     H        1   Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Journal entry batch posting maintenance')     *
      *****************************************************************
      *                                                               *
      *  Midas - General Ledger Module                                *
      *                                                               *
      *  GL0121M- Edit Journal Entry Batch posting                    *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. CGL154             Date 13Oct14               *
      *  Prev Amend No. LLN022A            Date 03Jun15               *
      *                 MD027587           Date 19Jun14               *
      *                 MD024475           Date 07May14               *
      *                 AR1093096          Date 30Sep13               *
      *                 CRE041             Date 28Sep12               *
      *                 AR784719           Date 13Jun11               *
      *                 AR782538           Date 03Jun11               *
      *                 AR782069           Date 08Jun11               *
      *                 AR792734A          Date 20Sep11               *
      *                 AR802562           Date 07Sep11               *
      *                 AR787620           Date 10Jun11               *
      *                 CAP207             Date 10Feb11               *
      *                 CRE075             Date 06Dec10               *
      *                 AR739731           Date 03Apr11               *
      *                 AR740098           Date 02Apr11               *
      *                 CER059             Date 19Jul10               *
      *                 BUG26846           Date 14Aug09               *
      *                 BUG23742           Date 09May09               *
      *                 BUG23499           Date 19Mar09               *
      *                 CER047             Date 19May08               *
      *                 BUG21945           Date 12Dec08               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 260211             Date 14May09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 255341             Date 16Jul08               *
      *                 255364             Date 11Jul08               *
      *                 246922             Date 25Apr07               *
      *                 246418             Date 16Mar07               *
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 GBO021             Date 18Aug06               *
      *                 241505             Date 23Aug06               *
      *                 CDL049             Date 07Jul06               *
      *                 BUG11436           Date 02Jun06               *
      *                 237508             Date 23May06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 204679             Date 24Jul02               *
      *                 LLN022             Date 24Jan05               *
      *                 LLN021             Date 21Oct03               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG2488            Date 31May04               *
      *                 CGL014             Date 20Oct03               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG2304            Date 30Apr04               *
      *                 TDA035             Date 02Apr04               *
      *                 TDA025             Date 18Mar04               *
      *                 CRE019             Date 12Jan04               *
      *                 CGL029             Date 01Sep03               *
      *                 CRE008             Date 19Feb02               *
      *                 CGL013             Date 29Mar02               *
      *                 CGL016             Date 01Aug02               *
      *                 210796             DATE 27JAN03               *
      *                 214691             Date 02Apr03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 195961             Date 23May02               *
      *                 191175             Date 17Apr02               *
      *                 189519             Date 27Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSC011             Date 18Sep01               *
      *                 152295             Date 01Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 09Nov01               *
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 127199             Date 07Apr00               *
      *                 127185             Date 06Apr00               *
      *                 165092             Date 29Mar00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CAP032             Date 26Apr99               *
      *                 CGL010             Date 08Nov99               *
      *                 152205             DATE 18Oct99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 158805             DATE 17May99               *
      *                 CPL002             Date 08MAR99               *
      *                 CSD005             Date 01MAR99               *
      *                 CGL008             DATE 03Mar99               *
      *                 CTI002             DATE 23Sep98               *
      *                 143482             DATE 25Sep98               *
      *                 114000             DATE 20May98               *
      *                 127209             DATE 07May98               *
      *                 076566             DATE 26FEB98               *
      *                 CEU013             DATE 23FEB98               *
      *                 095522             DATE 26FEB98               *
      *                 090560             DATE 18FEB98               *
      *                 101696             DATE 04FEB98               *
      *                 105384             DATE 04FEB98               *
      *                 094655             DATE 22JAN98               *
      *                 088257             DATE 21JAN98               *
      *                 091729             DATE 21JAN98               *
      *                 085175             DATE 21JAN98               *
      *                 099191             DATE 24JUN97               *
      *                 CGL002             Date 28OCT96               *
      *                 CAC001             DATE 01FEB96               *
      *                 086290             DATE 26FEB96               *
      *                 099053             DATE 31JAN96               *
      *                 078761             DATE 13DEC95               *
      *                 077173             DATE 13DEC95               *
      *                 076029             DATE 13DEC95               *
      *                 074890             DATE 12DEC95               *
      *                 089856             DATE 26OCT95               *
      *                 S01408             DATE 05OCT95               *
      *                 087917             DATE 28JUN95               *
      *                 087770             Date 23MAY95               *
      *                 S01408             DATE 24JUL95               *
      *                 S01408             DATE 26JUN95               *
      *                 S01408             DATE 13JUN95               *
      *                 084499             DATE 18APR95               *
      *                 S01408             Date 10APR95               *
      *                 S01408             Date 06MAR95               *
      *                 079904             Date 05MAR95               *
      *                 083009             Date 09FEB95               *
      *                 082162             Date 25JAN95               *
      *                 S01408             Date 12JAN95               *
      *                 074778             Date 13OCT94               *
      *                 073456             Date 12OCT94               *
      *                 071924             Date 12OCT94               *
      *                 072084             Date 12OCT94               *
      *                 S01408             Date 22AUG94               *
      *                 063607             Date 01DEC93               *
      *                 S01413             Date 20JUL93               *
      *                 049957             Date 17FEB93               *
      *                 047414             Date 17FEB93               *
      *                 S10736             Date 07SEP92               *
      *                 E38270             Date 18JUN92               *
      *                 E28994             Date 11FEB92               *
      *                 S01314             Date 09MAY91               *
      *                 E19779             Date 07JAN91               *
      *                 BHF670             Date 05OCT90               *
      *                 LN0312             Date 07JUN90               *
      *                 LN0334             Date 07JUN90               *
      *                 LN0320             Date 06JUN90               *
      *                 LN0315             Date 06JUN90               *
      *                 S01234             Date 20NOV89               *
      *                 E19950             Date 07/11/89              *
      *                 E18852             Date 28/09/89              *
      *                 E19627             Date 28/08/89              *
      *                 S01212             Date 11/09/89              *
      *                 E18437             Date 18/05/89              *
      *                 E17939             Date ../05/89              *
      *                 E17819             Date 02/05/89              *
      *                 E17610             Date 27/04/89              *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CGL154 - FATCA Reporting (Recompile)                         *
      *  LLN022A - BOE Upgrade to MidasPlus - incorporate code from   *
      *            /COPY members and add switchability.               *
      *  MD027587 - Unable to used the C for Copy and T for Template  *
      *  MD024475 - Changes on branch is accepted even though there is*
      *             an error in the validation. Enhance fix AR802562  *
      *             to solve the issue.                               *
      *  AR1093096 - ABC - Reservations not removed for JRNE.         *
      *              (Child: AR1093097) (Recompile)                   *
      *  CRE041 - Enhancements to Customer Exchanges (Recompile)      *
      *  AR784719 - 6-digit cheque no. is not accepted. Patterned fix *
      *             with cheque maintenance validation process.       *
      *             (Child: AR784720)                                 *
      *  AR782538 - Misleading warning message issued when accnt is   *
      *             closed. Changed to more appropriate message       *
      *             (Child: AR782539)                                 *
      *  AR782069 - Batch entry flagged as accepted with outstanding  *
      *             errors. Apply core fix 241505A. (Child: AR782070) *
      *  241505A  - Consider #ERRIN indicate to determine individual  *
      *             valid indicators of journal entries.              *
      *  AR792734A - Projected Account movement show incorrect        *
      *              Available Balance when posting Cash Deposit.     *
      *              Used CGL016 codes to insert shadow postings      *
      *              when CRE023 is turned on (Child: AR792735A)      *
      *  AR802562 - Error in the validation of User Override for      *
      *             GL Accounts. Reversed Core Fix 158805. Prevented  *
      *             Entries with Non-Overridable errors to be added.  *
      *             (Child: AR802563)                                 *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,GLH00167                                 *
      *  CAP207 - Account Balance Check extended to other APIs        *
      *           (Recompile)                                         *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  AR739731 - Journal Entry Postings Maintenance Error stucked  *
      *             on error (Child: AR739758)                        *
      *  AR740098 - Journal Entry Postings Maintenance unlabeled      *
      *             fields (Child: AR740099) (Recompile)              *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG26846 - Batch could not be accepted                       *
      *  BUG23742 - Improper handling of Ext Narr from Batch          *
      *             Interface Input                                   *
      *  BUG23499 - Database error on Journal Entry Input based on    *
      *             Interface file                                    *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  BUG21945 - Reset of #1PVDT for interface processing to       *
      *             enable value date holiday warning validation.     *
      *             New parameter for interface processing.           *
      *             Apply fix 246922.                                 *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  260211 - GL impossible to enter Associated Customer which is *
      *           the same as the Customer Number used. Removed core  *
      *           fix#090560 to allow customer to be the same as batch*
      *           item account customer.                              *
      *  255341 - Add validation for Associated Customer and Profit   *
      *           Centre.  Apply ERZ033 Fix (CGL064).                 *
      *  255364 - Fix 204679 succesfully manages to disable F9 Insert *
      *           /Amend if TOF if not on. Apply fix 253929.          *
      *  246922 - Reset of #1PVDT for interface processing to         *
      *           enable value date holiday warning validation.       *
      *         - New parameter for interface processing.             *
      *  246418 - CGL013 changes for Midas Plus                       *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  GBO021 - OUTPUT tag :86: - Information to Account Owners     *
      *           Core hook GL0121MFP1, GL0121MI02, GL0121MC30,       *
      *           GL0121MK82, GL0121MC36, GL0121MC07, GL0121MC86,     *
      *           amended                                             *
      *           Core hook GL0121MM35, GL0121MM36, GL0121MM37,       *
      *           GL0121MM38, GL0121MM39, GL0121MM40, GL0121MM41      *
      *           added                                               *
      *  241505 - Journal entries BTVALI (valid field indicator)      *
      *           should be updated correctly.                        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  BUG11436 - Incorrect validation of associated customer       *
      *  237508 - Issue warning message if account is flagged for     *
      *           closure.                                            *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  204679 - Several fields should not be amendable if Private   *
      *           Banking is on and the journal entries come from     *
      *           TOF.                                                *
      *  LLN022 - BOE Upgrade to MidasPlus.                           *
      *  LLN021 - Associated customer field is mandatory if account   *
      *           code is 'INcome' or 'EXpense'.                      *
      *           Hook: GL0121MK17, GL0121MC08.                       *
      *         - Added user confirmation window prior to write/update*
      *           of P&L Income/Expense account codes.                *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG2488- Logical file REDDSSRCDV/TTRANL6 is based over  a    *
      *           phsical which is set to members = *nomax.  Amend    *
      *           TTRANL6 and create a  new logical file TTRANL7.     *
      *  CGL014 - Collaterals Processing                              *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  BUG2304 - Various file layout changes. Recompile.            *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  TDA025 - Recompiled due to changes in GL0121M#.              *
      *  CRE019 - Cheque Processing and Maintenance                   *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CRE008 - Cash Management                                     *
      *  CGL013 - MT94x Messages Generation                           *
      *  CGL016 - Projected Movements Update Prior to Authorisation.  *
      *  210796 - EXTEND OUR A/C AT NOSTRO FIELD                      *
      *  214691 - Nostro position is not updated using journal entries*
      *           input.                                              *
      *  195961 - Invalid Transaction type was accepted. Fix is to    *
      *           correct validation processing for the said field.   *
      *  191175 - CGL008 Modification. User cannot authorise the      *
      *           batch if any amendment was made and the user        *
      *           authority level is 'Z'.                             *
      *  189519 - Can't insert multibranch batch without authority to *
      *           action code 'A'. Introduced P4SACD to receive the   *
      *           appropriate code passed by GL0101R.                 *
      *  CSC011 - 24x7 Midas Availability                             *
      *  152295 - Set off bits of WURETB, instead of moving BLANKS    *
      *           to work field WURETB for a non-existing account.    *
      *  CPK014 - Release 4 packaging:                                *
      *           - A default timestamp string is required for        *
      *             file GLJENPPD write.                              *
      *  127199 - Journal Entries with no error are not saved when    *
      *           F3 is pressed. Fix is to ensure that valid entries  *
      *           are saved & only those invalid will be disregarded  *
      *           when F3 key is pressed.                             *
      *  127185 - If client has a short name built exactly as the     *
      *           nostro account,then check if it exists in SDNOSTL0  *
      *           first .                                             *
      *  165092 - Ret number is not written to Gljenppd when a nostro *
      *           number is entered (Nostro is retail) .              *
      *  CAP032 - Conversion of Journal Batch Entry inputs into       *
      *           modular structure to use as APIs. Recompiled        *
      *           due to change in length of #1DBRC field in the      *
      *           display file.                                       *
      *  CGL010 - Future Value Dated Journal Entries for Non-Retail   *
      *           Accounts.                                           *
      *  152205 - Change for transaction type checking must be        *
      *           reversed for Management Accounts users.             *
      *  158805 - Journal Entry - CGL002 is incorrect in SR/SRGLST    *
      *  CPL002 - Midas-Plato Interface.                              *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CGL008 - Security on Journal Entry                           *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
      *  143482 - BATCH INPUT IS NOT ALLOWED ON THE DAY IT IS SET TO  *
      *           CLOSE IN THE MAPPING DETAILS.                       *
      *  114000 - History batches enquiry; customer numbers displayed *
      *           incorrectly.                                        *
      *  127209 - '?' should not be accepted as a valid trans type.   *
      *  076566 - Retail Account Trans Type validation not complete   *
      *  CEU013 - EMU Account Postings Narrative                      *
      *  095522 - BATCH BRANCH CODE INCORRECT                         *
      *  090560 - Associated Cust should not be same as the Batch Item*
      *           Customer Nbr - amend pgm to output error message.   *
      *  101696 - Text '?=Copy Special Character' should only be      *
      *           shown when copy facility is used so as not to       *
      *           confuse the user.                                   *
      *  105384 - Cust. originated field (BTCOIN) of journal entries  *
      *           in GLJENPPD are not updated correctly, causing some *
      *           accounts to be incorrectly transferred to inactive  *
      *           and some reported in retail accounts excess report  *
      *           as having no credit for 31 days.                    *
      *  094655 - Misleading error message 'Check No. must be numeric'*
      *           if invalid customer is entered.  Amend pgm to reset *
      *           WUERCD to '0' before validating cheque no. if input.*
      *  088257 - Program does not retain the Retail Override value.  *
      *           If Override Of Errors not allowed, the program does *
      *           not update the Item Records with the 'N' value of   *
      *           the 'Retail Override'. File update forced.          *
      *         - If invalid account entered, skip retail errors check*
      *           as program is checking values from previous batch   *
      *           item in this case.                                  *
      *  091729 - Pgm not correctly checking Value Date for holiday;  *
      *        1) Program GL0130U has been amended to correctly return*
      *           a value of H or W, instead of an incorrect numeric  *
      *           value.                                              *
      *        2) Amend this pgm to display a warning message if value*
      *           date is a holiday in A/c currency.                  *
      *  085175 - If value date blanked out, default it to the        *
      *           posting date.                                       *
      *  099191 - Value date of entries not defaulted to rundate.     *
      *           (Applied fix 093924.)                               *
     F*  CGL002 - Block GL Accounts in Journal Entry Input            *
     F*  CAC001 - Profit Centre Accounting Development:               *
     F*           For default profit centre processing, default       *
     F*           profit centre to the profit centre of the account   *
     F*           for Retail and Nostro accounts.  Also, make the     *
     F*           profit centre field mandatory.  And lastly, for     *
     F*           Retail and Nostro accounts, display a warning if    *
     F*           profit centre entered is not equal to the profit    *
     F*           centre of the account.                              *
     F*   086290 - Customer originated field (BTCOIN) of journal      *
     F*            entries in GLJENPPD are not updated correctly      *
     F*            causing some accounts to be incorrectly            *
     F*            transferred to inactive.                           *
     F*  099053 - Fix to GEMS no 076029.                              *
     F*           Fix incorporated within wrong Subroutine;           *
     F*  078761 - On re-using a deleted Batch No, random Batch Items  *
     F*           displayed before any have been input.               *
     F*  077173 - Retail Error Override Indicator #1RINO check allows *
     F*           values of ' ', 'N', 'Y'  but processing checks for  *
     F*           EQ/NE ' ' making values of N/Y treated as equal.    *
     F*           (Includes amendment 084427 to this fix)             *
     F*  076029 - Move blanks to parameter UUCUST (Cust No) before    *
     F*           call to access program AOACCTR0 (Access A/C Dets)   *
     F*           in SR/UDSUBR (Check for Retail Account No).  This   *
     F*           ensures that ACCNTL1 (keyed on ACNO) is used in     *
     F*           chaining for the accnt details, if the retail a/c   *
     F*           no. has changed, else the pgm will chain with the   *
     F*           old Midas a/c no, and update the retail a/c no field*
     F*           with the previous retail a/c no.                    *
      *  074890 - Outstanding errors exist displayed even if all      *
      *           the fields are correct.  #1RINO not initialized.    *
      *  089856 - Change to allow posting amount as 13N as specified  *
      *           in Ins Manual.                                      *
      *  S01408 - Addition of core hook  GL0121MFP1                  *
      *   087917 - If, and only if, entire entry (all screen fields   *
      *            on a changed record) is blank, ignore the record   *
      *            for processing, ensuring appropriate work fields   *
      *            are reset.                                         *
      *  087770 - Template function is not working properly; instead  *
      *           of displaying the item selected for template,       *
      *           system displays the previous item selected. Fix     *
      *           to amend SR/DFV2RC to check if WUTFUS *EQ 'N'.      *
      *         - Template and copy character '&' return incorrect    *
      *           values in ADD mode if Enter pressed before F9.      *
      *           Fix is in define separate work fields for 'Copy'    *
      *           and 'Template' functions so that they do not        *
      *           overwrite each other.                               *
      *  S01408 - Addition of core hooks GL0121MC13                  *
      *           Addition of core hooks GL0121MC14                  *
      *  S01408 - Addition of core hooks GL0121MCP8                  *
      *           Addition of core hooks GL0121MCP9                  *
      *           Addition of core hooks GL0121MC10                  *
      *           Addition of core hooks GL0121MC11                  *
      *           Addition of core hooks GL0121MC12                  *
      *  S01408 - Addition of core hooks GL0121MVSF                  *
      *  084499 - Call AORETLR0 only if retail exists.               *
      *  S01408 - Addition of core hook  GL0121MEP1                  *
      *  S01408 - Addition of core hooks GL0121MIR1                  *
      *                                  GL0121MNUL                  *
      *                                  GL0121MCP7                  *
      *                                  GL0121MCP6                  *
      *                                  GL0121MRF1                  *
      *                                  GL0121MRF2                  *
      *                                  GL0121MIR2                  *
      *  079904 - When a ? is entered in the narrative field in add  *
      *           mode, then make sure the screen is redisplayed     *
      *           even if there are no errors.                       *
      *  083009 - /COPYs have wrong names.                            *
      *  082162 - Change 074788 does not take into account whether    *
      *           the Management Accounts module is present.          *
      *  S01408 - Addition of core hook GL0121MCP5                    *
      *  074778 - Invalid transaction type can be entered             *
      *  073456 - If multi-branch flag (P1MBRB) is 'N', display       *
      *           GLX0144 else, display GLX0054. So that if account   *
      *           exist in another branch, the correct msg will be    *
      *           displayed to the user.                              *
      *  071924 - DEFAULT PROFIT CENTRE PROCESSING NOT WORKING        *
      *           CORRECTLY. CHANGES MADE SO THAT CUSTOMER AND        *
      *           ACCOUNT OFFICER PARAMTERS FOR AOPRFMR0 ARE TAKEN    *
      *           FROM ASSOCIATED CUSTOMER IF ENTERED, ELSE FROM      *
      *           ACCOUNT. AOPRFMR0 RETURN CODE CHANGED TO 1A.        *
      *  072084 - NON MULTIPLE BRANCH BATCH ALLOWS ENTRY OF MULTIPLE  *
      *           BRANCHES CAUSING DAILY JOURNAL OUT OF BALANCE.      *
      *           RESTICT ENTRY OF ITEM BRANCH NUMBER TO THAT ON      *
      *           HEADER                                              *
      *  S01408 - ADDITION OF HOOK GL0121MCP1                         *
      *           ADDITION OF HOOK GL0121MCP2                         *
      *           ADDITION OF HOOK GL0121MCP3                         *
      *           ADDITION OF HOOK GL0121MCP4                         *
      *  063607 - 'NO. OF ITEMS' DISPLAYS 'ACCNT N'.                  *
      *  047414 - REWORK OF 047414. DO NOT DISPLAY BRANCH NUMBER IF   *
      *           NOT MULTIBRANCH BATCH. REMOVE INCORRECT CODE.       *
      *  S01413 - RETAIL 3 INCORPORATION:- NUMBER OF ITEMS AVAILABLE. *
      *  049957 - SPECIAL COPY CHAR NARRATIVE IS NOT APPEARING ON     *
      *           1ST INSERT SCREEN.                                  *
      *  047414 - MULTI-BRANCH BATCHES WHEN MULTIBRANCH BATCH = N     *
      *           CAUSE EOD CURRENCY OUT OF BALANCE PROBLEMS          *
      *  S10736 - MANAGEMENT ACCOUNTS                                 *
      *  E38270 - DO NOT DISPLAY BRANCH IF MBIN IS 'N'                *
      *  E28994 - SUBFILE NOT POSITIONING TO PAGE IN ERROR            *
      *  S01314 - Multi-Language Subfile Coding                       *
      *  E19779 - CALCULATE 'MAXIMUM FORWARD DATE'                    *
      *  BHF670 - PREVENT LEADING ZEROS FROM BEING DROPPED OFF        *
      *           THE CHEQUE NUMBER                                   *
      *  LN0312 - FOOTER TEXT TO READ F3=BATCH SUMMARY INSTEAD OF EXIT*
      *  LN0334 - RETURN ACCOUNT CODE FROM AOACODR0                   *LN0334
      *  LN0320 - ALLOW N IN OVERRIDE FIELD                           *LN0320
      *  LN0315 - ADDITION OF RETAIL INDICATORS ON CALL TO AOACCTR0   *LN0315
      *  S01234 - JOURNAL ENTRY TEMPLATE ENHANCEMENTS                 *
      *  E19950 - TO RESTRICT THE ENTRY OF DR/CR INDICATOR SAME AS    *
      *           THE DR/CR INDICATOR OF THE TX TYPE IF THE TX TYPE   *
      *           IS ENTERED.                                         *
      *  E18852 - TO RESTRICT ENTRIES BEING MADE ACROSS DIFFERENT     *
      *           BRANCHES                                            *
      *  E19627 - TO ALLOW VALID NOSTRO NUMBER STO BE ENTERED INTO    *
      *           THE ACCOUNT IDENTIFIER FIELD.                       *
      *  S01212 - TO RESTRICT THE COPYING OF RECORDS TO THE LAST ONE  *
      *           PRESENT ON THE FILE & ADD /COPY STATEMENTS          *
      *  E18437 - PROGRAM ALLOWED ENTRIES TO BE INPUT ACROSS CLOSED   *
      *           ACCOUNTS.                                           *
      *  E17939 - RETAIL ACCOUNT NUMBER REVERTS BACK TO THE CUSTOMER  *
      *           NUMBER IN THE ACCOUNT NUMBER FIELD. THIS DID NOT    *
      *           HAPPEN ON S38. FILE CHANGE WAS REQUIRED TO DETER-   *
      *           MINE WHETHER A RETAIL AC NO WAS ENTERED. FIELD WAS  *
      *           'RETAIL A/C NUMBER ENTERED'.                        *
      *  E17819 - SUBFILE IS BEING CLEARED DOWN EVERY TIME AN ERROR   *
      *           OCCURED IN THE TRANSACTION CODE OR ACCOUNT NO FLD.  *
      *  E17610 - ON RETURNING FROM THE SELECT NARRATIVE CODE PGM     *
      *           AFTER PLACING A '?' INTO THE NARRATIVE CODE THE     *
      *           FIELD WAS NOT BEING UPDATED WITH THE SELECTED       *
      *           NARRATIVE CODE.                                     *
      *  S01212 - WINDOW PROCESSING INSTALLED - /COPY                 *
      *                                                               *
      *****************************************************************
      *                                                                   CGL008
     FMUSER   IF  E           K        DISK                           UC  CGL008
      ** RTV : Midas SF Midas Users                                       CGL008
      *                                                                   CGL008
     FSFACAUL0IF  E           K        DISK                           UC  CGL008
      ** RTV : Account Code/Authorities File By Account Code              CGL008
      *                                                                   CGL008
     F/COPY WNCPYSRC,GL0121MFPG
     FGL0121M#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: Midas GL Edit Journal Entry Batch posting
      *
     FGLJENPL1IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RTV : Midas GL Journal Entry Posting Rtv
      *
     FGLJENHL1IF  E           K        DISK
      * RTV : Midas GL Journal Entry Header LF Rtv
      *
     FGLJENPL0UF  E           K        DISK                      A
     F                                              KCOMIT
     FAPVLOGL0UF  E           K        DISK         KCOMIT            UC                      CSC011
      *                                                                                       CSC011
      * UPD : Midas GL Journal Entry Posting Update
     FFDDTSTL1IF  E           K        DISK                               076566
      * RTV : BIS¦Midas¦ABS DL Trans Type/Sub-Types                       076566
      *                                                                   076566
     FINVTO   IF  E           K        DISK                               076566
      * RTV : BIS¦Midas¦ABS SE Investment Types                           076566
      *                                                                   076566
     FGLJENXL2IF  E           K        DISK         KINFSR *PSSR                              CGL013
      ** RTV: Midas GL Journal Entry File - Additional Information                            CGL013
      *                                                                                       CGL013
     FGLJENXL3UF  E           K        DISK         KINFSR *PSSR                              CGL013
     F            GLJENXD0                          KRENAME@LJENXD0                           CGL013
      ** UPD: Midas GL Journal Entry File - Additional Information                            CGL013
      *
     FCHQBKL1 UF  E           K        DISK         KINFSR *PSSR A                            CRE019
      ** Midas RE Cheque Book file - 1                                                        CRE019
      *                                                                                       CRE019
     FTTRANL6 IF  E           K        DISK                                                   CRE019
      ** Midas RE Cheques Presented with Warning Messages                                     CRE019
      *                                                                                      BUG2488
     FTTRANL7 IF  E           K        DISK         KINFSR *PSSR      UC                     BUG2488
      ** Teller Trans. logical file of all presented cheques                                 BUG2488
      *                                                                                      BUG2488
     FSDTELDL1IF  E           K        DISK         KINFSR *PSSR                             BUG2488
      ** Teller Identification file                                                          BUG2488
      *                                                                   S01408
      ** RTV: Midas GL MultiCash Narratives File - Rtv Indx                                 BUG23742
      *                                                                                     BUG23742
     FGLMNARL3IF  E           K        DISK         KINFSR *PSSR                            BUG23742
      *                                                                                     BUG23742
      ** UPD: Midas GL MultiCash Narratives File - by Batch Number & Item                   BUG23742
      *                                                                                     BUG23742
     FGLMNARL2UF  E           K        DISK         KINFSR *PSSR                            BUG23742
     F            GLMNARD0                          KRENAMEGLMNARD2                         BUG23742
      *                                                                                     BUG23742
     F/COPY WNCPYSRC,GL0121MFP1                                           S01408
      *                                                                   S01408
      *                                                                   S01408
     E/COPY WNCPYSRC,GL0121MEP1                                           S01408
      *                                                                   S01408
     E                    UBLK        8  1
     E                    @IE     1   2 76               Item Err.Msgs.
     E                    @IH         8  9               Item Err.slots
     E                    ATRT        5  1               Trans Type       076566
     E                    ATST       10  1               Trans Sub-Type   076566
     E                    ADLT   24  24  2               DL Trans Type    076566
     E                    AFTT    5   5  2               FT Trans Type    076566
     E/COPY WNCPYSRC,GL0121ME01
     E**********          @MSG    1   1 79               Free-Fmt Msgs.                090560 260211
     E/COPY WNCPYSRC,GL0121ME02
     E                    STAMP   1   1 26                                                    CPK014
      ** Array containing dummy timestamp                                                     CPK014
     E                    CPY@    1   1 80               Copyright array
      *                                                                                      BUG2488
     E                    @TXT    1   2 80                                                   BUG2488
      **  Array containing Text Strings for Override of Files                                BUG2488
      *                                                                                       246418
      * Parameters for pass to GL000185                                                       246418
     E                    FLDNMA     75 10                                                    246418
     E                    MSGIDA     75  7                                                    246418
     E                    MSGDTA     75 45                                                    246418
      *                                                                                       CRE019
      ** Work array for CQPS                                                                  CRE019
      *                                                                                       CRE019
     E                    WAR        20  1                                                    CRE019
     E                    WCH       999  8                                                    CRE019
      *                                                                                       CRE019
     E/COPY WNCPYSRC,GL0121MEPG
      *                                                                                       CRE019
      ** Rename fields in TTRANL6 for record format @BTREMG                                   CRE019
      *                                                                                       CRE019
     I@BTREMG                                                                                 CRE019
     I              BTCQNB                          TRCQNB                                    CRE019
     I              BTBTNB                          TRBTNB                                    CRE019
     I              BTBINB                          TRBINB                                    CRE019
     I              BTIBCA                          TRIBCA                                    CRE019
     I              BTCUST                          TRCUST                                    CRE019
     I              BTCYCD                          TRCYCD                                    CRE019
     I              BTACCD                          TRACCD                                    CRE019
     I              BTACSN                          TRACSN                                    CRE019
     I              BTRACN                          TRACNO                                    CRE019
      *                                                                                       CRE019
      ** Rename fields in TTRANL6 for record format CUSEXCEF                                  CRE019
      *                                                                                       CRE019
     ICUSEXCEF                                                                                CRE019
     I              DRBR                            TDRBR                                     CRE019
     I              DCUS                            TDCUS                                     CRE019
     I              DRCY                            TDRCY                                     CRE019
     I              DCOD                            TDACOD                                    CRE019
     I              DACS                            TDACS                                     CRE019
     I              DRAN                            TRACNO                                    CRE019
      *                                                                                       CRE019
      ***Rename*fields*in*TTRANL6*for*record*format*TTRAND0************               CRE019 BUG2488
      *****************************************************************               CRE019 BUG2488
     I***TTRAD0                                                                       CRE019 BUG2488
     I*********     ACNO                            TRACNO                            CRE019 BUG2488
     I*********     HCAC                            TAACNO                            CRE019 BUG2488
     I*                                                                   CPL002
     IINVTPDF                                                             CPL002
     I*                                                                   CPL002
     I** Rename PLDPCD to avoid confusion with PLDPCD on PF/FDDTSTPD      CPL002
     I              PLDPCD                          INDPCD                CPL002
     I*                                                                   CPL002
     I*****P@BJRF    E DSSDBANKPD                                         S01117
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE                       S01117
     I*                                                                   S01117
     I*
     I*****P@ACCT    E DSACCNTAB
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     I*
     I*
     I*   Define MIDAS Rundate from data-area RUNDAT
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I* Define Data area MUSER                                         ***
     I*                                                                ***
     I*
     I/COPY WNCPYSRC,GL0121MIPG
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSGLJENPL0
      * UPD : Midas GL Journal Entry Posting Update
      * Current/previous master file format fields for change control
      *
     I            DS
     I                                        1   60UUDNMA
     I            DS
      * Determine Account identity
     I                                        1  10 UKACID
     I                                        1   6 UKACF6
     I                                        1   3 UKACF3
     I                                        1   1 UKACF1
     I                                        1   1 UKACA1
     I                                        2   2 UKACA2
     I                                        3   3 UKACA3
     I                                        4   5 UKACM2
     I                                        6  10 UKACL5
     I                                        7  10 UKACL4
      * Set up parameters :
     IGLREOV      DS
      * Retail Override data area data structure
     I                                        1   1 URRE01
     I                                        2   2 URRE02
     I                                        3   3 URRE03
     I                                        4   4 URRE04
     I                                        5   5 URRE05
     I                                        6   6 URRE06
     I                                        7   7 URRE07
     I                                        8   8 URRE08
     I                                        9   9 URRE09
     I                                       10  10 URRE10
      *
      ** Data structure to update last transaction number                                     CRE019
      *                                                                                       CRE019
     IDNATN       DS                              5                                           CRE019
     I                                        1   50FNATN                                     CRE019
      *                                                                                       CRE019
     I            DS
      * Item error status data structure
     I                                        1 152 @IE
     I                                        1  76 URERMG
     I                                       77 152 URDASH
     I                                        5  76 @IH
     I                                        5  76 URIESL
     I                                        5   5 URHL01
     I                                       14  14 URHL02
     I                                       23  23 URHL03
     I                                       32  32 URHL04
     I                                       41  41 URHL05
     I                                       50  50 URHL06
     I                                       59  59 URHL07
     I                                       68  68 URHL08
     IWURARC      DS
     I                                        1   1 WURSRD
     I                                        2   2 WURSRC
     I                                        3   3 WURSBD
     I                                        4   4 WURSBC
     I                                        5   5 WURSIN
     I                                        6   6 WUDBST
     I                                        7   7 WURSBR
     I                                        8   8 WURTSB
     I                                        9   9 WURSSC
     I                                       10  10 WUFMST
      *
     I            DS
     I                                        1   60UUDNUM
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
     I            DS                                                                         BUG2488
      ** Data structure to hold string constants for QCMDEXC                                 BUG2488
     I                                        1  80 @CMD                                     BUG2488
     I                                       30  30 @BRI                                     BUG2488
     I                                       31  33 @BID                                     BUG2488
      *                                                                                       CSC011
     ITRANDL      DS                           5800                                           CSC011
     ITRNDTL      DS                           5800                                           CSC011
      *                                                                                       CSC011
     IUUFDY     E DSDSFDY
     I*
     I* 200 Byte Data Structure for Incoming Data from Access Program
     I*
     IUUSDY     E DSDSSDY
     I*
     I* 800 Byte Data Structure for Incoming Data from Access Program
      *                                                                                       CSC011
     IAPHEAD      DS                            200                                           CSC011
     I                                        1  32 APTYPE                                    CSC011
     I                                       81  90 APUSER                                    CSC011
     I                                      137 137 APRESP                                    CSC011
     I                                      139 158 APFTRN                                    CSC011
     I                                      159 178 APFASC                                    CSC011
     I                                      180 180 APRPRL                                    CSC011
     I*
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNO
     I                                       11  11 SUCP
     I                                       12  12 DTFF
     I                                       13  13 MBIN
      *                                                                                       CRE008
      ** DS for message data for overdraft limit check                                        CRE008
      *                                                                                       CRE008
     IWOLTXT      DS                                                                          CRE008
     I**********                              1  18 WMDTA1                             CRE008 CGL029
     I**********                              1  29 WMDTA2                             CRE008 CGL029
     I                                        1  24 WMDTA1                                    CGL029
     I                                        1  35 WMDTA2                                    CGL029
     I                                        1   3 WBRCDE                                    CRE008
     I                                        4   4 WDASH1                                    CRE008
     I                                        5  10 WCUSTN                                    CRE008
     I                                       11  11 WDASH2                                    CRE008
     I**********                             12  15 WACOD                              CRE008 CGL029
     I**********                             16  16 WDASH3                             CRE008 CGL029
     I**********                             17  18 WACSQ                              CRE008 CGL029
     I**********                             19  19 WSLSH                              CRE008 CGL029
     I**********                             20  29 WRETN                              CRE008 CGL029
     I                                       12  21 WACOD                                     CGL029
     I                                       22  22 WDASH3                                    CGL029
     I                                       23  24 WACSQ                                     CGL029
     I                                       25  25 WSLSH                                     CGL029
     I                                       26  35 WRETN                                     CGL029
     I*
     ID@ACOD    E DSSDACODPD
     I*
     I*  Account Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@BOOK    E DSSDBOOKPD
     I*
     I*  Book Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@ACCT    E DSACCNTAB
     I*
     I*  Account Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     IP@BJRF    E DSSDBANKPD
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     ID@BRCH    E DSSDBRCHPD
     I*
     I*  Branch Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@CUST    E DSSDCUSTPD
     I              QQDFAC                          DFACQQ                                    CGL029
     I*
     I*  Client Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@CURR    E DSSDCURRPD
     I*
     I*  Currency Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@NOST    E DSSDNOSTPD
     I              QQACCD                          ACCDQQ                                    CGL029
     I*
     I*  Nostro Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@NARR    E DSSDNARRPD
     I*
     I*  Narrative Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@PRFC    E DSSDPRFCPD
     I*
     I*  Profit Centre DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@PRFM    E DSSDPRFMPD
     I*
     I*  Profit Centre Def Matrix DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@RETR    E DSSDRETRPD
     I*
     I*  Retail Transaction Types DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@GELR    E DSSDGELRPD
     I              QQACCD                          #ACCD1                                    CGL029
     I*
     I*  General Ledger Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@RETL    E DSSDRETLPD
     I              QQACCD                          #ACCD@                                    CGL029
     I*
     I*  Retail Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ILDA       E DSLDA                         256                                           CGL013
      ** Local Data Area for Database Error Details                                           CGL013
      *                                                                                       CGL013
     I/COPY WNCPYSRC,GL0121MI02
     IZMUSER      DS
     I                                        1  10 USID
     I                                       11  13 UDBC
     I                                       14  16 UDDP
     I                                       17  17 UBLA
      *                                                                                       CSC011
     ISDSTAT      DS                            256                                           CSC011
     I                                        6   7 LIBR                                      CSC011
      *                                                                                       CSC011
     ISC24X7      DS                            256                                           CSC011
     I                                        3   4 S1SUPP                                    CSC011
      *                                                                                       CSC011
     ID@MMOD    E DSSDMMODPD
     I*
     I*  Midas Modules DS for assigning data from Access
     I*  Programs to work fields
     I*
     I/COPY QWINDSRC,GL0121GDTA
      ** Data to be passed to window program                                                  LLN022
      *                                                                                       LLN022
     ID@SARD    E DSSCSARDPD                                              CGL002
     I*                                                                   CGL002
     I*  Switchable Features DS                                           CGL002
     I              LCD                             LCDX                  CGL002
     I*                                                                   CGL002
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Journal Entry Header
      * I : RST Batch number
     I                                        1   3 P1BTNB
      * I :  Branch Code - Alpha
     I                                        4   6 P1BCDA
      * I :  Dept Code
     I                                        7   9 P1DPCD
      * I :  Hash item no.calculated
     I                                    P  10  110P1HINC
      * I :  Multiple Branch Batch
     I                                       12  12 P1MBRB
     IP2PARM      DS
      * I :  Branch Internal Customer
     I                                        1   6 P2BICN
     IP3PARM      DS
      * O :  Exit option
     I                                        1   1 P3EXTO
     IP4PARM      DS                                                                          189519
      * I :  SPF Action Code                                                                  189519
     I                                        1   1 P4SACD                                    189519
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Subfile Select Details'
      * Message data for 'Copy Special Char Add Mod'
      * JE Special Character
     I                                        1   1 ZA0001
      * Message data for 'Subfile Select Details'
      * Message data for 'Copy Special Char Add Mod'
      * JE Special Character
     I                                        1   1 ZA0002
      * Message data for 'Copy/Template - ENTER'
      * *SFLSEL
     I                                        1   1 ZA0003
      * Message data for 'Account ID not valid ERR'
      * Account Identifier
     I                                        1  10 ZA0004
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0005
      * Currency code
     I                                       11  13 ZA0006
      * Account code
     I**********                             14  17 ZA0007                                    CGL029
     I                                       14  23 ZA0007                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0008                                    CGL029
     I                                       24  25 ZA0008                                    CGL029
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0009
      * Currency code
     I                                       11  13 ZA0010
      * Account code
     I**********                             14  17 ZA0011                                    CGL029
     I                                       14  23 ZA0011                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0012                                    CGL029
     I                                       24  25 ZA0012                                    CGL029
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0013
      * Currency code
     I                                       11  13 ZA0014
      * Account code
     I**********                             14  17 ZA0015                                    CGL029
     I                                       14  23 ZA0015                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0016                                    CGL029
     I                                       24  25 ZA0016                                    CGL029
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0017
      * Currency code
     I                                       11  13 ZA0018
      * Account code
     I**********                             14  17 ZA0019                                    CGL029
     I                                       14  23 ZA0019                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0020                                    CGL029
     I                                       24  25 ZA0020                                    CGL029
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0021
      * Currency code
     I                                       11  13 ZA0022
      * Account code
     I**********                             14  17 ZA0023                                    CGL029
     I                                       14  23 ZA0023                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0024                                    CGL029
     I                                       24  25 ZA0024                                    CGL029
      * Message data for 'Account is Closed'
      * Account Identifier
     I                                        1  10 ZA0025
      * Currency code
     I                                       11  13 ZA0026
      * Account code
     I**********                             14  17 ZA0027                                    CGL029
     I                                       14  23 ZA0027                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0028                                    CGL029
     I                                       24  25 ZA0028                                    CGL029
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0029
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0030
      * Currency code
     I                                       11  13 ZA0031
      * Account code
     I**********                             14  17 ZA0032                                    CGL029
     I                                       14  23 ZA0032                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0033                                    CGL029
     I                                       24  25 ZA0033                                    CGL029
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0034
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0035
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0036
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0037
      * Message data for 'Account is Closed'
      * Account Identifier
     I                                        1  10 ZA0038
      * Currency code
     I                                       11  13 ZA0039
      * Account code
     I**********                             14  17 ZA0040                                    CGL029
     I                                       14  23 ZA0040                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0041                                    CGL029
     I                                       24  25 ZA0041                                    CGL029
      * Message data for 'Customer not found'
      * Account Identifier
     I                                        1  10 ZA0042
      * Message data for 'Currency Code Required'
      * Currency code
     I                                        1   3 ZA0043
      * Message data for 'Account Code Required'
      * Account code
     I**********                              1   4 ZA0044                                    CGL029
     I                                        1  10 ZA0044                                    CGL029
      * Message data for 'Account Seq Required'
      * Account sequence number
     I                                        1   2 ZA0045
      * Message data for 'Branch Code Required'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0046
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0047
      * Currency code
     I                                       11  13 ZA0048
      * Account code
     I**********                             14  17 ZA0049                                    CGL029
     I                                       14  23 ZA0049                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0050                                    CGL029
     I                                       24  25 ZA0050                                    CGL029
      * Message data for 'Account is Closed'
      * Account Identifier
     I                                        1  10 ZA0051
      * Currency code
     I                                       11  13 ZA0052
      * Account code
     I**********                             14  17 ZA0053                                    CGL029
     I                                       14  23 ZA0053                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0054                                    CGL029
     I                                       24  25 ZA0054                                    CGL029
      * Message data for 'SPF Atn Cde ERR 1 ZVACTBU'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0055
      * Message data for 'SPF Atn Cde ERR 5 ZVACTBU'
      * SPF Action Code
     I                                        1   1 ZA0056
      * Branch Code - Alpha
     I                                        2   4 ZA0057
      * Message data for 'Amount not valid'
      * Formatted Posting amount
     I                                        1  14 ZA0058
      * Message data for 'Amount not valid'
      * Formatted Posting amount
     I                                        1  14 ZA0059
      * Message data for 'Posting amount is req'd'
      * Formatted Posting amount
     I                                        1  14 ZA0060
      * Message data for 'Debit Credit must be Y/N'
      * Debit/credit indicator
     I                                        1   1 ZA0061
      * Message data for 'No Narrative entered'
      * Narrative
     I                                        1  30 ZA0062
      * Message data for 'Narrative Code not found'
      * Narrative
     I                                        1  30 ZA0063
      * Message data for 'Trans. type not valid'
      * Transaction type
     I                                        1   5 ZA0064
      * Message data for 'Trans. type not right D/C'
      * Transaction type
     I                                        1   5 ZA0065
      * Message data for 'Must enter Trans Type'
      * Transaction type
     I                                        1   5 ZA0066
      * Message data for 'Cheque no contains blanks'
      * Cheque number
     I                                        1   8 ZA0067
      * Message data for 'Cheque Number Numeric'
      * Cheque number
     I                                        1   8 ZA0068
      * Message data for 'Stopped Cheque'
      * Cheque number
     I                                        1   8 ZA0069
      * Message data for 'Can't O'ride Retail error'
      * Account Identifier
     I                                        1  10 ZA0070
      * Currency code
     I                                       11  13 ZA0071
      * Account code
     I**********                             14  17 ZA0072                                    CGL029
     I                                       14  23 ZA0072                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0073                                    CGL029
     I                                       24  25 ZA0073                                    CGL029
      * Message data for 'Retail Error Req's Overde'
      * Retail ind.: Override
     I                                        1   1 ZA0074
      * Message data for 'Retail Override Invalid'
      * Retail ind.: Override
     I                                        1   1 ZA0075
      * Message data for 'Value Date not valid 1'
      * Value date (display)
     I                                        1   6 ZA0076
      * Message data for 'Value Date not valid 2'
      * Value date (display)
     I                                        1   6 ZA0077
      * Message data for 'Value Date not valid 3'
      * Value date (display)
     I                                        1   6 ZA0078
      * Message data for 'Value Date Not Valid 9'
      * Value date (display)
     I                                        1   6 ZA0079
      * Message data for 'Value Date not valid 4'
      * Value date (display)
     I                                        1   6 ZA0080
      * Message data for 'Value Date not valid 5'
      * Value date (display)
     I                                        1   6 ZA0081
      * Message data for 'Value Date Not Valid 6'
      * Value date (display)
     I                                        1   6 ZA0082
      * Message data for 'Value Date Not Valid 7'
      * Value date (display)
     I                                        1   6 ZA0083
      * Message data for 'Value Date Not Valid 8'
      * Value date (display)
     I                                        1   6 ZA0084
      * Message data for 'Cheque No. must be blank'
      * Cheque number
     I                                        1   8 ZA0085
      * Message data for 'Value Date not valid 1'
      * Value date (display)
     I                                        1   6 ZA0086
      * Message data for 'Value Date not valid 2'
      * Value date (display)
     I                                        1   6 ZA0087
      * Message data for 'Value Date Must <= Today'
      * Value date (display)
     I                                        1   6 ZA0088
      * Message data for 'Value Date not valid 4'
      * Value date (display)
     I                                        1   6 ZA0089
      * Message data for 'Value Date not valid 5'
      * Value date (display)
     I                                        1   6 ZA0090
      * Message data for 'Assoc.Cust.No/Shortname 1'
      * Associated Cust - Display
     I                                        1  10 ZA0091
      * Message data for 'Book Codes Not Found.'
      * Book Code
     I                                        1   2 ZA0092
      * Message data for 'Profit Centres         NF'
      * Profit centre
     I                                        1   4 ZA0093
      * Message data for 'Profit Centres         NF'
      * Profit centre
     I                                        1   4 ZA0094
      * Message data for 'Reverse/Void  is invalid'
      * Reverse/Void Indicator
     I                                        1   1 ZA0095
      * Message data for 'Number of Items invalid'
      * Number of items - display
     I                                        1   5 ZA0096
      * Message data for 'Number of Items invalid'
      * Number of items - display
     I                                        1   5 ZA0097
      * Message data for 'Currency Code not found'
      * Currency code
     I                                        1   3 ZA0098
      * Message data for 'Account Code not found'
      * Account code
     I**********                              1   4 ZA0099                                    CGL029
     I                                        1  10 ZA0099                                    CGL029
      * Message data for 'Branch Code not found'
      * Branch code
     I                                        1   3 ZA0100
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0101
      * JE Special Character
     I                                       26  26 ZA0102
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0103
      * JE Special Character
     I                                       26  26 ZA0104
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0105
      * JE Special Character
     I                                       26  26 ZA0106
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0107
      * JE Special Character
     I                                       26  26 ZA0108
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0109
      * JE Special Character
     I                                       26  26 ZA0110
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0111
      * JE Special Character
     I                                       26  26 ZA0112
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0113
      * JE Special Character
     I                                       26  26 ZA0114
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0115
     I/COPY WNCPYSRC,GL0121MI04
      * JE Special Character
     I                                       26  26 ZA0116
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0117
      * JE Special Character
     I                                       26  26 ZA0118
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0119
      * JE Special Character
     I                                       26  26 ZA0120
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0121
      * JE Special Character
     I                                       26  26 ZA0122
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0123
      * JE Special Character
     I                                       26  26 ZA0124
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0125
      * JE Special Character
     I                                       26  26 ZA0126
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0127
      * JE Special Character
     I                                       26  26 ZA0128
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0129
      * JE Special Character
     I                                       26  26 ZA0130
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0131
      * JE Special Character
     I                                       26  26 ZA0132
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0133
      * JE Special Character
     I                                       26  26 ZA0134
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0135
      * Currency code
     I                                       11  13 ZA0136
      * Account code
     I**********                             14  17 ZA0137                                    CGL029
     I                                       14  23 ZA0137                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0138                                    CGL029
     I                                       24  25 ZA0138                                    CGL029
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0139
      * Currency code
     I                                       11  13 ZA0140
      * Account code
     I**********                             14  17 ZA0141                                    CGL029
     I                                       14  23 ZA0141                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0142                                    CGL029
     I                                       24  25 ZA0142                                    CGL029
      * Message data for 'Lots of Dots'
      * Message data for 'Subfile Select Details'
      * Message data for 'Copy Special Char Add Mod'
      * JE Special Character
     I                                        1   1 ZA0143
     I/COPY WNCPYSRC,GL0121MI01
      * Message data for 'Warning: Date entered: &1 is a Holiday in &2/&3'091729
      * JE Special Characters GLX0397                                     091729
     I                                        1   6 ZA0144                091729
     I                                        7   9 ZA0145                091729
     I                                       10  12 ZA0146                091729
      * Message data for 'Copy function not valid'                        CEU013
      * *Copy Error Field                                                 CEU013
     I                                        1  25 ZA0147                CEU013
      * JE Special Character                                              CEU013
     I                                       26  26 ZA0148                CEU013
      * Message data for 'Copy function not valid'                        CEU013
      * *Copy Error Field                                                 CEU013
     I                                        1  25 ZA0149                CEU013
      * JE Special Character                                              CEU013
     I                                       26  26 ZA0150                CEU013
      * Message data for 'Original currency invalid'                      CEU013
      * Original currency code                                            CEU013
     I                                        1   3 ZA0151                CEU013
      * Message data for 'Original amount invalid'                        CEU013
      * Original amount                                                   CEU013
     I                                        1  16 ZA0152                CEU013
      * Called program EU0200 in error                                    CEU013
     I                                        1  10 ZA0153                CEU013
      *                                                                                       CRE019
      ** Message data for 'Cheque Number is not in Range'                                     CRE019
      *                                                                                       CRE019
     I                                        1   8 ZA0154                                    CRE019
      *                                                                                       CRE019
      ** Message data for 'Cheque Number already Presented'                                   CRE019
      *                                                                                       CRE019
     I                                        1   8 ZA0155                                    CRE019
      *                                                                                       CRE019
      ** Message data for 'No Cheque Number Expected'                                         CRE019
      *                                                                                       CRE019
     I                                        1   8 ZA0156                                    CRE019
      *                                                                                       CRE019
     I/COPY WNCPYSRC,GL0121MI03
      *                                                                                       CGL013
     I            DS                                                                          CGL013
      *                                                                                       CGL013
      ** Parameter Passed to GL000185                                                         CGL013
      *                                                                                       CGL013
     I**********                              1 108 PDETLS                           CGL013 BUG23499
     I**********                              1 118 PDETLS                         BUG23499 BUG23742
     I                                        1 119 PDETLS                                  BUG23742
     I                                        1   3 #1BTNB                                    CGL013
     I                                        4   6 PABINB                                    CGL013
     I                                        7   9 #1BCBH                                    CGL013
     I                                       10  15 #1CUST                                    CGL013
     I                                       16  18 #1CYCD                                    CGL013
     I**********                             19  22 #1ACCD                             CGL013 CGL029
     I                                       19  22 #1ACQQ                                    CGL029
     I                                       23  24 #1ACSN                                    CGL013
     I                                       25  34 PARACN                                    CGL013
     I                                       35  48 #RFMPA                                    CGL013
     I                                       49  49 #1DCIN                                    CGL013
     I                                       50  79 #RNRTV                                    CGL013
     I                                       80  85 #RVDDS                                    CGL013
     I                                       86  90 #1TRTY                                    CGL013
     I                                       91 100 #1TSTY                                    CGL013
     I                                       93  96 #1TCLS                                    CLE042
     I                                      101 108 #1CQNB                                    CGL013
     I                                      109 118 #1ACCD                                    CGL029
     I                                      119 119 PEDIT                                   BUG23742
      *                                                                                       246418
      **  Valid JE Item (DS) for passing to GL000185                                          246418
     IPVBIPX    E DSGLVBIPXPD                                                                 246418
      *                                                                                       CSC011
     I              'GLBITPLOG'           C         WPGM                                      CSC011
     I              'APLOGTRAN'           C         WPGM2                                     CSC011
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1BTNB    PARM           WP0001  3        Batch number
     C           P1BCDA    PARM           WP0002  3        Branch Code - A
     C           P1DPCD    PARM           WP0003  3        Dept Code
     C           P1HINC    PARM           WP0004  30       Hash item no.ca
     C           P1MBRB    PARM           WP0005  1        Multiple Branch
     C           P2BICN    PARM           WP0006  6        Branch Internal
     C           P3EXTO    PARM P3EXTO    WP0007  1        Exit option
     C                     PARM           WP0008  1        Interface Jrnl CEU013
     C           P4SACD    PARM           WP0009  1        Action Code                        189519
     C           PBTAM     PARM PBTAM     WPBTAM  1                                           191175
     C                     PARM           WP0010  1        GL0121M Interface                  246922
     C/COPY WNCPYSRC,GL0121MK65
     C*                                                                   CEU013
      *****************************************************************
      * Initialise
     C                     EXSR ZZINIT
     C/COPY WNCPYSRC,GL0121MC24
      *
     C                     DO   *HIVAL
      *                                                                   CAC001
      **  Upon first screen entry or refresh command, do not issue        CAC001
      **  warnings right away.                                            CAC001
      *                                                                   CAC001
     C                     MOVE 'N'       WKWARN  1                       CAC001
      * Initialise and load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
     C/COPY WNCPYSRC,GL0121MK19
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C/COPY WNCPYSRC,GL0121MK84
     C                     EXSR CAEXFM
     C                     MOVE 'Y'       WKWARN                          CAC001
     C/COPY WNCPYSRC,GL0121MC90
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   05                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
     C/COPY WNCPYSRC,GL0121MC91
      *
     C                     END
     C                     END
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * USER: Initialise subfile header
      * End of Fix LN0312
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0121MISH - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0121MISH
     C*00/Copy Member GL0121M   Initialise Subfile Header
     C                     END                             *FI
      * If CHANGE mode, then position file:
     C           W0PMD     IFNE 'ADD'
     C           KPOS      KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      *                                                                                     BUG23742
      ** Declare key Fields for GLMNARL3                                                    BUG23742
      *                                                                                     BUG23742
     C           KPOS1     KLIST                                                            BUG23742
     C                     KFLD           BTPTDT                                            BUG23742
     C                     KFLD           BTBTNB                                            BUG23742
     C                     KFLD           BTBINB                                            BUG23742
      * Setup key
     C                     MOVEL#2BTNB    BTBTNB           Batch number
     C                     Z-ADD#2BINB    BTBINB           Batch item no.
     C**********           MOVE 'N'       BTVALI                                      241505 241505A
      * 82=EOF
     C********** KPOS **** SETLL@BTREAL  *********** 82 ** *              078761
     C                     MOVE *OFF      *IN55                           078761
     C           BTBINB    IFEQ 0                                         078761
     C           KRST      SETLL@BTREAL                  55               078761
     C                     ELSE                                           078761
     C           KPOS      SETLL@BTREAL                  55               078761
     C                     ENDIF                                          078761
     C           *IN55     COMP *OFF                     82               078761
      * 82=EOF
     C/COPY WNCPYSRC,GL0121MK91
     C           KRST      KLIST
     C                     KFLD           BTBTNB           Batch number
      * Setup key
     C                     MOVEL#2BTNB    BTBTNB           Batch number
     C  N82      KRST      READE@BTREAL                9182*
     C/COPY WNCPYSRC,GL0121MK92
     C                     ELSE
     C                     SETOF                     82    *
     C/COPY WNCPYSRC,GL0121MK93
     C                     END
     C/COPY WNCPYSRC,GL0121MK20
      * Load subfile page
     C                     EXSR BBLDSF
      * If no records (first time only), switch to add mode and load again
     C           W0APM     IFEQ 'Y'
     C           ##RR      ANDEQ*ZERO
     C                     MOVEL'ADD'     W0PMD
     C                     SETOF                     82    *
     C/COPY WNCPYSRC,GL0121MK21
     C                     EXSR BBLDSF
     C                     END
     C                     MOVEL'N'       W0APM   1
      *................................................................
      * If no records found, display error message
     C   82      ##RR      IFEQ *ZERO                      IF
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page (write empty page if add mode)
      *================================================================
     C                     SETOF                     84    No SFLNXTCHG
      * Re-establish fields in read-ahead record
     C   27      W0PMD     IFNE 'ADD'
     C  N82                READP@BTREAL                  90*
     C/COPY WNCPYSRC,GL0121MK94
     C  N82                READ @BTREAL                  90*
     C/COPY WNCPYSRC,GL0121MM41                                                               GBO021
     C                     END
      *
      * Setof record error indicators
     C* Include Original Currency and amount error indicators 51 & 52     CEU013
     C*                                                                   CEU013
     C*********************MOVE *ALL'0'   WKIND0 20                       CEU013
     C*********************MOVE *ALL'1'   WKIND1 20                       CEU013
     C/COPY WNCPYSRC,GL0121MC92
     C                     MOVE *ALL'0'   WKIND0 22                       CEU013
     C                     MOVE *ALL'1'   WKIND1 22                       CEU013
     C/COPY WNCPYSRC,GL0121MC93
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
     C                     Z-ADD*ZERO     ##RROK  50
      *................................................................
      * Load next subfile page
     C  N82      ##RROK    DOWLT##SFPG                     DO
     C                     MOVEAWKIND0    *IN,31
     C/COPY WNCPYSRC,GL0121MK95
     C                     SETOF                     87    *
      * Clear subfile fields
     C                     EXSR MAIZ#1
      * If CHANGE mode, load subfile fields
     C           W0PMD     IFNE 'ADD'
     C                     EXSR MBFL#1
      * Calculate function fields
     C                     EXSR DG#2FN
      * Record will be selected unless overridden
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialise subfile record (existing record)
     C                     Z-ADDBTBINB    WULINB           Last item numbe
     C                     MOVELWUIEMG    #RIEMG           Item error mess
      * CASE: DB1.Narrative code is Narrative code
     C           BTNVCD    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVELBTNVCD    #RNRTV           Narrative
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELBTNRDC    #RNRTV           Narrative
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MK96
     C                     MOVEL*BLANK    #RASCD           Associated Cust
     C                     MOVELBTACNB    #RASCD           Associated Cust
      * Start of Fix E28994
      * Set Subfile Next Change - Standard functions  *
     C                     SETON                     84                   E28994
      * End of Fix E28994
      * Start of Fix E17939
      * CASE: RCD.Retail Number Entered is Retail Account
     C           #1RNBE    IFEQ 'Y'                        *IF
     C                     MOVEL#1RACN    #RACID           Account Identif
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELBTCUST    #RACID           Account Identif
     C                     END                             *FI
      * End of Fix E17939
     C* Save Account identifier to control warning message                CEU013
     C                     MOVE #RACID    #1SVAI           Save acc identiCEU013
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * Format amount (short) - Standard functions  *
     C                     Z-ADDBTPTAM    ULVALU           Value
      *
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALU 150       I:Value
     C                     PARM WUNBDP    ULDECP  10       I:Decimal place
     C***********          PARM 'L'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM '3'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLF 23        O:Formatted
      *
     C                     MOVE ULRSLF    #RFMPA           Formatted data
      *
      *     E18852  - Branch Code Of trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL*BLANK    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C/COPY WNCPYSRC,GL0121MC68
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO 10                                           CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0121MC47
     C*
     C* Assign work field to file field values.
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C           #1ACCD    IFNE *BLANKS                                   CEU013
     C                     MOVELA5ACTY    WUACTY           Account Type   CEU013
     C                     ELSE                                           CEU013
     C                     MOVEL#1ACTY    WUACTY           Account Type   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVEL*BLANKS   WUBPST           Account Sub-TypCEU013
     C                     MOVEL*BLANKS   WUACCS           Account Status CEU013
     C                     MOVE *ZEROS    WUDACO           Date Account OpCEU013
     C                     MOVE *ZEROS    WUDACC           Date Account CL143482
     C                     MOVEL*BLANKS   WUACNM           Account Name   CEU013
     C                     MOVEL#1RACN    WURACN           Retails AccountCEU013
     C                     MOVE *ZEROS    WURRNM           Relative rec NoCEU013
     C***********          MOVEL*BLANK    WURETB           Retail ICEU013 152295
     C                     BITOF'01234567'WURETB                          152295
     C                     MOVEL#1PRCN    WUPRFC           Profit Centre  CEU013
     C                     ELSE                                           CEU013
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELDACC      WUDACC           Date Account CL143482
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,GL0121MC48
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is *No Errors
     C           WUAPRC    IFEQ *BLANK                     *IF
     C*                                                                   CEU013
     C* If CEU013 switchable function is installed, the batch is from     CEU013
     C*   external interface, account currency is an 'In' currency,       CEU013
     C*   account code type is Retail and the account is not found,       CEU013
     C*   the conversion of Value date is carriedout. Account not found   CEU013
     C*   is not an error and only a warning.                             CEU013
     C*                                                                   CEU013
     C           WUAPRC    ORNE *BLANKS                                   CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WP0008    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C/COPY WNCPYSRC,GL0121MK69
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM BTVLDT    WQ0001  50       Runday Number
     C/COPY WNCPYSRC,GL0121MK70
     C                     PARM WUDTFF    WQ0002  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0003  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0004  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C/COPY WNCPYSRC,GL0121MK30
     C                     MOVE UUDNMA    #RVDDS
     C/COPY WNCPYSRC,GL0121MC04
     C                     END                             *FI
      * start S01413
      * CASE: WRK.Display no of items is Yes
     C           WUDNIT    IFEQ 'Y'                        *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVELBTNITM    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0005  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0006 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0007  10       ZALIGN No Of De
     C                     PARM 5         WQ0008  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0009 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0010 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0011  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
     C                     MOVE WUZAFF    #1NITM           Number of Items
      * Move No. of Items display - Journal Entry Posting  *
     C*  MOVE ZALIGN FUNCTION FIELD INTO NUMBER OF ITEMS - DISPLAY
     C                     MOVE WUZASF    #RNITD
     C                     END                             *FI
      * end S01413
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Number of decimal places and 'In' currency flag                  CEU013
     C*                                                                   CEU013
     C           #1OCCY    IFNE *BLANKS                                   CEU013
     C                     MOVEL#1OCCY    UUCYCD                          CEU013
     C                     CALL 'AOCURRR0'                                CEU013
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CEU013
     C                     PARM '*KEY'    UUAPOP  7        I:Option       CEU013
     C                     PARM           UUCYCD  3        I:Currency CodeCEU013
     C           D@CURR    PARM *BLANK    UUSDY            O:Format       CEU013
     C                     MOVELA6NBDP    WKNBDP  10                      CEU013
     C                     ELSE                                           CEU013
     C                     Z-ADD0         WKNBDP  10                      CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C           #1OAMT    IFNE *ZEROS                                    CEU013
      * Format amount (short) - Standard functions  *                     CEU013
     C                     Z-ADD#1OAMT    ULVALU           Value          CEU013
      *                                                                   CEU013
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>CEU013
     C                     PARM           ULVALU 150       I:Value        CEU013
     C                     PARM WKNBDP    ULDECP  10       I:Decimal placeCEU013
     C                     PARM '3'       ULEDIT  1        I:IBM Edit codeCEU013
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.CEU013
     C                     PARM           ULRSLF 23        O:Formatted    CEU013
      *                                                                   CEU013
     C                     MOVE ULRSLF    #RFMOA           Formatted data CEU013
     C                     MOVE ULRSLF    #1SVOA           Screen save dtaCEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      * 047414 - remove code which moved parameter branch to file
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0121MIRE - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0121MIRE
     C*00/Copy Member GL0121M   Initialise Exist Record
     C                     END                             *FI
      * If record dropped...
     C           W0RSL     CABNE'Y'       BB020
      * Validate subfile record and calculate derived fields
     C                     EXSR DFV2RC
     C                     ELSE
      * USER: Initialise subfile record (new record)
     C                     MOVELWUIEMG    #RIEMG           Item error mess
     C                     Z-ADDWURDNO    #1PTDT           Posting date
     C                     MOVEL'N'       #1RINE           Retail ind.: Er
      * Start of 049957
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
      * Setup message data for message
      * Retrieve message Subfile Select Details
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0204' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUSFCC    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Set Screen Ftr Copy Char - Standard functions  *
     C* Move Copy Special Character Message into screen footer field
     C*                                                                   S01117
     C                     MOVELWUSFCC    ##CTX1
     C*
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C*                                                                   101696
     C** Display special character text only when copy facility is used.  101696
     C*                                                                   101696
     C           WUCFUS    IFEQ 'Y'                                       101696
     C                     MOVELWUJESP    ZA0001           JE Special Char
      * Retrieve message Copy Special Char Add Mod
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0222' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUSFCC    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Set Screen Ftr Copy Char - Standard functions  *
     C* Move Copy Special Character Message into screen footer field
     C*                                                                   S01117
     C                     MOVELWUSFCC    ##CTX1
     C                     ELSE                                           101696
     C                     MOVEL*BLANKS   ##CTX1                          101696
     C                     ENDIF                                          101696
     C*
     C                     END                             *FI
      * End of 049957
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MCP9                                           S01408
     C*                                                                   S01408
      * CASE: WRK.Template Facility Used is Yes
     C           WUTFUS    IFEQ 'Y'                        *IF
      * Set up Fields From templated record
     C                     EXSR UASUBR                     Set up Fields F
     C                     ELSE
      * CASE: *OTHERWISE
      * Set up Default Fields
     C                     EXSR UBSUBR                     Set up Default
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0121MIRN - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0121MIRN
     C*00/Copy Member GL0121M   Initialise New Record
     C                     END                             *FI
     C                     END
      * Output to subfile
     C                     ADD  1         ##RR       81    *
     C                     ADD  1         ##RROK
     C/COPY WNCPYSRC,GL0121MK71
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C/COPY WNCPYSRC,GL0121MK06
     C                     WRITE#SFLRCD
     C           BB020     TAG
     C/COPY WNCPYSRC,GL0121MK07
     C           W0PMD     IFNE 'ADD'
      * 82=EOF
     C           KRST      READE@BTREAL                  82*
     C/COPY WNCPYSRC,GL0121MK97
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MC10                                           S01408
     C*                                                                   S01408
     C  N82                END
     C/COPY WNCPYSRC,GL0121MC94
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
     C           ##RRMX    ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN25     HELP25  1
     C/COPY WNCPYSRC,GL0121MC95
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C/COPY WNCPYSRC,GL0121MC96
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN89     IFNE CAIN89
     C           *IN81     ORNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN89     CAIN89  1
     C                     MOVE *IN81     CAIN81  1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C/COPY WNCPYSRC,GL0121MC97
     C                     EXFMT#SFLCTL
     C/COPY WNCPYSRC,GL0121MC98
      *                                                                   CAC001
      **  Remove reverse image of profit centre field triggered by a      CAC001
      **  warning on the next screen execution                            CAC001
      *                                                                   CAC001
     C                     MOVE '0'       *IN45                           CAC001
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
     C*                                                                   CEU013
     C* If the warning was already displayed and there was no other       CEU013
     C*   error, set up a Skip work field to control the display of       CEU013
     C*   warning for the second time in the absence of any other         CEU013
     C*   error.                                                          CEU013
     C*                                                                   CEU013
     C                     MOVE *BLANK    WKSKIP                          CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WWFLG     ANDEQ'Y'                                       CEU013
     C           WERRF     ANDNE'Y'                                       CEU013
     C                     MOVE 'Y'       WKSKIP                          CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE *BLANK    WWFLG                           CEU013
     C                     MOVE *BLANK    WERRF                           CEU013
     C*                                                                   CEU013
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
     C/COPY WNCPYSRC,GL0121MK72
      *
      * CALC: Subfile control function fields
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0121MSFF - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0121MSFF
     C*00/Copy Member GL0121M   Calculate Control Funct
     C                     END                             *FI
      * USER: Validate subfile control
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0121MVSC - Journal Entry Posting  *
     C*00/Copy Member GL0121M   Validate Control
     C/COPY WNCPYSRC,GL0121MVSC
     C                     END                             *FI
      * Quit if reload requested
     C           W0RSF     CABEQ'Y'       DAEXIT
      *
     C   81                DO
      * No data entered as yet
     C                     MOVEL'N'       WKIPIN  1
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
     C/COPY WNCPYSRC,GL0121MM35                                                               GBO021
      * Process subfile records
     C                     EXSR DBPRSF
     C*                                                                   CEU013
     C* If the warning was already displayed and there is no other        CEU013
     C*   error, do not display warning for the second time.              CEU013
      * Defer confirm/update requested                                    CEU013
     C/COPY WNCPYSRC,GL0121MK31
     C           W0DCF     IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     MOVE *BLANKS   WWFLG                           CEU013
     C                     ENDIF                                          CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WKSKIP    ANDEQ'Y'                                       CEU013
     C           WWFLG     IFEQ 'Y'                                       CEU013
     C           WERRF     IFNE 'Y'                                       CEU013
      * Clear messages from program message queue                         CEU013
     C                     CALL 'Y2CLMSC'                                 CEU013
     C                     PARM ##PGM     ZAPGMQ 10                       CEU013
     C                     PARM '*SAME'   ZAPGRL  5                       CEU013
     C                     SETOF                     999832               CEU013
     C                     SETOF                     333435               CEU013
     C                     SETOF                     52                   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     MOVE *BLANKS   WWFLG                           CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
     C/COPY WNCPYSRC,GL0121MM36                                                               GBO021
      * If data entered
     C           WKIPIN    IFEQ 'Y'
      * Update DBF from subfile
     C                     EXSR EAPRSF
      * If error during update, exit:
     C           *IN99     CABEQ'1'       DAEXIT
     C                     END                             WKIPIN
     C                     END
      * Switch between *ADD/*CHANGE modes
     C***09*****           EXSR FACHMD                                                        204679
     C           *IN09     IFEQ '1'                                                           204679
     C           WUN4ST    IFEQ 'Y'                                                           204679
     C           WFRNT1    ANDNE'TO'                                                          204679
     C           WUN4ST    OREQ 'Y'                                                           204679
     C           WFRNT2    ANDNE'TO'                                                          204679
     C           WUN4ST    ORNE 'Y'                                                           255364
     C                     EXSR FACHMD                                                        204679
     C                     ENDIF                                                              204679
     C                     ENDIF                                                              204679
     C/COPY WNCPYSRC,GL0121MC89
      * USER: Process command keys
      * Start of Fix LN0312
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
      * Setup message data for message
      * Retrieve message Subfile Select Details
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0204' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUSFCC    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Set Screen Ftr Copy Char - Standard functions  *
     C* Move Copy Special Character Message into screen footer field
     C*                                                                   S01117
     C                     MOVELWUSFCC    ##CTX1
     C*
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C*                                                                   101696
     C** Display special character text only when copy facility is used.  101696
     C*                                                                   101696
     C           WUCFUS    IFEQ 'Y'                                       101696
     C                     MOVELWUJESP    ZA0002           JE Special Char
      * Retrieve message Copy Special Char Add Mod
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0222' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUSFCC    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Set Screen Ftr Copy Char - Standard functions  *
     C* Move Copy Special Character Message into screen footer field
     C*                                                                   S01117
     C                     MOVELWUSFCC    ##CTX1
     C                     ELSE                                           101696
     C                     MOVEL*BLANKS   ##CTX1                          101696
     C                     ENDIF                                          101696
     C*
     C                     END                             *FI
      * End of Fix LN0312
      * Start of Fix E28994
      * Find Next Posting In Error
      * CASE: CTL.*CMD key is CF16
     C           *IN16     IFEQ '1'                        *IF
      * Find Next Item in Error - Standard functions  *
     C                     MOVE 'N'       WUERRL
     C           *IN82     DOWEQ'0'
     C           *IN98     ANDEQ'0'
     C                     EXSR BBLDSF
     C                     END
     C/COPY WNCPYSRC,GL0121MK22
     C           *IN98     IFEQ '1'
     C                     MOVE 'Y'       WUERRL
     C                     END
      * CASE: WRK.Error Located is No
     C           WUERRL    IFEQ 'N'                        *IF
      * Send message 'No More Errors'
     C                     MOVEL'GLX0333' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     END                             *FI
     C                     END                             *FI
      * End of Fix E28994
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0121MPCK - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0121MPCK
     C*00/Copy Member GL0121M   Process Command Keys
     C                     END                             *FI
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
     C           WPBTAM    IFEQ ' '                                                           191175
     C                     MOVE 'N'       PBTAM   1                                           191175
     C                     MOVE 'N'       WPBTAM                                              191175
     C                     ENDIF                                                              191175
     C/COPY WNCPYSRC,GL0121MK13
     C                     READC#SFLRCD                  92*
      *                                                                                       CRE019
      ** Reset array counter                                                                  CRE019
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C                     MOVE *BLANKS   WPCQNB                                              CRE019
     C                     Z-ADD0         WZ      30                                          CRE019
     C                     MOVE 'Y'       WFRMFL                                              CRE019
     C                     MOVE 'N'       WSAVEP  1                                           CRE019
     C           *IN92     IFEQ '0'                                                           CRE019
     C                     MOVE 'Y'       WSAVEP                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C           *IN92     IFEQ '0'                                                           191175
     C/COPY WNCPYSRC,GLH00167
     C                     MOVE 'Y'       PBTAM                                               191175
     C                     ENDIF                                                              191175
     C           WPBTAM    IFEQ 'Y'                                                           191175
     C                     MOVE 'Y'       PBTAM                                               191175
     C                     ENDIF                                                              191175
     C/COPY WNCPYSRC,GL0121MK66
     C           *IN92     DOWEQ'0'
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C                     ADD  1         WZ                                                  CRE019
     C           #1CQNB    IFNE WCH,WZ                                                        CRE019
     C                     MOVE 'N'       WFRMFL                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C/COPY WNCPYSRC,GL0121MM37                                                               GBO021
     C                     EXSR DCPRSR
     C/COPY WNCPYSRC,GL0121MM38                                                               GBO021
     C                     SETOF                     87    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C/COPY WNCPYSRC,GL0121MK08
     C                     UPDAT#SFLRCD
     C/COPY WNCPYSRC,GL0121MK09
     C                     READC#SFLRCD                  92*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MC11                                           S01408
     C*                                                                   S01408
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MCP8                                           S01408
     C*                                                                   S01408
      * No errors
     C                     SETOF                     98
      * No SFLNXTCHG
     C                     SETOF                     84
     C           W0PMD     IFEQ 'ADD'
      * Check for null record
     C                     EXSR DDNLRC
     C           W0NLR     IFEQ 'Y'
     C                     GOTO DCEXIT
     C                     END
      * If not null record, continue
     C                     END
      * Data entered
     C                     MOVEL'Y'       WKIPIN
      * SFLNXTCHG
     C                     SETON                     84
      * If delete request, bypass validation
     C           #1SEL     IFEQ 'D'
     C                     GOTO DCEXIT
     C                     END
      * If action code is not C, T or D                                                     AR739731
     C           #1SEL     IFNE ' '                                                         AR739731
     C           #1SEL     ANDNE'C'                                                         AR739731
     C           #1SEL     ANDNE'T'                                                         AR739731
     C           #1SEL     ANDNE'D'                                                         AR739731
      * Setup message data for message                                                      AR739731
     C                     MOVEL#1SEL     ZA0003           *SFLSEL                          AR739731
      * Send message 'Invalid action code'                                                  AR739731
     C                     MOVEL'CSF9094' ZAMSID                                            AR739731
     C                     EXSR ZASNMS                                                      AR739731
     C                     SETON                     9831                                   AR739731
     C                     MOVE 'Y'       W0DCF                                             AR739731
     C                     GOTO DCEXIT                                                      AR739731
     C                     ENDIF                                                            AR739731
      * Validate subfile record
     C                     EXSR DEV1RC
      * If SFLRCD invalid, note the fact
     C*                                                                   127199
     C** Mark invalid records                                             127199
     C*                                                                   127199
     C           *IN98     IFEQ '1'                                       127199
     C                     MOVE 'Y'       #ERRIN                          127199
     C                     ELSE                                           127199
     C                     MOVE *BLANK    #ERRIN                          127199
     C                     ENDIF                                          127199
     C*                                                                   127199
      *                                                                   088257
      *    DO NOT SET *ON 99, IF OVERRIDE-IND = 'N'                       088257
     C***98N99*************Z-ADD##RR      ##SFRC     99                   088257
     C           *IN98     IFEQ *ON                                       088257
     C           *IN99     ANDEQ*OFF                                      088257
     C           W0PMD     ANDEQ'ADD'                                                       AR802562
     C           *IN98     OREQ *ON                                                         MD024475
     C           *IN99     ANDEQ*OFF                                                        MD024475
     C           W0PMD     ANDEQ'CHG'                                                       MD024475
     C                     Z-ADD##RR      ##SFRC                          088257
     C********** #1RINO    IFNE 'N'                                                  088257 AR802562
     C                     MOVE *ON       *IN99                           088257
     C**********           ENDIF                                                     088257 AR802562
     C                     ENDIF                                          088257
     C/COPY WNCPYSRC,GL0121MC30
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DDNLRC    BEGSR
      *================================================================
      * Check for null record
      *================================================================
     C                     MOVEL'N'       W0NLR   1
     C           #RACID    CABNE*BLANK    DDEXIT           Account Identif
     C           #1CYCD    CABNE*BLANK    DDEXIT           Currency code
     C           #1ACCD    CABNE*BLANK    DDEXIT           Account code
     C           #1ACSN    CABNE*BLANK    DDEXIT           Account sequenc
     C***********#1IBCA    CABNE*BLANK    DDEXIT           Input Branch Co087917
     C           #RFMPA    CABNE*BLANK    DDEXIT           Formatted Posti
     C           #1DCIN    CABNE*BLANK    DDEXIT           Debit/credit in
     C           #RNRTV    CABNE*BLANK    DDEXIT           Narrative
     C           #1TRTY    CABNE*BLANK    DDEXIT           Transaction typ
     C           #1TSTY    CABNE*BLANK    DDEXIT           Transaction (Su
     C           #RVDDS    CABNE*BLANK    DDEXIT           Value date (dis
     C           #1CQNB    CABNE*BLANK    DDEXIT           Cheque number
     C           #1SWCR    CABNE*BLANK    DDEXIT           Swift common re
     C           #1PRCN    CABNE*BLANK    DDEXIT           Profit centre
     C           #RASCD    CABNE*BLANK    DDEXIT           Associated Cust
     C           #1BKCD    CABNE*BLANK    DDEXIT           Book Code
     C           #1RVDI    CABNE*BLANK    DDEXIT           Reverse/Void In
     C           #RNITD    CABNE*BLANK    DDEXIT           Number of items
     C           #1RINO    CABNE*BLANK    DDEXIT           Retail ind.: Ov
     C           #1OCCY    CABNE*BLANK    DDEXIT           Original ccy   CEU013
     C           #RFMOA    CABNE*BLANK    DDEXIT           Original amountCEU013
      * If non-multibranch and all screen fields are blank,               087917
      * reset the Input Branch field to blank.                            087917
     C           P1MBRB    IFEQ 'N'                                       087917
     C                     MOVEL*BLANK    #1IBCA           Input Branch Co087917
     C                     ELSE                                           087917
     C           #1IBCA    CABNE*BLANK    DDEXIT           Input Branch Co087917
     C                     END                                            087917
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MNUL                                           S01408
     C*                                                                   S01408
     C                     MOVEL'Y'       W0NLR
      *================================================================
     CSR         DDEXIT    ENDSR
      /EJECT
     CSR         DEV1RC    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
     C*                                                                   CEU013
     C* If the Warning message was already displayed and any of the       CEU013
     C*   corresponding field is changed, perform the validation          CEU013
     C*   again.                                                          CEU013
     C*                                                                   CEU013
     C*                                                                   CEU013
     C* If Account identifier, Currency code, Account code, Account       CEU013
     C*   Sequence number, Input branch code - Alpha are changed          CEU013
     C*   force the validation and the warning message again.             CEU013
     C*                                                                   CEU013
     C           #1SVAI    IFNE #RACID                                    CEU013
     C           #1SVCY    ORNE #1CYCD                                    CEU013
     C           #1SVAC    ORNE #1ACCD                                    CEU013
     C           #1SVCS    ORNE #1ACSN                                    CEU013
     C           #1SVBC    ORNE #1IBCA                                    CEU013
     C* If the Original amount is changed, force the screen display       CEU013
     C*   even if the Warning message was displayed.                      CEU013
     C*                                                                   CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     MOVE *BLANKS   WWFLG                           CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C* Save the screen values for the comparison.                        CEU013
     C*                                                                   CEU013
     C                     MOVE #RACID    #1SVAI           Save acc identiCEU013
     C                     MOVEL#1CYCD    #1SVCY           Currency  save CEU013
     C                     MOVEL#1ACCD    #1SVAC           Acc code  save CEU013
     C                     MOVEL#1ACSN    #1SVCS           Acc seq no. savCEU013
     C                     MOVEL#1IBCA    #1SVBC           Input BranchsavCEU013
     C*                                                                   CEU013
      * Validate Debit/credit indicator
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1DCIN    W0NSRQ  1        Debit/credit in
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'MIVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1107881   Y2LSNO  70
     C           #1DCIN    PARM #1DCIN    W0EXVL 20        Debit/credit in
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      * USER: Validate subfile record fields
      * CASE: CTL.*CMD key is *Go to 'Add' mode
     C           *IN09     IFEQ '1'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.*SFLSEL is Copy/Template
     C           #1SEL     IFEQ 'C'                        *IF
     C           #1SEL     OREQ 'T'
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0003           *SFLSEL
      * Send message 'Copy/Template - ENTER'
     C                     MOVEL'GLX0213' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
      * S10736 Start
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
     C                     MOVEL'N'       WUTFUS           Template Facili
     C                     MOVEL'N'       WUCFUS           Copy Facility U
     C                     MOVEL'N'       WUCTFY           Copy / Template
     C                     END                             *FI
      * S10736 End
     C                     END                             *FI
     C                     END                             *FI
      * Blank Branch on null record
      * CASE: PAR.Multiple Branch Batch is No
     C           P1MBRB    IFEQ 'N'                        *IF
     C                     ELSE
      * CASE: RCD.Account Identifier is Not Entered
     C           #RACID    IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: RCD.Currency code is Blank
     C           #1CYCD    IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: RCD.Account code is Blank
     C           #1ACCD    IFEQ *BLANK                     *IF
     C                     ELSE
      * CASE: RCD.Account sequence number is Blank
     C           #1ACSN    IFEQ *BLANK                     *IF
     C                     MOVEL*BLANK    #1IBCA           Input Branch Co
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0121MVSU - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0121MVSU
     C*
     C                     END                             *FI
      * Validate subfile record relations
     C                     EXSR DFV2RC
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFV2RC    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      *                                                                   CGL008
      ** If Feature CGL008 is ON                                          CGL008
      *                                                                   CGL008
     C           CGL008    IFEQ 'Y'                                       CGL008
      *                                                                   CGL008
      ** Check the Access to all account codes                            CGL008
      *                                                                   CGL008
     C           WMACOD    IFNE 'Y'                                       CGL008
     C           #1ACCD    ANDNE'?'                                       CGL008
     C           #1ACCD    ANDNE*BLANKS                                   CGL008
      *                                                                   CGL008
      ** Check the Authorities of this account code                       CGL008
      *                                                                   CGL008
     C                     MOVE #1ACCD    WWACCD                          CGL008
      *                                                                   CGL008
     C           KCAUAC    CHAINSFACAUL0             22                   CGL008
      *                                                                   CGL008
      ** If no record found, the input is not allowed                     CGL008
      *                                                                   CGL008
     C           *IN22     IFEQ *ON                                       CGL008
     C                     MOVEL'CGL0001' ZAMSID                          CGL008
     C                     MOVEL'GLUSRMSG'ZAMSGF                          CGL008
     C                     EXSR ZASNMS                                    CGL008
     C                     MOVE *ON       *IN98                           CGL008
     C                     MOVE *ON       *IN34                           CGL008
     C                     GOTO DFEXIT                                    CGL008
     C                     ENDIF                                          CGL008
     C                     ENDIF                                          CGL008
     C                     ENDIF                                          CGL008
      *                                                                   CGL008
     C/COPY WNCPYSRC,GL0121MC33
      * Calculate function fields
     C                     EXSR DG#2FN
      * USER: Validate subfile record relations
      * Check Account Identifier
     C                     EXSR UCSUBR                     Check Account I
      * Account Identifier is Retail or Nostro
      * CASE: WRK.Account ID Status Flag is Retail or Nostro
     C           WUAISF    IFEQ '*NOSTRO'                  *IF
     C           WUAISF    OREQ '*RETAIL'
      * El7939 Start
      * Check for Retail Account No
     C                     EXSR UDSUBR                     Check for Retai
      * Check for Nostro Account No
     C                     EXSR UFSUBR                     Check for Nostr
      * El7939 End
     C/COPY WNCPYSRC,GL0121MK68
      *                                                                                       255341
     C           CGL064    IFEQ 'Y'                                                           255341
      *                                                                                       255341
     C                     MOVE *BLANKS   WACSC   2                                           255341
     C           #1ACCD    IFNE *BLANK                                                        255341
     C                     CALL 'AOACODR0'                                                    255341
     C                     PARM *BLANKS   WRTCD   7                                           255341
     C                     PARM '*KEY'    WOPTN   7                                           255341
     C                     PARM #1ACCD    WACOD                                               255341
     C           D@ACOD    PARM *BLANK    UUFDY                                               255341
     C           WRTCD     IFEQ *BLANKS                                                       255341
     C                     MOVE A5ACSC    WACSC                                               255341
     C                     ENDIF                                                              255341
     C                     ENDIF                                                              255341
      *                                                                                       255341
     C                     ENDIF                                                              255341
      *                                                                                       255341
      * CASE: RCD.Input Branch Code is not the same as batch header       072084
      *       yet Multiple Branch Batch has been set to 'N'               072084
     C           P1MBRB    IFEQ 'N'                        *IF            072084
     C           #1IBCA    ANDNEP1BCDA                     *IF            072084
      * Set up message data for message                                   072084
     C                     MOVEL#1IBCA    ZA0053                          072084
      * Send message 'Branch code must be same as header'                 072084
     C                     MOVEL'GLX0332' ZAMSID                          072084
     C                     EXSR ZASNMS                                    072084
     C                     SETON                     9836                 072084
      *                                                                   072084
     C                     MOVEL'Y'       WUCNSI                          072084
     C                     END                                            072084
     C                     END                             *FI
      * Account Identifier is Customer number or Shortname
      * CASE: WRK.Account ID Status Flag is Customer No or short
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
      * E17819 Start
     C                     MOVEL'N'       WUCNSI           Cust No or Shor
      * CASE: WRK.Valid Customer Number is Not Valid
     C           WUVCNB    IFEQ 'N'                        *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0042           Account Identif
      * Send message 'Customer not found'
     C                     MOVEL'GLX0084' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
      * CASE: RCD.Currency code is Blank
     C           #1CYCD    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0043           Currency code
      * Send message 'Currency Code Required'
     C                     MOVEL'GLX0123' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
      * CASE: RCD.Account code is Blank
     C           #1ACCD    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0044           Account code
      * Send message 'Account Code Required'
     C                     MOVEL'GLX0124' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9834  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MK16
      *                                                                                       255341
     C           CGL064    IFEQ 'Y'                                                           255341
      *                                                                                       255341
     C                     MOVE *BLANKS   WACSC   2                                           255341
     C           #1ACCD    IFNE *BLANK                                                        255341
     C                     CALL 'AOACODR0'                                                    255341
     C                     PARM *BLANKS   WRTCD   7                                           255341
     C                     PARM '*KEY'    WOPTN   7                                           255341
     C                     PARM #1ACCD    WACOD                                               255341
     C           D@ACOD    PARM *BLANK    UUFDY                                               255341
     C           WRTCD     IFEQ *BLANKS                                                       255341
     C                     MOVE A5ACSC    WACSC                                               255341
     C                     ENDIF                                                              255341
     C                     ENDIF                                                              255341
      *                                                                                       255341
     C                     ENDIF                                                              255341
      *                                                                                       255341
      * CASE: RCD.Account sequence number is Blank
     C           #1ACSN    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1ACSN    ZA0045           Account sequenc
      * Send message 'Account Seq Required'
     C                     MOVEL'GLX0125' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
      * CASE: RCD.Input Branch Code - Alpha is Blank
     C           #1IBCA    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0046           Input Branch Co
      * Send message 'Branch Code Required'
     C                     MOVEL'GLX0201' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
      * CASE: RCD.Input Branch Code is not the same as batch header       072084
      *       yet Multiple Branch Batch has been set to 'N'               072084
     C           P1MBRB    IFEQ 'N'                        *IF            072084
     C           #1IBCA    ANDNEP1BCDA                     *IF            072084
      * Set up message data for message                                   072084
     C                     MOVEL#1IBCA    ZA0053                          072084
      * Send message 'Branch code must be same as header'                 072084
     C                     MOVEL'GLX0332' ZAMSID                          072084
     C                     EXSR ZASNMS                                    072084
     C                     SETON                     9836                 072084
      *                                                                   072084
     C                     MOVEL'Y'       WUCNSI                          072084
     C                     END                                            072084
      * CASE: WRK.Cust No or Short Inval is No Error
     C           WUCNSI    IFEQ 'N'                        *IF
      *     E18852  - Branch Code Of trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C***********                                                   076029099053
     C***Move*blanks*to*parameter*UUCUST*(customer*no)*to*ensure*tha076029099053
     C***file*ACCNTL1*(keyed*on*ACNO)*will*be*used*in*chaining*to*a/076029099053
     C***details*file,*if*the*retail*account*number*has*been*changed076029099053
     C***********                                                   076029099053
     C                     MOVEL#1CUST    UUCUST                    076029099053
     C***********          MOVEL*BLANK    UUCUST                    076029099053
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C/COPY WNCPYSRC,GL0121MC69
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0121MC49
     C*
     C* Assign work field to file field values.
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C           #1ACCD    IFNE *BLANKS                                   CEU013
     C                     MOVELA5ACTY    WUACTY           Account Type   CEU013
     C                     ELSE                                           CEU013
     C                     MOVEL#1ACTY    WUACTY           Account Type   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVEL*BLANKS   WUBPST           Account Sub-TypCEU013
     C                     MOVEL*BLANKS   WUACCS           Account Status CEU013
     C                     MOVE *ZEROS    WUDACO           Date Account OpCEU013
     C                     MOVE *ZEROS    WUDACC           Date Account CL143482
     C                     MOVEL*BLANKS   WUACNM           Account Name   CEU013
     C                     MOVEL#1RACN    WURACN           Retails AccountCEU013
     C                     MOVE *ZEROS    WURRNM           Relative rec NoCEU013
     C***********          MOVEL*BLANK    WURETB           Retail ICEU013 152295
     C                     BITOF'01234567'WURETB                          152295
     C                     MOVEL#1PRCN    WUPRFC           Profit Centre  CEU013
     C                     ELSE                                           CEU013
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELDACC      WUDACC           Date Account CL143482
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Cntre   CAC001
     C/COPY WNCPYSRC,GL0121MK23
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,GL0121MC50
     C*
      * End of Fix LN0315
      * Check Account Number
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C/COPY WNCPYSRC,GL0121MC51
     C           WUAPRC    OREQ '*NRF'
     C/COPY WNCPYSRC,GL0121MC67
     C           WUAPRC    OREQ '*EMPTY'
     C/COPY WNCPYSRC,GL0121MC52
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C/COPY WNCPYSRC,GL0121MC17
      * Setup message data for message
     C                     MOVEL#RACID    ZA0047           Account Identif
     C                     MOVEL#1CYCD    ZA0048           Currency code
     C                     MOVEL#1ACCD    ZA0049           Account code
     C                     MOVEL#1ACSN    ZA0050           Account sequenc
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*    Account code type is Retail or Nostro, and is an interface     CEU013
     C*    journal batch, issue a warning message                      .  CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           WP0008    OREQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'N'                                       CEU013
     C/COPY WNCPYSRC,GL0121MK60
     C                     MOVEL'GLX0407' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     ELSE                                           CEU013
     C/COPY WNCPYSRC,GL0121MK61
      *                                                                   073456
     C           P1MBRB    IFEQ 'N'                                       073456
      * Send message 'This A/C No. does not exist within this branch'     073456
     C                     MOVEL'GLX0144' ZAMSID                          073456
     C                     ELSE                                           073456
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     END                                            073456
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     983233*
     C                     SETON                     3435  *
     C/COPY WNCPYSRC,GL0121MC18
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * E18437 Start
      * Reload screen fields
     C/COPY WNCPYSRC,GL0121MC66
     C                     EXSR UISUBR                     Reload screen f
     C/COPY WNCPYSRC,GL0121MC53
      * CASE: WRK.Account status is Closed
     C           WUACCS    IFEQ 'C'                        *IF
      * CASE: WRK.Account AND DATE OF CLOSED ACCOUNT LOWEER THAN THE RUNDA143482
     C           WUDACC    ANDLTWURDNO                     *IF            143482
      * Setup message data for message
     C                     MOVEL#RACID    ZA0051           Account Identif
     C                     MOVEL#1CYCD    ZA0052           Currency code
     C                     MOVEL#1ACCD    ZA0053           Account code
     C                     MOVEL#1ACSN    ZA0054           Account sequenc
     C*                                                                   CEU013
     C* If switchable function CEU013 is installed, the batch is from     CEU013
     C*   external interface and the currency is an 'In' currency,        CEU013
     C*   the account is Retail or Nostro, then the                       CEU013
     C*   'account is closed' is converted as a warning.                  CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           WP0008    OREQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'N'                                       CEU013
     C                     MOVEL'GLX0409' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR                           CEU013
     C                     ELSE                                           CEU013
      * Send message 'Account is Closed'
     C                     MOVEL'GLX0126' ZAMSID
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     END                             *FI
      * CASE: WRK.Account status is flagged for closure                                       237508
     C           WUACCS    IFEQ 'C'                        *IF                                237508
      * CASE: WRK.Account and date of closed account is equal to rundate                      237508
     C           WUDACC    ANDEQWURDNO                     *IF                                237508
      * Setup message data for message                                                        237508
     C                     MOVEL#RACID    ZA0051           Account Identif                    237508
     C                     MOVEL#1CYCD    ZA0052           Currency code                      237508
     C                     MOVEL#1ACCD    ZA0053           Account code                       237508
     C                     MOVEL#1ACSN    ZA0054           Account sequenc                    237508
      * Send message 'Account is flagged for closure'                                         237508
     C**********           MOVEL'GLX0427' ZAMSID                                     237508 AR782538
     C                     MOVEL'GLX0409' ZAMSID                                            AR782538
     C                     MOVE 'Y'       WWFLG                                               237508
     C                     EXSR ZASNMS                                                        237508
      *                                                                                       237508
     C                     END                             *FI                                237508
     C/COPY WNCPYSRC,GL0121MC54
      * E18437 End
     C                     END                             *FI
     C                     END                             *FI
      * E17819 End
     C                     END                             *FI
      * Obtain NOSTRO details
     C/COPY WNCPYSRC,GL0121MC73
     C                     EXSR UJSUBR                     Obtain NOSTRO d
     C/COPY WNCPYSRC,GL0121MC74
      * Check Branch Authority
      * CASE: PAR.Multiple Branch Batch is Yes
     C           P1MBRB    IFEQ 'Y'                        *IF
      * CASE: RCD.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * Check Users' Branch Authority
     C                     EXSR UKSUBR                     Check Users' Br
     C                     END                             *FI
     C                     END                             *FI
      * Check Posting amount
     C                     EXSR ULSUBR                     Check Posting a
      * Check Debit/Credit Indicator
      * CASE: RCD.Debit/credit indicator is Valid Values
     C           #1DCIN    IFEQ 'C'                        *IF
     C           #1DCIN    OREQ 'D'
     C                     ELSE
      * CASE: RCD.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1DCIN    ZA0061           Debit/credit in
      * Send message 'Debit Credit must be Y/N'
     C                     MOVEL'GLX0205' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9838  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Check Narrative
     C                     EXSR UMSUBR                     Check Narrative
     C/COPY WNCPYSRC,GL0121MC05
      * Check Retail/Non-Retail fields
     C                     EXSR UNSUBR                     Check Retail/No
     C/COPY WNCPYSRC,GL0121MC06
      *                                                                                      LLN022A
      ** If Profit/Loss switchable feature is on and posting is from                         LLN022A
      ** interface and associated customer no. is blank                                      LLN022A
      *                                                                                      LLN022A
     C           LLN021    IFEQ 'Y'                                                          LLN022A
     C           BRTOJE    ANDEQ'I'                                                          LLN022A
     C           WUACNB    ANDEQ*BLANKS                                                      LLN022A
     C           #1ACNB    ANDEQ*BLANKS                                                      LLN022A
      *                                                                                      LLN022A
      ** Access Account codes file for the following fields                                  LLN022A
      ** Account Section.                                                                    LLN022A
      *                                                                                      LLN022A
     C                     MOVEL#1ACCD    UUACCD                                             LLN022A
     C                     CALL 'AOACODR0'                                                   LLN022A
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd                       LLN022A
     C                     PARM '*KEY'    UUAPOP  7        I:Option                          LLN022A
     C                     PARM           UUACCD 10        I:Account Code                    LLN022A
     C           D@ACOD    PARM *BLANK    UUFDY            O:Format                          LLN022A
      *                                                                                      LLN022A
      ** Assign work field to file field values                                              LLN022A
      *                                                                                      LLN022A
     C                     MOVELA5ACSC    WUACSC           A/c Section                       LLN022A
      *                                                                                      LLN022A
      ** Only if it is a interface batch entry                                               LLN022A
      *                                                                                      LLN022A
     C           WUACSC    IFEQ 'IN'                                                         LLN022A
     C           WUACSC    OREQ 'EX'                                                         LLN022A
     C                     MOVELBBCUST    WUACNB    P                                        LLN022A
     C                     MOVELBBCUST    #1ACNB    P                                        LLN022A
     C                     MOVELBBCUST    #RASCD    P                                        LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
      * Check Associated Customer
      * CASE: RCD.Associated Cust - Display is Entered
     C           #RASCD    IFNE *BLANK                     *IF
     C/COPY WNCPYSRC,GL0121MK47
      * Start of Fix LN0334
      * CASE: RCD.Account code is Not Select
     C           #1ACCD    IFNE '?'                        *IF
      * Access Account Codes. - Account Codes  *
     C*
     C*  Access Account codes file for the following fields
     C*  A/c Type, A/c Name, Account Section, Account Subtype
     C*
     C                     MOVEL#1ACCD    UUACCD                          LN0334
     C                     CALL 'AOACODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C**********           PARM           UUACCD  4        I:Account Code LN0334       LN0334 CGL029
     C********** D@ACOD    PARM *BLANK    UUFDY            O:Format                           CGL029
     C                     PARM           UUACCD 10                                           CGL029
     C           D@ACOD    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA5ACCD    WUACCD           A/c Code       LN0334
     C                     MOVELA5ACTY    WUACTY           A/C Type
     C                     MOVELA5ACCN    WUACCN           A/c Name
     C                     MOVELA5ACSC    WUACSC           A/c Section
     C                     MOVELA5ACST    WUACST           A/c Sub-Type
     C*
     C                     END                             *FI
      * End of Fix LN0334
     C/COPY WNCPYSRC,GL0121MK48
      * CASE: RCD.Associated Cust - Display is Select Requested
     C           #RASCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Client Details. - Client Details  *
     C*
     C*  Access CLient Details file for the following fields
     C*  Customer No., Customer shortname, DRS Shortname,
     C*  Location, Customer SWIFT I.D.
     C*  Account Officer code                                             S10736
     C*
     C                     CALL 'AOCUSTR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM #RASCD    UUCNCD 10        I:Client Key
     C                     PARM           UUCRST  7        O:Key status
     C           D@CUST    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUCRST    WUCRST           Key Status  ber
     C*
     C                     MOVELBBCUST    WUACNB           Customer Number
     C                     MOVELBBCSSN    WUCSSN           Shortname
     C                     MOVELBBDRCS    WUDRCS           DRS Shortname
     C                     MOVELBBLCCD    WULCCD           Location
     C                     MOVELBBCSID    WUCSID           SWIFT ID
     C                     MOVELBBACOC    WUACOC           SWIFT ID
     C/COPY WNCPYSRC,GL0121MK49
     C*
     C           LLN021    IFEQ 'Y'                                                          LLN022A
      *                                                                                      LLN022A
     C           WUAPRC    IFEQ '*CLOSE'                                                     LLN022A
     C           WUAPRC    OREQ '*ERROR'                                                     LLN022A
     C           WUAPRC    OREQ '*OPEN'                                                      LLN022A
     C           WUAPRC    OREQ '*KEY'                                                       LLN022A
     C           WUAPRC    OREQ '*NRF'                                                       LLN022A
     C           WUAPRC    OREQ '*EMPTY'                                                     LLN022A
     C           WUAPRC    OREQ '*EOF'                                                       LLN022A
     C           WUAPRC    OREQ '*OPTION'                                                    LLN022A
     C           WUAPRC    OREQ '*CALL'                                                      LLN022A
     C           WUAPRC    OREQ '*SELECT'                                                    LLN022A
     C           WUAPRC    OREQ '*NOSEL'                                                     LLN022A
     C           WUAPRC    OREQ '*ID'                                                        LLN022A
     C                     MOVE *BLANKS   WUACNB                                             LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C                     MOVE ' '       WUTMP1  1                                          LLN022A
      *                                                                                      LLN022A
     C           #1ACCD    IFNE *BLANKS                                                      LLN022A
     C           *IN32     ANDEQ*OFF                                                         LLN022A
      *                                                                                      LLN022A
      ** Access Account codes file for the following fields                                  LLN022A
      ** Account Section.                                                                    LLN022A
      *                                                                                      LLN022A
     C                     MOVEL#1ACCD    UUACCD                                             LLN022A
     C                     CALL 'AOACODR0'                                                   LLN022A
     C                     PARM *BLANKS   UUAPRC  7        B:Return Cd                       LLN022A
     C                     PARM '*KEY'    UUAPOP  7        I:Option                          LLN022A
     C                     PARM           UUACCD 10        I:Account Code                    LLN022A
     C           D@ACOD    PARM *BLANK    UUFDY            O:Format                          LLN022A
      *                                                                                      LLN022A
      ** Assign work field to file field values                                              LLN022A
      *                                                                                      LLN022A
     C           UUAPRC    IFEQ *BLANKS                                                      LLN022A
     C                     MOVELA5ACSC    WUACSC                                             LLN022A
     C           WUACSC    IFEQ 'IN'                                                         LLN022A
     C           WUACSC    OREQ 'EX'                                                         LLN022A
     C                     MOVE 'Y'       WUTMP1                                             LLN022A
     C                     ENDIF                                                             LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C/COPY WNCPYSRC,GL0121MK53
      *                                                                                      LLN022A
      ** Associated Cust = ACC Cust and LLN021 is on                                         LLN022A
      *                                                                                      LLN022A
     C           WUCUS1    OREQ WUACNB                                                       LLN022A
     C           LLN021    ANDEQ'Y'                                                          LLN022A
     C           *IN32     ANDEQ*OFF                                                         LLN022A
     C           WUTMP1    ANDNE'Y'                                                          LLN022A
      *                                                                                      LLN022A
      * Associated Cust = ACC Cust                                        090560
     C********** WUCUS1    OREQ WUACNB                                                 090560 260211
     C********** WUAPRC    ANDEQ'       '                                            BUG11436 260211
     C********** *IN32     ANDEQ*OFF                                                   090560 260211
      *                                                                   090560
     C/COPY WNCPYSRC,GL0121MK58
     C*****      WUCUS1    IFNE WUACNB                                    090560            BUG11436
     C*****      *IN32     OREQ *ON                                       090560            BUG11436
     C********** WUAPRC    IFNE '       '                                            BUG11436 260211
      *                                                                   090560
     C/COPY WNCPYSRC,GL0121MK54
      * Setup message data for message
     C                     MOVEL#RASCD    ZA0091           Associated Cust
      * Send message 'Assoc.Cust.No/Shortname 1'
     C                     MOVEL'GLX0198' ZAMSID
      *                                                                   090560
     C/COPY WNCPYSRC,GL0121MK55
     C**********           ELSE                                                        090560 260211
      * Setup msg text 'Associated Cust cannot be same as ACC Cust'       090560
     C**********           MOVEL@MSG,1    ZAMSDA           Msg Text                    090560 260211
     C**********           MOVELWUACNB    ZAMSDA                                       090560 260211
     C/COPY WNCPYSRC,GL0121MK57
      * GLX0999 = 79A free-format msg                                     090560
     C**********           MOVEL'GLX0999' ZAMSID                                       090560 260211
     C/COPY WNCPYSRC,GL0121MK59
     C**********           ENDIF                                                       090560 260211
      *                                                                   090560
     C/COPY WNCPYSRC,GL0121MK56
     C                     EXSR ZASNMS
     C                     SETON                     9846  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Save customer number and account officer for associated customer  071924
      * in fields WUCUS2 and WUACO2.                                      071924
     C                     MOVELBBCUST    WUCUS2                          071924
     C                     MOVELBBACOC    WUACO2                          071924
     C                     MOVELWUACNB    #1ACNB           Assoc. Customer
     C                     MOVEL*BLANK    #RASCD           Associated Cust
     C                     MOVELWUACNB    #RASCD           Associated Cust
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MK50
     C                     ELSE
      * CASE: *OTHERWISE
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MVSF                                           S01408
     C*                                                                   S01408
      * Clear associated customer work fields                             071924
     C                     MOVEL*BLANK    #1ACNB           Assoc. Customer
     C                     MOVEL*BLANK    WUACOC           Account Officer
     C/COPY WNCPYSRC,GL0121MK17
      *                                                                                       255341
      ** If Profit/Loss switchable feature is on                                             LLN022A
      *                                                                                      LLN022A
     C           LLN021    IFEQ 'Y'                                                          LLN022A
     C           #1ACCD    ANDNE*BLANK                                                       LLN022A
      *                                                                                      LLN022A
      ** Access Account codes file for the following fields                                  LLN022A
      ** Account Section.                                                                    LLN022A
      *                                                                                      LLN022A
     C                     MOVEL#1ACCD    UUACCD                                             LLN022A
     C                     CALL 'AOACODR0'                                                   LLN022A
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd                       LLN022A
     C                     PARM '*KEY'    UUAPOP  7        I:Option                          LLN022A
     C                     PARM           UUACCD 10        I:Account Code                    LLN022A
     C           D@ACOD    PARM *BLANK    UUFDY            O:Format                          LLN022A
      *                                                                                      LLN022A
      ** Assign work field to file field values                                              LLN022A
      *                                                                                      LLN022A
     C                     MOVELA5ACSC    WUACSC           A/c Section                       LLN022A
      *                                                                                      LLN022A
      ** Entry in associated cust field mandatory                                            LLN022A
      ** if account code is income or expense.                                               LLN022A
      *                                                                                      LLN022A
     C           WUACSC    IFEQ 'IN'                                                         LLN022A
     C           WUACSC    OREQ 'EX'                                                         LLN022A
      *                                                                                      LLN022A
      ** Send message 'Number of Items invalid'                                              LLN022A
      *                                                                                      LLN022A
     C                     MOVEL'XXUSRMSG'ZAMSGF                                             LLN022A
     C                     MOVEL'XXX0010' ZAMSID                                             LLN022A
     C                     EXSR ZASNMS                                                       LLN022A
     C                     SETON                     9846                                    LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C           CGL064    IFEQ 'Y'                                                           255341
      *                                                                                       255341
      * Mandatory if posting is to an Income account                                          255341
     C           #RASCD    IFEQ *BLANKS                                                       255341
     C           WACSC     ANDEQ'IN'                                                          255341
     C                     MOVEL'GLUSRMSG'ZAMSGF                                              255341
     C                     MOVEL'CGL0025' ZAMSID                                              255341
     C                     EXSR ZASNMS                                                        255341
     C                     SETON                     9846                                     255341
     C                     ENDIF                                                              255341
      *                                                                                       255341
     C                     ENDIF                                                              255341
      *                                                                                       255341
     C                     END                             *FI
      * S10736 Start
      * Check Book Code
      * CASE: RCD.Book Code is Entered
     C           #1BKCD    IFNE *BLANK                     *IF
      * CASE: RCD.Book Code is Select requested
     C           #1BKCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Book Codes - Book Codes  *
     C*
     C*  Access Book Codes for the file fields
     C*
     C                     MOVEL#1BKCD    UUBKCD
     C                     CALL 'AOBOOKR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBKCD  2        I:Book Code
     C           D@BOOK    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVE BDBKCD    WUBKCD
     C                     MOVE BDBKD     WUBKD
     C                     MOVE BDHGIN    WUHGIN
     C                     MOVE BDACIN    WUACIN
     C                     MOVE BDBKCC    WUBKCC
     C                     MOVE BDSTAM    WUSTAM
     C                     MOVE BDSTRM    WUSTRM
     C                     MOVE BDSTEP    WUSTEP
     C                     MOVE BDIACK    WUIACK
     C/COPY WNCPYSRC,GL0121MK38
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1BKCD    ZA0092           Book Code
      * Send message 'Book Codes Not Found.'
     C                     MOVEL'GLX0240' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9847  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C/COPY WNCPYSRC,GL0121MK73
     C                     MOVELWUBKCD    #1BKCD           Book Code
     C/COPY WNCPYSRC,GL0121MK74
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MC35
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MC01
      * Check Profit Centre
     C                     EXSR URSUBR                     Check Profit Ce
     C/COPY WNCPYSRC,GL0121MC02
      * Check Reverse/Void indicator
      * CASE: RCD.Reverse/Void Indicator is valid
     C           #1RVDI    IFEQ *BLANK                     *IF
     C           #1RVDI    OREQ 'Y'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1RVDI    ZA0095           Reverse/Void In
      * Send message 'Reverse/Void  is invalid'
     C                     MOVEL'GLX0237' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9848  *
      *
     C                     END                             *FI
      * start S01413
      * Check Number of Items
      * CASE: WRK.Display no of items is Yes
     C           WUDNIT    IFEQ 'Y'                        *IF
      * CASE: RCD.Number of items - display is Blank
     C           #RNITD    IFEQ *BLANK                     *IF
     C                     MOVEL'    1'   #RNITD           Number of items
     C                     Z-ADD1         #1NITM           Number of Items
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#RNITD    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0058  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0059 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0060  10       ZALIGN No Of De
     C                     PARM 5         WQ0061  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0062 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0063 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0064  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#RNITD    ZA0096           Number of items
      * Send message 'Number of Items invalid'
     C                     MOVEL'GLX0385' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9849  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUZAFF    #1NITM           Number of Items
      * Move No. of Items display - Journal Entry Posting  *
     C*  MOVE ZALIGN FUNCTION FIELD INTO NUMBER OF ITEMS - DISPLAY
     C                     MOVE WUZASF    #RNITD
      * CASE: RCD.Number of Items is Valid range
     C           #1NITM    IFGE 00001                      *IF
     C           #1NITM    ANDLE99999
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#RNITD    ZA0097           Number of items
      * Send message 'Number of Items invalid'
     C                     MOVEL'GLX0385' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9849  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD1         #1NITM           Number of Items
     C                     END                             *FI
      * end S01413
      * S10736 End
     C*                                                                   CEU013
     C* If the switchable funtion EMU Account Postings Narrative is       CEU013
     C*    installed, the original currency and amount are allowed        CEU013
     C*    only if the currency of account is an 'In' currency or 'EURO'  CEU013
     C*    currency.                                                      CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     EXSR VALORG                                    CEU013
     C                     ENDIF                                          CEU013
      *                                                                                       CGL013
      ** If MT94x Messages Generation (CGL013) is installed, validate                         CGL013
      ** Additional Information Field                                                         CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C           CER030    OREQ 'Y'                                                         BUG23742
      *                                                                                       CGL013
     C           #1ADIN    IFEQ *BLANK                                                        CGL013
     C                     MOVE 'N'       #1ADIN                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           #1ADIN    IFNE 'Y'                                                           CGL013
     C           #1ADIN    ANDNE'N'                                                           CGL013
     C                     MOVE *ON       *IN68                                               CGL013
     C                     MOVE *ON       *IN98                                               CGL013
     C                     MOVEL'USR0912' ZAMSID                                              CGL013
     C                     EXSR ZASNMS                                                        CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE *OFF      *IN68                                               CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     ENDIF                                                              CGL013
     C*                                                                   CEU013
      * Setup Branch code (Header) & Posting Date on RCD
     C                     EXSR USSUBR                     Setup Branch co
      * CASE: WRK.Copy Facility Used is No
     C           WUCFUS    IFEQ 'N'                        *IF
     C           WUTFUS    ANDEQ'N'                                       087770
      **Store*Data*for*Copy*/*Template*Function************************   087770
      * Clear Copy / Template Function work fields                        087770
     C                     EXSR UTSUBR                     Store Data for
     C                     END                             *FI
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MC12                                           S01408
     C*                                                                   S01408
      * E01234 Start
      * Start of Fix E28994
      * Set UP Exit Option - Standard functions  *
     C*                                                                   CEU013
     C* If *CMD key CF03 is pressed, Switchable feature CEU013 is         CEU013
     C*    active, the call to this program is from interface,            CEU013
     C*    Warning messages are pending and there is no other errors      CEU013
     C*    detected, ignore the warning message.                          CEU013
     C*                                                                   CEU013
     C           *IN03     IFEQ *ON                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WWFLG     ANDEQ'Y'                                       CEU013
     C           WERRF     ANDNE'Y'                                       CEU013
     C                     MOVE *OFF      *IN98                           CEU013
     C                     MOVE *BLANKS   WWFLG                           CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C*
     C* Set Error on batch indicator to P Indicating Errors outstanding
     C* In Batch Postings.. Occurred during I/Face Batch Being Read..
     C*
     C           *IN98     IFEQ '1'
     C           #1RINO    OREQ 'N'                                       LN0327
     C                     MOVEL'P'       P3EXTO            EXIT OPTION
     C***********          ELSE                                     LN0327E28994
     C***********          MOVEL' '       #OEXTO                          E28994
     C                     END                              *FI
      * Endt of Fix E28994
      * E01234 End
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0121MVRR - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0121MVRR
     C*00/Copy Member GL0121M   Validate Record Relations
     C                     END                             *FI
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         DG#2FN    BEGSR
      *================================================================
      * Calculate subfile record function fields
      *================================================================
      * Set default profit centre fields to '*'s                          071924
     C                     MOVEL*ALL'*'   WUCUS1                          071924
     C                     MOVEL*ALL'*'   WUACO1                          071924
     C                     MOVEL*ALL'*'   WUCUS2                          071924
     C                     MOVEL*ALL'*'   WUACO2                          071924
      * CALC: Subfile record function fields
      * Add Mode Processing
      * CASE: PGM.*Program mode is *ADD
     C           W0PMD     IFEQ 'ADD'                      *IF
      **Check*for*Copy*Character*in*Field******************************   087770
      * Replace 'Copy Character' in Field with WU... field value          087770
     C                     EXSR UUSUBR                     Check for Copy
     C                     END                             *FI
      * Check Account Identifier
      * CASE: RCD.Account Identifier is Entered
     C           #RACID    IFNE *BLANK                     *IF
      * Select Account Identifier
      * CASE: RCD.Account Identifier is Select Requested
     C           #RACID    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
     C                     MOVEL'Y'       WUVCNB           Valid Customer
      *                                                                   127185
      * 4. Check for Nostro :                                             127185
      *                                                                   127185
     C                     MOVEL#RACID    UKACID           10-Char.A/C ID 127185
     C                     TESTN          UKACM2     90    All numeric?   127185
      **                                                                  127185
     C           *IN90     IFEQ '1'                        IF NUMERIC     127185
     C           UKACA1    ANDNE*BLANK                      NOT  BLANK    127185
     C           UKACA1    ANDLT'0'                         NOT  NUMERIC  127185
     C           UKACA2    ANDNE*BLANK                      NOT  BLANK    127185
     C           UKACA2    ANDLT'0'                         NOT  NUMERIC  127185
     C           UKACA3    ANDNE*BLANK                      NOT  BLANK    127185
     C           UKACA3    ANDLT'0'                         NOT  NUMERIC  127185
     C           UKACL5    ANDEQ*BLANK                          NO MORE   127185
     C                     MOVEL#RACID    XXCYCD                          127185
      *                                                                   127185
     C                     CALL 'AONOSTR0'                                127185
     C                     PARM           XXAPRC  7        B:Return Cd    127185
     C                     PARM '*KEY'    XXAPOP  7        I:Option       127185
     C                     PARM           XXCUST  6        I:Customer No. 127185
     C                     PARM           XXCYCD  3        I:Currency Code127185
     C**********           PARM           XXACCD  4        I:Account Code              127185 CGL029
     C                     PARM           XXACCD 10                                           CGL029
     C                     PARM           XXACSN  2        I:Account Seque127185
     C                     PARM UKACM2    XXNONB  2        I:Nostro Number127185
     C                     PARM           XXBRCD  3        I:Branch Code  127185
     C                     PARM           XXCSSN 10        I:Cust ShortN  127185
     C                     PARM           XXPNOI  1        I:Prime Nost In127185
     C                     PARM           UUFDY            O:Format       127185
     C*                                                                   127185
      * CASE: WRK.Access Pgm Return Code is Record found                  127185
     C           XXAPRC    IFEQ '      '                   *IF            127185
     C                     GOTO NOSFND                                    127185
     C                     END                                            127185
      *                                                                   127185
     C                     END                                            127185
      **                                                                  127185
      * Access Client Details. - Client Details  *
     C*
     C*  Access CLient Details file for the following fields
     C*  Customer No., Customer shortname, DRS Shortname,
     C*  Location, Customer SWIFT I.D.
     C*  Account Officer code                                             S10736
     C*
     C                     CALL 'AOCUSTR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM #RACID    UUCNCD 10        I:Client Key
     C                     PARM           UUCRST  7        O:Key status
     C           D@CUST    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUCRST    WUCRST           Key Status  ber
     C*
     C                     MOVELBBCUST    WUCUST           Customer Number
     C                     MOVELBBCSSN    WUCSSN           Shortname
     C                     MOVELBBDRCS    WUDRCS           DRS Shortname
     C                     MOVELBBLCCD    WULCCD           Location
     C                     MOVELBBCSID    WUCSID           SWIFT ID
     C                     MOVELBBACOC    WUACOC           SWIFT ID
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL'N'       WUVCNB           Valid Customer
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     MOVELWUCUST    #1CUST           Customer number
      * Save customer number and account officer fields for default       071924
      * profit centre processing in fields WUCUS1 and WUACO1              071924
     C                     MOVELWUCUST    WUCUS1                          071924
     C                     MOVELWUACOC    WUACO1                          071924
     C                     END                             *FI
     C           NOSFND    TAG                             NOSTRO AC FOUND127185
     C                     END                             *FI
      * Check Currency Code
      * CASE: RCD.Currency code is Not blank
     C           #1CYCD    IFNE *BLANK                     *IF
      * Select Currency Code
      * CASE: RCD.Currency code is Select Requested
     C           #1CYCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVE *BLANK    WUINCY  1        'In' Currency  CEU013
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C                     MOVELA6INCY    WUINCY           'In' Currency  CEU013
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0098           Currency code
      * Send message 'Currency Code not found'
     C                     MOVEL'GLX0048' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     END                             *FI
     C                     END                             *FI
      * Check Account Code
      * CASE: RCD.Account code is Not blank
     C           #1ACCD    IFNE *BLANK                     *IF
      * Start of Fix LN0334
      * Select Account Code
      * CASE: RCD.Account code is Select Requested
     C           #1ACCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Account Codes. - Account Codes  *
     C*
     C*  Access Account codes file for the following fields
     C*  A/c Type, A/c Name, Account Section, Account Subtype
     C*
     C                     MOVEL#1ACCD    UUACCD                          LN0334
     C                     CALL 'AOACODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C**********           PARM           UUACCD  4        I:Account Code              LN0334 CGL029
     C********** D@ACOD    PARM *BLANK    UUFDY            O:Format                           CGL029
     C                     PARM           UUACCD                                              CGL029
     C           D@ACOD    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA5ACCD    WUACCD           A/c Code       LN0334
     C                     MOVELA5ACTY    WUACTY           A/C Type
     C                     MOVELA5ACCN    WUACCN           A/c Name
     C                     MOVELA5ACSC    WUACSC           A/c Section
     C                     MOVELA5ACST    WUACST           A/c Sub-Type
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0099           Account code
      * Send message 'Account Code not found'
     C                     MOVEL'GLX0046' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9834  *
      *
     C                     ELSE
     C/COPY WNCPYSRC,GL0121MK67
      * CASE: *OTHERWISE
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     END                             *FI
      * End of Fix LN0334
     C                     END                             *FI
      * Check Branch Code
      * CASE: PAR.Multiple Branch Batch is Yes
     C           P1MBRB    IFEQ 'Y'                        *IF
      * CASE: RCD.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * CASE: RCD.Input Branch Code - Alpha is Select Request
     C           #1IBCA    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1IBCA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0100           Input Branch Co
      * Send message 'Branch Code not found'
     C                     MOVEL'GLX0045' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUBRCD    #1IBCA           Input Branch Co
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C*                                                                   CEU013
     C* Check Original currency field entry                               CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     EXSR VALOCY                                    CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      * Change Mode Processing
     C                     EXSR UVSUBR                     Change Mode Pro
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0121MRFF - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0121MRFF
     C*00/Copy Member GL0121M   Calculate Record Funct
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MC80
      *================================================================
     CSR         DGEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
      * Initialise subfile reload flag
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'Y'       W0RSF
     C                     ELSE
     C                     MOVEL'N'       W0RSF
     C                     END
      * Process all modified subfile records
     C/COPY WNCPYSRC,GL0121MK14
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
     C           W0RTN     IFNE *BLANK
      * ROLLBACK required
      * Send message '*ROLLBACK required'
     C                     MOVEL'Y2U0018' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     MOVEL'Y2U0018' P0RTN
     C                     EXSR ZYEXPG
     C                     END
     C                     MOVEL*BLANK    #1SEL
     C/COPY WNCPYSRC,GL0121MK75
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C/COPY WNCPYSRC,GL0121MK10
     C                     UPDAT#SFLRCD
     C/COPY WNCPYSRC,GL0121MK11
     C                     READC#SFLRCD                  92*
     C                     END
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      *                                                                   CAC001
      **  Restore status of *IN45 for later use                           CAC001
      *                                                                   CAC001
     C                     MOVE *IN45     WKIN45  1                       CAC001
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
     C/COPY WNCPYSRC,GL0121MK98
     C                     MOVE WKIN45    *IN45                           CAC001
     C                     SETOF                     98
      *
     C           W0PMD     IFEQ 'ADD'
      * Process add request
     C           #1SEL     IFNE 'D'
     C                     EXSR DDNLRC
     C           W0NLR     IFNE 'Y'
     C                     EXSR ECADRQ
     C                     END
     C                     END
     C                     ELSE
     C           #1SEL     IFEQ 'D'
      * Process delete request
     C                     EXSR EDDLRQ
     C                     ELSE
      * Process change request
     C                     EXSR EECHRQ
     C                     END
     C                     END
      * If error occurred on update, note the fact
     C           *IN98     IFEQ '1'
     C           *IN99     IFEQ '0'
     C                     Z-ADD##RR      ##SFRC     99    *
     C                     END
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         ECADRQ    BEGSR
      *================================================================
      * Process add request
      *================================================================
      * USER: Create DBF record
      * Create GL Batch posting - Journal Entry Posting  *
     C                     EXSR SACRRC
     C           W0RTN     IFNE *BLANK
      * Write error detected
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
     C/COPY WNCPYSRC,GL0121MK99
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
     C                     ELSE
      * DBF write successful
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EDDLRQ    BEGSR
      *================================================================
      * Process delete request
      *================================================================
      * USER: Delete DBF record
      * Delete GL Batch posting - Journal Entry Posting  *
     C                     EXSR SBDLRC
     C           W0RTN     IFNE *BLANK
      * Delete unsuccessful
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
     C/COPY WNCPYSRC,GL0121MM01
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * If record altered, reset subfile record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF delete successful
      * Blank out record and protect from entry
     C                     EXSR MAIZ#1
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
      * Reload subfile
     C                     MOVEL'Y'       W0RSF   1
     C                     END
      *================================================================
     CSR         EDEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Change GL Batch posting - Journal Entry Posting  *
     C                     EXSR SCCHRC
     C           W0RTN     IFNE *BLANK
      * DBF update error
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
     C/COPY WNCPYSRC,GL0121MM02
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * Reset subfile record if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF update successful
      * Enable entry
     C                     SETOF                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FACHMD    BEGSR
      *================================================================
      * Switch between *ADD/*CHANGE modes
      *================================================================
     C           W0PMD     IFNE 'ADD'
     C                     MOVEL'ADD'     W0PMD
     C/COPY WNCPYSRC,GL0121MK46
     C                     ELSE
     C                     MOVEL'CHG'     W0PMD
     C                     END
     C/COPY WNCPYSRC,GL0121MC88
     C                     EXSR FBRQRL
      *================================================================
     CSR         FAEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect keys if change mode or updated record
     C                     SETON                     88    *
     C   89N87             SETOF                     88    *
     C                     MOVEL*IN87     *IN78
      *                                                                                       204679
      ** If the Private Banking module is on and the Front Office ID                          204679
      ** from GLJENHPD or GLJENPPD starts with 'TO' do not allow                              204679
      ** any amendments                                                                       204679
      *                                                                                       204679
     C                     MOVE '0'       *IN65                                               204679
     C           WUN4ST    IFEQ 'Y'                                                           204679
     C                     MOVELBRFRNT    WFRNT1                                              204679
     C                     MOVELBTFRNT    WFRNT2                                              204679
     C           WFRNT1    IFEQ 'TO'                                                          204679
     C           WFRNT2    OREQ 'TO'                                                          204679
     C                     MOVEL'1'       *IN65                                               204679
     C                     MOVEL'1'       *IN78                                               204679
     C                     ENDIF                                                              204679
     C                     ENDIF                                                              204679
     C           W0PMD     IFEQ 'ADD'                      *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
     C                     MOVEL*IN87     *IN77
     C/COPY WNCPYSRC,GL0121MK76
     C           P1MBRB    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN77
     C                     END                             *FI
     C                     MOVEL*IN87     *IN76
     C/COPY WNCPYSRC,GL0121MK77
     C           WUPRCU    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN76
     C                     END                             *FI
     C                     MOVEL*IN87     *IN75
     C           WUDNIT    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN75
     C                     END                             *FI
     C                     MOVEL*IN87     *IN74
     C           #1RINE    IFEQ *BLANK                     *IF
     C           #1RINE    OREQ 'N'
     C                     MOVEL'1'       *IN74
     C                     END                             *FI
     C                     MOVEL'0'       *IN73
     C           #RIEST    IFEQ 'E'                        *IF
     C                     MOVEL'1'       *IN73
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MK90
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
     C                     MOVEL'0'       *IN79
     C           P1MBRB    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise subfile record
      *================================================================
      * Previous values
     C                     MOVEL*BLANK    #1DBRC
     C                     MOVEL*BLANK    #RIEST           Item error stat
     C                     MOVELP1BTNB    #1BTNB           Batch number
     C                     Z-ADD*ZERO     #1BINB           Batch item no.
     C                     MOVEL*BLANK    #1CUST           Customer number
     C                     MOVEL*BLANK    #1NNBI           Nostro number (
     C                     Z-ADD*ZERO     #1RACN           Retail account
     C                     Z-ADD*ZERO     #1PTAM           Posting amount
     C                     MOVEL*BLANK    #1RINE           Retail ind.: Er
     C                     Z-ADD*ZERO     #1PTDT           Posting date
     C                     MOVEL*BLANK    #1NVCD           Narrative code
     C                     MOVEL*BLANK    #1NRDC           Narrative descr
     C                     MOVEL*BLANK    #1ACTY           Account type
     C                     Z-ADD*ZERO     #1VLDT           Value date
     C                     Z-ADD*ZERO     #1PVDT           Prev VLDT      091729
     C                     MOVE *BLANKS   #1PCCY           Prev A/C ccy   091729
     C                     MOVEL*BLANK    #1ACNB           Assoc. Customer
     C                     MOVEL*BLANK    #1COIN           Customer origin
     C                     MOVEL*BLANK    #RREVI           Reversal/void i
     C                     Z-ADD*ZERO     #1SPFC           Spread Factor
     C                     Z-ADD*ZERO     #1NITM           Number of Items
     C                     MOVEL*BLANK    #1BCBH           Branch Code (Ba
     C                     MOVEL*BLANK    #1RADP           Retail advice p
     C                     MOVEL*BLANK    #1SHPI           Shadow post ind
     C                     Z-ADD*ZERO     #1RRNM           Relative rec no
     C                     MOVEL*BLANK    #1RNBE           Retail Number E
     C                     MOVEL*BLANK    #1RARC           Retail Ac Refer
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVEL*BLANK    #1CYCD           Currency code
     C                     MOVEL*BLANK    #1ACCD           Account code
     C                     MOVEL*BLANK    #1ACSN           Account sequenc
     C                     MOVEL*BLANK    #1IBCA           Input Branch Co
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     MOVEL*BLANK    #1DCIN           Debit/credit in
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVEL*BLANK    #1TRTY           Transaction typ
     C                     MOVEL*BLANK    #1TSTY           Transaction (Su
     C                     MOVEL*BLANK    #RVDDS           Value date (dis
     C/COPY WNCPYSRC,GL0121MK78
     C                     MOVEL*BLANK    #1CQNB           Cheque number
     C                     MOVEL*BLANK    #1SWCR           Swift common re
     C                     MOVEL*BLANK    #1PRCN           Profit centre
     C                     MOVEL*BLANK    #RASCD           Associated Cust
     C                     MOVEL*BLANK    #1BKCD           Book Code
     C                     MOVEL*BLANK    #1RVDI           Reverse/Void In
     C                     MOVEL*BLANK    #RNITD           Number of items
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
     C                     MOVEL*BLANK    #RIEMG           Item error mess
     C                     MOVEL*BLANKS   #1OCCY           Original Ccy   CEU013
     C/COPY WNCPYSRC,GL0121MC38
     C                     Z-ADD*ZEROS    #1OAMT           Original AmountCEU013
     C                     MOVEL*BLANKS   #RFMOA           Formatted O/AmtCEU013
     C                     MOVEL*BLANKS   #1SVOA           Formatted save CEU013
     C                     MOVEL*BLANKS   #1SVAI           Acc ident save CEU013
     C                     MOVEL*BLANKS   #1SVCY           Currency  save CEU013
     C                     MOVEL*BLANKS   #1SVAC           Acc code  save CEU013
     C                     MOVEL*BLANKS   #1SVCS           Acc seq no. savCEU013
     C                     MOVEL*BLANKS   #1SVBC           Input BranchsavCEU013
      *                                                                                       CGL013
      ** If CGL013 is installed                                                               CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C                     MOVEL*BLANKS   #1ADIN                                              CGL013
     C                     MOVEL*BLANKS   #1AIPI                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
      ** If CER030 is installed                                                             BUG23742
      *                                                                                     BUG23742
     C           CER030    IFEQ 'Y'                                                         BUG23742
     C                     MOVEL*BLANKS   #1ADIN                                            BUG23742
     C                     MOVEL*BLANKS   #1AIP1                                            BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     Z-ADD*ZEROS    #1PDID                                            MD027587
      *                                                                                     MD027587
     C/COPY WNCPYSRC,GL0121MM03
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @BTREAL fields to subfile
      *================================================================
     C                     MOVELBTBTNB    #1BTNB           Batch number
     C                     Z-ADDBTBINB    #1BINB           Batch item no.
     C                     MOVELBTCUST    #1CUST           Customer number
     C                     MOVELBTNNBI    #1NNBI           Nostro number (
     C                     Z-ADDBTRACN    #1RACN           Retail account
     C                     Z-ADDBTPTAM    #1PTAM           Posting amount
     C                     MOVELBTRINE    #1RINE           Retail ind.: Er
     C                     Z-ADDBTPTDT    #1PTDT           Posting date
     C                     MOVELBTNVCD    #1NVCD           Narrative code
     C                     MOVELBTNRDC    #1NRDC           Narrative descr
     C                     MOVELBTACTY    #1ACTY           Account type
     C                     Z-ADDBTVLDT    #1VLDT           Value date
     C           WP0010    IFEQ 'I'                                                           246922
     C                     Z-ADD0         #1PVDT                                              246922
     C                     ELSE                                                               246922
     C                     Z-ADDBTVLDT    #1PVDT           Prev VLDT      091729
     C                     ENDIF                                                              246922
     C/COPY WNCPYSRC,GL0121MK79
     C                     MOVELBTCYCD    #1PCCY           Prev A/C ccy   091729
     C                     MOVELBTACNB    #1ACNB           Assoc. Customer
     C                     MOVELBTCOIN    #1COIN           Customer origin
     C                     Z-ADDBTSPFC    #1SPFC           Spread Factor
     C                     Z-ADDBTNITM    #1NITM           Number of Items
     C                     MOVELBTBCBH    #1BCBH           Branch Code (Ba
     C                     MOVELBTRADP    #1RADP           Retail advice p
     C                     MOVELBTSHPI    #1SHPI           Shadow post ind
     C                     Z-ADDBTRRNM    #1RRNM           Relative rec no
     C                     MOVELBTRNBE    #1RNBE           Retail Number E
     C                     MOVELBTRARC    #1RARC           Retail Ac Refer
     C                     MOVELBTCYCD    #1CYCD           Currency code
     C                     MOVELBTACCD    #1ACCD           Account code
     C                     MOVELBTACSN    #1ACSN           Account sequenc
     C                     MOVELBTIBCA    #1IBCA           Input Branch Co
     C                     MOVELBTDCIN    #1DCIN           Debit/credit in
     C                     MOVELBTTRTY    #1TRTY           Transaction typ
     C                     MOVELBTTSTY    #1TSTY           Transaction (Su
     C                     MOVELBTCQNB    #1CQNB           Cheque number
     C                     MOVELBTSWCR    #1SWCR           Swift common re
     C                     MOVELBTPRCN    #1PRCN           Profit centre
     C                     MOVELBTBKCD    #1BKCD           Book Code
     C                     MOVELBTRVDI    #1RVDI           Reverse/Void In
     C                     MOVELBTRINO    #1RINO           Retail ind.: Ov
     C                     MOVELBTOCCY    #1OCCY           Original Ccy   CEU013
     C                     Z-ADDBTOAMT    #1OAMT           Original AmountCEU013
     C                     MOVEL#1CYCD    #1SVCY           Currency  save CEU013
     C                     MOVEL#1ACCD    #1SVAC           Acc code  save CEU013
     C                     MOVEL#1ACSN    #1SVCS           Acc seq no. savCEU013
     C                     MOVEL#1IBCA    #1SVBC           Input BranchsavCEU013
      *                                                                                       CGL013
      ** If CGL013 is installed                                                               CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C                     MOVEL'N'       #1ADIN                                              CGL013
      *                                                                                       CGL013
     C           KPOS      CHAINGLJENXL2             65                                       CGL013
     C           *IN65     IFEQ *OFF                                                          CGL013
     C           BAADI1    ANDNE*BLANKS                                                       CGL013
     C                     MOVEL'*'       #1AIPI                                              CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE *BLANK    #1AIPI                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           CER030    IFEQ 'Y'                                                         BUG23742
      *                                                                                     BUG23742
     C                     MOVEL'N'       #1ADIN                                            BUG23742
     C           KPOS1     CHAINGLMNARL3             65                                     BUG23742
      *                                                                                     BUG23742
     C           *IN65     IFEQ *OFF                                                        BUG23742
     C           BAEX1     ANDNE*BLANKS                                                     BUG23742
     C                     MOVEL'*'       #1AIP1                                            BUG23742
     C                     ELSE                                                             BUG23742
     C                     MOVE *BLANKS   #1AIP1                                            BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     Z-ADDBTPDID    #1PDID                                            MD027587
      *                                                                                     MD027587
      * Hold current record image for change detection
     C                     MOVEL@1DBRC    #1DBRC
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C                     MOVE 'Y'       WFRMFL  1                                           CRE019
     C                     ENDIF                                                              CRE019
     C/COPY WNCPYSRC,GL0121MC39
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVELP1BTNB    #2BTNB           Batch number
     C                     Z-ADD*ZERO     #2BINB           Batch item no.
      * Check restriction within
     C                     EXSR VACKRL
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         SACRRC    BEGSR
      *================================================================
      * Create GL Batch posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      *                                                                                       CRE019
      ** Save previous value of cheque number and full account                                CRE019
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C                     MOVE BTCQNB    WPCQNB  8                                           CRE019
     C                     MOVELBTIBCA    WPIBCA  3                                           CRE019
     C                     MOVELBTCUST    WPCUST  6                                           CRE019
     C                     MOVELBTCYCD    WPCYCD  3                                           CRE019
     C                     MOVELBTACCD    WPACCD 10                                           CRE019
     C                     MOVELBTACSN    WPACSN  2                                           CRE019
     C                     Z-ADDBTRACN    WPRACN 100                                          CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      * Move all fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
     C                     MOVEL#1IBCA    BTIBCA           Input Branch Co
     C                     MOVEL#1CUST    BTCUST           Customer number
     C                     MOVEL#1CYCD    BTCYCD           Currency code
     C                     MOVEL#1ACCD    BTACCD           Account code
     C                     MOVEL#1ACSN    BTACSN           Account sequenc
     C                     MOVEL#1NNBI    BTNNBI           Nostro number (
     C                     Z-ADD#1RACN    BTRACN           Retail account
     C                     MOVEL#1RINO    BTRINO           Retail ind.: Ov
     C                     MOVEL#1RINE    BTRINE           Retail ind.: Er
     C                     MOVEL#1TRTY    BTTRTY           Transaction typ
     C                     Z-ADD#1PTAM    BTPTAM           Posting amount
     C                     MOVEL#1DCIN    BTDCIN           Debit/credit in
     C                     Z-ADD#1PTDT    BTPTDT           Posting date
     C                     Z-ADD#1VLDT    BTVLDT           Value date
     C                     MOVEL#1NVCD    BTNVCD           Narrative code
     C                     MOVEL#1NRDC    BTNRDC           Narrative descr
     C/COPY WNCPYSRC,GL0121MM04
     C                     MOVEL#1ACTY    BTACTY           Account type
     C                     MOVEL#1ACNB    BTACNB           Assoc. Customer
     C                     MOVEL#1CQNB    BTCQNB           Cheque number
     C                     MOVEL#1COIN    BTCOIN           Customer origin
     C                     MOVEL#1SWCR    BTSWCR           Swift common re
     C                     MOVEL#1PRCN    BTPRCN           Profit centre
     C                     MOVEL#1BCBH    BTBCBH           Branch Code (Ba
     C                     MOVEL#1RADP    BTRADP           Retail advice p
     C                     MOVEL#1SHPI    BTSHPI           Shadow post ind
     C                     Z-ADD#1RRNM    BTRRNM           Relative rec no
     C                     MOVEL#1RNBE    BTRNBE           Retail Number E
     C                     MOVEL#1RARC    BTRARC           Retail Ac Refer
     C                     MOVEL#1TSTY    BTTSTY           Transaction (Su
     C                     MOVEL#1BKCD    BTBKCD           Book Code
     C                     Z-ADD#1SPFC    BTSPFC           Spread Factor
     C                     MOVEL#1RVDI    BTRVDI           Reverse/Void In
     C                     Z-ADD#1NITM    BTNITM           Number of Items
     C                     MOVEL#1OCCY    BTOCCY           Original Ccy   CEU013
     C                     Z-ADD#1OAMT    BTOAMT           Original AmountCEU013
     C                     Z-ADD#1PDID    BTPDID                                            MD027587
     C           CSC011    IFEQ 'Y'                                                           CSC011
     C           BTFRNT    ANDEQ*BLANKS                                                       CSC011
     C           'MD'      CAT  BTBTNB:0  BTFRNT    P                                         CSC011
     C                     ENDIF                                                              CSC011
     C                     MOVEASTAMP,1   BTTMST                                              CPK014
      *
      * USER: Processing before DBF update
      * RTV Last Batch Item - Standard functions  *
     C                     CALL 'GL0137U'              90  RTV Last Batch
     C                     PARM BTBTNB    WQ0065  3        Batch number
     C           WULINB    PARM *ZERO     WQ0066  30       Last item numbe
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ADD  1         WULINB           Last item numbe
     C                     Z-ADDWULINB    BTBINB           Batch item no.
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      ***** 00/Copy Member GL0181MCBU - Journal Entry Posting  *          083009
     C*                                                                   083009
     C****/COPY WNCPYSRC,GL0181MCBU                                       083009
     C*
      * 00/Copy Member GL0121MCBU - Journal Entry Posting  *              083009
     C*                                                                   083009
     C/COPY WNCPYSRC,GL0121MCBU                                           083009
     C                     END                             *FI
     C           KLCRSA    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Check for duplicate primary key
     C           KLCRSA    SETLL@BTREAK                  90*
     C/COPY WNCPYSRC,GL0121MM05
     C           *IN90     IFEQ '1'
     C                     MOVEL'GLX0175' W0RTN   7
      * USER: Processing if DBF record already exists
     C                     SUB  1         WULINB           Last item numbe
     C                     GOTO SAEXIT
     C                     END
     C/COPY WNCPYSRC,GL0121MC99
      *
      ** display P&L CONFIRMATION window if acc code is Income/Expense                       LLN022A
      *                                                                                      LLN022A
     C           LLN021    IFEQ 'Y'                                                          LLN022A
     C           #1ACCD    ANDNE*BLANK                                                       LLN022A
      *                                                                                      LLN022A
      ** Access Account codes file to determine whether the code's                           LLN022A
      ** account Section is either INcome or EXpense.                                        LLN022A
      *                                                                                      LLN022A
     C                     MOVEL#1ACCD    UUACCD                                             LLN022A
     C                     CALL 'AOACODR0'                                                   LLN022A
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd                       LLN022A
     C                     PARM '*KEY'    UUAPOP  7        I:Option                          LLN022A
     C                     PARM           UUACCD 10        I:Account Code                    LLN022A
     C           D@ACOD    PARM *BLANK    UUFDY            O:Format                          LLN022A
      *                                                                                      LLN022A
      ** Assign work field to file field values                                              LLN022A
      *                                                                                      LLN022A
     C                     MOVELA5ACSC    WUACSC           A/c Section                       LLN022A
      *                                                                                      LLN022A
     C           WUACSC    IFEQ 'IN'                                                         LLN022A
     C           WUACSC    OREQ 'EX'                                                         LLN022A
     C                     MOVE 'Y'       W#YORN  1                                          LLN022A
     C                     MOVELP1BTNB    W#BTNB  3                                          LLN022A
     C                     Z-ADD#1BINB    W#BINB  30                                         LLN022A
     C                     MOVEL#1BCBH    W#BCBH  3                                          LLN022A
     C                     MOVEL#1CUST    W#CUST  6                                          LLN022A
     C                     MOVEL#1CYCD    W#CYCD  3                                          LLN022A
     C                     MOVEL#1ACCD    W#ACCD 10                                          LLN022A
     C                     MOVEL#1ACSN    W#ACSN  2                                          LLN022A
     C                     MOVELP1DPCD    W#DPCD  3                                          LLN022A
     C                     MOVEL#RNRTV    W#NARR 20                                          LLN022A
     C                     EXSR SRWNDW                                                       LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C                     WRITE@BTREAK                91  *
     C/COPY WNCPYSRC,GL0121MM06
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
      * USER: Processing if DBF update error
     C                     SUB  1         WULINB           Last item numbe
     C                     ELSE
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
      *                                                                   CGL016
     C           KLCHSC    CHAIN@BTREAK              9394                 CGL016
      *                                                                   CGL016
      * Accessing accounts to see whether Retail or not                   CGL016
      *                                                                   CGL016
     C                     CALL 'AOACCTR0'                                CGL016
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CGL016
     C                     PARM '*KEY'    UUAPOP  7        B:Option       CGL016
     C                     PARM *BLANKS   UUACID 10        I:Account IdentCGL016
     C                     PARM           BTCUST  6        I:Customer NumbCGL016
     C                     PARM           BTCYCD  3        I:Currency CodeCGL016
     C**********           PARM           BTACCD  4        I:Account Code              CGL016 CGL029
     C                     PARM           BTACCD 10                                           CGL029
     C                     PARM           BTACSN  2        I:Account SequeCGL016
     C                     PARM           BTIBCA  3        I:Branch code  CGL016
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format       CGL016
      *                                                                   CGL016
      * Accessing end date                                                CGL016
      *                                                                   CGL016
B2   C           ATYP      IFEQ 'R'                                       CGL016
      *                                                                   CGL016
     C                     CALL 'GL004446'                                CGL016
     C                     PARM *BLANKS   UUAPRC                          CGL016
     C                     PARM           @1DBRC                          CGL016
      *                                                                   CGL016
B3   C           UUAPRC    IFNE *BLANKS                                   CGL016
     C                     MOVE *ON       *IN91                           CGL016
     C                     MOVEL'Y2U0004' W0RTN                           CGL016
     C                     SUB  1         WULINB                          CGL016
     C                     GOTO SAEXIT                                    CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     MOVE 'Y'       BTSHPI                          CGL016
      *                                                                   CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
B2   C           *IN93     IFEQ *OFF                                      CGL016
     C           *IN94     ANDEQ*OFF                                      CGL016
      *                                                                                       CRE019
      ** When CRE019 is installed, write to CHQBKPD                                           CRE019
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           #1DCIN    ANDEQ'D'                                                           CRE019
     C                     SELEC                                                              CRE019
      *                                                                                       CRE019
      ** When full account was ammended and cheque number was present,                        CRE019
      ** reverse cheque with previous account                                                 CRE019
      *                                                                                       CRE019
     C           #1CUST    WHNE WPCUST                                                        CRE019
     C           WPCQNB    ANDNE*BLANKS                                                       CRE019
     C           #1CYCD    ORNE WPCYCD                                                        CRE019
     C           WPCQNB    ANDNE*BLANKS                                                       CRE019
     C           #1ACCD    ORNE WPACCD                                                        CRE019
     C           WPCQNB    ANDNE*BLANKS                                                       CRE019
     C           #1ACSN    ANDNEWPACSN                                                        CRE019
     C           WPCQNB    ANDNE*BLANKS                                                       CRE019
     C                     EXSR SRRFAC                                                        CRE019
      *                                                                                       CRE019
      ** If a cheque number is entered write new record to CHQBKPD                            CRE019
      *                                                                                       CRE019
     C           #1CQNB    IFNE *BLANKS                                                       CRE019
     C                     EXSR SRWCHQ                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** When ammended and cheque was blanked out, reverse previous                           CRE019
      *                                                                                       CRE019
     C           #1CQNB    WHEQ *BLANKS                                                       CRE019
     C           WPCQNB    ANDNE*BLANKS                                                       CRE019
     C                     MOVE *BLANKS   BTDUPC                                              CRE019
     C                     MOVE *BLANKS   BTOUTR                                              CRE019
     C                     EXSR SRRCHQ                                                        CRE019
      *                                                                                       CRE019
      ** When cheque number was ammended, write new record and                                CRE019
      ** reverse previous                                                                     CRE019
      *                                                                                       CRE019
     C           WPCQNB    WHNE *BLANKS                                                       CRE019
     C           WPCQNB    ANDNE#1CQNB                                                        CRE019
     C                     EXSR SRWCHQ                                                        CRE019
     C                     EXSR SRRCHQ                                                        CRE019
      *                                                                                       CRE019
      ** When cheque number was entered, write new record                                     CRE019
      *                                                                                       CRE019
     C           #1CQNB    WHNE *BLANKS                                                       CRE019
     C                     EXSR SRWCHQ                                                        CRE019
      *                                                                                       CRE019
      ** Other case, just initialize new fields for GLJENPPD                                  CRE019
      *                                                                                       CRE019
     C                     OTHER                                                              CRE019
     C                     MOVE *BLANKS   BTDUPC                                              CRE019
     C                     MOVE *BLANKS   BTOUTR                                              CRE019
     C                     ENDSL                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C********** WERRF     IFEQ 'Y'                                                   241505 241505A
     C**********           MOVE 'N'       BTVALI                                      241505 241505A
     C**********           ELSE                                                       241505 241505A
     C**********           MOVE 'Y'       BTVALI                                      241505 241505A
     C**********           ENDIF                                                      241505 241505A
      **********                                                                      241505 241505A
     C                     UPDAT@BTREAK                                   CGL016
     C                     EXSR MBFL#1                                    CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      * DBF write successful
     C           CSC011    IFEQ 'Y'                                                           CSC011
     C           LIBR      ANDEQS1SUPP                                                        CSC011
      *                                                                                       CSC011
     C                     CALL WPGM                                                          CSC011
     C                     PARM *BLANKS   PPRTCD 10                                           CSC011
     C                     PARM           @1DBRC                                              CSC011
     C                     PARM           TRANDL                                              CSC011
      *                                                                                       CSC011
     C                     MOVEL'GLBITP'  APTYPE                                              CSC011
     C                     MOVELBTFRNT    APFTRN                                              CSC011
     C                     MOVELBTAFRT    APFASC                                              CSC011
     C                     MOVELUSID      APUSER                                              CSC011
     C                     MOVELBTBTNB    PTRNNO                                              CSC011
      *                                                                                       CSC011
     C                     CALL WPGM2                                                         CSC011
     C                     PARM *BLANKS   PPRTCD                                              CSC011
     C                     PARM           APHEAD                                              CSC011
     C                     PARM           TRANDL                                              CSC011
     C                     PARM *BLANKS   PTIME  26                                           CSC011
     C**********           PARM           PTRNNO 18                                    CSC011 CGL029
     C**********           PARM *BLANKS   PATRNO 18                                    CSC011 CGL029
     C                     PARM           PTRNNO 24                                           CGL029
     C                     PARM *BLANKS   PATRNO 24                                           CGL029
      *                                                                                       CSC011
     C                     ENDIF                                                              CSC011
      *                                                                                       CGL013
      ** Additional Information Maintenance Screen                                            CGL013
      *                                                                                       CGL013
     C           PREV      TAG                                                              BUG23742
      *                                                                                     BUG23742
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C           #1ADIN    ANDEQ'Y'                                                           CGL013
     C                     MOVELBTBINB    PABINB                                              CGL013
     C                     MOVEL#1RACN    PARACN                                              CGL013
     C                     CALL 'GL000185'                                                    CGL013
     C                     PARM *BLANKS   PRTCD                                               CGL013
     C                     PARM           PDETLS                                              CGL013
     C                     PARM *BLANK    PADD    1                                           CGL013
     C                     PARM 'M'       PMODE   1                                           CGL013
     C                     PARM '0'       PEXIT1  1                                         BUG23742
     C                     PARM '0'       PCANC1  1                                         BUG23742
     C                     PARM           PVBIPX                                              246418
     C                     PARM 'N'       APIMOD  1                                           246418
     C                     PARM           FLDNMA                                              246418
     C                     PARM           MSGIDA                                              246418
     C                     PARM           MSGDTA                                              246418
      *                                                                                     BUG23742
     C           PCANC1    IFEQ '1'                                                         BUG23742
     C                     GOTO SAEXIT                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PEXIT1    IFEQ '1'                                                         BUG23742
     C                     EXSR ZYEXPG                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                       CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
      ** Display Additional 22x35 Narratives                                                BUG23742
      *                                                                                     BUG23742
     C           CER030    IFEQ 'Y'                                                         BUG23742
     C           #1ADIN    ANDEQ'Y'                                                         BUG23742
      *                                                                                     BUG23742
     C                     MOVELBTPTDT    PDATE                                             BUG23742
     C                     CALL 'GL000186'                                                  BUG23742
     C                     PARM *BLANKS   PRTCD                                             BUG23742
     C                     PARM           PDETLS                                            BUG23742
     C                     PARM           PDATE   50                                        BUG23742
     C                     PARM *BLANKS   PADD                                              BUG23742
     C                     PARM 'M'       PMODE                                             BUG23742
     C                     PARM '0'       PEXIT                                             BUG23742
     C                     PARM '0'       PCANC                                             BUG23742
     C                     PARM           FLDNMA                                            BUG23742
     C                     PARM           MSGIDA                                            BUG23742
     C                     PARM           MSGDTA                                            BUG23742
      *                                                                                     BUG23742
     C           PCANC     IFEQ '1'                                                         BUG23742
      *                                                                                     BUG23742
     C           CGL013    IFEQ 'Y'                                                         BUG23742
     C                     GOTO PREV                                                        BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PEXIT     IFEQ '1'                                                         BUG23742
     C                     EXSR ZYEXPG                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      ***** 00/Copy Member GL0181MCAU - Journal Entry Posting  *          083009
     C*
     C****/COPY WNCPYSRC,GL0181MCAU                                       083009
     C*
      * 00/Copy Member GL0121MCAU - Journal Entry Posting  *              083009
     C*                                                                   083009
     C/COPY WNCPYSRC,GL0121MCAU                                           083009
     C                     END                             *FI
     C                     END
     C/COPY WNCPYSRC,GL0121MC36
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBDLRC    BEGSR
      *================================================================
      * Delete GL Batch posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      ***** 00/Copy Member GL0181MDBU - Journal Entry Posting  *          083009
     C*
     C****/COPY WNCPYSRC,GL0181MDBU                                       083009
     C*
      * 00/Copy Member GL0121MDBU - Journal Entry Posting  *              083009
     C*                                                                   083009
     C/COPY WNCPYSRC,GL0121MDBU                                           083009
     C                     END                             *FI
      * Move key fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
      *
     C           KLDLSB    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      *                                                                                     BUG23742
      ** Declare key Fields for GLMNARL2                                                    BUG23742
      *                                                                                     BUG23742
     C           KLDLS1    KLIST                                                            BUG23742
     C                     KFLD           BTPTDT                                            BUG23742
     C                     KFLD           BTBTNB                                            BUG23742
     C                     KFLD           BTBINB                                            BUG23742
      *                                                                                     BUG23742
     C           KLDLSB    CHAIN@BTREAK              9091  *
     C/COPY WNCPYSRC,GL0121MM07
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SBEXIT
     C                     END
      *                                                                                       CSC011
     C           CSC011    IFEQ 'Y'                                                           CSC011
     C           LIBR      ANDEQS1SUPP                                                        CSC011
     C                     CALL WPGM                                                          CSC011
     C                     PARM *BLANKS   PPRTCD 10                                           CSC011
     C                     PARM           @1DBRC                                              CSC011
     C                     PARM           TRNDTL                                              CSC011
     C                     ENDIF                                                              CSC011
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Use SETLL to release record lock
     C           KLDLSB    SETLL@BTREAK              9091  *
     C/COPY WNCPYSRC,GL0121MM08
     C                     GOTO SBEXIT
     C                     END                             FI #1DBRC
      *................................................................
     C/COPY WNCPYSRC,GL0121MK01
      *                                                                                       CRE019
      ** Remove cheque from presented list when removing a batch if no                        CRE019
      ** other transaction is using the specific cheque                                       CRE019
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           #1CQNB    ANDNE*BLANKS                                                       CRE019
     C                     MOVE 'Y'       WOKDEL                                              CRE019
      *                                                                                       CRE019
      ** Access TTRANL6 to check if other transaction uses the cheque                         CRE019
      *                                                                                       CRE019
     C           #1CQNB    SETLLTTRANL6                                                       CRE019
     C           #1CQNB    READETTRANL6                  83                                   CRE019
      *                                                                                       CRE019
     C           *IN83     DOWNE*ON                                                           CRE019
      *                                                                                       CRE019
      ** Convert CUSEXCE's numeric fields to alpha for comparison                             CRE019
      *                                                                                       CRE019
     C                     MOVELTDCUS     WDCUS   6                                           CRE019
     C                     MOVELTDACOD    WDACOD 10                                           CRE019
     C                     MOVELTDACS     WDACS   2                                           CRE019
      *                                                                                       CRE019
     C********** TAACNO    IFNE *BLANKS                                               CRE019 BUG2488
     C**********           MOVE TAACNO    TRACNO                                      CRE019 BUG2488
     C**********           ENDIF                                                      CRE019 BUG2488
      *                                                                                       CRE019
     C           BTRACN    IFEQ TRACNO                                                        CRE019
     C           TRACNO    OREQ *ZEROS                                                        CRE019
     C           TDRBR     ANDEQBTIBCA                                                        CRE019
     C           WDCUS     ANDEQBTCUST                                                        CRE019
     C           WDACOD    ANDEQBTACCD                                                        CRE019
     C           WDACS     ANDEQBTACSN                                                        CRE019
     C           TDRCY     ANDEQBTCYCD                                                        CRE019
      *                                                                                       CRE019
     C           BTBTNB    IFEQ TRBTNB                                                        CRE019
     C           BTBINB    ANDEQTRBINB                                                        CRE019
     C                     MOVE *BLANKS   TRBTNB                                              CRE019
     C                     MOVE *BLANKS   TRBINB                                              CRE019
     C           #1CQNB    READETTRANL6                  83                                   CRE019
     C                     ELSE                                                               CRE019
     C                     MOVE 'N'       WOKDEL  1                                           CRE019
     C                     MOVE *ON       *IN83                                               CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
     C           #1CQNB    READETTRANL6                  83                                   CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDDO                                                              CRE019
      *                                                                                      BUG2488
      ** Check if cheque exist in telelr transactions                                        BUG2488
      *                                                                                      BUG2488
     C           WOKDEL    IFEQ 'Y'                                                          BUG2488
     C                     MOVE *OFF      *IN83                                              BUG2488
     C           *LOVAL    SETLLSDTELDL1                                                     BUG2488
     C                     READ SDTELDL1                 83                                  BUG2488
     C           *IN83     DOWEQ*OFF                                                         BUG2488
      *                                                                                      BUG2488
      ** If not the first time, delete previous overrides                                    BUG2488
      *                                                                                      BUG2488
     C           @CMD      IFNE *BLANKS                                                      BUG2488
     C                     MOVEL*BLANKS   @CMD                                               BUG2488
     C                     MOVEL@TXT,1    @CMD                                               BUG2488
     C                     CALL 'QCMDEXC'                                                    BUG2488
     C                     PARM           @CMD                                               BUG2488
     C                     PARM 80        @LEN   155                                         BUG2488
     C                     CLOSETTRANL7                                                      BUG2488
     C                     ENDIF                                                             BUG2488
      *                                                                                      BUG2488
      ** Perform override to LF/TTRANL7                                                      BUG2488
      *                                                                                      BUG2488
     C                     MOVEL*BLANKS   @CMD                                               BUG2488
     C                     MOVEL@TXT,2    @CMD                                               BUG2488
     C                     MOVEL'T'       @BRI                                               BUG2488
     C                     MOVELFRTLID    @BID                                               BUG2488
     C                     CALL 'QCMDEXC'                                                    BUG2488
     C                     PARM           @CMD                                               BUG2488
     C                     PARM 80        @LEN                                               BUG2488
      *                                                                                      BUG2488
     C                     OPEN TTRANL7                                                      BUG2488
     C           *LOVAL    SETLLTTRANL7                                                      BUG2488
     C           #1CQNB    CHAINTTRANL7              84                                      BUG2488
     C           *IN84     IFEQ *OFF                                                         BUG2488
     C                     MOVE 'N'       WOKDEL                                             BUG2488
     C                     LEAVE                                                             BUG2488
     C                     ENDIF                                                             BUG2488
      *                                                                                      BUG2488
     C                     READ SDTELDL1                 83                                  BUG2488
      *                                                                                      BUG2488
     C                     ENDDO                                                             BUG2488
     C                     ENDIF                                                             BUG2488
      *                                                                                       CRE019
      ** Allow delete if current transaction is the only transaction                          CRE019
      ** using the cheque                                                                     CRE019
      *                                                                                       CRE019
     C           WOKDEL    IFEQ 'Y'                                                           CRE019
     C                     EXSR SRDCHQ                                                        CRE019
     C                     ENDIF                                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     DELET@BTREAK                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF delete successful
      *                                                                                       CSC011
     C/COPY WNCPYSRC,GL0121MK85
      *                                                                                       CGL013
      ** If Additional Information Exist in PF/GLJENXPD, delete.                              CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C           KLDLSB    CHAINGLJENXL3             65                                       CGL013
     C           *IN65     IFEQ *OFF                                                          CGL013
     C                     DELET@LJENXD0                                                      CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                     BUG23742
     C           CER030    IFEQ 'Y'                                                         BUG23742
      *                                                                                     BUG23742
     C           KLDLS1    CHAINGLMNARL2             65                                     BUG23742
      *                                                                                     BUG23742
     C           *IN65     IFEQ *OFF                                                        BUG23742
     C                     DELETGLMNARD2                                                    BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
      ** Delete record in the log file when in the support system                             CSC011
      *                                                                                       CSC011
     C           CSC011    IFEQ 'Y'                                                           CSC011
     C           LIBR      ANDEQS1SUPP                                                        CSC011
      *                                                                                       CSC011
     C                     OPEN APVLOGL0                                                      CSC011
     C                     MOVEL'GLBITP'  APTYPE                                              CSC011
     C           KVLOG     CHAINAPVLOGL0             56                                       CSC011
      *                                                                                       CSC011
     C           *IN56     DOWEQ'0'                                                           CSC011
     C           TRNDTL    IFEQ GLTRDL                                                        CSC011
     C                     DELETAPVLOGP0                                                      CSC011
     C                     MOVE '1'       *IN56                                               CSC011
     C                     ELSE                                                               CSC011
     C           KVLOG     READEAPVLOGL0                 56                                   CSC011
     C                     ENDIF                                                              CSC011
      *                                                                                       CSC011
     C                     ENDDO                                                              CSC011
     C                     CLOSEAPVLOGL0                                                      CSC011
      *                                                                                       CSC011
     C                     ENDIF                                                              CSC011
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
      *                                                                   CGL016
B2   C           BTSHPI    IFEQ 'Y'                                       CGL016
      *                                                                   CGL016
B3   C           BTDCIN    IFEQ 'D'                                       CGL016
     C                     MOVE 'C'       BTDCIN                          CGL016
X3   C                     ELSE                                           CGL016
     C                     MOVE 'D'       BTDCIN                          CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     CALL 'GL004446'                                CGL016
     C                     PARM *BLANKS   UUAPRC                          CGL016
     C                     PARM           @1DBRC                          CGL016
      *                                                                   CGL016
B3   C           UUAPRC    IFNE *BLANKS                                   CGL016
     C                     MOVE *ON       *IN91                           CGL016
     C                     MOVEL'Y2U0004' W0RTN                           CGL016
     C                     GOTO SBEXIT                                    CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      *                                                                                       CSC011
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      ***** 00/Copy Member GL0181MDAU - Journal Entry Posting  *          083009
     C*
     C****/COPY WNCPYSRC,GL0181MDAU                                       083009
     C*
      * 00/Copy Member GL0121MDAU - Journal Entry Posting  *              083009
     C*                                                                   083009
     C/COPY WNCPYSRC,GL0121MDAU                                           083009
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MM39                                                               GBO021
     C                     END
     C/COPY WNCPYSRC,GL0121MC40
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCHRC    BEGSR
      *================================================================
      * Change GL Batch posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before DBF read
      * CASE: WRK.Abbreviated Posting? is Yes
     C           WUABPS    IFEQ 'Y'                        *IF
      * E18852 - Branch Code of Trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL*BLANK    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C/COPY WNCPYSRC,GL0121MC85
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0121MC55
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELDACC      WUDACC           Date Account CL143482
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C/COPY WNCPYSRC,GL0121MC56
     C*
      * End of Fix LN0315
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0135           Account Identif
     C                     MOVEL#1CYCD    ZA0136           Currency code
     C                     MOVEL#1ACCD    ZA0137           Account code
     C                     MOVEL#1ACSN    ZA0138           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983334*
     C                     SETON                     35    *
      *
     C                     GOTO SCEXIT                     *QUIT
     C                     END                             *FI
      * Was posting Retail? - Journal Entry Posting  *
     C                     EXSR SDRVGN
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0139           Account Identif
     C                     MOVEL#1CYCD    ZA0140           Currency code
     C                     MOVEL#1ACCD    ZA0141           Account code
     C                     MOVEL#1ACSN    ZA0142           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983334*
     C                     SETON                     35    *
      *
     C                     GOTO SCEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Move key fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
      *
     C           KLCHSC    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
     C           KLCHSC    CHAIN@BTREAK              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SCEXIT
     C                     END
     C/COPY WNCPYSRC,GL0121MM09
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Use SETLL to release record lock
     C           KLCHSC    SETLL@BTREAK              9091  *
     C/COPY WNCPYSRC,GL0121MM10
     C                     GOTO SCEXIT
     C                     END                             FI #1DBRC
      *                                                                                       CSC011
     C           CSC011    IFEQ 'Y'                                                           CSC011
     C           LIBR      ANDEQS1SUPP                                                        CSC011
     C                     CALL WPGM                                                          CSC011
     C                     PARM *BLANKS   PPRTCD 10                                           CSC011
     C                     PARM           @1DBRC                                              CSC011
     C                     PARM           TRNDTL                                              CSC011
     C                     ENDIF                                                              CSC011
      *                                                                   CGL016
      * Save Batch info                                                   CGL016
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
     C                     MOVE BTIBCA    W0IBCA  3                       CGL016
     C                     MOVE BTCUST    W0CUST  6                       CGL016
     C                     MOVE BTCYCD    W0CYCD  3                       CGL016
     C**********           MOVE BTACCD    W0ACCD  4                                    CGL016 CGL029
     C                     MOVE BTACCD    W0ACCD 10                                           CGL029
     C                     MOVE BTACSN    W0ACSN  2                       CGL016
     C                     MOVE BTPTAM    W0PTAM 130                      CGL016
     C                     MOVE BTDCIN    W0DCIN  1                       CGL016
     C                     MOVE BTVLDT    W0VLDT  50                      CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                                       CSC011
      ** Save previous value of cheque number and full account                                CRE019
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C                     MOVE BTCQNB    WPCQNB                                              CRE019
     C                     MOVELBTIBCA    WPIBCA                                              CRE019
     C                     MOVELBTCUST    WPCUST                                              CRE019
     C                     MOVELBTCYCD    WPCYCD                                              CRE019
     C                     MOVELBTACCD    WPACCD                                              CRE019
     C                     MOVELBTACSN    WPACSN                                              CRE019
     C                     Z-ADDBTRACN    WPRACN                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      * Move non-key fields to @BTREAK
     C                     MOVEL#1IBCA    BTIBCA           Input Branch Co
     C                     MOVEL#1CUST    BTCUST           Customer number
     C                     MOVEL#1CYCD    BTCYCD           Currency code
     C                     MOVEL#1ACCD    BTACCD           Account code
     C                     MOVEL#1ACSN    BTACSN           Account sequenc
     C                     MOVEL#1NNBI    BTNNBI           Nostro number (
     C                     Z-ADD#1RACN    BTRACN           Retail account
     C                     MOVEL#1RINO    BTRINO           Retail ind.: Ov
     C                     MOVEL#1RINE    BTRINE           Retail ind.: Er
     C                     MOVEL#1TRTY    BTTRTY           Transaction typ
     C                     Z-ADD#1PTAM    BTPTAM           Posting amount
     C                     MOVEL#1DCIN    BTDCIN           Debit/credit in
     C                     Z-ADD#1PTDT    BTPTDT           Posting date
     C                     Z-ADD#1VLDT    BTVLDT           Value date
     C                     MOVEL#1NVCD    BTNVCD           Narrative code
     C                     MOVEL#1NRDC    BTNRDC           Narrative descr
     C/COPY WNCPYSRC,GL0121MM11
     C                     MOVEL#1ACTY    BTACTY           Account type
     C                     MOVEL#1ACNB    BTACNB           Assoc. Customer
     C                     MOVEL#1CQNB    BTCQNB           Cheque number
     C                     MOVEL#1COIN    BTCOIN           Customer origin
     C                     MOVEL#1SWCR    BTSWCR           Swift common re
     C                     MOVEL#1PRCN    BTPRCN           Profit centre
     C                     MOVEL#1BCBH    BTBCBH           Branch Code (Ba
     C                     MOVEL#1RADP    BTRADP           Retail advice p
     C                     MOVEL#1SHPI    BTSHPI           Shadow post ind
     C                     Z-ADD#1RRNM    BTRRNM           Relative rec no
     C                     MOVEL#1RNBE    BTRNBE           Retail Number E
     C                     MOVEL#1RARC    BTRARC           Retail Ac Refer
     C                     MOVEL#1TSTY    BTTSTY           Transaction (Su
     C                     MOVEL#1BKCD    BTBKCD           Book Code
     C                     Z-ADD#1SPFC    BTSPFC           Spread Factor
     C                     MOVEL#1RVDI    BTRVDI           Reverse/Void In
     C                     Z-ADD#1NITM    BTNITM           Number of Items
     C                     MOVEL#1OCCY    BTOCCY           Original Ccy   CEU013
     C                     Z-ADD#1OAMT    BTOAMT           Original AmountCEU013
      *
      * USER: Processing before DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      ***** 00/Copy Member GL0181MBDU - Journal Entry Posting  *          083009
     C*
     C****/COPY WNCPYSRC,GL0181MBDU                                       083009
     C*
      * 00/Copy Member GL0121MBDU - Journal Entry Posting  *              083009
     C*                                                                   083009
     C/COPY WNCPYSRC,GL0121MBDU                                           083009
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MK02
      *                                                                                      LLN022A
      ** Display P&L CONFIRMATION window if acc code is Income/Expense                       LLN022A
      *                                                                                      LLN022A
     C           LLN021    IFEQ 'Y'                                                          LLN022A
     C           #1ACCD    ANDNE*BLANK                                                       LLN022A
      *                                                                                      LLN022A
      ** Access Account codes file to determine whether the code's                           LLN022A
      ** account Section is either INcome or EXpense.                                        LLN022A
      *                                                                                      LLN022A
     C                     MOVEL#1ACCD    UUACCD                                             LLN022A
     C                     CALL 'AOACODR0'                                                   LLN022A
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd                       LLN022A
     C                     PARM '*KEY'    UUAPOP  7        I:Option                          LLN022A
     C                     PARM           UUACCD 10        I:Account Code                    LLN022A
     C           D@ACOD    PARM *BLANK    UUFDY            O:Format                          LLN022A
      *                                                                                      LLN022A
      ** Assign work field to file field values                                              LLN022A
      *                                                                                      LLN022A
     C                     MOVELA5ACSC    WUACSC           A/c Section                       LLN022A
      *                                                                                      LLN022A
     C           WUACSC    IFEQ 'IN'                                                         LLN022A
     C           WUACSC    OREQ 'EX'                                                         LLN022A
     C                     MOVE 'Y'       W#YORN                                             LLN022A
     C                     MOVELP1BTNB    W#BTNB                                             LLN022A
     C                     Z-ADD#1BINB    W#BINB                                             LLN022A
     C                     MOVEL#1BCBH    W#BCBH                                             LLN022A
     C                     MOVEL#1CUST    W#CUST                                             LLN022A
     C                     MOVEL#1CYCD    W#CYCD                                             LLN022A
     C                     MOVEL#1ACCD    W#ACCD                                             LLN022A
     C                     MOVEL#1ACSN    W#ACSN                                             LLN022A
     C                     MOVELP1DPCD    W#DPCD                                             LLN022A
     C                     MOVEL#RNRTV    W#NARR                                             LLN022A
     C                     EXSR SRWNDW                                                       LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           #1DCIN    ANDEQ'D'                                                           CRE019
     C                     SELEC                                                              CRE019
      *                                                                                       CRE019
      ** When full account was ammended and cheque number was present,                        CRE019
      ** reverse cheque with previous account                                                 CRE019
      *                                                                                       CRE019
     C           #1CUST    WHNE WPCUST                                                        CRE019
     C           WPCQNB    ANDNE*BLANKS                                                       CRE019
     C           #1CYCD    ORNE WPCYCD                                                        CRE019
     C           WPCQNB    ANDNE*BLANKS                                                       CRE019
     C           #1ACCD    ORNE WPACCD                                                        CRE019
     C           WPCQNB    ANDNE*BLANKS                                                       CRE019
     C           #1ACSN    ANDNEWPACSN                                                        CRE019
     C           WPCQNB    ANDNE*BLANKS                                                       CRE019
     C                     EXSR SRRFAC                                                        CRE019
      *                                                                                       CRE019
      ** If a cheque number is entered write new record to CHQBKPD                            CRE019
      *                                                                                       CRE019
     C           #1CQNB    IFNE *BLANKS                                                       CRE019
     C                     EXSR SRWCHQ                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** When ammended and cheque was blanked out, reverse previous                           CRE019
      *                                                                                       CRE019
     C           #1CQNB    WHEQ *BLANKS                                                       CRE019
     C           WPCQNB    ANDNE*BLANKS                                                       CRE019
     C                     MOVE *BLANKS   BTDUPC                                              CRE019
     C                     MOVE *BLANKS   BTOUTR                                              CRE019
     C                     EXSR SRRCHQ                                                        CRE019
      *                                                                                       CRE019
      ** When cheque number was ammended, write new record and                                CRE019
      ** reverse previous                                                                     CRE019
      *                                                                                       CRE019
     C           WPCQNB    WHNE *BLANKS                                                       CRE019
     C           WPCQNB    ANDNE#1CQNB                                                        CRE019
     C                     EXSR SRWCHQ                                                        CRE019
     C                     EXSR SRRCHQ                                                        CRE019
      *                                                                                       CRE019
      ** When cheque number was entered, write new record                                     CRE019
      *                                                                                       CRE019
     C           #1CQNB    WHNE *BLANKS                                                       CRE019
     C                     EXSR SRWCHQ                                                        CRE019
      *                                                                                       CRE019
      ** Other case, just initialize new fields for GLJENPPD                                  CRE019
      *                                                                                       CRE019
     C                     OTHER                                                              CRE019
     C                     MOVE *BLANKS   BTDUPC                                              CRE019
     C                     MOVE *BLANKS   BTOUTR                                              CRE019
     C                     ENDSL                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C********** WERRF     IFEQ 'Y'                                                   241505 241505A
     C**********           MOVE 'N'       BTVALI                                      241505 241505A
     C**********           ELSE                                                       241505 241505A
     C**********           MOVE 'Y'       BTVALI                                      241505 241505A
     C**********           ENDIF                                                      241505 241505A
      **********                                                                      241505 241505A
     C                     UPDAT@BTREAK                91  *
     C/COPY WNCPYSRC,GL0121MM12
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *                                                                   CGL016
      * Lock the record again                                             CGL016
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
      *                                                                   CGL016
B2   C           BTIBCA    IFNE W0IBCA                                    CGL016
     C           BTCUST    ORNE W0CUST                                    CGL016
     C           BTCYCD    ORNE W0CYCD                                    CGL016
     C           BTACCD    ORNE W0ACCD                                    CGL016
     C           BTACSN    ORNE W0ACSN                                    CGL016
     C           BTPTAM    ORNE W0PTAM                                    CGL016
     C           BTDCIN    ORNE W0DCIN                                    CGL016
     C           BTVLDT    ORNE W0VLDT                                    CGL016
      *                                                                   CGL016
     C           KLCHSC    CHAIN@BTREAK              9394                 CGL016
      *                                                                   CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C/COPY WNCPYSRC,GL0121MK83
      *                                                                                       CGL013
      ** Additional Information Maintenance Screen                                            CGL013
      *                                                                                       CGL013
     C           PREV1     TAG                                                              BUG23742
      *                                                                                     BUG23742
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C           #1ADIN    ANDEQ'Y'                                                           CGL013
     C                     MOVELBTBINB    PABINB                                              CGL013
     C                     MOVEL#1RACN    PARACN                                              CGL013
     C                     CALL 'GL000185'                                                    CGL013
     C                     PARM *BLANKS   PRTCD                                               CGL013
     C                     PARM           PDETLS                                              CGL013
     C                     PARM *BLANK    PADD                                                CGL013
     C                     PARM 'M'       PMODE                                               CGL013
     C                     PARM '0'       PEXIT1                                            BUG23742
     C                     PARM '0'       PCANC1                                            BUG23742
     C                     PARM           PVBIPX                                              246418
     C                     PARM 'N'       APIMOD  1                                           246418
     C                     PARM           FLDNMA                                              246418
     C                     PARM           MSGIDA                                              246418
     C                     PARM           MSGDTA                                              246418
      *                                                                                       CGL013
     C**********           MOVE 'N'       #1ADIN                                     CGL013 BUG23742
     C           PADD      IFEQ 'Y'                                                           CGL013
     C                     MOVE '*'       #1AIPI                                              CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE *BLANK    #1AIPI                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           PCANC1    IFEQ '1'                                                         BUG23742
     C                     MOVE 'N'       #1ADIN                                            BUG23742
     C                     GOTO SCEXIT                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PEXIT1    IFEQ '1'                                                         BUG23742
     C                     EXSR ZYEXPG                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                              CGL013
      *                                                                                     BUG23742
      ** Display Additional 22x35 Narratives                                                BUG23742
      *                                                                                     BUG23742
     C           CER030    IFEQ 'Y'                                                         BUG23742
     C           #1ADIN    ANDEQ'Y'                                                         BUG23742
      *                                                                                     BUG23742
     C                     MOVELBTPTDT    PDATE                                             BUG23742
     C                     CALL 'GL000186'                                                  BUG23742
     C                     PARM *BLANKS   PRTCD                                             BUG23742
     C                     PARM           PDETLS                                            BUG23742
     C                     PARM           PDATE                                             BUG23742
     C                     PARM *BLANKS   PADD                                              BUG23742
     C                     PARM 'M'       PMODE                                             BUG23742
     C                     PARM '0'       PEXIT   1                                         BUG23742
     C                     PARM '0'       PCANC   1                                         BUG23742
     C                     PARM           FLDNMA                                            BUG23742
     C                     PARM           MSGIDA                                            BUG23742
     C                     PARM           MSGDTA                                            BUG23742
      *                                                                                     BUG23742
     C           PADD      IFEQ 'Y'                                                         BUG23742
     C                     MOVE '*'       #1AIP1                                            BUG23742
     C                     ELSE                                                             BUG23742
     C                     MOVE *BLANKS   #1AIP1                                            BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PCANC     IFEQ '1'                                                         BUG23742
      *                                                                                     BUG23742
     C           CGL013    IFEQ 'Y'                                                         BUG23742
     C                     GOTO PREV1                                                       BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PEXIT     IFEQ '1'                                                         BUG23742
     C                     EXSR ZYEXPG                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     MOVE 'N'       #1ADIN                                            BUG23742
      * DBF change successful
      *                                                                                       CSC011
      ** Update log file when in the support system                                           CSC011
      *                                                                                       CSC011
     C           CSC011    IFEQ 'Y'                                                           CSC011
     C           LIBR      ANDEQS1SUPP                                                        CSC011
      *                                                                                       CSC011
     C                     OPEN APVLOGL0                                                      CSC011
     C                     MOVEL'GLBITP'  APTYPE                                              CSC011
     C           KVLOG     CHAINAPVLOGL0             56                                       CSC011
      *                                                                                       CSC011
     C                     CALL WPGM                                                          CSC011
     C                     PARM *BLANKS   PPRTCD 10                                           CSC011
     C                     PARM           @1DBRC                                              CSC011
     C                     PARM           TRANDL                                              CSC011
      *                                                                                       CSC011
     C                     MOVELBTFRNT    APFTRN                                              CSC011
     C                     MOVELBTAFRT    APFASC                                              CSC011
     C                     MOVELUSID      APUSER                                              CSC011
     C                     MOVELBTBTNB    PTRNNO                                              CSC011
     C                     MOVEL'N'       WDONE                                               CSC011
      *                                                                                       CSC011
     C           *IN56     DOWEQ'0'                                                           CSC011
     C           WDONE     ANDEQ'N'                                                           CSC011
      *                                                                                       CSC011
     C           TRNDTL    IFEQ GLTRDL                                                        CSC011
     C                     MOVEL'A'       APRESP                                              CSC011
     C                     MOVEL'B'       APRPRL                                              CSC011
     C           APHEAD    CAT  TRANDL    APTRAN                                              CSC011
     C                     UPDATAPVLOGP0                                                      CSC011
     C                     MOVEL'Y'       WDONE   1                                           CSC011
      *                                                                                       CSC011
     C                     ELSE                                                               CSC011
     C           KVLOG     READEAPVLOGL0                 56                                   CSC011
     C                     ENDIF                                                              CSC011
      *                                                                                       CSC011
     C                     ENDDO                                                              CSC011
     C                     CLOSEAPVLOGL0                                                      CSC011
      *                                                                                       CSC011
      ** If does not exist in the log file, insert a record                                   CSC011
      *                                                                                       CSC011
     C           WDONE     IFEQ 'N'                                                           CSC011
     C                     CALL WPGM2                                                         CSC011
     C                     PARM *BLANKS   PPRTCD                                              CSC011
     C                     PARM           APHEAD                                              CSC011
     C                     PARM           TRANDL                                              CSC011
     C                     PARM *BLANKS   PTIME  26                                           CSC011
     C**********           PARM           PTRNNO 18                                    CSC011 CGL029
     C**********           PARM *BLANKS   PATRNO 18                                    CSC011 CGL029
     C                     PARM           PTRNNO 24                                           CGL029
     C                     PARM *BLANKS   PATRNO 24                                           CGL029
      *                                                                                       CSC011
     C                     ENDIF                                                              CSC011
      *                                                                                       CSC011
     C                     ENDIF                                                              CSC011
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      *                                                                   CGL016
      * Verify any change in details for batch entered - CGL016           CGL016
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
      *                                                                   CGL016
B2   C           BTIBCA    IFNE W0IBCA                                    CGL016
     C           BTCUST    ORNE W0CUST                                    CGL016
     C           BTCYCD    ORNE W0CYCD                                    CGL016
     C           BTACCD    ORNE W0ACCD                                    CGL016
     C           BTACSN    ORNE W0ACSN                                    CGL016
     C           BTPTAM    ORNE W0PTAM                                    CGL016
     C           BTDCIN    ORNE W0DCIN                                    CGL016
     C           BTVLDT    ORNE W0VLDT                                    CGL016
      *                                                                   CGL016
B3   C           BTSHPI    IFEQ 'Y'                                       CGL016
      *                                                                   CGL016
      * Revert entry                                                      CGL016
     C                     MOVE W0IBCA    BTIBCA                          CGL016
     C                     MOVE W0CUST    BTCUST                          CGL016
     C                     MOVE W0CYCD    BTCYCD                          CGL016
     C                     MOVE W0ACCD    BTACCD                          CGL016
     C                     MOVE W0ACSN    BTACSN                          CGL016
     C                     MOVE W0PTAM    BTPTAM                          CGL016
     C                     MOVE W0DCIN    BTDCIN                          CGL016
     C                     MOVE W0VLDT    BTVLDT                          CGL016
      *                                                                   CGL016
B4   C           BTDCIN    IFEQ 'D'                                       CGL016
     C                     MOVE 'C'       BTDCIN                          CGL016
X4   C                     ELSE                                           CGL016
     C                     MOVE 'D'       BTDCIN                          CGL016
E4   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     CALL 'GL004446'                                CGL016
     C                     PARM *BLANKS   UUAPRC                          CGL016
     C                     PARM           @1DBRC                          CGL016
      *                                                                   CGL016
B4   C           UUAPRC    IFNE *BLANKS                                   CGL016
     C                     MOVE *ON       *IN91                           CGL016
     C                     MOVEL'Y2U0004' W0RTN                           CGL016
     C                     GOTO SCEXIT                                    CGL016
E4   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     MOVEL#1DBRC    @1DBRC                          CGL016
      *                                                                   CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      * Accessing account to see whether Retail or not                    CGL016
      *                                                                   CGL016
     C                     CALL 'AOACCTR0'                                CGL016
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CGL016
     C                     PARM '*KEY'    UUAPOP  7        B:Option       CGL016
     C                     PARM *BLANKS   UUACID 10        I:Account IdentCGL016
     C                     PARM           BTCUST  6        I:Customer NumbCGL016
     C                     PARM           BTCYCD  3        I:Currency CodeCGL016
     C**********           PARM           BTACCD  4        I:Account Code              CGL016 CGL029
     C                     PARM           BTACCD 10                                           CGL029
     C                     PARM           BTACSN  2        I:Account SequeCGL016
     C                     PARM           BTIBCA  3        I:Branch code  CGL016
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format       CGL016
      *                                                                   CGL016
      * Accessing end date                                                CGL016
      *                                                                   CGL016
B3   C           ATYP      IFEQ 'R'                                       CGL016
      * Yes: call helper program                                          CGL016
     C                     CALL 'GL004446'                                CGL016
     C                     PARM *BLANKS   UUAPRC                          CGL016
     C                     PARM           @1DBRC                          CGL016
      *                                                                   CGL016
B4   C           UUAPRC    IFNE *BLANKS                                   CGL016
     C                     MOVE *ON       *IN91                           CGL016
     C                     MOVEL'Y2U0004' W0RTN                           CGL016
     C                     GOTO SCEXIT                                    CGL016
E4   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     MOVE 'Y'       BTSHPI                          CGL016
      *                                                                   CGL016
X3   C                     ELSE                                           CGL016
      *                                                                   CGL016
     C                     MOVE ' '       BTSHPI                          CGL016
      *                                                                   CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
B3   C           *IN93     IFEQ *OFF                                      CGL016
     C           *IN94     ANDEQ*OFF                                      CGL016
     C                     UPDAT@BTREAK                                   CGL016
     C                     EXSR MBFL#1                                    CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      ***** 00/Copy Member GL0181MADU - Journal Entry Posting  *          083009
     C*
     C****/COPY WNCPYSRC,GL0181MADU                                       083009
     C*
      * 00/Copy Member GL0121MADU - Journal Entry Posting  *              083009
     C*                                                                   083009
     C/COPY WNCPYSRC,GL0121MADU                                           083009
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MM40                                                               GBO021
     C                     END
     C/COPY WNCPYSRC,GL0121MC37
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDRVGN    BEGSR
      *================================================================
      * Was posting Retail? - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSD     KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Move fields to key list
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
     C           KRSSD     CHAIN@BTREAL              90    *
     C/COPY WNCPYSRC,GL0121MM13
      * DBF record not found
     C   90                MOVEL'GLX0176' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process DBF record
      * PAR = DB1 By name
     C                     MOVELBTACTY    WUACTY           Account type
     C                     END
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT                                                              CGL002
     CSR         SRGLOV    BEGSR                                          CGL002
      *================================================================   CGL002
      **  Check Overrideable GL Errors                                    CGL002
      *================================================================   CGL002
      *                                                                   CGL002
      **  Initialise work fields                                          CGL002
      *                                                                   CGL002
     C                     MOVELWURETB    URRETI                          CGL002
     C                     MOVEL#1DCIN    URIND                           CGL002
     C                     MOVEL'NNNNNNNN'WURARC                          CGL002
     C                     MOVE 'NN'      WURARC                          CGL002
      *                                                                   CGL002
      **  Check GL Account Status                                         CGL002
      *                                                                   CGL002
     C                     EXSR SRGLST                                    CGL002
     C                     MOVELURERST    #RIEST                          CGL002
     C                     MOVELURERTX    #RIEMG                          CGL002
      *                                                                   CGL002
      **  Determine Item Error State...                                   CGL002
     C                     SELEC                                          CGL002
      *                                                                   CGL002
      **  ...Errors in Item, send message 'Can't Override GL A/c Error'   CGL002
      *                                                                   CGL002
     C           #RIEST    WHEQ 'E'                                       CGL002
     C                     MOVEL'Y'       #1RINE                          CGL002
     C                     MOVEL'N'       #1RINO                          CGL002
     C                     MOVEL#RACID    ZA0070                          CGL002
     C                     MOVEL#1CYCD    ZA0071                          CGL002
     C                     MOVEL#1ACCD    ZA0072                          CGL002
     C                     MOVEL#1ACSN    ZA0073                          CGL002
     C                     MOVEL'GLX0395' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     983233               CGL002
     C                     SETON                     3435                 CGL002
      *                                                                   CGL002
      **  ...Overridable Errors                                           CGL002
      *                                                                   CGL002
     C           #RIEST    WHEQ 'O'                                       CGL002
     C                     MOVEL'Y'       #1RINE                          CGL002
      *                                                                   CGL002
     C           #1RINO    IFNE 'Y'                                       CGL002
     C           #1RINO    ANDNE'N'                                       CGL002
      *                                                                   CGL002
      **  Override indicator is *Blank, send message 'GL A/c              CGL002
      **  Error Requires Override'                                        CGL002
     C           #1RINO    IFEQ *BLANK                                    CGL002
     C                     MOVEL#1RINO    ZA0074                          CGL002
     C                     MOVEL'GLX0141' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     9850                 CGL002
      *                                                                   CGL002
      **  Else, send message 'GL A/c Override Invalid'                    CGL002
     C                     ELSE                                           CGL002
     C                     MOVEL#1RINO    ZA0075                          CGL002
     C                     MOVEL'GLX0214' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     9850                 CGL002
     C                     ENDIF                                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  ...No errors in Item                                            CGL002
      *                                                                   CGL002
     C           #RIEST    WHEQ *BLANK                                    CGL002
     C                     MOVEL'N'       #1RINE                          CGL002
     C                     MOVEL*BLANK    #1RINO                          CGL002
      *                                                                   CGL002
     C                     ENDSL                                          CGL002
      *                                                                   CGL002
      *================================================================   CGL002
     CSR                   ENDSR                                          CGL002
      /EJECT                                                              CGL002
     CSR         SRGLST    BEGSR                                          CGL002
      *================================================================   CGL002
      **  Check GL Account Status                                         CGL002
      *================================================================   CGL002
      *                                                                   CGL002
     C                     MOVE *IN90     URSI90  1                       CGL002
     C                     MOVE *IN91     URSI91  1                       CGL002
     C                     MOVE *BLANK    URIESL                          CGL002
     C                     MOVE *BLANK    URERST  1                       CGL002
     C                     Z-ADD1         U1      30                      CGL002
     C                     SETOF                     91                   CGL002
      *                                                                   CGL002
      **  Determine if user is authorised to perform GL Account           CGL002
      **  Overrides in all cases                                          CGL002
      *                                                                   CGL002
     C                     CALL 'ZVACTBU'              90                 CGL002
     C                     PARM 'O'       WQ0012  1                       CGL002
     C                     PARM #1IBCA    WQ0013  3                       CGL002
     C           WUSPEC    PARM *ZERO     WQ0014  10                      CGL002
      *                                                                   CGL002
      **  Call to program ended in error                                  CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C                     MOVEL'Y2U0021' W0RTN   7                       CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Error Condition                                           CGL002
     C           WUSPEC    IFEQ 0                                         CGL002
     C                     MOVE 'Y'       WUAUTH  1                       CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'N'       WUAUTH                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Refer Debits:                                             CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'D'                                       CGL002
     C                     TESTB'0'       URRETI  1      90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C***********URRE01    IFNE 'Y'                                 CGL002158805
     C********** URRE01    IFEQ 'Y'                                                  158805 AR802562
     C           URRE01    IFNE 'Y'                                                         AR802562
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Refer Dr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSRD                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Refer Credits:                                            CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'C'                                       CGL002
     C                     TESTB'1'       URRETI         90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C***********URRE02    IFNE 'Y'                                 CGL002158805
     C********** URRE02    IFEQ 'Y'                                                  158805 AR802562
     C           URRE02    IFNE 'Y'                                                         AR802562
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Refer Cr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSRC                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Block Debits:                                             CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'D'                                       CGL002
     C                     TESTB'2'       URRETI         90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C***********URRE03    IFNE 'Y'                                 CGL002158805
     C********** URRE03    IFEQ 'Y'                                                  158805 AR802562
     C           URRE03    IFNE 'Y'                                                         AR802562
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Block Dr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSBD                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Block Credits:                                            CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'C'                                       CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C                     TESTB'3'       URRETI         90               CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C***********URRE04    IFNE 'Y'                                 CGL002158805
     C********** URRE04    IFEQ 'Y'                                                  158805 AR802562
     C           URRE04    IFNE 'Y'                                                         AR802562
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Block Cr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSBC                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  If there are any errors, setup non-overrideable error status    CGL002
      *                                                                   CGL002
     C           U1        IFGT 1                                         CGL002
     C           U1        IFLT 5                                         CGL002
     C                     MOVELURNORM    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE URERMG    URERTX                          CGL002
     C           *IN91     IFEQ '1'                                       CGL002
     C                     MOVE 'E'       URERST                          CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'O'       URERST                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Else, no errors found                                           CGL002
     C                     ELSE                                           CGL002
     C                     MOVE *BLANK    URERST                          CGL002
     C                     MOVE URDASH    URERTX 76                       CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     MOVE URSI90    *IN90                           CGL002
     C                     MOVE URSI91    *IN91                           CGL002
      *                                                                   CGL002
      *================================================================   CGL002
     CSR                   ENDSR                                          CGL002
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Set up Fields From templated record
      *================================================================
     C                     MOVELP1BTNB    #1BTNB           Batch number
     C***********          MOVELWUCACI    #RACID           Account Identif087770
     C***********          MOVELWUCCCD    #1CYCD           Currency code  087770
     C***********          MOVELWUCPAC    #1ACCD           Account code   087770
     C***********          MOVELWUCACS    #1ACSN           Account sequenc087770
     C***********          MOVELWUCBCA    #1IBCA           Input Branch Co087770
     C***********          MOVELWUCAMT    #RFMPA           Formatted Posti087770
     C***********          MOVELWUCDCI    #1DCIN           Debit/credit in087770
     C***********          MOVELWUCNAR    #RNRTV           Narrative      087770
     C***********          MOVELWUCTRT    #1TRTY           Transaction typ087770
     C***********          MOVELWUCCNB    #1CQNB           Cheque number  087770
     C***********          MOVELWUASSC    #RASCD           Associated Cust087770
     C***********          Z-ADDWUCVDN    #1VLDT           Value date     087770
     C***********          MOVELWUCVDT    #RVDDS           Value date (dis087770
     C***********          MOVELWUCSCR    #1SWCR           Swift common re087770
     C***********          MOVELWUCPRC    #1PRCN           Profit centre  087770
      * Start of S10736
     C***********          MOVELWUCTST    #1TSTY           Transaction (Su087770
     C***********          MOVELWUCBKC    #1BKCD           Book Code      087770
     C***********          MOVELWUCRVI    #1RVDI           Reverse/Void In087770
      * End of S10736
      *                                                                   087770
     C                     MOVELWZCACI    #RACID           Account Identif087770
     C                     MOVELWZCCCD    #1CYCD           Currency code  087770
     C                     MOVELWZCPAC    #1ACCD           Account code   087770
     C                     MOVELWZCACS    #1ACSN           Account sequenc087770
     C                     MOVELWZCBCA    #1IBCA           Input Branch Co087770
     C                     MOVELWZCAMT    #RFMPA           Formatted Posti087770
     C                     MOVELWZCDCI    #1DCIN           Debit/credit in087770
     C                     MOVELWZCNAR    #RNRTV           Narrative      087770
     C                     MOVELWZCTRT    #1TRTY           Transaction typ087770
     C                     MOVELWZCCNB    #1CQNB           Cheque number  087770
     C                     MOVELWZASSC    #RASCD           Associated Cust087770
     C                     Z-ADDWZCVDN    #1VLDT           Value date     087770
     C                     Z-ADDWZCVDN    #1PVDT           Prev VLDT      091729
     C                     MOVELWZCCCD    #1PCCY           Prev A/C ccy   091729
     C                     MOVELWZCVDT    #RVDDS           Value date (dis087770
     C                     MOVELWZCSCR    #1SWCR           Swift common re087770
     C                     MOVELWZCPRC    #1PRCN           Profit centre  087770
     C                     MOVELWZCTST    #1TSTY           Transaction (Su087770
     C                     MOVELWZCBKC    #1BKCD           Book Code      087770
     C                     MOVELWZCRVI    #1RVDI           Reverse/Void In087770
     C                     MOVELWZCOCY    #1OCCY           Original ccy   CEU013
     C                     MOVELWZCOAM    #RFMOA           Original amountCEU013
      *                                                                                       CGL013
      ** If CGL013 is installed                                                               CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C                     MOVEL'N'       #1ADIN                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MIR1                                           S01408
     C*                                                                   S01408
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Set up Default Fields
      *================================================================
     C                     MOVELP1BTNB    #1BTNB           Batch number
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELP2BICN    #RACID           Account Identif
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C                     MOVELBJLCCY    WULCCY
     C                     MOVELWULCCY    #1CYCD           Currency code
     C                     MOVEL*BLANK    #1ACCD           Account code
     C/COPY WNCPYSRC,GL0121MK51
     C                     MOVEL'01'      #1ACSN           Account sequenc
     C                     MOVELP1BCDA    #1IBCA           Input Branch Co
     C/COPY WNCPYSRC,GL0121MK52
     C                     MOVEL*BLANK    #1DCIN           Debit/credit in
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     MOVEL*BLANK    #1TRTY           Transaction typ
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     Z-ADDWURDNO    #1VLDT           Value date
     C                     Z-ADDWURDNO    #1PVDT           Prev VLDT      091729
     C                     MOVELWULCCY    #1PCCY           Prev A/C ccy   091729
     C                     MOVEL*BLANK    #RVDDS           Value date (dis
     C/COPY WNCPYSRC,GL0121MK80
     C                     MOVEL*BLANK    #1CQNB           Cheque number
     C                     MOVEL*BLANK    #RASCD           Associated Cust
     C                     MOVEL*BLANK    #1SWCR           Swift common re
     C                     MOVEL*BLANK    #1PRCN           Profit centre
     C                     MOVEL'N'       #1RNBE           Retail Number E
      * Start of S10736
     C                     MOVEL*BLANK    #1TSTY           Transaction (Su
     C                     MOVEL*BLANK    #1BKCD           Book Code
     C                     MOVEL*BLANK    #1RVDI           Reverse/Void In
      *                                                                                       CGL013
      ** If CGL013 is installed, initialize Additional Information field                      CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C                     MOVEL'N'       #1ADIN                                              CGL013
     C                     ENDIF                                                              CGL013
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MIR2                                           S01408
     C*                                                                   S01408
      * End of S10736
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Check Account Identifier
      *================================================================
      * Determine Account type - Standard functions  *
     C                     MOVEL#RACID    UKACID           10-Char.A/C ID
     C******               EXSR UKACCK                                    E17819
     C                     EXSR XXIN                                      E17819
     C                     MOVELUKTYPE    WUAISF           Account type
     C*SR***      UKACCK    BEGSR                                         E17819
      * CASE: WRK.Account ID Status Flag is Error
     C           WUAISF    IFEQ '*ERROR*'                  *IF
      * Start of Fix E17819
      * Setup message data for message
     C                     MOVEL#RACID    ZA0004           Account Identif
      * Send message 'Account ID not valid ERR'
     C                     MOVEL'GLX0119' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
      * End of Fix E17819
     C                     END                             *FI
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      * Check for Retail Account No
      *================================================================
      * CASE: WRK.Account ID Status Flag is Retail
     C           WUAISF    IFEQ '*RETAIL'                  *IF
      *     E18852  - Branch Code Of trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C*                                                                   099053
     C** Move blanks to parameter UUCUST (customer no) to ensure that     099053
     C** file ACCNTL1 (keyed on ACNO) will be used in chaining to a/c     099053
     C** details file, if the retail account number has been changed.     099053
     C*                                                                   099053
     C***********          MOVEL#1CUST    UUCUST                          099053
     C                     MOVEL*BLANK    UUCUST                          099053
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C/COPY WNCPYSRC,GL0121MC86
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0121MC57
     C*
     C* Assign work field to file field values.
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C           #1ACCD    IFNE *BLANKS                                   CEU013
     C                     MOVELA5ACTY    WUACTY           Account Type   CEU013
     C                     ELSE                                           CEU013
     C                     MOVEL#1ACTY    WUACTY           Account Type   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVEL*BLANKS   WUBPST           Account Sub-TypCEU013
     C                     MOVEL*BLANKS   WUACCS           Account Status CEU013
     C                     MOVE *ZEROS    WUDACO           Date Account OpCEU013
     C                     MOVE *ZEROS    WUDACC           Date Account CL143482
     C                     MOVEL*BLANKS   WUACNM           Account Name   CEU013
     C                     MOVEL#1RACN    WURACN           Retails AccountCEU013
     C                     MOVE *ZEROS    WURRNM           Relative rec NoCEU013
     C***********          MOVEL*BLANK    WURETB           Retail ICEU013 152295
     C                     BITOF'01234567'WURETB                          152295
     C                     MOVEL#1PRCN    WUPRFC           Profit Centre  CEU013
     C                     ELSE                                           CEU013
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELDACC      WUDACC           Date Account CL143482
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profir Centre  CAC001
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,GL0121MC58
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RACID    ZA0005           Account Identif
     C                     MOVEL#1CYCD    ZA0006           Currency code
     C                     MOVEL#1ACCD    ZA0007           Account code
     C                     MOVEL#1ACSN    ZA0008           Account sequenc
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0407' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     MOVEL#RACID    #1RACN                          CEU013
     C                     ELSE                                           CEU013
      *                                                                   073456
     C           P1MBRB    IFEQ 'N'                                       073456
      * Send message 'This A/C No. does not exist within this branch'     073456
     C                     MOVEL'GLX0144' ZAMSID                          073456
     C                     ELSE                                           073456
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     END                                            073456
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * E18437 Start
      * Check account number
     C                     EXSR UESUBR                     Check account n
      * CASE: WRK.Account status is Closed
     C           WUACCS    IFEQ 'C'                        *IF
      * CASE: WRK.Account AND DATE OF CLOSED ACCOUNT LOWEER THAN THE RUNDA143482
     C           WUDACC    ANDLTWURDNO                     *IF            143482
      * Setup message data for message
     C                     MOVEL#RACID    ZA0025           Account Identif
     C                     MOVEL#1CYCD    ZA0026           Currency code
     C                     MOVEL#1ACCD    ZA0027           Account code
     C                     MOVEL#1ACSN    ZA0028           Account sequenc
     C*                                                                   CEU013
     C* If switchable function CEU013 is installed, the batch is from     CEU013
     C*   external interface and the currency is an 'In' currency,        CEU013
     C*   the account is Retail or Nostro, then the                       CEU013
     C*   'account is closed' is converted as a warning.                  CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0409' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR                           CEU013
     C                     ELSE                                           CEU013
      * Send message 'Account is Closed'
     C                     MOVEL'GLX0126' ZAMSID
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     END                             *FI
      * CASE: WRK.Account status is flagged for closure                                       237508
     C           WUACCS    IFEQ 'C'                        *IF                                237508
      * CASE: WRK.Account AND DATE OF CLOSED ACCOUNT is equal to rundate                      237508
     C           WUDACC    ANDEQWURDNO                     *IF                                237508
      * Setup message data for message                                                        237508
     C                     MOVEL#RACID    ZA0025           Account Identif                    237508
     C                     MOVEL#1CYCD    ZA0026           Currency code                      237508
     C                     MOVEL#1ACCD    ZA0027           Account code                       237508
     C                     MOVEL#1ACSN    ZA0028           Account sequenc                    237508
      * Send message 'Account is flagged for closure'                                         237508
     C**********           MOVEL'GLX0427' ZAMSID                                     237508 AR782538
     C                     MOVEL'GLX0409' ZAMSID                                            AR782538
     C                     MOVE 'Y'       WWFLG                                               237508
     C                     EXSR ZASNMS                                                        237508
      *                                                                                       237508
     C                     END                             *FI                                237508
      * E18437 End
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         UESUBR    BEGSR
      *================================================================
      * Check account number
      *================================================================
     C                     MOVEL'N'       WURNIA           Ret / Nostro In
      * CASE: RCD.Currency code is Not blank
     C           #1CYCD    IFNE *BLANK                     *IF
      * CASE: RCD.Currency code NE WRK.Currency code
     C           #1CYCD    IFNE WUCYCD                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0009           Account Identif
     C                     MOVEL#1CYCD    ZA0010           Currency code
     C                     MOVEL#1ACCD    ZA0011           Account code
     C                     MOVEL#1ACSN    ZA0012           Account sequenc
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*    Over write the screen fields with Retail account details.      CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0407' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR                           CEU013
     C                     MOVEL'N'       WURNIA           Ret / Nostro InCEU013
     C                     ELSE                                           CEU013
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C*********************MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Account code is Not blank
     C           #1ACCD    IFNE *BLANK                     *IF
      * CASE: RCD.Account code NE WRK.Account code
     C           #1ACCD    IFNE WUACCD                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0013           Account Identif
     C                     MOVEL#1CYCD    ZA0014           Currency code
     C                     MOVEL#1ACCD    ZA0015           Account code
     C                     MOVEL#1ACSN    ZA0016           Account sequenc
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*    Over write the screen fields with Retail account details.      CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0407' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR                           CEU013
     C                     MOVEL'N'       WURNIA           Ret / Nostro InCEU013
     C                     ELSE                                           CEU013
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C*********************MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Account sequence number is Not blank
     C           #1ACSN    IFNE *BLANK                     *IF
      * CASE: RCD.Account sequence number NE WRK.Account sequence number
     C           #1ACSN    IFNE WUACSN                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0017           Account Identif
     C                     MOVEL#1CYCD    ZA0018           Currency code
     C                     MOVEL#1ACCD    ZA0019           Account code
     C                     MOVEL#1ACSN    ZA0020           Account sequenc
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*    Over write the screen fields with Retail account details.      CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0407' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR                           CEU013
     C                     MOVEL'N'       WURNIA           Ret / Nostro InCEU013
     C                     ELSE                                           CEU013
      *                                                                   073456
     C           P1MBRB    IFEQ 'N'                                       073456
      * Send message 'This A/C No. does not exist within this branch'     073456
     C                     MOVEL'GLX0144' ZAMSID                          073456
     C                     ELSE                                           073456
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     END                                            073456
     C                     MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C*********************MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * CASE: RCD.Input Branch Code - Alpha NE WRK.Input Branch Code - Alpha
     C           #1IBCA    IFNE WUIBCA                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0021           Account Identif
     C                     MOVEL#1CYCD    ZA0022           Currency code
     C                     MOVEL#1ACCD    ZA0023           Account code
     C                     MOVEL#1ACSN    ZA0024           Account sequenc
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*    Over write the screen fields with Retail account details.      CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0407' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR                           CEU013
     C                     MOVEL'N'       WURNIA           Ret / Nostro InCEU013
     C                     ELSE                                           CEU013
      *                                                                   073456
     C           P1MBRB    IFEQ 'N'                                       073456
      * Send message 'This A/C No. does not exist within this branch'     073456
     C                     MOVEL'GLX0144' ZAMSID                          073456
     C                     ELSE                                           073456
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     END                                            073456
     C                     MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C*********************MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.Ret / Nostro Inval Ac is No Error
     C           WURNIA    IFEQ 'N'                        *IF
     C                     Z-ADDWURACN    #1RACN           Retail account
     C                     MOVEL#1RACN    #RACID           Account Identif
      *                                                                   114000
      ** Check whether retail number is zero (non-retail account)         114000
      *                                                                   114000
     C           WURACN    IFNE 0                                         114000
     C                     MOVE *BLANKS   #RACID                          114000
     C                     MOVEL#1RACN    #RACID           Account Identif114000
     C                     MOVEL'Y'       #1RNBE           Retail Number E114000
     C                     ELSE                                           114000
     C                     MOVE *BLANKS   #RACID                          114000
     C                     MOVELWUCUST    #RACID           Account Identif114000
     C                     MOVEL'N'       #1RNBE           Retail Number E114000
     C                     END                                            114000
     C***********          MOVEL#1RACN    #RACID           Account Identif114000
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUIBCA    #1IBCA           Input Branch Co
     C                     MOVELWUACTY    #1ACTY           Account type
     C                     Z-ADDWURRNM    #1RRNM           Relative rec no
     C                     MOVEL'Y'       #1RNBE           Retail Number E
      * Save customer number for default profit centre processing in      071924
      * field WUCUS1                                                      071924
     C                     MOVELWUCUST    WUCUS1                          071924
     C                     END                             *FI
      *================================================================
     CSR         UEEXIT    ENDSR
      /EJECT
     CSR         UFSUBR    BEGSR
      *================================================================
      * Check for Nostro Account No
      *================================================================
      * CASE: WRK.Account ID Status Flag is Nostro
     C           WUAISF    IFEQ '*NOSTRO'                  *IF
      * Obtain nostro code - Standard functions  *
     C                     MOVEL#RACID    UXNOST  5        Nostro
     C                     MOVELUXNOST    #1CYCD           Nostro Ccy.
     C                     MOVE UXNOST    #1NNBI           Nostro No.
      * Access Nostro Details. - Nostro Details  *
     C*
     C* Set up Parameters for call to AONOSTR0
     C*
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACCD
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1NNBI    UUNONB
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Access Nostro Details file for the file fields
     C*
     C                     CALL 'AONOSTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCUST  6        I:Customer No.
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACCD  4        I:Account Code                     CGL029
     C                     PARM           UUACCD                                              CGL029
     C                     PARM           UUACSN  2        I:Account Seque
     C                     PARM           UUNONB  2        I:Nostro Number
     C                     PARM           UUBRCD  3        I:Branch Code
     C                     PARM *BLANK    UUCSSN 10        I:Cust ShortN  S01230
     C                     PARM *BLANK    UUPNOI  1        I:Prime Nost InS01230
     C           D@NOST    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1NNBI    WUNONB           Nostro Number  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL*BLANKS   WUNOSN           Nostro ShortnamCEU013
     C                     MOVEL*BLANKS   WUOANN           Our A/c Nost   CEU013
     C                     MOVEL*BLANKS   WUORAC           Our Rec A/c    CEU013
     C                     MOVEL*BLANKS   WUPNOI           Prime Nostro InCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C                     ELSE                                           CEU013
     C                     MOVELA7CYCD    WUCYCD           Currency Code
     C                     MOVELA7NONB    WUNONB           Nostro Number
     C                     MOVELA7ACCD    WUACCD           Account Code
     C                     MOVELA7CUST    WUCUST           Customer Number
     C                     MOVELA7ACSN    WUACSN           Account Sequenc
     C                     MOVELA7NOSN    WUNOSN           Nostro Shortnam
     C***********          MOVELA7OANN    WUOANN           Our A/c Nost                       210796
     C                     MOVELA7OACN    WUOANN           Our A/c Nost                       210796
     C                     MOVELA7ORAC    WUORAC           Our Rec A/c
     C                     MOVELA7PNOI    WUPNOI           Prime Nostro In
     C                     MOVELA7BRCD    WUIBCA           Branch Code
     C                     ENDIF                                          CEU013
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RACID    ZA0029           Account Identif
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*    Nost code not valid is changed as a warning.                   CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0410' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     ELSE                                           CEU013
      *                                                                   CEU013
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     9832  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * E18437 Start
      * E19627 - CCY ACOD CNUM & ASEQ changed to WRK fields from RCD fields
      * E18852  - Branch Code Of trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVELWUCUST    UUCUST
     C                     MOVELWUCYCD    UUCYCD
     C                     MOVELWUACCD    UUACNO
     C                     MOVELWUACSN    UUACSN
     C                     MOVELWUIBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C/COPY WNCPYSRC,GL0121MC87
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0121MC59
     C*
     C* Assign work field to file field values.
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C           #1ACCD    IFNE *BLANKS                                   CEU013
     C                     MOVELA5ACTY    WUACTY           Account Type   CEU013
     C                     ELSE                                           CEU013
     C                     MOVEL#1ACTY    WUACTY           Account Type   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVEL*BLANKS   WUBPST           Account Sub-TypCEU013
     C                     MOVEL*BLANKS   WUACCS           Account Status CEU013
     C                     MOVE *ZEROS    WUDACO           Date Account OpCEU013
     C                     MOVE *ZEROS    WUDACC           Date Account CL143482
     C                     MOVEL*BLANKS   WUACNM           Account Name   CEU013
     C                     MOVEL#1RACN    WURACN           Retails AccountCEU013
     C                     MOVE *ZEROS    WURRNM           Relative rec NoCEU013
     C***********          MOVEL*BLANK    WURETB           Retail ICEU013 152295
     C                     BITOF'01234567'WURETB                          152295
     C                     MOVEL#1PRCN    WUPRFC           Profit Centre  CEU013
     C                     ELSE                                           CEU013
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELDACC      WUDACC           Date Account CL143482
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,GL0121MC60
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C/COPY WNCPYSRC,GL0121MC61
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C/COPY WNCPYSRC,GL0121MC62
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RACID    ZA0030           Account Identif
     C                     MOVEL#1CYCD    ZA0031           Currency code
     C                     MOVEL#1ACCD    ZA0032           Account code
     C                     MOVEL#1ACSN    ZA0033           Account sequenc
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0407' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     ELSE                                           CEU013
      *                                                                   CEU013
      *                                                                   073456
     C           P1MBRB    IFEQ 'N'                                       073456
      * Send message 'This A/C No. does not exist within this branch'     073456
     C                     MOVEL'GLX0144' ZAMSID                          073456
     C                     ELSE                                           073456
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     END                                            073456
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Check Account Number
     C                     EXSR UGSUBR                     Check Account N
     C/COPY WNCPYSRC,GL0121MC63
      * CASE: WRK.Account status is Closed
     C           WUACCS    IFEQ 'C'                        *IF
      * CASE: WRK.Account AND DATE OF CLOSED ACCOUNT LOWEER THAN THE RUNDA143482
     C           WUDACC    ANDLTWURDNO                     *IF            143482
      * Setup message data for message
     C                     MOVEL#RACID    ZA0038           Account Identif
     C                     MOVEL#1CYCD    ZA0039           Currency code
     C                     MOVEL#1ACCD    ZA0040           Account code
     C                     MOVEL#1ACSN    ZA0041           Account sequenc
     C*                                                                   CEU013
     C* If switchable function CEU013 is installed, the batch is from     CEU013
     C*   external interface and the currency is an 'In' currency,        CEU013
     C*   the account is Retail or Nostro, then the                       CEU013
     C*   'account is closed' is converted as a warning.                  CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0409' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR                           CEU013
     C                     ELSE                                           CEU013
      * Send message 'Account is Closed'
     C                     MOVEL'GLX0126' ZAMSID
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     END                             *FI
      * CASE: WRK.Account status is flagged for closure                                       237508
     C           WUACCS    IFEQ 'C'                        *IF                                237508
      * CASE: WRK.Account AND DATE OF CLOSED ACCOUNT is equal to rundate                      237508
     C           WUDACC    ANDEQWURDNO                     *IF                                237508
      * Setup message data for message                                                        237508
     C                     MOVEL#RACID    ZA0038           Account Identi                     237508
     C                     MOVEL#1CYCD    ZA0039           Currency code                      237508
     C                     MOVEL#1ACCD    ZA0040           Account code                       237508
     C                     MOVEL#1ACSN    ZA0041           Account sequenc                    237508
      * Send message 'Account is flagged for Closure'                                         237508
     C**********           MOVEL'GLX0427' ZAMSID                                     237508 AR782538
     C                     MOVEL'GLX0409' ZAMSID                                            AR782538
     C                     MOVE 'Y'       WWFLG                                               237508
     C                     EXSR ZASNMS                                                        237508
      *                                                                                       237508
     C                     END                             *FI                                237508
     C/COPY WNCPYSRC,GL0121MC64
     C                     END                             *FI
      * E18437 End
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UFEXIT    ENDSR
      /EJECT
     CSR         UGSUBR    BEGSR
      *================================================================
      * Check Account Number
      *================================================================
      * Check Rest of Account Number
     C                     EXSR UHSUBR                     Check Rest of A
      * CASE: WRK.Ret / Nostro Inval Ac is No Error
     C           WURNIA    IFEQ 'N'                        *IF
      *                                                                   165092
     C           WUACTY    IFEQ 'R'                                       165092
     C           WURACN    ANDNE*ZERO                                     165092
     C                     MOVELWURACN    #1RACN                          165092
     C                     ENDIF                                          165092
      *                                                                   165092
     C                     MOVELWUACTY    #1ACTY           Account Type   165092
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUIBCA    #1IBCA           Input Branch Co
     C                     MOVELWUNNBI    #1NNBI           Nostro number (
      * Save customer number for default profit centre processing in      071924
      * field WUCUS1                                                      071924
     C                     MOVELWUCUST    WUCUS1                          071924
     C                     END                             *FI
      *================================================================
     CSR         UGEXIT    ENDSR
      /EJECT
     CSR         UHSUBR    BEGSR
      *================================================================
      * Check Rest of Account Number
      *================================================================
     C                     MOVEL'N'       WURNIA           Ret / Nostro In
      * CASE: RCD.Currency code is Not blank
     C           #1CYCD    IFNE *BLANK                     *IF
      * CASE: RCD.Currency code NE WRK.Currency code
     C           #1CYCD    IFNE WUCYCD                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0034           Account Identif
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*    Nost code not valid is changed as a warning.                   CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0410' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     MOVEL'N'       WURNIA           Ret / Nostro InCEU013
     C                     ELSE                                           CEU013
      *                                                                   CEU013
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     9832  *
      *
     C*********************MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Account code is Not blank
     C           #1ACCD    IFNE *BLANK                     *IF
      * CASE: RCD.Account code NE WRK.Account code
     C           #1ACCD    IFNE WUACCD                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0035           Account Identif
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*    Nost code not valid is changed as a warning.                   CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0410' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     MOVEL'N'       WURNIA           Ret / Nostro InCEU013
     C                     ELSE                                           CEU013
      *                                                                   CEU013
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     9832  *
      *
     C*********************MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Account sequence number is Not blank
     C           #1ACSN    IFNE *BLANK                     *IF
      * CASE: RCD.Account sequence number NE WRK.Account sequence number
     C           #1ACSN    IFNE WUACSN                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0036           Account Identif
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*    Nost code not valid is changed as a warning.                   CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0410' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     MOVEL'N'       WURNIA           Ret / Nostro InCEU013
     C                     ELSE                                           CEU013
      *                                                                   CEU013
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     9832  *
      *
     C*********************MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * CASE: RCD.Input Branch Code - Alpha NE WRK.Input Branch Code - Alpha
     C           #1IBCA    IFNE WUIBCA                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0037           Account Identif
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*    Nost code not valid is changed as a warning.                   CEU013
     C*                                                                   CEU013
     C           WP0008    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0410' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     MOVEL'N'       WURNIA           Ret / Nostro InCEU013
     C                     ELSE                                           CEU013
      *                                                                   CEU013
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     9832  *
      *
     C*********************MOVEL'Y'       WURNIA           Ret / Nostro InCEU013
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UHEXIT    ENDSR
      /EJECT
     CSR         UISUBR    BEGSR
      *================================================================
      * Reload screen fields
      *================================================================
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUIBCA    #1IBCA           Input Branch Co
     C                     MOVELWUACTY    #1ACTY           Account type
     C                     Z-ADDWURACN    #1RACN           Retail account
     C                     Z-ADDWURRNM    #1RRNM           Relative rec no
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     MOVEL'N'       #1RNBE           Retail Number E
      *================================================================
     CSR         UIEXIT    ENDSR
      /EJECT
     CSR         UJSUBR    BEGSR
      *================================================================
      * Obtain NOSTRO details
      *================================================================
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C/COPY WNCPYSRC,GL0121MC70
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0121MC65
     C*
     C* Assign work field to file field values.
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C           #1ACCD    IFNE *BLANKS                                   CEU013
     C                     MOVELA5ACTY    WUACTY           Account Type   CEU013
     C                     ELSE                                           CEU013
     C                     MOVEL#1ACTY    WUACTY           Account Type   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVEL*BLANKS   WUBPST           Account Sub-TypCEU013
     C                     MOVEL*BLANKS   WUACCS           Account Status CEU013
     C                     MOVE *ZEROS    WUDACO           Date Account OpCEU013
     C                     MOVE *ZEROS    WUDACC           Date Account CL143482
     C                     MOVEL*BLANKS   WUACNM           Account Name   CEU013
     C                     MOVEL#1RACN    WURACN           Retails AccountCEU013
     C                     MOVE *ZEROS    WURRNM           Relative rec NoCEU013
     C***********          MOVEL*BLANK    WURETB           Retail ICEU013 152295
     C                     BITOF'01234567'WURETB                          152295
     C                     MOVEL#1PRCN    WUPRFC           Profit Centre  CEU013
     C                     ELSE                                           CEU013
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELDACC      WUDACC           Date Account CL143482
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,GL0121MC19
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is *No Errors
     C           WUAPRC    IFEQ *BLANK                     *IF
      * Access Nostro Details. - Nostro Details  *
     C*
     C* Set up Parameters for call to AONOSTR0
     C*
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACCD
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1NNBI    UUNONB
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Access Nostro Details file for the file fields
     C*
     C                     CALL 'AONOSTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCUST  6        I:Customer No.
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACCD  4        I:Account Code                     CGL029
     C                     PARM           UUACCD                                              CGL029
     C                     PARM           UUACSN  2        I:Account Seque
     C                     PARM           UUNONB  2        I:Nostro Number
     C                     PARM           UUBRCD  3        I:Branch Code
     C                     PARM *BLANK    UUCSSN 10        I:Cust ShortN  S01230
     C                     PARM *BLANK    UUPNOI  1        I:Prime Nost InS01230
     C           D@NOST    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1NNBI    WUNONB           Nostro Number  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL*BLANKS   WUNOSN           Nostro ShortnamCEU013
     C                     MOVEL*BLANKS   WUOANN           Our A/c Nost   CEU013
     C                     MOVEL*BLANKS   WUORAC           Our Rec A/c    CEU013
     C                     MOVEL*BLANKS   WUPNOI           Prime Nostro InCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C                     ELSE                                           CEU013
     C                     MOVELA7CYCD    WUCYCD           Currency Code
     C                     MOVELA7NONB    WUNONB           Nostro Number
     C                     MOVELA7ACCD    WUACCD           Account Code
     C                     MOVELA7CUST    WUCUST           Customer Number
     C                     MOVELA7ACSN    WUACSN           Account Sequenc
     C                     MOVELA7NOSN    WUNOSN           Nostro Shortnam
     C***********          MOVELA7OANN    WUOANN           Our A/c Nost                       210796
     C                     MOVELA7OACN    WUOANN           Our A/c Nost                       210796
     C                     MOVELA7ORAC    WUORAC           Our Rec A/c
     C                     MOVELA7PNOI    WUPNOI           Prime Nostro In
     C                     MOVELA7BRCD    WUIBCA           Branch Code
     C                     ENDIF                                          CEU013
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL*BLANK    #1NNBI           Nostro number (
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUNONB    #1NNBI           Nostro number (
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UJEXIT    ENDSR
      /EJECT
     CSR         UKSUBR    BEGSR
      *================================================================
      * Check Users' Branch Authority
      *================================================================
      * Val. Action Cde & Bch U/P - Standard functions  *
     C/COPY WNCPYSRC,GL0121MK15
     C                     CALL 'ZVACTBU'              90  Val. Action Cde
     C**********           PARM 'A'       WQ0012  1        SPF Action Code                    189519
     C                     PARM P4SACD    WQ0012  1        SPF Action Code                    189519
     C                     PARM #1IBCA    WQ0013  3        Branch code
     C           WUSPEC    PARM *ZERO     WQ0014  10       SPF Error Condi
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.SPF Error Condition is One
     C           WUSPEC    IFEQ 1                          *IF
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0055           Input Branch Co
      * Send message 'SPF Atn Cde ERR 1 ZVACTBU'
     C                     MOVEL'GLX0186' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     ELSE
      * CASE: WRK.SPF Error Condition is Two
     C           WUSPEC    IFEQ 2                          *IF
      * Setup message data for message
     C**********           MOVEL'A'       ZA0056           SPF Action Code                    189519
     C                     MOVELP4SACD    ZA0056           SPF Action Code                    189519
     C                     MOVEL#1IBCA    ZA0057           Input Branch Co
      * Send message 'SPF Atn Cde ERR 5 ZVACTBU'
     C                     MOVEL'GLX0206' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UKEXIT    ENDSR
      /EJECT
     CSR         ULSUBR    BEGSR
      *================================================================
      * Check Posting amount
      *================================================================
      * CASE: RCD.Formatted Posting amount is Entered
     C           #RFMPA    IFNE *BLANK                     *IF
      * Get Number of Decimal Places
      * CASE: RCD.Currency code is Not Question Mark
     C           #1CYCD    IFNE '?'                        *IF
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
      * Set up No of Decimals and no of digits for ZALIGN
      * CASE: WRK.Number of Decimal Places is Zero
     C           WUNBDP    IFEQ *ZERO                      *IF
     C                     Z-ADD*ZERO     WUZNDE           ZALIGN No Of De
     C***********          Z-ADD12        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD13        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is One
     C           WUNBDP    IFEQ 1                          *IF
     C                     Z-ADD1         WUZNDE           ZALIGN No Of De
     C***********          Z-ADD11        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD12        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is Two
     C           WUNBDP    IFEQ 2                          *IF
     C                     Z-ADD2         WUZNDE           ZALIGN No Of De
     C***********          Z-ADD10        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD11        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is Three
     C           WUNBDP    IFEQ 3                          *IF
     C                     Z-ADD3         WUZNDE           ZALIGN No Of De
     C***********          Z-ADD9         WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD10        WUZNDI           ZALIGN No Of Di089856
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#RFMPA    WUZASF           ZALIGN Screen F
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0121MCP2                                           S01408
      *                                                                   S01408
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0015  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0016 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0017  10       ZALIGN No Of De
     C                     PARM WUZNDI    WQ0018  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0019 16        ZALIGN File Fie
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0121MCP3                                           S01408
      *                                                                   S01408
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0121MCP4                                           S01408
      *                                                                   S01408
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0020 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0021  10       ZALIGN No Of De
      *
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0121MCP3                                           S01408
      *                                                                   S01408
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0058           Formatted Posti
      * Send message 'Amount not valid'
     C                     MOVEL'GLX0063' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9837  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * MOVE Posting Amount - Journal Entry Posting  *
     C*  MOVE ZALIGN FILE FIELD INTO POSTING AMOUNT
     C                     MOVE WUZAFF    #1PTAM
      * Move Fmt Posting Amount - Journal Entry Posting  *
     C*  MOVE ZALIGN FUNCTION FIELD INTO FORMATTED POSTING AMOUNT
     C                     MOVE WUZASF    #RFMPA
      * CASE: RCD.Posting amount is LE Zero
     C           #1PTAM    IFLE *ZERO                      *IF
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0059           Formatted Posti
      * Send message 'Amount not valid'
     C                     MOVEL'GLX0063' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9837  *
      *
     C                     ELSE                                                               CGL014
      *                                                                                       CGL014
      ** Check if balance remaining due to all debits posted across                           CGL014
      ** retail accounts is sufficient to cover the blocked amount                            CGL014
      *                                                                                       CGL014
     C           CGL014    IFEQ 'Y'                                                           CGL014
     C           #1DCIN    ANDEQ'D'                                                           CGL014
     C           ATYP      ANDEQ'R'                                                           CGL014
     C           COLF      ANDEQ'Y'                                                           CGL014
     C                     Z-ADD#1PTAM    PTAMNT                                              CGL014
      *                                                                                       CGL014
     C                     CALL 'GL006000'                                                    CGL014
     C                     PARM           PTAMNT 150                                          CGL014
     C                     PARM WUCYCD    PTCCY   3                                           CGL014
     C                     PARM WUIBCA    PABRCA  3                                           CGL014
     C                     PARM WUCUST    PACNUM  6                                           CGL014
     C                     PARM WUCYCD    PACCY   3                                           CGL014
     C                     PARM WUACCD    PAACOD 10                                           CGL014
     C                     PARM WUACSN    PAACSQ  2                                           CGL014
     C                     PARM WURACN    PAACNO 100                                          CGL014
     C                     PARM *BLANKS   PRTCD   7                                           CGL014
      *                                                                                       CGL014
      ** Send error msg 'Available balance is not sufficient                                  CGL014
      ** to cover blocked amount'                                                             CGL014
      *                                                                                       CGL014
     C           PRTCD     IFEQ '*BLKERR'                                                     CGL014
     C                     MOVE *ON       *IN37                                               CGL014
     C                     MOVE *ON       *IN98                                               CGL014
     C                     MOVEL'GLX0423' ZAMSID                                              CGL014
     C                     EXSR ZASNMS                                                        CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
      ** Balance is greater than blocked amount but less than minimum                         CGL014
      ** balance, send warning msg 'Minimum balance will be exceeded'                         CGL014
      *                                                                                       CGL014
     C           PRTCD     IFEQ '*WARN  '                                                     CGL014
     C                     MOVE *ON       *IN37                                               CGL014
     C                     MOVE *ON       *IN98                                               CGL014
     C                     MOVEL'GLX0424' ZAMSID                                              CGL014
     C                     MOVE 'Y'       WWERR                                               CGL014
     C                     EXSR ZASNMS                                                        CGL014
     C                     MOVE *BLANK    WWERR                                               CGL014
     C                     ENDIF                                                              CGL014
     C                     ENDIF                                                              CGL014
      *                                                                                       CGL014
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MK24
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0060           Formatted Posti
      * Send message 'Posting amount is req'd'
     C                     MOVEL'GLX0215' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9837  *
      *
     C                     END                             *FI
      *================================================================
     CSR         ULEXIT    ENDSR
      /EJECT
     CSR         UMSUBR    BEGSR
      *================================================================
      * Check Narrative
      *================================================================
     C/COPY WNCPYSRC,GL0121MM14
     C                     MOVEL*BLANK    #1NVCD           Narrative code
     C                     MOVEL*BLANK    #1NRDC           Narrative descr
      * Check Narrative - Standard functions  *
     C*  Check Narrative for Narrative code
     C*
     C                     MOVE #RNRTV    URNARR 28        Narrative slice
     C/COPY WNCPYSRC,GL0121MM15
      *
     C           #RNRTV    IFNE *BLANK                     IF ¬BLANK
     C           URNARR    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*CODE  ' WUNRST             Code entered
     C                     MOVEL#RNRTV    #1NVCD             Narrative code
     C                     ELSE                            EL ¬BLANK
     C                     MOVE '*TEXT  ' WUNRST             Narrative text
     C                     MOVE *BLANK    #1NVCD             No Narr.code
     C                     END                             FI
     C                     ELSE                            EL BLANK
     C                     MOVE '*ERROR ' WUNRST             No narrative
     C                     MOVE *BLANK    #1NVCD             No Narr.code
     C                     END                             FI
      *
      * CASE: WRK.Narrative status is No narrative
     C           WUNRST    IFEQ '*ERROR'                   *IF
      * Setup message data for message
     C                     MOVEL#RNRTV    ZA0062           Narrative
     C/COPY WNCPYSRC,GL0121MM16
      * Send message 'No Narrative entered'
     C                     MOVEL'GLX0055' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     END                             *FI
      * CASE: WRK.Narrative status is Narrative code entered
     C           WUNRST    IFEQ '*CODE'                    *IF
      * Access Narrative. - Narrative Codes  *
     C*
     C*  Access Narrative codes file for the following fields
     C*  Narrative Code, Narrative Description
     C*
     C                     MOVEL#1NVCD    CHAR1   1                       079904
     C                     MOVEL#1NVCD    UUNVCD
     C                     CALL 'AONARRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUNVCD  2        I:Narrative Code
     C           D@NARR    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELALNVCD    #1NVCD           Narrative Code
     C                     MOVELALDON     WUDON            Description
     C*
      * E17610 Start
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RNRTV    ZA0063           Narrative
      * Send message 'Narrative Code not found'
     C                     MOVEL'GLX0049' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     ELSE
     C/COPY WNCPYSRC,GL0121MC03
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVEL#1NVCD    #RNRTV           Narrative
      * If question mark routine was called then keep record on screen    079904
      * in add mode.                                                      079904
     C           CHAR1     IFEQ '?'                                       079904
     C                     SETON                     98                   079904
     C                     END                                            079904
     C                     END                             *FI
      * E17610 End
     C                     ELSE
      * CASE: *OTHERWISE
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0121MCP5                                           S01408
      *                                                                   S01408
     C                     MOVEL#RNRTV    #1NRDC           Narrative descr
     C/COPY WNCPYSRC,GL0121MM17
     C                     END                             *FI
      *================================================================
     CSR         UMEXIT    ENDSR
      /EJECT
     CSR         UNSUBR    BEGSR
      *================================================================
      * Check Retail/Non-Retail fields
      *================================================================
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
     C/COPY WNCPYSRC,GL0121MC09
      * Check Transaction Type
      * CASE: RCD.Transaction type is Entered
     C           #1TRTY    IFNE *BLANK                     *IF
      * S10736 Start
      * CASE: RCD.Transaction type is Select Request
     C           #1TRTY    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * S10736 End
     C*                                                                   099191
     C** If entry is Retail, move Rundate to value date field for         099191
     C** update if display field is blank.                                099191
     C*                                                                   099191
     C           #RVDDS    IFEQ *BLANKS                                   099191
     C/COPY WNCPYSRC,GL0121MC82
     C                     MOVE WURDNO    #1VLDT                          099191
     C/COPY WNCPYSRC,GL0121MC83
     C                     END                                            099191
     C*                                                                   099191
      * Access Retail Transact. - Retail Transaction Types  *
     C*
     C*  Access Retail Transaction types for the file fields
     C*
     C                     MOVEL#1TRTY    UURTTY
     C                     CALL 'AORETRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UURTTY  5        I:Retail Tran Type
     C           D@RETR    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA1RTTY    WUTRTY           Retail Transaction Ty
     C                     MOVELA1RTNM    WURTNM           Retail Tran Name
     C                     MOVELA1COIN    WUCOIN           Cust Originated Ind
     C                     MOVELA1DCIN    WUDCIN           Debit/Credit Ind
     C                     MOVELA1RVIN    WURVIN           Reversal Indicator
     C                     MOVELA1PADI    WUPADI           Print Advices Ind
     C                     MOVELWUCOIN    #1COIN                          105384
     C*
      * E19950 Start
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C**Start*of*S10736**************                                     076566
     C**CASE:*RCD.Transaction*(Sub*-*Type) is Entered                     076566
     C***********#1TSTY    IFNE *BLANK                     *IF            074778
     C***********          ELSE                                           074778
     C**CASE:*RCD.Book*Code is Entered                                    076566
     C***********#1BKCD    IFNE *BLANK                     *IF            074778
     C***********          ELSE                                           074778
     C**CASE:*RCD.Profit*centre*is*Entered                                076566
     C***********#1PRCN    IFNE *BLANK                     *IF            074778
     C***********          ELSE                                           074778
     C**CASE:*RCD.Reverse/Void*Indicator is Void                          076566
     C***********#1RVDI    IFEQ 'Y'                        *IF            074778
     C***********          ELSE                                           074778
     C**CASE:**OTHERWISE*************                                     076566
     C**End*of*S10736****************                                     076566
      *                                                                   082162
      **If*the*Management*Accounts*module*is*not*present            082162CEU013
      * If the Management Accounts module is not present                  082162
     C           BGNVST    IFNE 'Y'                                       082162
      *                                                                   076566
      * Validate the Trans Type against other modules Trans Type          076566
      *   Master files.                                                   076566
     C                     MOVE *OFF      *IN55                           076566
      *                                                                   076566
     C           #1TSTY    IFNE *BLANK                                    076566
     C           #1BKCD    ORNE *BLANK                                    076566
     C           #1PRCN    ORNE *BLANK                                    076566
     C           #1RVDI    OREQ 'Y'                                       076566
     C                     EXSR TRANSV                                    076566
     C                     ELSE                                           076566
     C                     MOVE *ON       *IN55                           076566
     C                     ENDIF                                          076566
     C*                                                                   076566
     C* ERROR= Trans Type not on any one of the Trans Typ Masters.        076566
     C           *IN55     IFEQ *ON                                       076566
      * Setup message data for message
     C                     MOVEL#1TRTY    ZA0064           Transaction typ
      * Send message 'Trans. type not valid'
     C                     MOVEL'GLX0059' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9840  *
     C                     END                                            082162
     C*                                                                   076566
     C                     ENDIF                                          076566
     C**Start*of*S10736**************                                     076566
     C***********BGNVST    IFNE 'Y'                                 082162CEU013
      **Setup*message*data*for*message                                    CEU013
     C***********          MOVEL#1TRTY    ZA0064           Transaction typCEU013
      **Send*message*'Trans.*type*not*valid'                              CEU013
     C***********          MOVEL'GLX0059' ZAMSID                          CEU013
     C***********          EXSR ZASNMS                                    CEU013
     C***********          SETON                     9840  *              CEU013
     C***********          END                                      082162CEU013
      ***********
      * Start of S10736
     C***********          END                             *FI            074778
     C***********          END                             *FI            074778
     C***********          END                             *FI            074778
     C***********          END                             *FI            074778
     C**End*of*S10736****************                                     076566
      *                                                                   082162
      * If the Management Accounts module is present                      082162
     C           BGNVST    IFEQ 'Y'                                       082162
     C           CEU013    IFEQ 'Y'                                       CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1TRTY    ZA0064           Transaction typCEU013
      * Send message 'Trans. type not valid'                              CEU013
     C                     MOVEL'GLX0059' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9840  *              CEU013
     C                     ELSE                                           CEU013
     C           WUAPRC    IFNE *BLANKS                                                       195961
      *                                                                                       195961
      ** Setup message data for message                                                       195961
      *                                                                                       195961
     C                     MOVEL#1TRTY    ZA0064           Transaction type                   195961
      *                                                                                       195961
      ** Send message 'Trans. type not valid'                                                 195961
      *                                                                                       195961
     C                     MOVEL'GLX0059' ZAMSID                                              195961
     C                     EXSR ZASNMS                                                        195961
     C                     MOVE '1'       *IN98                                               195961
     C                     MOVE '1'       *IN40                                               195961
      * CASE: RCD.Transaction (Sub - Type) is Entered                     082162
     C           #1TSTY    IFNE *BLANK                                    082162
      *                                                                                       195961
      ** Setup message data for message                                                       195961
      *                                                                                       195961
     C                     MOVEL#1TSTY    ZA0092           Transaction type                   195961
      *                                                                                       195961
      ** Send message 'Trans. Sub-type must be blank'                                         195961
      *                                                                                       195961
     C                     MOVEL'GLX0418' ZAMSID                                              195961
     C                     EXSR ZASNMS                                                        195961
     C                     MOVE '1'       *IN98                                               195961
     C                     MOVE '1'       *IN40                                               195961
     C                     ELSE                                           082162
      * CASE: RCD.Book Code is Entered                                    082162
     C           #1BKCD    IFNE *BLANK                                    082162
     C                     ELSE                                           082162
      * CASE: RCD.Profit centre is Entered                                082162
     C           #1PRCN    IFNE *BLANK                                    082162
     C                     ELSE                                           082162
      * CASE: RCD.Reverse/Void Indicator is Void                          082162
     C           #1RVDI    IFEQ 'Y'                                       082162
     C                     ELSE                                           082162
      * CASE: *OTHERWISE                                                  082162
      *                                                                   082162
      * Setup message data for message                                    082162
     C                     MOVEL#1TRTY    ZA0064           Transaction typ082162
      * Send message 'Trans. type not valid'                              082162
     C                     MOVEL'GLX0059' ZAMSID                          082162
     C                     EXSR ZASNMS                                    082162
     C                     SETON                     9840  *              082162
      *                                                                   082162
     C                     END                                            082162
     C                     END                                            082162
     C                     END                                            082162
     C                     END                                            082162
     C                     END                                                                195961
     C                     ENDIF                                          CEU013
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MC13                                           S01408
     C*                                                                   S01408
      *                                                                   CEU013
      * If the Management Accounts module is not present                  CEU013
     C                     ELSE                                           CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1TRTY    ZA0064           Transaction typCEU013
      * Send message 'Trans. type not valid'                              CEU013
     C                     MOVEL'GLX0059' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9840  *              CEU013
     C                     END                                            082162
      *                                                                   082162
     C                     ELSE
      * CASE: *OTHERWISE
      *                                                                                       195961
      ** CASE: RCD.Transaction (Sub - Type) is Entered                                        195961
      *                                                                                       195961
     C           #1TSTY    IFNE *BLANK                                                        195961
      *                                                                                       195961
      ** Setup message data for message                                                       195961
      *                                                                                       195961
     C                     MOVEL#1TSTY    ZA0092           Transaction type                   195961
      *                                                                                       195961
      ** Send message 'Trans. Sub-type must be blank'                                         195961
      *                                                                                       195961
     C                     MOVEL'GLX0418' ZAMSID                                              195961
     C                     EXSR ZASNMS                                                        195961
     C                     MOVE '1'       *IN98                                               195961
     C                     MOVE '1'       *IN41                                               195961
     C                     ELSE                                                               195961
     C                     MOVELWUTRTY    #1TRTY           Transaction typ
     C                     MOVELWUCOIN    #1COIN                          086290
     C                     END                                                                195961
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MC14                                           S01408
     C*                                                                   S01408
      * Check Cr/Dr of transaction type
      * CASE: WRK.Debit/credit indicator is Blank
     C           WUDCIN    IFEQ *BLANK                     *IF
     C           BGNVST    IFEQ 'Y'                                                           195961
     C           #1TSTY    IFNE *BLANKS                                                       195961
      *                                                                                       195961
      ** Setup message data for message                                                       195961
      *                                                                                       195961
     C                     MOVEL#1TSTY    ZA0064           Transaction type                   195961
      *                                                                                       195961
      ** Send message 'Trans. type not valid'                                                 195961
      *                                                                                       195961
     C                     MOVEL'GLX0059' ZAMSID                                              195961
     C                     EXSR ZASNMS                                                        195961
     C                     MOVE '1'       *IN98                                               195961
     C                     MOVE '1'       *IN41                                               195961
     C                     END                                                                195961
     C                     END                                                                195961
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Debit/credit indicator NE RCD.Debit/credit indicator
     C           WUDCIN    IFNE #1DCIN                     *IF
      * Setup message data for message
     C                     MOVEL#1TRTY    ZA0065           Transaction typ
      * Send message 'Trans. type not right D/C'
     C                     MOVEL'GLX0157' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9840  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * E19950 End
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1TRTY    ZA0066           Transaction typ
      * Send message 'Must enter Trans Type'
     C                     MOVEL'GLX0107' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9840  *
      *
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MC15
      * Check Overrideable Retail errors
     C                     EXSR UOSUBR                     Check Overridea
     C/COPY WNCPYSRC,GL0121MC34
      * ==================                                                085175
      *  Restore Value Date (display) if blanked out -                    085175
      *   default the Value Date to the Posting Date                      085175
     C           #RVDDS    IFEQ *BLANK                                    085175
     C/COPY WNCPYSRC,GL0121MK32
     C                     Z-ADD#1PTDT    #1VLDT           Value date     085175
     C                     Z-ADD#1PTDT    #1PVDT           Prev VLDT      091729
     C/COPY WNCPYSRC,GL0121MC84
      *                                                                   085175
      * Midas Conv. Day to Date - Standard functions  *                   085175
     C                     CALL 'ZDATE2'               90  Midas Conv. Day085175
     C                     PARM #1VLDT    WQ0054  50       Value date     085175
     C                     PARM WUDTFF    WQ0055  1        Date Format fla085175
     C           WUDTNF    PARM *ZERO     WQ0056  60       Date (numeric) 085175
     C           WUDDCD    PARM *BLANK    WQ0057  7        Date Julian    085175
     C           *IN90     IFEQ '1'                                       085175
      * Call to program ended in error                                    085175
     C                     MOVEL'Y2U0021' W0RTN   7                       085175
     C                     END                                            085175
      *                                                                   085175
      * Copy Num to VDate Display - Standard functions  *                 085175
     C                     Z-ADDWUDTNF    UUDNMA                          085175
     C                     MOVE UUDNMA    #RVDDS                          085175
     C/COPY WNCPYSRC,GL0121MK33
     C                     END                                            085175
      *                                                                   085175
      * Check Value Date
     C/COPY WNCPYSRC,GL0121MK27
      * CASE: RCD.Value date (display) is Date entered
     C           #RVDDS    IFNE *BLANK                     *IF
     C/COPY WNCPYSRC,GL0121MK28
     C                     MOVEL#RVDDS    WUWVDD           Work Value Date
      * Check VDate Blank Entries - Standard functions  *
     C                     CALL 'GL0131U'              90  Check VDate Bla
     C           WUWVDD    PARM WUWVDD    WQ0027  6        Value date (dis
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Check Numeric - Standard functions  *
     C                     MOVE *IN20     UUIN20  1
     C                     MOVE *IN21     UUIN21  1
     C           *LIKE     DEFN WUWVDD    UUVLDT+ 1
     C                     MOVELWUWVDD    UUVLDT
     C                     MOVE '0'       UUVLDT
     C                     TESTN          UUVLDT       21
     C           *IN21     IFEQ '1'
     C                     MOVEL'0'       UUVLDT
     C                     END
     C                     TESTN          UUVLDT     20
     C           *IN20     IFEQ '0'
     C                     MOVE '*NUMERR' W0RTN
     C                     ELSE
     C                     MOVE *BLANKS   W0RTN
     C                     END
     C                     MOVE UUIN20    *IN20
     C                     MOVE UUIN21    *IN21
      * CASE: PGM.*Return code is *Numeric Error
     C           W0RTN     IFEQ '*NUMERR'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0076           Value date (dis
      * Send message 'Value Date not valid 1'
     C                     MOVEL'GLX0109' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * CASE: WRK.Date (numeric format) is Gt 30
     C           WUDTNF    IFGT 30                         *IF
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0028  7        *Return code
     C                     PARM WUDTNF    WQ0029  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0030  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0031  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0077           Value date (dis
      * Send message 'Value Date not valid 2'
     C                     MOVEL'GLX0110' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C/COPY WNCPYSRC,GL0121MK39
     C                     MOVELWUWVDD    #RVDDS           Value date (dis
     C/COPY WNCPYSRC,GL0121MK40
      *                                                                   091729
     C           #1VLDT    IFNE #1PVDT                                    091729
     C           #1CYCD    ORNE #1PCCY                                    091729
      *                                                                   091729
      ** Check Value Date NE Hol. - Standard functions                    091729
      * A/C LOCATION                                                      091729
     C**********           CALL 'AOBRCHR0'                                             091729 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    091729
     C                     PARM '*KEY'    UUAPOP  7        I:Option       091729
     C                     PARM #1IBCA    UUBRCD  3        I:Branch Code  091729
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                    091729 CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*                                                                   091729
     C* A8LCCD = O:Location Code                                          091729
     C*                                                                   091729
     C                     CALL 'GL0130U'              90  Check Value Dat091729
     C                     PARM #1VLDT    WQ0032  50       Value date     091729
     C                     PARM #1CYCD    WQ0033  3        Acc Currency   091729
     C                     PARM A8LCCD    WQ0034  3        Acc Location   091729
     C           WUJJST    PARM *BLANK    WQ0035  1        Error Ind - Day091729
      *                                                                   091729
     C           *IN90     IFEQ '1'                                       091729
      ** Call to program ended in error                                   091729
     C                     MOVEL'Y2U0021' W0RTN   7                       091729
     C                     ENDIF                                          091729
      *                                                                   091729
      ** Error Ind = 'H' Holiday day   ('W' = working day)                091729
     C           WUJJST    IFEQ 'H'                                       091729
      * Setup message data for message GLX0397                            091729
      *   'Warning: Date entered: &1 is a Holiday in &2/&3'               091729
     C                     MOVEL#RVDDS    ZA0144           Value date (6) 091729
     C                     MOVE #1CYCD    ZA0145           Acc CCY        091729
     C                     MOVE A8LCCD    ZA0146           Acc Location   091729
     C                     MOVE 'Y'       WWERR                                             BUG26846
      * Send msg                                                          091729
     C                     MOVEL'GLX0397' ZAMSID                          091729
     C                     EXSR ZASNMS                                    091729
     C                     MOVE *ON       *IN98                           091729
     C                     MOVE *ON       *IN42                           091729
     C                     MOVE *BLANKS   WWERR                                             BUG26846
     C                     ENDIF                                          091729
     C                     ENDIF                                          091729
      *                                                                   091729
      * Re-set Previous Value Date values                                 091729
     C                     Z-ADD#1VLDT    #1PVDT           Prev VLDT      091729
     C                     MOVEL#1CYCD    #1PCCY           Prev A/C ccy   091729
      *                                                                   091729
     C/COPY WNCPYSRC,GL0121MC77
      * CASE: RCD.Value date GE WRK.Runday Number
     C           #1VLDT    IFGE WURDNO                     *IF
      * START - E19779
      * Validation of Forward Date - REMOVED -
      * END - E19779
      * CASE: RCD.Value date GT WRK.Forward Day Number
     C           #1VLDT    IFGT WUFDNB                     *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0078           Value date (dis
      * Send message 'Value Date not valid 3'
     C                     MOVEL'GLX0111' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      *******************************                                     091729
      **Check*Value*Date*NE*Hol.*-*Standard functions  *                  091729
     C*********************CALL*'GL0130U'              90  Check Value Dat091729
     C*********************PARM*#1VLDT    WQ0032  50       Value date     091729
     C*********************PARM*WULCCY    WQ0033  3        Local Currency 091729
     C*********************PARM*WULCCD    WQ0034  3        Location Code  091729
     C***********WUJJST****PARM**BLANK    WQ0035  1        Error Ind - Day091729
      *******************************                                     091729
     C************IN90*****IFEQ*'1'**                                     091729
      **Call*to*program*ended*in*error                                    091729
     C*********************MOVEL'Y2U0021' W0RTN   7                       091729
     C*********************END*******                                     091729
      *******************************                                     091729
      **CASE:*WRK.Error*Ind*-*Day*-*Holiday is Record Found               091729
     C***********WUJJST****IFEQ*'H'**                      *IF            091729
      **Setup*message*data*for*message                                    091729
     C*********************MOVEL#RVDDS    ZA0079           Value date (dis091729
      **Send*message*'Value*Date*Not*Valid 9'                             091729
     C*********************MOVEL'GLX0117' ZAMSID                          091729
     C*********************EXSR*ZASNMS                                    091729
     C*********************SETON*****                9842  *              091729
      *******************************                                     091729
     C*********************END*******                      *FI            091729
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MC78
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    #RVDDS           Value date (dis
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C                     MOVELBJLCCY    WULCCY
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVELP1BCDA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE #RVDDS    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Locate Local.CCY.Fwd.Days - Standard functions  *
     C                     CALL 'SZDATE3'              90  Locate Local.CC
     C                     PARM WURDNO    WQ0036  50       Runday Number
     C                     PARM WULCCY    WQ0037  3        Local Currency
     C                     PARM WULCCD    WQ0038  3        Location Code
     C                     PARM WUDTNF    WQ0039  20       Number of Forwa
     C           WUFDNB    PARM *ZERO     WQ0040  50       Forward Day Num
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM WUFDNB    WQ0041  50       Runday Number
     C                     PARM WUDTFF    WQ0042  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0043  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0044  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    #RVDDS
     C                     END                             *FI
      *                                            START  E17913 18/04/89
      * Error caused Value date to be interpreted as before A/C open date
      * mov disp VDate to Vdate - Standard functions  *   (Deleted code)
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE #RVDDS    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           W0RTN     PARM W0RTN     WQ0045  7        *Return code
     C                     PARM WUDTNF    WQ0046  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0047  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0048  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      *                                            END    E17913 18/04/89
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Invalid Date - Do no further date validation
     C                     ELSE
      * CASE: *OTHERWISE
      * Value Date A/c Validation - Standard functions  *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANK    P@RTCD  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option
     C                     PARM '*FIRST'  P@OPTN  7        I:Option
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C* Set Retail Key = Numeric Retail Account Number
     C                     MOVEL#1RACN    P@RETK 10
     C*
     C/COPY WNCPYSRC,GL0121MC26
     C                     CALL 'AOACCTR0'
     C                     PARM *BLANK    P@RTCD  7        B:Return code
     C                     PARM '*KEY'    P@OPTN  7        I:Option
     C*********************PARM #IRACN    P@RETK 10        I:Key field
     C                     PARM           P@RETK           I:Key field
     C                     PARM #1CUST    P@CNUM  6        I:Key field
     C                     PARM #1CYCD    P@CCY   3        I:Key field
     C**********           PARM #1ACCD    P@ACOD  4        I:Key field                        CGL029
     C                     PARM #1ACCD    P@ACOD 10                                           CGL029
     C                     PARM #1ACSN    P@ACSQ  2        I:Key field
     C                     PARM #1IBCA    P@IBCA  3        I:Key Field
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0121MC27
     C*
     C* EXTRACT BACK VALUEING PERIOD & CALCULATE BACK VALUE DATE
     C*
     C           WURDNO    SUB  BJBVPD    UUBRUN  50
     C*                                                                   CEU013
     C* If CEU013 switchable function is installed, the batch is from     CEU013
     C*   external interface, account currency is an 'In' currency,       CEU013
     C*   account code type is Retail and the account is not found,       CEU013
     C*   the tests on account dates are skipped.  Account not found      CEU013
     C*   is not an error and only a warning.                             CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WP0008    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           P@RTCD    ANDNE*BLANKS                                   CEU013
     C/COPY WNCPYSRC,GL0121MK62
     C                     ELSE                                           CEU013
     C*                                                                   CEU013
     C*
     C* SAVE INDICATORS
     C*
     C                     MOVE *IN33     UUIN33  10
     C                     MOVE *IN64     UUIN64  10
     C                     MOVE *IN69     UUIN69  10
     C*
     C                     SETOF                     336469
     C*
     C** DR/CR INT.BEARING
     C*
     C***********AADRIF****IFEQ ' '                         IF 1          S01117
     C           DRIF      IFEQ ' '                         IF 1          S01117
     C***********AACRIF****ANDEQ' '                                       S01117
     C           CRIF      ANDEQ' '                                       S01117
     C***********AALDID****COMP AALCID               64                   S01117
     C           LDID      COMP LCID                 64                   S01117
     C***64******UUBRUN****COMP AALDID                 69                 S01117
     C   64      UUBRUN    COMP LDID                   69                 S01117
     C**N64******UUBRUN****COMP AALCID                 69                 S01117
     C  N64      UUBRUN    COMP LCID                   69                 S01117
     C*
     C   69      #1VLDT    COMP UUBRUN                 33
     C***64N69***#1VLDT****COMP AALDID                 3333               S01117
     C   64N69   #1VLDT    COMP LDID                   3333               S01117
     C**N64N69***#1VLDT****COMP AALCID                 3333               S01117
     C  N64N69   #1VLDT    COMP LCID                   3333               S01117
     C   33                MOVE '*DRCRER' W0RTN
     C                     ELSE                              ELSE 1
     C*
     C** CR INT BEARING ONLY
     C*
     C***********AADRIF****IFEQ ' '                          IF 2         S01117
     C           DRIF      IFEQ ' '                          IF 2         S01117
     C***********AALCID****COMP UUBRUN               64                   S01117
     C           LCID      COMP UUBRUN               64                   S01117
     C      64   #1VLDT    COMP UUBRUN                 33
     C*****N64***#1VLDT****COMP AALCID                 3333               S01117
     C     N64   #1VLDT    COMP LCID                   3333               S01117
     C   33                MOVE '*DTCRER' W0RTN
     C                     ELSE                              ELSE 2
     C*
     C** DR INT.BEARING ONLY
     C*
     C***********AACRIF****IFEQ ' '                          IF 3         S01117
     C           CRIF      IFEQ ' '                          IF 3         S01117
     C***********AALDID****COMP UUBRUN               64                   S01117
     C           LDID      COMP UUBRUN               64                   S01117
     C      64   #1VLDT    COMP UUBRUN                 33
     C*****N64***#1VLDT****COMP AALDID                 3333               S01117
     C     N64   #1VLDT    COMP LDID                   3333               S01117
     C   33                MOVE '*DTDRER' W0RTN
     C                     ELSE                              ELSE 3
     C*
     C**   NOT INT.BEARING
     C*
     C           #1VLDT    COMP UUBRUN                 33
     C   33                MOVE '*BVLDER' W0RTN
     C                     END                               END 3
     C                     END                               END 2
     C                     END                               END 1
     C/COPY WNCPYSRC,GL0121MC20
     C*
     C**   CHECK AGAINST DATE THE ACCOUNT WAS OPENED
     C*
     C           DACO      IFGT #1VLDT                       IF 1
     C                     MOVE '*DTOPER' W0RTN
     C                     END                               END 1
     C/COPY WNCPYSRC,GL0121MC21
     C*
     C* RESTORE INDICATORS
     C*
     C                     MOVE UUIN33    *IN33
     C                     MOVE UUIN64    *IN64
     C                     MOVE UUIN69    *IN69
      * CASE: PGM.*Return code is Value Date Before Ac Open
     C           W0RTN     IFEQ '*DTOPER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0080           Value date (dis
      * Send message 'Value Date not valid 4'
     C                     MOVEL'GLX0112' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef Back Value Date
     C           W0RTN     IFEQ '*BVLDER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0081           Value date (dis
      * Send message 'Value Date not valid 5'
     C                     MOVEL'GLX0113' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Before Last CR Int
     C           W0RTN     IFEQ '*DTCRER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0082           Value date (dis
      * Send message 'Value Date Not Valid 6'
     C                     MOVEL'GLX0114' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Before Last DR Int
     C           W0RTN     IFEQ '*DTDRER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0083           Value date (dis
      * Send message 'Value Date Not Valid 7'
     C                     MOVEL'GLX0115' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef. Last CR/DR Int
     C           W0RTN     IFEQ '*DRCRER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0084           Value date (dis
      * Send message 'Value Date Not Valid 8'
     C                     MOVEL'GLX0116' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
     C                     ENDIF                                          CEU013
     C                     END                             *FI
      *                                            START  E17913 18/04/89
      * Copy VDate Display To Num - Standard functions  *  (Deleted code)
      * Midas Conv. Date to Day - Standard functions  *    (Deleted code)
      *                                            END    E17913 18/04/89
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      *                                                                   CGL002
      **  If Block GL Accounts Enhancement feature is switched on         CGL002
      **  and account type is GL, check overrideable GL errors            CGL002
      *                                                                   CGL002
     C           CGL002    IFEQ 'Y'                                       CGL002
     C           WUACTY    ANDEQ'G'                                       CGL002
     C                     EXSR SRGLOV                                    CGL002
     C                     ELSE                                           CGL002
      *                                                                   CGL002
      * Reset Retail Error Indicators
     C                     EXSR UPSUBR                     Reset Retail Er
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C/COPY WNCPYSRC,GL0121MC41
      * Check Cheque Number is blank
      * CASE: RCD.Cheque number is Entered
     C           #1CQNB    IFNE *BLANK                     *IF
     C/COPY WNCPYSRC,GL0121MK25
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0085           Cheque number
      * Send message 'Cheque No. must be blank'
     C                     MOVEL'GLX0062' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9843  *
      *
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MK26
      *                                                                   127209
      ** On entries to non-retail accounts, do not accept '?' in the      127209
      **    transaction type field.                                       127209
      *                                                                   127209
     C           #1TRTY    IFEQ '?'                                       127209
      * Setup message data for message                                    127209
     C                     MOVEL#1TRTY    ZA0092           Cheque number  127209
      * Send message 'Prompt is not avalilable for non-retail accounts'   127209
     C                     MOVEL'GLX0998' ZAMSID                          127209
     C                     EXSR ZASNMS                                    127209
     C                     SETON                     9840  *              127209
     C                     ELSE                                           127209
      *                                                                   074778
     C/COPY WNCPYSRC,GL0121MM18
      * Check Transaction Type is blank for non-retail account            074778
      * (only if the Management Accounts module is not present)           082162
     C           #1TRTY    IFNE *BLANK                     *IF            074778
     C           BGNVST    ANDNE'Y'                                       082162
     C* This is made as an error on par with GL0123R and GL0122D.         CEU013
      ** Transaction type checking reversed out for Management Accounts   152205
      ** users.                                                           152205
     C***********#1TRTY    ORNE *BLANKS                            CEU013 152205
     C***********CEU013    ANDEQ'Y'                                CEU013 152205
     C/COPY WNCPYSRC,GL0121MK05
      * Setup message data for message                                    074778
     C                     MOVEL#1TRTY    ZA0092           Cheque number  074778
      * Send message 'Transaction type must be blank'                     074778
     C                     MOVEL'GLX0061' ZAMSID                          074778
     C                     EXSR ZASNMS                                    074778
     C                     SETON                     9840  *              074778
     C                     ELSE                                                               195961
     C           BGNVST    IFEQ 'Y'                                                           195961
     C           #1TRTY    IFEQ *BLANKS                                                       195961
     C           #1TSTY    IFNE *BLANKS                                                       195961
      *                                                                                       195961
      ** Setup message data for message                                                       195961
      *                                                                                       195961
     C                     MOVEL#1TSTY    ZA0064           Transaction type                   195961
      *                                                                                       195961
      ** Send message 'Trans. Sub-type must be blank'                                         195961
      *                                                                                       195961
     C                     MOVEL'GLX0418' ZAMSID                                              195961
     C                     EXSR ZASNMS                                                        195961
     C                     MOVE '1'       *IN98                                               195961
     C                     MOVE '1'       *IN41                                               195961
     C                     END                                                                195961
     C                     ELSE                                                               195961
      *                                                                                       195961
      ** Validate the Trans Type against other modules Trans Type                             195961
      *   Master files.                                                                       195961
     C                     MOVE '0'       *IN55                                               195961
      *                                                                                       195961
     C           #1TSTY    IFNE *BLANK                                                        195961
     C           #1BKCD    ORNE *BLANK                                                        195961
     C           #1PRCN    ORNE *BLANK                                                        195961
     C           #1RVDI    OREQ 'Y'                                                           195961
     C                     EXSR TRANSV                                                        195961
     C                     ELSE                                                               195961
     C                     MOVE '1'       *IN55                                               195961
     C                     ENDIF                                                              195961
      *                                                                                       195961
      ** ERROR= Trans Type not on any one of the Trans Typ Masters.                           195961
      *                                                                                       195961
     C           *IN55     IFEQ '1'                                                           195961
      *                                                                                       195961
      ** Setup message data for message                                                       195961
      *                                                                                       195961
     C                     MOVEL#1TRTY    ZA0064           Transaction type                   195961
      *                                                                                       195961
      ** Send message 'Trans. type not valid'                                                 195961
      *                                                                                       195961
     C                     MOVEL'GLX0059' ZAMSID                                              195961
     C                     EXSR ZASNMS                                                        195961
     C                     MOVE '1'       *IN98                                               195961
     C                     MOVE '1'       *IN40                                               195961
     C                     MOVE '1'       *IN41                                               195961
     C                     END                                                                195961
      *                                                                                       195961
      ** check tran type end                                                                  195961
      *                                                                                       195961
     C                     END                                                                195961
     C                     END                                                                195961
     C/COPY WNCPYSRC,GL0121MK12
     C                     END                             *FI            074778
     C/COPY WNCPYSRC,GL0121MM19
     C                     END                                            127209
     C/COPY WNCPYSRC,GL0121MC42
      * Check For Back Valuations
     C                     EXSR UQSUBR                     Check For Back
     C                     END                             *FI
      *                                                                   CGL010
      ** Validate forward value dates for non-retail accounts if swit     CGL010
      ** chable feature CGL010 is installed.                              CGL010
      *                                                                   CGL010
     C           CGL010    IFEQ 'Y'                                       CGL010
     C           WUACTY    IFEQ 'N'                                       CGL010
     C           WAFVN     ANDEQ'Y'                                       CGL010
     C           WUACTY    OREQ 'D'                                       CGL010
     C           WAFVD     ANDEQ'Y'                                       CGL010
     C           WUACTY    OREQ 'C'                                       CGL010
     C           WAFVC     ANDEQ'Y'                                       CGL010
     C           WUACTY    OREQ 'G'                                       CGL010
     C           WAFVG     ANDEQ'Y'                                       CGL010
      *                                                                   CGL010
      ** Value date later than maximum forward day number, send error     CGL010
      ** message.                                                         CGL010
      *                                                                   CGL010
     C           WURDNO    ADD  WNDFV     WMXFDN  50                      CGL010
      *                                                                   CGL010
     C           #1VLDT    IFGT WMXFDN                                    CGL010
     C                     MOVEL#RVDDS    ZA0078                          CGL010
     C                     MOVEL'GLX0111' ZAMSID                          CGL010
     C                     EXSR ZASNMS                                    CGL010
     C                     MOVE *ON       *IN98                           CGL010
     C                     MOVE *ON       *IN42                           CGL010
     C                     ENDIF                                          CGL010
     C                     ENDIF                                          CGL010
     C                     ENDIF                                          CGL010
      *                                                                   CGL010
      *================================================================
     CSR         UNEXIT    ENDSR
     C/EJECT                                                              076566
     CSR         TRANSV    BEGSR                                          076566
     C*================================================================   076566
     C* Validate Transaction Type entry                                   076566
     C*================================================================   076566
     C                     MOVE *OFF      *IN55                           076566
     C                     MOVEA#1TRTY    ATRT                            076566
     C                     MOVEA#1TSTY    ATST                            076566
     C*                                                                   076566
     C* Sub-Type set to blanks                                            076566
     C           #1TSTY    IFEQ *BLANKS                        B01        076566
     C*                                                                   076566
     C* Type 5A                                                           076566
     C* FUTURES & OPTIONS                                                 076566
     C* =================                                                 076566
     C* Type non blank                                                    076566
     C*                                                                   076566
     C           ATRT,5    IFNE *BLANKS                         B02       076566
     C                     CALL 'AOFFITR0'             55   lf/INTYP      076566
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    076566
     C                     PARM '*KEY'    UUAPOP  7        I:Option       076566
     C                     PARM #1TRTY    UURTTY  5        I:FF Tran Type 076566
     C                     PARM *BLANK    UUFDY            O:Format       076566
     C* check for errors in return code                                   076566
     C           *IN55     IFEQ *OFF                            B03       076566
     C                     EXSR TRANSE                     Errors         076566
     C                     ENDIF                                E03       076566
     C* Type 3A                                                           076566
     C* FACILITIES                                                        076566
     C*    *or   SECURITY TRADING                                         076566
     C* Type, last char blank                                             076566
     C                     ELSE                                 X02       076566
     C*                                                                   076566
     C* Type, first 3 char non-blank  & Sub-Type blank                    076566
     C           ATRT,4    IFEQ *BLANKS                         B03       076566
     C           ATRT,3    ANDNE*BLANKS                                   076566
     C*                                                                   076566
     C                     MOVEL#1TRTY    UUTR3            Tran Type      076566
     C* FACILITIES  (LN)                                                  076566
     C* =================                                                 076566
     C                     CALL 'AOFACTR0'             55   lf/SDFACTL1   076566
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    076566
     C                     PARM '*KEY'    UUAPOP  7        I:Option       076566
     C                     PARM           UUTR3   3        I:Trans Type   076566
     C                     PARM *BLANK    UUFDY            O:Format       076566
     C* check for errors in return code                                   076566
     C           *IN55     IFEQ *OFF                            B04       076566
     C                     EXSR TRANSE                     Errors         076566
     C                     ENDIF                                E04       076566
     C*                                                                   076566
     C* SECURITY INVESTMENT TYPE                                          076566
     C* ===========================                                       076566
     C           *IN55     IFEQ *ON                             B04       076566
     C                     MOVE *OFF      *IN55                           076566
     C                     MOVEL#1TRTY    INVT                            076566
     C           INVT      SETLLINVTO                    55               076566
     C* Reverse indicator 55,  Error= 55 *ON                              076566
     C           *IN55     IFEQ *ON                             B05       076566
     C                     MOVE *OFF      *IN55                           076566
     C                     ELSE                                 X05       076566
     C                     MOVE *ON       *IN55                           076566
     C                     ENDIF                                E05       076566
     C                     ENDIF                                E04       076566
     C*                                                                   076566
     C* Type  *NE  (5A or 3A)                                             076566
     C* and   Sub-Type  *EQ  blanks                                       076566
     C                     ELSE                                 X03       076566
     C                     MOVE *ON       *IN55                           076566
     C                     ENDIF                                E03       076566
     C*                                                                   076566
     C                     ENDIF                                E02       076566
     C*                                                                   076566
     C* Sub-Type *NE blanks                                               076566
     C                     ELSE                                 X01       076566
     C* Type 2A                                                           076566
     C* DEALING  *or  LENDING  *or   FUNDS TRANSFER                       076566
     C*                                                                   076566
     C* Type must be 2A and                                               076566
     C* Sub-Type must be 2A  for further validation                       076566
     C*                                                                   076566
     C                     MOVEL#1TRTY    UUTR2                           076566
     C                     MOVEL#1TSTY    UUTS2                           076566
     C                     MOVE #1TRTY    WRK3A   3                       076566
     C                     MOVE #1TSTY    WRK4A   4                       CLE042
     C*********************MOVE #1TSTY    WRK7A   7                076566 CLE042
     C*                                                                   076566
     C           WRK3A     IFNE *BLANKS                         B02       076566
     C           WRK4A     ORNE *BLANKS                                   CLE042
     C***********WRK7A*****ORNE *BLANKS                            076566 CLE042
     C           UUTR2     OREQ *BLANKS                                   076566
     C           UUTS2     OREQ *BLANKS                                   076566
     C                     MOVE *ON       *IN55                           076566
     C                     ELSE                                 X02       076566
     C* DEALING                                                           076566
     C* =======                                                           076566
     C*  valid Type  55=*ON                                               076566
     C           UUTR2     LOKUPADLT                     55               076566
     C*                                                                   076566
     C*  valid Type/Sub-Type  55=*ON                                      076566
     C           *IN55     IFEQ *ON                             B03       076566
     C                     MOVEL#1TCLS    UUTC4                           CLE042
     C           DTSTK1    KLIST                                          076566
     C                     KFLD           UUTR2                           076566
     C                     KFLD           UUTS2                           076566
     C                     KFLD           UUTC4                           CLE042
     C           DTSTK1    SETLLFDDTSTL1                 55               076566
     C                     ENDIF                                E03       076566
     C* Reverse indicator 55,  Error= 55 *ON                              076566
     C           *IN55     IFEQ *ON                             B03       076566
     C                     MOVE *OFF      *IN55                           076566
     C                     ELSE                                 X03       076566
     C* LENDING                                                           076566
     C* =======                                                           076566
     C                     MOVEL#1TRTY    UUTR2                           076566
     C                     MOVEL#1TSTY    UUTS2                           076566
     C                     MOVEL#1TCLS    UUTC4                           CLE042
     C*                                                                   076566
     C                     CALL 'AOLOANR0'             55   lf/SDLOANL1   076566
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    076566
     C                     PARM '*KEY'    UUAPOP  7        I:Option       076566
     C                     PARM           UUTR2   2        I:Trn Type     076566
     C                     PARM           UUTS2   2        I:Trn Sub-Typ  076566
     C                     PARM           UUTC4   4        I:Trn Class    CLE042
     C                     PARM *BLANK    UUFDY            O:Format       076566
     C* check for errors in return code                                   076566
     C           *IN55     IFEQ *OFF                            B04       076566
     C                     EXSR TRANSE                     Errors         076566
     C                     ENDIF                                E04       076566
     C*                                                                   076566
     C* FUNDS TRANSFER                                                    076566
     C* ================                                                  076566
     C           *IN55     IFEQ *ON                             B04       076566
     C*                                                                   076566
     C*  valid Type  55=*ON                                               076566
     C                     MOVE *OFF      *IN55                           076566
     C                     MOVEL#1TRTY    UUTR2                           076566
     C           UUTR2     LOKUPAFTT                     55               076566
     C* Reverse indicator 55,  Error= 55 *ON                              076566
     C           *IN55     IFEQ *ON                             B05       076566
     C                     MOVE *OFF      *IN55                           076566
     C                     ELSE                                 X05       076566
     C                     MOVE *ON       *IN55                           076566
     C                     ENDIF                                E05       076566
     C*                                                                   076566
     C                     ENDIF                                E04       076566
     C                     ENDIF                                E03       076566
     C                     ENDIF                                E02       076566
     C                     ENDIF                                E01       076566
     C*                                                                   076566
     C*================================================================   076566
     CSR                   ENDSR                                          076566
     CSR         TRANSE    BEGSR                                          076566
     C*================================================================   076566
     C* Check Access Pgm Return Code is Access Error                      076566
     C*================================================================   076566
     C*                                                                   076566
     C           WUAPRC    IFEQ '*CLOSE'                   *IF            076566
     C           WUAPRC    OREQ '*ERROR'                                  076566
     C           WUAPRC    OREQ '*OPEN'                                   076566
     C           WUAPRC    OREQ '*KEY'                                    076566
     C           WUAPRC    OREQ '*NRF'                                    076566
     C           WUAPRC    OREQ '*EMPTY'                                  076566
     C           WUAPRC    OREQ '*EOF'                                    076566
     C           WUAPRC    OREQ '*OPTION'                                 076566
     C           WUAPRC    OREQ '*CALL'                                   076566
     C           WUAPRC    OREQ '*SELECT'                                 076566
     C           WUAPRC    OREQ '*NOSEL'                                  076566
     C           WUAPRC    OREQ '*ID'                                     076566
     C                     MOVE *ON       *IN55                           076566
     C                     ENDIF                                          076566
     C*================================================================   076566
     CSR                   ENDSR                                          076566
      /EJECT
     CSR         UOSUBR    BEGSR
      *================================================================
      * Check Overrideable Retail errors
      *================================================================
     C/COPY WNCPYSRC,GL0121MC43
      * E17610 Start
      * CASE: RCD.Cheque number is Not entered
     C           #1CQNB    IFEQ *BLANK                     *IF
     C/COPY WNCPYSRC,GL0121MC16
     C                     MOVEL'00000000'WUCQNB           Cheque number
     C                     ELSE
     C*                                                                   094655
     C** Reset field WUERCD to '0'                                        094655
     C*                                                                   094655
     C                     MOVE '0'       WUERCD                          094655
     C*                                                                   094655
      * CASE: *OTHERWISE
      * Start of Fix BHF670
      * Check that all the digits of the cheque number are entered
      * No blanks in Cheque No. - Journal Entry Posting  *
      *                                                                                     AR784719
      ** Align Cheque Number and Pad with Zeroes if necessary                               AR784719
      *                                                                                     AR784719
     C                     MOVEL*BLANK    WUZASF                                            AR784719
     C                     MOVEL#1CQNB    WUZASF                                            AR784719
      *                                                                                     AR784719
      ** ZALIGN Screen Field - Standard functions                                           AR784719
      *                                                                                     AR784719
     C                     CALL 'ZALIGN'               90                                   AR784719
     C           W0RTN     PARM W0RTN     WQ0079  7                                         AR784719
     C           WUZASF    PARM WUZASF    WQ0080 16                                         AR784719
     C                     PARM *ZERO     WQ0081  10                                        AR784719
     C                     PARM 8         WQ0082  20                                        AR784719
     C           WUZAFF    PARM *BLANK    WQ0083 16                                         AR784719
     C                     MOVE WQ0083    CHQNUM  8                                         AR784719
     C           CHQNUM    IFNE *BLANK                                                      AR784719
     C                     MOVE CHQNUM    #1CQNB                                            AR784719
     C                     ENDIF                                                            AR784719
     C*
     C** LOAD THE CHEQUE NUMBER INTO THE ARRAY SO THAT EACH
     C** ELEMENT CAN BE CHECKED TO SEE IF IT IS BLANK
     C*
     C                     MOVEA#1CQNB    UBLK
     C           1         DO   8         UBL     10
     C           UBLK,UBL  IFEQ *BLANK
     C                     MOVE '1'       WUERCD
     C                     END
     C                     END
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0067           Cheque number
      * Send message 'Cheque no contains blanks'
     C                     MOVEL'GLX0227' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9843  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Check that the cheque number is a valid number
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#1CQNB    WUZASF           ZALIGN Screen F
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0022  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0023 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0024  10       ZALIGN No Of De
     C                     PARM 8         WQ0025  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0026 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is Zalign Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0068           Cheque number
      * Send message 'Cheque Number Numeric'
     C                     MOVEL'GLX0209' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9843  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Move ZALIGN to Cheque No - Journal Entry Posting  *
     C                     MOVE WUZASF    #1CQNB
     C/COPY WNCPYSRC,GL0121MC44
      * Verify Stopped Cheques
      * CASE: RCD.Debit/credit indicator is Debit
     C           #1DCIN    IFEQ 'D'                        *IF
      * Verify Stopped Cheque. - Standard functions  *
     C*
     C*  Call to Access Program - AOSTOPV0 Verify Stoppped Cheque
     C*  Access Account Details file for the file fields
     C*
     C/COPY WNCPYSRC,GL0121MK87
     C                     CALL 'AOSTOPV0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM #1PTAM    UUCQAM 130       I:Cheque Amount
     C                     PARM #1CQNB    UUCQNB  8        I:Cheque Number
     C                     PARM #1RACN    UURACN 100       I:Retail Account No
     C                     PARM #1CUST    UUCUST  6        I:Customer Number
     C                     PARM #1CYCD    UUCYCD  3        I:Currency Code
     C**********           PARM #1ACCD    UUACCD  4        I:Account Code                     CGL029
     C                     PARM #1ACCD    UUACCD                                              CGL029
     C                     PARM #1ACSN    UUACSN  2        I:Acount Sequence
     C                     PARM #1IBCA    UUBRCD  3        I:Branch Code
     C/COPY WNCPYSRC,GL0121MK88
     C*
      * CASE: WRK.Access Pgm Return Code is Cheque's a stopped cheque
     C           WUAPRC    IFEQ '*STOP'                    *IF
      * CASE: RCD.Retail ind.: Override is Error(s) Overridden
     C           #1RINO    IFEQ 'Y'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0069           Cheque number
      * Send message 'Stopped Cheque'
     C                     MOVEL'GLX0133' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9843  *
      *
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MK86
     C                     END                             *FI
      *                                                                                       CRE019
      ** If cheque is still valid after checking for stopped cheques                          CRE019
      *                                                                                       CRE019
     C           CRE019    IFEQ 'Y'                                                           CRE019
     C           *IN43     IFEQ *OFF                                                          CRE019
     C           WFRMFL    ANDEQ'N'                                                           CRE019
      *                                                                                       CRE019
      ** Set up key to access Cheque book file                                                CRE019
      *                                                                                       CRE019
     C           KCHQBK    KLIST                                                              CRE019
     C                     KFLD           KACNO  100                                          CRE019
     C                     KFLD           KGCIN   10                                          CRE019
     C                     KFLD           KSCQN   80                                          CRE019
      *                                                                                       CRE019
     C           KCHQB2    KLIST                                                              CRE019
     C                     KFLD           KACNO  100                                          CRE019
     C                     KFLD           KGCIN   10                                          CRE019
      *                                                                                       CRE019
     C                     MOVE #1RACN    KACNO                                               CRE019
     C                     Z-ADD0         KGCIN                                               CRE019
     C                     MOVE #1CQNB    KSCQN                                               CRE019
      *                                                                                       CRE019
      ** Set up key to access Cheque book file                                                CRE019
      *                                                                                       CRE019
     C           KCHQBK    SETGTCHQBKPDF                                                      CRE019
     C           KCHQB2    REDPECHQBKPDF                 43                                   CRE019
      *                                                                                       CRE019
      ** If record is found and RECID = 'D'                                                   CRE019
      *                                                                                       CRE019
     C           *IN43     IFEQ *OFF                                                          CRE019
     C           RECID     ANDEQ'D'                                                           CRE019
      *                                                                                       CRE019
      ** If cheque is in range expected for any of the cheque books issued                    CRE019
      *                                                                                       CRE019
     C           KSCQN     IFLT SCQN                                                          CRE019
     C           KSCQN     ORGT ECQN                                                          CRE019
      *                                                                                       CRE019
     C                     MOVEL#1CQNB    ZA0154                                              CRE019
     C                     MOVEL'GLX0004' ZAMSID                                              CRE019
     C                     EXSR ZASNMS                                                        CRE019
     C                     MOVE *ON       *IN98                                               CRE019
     C                     MOVE *ON       *IN43                                               CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
      ** Check if cheque has already been presented before                                    CRE019
      *                                                                                       CRE019
     C                     Z-ADDKSCQN     WSCQN   80                                          CRE019
     C           WSCQN     SUB  SCQN      WOFSET  80                                          CRE019
     C           WOFSET    DIV  8         WI      20                                          CRE019
     C                     MVR            WBITN   10                                          CRE019
     C                     ADD  1         WI                                                  CRE019
      *                                                                                       CRE019
      ** Test corresponding bit-position of element for cheque presented                      CRE019
      *                                                                                       CRE019
     C                     MOVEACQPS      WAR                                                 CRE019
     C           WBITN     IFEQ 0                                                             CRE019
     C                     TESTB'0'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 1                                                             CRE019
     C                     TESTB'1'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 2                                                             CRE019
     C                     TESTB'2'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 3                                                             CRE019
     C                     TESTB'3'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 4                                                             CRE019
     C                     TESTB'4'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 5                                                             CRE019
     C                     TESTB'5'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 6                                                             CRE019
     C                     TESTB'6'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 7                                                             CRE019
     C                     TESTB'7'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVEAWAR       CQPS                                                CRE019
      *                                                                                       CRE019
      ** If *IN43 is on, work flag for duplicate cheques to 'Y'                               CRE019
      *                                                                                       CRE019
     C           *IN43     IFEQ *ON                                                           CRE019
     C                     MOVEL#1CQNB    ZA0155                                              CRE019
     C                     MOVEL'GLX0003' ZAMSID                                              CRE019
     C                     EXSR ZASNMS                                                        CRE019
     C                     MOVE *ON       *IN98                                               CRE019
     C                     MOVE *ON       *IN43                                               CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Else (No live record was found)                                                      CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
     C                     MOVEL#1CQNB    ZA0156                                              CRE019
     C                     MOVEL'GLX0005' ZAMSID                                              CRE019
     C                     EXSR ZASNMS                                                        CRE019
     C                     MOVE *ON       *IN98                                               CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C           WSAVEP    IFEQ 'Y'                                                           CRE019
     C                     MOVE #1CQNB    WCH,WZ                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MC45
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MC46
      * E17610 End
      * Check Retail indicator - Standard functions  *
     C*********************MOVEL#IRTIN    URRETI           Retail ind.    LN0315
     C                     MOVELWURETB    URRETI           Retail ind.    LN0315
     C*********************MOVEL#IAORC    URSTOP  7        A/O Rtn.Code   S01117
     C                     MOVELWUAPRC    URSTOP  7        A/P Rtn.Code   S01117
     C                     MOVEL#1DCIN    URIND   1                       E17600
     C                     MOVEL'NNNNNNNN'WURARC             CLEAR OVR    S01212
     C                     MOVE 'NN'      WURARC              FIELD       S01212
     C*                                                                   CEU013
     C* If switchable function CEU013 is installed, the batch is an       CEU013
     C*   external interface, the account code type is Retail, the        CEU013
     C*   account currency is an 'In' currency, and the account           CEU013
     C*   does'nt exist, then the account file field values are not       CEU013
     C*   used for validation.                                            CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WP0008    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           *IN32     ANDEQ*ON                                       CEU013
     C           WWFLG     ANDEQ'Y'                                       CEU013
     C                     MOVE *BLANKS   URRETI           Retail Indicat CEU013
     C                     MOVE *BLANKS   URERST           Error status   CEU013
     C                     MOVE *BLANKS   URERTX           Error message  CEU013
     C                     ELSE                                           CEU013
      *
     C                     EXSR URRETK                     Check Retail
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C/COPY WNCPYSRC,GL0121MC32
      *
     C                     MOVELURERST    #RIEST           Error status
     C                     MOVELURERTX    #RIEMG           Error message
      *
      * CASE: RCD.Item error state is Errors in Item
     C           #RIEST    IFEQ 'E'                        *IF
     C                     MOVEL'Y'       #1RINE           Retail ind.: Er
     C                     MOVEL'N'       #1RINO           Retail ind.: Ov
      * Setup message data for message
     C                     MOVEL#RACID    ZA0070           Account Identif
     C                     MOVEL#1CYCD    ZA0071           Currency code
     C                     MOVEL#1ACCD    ZA0072           Account code
     C                     MOVEL#1ACSN    ZA0073           Account sequenc
      * Send message 'Can't O'ride Retail error'
     C                     MOVEL'GLX0085' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     ELSE
      * CASE: RCD.Item error state is Overridable Errors
     C           #RIEST    IFEQ 'O'                        *IF
     C/COPY WNCPYSRC,GL0121MK89
     C                     MOVEL'Y'       #1RINE           Retail ind.: Er
      * CASE: RCD.Retail ind.: Override is Error(s) Overridden
     C           #1RINO    IFEQ 'Y'                        *IF
      *                      : Override is Error(s) Postponed             077173
     C           #1RINO    OREQ 'N'                                       077173
      **Start*of*Fix*LN0320**********                                     077173
     C******************** MOVEL'Y'       #1RINO           Retail ind.: Ov077173
     C******************** ELSE                                           077173
     C**CASE:*RCD.Retail*ind.: Override is Error(s) not Overridden        077173
     C********** #1RINO    IFEQ 'N'                        *IF            077173
     C*******************  MOVEL'N'       #1RINO           Retail ind.: Ov077173
      **End*of*Fix*LN0320**************                                   077173
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.Retail ind.: Override is *Blank
     C           #1RINO    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1RINO    ZA0074           Retail ind.: Ov
      * Send message 'Retail Error Req's Overde'
     C                     MOVEL'GLX0141' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9850  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.Retail ind.: Override *NE Y,N, or BLANK                 077173
      * Setup message data for message
     C                     MOVEL#1RINO    ZA0075           Retail ind.: Ov
      * Send message 'Retail Override Invalid'
     C                     MOVEL'GLX0214' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9850  *
      *
     C                     END                             *FI
     C******************** END                             *FI            077173
     C                     END                             *FI
     C                     ELSE
      * CASE: RCD.Item error state is No errors in Item
     C           #RIEST    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       #1RINE           Retail ind.: Er
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UOEXIT    ENDSR
      /EJECT
     CSR         UPSUBR    BEGSR
      *================================================================
      * Reset Retail Error Indicators
      *================================================================
     C                     MOVEL' '       #1RINO           Retail override074890
     C                     MOVEL'N'       #1RINE           Retail ind.: Er
     C                     MOVEL*BLANK    #RIEST           Item error stat
     C                     MOVELURDASH    #RIEMG           Item error msg CGL002
      *================================================================
     CSR         UPEXIT    ENDSR
      /EJECT
     CSR         UQSUBR    BEGSR
      *================================================================
      * Check For Back Valuations
      *================================================================
      * CASE: RCD.Value date (display) is Date entered
     C           #RVDDS    IFNE *BLANK                     *IF
     C                     MOVEL#RVDDS    WUWVDD           Work Value Date
     C/COPY WNCPYSRC,GL0121MK41
      * Check VDate Blank Entries - Standard functions  *
     C                     CALL 'GL0131U'              90  Check VDate Bla
     C           WUWVDD    PARM WUWVDD    WQ0049  6        Value date (dis
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Check Numeric - Standard functions  *
     C                     MOVE *IN20     UUIN20  1
     C                     MOVE *IN21     UUIN21  1
     C                     MOVELWUWVDD    UUVLDT
     C                     MOVE '0'       UUVLDT
     C                     TESTN          UUVLDT       21
     C           *IN21     IFEQ '1'
     C                     MOVEL'0'       UUVLDT
     C                     END
     C                     TESTN          UUVLDT     20
     C           *IN20     IFEQ '0'
     C                     MOVE '*NUMERR' W0RTN
     C                     ELSE
     C                     MOVE *BLANKS   W0RTN
     C                     END
     C                     MOVE UUIN20    *IN20
     C                     MOVE UUIN21    *IN21
      * CASE: PGM.*Return code is *Numeric Error
     C           W0RTN     IFEQ '*NUMERR'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0086           Value date (dis
      * Send message 'Value Date not valid 1'
     C                     MOVEL'GLX0109' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0050  7        *Return code
     C                     PARM WUDTNF    WQ0051  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0052  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0053  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0087           Value date (dis
      * Send message 'Value Date not valid 2'
     C                     MOVEL'GLX0110' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C/COPY WNCPYSRC,GL0121MK42
     C                     MOVELWUWVDD    #RVDDS           Value date (dis
     C/COPY WNCPYSRC,GL0121MK43
      * CASE: RCD.Value date GT WRK.Runday Number
     C           #1VLDT    IFGT WURDNO                     *IF
     C           CGL010    ANDEQ'N'                                       CGL010
     C           CGL010    OREQ 'Y'                                       CGL010
     C           WUACTY    ANDEQ'N'                                       CGL010
     C           WAFVN     ANDEQ'N'                                       CGL010
     C           #1VLDT    ANDGTWURDNO                                    CGL010
     C           CGL010    OREQ 'Y'                                       CGL010
     C           WUACTY    ANDEQ'D'                                       CGL010
     C           WAFVD     ANDEQ'N'                                       CGL010
     C           #1VLDT    ANDGTWURDNO                                    CGL010
     C           CGL010    OREQ 'Y'                                       CGL010
     C           WUACTY    ANDEQ'C'                                       CGL010
     C           WAFVC     ANDEQ'N'                                       CGL010
     C           #1VLDT    ANDGTWURDNO                                    CGL010
     C           CGL010    OREQ 'Y'                                       CGL010
     C           WUACTY    ANDEQ'G'                                       CGL010
     C           WAFVG     ANDEQ'N'                                       CGL010
     C           #1VLDT    ANDGTWURDNO                                    CGL010
     C/COPY WNCPYSRC,GL0121MC71
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0088           Value date (dis
      * Send message 'Value Date Must <= Today'
     C                     MOVEL'GLX0202' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
     C/COPY WNCPYSRC,GL0121MC79
      *
     C                     ELSE
     C/COPY WNCPYSRC,GL0121MC75
      * CASE: *OTHERWISE
      * VDate A/c Val- Not Retail - Standard functions  *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG  '  P@RTCD  7        B:Return code
     C                     PARM '*FIRST'  P@OPTN  7        I:Option
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C* Set Retail Key = Numeric Retail Account Number
     C                     MOVEL#1RACN    P@RETK 10
     C*
     C/COPY WNCPYSRC,GL0121MC28
     C                     CALL 'AOACCTR0'
     C                     PARM '*MSG   ' P@RTCD  7        B:Return code
     C                     PARM '*KEY'    P@OPTN  7        I:Option
     C                     PARM           P@RETK           I:Key field
     C                     PARM #1CUST    P@CNUM  6        I:Key field
     C                     PARM #1CYCD    P@CCY   3        I:Key field
     C**********           PARM #1ACCD    P@ACOD  4        I:Key field                        CGL029
     C                     PARM #1ACCD    P@ACOD 10                                           CGL029
     C                     PARM #1ACSN    P@ACSQ  2        I:Key field
     C                     PARM #1IBCA    P@IBCA  3        I:Key Field
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0121MC29
     C*
     C* EXTRACT BACK VALUEING PERIOD & CALCULATE BACK VALUE DATE
     C*
     C           WURDNO    SUB  BJBVPD    UUBRUN  50
     C*                                                                   CEU013
     C* If CEU013 switchable function is installed, the batch is from     CEU013
     C*   external interface, account currency is an 'In' currency,       CEU013
     C*   account code type is Nostro and the account is not found,       CEU013
     C*   the tests on account dates are skipped.  Account not found      CEU013
     C*   is not an error and only a warning.                             CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WP0008    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'N'                                       CEU013
     C           P@RTCD    ANDNE*BLANKS                                   CEU013
     C/COPY WNCPYSRC,GL0121MK63
     C                     ELSE                                           CEU013
     C*                                                                   CEU013
     C*
     C**   CHECK AGAINST DATE THE BACK VALUE PERIOD
     C*
     C           #1VLDT    IFLT UUBRUN
     C                     MOVE '*BVLDER' W0RTN
     C                     END
     C/COPY WNCPYSRC,GL0121MC22
     C*
     C**   CHECK AGAINST DATE THE ACCOUNT WAS OPENED
     C*
     C           DACO      IFGT #1VLDT                       IF 1
     C                     MOVE '*DTOPER' W0RTN
     C                     END                               END 1
     C/COPY WNCPYSRC,GL0121MC23
      * CASE: PGM.*Return code is Value Date Before Ac Open
     C           W0RTN     IFEQ '*DTOPER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0089           Value date (dis
      * Send message 'Value Date not valid 4'
     C                     MOVEL'GLX0112' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef Back Value Date
     C           W0RTN     IFEQ '*BVLDER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0090           Value date (dis
      * Send message 'Value Date not valid 5'
     C                     MOVEL'GLX0113' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,GL0121MC76
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C/COPY WNCPYSRC,GL0121MK34
     C                     Z-ADD#1PTDT    #1VLDT           Value date
     C/COPY WNCPYSRC,GL0121MK35
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM #1VLDT    WQ0054  50       Runday Number
     C                     PARM WUDTFF    WQ0055  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0056  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0057  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C/COPY WNCPYSRC,GL0121MK44
     C                     MOVE UUDNMA    #RVDDS
     C/COPY WNCPYSRC,GL0121MK45
      * Re-set Previous Value Date values                                 091729
     C                     Z-ADD#1VLDT    #1PVDT           Prev VLDT      091729
     C                     END                             *FI
      *================================================================
     CSR         UQEXIT    ENDSR
     CSR         URRETK    BEGSR
      *====================================================
      * Check Retail Account status
      *----------------------------------------------------
      *
     C                     MOVE *IN90     URSI90  1        Save indicator
     C                     MOVE *IN91     URSI91  1        Save indicator
     C                     MOVE *BLANK    URIESL           Blank msg.text
     C                     MOVE *BLANK    URERST  1        Error status
     C                     Z-ADD1         U1      30       Set pointer
     C                     SETOF                     91    Set ind.
      *                                                                   088257
      * Check for Retail errors, if A/C entered is valid.                 088257
      *                                                                   088257
     C           *IN32     IFEQ *OFF                       VALID A/C ONLY 088257
      *
      * Check Refer Debits :
      *
     C           URIND     IFEQ 'D'                        ONLY IF DEBIT  E17600
      *
     C                     TESTB'0'       URRETI  1      90=Refer debits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE01    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Refer Dr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSRD             Refer DR
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Refer Credits :
      *
     C           URIND     IFEQ 'C'                        ONLY IF CREDIT E17600
      *
     C                     TESTB'1'       URRETI         90 Refer credits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE02    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Refer Cr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSRC             Refer CR     S01212
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Block Debits :
      *
     C           URIND     IFEQ 'D'                        ONLY IF DEBIT  E17600
      *
     C                     TESTB'2'       URRETI         90 Block debits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE03    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Block Dr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSBD             Block DR     S01212
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Block Credits :
      *
     C           URIND     IFEQ 'C'                        ONLY IF CREDIT E17600
      *
     C                     TESTB'3'       URRETI         90 Block credits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE04    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Block Cr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSBC             Block CR     S01212
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Inactive A/C :
      *
     C                     TESTB'4'       URRETI         90 Inactive a/c
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE05    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Inactive'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSIN             Inactive     S01212
     C                     END                             FI
      *
      * Check Not in Use :   ***REMOVE COMMENTS IF FLAG TO BE USED LATER***
      *
     C*****                TESTB'5'       URRETI         90 -Not in Use-
      *
     C*****      *IN90     IFEQ '1'                        IF BIT SET
     C*****      URRE06    IFNE 'Y'                        IF NO O'RIDE
     C*****                MOVELURRIHF    @IH,U1             Blnk.H'Light
     C*****                SETON                     91      No O'ride
     C*****                ELSE                            EL O'RIDEABLE
     C*****                MOVELURRIHS    @IH,U1             Highlight
     C*****                END                             FI
     C*****                MOVE 'Not used'@IH,U1             Message text
     C*****                ADD  1         U1                 Incr.pointer
     C*****                MOVE 'Y'       WURTSS             Spare Cond.  S01212
     C*****                END                             FI
      *
      * Check Bankrupt :
      *
     C                     TESTB'6'       URRETI         90 B'rupt/L'dated
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE07    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Bankrupt'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSBR             Bankrupt     S01212
     C                     END                             FI
      *
      * Check Bad Debt :
      *
     C                     TESTB'7'       URRETI         90 Bad debt
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE08    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Bad Debt'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURTSB             Bad Debt     S01212
     C                     END                             FI
      *
      * Check Stopped cheque :
      *
     C           URSTOP    IFEQ '*STOP  '                  IF STOPPED
     C           URRE09    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Chq.Stop'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSSC             Stop.Chq     S01212
     C                     END                             FI
      *                                                                                       CRE008
      ** If enhancement CRE008 is on and posting item is a debit,                             CRE008
      ** check the group account overdraft limit.                                             CRE008
      *                                                                                       CRE008
     C           CRE008    IFEQ 'Y'                                                           CRE008
     C           URIND     ANDEQ'D'                                                           CRE008
      *                                                                                       CRE008
     C                     MOVEL#1IBCA    PIBRCH                                              CRE008
     C                     MOVEL#1CUST    PICUST                                              CRE008
     C                     MOVEL#1CYCD    PICURR                                              CRE008
     C                     MOVEL#1ACCD    PIACOD                                              CRE008
     C                     MOVEL#1ACSN    PIACSQ                                              CRE008
     C                     Z-ADD#1PTAM    PIDAMT                                              CRE008
      *                                                                                       CRE008
      ** Call Group Account Overdraft Limit Check Function.                                   CRE008
      *                                                                                       CRE008
     C                     CALL 'RE101901'                                                    CRE008
      *                                                                                       CRE008
     C                     PARM *BLANKS   PRCODE  7                                           CRE008
      *                                                                                       CRE008
      ** Input parameters                                                                     CRE008
      *                                                                                       CRE008
     C                     PARM           PIBRCH  3                                           CRE008
     C**********           PARM           PICUST  60                                   CRE008 CSD027
     C                     PARM           PICUST  6                                           CSD027
     C                     PARM           PICURR  3                                           CRE008
     C**********           PARM           PIACOD  40                                   CRE008 CGL029
     C                     PARM           PIACOD 100                                          CGL029
     C                     PARM           PIACSQ  20                                          CRE008
     C                     PARM           PIDAMT 150                                          CRE008
      *                                                                                       CRE008
      ** Output parameters                                                                    CRE008
      *                                                                                       CRE008
     C                     PARM *BLANKS   POBRCH  3                                           CRE008
     C**********           PARM *ZERO     POCUST  60                                   CRE008 CSD027
     C                     PARM *BLANKS   POCUST  6                                           CSD027
     C                     PARM *BLANKS   POCURR  3                                           CRE008
     C**********           PARM *ZERO     POACOD  40                                   CRE008 CGL029
     C                     PARM *ZERO     POACOD 100                                          CGL029
     C                     PARM *ZERO     POACSQ  20                                          CRE008
     C                     PARM *ZERO     PORETN 100                                          CRE008
      *                                                                                       CRE008
     C           PRCODE    IFEQ '*ODLMTX'                                                     CRE008
     C/COPY WNCPYSRC,GLH00638
      *                                                                                       CRE008
     C           URRE10    IFNE 'Y'                                                           CRE008
     C                     MOVELURRIHF    @IH,U1                                              CRE008
     C                     SETON                     91                                       CRE008
     C                     ELSE                                                               CRE008
     C                     MOVELURRIHS    @IH,U1                                              CRE008
     C                     ENDIF                                                              CRE008
      *                                                                                       CRE008
     C                     MOVE 'Exceeded'@IH,U1                                              CRE008
     C                     ADD  1         U1                                                  CRE008
     C                     MOVE 'Y'       WUFMST                                              CRE008
      *                                                                                       CRE008
      ** Set up warning message.                                                              CRE008
      *                                                                                       CRE008
     C                     MOVE POBRCH    WBRCDE                                              CRE008
     C                     MOVE '-'       WDASH1                                              CRE008
     C                     MOVE POCUST    WCUSTN                                              CRE008
     C                     MOVE '-'       WDASH2                                              CRE008
     C                     MOVE POACOD    WACOD                                               CRE008
     C                     MOVE '-'       WDASH3                                              CRE008
     C                     MOVE POACSQ    WACSQ                                               CRE008
     C                     MOVE '/'       WSLSH                                               CRE008
     C                     MOVE PORETN    WRETN                                               CRE008
      *                                                                                       CRE008
     C           PORETN    IFEQ *ZERO                                                         CRE008
     C                     MOVELWMDTA1    ZAMSDA    P                                         CRE008
     C                     ELSE                                                               CRE008
     C                     MOVELWMDTA2    ZAMSDA    P                                         CRE008
     C                     ENDIF                                                              CRE008
      *                                                                                       CRE008
     C                     MOVEL'CGL0005' ZAMSID                                              CRE008
     C                     MOVEL'GLUSRMSG'ZAMSGF                                              CRE008
     C                     EXSR ZASNMS                                                        CRE008
     C                     ENDIF                                                              CRE008
     C                     ENDIF                                                              CRE008
      *                                                                   088257
     C                     ENDIF                           VALID A/C      088257
      *
      * Check Non-Overrideable error status :
      *
     C           U1        IFGT 1                          IF ERRORS
     C           U1        IFLT 9                          IF NOT MAXIMUM
     C                     MOVELURNORM    @IH,U1             End Highlight
     C                     END                             FI
     C                     MOVE URERMG    URERTX             Error line
     C           *IN91     IFEQ '1'                        IF NOT O'RIDE
     C                     MOVE 'E'       URERST             Error Status
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVE 'O'       URERST             Error Status
     C                     END                             FI
     C                     ELSE                            EL NO ERRORS
     C                     MOVE *BLANK    URERST             Error Status
     C                     MOVE URDASH    URERTX 76          Dashes
     C                     END                             FI
      *
     C                     MOVE URSI90    *IN90            Restore ind.
     C                     MOVE URSI91    *IN91            Restore ind.
      *
      *----------------------------------------------------
      *
      *====================================================
     C**         UREXIT    ENDSR
     CSR         XXET      ENDSR
      /EJECT
     CSR         URSUBR    BEGSR
      *================================================================
      * Check Profit Centre
      *================================================================
      * CASE: WRK.Profit Centres Used is Yes
     C           WUPRCU    IFEQ 'Y'                        *IF
      * CASE: RCD.Profit centre is Entered
     C/COPY WNCPYSRC,GL0121MK36
     C           #1PRCN    IFNE *BLANK                     *IF
     C/COPY WNCPYSRC,GL0121MK37
      * CASE: RCD.Profit centre is Select requested
     C           #1PRCN    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access profit Centre - Profit Centres  *
     C*
     C*  Access Def centre code off file.
     C*
     C                     MOVEL#1PRCN    UUPCCD
     C                     CALL 'AOPRFCR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUPCCD  4        I:Profit Cent
     C           D@PRFC    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELDSPCCD    WUPRCN           Profit Centre
     C                     MOVELDSPCCD    WUPCDS           Prof Cent Desc
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0093           Profit centre
      * Send message 'Profit Centres         NF'
     C                     MOVEL'GLX0182' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9845  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUPRCN    #1PRCN           Profit centre
     C                     END                             *FI
      *                                                                   CAC001
      **  If Analytical Accounting is on and account is Retail or         CAC001
      **  Nostro, issue a warning if profit centre entered is not equal   CAC001
      **  to the profit centre of the account                             CAC001
      *                                                                   CAC001
     C           WUN0ST    IFEQ 'Y'                                       CAC001
     C           WUACTY    IFEQ 'R'                                       CAC001
     C           WUACTY    OREQ 'N'                                       CAC001
     C           #1PRCN    IFNE WUPRFC                                    CAC001
     C           WKWARN    ANDEQ'Y'                                       CAC001
     C                     MOVEL'GLX0391' ZAMSID                          CAC001
     C                     MOVE 'Y'       WWERR                                              241505A
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS                                    CAC001
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     ENDIF                                          CEU013
     C                     SETON                     45                   CAC001
     C                     END                                            CAC001
     C                     END                                            CAC001
     C                     END                                            CAC001
      *                                                                   CAC001
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Profit Centre Def'ts Used is Yes
     C           WUPCDU    IFEQ 'Y'                        *IF
      * Define profit centre default processing work fields               071924
     C           *LIKE     DEFN BBCUST    WUCUS1                          071924
     C           *LIKE     DEFN BBCUST    WUCUS2                          071924
     C           *LIKE     DEFN BBCUST    WUCUS3                          071924
     C           *LIKE     DEFN BBACOC    WUACO1                          071924
     C           *LIKE     DEFN BBACOC    WUACO2                          071924
     C           *LIKE     DEFN BBACOC    WUACO3                          071924
      * Clear third set of work fields. These will contain the customer   071924
      * number and account officer code to be passed to AOPRFMR0          071924
     C                     MOVEL*BLANKS   WUCUS3                          071924
     C                     MOVEL*BLANKS   WUACO3                          071924
      * The second set of work fields contain the customer number and     071924
      * account officer code for the associated customer. Use these if    071924
      * they have been set (ie. they are not all '*'s).                   071924
     C           WUCUS2    IFNE *ALL'*'                    --- B10        071924
     C                     MOVELWUCUS2    WUCUS3                          071924
     C                     MOVELWUACO2    WUACO3                          071924
     C                     ELSE                            --- X10        071924
      * Check that first customer work field has been set, if it has then 071924
      * use it.                                                           071924
     C           WUCUS1    IFNE *ALL'*'                    --- B20        071924
     C                     MOVELWUCUS1    WUCUS3                          071924
      * If the first account officer code is set, use it.                 071924
     C           WUACO1    IFNE *ALL'*'                    --- B30        071924
     C                     MOVELWUACO1    WUACO3                          071924
     C                     ELSE                            --- X30        071924
      * If the first account officer code is not set, then set it via     071924
      * access object.                                                    071924
     C                     MOVEL*BLANKS   UUCNCD                          071924
     C                     MOVELWUCUS1    UUCNCD                          071924
     C                     CALL 'AOCUSTR0'                                071924
     C           WUAPRC    PARM           WUAPRC           B:Return Cd    071924
     C                     PARM '*KEY'    UUAPOP           I:Option       071924
     C                     PARM           UUCNCD           I:Client Key   071924
     C                     PARM           UUCRST           O:Key status   071924
     C           D@CUST    PARM *BLANK    UUSDY            O:Format       071924
     C           WUAPRC    IFEQ *BLANKS                    --- B40        071924
     C                     MOVELBBACOC    WUACO3                          071924
     C                     END                             --- E40        071924
     C                     END                             --- E30        071924
     C                     END                             --- E20        071924
     C                     END                             --- E10        071924
      *                                                                   CAC001
      **  If Analytical Accounting is on and account is Retail or         CAC001
      **  Nostro, default profit centre to the profit centre of the       CAC001
      **  account                                                         CAC001
      *                                                                   CAC001
     C           WUN0ST    IFEQ 'Y'                                       CAC001
     C           WUACTY    ANDEQ'R'                                       CAC001
     C           WUN0ST    OREQ 'Y'                                       CAC001
     C           WUACTY    ANDEQ'N'                                       CAC001
     C                     MOVELWUPRFC    WUPRCN                          CAC001
     C                     MOVELWUPRFC    #1PRCN                          CAC001
      *                                                                   CAC001
     C                     ELSE                                           CAC001
      * Access Prof C Def Matrix. - Profit Centre Dft Matrix  *
     C*
     C*  Access Def Prof centre code off file.
     C*
     C                     CALL 'AOPRFMR0'
     C***********WUAPRC****PARM WUAPRC    UUAPRC  7        B:Return Cd    071924
     C                     PARM           @RETC   1        B:Return Cd    071924
     C                     PARM WUBKCD    UUBKCD  2        I:Book Code
     C                     PARM #1TRTY    UUPCTT  5        I:Trans Type
     C                     PARM #1TSTY    UUSBTY  2        I:Sub Type
     C                     PARM #1IBCA    UUBRCD  3        I:Branch Code
     C                     PARM P1DPCD    UUDPCD  3        I:Department
     C                     PARM ##USR     UUUSID 10        I:User Profile
     C*********************PARM WUACOC    UUACOC  2        I:A/c Officer  071924
     C*********************PARM WUACNB    UUCUST  6        I:Customer No. 071924
     C                     PARM WUACO3    UUACOC  2        I:A/c Officer  071924
     C                     PARM WUCUS3    UUCUST  6        I:Customer No. 071924
     C                     PARM *BLANK    UUPCCD  4        O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUPCCD    WUPRCN           Profit Centre
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 0
     C***********WUAPRC    IFEQ '0'                        *IF            071924
     C           @RETC     IFEQ '0'                        *IF            071924
     C                     MOVELWUPRCN    #1PRCN           Profit centre
     C                     ELSE
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 1
     C***********WUAPRC    IFEQ '1'                        *IF            071924
     C           @RETC     IFEQ '1'                        *IF            071924
     C                     MOVEL*BLANK    #1PRCN           Profit centre
     C                     ELSE
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 2
     C***********WUAPRC    IFEQ '2'                        *IF            071924
     C           @RETC     IFEQ '2'                        *IF            071924
     C                     MOVELWUPRCN    #1PRCN           Profit centre
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0094           Profit centre
      * Send message 'Profit Centres         NF'
     C                     MOVEL'GLX0182' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9845  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *                                                                   CAC001
      **  If Analytical Accounting is on and default profit centre is     CAC001
      **  blank, send an error message                                    CAC001
      *                                                                   CAC001
     C           WUN0ST    IFEQ 'Y'                                       CAC001
     C           #1PRCN    ANDEQ*BLANK                                    CAC001
     C                     MOVEL'GLX0390' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     SETON                     9845                 CAC001
     C                     END                                            CAC001
      *                                                                   CAC001
     C                     END                                            CAC001
      *                                                                   CAC001
     C                     ELSE                                           CAC001
      *                                                                   CAC001
      **  If Analytical Accounting is on and no profit centre entered,    CAC001
      **  profit centre field must be mandatory                           CAC001
      *                                                                   CAC001
     C           WUN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVEL'GLX0390' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     SETON                     9845                 CAC001
     C                     END                                            CAC001
      *                                                                   CAC001
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MK18
      *                                                                                       255341
     C           CGL064    IFEQ 'Y'                                                           255341
      *                                                                                       255341
      * Mandatory if posting is to an Expense account                                         255341
     C           #1PRCN    IFEQ *BLANKS                                                       255341
     C           WACSC     ANDEQ'EX'                                                          255341
     C                     MOVEL'GLX0390' ZAMSID                                              255341
     C                     EXSR ZASNMS                                                        255341
     C                     SETON                     9845                                     255341
     C                     ENDIF                                                              255341
      *                                                                                       255341
     C                     ENDIF                                                              255341
      *                                                                                       255341
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0121MK64
     C                     END                             *FI
      *================================================================
     CSR         UREXIT    ENDSR
      /EJECT
     CSR         USSUBR    BEGSR
      *================================================================
      * Setup Branch code (Header) & Posting Date on RCD
      *================================================================
      * start 047414
      * only move branch number if not a multibranch batch.
      * CASE: WRK.Multiple Branch Batch is No
     C***********WUMBRB    IFEQ 'N'                        *IF            095522
     C                     MOVELP1BCDA    #1BCBH           Branch Code (Ba
     C***********          END                             *FI            095522
      * end 047414
     C                     Z-ADDWURDNO    #1PTDT           Posting date
      *================================================================
     CSR         USEXIT    ENDSR
      /EJECT
     CSR         UTSUBR    BEGSR
      *================================================================
      **Store*Data*for*Copy*/*Template*Function************************   087770
      * Clear Copy / Template Function work fields                        087770
      *================================================================
     C***********          MOVEL#RACID    WUCACI           Copy:Account id087770
     C***********          MOVEL#1CYCD    WUCCCD           Copy:Currency c087770
     C***********          MOVEL#1ACCD    WUCPAC           Copy:Account co087770
     C***********          MOVEL#1ACSN    WUCACS           Copy:Account Se087770
     C***********          MOVEL#1IBCA    WUCBCA           Copy:Branch Cod087770
     C***********          MOVEL#RFMPA    WUCAMT           Copy:Amount    087770
     C***********          MOVEL#1DCIN    WUCDCI           Copy:DR/CR Indi087770
     C***********          MOVEL#RNRTV    WUCNAR           Copy:Narrative 087770
     C***********          MOVEL#1TRTY    WUCTRT           Copy:Transactio087770
     C***********          MOVEL#1CQNB    WUCCNB           Copy:Cheque Num087770
     C***********          MOVEL#RASCD    WUASSC           Copy:Assoc Cust087770
     C***********          Z-ADD#1VLDT    WUCVDN           Copy:Value Date087770
     C***********          MOVEL#RVDDS    WUCVDT           Copy:Value Date087770
     C***********          MOVEL#1SWCR    WUCSCR           Copy:Swift Comm087770
     C***********          MOVEL#1PRCN    WUCPRC           Copy:Profit Cen087770
      * Start of S10736
     C***********          MOVEL#1TSTY    WUCTST           Copy:Transactio087770
     C***********          MOVEL#1BKCD    WUCBKC           Copy:Book Code 087770
     C***********          MOVEL#1RVDI    WUCRVI           Copy:Reverse/Vo087770
      *                                                                   087770
     C           WUCFUS    IFEQ 'N'                                       087770
     C                     MOVE *BLANKS   WUCACI           Copy:Account id087770
     C                     MOVE *BLANKS   WUCCCD           Copy:Currency c087770
     C                     MOVE *BLANKS   WUCPAC           Copy:Account co087770
     C                     MOVE *BLANKS   WUCACS           Copy:Account Se087770
     C                     MOVE *BLANKS   WUCBCA           Copy:Branch Cod087770
     C                     MOVE *BLANKS   WUCAMT           Copy:Amount    087770
     C                     MOVE *BLANKS   WUCDCI           Copy:DR/CR Indi087770
     C                     MOVE *BLANKS   WUCNAR           Copy:Narrative 087770
     C                     MOVE *BLANKS   WUCTRT           Copy:Transactio087770
     C                     MOVE *BLANKS   WUCCNB           Copy:Cheque Num087770
     C                     MOVE *BLANKS   WUASSC           Copy:Assoc Cust087770
     C                     Z-ADD0         WUCVDN           Copy:Value Date087770
     C                     MOVE *BLANKS   WUCVDT           Copy:Value Date087770
     C                     MOVE *BLANKS   WUCSCR           Copy:Swift Comm087770
     C                     MOVE *BLANKS   WUCPRC           Copy:Profit Cen087770
     C                     MOVE *BLANKS   WUCTST           Copy:Transactio087770
     C                     MOVE *BLANKS   WUCBKC           Copy:Book Code 087770
     C                     MOVE *BLANKS   WUCRVI           Copy:Reverse/Vo087770
     C                     MOVE *BLANKS   WUCOCY           Copy:Origin ccyCEU013
     C                     MOVE *BLANKS   WUCOAM           Copy:Origin amtCEU013
     C                     ENDIF                                          087770
      *                                                                   087770
     C           WUTFUS    IFEQ 'N'                                       087770
     C                     MOVE *BLANKS   WZCACI           Tmpl:Account id087770
     C                     MOVE *BLANKS   WZCCCD           Tmpl:Currency c087770
     C                     MOVE *BLANKS   WZCPAC           Tmpl:Account co087770
     C                     MOVE *BLANKS   WZCACS           Tmpl:Account Se087770
     C                     MOVE *BLANKS   WZCBCA           Tmpl:Branch Cod087770
     C                     MOVE *BLANKS   WZCAMT           Tmpl:Amount    087770
     C                     MOVE *BLANKS   WZCDCI           Tmpl:DR/CR Indi087770
     C                     MOVE *BLANKS   WZCNAR           Tmpl:Narrative 087770
     C                     MOVE *BLANKS   WZCTRT           Tmpl:Transactio087770
     C                     MOVE *BLANKS   WZCCNB           Tmpl:Cheque Num087770
     C                     MOVE *BLANKS   WZASSC           Tmpl:Assoc Cust087770
     C                     Z-ADD0         WZCVDN           Tmpl:Value Date087770
     C                     MOVE *BLANKS   WZCVDT           Tmpl:Value Date087770
     C                     MOVE *BLANKS   WZCSCR           Tmpl:Swift Comm087770
     C                     MOVE *BLANKS   WZCPRC           Tmpl:Profit Cen087770
     C                     MOVE *BLANKS   WZCTST           Tmpl:Transactio087770
     C                     MOVE *BLANKS   WZCBKC           Tmpl:Book Code 087770
     C                     MOVE *BLANKS   WZCRVI           Tmpl:Reverse/Vo087770
     C                     MOVE *BLANKS   WZCOCY           Tmpl:Origin ccyCEU013
     C                     MOVE *BLANKS   WZCOAM           Tmpl:Origin amtCEU013
     C                     ENDIF                                          087770
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MRF2                                           S01408
     C*                                                                   S01408
      * End of S10736
      *================================================================
     CSR         UTEXIT    ENDSR
      /EJECT
     CSR         UUSUBR    BEGSR
      *================================================================
      * Check for Copy Character in Field
      *================================================================
      * CASE: RCD.Account Identifier EQ WRK.JE Special Character
     C           #RACID    IFEQ WUJESP                     *IF
     C                     MOVELWUCACI    #RACID           Account Identif
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Currency code EQ WRK.JE Special Character
     C           #1CYCD    IFEQ WUJESP                     *IF
     C                     MOVELWUCCCD    #1CYCD           Currency code
     C                     MOVEL#1CYCD    #1PCCY           Prev A/C ccy   091729
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Account code EQ WRK.JE Special Character
     C           #1ACCD    IFEQ WUJESP                     *IF
     C                     MOVELWUCPAC    #1ACCD           Account code
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Account sequence number EQ WRK.JE Special Character
     C           #1ACSN    IFEQ WUJESP                     *IF
     C                     MOVELWUCACS    #1ACSN           Account sequenc
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Input Branch Code - Alpha EQ WRK.JE Special Character
     C           #1IBCA    IFEQ WUJESP                     *IF
     C                     MOVELWUCBCA    #1IBCA           Input Branch Co
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Formatted Posting amount EQ WRK.JE Special Character
     C           #RFMPA    IFEQ WUJESP                     *IF
     C                     MOVELWUCAMT    #RFMPA           Formatted Posti
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
     C                     MOVELWUCDCI    #1DCIN           Debit/credit in
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Narrative EQ WRK.JE Special Character
     C           #RNRTV    IFEQ WUJESP                     *IF
     C                     MOVELWUCNAR    #RNRTV           Narrative
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Transaction type EQ WRK.JE Special Character
     C           #1TRTY    IFEQ WUJESP                     *IF
     C                     MOVELWUCTRT    #1TRTY           Transaction typ
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Cheque number EQ WRK.JE Special Character
     C           #1CQNB    IFEQ WUJESP                     *IF
     C                     MOVELWUCCNB    #1CQNB           Cheque number
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Associated Cust - Display EQ WRK.JE Special Character
     C           #RASCD    IFEQ WUJESP                     *IF
     C                     MOVELWUASSC    #1ACNB           Assoc. Customer
     C                     MOVELWUASSC    #RASCD           Associated Cust
     C                     END                             *FI
      * CASE: RCD.Value date (display) EQ WRK.JE Special Character
     C           #RVDDS    IFEQ WUJESP                     *IF
     C                     Z-ADDWUCVDN    #1VLDT           Value date
     C                     MOVELWUCVDT    #RVDDS           Value date (dis
      * Re-set Previous Value Date values                                 091729
     C                     Z-ADD#1VLDT    #1PVDT           Prev VLDT      091729
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Swift common reference EQ WRK.JE Special Character
     C           #1SWCR    IFEQ WUJESP                     *IF
     C                     MOVELWUCSCR    #1SWCR           Swift common re
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Profit centre EQ WRK.JE Special Character
     C           #1PRCN    IFEQ WUJESP                     *IF
     C                     MOVELWUCPRC    #1PRCN           Profit centre
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Start of S10736
      * CASE: RCD.Transaction (Sub - Type) EQ WRK.JE Special Character
     C           #1TSTY    IFEQ WUJESP                     *IF
     C                     MOVELWUCTST    #1TSTY           Transaction (Su
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Book Code EQ WRK.JE Special Character
     C           #1BKCD    IFEQ WUJESP                     *IF
     C                     MOVELWUCBKC    #1BKCD           Book Code
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Reverse/Void Indicator EQ WRK.JE Special Character
     C           #1RVDI    IFEQ WUJESP                     *IF
     C                     MOVELWUCRVI    #1RVDI           Reverse/Void In
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Original Currency code EQ WRK.JE Special Character      CEU013
     C           #1OCCY    IFEQ WUJESP                     *IF            CEU013
     C                     MOVELWUCOCY    #1OCCY           Original ccy   CEU013
     C                     MOVEL'Y'       W0DCF            *Defer confirm CEU013
     C                     END                             *FI            CEU013
      * CASE: RCD.Formatted Original amount EQ WRK.JE Special Character   CEU013
     C           #RFMOA    IFEQ WUJESP                     *IF            CEU013
     C                     MOVELWUCOAM    #RFMOA           Formatted OrigiCEU013
     C                     MOVEL'Y'       W0DCF            *Defer confirm CEU013
     C                     END                             *FI            CEU013
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MRF1                                           S01408
     C*                                                                   S01408
      * End of S10736
      *================================================================
     CSR         UUEXIT    ENDSR
      /EJECT
     C/COPY WNCPYSRC,GL0121MC07
     CSR         UVSUBR    BEGSR
      *================================================================
      * Change Mode Processing
      *================================================================
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
      * CASE: RCD.*SFLSEL is Copy/Template
     C           #1SEL     IFEQ 'C'                        *IF
     C           #1SEL     OREQ 'T'
      * CASE: RCD.*SFLSEL is Copy
     C           #1SEL     IFEQ 'C'                        *IF
     C                     MOVEL'Y'       WUCFUS           Copy Facility U
     C                     END                             *FI
      * CASE: RCD.*SFLSEL is Template
     C           #1SEL     IFEQ 'T'                        *IF
     C                     MOVEL'Y'       WUTFUS           Template Facili
     C                     END                             *FI
     C                     MOVEL'Y'       WUCTFY           Copy / Template
      * Store Data for Copy / Template Function
     C                     EXSR UWSUBR                     Store Data for
     C                     END                             *FI
      * Check for Copy Character in Screen Field
     C                     EXSR UXSUBR                     Check for Copy
     C                     END                             *FI
      *================================================================
     CSR         UVEXIT    ENDSR
      /EJECT
     CSR         UWSUBR    BEGSR
      *================================================================
      * Store Data for Copy / Template Function
      *================================================================
      * IF:*SFLSEL is COPY                                                087770
     C           #1SEL     IFEQ 'C'                                       087770
     C                     MOVEL#RACID    WUCACI           Copy:Account id
     C                     MOVEL#1CYCD    WUCCCD           Copy:Currency c
     C                     MOVEL#1ACCD    WUCPAC           Copy:Account co
     C                     MOVEL#1ACSN    WUCACS           Copy:Account Se
     C                     MOVEL#1IBCA    WUCBCA           Copy:Branch Cod
     C                     MOVEL#RFMPA    WUCAMT           Copy:Amount
     C                     MOVEL#1DCIN    WUCDCI           Copy:DR/CR Indi
     C                     MOVEL#RNRTV    WUCNAR           Copy:Narrative
     C                     MOVEL#1TRTY    WUCTRT           Copy:Transactio
     C                     MOVEL#1CQNB    WUCCNB           Copy:Cheque Num
     C                     MOVEL#RASCD    WUASSC           Copy:Assoc Cust
     C                     Z-ADD#1VLDT    WUCVDN           Copy:Value Date
     C                     MOVEL#RVDDS    WUCVDT           Copy:Value Date
     C                     MOVEL#1SWCR    WUCSCR           Copy:Swift Comm
     C                     MOVEL#1PRCN    WUCPRC           Copy:Profit Cen
      * Start of S10736
     C                     MOVEL#1TSTY    WUCTST           Copy:Transactio
     C                     MOVEL#1BKCD    WUCBKC           Copy:Book Code
     C                     MOVEL#1RVDI    WUCRVI           Copy:Reverse/Vo
     C                     MOVEL#1OCCY    WUCOCY           Copy:Origin ccyCEU013
     C                     MOVEL#RFMOA    WUCOAM           Copy:Origin amtCEU013
     C                     ENDIF                                          087770
      *                                                                   087770
      * IF:*SFLSEL is Template                                            087770
     C           #1SEL     IFEQ 'T'                                       087770
     C                     MOVEL#RACID    WZCACI           Tmpl:Account id087770
     C                     MOVEL#1CYCD    WZCCCD           Tmpl:Currency c087770
     C                     MOVEL#1ACCD    WZCPAC           Tmpl:Account co087770
     C                     MOVEL#1ACSN    WZCACS           Tmpl:Account Se087770
     C                     MOVEL#1IBCA    WZCBCA           Tmpl:Branch Cod087770
     C                     MOVEL#RFMPA    WZCAMT           Tmpl:Amount    087770
     C                     MOVEL#1DCIN    WZCDCI           Tmpl:DR/CR Indi087770
     C                     MOVEL#RNRTV    WZCNAR           Tmpl:Narrative 087770
     C                     MOVEL#1TRTY    WZCTRT           Tmpl:Transactio087770
     C                     MOVEL#1CQNB    WZCCNB           Tmpl:Cheque Num087770
     C                     MOVEL#RASCD    WZASSC           Tmpl:Assoc Cust087770
     C                     Z-ADD#1VLDT    WZCVDN           Tmpl:Value Date087770
     C                     MOVEL#RVDDS    WZCVDT           Tmpl:Value Date087770
     C                     MOVEL#1SWCR    WZCSCR           Tmpl:Swift Comm087770
     C                     MOVEL#1PRCN    WZCPRC           Tmpl:Profit Cen087770
     C                     MOVEL#1TSTY    WZCTST           Tmpl:Transactio087770
     C                     MOVEL#1BKCD    WZCBKC           Tmpl:Book Code 087770
     C                     MOVEL#1RVDI    WZCRVI           Tmpl:Reverse/Vo087770
     C                     MOVEL#1OCCY    WZCOCY           Tmpl:Origin ccyCEU013
     C                     MOVEL#RFMOA    WZCOAM           Tmpl:Origin amtCEU013
     C                     ENDIF                                          087770
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MCP6                                           S01408
     C*                                                                   S01408
      * End of S10736
      *================================================================
     CSR         UWEXIT    ENDSR
      /EJECT
     CSR         UXSUBR    BEGSR
      *================================================================
      * Check for Copy Character in Screen Field
      *================================================================
      * CASE: RCD.Account Identifier EQ WRK.JE Special Character
     C           #RACID    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0101           Account Identif
     C                     MOVELWUJESP    ZA0102           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     END                             *FI
      * CASE: RCD.Currency code EQ WRK.JE Special Character
     C           #1CYCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0103           Currency code
     C                     MOVELWUJESP    ZA0104           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     END                             *FI
      * CASE: RCD.Account code EQ WRK.JE Special Character
     C           #1ACCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0105           Account code
     C                     MOVELWUJESP    ZA0106           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9834  *
      *
     C                     END                             *FI
      * CASE: RCD.Account sequence number EQ WRK.JE Special Character
     C           #1ACSN    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1ACSN    ZA0107           Account sequenc
     C                     MOVELWUJESP    ZA0108           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     END                             *FI
      * CASE: RCD.Input Branch Code - Alpha EQ WRK.JE Special Character
     C           #1IBCA    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0109           Input Branch Co
     C                     MOVELWUJESP    ZA0110           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     END                             *FI
      * CASE: RCD.Formatted Posting amount EQ WRK.JE Special Character
     C           #RFMPA    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0111           Formatted Posti
     C                     MOVELWUJESP    ZA0112           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9837  *
      *
     C                     END                             *FI
      * CASE: RCD.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1DCIN    ZA0113           Debit/credit in
     C                     MOVELWUJESP    ZA0114           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9838  *
      *
     C                     END                             *FI
      * CASE: RCD.Narrative EQ WRK.JE Special Character
     C           #RNRTV    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RNRTV    ZA0115           Narrative
     C/COPY WNCPYSRC,GL0121MM20
     C                     MOVELWUJESP    ZA0116           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     END                             *FI
      * CASE: RCD.Transaction type EQ WRK.JE Special Character
     C           #1TRTY    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1TRTY    ZA0117           Transaction typ
     C                     MOVELWUJESP    ZA0118           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9840  *
      *
     C                     END                             *FI
      * CASE: RCD.Cheque number EQ WRK.JE Special Character
     C           #1CQNB    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0119           Cheque number
     C                     MOVELWUJESP    ZA0120           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9843  *
      *
     C                     END                             *FI
      * CASE: RCD.Associated Cust - Display EQ WRK.JE Special Character
     C           #RASCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RASCD    ZA0121           Associated Cust
     C                     MOVELWUJESP    ZA0122           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9846  *
      *
     C                     END                             *FI
      * CASE: RCD.Value date (display) EQ WRK.JE Special Character
     C           #RVDDS    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0123           Value date (dis
     C                     MOVELWUJESP    ZA0124           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      * CASE: RCD.Swift common reference EQ WRK.JE Special Character
     C           #1SWCR    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1SWCR    ZA0125           Swift common re
     C                     MOVELWUJESP    ZA0126           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9844  *
      *
     C                     END                             *FI
      * CASE: RCD.Profit centre EQ WRK.JE Special Character
     C           #1PRCN    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0127           Profit centre
     C                     MOVELWUJESP    ZA0128           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9845  *
      *
     C                     END                             *FI
      * Start of S10736
      * CASE: RCD.Transaction (Sub - Type) EQ WRK.JE Special Character
     C           #1TSTY    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1TSTY    ZA0129           Transaction (Su
     C                     MOVELWUJESP    ZA0130           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9841  *
      *
     C                     END                             *FI
      * CASE: RCD.Book Code EQ WRK.JE Special Character
     C           #1BKCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1BKCD    ZA0131           Book Code
     C                     MOVELWUJESP    ZA0132           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9847  *
      *
     C                     END                             *FI
      * CASE: RCD.Reverse/Void Indicator EQ WRK.JE Special Character
     C           #1RVDI    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1RVDI    ZA0133           Reverse/Void In
     C                     MOVELWUJESP    ZA0134           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9848  *
      *
     C                     END                             *FI
      * CASE: RCD.Original currency code EQ WRK.JE Special Character      CEU013
     C           #1OCCY    IFEQ WUJESP                     *IF            CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0147           Original ccy   CEU013
     C                     MOVELWUJESP    ZA0148           JE Special CharCEU013
      * Send message 'Copy function not valid'                            CEU013
     C                     MOVEL'GLX0090' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9851  *              CEU013
      *                                                                   CEU013
     C                     END                             *FI            CEU013
      * CASE: RCD.Formatted Original amount EQ WRK.JE Special Character   CEU013
     C           #RFMOA    IFEQ WUJESP                     *IF            CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#RFMOA    ZA0149           Formatted OrigiCEU013
     C                     MOVELWUJESP    ZA0150           JE Special CharCEU013
      * Send message 'Copy function not valid'                            CEU013
     C                     MOVEL'GLX0090' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9852  *              CEU013
      *                                                                   CEU013
     C                     END                             *FI            CEU013
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0121MCP7                                           S01408
     C*                                                                   S01408
      * End of S10736
      *================================================================
     CSR         UXEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C                     MOVEL#2BTNB    WK1X01  1
     C           WK1X01    IFEQ '?'                        Batch number
     C                     CALL 'GL0140S'              90  *
     C                     PARM           W0RTN   7
     C           #2BTNB    PARM #2BTNB    WQ0067  3        Batch number
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     CABNE*BLANK    VA999
     C                     END
      *................................................................
      *
     C           KLVABR    KLIST
     C                     KFLD           BRBTNB           Batch number
      * Setup key
     C                     MOVEL#2BTNB    BRBTNB           Batch number
     C           KLVABR    CHAIN@BRREAH              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
     C           VA999     TAG
      * Restrictor relation not satisfied
      * Send message 'Journal Entry Header   NF'
     C                     MOVEL'GLX0172' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'GLX0172' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VAEXIT    ENDSR
     CSR         XXIN      BEGSR                                          E17819
      *====================================================
      * Determine Account type
      *----------------------------------------------------
      *
     C                     MOVE *IN90     UKSI90  1        Save indicator
      *
      * 1. Check for invalid input :
      *
     C           UKACID    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*ERROR*' UKTYPE  7          Error
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 2. Check for Retail A/C :
      *
     C                     TESTN          UKACID     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF ALL NUMERIC
     C                     MOVE '*RETAIL' UKTYPE             Retail A/C
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 3. Check for Customer number :
      *
     C                     TESTN          UKACF6     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF ALL NUMERIC
     C           UKACL4    IFEQ *BLANK                     IF 6 DIGITS ONLY
     C                     MOVE '*NUMBER' UKTYPE             Cust.number
     C                     ELSE                            EL INVALID
     C                     MOVE '*ERROR*' UKTYPE  7          Error
     C                     END                             FI
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 4. Check for Nostro :
      *
     C                     TESTN          UKACM2     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF NUMERIC
     C           UKACA1    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA1    ANDLT'0'                         AND ¬NUMERIC
     C           UKACA2    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA2    ANDLT'0'                         AND ¬NUMERIC
     C           UKACA3    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA3    ANDLT'0'                         AND ¬NUMERIC
     C           UKACL5    ANDEQ*BLANK                      AND NO MORE
     C                     MOVE '*NOSTRO' UKTYPE             Nostro
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 5. Check for Customer Shortname :
      *
     C           UKACF1    IFLT '0'                        IF ¬NUMERIC
     C           UKACF1    ANDNE*BLANK                      AND ¬BLANK
     C                     MOVE '*SHNAME' UKTYPE             Shortname
     C                     ELSE                            EL NUMERIC
     C                     MOVE '*ERROR*' UKTYPE             Invalid
     C                     END                             FI
      *          _____________
     C           UKSK01    TAG
      *          ~~~~~~~~~~~~~
     C                     MOVE UKSI90    *IN90            Restore ind.
      *
      *----------------------------------------------------
      *
      *====================================================
     C*SR****     UKEXIT    ENDSR                                         E17819
     CSR         XXOUT     ENDSR                                          E17819
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      *                                                                   CEU013
     C           WWERR     IFEQ 'Y'                                       CEU013
     C                     MOVE 'Y'       WWFLG                           CEU013
     C                     ELSE                                           CEU013
     C                     MOVE 'Y'       WERRF                           CEU013
     C                     ENDIF                                          CEU013
      *                                                                   CEU013
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
      * USER: Exit program processing
      * Start of Fix E28994
      * CASE: CTL.*CMD key is CF03
     C*                                                                   127199
     C** If F3 is pressed during ADD mode, process the entire subfile     127199
     C** to avoid loss of valid records.                                  127199
     C*                                                                   127199
     C           W0PMD     IFEQ 'ADD'                                     127199
     C*                                                                   127199
     C                     EXSR DBPRSF                                    127199
     C*                                                                   127199
     C                     READC#SFLRCD                  92               127199
     C           *IN92     DOWEQ'0'                                       127199
     C           #ERRIN    IFEQ *BLANK                                    127199
     C                     MOVE 'Y'       BTVALI                                             241505A
     C                     EXSR SACRRC                                    127199
     C                     ENDIF                                          127199
     C                     READC#SFLRCD                  92               127199
     C                     ENDDO                                          127199
     C*                                                                   127199
     C                     ENDIF                                          127199
     C*                                                                   127199
      *                                                                                      241505A
      ** For change mode correctly update first BTVALI field before updating                 241505A
      ** GLJENPPD.                                                                           241505A
      *                                                                                      241505A
     C           W0PMD     IFEQ 'CHG'                                                        241505A
      *                                                                                      241505A
     C                     MOVE ' '       TMPERR  1                                          241505A
     C                     MOVE WERRF     TMPERR  1                                          241505A
      *                                                                                      241505A
     C           KLVALD    KLIST                                                             241505A
     C                     KFLD           #3BTNB  3                                          241505A
     C                     KFLD           #3BINB  30                                         241505A
      *                                                                                      241505A
     C           KLVLD2    KLIST                                                             241505A
     C                     KFLD           #4BTNB  3                                          241505A
     C                     KFLD           #4BINB  30                                         241505A
      *                                                                                      241505A
     C                     MOVE BTBTNB    #3BTNB                                             241505A
     C                     Z-ADD1         #3BINB                                             241505A
      *                                                                                      241505A
     C                     MOVE BTBTNB    B5BTNB  3                                          241505A
     C           KLVALD    SETLL@BTREAL                                                      241505A
     C                     READE@BTREAL                  20                                  241505A
      *                                                                                      241505A
     C           *IN20     DOWEQ'0'                                                          241505A
     C                     MOVE *BLANKS   WERRF                                              241505A
     C                     MOVE *BLANKS   WWERR                                              241505A
      *                                                                                      241505A
     C                     MOVE BTBTNB    #4BTNB                                             241505A
     C                     MOVE BTBINB    #4BINB                                             241505A
      *                                                                                      241505A
     C           KLVLD2    CHAIN@BTREAK              1718                                    241505A
     C                     EXSR MBFL#1                                                       241505A
     C           #1RNBE    IFEQ 'Y'                                                          241505A
     C                     MOVEL#1RACN    #RACID                                             241505A
     C                     ELSE                                                              241505A
     C                     MOVEL*BLANK    #RACID                                             241505A
     C                     MOVELBTCUST    #RACID                                             241505A
     C                     ENDIF                                                             241505A
     C                     EXSR DFV2RC                                                       241505A
      *                                                                                      241505A
     C           WERRF     IFEQ *BLANK                                                       241505A
     C                     MOVE 'Y'       BTVALI                                             241505A
     C                     ELSE                                                              241505A
     C                     MOVE 'N'       BTVALI                                             241505A
     C                     ENDIF                                                             241505A
      *                                                                                      241505A
     C                     EXCPTVALID                                                        241505A
     C                     READ @BTREAL                  20                                  241505A
     C           B5BTNB    IFNE BTBTNB                                                       241505A
     C                     MOVE '1'       *IN20                                              241505A
     C                     ENDIF                                                             241505A
      *                                                                                      241505A
     C                     ENDDO                                                             241505A
      *                                                                                      241505A
     C                     ENDIF                                                             241505A
      *                                                                                      241505A
     C                     MOVE TMPERR    WERRF                                              241505A
      *                                                                                      241505A
     C           *IN03     IFEQ '1'                        *IF
     C/COPY WNCPYSRC,GL0121MK81
     C                     MOVEL'CHG'     W0PMD            *Program mode
      * Check For Posting Errors - Standard functions  *
     C                     MOVE ' '       P3EXTO
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
     C                     Z-ADD*ZERO     ##RRMX     81
     C                     MOVEL#2BTNB    BTBTNB           Batch number
     C           KRST      SETLL@BTREAL              82    *
     C  N82      KRST      READE@BTREAL                9182*
     C/COPY WNCPYSRC,GL0121MM21
     C           *IN82     DOWEQ'0'
     C           P3EXTO    ANDEQ' '
     C                     EXSR BBLDSF
     C                     END
     C                     END                             *FI
      * End of Fix E28994
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0121MEPP - Journal Entry Posting  *
     C*00/Copy Member GL0121M   Exit Program Processing
     C/COPY WNCPYSRC,GL0121MEPP
     C                     END                             *FI
     C                     EXSR EAPRSF                                                        214691
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C/COPY WNCPYSRC,GL0121MC25
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
      *****************************************************************                       LLN022
      * SRWNDW  -  Window processing subroutine                       *                       LLN022
      * Called by:                                                    *                       LLN022
      * Calls    : None                                               *                       LLN022
      *****************************************************************                       LLN022
     C           SRWNDW    BEGSR                                                              LLN022
      *                                                                                       LLN022
     C/COPY WNCPYSRC,GL0121MOV1                                                               LLN022
      *                                                                                       LLN022
      **  Call window manager WN0010                                                          LLN022
      *                                                                                       LLN022
     C                     CALL 'WN0010'                                                      LLN022
     C                     PARM ##PGM     #PGM   10                                           LLN022
     C                     PARM           KEY     2                                           LLN022
     C                     PARM *BLANK    ACTION  1                                           LLN022
     C                     PARM           DATA                                                LLN022
     C                     PARM *BLANK    #RTRN   7                                           LLN022
     C                     PARM           SPAREW256                                           LLN022
      *                                                                                       LLN022
      ** Process return code                                                                  LLN022
      *                                                                                       LLN022
     C                     SELEC                                                              LLN022
     C           #RTRN     WHEQ 'Y2U9999'                                                     LLN022
     C           #RTRN     WHEQ 'USR0790'                                                     LLN022
     C           #RTRN     WHNE *BLANKS                                                       LLN022
     C                     MOVEL#RTRN     ZAMSID                                              LLN022
     C                     EXSR ZASNMS                                                        LLN022
     C                     ENDSL                                                              LLN022
      *                                                                                       LLN022
     C                     ENDSR                                                              LLN022
      /EJECT                                                                                  LLN022
      *****************************************************************                       LLN022
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0121MCP1                                           S01408
      *                                                                   S01408
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C/COPY WNCPYSRC,GL0121MC72
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
     C/COPY WNCPYSRC,GL0121MK29
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field S01212
     C                     MOVEL*BLANK    WUFKST  1
      * Define work field Last item number
     C                     Z-ADD*ZERO     WULINB  30
      * Define work field Item error message
     C                     MOVEL*BLANK    WUIEMG 76
      * Define work field Access Pgm Return Code
     C                     MOVEL*BLANK    WUAPRC  7
      * Define work field Currency code
     C                     MOVEL*BLANK    WUCYCD  3
      * Define work field Currency Name
     C                     MOVEL*BLANK    WUCYNM 14
      * Define work field Number of Decimal Places
     C                     Z-ADD*ZERO     WUNBDP  10
      * Define work field Nostro Shortname
     C                     MOVEL*BLANK    WUNOSN 10
      * Define work field Customer number
     C                     MOVEL*BLANK    WUCUST  6
      * Define work field Account code
     C**********           MOVEL*BLANK    WUACCD  4                                           CGL029
     C                     MOVEL*BLANK    WUACCD 10                                           CGL029
      * Define work field Account sequence number
     C                     MOVEL*BLANK    WUACSN  2
      * Define work field Input Branch Code - Alpha
     C                     MOVEL*BLANK    WUIBCA  3
      * Define work field Account type
     C                     MOVEL*BLANK    WUACTY  1
      * Define work field Account subtype
     C                     MOVEL*BLANK    WUBPST  1
      * Define work field Account status
     C                     MOVEL*BLANK    WUACCS  1
      * Define work field Date account opened
     C                     Z-ADD*ZERO     WUDACO  50
      * Define work field Date account CLOSED                             143482
     C                     Z-ADD*ZERO     WUDACC  50                      143482
      * Define work field Account name
     C                     MOVEL*BLANK    WUACNM 20
      * Define work field Retail account number
     C                     Z-ADD*ZERO     WURACN 100
      * Define work field Retail Indicators   MIDAS
     C***********          MOVEL*BLANK    WURETB  1                       152295
     C                     BITOF'01234567'WURETB  1                       152295
      *                                                                   CAC001
      **  Define work field for Profit Centre                             CAC001
      *                                                                   CAC001
     C                     MOVEL*BLANK    WUPRFC  4                       CAC001
      * Define work field Relative rec no of memos
     C                     Z-ADD*ZERO     WURRNM  50
      * Define work field Date Format flag
     C                     MOVEL*BLANK    WUDTFF  1
      * Define work field Date (numeric format)
     C                     Z-ADD*ZERO     WUDTNF  60
      * Define work field Midas Run Date
     C                     MOVEL*BLANK    WUDDCD  7
      * Define work field Display no of items
     C                     MOVEL*BLANK    WUDNIT  1
      * Define work field ZALIGN Screen Fun Field
     C                     MOVEL*BLANK    WUZASF 16
      * Define work field ZALIGN File Field
     C                     MOVEL*BLANK    WUZAFF 16
      * Define work field Error Code
     C                     MOVEL*BLANK    WUERCD  1
      * Define work field Runday Number
     C                     Z-ADD*ZERO     WURDNO  50
      * Define work field Screen Footer / Copy Char
     C                     MOVEL*BLANK    WUSFCC 78
      * Obtain default message file
     C           *NAMVAR   DEFN MIMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field JE Special Character
     C                     MOVEL*BLANK    WUJESP  1
      * Define work field Template Facility Used
     C                     MOVEL*BLANK    WUTFUS  1
      * Define work field Copy:Account identifier
     C                     MOVEL*BLANK    WUCACI 10
      * Define work field Copy:Currency code
     C                     MOVEL*BLANK    WUCCCD  3
      * Define work field Copy:Account code
     C**********           MOVEL*BLANK    WUCPAC  4                                           CGL029
     C                     MOVEL*BLANK    WUCPAC 10                                           CGL029
      * Define work field Copy:Account Sequence
     C                     MOVEL*BLANK    WUCACS  2
      * Define work field Copy:Branch Code - Alpha
     C                     MOVEL*BLANK    WUCBCA  3
      * Define work field Copy:Amount
     C                     MOVEL*BLANK    WUCAMT 14
      * Define work field Copy:DR/CR Indicator
     C                     MOVEL*BLANK    WUCDCI  1
      * Define work field Copy:Narrative
     C/COPY WNCPYSRC,GL0121MM22
     C                     MOVEL*BLANK    WUCNAR 30
     C/COPY WNCPYSRC,GL0121MM23
      * Define work field Copy:Transaction Type
     C                     MOVEL*BLANK    WUCTRT  5
      * Define work field Copy:Cheque Number
     C                     MOVEL*BLANK    WUCCNB  8
      * Define work field Copy:Assoc Cust - Display
     C                     MOVEL*BLANK    WUASSC 10
      * Define work field Copy:Value Date Nbr
     C                     Z-ADD*ZERO     WUCVDN  50
      * Define work field Copy:Value Date
     C                     MOVEL*BLANK    WUCVDT  6
      * Define work field Copy:Swift Common Ref
     C                     MOVEL*BLANK    WUCSCR 16
      * Define work field Copy:Profit Centre
     C                     MOVEL*BLANK    WUCPRC  4
      * Define work field Copy:Transaction Sub-Type
     C                     MOVEL*BLANK    WUCTST 10
      * Define work field Copy:Book Code
     C                     MOVEL*BLANK    WUCBKC  2
      * Define work field Copy:Reverse/Void Ind.
     C                     MOVEL*BLANK    WUCRVI  1
      *                                                                   087770
      * Define work field Tmpl:Account identifier                         087770
     C                     MOVEL*BLANK    WZCACI 10                       087770
      * Define work field Tmpl:Currency code                              087770
     C                     MOVEL*BLANK    WZCCCD  3                       087770
      * Define work field Tmpl:Account code                               087770
     C**********           MOVEL*BLANK    WZCPAC  4                                    087770 CGL029
     C                     MOVEL*BLANK    WZCPAC 10                                           CGL029
      * Define work field Tmpl:Account Sequence                           087770
     C                     MOVEL*BLANK    WZCACS  2                       087770
      * Define work field Tmpl:Branch Code - Alpha                        087770
     C                     MOVEL*BLANK    WZCBCA  3                       087770
      * Define work field Tmpl:Amount                                     087770
     C                     MOVEL*BLANK    WZCAMT 14                       087770
      * Define work field Tmpl:DR/CR Indicator                            087770
     C                     MOVEL*BLANK    WZCDCI  1                       087770
      * Define work field Tmpl:Narrative                                  087770
     C                     MOVEL*BLANK    WZCNAR 30                       087770
      * Define work field Tmpl:Transaction Type                           087770
     C                     MOVEL*BLANK    WZCTRT  5                       087770
      * Define work field Tmpl:Cheque Number                              087770
     C                     MOVEL*BLANK    WZCCNB  8                       087770
      * Define work field Tmpl:Assoc Cust - Display                       087770
     C                     MOVEL*BLANK    WZASSC 10                       087770
      * Define work field Tmpl:Value Date Nbr                             087770
     C                     Z-ADD*ZERO     WZCVDN  50                      087770
      * Define work field Tmpl:Value Date                                 087770
     C                     MOVEL*BLANK    WZCVDT  6                       087770
      * Define work field Tmpl:Swift Common Ref                           087770
     C                     MOVEL*BLANK    WZCSCR 16                       087770
      * Define work field Tmpl:Profit Centre                              087770
     C                     MOVEL*BLANK    WZCPRC  4                       087770
      * Define work field Tmpl:Transaction Sub-Type                       087770
     C                     MOVEL*BLANK    WZCTST 10                       087770
      * Define work field Tmpl:Book Code                                  087770
     C                     MOVEL*BLANK    WZCBKC  2                       087770
      * Define work field Tmpl:Reverse/Void Ind.                          087770
     C                     MOVEL*BLANK    WZCRVI  1                       087770
      *                                                                   087770
      * Define work field Local Currency code
     C                     MOVEL*BLANK    WULCCY  3
      * Define work field Error Located
     C                     MOVEL*BLANK    WUERRL  1
      * Define work field Copy Facility Used
     C                     MOVEL*BLANK    WUCFUS  1
      * Define work field Copy / Template Facility
     C                     MOVEL*BLANK    WUCTFY  1
      * Define work field Account ID Status Flag
     C                     MOVEL*BLANK    WUAISF  7
      * Define work field Ret / Nostro Inval Ac
     C                     MOVEL*BLANK    WURNIA  1
      * Define work field Nostro Number
     C                     MOVEL*BLANK    WUNONB  2
      * Define work field Our Account No. at Nostro
     C*******************  MOVEL*BLANK    WUOANN 14                                           210796
     C                     MOVEL*BLANK    WUOANN 35                                           210796
      * Define work field Our Receive Account
     C                     MOVEL*BLANK    WUORAC 25
      * Define work field Prime Nostro Indicator
     C                     MOVEL*BLANK    WUPNOI  1
      * Define work field Nostro number (Item)
     C                     MOVEL*BLANK    WUNNBI  2
      * Define work field Cust No or Short Inval
     C                     MOVEL*BLANK    WUCNSI  1
      * Define work field Valid Customer Number
     C                     MOVEL*BLANK    WUVCNB  1
      * Define work field SPF Error Condition
     C                     Z-ADD*ZERO     WUSPEC  10
      * Define work field ZALIGN No Of Decimals
     C                     Z-ADD*ZERO     WUZNDE  10
      * Define work field ZALIGN No Of Digits
     C                     Z-ADD*ZERO     WUZNDI  20
      * Define work field Narrative status
     C                     MOVEL*BLANK    WUNRST  7
     C/COPY WNCPYSRC,GL0121MM24
      * Define work field Description of Narrative
     C                     MOVEL*BLANK    WUDON  30
      * Define work field Transaction type
     C                     MOVEL*BLANK    WUTRTY  5
      * Define work field Retail Transaction Name
     C                     MOVEL*BLANK    WURTNM 30
      * Define work field Customer originated ind.
     C                     MOVEL*BLANK    WUCOIN  1
      * Define work field Debit/credit indicator
     C                     MOVEL*BLANK    WUDCIN  1
      * Define work field Reversal Indicator
     C                     MOVEL*BLANK    WURVIN  1
      * Define work field Print Advices Indicator
     C                     MOVEL*BLANK    WUPADI  1
      * Define work field Cheque number
     C                     MOVEL*BLANK    WUCQNB  8
      * Define work field Work Value Date (display)
     C                     MOVEL*BLANK    WUWVDD  6
      * Define work field Forward Day Number
     C                     Z-ADD*ZERO     WUFDNB  50
      * Define work field Location Code
     C                     MOVEL*BLANK    WULCCD  3
      * Define work field Error Ind - Day - Holiday
     C                     MOVEL*BLANK    WUJJST  1
      * Define work field Branch code
     C                     MOVEL*BLANK    WUBRCD  3
      * Define work field Company Code
     C                     MOVEL*BLANK    WUCMCD  3
      * Define work field Due From Account Code
     C**********           MOVEL*BLANK    WUDFAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDFAC 10                                           CGL029
      * Define work field Due To Account Code
     C**********           MOVEL*BLANK    WUDTAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDTAC 10                                           CGL029
      * Define work field Branch Internal Customer
     C                     MOVEL*BLANK    WUBICN  6
      * Define work field Branch Name
     C                     MOVEL*BLANK    WUBRNM 30
      * Define work field Global Branch Code
     C                     MOVEL*BLANK    WUGBCD  3
      * Define work field Branch Shortname
     C                     MOVEL*BLANK    WUBRSN  3
      * Define work field Account Code Name
     C                     MOVEL*BLANK    WUACCN 25
      * Define work field Account Section
     C                     MOVEL*BLANK    WUACSC  2
      * Define work field Account Sub-type
     C                     MOVEL*BLANK    WUACST  1
      * Define work field Client key identity
     C                     MOVEL*BLANK    WUCRST  7
      * Define work field Assoc. Customer number
     C                     MOVEL*BLANK    WUACNB  6
      * Define work field Customer Shortname
     C                     MOVEL*BLANK    WUCSSN 10
      * Define work field DRS Customer Shortname
     C                     MOVEL*BLANK    WUDRCS  7
      * Define work field Account Officer Code
     C                     MOVEL*BLANK    WUACOC  2
      * Define work field Customer Swift Id
     C                     MOVEL*BLANK    WUCSID 12
      * Define work field Book Code
     C                     MOVEL*BLANK    WUBKCD  2
      * Define work field Book Description
     C                     MOVEL*BLANK    WUBKD  30
      * Define work field Hedge Indicator
     C                     MOVEL*BLANK    WUHGIN  1
      * Define work field Automatic Closure ind
     C                     MOVEL*BLANK    WUACIN  1
      * Define work field Book Consolidation Code
     C                     MOVEL*BLANK    WUBKCC  1
      * Define work field ST Amortise Discounts
     C                     MOVEL*BLANK    WUSTAM  1
      * Define work field ST Revalue Mark to Market
     C                     MOVEL*BLANK    WUSTRM  1
      * Define work field ST Exposure Percentage
     C                     Z-ADD*ZERO     WUSTEP  30
      * Define work field Include In Account Key
     C                     MOVEL*BLANK    WUIACK  1
      * Define work field Profit Centres Used
     C                     MOVEL*BLANK    WUPRCU  1
      * Define work field Profit centre
     C                     MOVEL*BLANK    WUPRCN  4
      * Define work field Profit Centre Description
     C                     MOVEL*BLANK    WUPCDS 30
      * Define work field Profit Centre Def'ts Used
     C                     MOVEL*BLANK    WUPCDU  1
      * Define work field Multiple Branch Batch
     C                     MOVEL*BLANK    WUMBRB  1
      * Define work field Abbreviated Posting?
     C                     MOVEL*BLANK    WUABPS  1
      * Define work field Account Identifier
     C                     MOVEL*BLANK    WUACID 10
      * Define work field Midas Rundate
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Setup Complete
     C                     MOVEL*BLANK    WUSUCP  1
      * Define work field Multibranching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Define work field User
     C                     MOVEL*BLANK    WUUSID 10
      * Define work field User Default Branch Code
     C                     MOVEL*BLANK    WUUDBC  3
      * Define work field User Default Department
     C                     MOVEL*BLANK    WUUDDP  3
      * Define work field User Bank Level Authority
     C                     MOVEL*BLANK    WUUBLA  1
      * Define work field General Ledger
     C                     MOVEL*BLANK    WUGNLG 10
      * Define work field Profit & Loss Accnt Code
     C**********           MOVEL*BLANK    WUPLAC  4                                           CGL029
     C                     MOVEL*BLANK    WUPLAC 10                                           CGL029
      * Define work field Base Currency Transfer Fq
     C                     MOVEL*BLANK    WUBCTF  1
      * Define work field Accrual Key Summary Ind.
     C                     MOVEL*BLANK    WUAKSI  1
      * Define work field Accruals/Profit Date
     C                     Z-ADD*ZERO     WUAPDT  50
      * Define work field Accruals/Profit Frequency
     C                     MOVEL*BLANK    WUAPFQ  1
      * Define work field Accruals/Profit Fq. Day
     C                     Z-ADD*ZERO     WUAPFD  20
      * Define work field Accrue on Last Day Ind.
     C                     MOVEL*BLANK    WUALDI  1
      * Define work field A/c Posting Retention Pd
     C                     Z-ADD*ZERO     WUAPRP  20
      * Define work field Accrual Non-Wk Day Ind
     C                     MOVEL*BLANK    WUANWD  1
      * Define work field Spot Rates Retention Pd
     C                     Z-ADD*ZERO     WUSRRP  20
      * Define work field Base Rates Retention Pd
     C                     Z-ADD*ZERO     WUBRRP  20
      * Define work field GL Description Ind.
     C                     MOVEL*BLANK    WUGLDI  1
      * Define work field Profit Centres Amendable
     C                     MOVEL*BLANK    WUPRCA  1
      * Define work field Prof C Def Matrix-Book
     C                     MOVEL*BLANK    WUPMBK  1
      * Define work field Prof C Def Matrix-T Type
     C                     MOVEL*BLANK    WUPMTT  1
      * Define work field Prof C Def Matrix-S Type
     C                     MOVEL*BLANK    WUPMST  1
      * Define work field Prof C Def Matrix-Branch
     C                     MOVEL*BLANK    WUPMBH  1
      * Define work field Prof C Def Matrix-Dept
     C                     MOVEL*BLANK    WUPMDT  1
      * Define work field Prof C Def Matrix-User
     C                     MOVEL*BLANK    WUPMUR  1
      * Define work field Prof C Def Matrix-A/c Off
     C                     MOVEL*BLANK    WUPMAO  1
      * Define work field Prof C Def Matrix-Cust
     C                     MOVEL*BLANK    WUPMCU  1
      * Define work field Originating Branch Used
     C                     MOVEL*BLANK    WUOBRU  1
      * Define work field Orig Branch User/Vald Req
     C                     MOVEL*BLANK    WUOBUV  1
      * Define work field JE Int-Bch Ents @ Bch/Itm
     C                     MOVEL*BLANK    WUIEBI  1
      * Define work field Main Branch
     C                     MOVEL*BLANK    WUMABR  3
      * Define work field Int-Bch Ent Via Main Brch
     C                     MOVEL*BLANK    WUIEMB  1
      * Define work field End of Last Activity Per.
     C                     Z-ADD*ZERO     WUELAP  50
      * Define work field End of Current Act Period
     C                     Z-ADD*ZERO     WUECAP  50
      * Define work field Last Day Accrual Ind.
     C                     MOVEL*BLANK    WULDAI  1
      * Define work field Cleared Balance Accr. Ind
     C                     MOVEL*BLANK    WUCBAI  1
      * Define work field No. Days Forward Value
     C                     Z-ADD*ZERO     WUNDFV  30
      * Define work field Rate Change Print Ind.
     C                     MOVEL*BLANK    WURCPI  1
      * Define work field Retail A/C Nos. Required?
     C                     MOVEL*BLANK    WURANR  1
      * Define work field No. Days Before Inactive
     C                     Z-ADD*ZERO     WUNDBI  30
      * Define work field Branch name on Retail Adv
     C                     MOVEL*BLANK    WUBNRA  1
      * Define work field Midas/Telex Module Ind.
     C                     MOVEL*BLANK    WUMTMI  1
      * Define work field SWIFT Funds Transfer
     C                     MOVEL*BLANK    WUSWFT  1
      * Define work field SWIFT Securities Trading
     C                     MOVEL*BLANK    WUSWST  1
      * Define work field SWIFT Customer Lending
     C                     MOVEL*BLANK    WUSWCL  1
      * Define work field SWIFT Syndicated Loans
     C                     MOVEL*BLANK    WUSWSL  1
      * Define work field SWIFT Statements
     C                     MOVEL*BLANK    WUSWSM  1
      * Define work field SWIFT Dealing
     C                     MOVEL*BLANK    WUSWDL  1
      * Define work field Standing data/Gen.Ledger
     C                     MOVEL*BLANK    WUSDGL  1
      * Define work field Dealing: FX
     C                     MOVEL*BLANK    WUDLFX  1
      * Define work field Syndicated Loans
     C                     MOVEL*BLANK    WUSYLN  1
      * Define work field Exposure Management
     C                     MOVEL*BLANK    WUEXMG  1
      * Define work field Financial Modeller
     C                     MOVEL*BLANK    WUFNMO  1
      * Define work field Statutary Returns
     C                     MOVEL*BLANK    WUSTRT  1
      * Define work field Customer Lending
     C                     MOVEL*BLANK    WUCSLN  1
      * Define work field Retail Banking
     C                     MOVEL*BLANK    WURTBN  1
      * Define work field Midas/Swift direct link
     C                     MOVEL*BLANK    WUMSDL  1
      * Define work field Securities
     C                     MOVEL*BLANK    WUSECS  1
      * Define work field Auto-reconciliations
     C                     MOVEL*BLANK    WUAURC  1
      * Define work field Bond Dealers Interface
     C                     MOVEL*BLANK    WUBDLI  1
      * Define work field DRS Standing Data
     C                     MOVEL*BLANK    WUDRSD  1
      * Define work field DRS Control module
     C                     MOVEL*BLANK    WUDRCM  1
      * Define work field DRS Foreign Exchange
     C                     MOVEL*BLANK    WUDRFE  1
      * Define work field DRS Money Market
     C                     MOVEL*BLANK    WUDRMM  1
      * Define work field DRS Arbitrage
     C                     MOVEL*BLANK    WUDRAR  1
      * Define work field Funds Transfer
     C                     MOVEL*BLANK    WUFDTR  1
      * Define work field DRS Common Applications
     C                     MOVEL*BLANK    WUDRCA  1
      * Define work field Futures & Options
     C                     MOVEL*BLANK    WUFUOP  1
      * Define work field Midas/Telex Synd. Loans
     C                     MOVEL*BLANK    WUMTSL  1
      * Define work field Midas/Telex Dealing
     C                     MOVEL*BLANK    WUMTDL  1
      * Define work field Midas/Telex Gen. Ledger
     C                     MOVEL*BLANK    WUMTGL  1
      * Define work field Midas/Telex Cust. Lending
     C                     MOVEL*BLANK    WUMTCL  1
      * Define work field Network Midas
     C                     MOVEL*BLANK    WUNWMI  1
      * Define work field FRA/IRS Indicator
     C                     MOVEL*BLANK    WUFIIN  1
      * Define work field Dealing: MM
     C                     MOVEL*BLANK    WUDLMM  1
      * Define work field Internal Contracts
     C                     MOVEL*BLANK    WUINCN  1
      * Define work field Treasury Management
     C                     MOVEL*BLANK    WUTRMG  1
      * Define work field Risk Management
     C                     MOVEL*BLANK    WURKMG  1
      * Define work field Testkey
     C                     MOVEL*BLANK    WUTSKY  1
      * Define work field Midas/Q
     C                     MOVEL*BLANK    WUMIDQ  1
      * Define work field Microfiche
     C                     MOVEL*BLANK    WUMFIC  1
      * Define work field Interest on accounts
     C                     MOVEL*BLANK    WUIOAC  1
      * Define work field Window processing requir.
     C                     MOVEL*BLANK    WUWDPR  1
      * Define work field SAR's processing required
     C                     MOVEL*BLANK    WUSARP  1
      * Define work field French  return indicator
     C                     MOVEL*BLANK    WUFRIN  1
      * Define work field Lux     return indicator
     C                     MOVEL*BLANK    WULRIN  1
      * Define work field Dutch   return indicator
     C                     MOVEL*BLANK    WUDRIN  1
      * Define work field German  return indicator
     C                     MOVEL*BLANK    WUGRIN  1
      * Define work field Belgian return indicator
     C                     MOVEL*BLANK    WUBRIN  1
      * Define work field Italian return indicator
     C                     MOVEL*BLANK    WUIRIN  1
      * Define work field Swift External Interface
     C                     MOVEL*BLANK    WUSWEI  1
      * Define work field Portfolio Management
     C                     MOVEL*BLANK    WUPFMG  1
      * Define work field Credit Management.
     C                     MOVEL*BLANK    WUCRMG  1
      * Define work field Head Office Reporting
     C                     MOVEL*BLANK    WUHORP  1
      * Define work field Average Balances
     C                     MOVEL*BLANK    WUAVBL  1
      * Define work field Margins
     C                     MOVEL*BLANK    WUMARG  1
      * Define work field Taxes
     C                     MOVEL*BLANK    WUNTST  1
      * Define work field Retail 3
     C                     MOVEL*BLANK    WUNXST  1
      * Define work field Interest on Accounts 3
     C                     MOVEL*BLANK    WUNYST  1
      *                                                                   CAC001
      **  Define work field Analytical Accounting                         CAC001
      *                                                                   CAC001
     C                     MOVEL*BLANK    WUN0ST  1                       CAC001
      *                                                                                       204679
      ** Define work field for Private Banking                                                204679
      *                                                                                       204679
     C                     MOVEL*BLANK    WUN4ST  1                                           204679
      *                                                                                       204679
      ** Define work fields for Front Office ID                                               204679
      *                                                                                       204679
     C                     MOVEL*BLANK    WFRNT1  2                                           204679
     C                     MOVEL*BLANK    WFRNT2  2                                           204679
      *                                                                                       204679
      * Define work field Charge for Mult Transacts
     C                     MOVEL*BLANK    WUCHMT  1
     C* Define work field 'In' Currency flag of Posting currency          CEU013
     C                     MOVE *BLANK    WUINCY  1        'In' Currency  CEU013
     C                     MOVE *BLANKS   WUCOCY  3        Copy:Origin ccyCEU013
     C                     MOVE *BLANKS   WUCOAM 16        Copy:Origin amtCEU013
     C                     MOVE *BLANKS   WZCOCY  3        Tmpl:Origin ccyCEU013
     C                     MOVE *BLANKS   WZCOAM 16        Tmpl:Origin amtCEU013
     C                     MOVE *BLANKS   WKSKIP  1        Skip warning   CEU013
     C                     MOVE *BLANKS   WWFLG   1        Warning flag   CEU013
     C                     MOVE *BLANKS   WERRF   1        Error found flgCEU013
     C                     MOVE *BLANKS   WWERR   1        Warning work flCEU013
     C           *NAMVAR   DEFN           GLREOV           Override DTAARA
     C                     IN   GLREOV                     Obtain   DTAARA
      *
      * Set highlights for error message line :
      *
     C                     MOVE *LOVAL    URNORM  1        ¦ Highlight 0
     C                     BITON'2'       URNORM           ¦ NORMAL
      *
     C                     MOVE *LOVAL    URRIHS  1        ¦ Highlight 1
     C                     BITON'27'      URRIHS           ¦ RI/STEADY
      *
     C                     MOVE *LOVAL    URRIHF  1        ¦ Highlight 2
     C                     BITON'2467'    URRIHF           ¦ RI/HI/BLINK
     C/COPY WNCPYSRC,GL0121MK03
      *
     C                     Z-ADD03        ##SFPG  30       SFLPAG
     C/COPY WNCPYSRC,GL0121MC31
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD500       W0SLM   50
      *................................................................
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL'Y'       W0APM   1
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialise program
      * Standard RPG Creation Par - Standard functions  *
      * Last Amend Box - GL0121M - Journal Entry Posting  *
      * Window Processing Hdr Box - Standard functions  *
      * Copyright notice - Standard functions  *
      * Start of S01314
      * Multi-Language - GL0121M - Journal Entry Posting  *
      *
      * Call SDRTVTXT pgm to access text for a field used in the SFL
      *
     C* Type
     C                     MOVEL'ZZGBMSGF'MSGNM
     C                     MOVEL'ZZM3781' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM002                          MD0015
     C                     MOVELMSGTXT    ZZM002  4                       MD0015
     C* Sub Type
     C                     MOVEL'ZZM6338' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C                     MOVELMSGTXT    ZZM003
     C***********          MOVELMSGTXT    ZZM003                          MD0015
     C                     MOVELMSGTXT    ZZM003  8                       MD0015
     C* Value Date
     C                     MOVEL'ZZM0251' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM004                          MD0015
     C                     MOVELMSGTXT    ZZM004 10                       MD0015
      * Cheque
     C                     MOVEL'ZZM1718' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM005                          MD0015
     C                     MOVELMSGTXT    ZZM005  6                       MD0015
      * SWIFT
     C                     MOVEL'ZZM6340' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM006                          MD0015
     C                     MOVELMSGTXT    ZZM006  5                       MD0015
      * Profit Centre
     C                     MOVEL'ZZM3784' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM007                          MD0015
     C                     MOVELMSGTXT    ZZM007 13                       MD0015
      * Associated Customer
     C                     MOVEL'ZZM3782' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM008                          MD0015
     C                     MOVELMSGTXT    ZZM008 19                       MD0015
      * Book Code
     C                     MOVEL'ZZM6326' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C                     MOVELMSGTXT    ZZM009
     C***********          MOVELMSGTXT    ZZM009                          MD0015
     C                     MOVELMSGTXT    ZZM009  9                       MD0015
      * Void                                                              S17036
     C                     MOVEL'ZZM8180' MSGDNB                          S17036
     C                     CALL 'SDRTVTXT'                                S17036
     C                     PARM           MSGDNB  7                       S17036
     C                     PARM           MSGNM  10                       S17036
     C                     PARM           MSGTXT 80                       S17036
     C***********          MOVELMSGTXT    ZZM010                    S17036MD0015
     C                     MOVELMSGTXT    ZZM010  4                       MD0015
      * No. Items                                                         S01413
     C***********          MOVEL'ZZM8536' MSGDNB                    S01413063607
     C                     MOVEL'ZZM9271' MSGDNB                          063607
     C                     CALL 'SDRTVTXT'                                S01413
     C                     PARM           MSGDNB  7                       S01413
     C                     PARM           MSGNM  10                       S01413
     C                     PARM           MSGTXT 80                       S01413
     C***********          MOVELMSGTXT    ZZM011                    S01413MD0015
     C                     MOVELMSGTXT    ZZM011  9                       MD0015
      * Override                                                          S10736
     C                     MOVEL'ZZM0384' MSGDNB                          S10736
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM010                          S10736
     C***********          MOVELMSGTXT    ZZM011                    S10736S01413
     C***********          MOVELMSGTXT    ZZM012                    S01413MD0015
     C                     MOVELMSGTXT    ZZM012  8                       MD0015
      * Original Ccy/Amount                                               CEU013
     C                     MOVEL'ZZN5915' MSGDNB                          CEU013
     C                     CALL 'SDRTVTXT'                                CEU013
     C                     PARM           MSGDNB  7                       CEU013
     C                     PARM           MSGNM  10                       CEU013
     C                     PARM           MSGTXT 80                       CEU013
     C                     MOVELMSGTXT    ZZM013 19                       CEU013
     C/COPY WNCPYSRC,GL0121MK04
      *
      * End of S01314
      * Setup message data for message
      * Retrieve message Lots of Dots
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0083' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUIEMG    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
     C                     Z-ADD*ZERO     WULINB           Last item numbe
      * Define 200 Byte Dummy DS - Standard functions  *
      * Define 800 Byte Dummy DS - Standard functions  *
      * Access Midas rundate - Standard functions  *
     C*   Access MIDAS Rundate from data-area RUNDAT
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT
     C                     MOVE RDNO      WURDNO
     C                     MOVE SUCP      WUSUCP
     C                     MOVE DTFF      WUDTFF
     C                     MOVE MBIN      WUMBIN
      * Account Codes DS - Account Codes  *
      * Book Codes DS - Book Codes  *
      * Account Details DS - Standard functions  *
      * Declare Bank File DS - Standard functions  *
      * Branch Codes DS - Branch Codes  *
      * Client Details DS - Client Details  *
      * Currency Codes DS - Currency Codes  *
      * Nostro Details DS - Nostro Details  *
      * Narrative Codes DS - Narrative Codes  *
      * Profit Centre DS - Profit Centres  *
      * Prof C Def Matrix DS - Profit Centre Dft Matrix  *
      * Retail Transactions DS - Retail Transaction Types  *
      * General Ledger Details DS - General Ledger Details  *
      * START - E19779
      * Retail Details DS - Retail Details  *
      * END - E19779
     C                     MOVEL'Y'       WUFKST           S01212
      * Start of Fix E17939
      * RTV Last Batch Item - Standard functions  *
     C                     CALL 'GL0137U'              90  RTV Last Batch
     C                     PARM P1BTNB    WQ0068  3        Batch number
     C           WULINB    PARM *ZERO     WQ0069  30       Last item numbe
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * End of Fix E17939
     C                     MOVEL'N'       WUCTFY           Copy / Template
     C                     MOVEL'N'       WUTFUS           Template Facili
     C                     MOVEL'N'       WUCFUS           Copy Facility U
      * Access ZMUSER - Standard functions  *
     C*
     C* Access data-area ZMUSER
     C*
     C           *NAMVAR   DEFN           ZMUSER
     C                     IN   ZMUSER
     C                     MOVE USID      WUUSID           User Profile
     C                     MOVE UDBC      WUUDBC           User Def Branch
     C                     MOVE UDDP      WUUDDP           User Def Dept
     C                     MOVE UBLA      WUUBLA           User Bank Lvl A
      * Access General Ledger. - General Ledger Details  *
     C*
     C*  Access General Ledger Details file for it' file fields
     C*
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*FIRST'  UUAPOP  7        I:Option
     C********** D@GELR    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@GELR    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELBKGNLG    WUGNLG           General Ledger
     C                     MOVELBKACCD    WUACCD           Account Code
     C                     MOVELBKPLAC    WUPLAC           Profit & Loss Account
     C                     MOVELBKCUST    WUCUST           Cutomer Number
     C                     MOVELBKBCTF    WUBCTF           Base Currency Tran
     C                     MOVELBKAKSI    WUAKSI           Accrual Key summary
     C                     MOVELBKAPDT    WUAPDT           Accruals Profit Date
     C                     MOVELBKAPFQ    WUAPFQ           Accruals Profit Freq
     C                     MOVELBKAPFD    WUAPFD           Accruals Profit Fr Dy
     C                     MOVELBKALDI    WUALDI           Accrue on Last Day
     C                     MOVELBKAPRP    WUAPRP           A/c Posting Ret Pd.
     C                     MOVELBKANWD    WUANWD           Accrual non-wk Day
     C                     MOVELBKSRRP    WUSRRP           Spot Rates Retention
     C                     MOVELBKBRRP    WUBRRP           Base Rates Retention
     C                     MOVELBKGLDI    WUGLDI           GL Description Ind
     C                     MOVELBKPRCU    WUPRCU           Profit Centres Used
     C                     MOVELBKPRCA    WUPRCA           Profit Centres Amend
     C                     MOVELBKPCDU    WUPCDU           Profit Centre Default
     C                     MOVELBKPMBK    WUPMBK           Prof C Matrix Book
     C                     MOVELBKPMTT    WUPMTT           Prof C Matrix Trans
     C                     MOVELBKPMST    WUPMST           Prof C Matrix SubType
     C                     MOVELBKPMBH    WUPMBH           Prof C Matrix Branch
     C                     MOVELBKPMDT    WUPMDT           Prof C Matrix Dept
     C                     MOVELBKPMUR    WUPMUR           Prof C Matrix User
     C                     MOVELBKPMAO    WUPMAO           Prof C Matrix Acc Off
     C                     MOVELBKPMCU    WUPMCU           Prof C Matrix Cust
     C                     MOVELBKOBRU    WUOBRU           Originating Branch Ud
     C                     MOVELBKOBUV    WUOBUV           Orig Branch/User Vald
     C                     MOVELBKJESP    WUJESP           Copy Special Char
     C                     MOVELBKELAP    WUELAP           End of Last Activity
     C                     MOVELBKECAP    WUECAP           End of Curnt Activity
     C*                                                                   084499
      * Check if Retail 3 is on, and if Charges for Multiple Transaction  084499
      * is Y. If both true, Number of Items will display.                 084499
      * MIDAS Modules DS - MIDAS Modules  *                               084499
      * Access MIDAS Modules. - MIDAS Modules  *                          084499
     C*                                                                   084499
     C*  Access Midas Modules file for the file fields                    084499
     C*                                                                   084499
     C                     CALL 'AOMMODR0'                                084499
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    084499
     C                     PARM '*FIRST'  UUAPOP  7        I:Option       084499
     C           D@MMOD    PARM *BLANK    UUFDY            O:Format       084499
     C*                                                                   084499
     C* Assign work field to file field values.                           084499
     C*                                                                   084499
     C                     MOVELBGMTMI    WUMTMI           Midas/Telex    084499
     C                     MOVELBGSWFT    WUSWFT           SWIFT FT       084499
     C                     MOVELBGSWST    WUSWST           SWIFT SE       084499
     C                     MOVELBGSWCL    WUSWCL           SWIFT LE       084499
     C                     MOVELBGSWSL    WUSWSL           SWIFT Synd Loan084499
     C                     MOVELBGSWSM    WUSWSM           SWIFT Stmts    084499
     C                     MOVELBGSWDL    WUSWDL           SWIFT Dealing  084499
     C                     MOVELBGSDGL    WUSDGL           SD/GL          084499
     C                     MOVELBGDLFX    WUDLFX           Dealing : FX   084499
     C                     MOVELBGSYLN    WUSYLN           Synd Loans     084499
     C                     MOVELBGEXMG    WUEXMG           Exposure Mgmt  084499
     C                     MOVELBGFNMO    WUFNMO           Financial Mod  084499
     C                     MOVELBGSTRT    WUSTRT           Stat Returns   084499
     C                     MOVELBGCSLN    WUCSLN           Lending        084499
     C                     MOVELBGRTBN    WURTBN           Retail Banking 084499
     C                     MOVELBGMSDL    WUMSDL           Midas/SWIFT D l084499
     C                     MOVELBGSECS    WUSECS           Securities     084499
     C                     MOVELBGAURC    WUAURC           Auto-Recs      084499
     C                     MOVELBGBDLI    WUBDLI           Bond Dealers   084499
     C                     MOVELBGDRSD    WUDRSD           DRS SD         084499
     C                     MOVELBGDRCM    WUDRCM           DRS Cont Mod   084499
     C                     MOVELBGDRFE    WUDRFE           DRS FX         084499
     C                     MOVELBGDRMM    WUDRMM           DRS MM         084499
     C                     MOVELBGDRAR    WUDRAR           DRS Arbitrage  084499
     C                     MOVELBGFDTR    WUFDTR           Funds Transfer 084499
     C                     MOVELBGDRCA    WUDRCA           DRS Common App 084499
     C                     MOVELBGFUOP    WUFUOP           Futures & Ops  084499
     C                     MOVELBGMTSL    WUMTSL           Midas/Telex SL 084499
     C                     MOVELBGMTDL    WUMTDL           Midas/Telex DL 084499
     C                     MOVELBGMTGL    WUMTGL           Midas/Telex GL 084499
     C                     MOVELBGMTCL    WUMTCL           Midas/Telex LE 084499
     C                     MOVELBGNWMI    WUNWMI           Network Midas  084499
     C                     MOVELBGFIIN    WUFIIN           FRA/IRS        084499
     C                     MOVELBGDLMM    WUDLMM           Dealing: MM    084499
     C                     MOVELBGINCN    WUINCN           Int Contracts  084499
     C                     MOVELBGTRMG    WUTRMG           TM             084499
     C                     MOVELBGRKMG    WURKMG           Risk Management084499
     C                     MOVELBGTSKY    WUTSKY           TestKey        084499
     C                     MOVELBGMIDQ    WUMIDQ           Midas Q        084499
     C                     MOVELBGMFIC    WUMFIC           Microfiche     084499
     C                     MOVELBGIOAC    WUIOAC           Int on Accounts084499
     C                     MOVELBGWDPR    WUWDPR           Window Proc Req084499
     C                     MOVELBGSARP    WUSARP           SAR's Proc Req 084499
     C                     MOVELBGFRIN    WUFRIN           French Returns 084499
     C                     MOVELBGLRIN    WULRIN           Lux Return Ind 084499
     C                     MOVELBGDRIN    WUDRIN           Dutch Return   084499
     C                     MOVELBGGRIN    WUGRIN           German Return  084499
     C                     MOVELBGBRIN    WUBRIN           Belgian Return 084499
     C                     MOVELBGIRIN    WUIRIN           Italian Return 084499
     C                     MOVELBGSWEI    WUSWEI           SWIFT Ext Int  084499
     C                     MOVELBGPFMG    WUPFMG           Portfolio Mgmt 084499
     C                     MOVELBGCRMG    WUCRMG           Credit Mgmt    084499
     C                     MOVELBGHORP    WUHORP           H.O. Reporting 084499
     C                     MOVELBGAVBL    WUAVBL           Av. Balances   084499
     C                     MOVELBGMARG    WUMARG           Margins        084499
     C                     MOVELBGNTST    WUNTST           Taxes          084499
     C                     MOVELBGNXST    WUNXST           Retail 3       084499
     C                     MOVELBGNYST    WUNYST           Int on A/C 3   084499
     C                     MOVELBGN0ST    WUN0ST           Anal. Acctg.   CAC001
      *                                                                                       204679
      ** Assign work field to Private Banking file field value                                204679
      *                                                                                       204679
     C                     MOVELBGN4ST    WUN4ST                                              204679
     C*                                                                   084499
     C                     MOVEL'N'       WUDNIT           Display no of i084499
      * START - E19779
      * Access Retail Details - Retail Details  *
     C*
     C*  Access Retail Details types for the file fields
     C** Only if RETAIL switched on.                                      084499
     C*
     C           BGRTBN    IFEQ 'Y'                                       084499
     C                     CALL 'AORETLR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*FIRST'  UUAPOP  7        I:Option
     C           D@RETL    PARM *BLANK    UUFDY            O:Format
     C                     END                                            084499
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVE BMACCD    WUACCD
     C                     MOVE BMLDAI    WULDAI
     C                     MOVE BMCBAI    WUCBAI
     C                     MOVE BMNDFV    WUNDFV
     C                     MOVE BMRCPI    WURCPI
     C                     MOVE BMRANR    WURANR
     C                     MOVE BMNDBI    WUNDBI
     C                     MOVE BMBNRA    WUBNRA
     C           WURDNO    ADD  WUNDFV    WUFDNB           Forward Day Num
      * END - E19779
      * start S01413
      ********                                                            084499
      ** MOVE CODE TO BEFORE ACCESS OF RETAIL ICD FILE                    084499
      **Check*if Retail 3 is on, and if Charges for Multiple Transaction  084499
      **is*Y.*If both true, Number of Items will display.                 084499
      **MIDAS*Modules DS - MIDAS Modules  *                               084499
      **Access MIDAS Modules. - MIDAS Modules  *                          084499
     C********                                                            084499
     C***Access Midas Modules file for the file fields                    084499
     C********                                                            084499
     C********             CALL 'AOMMODR0'                                084499
     C********   WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    084499
     C********             PARM '*FIRST'  UUAPOP  7        I:Option       084499
     C********   D@MMOD    PARM *BLANK    UUFDY            O:Format       084499
     C********                                                            084499
     C**Assign work field to file field values.                           084499
     C********                                                            084499
     C********             MOVELBGMTMI    WUMTMI           Midas/Telex Mod084499
     C********             MOVELBGSWFT    WUSWFT           SWIFT Funds Tra084499
     C********             MOVELBGSWST    WUSWST           SWIFT Securitie084499
     C********             MOVELBGSWCL    WUSWCL           SWIFT Customer 084499
     C********             MOVELBGSWSL    WUSWSL           SWIFT Syndicate084499
     C********             MOVELBGSWSM    WUSWSM           SWIFT Statement084499
     C********             MOVELBGSWDL    WUSWDL           SWIFT Dealing  084499
     C********             MOVELBGSDGL    WUSDGL           Standing Data/G084499
     C********             MOVELBGDLFX    WUDLFX           Dealing : FX   084499
     C********             MOVELBGSYLN    WUSYLN           Syndicated Loan084499
     C********             MOVELBGEXMG    WUEXMG           Exposure Manage084499
     C********             MOVELBGFNMO    WUFNMO           Financial Model084499
     C********             MOVELBGSTRT    WUSTRT           Statuatory Retu084499
     C********             MOVELBGCSLN    WUCSLN           Customer Lendin084499
     C********             MOVELBGRTBN    WURTBN           Retail Banking 084499
     C********             MOVELBGMSDL    WUMSDL           Midas/SWIFT Dir084499
     C********             MOVELBGSECS    WUSECS           Securities     084499
     C********             MOVELBGAURC    WUAURC           Auto-Reconcilli084499
     C********             MOVELBGBDLI    WUBDLI           Bond Dealers In084499
     C********             MOVELBGDRSD    WUDRSD           DRS Standing Da084499
     C********             MOVELBGDRCM    WUDRCM           DRS Control Mod084499
     C********             MOVELBGDRFE    WUDRFE           DRS Foreign Exc084499
     C********             MOVELBGDRMM    WUDRMM           DRS Money Marke084499
     C********             MOVELBGDRAR    WUDRAR           DRS Arbitrage  084499
     C********             MOVELBGFDTR    WUFDTR           Funds Transfer 084499
     C********             MOVELBGDRCA    WUDRCA           DRS Common Appl084499
     C********             MOVELBGFUOP    WUFUOP           Futures & Optio084499
     C********             MOVELBGMTSL    WUMTSL           Midas/Telex Syn084499
     C********             MOVELBGMTDL    WUMTDL           Midas/Telex Dea084499
     C********             MOVELBGMTGL    WUMTGL           Midas/Telex Gen084499
     C********             MOVELBGMTCL    WUMTCL           Midas/Telex Cus084499
     C********             MOVELBGNWMI    WUNWMI           Network Midas  084499
     C********             MOVELBGFIIN    WUFIIN           FRA/IRS Indicat084499
     C********             MOVELBGDLMM    WUDLMM           Dealing:Money M084499
     C********             MOVELBGINCN    WUINCN           Internal Contra084499
     C********             MOVELBGTRMG    WUTRMG           Treasury Manage084499
     C********             MOVELBGRKMG    WURKMG           Risk Management084499
     C********             MOVELBGTSKY    WUTSKY           TestKey        084499
     C********             MOVELBGMIDQ    WUMIDQ           Midas Q        084499
     C********             MOVELBGMFIC    WUMFIC           Microfiche     084499
     C********             MOVELBGIOAC    WUIOAC           Interest on Acc084499
     C********             MOVELBGWDPR    WUWDPR           Window Processi084499
     C********             MOVELBGSARP    WUSARP           SAR's Processin084499
     C********             MOVELBGFRIN    WUFRIN           French Return I084499
     C********             MOVELBGLRIN    WULRIN           Lux Return Ind 084499
     C********             MOVELBGDRIN    WUDRIN           Dutch Return In084499
     C********             MOVELBGGRIN    WUGRIN           German Return I084499
     C********             MOVELBGBRIN    WUBRIN           Belgian Return 084499
     C********             MOVELBGIRIN    WUIRIN           Italian Return 084499
     C********             MOVELBGSWEI    WUSWEI           SWIFT External 084499
     C********             MOVELBGPFMG    WUPFMG           Portfolio Manag084499
     C********             MOVELBGCRMG    WUCRMG           Credit Manageme084499
     C********             MOVELBGHORP    WUHORP           H.O. Reporting 084499
     C********             MOVELBGAVBL    WUAVBL           Average Balance084499
     C********             MOVELBGMARG    WUMARG           Margins        084499
     C********             MOVELBGNTST    WUNTST           Taxes   S01413 084499
     C********             MOVELBGNXST    WUNXST           Retail  S01413 084499
     C********             MOVELBGNYST    WUNYST           Int on  S01413 084499
     C********                                                            084499
     C********             MOVEL'N'       WUDNIT           Display no of i084499
      * CASE: WRK.Retail 3 is Yes
     C           WUNXST    IFEQ 'Y'                        *IF
      * Get Chrg for mult trans - Standard functions  *
     C                     CALL 'SD9343'               90  Get Chrg for mu
     C           W0RTN     PARM W0RTN     WQ0070  7        *Return code
     C           WUCHMT    PARM *BLANK    WQ0071  1        Charge for Mult
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: WRK.Charge for Mult Transacts is Yes
     C           WUCHMT    IFEQ 'Y'                        *IF
     C                     MOVEL'Y'       WUDNIT           Display no of i
     C                     END                             *FI
     C                     END                             *FI
      * end S01413
      * Start of Fix LN0312
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
      * Setup message data for message
      * Retrieve message Subfile Select Details
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0204' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUSFCC    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Set Screen Ftr Copy Char - Standard functions  *
     C* Move Copy Special Character Message into screen footer field
     C*                                                                   S01117
     C                     MOVELWUSFCC    ##CTX1
     C*
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C*                                                                   101696
     C** Display special character text only when copy facility is used.  101696
     C*                                                                   101696
     C           WUCFUS    IFEQ 'Y'                                       101696
     C                     MOVELWUJESP    ZA0143           JE Special Char
      * Retrieve message Copy Special Char Add Mod
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0222' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUSFCC    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Set Screen Ftr Copy Char - Standard functions  *
     C* Move Copy Special Character Message into screen footer field
     C*                                                                   S01117
     C                     MOVELWUSFCC    ##CTX1
     C                     ELSE                                           101696
     C                     MOVEL*BLANKS   ##CTX1                          101696
     C                     ENDIF                                          101696
     C*
     C                     END                             *FI
      * End of Fix LN0312
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0121MIPG - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0121MCPG
     C                     END                             *FI
      *                                                                   CGL002
      ** Check if Block GL Accounts Enhancement feature is installed      CGL002
      *                                                                   CGL002
     C                     CALL 'AOSARDR0'                                CGL002
     C           WUAPRC    PARM WUAPRC    UUAPRC  7                       CGL002
     C                     PARM '*VERIFY' UUAPOP  7                       CGL002
     C                     PARM 'CGL002'  UUSARN  6                       CGL002
     C           D@SARD    PARM *BLANKS   UUFDY                           CGL002
      *                                                                   CGL002
     C           WUAPRC    IFEQ *BLANKS                                   CGL002
     C                     MOVE 'Y'       CGL002  1                       CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'N'       CGL002                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C*                                                                   CEU013
     C**  Access SAR details file to see if CEU013 is installed.          CEU013
     C*                                                                   CEU013
     C                     CALL 'AOSARDR0'                                CEU013
     C                     PARM '       ' @RTCD   7                       CEU013
     C                     PARM '*VERIFY' @OPTN   7                       CEU013
     C                     PARM 'CEU013'  WSARD   6                       CEU013
     C*                                                                   CEU013
     C           @RTCD     IFEQ *BLANK                                    CEU013
     C                     MOVE 'Y'       CEU013  1                       CEU013
     C                     MOVE *OFF      *IN66            Display controlCEU013
     C                     ELSE                                           CEU013
     C                     MOVE 'N'       CEU013                          CEU013
     C                     MOVE *ON       *IN66                           CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      ** Access SAR details file to see if CSC011 is installed                                CSC011
      *                                                                                       CSC011
     C                     CALL 'AOSARDR0'                                                    CSC011
     C                     PARM *BLANKS   @RTCD                                               CSC011
     C                     PARM '*VERIFY' @OPTN                                               CSC011
     C                     PARM 'CSC011'  @SARD                                               CSC011
      *                                                                                       CSC011
     C           @RTCD     IFEQ *BLANKS                                                       CSC011
     C                     MOVE 'Y'       CSC011  1                                           CSC011
     C           *NAMVAR   DEFN           SDSTAT                                              CSC011
     C                     IN   SDSTAT                                                        CSC011
     C           *NAMVAR   DEFN           SC24X7                                              CSC011
     C                     IN   SC24X7                                                        CSC011
     C                     ELSE                                                               CSC011
     C                     MOVE 'N'       CSC011                                              CSC011
     C                     ENDIF                                                              CSC011
      *                                                                                       CSC011
     C           KVLOG     KLIST                                                              CSC011
     C                     KFLD           APTYPE                                              CSC011
     C                     KFLD           BTFRNT                                              CSC011
      *                                                                                       CSC011
     C/COPY WNCPYSRC,GL0121MC81                                                               255341
      *                                                                                       255341
     C                     CALL 'AOSARDR0'                                                    255341
     C                     PARM *BLANKS   @RTCD                                               255341
     C                     PARM '*VERIFY' @OPTN                                               255341
     C                     PARM 'CGL064'  WSARD                                               255341
      *                                                                                       255341
     C           @RTCD     IFEQ *BLANK                                                        255341
     C                     MOVE 'Y'       CGL064  1                                           255341
     C                     ELSE                                                               255341
     C                     MOVE 'N'       CGL064                                              255341
     C                     ENDIF                                                              255341
      *                                                                                       255341
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *                                                                   CGL008
     C           KCAUAC    KLIST                                          CGL008
     C**********           KFLD           WWACCD  40       Account Code                CGL008 CGL029
     C                     KFLD           WWACCD 100                                          CGL029
     C                     KFLD           WMUSRP           Reference USRP CGL008
      *                                                                   CGL008
      ** Access SAR details file to see if CGL008 SAR is installed.       CGL008
      *                                                                   CGL008
     C                     CALL 'AOSARDR0'                                CGL008
     C                     PARM *BLANKS   @RTCD   7                       CGL008
     C                     PARM '*VERIFY' @OPTN   7                       CGL008
     C                     PARM 'CGL008'  @SARD   6                       CGL008
      *                                                                   CGL008
     C           @RTCD     IFEQ *BLANK                                    CGL008
     C                     MOVE 'Y'       CGL008  1                       CGL008
     C                     OPEN SFACAUL0                                  CGL008
     C                     OPEN MUSER                                     CGL008
      *                                                                   CGL008
      ** Check the User details extension to retrieve the journal entry   CGL008
      ** authorisation                                                    CGL008
      *                                                                   CGL008
     C           WUUSID    CHAINMUSER                22                   CGL008
     C           *IN22     IFEQ *OFF                                      CGL008
      *                                                                   CGL008
      ** Verify the content of the 'Access to all account codes' field    CGL008
      *                                                                   CGL008
     C                     MOVE ALACOD    WMACOD  1                       CGL008
     C                     MOVE REFUSR    WMUSRP 10                       CGL008
     C                     ENDIF                                          CGL008
     C                     ELSE                                           CGL008
     C                     MOVE 'N'       CGL008                          CGL008
     C                     ENDIF                                          CGL008
     C/COPY WNCPYSRC,GL0121MK82
      *                                                                   CGL008
      ** Access Switchable Features file to check if CGL010 is            CGL010
      ** installed.                                                       CGL010
      *                                                                   CGL010
     C                     CALL 'AOSARDR0'                                CGL010
     C                     PARM *BLANKS   WRTCD   7                       CGL010
     C                     PARM '*VERIFY' WOPTN   7                       CGL010
     C                     PARM 'CGL010'  WSARD   6                       CGL010
     C           D@SARD    PARM D@SARD    UUFDY                           CGL010
      *                                                                   CGL010
     C           WRTCD     IFEQ *BLANK                                    CGL010
     C                     MOVEL'Y'       CGL010  1                       CGL010
     C                     ELSE                                           CGL010
     C                     MOVE 'N'       CGL010                          CGL010
     C                     ENDIF                                          CGL010
      *                                                                   CGL010
      ** If CGL010 installed, setup program work fields for the new GL    CGL010
      ** ICD fields                                                       CGL010
      *                                                                   CGL010
     C           CGL010    IFEQ 'Y'                                       CGL010
     C                     Z-ADDBKNDFV    WNDFV   30                      CGL010
     C                     MOVE BKAFVN    WAFVN   1                       CGL010
     C                     MOVE BKAFVD    WAFVD   1                       CGL010
     C                     MOVE BKAFVC    WAFVC   1                       CGL010
     C                     MOVE BKAFVG    WAFVG   1                       CGL010
     C                     ENDIF                                          CGL010
      *                                                                   CGL010
      ** Access account info                                              CGL016
     C           KACCT     KLIST                                          CGL016
     C                     KFLD           W0CNUM  6                       CGL016
     C                     KFLD           W0CCY   3                       CGL016
     C**********           KFLD           W0ACOD  40                                   CGL016 CGL029
     C                     KFLD           W0ACOD 100                                          CGL029
     C                     KFLD           W0ACSQ  20                      CGL016
     C                     KFLD           W0BRCA  3                       CGL016
      *                                                                   CGL016
      ** Access SAR details for Projected Movements Update Prior to Auth. CGL016
      *                                                                   CGL016
     C                     MOVEL'N'       CGL016  1                       CGL016
     C                     CALL 'AOSARDR0'                                CGL016
     C                     PARM *BLANKS   @RTCD                           CGL016
     C                     PARM '*VERIFY' @OPTN                           CGL016
     C                     PARM 'CGL016'  @SARD                           CGL016
     C           D@SARD    PARM D@SARD    UUFDY                           CGL016
      *                                                                   CGL016
     C           @RTCD     IFEQ *BLANK                                    CGL016
     C                     MOVEL'Y'       CGL016                          CGL016
     C                     ENDIF                                          CGL016
      *                                                                                    AR792734A
      ** Access SAR details for Two O'clock feature                                        AR792734A
      *                                                                                    AR792734A
     C                     MOVEL'N'       CRE023  1                                        AR792734A
     C                     CALL 'AOSARDR0'                                                 AR792734A
     C                     PARM *BLANKS   @RTCD                                            AR792734A
     C                     PARM '*VERIFY' @OPTN                                            AR792734A
     C                     PARM 'CRE023'  @SARD                                            AR792734A
     C           D@SARD    PARM D@SARD    UUFDY                                            AR792734A
      *                                                                                    AR792734A
     C           @RTCD     IFEQ *BLANK                                                     AR792734A
     C                     MOVEL'Y'       CRE023                                           AR792734A
     C                     ENDIF                                                           AR792734A
      *                                                                                       CGL013
      ** Access SAR details file to see if CGL013 is installed.                               CGL013
      *                                                                                       CGL013
     C           *NAMVAR   DEFN           LDA                                                 CGL013
     C                     CALL 'AOSARDR0'                                                    CGL013
     C                     PARM *BLANKS   PRTCD   7                                           CGL013
     C                     PARM '*VERIFY' POPTN   7                                           CGL013
     C                     PARM 'CGL013'  PSARD   6                                           CGL013
     C           D@SARD    PARM D@SARD    UUFDY                                               CGL013
      *                                                                                       CGL013
     C           PRTCD     IFNE *BLANKS                                                       CGL013
     C           PRTCD     ANDNE'*NRF    '                                                    CGL013
     C           *LOCK     IN   LDA                                                           CGL013
     C                     MOVE 'SCSARDPD'DBFILE                                              CGL013
     C                     MOVEL'001'     DBASE                                               CGL013
     C                     MOVEL'CGL013'  DBKEY                                               CGL013
     C                     OUT  LDA                                                           CGL013
     C                     EXSR *PSSR                                                         CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           PRTCD     IFEQ *BLANK                                                        CGL013
     C                     MOVE 'Y'       CGL013  1                                           CGL013
     C                     MOVE *ON       *IN67                                               CGL013
     C                     MOVE *OFF      *IN68                                               CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE 'N'       CGL013                                              CGL013
     C                     MOVE *OFF      *IN67                                               CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                     BUG23742
      ** Access SAR details file to see if CER030 is installed                              BUG23742
      *                                                                                     BUG23742
     C                     CALL 'AOSARDR0'                                                  BUG23742
     C                     PARM *BLANKS   PRTCD                                             BUG23742
     C                     PARM '*VERIFY' POPTN                                             BUG23742
     C                     PARM 'CER030'  PSARD                                             BUG23742
     C           D@SARD    PARM D@SARD    UUFDY                                             BUG23742
      *                                                                                     BUG23742
     C           PRTCD     IFNE *BLANKS                                                     BUG23742
     C           PRTCD     ANDNE'*NRF'                                                      BUG23742
     C           *LOCK     IN   LDA                                                         BUG23742
     C                     MOVE 'SCSARDPD'DBFILE                                            BUG23742
     C                     MOVEL'011'     DBASE                                             BUG23742
     C                     MOVEL'CER030'  DBKEY                                             BUG23742
     C                     OUT  LDA                                                         BUG23742
     C                     EXSR *PSSR                                                       BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PRTCD     IFEQ *BLANKS                                                     BUG23742
     C                     MOVE 'Y'       CER030  1                                         BUG23742
     C                     MOVE *ON       *IN57                                             BUG23742
     C                     ELSE                                                             BUG23742
     C                     MOVE 'N'       CER030                                            BUG23742
     C                     MOVE *OFF      *IN57                                             BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
      ** Check if enhancement CRE008 is on.                                                   CRE008
      *                                                                                       CRE008
     C                     CALL 'AOSARDR0'                                                    CRE008
     C                     PARM *BLANKS   WRTCD                                               CRE008
     C                     PARM '*VERIFY' WOPTN                                               CRE008
     C                     PARM 'CRE008'  WSARD                                               CRE008
     C           D@SARD    PARM D@SARD    UUFDY                                               CRE008
      *                                                                                       CRE008
     C           WRTCD     IFEQ *BLANKS                                                       CRE008
     C                     MOVE 'Y'       CRE008  1                                           CRE008
     C                     ELSE                                                               CRE008
     C                     MOVE 'N'       CRE008                                              CRE008
     C                     ENDIF                                                              CRE008
      *                                                                                       CRE008
      ** Access SAR details file to see if CRE019 is installed.                               CRE019
      *                                                                                       CRE019
     C                     CALL 'AOSARDR0'                                                    CRE019
     C                     PARM *BLANKS   PRTCD   7                                           CRE019
     C                     PARM '*VERIFY' POPTN   7                                           CRE019
     C                     PARM 'CRE019'  PSARD   6                                           CRE019
     C           D@SARD    PARM D@SARD    UUFDY                                               CRE019
      *                                                                                       CRE019
     C           PRTCD     IFNE *BLANKS                                                       CRE019
     C           PRTCD     ANDNE'*NRF    '                                                    CRE019
     C           *LOCK     IN   LDA                                                           CRE019
     C                     MOVE 'SCSARDPD'DBFILE                                              CRE019
     C                     MOVEL'001'     DBASE                                               CRE019
     C                     MOVEL'CRE019'  DBKEY                                               CRE019
     C                     OUT  LDA                                                           CRE019
     C                     EXSR *PSSR                                                         CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C           PRTCD     IFEQ *BLANK                                                        CRE019
     C                     MOVE 'Y'       CRE019  1                                           CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CGL014
      ** Check if enhancement CGL014 (Collaterals Processing) is on                           CGL014
      *                                                                                       CGL014
     C                     CALL 'AOSARDR0'                                                    CGL014
     C                     PARM *BLANKS   WRTCD                                               CGL014
     C                     PARM '*VERIFY' WOPTN                                               CGL014
     C                     PARM 'CGL014'  WSARD                                               CGL014
     C           D@SARD    PARM D@SARD    UUFDY                                               CGL014
      *                                                                                       CGL014
     C           WRTCD     IFEQ *BLANKS                                                       CGL014
     C                     MOVE 'Y'       CGL014  1                                           CGL014
     C                     ELSE                                                               CGL014
     C                     MOVE 'N'       CGL014                                              CGL014
     C                     ENDIF                                                              CGL014
      *                                                                   CGL016
     C/COPY WNCPYSRC,GL0121MC08
      *                                                                                      LLN022A
      ** Check if Profit / Loss feature is installed                                         LLN022A
      *                                                                                      LLN022A
     C                     CALL 'AOSARDR0'                                                   LLN022A
     C           WUAPRC    PARM WUAPRC    UUAPRC  7                                          LLN022A
     C                     PARM '*VERIFY' UUAPOP  7                                          LLN022A
     C                     PARM 'LLN021'  UUSARN  6                                          LLN022A
     C           D@SARD    PARM *BLANKS   UUFDY                                              LLN022A
      *                                                                                      LLN022A
     C           WUAPRC    IFEQ *BLANKS                                                      LLN022A
     C                     MOVE 'Y'       LLN021  1                                          LLN022A
     C                     ELSE                                                              LLN022A
     C                     MOVE 'N'       LLN021                                             LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
      *================================================================
     CSR         ZZEXIT    ENDSR
     C*                                                                   S01408
      /EJECT                                                              CEU013
     C           EUCNVT    BEGSR                                          CEU013
      *================================================================   CEU013
      * Convert Euro to 'In' currency or vice versa                       CEU013
      *================================================================   CEU013
     C*                                                                   CEU013
     C                     Z-ADD0         W1OUTA 150       Outright AmountCEU013
     C                     Z-ADD0         W1INTA 183       Interim Amount CEU013
     C                     CALL 'EU0200'                                  CEU013
     C                     PARM *BLANKS   P@RTCD  7        Return Code    CEU013
     C                     PARM W1FRAM    P@FRAM 183       FROM Ccy AmountCEU013
     C                     PARM W1FRCY    P@FRCY  3        FROM Currency  CEU013
     C                     PARM W1TOCY    P@TOCY  3        TO Currency    CEU013
     C           W1OUTA    PARM W1OUTA    P@OUTA 150       Outright AmountCEU013
     C           W1INTA    PARM W1INTA    P@INTA 183       Interim Amount CEU013
     C                     PARM           P@EXRT 159       Exchange Rate  CEU013
     C                     PARM           P@MDIN  1        Mult/Div Ind   CEU013
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL'EU0200  'ZA0153           Error in calledCEU013
      * Send message 'Error in called program'                            CEU013
     C                     MOVEL'GLX0405' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     985152*              CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      *================================================================   CEU013
     C                     ENDSR                                          CEU013
      /EJECT                                                              CEU013
     CSR         VALOAM    BEGSR                                          CEU013
      *================================================================   CEU013
      * Validate Original amount                                          CEU013
      *================================================================   CEU013
      * CASE: RCD.Formatted Original amount is Entered                    CEU013
     C           #RFMOA    IFNE *BLANK                     *IF            CEU013
      * Get Number of Decimal Places                                      CEU013
      * CASE: RCD. Original Currency code is Not Question Mark            CEU013
     C           #1OCCY    IFEQ '?'                        *IF            CEU013
     C*                                                                   CEU013
     C                     Z-ADD*ZERO     WKNBDP           Number of DecimCEU013
     C                     ENDIF                                          CEU013
      * Set up No of Decimals and no of digits for ZALIGN                 CEU013
      * CASE: WRK.Number of Decimal Places is Zero                        CEU013
     C                     SELEC                                          CEU013
     C           WKNBDP    WHEQ *ZERO                      *IF            CEU013
     C                     Z-ADD*ZERO     WUZNDE           ZALIGN No Of DeCEU013
     C                     Z-ADD15        WUZNDI           ZALIGN No Of DiCEU013
      * CASE: WRK.Number of Decimal Places is One                         CEU013
     C           WKNBDP    WHEQ 1                          *IF            CEU013
     C                     Z-ADD1         WUZNDE           ZALIGN No Of DeCEU013
     C                     Z-ADD14        WUZNDI           ZALIGN No Of DiCEU013
      * CASE: WRK.Number of Decimal Places is Two                         CEU013
     C           WKNBDP    WHEQ 2                          *IF            CEU013
     C                     Z-ADD2         WUZNDE           ZALIGN No Of DeCEU013
     C                     Z-ADD13        WUZNDI           ZALIGN No Of DiCEU013
      * CASE: WRK.Number of Decimal Places is Three                       CEU013
     C           WKNBDP    WHEQ 3                          *IF            CEU013
     C                     Z-ADD3         WUZNDE           ZALIGN No Of DeCEU013
     C                     Z-ADD12        WUZNDI           ZALIGN No Of DiCEU013
     C                     ENDSL                                          CEU013
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen FCEU013
     C                     MOVEL#RFMOA    WUZASF           ZALIGN Screen FCEU013
      *                                                                   CEU013
      *                                                                   CEU013
      * Call Zalign and Zedit                                             CEU013
      * ZALIGN Screen Field - Standard functions  *                       CEU013
     C                     CALL 'ZALIGN'               90  ZALIGN Screen FCEU013
     C           W0RTN     PARM W0RTN     WQ0072  7        *Return code   CEU013
     C           WUZASF    PARM WUZASF    WQ0073 16        ZALIGN Screen FCEU013
     C                     PARM WUZNDE    WQ0074  10       ZALIGN No Of DeCEU013
     C                     PARM WUZNDI    WQ0075  20       ZALIGN No Of DiCEU013
     C           WUZAFF    PARM *BLANK    WQ0076 16        ZALIGN File FieCEU013
      *                                                                   CEU013
      *                                                                   CEU013
      *                                                                   CEU013
     C           *IN90     IFEQ '1'                                       CEU013
      * Call to program ended in error                                    CEU013
     C                     MOVEL'Y2U0021' W0RTN   7                       CEU013
     C                     END                                            CEU013
      *                                                                   CEU013
      * Error detected?                                                   CEU013
     C           W0RTN     IFNE *BLANK                                    CEU013
     C                     SETON                     98    *              CEU013
     C                     END                                            CEU013
      * CASE: PGM.*Return code is *Normal                                 CEU013
     C           W0RTN     IFEQ *BLANK                     *IF            CEU013
     C                     MOVEL'0'       WUERCD           Error Code     CEU013
      *                                                                   CEU013
      *                                                                   CEU013
      * ZEDIT Screen Field - Standard functions  *                        CEU013
     C                     CALL 'ZEDIT'                90  ZEDIT Screen FiCEU013
     C           WUZASF    PARM WUZASF    WQ0077 16        ZALIGN Screen FCEU013
     C                     PARM WUZNDE    WQ0078  10       ZALIGN No Of DeCEU013
      *                                                                   CEU013
      *                                                                   CEU013
      *                                                                   CEU013
     C           *IN90     IFEQ '1'                                       CEU013
      * Call to program ended in error                                    CEU013
     C                     MOVEL'Y2U0021' W0RTN   7                       CEU013
     C                     END                                            CEU013
      *                                                                   CEU013
     C                     ELSE                                           CEU013
      * CASE: *OTHERWISE                                                  CEU013
     C                     MOVEL'1'       WUERCD           Error Code     CEU013
     C                     END                             *FI            CEU013
      * CASE: WRK.Error Code is Error Found                               CEU013
     C           WUERCD    IFEQ '1'                        *IF            CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#RFMOA    ZA0152           Formatted PostiCEU013
      * Send message 'Amount not valid'                                   CEU013
     C                     MOVEL'GLX0403' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9852  *              CEU013
      *                                                                   CEU013
     C                     ELSE                                           CEU013
      * CASE: *OTHERWISE                                                  CEU013
      * MOVE Posting Amount - Journal Entry Posting  *                    CEU013
     C*  MOVE ZALIGN FILE FIELD INTO POSTING AMOUNT                       CEU013
     C                     MOVE WUZAFF    #1OAMT                          CEU013
      * Move Fmt Posting Amount - Journal Entry Posting  *                CEU013
     C*  MOVE ZALIGN FUNCTION FIELD INTO FORMATTED POSTING AMOUNT         CEU013
     C                     MOVE WUZASF    #RFMOA                          CEU013
      * CASE: RCD.Posting amount is LE Zero                               CEU013
     C           #1OAMT    IFLE *ZERO                      *IF            CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#RFMOA    ZA0152           Formatted PostiCEU013
      * Send message 'Amount not valid'                                   CEU013
     C                     MOVEL'GLX0403' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9852  *              CEU013
      *                                                                   CEU013
     C                     END                             *FI            CEU013
     C                     END                             *FI            CEU013
     C                     ELSE                                           CEU013
      * CASE: *OTHERWISE                                                  CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#RFMOA    ZA0152           Formatted PostiCEU013
      * Send message 'Posting amount is req'd'                            CEU013
     C                     MOVEL'GLX0401' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9852  *              CEU013
      *                                                                   CEU013
     C                     END                             *FI            CEU013
     C           #1SVOA    IFNE #RFMOA                                    CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     MOVE *BLANKS   WWFLG                           CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE #RFMOA    #1SVOA           Origin amt saveCEU013
      *================================================================   CEU013
     CSR                   ENDSR                                          CEU013
      /EJECT                                                              CEU013
     C           VALOCY    BEGSR                                          CEU013
      *================================================================   CEU013
      * Validate Original currency entry                                  CEU013
      *================================================================   CEU013
     C*                                                                   CEU013
     C* Validate original currency                                        CEU013
      * CASE: RCD. Original Currency code is Not blank                    CEU013
     C                     MOVE *BLANK    WKINCY  1        'In' Currency  CEU013
     C                     MOVE *ZERO     WKNBDP  10       No. Decimal PlcCEU013
     C           #1OCCY    IFNE *BLANK                                    CEU013
      * Access Currency. - Currency Codes  *                              CEU013
     C* CASE: RCD Original currency code is Select Requested              CEU013
     C           #1OCCY    IFEQ '?'                                       CEU013
     C                     MOVEL'Y'       W0DCF                           CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Number of decimal places and 'In' currency flag                  CEU013
     C*                                                                   CEU013
     C                     MOVEL#1OCCY    UUCYCD                          CEU013
     C                     CALL 'AOCURRR0'                                CEU013
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CEU013
     C                     PARM '*KEY'    UUAPOP  7        I:Option       CEU013
     C                     PARM           UUCYCD  3        I:Currency CodeCEU013
     C           D@CURR    PARM *BLANK    UUSDY            O:Format       CEU013
     C*                                                                   CEU013
      * CASE: WRK.Access Pgm Return Code is Access Error                  CEU013
     C           WUAPRC    IFNE *BLANKS                    *IF            CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0151           Original ccy   CEU013
      * Send message 'Original Currency Code not found'                   CEU013
     C                     MOVEL'GLX0400' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9851  *              CEU013
      *                                                                   CEU013
     C                     ELSE                                           CEU013
      * CASE: *OTHERWISE                                                  CEU013
     C* Assign work field to file field values.                           CEU013
     C*                                                                   CEU013
     C                     MOVE UUCYCD    #1OCCY                          CEU013
     C                     MOVELA6NBDP    WKNBDP  10       No. Decimal PlcCEU013
     C                     MOVELA6INCY    WKINCY  1        'In' Currency  CEU013
     C                     ENDIF                           *FI            CEU013
     C                     ENDIF                           *FI            CEU013
     C*                                                                   CEU013
     C*                                                                   CEU013
      *================================================================   CEU013
     C                     ENDSR                                          CEU013
      /EJECT                                                              CEU013
     C           VALORG    BEGSR                                          CEU013
      *================================================================   CEU013
      * Validate Original currency and amount combination                 CEU013
      *================================================================   CEU013
     C*                                                                   AP0003
     C* If the Original amount is blanked out, move zeros to screen       AP0003
     C*   saved field #1OAMT                                              AP0003
     C*                                                                   AP0003
     C           #RFMOA    IFEQ *BLANKS                                   AP0003
     C                     MOVE *ZEROS    #1OAMT                          AP0003
     C                     MOVE *ZEROS    #1SVOA                          AP0003
     C                     ENDIF                                          AP0003
     C*                                                                   CEU013
     C                     SELEC                                          CEU013
     C           WUINCY    WHNE 'Y'                                       CEU013
     C           #1CYCD    ANDNEBKEURO                                    CEU013
     C* Original currency is allowed only for 'EURO' or 'In' currency     CEU013
     C*   account.                                                        CEU013
     C*                                                                   CEU013
     C           #1OCCY    IFNE *BLANKS                                   CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0151           Original ccy   CEU013
      * Send message 'Original Currency Code not allowed'                 CEU013
     C                     MOVEL'GLX0408' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9851  *              CEU013
     C                     ENDIF                                          CEU013
     C* Original amount is allowed only for 'EURO' or 'In' currency       CEU013
     C*   account.                                                        CEU013
     C*                                                                   CEU013
     C           #RFMOA    IFNE *BLANKS                                   CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#RFMOA    ZA0152           Original amt   CEU013
      * Send message 'Original amount not allowed'                        CEU013
     C                     MOVEL'GLX0398' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9852  *              CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C* If the account currency is 'Euro' or 'In' currency, validate      CEU013
     C*  Original currency and the amount.                                CEU013
     C                     OTHER                                          CEU013
     C                     SELEC                                          CEU013
     C*                                                                   CEU013
      * CASE: RCD. Original Currency code is same as account currency     CEU013
     C* Original currency must not be same as account currency            CEU013
     C*                                                                   CEU013
     C           #1OCCY    WHEQ #1CYCD                                    CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0151           Original ccy   CEU013
      * Send message 'Original Currency Code is not valid'                CEU013
     C                     MOVEL'GLX0399' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9851  *              CEU013
     C*                                                                   CEU013
     C* Validate original currency                                        CEU013
      * CASE: RCD. Original Currency code is Not blank                    CEU013
     C           #1OCCY    WHNE *BLANK                                    CEU013
     C*                                                                   CEU013
     C                     SELEC                                          CEU013
     C           #1OCCY    WHNE BKEURO                                    CEU013
     C           WKINCY    ANDNE'Y'                                       CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0151           Original ccy   CEU013
      * Send message 'Original Currency must be either 'EURO' or          CEU013
     C*   'In' currency.                                                  CEU013
     C                     MOVEL'GLX0404' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9851  *              CEU013
     C*                                                                   CEU013
     C* CASE: Original currency is entered but not original amount        CEU013
     C*                                                                   CEU013
     C           #RFMOA    WHEQ *BLANKS                                   CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#RFMOA    ZA0152           Original amt   CEU013
      * Send message 'Original amount must be entered if Original         CEU013
     C*   currency is entered'                                            CEU013
     C                     MOVEL'GLX0401' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     985152*              CEU013
     C*                                                                   CEU013
     C* CASE: Original currency and Original amount are entered           CEU013
     C*                                                                   CEU013
     C                     OTHER                                          CEU013
     C                     EXSR VALOAM                                    CEU013
     C*                                                                   CEU013
     C                     SELEC                                          CEU013
     C           #1CYCD    WHEQ BKEURO                                    CEU013
     C           #1OCCY    OREQ BKEURO                                    CEU013
     C* If Posting currency or Original currency is Euro, call            CEU013
     C*   conversion program once.                                        CEU013
     C                     Z-ADD#1PTAM    W1FRAM 183       FROM Ccy AmountCEU013
     C                     MOVEL#1CYCD    W1FRCY  3        FROM Currency  CEU013
     C                     MOVEL#1OCCY    W1TOCY  3        TO Currency    CEU013
     C                     EXSR EUCNVT                                    CEU013
     C                     MOVE W1OUTA    W1OAMT 150                      CEU013
      *                                                                   CEU013
     C           W1OAMT    IFNE #1OAMT                                    CEU013
     C           #1OAMT    SUB  W1OAMT    W1DIFF 150                      CEU013
     C*                                                                   CEU013
     C           W1DIFF    IFGT 1                                         CEU013
     C           W1DIFF    ORLT -1                                        CEU013
     C*                                                                   CEU013
      * Setup message data for message                                    CEU013
      * Format amount (short) - Standard functions  *                     CEU013
     C                     Z-ADDW1OUTA    ULVALU           Value          CEU013
      *                                                                   CEU013
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>CEU013
     C                     PARM           ULVALU 150       I:Value        CEU013
     C                     PARM WKNBDP    ULDECP  10       I:Decimal placeCEU013
     C                     PARM '3'       ULEDIT  1        I:IBM Edit codeCEU013
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.CEU013
     C                     PARM           ULRSLF 23        O:Formatted    CEU013
      *                                                                   CEU013
     C                     MOVE ULRSLF    ZA0152           Formatted data CEU013
      * Send message 'Calculated Original amount is W1OUTA'               CEU013
     C                     MOVEL'GLX0406' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     9852  *              CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C                     ENDIF                                          CEU013
     C                     OTHER                                          CEU013
     C* If Posting currency and Original currency are 'In' currencies,    CEU013
     C*   then conversion program is called twice.                        CEU013
     C* The first call converts the Posting amount to Euro currency.      CEU013
     C                     Z-ADD#1PTAM    W1FRAM 183       FROM Ccy AmountCEU013
     C                     MOVEL#1CYCD    W1FRCY  3        FROM Currency  CEU013
     C                     MOVELBKEURO    W1TOCY  3        TO Currency    CEU013
     C                     EXSR EUCNVT                                    CEU013
     C                     Z-ADDW1OUTA    W1FRAM 183       FROM Ccy AmountCEU013
     C                     MOVELBKEURO    W1FRCY  3        FROM Currency  CEU013
     C                     MOVEL#1OCCY    W1TOCY  3        TO Currency    CEU013
     C* The second call converts the Euro currency amount to 'In'         CEU013
     C*   currency Original amount.                                       CEU013
     C                     EXSR EUCNVT                                    CEU013
     C                     MOVE W1OUTA    W1OAMT 150                      CEU013
     C           W1OAMT    IFNE #1OAMT                                    CEU013
     C           #1OAMT    SUB  W1OAMT    W1DIFF 150                      CEU013
     C*                                                                   CEU013
     C           W1DIFF    IFGT 1                                         CEU013
     C           W1DIFF    ORLT -1                                        CEU013
      * Setup message data for message                                    CEU013
      * Format amount (short) - Standard functions  *                     CEU013
     C                     Z-ADDW1OUTA    ULVALU           Value          CEU013
      *                                                                   CEU013
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>CEU013
     C                     PARM           ULVALU 150       I:Value        CEU013
     C                     PARM WKNBDP    ULDECP  10       I:Decimal placeCEU013
     C                     PARM '3'       ULEDIT  1        I:IBM Edit codeCEU013
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.CEU013
     C                     PARM           ULRSLF 23        O:Formatted    CEU013
      *                                                                   CEU013
     C                     MOVE ULRSLF    ZA0152           Formatted data CEU013
      * Send message 'Calculated Original amount is W1OUTA'               CEU013
     C                     MOVEL'GLX0406' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     9852  *              CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C                     ENDIF                                          CEU013
     C                     ENDSL                                          CEU013
     C                     ENDSL                                          CEU013
     C*                                                                   CEU013
     C* CASE: Original amount is entered but not original currency        CEU013
     C*                                                                   CEU013
     C           #RFMOA    WHNE *BLANKS                                   CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#RFMOA    ZA0152           Original amt   CEU013
     C* Original amount is not allowed if the original currency is        CEU013
     C*   blank                                                           CEU013
     C                     MOVEL'GLX0402' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9852  *              CEU013
     C*                                                                   CEU013
     C                     ENDSL                                          CEU013
     C*                                                                   CEU013
     C                     ENDSL                                          CEU013
     C*                                                                   CEU013
     C* Save the orginal amount for later comparison                      CEU013
     C*                                                                   CEU013
     C*                                                                   CEU013
      *================================================================   CEU013
     C                     ENDSR                                          CEU013
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      * SRWCHQ - Update Presented Cheque Table                        *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
     C           SRWCHQ    BEGSR                                                              CRE019
      *                                                                                       CRE019
      ** Generate Next Transaction number                                                     CRE019
      *                                                                                       CRE019
     C                     EXSR SRTNLU                                                        CRE019
      *                                                                                       CRE019
      ** Initialize work flags                                                                CRE019
      *                                                                                       CRE019
     C                     MOVE 'N'       WINS    1                                           CRE019
     C                     MOVE 'N'       WOUTR   1                                           CRE019
     C                     MOVE 'N'       WDUP    1                                           CRE019
     C                     MOVE 'N'       WNLIVE  1                                           CRE019
     C                     MOVE *IN43     WIN43   1                                           CRE019
      *                                                                                       CRE019
     C                     MOVE #1RACN    KACNO                                               CRE019
     C                     Z-ADD0         KGCIN                                               CRE019
     C                     MOVE #1CQNB    KSCQN                                               CRE019
      *                                                                                       CRE019
      ** Set up key to access Cheque book file                                                CRE019
      *                                                                                       CRE019
     C           KCHQBK    SETGTCHQBKPDF                                                      CRE019
     C           KCHQB2    REDPECHQBKPDF                 43                                   CRE019
      *                                                                                       CRE019
      ** If record is found and RECID = 'D'                                                   CRE019
      *                                                                                       CRE019
     C           *IN43     IFEQ *OFF                                                          CRE019
     C           RECID     ANDEQ'D'                                                           CRE019
      *                                                                                       CRE019
      ** If cheque is in range expected for any of the cheque books issued                    CRE019
      *                                                                                       CRE019
     C           KSCQN     IFLT SCQN                                                          CRE019
     C           KSCQN     ORGT ECQN                                                          CRE019
      *                                                                                       CRE019
     C                     MOVE 'Y'       WOUTR                                               CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
      ** Check if cheque has already been presented before                                    CRE019
      *                                                                                       CRE019
     C                     Z-ADDKSCQN     WSCQN   80                                          CRE019
     C           WSCQN     SUB  SCQN      WOFSET  80                                          CRE019
     C           WOFSET    DIV  8         WI      20                                          CRE019
     C                     MVR            WBITN   10                                          CRE019
     C                     ADD  1         WI                                                  CRE019
      *                                                                                       CRE019
      ** Test corresponding bit-position of element for cheque presented                      CRE019
      *                                                                                       CRE019
     C                     MOVEACQPS      WAR                                                 CRE019
     C           WBITN     IFEQ 0                                                             CRE019
     C                     TESTB'0'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 1                                                             CRE019
     C                     TESTB'1'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 2                                                             CRE019
     C                     TESTB'2'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 3                                                             CRE019
     C                     TESTB'3'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 4                                                             CRE019
     C                     TESTB'4'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 5                                                             CRE019
     C                     TESTB'5'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 6                                                             CRE019
     C                     TESTB'6'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 7                                                             CRE019
     C                     TESTB'7'       WAR,WI         43                                   CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVEAWAR       CQPS                                                CRE019
      *                                                                                       CRE019
      ** If *IN43 is on, work flag for duplicate cheques to 'Y'                               CRE019
      *                                                                                       CRE019
     C           *IN43     IFEQ *ON                                                           CRE019
     C                     MOVE 'Y'       WDUP    1                                           CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Else (No live record was found)                                                      CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
      ** If record is found but not live                                                      CRE019
      *                                                                                       CRE019
     C           RECID     IFNE 'D'                                                           CRE019
     C                     MOVE 'Y'       WNLIVE                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE 'Y'       WOUTR                                               CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C           WOUTR     IFEQ 'Y'                                                           CRE019
     C           WNLIVE    ANDNE'Y'                                                           CRE019
     C                     MOVE 'D'       RECID                                               CRE019
     C                     MOVE #1RACN    ACNO                                                CRE019
     C                     Z-ADD0         GCQI                                                CRE019
     C                     MOVE #1CQNB    SCQN                                                CRE019
     C                     Z-ADD1         NOCQ                                                CRE019
     C                     MOVE #1CQNB    ECQN                                                CRE019
     C                     Z-ADDBTVLDT    DISS                                                CRE019
     C                     Z-ADDBTVLDT    DCOL                                                CRE019
     C                     MOVE BRCA      BRCA                                                CRE019
     C                     MOVE 'I'       CHTP                                                CRE019
     C                     Z-ADD0         CHAM                                                CRE019
     C                     MOVE 'Y'       OUTR                                                CRE019
     C                     MOVE 'Y'       WINS                                                CRE019
      *                                                                                       CRE019
      ** Set bit of for all the 160 cheque presented array                                    CRE019
      *                                                                                       CRE019
     C                     Z-ADD1         W2      20                                          CRE019
      *                                                                                       CRE019
     C           W2        DOWLE20                                                            CRE019
     C                     BITON'01234567'WAR,W2                                              CRE019
     C                     BITOF'01234567'WAR,W2                                              CRE019
     C                     ADD  1         W2                                                  CRE019
     C                     ENDDO                                                              CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Update fields TNLU, LCD and CQPS for both update and write                           CRE019
      *                                                                                       CRE019
     C                     Z-ADDWNATN     TNLU                                                CRE019
     C                     Z-ADDRDNO      LCD                                                 CRE019
      *                                                                                       CRE019
      ** Set on bits  of CQPS to specify cheque presented                                     CRE019
      *                                                                                       CRE019
     C                     MOVE #1CQNB    WSCQN   80                                          CRE019
     C           WSCQN     SUB  SCQN      WOFSET  80                                          CRE019
     C           WOFSET    DIV  8         WI      20                                          CRE019
     C                     MVR            WBITN   10                                          CRE019
     C                     ADD  1         WI                                                  CRE019
      *                                                                                       CRE019
     C                     MOVEACQPS      WAR                                                 CRE019
      *                                                                                       CRE019
     C           WBITN     IFEQ 0                                                             CRE019
     C                     BITON'0'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 1                                                             CRE019
     C                     BITON'1'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 2                                                             CRE019
     C                     BITON'2'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 3                                                             CRE019
     C                     BITON'3'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 4                                                             CRE019
     C                     BITON'4'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 5                                                             CRE019
     C                     BITON'5'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 6                                                             CRE019
     C                     BITON'6'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 7                                                             CRE019
     C                     BITON'7'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVEAWAR       CQPS                                                CRE019
      *                                                                                       CRE019
      ** If record does not exist, write a new one and update trailer                         CRE019
      ** file, else, update current record on CHQBKPD                                         CRE019
      *                                                                                       CRE019
     C           WINS      IFEQ 'Y'                                                           CRE019
     C                     Z-ADDRDNO      OEDT                                                CRE019
     C                     WRITECHQBKPDF                                                      CRE019
     C                     EXSR SRUTRL                                                        CRE019
     C                     ELSE                                                               CRE019
     C           WDUP      IFEQ 'N'                                                           CRE019
     C           RECID     IFEQ '*'                                                           CRE019
     C                     MOVE 'Y'       WINS                                                CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVE 'D'       RECID                                               CRE019
     C                     MOVE 'A'       CHTP                                                CRE019
     C                     UPDATCHQBKPDF                                                      CRE019
     C                     EXSR SRUTRL                                                        CRE019
     C                     ENDIF                                                              CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE *ALL' '   WCH                                                 CRE019
     C                     MOVE WDUP      BTDUPC                                              CRE019
     C                     MOVE WOUTR     BTOUTR                                              CRE019
     C                     MOVE WIN43     *IN43                                               CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      * SRDCHQ - Remove cheque number from the list of presented      *                       CRE019
      *          Cheques                                              *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
     C           SRDCHQ    BEGSR                                                              CRE019
      *                                                                                       CRE019
      ** Generate Next Transaction number                                                     CRE019
      *                                                                                       CRE019
     C                     EXSR SRTNLU                                                        CRE019
     C                     Z-ADDWNATN     TNLU                                                CRE019
      *                                                                                       CRE019
     C                     MOVE BJRDNB    LCD                                                 CRE019
     C                     MOVE 'N'       WDEL    1                                           CRE019
      *                                                                                       CRE019
     C                     MOVE #1RACN    KACNO                                               CRE019
     C                     Z-ADD0         KGCIN                                               CRE019
     C                     MOVE BTCQNB    KSCQN                                               CRE019
      *                                                                                       CRE019
      ** If cheque number being reverse was due to ammended full account                      CRE019
      ** or cheque number, use previous full account and cheque number                        CRE019
      *                                                                                       CRE019
     C           WFRMR     IFEQ 'Y'                                                           CRE019
     C                     MOVE WPRACN    KACNO                                               CRE019
     C                     MOVE WPCQNB    KSCQN                                               CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Set up key to access Cheque book file                                                CRE019
      *                                                                                       CRE019
     C           KCHQBK    SETGTCHQBKPDF                                                      CRE019
     C           KCHQB2    REDPECHQBKPDF                 43                                   CRE019
      *                                                                                       CRE019
      ** If out of range flag is 'Y', record can be deleted                                   CRE019
      *                                                                                       CRE019
     C           OUTR      IFEQ 'Y'                                                           CRE019
     C                     MOVE 'Y'       WDEL                                                CRE019
     C                     DELETCHQBKPDF                                                      CRE019
     C                     EXSR SRUTRL                                                        CRE019
      *                                                                                       CRE019
      ** Else, ammend such that the cheque is not yet presented                               CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
      ** Set on bits  of CQPS to specify cheque presented                                     CRE019
      *                                                                                       CRE019
     C                     Z-ADDKSCQN     WSCQN                                               CRE019
     C           WSCQN     SUB  SCQN      WOFSET                                              CRE019
     C           WOFSET    DIV  8         WI                                                  CRE019
     C                     MVR            WBITN                                               CRE019
     C                     ADD  1         WI                                                  CRE019
      *                                                                                       CRE019
     C                     MOVEACQPS      WAR                                                 CRE019
     C           WBITN     IFEQ 0                                                             CRE019
     C                     BITOF'0'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 1                                                             CRE019
     C                     BITOF'1'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 2                                                             CRE019
     C                     BITOF'2'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 3                                                             CRE019
     C                     BITOF'3'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 4                                                             CRE019
     C                     BITOF'4'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 5                                                             CRE019
     C                     BITOF'5'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 6                                                             CRE019
     C                     BITOF'6'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C           WBITN     IFEQ 7                                                             CRE019
     C                     BITOF'7'       WAR,WI                                              CRE019
     C                     ENDIF                                                              CRE019
     C                     MOVEAWAR       CQPS                                                CRE019
      *                                                                                       CRE019
     C                     MOVE 'A'       CHTP                                                CRE019
     C                     UPDATCHQBKPDF                                                      CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      * SRRCHQ - Reverse previous cheque number that was ammended     *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
     C           SRRCHQ    BEGSR                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE 'Y'       WFRMR   1                                           CRE019
     C                     MOVE 'Y'       WOKDL2                                              CRE019
      *                                                                                       CRE019
      ** Access TTRANL6 to check if other transaction uses the cheque                         CRE019
      *                                                                                       CRE019
     C           WPCQNB    SETLLTTRANL6                                                       CRE019
     C           WPCQNB    READETTRANL6                  83                                   CRE019
      *                                                                                       CRE019
     C           *IN83     DOWNE*ON                                                           CRE019
      *                                                                                       CRE019
      ** Convert CUSEXCE's numeric fields to alpha for comparison                             CRE019
      *                                                                                       CRE019
     C                     MOVELTDCUS     WDCUS                                               CRE019
     C                     MOVELTDACOD    WDACOD                                              CRE019
     C                     MOVELTDACS     WDACS                                               CRE019
      *                                                                                       CRE019
     C********** TAACNO    IFNE *BLANKS                                               CRE019 BUG2488
     C**********           MOVE TAACNO    TRACNO                                      CRE019 BUG2488
     C**********           ENDIF                                                      CRE019 BUG2488
      *                                                                                       CRE019
     C           BTRACN    IFEQ TRACNO                                                        CRE019
     C           TRACNO    OREQ *ZEROS                                                        CRE019
     C           TDRBR     ANDEQBTIBCA                                                        CRE019
     C           WDCUS     ANDEQBTCUST                                                        CRE019
     C           WDACOD    ANDEQBTACCD                                                        CRE019
     C           WDACS     ANDEQBTACSN                                                        CRE019
     C           TDRCY     ANDEQBTCYCD                                                        CRE019
      *                                                                                       CRE019
     C           BTBTNB    IFEQ TRBTNB                                                        CRE019
     C           BTBINB    ANDEQTRBINB                                                        CRE019
     C                     MOVE *BLANKS   TRBTNB                                              CRE019
     C                     MOVE *BLANKS   TRBINB                                              CRE019
     C           WPCQNB    READETTRANL6                  83                                   CRE019
     C                     ELSE                                                               CRE019
     C                     MOVE 'N'       WOKDL2  1                                           CRE019
     C                     MOVE *ON       *IN83                                               CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
     C           WPCQNB    READETTRANL6                  83                                   CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDDO                                                              CRE019
      *                                                                                      BUG2488
      ** Check if cheque exist in telelr transactions                                        BUG2488
      *                                                                                      BUG2488
     C           WOKDEL    IFEQ 'Y'                                                          BUG2488
     C                     MOVE *OFF      *IN83                                              BUG2488
     C           *LOVAL    SETLLSDTELDL1                                                     BUG2488
     C                     READ SDTELDL1                 83                                  BUG2488
     C           *IN83     DOWEQ*OFF                                                         BUG2488
      *                                                                                      BUG2488
      ** If not the first time, delete previous overrides                                    BUG2488
      *                                                                                      BUG2488
     C           @CMD      IFNE *BLANKS                                                      BUG2488
     C                     MOVEL*BLANKS   @CMD                                               BUG2488
     C                     MOVEL@TXT,1    @CMD                                               BUG2488
     C                     CALL 'QCMDEXC'                                                    BUG2488
     C                     PARM           @CMD                                               BUG2488
     C                     PARM 80        @LEN                                               BUG2488
     C                     CLOSETTRANL7                                                      BUG2488
     C                     ENDIF                                                             BUG2488
      *                                                                                      BUG2488
      ** Perform override to LF/TTRANL7                                                      BUG2488
      *                                                                                      BUG2488
     C                     MOVEL*BLANKS   @CMD                                               BUG2488
     C                     MOVEL@TXT,2    @CMD                                               BUG2488
     C                     MOVEL'T'       @BRI                                               BUG2488
     C                     MOVELFRTLID    @BID                                               BUG2488
     C                     CALL 'QCMDEXC'                                                    BUG2488
     C                     PARM           @CMD                                               BUG2488
     C                     PARM 80        @LEN                                               BUG2488
      *                                                                                      BUG2488
     C                     OPEN TTRANL7                                                      BUG2488
     C           *LOVAL    SETLLTTRANL7                                                      BUG2488
     C           #1CQNB    CHAINTTRANL7              84                                      BUG2488
     C           *IN84     IFEQ *OFF                                                         BUG2488
     C                     MOVE 'N'       WOKDEL                                             BUG2488
     C                     LEAVE                                                             BUG2488
     C                     ENDIF                                                             BUG2488
      *                                                                                      BUG2488
     C                     READ SDTELDL1                 83                                  BUG2488
      *                                                                                      BUG2488
     C                     ENDDO                                                             BUG2488
     C                     ENDIF                                                             BUG2488
      *                                                                                       CRE019
      ** Allow delete if current transaction is the only transaction                          CRE019
      ** using the cheque                                                                     CRE019
      *                                                                                       CRE019
     C           WOKDL2    IFEQ 'Y'                                                           CRE019
     C                     EXSR SRDCHQ                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE 'N'       WFRMR                                               CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      * SRRFAC - Reverse previous cheque number if full account       *                       CRE019
      *          was ammended                                         *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
     C           SRRFAC    BEGSR                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE 'Y'       WFRMR                                               CRE019
     C                     MOVE 'Y'       WOKDL2                                              CRE019
      *                                                                                       CRE019
      ** Access TTRANL6 to check if other transaction uses the cheque                         CRE019
      *                                                                                       CRE019
     C           WPCQNB    SETLLTTRANL6                                                       CRE019
     C           WPCQNB    READETTRANL6                  83                                   CRE019
      *                                                                                       CRE019
     C           *IN83     DOWNE*ON                                                           CRE019
      *                                                                                       CRE019
      ** Convert CUSEXCE's numeric fields to alpha for comparison                             CRE019
      *                                                                                       CRE019
     C                     MOVELTDCUS     WDCUS                                               CRE019
     C                     MOVELTDACOD    WDACOD                                              CRE019
     C                     MOVELTDACS     WDACS                                               CRE019
      *                                                                                       CRE019
     C********** TAACNO    IFNE *BLANKS                                               CRE019 BUG2488
     C**********           MOVE TAACNO    TRACNO                                      CRE019 BUG2488
     C**********           ENDIF                                                      CRE019 BUG2488
      *                                                                                       CRE019
     C           WPRACN    IFEQ TRACNO                                                        CRE019
     C           TRACNO    OREQ *ZEROS                                                        CRE019
     C           TDRBR     ANDEQWPIBCA                                                        CRE019
     C           WDCUS     ANDEQWPCUST                                                        CRE019
     C           WDACOD    ANDEQWPACCD                                                        CRE019
     C           WDACS     ANDEQWPACSN                                                        CRE019
     C           TDRCY     ANDEQWPCYCD                                                        CRE019
      *                                                                                       CRE019
     C           BTBTNB    IFEQ TRBTNB                                                        CRE019
     C           BTBINB    ANDEQTRBINB                                                        CRE019
     C                     MOVE *BLANKS   TRBTNB                                              CRE019
     C                     MOVE *BLANKS   TRBINB                                              CRE019
     C           WPCQNB    READETTRANL6                  83                                   CRE019
     C                     ELSE                                                               CRE019
     C                     MOVE 'N'       WOKDL2                                              CRE019
     C                     MOVE *ON       *IN83                                               CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ELSE                                                               CRE019
     C           WPCQNB    READETTRANL6                  83                                   CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDDO                                                              CRE019
      *                                                                                      BUG2488
      ** Check if cheque exist in telelr transactions                                        BUG2488
      *                                                                                      BUG2488
     C           WOKDEL    IFEQ 'Y'                                                          BUG2488
     C                     MOVE *OFF      *IN83                                              BUG2488
     C           *LOVAL    SETLLSDTELDL1                                                     BUG2488
     C                     READ SDTELDL1                 83                                  BUG2488
     C           *IN83     DOWEQ*OFF                                                         BUG2488
      *                                                                                      BUG2488
      ** If not the first time, delete previous overrides                                    BUG2488
      *                                                                                      BUG2488
     C           @CMD      IFNE *BLANKS                                                      BUG2488
     C                     MOVEL*BLANKS   @CMD                                               BUG2488
     C                     MOVEL@TXT,1    @CMD                                               BUG2488
     C                     CALL 'QCMDEXC'                                                    BUG2488
     C                     PARM           @CMD                                               BUG2488
     C                     PARM 80        @LEN                                               BUG2488
     C                     CLOSETTRANL7                                                      BUG2488
     C                     ENDIF                                                             BUG2488
      *                                                                                      BUG2488
      ** Perform override to LF/TTRANL7                                                      BUG2488
      *                                                                                      BUG2488
     C                     MOVEL*BLANKS   @CMD                                               BUG2488
     C                     MOVEL@TXT,2    @CMD                                               BUG2488
     C                     MOVEL'T'       @BRI                                               BUG2488
     C                     MOVELFRTLID    @BID                                               BUG2488
     C                     CALL 'QCMDEXC'                                                    BUG2488
     C                     PARM           @CMD                                               BUG2488
     C                     PARM 80        @LEN                                               BUG2488
      *                                                                                      BUG2488
     C                     OPEN TTRANL7                                                      BUG2488
     C           *LOVAL    SETLLTTRANL7                                                      BUG2488
     C           #1CQNB    CHAINTTRANL7              84                                      BUG2488
     C           *IN84     IFEQ *OFF                                                         BUG2488
     C                     MOVE 'N'       WOKDEL                                             BUG2488
     C                     LEAVE                                                             BUG2488
     C                     ENDIF                                                             BUG2488
      *                                                                                      BUG2488
     C                     READ SDTELDL1                 83                                  BUG2488
      *                                                                                      BUG2488
     C                     ENDDO                                                             BUG2488
     C                     ENDIF                                                             BUG2488
      *                                                                                       CRE019
      ** Allow delete if current transaction is the only transaction                          CRE019
      ** using the cheque                                                                     CRE019
      *                                                                                       CRE019
     C           WOKDL2    IFEQ 'Y'                                                           CRE019
     C                     EXSR SRDCHQ                                                        CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE 'N'       WFRMR                                               CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      * SRUTRL - Update Control Trailer Record                        *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
     C           SRUTRL    BEGSR                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE '0'       *IN70                                               CRE019
      *                                                                                       CRE019
     C           KCHQTR    KLIST                                                              CRE019
     C                     KFLD           KACNTR 100                                          CRE019
     C                     KFLD           KGCITR  10                                          CRE019
     C                     KFLD           KSQNTR  80                                          CRE019
      *                                                                                       CRE019
     C                     MOVE *ALL'9'   KACNTR                                              CRE019
     C                     MOVE '9'       KGCITR                                              CRE019
     C                     MOVE *ALL'9'   KSQNTR                                              CRE019
     C           KCHQTR    CHAINCHQBKPTF             70                                       CRE019
      *                                                                                       CRE019
      **  DB Error if Trailer file is empty                                                   CRE019
      *                                                                                       CRE019
     C           *IN70     IFEQ *ON                                                           CRE019
     C           *LOCK     IN   LDA                                                           CRE019
     C                     MOVEL'CHQBKPTF'DBFILE                                              CRE019
     C                     Z-ADD2         DBASE                                               CRE019
     C                     MOVE *ALL'9'   DBKEY                                               CRE019
     C                     OUT  LDA                                                           CRE019
     C                     EXSR *PSSR                                                         CRE019
     C                     ELSE                                                               CRE019
      *                                                                                       CRE019
      ** Increase No. of records if action is insert                                          CRE019
      *                                                                                       CRE019
     C           WINS      IFEQ 'Y'                                                           CRE019
     C                     ADD  1         NORE                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
      ** Decrease No. of records if action is delete                                          CRE019
      *                                                                                       CRE019
     C           WDEL      IFEQ 'Y'                                                           CRE019
     C                     SUB  1         NORE                                                CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     MOVE 'N'       WINS                                                CRE019
     C                     MOVE 'N'       WDEL                                                CRE019
      *                                                                                       CRE019
     C                     MOVE BJRDNB    LCD                                                 CRE019
     C                     MOVEL'A'       CHTP                                                CRE019
     C                     Z-ADDWNATN     TNLU                                                CRE019
     C                     UPDATCHQBKPTF                                                      CRE019
      *                                                                                       CRE019
     C                     ENDIF                                                              CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
      *                                                               *                       CRE019
      * SRTNLU - Subroutine to get the next transaction number        *                       CRE019
      *                                                               *                       CRE019
      *****************************************************************                       CRE019
     C           SRTNLU    BEGSR                                                              CRE019
      *                                                                                       CRE019
     C           *NAMVAR   DEFN MNATN     DNATN                                               CRE019
     C           *LOCK     IN   DNATN                                                         CRE019
     C                     MOVE FNATN     WNATN   50                                          CRE019
     C                     MOVE FNATN     WWRK5   50                                          CRE019
     C                     ADD  1         WWRK5                                               CRE019
     C                     MOVE WWRK5     FNATN                                               CRE019
     C                     OUT  DNATN                                                         CRE019
      *                                                                                       CRE019
     C                     ENDSR                                                              CRE019
      *****************************************************************                       CRE019
      *                                                                                       CGL013
      *****************************************************************                       CGL013
      *                                                               *                       CGL013
      * *PSSR  - Program exception error routine                      *                       CGL013
      *          Called automatically if a program error occurs,      *                       CGL013
      *          or directly by the program code using EXSR.          *                       CGL013
      *          This subroutine DUMPs the program just once.         *                       CGL013
      *                                                               *                       CGL013
      * Called by: ZZINIT                                             *                       CGL013
      *                                                               *                       CGL013
      * Calls: None                                                   *                       CGL013
      *                                                               *                       CGL013
      *****************************************************************                       CGL013
      *                                                                                       CGL013
     C           *PSSR     BEGSR                                                              CGL013
      *                                                                                       CGL013
     C           @RUN      IFEQ *BLANK                                                        CGL013
     C                     MOVE 'Y'       @RUN    1                                           CGL013
     C                     DUMP                                                               CGL013
     C                     CALL 'DBERRCTL'                                                    CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     MOVE *ON       *INU7                                               CGL013
     C                     MOVE *ON       *INU8                                               CGL013
     C                     MOVE *ON       *INLR                                               CGL013
     C                     RETRN                                                              CGL013
      *                                                                                       CGL013
     C                     ENDSR                                                              CGL013
      *                                                                                       CGL013
      *****************************************************************                       CGL013
      /EJECT                                                                                  CGL013
      *****************************************************************                       CGL013
     O/COPY WNCPYSRC,GL0121MOPG
     O@BTREAK E                VALID                                                         241505A
     O                         BTVALI                                                        241505A
** Item Error Message
Err:
----------------------------------------------------------------------------
** (076566) Dealing - Transaction Types  (34 x 2A)
BDBPCICDCLCXC1C2DLFPFRFSIDILIPITLNNXOPOTPIPSRARFRPRRRSRXSJSWTDTITSTR
** (076566) Funds Transfer - Transaction Types  (5 x 2A)
CCCPINNTOP
** STAMP - Dummy timestamp                                                                    CPK014
0001-01-01-00.00.00.000000                                                                    CPK014
** CPY@
(c) Misys International Banking Systems Ltd. 2001
**   @TXT - TEXT STRINGS FOR OVERRIDE
DLTOVR     FILE(TTRANL7)
OVRDBF     FILE(TTRANL7) MBR(XXXX) SECURE(*YES) SHARE(*NO)  SEQONLY(*NO)
     X/COPY WNCPYSRC,GL0121MX01
