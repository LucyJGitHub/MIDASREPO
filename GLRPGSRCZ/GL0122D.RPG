     H            Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Maintain JE batch posting')                   *
     H/TITLE Midas GL Maintain JE Batch Posting
     Z* CRTRPGPGM
     Z* IGNDECERR(*YES)
      *
     H* SYNOPSIS :
     H* - Displays the records from DBF as a subfile
     H* - Loads the SFL from the DBF a page at a time
     H* - The DBF record at which the SFL display starts may be
     H*   controlled by positioning fields on the SFL header
     H* - Any key fields on the SFL header will be used as
     H*   positioning values
     H* - Any non-key fields on the SFL header will be used as
     H*   selection values: a maximum of W0SLM records will be
     H*   read from the DBF before giving up
      *
     H* Generated by  : SYNON/2  Version:  9054
     H* Function type : Display file
      *
     H*  Company :
     H* System        : General Ledger Synon Model
     H* User name     : COLMANP
     H* Date          : 15/06/92  Time  : 13:59:12
      *  (c) Finastra International Limited 2001                      *
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     F*****************************************************************
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CGL154             Date 13Oct14               *
      *                 MD027587           Date 19Jun14               *
      *                 AR782538           Date 03Jun11               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG24339           Date 17Jun09               *
      *                 CER047             Date 19May08               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 237508             Date 23May06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 206317             Date 15Aug02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 169980             Date 15May00               *
      *                 144466             Date 04Jan00               *
      *                 131441             Date 19Oct99               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CGL010             Date 08Nov99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01MAR99               *
      *                 CTI002             Date 23Sep98               *
     F*                 CEU013             DATE 23FEB98               *
     F*                 126386             DATE 20FEB98               *
     F*                 CGL002             Date 28OCT96               *
     F*                 110304             Date 28OCT96               *
     F*                 S01408             DATE 04SEP96               *
     F*                087102            DATE : 19FEB96               *
     F*              : 089856            DATE : 25OCT95               *
     F*              : 080490            DATE : 01MAR95               *
     F*        AMEND : 080488            DATE : 01MAR95               *
     F*        AMEND : S01408            DATE : 22AUG94               *
     F*        AMEND : S01413            DATE : 29JUL93               *
     F*        AMEND : E38270            DATE :15JUN92                *
     F*        AMEND : E17939            DATE : ../05/89              *
     F*        AMEND : LN0312            DATE : 07JUN90               *
     F*        AMEND : LN0335            DATE : 07JUN90               *
     F*        AMEND : LN0315            DATE : 06JUN90               *
     F*        AMEND : E18852            DATE : 28/09/89              *
     F*        AMEND : E20026            DATE :   /  /89              *
     F*****************************************************************
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *           (Recompile)                                         *
      *  MD046248 - Finastra Rebranding                               *
      *  CGL154 - FATCA Reporting (Recompile)                         *
      *  MD027587 - Unable to used the C for Copy and T for Template  *
      *             (Recompile)                                       *
      *  AR782538 - Misleading warning message issued when accnt is   *
      *             closed. Changed to more appropriate message       *
      *             (Child: AR782539)                                 *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG24339 - Extended Narrative fields are unavailable         *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  237508 - Issue warning message if account is flagged for     *
      *           closure.                                            *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  206317 - Fix will ensure that closed accounts will not be    *
      *           allowed on journal entry.                           *
      *  169980 - Journal entry does not show all postings in a batch.*
      *           It only displays 500 of the 916 items.              *
      *  144466 - If nostro account is not defined in the nostro table*
      *           file SDNOSTPD but exists in ACCNTAB with acc type   *
      *           'N', display the details from the acc file .        *
      *  131441 - Setup the correct parameter for AOSTOPV0.           *
      *  CGL010 - Future Value Dated Journal Entries for Non-Retail   *
      *           Accounts.                                           *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  CEU013 - EMU Account Postings Narrative                      *
     F*   126386 - CHECK FOR REMAINING POSTING ERRORS IS NOT DONE     *
     F*  CGL002 - Block GL Accounts in Journal Entry Input            *
     F*  110304 - Move retail indicator to work field after           *
     F*           accessing account details.                          *
     F*   S01408 - ADDITION OF HOOK GL0122DCP5                        *
     F*   087102 - Ensure full validation is done for batch items in  *
     F*            this program, as batch may have been input via an  *
     F*            interface program rather than through batch input. *
     F*            - Validate all items in batch (up to a practical   *
     F*              limit of 500) rather than just one page, to      *
     F*              enable all errors to be found in a batch without *
     F*              having to roll up first.                         *
     F*            - Force Subfile validation for closed accounts.    *
     F*            - Load all items for a batch into the subfile,     *
     F*              this ensures all errors are found at the start.  *
     F*            - Ensure reload of subfile to reset error status.  *
     F*            - Any errors on subfile rcd, highlight Account No. *
     F*            - Reset return parameter when reloading subfile.  *
     F*   089856 - Change to allow posting amount as 13N as specified *
     F*            in Ins Manual.                                     *
     F*   080490 - FORWARD DATE NEVER SET UP                          *
     F*   080488 - FIELD INITIALISED INCORRECTLY                      *
     F*   S01408 - ADDITION OF HOOK GL0122DCP1                        *
     F*            ADDITION OF HOOK GL0122DCP2                        *
     F*            ADDITION OF HOOK GL0122DCP3                        *
     F*            ADDITION OF HOOK GL0122DCP4                        *
     F*   S01413 - RETAIL 3 INCORPORATION. RECOMPILE FOR NUMBER OF    *
     F*            ITEMS ADDED TO GLJENPPD. PGM NOT REGENERATED.      *
     F*   E38270 - DO NOT DISPLAY BRANCH, IF MBIN IS 'N'              *
     F*   E17939 - RETAIL ACCOUNT NUMBER REVERTS BACK TO THE CUSTOMER *
     F*            NUMBER IN THE ACCOUNT NUMBER FIELD. THIS DID NOT   *
     F*            HAPPEN ON S38. FILE CHANGE WAS REQUIRED TO DETER-  *
     F*            MINE WHETHER A RETAIL AC NO WAS ENTERED. FIELD WAS *
     F*            'RETAIL A/C NUMBER ENTERED'.                       *
     F*   LN0312 - FOOTER TEXT TO READ F3=BATCH SUMMARY INSTEAD OF EXIT
     F*   LN0335 - FOOTER TEXT WAS INCORRECT                          *
     F*   LN0315 - ADDITION OF RETAIL INDICATORS ON CALL TO AOACCTR0  *LN0315
     F*   E18852 - TO RESTRICT ENTRIES BEING MADE ACROSS DIFFERENT    *
     F*            BRANCHES                                           *
     F*   E20026 - TO STOP DISPLAYING CUSTOMER REPORT NAME WHEN THE   *
     F*            GL DESC. IND.ON PF/SDGELRPD = 'N', AND             *
     F*   SAR017 - TO DISPLAY THE CUSTOMER REPORT NAME AND THE ACCOUNT*
     F*            NAME ON BATCH ITEM INPUT SCREEN.                   *
     F*   S01234 - JOURNAL ENTRY TEMPLATE FACILITY.                   *
     F*****************************************************************
     FGL0122D#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: Midas GL Maintain JE Batch Posting
      *
     FGLJENPL1IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RTV : Midas GL Journal Entry Posting Rtv
      *
     FGLJENHL1IF  E           K        DISK
      * RTV : Midas GL Journal Entry Header LF Rtv
      *
     F/COPY WNCPYSRC,GL0122DF01
     E                    @IE     1   2 76               Item Err.Msgs.
     E                    @IH         8  9               Item Err.slots
     E                    CPY@    1   1 80               Copyright     array
     E                    CTX1    1   3 78                                LN0335
      *
     I*****P@BJRF    E DSSDBANKPD                                         S01117
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE                       S01117
     I*                                                                   S01117
     I*
     I*****P@ACCT    E DSACCNTAB
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*   Define MIDAS Rundate from data-area RUNDAT
     I*
     I*00/Copy Member GL0122D   Initialise Program I-Spec
     I/COPY WNCPYSRC,GL0122DIPG
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     IGLREOV      DS
      * Retail Override data area data structure
     I                                        1   1 URRE01
     I                                        2   2 URRE02
     I                                        3   3 URRE03
     I                                        4   4 URRE04
     I                                        5   5 URRE05
     I                                        6   6 URRE06
     I                                        7   7 URRE07
     I                                        8   8 URRE08
     I                                        9   9 URRE09
     I                                       10  10 URRE10
      *
     I            DS
      * Item error status data structure
     I                                        1 152 @IE
     I                                        1  76 URERMG
     I                                       77 152 URDASH
     I                                        5  76 @IH
     I                                        5  76 URIESL
     I                                        5   5 URHL01
     I                                       14  14 URHL02
     I                                       23  23 URHL03
     I                                       32  32 URHL04
     I                                       41  41 URHL05
     I                                       50  50 URHL06
     I                                       59  59 URHL07
     I                                       68  68 URHL08
     IWURARC      DS
     I                                        1   1 WURSRD
     I                                        2   2 WURSRC
     I                                        3   3 WURSBD
     I                                        4   4 WURSBC
     I                                        5   5 WURSIN
     I                                        6   6 WUDBST
     I                                        7   7 WURSBR
     I                                        8   8 WURTSB
     I                                        9   9 WURSSC
     I                                       10  10 WUFMST
     I                                        1  10 WKRARC                CEU013
     I                                       11  130WUNDFV                080490
      *
     I            DS
     I                                        1   60UUDNUM
     I            DS
     I                                        1   60UUDNMA
      * Outward parameters
     IPARC        DS                              5
      * KEY : Midas GL Journal Entry Posting Rtv
      * I : MAP Batch number
     I                                        1   3 PABTNB
      * I : MAP Batch item no.
     I                                    P   4   50PABINB
      *
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
     IUUFDY     E DSDSFDY
     I*
     I* 200 Byte Data Structure for Incoming Data from Access Program
     I*
     IUUSDY     E DSDSSDY
     I*
     I* 800 Byte Data Structure for Incoming Data from Access Program
     I*
     IP@BJRF    E DSSDBANKPD
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     ID@CUST    E DSSDCUSTPD
     I*
     I*  Client Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@ACCT    E DSACCNTAB
     I*
     I*  Account Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@ACOD    E DSSDACODPD
     I*
     I*  Account Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@BRCH    E DSSDBRCHPD
     I              QQDFAC                          DFACQQ                                    CGL029
     I*
     I*  Branch Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@CURR    E DSSDCURRPD
     I*
     I*  Currency Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@NARR    E DSSDNARRPD
     I*
     I*  Narrative Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@PRFM    E DSSDPRFMPD
     I*
     I*  Profit Centre Def Matrix DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@PRFC    E DSSDPRFCPD
     I*
     I*  Profit Centre DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@RETR    E DSSDRETRPD
     I*
     I*  Retail Transaction Types DS for assigning data from Access
     I*  Programs to work fields
     I*                                                                   CEU013
     ID@GELR    E DSSDGELRPD                                              CEU013
     I              QQACCD                          ACCDQQ                                    CGL029
     I*                                                                   CEU013
     I*  General Ledger Details DS for assigning data from Access         CEU013
     I*  Programs to work fields                                          CEU013
     I*                                                                   CEU013
     I*
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNO
     I                                       11  11 SUCP
     I                                       12  12 DTFF
     I                                       13  13 MBIN
     I*
     ID@RETL    E DSSDRETLPD                                              080490
     I              QQACCD                          #ACCD@                                    CGL029
     I*                                                                   080490
     I*  Retail Details DS for assigning data from Access                 080490
     I*  Programs to work fields                                          080490
     I*                                                                   080490
     ID@SARD    E DSSCSARDPD                                              CGL002
     I*                                                                   CGL002
     I*  Switchable Features DS                                           CGL002
     I              LCD                             LCDX                  CGL002
     I*                                                                   CGL002
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * FLD: Journal Entry Header
      * I : RST Batch number
     I                                        1   3 P1BTNB
      * I : MAP Branch Code - Alpha
     I                                        4   6 P1BCDA
      * I : MAP Dept Code
     I                                        7   9 P1DPCD
      * I : MAP Hash item no.calculated
     I                                    P  10  110P1HINC
      * I : MAP Multiple Branch Batch
     I                                       12  12 P1MBRB
     IP2PARM      DS
      * I :  Branch Internal Customer
     I                                        1   6 P2BICN
     IP3PARM      DS
      * I :  Action Code
     I                                        1   1 P3ACTC
     IP4PARM      DS
      * O :  Exit option
     I                                        1   1 P4EXTO
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Customer not found'
      * Account Identifier
     I                                        1  10 ZA0001
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0002
      * Message data for 'Nostro/Cust Shortname NF'
      * Account Identifier
     I                                        1  10 ZA0003
      * Message data for 'Account ID not valid ERR'
      * Account Identifier
     I                                        1  10 ZA0004
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0005
      * Currency code
     I                                       11  13 ZA0006
      * Account code
     I**********                             14  17 ZA0007                                    CGL029
     I                                       14  23 ZA0007                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0008                                    CGL029
     I                                       24  25 ZA0008                                    CGL029
      * Input Branch Code - Alpha
     I**********                             20  22 ZA0009                                    CGL029
     I                                       26  28 ZA0009                                    CGL029
      * Message data for 'Account is Closed'
      * Account Identifier
     I                                        1  10 ZA0010
      * Currency code
     I                                       11  13 ZA0011
      * Account code
     I**********                             14  17 ZA0012                                    CGL029
     I                                       14  23 ZA0012                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0013                                    CGL029
     I                                       24  25 ZA0013                                    CGL029
      * Input Branch Code - Alpha
     I**********                             20  22 ZA0014                                    CGL029
     I                                       26  28 ZA0014                                    CGL029
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0015
      * Currency code
     I                                       11  13 ZA0016
      * Account code
     I**********                             14  17 ZA0017                                    CGL029
     I                                       14  23 ZA0017                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0018                                    CGL029
     I                                       24  25 ZA0018                                    CGL029
      * Input Branch Code - Alpha
     I**********                             20  22 ZA0019                                    CGL029
     I                                       26  28 ZA0019                                    CGL029
      * Message data for 'Amount not valid'
      * Formatted Posting amount
     I                                        1  14 ZA0020
      * Message data for 'Amount not valid'
      * Formatted Posting amount
     I                                        1  14 ZA0021
      * Message data for 'No Narrative entered'
      * Narrative
     I                                        1  30 ZA0022
      * Message data for 'Narrative Code not found'
      * Narrative
     I                                        1  30 ZA0023
      * Message data for 'Trans. type not valid'
      * Transaction type
     I                                        1   5 ZA0024
      * Message data for 'Must enter Trans Type'
      * Transaction type
     I                                        1   5 ZA0025
      * Message data for 'Cheque Number Numeric'
      * Cheque number
     I                                        1   8 ZA0026
      * Message data for 'Stopped Cheque'
      * Cheque number
     I                                        1   8 ZA0027
      * Message data for 'Lots of blanks'
      * Message data for 'Can't O'ride Retail error'
      * Account Identifier
     I                                        1  10 ZA0028
      * Currency code
     I                                       11  13 ZA0029
      * Account code
     I**********                             14  17 ZA0030                                    CGL029
     I                                       14  23 ZA0030                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0031                                    CGL029
     I                                       24  25 ZA0031                                    CGL029
      * Message data for 'Retail Error Req's Overde'
      * Retail ind.: Override
     I                                        1   1 ZA0032
      * Message data for 'Retail Override Invalid'
      * Retail ind.: Override
     I                                        1   1 ZA0033
      * Message data for 'Value Date not valid 1'
      * Value date (display)
     I                                        1   6 ZA0034
      * Message data for 'Value Date not valid 2'
      * Value date (display)
     I                                        1   6 ZA0035
      * Message data for 'Value Date not valid 3'
      * Value date (display)
     I                                        1   6 ZA0036
      * Message data for 'Value Date Not Valid 9'
      * Value date (display)
     I                                        1   6 ZA0037
      * Message data for 'Value Date not valid 4'
      * Value date (display)
     I                                        1   6 ZA0038
      * Message data for 'Value Date not valid 5'
      * Value date (display)
     I                                        1   6 ZA0039
      * Message data for 'Value Date Not Valid 6'
      * Value date (display)
     I                                        1   6 ZA0040
      * Message data for 'Value Date Not Valid 7'
      * Value date (display)
     I                                        1   6 ZA0041
      * Message data for 'Value Date Not Valid 8'
      * Value date (display)
     I                                        1   6 ZA0042
      * Message data for 'Lots of blanks'
      * Message data for 'Trans. type must be blank'
      * Transaction type
     I                                        1   5 ZA0043
      * Message data for 'Cheque No. must be blank'
      * Cheque number
     I                                        1   8 ZA0044
      * Message data for 'Value Date not valid 1'
      * Value date (display)
     I                                        1   6 ZA0045
      * Message data for 'Value Date not valid 2'
      * Value date (display)
     I                                        1   6 ZA0046
      * Message data for 'Value Date Must <= Today'
      * Value date (display)
     I                                        1   6 ZA0047
      * Message data for 'Value Date not valid 4'
      * Value date (display)
     I                                        1   6 ZA0048
      * Message data for 'Value Date not valid 5'
      * Value date (display)
     I                                        1   6 ZA0049
      * Message data for 'Assoc.Cust.No/Shortname 1'
      * Associated Cust - Display
     I                                        1  10 ZA0050
      * Message data for 'Assoc.Cust.No/Shortname 2'
      * Associated Cust - Display
     I                                        1  10 ZA0051
      * Message data for 'Profit Centres         NF'
      * Profit centre
     I                                        1   4 ZA0052
      * Message data for 'Def Prof Centre Not Found'
      * Profit centre
     I                                        1   4 ZA0053
      * Message data for 'Invalid Option'
      * *SFLSEL
     I                                        1   1 ZA0054
      * Message data for 'Invalid Option'
      * *SFLSEL
     I                                        1   1 ZA0055
      * Message data for 'Invalid Option'
      * *SFLSEL
     I                                        1   1 ZA0056
      * Message data for 'Original currency invalid'                      CEU013
      * Original currency code                                            CEU013
     I                                        1   3 ZA0057                CEU013
      * Message data for 'Original amount invalid'                        CEU013
      * Original amount                                                   CEU013
     I                                        1  16 ZA0058                CEU013
      * Called program EU0200 in error                                    CEU013
     I                                        1  10 ZA0059                CEU013
     I/COPY WNCPYSRC,GL0122DI01
      /EJECT
      *****************************************************************
     C* Interface journal flag ' ' or 'V' is used in maintenance          CEU013
     C*  programs to validate Account number. This flag is passed on      CEU013
     C*  to Calling programs.                                             CEU013
     C*                                                                   CEU013
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1BTNB    PARM           WP0001  3        Batch number
     C           P1BCDA    PARM           WP0002  3        Branch Code - A
     C           P1DPCD    PARM           WP0003  3        Dept Code
     C           P1HINC    PARM           WP0004  30       Hash item no.ca
     C           P1MBRB    PARM           WP0005  1        Multiple Branch
     C           P2BICN    PARM           WP0006  6        Branch Internal
     C           P3ACTC    PARM           WP0007  1        Action Code
     C           P4EXTO    PARM P4EXTO    WP0008  1        Exit option
     C                     PARM           WP0009  1        Interface Jrnl CEU013
      *****************************************************************
      * Initialise
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise & load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   05                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END                             OD W0RSF
     C                     END                             OD *HIVAL
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise and load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * USER: Initialise subfile control
      * 00/Copy Member GL0122DISC - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122DISC
     C*00/Copy Member GL0122D   Initialise Subf Control
      * Position DBF file
     C           KPOS      KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Setup key
     C                     MOVEL#2BTNB    BTBTNB           Batch number
     C                     Z-ADD#2BINB    BTBINB           Batch item no.
     C           KPOS      SETLL@BTREAL
     C           KRST      KLIST
     C                     KFLD           BTBTNB           Batch number
      * Setup key
     C                     MOVEL#2BTNB    BTBTNB           Batch number
     C           KRST      READE@BTREAL                8782*82=EOF
      * Save previous selector values
     C           *LIKE     DEFN #2BINB    WZBINB
     C                     MOVEL#2BINB    WZBINB           Batch item no.
     C           *LIKE     DEFN #2CUST    WZCUST
     C                     MOVEL#2CUST    WZCUST           Customer number
     C           *LIKE     DEFN #2NNBI    WZNNBI
     C                     MOVEL#2NNBI    WZNNBI           Nostro number (
     C           *LIKE     DEFN #2RACN    WZRACN
     C                     MOVEL#2RACN    WZRACN           Retail account
     C           *LIKE     DEFN #2RINE    WZRINE
     C                     MOVEL#2RINE    WZRINE           Retail ind.: Er
     C           *LIKE     DEFN #2TRTY    WZTRTY
     C                     MOVEL#2TRTY    WZTRTY           Transaction typ
     C           *LIKE     DEFN #2PTAM    WZPTAM
     C                     MOVEL#2PTAM    WZPTAM           Posting amount
     C           *LIKE     DEFN #2PTDT    WZPTDT
     C                     MOVEL#2PTDT    WZPTDT           Posting date
     C           *LIKE     DEFN #2VLDT    WZVLDT
     C                     MOVEL#2VLDT    WZVLDT           Value date
     C           *LIKE     DEFN #2NVCD    WZNVCD
     C                     MOVEL#2NVCD    WZNVCD           Narrative code
     C           *LIKE     DEFN #2NRDC    WZNRDC
     C                     MOVEL#2NRDC    WZNRDC           Narrative descr
     C           *LIKE     DEFN #2ACTY    WZACTY
     C                     MOVEL#2ACTY    WZACTY           Account type
     C           *LIKE     DEFN #2ACNB    WZACNB
     C                     MOVEL#2ACNB    WZACNB           Assoc. Customer
     C           *LIKE     DEFN #2CQNB    WZCQNB
     C                     MOVEL#2CQNB    WZCQNB           Cheque number
     C           *LIKE     DEFN #2COIN    WZCOIN
     C                     MOVEL#2COIN    WZCOIN           Customer origin
     C           *LIKE     DEFN #2SWCR    WZSWCR
     C                     MOVEL#2SWCR    WZSWCR           Swift common re
     C           *LIKE     DEFN #2PRCN    WZPRCN
     C                     MOVEL#2PRCN    WZPRCN           Profit centre
     C           *LIKE     DEFN #2BCBH    WZBCBH
     C                     MOVEL#2BCBH    WZBCBH           Branch Code (Ba
     C           *LIKE     DEFN #2RADP    WZRADP
     C                     MOVEL#2RADP    WZRADP           Retail advice p
     C           *LIKE     DEFN #2SHPI    WZSHPI
     C                     MOVEL#2SHPI    WZSHPI           Shadow post ind
     C           *LIKE     DEFN #2RRNM    WZRRNM
     C                     MOVEL#2RRNM    WZRRNM           Relative rec no
     C           *LIKE     DEFN #2RNBE    WZRNBE
     C                     MOVEL#2RNBE    WZRNBE           Retail Number E
     C           *LIKE     DEFN #2RARC    WZRARC
     C                     MOVEL#2RARC    WZRARC           Retail Ac Refer
     C           *LIKE     DEFN #2CYCD    WZCYCD
     C                     MOVEL#2CYCD    WZCYCD           Currency code
     C           *LIKE     DEFN #2ACCD    WZACCD
     C                     MOVEL#2ACCD    WZACCD           Account code
     C           *LIKE     DEFN #2ACSN    WZACSN
     C                     MOVEL#2ACSN    WZACSN           Account sequenc
     C           *LIKE     DEFN #2IBCA    WZIBCA
     C                     MOVEL#2IBCA    WZIBCA           Input Branch Co
     C           *LIKE     DEFN #2DCIN    WZDCIN
     C                     MOVEL#2DCIN    WZDCIN           Debit/credit in
     C           *LIKE     DEFN #2RINO    WZRINO
     C                     MOVEL#2RINO    WZRINO           Retail ind.: Ov
     C           *LIKE     DEFN #2OCCY    WZOCCY                          CEU013
     C                     MOVEL#2OCCY    WZOCCY           Original currenCEU013
      * Load subfile page
     C                     Z-ADD0         ##RROK  50
     C                     EXSR BBLDSF
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page
      *================================================================
      * Re-establish fields in read-ahead record
     C   27                DO
     C  N82                READP@BTREAL                  90*
     C  N82                READ @BTREAL                  90*
     C                     END
      *
      * Setof record error indicators
     C************         MOVEL*ALL'0'   WKIND0  1                       087102
     C                     MOVEL*ALL'0'   WKIND0  2                       087102
     C                     MOVEAWKIND0    *IN,40
     C                     MOVE *BLANK    P4EXTO            EXIT OPTION   087102
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
      * Reset count of DBF records read
     C                     Z-ADD0         ##RRRD  50
      *................................................................
      * Load next SFL page until SFL page full, or
      * Scan limit reached
     C           *IN82     DOWEQ'0'                        DO
     C           ##RROK    ANDLT##SFPG
     C           ##RRRD    ANDLTW0SLM
      * Check selection fields - if fail, read next record
     C           #2CUST    IFNE *BLANK                     Customer number
     C           BTCUST    CABNE#2CUST    BB020            Customer number
     C                     END
     C           #2NNBI    IFNE *BLANK                     Nostro number (
     C           BTNNBI    CABNE#2NNBI    BB020            Nostro number (
     C                     END
     C           #2RACN    IFNE *ZERO                      Retail account
     C           BTRACN    CABNE#2RACN    BB020            Retail account
     C                     END
     C           #2RINE    IFNE *BLANK                     Retail ind.: Er
     C           BTRINE    CABNE#2RINE    BB020            Retail ind.: Er
     C                     END
     C           #2TRTY    IFNE *BLANK                     Transaction typ
     C           BTTRTY    CABNE#2TRTY    BB020            Transaction typ
     C                     END
     C           #2PTAM    IFNE *ZERO                      Posting amount
     C           BTPTAM    CABNE#2PTAM    BB020            Posting amount
     C                     END
     C           #2PTDT    IFNE *ZERO                      Posting date
     C           BTPTDT    CABNE#2PTDT    BB020            Posting date
     C                     END
     C           #2VLDT    IFNE *ZERO                      Value date
     C           BTVLDT    CABNE#2VLDT    BB020            Value date
     C                     END
     C           #2NVCD    IFNE *BLANK                     Narrative code
     C           BTNVCD    CABNE#2NVCD    BB020            Narrative code
     C                     END
     C           #2NRDC    IFNE *BLANK                     Narrative descr
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           BTNRDC           Narrative descr
      * Length
     C                     PARM 30        WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           #2NRDC
      * Length
     C                     PARM 30        WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2ACTY    IFNE *BLANK                     Account type
     C           BTACTY    CABNE#2ACTY    BB020            Account type
     C                     END
     C           #2ACNB    IFNE *BLANK                     Assoc. Customer
     C           BTACNB    CABNE#2ACNB    BB020            Assoc. Customer
     C                     END
     C           #2CQNB    IFNE *BLANK                     Cheque number
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           BTCQNB           Cheque number
      * Length
     C                     PARM 8         WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           #2CQNB
      * Length
     C                     PARM 8         WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2COIN    IFNE *BLANK                     Customer origin
     C           BTCOIN    CABNE#2COIN    BB020            Customer origin
     C                     END
     C           #2SWCR    IFNE *BLANK                     Swift common re
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           BTSWCR           Swift common re
      * Length
     C                     PARM 16        WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           #2SWCR
      * Length
     C                     PARM 16        WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2PRCN    IFNE *BLANK                     Profit centre
     C           BTPRCN    CABNE#2PRCN    BB020            Profit centre
     C                     END
     C           #2BCBH    IFNE *BLANK                     Branch Code (Ba
     C           BTBCBH    CABNE#2BCBH    BB020            Branch Code (Ba
     C                     END
     C           #2RADP    IFNE *BLANK                     Retail advice p
     C           BTRADP    CABNE#2RADP    BB020            Retail advice p
     C                     END
     C           #2SHPI    IFNE *BLANK                     Shadow post ind
     C           BTSHPI    CABNE#2SHPI    BB020            Shadow post ind
     C                     END
     C           #2RRNM    IFNE *ZERO                      Relative rec no
     C           BTRRNM    CABNE#2RRNM    BB020            Relative rec no
     C                     END
     C           #2RNBE    IFNE *BLANK                     Retail Number E
     C           BTRNBE    CABNE#2RNBE    BB020            Retail Number E
     C                     END
     C           #2RARC    IFNE *BLANK                     Retail Ac Refer
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           BTRARC           Retail Ac Refer
      * Length
     C                     PARM 10        WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           #2RARC
      * Length
     C                     PARM 10        WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2CYCD    IFNE *BLANK                     Currency code
     C           BTCYCD    CABNE#2CYCD    BB020            Currency code
     C                     END
     C           #2ACCD    IFNE *BLANK                     Account code
     C           BTACCD    CABNE#2ACCD    BB020            Account code
     C                     END
     C           #2ACSN    IFNE *BLANK                     Account sequenc
     C           BTACSN    CABNE#2ACSN    BB020            Account sequenc
     C                     END
     C           #2IBCA    IFNE *BLANK                     Input Branch Co
     C           BTIBCA    CABNE#2IBCA    BB020            Input Branch Co
     C                     END
     C           #2DCIN    IFNE *BLANK                     Debit/credit in
     C           BTDCIN    CABNE#2DCIN    BB020            Debit/credit in
     C                     END
     C           #2RINO    IFNE *BLANK                     Retail ind.: Ov
     C           BTRINO    CABNE#2RINO    BB020            Retail ind.: Ov
     C                     END
      * Load SFL fields
     C                     EXSR MBFL#1
     C                     EXSR MC#1FN
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialise subfile record from DBF record
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C                     MOVE A6INCY    WUINCY           In-Currency flgCEU013
     C*
      * Format amount (short) - Standard functions  *
     C                     Z-ADD#1PTAM    ULVALU           Value
      *
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALU 150       I:Value
     C                     PARM WUNBDP    ULDECP  10       I:Decimal place
     C***********          PARM 'L'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM '3'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLF 23        O:Formatted
      *
     C                     MOVE ULRSLF    #RFMPA           Formatted data
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Number of decimal places and 'In' currency flag                  CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C* Access  original currency code for number of decimal places and   CEU013
     C*  In-currency flag                                                 CEU013
     C                     MOVE *BLANK    WKINCY  1        'In' Currency  CEU013
     C                     MOVE *ZERO     WKNBDP  10       No. Decimal PlcCEU013
     C           #1OCCY    IFNE *BLANK                                    CEU013
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Number of decimal places and 'In' currency flag                  CEU013
     C*                                                                   CEU013
     C                     MOVEL#1OCCY    UUCYCD                          CEU013
     C                     CALL 'AOCURRR0'                                CEU013
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CEU013
     C                     PARM '*KEY'    UUAPOP  7        I:Option       CEU013
     C                     PARM           UUCYCD  3        I:Currency CodeCEU013
     C           D@CURR    PARM *BLANK    UUSDY            O:Format       CEU013
     C*                                                                   CEU013
     C* Assign work field to file field values.                           CEU013
     C*                                                                   CEU013
     C                     MOVE UUCYCD    #1OCCY                          CEU013
     C                     MOVELA6NBDP    WKNBDP  10       No. Decimal PlcCEU013
     C                     MOVELA6INCY    WKINCY  1        'In' Currency  CEU013
     C                     ENDIF                           *FI            CEU013
     C*                                                                   CEU013
     C*                                                                   CEU013
     C           #1OAMT    IFNE *ZEROS                                    CEU013
      * Format amount (short) - Standard functions  *                     CEU013
     C                     Z-ADD#1OAMT    ULVALU           Value          CEU013
      *                                                                   CEU013
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>CEU013
     C                     PARM           ULVALU 150       I:Value        CEU013
     C                     PARM WKNBDP    ULDECP  10       I:Decimal placeCEU013
     C                     PARM '3'       ULEDIT  1        I:IBM Edit codeCEU013
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.CEU013
     C                     PARM           ULRSLF 23        O:Formatted    CEU013
      *                                                                   CEU013
     C                     MOVE ULRSLF    #RFMOA           Formatted data CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      *
      * CASE: DB1.Retail Number Entered is Retail Account
     C* If the screen field is not filled, the account identifier         CEU013
     C*  validation is resulting in error.                                CEU013
     C           BTRNBE    IFEQ 'Y'                        *IF
     C                     MOVELBTRACN    #RACID           Account Identif
     C                     ELSE
      * CASE: *OTHERWISE
     C           BTACTY    IFEQ 'N'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUAISF    ANDEQ'*NOSTRO'                                 144466
     C                     MOVELBTCYCD    UXNOST  5                       CEU013
     C                     MOVE BTNNBI    UXNOST                          CEU013
     C                     MOVEL*BLANK    #RACID           Account IdentifCEU013
     C                     MOVELUXNOST    #RACID           Account IdentifCEU013
     C                     ELSE                                           CEU013
      *                                                                   CEU013
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELBTCUST    #RACID           Account Identif
     C                     END                             *FI            CEU013
     C                     END                             *FI
      * CASE: DB1.Narrative code is Narrative code
     C           BTNVCD    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVELBTNVCD    #RNRTV           Narrative
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELBTNRDC    #RNRTV           Narrative
     C                     END                             *FI
      * Start   S01234
      * CASE: PAR.Action Code is Maintenance
     C           P3ACTC    IFEQ 'A'                        *IF
     C           P3ACTC    OREQ 'D'
     C           P3ACTC    OREQ 'I'
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM #1VLDT    WQ0001  50       Runday Number
     C                     PARM WUDTFF    WQ0002  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0003  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0004  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.Date (numeric format) is No Date entered
     C           WUDTNF    IFEQ *ZERO                      *IF
     C                     MOVEL*BLANK    WUVDDS           Value date (dis
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUDTNF    WUVDDS           Value date (dis
     C                     END                             *FI
     C                     MOVEL*BLANK    WUASCD           Associated Cust
     C                     MOVEL#1ACNB    WUASCD           Associated Cust
     C*
     C*
      * Val Subfile Rec Relations
      * Check Account Identifier
     C                     EXSR UASUBR                     Check Account I
      * Check Posting Amount
     C                     EXSR UDSUBR                     Check Posting A
      * Check Narrative
     C                     EXSR UESUBR                     Check Narrative
      * Check Retail/Non-Retail Fields
     C                     EXSR UFSUBR                     Check Retail/No
      * Check Associated Customer
     C                     EXSR UNSUBR                     Check Associate
      * Check Profit Centre Code
     C                     EXSR UOSUBR                     Check Profit Ce
      * Setup Branch code (Header) & Posting Date on RCD
     C                     EXSR UPSUBR                     Setup Branch co
     C/COPY WNCPYSRC,GL0122DC31
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C* Check Original currency                                           CEU013
     C                     EXSR VALOCY                                    CEU013
     C* Check Original amount                                             CEU013
     C                     EXSR VALORG                                    CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C/COPY WNCPYSRC,GL0122DC07
      * Check Field Indicators - Standard functions  *
     C*
     C* Set Error on batch indicator to P Indicating Errors outstanding
     C* In Batch Postings.. Occurred during I/Face Batch Being Read..
     C*
     C           *IN98     IFEQ '1'
     C                     SETON                     41                   087102
     C                     MOVEL'P'       P4EXTO            EXIT OPTION
     C                     END                              *FI
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WKSKIP    ANDEQ'Y'                                       CEU013
     C           WWFLG     IFEQ 'Y'                                       CEU013
     C           WERRF     IFNE 'Y'                                       CEU013
      * Clear messages from program message queue                         CEU013
     C                     CALL 'Y2CLMSC'                                 CEU013
     C                     PARM ##PGM     ZAPGM  10                       CEU013
     C                     PARM '*SAME'   ZAPGRL  5                       CEU013
     C                     SETOF                     99                   CEU013
     C                     SETOF                     9841                 CEU013
     C                     MOVE *BLANKS   P4EXTO                          CEU013
     C                     MOVE 'Y'       W0RSF            Load subfile   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE *BLANKS   WWFLG                           CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C*
     C* Override all error indicators
     C*
     C************         MOVEA*ZEROS    *IN                             087102
     C**Clear*messages*from*program*message*queue.***                     087102
     C************         CALL 'Y2CLMSC'                                 087102
     C************         PARM ##PGM     ZAPGM  10                       087102
     C************         PARM '*SAME'   ZAPGRL  5                       087102
     C                     END                             *FI
      * End   S01234
      * 00/Copy Member GL0122DISR - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122DISR
     C*00/Copy Member GL0122D   Initialise Subfile Rcd
      * DBF record not selected
     C           W0RSL     CABNE'Y'       BB020
      * Output to subfile
     C                     ADD  1         ##RR       81    *
     C                     ADD  1         ##RROK
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
     C           BB020     TAG
     C                     MOVEAWKIND0    *IN,40                          087102
     C                     SETOF                     98                   087102
      * Increment scan check count
     C                     ADD  1         ##RRRD
     C           KRST      READE@BTREAL                  82*82=EOF
     C                     END                             OD 1 - ##SFPG
      *................................................................
      * If no DBF records found, display error message
     C           ##RR      IFEQ *ZERO
     C           *IN82     ANDEQ'1'
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI ##RR = *ZERO
      *
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
     C           ##RRMX    ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      * If scan limit reached, display error message
     C           ##RRRD    IFGE W0SLM
      * Send message '*Scan limit reached'
     C                     MOVEL'Y2U0017' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     ELSE
     C                     Z-ADD0         ##RROK
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
     C           W0HLP     DOUEQ'N'
      * Update screen time
     C                     TIME           ##TME
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN81     IFNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN81     CAIN81  1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
     C                     MOVEL'N'       W0HLP   1
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
     C*                                                                   CEU013
     C* If the warning was already displayed and there was no other       CEU013
     C*   error, set up a Skip work field to control the display of       CEU013
     C*   warning for the second time in the absence of any other         CEU013
     C*   error.                                                          CEU013
     C*                                                                   CEU013
     C                     MOVE *BLANK    WKSKIP                          CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WWFLG     ANDEQ'Y'                                       CEU013
     C           WERRF     ANDNE'Y'                                       CEU013
     C                     MOVE 'Y'       WKSKIP                          CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE *BLANK    WWFLG                           CEU013
     C                     MOVE *BLANK    WERRF                           CEU013
     C*                                                                   CEU013
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     SETOF                       8388*
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      *
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Validate Debit/credit indicator
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#2DCIN    W0NSRQ  1        Debit/credit in
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'MIVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1107881   Y2LSNO  70
     C           #2DCIN    PARM #2DCIN    W0EXVL 20        Debit/credit in
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      * Change of position specified
     C           WZCYCD    CASNE#2CYCD    FBRQRL
     C           WZACCD    CASNE#2ACCD    FBRQRL
     C           WZACSN    CASNE#2ACSN    FBRQRL
     C           WZIBCA    CASNE#2IBCA    FBRQRL
     C           WZDCIN    CASNE#2DCIN    FBRQRL
     C           WZRINO    CASNE#2RINO    FBRQRL
     C                     END
      * USER: Process subfile control (Pre-confirm)
      * 00/Copy Member GL0122DPSC - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122DPSC
     C*00/Copy Member GL0122D   Process Subfile Control
      * Reload subfile requested
     C           W0RSF     CABEQ'Y'       DAEXIT
     C           *IN81     IFEQ '1'
      * Process subfile records
     C                     EXSR DBPRSF
     C                     END
      * USER: Final processing (Pre-confirm)
      * 00/Copy Member GL0122DFPR - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122DFPR
     C*00/Copy Member GL0122D   Final Processing
      * If error, quit processing
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * USER: Process command keys
      * CASE: PAR.Action Code is Maintenance
     C           P3ACTC    IFEQ 'A'                        *IF
     C           P3ACTC    OREQ 'D'
     C           P3ACTC    OREQ 'I'
      * CASE: CTL.*CMD key is *Go to 'Add' mode
     C           *IN09     IFEQ '1'                        *IF
      * Edit GL Btch Post LCL - Journal Entry Posting  *
     C                     MOVEL*BLANK    PARC
     C                     MOVELP1BTNB    PABTNB           Batch number
     C                     Z-ADD#2BINB    PABINB           Batch item no.
      *
     C                     CALL 'GL0123R'              90  Edit GL Btch Po
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: Journal En
     C                     PARM P1BCDA    WQ0050  3        Branch Code - A
     C                     PARM P1DPCD    WQ0051  3        Dept Code
     C                     PARM P1HINC    WQ0052  30       Hash item no.ca
     C                     PARM P1MBRB    WQ0053  1        Multiple Branch
     C                     PARM P2BICN    WQ0054  6        Branch Internal
     C                     PARM *ZERO     WQ0055  30       Batch Item To C
     C                     PARM *ZERO     WQ0056  30       Batch Item To T
     C                     PARM 'I'       WQ0057  1        Action Code
     C                     PARM WP0009    WQ0085  1        Interface Jrnl CEU013
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL*BLANKS   WKSKIP                          CEU013
     C                     END                             *FI
     C                     END                             *FI
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WKSKIP    ANDEQ'Y'                                       CEU013
     C           WERRF     ANDNE'Y'                                       CEU013
     C                     MOVEL'Y'       W0RSF            *Reload subfileCEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      * 00/Copy Member GL0122DPCK - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122DPCK
     C*00/Copy Member GL0122D   Process Command Keys
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
     C                     READC#SFLRCD                  88*
     C           *IN88     DOWEQ'0'
      * Process subfile record
     C                     EXSR DCPRSR
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  88*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Setof error indicators and SFLNXTCHG
     C                     MOVEAWKIND0    *IN,40
     C                     SETOF                     98    *
     C                     EXSR MC#1FN
      * USER: Process subfile record (Pre-confirm)
      * CASE: PAR.Action Code is Maintenance
     C           P3ACTC    IFEQ 'A'                        *IF
     C           P3ACTC    OREQ 'D'
     C           P3ACTC    OREQ 'I'
      * CASE: RCD.*SFLSEL is *Enquire
     C           #1SEL     IFEQ 'E'                        *IF
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0054           *SFLSEL
      * Send message 'Invalid Option'
     C                     MOVEL'GLX0130' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9840  *
      *
     C                     ELSE
      * CASE: RCD.*SFLSEL is *Maintenance
     C           #1SEL     IFEQ 'A'                        *IF
     C           #1SEL     OREQ 'D'
      * CASE: RCD.*SFLSEL is *Amend
     C           #1SEL     IFEQ 'A'                        *IF
     C                     MOVEL'A'       WUACTC           Action Code
     C                     ELSE
      * CASE: RCD.*SFLSEL is *Delete
     C           #1SEL     IFEQ 'D'                        *IF
     C                     MOVEL'D'       WUACTC           Action Code
     C/COPY WNCPYSRC,GL0122DC16
     C                     END                             *FI
     C                     END                             *FI
      * Edit GL Btch Post LCL - Journal Entry Posting  *
     C                     MOVEL*BLANK    PARC
     C                     MOVEL#1BTNB    PABTNB           Batch number
     C                     Z-ADD#1BINB    PABINB           Batch item no.
      *
     C                     CALL 'GL0123R'              90  Edit GL Btch Po
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: Journal En
     C                     PARM P1BCDA    WQ0058  3        Branch Code - A
     C                     PARM P1DPCD    WQ0059  3        Dept Code
     C                     PARM P1HINC    WQ0060  30       Hash item no.ca
     C                     PARM P1MBRB    WQ0061  1        Multiple Branch
     C                     PARM P2BICN    WQ0062  6        Branch Internal
     C                     PARM *ZERO     WQ0063  30       Batch Item To C
     C                     PARM *ZERO     WQ0064  30       Batch Item To T
     C                     PARM WUACTC    WQ0065  1        Action Code
     C                     PARM WP0009    WQ0086  1        Interface Jrnl CEU013
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C/COPY WNCPYSRC,GL0122DC06
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL*BLANKS   WKSKIP                          CEU013
     C                     ELSE
      * CASE: RCD.*SFLSEL is Copy
     C           #1SEL     IFEQ 'C'                        *IF
      * Edit GL Btch Post LCL - Journal Entry Posting  *
     C                     MOVEL*BLANK    PARC
     C                     MOVEL#1BTNB    PABTNB           Batch number
     C                     Z-ADD#1BINB    PABINB           Batch item no.
      *
     C                     CALL 'GL0123R'              90  Edit GL Btch Po
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: Journal En
     C                     PARM P1BCDA    WQ0066  3        Branch Code - A
     C                     PARM P1DPCD    WQ0067  3        Dept Code
     C                     PARM P1HINC    WQ0068  30       Hash item no.ca
     C                     PARM P1MBRB    WQ0069  1        Multiple Branch
     C                     PARM P2BICN    WQ0070  6        Branch Internal
     C                     PARM #1BINB    WQ0071  30       Batch Item To C
     C                     PARM *ZERO     WQ0072  30       Batch Item To T
     C                     PARM 'I'       WQ0073  1        Action Code
     C                     PARM WP0009    WQ0087  1        Interface Jrnl CEU013
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL*BLANKS   WKSKIP                          CEU013
     C                     ELSE
      * CASE: RCD.*SFLSEL is Template
     C           #1SEL     IFEQ 'T'                        *IF
      * Edit GL Btch Post LCL - Journal Entry Posting  *
     C                     MOVEL*BLANK    PARC
     C                     MOVEL#1BTNB    PABTNB           Batch number
     C                     Z-ADD#1BINB    PABINB           Batch item no.
      *
     C                     CALL 'GL0123R'              90  Edit GL Btch Po
     C                     PARM *BLANK    W0RTN   7
     C                     PARM           PARC             KEY: Journal En
     C                     PARM P1BCDA    WQ0074  3        Branch Code - A
     C                     PARM P1DPCD    WQ0075  3        Dept Code
     C                     PARM P1HINC    WQ0076  30       Hash item no.ca
     C                     PARM P1MBRB    WQ0077  1        Multiple Branch
     C                     PARM P2BICN    WQ0078  6        Branch Internal
     C                     PARM *ZERO     WQ0079  30       Batch Item To C
     C                     PARM #1BINB    WQ0080  30       Batch Item To T
     C                     PARM 'I'       WQ0081  1        Action Code
     C                     PARM WP0009    WQ0088  1        Interface Jrnl CEU013
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     MOVEL*BLANKS   WKSKIP                          CEU013
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * CASE: PAR.Action Code is *Enquire
     C           P3ACTC    IFEQ 'E'                        *IF
      * CASE: RCD.*SFLSEL is *Maintenance
     C           #1SEL     IFEQ 'A'                        *IF
     C           #1SEL     OREQ 'D'
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0055           *SFLSEL
      * Send message 'Invalid Option'
     C                     MOVEL'GLX0130' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9840  *
      *
     C                     ELSE
      * CASE: RCD.*SFLSEL is Copy/Template
     C           #1SEL     IFEQ 'C'                        *IF
     C           #1SEL     OREQ 'T'
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0056           *SFLSEL
      * Send message 'Invalid Option'
     C                     MOVEL'GLX0130' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9840  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.*SFLSEL is *Enquire
     C           #1SEL     IFEQ 'E'                        *IF
      * Display GL Btch Post LCL - Journal Entry Posting  *
     C                     CALL 'GL0123E'              90  Display GL Btch
     C                     PARM *BLANK    W0RTN   7
     C                     PARM #1BTNB    WQ0082  3        Batch number
     C                     PARM #1BINB    WQ0083  30       Batch item no.
     C                     PARM *ZEROS    WQ0089  50                                        BUG24339
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * 00/Copy Member GL0122DPSR - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122DPSR
     C*00/Copy Member GL0122D   Process Subfile Record
     C           *IN98     IFEQ '1'
      * SFLRCD invalid
     C  N99                Z-ADD##RR      ##SFRC     99    *
      * SFLNXTCHG
     C                     SETON                     84
     C                     ELSE
      * SFLRCD valid
      * SFLNXTCHG
     C                     SETOF                     84
     C                     MOVEL*BLANK    #1SEL
     C                     END                             FI *IN98
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C                     MOVEL'0'       *IN77
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN77
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C                     MOVEL'0'       *IN78
     C                     MOVEL'0'       *IN79
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN78
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @BTREAL fields to subfile
      *================================================================
     C                     MOVEL*BLANK    #1SEL
     C                     MOVELBTBTNB    #1BTNB           Batch number
     C                     Z-ADDBTBINB    #1BINB           Batch item no.
     C                     MOVELBTCUST    #1CUST           Customer number
     C                     MOVELBTNNBI    #1NNBI           Nostro number (
     C                     Z-ADDBTRACN    #1RACN           Retail account
     C                     MOVELBTRINE    #1RINE           Retail ind.: Er
     C                     MOVELBTTRTY    #1TRTY           Transaction typ
     C                     Z-ADDBTPTAM    #1PTAM           Posting amount
     C                     Z-ADDBTPTDT    #1PTDT           Posting date
     C                     Z-ADDBTVLDT    #1VLDT           Value date
     C                     MOVELBTNVCD    #1NVCD           Narrative code
     C                     MOVELBTNRDC    #1NRDC           Narrative descr
     C                     MOVELBTACTY    #1ACTY           Account type
     C                     MOVELBTACNB    #1ACNB           Assoc. Customer
     C                     MOVELBTCQNB    #1CQNB           Cheque number
     C                     MOVELBTCOIN    #1COIN           Customer origin
     C                     MOVELBTSWCR    #1SWCR           Swift common re
     C                     MOVELBTPRCN    #1PRCN           Profit centre
     C                     MOVELBTBCBH    #1BCBH           Branch Code (Ba
     C                     MOVELBTRADP    #1RADP           Retail advice p
     C                     MOVELBTSHPI    #1SHPI           Shadow post ind
     C                     Z-ADDBTRRNM    #1RRNM           Relative rec no
     C                     MOVELBTRNBE    #1RNBE           Retail Number E
     C                     MOVELBTRARC    #1RARC           Retail Ac Refer
     C                     MOVELBTTSTY    #1TSTY           Transaction (Su
     C                     MOVELBTBKCD    #1BKCD           Book Code
     C                     Z-ADDBTSPFC    #1SPFC           Spread Factor
     C                     MOVELBTRVDI    #1RVDI           Reverse/Void In
     C                     MOVELBTCYCD    #1CYCD           Currency code
     C                     MOVELBTACCD    #1ACCD           Account code
     C                     MOVELBTACSN    #1ACSN           Account sequenc
     C                     MOVELBTIBCA    #1IBCA           Input Branch Co
     C                     MOVELBTDCIN    #1DCIN           Debit/credit in
     C                     MOVELBTRINO    #1RINO           Retail ind.: Ov
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVELBTOCCY    #1OCCY           Original Ccy   CEU013
     C                     Z-ADDBTOAMT    #1OAMT           Original AmountCEU013
     C                     MOVE *BLANKS   #RFMOA           Format Orig amtCEU013
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MC#1FN    BEGSR
      *================================================================
      * CALC: Subfile record function fields
      *================================================================
      * CALC: Subfile record function fields
      * 00/Copy Member GL0122DRFF - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122DRFF
     C*00/Copy Member GL0122D   Calculate Record Funcs
      *================================================================
     CSR         MCEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVELP1BCDA    #PBCDA           Branch Code - A
     C                     MOVELP1DPCD    #PDPCD           Dept Code
     C                     Z-ADDP1HINC    #PHINC           Hash item no.ca
     C                     MOVELP1MBRB    #PMBRB           Multiple Branch
     C                     MOVELP1BTNB    #2BTNB           Batch number
     C                     Z-ADD*ZERO     #2BINB           Batch item no.
     C                     MOVEL*BLANK    #2CUST           Customer number
     C                     MOVEL*BLANK    #2NNBI           Nostro number (
     C                     Z-ADD*ZERO     #2RACN           Retail account
     C                     MOVEL*BLANK    #2RINE           Retail ind.: Er
     C                     MOVEL*BLANK    #2TRTY           Transaction typ
     C                     Z-ADD*ZERO     #2PTAM           Posting amount
     C                     Z-ADD*ZERO     #2PTDT           Posting date
     C                     Z-ADD*ZERO     #2VLDT           Value date
     C                     MOVEL*BLANK    #2NVCD           Narrative code
     C                     MOVEL*BLANK    #2NRDC           Narrative descr
     C                     MOVEL*BLANK    #2ACTY           Account type
     C                     MOVEL*BLANK    #2ACNB           Assoc. Customer
     C                     MOVEL*BLANK    #2CQNB           Cheque number
     C                     MOVEL*BLANK    #2COIN           Customer origin
     C                     MOVEL*BLANK    #2SWCR           Swift common re
     C                     MOVEL*BLANK    #2PRCN           Profit centre
     C                     MOVEL*BLANK    #2BCBH           Branch Code (Ba
     C                     MOVEL*BLANK    #2RADP           Retail advice p
     C                     MOVEL*BLANK    #2SHPI           Shadow post ind
     C                     Z-ADD*ZERO     #2RRNM           Relative rec no
     C                     MOVEL*BLANK    #2RNBE           Retail Number E
     C                     MOVEL*BLANK    #2RARC           Retail Ac Refer
     C                     MOVEL*BLANK    #CACID           Account Identif
     C                     MOVEL*BLANK    #2CYCD           Currency code
     C                     MOVEL*BLANK    #2ACCD           Account code
     C                     MOVEL*BLANK    #2ACSN           Account sequenc
     C                     MOVEL*BLANK    #2IBCA           Input Branch Co
     C                     MOVEL*BLANK    #CFMPA           Formatted Posti
     C                     MOVEL*BLANK    #2DCIN           Debit/credit in
     C                     MOVEL*BLANK    #CNRTV           Narrative
     C                     MOVEL*BLANK    #2RINO           Retail ind.: Ov
     C                     MOVEL*BLANK    #2OCCY           Original currenCEU013
      * Check restriction within
     C                     EXSR VACKRL
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT                                                              CGL002
     CSR         SRGLOV    BEGSR                                          CGL002
      *================================================================   CGL002
      **  Check Overrideable GL Errors                                    CGL002
      *================================================================   CGL002
      *                                                                   CGL002
      **  Initialise work fields                                          CGL002
      *                                                                   CGL002
     C                     MOVELWURETB    URRETI                          CGL002
     C                     MOVEL#1DCIN    URIND                           CGL002
     C* Data structure WURARC has been increased to 13 long and hence     CEU013
     C*  positions 9-10 are not initalised.                               CEU013
     C*                                                                   CEU013
     C*********************MOVEL'NNNNNNNN'WURARC                    CGL002CEU013
     C*********************MOVE 'NN'      WURARC                    CGL002CEU013
     C                     MOVEL'NNNNNNNN'WKRARC                          CEU013
     C                     MOVE 'NN'      WKRARC                          CEU013
      *                                                                   CGL002
      **  Check GL Account Status                                         CGL002
      *                                                                   CGL002
     C                     EXSR SRGLST                                    CGL002
     C                     MOVELURERST    WUIEST                          CGL002
     C                     MOVELURERTX    WUIEMG                          CGL002
      *                                                                   CGL002
      **  Determine Item Error State...                                   CGL002
     C                     SELEC                                          CGL002
      *                                                                   CGL002
      **  ...Errors in Item, send message 'Can't Override GL A/c Error'   CGL002
      *                                                                   CGL002
     C           WUIEST    WHEQ 'E'                                       CGL002
     C                     MOVEL'Y'       #1RINE                          CGL002
     C                     MOVEL'N'       #1RINO                          CGL002
     C                     MOVEL#RACID    ZA0028                          CGL002
     C                     MOVEL#1CYCD    ZA0029                          CGL002
     C                     MOVEL#1ACCD    ZA0030                          CGL002
     C                     MOVEL#1ACSN    ZA0031                          CGL002
     C                     MOVEL'GLX0395' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     98                   CGL002
      *                                                                   CGL002
      **  ...Overridable Errors                                           CGL002
      *                                                                   CGL002
     C           WUIEST    WHEQ 'O'                                       CGL002
     C                     MOVEL'Y'       #1RINE                          CGL002
      *                                                                   CGL002
     C           #1RINO    IFNE 'Y'                                       CGL002
     C           #1RINO    ANDNE'N'                                       CGL002
      *                                                                   CGL002
      **  Override indicator is *Blank, send message 'GL A/c              CGL002
      **  Error Requires Override'                                        CGL002
     C           #1RINO    IFEQ *BLANK                                    CGL002
     C                     MOVEL#1RINO    ZA0032                          CGL002
     C                     MOVEL'GLX0141' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     98                   CGL002
      *                                                                   CGL002
      **  Else, send message 'GL A/c Override Invalid'                    CGL002
     C                     ELSE                                           CGL002
     C                     MOVEL#1RINO    ZA0033                          CGL002
     C                     MOVEL'GLX0214' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     98                   CGL002
     C                     ENDIF                                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  ...No errors in Item                                            CGL002
      *                                                                   CGL002
     C           WUIEST    WHEQ *BLANK                                    CGL002
     C                     MOVEL'N'       #1RINE                          CGL002
     C                     MOVEL*BLANK    #1RINO                          CGL002
      *                                                                   CGL002
      ** Retrieve message Lots of blanks                                  CGL002
     C                     MOVELZADFMF    ZAMSGF                          CGL002
     C                     CALL 'Y2RVMGC'              90                 CGL002
     C                     PARM *BLANK    W0RTN   7                       CGL002
     C                     PARM 'GLX0092' ZAMSID  7                       CGL002
     C                     PARM           ZAMSGF 10                       CGL002
     C                     PARM           ZAMSDA132                       CGL002
     C           WUIEMG    PARM           W0MTX 132                       CGL002
     C                     MOVEL*BLANK    ZAMSDA                          CGL002
     C                     MOVEL*BLANK    ZAMSGF                          CGL002
      *                                                                   CGL002
     C                     ENDSL                                          CGL002
      *                                                                   CGL002
      *================================================================   CGL002
     CSR                   ENDSR                                          CGL002
      /EJECT                                                              CGL002
     CSR         SRGLST    BEGSR                                          CGL002
      *================================================================   CGL002
      **  Check GL Account Status                                         CGL002
      *================================================================   CGL002
      *                                                                   CGL002
     C                     MOVE *IN90     URSI90  1                       CGL002
     C                     MOVE *IN91     URSI91  1                       CGL002
     C                     MOVE *BLANK    URIESL                          CGL002
     C                     MOVE *BLANK    URERST  1                       CGL002
     C                     Z-ADD1         U1      30                      CGL002
     C                     SETOF                     91                   CGL002
      *                                                                   CGL002
      **  Determine if user is authorised to perform GL Account           CGL002
      **  Overrides in all cases                                          CGL002
      *                                                                   CGL002
     C                     CALL 'ZVACTBU'              90                 CGL002
     C                     PARM 'O'       WACTN   1                       CGL002
     C                     PARM #1IBCA    WBRCA   3                       CGL002
     C                     PARM *ZERO     WERCD   10                      CGL002
      *                                                                   CGL002
      **  Call to program ended in error                                  CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C                     MOVEL'Y2U0021' W0RTN   7                       CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Error Condition                                           CGL002
     C           WERCD     IFEQ 0                                         CGL002
     C                     MOVE 'Y'       WUAUTH  1                       CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'N'       WUAUTH                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Refer Debits:                                             CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'D'                                       CGL002
     C                     TESTB'0'       URRETI  1      90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE01    IFNE 'Y'                                       CGL002
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Refer Dr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSRD                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Refer Credits:                                            CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'C'                                       CGL002
     C                     TESTB'1'       URRETI         90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE02    IFNE 'Y'                                       CGL002
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Refer Cr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSRC                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Block Debits:                                             CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'D'                                       CGL002
     C                     TESTB'2'       URRETI         90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE03    IFNE 'Y'                                       CGL002
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Block Dr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSBD                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Block Credits:                                            CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'C'                                       CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C                     TESTB'3'       URRETI         90               CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE04    IFNE 'Y'                                       CGL002
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Block Cr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSBC                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  If there are any errors, setup non-overrideable error status    CGL002
      *                                                                   CGL002
     C           U1        IFGT 1                                         CGL002
     C           U1        IFLT 5                                         CGL002
     C                     MOVELURNORM    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE URERMG    URERTX                          CGL002
     C           *IN91     IFEQ '1'                                       CGL002
     C                     MOVE 'E'       URERST                          CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'O'       URERST                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Else, no errors found                                           CGL002
     C                     ELSE                                           CGL002
     C                     MOVE *BLANK    URERST                          CGL002
     C                     MOVE URDASH    URERTX 76                       CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     MOVE URSI90    *IN90                           CGL002
     C                     MOVE URSI91    *IN91                           CGL002
      *                                                                   CGL002
      *================================================================   CGL002
     CSR                   ENDSR                                          CGL002
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Check Account Identifier
      *================================================================
     C* If CEU013 switchable function is installed and this is an         CEU013
     C*   interface batch, the Account code file is accessed to           CEU013
     C*   retrieve the account type.  This is used for validation         CEU013
     C*   when the account is not found.                                  CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           #1ACCD    IFNE '?'                        *IF            CEU013
      * Access Account Codes. - Account Codes  *                          CEU013
     C*                                                                   CEU013
     C*  Access Account codes file for the following field                CEU013
     C*  A/c Type                                                         CEU013
     C*                                                                   CEU013
     C                     MOVEL#1ACCD    UUACCD                          CEU013
     C                     CALL 'AOACODR0'                                CEU013
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CEU013
     C                     PARM '*KEY'    UUAPOP  7        I:Option       CEU013
     C**********           PARM           UUACCD  4        I:Account Code              CEU013 CGL029
     C********** D@ACOD    PARM *BLANK    UUFDY            O:Format                    CEU013 CGL029
     C                     PARM           UUACCD 10                                           CGL029
     C           D@ACOD    PARM *BLANK    UUSDY                                               CGL029
     C*                                                                   CEU013
     C* Assign work field to file field values.                           CEU013
     C*                                                                   CEU013
     C                     MOVELA5ACTY    WUACTY           A/C Type       CEU013
     C*                                                                   CEU013
     C                     ENDIF                           *FI            CEU013
     C                     ENDIF                                          CEU013
      * Check Account Identifier. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTV0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACCD
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C                     MOVEL'Y'       WUACIC                          087102
     C*
     C*  Call to Access Program - AOACCTV0 Check Account Identifier
     C*  Access Account Details file for the file fields
     C*
     C/COPY WNCPYSRC,GL0122DC19
     C                     CALL 'AOACCTV0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACCD  4        I:Account Code                     CGL029
     C                     PARM           UUACCD                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch Code  nce
     C           UUAISF    PARM           UUAISF  7        O:Account ID Status
     C           UUNNBI    PARM           UUNNBI  2        O:Nostro Number -Item
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0122DC20
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUAISF    WUAISF           Account Id Status
     C                     MOVELUUNNBI    WUNNBI           Nostro No Item
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1NNBI    WUNNBI           Nostro No Item CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C           #1ACCD    IFNE *BLANKS                                   CEU013
     C                     MOVELA5ACTY    WUACTY           Account Type   CEU013
     C                     ELSE                                           CEU013
     C                     MOVEL#1ACTY    WUACTY           Account Type   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVEL*BLANKS   WUBPST           Account Sub-TypCEU013
     C                     MOVEL*BLANKS   WUACCS           Account Status CEU013
     C                     MOVE *ZEROS    WUDACO           Date Account OpCEU013
     C                     MOVEL*BLANKS   WUACNM           Account Name   CEU013
     C                     MOVEL#1RACN    WURACN           Retails AccountCEU013
     C                     MOVE *ZEROS    WURRNM           Relative rec NoCEU013
     C                     MOVEL*BLANK    WURETB           Retail Indic'trCEU013
     C                     ELSE                                           CEU013
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Ind.    110304
     C                     ENDIF                                          CEU013
     C*
     C/COPY WNCPYSRC,GL0122DC21
      * CASE: WRK.Account ID Status Flag is Customer Not Found
     C           WUAISF    IFEQ '*CUSTNO'                  *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0001           Account Identif
      * Send message 'Customer not found'
     C                     MOVEL'GLX0084' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Nostro Not Found
     C           WUAISF    IFEQ '*NOSTNO'                  *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0002           Account Identif
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*    Nost code not valid is changed as a warning.                   CEU013
     C*                                                                   CEU013
     C           WP0009    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0410' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     ELSE                                           CEU013
      *                                                                   CEU013
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     98    *
      *
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Customer Shortname Err
     C           WUAISF    IFEQ '*SHNERR'                  *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0003           Account Identif
      * Send message 'Nostro/Cust Shortname NF'
     C                     MOVEL'GLX0129' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Account Id Error
     C           WUAISF    IFEQ '*ERROR'                   *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0004           Account Identif
      * Send message 'Account ID not valid ERR'
     C                     MOVEL'GLX0119' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Account Identifier Check is Yes
     C           WUACIC    IFEQ 'Y'                        *IF
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RACID    ZA0005           Account Identif
     C                     MOVEL#1CYCD    ZA0006           Currency code
     C                     MOVEL#1ACCD    ZA0007           Account code
     C                     MOVEL#1ACSN    ZA0008           Account sequenc
     C                     MOVEL#1IBCA    ZA0009           Input Branch Co
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting account type is Retail or Nostro,    CEU013
     C*    the account currency is an 'In' currency,                      CEU013
     C*    and is an interface journal header, issue a warning message .  CEU013
     C*                                                                   CEU013
     C           WP0009    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           A5ACTY    OREQ 'N'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0407' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     ELSE                                           CEU013
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Account status is Closed
     C********** WUACCS    IFEQ 'C'                        *IF                                206317
     C********** WUAPRC    IFEQ '*ACST  '                                              206317 237508
     C           WUACCS    IFEQ 'C'                        *IF                                237508
     C           WURECI    ANDEQ'C'                        *IF                                237508
      * Setup message data for message
     C                     MOVEL#RACID    ZA0010           Account Identif
     C                     MOVEL#1CYCD    ZA0011           Currency code
     C                     MOVEL#1ACCD    ZA0012           Account code
     C                     MOVEL#1ACSN    ZA0013           Account sequenc
     C                     MOVEL#1IBCA    ZA0014           Input Branch Co
     C*                                                                   CEU013
     C* If switchable function CEU013 is installed, the batch is from     CEU013
     C*   external interface and the account is Retail or Nostro,         CEU013
     C*    the account currency is an 'In' currency,                      CEU013
     C*   then the 'account is closed' is converted as a warning.         CEU013
     C*                                                                   CEU013
     C           WP0009    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           WUAISF    ANDEQ'*RETAIL'                                 CEU013
     C           WUAISF    OREQ '*NOSTRO'                                 CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0409' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR                           CEU013
     C                     ELSE                                           CEU013
      * Send message 'Account is Closed'
     C                     MOVEL'GLX0126' ZAMSID
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     98    *
      *
     C                     END                             *FI
      *Account flagged for closure                                                            237508
     C           WUACCS    IFEQ 'C'                        *IF                                237508
     C           WURECI    ANDEQ'D'                        *IF                                237508
      * Setup message data for message                                                        237508
     C                     MOVEL#RACID    ZA0010           Account Identif                    237508
     C                     MOVEL#1CYCD    ZA0011           Currency code                      237508
     C                     MOVEL#1ACCD    ZA0012           Account code                       237508
     C                     MOVEL#1ACSN    ZA0013           Account sequenc                    237508
     C                     MOVEL#1IBCA    ZA0014           Input Branch Co                    237508
      * Send message 'Account is flagged for closure                                          237508
     C**********           MOVEL'GLX0427' ZAMSID                                     237508 AR782538
     C                     MOVEL'GLX0409' ZAMSID                                            AR782538
     C                     MOVE 'Y'       WWFLG                                               237508
     C                     EXSR ZASNMS                                                        237508
     C                     END                             *FI                                237508
      *                                                                                       237508
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Retail
     C           WUAISF    IFEQ '*RETAIL'                  *IF
     C                     MOVEL'Y'       #1RNBE           Retail Number E
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       #1RNBE           Retail Number E
     C                     END                             *FI
      * CASE: WRK.Access Pgm Return Code is *No Errors
     C           WUAPRC    IFEQ *BLANK                     *IF
     C           WUAPRC    ORNE *BLANKS                                   CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           WUAPRC    ORNE *BLANKS                                   CEU013
     C           A5ACTY    ANDEQ'N'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
      * CASE: WRK.Account ID Status Flag is Customer No or short name
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
      * Set Screen Fields = File Fields
     C                     EXSR UBSUBR                     Set Screen Fiel
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUAIVL           Ac Id Valid-Ret
      * Check Input Of Currency
      * CASE: PAR.Currency code is Not blank
     C           #1CYCD    IFNE *BLANK                     *IF
      * CASE: WRK.Currency code EQ PAR.Currency code
     C           WUCYCD    IFEQ #1CYCD                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUAIVL           Ac Id Valid-Ret
     C                     END                             *FI
     C                     END                             *FI
      * Check Input Of Account Code
      * CASE: PAR.Account code is Not blank
     C           #1ACCD    IFNE *BLANK                     *IF
      * CASE: WRK.Account code EQ PAR.Account code
     C           WUACCD    IFEQ #1ACCD                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUAIVL           Ac Id Valid-Ret
     C                     END                             *FI
     C                     END                             *FI
      * Check Input Of Account Sequence
      * CASE: PAR.Account sequence number is Not blank
     C           #1ACSN    IFNE *BLANK                     *IF
      * CASE: WRK.Account sequence number EQ PAR.Account sequence number
     C           WUACSN    IFEQ #1ACSN                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUAIVL           Ac Id Valid-Ret
     C                     END                             *FI
     C                     END                             *FI
      * Check Input Of Branch Code
      * CASE: PAR.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * CASE: WRK.Input Branch Code - Alpha EQ PAR.Input Branch Code - Alpha
     C           WUIBCA    IFEQ #1IBCA                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUAIVL           Ac Id Valid-Ret
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.Ac Id Valid-Ret & Nost is Yes
     C           WUAIVL    IFEQ 'Y'                        *IF
      * Set Screen Fields = File Fields
     C                     EXSR UCSUBR                     Set Screen Fiel
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#RACID    ZA0015           Account Identif
     C                     MOVEL#1CYCD    ZA0016           Currency code
     C                     MOVEL#1ACCD    ZA0017           Account code
     C                     MOVEL#1ACSN    ZA0018           Account sequenc
     C                     MOVEL#1IBCA    ZA0019           Input Branch Co
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting account type is Retail or Nostro     CEU013
     C*    and is an interface journal header, issue a warning message .  CEU013
     C*                                                                   CEU013
     C           WP0009    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           WP0009    OREQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'N'                                       CEU013
     C                     MOVEL'GLX0407' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     ELSE                                           CEU013
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Start of Fix LN0334
     C                     MOVEL*BLANK    WUACTY           Account type
      * End of Fix LN0334
     C                     END                             *FI
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Set Screen Fields = File Fields
      *================================================================
      * CASE: WRK.Account ID Status Flag is Customer Short Name
     C           WUAISF    IFEQ '*SHNAME'                  *IF
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     END                             *FI
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUIBCA    #1IBCA           Input Branch Co
     C                     MOVELWUNNBI    #1NNBI           Nostro number (
     C                     MOVELWUACTY    #1ACTY           Account type
     C                     Z-ADDWURACN    #1RACN           Retail account
     C                     Z-ADDWURRNM    #1RRNM           Relative rec no
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Set Screen Fields = File Fields
      *================================================================
      * CASE: WRK.Account ID Status Flag is Customer Short Name
     C           WUAISF    IFEQ '*SHNAME'                  *IF
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     ELSE
      * CASE: WRK.Account ID Status Flag is Retail
     C           WUAISF    IFEQ '*RETAIL'                  *IF
     C                     MOVELWURACN    #RACID           Account Identif
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUIBCA    #1IBCA           Input Branch Co
     C                     MOVELWUNNBI    #1NNBI           Nostro number (
     C                     MOVELWUACTY    #1ACTY           Account type
     C                     Z-ADDWURACN    #1RACN           Retail account
     C                     Z-ADDWURRNM    #1RRNM           Relative rec no
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      * Check Posting Amount
      *================================================================
      * Start of Fix LN0334
      * CASE: PAR.Currency code is Not Question Mark
     C           #1CYCD    IFNE '?'                        *IF
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUZNDE           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C                     MOVE A6INCY    WUINCY           In-Currency flgCEU013
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     Z-ADD*ZERO     WUZNDE           ZALIGN No Of De
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     WUZNDE           ZALIGN No Of De
     C                     END                             *FI
      * Set up Number of digits
      * CASE: WRK.ZALIGN No Of Decimals is Zero
     C           WUZNDE    IFEQ *ZERO                      *IF
     C***********          Z-ADD12        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD13        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.ZALIGN No Of Decimals is One
     C           WUZNDE    IFEQ 1                          *IF
     C***********          Z-ADD11        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD12        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.ZALIGN No Of Decimals is Two
     C           WUZNDE    IFEQ 2                          *IF
     C***********          Z-ADD10        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD11        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.ZALIGN No Of Decimals is Three
     C           WUZNDE    IFEQ 3                          *IF
     C***********          Z-ADD9         WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD10        WUZNDI           ZALIGN No Of Di089856
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#RFMPA    WUZASF           ZALIGN Screen F
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0122DCP2                                           S01408
      *                                                                   S01408
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0005  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0006 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0007  10       ZALIGN No Of De
     C                     PARM WUZNDI    WQ0008  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0009 16        ZALIGN File Fie
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0122DCP3                                           S01408
      *                                                                   S01408
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0122DCP4                                           S01408
      *                                                                   S01408
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0010 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0011  10       ZALIGN No Of De
      *
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0122DCP3                                           S01408
      *                                                                   S01408
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0020           Formatted Posti
      * Send message 'Amount not valid'
     C                     MOVEL'GLX0063' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Move Fmt Posting Amount - Journal Entry Posting  *
     C*  MOVE ZALIGN FUNCTION FIELD INTO FORMATTED POSTING AMOUNT
     C                     MOVE WUZASF    #RFMPA
      * MOVE Posting Amount - Journal Entry Posting  *
     C*  MOVE ZALIGN FILE FIELD INTO POSTING AMOUNT
     C                     MOVE WUZAFF    #1PTAM
      * CASE: PAR.Posting amount is LE Zero
     C           #1PTAM    IFLE *ZERO                      *IF
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0021           Formatted Posti
      * Send message 'Amount not valid'
     C                     MOVEL'GLX0063' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     END                             *FI
      * End of Fix LN0334
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         UESUBR    BEGSR
      *================================================================
      * Check Narrative
      *================================================================
     C                     MOVEL*BLANK    #1NVCD           Narrative code
     C                     MOVEL*BLANK    #1NRDC           Narrative descr
      * CASE: PAR.Narrative is Select Request
     C           #RNRTV    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Check Narrative - Standard functions  *
     C*  Check Narrative for Narrative code
     C*
     C                     MOVE #RNRTV    URNARR 28        Narrative slice
      *
     C           #RNRTV    IFNE *BLANK                     IF ¬BLANK
     C           URNARR    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*CODE  ' WUNRST             Code entered
     C                     MOVEL#RNRTV    #1NVCD             Narrative code
     C                     ELSE                            EL ¬BLANK
     C                     MOVE '*TEXT  ' WUNRST             Narrative text
     C                     MOVE *BLANK    #1NVCD             No Narr.code
     C                     END                             FI
     C                     ELSE                            EL BLANK
     C                     MOVE '*ERROR ' WUNRST             No narrative
     C                     MOVE *BLANK    #1NVCD             No Narr.code
     C                     END                             FI
      *
      * CASE: WRK.Narrative status is No narrative
     C           WUNRST    IFEQ '*ERROR'                   *IF
      * Setup message data for message
     C                     MOVEL#RNRTV    ZA0022           Narrative
      * Send message 'No Narrative entered'
     C                     MOVEL'GLX0055' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
      * CASE: WRK.Narrative status is Narrative code entered
     C           WUNRST    IFEQ '*CODE'                    *IF
      * Access Narrative. - Narrative Codes  *
     C*
     C*  Access Narrative codes file for the following fields
     C*  Narrative Code, Narrative Description
     C*
     C                     MOVEL#1NVCD    UUNVCD
     C                     CALL 'AONARRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUNVCD  2        I:Narrative Code
     C           D@NARR    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELALNVCD    WUNVCD           Narrative Code
     C                     MOVELALDON     WUDON            Description
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RNRTV    ZA0023           Narrative
      * Send message 'Narrative Code not found'
     C                     MOVEL'GLX0049' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0122DCP5                                           S01408
      *                                                                   S01408
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVELWUNVCD    #RNRTV           Narrative
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#RNRTV    #1NRDC           Narrative descr
     C                     END                             *FI
      *================================================================
     CSR         UEEXIT    ENDSR
      /EJECT
     CSR         UFSUBR    BEGSR
      *================================================================
      * Check Retail/Non-Retail Fields
      *================================================================
     C/COPY WNCPYSRC,GL0122DC01
      * CASE: WRK.Account type is Retail
     C* If CEU013 is installed, the batch is from external interface,     CEU013
     C*  account currency is an 'In' currency, and the account doesn't    CEU013
     C*  exist, the field from Account code is used instead of the        CEU013
     C*  work field. The work field has been overwritten with the         CEU013
     C*  previous account value.                                          CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           *IN98     ANDEQ*ON                                       CEU013
     C           WWFLG     ANDEQ'Y'                                       CEU013
     C                     MOVE A5ACTY    WUACTY                          CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C           WUACTY    IFEQ 'R'                        *IF
      * Check Transaction Type
     C                     EXSR UGSUBR                     Check Transacti
      * Check Overridable Retail Errors
     C                     EXSR UHSUBR                     Check Overridab
      * Check Value Date
     C                     EXSR UISUBR                     Check Value Dat
     C                     ELSE
      * CASE: *OTHERWISE
      *                                                                   CGL002
      **  If Block GL Accounts Enhancement feature is switched on         CGL002
      **  and account type is GL, check overrideable GL errors            CGL002
      *                                                                   CGL002
     C           CGL002    IFEQ 'Y'                                       CGL002
     C           WUACTY    ANDEQ'G'                                       CGL002
     C                     EXSR SRGLOV                                    CGL002
     C                     ELSE                                           CGL002
      *                                                                   CGL002
      * Reset Retail Error Indicators
     C                     EXSR UJSUBR                     Reset Retail Er
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C/COPY WNCPYSRC,GL0122DC08
      * Check Transaction Type is Blank
     C/COPY WNCPYSRC,GL0122DC09
     C                     EXSR UKSUBR                     Check Transacti
      * Check Cheque No is Blank
     C                     EXSR ULSUBR                     Check Cheque No
      * Check For Back Valuations
     C                     EXSR UMSUBR                     Check For Back
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0122DC02
      *                                                                   CGL010
      ** Validate forward value dates for non-retail accounts             CGL010
      *                                                                   CGL010
     C           CGL010    IFEQ 'Y'                                       CGL010
     C           WUACTY    IFEQ 'N'                                       CGL010
     C           WAFVN     ANDEQ'Y'                                       CGL010
     C           WUACTY    OREQ 'D'                                       CGL010
     C           WAFVD     ANDEQ'Y'                                       CGL010
     C           WUACTY    OREQ 'C'                                       CGL010
     C           WAFVC     ANDEQ'Y'                                       CGL010
     C           WUACTY    OREQ 'G'                                       CGL010
     C           WAFVG     ANDEQ'Y'                                       CGL010
      *                                                                   CGL010
     C           WURDNO    ADD  WNDFV     WMFDNO  50                      CGL010
      *                                                                   CGL010
     C           #1VLDT    IFGT WMFDNO                                    CGL010
     C                     MOVELWUVDDS    ZA0036                          CGL010
     C                     MOVEL'GLX0111' ZAMSID                          CGL010
     C                     EXSR ZASNMS                                    CGL010
     C                     MOVE *ON       *IN98                           CGL010
     C                     ENDIF                                          CGL010
     C                     ENDIF                                          CGL010
     C                     ENDIF                                          CGL010
      *                                                                   CGL010
      *================================================================
     CSR         UFEXIT    ENDSR
      /EJECT
     CSR         UGSUBR    BEGSR
      *================================================================
      * Check Transaction Type
      *================================================================
      * CASE: PAR.Transaction type is Entered
     C           #1TRTY    IFNE *BLANK                     *IF
      * CASE: PAR.Transaction type is Select Request
     C           #1TRTY    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Retail Transact. - Retail Transaction Types  *
     C*
     C*  Access Retail Transaction types for the file fields
     C*
     C                     MOVEL#1TRTY    UURTTY
     C                     CALL 'AORETRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UURTTY  5        I:Retail Tran Type
     C           D@RETR    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA1RTTY    WURTTY           Retail Transaction Ty
     C                     MOVELA1RTNM    WURTNM           Retail Tran Name
     C                     MOVELA1COIN    WUCOIN           Cust Originated Ind
     C                     MOVELA1DCIN    WUDCIN           Debit/Credit Ind
     C                     MOVELA1RVIN    WURVIN           Reversal Indicator
     C                     MOVELA1PADI    WUPADI           Print Advices Ind
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1TRTY    ZA0024           Transaction typ
      * Send message 'Trans. type not valid'
     C                     MOVEL'GLX0059' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWURTTY    #1TRTY           Transaction typ
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1TRTY    ZA0025           Transaction typ
      * Send message 'Must enter Trans Type'
     C                     MOVEL'GLX0107' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
      *================================================================
     CSR         UGEXIT    ENDSR
      /EJECT
     CSR         UHSUBR    BEGSR
      *================================================================
      * Check Overridable Retail Errors
      *================================================================
      * Validate Cheque Number
      * CASE: PAR.Cheque number is Not entered
     C           #1CQNB    IFEQ *BLANK                     *IF
     C                     MOVEL'00000000'WUCQNB           Cheque number
     C                     ELSE
      * CASE: *OTHERWISE
      * Start of Fix LN0334
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#1CQNB    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0012  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0013 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0014  10       ZALIGN No Of De
     C                     PARM 8         WQ0015  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0016 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0017 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0018  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0026           Cheque number
      * Send message 'Cheque Number Numeric'
     C                     MOVEL'GLX0209' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * ZALIGN Screen- Cheque No - Standard functions  *
     C* Move ZALIGNed screen field to Cheque Number field before
     C* checking for a Stopped Cheque.
     C*********************MOVE #IZASF    #OCQNB
     C***********          MOVE WUZSCO    #1CQNB                          131441
     C*
      * Verify Stopped Cheque
      * CASE: PAR.Debit/credit indicator is Debit
     C           #1DCIN    IFEQ 'D'                        *IF
      * Verify Stopped Cheque. - Standard functions  *
     C*
     C*  Call to Access Program - AOSTOPV0 Verify Stoppped Cheque
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOSTOPV0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM #1PTAM    UUCQAM 130       I:Cheque Amount
     C***********          PARM WUCQNB    UUCQNB  8        I:Cheque Number131441
     C                     PARM #1CQNB    UUCQNB  8        I:Cheque Number131441
     C                     PARM WURACN    UURACN 100       I:Retail Account No
     C                     PARM WUCUST    UUCUST  6        I:Customer Number
     C                     PARM WUCYCD    UUCYCD  3        I:Currency Code
     C**********           PARM WUACCD    UUACCD  4        I:Account Code                     CGL029
     C                     PARM WUACCD    UUACCD                                              CGL029
     C                     PARM WUACSN    UUACSN  2        I:Acount Sequence
     C                     PARM WUIBCA    UUBRCD  3        I:Branch Code
     C*
      * CASE: WRK.Access Pgm Return Code is Cheque's a stopped cheque
     C           WUAPRC    IFEQ '*STOP'                    *IF
      * CASE: PAR.Retail ind.: Override is Error(s) Overridden
     C           #1RINO    IFEQ 'Y'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0027           Cheque number
      * Send message 'Stopped Cheque'
     C                     MOVEL'GLX0133' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * End of Fix LN0334
     C                     END                             *FI
     C                     END                             *FI
      * Check Retail indicator - Standard functions  *
     C*********************MOVEL#IRTIN    URRETI           Retail ind.    LN0315
     C******************** MOVELWURETB    URRETI    Retail ind.    LN0315 126386
     C                     MOVELRETB      URRETI           Retail ind.    126386
     C*********************MOVEL#IAORC    URSTOP  7        A/O Rtn.Code   S01117
     C                     MOVELWUAPRC    URSTOP  7        A/P Rtn.Code   S01117
     C                     MOVEL#1DCIN    URIND   1                       E17600
     C* Data structure WURARC has been increased to 13 long and hence     CEU013
     C*  positions 9-10 are not initalised.                               CEU013
     C*                                                                   CEU013
     C*********************MOVEL'NNNNNNNN'WURARC             CLEAR OS01212CEU013
     C*********************MOVE 'NN'      WURARC              FIELD S01212CEU013
     C                     MOVEL'NNNNNNNN'WKRARC             CLEAR OVR    CEU013
     C                     MOVE 'NN'      WKRARC              FIELD       CEU013
      *
     C*                                                                   CEU013
     C* If switchable function CEU013 is installed, the batch is an       CEU013
     C*   external interface, the account code type is Retail, the        CEU013
     C*   account currency is an 'In' currency, and the account           CEU013
     C*   does'nt exist, then the account file field values are not       CEU013
     C*   used for validation.                                            CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           *IN98     ANDEQ*ON                                       CEU013
     C           WWFLG     ANDEQ'Y'                                       CEU013
     C                     MOVE *BLANKS   URRETI           Retail Indicat CEU013
     C                     MOVE *BLANKS   WUIEST           Error status   CEU013
     C                     MOVE *BLANKS   WUIEMG           Error message  CEU013
     C                     ELSE                                           CEU013
     C                     EXSR URRETK                     Check Retail
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      *
     C                     MOVELURERST    WUIEST           Error status
     C                     MOVELURERTX    WUIEMG           Error message
      *
      * 99. Extra Overrides - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123ROVR
     C                     MOVELWURARC    #1RARC           Retail Ac Refer
      * Start of case statement SAR017
      * CASE: PAR.Item error state is No errors in Item
     C           WUIEST    IFEQ *BLANK                     *IF
      * Setup message data for message
      * Retrieve message Lots of blanks
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0092' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUIEMG    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
     C                     END                             *FI
      * End of case statement SAR017
      * Check Overrides
      * CASE: PAR.Item error state is Errors in Item
     C           WUIEST    IFEQ 'E'                        *IF
     C                     MOVEL'Y'       #1RINE           Retail ind.: Er
     C                     MOVEL'N'       #1RINO           Retail ind.: Ov
      * Setup message data for message
     C                     MOVEL#RACID    ZA0028           Account Identif
     C                     MOVEL#1CYCD    ZA0029           Currency code
     C                     MOVEL#1ACCD    ZA0030           Account code
     C                     MOVEL#1ACSN    ZA0031           Account sequenc
      * Send message 'Can't O'ride Retail error'
     C                     MOVEL'GLX0085' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: PAR.Item error state is Overridable Errors
     C           WUIEST    IFEQ 'O'                        *IF
     C                     MOVEL'Y'       #1RINE           Retail ind.: Er
      * CASE: PAR.Retail ind.: Override is Error(s) Overridden
     C           #1RINO    IFEQ 'Y'                        *IF
      * Start of Fix LN0320
     C                     ELSE
      * CASE: PAR.Retail ind.: Override is Error(s) not Overridden
     C           #1RINO    IFEQ 'N'                        *IF
     C                     ELSE
      * CASE: PAR.Retail ind.: Override is *Blank
     C           #1RINO    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1RINO    ZA0032           Retail ind.: Ov
      * Send message 'Retail Error Req's Overde'
     C                     MOVEL'GLX0141' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1RINO    ZA0033           Retail ind.: Ov
      * Send message 'Retail Override Invalid'
     C                     MOVEL'GLX0214' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
      * End of Fix LN0320
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: PAR.Item error state is No errors in Item
     C           WUIEST    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       #1RINE           Retail ind.: Er
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UHEXIT    ENDSR
      /EJECT
     CSR         UISUBR    BEGSR
      *================================================================
      * Check Value Date
      *================================================================
      * CASE: PAR.Value date (display) is Date entered
     C           WUVDDS    IFNE *BLANK                     *IF
     C                     MOVELWUVDDS    WUWVDD           Work Value Date
      * Check VDate Blank Entries - Standard functions  *
     C                     CALL 'GL0131U'              90  Check VDate Bla
     C           WUWVDD    PARM WUWVDD    WQ0019  6        Value date (dis
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Check Numeric - Standard functions  *
     C                     MOVE *IN20     UUIN20  1
     C                     MOVE *IN21     UUIN21  1
     C           *LIKE     DEFN WUWVDD    UUVLDT+ 1
     C                     MOVELWUWVDD    UUVLDT
     C                     MOVE '0'       UUVLDT
     C                     TESTN          UUVLDT       21
     C           *IN21     IFEQ '1'
     C                     MOVEL'0'       UUVLDT
     C                     END
     C                     TESTN          UUVLDT     20
     C           *IN20     IFEQ '0'
     C                     MOVE '*NUMERR' W0RTN
     C                     ELSE
     C                     MOVE *BLANKS   W0RTN
     C                     END
     C                     MOVE UUIN20    *IN20
     C                     MOVE UUIN21    *IN21
      * CASE: PGM.*Return code is *Numeric Error
     C           W0RTN     IFEQ '*NUMERR'                  *IF
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0034           Value date (dis
      * Send message 'Value Date not valid 1'
     C                     MOVEL'GLX0109' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * CASE: WRK.Date (numeric format) is Gt 30
     C           WUDTNF    IFGT 30                         *IF
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0020  7        *Return code
     C                     PARM WUDTNF    WQ0021  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0022  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0023  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0035           Value date (dis
      * Send message 'Value Date not valid 2'
     C                     MOVEL'GLX0110' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    WUVDDS           Value date (dis
      * CASE: PAR.Value date GE WRK.Runday Number
     C           #1VLDT    IFGE WURDNO                     *IF
      * START - E19779
      * Validation of Forward Date - REMOVED
      * END - E19779
      * CASE: PAR.Value date GT WRK.Forward Day Number
     C/COPY WNCPYSRC,GL0122DC10
     C           #1VLDT    IFGT WUFDNB                     *IF
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0036           Value date (dis
      * Send message 'Value Date not valid 3'
     C                     MOVEL'GLX0111' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0122DC11
      * Check Value Date NE Hol. - Standard functions  *
     C                     CALL 'GL0130U'              90  Check Value Dat
     C                     PARM #1VLDT    WQ0024  50       Value date
     C                     PARM WULCCY    WQ0025  3        Local Currency
     C                     PARM WULCCD    WQ0026  3        Location Code
     C           WUJJST    PARM *BLANK    WQ0027  1        Error Ind - Day
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.Error Ind - Day - Holiday is Record Found
     C           WUJJST    IFEQ 'H'                        *IF
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0037           Value date (dis
      * Send message 'Value Date Not Valid 9'
     C                     MOVEL'GLX0117' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    WUVDDS           Value date (dis
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C                     MOVELBJLCCY    WULCCY
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUVDDS    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVELP1BCDA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * Locate Local.CCY.Fwd.Days - Standard functions  *
     C                     CALL 'SZDATE3'              90  Locate Local.CC
     C                     PARM WURDNO    WQ0028  50       Runday Number
     C                     PARM WULCCY    WQ0029  3        Local Currency
     C                     PARM WULCCD    WQ0030  3        Location Code
     C                     PARM WUNBFD    WQ0031  20       Number of Forwa
     C           WUFDNB    PARM *ZERO     WQ0032  50       Forward Day Num
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0033  7        *Return code
     C                     PARM WUDTNF    WQ0034  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0035  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0036  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    WUVDDS
     C                     END                             *FI
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUVDDS    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0037  7        *Return code
     C                     PARM WUDTNF    WQ0038  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0039  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0040  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * Value Date A/c Validation - Standard functions  *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANK    P@RTCD  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option
     C                     PARM '*FIRST'  P@OPTN  7        I:Option
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C* Set Retail Key = Numeric Retail Account Number
     C                     MOVEL#1RACN    P@RETK 10
     C*
     C/COPY WNCPYSRC,GL0122DC24
     C                     CALL 'AOACCTR0'
     C                     PARM *BLANK    P@RTCD  7        B:Return code
     C                     PARM '*KEY'    P@OPTN  7        I:Option
     C*********************PARM #IRACN    P@RETK 10        I:Key field
     C                     PARM           P@RETK           I:Key field
     C                     PARM #1CUST    P@CNUM  6        I:Key field
     C                     PARM #1CYCD    P@CCY   3        I:Key field
     C**********           PARM #1ACCD    P@ACOD  4        I:Key field                        CGL029
     C                     PARM #1ACCD    P@ACOD 10                                           CGL029
     C                     PARM #1ACSN    P@ACSQ  2        I:Key field
     C                     PARM #1IBCA    P@IBCA  3        I:Key Field
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C/COPY WNCPYSRC,GL0122DC25
     C* EXTRACT BACK VALUEING PERIOD & CALCULATE BACK VALUE DATE
     C*
     C           WURDNO    SUB  BJBVPD    UUBRUN  50
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the account code type is Retail (it is           CEU013
     C*    already checked for Retail account), account currency is an    CEU013
     C*    'In' currency, and is an interface journal header, ignore      CEU013
     C*    this error.                                                    CEU013
     C* If the account account doesn't exist, the values in Account       CEU013
     C*    file fields are invalid and hence the checking is bypassed.    CEU013
     C*                                                                   CEU013
     C           P@RTCD    IFNE *BLANKS                                   CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     ELSE                                           CEU013
     C*
     C* SAVE INDICATORS
     C*
     C                     MOVE *IN33     UUIN33  10
     C                     MOVE *IN64     UUIN64  10
     C                     MOVE *IN69     UUIN69  10
     C*
     C                     SETOF                     336469
     C*
     C** DR/CR INT.BEARING
     C*
     C***********AADRIF****IFEQ ' '                         IF 1          S01117
     C           DRIF      IFEQ ' '                         IF 1          S01117
     C***********AACRIF****ANDEQ' '                                       S01117
     C           CRIF      ANDEQ' '                                       S01117
     C***********AALDID****COMP AALCID               64                   S01117
     C           LDID      COMP LCID                 64                   S01117
     C***64******UUBRUN****COMP AALDID                 69                 S01117
     C   64      UUBRUN    COMP LDID                   69                 S01117
     C**N64******UUBRUN****COMP AALCID                 69                 S01117
     C  N64      UUBRUN    COMP LCID                   69                 S01117
     C*
     C   69      #1VLDT    COMP UUBRUN                 33
     C***64N69***#1VLDT****COMP AALDID                 3333               S01117
     C   64N69   #1VLDT    COMP LDID                   3333               S01117
     C**N64N69***#1VLDT****COMP AALCID                 3333               S01117
     C  N64N69   #1VLDT    COMP LCID                   3333               S01117
     C   33                MOVE '*DRCRER' W0RTN
     C                     ELSE                              ELSE 1
     C*
     C** CR INT BEARING ONLY
     C*
     C***********AADRIF****IFEQ ' '                          IF 2         S01117
     C           DRIF      IFEQ ' '                          IF 2         S01117
     C***********AALCID****COMP UUBRUN               64                   S01117
     C           LCID      COMP UUBRUN               64                   S01117
     C      64   #1VLDT    COMP UUBRUN                 33
     C*****N64***#1VLDT****COMP AALCID                 3333               S01117
     C     N64   #1VLDT    COMP LCID                   3333               S01117
     C   33                MOVE '*DTCRER' W0RTN
     C                     ELSE                              ELSE 2
     C*
     C** DR INT.BEARING ONLY
     C*
     C***********AACRIF****IFEQ ' '                          IF 3         S01117
     C           CRIF      IFEQ ' '                          IF 3         S01117
     C***********AALDID****COMP UUBRUN               64                   S01117
     C           LDID      COMP UUBRUN               64                   S01117
     C      64   #1VLDT    COMP UUBRUN                 33
     C*****N64***#1VLDT****COMP AALDID                 3333               S01117
     C     N64   #1VLDT    COMP LDID                   3333               S01117
     C   33                MOVE '*DTDRER' W0RTN
     C                     ELSE                              ELSE 3
     C*
     C**   NOT INT.BEARING
     C*
     C           #1VLDT    COMP UUBRUN                 33
     C   33                MOVE '*BVLDER' W0RTN
     C                     END                               END 3
     C                     END                               END 2
     C                     END                               END 1
     C*
     C**   CHECK AGAINST DATE THE ACCOUNT WAS OPENED
     C*
     C           DACO      IFGT #1VLDT                       IF 1
     C                     MOVE '*DTOPER' W0RTN
     C                     END                               END 1
     C/COPY WNCPYSRC,GL0122DC03
     C*
     C* RESTORE INDICATORS
     C*
     C                     MOVE UUIN33    *IN33
     C                     MOVE UUIN64    *IN64
     C                     MOVE UUIN69    *IN69
      * CASE: PGM.*Return code is Value Date Before Ac Open
     C           W0RTN     IFEQ '*DTOPER'                  *IF
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0038           Value date (dis
      * Send message 'Value Date not valid 4'
     C                     MOVEL'GLX0112' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef Back Value Date
     C           W0RTN     IFEQ '*BVLDER'                  *IF
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0039           Value date (dis
      * Send message 'Value Date not valid 5'
     C                     MOVEL'GLX0113' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0122DC04
      * CASE: PGM.*Return code is VDate Before Last CR Int
     C           W0RTN     IFEQ '*DTCRER'                  *IF
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0040           Value date (dis
      * Send message 'Value Date Not Valid 6'
     C                     MOVEL'GLX0114' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Before Last DR Int
     C           W0RTN     IFEQ '*DTDRER'                  *IF
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0041           Value date (dis
      * Send message 'Value Date Not Valid 7'
     C                     MOVEL'GLX0115' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef. Last CR/DR Int
     C           W0RTN     IFEQ '*DRCRER'                  *IF
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0042           Value date (dis
      * Send message 'Value Date Not Valid 8'
     C                     MOVEL'GLX0116' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     ENDIF                                          CEU013
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UIEXIT    ENDSR
      /EJECT
     CSR         UJSUBR    BEGSR
      *================================================================
      * Reset Retail Error Indicators
      *================================================================
     C                     MOVEL'N'       #1RINE           Retail ind.: Er
     C                     MOVEL*BLANK    WUIEST           Item error stat
      * Start of Fix LN0334
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
      * Setup message data for message
      * Retrieve message Lots of blanks
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0092' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUIEMG    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * End of Fix LN0334
      *================================================================
     CSR         UJEXIT    ENDSR
      /EJECT
     CSR         UKSUBR    BEGSR
      *================================================================
      * Check Transaction Type is Blank
      *================================================================
     C/COPY WNCPYSRC,GL0122DC12
      * CASE: PAR.Transaction type is Entered
     C           #1TRTY    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1TRTY    ZA0043           Transaction typ
     C/COPY WNCPYSRC,GL0122DC28
      * Send message 'Trans. type must be blank'
     C                     MOVEL'GLX0061' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
     C/COPY WNCPYSRC,GL0122DC29
      *
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0122DC13
      *================================================================
     CSR         UKEXIT    ENDSR
      /EJECT
     C/COPY WNCPYSRC,GL0122DC14
     CSR         ULSUBR    BEGSR
      *================================================================
      * Check Cheque No is Blank
      *================================================================
      * CASE: PAR.Cheque number is Entered
     C           #1CQNB    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0044           Cheque number
      * Send message 'Cheque No. must be blank'
     C                     MOVEL'GLX0062' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
      *================================================================
     CSR         ULEXIT    ENDSR
      /EJECT
     CSR         UMSUBR    BEGSR
      *================================================================
      * Check For Back Valuations
      *================================================================
      * CASE: PAR.Value date (display) is Date entered
     C           WUVDDS    IFNE *BLANK                     *IF
     C                     MOVELWUVDDS    WUWVDD           Work Value Date
      * Check VDate Blank Entries - Standard functions  *
     C                     CALL 'GL0131U'              90  Check VDate Bla
     C           WUWVDD    PARM WUWVDD    WQ0041  6        Value date (dis
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Check Numeric - Standard functions  *
     C                     MOVE *IN20     UUIN20  1
     C                     MOVE *IN21     UUIN21  1
     C                     MOVELWUWVDD    UUVLDT
     C                     MOVE '0'       UUVLDT
     C                     TESTN          UUVLDT       21
     C           *IN21     IFEQ '1'
     C                     MOVEL'0'       UUVLDT
     C                     END
     C                     TESTN          UUVLDT     20
     C           *IN20     IFEQ '0'
     C                     MOVE '*NUMERR' W0RTN
     C                     ELSE
     C                     MOVE *BLANKS   W0RTN
     C                     END
     C                     MOVE UUIN20    *IN20
     C                     MOVE UUIN21    *IN21
      * CASE: PGM.*Return code is *Numeric Error
     C           W0RTN     IFEQ '*NUMERR'                  *IF
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0045           Value date (dis
      * Send message 'Value Date not valid 1'
     C                     MOVEL'GLX0109' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0042  7        *Return code
     C                     PARM WUDTNF    WQ0043  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0044  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0045  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0046           Value date (dis
      * Send message 'Value Date not valid 2'
     C                     MOVEL'GLX0110' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    WUVDDS           Value date (dis
      * CASE: PAR.Value date GT WRK.Runday Number
     C                     MOVE 'N'       WNONRT                          CGL010
     C           CGL010    IFEQ 'Y'                                       CGL010
     C           WUACTY    IFEQ 'N'                                       CGL010
     C           WAFVN     ANDEQ'Y'                                       CGL010
     C           WUACTY    OREQ 'D'                                       CGL010
     C           WAFVD     ANDEQ'Y'                                       CGL010
     C           WUACTY    OREQ 'C'                                       CGL010
     C           WAFVC     ANDEQ'Y'                                       CGL010
     C           WUACTY    OREQ 'G'                                       CGL010
     C           WAFVG     ANDEQ'Y'                                       CGL010
     C                     MOVE 'Y'       WNONRT  1                       CGL010
     C                     ENDIF                                          CGL010
     C                     ENDIF                                          CGL010
     C/COPY WNCPYSRC,GL0122DC30
      *                                                                   CGL010
     C           #1VLDT    IFGT WURDNO                     *IF
     C           WNONRT    ANDEQ'N'                                       CGL010
     C/COPY WNCPYSRC,GL0122DC17
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0047           Value date (dis
      * Send message 'Value Date Must <= Today'
     C                     MOVEL'GLX0202' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
     C/COPY WNCPYSRC,GL0122DC22
      * CASE: *OTHERWISE
      * VDate A/c Val- Not Retail - Standard functions  *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG  '  P@RTCD  7        B:Return code
     C                     PARM '*FIRST'  P@OPTN  7        I:Option
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C* Set Retail Key = Numeric Retail Account Number
     C                     MOVEL#1RACN    P@RETK 10
     C*
     C/COPY WNCPYSRC,GL0122DC26
     C                     CALL 'AOACCTR0'
     C                     PARM '*MSG   ' P@RTCD  7        B:Return code
     C                     PARM '*KEY'    P@OPTN  7        I:Option
     C                     PARM           P@RETK           I:Key field
     C                     PARM #1CUST    P@CNUM  6        I:Key field
     C                     PARM #1CYCD    P@CCY   3        I:Key field
     C**********           PARM #1ACCD    P@ACOD  4        I:Key field                        CGL029
     C                     PARM #1ACCD    P@ACOD                                              CGL029
     C                     PARM #1ACSN    P@ACSQ  2        I:Key field
     C                     PARM #1IBCA    P@IBCA  3        I:Key Field
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C/COPY WNCPYSRC,GL0122DC27
     C* EXTRACT BACK VALUEING PERIOD & CALCULATE BACK VALUE DATE
     C*
     C           WURDNO    SUB  BJBVPD    UUBRUN  50
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the account code type is Nostro,                 CEU013
     C*    account currency is an 'In' currency, and is an interface      CEU013
     C*    journal header, ignore this error.                             CEU013
     C* If the account account doesn't exist, the values in Account       CEU013
     C*    file fields are invalid and hence the checking is bypassed.    CEU013
     C*                                                                   CEU013
     C           P@RTCD    IFNE *BLANKS                                   CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'N'                                       CEU013
     C                     ELSE                                           CEU013
     C*
     C**   CHECK AGAINST DATE THE BACK VALUE PERIOD
     C*
     C           #1VLDT    IFLT UUBRUN
     C                     MOVE '*BVLDER' W0RTN
     C                     END
     C*
     C**   CHECK AGAINST DATE THE ACCOUNT WAS OPENED
     C*
     C           DACO      IFGT #1VLDT                       IF 1
     C                     MOVE '*DTOPER' W0RTN
     C                     END                               END 1
      * CASE: PGM.*Return code is Value Date Before Ac Open
     C           W0RTN     IFEQ '*DTOPER'                  *IF
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0048           Value date (dis
      * Send message 'Value Date not valid 4'
     C                     MOVEL'GLX0112' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef Back Value Date
     C           W0RTN     IFEQ '*BVLDER'                  *IF
      * Setup message data for message
     C                     MOVELWUVDDS    ZA0049           Value date (dis
      * Send message 'Value Date not valid 5'
     C                     MOVEL'GLX0113' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,GL0122DC23
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD#1PTDT    #1VLDT           Value date
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM #1VLDT    WQ0046  50       Runday Number
     C                     PARM WUDTFF    WQ0047  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0048  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0049  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    WUVDDS
     C                     END                             *FI
      *================================================================
     CSR         UMEXIT    ENDSR
      /EJECT
     CSR         UNSUBR    BEGSR
      *================================================================
      * Check Associated Customer
      *================================================================
      * CASE: PAR.Associated Cust - Display is Entered
     C           WUASCD    IFNE *BLANK                     *IF
      * start of Fix LN0334
      * CASE: PAR.Account code is Not Select
     C           #1ACCD    IFNE '?'                        *IF
      * Access Account Codes. - Account Codes  *
     C*
     C*  Access Account codes file for the following fields
     C*  A/c Type, A/c Name, Account Section, Account Subtype
     C*
     C                     MOVEL#1ACCD    UUACCD                          LN0334
     C                     CALL 'AOACODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C**********           PARM           UUACCD  4        I:Account Code              LN0334 CGL029
     C********** D@ACOD    PARM *BLANK    UUFDY            O:Format                           CGL029
     C                     PARM           UUACCD                                              CGL029
     C           D@ACOD    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA5ACCD    WUACCD           A/c Code       LN0334
     C                     MOVELA5ACTY    WUACTY           A/C Type
     C                     MOVELA5ACCN    WUACCN           A/c Name
     C                     MOVELA5ACSC    WUACSC           A/c Section
     C                     MOVELA5ACST    WUACST           A/c Sub-Type
     C*
     C                     END                             *FI
      * End of Fix LN0334
      * CASE: WRK.Account Section is Income or Expense
     C           WUACSC    IFEQ 'EX'                       *IF
     C           WUACSC    OREQ 'IN'
      * CASE: PAR.Associated Cust - Display is Select Requested
     C           WUASCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Client Details. - Client Details  *
     C*
     C*  Access CLient Details file for the following fields
     C*  Customer No., Customer shortname, DRS Shortname,
     C*  Location, Customer SWIFT I.D.
     C*
     C                     CALL 'AOCUSTR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM WUASCD    UUCNCD 10        I:Client Key
     C                     PARM           UUCRST  7        O:Key status
     C           D@CUST    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUCRST    WUCRST           Key Status  ber
     C*
     C                     MOVELBBCUST    WUACNB           Customer Number
     C                     MOVELBBCSSN    WUCSSN           Shortname
     C                     MOVELBBDRCS    WUDRCS           DRS Shortname
     C                     MOVELBBLCCD    WULCCD           Location
     C                     MOVELBBCSID    WUCSID           SWIFT ID
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVELWUASCD    ZA0050           Associated Cust
      * Send message 'Assoc.Cust.No/Shortname 1'
     C                     MOVEL'GLX0198' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUASCD           Associated Cust
     C                     MOVELWUACNB    WUASCD           Associated Cust
     C                     MOVELWUACNB    #1ACNB           Assoc. Customer
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVELWUASCD    ZA0051           Associated Cust
      * Send message 'Assoc.Cust.No/Shortname 2'
     C                     MOVEL'GLX0199' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #1ACNB           Assoc. Customer
     C                     END                             *FI
      *================================================================
     CSR         UNEXIT    ENDSR
      /EJECT
     CSR         UOSUBR    BEGSR
      *================================================================
      * Check Profit Centre Code
      *================================================================
      * CASE: PAR.Profit centre is Entered
     C           #1PRCN    IFNE *BLANK                     *IF
      * CASE: WRK.Profit Centres Used is Yes
     C           WUPRCU    IFEQ 'Y'                        *IF
      * CASE: PAR.Profit centre is Select requested
     C           #1PRCN    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access profit Centre - Profit Centres  *
     C*
     C*  Access Def centre code off file.
     C*
     C                     MOVEL#1PRCN    UUPCCD
     C                     CALL 'AOPRFCR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUPCCD  4        I:Profit Cent
     C           D@PRFC    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELDSPCCD    WUPRCN           Profit Centre
     C                     MOVELDSPCCD    WUPCDS           Prof Cent Desc
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0052           Profit centre
      * Send message 'Profit Centres         NF'
     C                     MOVEL'GLX0182' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUPRCN    #1PRCN           Profit centre
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Profit Centre Def'ts Used is Yes
     C           WUPCDU    IFEQ 'Y'                        *IF
      * CASE: PAR.Transaction type is Not entered
     C           #1TRTY    IFEQ *BLANK                     *IF
     C                     MOVEL*BLANK    WUTRTY           Transaction typ
     C                     MOVEL'JE'      WUTRTY           Transaction typ
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#1TRTY    WUTRTY           Transaction typ
     C                     END                             *FI
      * Set Prof C Def Mat Key *s - Standard functions  *
     C                     MOVEL'**'      WUBKCD
     C                     MOVEL'**'      WUSBTY
     C                     MOVEL'**'      WUACOC
      * Access Prof C Def Matrix. - Profit Centre Dft Matrix  *
     C*
     C*  Access Def Prof centre code off file.
     C*
     C                     CALL 'AOPRFMR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM WUBKCD    UUBKCD  2        I:Book Code
     C                     PARM WUPCTT    UUPCTT  5        I:Trans Type
     C                     PARM WUSBTY    UUSBTY  2        I:Sub Type
     C                     PARM #1IBCA    UUBRCD  3        I:Branch Code
     C                     PARM WUDPCD    UUDPCD  3        I:Department
     C                     PARM ##USR     UUUSID 10        I:User Profile
     C                     PARM WUACOC    UUACOC  2        I:A/c Officer
     C                     PARM #1CUST    UUCUST  6        I:Customer No.
     C                     PARM *BLANK    UUPCCD  4        O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUPCCD    WUPRCN           Profit Centre
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 0
     C           WUAPRC    IFEQ '0'                        *IF
     C                     MOVELWUPRCN    #1PRCN           Profit centre
     C                     ELSE
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 1
     C           WUAPRC    IFEQ '1'                        *IF
     C                     MOVEL*BLANK    #1PRCN           Profit centre
     C                     ELSE
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 2
     C           WUAPRC    IFEQ '2'                        *IF
     C                     MOVELWUPRCN    #1PRCN           Profit centre
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0053           Profit centre
      * Send message 'Def Prof Centre Not Found'
     C                     MOVEL'GLX0203' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UOEXIT    ENDSR
      /EJECT
     CSR         UPSUBR    BEGSR
      *================================================================
      * Setup Branch code (Header) & Posting Date on RCD
      *================================================================
     C                     MOVELP1BCDA    #1BCBH           Branch Code (Ba
     C                     Z-ADDWURDNO    #1PTDT           Posting date
      *================================================================
     CSR         UPEXIT    ENDSR
     CSR         URRETK    BEGSR
      *====================================================
      * Check Retail Account status
      *----------------------------------------------------
      *
     C                     MOVE *IN90     URSI90  1        Save indicator
     C                     MOVE *IN91     URSI91  1        Save indicator
     C                     MOVE *BLANK    URIESL           Blank msg.text
     C                     MOVE *BLANK    URERST  1        Error status
     C                     Z-ADD1         U1      30       Set pointer
     C                     SETOF                     91    Set ind.
      *
      * Check Refer Debits :
      *
     C           URIND     IFEQ 'D'                        ONLY IF DEBIT  E17600
      *
     C                     TESTB'0'       URRETI  1      90=Refer debits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE01    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Refer Dr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSRD             Refer DR
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Refer Credits :
      *
     C           URIND     IFEQ 'C'                        ONLY IF CREDIT E17600
      *
     C                     TESTB'1'       URRETI         90 Refer credits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE02    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Refer Cr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSRC             Refer CR     S01212
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Block Debits :
      *
     C           URIND     IFEQ 'D'                        ONLY IF DEBIT  E17600
      *
     C                     TESTB'2'       URRETI         90 Block debits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE03    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Block Dr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSBD             Block DR     S01212
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Block Credits :
      *
     C           URIND     IFEQ 'C'                        ONLY IF CREDIT E17600
      *
     C                     TESTB'3'       URRETI         90 Block credits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE04    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Block Cr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSBC             Block CR     S01212
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Inactive A/C :
      *
     C                     TESTB'4'       URRETI         90 Inactive a/c
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE05    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Inactive'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSIN             Inactive     S01212
     C                     END                             FI
      *
      * Check Not in Use :   ***REMOVE COMMENTS IF FLAG TO BE USED LATER***
      *
     C*****                TESTB'5'       URRETI         90 -Not in Use-
      *
     C*****      *IN90     IFEQ '1'                        IF BIT SET
     C*****      URRE06    IFNE 'Y'                        IF NO O'RIDE
     C*****                MOVELURRIHF    @IH,U1             Blnk.H'Light
     C*****                SETON                     91      No O'ride
     C*****                ELSE                            EL O'RIDEABLE
     C*****                MOVELURRIHS    @IH,U1             Highlight
     C*****                END                             FI
     C*****                MOVE 'Not used'@IH,U1             Message text
     C*****                ADD  1         U1                 Incr.pointer
     C*****                MOVE 'Y'       WURTSS             Spare Cond.  S01212
     C*****                END                             FI
      *
      * Check Bankrupt :
      *
     C                     TESTB'6'       URRETI         90 B'rupt/L'dated
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE07    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Bankrupt'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSBR             Bankrupt     S01212
     C                     END                             FI
      *
      * Check Bad Debt :
      *
     C                     TESTB'7'       URRETI         90 Bad debt
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE08    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Bad Debt'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURTSB             Bad Debt     S01212
     C                     END                             FI
      *
      * Check Stopped cheque :
      *
     C           URSTOP    IFEQ '*STOP  '                  IF STOPPED
     C           URRE09    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Chq.Stop'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSSC             Stop.Chq     S01212
     C                     END                             FI
      *
      * Check Non-Overrideable error status :
      *
     C           U1        IFGT 1                          IF ERRORS
     C           U1        IFLT 9                          IF NOT MAXIMUM
     C                     MOVELURNORM    @IH,U1             End Highlight
     C                     END                             FI
     C                     MOVE URERMG    URERTX             Error line
     C           *IN91     IFEQ '1'                        IF NOT O'RIDE
     C                     MOVE 'E'       URERST             Error Status
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVE 'O'       URERST             Error Status
     C                     END                             FI
     C                     ELSE                            EL NO ERRORS
     C                     MOVE *BLANK    URERST             Error Status
     C                     MOVE URDASH    URERTX 76          Dashes
     C                     END                             FI
      *
     C                     MOVE URSI90    *IN90            Restore ind.
     C                     MOVE URSI91    *IN91            Restore ind.
      *
      *----------------------------------------------------
      *
      *====================================================
     C**         UREXIT    ENDSR
     CSR         XXET      ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C                     MOVEL#2BTNB    WK1X01  1        Batch number
     C           WK1X01    IFEQ '?'                        Batch number
     C                     CALL 'GL0140S'              90  *
     C                     PARM           W0RTN   7
     C           #2BTNB    PARM #2BTNB    WQ0084  3        Batch number
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     CABNE*BLANK    VA999
     C                     END
      *................................................................
      *
     C           KLVABR    KLIST
     C                     KFLD           BRBTNB           Batch number
      * Setup key
     C                     MOVEL#2BTNB    BRBTNB           Batch number
     C           KLVABR    CHAIN@BRREAH              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
     C           VA999     TAG
      * Restrictor relation not satisfied
      * Send message 'Journal Entry Header   NF'
     C                     MOVEL'GLX0172' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'GLX0172' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGM     IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGM
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      *                                                                   CEU013
     C           WWERR     IFEQ 'Y'                                       CEU013
     C                     MOVE 'Y'       WWFLG                           CEU013
     C                     ELSE                                           CEU013
     C                     MOVE 'Y'       WERRF                           CEU013
     C                     ENDIF                                          CEU013
      *                                                                   CEU013
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGM
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
      * USER: Exit program processing
      * 00/Copy Member GL0122DEPP - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122DEPP
     C*00/Copy Member GL0122D   Exit Program Processing
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0122DCP1                                           S01408
      *                                                                   S01408
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C/COPY WNCPYSRC,GL0122DC18
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Access Pgm Return Code
     C                     MOVEL*BLANK    WUAPRC  7
      * Define work field Currency code
     C                     MOVEL*BLANK    WUCYCD  3
      * Define work field Currency Name
     C                     MOVEL*BLANK    WUCYNM 14
      * Define work field Number of Decimal Places
     C                     Z-ADD*ZERO     WUNBDP  10
      * Define work field Nostro Shortname
     C                     MOVEL*BLANK    WUNOSN 10
      * Define work field Date Format flag
     C                     MOVEL*BLANK    WUDTFF  1
      * Define work field Date (numeric format)
     C                     Z-ADD*ZERO     WUDTNF  60
      * Define work field Midas Run Date
     C                     MOVEL*BLANK    WUDDCD  7
      * Define work field Value date (display)
     C                     MOVEL*BLANK    WUVDDS  6
      * Define work field Associated Cust - Display
     C                     MOVEL*BLANK    WUASCD 10
      * Define work field Item error message
     C                     MOVEL*BLANK    WUIEMG 76
      * Define work field Item error state
     C                     MOVEL*BLANK    WUIEST  1
      * Define work field Account ID Status Flag
     C                     MOVEL*BLANK    WUAISF  7
      * Define work field Nostro number (Item)
     C                     MOVEL*BLANK    WUNNBI  2
      * Define work field Customer number
     C                     MOVEL*BLANK    WUCUST  6
      * Define work field Record IF                                                           237508
     C                     MOVEL*BLANK    WURECI  1                                           237508
      * Define work field Account code
     C**********           MOVEL*BLANK    WUACCD  4                                           CGL029
     C                     MOVEL*BLANK    WUACCD 10                                           CGL029
      * Define work field Account sequence number
     C                     MOVEL*BLANK    WUACSN  2
      * Define work field Input Branch Code - Alpha
     C                     MOVEL*BLANK    WUIBCA  3
      * Define work field Account type
     C                     MOVEL*BLANK    WUACTY  1
      * Define work field Account subtype
     C                     MOVEL*BLANK    WUBPST  1
      * Define work field Account status
     C                     MOVEL*BLANK    WUACCS  1
      * Define work field Date account opened
     C                     Z-ADD*ZERO     WUDACO  50
      * Define work field Account name
     C                     MOVEL*BLANK    WUACNM 20
      * Define work field Retail account number
     C                     Z-ADD*ZERO     WURACN 100
      * Define work field Relative rec no of memos
     C                     Z-ADD*ZERO     WURRNM  50
      * Obtain default message file
     C           *NAMVAR   DEFN MIMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Account Identifier Check
     C                     MOVEL*BLANK    WUACIC  1
      * Define work field Ac Id Valid-Ret & Nost
     C                     MOVEL*BLANK    WUAIVL  1
      * Define work field ZALIGN No Of Decimals
     C                     Z-ADD*ZERO     WUZNDE  10
      * Define work field ZALIGN No Of Digits
     C                     Z-ADD*ZERO     WUZNDI  20
      * Define work field ZALIGN Screen Fun Field
     C                     MOVEL*BLANK    WUZASF 16
      * Define work field ZALIGN File Field
     C                     MOVEL*BLANK    WUZAFF 16
      * Define work field Error Code
     C                     MOVEL*BLANK    WUERCD  1
      * Define work field Narrative status
     C                     MOVEL*BLANK    WUNRST  7
      * Define work field Narrative code
     C                     MOVEL*BLANK    WUNVCD  2
      * Define work field Description of Narrative
     C                     MOVEL*BLANK    WUDON  30
      * Define work field Retail Transaction Type
     C                     MOVEL*BLANK    WURTTY  5
      * Define work field Retail Transaction Name
     C                     MOVEL*BLANK    WURTNM 30
      * Define work field Customer originated ind.
     C                     MOVEL*BLANK    WUCOIN  1
      * Define work field Debit/credit indicator
     C                     MOVEL*BLANK    WUDCIN  1
      * Define work field Reversal Indicator
     C                     MOVEL*BLANK    WURVIN  1
      * Define work field Print Advices Indicator
     C                     MOVEL*BLANK    WUPADI  1
      * Define work field Cheque number
     C                     MOVEL*BLANK    WUCQNB  8
      * Define work field ZSEDIT Char Output(21)
     C                     MOVEL*BLANK    WUZSCO 21
      * Define work field Retail Indicators   MIDAS
     C************         MOVEL*BLANK    WURETB  1                       080488
     C                     MOVEL*LOVAL    WURETB  1                       080488
      * Define work field Retail Ac Referral Cond.
     C** Length definition removed for fix 080490 because adding a field  080490
     C** to the array changed its length.                                 080490
     C***********          MOVEL*BLANK    WURARC 10                       080490
     C                     MOVEL*BLANK    WURARC                          080490
      * Define work field Work Value Date (display)
     C                     MOVEL*BLANK    WUWVDD  6
      * Define work field Runday Number
     C                     Z-ADD*ZERO     WURDNO  50
      * Define work field Forward Day Number
     C                     Z-ADD*ZERO     WUFDNB  50
      * Define work field Local Currency code
     C                     MOVEL*BLANK    WULCCY  3
      * Define work field Location Code
     C                     MOVEL*BLANK    WULCCD  3
      * Define work field Error Ind - Day - Holiday
     C                     MOVEL*BLANK    WUJJST  1
      * Define work field Branch code
     C                     MOVEL*BLANK    WUBRCD  3
      * Define work field Company Code
     C                     MOVEL*BLANK    WUCMCD  3
      * Define work field Due From Account Code
     C**********           MOVEL*BLANK    WUDFAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDFAC 10                                           CGL029
      * Define work field Due To Account Code
     C**********           MOVEL*BLANK    WUDTAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDTAC 10                                           CGL029
      * Define work field Branch Internal Customer
     C                     MOVEL*BLANK    WUBICN  6
      * Define work field Branch Name
     C                     MOVEL*BLANK    WUBRNM 30
      * Define work field Global Branch Code
     C                     MOVEL*BLANK    WUGBCD  3
      * Define work field Branch Shortname
     C                     MOVEL*BLANK    WUBRSN  3
      * Define work field Number of Forward Days
     C                     Z-ADD*ZERO     WUNBFD  20
      * Define work field Account Code Name
     C                     MOVEL*BLANK    WUACCN 25
      * Define work field Account Section
     C                     MOVEL*BLANK    WUACSC  2
      * Define work field Account Sub-type
     C                     MOVEL*BLANK    WUACST  1
      * Define work field Client key identity
     C                     MOVEL*BLANK    WUCRST  7
      * Define work field Assoc. Customer number
     C                     MOVEL*BLANK    WUACNB  6
      * Define work field Customer Shortname
     C                     MOVEL*BLANK    WUCSSN 10
      * Define work field DRS Customer Shortname
     C                     MOVEL*BLANK    WUDRCS  7
      * Define work field Customer Swift Id
     C                     MOVEL*BLANK    WUCSID 12
      * Define work field Profit Centres Used
     C                     MOVEL*BLANK    WUPRCU  1
      * Define work field Profit centre
     C                     MOVEL*BLANK    WUPRCN  4
      * Define work field Profit Centre Description
     C                     MOVEL*BLANK    WUPCDS 30
      * Define work field Profit Centre Def'ts Used
     C                     MOVEL*BLANK    WUPCDU  1
      * Define work field Transaction type
     C                     MOVEL*BLANK    WUTRTY  5
      * Define work field Book Code
     C                     MOVEL*BLANK    WUBKCD  2
      * Define work field Sub Type
     C                     MOVEL*BLANK    WUSBTY  2
      * Define work field Account Officer Code
     C                     MOVEL*BLANK    WUACOC  2
      * Define work field Profit Centre Transaction
     C                     MOVEL*BLANK    WUPCTT  5
      * Define work field Dept Code
     C                     MOVEL*BLANK    WUDPCD  3
      * Define work field Action Code
     C                     MOVEL*BLANK    WUACTC  1
      * Define work field Multibranching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Define work field Midas Rundate
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Setup Complete
     C                     MOVEL*BLANK    WUSUCP  1
     C                     MOVE *BLANK    WUINCY  1        'In' Currency  CEU013
     C                     MOVE *BLANKS   WKSKIP  1        Skip warning   CEU013
     C                     MOVE *BLANKS   WWFLG   1        Warning flag   CEU013
     C                     MOVE *BLANKS   WERRF   1        Error found flgCEU013
     C                     MOVE *BLANKS   WWERR   1        Warning work flCEU013
     C           *NAMVAR   DEFN           GLREOV           Override DTAARA
     C                     IN   GLREOV                     Obtain   DTAARA
      *
      * Set highlights for error message line :
      *
     C                     MOVE *LOVAL    URNORM  1        ¦ Highlight 0
     C                     BITON'2'       URNORM           ¦ NORMAL
      *
     C                     MOVE *LOVAL    URRIHS  1        ¦ Highlight 1
     C                     BITON'27'      URRIHS           ¦ RI/STEADY
      *
     C                     MOVE *LOVAL    URRIHF  1        ¦ Highlight 2
     C                     BITON'2467'    URRIHF           ¦ RI/HI/BLINK
     C*********************Z-ADD14        ##SFPG  30       SFLPAG         087102
     C***********          Z-ADD500       ##SFPG  30       SFLPAG  087102 169980
     C                     Z-ADD999       ##SFPG  30       SFLPAG         169980
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C***********          Z-ADD500       W0SLM   50                      169980
     C                     Z-ADD999       W0SLM   50                      169980
      *................................................................
      * USER: Initialise program
      * Standard RPG Creation Par - Standard functions  *
      * Last Amend Box - GL0122D - Journal Entry Posting  *
      * Copyright notice - Standard functions  *
      * Define 200 Byte Dummy DS - Standard functions  *
      * Define 800 Byte Dummy DS - Standard functions  *
      * Declare Bank File DS - Standard functions  *
      * Client Details DS - Client Details  *
      * Account Details DS - Standard functions  *
      * Account Codes DS - Account Codes  *
      * Branch Codes DS - Branch Codes  *
      * Currency Codes DS - Currency Codes  *
      * Narrative Codes DS - Narrative Codes  *
      * Prof C Def Matrix DS - Profit Centre Dft Matrix  *
      * Profit Centre DS - Profit Centres  *
      * Retail Transactions DS - Retail Transaction Types  *
      * Access Midas rundate - Standard functions  *
     C*   Access MIDAS Rundate from data-area RUNDAT
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT
     C                     MOVE RDNO      WURDNO
     C                     MOVE SUCP      WUSUCP
     C                     MOVE DTFF      WUDTFF
     C                     MOVE MBIN      WUMBIN
      * Set up CMD key text dspf - Journal Entry Posting  *
     C           P3ACTC    IFEQ 'D'
     C           P3ACTC    OREQ 'A'
     C           P3ACTC    OREQ 'I'
     C                     MOVEACTX1,1    ##CTX1
     C                     MOVEACTX1,2    ##CTX2                          LN0335
     C                     ELSE
     C                     MOVEL*BLANKS   ##CTX1                          LN0335
     C                     MOVEACTX1,3    ##CTX2                          LN0335
     C                     END
      *                                                                   080490
      * Access Retail Details - Retail Details  *                         080490
     C*                                                                   080490
     C*  Access Retail Details types for the file fields                  080490
     C*                                                                   080490
     C                     CALL 'AORETLR0'                                080490
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    080490
     C                     PARM '*FIRST'  UUAPOP  7        I:Option       080490
     C           D@RETL    PARM *BLANK    UUFDY            O:Format       080490
     C*                                                                   080490
     C* Assign work field to file field values.                           080490
     C*                                                                   080490
     C                     MOVE BMNDFV    WUNDFV                          080490
     C           WURDNO    ADD  WUNDFV    WUFDNB           Forward Day Num080490
      *                                                                   080490
      * 00/Copy Member GL0122DIPG - Journal Entry Posting  *
      *                                                                   CGL002
      ** Check if Block GL Accounts Enhancement feature is installed      CGL002
      *                                                                   CGL002
     C                     CALL 'AOSARDR0'                                CGL002
     C           WUAPRC    PARM WUAPRC    UUAPRC  7                       CGL002
     C                     PARM '*VERIFY' UUAPOP  7                       CGL002
     C                     PARM 'CGL002'  UUSARN  6                       CGL002
     C           D@SARD    PARM *BLANKS   UUFDY                           CGL002
      *                                                                   CGL002
     C           WUAPRC    IFEQ *BLANKS                                   CGL002
     C                     MOVE 'Y'       CGL002  1                       CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'N'       CGL002                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C*                                                                   CEU013
     C**  Access SAR details file to see if CEU013 is installed.          CEU013
     C*                                                                   CEU013
     C                     CALL 'AOSARDR0'                                CEU013
     C                     PARM '       ' UUAPRC                          CEU013
     C                     PARM '*VERIFY' UUAPOP                          CEU013
     C                     PARM 'CEU013'  UUSARN                          CEU013
     C*                                                                   CEU013
     C           UUAPRC    IFEQ *BLANK                                    CEU013
     C                     MOVE 'Y'       CEU013  1                       CEU013
     C                     ELSE                                           CEU013
     C                     MOVE 'N'       CEU013                          CEU013
     C                     ENDIF                                          CEU013
      *                                                                   CGL010
      **  Access SAR details file to see if CGL010 is installed.          CGL010
      *                                                                   CGL010
     C                     CALL 'AOSARDR0'                                CGL010
     C                     PARM '       ' UUAPRC                          CGL010
     C                     PARM '*VERIFY' UUAPOP                          CGL010
     C                     PARM 'CGL010'  UUSARN                          CGL010
     C*                                                                   CGL010
     C           UUAPRC    IFEQ *BLANK                                    CGL010
     C                     MOVE 'Y'       CGL010  1                       CGL010
     C                     ELSE                                           CGL010
     C                     MOVE 'N'       CGL010                          CGL010
     C                     ENDIF                                          CGL010
      *                                                                   CGL010
      * Access General Ledger. - General Ledger Details  *                CEU013
     C*                                                                   CEU013
     C*  Access General Ledger Details file for it' file fields           CEU013
     C*                                                                   CEU013
     C**********           CALL 'AOGELRR0'                                CEU013              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CEU013
     C                     PARM '*FIRST'  UUAPOP  7        I:Option       CEU013
     C********** D@GELR    PARM *BLANK    UUFDY            O:Format       CEU013              CGL029
     C           D@GELR    PARM *BLANK    UUSDY                                               CGL029
     C*                                                                   CEU013
     C*                                                                   CEU013
     C                     Z-ADDBKNDFV    WNDFV   30                      CGL010
     C                     MOVE BKAFVN    WAFVN   1                       CGL010
     C                     MOVE BKAFVD    WAFVD   1                       CGL010
     C                     MOVE BKAFVC    WAFVC   1                       CGL010
     C                     MOVE BKAFVG    WAFVG   1                       CGL010
      * Initialise subfile control
     C                     EXSR MEIZ#2
     C/COPY WNCPYSRC,GL0122DC05
      *================================================================
     CSR         ZZEXIT    ENDSR
      /EJECT                                                              CEU013
     C           VALOCY    BEGSR                                          CEU013
      *================================================================   CEU013
      * Validate Original currency entry                                  CEU013
      *================================================================   CEU013
     C*                                                                   CEU013
     C* Validate original currency                                        CEU013
      * CASE: RCD. Original Currency code is Not blank                    CEU013
     C                     MOVE *BLANK    WKINCY  1        'In' Currency  CEU013
     C                     MOVE *ZERO     WKNBDP  10       No. Decimal PlcCEU013
     C           #1OCCY    IFNE *BLANK                                    CEU013
      * Access Currency. - Currency Codes  *                              CEU013
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Number of decimal places and 'In' currency flag                  CEU013
     C*                                                                   CEU013
     C                     MOVEL#1OCCY    UUCYCD                          CEU013
     C                     CALL 'AOCURRR0'                                CEU013
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CEU013
     C                     PARM '*KEY'    UUAPOP  7        I:Option       CEU013
     C                     PARM           UUCYCD  3        I:Currency CodeCEU013
     C           D@CURR    PARM *BLANK    UUSDY            O:Format       CEU013
     C*                                                                   CEU013
      * CASE: WRK.Access Pgm Return Code is Access Error                  CEU013
     C           WUAPRC    IFNE *BLANKS                    *IF            CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0057           Original ccy   CEU013
      * Send message 'Original Currency Code not found'                   CEU013
     C                     MOVEL'GLX0400' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     98    *              CEU013
      *                                                                   CEU013
     C                     ELSE                                           CEU013
      * CASE: *OTHERWISE                                                  CEU013
     C* Assign work field to file field values.                           CEU013
     C*                                                                   CEU013
     C                     MOVE UUCYCD    #1OCCY                          CEU013
     C                     MOVELA6NBDP    WKNBDP  10       No. Decimal PlcCEU013
     C                     MOVELA6INCY    WKINCY  1        'In' Currency  CEU013
     C                     ENDIF                           *FI            CEU013
     C                     ENDIF                           *FI            CEU013
     C*                                                                   CEU013
     C*                                                                   CEU013
      *================================================================   CEU013
     C                     ENDSR                                          CEU013
      /EJECT                                                              CEU013
     C           VALORG    BEGSR                                          CEU013
      *================================================================   CEU013
      * Validate Original currency and amount combination                 CEU013
      *================================================================   CEU013
     C*                                                                   CEU013
     C                     SELEC                                          CEU013
     C           WUINCY    WHNE 'Y'                                       CEU013
     C           #1CYCD    ANDNEBKEURO                                    CEU013
     C* Original currency is allowed only for 'EURO' or 'In' currency     CEU013
     C*   account.                                                        CEU013
     C*                                                                   CEU013
     C           #1OCCY    IFNE *BLANKS                                   CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0057           Original ccy   CEU013
      * Send message 'Original Currency Code not allowed'                 CEU013
     C                     MOVEL'GLX0408' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     98    *              CEU013
     C                     ENDIF                                          CEU013
     C* Original amount is allowed only for 'EURO' or 'In' currency       CEU013
     C*   account.                                                        CEU013
     C*                                                                   CEU013
     C           #RFMOA    IFNE *BLANKS                                   CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#RFMOA    ZA0058           Original amt   CEU013
      * Send message 'Original amount not allowed'                        CEU013
     C                     MOVEL'GLX0398' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     98    *              CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C* If the account currency is 'Euro' or 'In' currency, validate      CEU013
     C*  Original currency and the amount.                                CEU013
     C                     OTHER                                          CEU013
     C                     SELEC                                          CEU013
     C*                                                                   CEU013
      * CASE: RCD. Original Currency code is same as account currency     CEU013
     C* Original currency must not be same as account currency            CEU013
     C*                                                                   CEU013
     C           #1OCCY    WHEQ #1CYCD                                    CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0057           Original ccy   CEU013
      * Send message 'Original Currency Code is not valid'                CEU013
     C                     MOVEL'GLX0399' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     98    *              CEU013
     C*                                                                   CEU013
     C* Validate original currency                                        CEU013
      * CASE: RCD. Original Currency code is Not blank                    CEU013
     C           #1OCCY    WHNE *BLANK                                    CEU013
     C*                                                                   CEU013
     C                     SELEC                                          CEU013
     C           #1OCCY    WHNE BKEURO                                    CEU013
     C           WKINCY    ANDNE'Y'                                       CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0057           Original ccy   CEU013
      * Send message 'Original Currency must be either 'EURO' or          CEU013
     C*   'In' currency.                                                  CEU013
     C                     MOVEL'GLX0404' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     98    *              CEU013
     C*                                                                   CEU013
     C* CASE: Original currency is entered but not original amount        CEU013
     C*                                                                   CEU013
     C           #RFMOA    WHEQ *BLANKS                                   CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#RFMOA    ZA0058           Original amt   CEU013
      * Send message 'Original amount must be entered if Original         CEU013
     C*   currency is entered'                                            CEU013
     C                     MOVEL'GLX0401' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     98    *              CEU013
     C*                                                                   CEU013
     C* CASE: Original currency and Original amount are entered           CEU013
     C*                                                                   CEU013
     C                     OTHER                                          CEU013
     C*                                                                   CEU013
     C                     SELEC                                          CEU013
     C           #1CYCD    WHEQ BKEURO                                    CEU013
     C           #1OCCY    OREQ BKEURO                                    CEU013
     C* If Posting currency or Original currency is Euro, call            CEU013
     C*   conversion program once.                                        CEU013
     C                     Z-ADD#1PTAM    W1FRAM 183       FROM Ccy AmountCEU013
     C                     MOVEL#1CYCD    W1FRCY  3        FROM Currency  CEU013
     C                     MOVEL#1OCCY    W1TOCY  3        TO Currency    CEU013
     C                     EXSR EUCNVT                                    CEU013
     C                     MOVE W1OUTA    W1OAMT 150                      CEU013
      *                                                                   CEU013
     C           W1OAMT    IFNE #1OAMT                                    CEU013
     C           #1OAMT    SUB  W1OAMT    W1DIFF 150                      CEU013
     C*                                                                   CEU013
     C           W1DIFF    IFGT 1                                         CEU013
     C           W1DIFF    ORLT -1                                        CEU013
     C*                                                                   CEU013
      * Setup message data for message                                    CEU013
      * Format amount (short) - Standard functions  *                     CEU013
     C                     Z-ADDW1OUTA    ULVALU           Value          CEU013
      *                                                                   CEU013
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>CEU013
     C                     PARM           ULVALU 150       I:Value        CEU013
     C                     PARM WKNBDP    ULDECP  10       I:Decimal placeCEU013
     C                     PARM '3'       ULEDIT  1        I:IBM Edit codeCEU013
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.CEU013
     C                     PARM           ULRSLF 23        O:Formatted    CEU013
      *                                                                   CEU013
     C                     MOVE ULRSLF    ZA0058           Formatted data CEU013
      * Send message 'The calculated original amount is W1OUTA'           CEU013
     C*                                                                   CEU013
     C                     MOVEL'GLX0406' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     98    *              CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C                     ENDIF                                          CEU013
     C                     OTHER                                          CEU013
     C* If Posting currency and Original currency are 'In' currencies,    CEU013
     C*   then conversion program is called twice.                        CEU013
     C* The first call converts the Posting amount to Euro currency.      CEU013
     C                     Z-ADD#1PTAM    W1FRAM 183       FROM Ccy AmountCEU013
     C                     MOVEL#1CYCD    W1FRCY  3        FROM Currency  CEU013
     C                     MOVELBKEURO    W1TOCY  3        TO Currency    CEU013
     C                     EXSR EUCNVT                                    CEU013
     C                     Z-ADDW1OUTA    W1FRAM 183       FROM Ccy AmountCEU013
     C                     MOVELBKEURO    W1FRCY  3        FROM Currency  CEU013
     C                     MOVEL#1OCCY    W1TOCY  3        TO Currency    CEU013
     C* The second call converts the Euro currency amount to 'In'         CEU013
     C*   currency Original amount.                                       CEU013
     C                     EXSR EUCNVT                                    CEU013
     C                     MOVE W1OUTA    W1OAMT 150                      CEU013
     C           W1OAMT    IFNE #1OAMT                                    CEU013
     C           #1OAMT    SUB  W1OAMT    W1DIFF 150                      CEU013
     C*                                                                   CEU013
     C           W1DIFF    IFGT 1                                         CEU013
     C           W1DIFF    ORLT -1                                        CEU013
      * Setup message data for message                                    CEU013
      * Format amount (short) - Standard functions  *                     CEU013
     C                     Z-ADDW1OUTA    ULVALU           Value          CEU013
      *                                                                   CEU013
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>CEU013
     C                     PARM           ULVALU 150       I:Value        CEU013
     C                     PARM WKNBDP    ULDECP  10       I:Decimal placeCEU013
     C                     PARM '3'       ULEDIT  1        I:IBM Edit codeCEU013
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.CEU013
     C                     PARM           ULRSLF 23        O:Formatted    CEU013
      *                                                                   CEU013
     C                     MOVE ULRSLF    ZA0058           Formatted data CEU013
      * Send message 'The calculated original amount is W1OUTA            CEU013
     C                     MOVEL'GLX0406' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     98    *              CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C                     ENDIF                                          CEU013
     C                     ENDSL                                          CEU013
     C                     ENDSL                                          CEU013
     C*                                                                   CEU013
     C* CASE: Original amount is entered but not original currency        CEU013
     C*                                                                   CEU013
     C           #RFMOA    WHNE *BLANKS                                   CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#RFMOA    ZA0058           Original amt   CEU013
     C* Original amount is not allowed if the original currency is        CEU013
     C*   blank                                                           CEU013
     C                     MOVEL'GLX0402' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     98    *              CEU013
     C                     ENDSL                                          CEU013
     C*                                                                   CEU013
     C                     ENDSL                                          CEU013
     C*                                                                   CEU013
     C* Save the orginal amount for later comparison                      CEU013
     C*                                                                   CEU013
     C*                                                                   CEU013
      *================================================================   CEU013
     C                     ENDSR                                          CEU013
      /EJECT                                                              CEU013
     C           EUCNVT    BEGSR                                          CEU013
      *================================================================   CEU013
      * Convert Euro to 'In' currency or vice versa                       CEU013
      *================================================================   CEU013
     C*                                                                   CEU013
     C                     Z-ADD0         W1OUTA 150       Outright AmountCEU013
     C                     Z-ADD0         W1INTA 183       Interim Amount CEU013
     C                     CALL 'EU0200'                                  CEU013
     C                     PARM *BLANKS   P@RTCD  7        Return Code    CEU013
     C                     PARM W1FRAM    P@FRAM 183       FROM Ccy AmountCEU013
     C                     PARM W1FRCY    P@FRCY  3        FROM Currency  CEU013
     C                     PARM W1TOCY    P@TOCY  3        TO Currency    CEU013
     C           W1OUTA    PARM W1OUTA    P@OUTA 150       Outright AmountCEU013
     C           W1INTA    PARM W1INTA    P@INTA 183       Interim Amount CEU013
     C                     PARM           P@EXRT 159       Exchange Rate  CEU013
     C                     PARM           P@MDIN  1        Mult/Div Ind   CEU013
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL'EU0200  'ZA0059           Error in calledCEU013
      * Send message 'Error in called program'                            CEU013
     C                     MOVEL'GLX0405' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     98    *              CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      *================================================================   CEU013
     C                     ENDSR                                          CEU013
     C/COPY WNCPYSRC,GL0122DC15
** Item Error Message
Err:
----------------------------------------------------------------------------
** CPY@
(c) Finastra International Limited 2001
**
A=Amend   C=Copy   D=Delete   T=Template
F3=Batch Summary   F5=Refresh   F9=Go to 'Add Mode'
E=Enquire   F3=Batch Summary   F5=Refresh
