     H            Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Abbreviated posting maintenance')             *
     H/TITLE Midas GL Edit abbreviated posting
     Z* CRTRPGPGM
     Z* IGNDECERR(*YES)
      *
     H* SYNOPSIS :
     H* - Maintain database file using subfile display
     H* - Existing records may be updated or deleted
     H* - Key changes are not allowed
     H* - Program functions in two modes : *ADD and *CHANGE
     H* - Multiple new records may be added by changing to add mode
      *
     H* Generated by  : SYNON/2  Version:  1080
     H* Function type : Edit file
      *
     H*  Company :
     H* System        : General Ledger Synon Model
     H* User name     : LEMMONP
     H* Date          : 28/07/93  Time  : 12:50:02
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     F*****************************************************************
      *                                                               *
      *  Last Amend No. MD038989           Date 11Jul16               *      
      *  Prev Amend No. MD027587           Date 19Jun14               *
      *                 AR1093096          Date 30Sep13               *
      *                 AR782538           Date 03Jun11               *
      *                 AR855165           Date 28Oct11               *
      *                 CAP207             Date 10Feb11               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 237508             Date 23May06               *
      *                 CSD031             Date 10Apr06               *
      *                 237620             Date 25Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA035             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 210796             Date 27Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 191175             Date 17Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 28Jun02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CAP032             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01Mar99               *
      *                 CGL008             Date 01Mar99               *
      *                 CTI002           Date 23Sep98                 *
     F*                CGL002            DATE : 28OCT96               *
     F*                S01408            DATE : 25NOV96               *
     F*                S01408            DATE : 26SEP96               *
     F*                089856            DATE : 25OCT95               *
     F*                S01408            DATE : 22AUG94               *
     F*                S01413            DATE : 27JUL93               *
     F*                054018            DATE : 04JUN93               *
     F*                S10736            DATE : 09SEP92               *
     F*                E03063            DATE : 14FEB92               *
     F*                S01314            DATE : 09MAY91               *
     F*                LN0312            DATE : 12JUN90               *
     F*                LN0315            DATE : 06JUN90               *
     F*                S01212            DATE : 11/09/89              *
     F*                E18437            DATE : 18/05/89              *
     F*                E17939            DATE : ../05/89              *
     F*                E17819            DATE : 02/05/89              *
     F*                E17610            DATE : 27/04/89              *
     F*                                                               *
     F*****************************************************************
      *                                                               *
      *  MD038989 - Journal Entry is allowed for Blocked Nostro a/c.  *
      *             Ensure that RETB will be validated for nostro a/cs*      
      *  MD027587 - Unable to used the C for Copy and T for Template  *
      *             (Recompile)                                       *
      *  AR1093096 - ABC - Reservations not removed for JRNE.         *
      *              (Child: AR1093097) (Recompile)                   *
      *  AR782538 - Misleading warning message issued when accnt is   *
      *             closed. Changed to more appropriate message       *
      *             (Child: AR782539)                                 *
      *  AR855165 - Abbreviated JE maintenance not possible to accept *
      *             due to error message GLX0428 (Child:AR855166)     *
      *  CAP207 - Account Balance Check extended to other APIs        *
      *           (Recompile)                                         *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  237508 - Issue warning message if account is flagged for     *
      *           closure.                                            *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  237620 - Increase 1DBRC field to 250, and initialise BTOAMT  *
      *           to zero to prevent decimal data error.              *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  210796 - EXTEND OUR A/C AT NOSTRO FIELD                      *
      *  191175 - CGL008 modification. User cannot authorise the      *
      *           batch if any amendment was made and the user        *
      *           authority level is 'Z'.                             *
      *  CPK015 - Release 4.01 Packaging:                             *
      *           - A default timestamp string is required for WRITE. *
      *  CAP032 - Conversion of Journal Batch Entry inputs into       *
      *           modular structure to use as APIs. Recompiled        *
      *           due to change in length of #1DBRC field in the      *
      *           display file.                                       *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CGL008 - Security on Journal Entry Input                     *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*   CGL002 - Block GL Accounts in Journal Entry Input           *
     F*   S01408 - REPLACEMENT OF GL0181* HOOKS WITH THE FOLLOWING:   *
     F*            ADDITION OF HOOK GL0122MP12                        *
     F*            ADDITION OF HOOK GL0122MP11                        *
     F*            ADDITION OF HOOK GL0122MP10                        *
     F*            ADDITION OF HOOK GL0122MCP9                        *
     F*            ADDITION OF HOOK GL0122MCP8                        *
     F*            ADDITION OF HOOK GL0122MCP7                        *
     F*            ADDITION OF HOOK GL0122MCP6                        *
     F*            ADDITION OF HOOK GL0122MCP5                        *
     F*   S01408 - ADDITION OF HOOK GL0122MFP1                        *
     F*   089856 - Change to allow posting amount as 13N as specified *
     F*            in Ins Manual.                                     *
     F*   S01408 - ADDITION OF HOOK GL0122MCP1                        *
     F*            ADDITION OF HOOK GL0122MCP2                        *
     F*            ADDITION OF HOOK GL0122MCP3                        *
     F*            ADDITION OF HOOK GL0122MCP4                        *
     F*   S01413 - RETAIL 3 INCORPORATION:- NO OF ITEMS ADDED TO      *
     F*            GLJENPPD. REGEN AND RECOMPILE ONLY.                *
     F*   054018 - OVERRIDE IND. DISPLAYED FOR NON RETAIL A/CS        *
     F*   S10736 - MANAGEMENT ACCOUNTS                                *
     F*   E03063 - CHANGE SPFA TO FMPA SO THAT IT IS THE SAME LENGTH  *
     F*            AS IN THE FULL JOURNAL ENTRY. THEREFORE THE END    *
     F*            DIGIT WILL NOT BE LOST.  REMOVE ASOC FROM SCREEN   *
     F*            SO THE NEW FIELD (1 CHAR LONGER) WILL FIT IN.      *
     F*                                                               *
     F*   S01314 - Multi-Language Subfile Coding                      *
     F*                                                               *
     F*   LN0312 - CHANGE FOOTER TO BE F3=BATCH SUMMARY NOT F3=EXIT   *
     F*                                                               *
     F*   LN0315 - ADDITION OF RETAIL INDICATORS ON CALL TO AOACCTR0  *
     F*                                                               *
     F*   S01212 - TO RESTRICT THE COPYING OF RECORDS TO THE LAST ONE *
     F*            PRESENT ON THE FILE                                *
     F*                                                               *
     F*   E18437 - PROGRAM ALLOWED ENTRIES TO BE INPUT ACROSS CLOSED  *
     F*            ACCOUNTS.                                          *
     F*                                                               *
     F*   E17939 - RETAIL ACCOUNT NUMBER REVERTS BACK TO THE CUSTOMER *
     F*            NUMBER IN THE ACCOUNT NUMBER FIELD. THIS DID NOT   *
     F*            HAPPEN ON S38. FILE CHANGE WAS REQUIRED TO DETER-  *
     F*            MINE WHETHER A RETAIL AC NO WAS ENTERED. FIELD WAS *
     F*            'RETAIL A/C NUMBER ENTERED'.                       *
     F*                                                               *
     F*   E17819 - SUBFILE IS BEING CLEARED DOWN EVERY TIME AN ERROR  *
     F*            OCCURED IN THE TRANSACTION CODE OR ACCOUNT NO FLD. *
     F*                                                               *
     F*   E17610 - ON RETURNING FROM THE SELECT NARRATIVE CODE PGM    *
     F*            AFTER PLACING A '?' INTO THE NARRATIVE CODE THE    *
     F*            FIELD WAS NOT BEING UPDATED WITH THE SELECTED      *
     F*            NARRATIVE CODE.                                    *
     F*                                                               *
     F*****************************************************************
     F**************************************************************
     F*
     F*     DATE   - 28.09.89
     F*
     F*     S01212 - WINDOW PROCESSING INSTALLED - /COPY
     F*
     F**************************************************************
     FGL0122M#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: Midas GL Edit abbreviated posting
      *
     FGLJENPL1IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RTV : Midas GL Journal Entry Posting Rtv
      *
     FSFACAUL0IF  E           K        DISK                           UC  CGL008
      ** RTV : Account Code/Authorities File By Account Code              CGL008
      *                                                                   CGL008
     FMUSER   IF  E           K        DISK                           UC  CGL008
      ** RTV : Midas SF Midas Users                                       CGL008
      *                                                                   CGL008
     FGLJENHL1IF  E           K        DISK
      * RTV : Midas GL Journal Entry Header LF Rtv
      *
     FGLJENPL0UF  E           K        DISK                      A
     F                                              KCOMIT
      * UPD : Midas GL Journal Entry Posting Update
      *
      *                                                                   S01408
     F/COPY WNCPYSRC,GL0122MFP1                                           S01408
      *                                                                   S01408
     E                    @IH         8  9               Item Err.slots
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
     E                    CPY@    1   1 80               Copyright     array
     I*
     I* DATA STRUCTURES TO ENABLE A BATCH NUMBER TO BE INCREMENTED        S01234
     I* EVEN THOUGH IT IS AN ALPHA FIELD                                  S01234
     I*                                                                   S01234
     I*   Define MIDAS Rundate from data-area RUNDAT
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*00/Copy Member GL0122M   Initialise Program I-Spec
     I/COPY WNCPYSRC,GL0122MIPG
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSGLJENPL0
      * UPD : Midas GL Journal Entry Posting Update
      * Current/previous master file format fields for change control
      *
     IBATCHG      DS                                                      S01234
     I                                        1   3 #1BTNB                S01234
     I                                        1   30BATNUM                S01234
      *                                                                   S01234
     I            DS                                                      S01234
     I                                        1   3 W@KEY1                S01234
     I                                        1   30BNUM2                 S01234
      *                                                                   S01234
     I            DS
      * Determine Account identity
     I                                        1  10 UKACID
     I                                        1   6 UKACF6
     I                                        1   3 UKACF3
     I                                        1   1 UKACF1
     I                                        1   1 UKACA1
     I                                        2   2 UKACA2
     I                                        3   3 UKACA3
     I                                        4   5 UKACM2
     I                                        6  10 UKACL5
     I                                        7  10 UKACL4
      * Set up parameters :
     IGLREOV      DS
      * Retail Override data area data structure
     I                                        1   1 URRE01
     I                                        2   2 URRE02
     I                                        3   3 URRE03
     I                                        4   4 URRE04
     I                                        5   5 URRE05
     I                                        6   6 URRE06
     I                                        7   7 URRE07
     I                                        8   8 URRE08
     I                                        9   9 URRE09
     I                                       10  10 URRE10
      *
     I            DS
      * Item error status data structure
     I                                        1  67 URERMG
     I                                        1  72 @IH
     I                                        1   1 URHL01
     I                                        9   9 URHL02
     I                                       17  17 URHL03
     I                                       25  25 URHL04
     I                                       33  33 URHL05
     I                                       41  41 URHL06
     I                                       49  49 URHL07
     I                                       57  57 URHL08
      *
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNO
     I                                       11  11 SUCP
     I                                       12  12 DTFF
     I                                       13  13 MBIN
     I*
     IUUFDY     E DSDSFDY
     I*
     I* 200 Byte Data Structure for Incoming Data from Access Program
     I*
     IUUSDY     E DSDSSDY
     I*
     I* 800 Byte Data Structure for Incoming Data from Access Program
     I*
     ID@ACOD    E DSSDACODPD
     I*
     I*  Account Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@ACCT    E DSACCNTAB
     I*
     I*  Account Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     IP@BJRF    E DSSDBANKPD
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     ID@CUST    E DSSDCUSTPD
     I*
     I*  Client Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@CURR    E DSSDCURRPD
     I*
     I*  Currency Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@NARR    E DSSDNARRPD
     I*
     I*  Narrative Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@NOST    E DSSDNOSTPD
     I              QQACCD                          ACCDQQ                                    CGL029
     I*
     I*  Nostro Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@GELR    E DSSDGELRPD
     I              QQACCD                          #ACCD@                                    CGL029
     I*
     I*  General Ledger Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@SARD    E DSSCSARDPD                                              CGL002
     I*                                                                   CGL002
     I*  Switchable Features DS                                           CGL002
     I              LCD                             LCDX                  CGL002
     I*                                                                   CGL002
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I : RST Batch number
     I                                        1   3 P1BTNB
     IP2PARM      DS
      * I :  Branch Code - Alpha
     I                                        1   3 P2BCDA
     IP3PARM      DS
      * I :  Branch Internal Customer
     I                                        1   6 P3BICN
     IP4PARM      DS
      * I :  Hash item no.calculated
     I                                    P   1   20P4HINC
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0001
      * Currency code
     I                                       11  13 ZA0002
      * Account code
     I**********                             14  17 ZA0003                                    CGL029
     I                                       14  23 ZA0003                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0004                                    CGL029
     I                                       24  25 ZA0004                                    CGL029
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0005
      * Currency code
     I                                       11  13 ZA0006
      * Account code
     I**********                             14  17 ZA0007                                    CGL029
     I                                       14  23 ZA0007                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0008                                    CGL029
     I                                       24  25 ZA0008                                    CGL029
      * Message data for 'Subfile Select Details'
      * Message data for 'Copy Special Char Add Mod'
      * JE Special Character
     I                                        1   1 ZA0009
      * Message data for 'Copy/Template - ENTER'
      * *SFLSEL
     I                                        1   1 ZA0010
      * Message data for 'Account ID not valid'
      * Account Identifier
     I                                        1  10 ZA0011
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0012
      * Currency code
     I                                       11  13 ZA0013
      * Account code
     I**********                             14  17 ZA0014                                    CGL029
     I                                       14  23 ZA0014                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0015                                    CGL029
     I                                       24  25 ZA0015                                    CGL029
      * Message data for 'Account is Closed'
      * Account Identifier
     I                                        1  10 ZA0016
      * Currency code
     I                                       11  13 ZA0017
      * Account code
     I**********                             14  17 ZA0018                                    CGL029
     I                                       14  23 ZA0018                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0019                                    CGL029
     I                                       24  25 ZA0019                                    CGL029
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0020
      * Message data for 'Account ID not valid ERR'
      * Account Identifier
     I                                        1  10 ZA0021
      * Message data for 'Account is Closed'
      * Account Identifier
     I                                        1  10 ZA0022
      * Currency code
     I                                       11  13 ZA0023
      * Account code
     I**********                             14  17 ZA0024                                    CGL029
     I                                       14  23 ZA0024                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0025                                    CGL029
     I                                       24  25 ZA0025                                    CGL029
      * Message data for 'Customer not found'
      * Account Identifier
     I                                        1  10 ZA0026
      * Message data for 'Currency Code Required'
      * Currency code
     I                                        1   3 ZA0027
      * Message data for 'Account Code Required'
      * Account code
     I**********                              1   4 ZA0028                                    CGL029
     I                                        1  10 ZA0028                                    CGL029
      * Message data for 'Account Seq Required'
      * Account sequence number
     I                                        1   2 ZA0029
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0030
      * Currency code
     I                                       11  13 ZA0031
      * Account code
     I**********                             14  17 ZA0032                                    CGL029
     I                                       14  23 ZA0032                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0033                                    CGL029
     I                                       24  25 ZA0033                                    CGL029
      * Message data for 'Account is Closed'
      * Account Identifier
     I                                        1  10 ZA0034
      * Currency code
     I                                       11  13 ZA0035
      * Account code
     I**********                             14  17 ZA0036                                    CGL029
     I                                       14  23 ZA0036                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0037                                    CGL029
     I                                       24  25 ZA0037                                    CGL029
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0038
      * Currency code
     I                                       11  13 ZA0039
      * Account code
     I**********                             14  17 ZA0040                                    CGL029
     I                                       14  23 ZA0040                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0041                                    CGL029
     I                                       24  25 ZA0041                                    CGL029
      * Message data for 'Account Not Valid - Brch'
      * Account Identifier
     I                                        1  10 ZA0042
      * Currency code
     I                                       11  13 ZA0043
      * Account code
     I**********                             14  17 ZA0044                                    CGL029
     I                                       14  23 ZA0044                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0045                                    CGL029
     I                                       24  25 ZA0045                                    CGL029
      * Branch Code - Alpha
     I**********                             20  22 ZA0046                                    CGL029
     I                                       26  28 ZA0046                                    CGL029
      * Message data for 'Amount not valid'
      * Formatted Posting amount
     I                                        1  14 ZA0047
      * Message data for 'Amount not valid'
      * Formatted Posting amount
     I                                        1  14 ZA0048
      * Message data for 'Posting amount is req'd'
      * Formatted Posting amount
     I                                        1  14 ZA0049
      * Message data for 'Debit Credit must be Y/N'
      * Debit/credit indicator
     I                                        1   1 ZA0050
      * Message data for 'No Narrative entered'
      * Narrative
     I                                        1  30 ZA0051
      * Message data for 'Narrative Code not found'
      * Narrative
     I                                        1  30 ZA0052
      * Message data for 'Can't O'ride Retail error'
      * Account Identifier
     I                                        1  10 ZA0053
      * Currency code
     I                                       11  13 ZA0054
      * Account code
     I**********                             14  17 ZA0055                                    CGL029
     I                                       14  23 ZA0055                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0056                                    CGL029
     I                                       24  25 ZA0056                                    CGL029
      * Message data for 'Retail Error Req's Overde'
      * Retail ind.: Override
     I                                        1   1 ZA0057
      * Message data for 'Retail Override Invalid'
      * Retail ind.: Override
     I                                        1   1 ZA0058
      * Message data for 'Assoc.Cust.No. not found'
      * Assoc. Customer number
     I                                        1   6 ZA0059
      * Message data for 'Copy/Template Invalid'
      * *SFLSEL
     I                                        1   1 ZA0060
      * Message data for 'Currency Code not found'
      * Currency code
     I                                        1   3 ZA0061
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0062
      * JE Special Character
     I                                       26  26 ZA0063
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0064
      * JE Special Character
     I                                       26  26 ZA0065
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0066
      * JE Special Character
     I                                       26  26 ZA0067
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0068
      * JE Special Character
     I                                       26  26 ZA0069
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0070
      * JE Special Character
     I                                       26  26 ZA0071
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0072
      * JE Special Character
     I                                       26  26 ZA0073
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0074
      * JE Special Character
     I                                       26  26 ZA0075
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0076
      * JE Special Character
     I                                       26  26 ZA0077
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0078
      * Currency code
     I                                       11  13 ZA0079
      * Account code
     I**********                             14  17 ZA0080                                    CGL029
     I                                       14  23 ZA0080                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0081                                    CGL029
     I                                       24  25 ZA0081                                    CGL029
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0082
      * Currency code
     I                                       11  13 ZA0083
      * Account code
     I**********                             14  17 ZA0084                                    CGL029
     I                                       14  23 ZA0084                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0085                                    CGL029
     I                                       24  25 ZA0085                                    CGL029
      * Message data for 'Lots of blanks'
      * Message data for 'Subfile Select Details'
      * Message data for 'Copy Special Char Add Mod'
      * JE Special Character
     I                                        1   1 ZA0086
     I/COPY WNCPYSRC,GL0122MI01
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1BTNB    PARM           WP0001  3        Batch number
     C           P2BCDA    PARM           WP0002  3        Branch Code - A
     C           P3BICN    PARM           WP0003  6        Branch Internal
     C           P4HINC    PARM           WP0004  30       Hash item no.ca
     C           PBTAM     PARM PBTAM     WPBTAM  1                                           191175
     C/COPY WNCPYSRC,GL0122MC35
      *****************************************************************
      * Initialise
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise and load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   05                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END
     C                     END
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & load subfile page
      *================================================================
     C/COPY WNCPYSRC,GL0122MC07
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * USER: Initialise subfile header
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0122MISH - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122MISH
     C*00/Copy Member GL0122M   Initialise Subfile Header
     C                     END                             *FI
      * If CHANGE mode, then position file:
     C           W0PMD     IFNE 'ADD'
     C           KPOS      KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Setup key
     C                     MOVEL#2BTNB    BTBTNB           Batch number
     C                     Z-ADD#2BINB    BTBINB           Batch item no.
      * 82=EOF
     C           KPOS      SETLL@BTREAL              82    *
      * 82=EOF
     C           KRST      KLIST
     C                     KFLD           BTBTNB           Batch number
      * Setup key
     C                     MOVEL#2BTNB    BTBTNB           Batch number
     C  N82      KRST      READE@BTREAL                9182*
     C                     ELSE
     C                     SETOF                     82    *
     C                     END
      * Load subfile page
     C                     EXSR BBLDSF
      * If no records (first time only), switch to add mode and load again
     C           W0APM     IFEQ 'Y'
     C           ##RR      ANDEQ*ZERO
     C                     MOVEL'ADD'     W0PMD
     C                     SETOF                     82    *
     C                     EXSR BBLDSF
     C                     END
     C                     MOVEL'N'       W0APM   1
      *................................................................
      * If no records found, display error message
     C   82      ##RR      IFEQ *ZERO                      IF
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page (write empty page if add mode)
      *================================================================
     C                     SETOF                     84    No SFLNXTCHG
      * Re-establish fields in read-ahead record
     C   27      W0PMD     IFNE 'ADD'
     C  N82                READP@BTREAL                  90*
     C  N82                READ @BTREAL                  90*
     C                     END
      *
      * Setof record error indicators
     C                     MOVE *ALL'0'   WKIND0  9
     C                     MOVE *ALL'1'   WKIND1  9
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
     C                     Z-ADD*ZERO     ##RROK  50
      *................................................................
      * Load next subfile page
     C  N82      ##RROK    DOWLT##SFPG                     DO
     C                     MOVEAWKIND0    *IN,31
     C/COPY WNCPYSRC,GL0122MC11
     C                     SETOF                     87    *
      * Clear subfile fields
     C                     EXSR MAIZ#1
      * If CHANGE mode, load subfile fields
     C           W0PMD     IFNE 'ADD'
     C                     EXSR MBFL#1
      * Calculate function fields
     C                     EXSR DG#2FN
      * Record will be selected unless overridden
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialise subfile record (existing record)
     C                     MOVELWUIEMA    #RIEMA           Item error msg.
      * CASE: DB1.Narrative code is Narrative code
     C           BTNVCD    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVELBTNVCD    #RNRTV           Narrative
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELBTNRDC    #RNRTV           Narrative
     C                     END                             *FI
      * E18437 Start
      * CASE: RCD.Retail Number Entered is Retail Account
     C           #1RNBE    IFEQ 'Y'                        *IF
     C                     MOVELBTRACN    #RACID           Account Identif
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELBTCUST    #RACID           Account Identif
     C                     END                             *FI
      * E18437 End
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVELBTCYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    #1CYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * Start of Fix E03063
      * Format amount (short) - Standard functions  *
     C                     Z-ADDBTPTAM    ULVALU           Value
      *
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALU 150       I:Value
     C                     PARM WUNBDP    ULDECP  10       I:Decimal place
     C***********          PARM 'L'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM '3'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLF 23        O:Formatted
      *
     C                     MOVE ULRSLF    #RFMPA           Formatted data
      *
      * End of Fix E03063
      * CASE: PAR.Branch Code - Alpha NE DB1.Branch Code (Batch
     C           P2BCDA    IFNE BTBCBH                     *IF
     C                     MOVELP2BCDA    WUBCBH           Branch Code (Ba
      * Change GL Batch posting - Journal Entry Posting  *
     C                     EXSR SACHRC
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0122MIRE - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122MIRE
     C*00/Copy Member GL0122M   Initialise Exist Record
     C                     END                             *FI
      * If record dropped...
     C           W0RSL     CABNE'Y'       BB020
      * Validate subfile record and calculate derived fields
     C                     EXSR DFV2RC
     C                     ELSE
      * USER: Initialise subfile record (new record)
     C                     MOVELWUIEMA    #RIEMA           Item error msg.
     C                     MOVELP2BCDA    #1IBCA           Input Branch Co
     C                     Z-ADDWURDNO    #1PTDT           Posting date
     C                     Z-ADDWURDNO    #1VLDT           Value date
     C                     MOVEL'N'       #1RINE           Retail ind.: Er
     C                     MOVEL*BLANK    #1PRCN           Profit centre
      * E17939 Start
     C                     MOVEL'N'       #1RNBE           Retail Number E
      * E17939 End
      * CASE: WRK.Template Facility Used is Yes
     C           WUTFUS    IFEQ 'Y'                        *IF
     C                     MOVELWUCACI    #RACID           Account Identif
     C                     MOVELWUCCCD    #1CYCD           Currency code
     C                     MOVELWUCACS    #1ACSN           Account sequenc
     C                     MOVELWUCPAC    #1ACCD           Account code
     C                     MOVELWUCBCA    #1IBCA           Input Branch Co
      * Start of Fix E03063
     C                     MOVELWUCAMT    #RFMPA           Formatted Posti
      * End of Fix E03063
     C                     MOVELWUCDCI    #1DCIN           Debit/credit in
     C                     MOVELWUCNAR    #RNRTV           Narrative
     C                     MOVELWUCACN    #1ACNB           Assoc. Customer
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'01'      #1ACSN           Account sequenc
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELP3BICN    #RACID           Account Identif
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C/COPY WNCPYSRC,GL0122MC39
     C                     MOVELBJLCCY    WULCCY
     C/COPY WNCPYSRC,GL0122MC40
     C                     MOVELWULCCY    #1CYCD           Currency code
     C                     MOVELP2BCDA    #1IBCA           Input Branch Co
     C/COPY WNCPYSRC,GL0122MC32
      * CASE: WRK.Template Facility Used is No
     C           WUTFUS    IFEQ 'N'                        *IF
      * CASE: WRK.Copy Facility Used is No
     C           WUCFUS    IFEQ 'N'                        *IF
      * RTV Last Btch Itm EDTFIL - Standard functions  *
     C*  SAVE INDICATORS
     C                     MOVEL*IN82     WUIN82  1
     C                     MOVEL*IN91     WUIN91  1
      * Setup key.
     C*****************    Z-ADD#IJDNB    W@BCHN  30       Batch number   S01234
     C*****************    Z-ADD#IJDNB    W@KEY1  30       Batch number   S01234
     C*                                                                   S01234
     C                     MOVE #1BTNB    W@BCHN  3        Batch number   S01234
     C                     MOVE #1BTNB    W@KEY1  3        Batch number   S01234
     C*                                                                   S01234
     C           BATNUM    ADD  1         BNUM2            Batch number   S01234
     C*
     C           W@KEY1    SETLL@BTREAL              82    *82=EOF
     C                     READP@BTREAL                9182*82=EOF
     C*
     C           *IN82     IFEQ '1'
     C           #1BTNB    ORNE W@BCHN
      *==
      * Move BLANKS OR ZEROES TO Copy Fields..
      *==
     C                     MOVEL*BLANK    WUCCUS  6        COPY:Cust No
     C                     Z-ADD0         WUCPAM 130       COPY:Amount
     C*********************MOVEL*BLANK    WUCRAN 10        COPY:Ret A/c
     C                     Z-ADD0         WUCRAN 100       COPY:Ret A/c
     C                     MOVEL*BLANK    WUCNRC  2        COPY:Narr Code
     C                     MOVEL*BLANK    WUCNDS 30        COPY:Narr Desc
     C                     Z-ADD0         WUCVDN  50       COPY:Value Date
     C                     MOVEL*BLANK    WUCCCD           COPY:CCY Code
     C                     MOVEL*BLANK    WUCPAC           COPY:A/c Code
     C                     MOVEL*BLANK    WUCACS  2        COPY:A/c Seq
     C                     MOVEL*BLANK    WUCDCI           COPY:Dr/Cr Ind
     C                     MOVEL*BLANK    WUCTRT  5        COPY:Trans Typ
     C                     MOVEL*BLANK    WUCCNB  8        COPY:Cheque No
     C                     MOVEL*BLANK    WUCACN  6        COPY:Assoc. Cust
     C                     MOVEL*BLANK    WUASSC 10        COPY:Assoc. Cust
     C                     MOVEL*BLANK    WUCSCR 16        COPY:Swift Ref
     C                     MOVEL*BLANK    WUCRNE  1        COPY:Ret A/c Ent
      *
     C                     ELSE
      *==
      * Move @BTREAL ( GL Batch Posting ) fields to Copy: Fields..
      *==
     C           #1BTNB    IFEQ W@BCHN                     Batch number
     C                     MOVELBTCUST    WUCCUS           COPY:Cust No
     C                     Z-ADDBTPTAM    WUCPAM           COPY:Post Amount
     C*********************Z-ADDBTRACN    WUCRAN           COPY:Ret A/c
     C                     MOVELBTRACN    WUCRAN           COPY:Ret A/c
     C                     MOVELBTNVCD    WUCNRC           COPY:Narr Code
     C                     MOVELBTNRDC    WUCNDS           COPY:Narr Desc
     C                     Z-ADDBTVLDT    WUCVDN           COPY:Val Date NBR
     C                     MOVELBTCYCD    WUCCCD           COPY:CCY Code
     C                     MOVELBTACCD    WUCPAC           COPY:A/c Code
     C                     MOVELBTACSN    WUCACS           COPY:A/c Seq
     C                     MOVELBTDCIN    WUCDCI           COPY:Dr/Cr Ind
     C                     MOVELBTTRTY    WUCTRT           COPY:Trans Typ
     C                     MOVELBTCQNB    WUCCNB           COPY:Cheque No
     C                     MOVELBTACNB    WUCACN           COPY:Assoc. Cust
     C                     MOVELBTACNB    WUASSC           COPY:Assoc. Cust
     C                     MOVELBTSWCR    WUCSCR           COPY:Swift Ref
     C                     MOVELBTRNBE    WUCRNE           COPY:Ret A/c Ent
     C                     END
     C                     END
     C* RESTORE INDICATORS
     C                     MOVELWUIN82    *IN82
     C                     MOVELWUIN91    *IN91
      * CASE: WRK.Copy:Retail Number Enter is Retail Account
     C           WUCRNE    IFEQ 'Y'                        *IF
     C                     MOVELWUCRAN    WUCACI           Copy:Account id
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUCACI           Copy:Account id
     C                     MOVELWUCCUS    WUCACI           Copy:Account id
     C                     END                             *FI
      * CASE: WRK.Copy:Narrative Code is Narrative code
     C           WUCNRC    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUCNAR           Copy:Narrative
     C                     MOVELWUCNRC    WUCNAR           Copy:Narrative
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCNDS    WUCNAR           Copy:Narrative
     C                     END                             *FI
      * CASE: RCD.Currency code is Not Question Mark
     C           #1CYCD    IFNE '?'                        *IF
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * Start of Fix E03063
      * Format amount (short) - Standard functions  *
     C                     Z-ADDWUCPAM    ULVALU           Value
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALU 150       I:Value
     C                     PARM WUDCPL    ULDECP  10       I:Decimal place
     C                     PARM 'J'       ULEDIT  1        I:IBM Edit code
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLF 23        O:Formatted
     C                     MOVE ULRSLF    WUCAMT           Formatted data
      * End of Fix E03063
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member SD0122MIRN - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122MIRN
     C*00/Copy Member GL0122M   Initialise New Record
     C                     END                             *FI
     C                     END
      * Output to subfile
     C                     ADD  1         ##RR       81    *
     C                     ADD  1         ##RROK
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C/COPY WNCPYSRC,GL0122MC21
     C                     WRITE#SFLRCD
     C           BB020     TAG
     C           W0PMD     IFNE 'ADD'
      * 82=EOF
     C           KRST      READE@BTREAL                  82*
     C                     END
     C  N82                END
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
     C           ##RRMX    ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN89     IFNE CAIN89
     C           *IN81     ORNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN89     CAIN89  1
     C                     MOVE *IN81     CAIN81  1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * CALC: Subfile control function fields
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0122MSFF - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122MSFF
     C*00/Copy Member GL0122M   Calculate Control Funct
     C                     END                             *FI
      * USER: Validate subfile control
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0122MVSC - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122MVSC
     C*00/Copy Member GL0122M   Validate Control
     C                     END                             *FI
      * Quit if reload requested
     C           W0RSF     CABEQ'Y'       DAEXIT
      *
     C   81                DO
      * No data entered as yet
     C                     MOVEL'N'       WKIPIN  1
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Process subfile records
     C                     EXSR DBPRSF
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * If data entered
     C           WKIPIN    IFEQ 'Y'
      * Update DBF from subfile
     C                     EXSR EAPRSF
      * If error during update, exit:
     C           *IN99     CABEQ'1'       DAEXIT
     C                     END                             WKIPIN
     C                     END
      * Switch between *ADD/*CHANGE modes
     C   09                EXSR FACHMD
      * USER: Process command keys
      * Start of Fix LN0312
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
      * Setup message data for message
      * Retrieve message Subfile Select Details
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0204' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUSFCC    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Set Screen Ftr Copy Char - Standard functions  *
     C* Move Copy Special Character Message into screen footer field
     C*                                                                   S01117
     C                     MOVELWUSFCC    ##CTX1
     C*
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVELWUJESP    ZA0009           JE Special Char
      * Retrieve message Copy Special Char Add Mod
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0222' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUSFCC    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Set Screen Ftr Copy Char - Standard functions  *
     C* Move Copy Special Character Message into screen footer field
     C*                                                                   S01117
     C                     MOVELWUSFCC    ##CTX1
     C*
     C                     END                             *FI
      * End of Fix LN0312
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0122MPCK - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122MPCK
     C*00/Copy Member GL0122M   Process Command Keys
     C                     END                             *FI
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
     C           WPBTAM    IFEQ ' '                                                           191175
     C                     MOVE 'N'       PBTAM   1                                           191175
     C                     MOVE 'N'       WPBTAM                                              191175
     C                     ENDIF                                                              191175
     C/COPY WNCPYSRC,GL0122MC22
     C                     READC#SFLRCD                  92*                                  191175
     C           *IN92     IFEQ '0'                                                           191175
     C                     MOVE 'Y'       PBTAM                                               191175
     C                     ENDIF                                                              191175
     C           WPBTAM    IFEQ 'Y'                                                           191175
     C                     MOVE 'Y'       PBTAM                                               191175
     C                     ENDIF                                                              191175
     C/COPY WNCPYSRC,GL0122MC36
     C           *IN92     DOWEQ'0'
     C                     EXSR DCPRSR
     C                     SETOF                     87    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C/COPY WNCPYSRC,GL0122MC23
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
     C/COPY WNCPYSRC,GL0122MC12
      * No errors
     C                     SETOF                     98
      * No SFLNXTCHG
     C                     SETOF                     84
     C           W0PMD     IFEQ 'ADD'
      * Check for null record
     C                     EXSR DDNLRC
     C           W0NLR     IFEQ 'Y'
     C                     GOTO DCEXIT
     C                     END
      * If not null record, continue
     C                     END
      * Data entered
     C                     MOVEL'Y'       WKIPIN
      * SFLNXTCHG
     C                     SETON                     84
      * If delete request, bypass validation
     C           #1SEL     IFEQ 'D'
     C                     GOTO DCEXIT
     C                     END
      * Validate subfile record
     C                     EXSR DEV1RC
      * If SFLRCD invalid, note the fact
     C   98N99             Z-ADD##RR      ##SFRC     99    *
     C/COPY WNCPYSRC,GL0122MC08
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DDNLRC    BEGSR
      *================================================================
      * Check for null record
      *================================================================
     C                     MOVEL'N'       W0NLR   1
     C           #RACID    CABNE*BLANK    DDEXIT           Account Identif
     C           #1CYCD    CABNE*BLANK    DDEXIT           Currency code
     C           #1ACCD    CABNE*BLANK    DDEXIT           Account code
     C           #1ACSN    CABNE*BLANK    DDEXIT           Account sequenc
     C           #RFMPA    CABNE*BLANK    DDEXIT           Formatted Posti
     C           #1DCIN    CABNE*BLANK    DDEXIT           Debit/credit in
     C           #RNRTV    CABNE*BLANK    DDEXIT           Narrative
     C           #1RINO    CABNE*BLANK    DDEXIT           Retail ind.: Ov
     C/COPY WNCPYSRC,GL0122MC31
     C                     MOVEL'Y'       W0NLR
      *================================================================
     CSR         DDEXIT    ENDSR
      /EJECT
     CSR         DEV1RC    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
      * Validate Debit/credit indicator
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1DCIN    W0NSRQ  1        Debit/credit in
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'MIVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1107881   Y2LSNO  70
     C           #1DCIN    PARM #1DCIN    W0EXVL 20        Debit/credit in
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      * USER: Validate subfile record fields
      * CASE: CTL.*CMD key is *Go to 'Add' mode
     C           *IN09     IFEQ '1'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.*SFLSEL is Copy/Template
     C           #1SEL     IFEQ 'C'                        *IF
     C           #1SEL     OREQ 'T'
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0010           *SFLSEL
      * Send message 'Copy/Template - ENTER'
     C                     MOVEL'GLX0213' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Validate subfile record relations
     C                     EXSR DFV2RC
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFV2RC    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      * Calculate function fields
     C                     EXSR DG#2FN
      * USER: Validate subfile record relations
      * Set up Branch Code
     C                     EXSR UASUBR                     Set up Branch C
      * Check Account Identifier
     C                     EXSR UBSUBR                     Check Account I
      * Account Identifier is Retail or Nostro
      * CASE: WRK.Account ID Status Flag is Retail or Nostro
     C           WUAISF    IFEQ '*NOSTRO'                  *IF
     C           WUAISF    OREQ '*RETAIL'
      * E17939 Start
      * Check for Retail Account NO
      * CASE: WRK.Account ID Status Flag is Retail
     C           WUAISF    IFEQ '*RETAIL'                  *IF
      *     E18852  - Branch Code Of trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVELWUIBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO 10                                           CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RACID    ZA0012           Account Identif
     C                     MOVEL#1CYCD    ZA0013           Currency code
     C                     MOVEL#1ACCD    ZA0014           Account code
     C                     MOVEL#1ACSN    ZA0015           Account sequenc
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWURACN    #RACID           Account Identif
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUACTY    #1ACTY           Account type
     C                     Z-ADDWURACN    #1RACN           Retail account
     C                     Z-ADDWURRNM    #1RRNM           Relative rec no
     C                     MOVEL'Y'       #1RNBE           Retail Number E
      * CASE: WRK.Account status is Closed
     C           WUACCS    IFEQ 'C'                        *IF
     C           WURECI    ANDEQ'C'                                                           237508
      * Setup message data for message
     C                     MOVEL#RACID    ZA0016           Account Identif
     C                     MOVEL#1CYCD    ZA0017           Currency code
     C                     MOVEL#1ACCD    ZA0018           Account code
     C                     MOVEL#1ACSN    ZA0019           Account sequenc
      * Send message 'Account is Closed'
     C                     MOVEL'GLX0126' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     END                             *FI
      * CASE: WRK.Account flagged for closure                                                 237508
     C           WUACCS    IFEQ 'C'                        *IF                                237508
     C           WURECI    ANDEQ'D'                                                           237508
      * Setup message data for message                                                        237508
     C                     MOVEL#RACID    ZA0016           Account Identif                    237508
     C                     MOVEL#1CYCD    ZA0017           Currency code                      237508
     C                     MOVEL#1ACCD    ZA0018           Account code                       237508
     C                     MOVEL#1ACSN    ZA0019           Account sequenc                    237508
      * Send message 'Account is Closed'                                                      237508
     C**********           MOVEL'GLX0427' ZAMSID                                     237508 AR782538
     C                     MOVEL'GLX0409' ZAMSID                                            AR782538
     C                     EXSR ZASNMS                                                        237508
      *                                                                                       237508
     C                     END                             *FI                                237508
     C                     END                             *FI
     C                     END                             *FI
      * Check for Nostro Account NO
      * CASE: WRK.Account ID Status Flag is Nostro
     C           WUAISF    IFEQ '*NOSTRO'                  *IF
      * Obtain nostro code - Standard functions  *
     C                     MOVEL#RACID    UXNOST  5        Nostro
     C                     MOVELUXNOST    #1CYCD           Nostro Ccy.
     C                     MOVE UXNOST    #1NNBI           Nostro No.
      * Access Nostro Details. - Nostro Details  *
     C*
     C* Set up Parameters for call to AONOSTR0
     C*
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACCD
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1NNBI    UUNONB
     C                     MOVELWUIBCA    UUBRCD
     C*
     C*  Access Nostro Details file for the file fields
     C*
     C                     CALL 'AONOSTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCUST  6        I:Customer No.
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACCD  4        I:Account Code                     CGL029
     C                     PARM           UUACCD 10                                           CGL029
     C                     PARM           UUACSN  2        I:Account Seque
     C                     PARM           UUNONB  2        I:Nostro Number
     C                     PARM           UUBRCD  3        I:Branch Code
     C                     PARM *BLANK    UUCSSN 10        I:Cust ShortN  S01230
     C                     PARM *BLANK    UUPNOI  1        I:Prime Nost InS01230
     C           D@NOST    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA7CYCD    WUCYCD           Currency Code
     C                     MOVELA7NONB    WUNONB           Nostro Number
     C                     MOVELA7ACCD    WUACCD           Account Code
     C                     MOVELA7CUST    WUCUST           Customer Number
     C                     MOVELA7ACSN    WUACSN           Account Sequenc
     C                     MOVELA7NOSN    WUNOSN           Nostro Shortnam
     C***********          MOVELA7OANN    WUOANN           Our A/c Nost                       210796
     C                     MOVELA7OACN    WUOANN           Our A/c Nost                       210796
     C                     MOVELA7ORAC    WUORAC           Our Rec A/c
     C                     MOVELA7PNOI    WUPNOI           Prime Nostro In
     C                     MOVELA7BRCD    WUIBCA           Branch Code
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RACID    ZA0020           Account Identif
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * E19627 - CCY ACOD CNUM & ASEQ Changed from RCD Fields To WRK Fields
      * E18852  - Branch Code Of trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVELWUCUST    UUCUST
     C                     MOVELWUCYCD    UUCYCD
     C                     MOVELWUACCD    UUACNO
     C                     MOVELWUACSN    UUACSN
     C                     MOVELWUIBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RACID    ZA0021           Account Identif
      * Send message 'Account ID not valid ERR'
     C                     MOVEL'GLX0119' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUNNBI    #1NNBI           Nostro number (
     C                     MOVEL'N'       #1RNBE           Retail Number E
      * CASE: WRK.Account status is Closed
     C           WUACCS    IFEQ 'C'                        *IF
     C           WURECI    ANDEQ'C'                                                           237508
      * Setup message data for message
     C                     MOVEL#RACID    ZA0022           Account Identif
     C                     MOVEL#1CYCD    ZA0023           Currency code
     C                     MOVEL#1ACCD    ZA0024           Account code
     C                     MOVEL#1ACSN    ZA0025           Account sequenc
      * Send message 'Account is Closed'
     C                     MOVEL'GLX0126' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     END                             *FI
      * CASE: WRK.Account flagged for closure                                                 237508
     C           WUACCS    IFEQ 'C'                        *IF                                237508
     C           WURECI    ANDEQ'D'                                                           237508
      * Setup message data for message                                                        237508
     C                     MOVEL#RACID    ZA0016           Account Identif                    237508
     C                     MOVEL#1CYCD    ZA0017           Currency code                      237508
     C                     MOVEL#1ACCD    ZA0018           Account code                       237508
     C                     MOVEL#1ACSN    ZA0019           Account sequenc                    237508
      * Send message 'Account is Closed'                                                      237508
     C**********           MOVEL'GLX0427' ZAMSID                                     237508 AR782538
     C                     MOVEL'GLX0409' ZAMSID                                            AR782538
     C                     EXSR ZASNMS                                                        237508
      *                                                                                       237508
     C                     END                             *FI                                237508
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * E17939 End
     C                     END                             *FI
      * Account Identifier is Customer number or Shortname
      * CASE: WRK.Account ID Status Flag is Customer No or short
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
      * E17819 Start
      * Validate Cust No Or Shortname
     C                     EXSR UCSUBR                     Validate Cust N
      * E17819 End
     C                     END                             *FI
      * Check if attempting to ADD a Retail Account
     C                     EXSR UDSUBR                     Check if attemp
      * Validate Branch Code
     C                     EXSR UESUBR                     Validate Branch
      * Obtain NOSTRO details
     C                     EXSR UFSUBR                     Obtain NOSTRO d
      * Start of Fix E03063
      * Check Posting amount
     C                     EXSR UGSUBR                     Check Posting a
      * End of Fix E03063
      * Check Debit/Credit Indicator
      * CASE: RCD.Debit/credit indicator is Valid Values
     C           #1DCIN    IFEQ 'C'                        *IF
     C           #1DCIN    OREQ 'D'
     C                     ELSE
      * CASE: RCD.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1DCIN    ZA0050           Debit/credit in
      * Send message 'Debit Credit must be Y/N'
     C                     MOVEL'GLX0205' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9837  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Check Narrative
     C                     EXSR UHSUBR                     Check Narrative
      * Check Retail/Non-Retail fields
     C                     EXSR UISUBR                     Check Retail/No
      * Check Associated Customer
      * CASE: RCD.Assoc. Customer number is Entered
     C/COPY WNCPYSRC,GL0122MC26
     C           #1ACNB    IFNE *BLANK                     *IF
     C/COPY WNCPYSRC,GL0122MC27
      * CASE: RCD.Account code is Not Select
     C           #1ACCD    IFNE '?'                        *IF
      * Access Account Codes. - Account Codes  *
     C*
     C*  Access Account codes file for the following fields
     C*  A/c Type, A/c Name, Account Section, Account Subtype
     C*
     C                     MOVEL#1ACCD    UUACCD                          LN0334
     C                     CALL 'AOACODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C**********           PARM           UUACCD  4        I:Account Code              LN0334 CGL029
     C********** D@ACOD    PARM *BLANK    UUFDY            O:Format                           CGL029
     C                     PARM           UUACCD                                              CGL029
     C           D@ACOD    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA5ACCD    WUACCD           A/c Code       LN0334
     C                     MOVELA5ACTY    WUACTY           A/C Type
     C                     MOVELA5ACCN    WUACCN           A/c Name
     C                     MOVELA5ACSC    WUACSC           A/c Section
     C                     MOVELA5ACST    WUACST           A/c Sub-Type
     C*
     C                     END                             *FI
      * CASE: RCD.Assoc. Customer number is Select Requested
     C/COPY WNCPYSRC,GL0122MC28
     C           #1ACNB    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Client Details. - Client Details  *
     C*
     C*  Access CLient Details file for the following fields
     C*  Customer No., Customer shortname, DRS Shortname,
     C*  Location, Customer SWIFT I.D.
     C*  Account Officer code                                             S10736
     C*
     C                     CALL 'AOCUSTR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM #1ACNB    UUCNCD 10        I:Client Key
     C                     PARM           UUCRST  7        O:Key status
     C           D@CUST    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUCRST    WUCRST           Key Status  ber
     C*
     C                     MOVELBBCUST    WUACNB           Customer Number
     C                     MOVELBBCSSN    WUCSSN           Shortname
     C                     MOVELBBDRCS    WUDRCS           DRS Shortname
     C                     MOVELBBLCCD    WULCCD           Location
     C                     MOVELBBCSID    WUCSID           SWIFT ID
     C                     MOVELBBACOC    WUACOC           SWIFT ID
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1ACNB    ZA0059           Assoc. Customer
      * Send message 'Assoc.Cust.No. not found'
     C                     MOVEL'GLX0058' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
     C/COPY WNCPYSRC,GL0122MC29
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUACNB    #1ACNB           Assoc. Customer
     C                     END                             *FI
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0122MC13
      * Setup Branch code (Header) & Posting Date on RCD
     C                     EXSR UKSUBR                     Setup Branch co
      * Store data for *Copy function
     C                     EXSR ULSUBR                     Store data for
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0122MVRR - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122MVRR
     C*00/Copy Member GL0122M   Validate Record Relations
     C                     END                             *FI
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         DG#2FN    BEGSR
      *================================================================
      * Calculate subfile record function fields
      *================================================================
      * CALC: Subfile record function fields
      * Add Mode Processing
      * CASE: PGM.*Program mode is *ADD
     C           W0PMD     IFEQ 'ADD'                      *IF
      * CASE: WRK.*SFLSEL is Copy/Template
     C           WUSEL     IFEQ 'C'                        *IF
     C           WUSEL     OREQ 'T'
      * Setup message data for message
     C                     MOVEL#1SEL     ZA0060           *SFLSEL
      * Send message 'Copy/Template Invalid'
     C                     MOVEL'GLX0196' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     END                             *FI
      * Check for Copy CHAR in REC Fields
     C                     EXSR UNSUBR                     Check for Copy
     C                     END                             *FI
      * Check Account Identifier
      * CASE: RCD.Account Identifier is Entered
     C           #RACID    IFNE *BLANK                     *IF
      * Select Account Identifier
      * CASE: RCD.Account Identifier is Select Requested
     C           #RACID    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
     C                     MOVEL'Y'       WUVCNB           Valid Customer
      * Access Client Details. - Client Details  *
     C*
     C*  Access CLient Details file for the following fields
     C*  Customer No., Customer shortname, DRS Shortname,
     C*  Location, Customer SWIFT I.D.
     C*  Account Officer code                                             S10736
     C*
     C                     CALL 'AOCUSTR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM #RACID    UUCNCD 10        I:Client Key
     C                     PARM           UUCRST  7        O:Key status
     C           D@CUST    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUCRST    WUCRST           Key Status  ber
     C*
     C                     MOVELBBCUST    WUCUST           Customer Number
     C                     MOVELBBCSSN    WUCSSN           Shortname
     C                     MOVELBBDRCS    WUDRCS           DRS Shortname
     C                     MOVELBBLCCD    WULCCD           Location
     C                     MOVELBBCSID    WUCSID           SWIFT ID
     C                     MOVELBBACOC    WUACOC           SWIFT ID
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL'N'       WUVCNB           Valid Customer
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     END                             *FI
     C                     END                             *FI
      * Check Currency
      * CASE: RCD.Currency code is Not blank
     C           #1CYCD    IFNE *BLANK                     *IF
      * Select Currency
      * CASE: RCD.Currency code is Select Requested
     C           #1CYCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0061           Currency code
      * Send message 'Currency Code not found'
     C                     MOVEL'GLX0048' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     END                             *FI
     C                     END                             *FI
      * Select Account Code
      * CASE: RCD.Account code is Select Requested
     C           #1ACCD    IFEQ '?'                        *IF
      * Select Account Number - Standard functions  *
     C                     CALL 'SD0031S'              90  Select Account
     C           W0RTN     PARM W0RTN     WQ0008  7        *Return code
     C********** #1ACCD    PARM #1ACCD    WQ0009  4        Account code                       CGL029
     C           #1ACCD    PARM #1ACCD    WQ0009 10                                           CGL029
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9834  *
     C                     END
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Change Mode Processing
     C                     EXSR UOSUBR                     Change Mode Pro
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0122MRFF - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122MRFF
     C*00/Copy Member GL0122M   Calculate Record Funct
     C                     END                             *FI
      *================================================================
     CSR         DGEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
      * Initialise subfile reload flag
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'Y'       W0RSF
     C                     ELSE
     C                     MOVEL'N'       W0RSF
     C                     END
      * Process all modified subfile records
     C/COPY WNCPYSRC,GL0122MC24
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
     C           W0RTN     IFNE *BLANK
      * ROLLBACK required
      * Send message '*ROLLBACK required'
     C                     MOVEL'Y2U0018' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     MOVEL'Y2U0018' P0RTN
     C                     EXSR ZYEXPG
     C                     END
     C                     MOVEL*BLANK    #1SEL
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C/COPY WNCPYSRC,GL0122MC25
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
     C/COPY WNCPYSRC,GL0122MC14
     C                     SETOF                     98
      *
     C           W0PMD     IFEQ 'ADD'
      * Process add request
     C           #1SEL     IFNE 'D'
     C                     EXSR DDNLRC
     C           W0NLR     IFNE 'Y'
     C                     EXSR ECADRQ
     C                     END
     C                     END
     C                     ELSE
     C           #1SEL     IFEQ 'D'
      * Process delete request
     C                     EXSR EDDLRQ
     C                     ELSE
      * Process change request
     C                     EXSR EECHRQ
     C                     END
     C                     END
      * If error occurred on update, note the fact
     C           *IN98     IFEQ '1'
     C           *IN99     IFEQ '0'
     C                     Z-ADD##RR      ##SFRC     99    *
     C                     END
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         ECADRQ    BEGSR
      *================================================================
      * Process add request
      *================================================================
      * USER: Create DBF record
      * Create GL Batch posting - Journal Entry Posting  *
     C                     EXSR SCCRRC
     C           W0RTN     IFNE *BLANK
      * Write error detected
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
     C/COPY WNCPYSRC,GL0122MC15
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
     C                     ELSE
      * DBF write successful
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EDDLRQ    BEGSR
      *================================================================
      * Process delete request
      *================================================================
      * USER: Delete DBF record
      * Delete GL Batch posting - Journal Entry Posting  *
     C                     EXSR SDDLRC
     C           W0RTN     IFNE *BLANK
      * Delete unsuccessful
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
     C/COPY WNCPYSRC,GL0122MC16
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * If record altered, reset subfile record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF delete successful
      * Blank out record and protect from entry
     C                     EXSR MAIZ#1
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
      * Reload subfile
     C                     MOVEL'Y'       W0RSF   1
     C                     END
      *================================================================
     CSR         EDEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Change GL Batch posting - Journal Entry Posting  *
     C                     EXSR SECHRC
     C           W0RTN     IFNE *BLANK
      * DBF update error
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
     C/COPY WNCPYSRC,GL0122MC17
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * Reset subfile record if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF update successful
      * Enable entry
     C                     SETOF                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FACHMD    BEGSR
      *================================================================
      * Switch between *ADD/*CHANGE modes
      *================================================================
     C           W0PMD     IFNE 'ADD'
     C                     MOVEL'ADD'     W0PMD
     C                     ELSE
     C                     MOVEL'CHG'     W0PMD
     C                     END
     C                     EXSR FBRQRL
      *================================================================
     CSR         FAEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect keys if change mode or updated record
     C                     SETON                     88    *
     C   89N87             SETOF                     88    *
     C                     MOVEL*IN87     *IN79
     C           W0PMD     IFEQ 'ADD'                      *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
     C                     MOVEL*IN87     *IN78
     C           #1RINE    IFEQ *BLANK                     *IF
     C           #1RINE    OREQ 'N'
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
     C                     MOVEL'0'       *IN77
     C           #RIEST    IFEQ 'E'                        *IF
     C                     MOVEL'1'       *IN77
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise subfile record
      *================================================================
      * Previous values
     C                     MOVEL*BLANK    #1DBRC
     C                     MOVEL*BLANK    #RIEST           Item error stat
     C                     MOVELP1BTNB    #1BTNB           Batch number
     C                     Z-ADD*ZERO     #1BINB           Batch item no.
     C                     MOVEL*BLANK    #1IBCA           Input Branch Co
     C                     MOVEL*BLANK    #1CUST           Customer number
     C                     MOVEL*BLANK    #1NNBI           Nostro number (
     C                     Z-ADD*ZERO     #1RACN           Retail account
     C                     Z-ADD*ZERO     #1PTAM           Posting amount
     C                     MOVEL*BLANK    #1RINE           Retail ind.: Er
     C                     Z-ADD*ZERO     #1PTDT           Posting date
     C                     MOVEL*BLANK    #1NVCD           Narrative code
     C                     MOVEL*BLANK    #1NRDC           Narrative descr
     C                     MOVEL*BLANK    #1ACTY           Account type
     C                     MOVEL*BLANK    #1TRTY           Transaction typ
     C                     MOVEL*BLANK    #1CQNB           Cheque number
     C                     Z-ADD*ZERO     #1VLDT           Value date
     C                     MOVEL*BLANK    #1ACNB           Assoc. Customer
     C                     MOVEL*BLANK    #RVDDS           Value date (dis
     C                     MOVEL*BLANK    #1COIN           Customer origin
     C                     MOVEL*BLANK    #1PRCN           Profit centre
     C                     MOVEL*BLANK    #1SWCR           Swift common re
     C                     MOVEL*BLANK    #RIEMG           Item error mess
     C                     MOVEL*BLANK    #1BCBH           Branch Code (Ba
     C                     MOVEL*BLANK    #1RADP           Retail advice p
     C                     MOVEL*BLANK    #1SHPI           Shadow post ind
     C                     Z-ADD*ZERO     #1RRNM           Relative rec no
     C                     MOVEL*BLANK    #1RNBE           Retail Number E
     C                     MOVEL*BLANK    #1RARC           Retail Ac Refer
     C                     MOVEL*BLANK    #1TSTY           Transaction (Su
     C                     MOVEL*BLANK    #1BKCD           Book Code
     C                     Z-ADD*ZERO     #1SPFC           Spread Factor
     C                     MOVEL*BLANK    #1RVDI           Reverse/Void In
     C                     Z-ADD*ZERO     #1NITM           Number of Items
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVEL*BLANK    #1CYCD           Currency code
     C                     MOVEL*BLANK    #1ACCD           Account code
     C                     MOVEL*BLANK    #1ACSN           Account sequenc
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     MOVEL*BLANK    #1DCIN           Debit/credit in
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
     C                     MOVEL*BLANK    #RIEMA           Item error msg.
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @BTREAL fields to subfile
      *================================================================
     C                     MOVELBTBTNB    #1BTNB           Batch number
     C                     Z-ADDBTBINB    #1BINB           Batch item no.
     C                     MOVELBTIBCA    #1IBCA           Input Branch Co
     C                     MOVELBTCUST    #1CUST           Customer number
     C                     MOVELBTNNBI    #1NNBI           Nostro number (
     C                     Z-ADDBTRACN    #1RACN           Retail account
     C                     Z-ADDBTPTAM    #1PTAM           Posting amount
     C                     MOVELBTRINE    #1RINE           Retail ind.: Er
     C                     Z-ADDBTPTDT    #1PTDT           Posting date
     C                     MOVELBTNVCD    #1NVCD           Narrative code
     C                     MOVELBTNRDC    #1NRDC           Narrative descr
     C                     MOVELBTACTY    #1ACTY           Account type
     C                     MOVELBTTRTY    #1TRTY           Transaction typ
     C                     MOVELBTCQNB    #1CQNB           Cheque number
     C                     Z-ADDBTVLDT    #1VLDT           Value date
     C                     MOVELBTACNB    #1ACNB           Assoc. Customer
     C                     MOVELBTCOIN    #1COIN           Customer origin
     C                     MOVELBTPRCN    #1PRCN           Profit centre
     C                     MOVELBTSWCR    #1SWCR           Swift common re
     C                     MOVELBTBCBH    #1BCBH           Branch Code (Ba
     C                     MOVELBTRADP    #1RADP           Retail advice p
     C                     MOVELBTSHPI    #1SHPI           Shadow post ind
     C                     Z-ADDBTRRNM    #1RRNM           Relative rec no
     C                     MOVELBTRNBE    #1RNBE           Retail Number E
     C                     MOVELBTRARC    #1RARC           Retail Ac Refer
     C                     MOVELBTTSTY    #1TSTY           Transaction (Su
     C                     MOVELBTBKCD    #1BKCD           Book Code
     C                     Z-ADDBTSPFC    #1SPFC           Spread Factor
     C                     MOVELBTRVDI    #1RVDI           Reverse/Void In
     C                     Z-ADDBTNITM    #1NITM           Number of Items
     C                     MOVELBTCYCD    #1CYCD           Currency code
     C                     MOVELBTACCD    #1ACCD           Account code
     C                     MOVELBTACSN    #1ACSN           Account sequenc
     C                     MOVELBTDCIN    #1DCIN           Debit/credit in
     C                     MOVELBTRINO    #1RINO           Retail ind.: Ov
      * Hold current record image for change detection
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVELP1BTNB    #2BTNB           Batch number
     C                     Z-ADD*ZERO     #2BINB           Batch item no.
      * Check restriction within
     C                     EXSR VACKRL
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         SACHRC    BEGSR
      *================================================================
      * Change GL Batch posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before DBF read
      * CASE: WRK.Abbreviated Posting? is Yes
     C           WUABPS    IFEQ 'Y'                        *IF
      * E18852 - Branch Code of Trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL*BLANK    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * End of Fix LN0315
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0001           Account Identif
     C                     MOVEL#1CYCD    ZA0002           Currency code
     C                     MOVEL#1ACCD    ZA0003           Account code
     C                     MOVEL#1ACSN    ZA0004           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983334*
     C                     SETON                     35    *
      *
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
      * Was posting Retail? - Journal Entry Posting  *
     C                     EXSR SBRVGN
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0005           Account Identif
     C                     MOVEL#1CYCD    ZA0006           Currency code
     C                     MOVEL#1ACCD    ZA0007           Account code
     C                     MOVEL#1ACSN    ZA0008           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983334*
     C                     SETON                     35    *
      *
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Move key fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
      *
     C           KLCHSA    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
     C           KLCHSA    CHAIN@BTREAK              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SAEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SAEXIT
     C                     END
      *
      * Move non-key fields to @BTREAK
     C                     MOVEL#1IBCA    BTIBCA           Input Branch Co
     C                     MOVEL#1CUST    BTCUST           Customer number
     C                     MOVEL#1CYCD    BTCYCD           Currency code
     C                     MOVEL#1ACCD    BTACCD           Account code
     C                     MOVEL#1ACSN    BTACSN           Account sequenc
     C                     MOVEL#1NNBI    BTNNBI           Nostro number (
     C                     Z-ADD#1RACN    BTRACN           Retail account
     C                     MOVEL#1RINO    BTRINO           Retail ind.: Ov
     C                     MOVEL#1RINE    BTRINE           Retail ind.: Er
     C                     MOVEL#1TRTY    BTTRTY           Transaction typ
     C                     Z-ADD#1PTAM    BTPTAM           Posting amount
     C                     MOVEL#1DCIN    BTDCIN           Debit/credit in
     C                     Z-ADD#1PTDT    BTPTDT           Posting date
     C                     Z-ADD#1VLDT    BTVLDT           Value date
     C                     MOVEL#1NVCD    BTNVCD           Narrative code
     C                     MOVEL#1NRDC    BTNRDC           Narrative descr
     C                     MOVEL#1ACTY    BTACTY           Account type
     C                     MOVEL#1ACNB    BTACNB           Assoc. Customer
     C                     MOVEL#1CQNB    BTCQNB           Cheque number
     C                     MOVEL#1COIN    BTCOIN           Customer origin
     C                     MOVEL#1SWCR    BTSWCR           Swift common re
     C                     MOVEL#1PRCN    BTPRCN           Profit centre
     C                     MOVELWUBCBH    BTBCBH           Branch Code (Ba
     C                     MOVEL#1RADP    BTRADP           Retail advice p
     C                     MOVEL#1SHPI    BTSHPI           Shadow post ind
     C                     Z-ADD#1RRNM    BTRRNM           Relative rec no
     C                     MOVEL#1RNBE    BTRNBE           Retail Number E
     C                     MOVEL#1RARC    BTRARC           Retail Ac Refer
     C                     MOVEL#1TSTY    BTTSTY           Transaction (Su
     C                     MOVEL#1BKCD    BTBKCD           Book Code
     C                     Z-ADD#1SPFC    BTSPFC           Spread Factor
     C                     MOVEL#1RVDI    BTRVDI           Reverse/Void In
     C                     Z-ADD#1NITM    BTNITM           Number of Items
     C                     Z-ADDBTOAMT    BTOAMT                                              237620
     C                     MOVE *BLANKS   W#15A  15                                           237620
     C                     Z-ADD*ZEROS    W#15N  150                                          237620
     C                     MOVE BTOAMT    W#15A                                               237620
     C                     MOVE W#15A     W#15N                                               237620
     C                     Z-ADDW#15N     BTOAMT                                              237620
      *                                                                                     AR855165
      ** Populate Valid Indicator                                                           AR855165
      *                                                                                     AR855165
     C           BTRINE    IFEQ 'Y'                                                         AR855165
     C           BTRINO    ANDEQ'N'                                                         AR855165
     C                     MOVEL'N'       BTVALI                                            AR855165
     C                     ELSE                                                             AR855165
     C                     MOVEL'Y'       BTVALI                                            AR855165
     C                     ENDIF                                                            AR855165
      *
      * USER: Processing before DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MBDU - Journal Entry Posting  *
     C*
     C***** WNCPYSRC,GL0181MBDU                                           S01408
     C/COPY WNCPYSRC,GL0122MCP5                                           S01408
     C*
     C                     END                             *FI
     C                     UPDAT@BTREAK                91  *
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C/COPY WNCPYSRC,GL0122MC37
      * DBF change successful
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MADU - Journal Entry Posting  *
     C*
     C***** WNCPYSRC,GL0181MADU                                           S01408
     C/COPY WNCPYSRC,GL0122MCP6                                           S01408
     C*
     C                     END                             *FI
     C                     END
     C/COPY WNCPYSRC,GL0122MC01
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Was posting Retail? - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Move fields to key list
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
     C           KRSSB     CHAIN@BTREAL              90    *
      * DBF record not found
     C   90                MOVEL'GLX0176' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process DBF record
      * PAR = DB1 By name
     C                     MOVELBTACTY    WUACTY           Account type
     C                     END
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCRRC    BEGSR
      *================================================================
      * Create GL Batch posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
     C                     MOVEL#1IBCA    BTIBCA           Input Branch Co
     C                     MOVEL#1CUST    BTCUST           Customer number
     C                     MOVEL#1CYCD    BTCYCD           Currency code
     C                     MOVEL#1ACCD    BTACCD           Account code
     C                     MOVEL#1ACSN    BTACSN           Account sequenc
     C                     MOVEL#1NNBI    BTNNBI           Nostro number (
     C                     Z-ADD#1RACN    BTRACN           Retail account
     C                     MOVEL#1RINO    BTRINO           Retail ind.: Ov
     C                     MOVEL#1RINE    BTRINE           Retail ind.: Er
     C                     MOVEL#1TRTY    BTTRTY           Transaction typ
     C                     Z-ADD#1PTAM    BTPTAM           Posting amount
     C                     MOVEL#1DCIN    BTDCIN           Debit/credit in
     C                     Z-ADD#1PTDT    BTPTDT           Posting date
     C                     Z-ADD#1VLDT    BTVLDT           Value date
     C                     MOVEL#1NVCD    BTNVCD           Narrative code
     C                     MOVEL#1NRDC    BTNRDC           Narrative descr
     C                     MOVEL#1ACTY    BTACTY           Account type
     C                     MOVEL#1ACNB    BTACNB           Assoc. Customer
     C                     MOVEL#1CQNB    BTCQNB           Cheque number
     C                     MOVEL#1COIN    BTCOIN           Customer origin
     C                     MOVEL#1SWCR    BTSWCR           Swift common re
     C                     MOVEL#1PRCN    BTPRCN           Profit centre
     C                     MOVEL#1BCBH    BTBCBH           Branch Code (Ba
     C                     MOVEL#1RADP    BTRADP           Retail advice p
     C                     MOVEL#1SHPI    BTSHPI           Shadow post ind
     C                     Z-ADD#1RRNM    BTRRNM           Relative rec no
     C                     MOVEL#1RNBE    BTRNBE           Retail Number E
     C                     MOVEL#1RARC    BTRARC           Retail Ac Refer
     C                     MOVEL#1TSTY    BTTSTY           Transaction (Su
     C                     MOVEL#1BKCD    BTBKCD           Book Code
     C                     Z-ADD#1SPFC    BTSPFC           Spread Factor
     C                     MOVEL#1RVDI    BTRVDI           Reverse/Void In
     C                     Z-ADD#1NITM    BTNITM           Number of Items
      *                                                                                     AR855165
      ** Populate Valid Indicator                                                           AR855165
      *                                                                                     AR855165
     C           BTRINE    IFEQ 'Y'                                                         AR855165
     C           BTRINO    ANDEQ'N'                                                         AR855165
     C                     MOVEL'N'       BTVALI                                            AR855165
     C                     ELSE                                                             AR855165
     C                     MOVEL'Y'       BTVALI                                            AR855165
     C                     ENDIF                                                            AR855165
      *
      * USER: Processing before DBF update
      * RTV Last Batch Item - Standard functions  *
     C                     CALL 'GL0137U'              90  RTV Last Batch
     C                     PARM BTBTNB    WQ0010  3        Batch number
     C           WULINB    PARM *ZERO     WQ0011  30       Last item numbe
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ADD  1         WULINB           Last item numbe
     C                     Z-ADDWULINB    BTBINB           Batch item no.
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MCBU - Journal Entry Posting  *
     C*
     C***** WNCPYSRC,GL0181MCBU                                           S01408
     C/COPY WNCPYSRC,GL0122MCP7                                           S01408
     C*
     C                     END                             *FI
     C           KLCRSC    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Check for duplicate primary key
     C           KLCRSC    SETLL@BTREAK                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'GLX0175' W0RTN   7
      * USER: Processing if DBF record already exists
     C                     SUB  1         WULINB           Last item numbe
     C                     GOTO SCEXIT
     C                     END
      *
     C                     MOVEASTAMP,1   BTTMST           Default Timestamp                  CPK015
     C                     Z-ADD0         BTOAMT                                              237620
     C                     WRITE@BTREAK                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
      * USER: Processing if DBF update error
     C                     SUB  1         WULINB           Last item numbe
     C                     ELSE
      * DBF write successful
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MCAU - Journal Entry Posting  *
     C*
     C***** WNCPYSRC,GL0181MCAU                                           S01408
     C/COPY WNCPYSRC,GL0122MCP8                                           S01408
     C*
     C                     END                             *FI
     C                     END
     C/COPY WNCPYSRC,GL0122MC02
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDDLRC    BEGSR
      *================================================================
      * Delete GL Batch posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MDBU - Journal Entry Posting  *
     C*
     C***** WNCPYSRC,GL0181MDBU                                           S01408
     C/COPY WNCPYSRC,GL0122MCP9                                           S01408
     C*
     C                     END                             *FI
      * Move key fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
      *
     C           KLDLSD    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
     C           KLDLSD    CHAIN@BTREAK              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SDEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Use SETLL to release record lock
     C           KLDLSD    SETLL@BTREAK              9091  *
     C                     GOTO SDEXIT
     C                     END                             FI #1DBRC
      *................................................................
     C                     DELET@BTREAK                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF delete successful
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MDAU - Journal Entry Posting  *
     C*
     C***** WNCPYSRC,GL0181MDAU                                           S01408
     C/COPY WNCPYSRC,GL0122MP10                                           S01408
     C*
     C                     END                             *FI
     C                     END
     C/COPY WNCPYSRC,GL0122MC03
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECHRC    BEGSR
      *================================================================
      * Change GL Batch posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before DBF read
      * CASE: WRK.Abbreviated Posting? is Yes
     C           WUABPS    IFEQ 'Y'                        *IF
      * E18852 - Branch Code of Trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL*BLANK    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * End of Fix LN0315
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0078           Account Identif
     C                     MOVEL#1CYCD    ZA0079           Currency code
     C                     MOVEL#1ACCD    ZA0080           Account code
     C                     MOVEL#1ACSN    ZA0081           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983334*
     C                     SETON                     35    *
      *
     C                     GOTO SEEXIT                     *QUIT
     C                     END                             *FI
      * Was posting Retail? - Journal Entry Posting  *
     C                     EXSR SFRVGN
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0082           Account Identif
     C                     MOVEL#1CYCD    ZA0083           Currency code
     C                     MOVEL#1ACCD    ZA0084           Account code
     C                     MOVEL#1ACSN    ZA0085           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983334*
     C                     SETON                     35    *
      *
     C                     GOTO SEEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Move key fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
      *
     C           KLCHSE    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
     C           KLCHSE    CHAIN@BTREAK              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SEEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Use SETLL to release record lock
     C           KLCHSE    SETLL@BTREAK              9091  *
     C                     GOTO SEEXIT
     C                     END                             FI #1DBRC
      * Move non-key fields to @BTREAK
     C                     MOVEL#1IBCA    BTIBCA           Input Branch Co
     C                     MOVEL#1CUST    BTCUST           Customer number
     C                     MOVEL#1CYCD    BTCYCD           Currency code
     C                     MOVEL#1ACCD    BTACCD           Account code
     C                     MOVEL#1ACSN    BTACSN           Account sequenc
     C                     MOVEL#1NNBI    BTNNBI           Nostro number (
     C                     Z-ADD#1RACN    BTRACN           Retail account
     C                     MOVEL#1RINO    BTRINO           Retail ind.: Ov
     C                     MOVEL#1RINE    BTRINE           Retail ind.: Er
     C                     MOVEL#1TRTY    BTTRTY           Transaction typ
     C                     Z-ADD#1PTAM    BTPTAM           Posting amount
     C                     MOVEL#1DCIN    BTDCIN           Debit/credit in
     C                     Z-ADD#1PTDT    BTPTDT           Posting date
     C                     Z-ADD#1VLDT    BTVLDT           Value date
     C                     MOVEL#1NVCD    BTNVCD           Narrative code
     C                     MOVEL#1NRDC    BTNRDC           Narrative descr
     C                     MOVEL#1ACTY    BTACTY           Account type
     C                     MOVEL#1ACNB    BTACNB           Assoc. Customer
     C                     MOVEL#1CQNB    BTCQNB           Cheque number
     C                     MOVEL#1COIN    BTCOIN           Customer origin
     C                     MOVEL#1SWCR    BTSWCR           Swift common re
     C                     MOVEL#1PRCN    BTPRCN           Profit centre
     C                     MOVEL#1BCBH    BTBCBH           Branch Code (Ba
     C                     MOVEL#1RADP    BTRADP           Retail advice p
     C                     MOVEL#1SHPI    BTSHPI           Shadow post ind
     C                     Z-ADD#1RRNM    BTRRNM           Relative rec no
     C                     MOVEL#1RNBE    BTRNBE           Retail Number E
     C                     MOVEL#1RARC    BTRARC           Retail Ac Refer
     C                     MOVEL#1TSTY    BTTSTY           Transaction (Su
     C                     MOVEL#1BKCD    BTBKCD           Book Code
     C                     Z-ADD#1SPFC    BTSPFC           Spread Factor
     C                     MOVEL#1RVDI    BTRVDI           Reverse/Void In
     C                     Z-ADD#1NITM    BTNITM           Number of Items
     C                     Z-ADDBTOAMT    BTOAMT                                              237620
     C                     MOVE *BLANKS   W#15A  15                                           237620
     C                     Z-ADD*ZEROS    W#15N  150                                          237620
     C                     MOVE BTOAMT    W#15A                                               237620
     C                     MOVE W#15A     W#15N                                               237620
     C                     Z-ADDW#15N     BTOAMT                                              237620
      *
      * USER: Processing before DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MBDU - Journal Entry Posting  *
     C*
     C***** WNCPYSRC,GL0181MBDU                                           S01408
     C/COPY WNCPYSRC,GL0122MP11                                           S01408
     C*
     C                     END                             *FI
     C                     UPDAT@BTREAK                91  *
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C/COPY WNCPYSRC,GL0122MC38
      * DBF change successful
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MADU - Journal Entry Posting  *
     C*
     C***** WNCPYSRC,GL0181MADU                                           S01408
     C/COPY WNCPYSRC,GL0122MP12                                           S01408
     C*
     C                     END                             *FI
     C                     END
     C/COPY WNCPYSRC,GL0122MC04
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Was posting Retail? - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Move fields to key list
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
     C           KRSSF     CHAIN@BTREAL              90    *
      * DBF record not found
     C   90                MOVEL'GLX0176' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process DBF record
      * PAR = DB1 By name
     C                     MOVELBTACTY    WUACTY           Account type
     C                     END
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT                                                              CGL002
     CSR         SRGLOV    BEGSR                                          CGL002
      *================================================================   CGL002
      **  Check Overrideable GL Errors                                    CGL002
      *================================================================   CGL002
      *                                                                   CGL002
      **  Initialise work fields                                          CGL002
      *                                                                   CGL002
     C                     MOVELWURETB    URRETI                          CGL002
     C                     MOVEL#1DCIN    URIND                           CGL002
      *                                                                   CGL002
      **  Check GL Account Status                                         CGL002
      *                                                                   CGL002
     C                     EXSR SRGLST                                    CGL002
     C                     MOVELURERST    #RIEST                          CGL002
     C                     MOVELURERMG    #RIEMA                          CGL002
      *                                                                   CGL002
      **  Determine Item Error State...                                   CGL002
     C                     SELEC                                          CGL002
      *                                                                   CGL002
      **  ...Errors in Item, send message 'Can't Override GL A/c Error'   CGL002
      *                                                                   CGL002
     C           #RIEST    WHEQ 'E'                                       CGL002
     C                     MOVEL'Y'       #1RINE                          CGL002
     C                     MOVEL'N'       #1RINO                          CGL002
     C                     MOVEL#RACID    ZA0053                          CGL002
     C                     MOVEL#1CYCD    ZA0054                          CGL002
     C                     MOVEL#1ACCD    ZA0055                          CGL002
     C                     MOVEL#1ACSN    ZA0056                          CGL002
     C                     MOVEL'GLX0395' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     983233               CGL002
     C                     SETON                     3435                 CGL002
      *                                                                   CGL002
      **  ...Overridable Errors                                           CGL002
      *                                                                   CGL002
     C           #RIEST    WHEQ 'O'                                       CGL002
     C                     MOVEL'Y'       #1RINE                          CGL002
      *                                                                   CGL002
     C           #1RINO    IFNE 'Y'                                       CGL002
     C           #1RINO    ANDNE'N'                                       CGL002
      *                                                                   CGL002
      **  Override indicator is *Blank, send message 'GL A/c              CGL002
      **  Error Requires Override'                                        CGL002
     C           #1RINO    IFEQ *BLANK                                    CGL002
     C                     MOVEL#1RINO    ZA0057                          CGL002
     C                     MOVEL'GLX0141' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     9839                 CGL002
      *                                                                   CGL002
      **  Else, send message 'GL A/c Override Invalid'                    CGL002
     C                     ELSE                                           CGL002
     C                     MOVEL#1RINO    ZA0058                          CGL002
     C                     MOVEL'GLX0214' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     9839                 CGL002
     C                     ENDIF                                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  ...No errors in Item                                            CGL002
      *                                                                   CGL002
     C           #RIEST    WHEQ *BLANK                                    CGL002
     C                     MOVEL'N'       #1RINE                          CGL002
     C                     MOVEL*BLANK    #1RINO                          CGL002
      *                                                                   CGL002
     C                     ENDSL                                          CGL002
      *                                                                   CGL002
      *================================================================   CGL002
     CSR                   ENDSR                                          CGL002
      /EJECT                                                              CGL002
     CSR         SRGLST    BEGSR                                          CGL002
      *================================================================   CGL002
      **  Check GL Account Status                                         CGL002
      *================================================================   CGL002
      *                                                                   CGL002
     C                     MOVE *IN90     URSI90  1                       CGL002
     C                     MOVE *IN91     URSI91  1                       CGL002
     C                     MOVE *BLANK    URERMG                          CGL002
     C                     MOVE *BLANK    URERST  1                       CGL002
     C                     Z-ADD1         U1      30                      CGL002
     C                     SETOF                     91                   CGL002
      *                                                                   CGL002
      **  Determine if user is authorised to perform GL Account           CGL002
      **  Overrides in all cases                                          CGL002
      *                                                                   CGL002
     C                     CALL 'ZVACTBU'              90                 CGL002
     C                     PARM 'O'       WACTN   1                       CGL002
     C                     PARM #1IBCA    WBRCA   3                       CGL002
     C                     PARM *ZERO     WERCD   10                      CGL002
      *                                                                   CGL002
      **  Call to program ended in error                                  CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C                     MOVEL'Y2U0021' W0RTN   7                       CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Error Condition                                           CGL002
     C           WERCD     IFEQ 0                                         CGL002
     C                     MOVE 'Y'       WUAUTH  1                       CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'N'       WUAUTH                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Refer Debits:                                             CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'D'                                       CGL002
     C                     TESTB'0'       URRETI  1      90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE01    IFNE 'Y'                                       CGL002
     C           CGL002    OREQ 'Y'                                                         MD038989
     C           WUACTY    ANDEQ'G'                                                         MD038989
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Refer Dr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Refer Credits:                                            CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'C'                                       CGL002
     C                     TESTB'1'       URRETI         90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE02    IFNE 'Y'                                       CGL002
     C           CGL002    OREQ 'Y'                                                         MD038989
     C           WUACTY    ANDEQ'G'                                                         MD038989
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Refer Cr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Block Debits:                                             CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'D'                                       CGL002
     C                     TESTB'2'       URRETI         90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE03    IFNE 'Y'                                       CGL002
     C           CGL002    OREQ 'Y'                                                         MD038989
     C           WUACTY    ANDEQ'G'                                                         MD038989
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Block Dr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Block Credits:                                            CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'C'                                       CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C                     TESTB'3'       URRETI         90               CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE04    IFNE 'Y'                                       CGL002
     C           CGL002    OREQ 'Y'                                                         MD038989
     C           WUACTY    ANDEQ'G'                                                         MD038989
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Block Cr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  If there are any errors, setup non-overrideable error status    CGL002
      *                                                                   CGL002
     C           U1        IFGT 1                                         CGL002
     C           U1        IFLT 5                                         CGL002
     C                     MOVELURNORM    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C           *IN91     IFEQ '1'                                       CGL002
     C                     MOVE 'E'       URERST                          CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'O'       URERST                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Else, no errors found                                           CGL002
     C                     ELSE                                           CGL002
     C                     MOVE *BLANK    URERST                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     MOVE URSI90    *IN90                           CGL002
     C                     MOVE URSI91    *IN91                           CGL002
      *                                                                   CGL002
      *================================================================   CGL002
     CSR                   ENDSR                                          CGL002
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Set up Branch Code
      *================================================================
     C                     MOVELP2BCDA    WUIBCA           Input Branch Co
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Check Account Identifier
      *================================================================
      * Determine Account type - Standard functions  *
     C                     MOVEL#RACID    UKACID           10-Char.A/C ID
     C******               EXSR UKACCK                                    E17819
     C                     EXSR XXIN                                      E17819
     C                     MOVELUKTYPE    WUAISF           Account type
     C*SR***      UKACCK    BEGSR                                         E17819
      * CASE: WRK.Account ID Status Flag is Error
     C           WUAISF    IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0011           Account Identif
      * Send message 'Account ID not valid'
     C                     MOVEL'GLX0050' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     END                             *FI
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Validate Cust No Or Shortname
      *================================================================
     C                     MOVEL'N'       WUCNSI           Cust No or Shor
      * CASE: WRK.Valid Customer Number is Not Valid
     C           WUVCNB    IFEQ 'N'                        *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0026           Account Identif
      * Send message 'Customer not found'
     C                     MOVEL'GLX0084' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
      * CASE: RCD.Currency code is Blank
     C           #1CYCD    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0027           Currency code
      * Send message 'Currency Code Required'
     C                     MOVEL'GLX0123' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
      * CASE: RCD.Account code is Blank
     C           #1ACCD    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0028           Account code
      * Send message 'Account Code Required'
     C                     MOVEL'GLX0124' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9834  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
      * CASE: RCD.Account sequence number is Blank
     C           #1ACSN    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1ACSN    ZA0029           Account sequenc
      * Send message 'Account Seq Required'
     C                     MOVEL'GLX0125' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
      * CASE: WRK.Cust No or Short Inval is No Error
     C           WUCNSI    IFEQ 'N'                        *IF
      *     E18852  - Branch Code Of trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVELWUIBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C/COPY WNCPYSRC,GL0122MC05
      * Setup message data for message
     C                     MOVEL#RACID    ZA0030           Account Identif
     C                     MOVEL#1CYCD    ZA0031           Currency code
     C                     MOVEL#1ACCD    ZA0032           Account code
     C                     MOVEL#1ACSN    ZA0033           Account sequenc
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     3435  *
     C/COPY WNCPYSRC,GL0122MC06
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * E18437 Start
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUACTY    #1ACTY           Account type
     C                     Z-ADDWURACN    #1RACN           Retail account
     C                     Z-ADDWURRNM    #1RRNM           Relative rec no
     C                     MOVEL'N'       #1RNBE           Retail Number E
      * CASE: WRK.Account status is Closed
     C           WUACCS    IFEQ 'C'                        *IF
     C           WURECI    ANDEQ'C'                                                           237508
      * Setup message data for message
     C                     MOVEL#RACID    ZA0034           Account Identif
     C                     MOVEL#1CYCD    ZA0035           Currency code
     C                     MOVEL#1ACCD    ZA0036           Account code
     C                     MOVEL#1ACSN    ZA0037           Account sequenc
      * Send message 'Account is Closed'
     C                     MOVEL'GLX0126' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     END                             *FI
      * CASE: WRK.Account flagged for closure                                                 237508
     C           WUACCS    IFEQ 'C'                        *IF                                237508
     C           WURECI    ANDEQ'D'                                                           237508
      * Setup message data for message                                                        237508
     C                     MOVEL#RACID    ZA0016           Account Identif                    237508
     C                     MOVEL#1CYCD    ZA0017           Currency code                      237508
     C                     MOVEL#1ACCD    ZA0018           Account code                       237508
     C                     MOVEL#1ACSN    ZA0019           Account sequenc                    237508
      * Send message 'Account is Closed'                                                      237508
     C**********           MOVEL'GLX0427' ZAMSID                                     237508 AR782538
     C                     MOVEL'GLX0409' ZAMSID                                            AR782538
     C                     EXSR ZASNMS                                                        237508
      *                                                                                       237508
     C                     END                             *FI                                237508
      * E18437 End
     C                     END                             *FI
      *                                                                   CGL008
      ** If CGL008 is installed, Verify the contents of the field         CGL008
      ** 'Access to all account codes'                                    CGL008
      *                                                                   CGL008
     C           CGL008    IFEQ 'Y'                                       CGL008
      *                                                                   CGL008
     C           WMACOD    IFNE 'Y'                                       CGL008
     C           #1ACCD    ANDNE'?'                                       CGL008
     C           #1ACCD    ANDNE*BLANKS                                   CGL008
      *                                                                   CGL008
      ** Check the Authorities of this account code                       CGL008
      *                                                                   CGL008
     C                     MOVE #1ACCD    WWACCD                          CGL008
     C           KCAUAC    CHAINSFACAUL0             22                   CGL008
      *                                                                   CGL008
     C           *IN22     IFEQ *ON                                       CGL008
     C                     MOVEL'CGL0001' ZAMSID                          CGL008
     C                     EXSR ZASNMS                                    CGL008
     C                     MOVE *ON       *IN98                           CGL008
     C                     MOVE *ON       *IN34                           CGL008
     C                     ENDIF                                          CGL008
     C                     ENDIF                                          CGL008
      *                                                                   CGL008
     C                     ENDIF                                          CGL008
     C                     END                             *FI
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      * Check if attempting to ADD a Retail Account
      *================================================================
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVELWUIBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * End of Fix LN0315
      * CASE: PGM.*Program mode is *ADD
     C           W0PMD     IFEQ 'ADD'                      *IF
      *     E18852  - Branch Code Of trade Parm Added 28.09.89
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0038           Account Identif
     C                     MOVEL#1CYCD    ZA0039           Currency code
     C                     MOVEL#1ACCD    ZA0040           Account code
     C                     MOVEL#1ACSN    ZA0041           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     GOTO UDEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         UESUBR    BEGSR
      *================================================================
      * Validate Branch Code
      *================================================================
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: PAR.Branch Code - Alpha NE WRK.Input Branch Code - Alpha
     C           P2BCDA    IFNE WUIBCA                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0042           Account Identif
     C                     MOVEL#1CYCD    ZA0043           Currency code
     C                     MOVEL#1ACCD    ZA0044           Account code
     C                     MOVEL#1ACSN    ZA0045           Account sequenc
     C                     MOVELP2BCDA    ZA0046           Branch Code - A
      * Send message 'Account Not Valid - Brch'
     C                     MOVEL'GLX0208' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUIBCA    #1IBCA           Input Branch Co
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UEEXIT    ENDSR
      /EJECT
     CSR         UFSUBR    BEGSR
      *================================================================
      * Obtain NOSTRO details
      *================================================================
      * Access Nostro Details. - Nostro Details  *
     C*
     C* Set up Parameters for call to AONOSTR0
     C*
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACCD
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1NNBI    UUNONB
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Access Nostro Details file for the file fields
     C*
     C                     CALL 'AONOSTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCUST  6        I:Customer No.
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACCD  4        I:Account Code                     CGL029
     C                     PARM           UUACCD                                              CGL029
     C                     PARM           UUACSN  2        I:Account Seque
     C                     PARM           UUNONB  2        I:Nostro Number
     C                     PARM           UUBRCD  3        I:Branch Code
     C                     PARM *BLANK    UUCSSN 10        I:Cust ShortN  S01230
     C                     PARM *BLANK    UUPNOI  1        I:Prime Nost InS01230
     C           D@NOST    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA7CYCD    WUCYCD           Currency Code
     C                     MOVELA7NONB    WUNONB           Nostro Number
     C                     MOVELA7ACCD    WUACCD           Account Code
     C                     MOVELA7CUST    WUCUST           Customer Number
     C                     MOVELA7ACSN    WUACSN           Account Sequenc
     C                     MOVELA7NOSN    WUNOSN           Nostro Shortnam
     C***********          MOVELA7OANN    WUOANN           Our A/c Nost                       210796
     C                     MOVELA7OACN    WUOANN           Our A/c Nost                       210796
     C                     MOVELA7ORAC    WUORAC           Our Rec A/c
     C                     MOVELA7PNOI    WUPNOI           Prime Nostro In
     C                     MOVELA7BRCD    WUIBCA           Branch Code
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL*BLANK    #1NNBI           Nostro number (
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUNONB    #1NNBI           Nostro number (
     C                     END                             *FI
      *================================================================
     CSR         UFEXIT    ENDSR
      /EJECT
     CSR         UGSUBR    BEGSR
      *================================================================
      * Check Posting amount
      *================================================================
      * CASE: RCD.Formatted Posting amount is Entered
     C           #RFMPA    IFNE *BLANK                     *IF
      * Get Number of Decimal Places
      * CASE: RCD.Currency code is Not Question Mark
     C           #1CYCD    IFNE '?'                        *IF
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
      * Set up number of decimal places and number of digits for zalign
      * CASE: WRK.Number of Decimal Places is Zero
     C           WUNBDP    IFEQ *ZERO                      *IF
     C                     Z-ADD*ZERO     WUZNDE           ZALIGN No Of De
     C***********          Z-ADD12        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD13        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is One
     C           WUNBDP    IFEQ 1                          *IF
     C                     Z-ADD1         WUZNDE           ZALIGN No Of De
     C***********          Z-ADD11        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD12        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is Two
     C           WUNBDP    IFEQ 2                          *IF
     C                     Z-ADD2         WUZNDE           ZALIGN No Of De
     C***********          Z-ADD10        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD11        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is Three
     C           WUNBDP    IFEQ 3                          *IF
     C                     Z-ADD3         WUZNDE           ZALIGN No Of De
     C***********          Z-ADD9         WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD10        WUZNDI           ZALIGN No Of Di089856
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#RFMPA    WUZASF           ZALIGN Screen F
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0122MCP2                                           S01408
      *                                                                   S01408
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0001  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0002 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0003  10       ZALIGN No Of De
     C                     PARM WUZNDI    WQ0004  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0005 16        ZALIGN File Fie
      *
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0122MCP3                                           S01408
      *                                                                   S01408
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0122MCP4                                           S01408
      *                                                                   S01408
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0006 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0007  10       ZALIGN No Of De
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0122MCP3                                           S01408
      *                                                                   S01408
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0047           Formatted Posti
      * Send message 'Amount not valid'
     C                     MOVEL'GLX0063' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * MOVE Posting Amount - Journal Entry Posting  *
     C*  MOVE ZALIGN FILE FIELD INTO POSTING AMOUNT
     C                     MOVE WUZAFF    #1PTAM
      * Move Fmt Posting Amount - Journal Entry Posting  *
     C*  MOVE ZALIGN FUNCTION FIELD INTO FORMATTED POSTING AMOUNT
     C                     MOVE WUZASF    #RFMPA
      * CASE: RCD.Posting amount is LE Zero
     C           #1PTAM    IFLE *ZERO                      *IF
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0048           Formatted Posti
      * Send message 'Amount not valid'
     C                     MOVEL'GLX0063' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0049           Formatted Posti
      * Send message 'Posting amount is req'd'
     C                     MOVEL'GLX0215' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     END                             *FI
      *================================================================
     CSR         UGEXIT    ENDSR
      /EJECT
     CSR         UHSUBR    BEGSR
      *================================================================
      * Check Narrative
      *================================================================
     C                     MOVEL*BLANK    #1NVCD           Narrative code
     C                     MOVEL*BLANK    #1NRDC           Narrative descr
      * Check Narrative - Standard functions  *
     C*  Check Narrative for Narrative code
     C*
     C                     MOVE #RNRTV    URNARR 28        Narrative slice
      *
     C           #RNRTV    IFNE *BLANK                     IF ¬BLANK
     C           URNARR    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*CODE  ' WUNRST             Code entered
     C                     MOVEL#RNRTV    #1NVCD             Narrative code
     C                     ELSE                            EL ¬BLANK
     C                     MOVE '*TEXT  ' WUNRST             Narrative text
     C                     MOVE *BLANK    #1NVCD             No Narr.code
     C                     END                             FI
     C                     ELSE                            EL BLANK
     C                     MOVE '*ERROR ' WUNRST             No narrative
     C                     MOVE *BLANK    #1NVCD             No Narr.code
     C                     END                             FI
      *
      * CASE: WRK.Narrative status is No narrative
     C           WUNRST    IFEQ '*ERROR'                   *IF
      * Setup message data for message
     C                     MOVEL#RNRTV    ZA0051           Narrative
      * Send message 'No Narrative entered'
     C                     MOVEL'GLX0055' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9838  *
      *
     C                     END                             *FI
      * CASE: WRK.Narrative status is Narrative code entered
     C           WUNRST    IFEQ '*CODE'                    *IF
      * Access Narrative. - Narrative Codes  *
     C*
     C*  Access Narrative codes file for the following fields
     C*  Narrative Code, Narrative Description
     C*
     C                     MOVEL#1NVCD    UUNVCD
     C                     CALL 'AONARRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUNVCD  2        I:Narrative Code
     C           D@NARR    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELALNVCD    #1NVCD           Narrative Code
     C                     MOVELALDON     WUDON            Description
     C*
      * E17610 Start
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RNRTV    ZA0052           Narrative
      * Send message 'Narrative Code not found'
     C                     MOVEL'GLX0049' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9838  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVEL#1NVCD    #RNRTV           Narrative
     C                     END                             *FI
      * E17610 End
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#RNRTV    #1NRDC           Narrative descr
     C                     END                             *FI
      *================================================================
     CSR         UHEXIT    ENDSR
      /EJECT
     CSR         UISUBR    BEGSR
      *================================================================
      * Check Retail/Non-Retail fields
      *================================================================
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Check Overrideable Retail errors
     C                     EXSR UJSUBR                     Check Overridea
      * Start of 054018
     C                     ELSE
      * CASE: *OTHERWISE
      *                                                                   CGL002
      **  If Block GL Accounts Enhancement feature is switched on         CGL002
      **  and account type is GL, check overrideable GL errors            CGL002
      *                                                                   CGL002
     C                     EXSR SRNOST                                                      MD038989
     C           CGL002    IFEQ 'Y'                                       CGL002
     C           WUACTY    ANDEQ'G'                                       CGL002
     C           WUACTY    OREQ 'N'                                                         MD038989
     C           NSTFLG    OREQ 'Y'                                                         MD038989
     C                     EXSR SRGLOV                                    CGL002
     C                     ELSE                                           CGL002
      *                                                                   CGL002
     C                     MOVEL'N'       #1RINE           Retail ind.: Er
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
     C                     ENDIF                                          CGL002
      * End of 054018
     C                     END                             *FI
      *================================================================
     CSR         UIEXIT    ENDSR
      /EJECT
     CSR         UJSUBR    BEGSR
      *================================================================
      * Check Overrideable Retail errors
      *================================================================
      * E17610 Start
      * CASE: RCD.Cheque number is Entered
     C           #1CQNB    IFNE *BLANK                     *IF
      * CASE: RCD.Debit/credit indicator is Debit
     C           #1DCIN    IFEQ 'D'                        *IF
      * Verify Stopped Cheque. - Standard functions  *
     C*
     C*  Call to Access Program - AOSTOPV0 Verify Stoppped Cheque
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOSTOPV0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM #1PTAM    UUCQAM 130       I:Cheque Amount
     C                     PARM #1CQNB    UUCQNB  8        I:Cheque Number
     C                     PARM #1RACN    UURACN 100       I:Retail Account No
     C                     PARM #1CUST    UUCUST  6        I:Customer Number
     C                     PARM #1CYCD    UUCYCD  3        I:Currency Code
     C**********           PARM #1ACCD    UUACCD  4        I:Account Code                     CGL029
     C                     PARM #1ACCD    UUACCD                                              CGL029
     C                     PARM #1ACSN    UUACSN  2        I:Acount Sequence
     C                     PARM #1IBCA    UUBRCD  3        I:Branch Code
     C*
     C                     END                             *FI
     C                     END                             *FI
      * E17610 End
      * Check Retail ind. abbrev. - Standard functions  *
     C*********************MOVEL#IRTIN    URRETI           Retail ind.    054018
     C                     MOVELWURETB    URRETI           Retail ind.    054018
     C*********************MOVEL#IAORC    URSTOP  7        A/O Rtn.Code
     C                     MOVELWUAPRC    URSTOP  7        A/P Rtn.Code
     C                     MOVEL#1DCIN    URIND   1                       E17600
      *
     C/COPY WNCPYSRC,GL0122MC09
     C                     EXSR URRETK                     Check Retail
      *
     C/COPY WNCPYSRC,GL0122MC10
     C                     MOVELURERST    #RIEST           Error status
     C                     MOVELURERMG    #RIEMA           Error message
      *
      * CASE: RCD.Item error state is Errors in Item
     C           #RIEST    IFEQ 'E'                        *IF
     C                     MOVEL'Y'       #1RINE           Retail ind.: Er
     C                     MOVEL'N'       #1RINO           Retail ind.: Ov
      * Setup message data for message
     C                     MOVEL#RACID    ZA0053           Account Identif
     C                     MOVEL#1CYCD    ZA0054           Currency code
     C                     MOVEL#1ACCD    ZA0055           Account code
     C                     MOVEL#1ACSN    ZA0056           Account sequenc
      * Send message 'Can't O'ride Retail error'
     C                     MOVEL'GLX0085' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     ELSE
      * CASE: RCD.Item error state is Overridable Errors
     C           #RIEST    IFEQ 'O'                        *IF
     C                     MOVEL'Y'       #1RINE           Retail ind.: Er
      * CASE: RCD.Retail ind.: Override is Error(s) Overridden
     C           #1RINO    IFEQ 'Y'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.Retail ind.: Override is *Blank
     C           #1RINO    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1RINO    ZA0057           Retail ind.: Ov
      * Send message 'Retail Error Req's Overde'
     C                     MOVEL'GLX0141' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1RINO    ZA0058           Retail ind.: Ov
      * Send message 'Retail Override Invalid'
     C                     MOVEL'GLX0214' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: RCD.Item error state is No errors in Item
     C           #RIEST    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       #1RINE           Retail ind.: Er
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UJEXIT    ENDSR
      /EJECT
     CSR         UKSUBR    BEGSR
      *================================================================
      * Setup Branch code (Header) & Posting Date on RCD
      *================================================================
     C                     MOVELP2BCDA    #1BCBH           Branch Code (Ba
     C                     Z-ADDWURDNO    #1PTDT           Posting date
      *================================================================
     CSR         UKEXIT    ENDSR
      /EJECT
     CSR         ULSUBR    BEGSR
      *================================================================
      * Store data for *Copy function
      *================================================================
     C                     EXSR UMSUBR
      *================================================================
     CSR         ULEXIT    ENDSR
      /EJECT
     CSR         UMSUBR    BEGSR
      *================================================================
      *
      *================================================================
     C                     MOVEL#RACID    WUCACI           Copy:Account id
     C                     MOVEL#1CYCD    WUCCCD           Copy:Currency c
     C                     MOVEL#1ACCD    WUCPAC           Copy:Account co
     C                     MOVEL#1ACSN    WUCACS           Copy:Account Se
      * Start of Fix E03063
     C                     MOVEL#RFMPA    WUCAMT           Copy:Amount
      * End of Fix E03063
     C                     MOVEL#1DCIN    WUCDCI           Copy:DR/CR Indi
     C                     MOVEL#RNRTV    WUCNAR           Copy:Narrative
     C                     MOVEL#1ACNB    WUCACN           Copy:Assoc. Cus
      *================================================================
     CSR         UMEXIT    ENDSR
      /EJECT
     CSR         UNSUBR    BEGSR
      *================================================================
      * Check for Copy CHAR in REC Fields
      *================================================================
      * CASE: RCD.Account Identifier EQ WRK.JE Special Character
     C           #RACID    IFEQ WUJESP                     *IF
     C                     MOVELWUCACI    #RACID           Account Identif
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Currency code EQ WRK.JE Special Character
     C           #1CYCD    IFEQ WUJESP                     *IF
     C                     MOVELWUCCCD    #1CYCD           Currency code
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Account code EQ WRK.JE Special Character
     C           #1ACCD    IFEQ WUJESP                     *IF
     C                     MOVELWUCPAC    #1ACCD           Account code
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Account sequence number EQ WRK.JE Special Character
     C           #1ACSN    IFEQ WUJESP                     *IF
     C                     MOVELWUCACS    #1ACSN           Account sequenc
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Start of Fix E03063
      * CASE: RCD.Formatted Posting amount EQ WRK.JE Special Character
     C           #RFMPA    IFEQ WUJESP                     *IF
     C                     MOVELWUCAMT    #RFMPA           Formatted Posti
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * End of Fix E03063
      * CASE: RCD.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
     C                     MOVELWUCDCI    #1DCIN           Debit/credit in
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Narrative EQ WRK.JE Special Character
     C           #RNRTV    IFEQ WUJESP                     *IF
     C                     MOVELWUCNAR    #RNRTV           Narrative
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Assoc. Customer number EQ WRK.JE Special Character
     C           #1ACNB    IFEQ WUJESP                     *IF
     C                     MOVELWUCACN    #1ACNB           Assoc. Customer
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      *================================================================
     CSR         UNEXIT    ENDSR
      /EJECT
      *================================================================                     MD038989
      * Validate If account is a Nostro                               *                     MD038989
      *================================================================                     MD038989
     CSR         SRNOST    BEGSR                                                            MD038989
      *                                                                                     MD038989
     C                     TESTN          UKACM2     72                                     MD038989
     C           *IN72     IFEQ '0'                                                         MD038989
     C                     CALL 'AONOSTR0'                                                  MD038989
     C                     PARM           XXAPRC  7                                         MD038989
     C                     PARM '*KEY'    XXAPOP  7                                         MD038989
     C                     PARM BTCUST    XXCUST  6                                         MD038989
     C                     PARM BTCYCD    XXCYCD  3                                         MD038989
     C                     PARM BTACCD    XXACCD 10                                         MD038989
     C                     PARM BTACSN    XXACSN  2                                         MD038989
     C                     PARM           XXNONB  2                                         MD038989
     C                     PARM BTIBCA    XXBRCD  3                                         MD038989
     C                     PARM           XXCSSN 10                                         MD038989
     C                     PARM           XXPNOI  1                                         MD038989
     C                     PARM           UUFDY                                             MD038989
      *                                                                                     MD038989
     C           XXAPRC    IFEQ '      '                                                    MD038989
     C                     MOVEL'Y'       NSTFLG  1                                         MD038989
     C                     ELSE                                                             MD038989
     C                     MOVEL'N'       NSTFLG                                            MD038989
     C                     END                                                              MD038989
      *                                                                                     MD038989
     C                     ELSE                                                             MD038989
     C                     MOVEL'Y'       NSTFLG                                            MD038989
     C                     ENDIF                                                            MD038989
      *                                                                                     MD038989
     CSR                   ENDSR                                                            MD038989
     C/EJECT                                                                                MD038989
     CSR         UOSUBR    BEGSR
      *================================================================
      * Change Mode Processing
      *================================================================
     C                     MOVEL'N'       WUTFUS           Template Facili
     C                     MOVEL'N'       WUCFUS           Copy Facility U
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
      * CASE: RCD.*SFLSEL is Copy/Template
     C           #1SEL     IFEQ 'C'                        *IF
     C           #1SEL     OREQ 'T'
      * CASE: RCD.*SFLSEL is Template
     C           #1SEL     IFEQ 'T'                        *IF
     C                     MOVEL'Y'       WUTFUS           Template Facili
     C                     END                             *FI
      * CASE: RCD.*SFLSEL is Copy
     C           #1SEL     IFEQ 'C'                        *IF
     C                     MOVEL'Y'       WUCFUS           Copy Facility U
     C                     END                             *FI
      * Store Data for Copy / Template Function
     C                     EXSR UPSUBR                     Store Data for
     C                     END                             *FI
      * Check for copy character in screen field
     C                     EXSR UQSUBR                     Check for copy
     C                     END                             *FI
      *================================================================
     CSR         UOEXIT    ENDSR
      /EJECT
     CSR         UPSUBR    BEGSR
      *================================================================
      * Store Data for Copy / Template Function
      *================================================================
     C                     MOVEL#RACID    WUCACI           Copy:Account id
     C                     MOVEL#1ACSN    WUCACS           Copy:Account Se
     C                     MOVEL#1ACCD    WUCPAC           Copy:Account co
     C                     MOVEL#1CYCD    WUCCCD           Copy:Currency c
      * Start of Fix E03063
     C                     MOVEL#RFMPA    WUCAMT           Copy:Amount
      * End of Fix E03063
     C                     MOVEL#1DCIN    WUCDCI           Copy:DR/CR Indi
     C                     MOVEL#RNRTV    WUCNAR           Copy:Narrative
     C                     MOVEL#1ACNB    WUCACN           Copy:Assoc. Cus
      *================================================================
     CSR         UPEXIT    ENDSR
      /EJECT
     CSR         UQSUBR    BEGSR
      *================================================================
      * Check for copy character in screen field
      *================================================================
      * CASE: RCD.Account Identifier EQ WRK.JE Special Character
     C           #RACID    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0062           Account Identif
     C                     MOVELWUJESP    ZA0063           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     END                             *FI
      * CASE: RCD.Currency code EQ WRK.JE Special Character
     C           #1CYCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0064           Currency code
     C                     MOVELWUJESP    ZA0065           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     END                             *FI
      * CASE: RCD.Account code EQ WRK.JE Special Character
     C           #1ACCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0066           Account code
     C                     MOVELWUJESP    ZA0067           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9834  *
      *
     C                     END                             *FI
      * CASE: RCD.Account sequence number EQ WRK.JE Special Character
     C           #1ACSN    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1ACSN    ZA0068           Account sequenc
     C                     MOVELWUJESP    ZA0069           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     END                             *FI
      * Start of Fix E03063
      * CASE: RCD.Formatted Posting amount EQ WRK.JE Special Character
     C           #RFMPA    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0070           Formatted Posti
     C                     MOVELWUJESP    ZA0071           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     END                             *FI
      * End of Fix E03063
      * CASE: RCD.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1DCIN    ZA0072           Debit/credit in
     C                     MOVELWUJESP    ZA0073           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9837  *
      *
     C                     END                             *FI
      * CASE: RCD.Narrative EQ WRK.JE Special Character
     C           #RNRTV    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RNRTV    ZA0074           Narrative
     C                     MOVELWUJESP    ZA0075           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9838  *
      *
     C                     END                             *FI
      * CASE: RCD.Assoc. Customer number EQ WRK.JE Special Character
     C           #1ACNB    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1ACNB    ZA0076           Assoc. Customer
     C                     MOVELWUJESP    ZA0077           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
     C/COPY WNCPYSRC,GL0122MC30
      *
     C                     END                             *FI
      *================================================================
     CSR         UQEXIT    ENDSR
     CSR         URRETK    BEGSR
      *====================================================
      * Check Retail Account status
      *----------------------------------------------------
      *
     C                     MOVE *IN90     URSI90  1        Save indicator
     C                     MOVE *IN91     URSI91  1        Save indicator
     C                     MOVE *BLANK    URERMG           Blank msg.text
     C                     MOVE *BLANK    URERST  1        Error status
     C                     Z-ADD1         U1      30       Set pointer
     C                     SETOF                     91    Set ind.
      *
      * Check Refer Debits :
      *
     C           URIND     IFEQ 'D'                        ONLY IF DEBIT  E17600
      *
     C                     TESTB'0'       URRETI  1      90=Refer debits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE01    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Refer Dr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Refer Credits :
      *
     C           URIND     IFEQ 'C'                        ONLY IF CREDIT E17600
      *
     C                     TESTB'1'       URRETI         90 Refer credits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE02    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Refer Cr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Block Debits :
      *
     C           URIND     IFEQ 'D'                        ONLY IF DEBIT  E17600
      *
     C                     TESTB'2'       URRETI         90 Block debits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE03    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Block Dr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Block Credits :
      *
     C           URIND     IFEQ 'C'                        ONLY IF CREDIT E17600
      *
     C                     TESTB'3'       URRETI         90 Block credits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE04    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Block Cr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Inactive A/C :
      *
     C                     TESTB'4'       URRETI         90 Inactive a/c
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE05    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Inactive'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
      *
      * Check Not in Use :   ***REMOVE COMMENTS IF FLAG TO BE USED LATER***
      *
     C*****                TESTB'5'       URRETI         90 -Not in Use-
      *
     C*****      *IN90     IFEQ '1'                        IF BIT SET
     C*****      URRE06    IFNE 'Y'                        IF NO O'RIDE
     C*****                MOVELURRIHF    @IH,U1             Blnk.H'Light
     C*****                SETON                     91      No O'ride
     C*****                ELSE                            EL O'RIDEABLE
     C*****                MOVELURRIHS    @IH,U1             Highlight
     C*****                END                             FI
     C*****                MOVE 'Not used'@IH,U1             Message text
     C*****                ADD  1         U1                 Incr.pointer
     C*****                END                             FI
      *
      * Check Bankrupt :
      *
     C                     TESTB'6'       URRETI         90 B'rupt/L'dated
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE07    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Bankrupt'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
      *
      * Check Bad Debt :
      *
     C                     TESTB'7'       URRETI         90 Bad debt
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE08    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Bad Debt'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
      *
      * Check Stopped cheque :
      *
     C           URSTOP    IFEQ '*STOP  '                  IF STOPPED
     C           URRE09    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Chq.Stop'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
      *
      * Check Non-Overrideable error status :
      *
     C           U1        IFGT 1                          IF ERRORS
     C           U1        IFLT 9                          IF NOT MAXIMUM
     C                     MOVELURNORM    @IH,U1             End Highlight
     C                     END                             FI
     C           *IN91     IFEQ '1'                        IF NOT O'RIDE
     C                     MOVE 'E'       URERST             Error Status
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVE 'O'       URERST             Error Status
     C                     END                             FI
     C                     ELSE                            EL NO ERRORS
     C                     MOVE *BLANK    URERST             Error Status
     C                     END                             FI
      *
     C                     MOVE URSI90    *IN90            Restore ind.
     C                     MOVE URSI91    *IN91            Restore ind.
      *
      *----------------------------------------------------
      *
      *====================================================
     CSR         UREXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C                     MOVEL#2BTNB    WK1X01  1
     C           WK1X01    IFEQ '?'                        Batch number
     C                     CALL 'GL0140S'              90  *
     C                     PARM           W0RTN   7
     C           #2BTNB    PARM #2BTNB    WQ0012  3        Batch number
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     CABNE*BLANK    VA999
     C                     END
      *................................................................
      *
     C           KLVABR    KLIST
     C                     KFLD           BRBTNB           Batch number
      * Setup key
     C                     MOVEL#2BTNB    BRBTNB           Batch number
     C           KLVABR    CHAIN@BRREAH              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
     C           VA999     TAG
      * Restrictor relation not satisfied
      * Send message 'Journal Entry Header   NF'
     C                     MOVEL'GLX0172' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'GLX0172' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VAEXIT    ENDSR
     CSR         XXIN      BEGSR                                          E17819
      *====================================================
      * Determine Account type
      *----------------------------------------------------
      *
     C                     MOVE *IN90     UKSI90  1        Save indicator
      *
      * 1. Check for invalid input :
      *
     C           UKACID    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*ERROR*' UKTYPE  7          Error
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 2. Check for Retail A/C :
      *
     C                     TESTN          UKACID     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF ALL NUMERIC
     C                     MOVE '*RETAIL' UKTYPE             Retail A/C
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 3. Check for Customer number :
      *
     C**********           TESTN          UKACF6     90    All numeric?                       CSD027
      **********                                                                              CSD027
     C********** *IN90     IFEQ '1'                        IF ALL NUMERIC                     CSD027
     C           UKACL4    IFEQ *BLANK                     IF 6 DIGITS ONLY
     C                     MOVE '*NUMBER' UKTYPE             Cust.number
     C                     GOTO UKSK01                       Return                           CSD027
     C                     ELSE                            EL INVALID
     C                     MOVE '*ERROR*' UKTYPE  7          Error
     C                     END                             FI
     C**********           GOTO UKSK01                       Return                           CSD027
     C**********           END                             FI                                 CSD027
      *
      * 4. Check for Nostro :
      *
     C                     TESTN          UKACM2     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF NUMERIC
     C           UKACA1    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA1    ANDLT'0'                         AND ¬NUMERIC
     C           UKACA2    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA2    ANDLT'0'                         AND ¬NUMERIC
     C           UKACA3    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA3    ANDLT'0'                         AND ¬NUMERIC
     C           UKACL5    ANDEQ*BLANK                      AND NO MORE
     C                     MOVE '*NOSTRO' UKTYPE             Nostro
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 5. Check for Customer Shortname :
      *
     C********** UKACF1    IFLT '0'                        IF ¬NUMERIC                        CSD027
     C********** UKACF1    ANDNE*BLANK                      AND ¬BLANK                        CSD027
     C           UKACL4    IFNE *BLANK                                                        CSD027
     C                     MOVE '*SHNAME' UKTYPE             Shortname
     C                     ELSE                            EL NUMERIC
     C                     MOVE '*ERROR*' UKTYPE             Invalid
     C                     END                             FI
      *          _____________
     C           UKSK01    TAG
      *          ~~~~~~~~~~~~~
     C                     MOVE UKSI90    *IN90            Restore ind.
      *
      *----------------------------------------------------
      *
      *====================================================
     C*SR****     UKEXIT    ENDSR                                         E17819
     CSR         XXOUT     ENDSR                                          E17819
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
      * USER: Exit program processing
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0122MEPP - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0122MEPP
     C*00/Copy Member GL0122M   Exit Program Processing
     C                     END                             *FI
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0122MCP1                                           S01408
      *                                                                   S01408
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C/COPY WNCPYSRC,GL0122MC20
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field S01212
     C                     MOVEL*BLANK    WUFKST  1
      * Define work field Item error msg. abbrev.
     C                     MOVEL*BLANK    WUIEMA 67
      * Define work field Access Pgm Return Code
     C                     MOVEL*BLANK    WUAPRC  7
      * Define work field Currency Name
     C                     MOVEL*BLANK    WUCYNM 14
      * Define work field Number of Decimal Places
     C                     Z-ADD*ZERO     WUNBDP  10
      * Define work field Nostro Shortname
     C                     MOVEL*BLANK    WUNOSN 10
      * Define work field Branch Code (Batch Headr)
     C                     MOVEL*BLANK    WUBCBH  3
      * Define work field Abbreviated Posting?
     C                     MOVEL*BLANK    WUABPS  1
      * Define work field Record ID                                                           237508
     C                     MOVEL*BLANK    WURECI  1                                           237508
      * Define work field Customer number
     C                     MOVEL*BLANK    WUCUST  6
      * Define work field Currency code
     C                     MOVEL*BLANK    WUCYCD  3
      * Define work field Account code
     C**********           MOVEL*BLANK    WUACCD  4                                           CGL029
     C                     MOVEL*BLANK    WUACCD 10                                           CGL029
      * Define work field Account sequence number
     C                     MOVEL*BLANK    WUACSN  2
      * Define work field Branch code
     C                     MOVEL*BLANK    WUBRCD  3
      * Define work field Account type
     C                     MOVEL*BLANK    WUACTY  1
      * Define work field Account subtype
     C                     MOVEL*BLANK    WUBPST  1
      * Define work field Account status
     C                     MOVEL*BLANK    WUACCS  1
      * Define work field Date account opened
     C                     Z-ADD*ZERO     WUDACO  50
      * Define work field Account name
     C                     MOVEL*BLANK    WUACNM 20
      * Define work field Retail account number
     C                     Z-ADD*ZERO     WURACN 100
      * Define work field Retail Indicators   MIDAS
     C                     MOVEL*BLANK    WURETB  1
      * Define work field Relative rec no of memos
     C                     Z-ADD*ZERO     WURRNM  50
      * Define work field Account Identifier
     C                     MOVEL*BLANK    WUACID 10
      * Obtain default message file
     C           *NAMVAR   DEFN MIMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Runday Number
     C                     Z-ADD*ZERO     WURDNO  50
      * Define work field Template Facility Used
     C                     MOVEL*BLANK    WUTFUS  1
      * Define work field Copy:Account identifier
     C                     MOVEL*BLANK    WUCACI 10
      * Define work field Copy:Currency code
     C                     MOVEL*BLANK    WUCCCD  3
      * Define work field Copy:Account Sequence
     C                     MOVEL*BLANK    WUCACS  2
      * Define work field Copy:Account code
     C**********           MOVEL*BLANK    WUCPAC  4                                           CGL029
     C                     MOVEL*BLANK    WUCPAC 10                                           CGL029
      * Define work field Copy:Branch Code - Alpha
     C                     MOVEL*BLANK    WUCBCA  3
      * Define work field Copy:Amount
     C                     MOVEL*BLANK    WUCAMT 14
      * Define work field Copy:DR/CR Indicator
     C                     MOVEL*BLANK    WUCDCI  1
      * Define work field Copy:Narrative
     C                     MOVEL*BLANK    WUCNAR 30
      * Define work field Copy:Assoc. Cust. Number
     C                     MOVEL*BLANK    WUCACN  6
      * Define work field Local Currency code
     C                     MOVEL*BLANK    WULCCY  3
      * Define work field Copy Facility Used
     C                     MOVEL*BLANK    WUCFUS  1
      * Define work field Copy:Retail Number Enter
     C                     MOVEL*BLANK    WUCRNE  1
      * Define work field Copy:Retail Account Num
     C                     Z-ADD*ZERO     WUCRAN 100
      * Define work field Copy:Customer Number
     C                     MOVEL*BLANK    WUCCUS  6
      * Define work field Copy:Narrative Code
     C                     MOVEL*BLANK    WUCNRC  2
      * Define work field Copy:Narrative Descriptn
     C                     MOVEL*BLANK    WUCNDS 30
      * Define work field Copy:Posting amount
     C                     Z-ADD*ZERO     WUCPAM 130
      * Define work field Decimal places
     C                     Z-ADD*ZERO     WUDCPL  10
      * Define work field Screen Footer / Copy Char
     C                     MOVEL*BLANK    WUSFCC 78
      * Define work field JE Special Character
     C                     MOVEL*BLANK    WUJESP  1
      * Define work field Input Branch Code - Alpha
     C                     MOVEL*BLANK    WUIBCA  3
      * Define work field Account ID Status Flag
     C                     MOVEL*BLANK    WUAISF  7
      * Define work field Nostro Number
     C                     MOVEL*BLANK    WUNONB  2
      * Define work field Our Account No. at Nostro
     C******************   MOVEL*BLANK    WUOANN 14                                           210796
     C                     MOVEL*BLANK    WUOANN 35                                           210796
      * Define work field Our Receive Account
     C                     MOVEL*BLANK    WUORAC 25
      * Define work field Prime Nostro Indicator
     C                     MOVEL*BLANK    WUPNOI  1
      * Define work field Nostro number (Item)
     C                     MOVEL*BLANK    WUNNBI  2
      * Define work field Cust No or Short Inval
     C                     MOVEL*BLANK    WUCNSI  1
      * Define work field Valid Customer Number
     C                     MOVEL*BLANK    WUVCNB  1
      * Define work field ZALIGN No Of Decimals
     C                     Z-ADD*ZERO     WUZNDE  10
      * Define work field ZALIGN No Of Digits
     C                     Z-ADD*ZERO     WUZNDI  20
      * Define work field ZALIGN Screen Fun Field
     C                     MOVEL*BLANK    WUZASF 16
      * Define work field ZALIGN File Field
     C                     MOVEL*BLANK    WUZAFF 16
      * Define work field Error Code
     C                     MOVEL*BLANK    WUERCD  1
      * Define work field Narrative status
     C                     MOVEL*BLANK    WUNRST  7
      * Define work field Description of Narrative
     C                     MOVEL*BLANK    WUDON  30
      * Define work field Account Code Name
     C                     MOVEL*BLANK    WUACCN 25
      * Define work field Account Section
     C                     MOVEL*BLANK    WUACSC  2
      * Define work field Account Sub-type
     C                     MOVEL*BLANK    WUACST  1
      * Define work field Client key identity
     C                     MOVEL*BLANK    WUCRST  7
      * Define work field Assoc. Customer number
     C                     MOVEL*BLANK    WUACNB  6
      * Define work field Customer Shortname
     C                     MOVEL*BLANK    WUCSSN 10
      * Define work field DRS Customer Shortname
     C                     MOVEL*BLANK    WUDRCS  7
      * Define work field Location Code
     C                     MOVEL*BLANK    WULCCD  3
      * Define work field Account Officer Code
     C                     MOVEL*BLANK    WUACOC  2
      * Define work field Customer Swift Id
     C                     MOVEL*BLANK    WUCSID 12
      * Define work field *SFLSEL
     C                     MOVEL*BLANK    WUSEL   1
      * Define work field Last item number
     C                     Z-ADD*ZERO     WULINB  30
      * Define work field Midas Rundate
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Setup Complete
     C                     MOVEL*BLANK    WUSUCP  1
      * Define work field Date Format flag
     C                     MOVEL*BLANK    WUDTFF  1
      * Define work field Multibranching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Define work field General Ledger
     C                     MOVEL*BLANK    WUGNLG 10
      * Define work field Profit & Loss Accnt Code
     C**********           MOVEL*BLANK    WUPLAC  4                                           CGL029
     C                     MOVEL*BLANK    WUPLAC 10                                           CGL029
      * Define work field Base Currency Transfer Fq
     C                     MOVEL*BLANK    WUBCTF  1
      * Define work field Accrual Key Summary Ind.
     C                     MOVEL*BLANK    WUAKSI  1
      * Define work field Accruals/Profit Date
     C                     Z-ADD*ZERO     WUAPDT  50
      * Define work field Accruals/Profit Frequency
     C                     MOVEL*BLANK    WUAPFQ  1
      * Define work field Accruals/Profit Fq. Day
     C                     Z-ADD*ZERO     WUAPFD  20
      * Define work field Accrue on Last Day Ind.
     C                     MOVEL*BLANK    WUALDI  1
      * Define work field A/c Posting Retention Pd
     C                     Z-ADD*ZERO     WUAPRP  20
      * Define work field Accrual Non-Wk Day Ind
     C                     MOVEL*BLANK    WUANWD  1
      * Define work field Spot Rates Retention Pd
     C                     Z-ADD*ZERO     WUSRRP  20
      * Define work field Base Rates Retention Pd
     C                     Z-ADD*ZERO     WUBRRP  20
      * Define work field GL Description Ind.
     C                     MOVEL*BLANK    WUGLDI  1
      * Define work field Profit Centres Used
     C                     MOVEL*BLANK    WUPRCU  1
      * Define work field Profit Centres Amendable
     C                     MOVEL*BLANK    WUPRCA  1
      * Define work field Profit Centre Def'ts Used
     C                     MOVEL*BLANK    WUPCDU  1
      * Define work field Prof C Def Matrix-Book
     C                     MOVEL*BLANK    WUPMBK  1
      * Define work field Prof C Def Matrix-T Type
     C                     MOVEL*BLANK    WUPMTT  1
      * Define work field Prof C Def Matrix-S Type
     C                     MOVEL*BLANK    WUPMST  1
      * Define work field Prof C Def Matrix-Branch
     C                     MOVEL*BLANK    WUPMBH  1
      * Define work field Prof C Def Matrix-Dept
     C                     MOVEL*BLANK    WUPMDT  1
      * Define work field Prof C Def Matrix-User
     C                     MOVEL*BLANK    WUPMUR  1
      * Define work field Prof C Def Matrix-A/c Off
     C                     MOVEL*BLANK    WUPMAO  1
      * Define work field Prof C Def Matrix-Cust
     C                     MOVEL*BLANK    WUPMCU  1
      * Define work field Originating Branch Used
     C                     MOVEL*BLANK    WUOBRU  1
      * Define work field Orig Branch User/Vald Req
     C                     MOVEL*BLANK    WUOBUV  1
      * Define work field JE Int-Bch Ents @ Bch/Itm
     C                     MOVEL*BLANK    WUIEBI  1
      * Define work field Main Branch
     C                     MOVEL*BLANK    WUMABR  3
      * Define work field Int-Bch Ent Via Main Brch
     C                     MOVEL*BLANK    WUIEMB  1
      * Define work field End of Last Activity Per.
     C                     Z-ADD*ZERO     WUELAP  50
      * Define work field End of Current Act Period
     C                     Z-ADD*ZERO     WUECAP  50
     C           *NAMVAR   DEFN           GLREOV           Override DTAARA
     C                     IN   GLREOV                     Obtain   DTAARA
      *
      * Set highlights for error message line :
      *
     C                     MOVE *LOVAL    URNORM  1        ¦ Highlight 0
     C                     BITON'2'       URNORM           ¦ Normal
      *
     C                     MOVE *LOVAL    URRIHS  1        ¦ Highlight 1
     C                     BITON'27'      URRIHS           ¦ RI/STEADY
      *
     C                     MOVE *LOVAL    URRIHF  1        ¦ Highlight 2
     C                     BITON'2467'    URRIHF           ¦ RI/HI/BLINK
      *
     C                     Z-ADD08        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      * Scan limit
     C                     Z-ADD500       W0SLM   50
      *................................................................
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL'Y'       W0APM   1
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialise program
      * Standard RPG Creation Par - Standard functions  *
      * Last Amend Box - GL0122M - Journal Entry Posting  *
      * Window Processing Hdr Box - Standard functions  *
      * Copyright notice - Standard functions  *
      * Start of S01314
      * Multi-Language - GL0122M - Journal Entry Posting  *
      *
      * Call SDRTVTXT pgm to access appropriate text
      *  for a field used in a SFL
      *
      * O'ride
     C                     MOVEL'ZZGBMSGF'MSGNM
     C                     MOVEL'ZZM3790' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM002                          S01413
     C                     MOVELMSGTXT    ZZM002  6                       S01413
      *
      * End of S01314
      * Setup message data for message
      * Retrieve message Lots of blanks
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0092' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUIEMA    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
     C                     Z-ADD*ZERO     WULINB           Last item numbe
      * Access Midas rundate - Standard functions  *
     C*   Access MIDAS Rundate from data-area RUNDAT
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT
     C                     MOVE RDNO      WURDNO
     C                     MOVE SUCP      WUSUCP
     C                     MOVE DTFF      WUDTFF
     C                     MOVE MBIN      WUMBIN
     C                     MOVEL'Y'       WUABPS           Abbreviated Pos
     C                     MOVEL'Y'       WUFKST           S01212
      * E17610 Start
      * Define 200 Byte Dummy DS - Standard functions  *
      * Define 800 Byte Dummy DS - Standard functions  *
      * Account Codes DS - Account Codes  *
      * Account Details DS - Standard functions  *
      * Declare Bank File DS - Standard functions  *
      * Client Details DS - Client Details  *
      * Currency Codes DS - Currency Codes  *
      * Narrative Codes DS - Narrative Codes  *
      * Nostro Details DS - Nostro Details  *
      * General Ledger Details DS - General Ledger Details  *
      * Access General Ledger. - General Ledger Details  *
     C*
     C*  Access General Ledger Details file for it' file fields
     C*
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*FIRST'  UUAPOP  7        I:Option
     C********** D@GELR    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@GELR    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELBKGNLG    WUGNLG           General Ledger
     C                     MOVELBKACCD    WUACCD           Account Code
     C                     MOVELBKPLAC    WUPLAC           Profit & Loss Account
     C                     MOVELBKCUST    WUCUST           Cutomer Number
     C                     MOVELBKBCTF    WUBCTF           Base Currency Tran
     C                     MOVELBKAKSI    WUAKSI           Accrual Key summary
     C                     MOVELBKAPDT    WUAPDT           Accruals Profit Date
     C                     MOVELBKAPFQ    WUAPFQ           Accruals Profit Freq
     C                     MOVELBKAPFD    WUAPFD           Accruals Profit Fr Dy
     C                     MOVELBKALDI    WUALDI           Accrue on Last Day
     C                     MOVELBKAPRP    WUAPRP           A/c Posting Ret Pd.
     C                     MOVELBKANWD    WUANWD           Accrual non-wk Day
     C                     MOVELBKSRRP    WUSRRP           Spot Rates Retention
     C                     MOVELBKBRRP    WUBRRP           Base Rates Retention
     C                     MOVELBKGLDI    WUGLDI           GL Description Ind
     C                     MOVELBKPRCU    WUPRCU           Profit Centres Used
     C                     MOVELBKPRCA    WUPRCA           Profit Centres Amend
     C                     MOVELBKPCDU    WUPCDU           Profit Centre Default
     C                     MOVELBKPMBK    WUPMBK           Prof C Matrix Book
     C                     MOVELBKPMTT    WUPMTT           Prof C Matrix Trans
     C                     MOVELBKPMST    WUPMST           Prof C Matrix SubType
     C                     MOVELBKPMBH    WUPMBH           Prof C Matrix Branch
     C                     MOVELBKPMDT    WUPMDT           Prof C Matrix Dept
     C                     MOVELBKPMUR    WUPMUR           Prof C Matrix User
     C                     MOVELBKPMAO    WUPMAO           Prof C Matrix Acc Off
     C                     MOVELBKPMCU    WUPMCU           Prof C Matrix Cust
     C                     MOVELBKOBRU    WUOBRU           Originating Branch Ud
     C                     MOVELBKOBUV    WUOBUV           Orig Branch/User Vald
     C                     MOVELBKJESP    WUJESP           Copy Special Char
     C                     MOVELBKELAP    WUELAP           End of Last Activity
     C                     MOVELBKECAP    WUECAP           End of Curnt Activity
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C                     MOVELBJLCCY    WULCCY
      * E17610 End
      * E17939 Start
      * RTV Last Batch Item - Standard functions  *
     C                     CALL 'GL0137U'              90  RTV Last Batch
     C                     PARM P1BTNB    WQ0013  3        Batch number
     C           WULINB    PARM *ZERO     WQ0014  30       Last item numbe
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * E17939 End
      * Start of Fix LN0312
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
      * Setup message data for message
      * Retrieve message Subfile Select Details
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0204' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUSFCC    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Set Screen Ftr Copy Char - Standard functions  *
     C* Move Copy Special Character Message into screen footer field
     C*                                                                   S01117
     C                     MOVELWUSFCC    ##CTX1
     C*
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVELWUJESP    ZA0086           JE Special Char
      * Retrieve message Copy Special Char Add Mod
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0222' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUSFCC    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Set Screen Ftr Copy Char - Standard functions  *
     C* Move Copy Special Character Message into screen footer field
     C*                                                                   S01117
     C                     MOVELWUSFCC    ##CTX1
     C*
     C                     END                             *FI
      * End of Fix LN0312
     C/COPY WNCPYSRC,GL0122MC18
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0122MIPG - Journal Entry Posting  *
     C                     END                             *FI
      *                                                                   CGL002
      ** Check if Block GL Accounts Enhancement feature is installed      CGL002
      *                                                                   CGL002
     C                     CALL 'AOSARDR0'                                CGL002
     C           WUAPRC    PARM WUAPRC    UUAPRC  7                       CGL002
     C                     PARM '*VERIFY' UUAPOP  7                       CGL002
     C                     PARM 'CGL002'  UUSARN  6                       CGL002
     C           D@SARD    PARM *BLANKS   UUFDY                           CGL002
      *                                                                   CGL002
     C           WUAPRC    IFEQ *BLANKS                                   CGL002
     C                     MOVE 'Y'       CGL002  1                       CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'N'       CGL002                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *                                                                   CGL008
     C           KCAUAC    KLIST                                          CGL008
     C**********           KFLD           WWACCD  40       Account Code                CGL008 CGL029
     C                     KFLD           WWACCD 100                                          CGL029
     C                     KFLD           WMUSRP           Reference USRP CGL008
      *                                                                   CGL008
      ** Check if CGL008 is installed                                     CGL008
      *                                                                   CGL008
     C                     CALL 'AOSARDR0'                                CGL008
     C                     PARM *BLANKS   PRTCD   7                       CGL008
     C                     PARM '*VERIFY' POPTN   7                       CGL008
     C                     PARM 'CGL008'  PSARD   6                       CGL008
      *                                                                   CGL008
     C           PRTCD     IFEQ *BLANKS                                   CGL008
     C                     MOVE 'Y'       CGL008  1                       CGL008
     C                     OPEN SFACAUL0                                  CGL008
     C                     OPEN MUSER                                     CGL008
      *                                                                   CGL008
      ** Check the User details extension to retrieve the journal entry   CGL008
      ** authorisation                                                    CGL008
      *                                                                   CGL008
     C           ##USR     CHAINMUSER                22                   CGL008
     C           *IN22     IFEQ *OFF                                      CGL008
      *                                                                   CGL008
      ** Verify the content of the 'Access to all account codes' field    CGL008
      *                                                                   CGL008
     C                     MOVE ALACOD    WMACOD  1                       CGL008
     C                     MOVE REFUSR    WMUSRP 10                       CGL008
     C                     ENDIF                                          CGL008
      *                                                                   CGL008
     C                     ELSE                                           CGL008
     C                     MOVE 'N'       CGL008                          CGL008
     C                     ENDIF                                          CGL008
      *================================================================
     CSR         ZZEXIT    ENDSR
     C/COPY WNCPYSRC,GL0122MC19
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
** CPY@
(c) Misys International Banking Systems Ltd. 2001
