     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Edit journal entry batch posting local')      *
      *****************************************************************
      *                                                               *
      *  Midas - General Ledger Module                                *
      *                                                               *
      *  GL0123R - Midas GL Edit JE Batch Posting Local               *
      *                                                               *
      *  Function:                                                    *
      *           - Maintain DBF file records, one at a time          *
      *           - Existing records may be updated or deleted        *
      *           - New records may be added                          *
      *           - Key changes are not allowed                       *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. EML102             Date 28Nov19               *
      *  Prev Amend No. CGL150             Date 13Jul18               *
      *                 CGL149             Date 13Jul18               *
      *                 CGL148             Date 13Jul18               *
      *                 MD046248           Date 27Oct17               *
      *                 CGL154             Date 13Oct14               *
      *                 LLN022A            Date 03Jun15               *
      *                 MD027587           Date 19Jun14               *
      *                 AR1093096          Date 30Sep13               *
      *                 AR782538           Date 03Jun11               *
      *                 AR792734A          Date 20Sep11               *
      *                 CAP207             Date 10Feb11               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG23742           Date 09May09               *
      *                 CER047             Date 19May08               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246418             Date 16Mar07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 237508             Date 23May06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CGL037             Date 14Jul04               *
      *                 LLN022             Date 24Jan05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA035             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 216088             Date 17Apr03               *
      *                 CGL013             Date 29Mar02               *
      *                 CGL016             Date 01Aug02               *
      * Midas Release 4.01.03 ----------------------------------------*
      * Midas Release 4.01.02 ----------------------------------------*
      *                 206317             Date 15Aug02               *
      *                 203566             Date 15May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 28Jun02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 179591             Date 14Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 176744             Date 22Sep00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CAP032             Date 26Apr99               *
      *                 CGL010             Date 08Nov99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01Mar99               *
      *                 CGL008             Date 04Mar99               *
      *                 CTI002             Date 23Sep98               *
      *                 132198             DATE 27Apr98               *
      *                 CEU013             DATE 09MAR98               *
      *                 128957             DATE 27FEB98               *
      *                 126299             DATE 27FEB98               *
      *                 095522             DATE 26FEB98               *
      *                 118976             DATE 20FEB98               *
      *                 104847             DATE 17FEB98               *
      *                 CGL002             Date 28OCT96               *
      *                 S01408             Date 04SEP96               *
      *                 100028             DATE 14MAY96               *
      *                 095580             DATE 22DEC95               *
      *                 085282             DATE 21JUN96               *
      *                 S01408             DATE 29APR96               *
      *        AMEND : 096664            DATE : 16APR96               *
      *        AMEND : 089856            DATE : 25OCT95               *
      *        AMEND : 088589            DATE : 23OCT95               *
      *        AMEND : 092723            DATE : 06SEP95               *
      *        AMEND : 084499            DATE : 19APR95               *
      *        AMEND : S01408            DATE : 12JAN95               *
      *        AMEND : S01408            DATE : 22AUG94               *
      *        AMEND : S01413            DATE : 27JUL93               *
      *        AMEND : 033001            DATE : 08FEB93               *
      *        AMEND : S10736            DATE : 09SEP92               *
      *        AMEND : E38270            DATE : 18JUN92               *
      *        AMEND : E24371            DATE : 13FEB92               *
      *        AMEND : E19779            DATE : 08JAN91               *
      *        AMEND : LN0358            DATE : 22JUN90               *
      *        AMEND : LN0312            DATE : 14JUN90               *
      *        AMEND : LN0334            DATE : 07JUN90               *
      *        AMEND : LN0315            DATE : 06JUN90               *
      *        AMEND : E20026            DATE : 10/11/89              *
      *        AMEND : E18852            DATE : 28/09/89              *
      *              : SAR017            DATE : 13/09/89              *
      *              : S01212            DATE : 11/09/89              *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  EML102 - Upgrade of UNL007 to FB2.1 SP21                     *
      *           UNL007 - Extended Narratives                        *
      *                Used GL0123RADU, GL0123RCAU, GL0123RCP1        *
      *                     GL0123RCP5, GL0123RCP6, GL0123RCP7        *
      *                     GL0123RCP8, GL0123RDAU, GL0123RDBU        *
      *                     GL0120GDTA                                *
      *                Added EML102_014                               *
      *  CGL150 - Value Date to Back Value Date if prior to the       *
      *           backvalue period                                    *
      *  CGL149 - Allow postings to be valued prior to the date       *
      *           account opened                                      *
      *  CGL148 - AUTOMATIC OPENING OF GL ACCOUNTS                    *
      *         - Includes fix MD024246, MD026357                     *
      *  MD046248 - Finastra Rebranding                               *
      *  CGL154 - FATCA Reporting (Recompile)                         *
      *  LLN022A - BOE Upgrade to MidasPlus - incorporate code from   *
      *            /COPY members and add switchability.               *
      *  MD027587 - Unable to used the C for Copy and T for Template  *
      *             (Recompile)                                       *
      *  AR1093096 - ABC - Reservations not removed for JRNE.         *
      *              (Child: AR1093097) (Recompile)                   *
      *  AR782538 - Misleading warning message issued when accnt is   *
      *             closed. Changed to more appropriate message       *
      *             (Child: AR782539)                                 *
      *  AR792734A - Projected Account movement show incorrect        *
      *              Available Balance when posting Cash Deposit.     *
      *              Used CGL016 codes to insert shadow postings      *
      *              when CRE023 is turned on (Child: AR792735A)      *
      *  CAP207 - Account Balance Check extended to other APIs        *
      *           (Recompile)                                         *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23742 - Improper handling of Ext Narr from Batch Interface*
      *             Input                                             *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  246418 - CGL013 changes for Midas Plus                       *
      *  237508 - Issue warning message if account is flagged for     *
      *           closure.                                            *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CGL037 - Account Access Security                             *
      *  LLN022 - BOE Upgrade to MidasPlus.                           *
      *           Inserted hooks : GL0123MK17                         *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  216088 - Check for cover on Group Account member debits      *
      *           Fixed as part of CRE008                             *
      *  CGL013 - MT94x Messages Generation                           *
      *  CGL016 - Projected Movements Update Prior to Authorisation   *
      *  206317 - Fix will ensure that closed accounts will not be    *
      *           allowed on journal entry.                           *
      *  203566 - Error resetting refer credit bit. Blank does not    *
      *           set off all the bits. Use BITOF instead.            *
      *  CPK015 - Release 4.01 Packaging:                             *
      *           - A default timestamp string is required for WRITE. *
      *  179591 - Amend program to allow a value date entry that      *
      *           falls on a holiday. Fix is to perform the same      *
      *           validation as in GL0121M. Applied fix 149195.       *
      *  176744 - If value date is blanked out, default it to the     *
      *           rundate.                                            *
      *  CAP032 - Conversion of Journal Batch Entry inputs into       *
      *           modular structure to use as APIs.                   *
      *  CGL010 - Future Value Dated Journal Entries for Non-Retail   *
      *           Accounts.                                           *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CGL008 - Security on Journal Entry                           *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
      *  132198 - Additional checks against Transaction Type DR/CR    *
      *           combinations USED ERROR FIX 124754                  *
      *  CEU013 - EMU Account Postings Narrative                      *
      *  128957 - Customer Name displaying previous value for *RETAIL *
      *           accounts as it is using #1CUST which is not correct.*
      *           Correct Nostro AND Shortname processing.            *
      *           Want to show the Customer and Account Name before   *
      *           record is added.                                    *
      *  126299 - Ensure cheque number correctly updated.             *
      *   095522 - BTBCBH NOT ALWAYS LOADED                           *
      *   118976 - Chech number not loaded when check on 'Stop check' *
      *  104847 - If value date blanked out for the retail account,   *
      *           send error message.                                 *
      *  CGL002 - Block GL Accounts in Journal Entry Input            *
      *  S01408 - HOOK GL0123RC15 ADDED.                              *
      *   100028 - Update Customer Originated flag correctly on       *
      *            posting - movel A1COIN to #1COIN after accessing   *
      *            Transaction Types file.                            *
      *   095580 - Validation problem when amending entries based on  *
      *            interface files, as the copy of the master file is *
      *            not updated when the master file is updated, so    *
      *            updates need to be done twice.  Fix is to move     *
      *            @1DBRC to 1#DBRC when master file is updated.      *
      *   085282 - On amending customer, batch re-displayed once too  *
      *            often.                                             *
      *   S01408 - HOOK GL0123RCP9 ADDED.                             *
      *            HOOK GL0123RC10 ADDED.                             *
      *            HOOK GL0123RC11 ADDED.                             *
      *            HOOK GL0123RC12 ADDED.                             *
      *            HOOK GL0123RC13 ADDED.                             *
      *            HOOK GL0123RC14 ADDED.                             *
      *   096664 - Value date not redisplay when amending a non retail*
      *            item                                               *
      *   089856 - Change to allow posting amount as 13N as specified *
      *            in Ins Manual.                                     *
      *   088589 - MONOBRANCH BATCH DEF. IS NOT CHECK DURING INPUT    *
      *            (DAILY JOURNAL OUT OF BALANCE |||)                 *
      *   092723 - Transaction Type should be blank for non-retail    *
      *            accounts.                                          *
      *          - Retail Indicators field should be initialised      *
      *            using BITOF instead of MOVE *BLANKS.               *
      *   084499 - Call AORETLR0 only if retail exists.               *
      *   S01408 - HOOK GL0123RCP5 ADDED.
      *            HOOK GL0123RCP6 ADDED.
      *            HOOK GL0123RCP7 ADDED.
      *            HOOK GL0123RCP8 ADDED.
      *   S01408 - HOOK GL0123RCP1 ADDED.
      *            HOOK GL0123RCP2 ADDED.
      *            HOOK GL0123RCP3 ADDED.
      *            HOOK GL0123RCP4 ADDED.
      *   S01413 - RETAIL 3 INCORPORATION:- NUMBER OF ITEMS AVAILABLE.*
      *   033001 - ADD COMMITMENT CONTROL FOR GLJENPHL0               *
      *   S10736 - MANAGEMENT ACCOUNTING                              *
      *   E38270 - DONOT DISPLAY BRANCH IF MBIN IS 'N'                *
      *   E24371 - CURSOR NOT BEING POSITIONED TO THE TOP OF THE      *
      *            SCREEN AFTER A SUCCESFUL ADD.  WRITE A DUMMY       *
      *            DETAIL FORMAT TO POSITION CURSOR.                  *
      *                                                               *
      *   E19779 - CALCULATE 'MAXIMUM FORWARD DATE'                   *
      *                                                               *
      *   LN0358 - Copy/Template not correctly working                *
      *                                                               *
      *   LN0312 - Change the footer text                             *
      *                                                               *
      *   LN0334 - Various Errors - ? in Account Code, Validation     *
      *            of amount, Branch Code displayed if MB Off, No     *
      *            field exit on last field.                          *
      *                                                               *
      *   LN0315 - ADDITION OF RETAIL INDICATORS ON CALL TO AOACCTR0  *
      *                                                               *
      *   E20026 - TO STOP DISPLAYING CUSTOMER REPORT NAME WHEN THE   *
      *            GL DESC. IND. ON PF/SDGELRPD = 'N', AND            *
      *          - EXTRACT BRANCH CODE FROM PF/ACCNTAB FOR THE A/C NO.*
      *            ENTERED AND VALIDATE FOR HAVING SAME BRANCH AS THAT*
      *            ENTERED VIA BATCH HEADER.                          *
      *                                                               *
      *   E18852 - TO STOP JOURNAL ENTRIES BEING POSTED ACROSS        *
      *            DIFFERENT BRANCHES                                 *
      *                                                               *
      *   SAR017 - TO DISPLAY THE CUSTOMER REPORT NAME AND THE        *
      *            ACCOUNT NAME ON BATCH ITEM INPUT SCREEN.           *
      *                                                               *
      *   S01212 - WINDOW PROCESSING BEING ALLOWED.                   *
      *                                                               *
      *   NB: FUNCTIONALLY THIS PROGRAM IS AN EXACT DUPLICATE OF THE  *
      *       MAIN JOURNAL ENTRY PROGRAM - GL0121M - EXCEPT THAT THIS *
      *       PROGRAM WILL ONLY PROCESS 1 RECORD AT A TIME SINCE IT   *
      *       IS AN EDIT (1 SCREEN) SYNON FUNCTION ) INSTEAD OF USING *
      *       A SUBFILE. THE SUBFILE PROGRAM GLAFEFR DOES NOT SUPPORT *
      *       WINDOW PROCESSING.                                      *
      *                                                               *
      *****************************************************************
      *                                                                   CGL008
     FMUSER   IF  E           K        DISK                           UC  CGL008
      ** RTV : Midas SF Midas Users                                       CGL008
      *                                                                   CGL008
     FSFACAUL0IF  E           K        DISK                           UC  CGL008
      ** RTV : Account Code/Authorities File By Account Code              CGL008
      *                                                                   CGL008
     F/COPY WNCPYSRC,GL0123RFPG
     FGL0123R#CF  E                    WORKSTN
     F                                              KINFDS INFDS#
      * DSP: Midas GL Edit JE Batch Posting Local
      *
     FGLJENPL1IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RTV : Midas GL Journal Entry Posting Rtv
      *
     FGLJENHL1IF  E           K        DISK
      * RTV : Midas GL Journal Entry Header LF Rtv
      *
     FGLJENPL0UF  E           K        DISK                      A
     F                                              KCOMIT
      * UPD : Midas GL Journal Entry Posting Update
      *
     FGLJENXL2IF  E           K        DISK         KINFSR *PSSR                              CGL013
      ** RTV: Midas GL Journal Entry File - Additional Information                            CGL013
      *                                                                                       CGL013
     FGLJENXL3UF  E           K        DISK         KINFSR *PSSR                              CGL013
     F            GLJENXD0                          KRENAME@LJENXD0                           CGL013
      ** UPD: Midas GL Journal Entry File - Additional Information                            CGL013
      *                                                                                       CGL013
     F/COPY WNCPYSRC,GL0123RF01
      *                                                                                     BUG23742
      ** Midas GL MultiCash Narratives File - Rtv Indx                                      BUG23742
      *                                                                                     BUG23742
     FGLMNARL3IF  E           K        DISK         KINFSR *PSSR                            BUG23742
      *                                                                                     BUG23742
      ** Midas GL MultiCash Narratives File - by Batch Number & Item                        BUG23742
      *                                                                                     BUG23742
     FGLMNARL2UF  E           K        DISK         KINFSR *PSSR                            BUG23742
     F            GLMNARD0                          KRENAMEGLMNARD4                         BUG23742
      *                                                                                     BUG23742
     E*   Set up function Key text for Edit 1 record Journal Entry
     E                    CTX2    1   2 78
     E/COPY WNCPYSRC,GL0123RE01
      *
     E                    @IE     1   2 76               Item Err.Msgs.
     E                    @IH         8  9               Item Err.slots
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
     E                    CPY@    1   1 80               Copyright     array
     E/COPY WNCPYSRC,GL0123REPG
      *                                                                                       246418
      * Parameters for pass to GL000185                                                       246418
     E                    FLDNMA     75 10                                                    246418
     E                    MSGIDA     75  7                                                    246418
     E                    MSGDTA     75 45                                                    246418
      *                                                                                       246418
     I*****P@BJRF    E DSSDBANKPD                                         S01117
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE                       S01117
     I*                                                                   S01117
     I*
     I*****P@ACCT    E DSACCNTAB
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     I*   Define MIDAS Rundate from data-area RUNDAT
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I/COPY QWINDSRC,GL0120GDTA
     I/COPY WNCPYSRC,GL0123RIPG
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSGLJENPL0
      * UPD : Midas GL Journal Entry Posting Update
      * Current/previous master file format fields for change control
      *
     I**#1DBRC      DS                            164                     CEU013
     I***#1DBRC**    DS                            175             CEU013 CAP032
     I***#1DBRC**    DS                            242                       CAP032         BUG23742
     I#1DBRC      DS                            250                                         BUG23742
      * Stored master file format fields
     I                                        1   1 #1DB1
      *
     I            DS
      * Determine Account identity
     I                                        1  10 UKACID
     I                                        1   6 UKACF6
     I                                        1   3 UKACF3
     I                                        1   1 UKACF1
     I                                        1   1 UKACA1
     I                                        2   2 UKACA2
     I                                        3   3 UKACA3
     I                                        4   5 UKACM2
     I                                        6  10 UKACL5
     I                                        7  10 UKACL4
      * Set up parameters :
     I            DS
     I                                        1   60UUDNMA
     IGLREOV      DS
      * Retail Override data area data structure
     I                                        1   1 URRE01
     I                                        2   2 URRE02
     I                                        3   3 URRE03
     I                                        4   4 URRE04
     I                                        5   5 URRE05
     I                                        6   6 URRE06
     I                                        7   7 URRE07
     I                                        8   8 URRE08
     I                                        9   9 URRE09
     I                                       10  10 URRE10
      *
     I            DS
      * Item error status data structure
     I                                        1 152 @IE
     I                                        1  76 URERMG
     I                                       77 152 URDASH
     I                                        5  76 @IH
     I                                        5  76 URIESL
     I                                        5   5 URHL01
     I                                       14  14 URHL02
     I                                       23  23 URHL03
     I                                       32  32 URHL04
     I                                       41  41 URHL05
     I                                       50  50 URHL06
     I                                       59  59 URHL07
     I                                       68  68 URHL08
     IWURARC      DS
     I                                        1   1 WURSRD
     I                                        2   2 WURSRC
     I                                        3   3 WURSBD
     I                                        4   4 WURSBC
     I                                        5   5 WURSIN
     I                                        6   6 WUDBST
     I                                        7   7 WURSBR
     I                                        8   8 WURTSB
     I                                        9   9 WURSSC
     I                                       10  10 WUFMST
      *
     I            DS
     I                                        1   60UUDNUM
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNO
     I                                       11  11 SUCP
     I                                       12  12 DTFF
     I                                       13  13 MBIN
      *                                                                                       216088
      ** DS for message data for overdraft limit check                                        216088
      *                                                                                       216088
     IWOLTXT      DS                                                                          216088
     I                                        1  18 WMDTA1                                    216088
     I                                        1  29 WMDTA2                                    216088
     I                                        1   3 WBRCDE                                    216088
     I                                        4   4 WDASH1                                    216088
     I                                        5  10 WCUSTN                                    216088
     I                                       11  11 WDASH2                                    216088
     I                                       12  15 WACOD                                     216088
     I                                       16  16 WDASH3                                    216088
     I                                       17  18 WACSQ                                     216088
     I                                       19  19 WSLSH                                     216088
     I                                       20  29 WRETN                                     216088
     I*
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
     IUUFDY     E DSDSFDY
     I*
     I* 200 Byte Data Structure for Incoming Data from Access Program
     I*
     IUUSDY     E DSDSSDY
     I*
     I* 800 Byte Data Structure for Incoming Data from Access Program
     I*
     ID@ACOD    E DSSDACODPD
     I*
     I*  Account Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@ACCT    E DSACCNTAB
     I*
     I*  Account Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     IP@BJRF    E DSSDBANKPD
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     ID@BRCH    E DSSDBRCHPD
     I*
     I*  Branch Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@CUST    E DSSDCUSTPD
     I              QQDFAC                          DFACQQ                                    CGL029
     I*
     I*  Client Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@CURR    E DSSDCURRPD
     I*
     I*  Currency Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@BOOK    E DSSDBOOKPD
     I*
     I*  Book Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@GELR    E DSSDGELRPD
     I              QQACCD                          QQACD1                                    CGL029
     I*
     I*  General Ledger Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@MMOD    E DSSDMMODPD
     I*
     I*  Midas Modules DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@NARR    E DSSDNARRPD
     I*
     I*  Narrative Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@RETR    E DSSDRETRPD
     I*
     I*  Retail Transaction Types DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@PRFM    E DSSDPRFMPD
     I*
     I*  Profit Centre Def Matrix DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@PRFC    E DSSDPRFCPD
     I*
     I*  Profit Centre DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@RETL    E DSSDRETLPD
     I              QQACCD                          QQACD2                                    CGL029
     I*
     I*  Retail Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     I/COPY WNCPYSRC,GL0123RI02
     ID@SARD    E DSSCSARDPD                                              CGL002
     I*                                                                   CGL002
     I*  Switchable Features DS                                           CGL002
     I              LCD                             LCDX                  CGL002
     I*                                                                   CGL002
      /EJECT
      * Parameter declarations
     IP1PARM      DS                              5
      * KEY: Midas GL Journal Entry Posting Rtv
      * I : MAP Batch number
     I                                        1   3 P1BTNB
      * I : MAP Batch item no.
     I                                    P   4   50P1BINB
     IP2PARM      DS
      * FLD: Journal Entry Header
      * I : MAP Branch Code - Alpha
     I                                        1   3 P2BCDA
      * I : MAP Dept Code
     I                                        4   6 P2DPCD
      * I : MAP Hash item no.calculated
     I                                    P   7   80P2HINC
      * I : MAP Multiple Branch Batch
     I                                        9   9 P2MBRB
     IP3PARM      DS
      * I :  Branch Internal Customer
     I                                        1   6 P3BICN
     IP4PARM      DS
      * I :  Batch Item To Copy
     I                                    P   1   20P4BITC
     IP5PARM      DS
      * I :  Batch Item To Template
     I                                    P   1   20P5BITT
     IP6PARM      DS
      * I :  Action Code
     I                                        1   1 P6ACTC
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Currency Code not found'
      * Currency code
     I                                        1   3 ZA0001
      * Message data for 'Currency Code Required'
      * Currency code
     I                                        1   3 ZA0002
      * Message data for 'Account Code not found'
      * Account code
     I**********                              1   4 ZA0003                                    CGL029
     I                                        1  10 ZA0003                                    CGL029
      * Message data for 'Account Code Required'
      * Account code
     I**********                              1   4 ZA0004                                    CGL029
     I                                        1  10 ZA0004                                    CGL029
      * Message data for 'Ac Sequence Not Blank'
      * Account sequence number
     I                                        1   2 ZA0005
      * Message data for 'Ac Seq Number Required'
      * Account sequence number
     I                                        1   2 ZA0006
      * Message data for 'Branch Code not found'
      * Branch code
     I                                        1   3 ZA0007
      * Message data for 'Debit/Credit must be Y/N'
      * Debit/credit indicator
     I                                        1   1 ZA0008
      * Message data for 'Book Codes Not Found.'
      * Book Code
     I                                        1   2 ZA0009
      * Message data for 'Reverse/Void  is invalid'
      * Reverse/Void Indicator
     I                                        1   1 ZA0010
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0011
      * Currency code
     I                                       11  13 ZA0012
      * Account code
     I**********                             14  17 ZA0013                                    CGL029
     I                                       14  23 ZA0013                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0014                                    CGL029
     I                                       24  25 ZA0014                                    CGL029
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0015
      * Currency code
     I                                       11  13 ZA0016
      * Account code
     I**********                             14  17 ZA0017                                    CGL029
     I                                       14  23 ZA0017                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0018                                    CGL029
     I                                       24  25 ZA0018                                    CGL029
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0019
      * JE Special Character
     I                                       26  26 ZA0020
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0021
      * JE Special Character
     I                                       26  26 ZA0022
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0023
      * JE Special Character
     I                                       26  26 ZA0024
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0025
      * JE Special Character
     I                                       26  26 ZA0026
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0027
      * JE Special Character
     I                                       26  26 ZA0028
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0029
      * JE Special Character
     I                                       26  26 ZA0030
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0031
      * JE Special Character
     I                                       26  26 ZA0032
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0033
      * JE Special Character
     I                                       26  26 ZA0034
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0035
      * JE Special Character
     I                                       26  26 ZA0036
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0037
      * JE Special Character
     I                                       26  26 ZA0038
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0039
      * JE Special Character
     I                                       26  26 ZA0040
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0041
      * JE Special Character
     I                                       26  26 ZA0042
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0043
      * JE Special Character
     I                                       26  26 ZA0044
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0045
      * JE Special Character
     I                                       26  26 ZA0046
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0047
      * JE Special Character
     I                                       26  26 ZA0048
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0049
      * JE Special Character
     I                                       26  26 ZA0050
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0051
      * JE Special Character
     I                                       26  26 ZA0052
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0053
      * JE Special Character
     I                                       26  26 ZA0054
      * Message data for 'Currency Code not found'
      * Currency code
     I                                        1   3 ZA0055
      * Message data for 'Currency Code Required'
      * Currency code
     I                                        1   3 ZA0056
      * Message data for 'Account Code not found'
      * Account code
     I**********                              1   4 ZA0057                                    CGL029
     I                                        1  10 ZA0057                                    CGL029
      * Message data for 'Account Code Required'
      * Account code
     I**********                              1   4 ZA0058                                    CGL029
     I                                        1  10 ZA0058                                    CGL029
      * Message data for 'Ac Sequence Not Blank'
      * Account sequence number
     I                                        1   2 ZA0059
      * Message data for 'Ac Seq Number Required'
      * Account sequence number
     I                                        1   2 ZA0060
      * Message data for 'Branch Code not found'
      * Branch code
     I                                        1   3 ZA0061
      * Message data for 'Debit/Credit must be Y/N'
      * Debit/credit indicator
     I                                        1   1 ZA0062
      * Message data for 'Book Codes Not Found.'
      * Book Code
     I                                        1   2 ZA0063
      * Message data for 'Reverse/Void  is invalid'
      * Reverse/Void Indicator
     I                                        1   1 ZA0064
      * Message data for 'Customer not found'
      * Account Identifier
     I                                        1  10 ZA0065
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0066
      * Message data for 'Nostro/Cust Shortname NF'
      * Account Identifier
     I                                        1  10 ZA0067
      * Message data for 'Account ID not valid ERR'
      * Account Identifier
     I                                        1  10 ZA0068
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0069
      * Currency code
     I                                       11  13 ZA0070
      * Account code
     I**********                             14  17 ZA0071                                    CGL029
     I                                       14  23 ZA0071                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0072                                    CGL029
     I                                       24  25 ZA0072                                    CGL029
      * Message data for 'Account is Closed'
      * Account Identifier
     I                                        1  10 ZA0073
      * Currency code
     I                                       11  13 ZA0074
      * Account code
     I**********                             14  17 ZA0075                                    CGL029
     I                                       14  23 ZA0075                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0076                                    CGL029
     I                                       24  25 ZA0076                                    CGL029
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0077
      * Currency code
     I                                       11  13 ZA0078
      * Account code
     I**********                             14  17 ZA0079                                    CGL029
     I                                       14  23 ZA0079                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0080                                    CGL029
     I                                       24  25 ZA0080                                    CGL029
      * Message data for 'Amount not valid'
      * Formatted Posting amount
     I                                        1  14 ZA0081
      * Message data for 'Amount not valid'
      * Formatted Posting amount
     I                                        1  14 ZA0082
      * Message data for 'No Narrative entered'
      * Narrative
     I                                        1  30 ZA0083
      * Message data for 'Narrative Code not found'
      * Narrative
     I                                        1  30 ZA0084
      * Message data for 'Trans. type not valid'
      * Transaction type
     I                                        1   5 ZA0085
      * Message data for 'Must enter Trans Type'
      * Transaction type
     I                                        1   5 ZA0086
      * Message data for 'Cheque Number Numeric'
      * Cheque number
     I                                        1   8 ZA0087
      * Message data for 'Stopped Cheque'
      * Cheque number
     I                                        1   8 ZA0088
      * Message data for 'Lots of blanks'
      * Message data for 'Can't O'ride Retail error'
      * Account Identifier
     I                                        1  10 ZA0089
      * Currency code
     I                                       11  13 ZA0090
      * Account code
     I**********                             14  17 ZA0091                                    CGL029
     I                                       14  23 ZA0091                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0092                                    CGL029
     I                                       24  25 ZA0092                                    CGL029
      * Message data for 'Retail Error Req's Overde'
      * Retail ind.: Override
     I                                        1   1 ZA0093
      * Message data for 'Retail Override Invalid'
      * Retail ind.: Override
     I                                        1   1 ZA0094
      * Message data for 'Value Date not valid 1'
      * Value date (display)
     I                                        1   6 ZA0095
      * Message data for 'Value Date not valid 2'
      * Value date (display)
     I                                        1   6 ZA0096
      * Message data for 'Value Date not valid 3'
      * Value date (display)
     I                                        1   6 ZA0097
      * Message data for 'Value Date Not Valid 9'
      * Value date (display)
     I                                        1   6 ZA0098
      * Message data for 'Value Date not valid 4'
      * Value date (display)
     I                                        1   6 ZA0099
      * Message data for 'Value Date not valid 5'
      * Value date (display)
     I                                        1   6 ZA0100
      * Message data for 'Value Date Not Valid 6'
      * Value date (display)
     I                                        1   6 ZA0101
      * Message data for 'Value Date Not Valid 7'
      * Value date (display)
     I                                        1   6 ZA0102
      * Message data for 'Value Date Not Valid 8'
      * Value date (display)
     I                                        1   6 ZA0103
      * Message data for 'Lots of blanks'
      * Message data for 'Cheque No. must be blank'
      * Cheque number
     I                                        1   8 ZA0104
      * Message data for 'Value Date not valid 1'
      * Value date (display)
     I                                        1   6 ZA0105
      * Message data for 'Value Date not valid 2'
      * Value date (display)
     I                                        1   6 ZA0106
      * Message data for 'Value Date Must <= Today'
      * Value date (display)
     I                                        1   6 ZA0107
      * Message data for 'Value Date not valid 4'
      * Value date (display)
     I                                        1   6 ZA0108
      * Message data for 'Value Date not valid 5'
      * Value date (display)
     I                                        1   6 ZA0109
      * Message data for 'Assoc.Cust.No/Shortname 1'
      * Associated Cust - Display
     I                                        1  10 ZA0110
      * Message data for 'Profit Centres         NF'
      * Profit centre
     I                                        1   4 ZA0111
      * Message data for 'Def Prof Centre Not Found'
      * Profit centre
     I                                        1   4 ZA0112
      * Message data for 'SPF Atn Cde ERR 1 ZVACTBU'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0113
      * Message data for 'SPF Atn Cde ERR 5 ZVACTBU'
      * SPF Action Code
     I                                        1   1 ZA0114
      * Branch Code - Alpha
     I                                        2   4 ZA0115
      * Message data for 'Number of Items invalid'
      * Number of items - display
     I                                        1   5 ZA0116
      * Message data for 'Number of Items invalid'
      * Number of items - display
     I                                        1   5 ZA0117
      * Message data for 'Lots of blanks'
      * Message data for 'Copy Special Char Add Mod'
      * JE Special Character
     I                                        1   1 ZA0118
      * Message data for 'Copy function not valid'                        CEU013
      * *Copy Error Field                                                 CEU013
     I                                        1  25 ZA0119                CEU013
      * JE Special Character                                              CEU013
     I                                       26  26 ZA0120                CEU013
      * Message data for 'Copy function not valid'                        CEU013
      * *Copy Error Field                                                 CEU013
     I                                        1  25 ZA0121                CEU013
      * JE Special Character                                              CEU013
     I                                       26  26 ZA0122                CEU013
      * Message data for 'Original currency invalid'                      CEU013
      * Original currency code                                            CEU013
     I                                        1   3 ZA0123                CEU013
      * Message data for 'Original amount invalid'                        CEU013
      * Original amount                                                   CEU013
     I                                        1  16 ZA0124                CEU013
      * Called program EU0200 in error                                    CEU013
     I                                        1  10 ZA0125                CEU013
      *                                                                   179591
      ** Message data for 'Warning: Date entered: &1 is a Holiday in      179591
      ** &2/&3'                                                           179591
      *                                                                   179591
     I                                        1   6 ZA0144                179591
     I                                        7   9 ZA0145                179591
     I                                       10  12 ZA0146                179591
     I/COPY WNCPYSRC,GL0123RI01
     I*                                                                   128957
     ID@NOST    E DSSDNOSTPD                                              128957
     I              QQACCD                          QQACD3                                    CGL029
     I*                                                                   128957
     I*  Nostro Details DS for assigning data from Access                 128957
     I*  Programs to work fields                                          128957
     I*                                                                   128957
     ILDA       E DSLDA                         256                                           CGL013
     I              SPARE                           WSPARE                                    CGL013
      ** Local Data Area for Database Error Details                                           CGL013
      *                                                                                       CGL013
     I            DS                                                                          CGL013
     I**********                              1 108 PDETLS                           CGL013 BUG23742
     I                                        1 119 PDETLS                                  BUG23742
     I                                        1   3 PABTNB                                    CGL013
     I                                        4   6 PABINB                                    CGL013
     I                                        7   9 #1BCBH                                    CGL013
     I                                       10  15 #1CUST                                    CGL013
     I                                       16  18 #1CYCD                                    CGL013
     I**********                             19  22 #1ACCD                             CGL013 CGL029
     I                                       19  22 #1ACQQ                                    CGL029
     I                                       23  24 #1ACSN                                    CGL013
     I                                       25  34 PARACN                                    CGL013
     I                                       35  48 #DFMPA                                    CGL013
     I                                       49  49 #1DCIN                                    CGL013
     I                                       50  79 #DNRTV                                    CGL013
     I                                       80  85 #DVDDS                                    CGL013
     I                                       86  90 #1TRTY                                    CGL013
     I                                       91 100 #1TSTY                                    CGL013
     I                                      101 108 #1CQNB                                    CGL013
     I                                      109 118 #1ACCD                                    CGL029
     I                                      119 119 PEDIT                                   BUG23742
      ** Parameter Passed to GL000185                                                         CGL013
      *                                                                                       CGL013
      **  Valid JE Item (DS) for passing to GL000185                                          246418
     IPVBIPX    E DSGLVBIPXPD                                                                 246418
      *                                                                                       246418
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           KEY: Journal En
     C           P2BCDA    PARM           WP0001  3        Branch Code - A
     C           P2DPCD    PARM           WP0002  3        Dept Code
     C           P2HINC    PARM           WP0003  30       Hash item no.ca
     C           P2MBRB    PARM           WP0004  1        Multiple Branch
     C           P3BICN    PARM           WP0005  6        Branch Internal
     C           P4BITC    PARM           WP0006  30       Batch Item To C
     C           P5BITT    PARM           WP0007  30       Batch Item To T
     C           P6ACTC    PARM           WP0008  1        Action Code
     C                     PARM           WP0009  1        Interface Jrnl CEU013
      *****************************************************************
      * Initialise
     C                     EXSR ZZINIT
      *
      * Check passed parameters
     C                     EXSR FACKPM
      * Perform once if all passed, else repeat
     C           W0RPT     DOUEQ'N'
      * Display and process key screen
     C                     EXSR BADSKY
     C                     END
      * Terminate program
     C                     EXSR ZXEXPG
      *****************************************************************
      /EJECT
     CSR         BADSKY    BEGSR
      *================================================================
      * Display and process key screen
      *================================================================
      * Initialise key screen
     C                     EXSR MDIZ#K
      * Bypass first display of key screen is possible
     C                     MOVEL'Y'       W0BYP   1
      * Signal start of transaction
     C                     MOVEL'Y'       W0TRN   1
     C           W0TRN     DOWEQ'Y'
     C           W0TRN     OREQ 'K'
      * Ensure transaction continues (if reset)
     C                     MOVEL'Y'       W0TRN   1
      * Initialise detail screen
     C                     EXSR MAIZ#1
      * Conduct screen conversation
     C           W0TRN     DOWEQ'Y'
      * Is bypass key screen still viable?
     C           W0BYP     IFEQ 'Y'
     C           #1BTNB    IFEQ *BLANK                     Batch number
     C           #1BINB    OREQ *ZERO                      Batch item no.
      * One or more key fields is blank
     C                     MOVEL'N'       W0BYP
     C                     END
     C                     END
      * Bypass key screen
     C           W0BYP     IFNE 'Y'
      * Display key screen
     C                     EXSR BBEXFM
     C                     END
      * Cancel key screen bypass
     C                     MOVEL'N'       W0BYP
      * Process response to key screen
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * Switch between *ADD/*CHANGE modes
     C   09                CAS            BCCHMD
      * HOME: Reset screen fields
     C   05                CAS            BDHMKY
      * Process key screen input
     C                     CAS            BEPRKY
     C                     END
     C           W0TRN     DOWEQ'R'
     C                     MOVEL'Y'       W0TRN
     C                     EXSR BEPRKY
     C                     END
      *
     C                     END
     C                     END
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBEXFM    BEGSR
      *================================================================
      * Display key screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GADSAK
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                         86*
     C           *IN89     IFNE BBIN89
     C                     SETOF                         86*
     C                     END
     C                     MOVE *IN89     BBIN89  1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#RCDKEY
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
     C*                                                                   CEU013
     C* If the warning was already displayed and there was no other       CEU013
     C*   error, set up a Skip work field to control the display of       CEU013
     C*   warning for the second time in the absence of any other         CEU013
     C*   error.                                                          CEU013
     C*                                                                   CEU013
     C                     MOVE *BLANK    WKSKIP                          CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WWFLG     ANDEQ'Y'                                       CEU013
     C           WERRF     ANDNE'Y'                                       CEU013
     C                     MOVE 'Y'       WKSKIP                          CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE *BLANK    WWFLG                           CEU013
     C                     MOVE *BLANK    WERRF                           CEU013
     C*                                                                   CEU013
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1
      * Reset global error indicator
     C                     SETOF                         99*
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         BCCHMD    BEGSR
      *================================================================
      * Switch between *ADD/*CHANGE modes
      *================================================================
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'CHG'     W0PMD   3
     C                     ELSE
     C                     MOVEL'ADD'     W0PMD
     C                     END
      *================================================================
     CSR         BCEXIT    ENDSR
      /EJECT
     CSR         BDHMKY    BEGSR
      *================================================================
      * Process HOME key
      *================================================================
     C                     MOVEL'N'       W0TRN
      *================================================================
     CSR         BDEXIT    ENDSR
      /EJECT
     CSR         BEPRKY    BEGSR
      *================================================================
      * Process key screen input
      *================================================================
      * Validate key fields
     C                     EXSR BFVLKY
     C           *IN99     CABEQ'1'       BEEXIT
      * Check for existing record
     C           KRTV      KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      *                                                                                     BUG23742
     C           KRTV1     KLIST                                                            BUG23742
     C                     KFLD           BTPTDT                                            BUG23742
     C                     KFLD           BTBTNB                                            BUG23742
     C                     KFLD           BTBINB                                            BUG23742
      *                                                                                     BUG23742
      * Setup key
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
     C           KRTV      CHAIN@BTREAL              9091  *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     SETON                     993132*
     C                     GOTO BEEXIT
     C                     END                             FI 91
      *
      * Verify record existence against program mode
     C           W0PMD     IFNE 'ADD'
      * If record does not exist, error
     C           *IN90     IFEQ '1'
     C                     SETON                     993132*
      * Send message 'Journal Entry Posting  NF'
     C                     MOVEL'GLX0176' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     EXSR MBFL#1
      * CALC: Detail screen function fields
      * CASE: RCD.Retail Number Entered is Retail Account                 CEU013
     C* If the screen field is not filled, the account identifier         CEU013
     C*  validation is resulting in error.                                CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           #1RNBE    IFEQ 'Y'                        *IF            CEU013
     C                     MOVEL#1RACN    #DACID           Account IdentifCEU013
     C                     ELSE                                           CEU013
     C*                                                                   CEU013
     C           BTACTY    IFEQ 'N'                                       CEU013
     C                     MOVELBTCYCD    UXNOST                          CEU013
     C                     MOVE BTNNBI    UXNOST                          CEU013
     C                     MOVEL*BLANK    #DACID           Account IdentifCEU013
     C                     MOVELUXNOST    #DACID           Account IdentifCEU013
     C                     ELSE                                           CEU013
      *                                                                   CEU013
     C                     MOVEL*BLANK    #DACID           Account IdentifCEU013
     C                     MOVELBTCUST    #DACID           Account IdentifCEU013
     C                     END                             *FI            CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      * Account Identifier validation
     C                     EXSR UASUBR                     Account Identif
      * Currency Code Validation
      * CASE: DTL.Currency code is Not blank
     C           #1CYCD    IFNE *BLANK                     *IF
      * CASE: DTL.Currency code is Select Requested
     C           #1CYCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVE *BLANKS   WUINCY           'In' Currency  CEU013
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C                     MOVELA6INCY    WUINCY           'In' Currency  CEU013
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL'N'       WUACIC           Account Identif
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0001           Currency code
      * Send message 'Currency Code not found'
     C                     MOVEL'GLX0048' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Account ID Status Flag is Customer No or short name
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
     C                     MOVEL'N'       WUACIC           Account Identif
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0002           Currency code
      * Send message 'Currency Code Required'
     C                     MOVEL'GLX0123' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Account Code Validation
     C                     EXSR UBSUBR                     Account Code Va
      * Account Sequence Validation
     C                     EXSR UCSUBR                     Account Sequenc
      * Branch Code Validation
     C                     EXSR UDSUBR                     Branch Code Val
      * debit/credit indicator validation
      * CASE: DTL.Debit/credit indicator is Valid Values
     C           #1DCIN    IFEQ 'C'                        *IF
     C           #1DCIN    OREQ 'D'
     C                     ELSE
      * CASE: DTL.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1DCIN    ZA0008           Debit/credit in
      * Send message 'Debit/Credit must be Y/N'
     C                     MOVEL'GLX0207' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9937  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Start of S10736
      * Book Code Validation
      * CASE: DTL.Book Code is Entered
     C           #1BKCD    IFNE *BLANK                     *IF
      * CASE: DTL.Book Code is Select requested
     C           #1BKCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Book Codes - Book Codes  *
     C*
     C*  Access Book Codes for the file fields
     C*
     C                     MOVEL#1BKCD    UUBKCD
     C                     CALL 'AOBOOKR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBKCD  2        I:Book Code
     C           D@BOOK    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVE BDBKCD    WUBKCD
     C                     MOVE BDBKD     WUBKD
     C                     MOVE BDHGIN    WUHGIN
     C                     MOVE BDACIN    WUACIN
     C                     MOVE BDBKCC    WUBKCC
     C                     MOVE BDSTAM    WUSTAM
     C                     MOVE BDSTRM    WUSTRM
     C                     MOVE BDSTEP    WUSTEP
     C                     MOVE BDIACK    WUIACK
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1BKCD    ZA0009           Book Code
      * Send message 'Book Codes Not Found.'
     C                     MOVEL'GLX0240' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9948  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUBKCD    #1BKCD           Book Code
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC38
     C                     END                             *FI
      * Reversal/Void indicator validation
      * CASE: DTL.Reverse/Void Indicator is valid
     C           #1RVDI    IFEQ *BLANK                     *IF
     C           #1RVDI    OREQ 'Y'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1RVDI    ZA0010           Reverse/Void In
      * Send message 'Reverse/Void  is invalid'
     C                     MOVEL'GLX0237' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9938  *
      *
     C                     END                             *FI
      * End of S10736
      * Validate Customer report name & Account name
     C                     EXSR UESUBR                     Validate Custom
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RSFF - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RSFF
     C*00/Copy Member GL0123R   Calc Detail Function Flds
     C                     END                             *FI
      * USER: Initialise detail screen (existing record)
      * Set up CMD Key Text CTX2 - Journal Entry Posting  *
     C*   Set up function Key text for Edit 1 record Journal Entry
     C           P6ACTC    IFEQ 'D'
     C                     MOVEACTX2,1    ##CTX2
     C                     ELSE
     C/COPY WNCPYSRC,GL0123RC70
     C                     MOVEACTX2,2    ##CTX2
     C/COPY WNCPYSRC,GL0123RC71
     C                     END
      *
     C                     MOVELBTRARC    WURARC           Retail Ac Refer
      * Setup Override Err Msg - Standard functions  *
      *
     C                     EXSR CHKOVR                     Check Retail
      *
     C                     MOVELURERTX    #DIEMG           Error message
      *
      *==================================================================
      *
      * Init Existing Record
      * Set UP Account Identifier
      * CASE: PAR.Retail Number Entered is Retail Account
     C           #1RNBE    IFEQ 'Y'                        *IF
     C                     MOVEL#1RACN    #DACID           Account Identif
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DACID           Account Identif
     C                     MOVEL#1CUST    #DACID           Account Identif
     C                     END                             *FI
      * Set UP Narrative
      * CASE: PAR.Narrative code is Narrative code
     C           #1NVCD    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    #DNRTV           Narrative
     C                     MOVEL#1NVCD    #DNRTV           Narrative
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#1NRDC    #DNRTV           Narrative
     C                     END                             *FI
     C                     MOVEL*BLANK    #DASCD           Associated Cust
     C                     MOVEL#1ACNB    #DASCD           Associated Cust
     C*                                                                   CEU013
     C* Save the screen values for the comparison.                        CEU013
     C*                                                                   CEU013
     C                     MOVE #DACID    #1SVAI           Save acc identiCEU013
     C                     MOVEL#1CYCD    #1SVCY           Currency  save CEU013
     C                     MOVEL#1ACCD    #1SVAC           Acc code  save CEU013
     C                     MOVEL#1ACSN    #1SVCS           Acc seq no. savCEU013
     C                     MOVEL#1IBCA    #1SVBC           Input BranchsavCEU013
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    #1CYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * Format amount (short) - Standard functions  *
     C                     Z-ADD#1PTAM    ULVALU           Value
      *
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALU 150       I:Value
     C                     PARM WUNBDP    ULDECP  10       I:Decimal place
     C***********          PARM 'L'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM '3'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLF 23        O:Formatted
      *
     C                     MOVE ULRSLF    #DFMPA           Formatted data
      *
      *     E18852  - Branch Code Of trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL*BLANK    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C/COPY WNCPYSRC,GL0123RC43
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO 10                                           CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0123RC44
     C*
     C* Assign work field to file field values.
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C           #1ACCD    IFNE *BLANKS                                   CEU013
     C                     MOVELA5ACTY    WUACTY           Account Type   CEU013
     C                     ELSE                                           CEU013
     C                     MOVEL#1ACTY    WUACTY           Account Type   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVEL*BLANKS   WUBPST           Account Sub-TypCEU013
     C                     MOVEL*BLANKS   WUACCS           Account Status CEU013
     C                     MOVE *ZEROS    WUDACO           Date Account OpCEU013
     C                     MOVEL*BLANKS   WUACNM           Account Name   CEU013
     C                     MOVEL#1RACN    WURACN           Retails AccountCEU013
     C                     MOVE *ZEROS    WURRNM           Relative rec NoCEU013
     C**********           MOVEL*BLANK    WURETB           Retail Indic'tr             CEU013 203566
     C                     BITOF'01234567'WURETB                                              203566
     C                     ELSE                                           CEU013
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     ENDIF                                          CEU013
     C*
      * End of Fix LN0315
     C/COPY WNCPYSRC,GL0123RC01
      * CASE: WRK.Access Pgm Return Code is *No Errors
     C           WUAPRC    IFEQ *BLANK                     *IF
     C*                                                                   CEU013
     C* If CEU013 switchable function is installed, the batch is from     CEU013
     C*   external interface, account type is Retail or Nostro,           CEU013
     C*   the currency is an 'In' currency, then the account not found    CEU013
     C*   is not an error.  The processing is continued                   CEU013
     C*                                                                   CEU013
     C           WUAPRC    ORNE *BLANKS                                   CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           WUAISF    ANDEQ'*RETAIL'                                 CEU013
     C           WUAPRC    ORNE *BLANKS                                   CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           WUAISF    ANDEQ'*NOSTRO'                                 CEU013
      * CASE: WRK.Account type is Retail
     C***********WUACTY    IFEQ 'R'                        *IF            096664
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM #1VLDT    WQ0003  50       Runday Number
     C                     PARM WUDTFF    WQ0004  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0005  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0006  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    #DVDDS
     C***********          ELSE                                           096664
      * CASE: *OTHERWISE
     C***********          MOVEL*BLANK    #DVDDS           Value date (dis096664
     C***********          END                             *FI            096664
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC02
      * Check for Change in Batch Header for Branch Code
      * CASE: PAR.Branch Code - Alpha NE PAR.Branch Code (Batch Headr)
     C           P2BCDA    IFNE #1BCBH                     *IF
     C                     MOVELP2BCDA    WUBCBH           Branch Code (Ba
      * Change GL Batch posting - Journal Entry Posting  *
     C                     EXSR SACHRC
     C                     ELSE                                           095522
     C                     MOVEL#1BCBH    WUBCBH           Branch Code (Ba095522
     C                     END                             *FI
      * SAR017 Start
      * Customer Report Name & Account Name Set-up Only If GLIN = Y
      * CASE: WRK.GL Description Ind. is Yes
     C           WUGLDI    IFEQ 'Y'                        *IF
      *     E18852  - Branch Code Of trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#DACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C/COPY WNCPYSRC,GL0123RC45
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0123RC46
     C*
     C* Assign work field to file field values.
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C           #1ACCD    IFNE *BLANKS                                   CEU013
     C                     MOVELA5ACTY    WUACTY           Account Type   CEU013
     C                     ELSE                                           CEU013
     C                     MOVEL#1ACTY    WUACTY           Account Type   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVEL*BLANKS   WUBPST           Account Sub-TypCEU013
     C                     MOVEL*BLANKS   WUACCS           Account Status CEU013
     C                     MOVE *ZEROS    WUDACO           Date Account OpCEU013
     C                     MOVEL*BLANKS   WUACNM           Account Name   CEU013
     C                     MOVEL#1RACN    WURACN           Retails AccountCEU013
     C                     MOVE *ZEROS    WURRNM           Relative rec NoCEU013
     C**********           MOVEL*BLANK    WURETB           Retail Indic'tr             CEU013 203566
     C                     BITOF'01234567'WURETB                                              203566
     C                     ELSE                                           CEU013
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C***********          MOVELSTYP      WUACTY           Account Sub-TypCEU013
     C                     MOVELSTYP      WUBPST           Account Sub-TypCEU013
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      #DDACN           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     ENDIF                                          CEU013
     C*
      * End of Fix LN0315
     C                     MOVEL'Y'       WUDSAC           Display Account
     C                     MOVEL#DDACN    WUCDAN           Copy:Display Ac
     C/COPY WNCPYSRC,GL0123RC64
      * Access Cust Report Name - Standard functions  *
     C*
     C* Access Customer Report Name Off Client File
     C*
     C                     MOVE *BLANK    WUCRST  7
     C**
     C                     CALL 'AOCUSTR0'
     C***********#BAORC****PARM #BAORC    P@RTN   7        B:Return code  S01117
     C           WUAPRC    PARM WUAPRC    P@RTN   7        B:Access Pgm ReS01117
     C*********************PARM #IAOPN    P@OPTN  7        I:Option       S01117
     C                     PARM '*KEY'    P@OPTN  7        I:Access Pgm OpS01117
     C                     PARM #1CUST    P@CKEY 10        I:Key field
     C           WUCRST    PARM *BLANK    P@FLD1  7        O:Client Key Id.
     C*********************PARM           P@AORF           O:Format       S01117
     C           D@CUST    PARM *BLANK    UUSDY            O:Format       S01117
     C*
     C                     MOVELBBCRNM    #DDCNM           O:Cust Report Nme
     C                     MOVEL'Y'       WUDCUS           Display Custome
     C                     MOVEL#DDCNM    WUCDCN           Copy:Display Cu
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDCUS           Display Custome
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     END                             *FI
      * SAR017 End
      * start S01413
      * Initialise number of items
      * CASE: WRK.Display no of items is Yes
     C           WUDNIT    IFEQ 'Y'                        *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVELBTNITM    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0007  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0008 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0009  10       ZALIGN No Of De
     C                     PARM 5         WQ0010  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0011 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0012 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0013  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
     C                     MOVE WUZAFF    #1NITM           Number of Items
      * Move No. of Items display - Journal Entry Posting  *
     C*  MOVE ZALIGN FUNCTION FIELD INTO NUMBER OF ITEMS - DISPLAY
     C                     MOVE WUZASF    #DNITD
     C                     END                             *FI
      * end S01413
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Number of decimal places and 'In' currency flag                  CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C* Access  original currency code for number of decimal places and   CEU013
     C*  In-currency flag                                                 CEU013
     C                     MOVE *BLANK    WKINCY  1        'In' Currency  CEU013
     C                     MOVE *ZERO     WKNBDP  10       No. Decimal PlcCEU013
     C           #1OCCY    IFNE *BLANK                                    CEU013
      * Access Currency. - Currency Codes  *                              CEU013
     C* CASE: RCD Original currency code is Select Requested              CEU013
     C           #1OCCY    IFEQ '?'                                       CEU013
     C                     MOVEL'Y'       W0DCF                           CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Number of decimal places and 'In' currency flag                  CEU013
     C*                                                                   CEU013
     C                     MOVEL#1OCCY    UUCYCD                          CEU013
     C                     CALL 'AOCURRR0'                                CEU013
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CEU013
     C                     PARM '*KEY'    UUAPOP  7        I:Option       CEU013
     C                     PARM           UUCYCD  3        I:Currency CodeCEU013
     C           D@CURR    PARM *BLANK    UUSDY            O:Format       CEU013
     C*                                                                   CEU013
      * CASE: *OTHERWISE                                                  CEU013
     C* Assign work field to file field values.                           CEU013
     C*                                                                   CEU013
     C                     MOVE UUCYCD    #1OCCY                          CEU013
     C                     MOVELA6NBDP    WKNBDP  10       No. Decimal PlcCEU013
     C                     MOVELA6INCY    WKINCY  1        'In' Currency  CEU013
     C                     ENDIF                           *FI            CEU013
     C*                                                                   CEU013
     C*                                                                   CEU013
     C           #1OAMT    IFNE *ZEROS                                    CEU013
      * Format amount (short) - Standard functions  *                     CEU013
     C                     Z-ADD#1OAMT    ULVALU           Value          CEU013
      *                                                                   CEU013
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>CEU013
     C                     PARM           ULVALU 150       I:Value        CEU013
     C                     PARM WKNBDP    ULDECP  10       I:Decimal placeCEU013
     C                     PARM '3'       ULEDIT  1        I:IBM Edit codeCEU013
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.CEU013
     C                     PARM           ULRSLF 23        O:Formatted    CEU013
      *                                                                   CEU013
     C                     MOVE ULRSLF    #DFMOA           Formatted data CEU013
     C                     MOVE ULRSLF    #1SVOA           Screen save dtaCEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RISE - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RISE
     C*00/Copy Member GL0123R   Initialise Dtl Exist Rcd
     C                     END                             *FI
     C                     END
      *
     C                     ELSE
      * If record already exists, error
     C           *IN90     IFEQ '0'
     C                     SETON                     993132*
      * Send message 'Journal Entry Posting  EX'
     C                     MOVEL'GLX0175' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
      * USER: Initialise detail screen (new record)
      * Set up CMD Key Text CTX2 - Journal Entry Posting  *
     C*   Set up function Key text for Edit 1 record Journal Entry
     C           P6ACTC    IFEQ 'D'
     C                     MOVEACTX2,1    ##CTX2
     C                     ELSE
     C/COPY WNCPYSRC,GL0123RC72
     C                     MOVEACTX2,2    ##CTX2
     C/COPY WNCPYSRC,GL0123RC73
     C                     END
      * CASE: PAR.Batch Item To Template is Greater than 0
     C           P5BITT    IFGT *ZERO                      *IF
      * rtv Templated Record - Journal Entry Posting  *
     C                     EXSR SCRVGN
     C                     MOVEL'Y'       WUTFUS           Template Facili
      * Start of Fix LN0334
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELP2BCDA    #1IBCA           Input Branch Co
      * End of Fix LN0334
     C                     END                             *FI
      * Init New Record
      * CASE: WRK.Template Facility Used is Yes
     C           WUTFUS    IFEQ 'Y'                        *IF
     C                     Z-ADDWURDNO    #1PTDT           Posting date
      * Start of Fix LN0358
      * Account Identifier
      * CASE: PAR.Retail Number Entered is Retail Account
     C           #1RNBE    IFEQ 'Y'                        *IF
     C                     MOVEL#1RACN    #DACID           Account Identif
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DACID           Account Identif
     C                     MOVEL#1CUST    #DACID           Account Identif
     C                     END                             *FI
      * Narrative
      * CASE: PAR.Narrative code is Narrative code
     C           #1NVCD    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    #DNRTV           Narrative
     C                     MOVEL#1NVCD    #DNRTV           Narrative
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#1NRDC    #DNRTV           Narrative
     C                     END                             *FI
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVE *BLANK    WUINCY  1        'In' Currency  CEU013
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C                     MOVELA6INCY    WUINCY  1        'In' Currency  CEU013
     C*
      * Format amount (short) - Standard functions  *
     C                     Z-ADD#1PTAM    ULVALU           Value
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALU 150       I:Value
     C                     PARM WUNBDP    ULDECP  10       I:Decimal place
     C***********          PARM 'L'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM '3'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLF 23        O:Formatted
     C                     MOVE ULRSLF    #DFMPA           Formatted data
     C                     MOVEL*BLANK    #DASCD           Associated Cust
     C                     MOVEL#1ACNB    #DASCD           Associated Cust
     C*                                                                   CEU013
     C* Save the screen values for the comparison.                        CEU013
     C*                                                                   CEU013
     C                     MOVE #DACID    #1SVAI           Save acc identiCEU013
     C                     MOVEL#1CYCD    #1SVCY           Currency  save CEU013
     C                     MOVEL#1ACCD    #1SVAC           Acc code  save CEU013
     C                     MOVEL#1ACSN    #1SVCS           Acc seq no. savCEU013
     C                     MOVEL#1IBCA    #1SVBC           Input BranchsavCEU013
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL*BLANK    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C           #1ACCD    IFNE *BLANKS                                   CEU013
     C                     MOVELA5ACTY    WUACTY           Account Type   CEU013
     C                     ELSE                                           CEU013
     C                     MOVEL#1ACTY    WUACTY           Account Type   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVEL*BLANKS   WUBPST           Account Sub-TypCEU013
     C                     MOVEL*BLANKS   WUACCS           Account Status CEU013
     C                     MOVE *ZEROS    WUDACO           Date Account OpCEU013
     C                     MOVEL*BLANKS   WUACNM           Account Name   CEU013
     C                     MOVEL#1RACN    WURACN           Retails AccountCEU013
     C                     MOVE *ZEROS    WURRNM           Relative rec NoCEU013
     C**********           MOVEL*BLANK    WURETB           Retail Indic'tr             CEU013 203566
     C                     BITOF'01234567'WURETB                                              203566
     C                     ELSE                                           CEU013
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     ENDIF                                          CEU013
     C*
      * Value Date
      * CASE: WRK.Access Pgm Return Code is *No Errors
     C           WUAPRC    IFEQ *BLANK                     *IF
     C*                                                                   CEU013
     C* If CEU013 switchable function is installed, the batch is from     CEU013
     C*   external interface, account type is Retail or Nostro,           CEU013
     C*   the currency is an 'In' currency, then the account not found    CEU013
     C*   is not an error.  The processing is continued                   CEU013
     C*                                                                   CEU013
     C           WUAPRC    ORNE *BLANKS                                   CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           WUAISF    ANDEQ'*RETAIL'                                 CEU013
     C           WUAPRC    ORNE *BLANKS                                   CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           WUAISF    ANDEQ'*NOSTRO'                                 CEU013
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM #1VLDT    WQ0014  50       Runday Number
     C                     PARM WUDTFF    WQ0015  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0016  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0017  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    #DVDDS
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DVDDS           Value date (dis
     C                     END                             *FI
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Number of decimal places and 'In' currency flag                  CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C* Access  original currency code for number of decimal places and   CEU013
     C*  In-currency flag                                                 CEU013
     C                     MOVE *BLANK    WKINCY  1        'In' Currency  CEU013
     C                     MOVE *ZERO     WKNBDP  10       No. Decimal PlcCEU013
     C           #1OCCY    IFNE *BLANK                                    CEU013
      * Access Currency. - Currency Codes  *                              CEU013
     C* CASE: RCD Original currency code is Select Requested              CEU013
     C           #1OCCY    IFEQ '?'                                       CEU013
     C                     MOVEL'Y'       W0DCF                           CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Number of decimal places and 'In' currency flag                  CEU013
     C*                                                                   CEU013
     C                     MOVEL#1OCCY    UUCYCD                          CEU013
     C                     CALL 'AOCURRR0'                                CEU013
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CEU013
     C                     PARM '*KEY'    UUAPOP  7        I:Option       CEU013
     C                     PARM           UUCYCD  3        I:Currency CodeCEU013
     C           D@CURR    PARM *BLANK    UUSDY            O:Format       CEU013
     C*                                                                   CEU013
      * CASE: *OTHERWISE                                                  CEU013
     C* Assign work field to file field values.                           CEU013
     C*                                                                   CEU013
     C                     MOVE UUCYCD    #1OCCY                          CEU013
     C                     MOVELA6NBDP    WKNBDP  10       No. Decimal PlcCEU013
     C                     MOVELA6INCY    WKINCY  1        'In' Currency  CEU013
     C                     ENDIF                           *FI            CEU013
     C*                                                                   CEU013
     C*                                                                   CEU013
     C           #1OAMT    IFNE *ZEROS                                    CEU013
      * Format amount (short) - Standard functions  *                     CEU013
     C                     Z-ADD#1OAMT    ULVALU           Value          CEU013
      *                                                                   CEU013
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>CEU013
     C                     PARM           ULVALU 150       I:Value        CEU013
     C                     PARM WKNBDP    ULDECP  10       I:Decimal placeCEU013
     C                     PARM '3'       ULEDIT  1        I:IBM Edit codeCEU013
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.CEU013
     C                     PARM           ULRSLF 23        O:Formatted    CEU013
      *                                                                   CEU013
     C                     MOVE ULRSLF    #DFMOA           Formatted data CEU013
     C                     MOVE ULRSLF    #1SVOA           Screen save dtaCEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      * End of Fix LN0358
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUIEMG    #DIEMG           Item error mess
     C                     Z-ADDWURDNO    #1PTDT           Posting date
     C                     MOVEL'01'      #1ACSN           Account sequenc
     C                     MOVEL*BLANK    #DACID           Account Identif
     C                     MOVELP3BICN    #DACID           Account Identif
     C                     Z-ADDWURDNO    #1VLDT           Value date
     C                     MOVEL'N'       #1RNBE           Retail Number E
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C/COPY WNCPYSRC,GL0123RC94
     C                     MOVELBJLCCY    WULCCY
     C/COPY WNCPYSRC,GL0123RC95
     C                     MOVELWULCCY    #1CYCD           Currency code
     C                     END                             *FI
      * SAR017 Start
      *    E20026 Start
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     MOVEL*BLANK    WUCDAN           Copy:Display Ac
      * CASE: WRK.GL Description Ind. is Yes
     C           WUGLDI    IFEQ 'Y'                        *IF
      * Access Cust Report Name - Standard functions  *
     C*
     C* Access Customer Report Name Off Client File
     C*
     C                     MOVE *BLANK    WUCRST  7
     C**
     C                     CALL 'AOCUSTR0'
     C***********#BAORC****PARM #BAORC    P@RTN   7        B:Return code  S01117
     C           WUAPRC    PARM WUAPRC    P@RTN   7        B:Access Pgm ReS01117
     C*********************PARM #IAOPN    P@OPTN  7        I:Option       S01117
     C                     PARM '*KEY'    P@OPTN  7        I:Access Pgm OpS01117
     C                     PARM P3BICN    P@CKEY 10        I:Key field
     C           WUCRST    PARM *BLANK    P@FLD1  7        O:Client Key Id.
     C*********************PARM           P@AORF           O:Format       S01117
     C           D@CUST    PARM *BLANK    UUSDY            O:Format       S01117
     C*
     C                     MOVELBBCRNM    #DDCNM           O:Cust Report Nme
     C                     MOVEL'Y'       WUDCUS           Display Custome
     C                     MOVEL#DDCNM    WUCDCN           Copy:Display Cu
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDCUS           Display Custome
     C                     END                             *FI
      *    E20026 End
      * SAR017 End
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RISN - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RISN
     C*00/Copy Member GL0123R   Initialise Dtl New Rcd
     C                     END                             *FI
     C                     END
     C                     END
      *..................................................
     C/COPY WNCPYSRC,GL0123RC98
     C           W0DCF     IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     MOVE *BLANKS   WWFLG                           CEU013
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,GL0123RC99
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WKSKIP    ANDEQ'Y'                                       CEU013
     C           WWFLG     IFEQ 'Y'                                       CEU013
     C           WERRF     IFNE 'Y'                                       CEU013
      * Clear messages from program message queue                         CEU013
     C                     CALL 'Y2CLMSC'                                 CEU013
     C                     PARM ##PGM     ZAPGMQ 10                       CEU013
     C                     PARM '*SAME'   ZAPGRL  5                       CEU013
     C                     SETOF                     99                   CEU013
     C                     SETOF                     51                   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     MOVE *BLANKS   WWFLG                           CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C   99                GOTO BEEXIT
      * No error: Display and process details
     C                     EXSR CADSDA
      *
      *================================================================
     CSR         BEEXIT    ENDSR
      /EJECT
     CSR         BFVLKY    BEGSR
      *================================================================
      * Validate key fields
      *================================================================
     C           W0PMD     IFNE 'ADD'
     C                     END
      * Check relations
      * Check reference to Journal Entry Header
     C                     EXSR VACKRL
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
      * USER: Validate key screen
      * CASE: PAR.Action Code is *Insert
     C           P6ACTC    IFEQ 'I'                        *IF
     C                     MOVELP1BTNB    #1BTNB           Batch number
      * RTV Last Batch Item - Standard functions  *
     C                     CALL 'GL0137U'              90  RTV Last Batch
     C                     PARM #1BTNB    WQ0019  3        Batch number
     C           WULINB    PARM *ZERO     WQ0020  30       Last item numbe
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C           1         ADD  WULINB    #1BINB           Batch item no.
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RVKS - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RVKS
     C*00/Copy Member GL0123R   Validate Key Screen
     C                     END                             *FI
      * Batch number required
     C           #1BTNB    IFEQ *BLANK                     IF
     C                     SETON                     9931  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      * Batch item no. required
     C           #1BINB    IFEQ *ZERO                      IF
     C                     SETON                     9932  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         BFEXIT    ENDSR
      /EJECT
     CSR         CADSDA    BEGSR
      *================================================================
      * Display and process detail screen
      *================================================================
      * Conduct detail screen conversation
      * - repeat until screen control flag is reset:
     C           W0TRN     DOWEQ'Y'
     C/COPY WNCPYSRC,GL0123RC41
      * Display detail screen
     C                     EXSR CBEXFM
      * Process response to detail screen
     C/COPY WNCPYSRC,GL0123RC42
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * Redisplay previous screen
     C   12                CAS            CCDSPV
      * HOME: Reset screen fields
     C   05                CAS            CCDSPV
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0123RCP5                                           S01408
      *                                                                   S01408
      * Process detail screen input
     C                     CAS            CFPRSC
     C                     END
     C           W0TRN     IFEQ 'R'
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'Y'       W0TRN
     C                     EXSR MAIZ#1
     C                     END
     C                     END
      *
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0123RCP6                                           S01408
      *                                                                   S01408
     CSR         CBEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSAD
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE HELP25    *IN25
      * PUTOVR unless conditioned fields change
     C                     SETON                         86*
     C           *IN89     IFNE CBIN89
     C                     SETOF                         86*
     C                     END
     C                     MOVE *IN89     CBIN89  1
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0123RCP7                                           S01408
      *                                                                   S01408
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT2
     C                     EXFMT#RCDDTL1
      * If help requested, display help text
     C   25                EXSR ZHHPKY
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0123RCP8                                           S01408
      *                                                                   S01408
     C                     END
     C*                                                                   CEU013
     C* If the warning was already displayed and there was no other       CEU013
     C*   error, set up a Skip work field to control the display of       CEU013
     C*   warning for the second time in the absence of any other         CEU013
     C*   error.                                                          CEU013
     C*                                                                   CEU013
     C                     MOVE *BLANK    WKSKIP                          CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WWFLG     ANDEQ'Y'                                       CEU013
     C           WERRF     ANDNE'Y'                                       CEU013
     C                     MOVE 'Y'       WKSKIP                          CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE *BLANK    WWFLG                           CEU013
     C                     MOVE *BLANK    WERRF                           CEU013
     C*                                                                   CEU013
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1
      * Reset global error indicator
     C                     SETOF                         99*
      *================================================================
     CSR         CBEXIT    ENDSR
      /EJECT
     CSR         CCDSPV    BEGSR
      *================================================================
      * Redisplay previous screen
      *================================================================
      * USER: Process key screen request
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * Send message 'Function Key Not Allowed'
     C                     MOVEL'GLX0131' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO CCEXIT                     *QUIT
     C                     ELSE
      * CASE: *OTHERWISE
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RPKR - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RPKR
     C*00/Copy Member GL0123R   Process Key Screen Rqst
     C                     END                             *FI
     C   05                MOVEL'R'       W0TRN
     C   12                MOVEL'K'       W0TRN
      *================================================================
     CSR         CCEXIT    ENDSR
      /EJECT
     CSR         CFPRSC    BEGSR
      *================================================================
      * Validate record
      *================================================================
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * If delete is not pending....
      * Validate details
     C  N10                CAS            DCVLDL
     C                     END
     C*                                                                   CEU013
     C/COPY WNCPYSRC,GL0123RK01
     C* If the warning was already displayed and there is no other        CEU013
     C*   error, do not display warning for the second time.              CEU013
      * Defer confirm/update requested                                    CEU013
     C           W0DCF     IFEQ 'Y'                                       CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     MOVE *BLANKS   WWFLG                           CEU013
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,GL0123RK02
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WKSKIP    ANDEQ'Y'                                       CEU013
     C           WWFLG     IFEQ 'Y'                                       CEU013
     C           WERRF     IFNE 'Y'                                       CEU013
      * Clear messages from program message queue                         CEU013
     C                     CALL 'Y2CLMSC'                                 CEU013
     C                     PARM ##PGM     ZAPGMQ 10                       CEU013
     C                     PARM '*SAME'   ZAPGRL  5                       CEU013
     C                     SETOF                     993132               CEU013
     C                     SETOF                     3334                 CEU013
     C                     SETOF                     51                   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     MOVE *BLANKS   WWFLG                           CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      * QUIT if error:
     C/COPY WNCPYSRC,GL0123RC35
     C   99                GOTO CFEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       CFEXIT
      * No error: update record
     C                     EXSR EBPR##
      *================================================================
     CSR         CFEXIT    ENDSR
     CSR         CHKOVR    BEGSR
      *====================================================
      * Check OVERRIDE MESSAGES
      *----------------------------------------------------
      *
     C                     MOVE *IN90     URSI90  1        Save indicator
     C                     MOVE *IN91     URSI91  1        Save indicator
     C                     MOVE *BLANK    URIESL           Blank msg.text
     C                     MOVE *BLANK    URERST  1        Error status
     C                     Z-ADD1         U1      30       Set pointer
     C                     SETOF                     91    Set ind.
      *
      * Check Refer Debits :
      *
      *
     C           WURSRD    IFEQ 'Y'                        IF BIT SET
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     MOVE 'Refer Dr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
      *
      * Check Refer Credits :
      *
      *
     C           WURSRC    IFEQ 'Y'                        IF BIT SET
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     MOVE 'Refer Cr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI             E17600
      *
      * Check Block Debits :
      *
      *
     C           WURSBD    IFEQ 'Y'                        IF BIT SET
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     MOVE 'Block Dr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI             E17600
      *
      * Check Block Credits :
      *
     C           WURSBC    IFEQ 'Y'                        IF BIT SET
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     MOVE 'Block Cr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI             E17600
      *
      * Check Inactive A/C :
      *
     C           WURSIN    IFEQ 'Y'                        IF BIT SET
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     MOVE 'Inactive'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
      *
      * Check Not in Use :   ***REMOVE COMMENTS IF FLAG TO BE USED LATER***
      *
     C*****      WUBDST    IFEQ 'Y'                        IF BIT SET
     C*****                MOVELURRIHS    @IH,U1             Highlight
     C*****                MOVE 'Not used'@IH,U1             Message text
     C*****                ADD  1         U1                 Incr.pointer
     C*****                END                             FI
      *
      * Check Bankrupt :
      *
     C           WURSBR    IFEQ 'Y'                        IF BIT SET
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     MOVE 'Bankrupt'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
      *
      * Check Bad Debt :
      *
     C           WURTSB    IFEQ 'Y'                        IF BIT SET
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     MOVE 'Bad Debt'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
      *
      * Check Stopped cheque :
      *
     C           WURSSC    IFEQ 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     MOVE 'Chq.Stop'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     END                             FI
      *
      * Check Non-Overrideable error status :
      *
     C           U1        IFGT 1                          IF ERRORS
     C           U1        IFLT 9                          IF NOT MAXIMUM
     C                     MOVELURNORM    @IH,U1             End Highlight
     C                     END                             FI
     C                     MOVE URERMG    URERTX             Error line
     C                     ELSE                            EL NO ERRORS
     C                     MOVE *BLANK    URERST             Error Status
     C                     MOVE URDASH    URERTX 76          Dashes
     C                     END                             FI
      *
     C                     MOVE URSI90    *IN90            Restore ind.
     C                     MOVE URSI91    *IN91            Restore ind.
      *
      *----------------------------------------------------
      *
      *====================================================
     CSR         XXEND     ENDSR
      *
      * Set highlights for error message line :
      *
      /EJECT
     CSR         DCVLDL    BEGSR
      *================================================================
      * Validate details
      *================================================================
      * Validate Debit/credit indicator
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1DCIN    W0NSRQ  1        Debit/credit in
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'MIVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1107881   Y2LSNO  70
     C           #1DCIN    PARM #1DCIN    W0EXVL 20        Debit/credit in
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      * USER: Validate detail screen fields
      * CASE: PAR.Action Code is *Delete
     C           P6ACTC    IFEQ 'D'                        *IF
      * Send message 'F3/F10 Only Valid Options'
     C                     MOVEL'GLX0132' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO DCEXIT                     *QUIT
     C                     END                             *FI
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
      * Copy Symbol Invalid Validation
     C                     EXSR UHSUBR                     Copy Symbol Inv
      * CASE: WRK.Copy Character Invalid is Yes
     C           WUCCIN    IFEQ 'Y'                        *IF
     C                     GOTO DCEXIT                     *QUIT
     C                     END                             *FI
     C                     ELSE
      * CASE: PGM.*Program mode is *ADD
     C           W0PMD     IFEQ 'ADD'                      *IF
      * Copy Symbol valid
     C                     EXSR UISUBR                     Copy Symbol val
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RVSF - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RVSF
     C*00/Copy Member GL0123R   Validate Detail Screen
     C                     END                             *FI
      * Check relations
      * CALC: Detail screen function fields
      * Account Identifier validation
     C                     EXSR UJSUBR                     Account Identif
      * Currency Code Validation
      * CASE: DTL.Currency code is Not blank
     C           #1CYCD    IFNE *BLANK                     *IF
      * CASE: DTL.Currency code is Select Requested
     C           #1CYCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVE *BLANK    WUINCY  1        'In' Currency  CEU013
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C                     MOVELA6INCY    WUINCY           'In' Currency  CEU013
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL'N'       WUACIC           Account Identif
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0055           Currency code
      * Send message 'Currency Code not found'
     C                     MOVEL'GLX0048' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Account ID Status Flag is Customer No or short name
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
     C                     MOVEL'N'       WUACIC           Account Identif
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0056           Currency code
      * Send message 'Currency Code Required'
     C                     MOVEL'GLX0123' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Account Code Validation
     C                     EXSR UKSUBR                     Account Code Va
      * Account Sequence Validation
     C                     EXSR ULSUBR                     Account Sequenc
      * Branch Code Validation
     C                     EXSR UMSUBR                     Branch Code Val
      * debit/credit indicator validation
      * CASE: DTL.Debit/credit indicator is Valid Values
     C           #1DCIN    IFEQ 'C'                        *IF
     C           #1DCIN    OREQ 'D'
     C                     ELSE
      * CASE: DTL.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1DCIN    ZA0062           Debit/credit in
      * Send message 'Debit/Credit must be Y/N'
     C                     MOVEL'GLX0207' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9937  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Start of S10736
      * Book Code Validation
      * CASE: DTL.Book Code is Entered
     C           #1BKCD    IFNE *BLANK                     *IF
      * CASE: DTL.Book Code is Select requested
     C           #1BKCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Book Codes - Book Codes  *
     C*
     C*  Access Book Codes for the file fields
     C*
     C                     MOVEL#1BKCD    UUBKCD
     C                     CALL 'AOBOOKR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBKCD  2        I:Book Code
     C           D@BOOK    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVE BDBKCD    WUBKCD
     C                     MOVE BDBKD     WUBKD
     C                     MOVE BDHGIN    WUHGIN
     C                     MOVE BDACIN    WUACIN
     C                     MOVE BDBKCC    WUBKCC
     C                     MOVE BDSTAM    WUSTAM
     C                     MOVE BDSTRM    WUSTRM
     C                     MOVE BDSTEP    WUSTEP
     C                     MOVE BDIACK    WUIACK
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1BKCD    ZA0063           Book Code
      * Send message 'Book Codes Not Found.'
     C                     MOVEL'GLX0240' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9948  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUBKCD    #1BKCD           Book Code
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC39
     C                     END                             *FI
      * Reversal/Void indicator validation
      * CASE: DTL.Reverse/Void Indicator is valid
     C           #1RVDI    IFEQ *BLANK                     *IF
     C           #1RVDI    OREQ 'Y'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1RVDI    ZA0064           Reverse/Void In
      * Send message 'Reverse/Void  is invalid'
     C                     MOVEL'GLX0237' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9938  *
      *
     C                     END                             *FI
      * End of S10736
      * Validate Customer report name & Account name
     C                     EXSR UNSUBR                     Validate Custom
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RSFF - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RSFF
     C*00/Copy Member GL0123R   Calc Detail Function Flds
     C                     END                             *FI
     C*                                                                   CEU013
     C* If the Warning message was already displayed and any of the       CEU013
     C*   corresponding field is changed, perform the validation          CEU013
     C*   again.                                                          CEU013
     C*                                                                   CEU013
     C*                                                                   CEU013
     C* If Account identifier, Currency code, Account code, Account       CEU013
     C*   Sequence number, Input branch code - Alpha are changed          CEU013
     C*   force the validation and the warning message again.             CEU013
     C*                                                                   CEU013
     C           #1SVAI    IFNE #DACID                                    CEU013
     C           #1SVCY    ORNE #1CYCD                                    CEU013
     C           #1SVAC    ORNE #1ACCD                                    CEU013
     C           #1SVCS    ORNE #1ACSN                                    CEU013
     C           #1SVBC    ORNE #1IBCA                                    CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     MOVE *BLANKS   WWFLG                           CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C* Save the screen values for the comparison.                        CEU013
     C*                                                                   CEU013
     C                     MOVE #DACID    #1SVAI           Save acc identiCEU013
     C                     MOVEL#1CYCD    #1SVCY           Currency  save CEU013
     C                     MOVEL#1ACCD    #1SVAC           Acc code  save CEU013
     C                     MOVEL#1ACSN    #1SVCS           Acc seq no. savCEU013
     C                     MOVEL#1IBCA    #1SVBC           Input BranchsavCEU013
     C*                                                                   CEU013
      * USER: Validate detail screen relations
     C                     MOVELP2DPCD    WUDPCD           Dept Code
     C                     MOVEL*BLANK    WUACOC           Account Officer
      * Val Subfile Rec Relations
     C/COPY WNCPYSRC,GL0123RC65
      * Check Account Identifier
     C                     EXSR UQSUBR                     Check Account I
      * Check BRANCH CODE                                                 088589
     C                     EXSR UDSUBR                     Check Account I088589
      *                                                                                       CGL037
      **  If CGL037 is ON and Account Identifier is not blank                                 CGL037
      **  (ie. retail no. entered)                                                            CGL037
      *                                                                                       CGL037
     C           CGL037    IFEQ 'Y'                                                           CGL037
     C           #DACID    ANDNE*BLANK                                                        CGL037
     C           *IN33     ANDEQ*OFF                                                          CGL037
      *                                                                                       CGL037
     C           *INU5     IFEQ '1'                                                           CGL037
     C           WUACTY    IFEQ 'R'                                                           CGL037
     C           WUBPST    IFNE 'V'                                                           CGL037
     C           WUBPST    ANDNE'I'                                                           CGL037
     C                     MOVEL'USR9841' ZAMSID                                              CGL037
     C                     EXSR ZASNMS                                                        CGL037
     C                     SETON                     993132                                   CGL037
     C                     SETON                     333435                                   CGL037
     C                     GOTO DCEXIT                                                        CGL037
     C                     ENDIF                                                              CGL037
     C                     ENDIF                                                              CGL037
     C                     ENDIF                                                              CGL037
      *                                                                                       CGL037
     C                     ENDIF                                                              CGL037
     C/COPY WNCPYSRC,GL0123RC66
      * Check Posting Amount
     C                     EXSR UTSUBR                     Check Posting A
      * Check Narrative
     C                     EXSR UUSUBR                     Check Narrative
      * Check Retail/Non-Retail Fields
     C                     EXSR UVSUBR                     Check Retail/No
      * Check Associated Customer
     C                     EXSR NCSUBR                     Check Associate
      * Check Profit Centre Code
     C/COPY WNCPYSRC,GL0123RC97
     C                     EXSR NDSUBR                     Check Profit Ce
      * Setup Branch code (Header) & Posting Date on RCD
     C                     EXSR NESUBR                     Setup Branch co
      * Check Users Branch Authority
     C                     EXSR NFSUBR                     Check Users Bra
      * start S01413
      * check number of items
      * CASE: WRK.Display no of items is Yes
     C           WUDNIT    IFEQ 'Y'                        *IF
      * CASE: DTL.Number of items - display is Blank
     C           #DNITD    IFEQ *BLANK                     *IF
     C                     MOVEL'    1'   #DNITD           Number of items
     C                     Z-ADD1         #1NITM           Number of Items
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DNITD    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0075  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0076 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0077  10       ZALIGN No Of De
     C                     PARM 5         WQ0078  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0079 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0080 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0081  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#DNITD    ZA0116           Number of items
      * Send message 'Number of Items invalid'
     C                     MOVEL'GLX0385' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9940  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUZAFF    #1NITM           Number of Items
      * Move No. of Items display - Journal Entry Posting  *
     C*  MOVE ZALIGN FUNCTION FIELD INTO NUMBER OF ITEMS - DISPLAY
     C                     MOVE WUZASF    #DNITD
      * CASE: DTL.Number of Items is Valid range
     C           #1NITM    IFGE 00001                      *IF
     C           #1NITM    ANDLE99999
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#DNITD    ZA0117           Number of items
      * Send message 'Number of Items invalid'
     C                     MOVEL'GLX0385' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9940  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD1         #1NITM           Number of Items
     C                     END                             *FI
      * end S01413
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Number of decimal places and 'In' currency flag                  CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     EXSR VALOCY                                    CEU013
     C*                                                                   CEU013
     C                     EXSR VALORG                                    CEU013
     C                     ENDIF                                          CEU013
      *                                                                                       CGL013
      ** If MT94x Messages Generation (CGL013) is installed, validate                         CGL013
      ** Additional Information Field                                                         CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
      *                                                                                       CGL013
     C           #1ADIN    IFEQ *BLANK                                                        CGL013
     C                     MOVE 'N'       #1ADIN                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           #1ADIN    IFNE 'Y'                                                           CGL013
     C           #1ADIN    ANDNE'N'                                                           CGL013
     C                     MOVEL'USR0912' ZAMSID                                              CGL013
     C                     EXSR ZASNMS                                                        CGL013
     C                     MOVE *ON       *IN53                                               CGL013
     C                     MOVE *ON       *IN99                                               CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE *OFF      *IN53                                               CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     ENDIF                                                              CGL013
     C*                                                                   CEU013
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RVSR - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RVSR
     C*00/Copy Member GL0123R   Validate Screen Relns
     C                     END                             *FI
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         EBPR##    BEGSR
      *================================================================
      * Process record:
      *================================================================
      * Process delete request
     C   10                CAS            EDDLRQ
      * Process add request
     C           W0PMD     CASEQ'ADD'     ECADRQ
      * Process update request
     C           W0PMD     CASNE'ADD'     EECHRQ
     C                     END
     C/COPY WNCPYSRC,GL0123RC89
     C           W0RTN     IFNE *BLANK
      * ROLLBACK required
     C                     MOVEL'Y2U0018' P0RTN
     C                     EXSR ZYEXPG
     C                     END
     C           W0RTN     IFEQ *BLANK
      * USER: Process command keys
      * Start of Fix E24371
      * Write Format(Posn Cursor) - Standard functions  *
     C           W0PMD     IFEQ 'ADD'
     C                     SETON                     31
     C                     WRITE#RCDDTL1
     C                     SETOF                     31
     C                     END
      * End of Fix E24371
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RPCK - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RPCK
     C*00/Copy Member GL0123R   Process Command Keys
     C                     END                             *FI
      * Restart program for next record
     C                     MOVEL'N'       W0TRN
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         ECADRQ    BEGSR
      *================================================================
      * Process add request
      *================================================================
      * USER: Create DBF record
      * Create GL Btch Post LCL - Journal Entry Posting  *
     C                     EXSR SDCRRC
     C           W0RTN     IFEQ *BLANK
     C/COPY WNCPYSRC,GL0123RK03
      * Send message '*Record added'
     C                     MOVEL'Y2U0011' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EDDLRQ    BEGSR
      *================================================================
      * Process delete request
      *================================================================
      * USER: Delete DBF record
      * Delete GL Btch Post LCL - Journal Entry Posting  *
     C                     EXSR SEDLRC
     C           W0RTN     IFEQ *BLANK
      * Send message '*Record deleted'
     C                     MOVEL'Y2U0013' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *================================================================
     CSR         EDEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Change GL Btch Post LCL - Journal Entry Posting  *
     C                     EXSR SFCHRC
     C           W0RTN     IFNE *BLANK
      * DBF update error
      * Reset screen fields if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1
     C                     END
     C                     ELSE
      * Send message '*Record changed'
     C                     MOVEL'Y2U0012' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FACKPM    BEGSR
      *================================================================
      * Check passed parameters
      *================================================================
      * Is full key present?
     C           P1BTNB    IFEQ *BLANK                     Batch number
     C           P1BINB    OREQ *ZERO                      Batch item no.
      * Not every key field passed - loop program
     C                     MOVEL'Y'       W0RPT   1
     C                     ELSE
      * Full key passed, so single shot program
     C                     MOVEL'N'       W0RPT
     C                     END
      *================================================================
     CSR         FAEXIT    ENDSR
      /EJECT
     CSR         GADSAK    BEGSR
      *================================================================
      * Set key screen conditioning indicators
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSAD    BEGSR
      *================================================================
      * Set detail screen conditioning indicators
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect key fields on detail screen
     C                     SETON                     88    *
     C                     MOVEL'0'       *IN79
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
     C                     MOVEL'0'       *IN78
     C           WUDNIT    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
     C                     MOVEL'0'       *IN77
     C           #1RINE    IFEQ *BLANK                     *IF
     C           #1RINE    OREQ 'N'
     C                     MOVEL'1'       *IN77
     C                     END                             *FI
     C                     MOVEL'0'       *IN76
     C           WUDCUS    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN76
     C                     END                             *FI
     C                     MOVEL'0'       *IN75
     C           WUDSAC    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN75
     C                     END                             *FI
      * Enable key screen
     C                     SETON                     87    *
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise record - except for key fields
      *================================================================
     C                     MOVELP2BCDA    #PBCDA           Branch Code - A
     C                     MOVELP2DPCD    #PDPCD           Dept Code
     C                     Z-ADDP2HINC    #PHINC           Hash item no.ca
     C                     MOVELP2MBRB    #PMBRB           Multiple Branch
     C                     MOVEL*BLANK    #DIEST           Item error stat
     C                     MOVEL*BLANK    #1CUST           Customer number
     C                     MOVEL*BLANK    #1NNBI           Nostro number (
     C                     Z-ADD*ZERO     #1RACN           Retail account
     C                     MOVEL*BLANK    #1RINE           Retail ind.: Er
     C                     Z-ADD*ZERO     #1PTAM           Posting amount
     C                     Z-ADD*ZERO     #1NITM           Number of Items
     C                     Z-ADD*ZERO     #1PTDT           Posting date
     C                     MOVEL*BLANK    #1NVCD           Narrative code
     C                     MOVEL*BLANK    #1NRDC           Narrative descr
     C                     MOVEL*BLANK    #1ACTY           Account type
     C                     MOVEL*BLANK    #1ACNB           Assoc. Customer
     C                     Z-ADD*ZERO     #1VLDT           Value date
     C                     MOVEL*BLANK    #1COIN           Customer origin
     C                     Z-ADD*ZERO     #1SPFC           Spread Factor
     C/COPY WNCPYSRC,GL0123RC16
     C                     MOVEL*BLANK    #1BCBH           Branch Code (Ba
     C/COPY WNCPYSRC,GL0123RC17
     C                     MOVEL*BLANK    #1RADP           Retail advice p
     C                     MOVEL*BLANK    #1SHPI           Shadow post ind
     C                     Z-ADD*ZERO     #1RRNM           Relative rec no
     C                     MOVEL*BLANK    #1RNBE           Retail Number E
     C                     MOVEL*BLANK    #1RARC           Retail Ac Refer
     C                     MOVEL*BLANK    #DACID           Account Identif
     C                     MOVEL*BLANK    #1CYCD           Currency code
     C                     MOVEL*BLANK    #1ACCD           Account code
     C                     MOVEL*BLANK    #1ACSN           Account sequenc
     C                     MOVEL*BLANK    #1IBCA           Input Branch Co
     C                     MOVEL*BLANK    #DFMPA           Formatted Posti
     C                     MOVEL*BLANK    #1DCIN           Debit/credit in
     C                     MOVEL*BLANK    #1RVDI           Reverse/Void In
     C                     MOVEL*BLANK    #DNRTV           Narrative
     C                     MOVEL*BLANK    #DNITD           Number of items
     C                     MOVEL*BLANK    #1TRTY           Transaction typ
     C                     MOVEL*BLANK    #1TSTY           Transaction (Su
     C                     MOVEL*BLANK    #DVDDS           Value date (dis
     C                     MOVEL*BLANK    #1CQNB           Cheque number
     C                     MOVEL*BLANK    #DASCD           Associated Cust
     C                     MOVEL*BLANK    #1SWCR           Swift common re
     C                     MOVEL*BLANK    #1PRCN           Profit centre
     C                     MOVEL*BLANK    #1BKCD           Book Code
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
     C                     MOVEL*BLANK    #DDCNM           Display Custome
     C                     MOVEL*BLANK    #DDACN           Display Account
     C                     MOVEL*BLANK    #DIEMG           Item error mess
     C                     MOVEL*BLANKS   #1OCCY           Original Ccy   CEU013
     C                     Z-ADD*ZEROS    #1OAMT           Original AmountCEU013
     C                     MOVEL*BLANKS   #DFMOA           Formatted O/AmtCEU013
     C                     MOVEL*BLANKS   #1SVOA           Formatted save CEU013
     C                     MOVEL*BLANKS   #1SVAI           Acc ident save CEU013
     C                     MOVEL*BLANKS   #1SVCY           Currency  save CEU013
     C                     MOVEL*BLANKS   #1SVAC           Acc code  save CEU013
     C                     MOVEL*BLANKS   #1SVCS           Acc seq no. savCEU013
     C                     MOVEL*BLANKS   #1SVBC           Input BranchsavCEU013
     C                     Z-ADD*ZERO     PVALD   50                      179591
     C                     MOVE *BLANKS   PCCY    3                       179591
      *                                                                                       CGL013
      ** If CGL013 is installed                                                               CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C                     MOVEL*BLANKS   #1ADIN                                              CGL013
     C                     MOVEL*BLANKS   #1AIPI                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                     BUG23742
     C           CER030    IFEQ 'Y'                                                         BUG23742
     C                     MOVEL*BLANKS   #1AIP1                                            BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                       CGL013
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @BTREAL fields to screen
      *================================================================
     C                     MOVELBTBTNB    #1BTNB           Batch number
     C                     Z-ADDBTBINB    #1BINB           Batch item no.
     C                     MOVELBTCUST    #1CUST           Customer number
     C                     MOVELBTNNBI    #1NNBI           Nostro number (
     C                     Z-ADDBTRACN    #1RACN           Retail account
     C                     MOVELBTRINE    #1RINE           Retail ind.: Er
     C                     Z-ADDBTPTAM    #1PTAM           Posting amount
     C                     Z-ADDBTNITM    #1NITM           Number of Items
     C                     Z-ADDBTPTDT    #1PTDT           Posting date
     C                     MOVELBTNVCD    #1NVCD           Narrative code
     C                     MOVELBTNRDC    #1NRDC           Narrative descr
     C                     MOVELBTACTY    #1ACTY           Account type
     C                     MOVELBTACNB    #1ACNB           Assoc. Customer
     C                     Z-ADDBTVLDT    #1VLDT           Value date
     C                     MOVELBTCOIN    #1COIN           Customer origin
     C                     Z-ADDBTSPFC    #1SPFC           Spread Factor
     C                     MOVELBTBCBH    #1BCBH           Branch Code (Ba
     C                     MOVELBTRADP    #1RADP           Retail advice p
     C                     MOVELBTSHPI    #1SHPI           Shadow post ind
     C                     Z-ADDBTRRNM    #1RRNM           Relative rec no
     C                     MOVELBTRNBE    #1RNBE           Retail Number E
     C                     MOVELBTRARC    #1RARC           Retail Ac Refer
     C                     MOVELBTCYCD    #1CYCD           Currency code
     C                     MOVELBTACCD    #1ACCD           Account code
     C                     MOVELBTACSN    #1ACSN           Account sequenc
     C                     MOVELBTIBCA    #1IBCA           Input Branch Co
     C                     MOVELBTDCIN    #1DCIN           Debit/credit in
     C                     MOVELBTRVDI    #1RVDI           Reverse/Void In
     C                     MOVELBTTRTY    #1TRTY           Transaction typ
     C                     MOVELBTTSTY    #1TSTY           Transaction (Su
     C                     MOVELBTCQNB    #1CQNB           Cheque number
     C                     MOVELBTSWCR    #1SWCR           Swift common re
     C                     MOVELBTPRCN    #1PRCN           Profit centre
     C                     MOVELBTBKCD    #1BKCD           Book Code
     C                     MOVELBTRINO    #1RINO           Retail ind.: Ov
     C                     MOVELBTOCCY    #1OCCY           Original Ccy   CEU013
     C                     Z-ADDBTOAMT    #1OAMT           Original AmountCEU013
     C                     MOVEL#1CYCD    #1SVCY           Currency  save CEU013
     C                     MOVEL#1ACCD    #1SVAC           Acc code  save CEU013
     C                     MOVEL#1ACSN    #1SVCS           Acc seq no. savCEU013
     C                     MOVEL#1IBCA    #1SVBC           Input BranchsavCEU013
     C                     Z-ADD*ZERO     PVALD   50                      179591
     C                     MOVE *BLANKS   PCCY    3                       179591
      *                                                                                       CGL013
      ** If CGL013 is installed                                                               CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C                     MOVEL'N'       #1ADIN                                              CGL013
      *                                                                                       CGL013
     C           KRTV      CHAINGLJENXL2             54                                       CGL013
     C           *IN54     IFEQ *OFF                                                          CGL013
     C           BAADI1    ANDNE*BLANKS                                                       CGL013
     C                     MOVEL'*'       #1AIPI                                              CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE *BLANK    #1AIPI                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           CER030    IFEQ 'Y'                                                         BUG23742
      *                                                                                     BUG23742
     C           KRTV1     CHAINGLMNARL3             54                                     BUG23742
      *                                                                                     BUG23742
     C           *IN54     IFEQ *OFF                                                        BUG23742
     C           BAEX1     ANDNE*BLANKS                                                     BUG23742
      *                                                                                     BUG23742
     C                     MOVE '*'       #1AIP1                                            BUG23742
     C                     ELSE                                                             BUG23742
     C                     MOVE *BLANKS   #1AIP1                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
      * Hold existing record image
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MDIZ#K    BEGSR
      *================================================================
      * Initialise key screen
      *================================================================
     C                     MOVELP2BCDA    #PBCDA           Branch Code - A
     C                     MOVELP2DPCD    #PDPCD           Dept Code
     C                     Z-ADDP2HINC    #PHINC           Hash item no.ca
     C                     MOVELP2MBRB    #PMBRB           Multiple Branch
     C                     MOVELP1BTNB    #1BTNB           Batch number
     C                     Z-ADDP1BINB    #1BINB           Batch item no.
      * USER: Initialise key screen
      * CASE: PAR.Action Code is *Insert
     C           P6ACTC    IFEQ 'I'                        *IF
     C                     MOVELP1BTNB    #1BTNB           Batch number
      * RTV Last Batch Item - Standard functions  *
     C                     CALL 'GL0137U'              90  RTV Last Batch
     C                     PARM #1BTNB    WQ0082  3        Batch number
     C           WULINB    PARM *ZERO     WQ0083  30       Last item numbe
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C           1         ADD  WULINB    #1BINB           Batch item no.
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RIKS - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RIKS
     C*00/Copy Member GL0123R   Initialise Key Screen
     C                     END                             *FI
      *================================================================
     CSR         MDEXIT    ENDSR
      /EJECT
     CSR         NASUBR    BEGSR
      *================================================================
      * Check Cheque No is Blank
      *================================================================
      * CASE: PAR.Cheque number is Entered
     C           #1CQNB    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0104           Cheque number
      * Send message 'Cheque No. must be blank'
     C                     MOVEL'GLX0062' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9944  *
      *
     C                     END                             *FI
      *================================================================
     CSR         NAEXIT    ENDSR
      /EJECT
     CSR         NBSUBR    BEGSR
      *================================================================
      * Check For Back Valuations
      *================================================================
      * CASE: PAR.Value date (display) is Date entered
     C           #DVDDS    IFNE *BLANK                     *IF
     C                     MOVEL#DVDDS    WUWVDD           Work Value Date
      * Check VDate Blank Entries - Standard functions  *
     C                     CALL 'GL0131U'              90  Check VDate Bla
     C           WUWVDD    PARM WUWVDD    WQ0063  6        Value date (dis
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Check Numeric - Standard functions  *
     C                     MOVE *IN20     UUIN20  1
     C                     MOVE *IN21     UUIN21  1
     C                     MOVELWUWVDD    UUVLDT
     C                     MOVE '0'       UUVLDT
     C                     TESTN          UUVLDT       21
     C           *IN21     IFEQ '1'
     C                     MOVEL'0'       UUVLDT
     C                     END
     C                     TESTN          UUVLDT     20
     C           *IN20     IFEQ '0'
     C                     MOVE '*NUMERR' W0RTN
     C                     ELSE
     C                     MOVE *BLANKS   W0RTN
     C                     END
     C                     MOVE UUIN20    *IN20
     C                     MOVE UUIN21    *IN21
      * CASE: PGM.*Return code is *Numeric Error
     C           W0RTN     IFEQ '*NUMERR'                  *IF
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0105           Value date (dis
      * Send message 'Value Date not valid 1'
     C                     MOVEL'GLX0109' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0064  7        *Return code
     C                     PARM WUDTNF    WQ0065  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0066  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0067  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0106           Value date (dis
      * Send message 'Value Date not valid 2'
     C                     MOVEL'GLX0110' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    #DVDDS           Value date (dis
      * CASE: PAR.Value date GT WRK.Runday Number
     C           #1VLDT    IFGT WURDNO                     *IF
     C/COPY WNCPYSRC,GL0123RC88
     C           CGL010    ANDEQ'N'                                       CGL010
     C           CGL010    OREQ 'Y'                                       CGL010
     C           WUACTY    ANDEQ'N'                                       CGL010
     C           WAFVN     ANDEQ'N'                                       CGL010
     C           #1VLDT    ANDGTWURDNO                                    CGL010
     C           CGL010    OREQ 'Y'                                       CGL010
     C           WUACTY    ANDEQ'D'                                       CGL010
     C           WAFVD     ANDEQ'N'                                       CGL010
     C           #1VLDT    ANDGTWURDNO                                    CGL010
     C           CGL010    OREQ 'Y'                                       CGL010
     C           WUACTY    ANDEQ'C'                                       CGL010
     C           WAFVC     ANDEQ'N'                                       CGL010
     C           #1VLDT    ANDGTWURDNO                                    CGL010
     C           CGL010    OREQ 'Y'                                       CGL010
     C           WUACTY    ANDEQ'G'                                       CGL010
     C           WAFVG     ANDEQ'N'                                       CGL010
     C           #1VLDT    ANDGTWURDNO                                    CGL010
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0107           Value date (dis
      * Send message 'Value Date Must <= Today'
     C                     MOVEL'GLX0202' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
     C/COPY WNCPYSRC,GL0123RK04
      *
     C                     ELSE
     C/COPY WNCPYSRC,GL0123RC67
      * CASE: *OTHERWISE
      * VDate A/c Val- Not Retail - Standard functions  *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG  '  P@RTCD  7        B:Return code
     C                     PARM '*FIRST'  P@OPTN  7        I:Option
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C* Set Retail Key = Numeric Retail Account Number
     C                     MOVEL#1RACN    P@RETK 10
     C*
     C/COPY WNCPYSRC,GL0123RC29
     C                     CALL 'AOACCTR0'
     C                     PARM '*MSG   ' P@RTCD  7        B:Return code
     C                     PARM '*KEY'    P@OPTN  7        I:Option
     C                     PARM           P@RETK           I:Key field
     C                     PARM #1CUST    P@CNUM  6        I:Key field
     C                     PARM #1CYCD    P@CCY   3        I:Key field
     C**********           PARM #1ACCD    P@ACOD  4        I:Key field                        CGL029
     C                     PARM #1ACCD    P@ACOD 10                                           CGL029
     C                     PARM #1ACSN    P@ACSQ  2        I:Key field
     C                     PARM #1IBCA    P@IBCA  3        I:Key Field
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0123RC30
     C*
     C* EXTRACT BACK VALUEING PERIOD & CALCULATE BACK VALUE DATE
     C*
     C           WURDNO    SUB  BJBVPD    UUBRUN  50
     C*                                                                   CEU013
     C* If CEU013 switchable function is installed, the batch is from     CEU013
     C*   external interface, account currency is an 'In' currency,       CEU013
     C*   account code type is Nostro and the account is not found,       CEU013
     C*   the tests on account dates are skipped.  Account not found      CEU013
     C*   is not an error and only a warning.                             CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'N'                                       CEU013
     C           P@RTCD    ANDNE*BLANKS                                   CEU013
     C                     ELSE                                           CEU013
     C*                                                                   CEU013
     C*
     C**   CHECK AGAINST DATE THE BACK VALUE PERIOD
     C*
     C           #1VLDT    IFLT UUBRUN
     C           CGL150    IFEQ 'N'                                                           CGL150
     C                     MOVE '*BVLDER' W0RTN
     C                     ELSE                                                               CGL150
     C                     Z-ADDUUBRUN    #1VLDT                                              CGL150
     C                     ENDIF                                                              CGL150
     C                     END
     C*
     C**   CHECK AGAINST DATE THE ACCOUNT WAS OPENED
     C*
     C/COPY WNCPYSRC,GL0123RC31
     C           DACO      IFGT #1VLDT                       IF 1
     C           CGL149    ANDEQ'N'                                                           CGL149
     C           DACO      ORGT #1VLDT                                                        CGL149
     C           UUBRUN    ANDGT#1VLDT                                                        CGL149
     C           CGL149    ANDEQ'Y'                                                           CGL149
     C           CGL149    IFEQ 'N'                                                           CGL149
     C                     MOVE '*DTOPER' W0RTN
     C                     ELSE                                                               CGL149
     C                     MOVE '*BVLDER' W0RTN                                               CGL149
     C                     ENDIF                                                              CGL149
     C                     END                               END 1
     C/COPY WNCPYSRC,GL0123RC32
      * CASE: PGM.*Return code is Value Date Before Ac Open
     C           W0RTN     IFEQ '*DTOPER'                  *IF
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0108           Value date (dis
      * Send message 'Value Date not valid 4'
     C                     MOVEL'GLX0112' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef Back Value Date
     C           W0RTN     IFEQ '*BVLDER'                  *IF
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0109           Value date (dis
      * Send message 'Value Date not valid 5'
     C                     MOVEL'GLX0113' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     END                             *FI
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,GL0123RC68
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RK05
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD#1PTDT    #1VLDT           Value date
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM #1VLDT    WQ0068  50       Runday Number
     C                     PARM WUDTFF    WQ0069  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0070  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0071  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    #DVDDS
     C                     END                             *FI
      *================================================================
     CSR         NBEXIT    ENDSR
      /EJECT
     CSR         NCSUBR    BEGSR
      *================================================================
      * Check Associated Customer
      *================================================================
      * CASE: PAR.Associated Cust - Display is Entered
     C/COPY WNCPYSRC,GL0123RC96
     C           #DASCD    IFNE *BLANK                     *IF
      * start of Fix LN0334
      * CASE: PAR.Account code is Not Select
     C           #1ACCD    IFNE '?'                        *IF
      * Access Account Codes. - Account Codes  *
     C*
     C*  Access Account codes file for the following fields
     C*  A/c Type, A/c Name, Account Section, Account Subtype
     C*
     C                     MOVEL#1ACCD    UUACCD                          LN0334
     C/COPY WNCPYSRC,GL0123RC57
     C                     CALL 'AOACODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C**********           PARM           UUACCD  4        I:Account Code              LN0334 CGL029
     C********** D@ACOD    PARM *BLANK    UUFDY            O:Format                           CGL029
     C                     PARM           UUACCD 10                                           CGL029
     C           D@ACOD    PARM *BLANK    UUSDY                                               CGL029
      *                                                                                       CGL037
     C           CGL037    IFEQ 'Y'                                                           CGL037
      *                                                                                       CGL037
      ** If indicator U5 is ON, then account type should not be                               CGL037
      ** 'R'. If it is 'R', Account Subtype must be 'V' or 'I'.                               CGL037
      *                                                                                       CGL037
     C           *INU5     IFEQ '1'                                                           CGL037
     C           A5ACTY    IFEQ 'R'                                                           CGL037
     C           A5ACST    IFNE 'V'                                                           CGL037
     C           A5ACST    ANDNE'I'                                                           CGL037
     C                     MOVEL'XXX0202' ZAMSID                                              CGL037
     C                     EXSR ZASNMS                                                        CGL037
     C                     SETON                     993132                                   CGL037
     C                     SETON                     333435                                   CGL037
     C                     GOTO NCEXIT                                                        CGL037
     C                     END                                                                CGL037
     C                     END                                                                CGL037
     C                     END                                                                CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C/COPY WNCPYSRC,GL0123RC58
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA5ACCD    WUACCD           A/c Code       LN0334
     C                     MOVELA5ACTY    WUACTY           A/C Type
     C                     MOVELA5ACCN    WUACCN           A/c Name
     C                     MOVELA5ACSC    WUACSC           A/c Section
     C                     MOVELA5ACST    WUACST           A/c Sub-Type
     C*
     C                     END                             *FI
      * End of Fix LN0334
      * CASE: PAR.Associated Cust - Display is Select Requested
     C           #DASCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Client Details. - Client Details  *
     C*
     C*  Access CLient Details file for the following fields
     C*  Customer No., Customer shortname, DRS Shortname,
     C*  Location, Customer SWIFT I.D.
     C*  Account Officer code                                             S10736
     C*
     C                     CALL 'AOCUSTR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM #DASCD    UUCNCD 10        I:Client Key
     C                     PARM           UUCRST  7        O:Key status
     C           D@CUST    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUCRST    WUCRST           Key Status  ber
     C*
     C                     MOVELBBCUST    WUACNB           Customer Number
     C                     MOVELBBCSSN    WUCSSN           Shortname
     C                     MOVELBBDRCS    WUDRCS           DRS Shortname
     C                     MOVELBBLCCD    WULCCD           Location
     C                     MOVELBBCSID    WUCSID           SWIFT ID
     C                     MOVELBBACOC    WUACOC           SWIFT ID
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C           WUAPRC    OREQ '*CUSCLS'                                                     CGL148
     C           WUAPRC    OREQ '*CUSDEL'                                                     CGL148
      * Setup message data for message
     C                     MOVEL#DASCD    ZA0110           Associated Cust
      * Send message 'Assoc.Cust.No/Shortname 1'
     C                     MOVEL'GLX0198' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9945  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DASCD           Associated Cust
     C                     MOVELWUACNB    #DASCD           Associated Cust
     C                     MOVELWUACNB    #1ACNB           Assoc. Customer
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #1ACNB           Assoc. Customer
     C/COPY WNCPYSRC,GL0123MK17
      *                                                                                      LLN022A
      ** If Profit/Loss switchable feature is on                                             LLN022A
      *                                                                                      LLN022A
     C           LLN021    IFEQ 'Y'                                                          LLN022A
     C           #1ACCD    ANDNE*BLANK                                                       LLN022A
      *                                                                                      LLN022A
      ** Access Account codes file for the following fields                                  LLN022A
      ** Account Section.                                                                    LLN022A
      *                                                                                      LLN022A
     C                     MOVEL#1ACCD    UUACCD                                             LLN022A
     C                     CALL 'AOACODR0'                                                   LLN022A
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd                       LLN022A
     C                     PARM '*KEY'    UUAPOP  7        I:Option                          LLN022A
     C                     PARM           UUACCD 10        I:Account Code                    LLN022A
     C           D@ACOD    PARM *BLANK    UUFDY            O:Format                          LLN022A
      *                                                                                      LLN022A
      ** Assign work field to file field values                                              LLN022A
      *                                                                                      LLN022A
     C                     MOVELA5ACSC    WUACSC           A/c Section                       LLN022A
      *                                                                                      LLN022A
      ** Entry in associated cust field mandatory if account code is                         LLN022A
      ** if account code is income or expense.                                               LLN022A
      *                                                                                      LLN022A
     C           WUACSC    IFEQ 'IN'                                                         LLN022A
     C           WUACSC    OREQ 'EX'                                                         LLN022A
      *                                                                                      LLN022A
      ** Send message 'Number of Items invalid'                                              LLN022A
      *                                                                                      LLN022A
     C                     MOVEL'XXUSRMSG'ZAMSGF                                             LLN022A
     C                     MOVEL'XXX0010' ZAMSID                                             LLN022A
     C                     EXSR ZASNMS                                                       LLN022A
     C                     SETON                     9945                                    LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC80
      *================================================================
     CSR         NCEXIT    ENDSR
      /EJECT
     CSR         NDSUBR    BEGSR
      *================================================================
      * Check Profit Centre Code
      *================================================================
      * CASE: PAR.Profit centre is Entered
     C           #1PRCN    IFNE *BLANK                     *IF
      * CASE: WRK.Profit Centres Used is Yes
     C           WUPRCU    IFEQ 'Y'                        *IF
      * CASE: PAR.Profit centre is Select requested
     C           #1PRCN    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access profit Centre - Profit Centres  *
     C*
     C*  Access Def centre code off file.
     C*
     C                     MOVEL#1PRCN    UUPCCD
     C                     CALL 'AOPRFCR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUPCCD  4        I:Profit Cent
     C           D@PRFC    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELDSPCCD    WUPRCN           Profit Centre
     C                     MOVELDSPCCD    WUPCDS           Prof Cent Desc
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0111           Profit centre
      * Send message 'Profit Centres         NF'
     C                     MOVEL'GLX0182' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9947  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUPRCN    #1PRCN           Profit centre
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Profit Centre Def'ts Used is Yes
     C           WUPCDU    IFEQ 'Y'                        *IF
      * Access Prof C Def Matrix. - Profit Centre Dft Matrix  *
     C*
     C*  Access Def Prof centre code off file.
     C*
     C                     CALL 'AOPRFMR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM #1BKCD    UUBKCD  2        I:Book Code
     C                     PARM #1TRTY    UUPCTT  5        I:Trans Type
     C                     PARM #1TSTY    UUSBTY  2        I:Sub Type
     C                     PARM #1IBCA    UUBRCD  3        I:Branch Code
     C                     PARM WUDPCD    UUDPCD  3        I:Department
     C                     PARM ##USR     UUUSID 10        I:User Profile
     C                     PARM WUACOC    UUACOC  2        I:A/c Officer
     C                     PARM #1ACNB    UUCUST  6        I:Customer No.
     C                     PARM *BLANK    UUPCCD  4        O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUPCCD    WUPRCN           Profit Centre
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 0
     C           WUAPRC    IFEQ '0'                        *IF
     C                     MOVELWUPRCN    #1PRCN           Profit centre
     C                     ELSE
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 1
     C           WUAPRC    IFEQ '1'                        *IF
     C                     MOVEL*BLANK    #1PRCN           Profit centre
     C                     ELSE
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 2
     C           WUAPRC    IFEQ '2'                        *IF
     C                     MOVELWUPRCN    #1PRCN           Profit centre
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0112           Profit centre
      * Send message 'Def Prof Centre Not Found'
     C                     MOVEL'GLX0203' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9947  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         NDEXIT    ENDSR
      /EJECT
     CSR         NESUBR    BEGSR
      *================================================================
      * Setup Branch code (Header) & Posting Date on RCD
      *================================================================
     C                     MOVELP2BCDA    #1BCBH           Branch Code (Ba
     C                     Z-ADDWURDNO    #1PTDT           Posting date
      *================================================================
     CSR         NEEXIT    ENDSR
      /EJECT
     CSR         NFSUBR    BEGSR
      *================================================================
      * Check Users Branch Authority
      *================================================================
      * CASE: DTL.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * Val. Action Cde & Bch U/P - Standard functions  *
     C                     CALL 'ZVACTBU'              90  Val. Action Cde
     C                     PARM 'A'       WQ0072  1        SPF Action Code
     C                     PARM #1IBCA    WQ0073  3        Branch code
     C           WUSPEC    PARM *ZERO     WQ0074  10       SPF Error Condi
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.SPF Error Condition is One
     C           WUSPEC    IFEQ 1                          *IF
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0113           Input Branch Co
      * Send message 'SPF Atn Cde ERR 1 ZVACTBU'
     C                     MOVEL'GLX0186' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9935  *
      *
     C                     ELSE
      * CASE: WRK.SPF Error Condition is Two
     C           WUSPEC    IFEQ 2                          *IF
      * Setup message data for message
     C                     MOVEL'A'       ZA0114           SPF Action Code
     C                     MOVEL#1IBCA    ZA0115           Input Branch Co
      * Send message 'SPF Atn Cde ERR 5 ZVACTBU'
     C                     MOVEL'GLX0206' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9935  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         NFEXIT    ENDSR
      /EJECT
     CSR         SACHRC    BEGSR
      *================================================================
      * Change GL Batch posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before DBF read
      * CASE: WRK.Abbreviated Posting? is Yes
     C           WUABPS    IFEQ 'Y'                        *IF
      * E18852 - Branch Code of Trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL*BLANK    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C/COPY WNCPYSRC,GL0123RC47
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0123RC48
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * End of Fix LN0315
     C*
     C* If CEU013 is installed, the batch is from external interface,     CEU013
     C*  account currency is an 'In' currency, the account code type is   CEU013
     C*  retail or Nostro and account does not exist, the value from      CEU013
     C*  Account code is used instead of the work field.                  CEU013
     C*  The work field has been overwritten with the previous account    CEU013
     C*  value.                                                           CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C*                                                                   CEU013
     C           CEU013    OREQ 'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'N'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVE A5ACTY    WUACTY                          CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0011           Account Identif
     C                     MOVEL#1CYCD    ZA0012           Currency code
     C                     MOVEL#1ACCD    ZA0013           Account code
     C                     MOVEL#1ACSN    ZA0014           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993233*
     C                     SETON                     34    *
      *
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
      * Was posting Retail? - Journal Entry Posting  *
     C                     EXSR SBRVGN
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0015           Account Identif
     C                     MOVEL#1CYCD    ZA0016           Currency code
     C                     MOVEL#1ACCD    ZA0017           Account code
     C                     MOVEL#1ACSN    ZA0018           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993233*
     C                     SETON                     34    *
      *
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Move key fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
      *
     C           KLCHSA    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
     C           KLCHSA    CHAIN@BTREAK              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SAEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SAEXIT
     C                     END
      *                                                                   CGL016
      * Save Batch info                                                   CGL016
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
     C                     MOVE BTIBCA    W0IBCA  3                       CGL016
     C                     MOVE BTCUST    W0CUST  6                       CGL016
     C                     MOVE BTCYCD    W0CYCD  3                       CGL016
     C**********           MOVE BTACCD    W0ACCD  4                                    CGL016 CGL029
     C                     MOVE BTACCD    W0ACCD 10                                           CGL029
     C                     MOVE BTACSN    W0ACSN  2                       CGL016
     C                     MOVE BTPTAM    W0PTAM 130                      CGL016
     C                     MOVE BTDCIN    W0DCIN  1                       CGL016
     C                     MOVE BTVLDT    W0VLDT  50                      CGL016
E1   C                     ENDIF                                          CGL016
      *
      * Move non-key fields to @BTREAK
     C                     MOVEL#1IBCA    BTIBCA           Input Branch Co
     C                     MOVEL#1CUST    BTCUST           Customer number
     C                     MOVEL#1CYCD    BTCYCD           Currency code
     C                     MOVEL#1ACCD    BTACCD           Account code
     C                     MOVEL#1ACSN    BTACSN           Account sequenc
     C                     MOVEL#1NNBI    BTNNBI           Nostro number (
     C                     Z-ADD#1RACN    BTRACN           Retail account
     C                     MOVEL#1RINO    BTRINO           Retail ind.: Ov
     C                     MOVEL#1RINE    BTRINE           Retail ind.: Er
     C                     MOVEL#1TRTY    BTTRTY           Transaction typ
     C                     Z-ADD#1PTAM    BTPTAM           Posting amount
     C                     MOVEL#1DCIN    BTDCIN           Debit/credit in
     C                     Z-ADD#1PTDT    BTPTDT           Posting date
     C                     Z-ADD#1VLDT    BTVLDT           Value date
     C                     MOVEL#1NVCD    BTNVCD           Narrative code
     C                     MOVEL#1NRDC    BTNRDC           Narrative descr
     C                     MOVEL#1ACTY    BTACTY           Account type
     C                     MOVEL#1ACNB    BTACNB           Assoc. Customer
     C                     MOVEL#1CQNB    BTCQNB           Cheque number
     C                     MOVEL#1COIN    BTCOIN           Customer origin
     C                     MOVEL#1SWCR    BTSWCR           Swift common re
     C                     MOVEL#1PRCN    BTPRCN           Profit centre
     C/COPY WNCPYSRC,GL0123RC18
     C                     MOVELWUBCBH    BTBCBH           Branch Code (Ba
     C/COPY WNCPYSRC,GL0123RC19
     C                     MOVEL#1RADP    BTRADP           Retail advice p
     C                     MOVEL#1SHPI    BTSHPI           Shadow post ind
     C                     Z-ADD#1RRNM    BTRRNM           Relative rec no
     C                     MOVEL#1RNBE    BTRNBE           Retail Number E
     C                     MOVELWURARC    BTRARC           Retail Ac Refer
     C                     MOVEL#1TSTY    BTTSTY           Transaction (Su
     C                     MOVEL#1BKCD    BTBKCD           Book Code
     C                     Z-ADD#1SPFC    BTSPFC           Spread Factor
     C                     MOVEL#1RVDI    BTRVDI           Reverse/Void In
     C                     Z-ADD#1NITM    BTNITM           Number of Items
     C                     MOVEL#1OCCY    BTOCCY           Original Ccy   CEU013
     C                     Z-ADD#1OAMT    BTOAMT           Original AmountCEU013
      *
      * USER: Processing before DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MBDU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0181MBDU
     C*
     C                     END                             *FI
     C                     UPDAT@BTREAK                91  *
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *                                                                   CGL016
      * Lock the record again                                             CGL016
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
      *                                                                   CGL016
B2   C           BTIBCA    IFNE W0IBCA                                    CGL016
     C           BTCUST    ORNE W0CUST                                    CGL016
     C           BTCYCD    ORNE W0CYCD                                    CGL016
     C           BTACCD    ORNE W0ACCD                                    CGL016
     C           BTACSN    ORNE W0ACSN                                    CGL016
     C           BTPTAM    ORNE W0PTAM                                    CGL016
     C           BTDCIN    ORNE W0DCIN                                    CGL016
     C           BTVLDT    ORNE W0VLDT                                    CGL016
      *                                                                   CGL016
     C           KLCHSA    CHAIN@BTREAK              9394                 CGL016
      *                                                                   CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      *                                                                                       CGL013
      ** Additional Information Maintenance Screen                                            CGL013
      *                                                                                       CGL013
     C           PREV1     TAG                                                              BUG23742
      *                                                                                     BUG23742
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C           #1ADIN    ANDEQ'Y'                                                           CGL013
     C                     MOVEL#1BTNB    PABTNB                                              CGL013
     C                     MOVELBTBINB    PABINB                                              CGL013
     C                     MOVEL#1RACN    PARACN                                              CGL013
      *                                                                                     BUG23742
     C           CER030    IFEQ 'Y'                                                         BUG23742
     C                     EXSR SCHK86                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     CALL 'GL000185'                                                    CGL013
     C                     PARM *BLANKS   PRTCD                                               CGL013
     C                     PARM           PDETLS                                              CGL013
     C                     PARM *BLANK    PADD    1                                           CGL013
     C                     PARM 'M'       PMODE   1                                           CGL013
     C                     PARM '0'       PEXIT1  1                                         BUG23742
     C                     PARM '0'       PCANC1  1                                         BUG23742
     C                     PARM           PVBIPX                                              246418
     C                     PARM 'N'       APIMOD  1                                           246418
     C                     PARM           FLDNMA                                              246418
     C                     PARM           MSGIDA                                              246418
     C                     PARM           MSGDTA                                              246418
      *                                                                                       CGL013
     C**********           MOVE 'N'       #1ADIN                                     CGL013 BUG23742
     C           PADD      IFEQ 'Y'                                                           CGL013
     C                     MOVE '*'       #1AIPI                                              CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE *BLANK    #1AIPI                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           PCANC1    IFEQ '1'                                                         BUG23742
     C                     MOVE 'N'       #1ADIN                                            BUG23742
     C                     GOTO SAEXIT                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PEXIT1    IFEQ '1'                                                         BUG23742
     C                     EXSR ZYEXPG                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                              CGL013
      *                                                                                     BUG23742
     C           CER030    IFEQ 'Y'                                                         BUG23742
     C           #1ADIN    ANDEQ'Y'                                                         BUG23742
      *                                                                                     BUG23742
     C                     MOVEL#1BTNB    PABTNB                                            BUG23742
     C                     MOVELBTBINB    PABINB                                            BUG23742
     C                     MOVEL#1RACN    PARACN                                            BUG23742
     C                     MOVELBTPTDT    PDATE                                             BUG23742
     C                     EXSR SCHK85                                                      BUG23742
      *                                                                                     BUG23742
     C                     CALL 'GL000186'                                                  BUG23742
     C                     PARM *BLANKS   PRTCD                                             BUG23742
     C                     PARM           PDETLS                                            BUG23742
     C                     PARM           PDATE   50                                        BUG23742
     C                     PARM *BLANKS   PADD    1                                         BUG23742
     C                     PARM 'M'       PMODE   1                                         BUG23742
     C                     PARM '0'       PEXIT   1                                         BUG23742
     C                     PARM '0'       PCANC   1                                         BUG23742
     C                     PARM           FLDNMA                                            BUG23742
     C                     PARM           MSGIDA                                            BUG23742
     C                     PARM           MSGDTA                                            BUG23742
      *                                                                                     BUG23742
     C           PADD      IFEQ 'Y'                                                         BUG23742
     C                     MOVE '*'       #1AIP1                                            BUG23742
     C                     ELSE                                                             BUG23742
     C                     MOVE *BLANKS   #1AIP1                                            BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PCANC     IFEQ '1'                                                         BUG23742
      *                                                                                     BUG23742
     C           CGL013    IFEQ 'Y'                                                         BUG23742
     C                     GOTO PREV1                                                       BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PEXIT     IFEQ '1'                                                         BUG23742
     C                     EXSR ZYEXPG                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
     C*                                                                   095580
     C** Copy updated @1DBRC to #1DBRC                                    095580
     C*                                                                   095580
     C                     MOVE @1DBRC    #1DBRC                          095580
     C*                                                                   095580
      *                                                                   CGL016
      * Verify any change in details for batch entered - CGL016           CGL016
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
      *                                                                   CGL016
B2   C           BTIBCA    IFNE W0IBCA                                    CGL016
     C           BTCUST    ORNE W0CUST                                    CGL016
     C           BTCYCD    ORNE W0CYCD                                    CGL016
     C           BTACCD    ORNE W0ACCD                                    CGL016
     C           BTACSN    ORNE W0ACSN                                    CGL016
     C           BTPTAM    ORNE W0PTAM                                    CGL016
     C           BTDCIN    ORNE W0DCIN                                    CGL016
     C           BTVLDT    ORNE W0VLDT                                    CGL016
      *                                                                   CGL016
B3   C           BTSHPI    IFEQ 'Y'                                       CGL016
      *                                                                   CGL016
      * Revert entry                                                      CGL016
     C                     MOVE W0IBCA    BTIBCA                          CGL016
     C                     MOVE W0CUST    BTCUST                          CGL016
     C                     MOVE W0CYCD    BTCYCD                          CGL016
     C                     MOVE W0ACCD    BTACCD                          CGL016
     C                     MOVE W0ACSN    BTACSN                          CGL016
     C                     MOVE W0PTAM    BTPTAM                          CGL016
     C                     MOVE W0DCIN    BTDCIN                          CGL016
     C                     MOVE W0VLDT    BTVLDT                          CGL016
      *                                                                   CGL016
B4   C           BTDCIN    IFEQ 'D'                                       CGL016
     C                     MOVE 'C'       BTDCIN                          CGL016
X4   C                     ELSE                                           CGL016
     C                     MOVE 'D'       BTDCIN                          CGL016
E4   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     CALL 'GL004446'                                CGL016
     C                     PARM *BLANKS   UUAPRC                          CGL016
     C                     PARM           @1DBRC                          CGL016
      *                                                                   CGL016
B4   C           UUAPRC    IFNE *BLANKS                                   CGL016
     C                     MOVE *ON       *IN91                           CGL016
     C                     MOVEL'Y2U0004' W0RTN                           CGL016
     C                     GOTO SAEXIT                                    CGL016
E4   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     MOVEL#1DBRC    @1DBRC                          CGL016
      *                                                                   CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      * Accessing accounts to see whether Retail or not                   CGL016
      *                                                                   CGL016
     C                     CALL 'AOACCTR0'                                CGL016
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CGL016
     C                     PARM '*KEY'    UUAPOP  7        B:Option       CGL016
     C                     PARM *BLANKS   UUACID 10        I:Account IdentCGL016
     C                     PARM           BTCUST  6        I:Customer NumbCGL016
     C                     PARM           BTCYCD  3        I:Currency CodeCGL016
     C**********           PARM           BTACCD  4        I:Account Code              CGL016 CGL029
     C                     PARM           BTACCD                                              CGL029
     C                     PARM           BTACSN  2        I:Account SequeCGL016
     C                     PARM           BTIBCA  3        I:Branch code  CGL016
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format       CGL016
      *                                                                   CGL016
      * Accessing end date                                                CGL016
      *                                                                   CGL016
B3   C           ATYP      IFEQ 'R'                                       CGL016
      *                                                                   CGL016
      * Yes: call helper program                                          CGL016
     C                     CALL 'GL004446'                                CGL016
     C                     PARM *BLANKS   UUAPRC                          CGL016
     C                     PARM           @1DBRC                          CGL016
      *                                                                   CGL016
B4   C           UUAPRC    IFNE *BLANKS                                   CGL016
     C                     MOVE *ON       *IN91                           CGL016
     C                     MOVEL'Y2U0004' W0RTN                           CGL016
     C                     GOTO SAEXIT                                    CGL016
E4   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     MOVE 'Y'       BTSHPI                          CGL016
      *                                                                   CGL016
X3   C                     ELSE                                           CGL016
      *                                                                   CGL016
     C                     MOVE ' '       BTSHPI                          CGL016
      *                                                                   CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
B3   C           *IN93     IFEQ *OFF                                      CGL016
     C           *IN94     ANDEQ*OFF                                      CGL016
     C                     UPDAT@BTREAK                                   CGL016
     C                     EXSR MBFL#1                                    CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      * DBF change successful
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MADU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0181MADU
     C*
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Was posting Retail? - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Move fields to key list
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
     C           KRSSB     CHAIN@BTREAL              90    *
      * DBF record not found
     C   90                MOVEL'GLX0176' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process DBF record
      * PAR = DB1 By name
     C                     MOVELBTACTY    WUACTY           Account type
     C                     END
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCRVGN    BEGSR
      *================================================================
      * rtv Templated Record - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSC     KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Move fields to key list
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADDP1BINB    BTBINB           Batch item no.
     C           KRSSC     CHAIN@BTREAL              90    *
     C           *IN90     IFEQ '1'
      * DBF record not found
     C                     MOVEL'GLX0176' W0RTN   7
      * USER: Processing if DBF record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SCEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process DBF record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELBTIBCA    #1IBCA           Input Branch Co
     C                     MOVELBTCUST    #1CUST           Customer number
     C                     MOVELBTCYCD    #1CYCD           Currency code
     C                     MOVELBTACCD    #1ACCD           Account code
     C                     MOVELBTACSN    #1ACSN           Account sequenc
     C                     Z-ADDBTRACN    #1RACN           Retail account
     C                     MOVELBTTRTY    #1TRTY           Transaction typ
     C                     Z-ADDBTPTAM    #1PTAM           Posting amount
     C                     MOVELBTDCIN    #1DCIN           Debit/credit in
     C                     Z-ADDBTVLDT    #1VLDT           Value date
     C                     MOVELBTNVCD    #1NVCD           Narrative code
     C                     MOVELBTNRDC    #1NRDC           Narrative descr
     C                     MOVELBTACNB    #1ACNB           Assoc. Customer
     C                     MOVELBTCQNB    #1CQNB           Cheque number
     C                     MOVELBTSWCR    #1SWCR           Swift common re
     C                     MOVELBTPRCN    #1PRCN           Profit centre
     C                     MOVELBTRNBE    #1RNBE           Retail Number E
     C                     MOVELBTOCCY    #1OCCY           Original Ccy   CEU013
     C                     Z-ADDBTOAMT    #1OAMT           Original AmountCEU013
     C                     Z-ADD*ZERO     PVALD   50                      179591
     C                     MOVE *BLANKS   PCCY    3                       179591
     C                     END
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDCRRC    BEGSR
      *================================================================
      * Create GL Btch Post LCL - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
     C                     MOVEL#1IBCA    BTIBCA           Input Branch Co
     C                     MOVEL#1CUST    BTCUST           Customer number
     C                     MOVEL#1CYCD    BTCYCD           Currency code
     C                     MOVEL#1ACCD    BTACCD           Account code
     C                     MOVEL#1ACSN    BTACSN           Account sequenc
     C                     MOVEL#1NNBI    BTNNBI           Nostro number (
     C                     Z-ADD#1RACN    BTRACN           Retail account
     C                     MOVEL#1RINO    BTRINO           Retail ind.: Ov
     C                     MOVEL#1RINE    BTRINE           Retail ind.: Er
     C                     MOVEL#1TRTY    BTTRTY           Transaction typ
     C                     Z-ADD#1PTAM    BTPTAM           Posting amount
     C                     MOVEL#1DCIN    BTDCIN           Debit/credit in
     C                     Z-ADD#1PTDT    BTPTDT           Posting date
     C                     Z-ADD#1VLDT    BTVLDT           Value date
     C                     MOVEL#1NVCD    BTNVCD           Narrative code
     C                     MOVEL#1NRDC    BTNRDC           Narrative descr
     C                     MOVEL#1ACTY    BTACTY           Account type
     C                     MOVEL#1ACNB    BTACNB           Assoc. Customer
     C                     MOVEL#1CQNB    BTCQNB           Cheque number
     C                     MOVEL#1COIN    BTCOIN           Customer origin
     C                     MOVEL#1SWCR    BTSWCR           Swift common re
     C                     MOVEL#1PRCN    BTPRCN           Profit centre
     C/COPY WNCPYSRC,GL0123RC20
     C                     MOVEL#1BCBH    BTBCBH           Branch Code (Ba
     C/COPY WNCPYSRC,GL0123RC21
     C                     MOVEL#1RADP    BTRADP           Retail advice p
     C                     MOVEL#1SHPI    BTSHPI           Shadow post ind
     C                     Z-ADD#1RRNM    BTRRNM           Relative rec no
     C                     MOVEL#1RNBE    BTRNBE           Retail Number E
     C                     MOVEL#1RARC    BTRARC           Retail Ac Refer
     C                     MOVEL#1TSTY    BTTSTY           Transaction (Su
     C                     MOVEL#1BKCD    BTBKCD           Book Code
     C                     Z-ADD#1SPFC    BTSPFC           Spread Factor
     C                     MOVEL#1RVDI    BTRVDI           Reverse/Void In
     C                     Z-ADD#1NITM    BTNITM           Number of Items
     C                     MOVEL#1OCCY    BTOCCY           Original Ccy   CEU013
     C                     Z-ADD#1OAMT    BTOAMT           Original AmountCEU013
      *
      * USER: Processing before DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * CASE: WRK.Window processing requir. is Yes
     C           WUWDPR    IFEQ 'Y'                        *IF
      * Start of Fix LN0334
      * Call Window Manager - Standard functions  *
     C*  Call Window Manager Program
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0123RCP9                                           S01408
     C*                                                                   S01408
     C                     CALL 'WN0010'
     C                     PARM ##PGM     UPGM   10        Calling PGM    LN0355
     C                     PARM *BLANK    UFKEY   2        Function Key   LN0355
     C                     PARM 'I'       UACODE  1        Action Code    LN0355
     C                     PARM           DATA             Trans Key      LN0355
     C                     PARM *BLANKS   W0RTN            Return code    LN0355
     C                     PARM           SPARE 256        Spare          LN0355
      * End of Fix LN0334
      * Check WM Return Code
      * CASE: PAR.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C/COPY WNCPYSRC,GL0123RC90
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     ELSE
      * CASE: PAR.*Return code is WN Window Error
     C           W0RTN     IFEQ 'USR0563'                  *IF
      * Send message 'WN Window Error'
     C                     MOVEL'USR0563' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SDEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.*Return code is *DBF update error
     C           W0RTN     IFEQ 'Y2U0004'                  *IF
      * Send message 'WN Database Error'
     C                     MOVEL'GLX0138' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SDEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.*Return code is previous screen
     C           W0RTN     IFEQ 'USR0790'                  *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SDEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * 00/Copy Member GL0123RCBW - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RCBW
     C*00/Copy Member GL0123R   Proc Before Create - WN
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0123RC10                                           S01408
     C*                                                                   S01408
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RCBU - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RCBU
     C*00/Copy Member GL0123R   Processing Before Create
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC74
     C           KLCRSD    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Check for duplicate primary key
     C           KLCRSD    SETLL@BTREAK                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'GLX0175' W0RTN   7
      * Send message 'Journal Entry Posting  EX'
     C                     MOVEL'GLX0175' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     END
      *
     C                     MOVEASTAMP,1   BTTMST           Default Timestamp                  CPK015
     C                     WRITE@BTREAK                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
      *                                                                   CGL016
     C           KLCRSD    CHAIN@BTREAK              9394                 CGL016
      *                                                                   CGL016
      * Accessing accounts to see whether Retail or not                   CGL016
      *                                                                   CGL016
     C                     CALL 'AOACCTR0'                                CGL016
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CGL016
     C                     PARM '*KEY'    UUAPOP  7        B:Option       CGL016
     C                     PARM *BLANKS   UUACID 10        I:Account IdentCGL016
     C                     PARM           BTCUST  6        I:Customer NumbCGL016
     C                     PARM           BTCYCD  3        I:Currency CodeCGL016
     C**********           PARM           BTACCD  4        I:Account Code              CGL016 CGL029
     C                     PARM           BTACCD                                              CGL029
     C                     PARM           BTACSN  2        I:Account SequeCGL016
     C                     PARM           BTIBCA  3        I:Branch code  CGL016
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format       CGL016
      *                                                                   CGL016
      * Accessing end date                                                CGL016
      *                                                                   CGL016
B2   C           ATYP      IFEQ 'R'                                       CGL016
      *                                                                   CGL016
     C                     CALL 'GL004446'                                CGL016
     C                     PARM *BLANKS   UUAPRC                          CGL016
     C                     PARM           @1DBRC                          CGL016
      *                                                                   CGL016
B3   C           UUAPRC    IFNE *BLANKS                                   CGL016
     C                     MOVE *ON       *IN91                           CGL016
     C                     MOVEL'Y2U0004' W0RTN                           CGL016
     C                     GOTO SDEXIT                                    CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     MOVE 'Y'       BTSHPI                          CGL016
      *                                                                   CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
B2   C           *IN93     IFEQ *OFF                                      CGL016
     C           *IN94     ANDEQ*OFF                                      CGL016
     C                     UPDAT@BTREAK                                   CGL016
     C                     EXSR MBFL#1                                    CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      *                                                                                       CGL013
      ** Additional Information Maintenance Screen                                            CGL013
      *                                                                                       CGL013
     C           PREV2     TAG                                                              BUG23742
      *                                                                                     BUG23742
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C           #1ADIN    ANDEQ'Y'                                                           CGL013
     C                     MOVEL#1BTNB    PABTNB                                              CGL013
     C                     MOVELBTBINB    PABINB                                              CGL013
     C                     MOVEL#1RACN    PARACN                                              CGL013
      *                                                                                     BUG23742
     C           CER030    IFEQ 'Y'                                                         BUG23742
     C                     EXSR SCHK86                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     CALL 'GL000185'                                                    CGL013
     C                     PARM *BLANKS   PRTCD                                               CGL013
     C                     PARM           PDETLS                                              CGL013
     C                     PARM *BLANK    PADD                                                CGL013
     C                     PARM 'M'       PMODE                                               CGL013
     C                     PARM '0'       PEXIT1                                            BUG23742
     C                     PARM '0'       PCANC1                                            BUG23742
     C                     PARM           PVBIPX                                              246418
     C                     PARM 'N'       APIMOD  1                                           246418
     C                     PARM           FLDNMA                                              246418
     C                     PARM           MSGIDA                                              246418
     C                     PARM           MSGDTA                                              246418
      *                                                                                       CGL013
     C           PCANC1    IFEQ '1'                                                         BUG23742
     C                     MOVE 'N'       #1ADIN                                            BUG23742
     C                     GOTO SDEXIT                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PEXIT1    IFEQ '1'                                                         BUG23742
     C                     EXSR ZYEXPG                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           CER030    IFEQ 'Y'                                                         BUG23742
     C           #1ADIN    ANDEQ'Y'                                                         BUG23742
      *                                                                                     BUG23742
     C                     MOVEL#1BTNB    PABTNB                                            BUG23742
     C                     MOVELBTBINB    PABINB                                            BUG23742
     C                     MOVEL#1RACN    PARACN                                            BUG23742
     C                     MOVELBTPTDT    PDATE                                             BUG23742
     C                     EXSR SCHK85                                                      BUG23742
      *                                                                                     BUG23742
     C                     CALL 'GL000186'                                                  BUG23742
     C                     PARM *BLANKS   PRTCD                                             BUG23742
     C                     PARM           PDETLS                                            BUG23742
     C                     PARM           PDATE                                             BUG23742
     C                     PARM *BLANKS   PADD    1                                         BUG23742
     C                     PARM 'M'       PMODE   1                                         BUG23742
     C                     PARM '0'       PEXIT   1                                         BUG23742
     C                     PARM '0'       PCANC   1                                         BUG23742
     C                     PARM           FLDNMA                                            BUG23742
     C                     PARM           MSGIDA                                            BUG23742
     C                     PARM           MSGDTA                                            BUG23742
      *                                                                                     BUG23742
     C           PCANC     IFEQ '1'                                                         BUG23742
      *                                                                                     BUG23742
     C           CGL013    IFEQ 'Y'                                                         BUG23742
     C                     GOTO PREV2                                                       BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PEXIT     IFEQ '1'                                                         BUG23742
     C                     EXSR ZYEXPG                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
      * DBF write successful
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RCAU - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RCAU
     C*00/Copy Member GL0123R   Processing After Create
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC82
     C                     END
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SEDLRC    BEGSR
      *================================================================
      * Delete GL Btch Post LCL - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before DBF update
      * CASE: PAR.Action Code is *Delete
     C           P6ACTC    IFEQ 'D'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Send message 'Function Key Not Allowed'
     C                     MOVEL'GLX0131' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     MOVEL'Y2U0004' W0RTN            *Return code
     C                     GOTO SEEXIT                     *QUIT
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * CASE: WRK.Window processing requir. is Yes
     C           WUWDPR    IFEQ 'Y'                        *IF
      * Start of Fix LN0334
      * Call Window Manager - Standard functions  *
     C*  Call Window Manager Program
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0123RC11                                           S01408
     C*                                                                   S01408
     C                     CALL 'WN0010'
     C                     PARM ##PGM     UPGM   10        Calling PGM    LN0355
     C                     PARM *BLANK    UFKEY   2        Function Key   LN0355
     C                     PARM 'D'       UACODE  1        Action Code    LN0355
     C                     PARM           DATA             Trans Key      LN0355
     C                     PARM *BLANKS   W0RTN            Return code    LN0355
     C                     PARM           SPARE 256        Spare          LN0355
      * End of Fix LN0334
      * Check WM Return Code
      * CASE: PAR.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C/COPY WNCPYSRC,GL0123RC91
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     ELSE
      * CASE: PAR.*Return code is WN Window Error
     C           W0RTN     IFEQ 'USR0563'                  *IF
      * Send message 'WN Window Error'
     C                     MOVEL'USR0563' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SEEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.*Return code is *DBF update error
     C           W0RTN     IFEQ 'Y2U0004'                  *IF
      * Send message 'WN Database Error'
     C                     MOVEL'GLX0138' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SEEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.*Return code is previous screen
     C           W0RTN     IFEQ 'USR0790'                  *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SEEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * 00/Copy Member GL0123RDBW - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RDBW
     C*00/Copy Member GL0123R   Proc Before Delete - WN
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0123RC12                                           S01408
     C*                                                                   S01408
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RDBU - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RDBU
     C*00/Copy Member GL0123R   Processing Before Delete
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC75
      * Move key fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
      *
     C           KLDLSE    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      *                                                                                     BUG23742
     C           KLDLS1    KLIST                                                            BUG23742
     C                     KFLD           BTPTDT                                            BUG23742
     C                     KFLD           BTBTNB                                            BUG23742
     C                     KFLD           BTBINB                                            BUG23742
      *                                                                                     BUG23742
     C           KLDLSE    CHAIN@BTREAK              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SEEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Use SETLL to release record lock
     C           KLDLSE    SETLL@BTREAK              9091  *
     C                     GOTO SEEXIT
     C                     END                             FI #1DBRC
      *................................................................
     C                     DELET@BTREAK                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF delete successful
      * USER: Processing after DBF update
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
      *                                                                   CGL016
B2   C           BTSHPI    IFEQ 'Y'                                       CGL016
      *                                                                   CGL016
B3   C           BTDCIN    IFEQ 'D'                                       CGL016
     C                     MOVE 'C'       BTDCIN                          CGL016
X3   C                     ELSE                                           CGL016
     C                     MOVE 'D'       BTDCIN                          CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     CALL 'GL004446'                                CGL016
     C                     PARM *BLANKS   UUAPRC                          CGL016
     C                     PARM           @1DBRC                          CGL016
      *                                                                   CGL016
B3   C           UUAPRC    IFNE *BLANKS                                   CGL016
     C                     MOVE *ON       *IN91                           CGL016
     C                     MOVEL'Y2U0004' W0RTN                           CGL016
     C                     GOTO SEEXIT                                    CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      *                                                                                       CGL013
      ** If Additional Information Exist in PF/GLJENXPD, delete.                              CGL013
      *                                                                                       CGL013
     C           KLDLSE    CHAINGLJENXL3             54                                       CGL013
     C           *IN54     IFEQ *OFF                                                          CGL013
     C                     DELET@LJENXD0                                                      CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           CER030    IFEQ 'Y'                                                         BUG23742
      *                                                                                     BUG23742
     C           KLDLS1    CHAINGLMNARL2             54                                     BUG23742
      *                                                                                     BUG23742
     C           *IN54     IFEQ *OFF                                                        BUG23742
     C                     DELETGLMNARD4                                                    BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RDAU - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RDAU
     C*00/Copy Member GL0123R   Processing After Delete
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC83
     C                     END
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
      *****************************************************************                     BUG23742
      *                                                               *                     BUG23742
      * SCHK85 - Check if additional information has been written     *                     BUG23742
      *          by GL000185                                          *                     BUG23742
      *                                                               *                     BUG23742
      * Called by:                                                    *                     BUG23742
      *                                                               *                     BUG23742
      * Calls: None                                                   *                     BUG23742
      *                                                               *                     BUG23742
      *****************************************************************                     BUG23742
      *                                                                                     BUG23742
     C           SCHK85    BEGSR                                                            BUG23742
      *                                                                                     BUG23742
     C           KRTV      CHAINGLJENXL2             65                                     BUG23742
      *                                                                                     BUG23742
     C           *IN65     IFEQ '0'                                                         BUG23742
     C                     MOVE 'N'       PEDIT                                             BUG23742
     C                     ELSE                                                             BUG23742
     C                     MOVE 'E'       PEDIT                                             BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDSR                                                            BUG23742
      *                                                                                     BUG23742
      *****************************************************************                     BUG23742
      /EJECT                                                                                BUG23742
      *****************************************************************                     BUG23742
      *                                                               *                     BUG23742
      * SCHK86 - Check if MultiCash Narratives has been written by    *                     BUG23742
      *          GL000186                                             *                     BUG23742
      *                                                               *                     BUG23742
      * Called by:                                                    *                     BUG23742
      *                                                               *                     BUG23742
      * Calls: None                                                   *                     BUG23742
      *                                                               *                     BUG23742
      *****************************************************************                     BUG23742
      *                                                                                     BUG23742
     C           SCHK86    BEGSR                                                            BUG23742
      *                                                                                     BUG23742
     C           KRTV1     CHAINGLMNARL3             65                                     BUG23742
      *                                                                                     BUG23742
     C           *IN65     IFEQ '0'                                                         BUG23742
     C                     MOVE 'N'       PEDIT                                             BUG23742
     C                     ELSE                                                             BUG23742
     C                     MOVE 'E'       PEDIT                                             BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDSR                                                            BUG23742
      *                                                                                     BUG23742
      *****************************************************************                     BUG23742
      /EJECT                                                                                BUG23742
      *****************************************************************                     BUG23742
     CSR         SFCHRC    BEGSR
      *================================================================
      * Change GL Btch Post LCL - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
      *
     C           KLCHSF    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
     C           KLCHSF    CHAIN@BTREAK              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SFEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SFEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Use SETLL to release record lock
     C           KLCHSF    SETLL@BTREAK              9091  *
     C                     GOTO SFEXIT
     C                     END                             FI #1DBRC
      *                                                                   CGL016
      * Save Batch info                                                   CGL016
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
     C                     MOVE BTIBCA    W0IBCA  3                       CGL016
     C                     MOVE BTCUST    W0CUST  6                       CGL016
     C                     MOVE BTCYCD    W0CYCD  3                       CGL016
     C**********           MOVE BTACCD    W0ACCD  4                                    CGL016 CGL029
     C                     MOVE BTACCD    W0ACCD                                              CGL029
     C                     MOVE BTACSN    W0ACSN  2                       CGL016
     C                     MOVE BTPTAM    W0PTAM 130                      CGL016
     C                     MOVE BTDCIN    W0DCIN  1                       CGL016
     C                     MOVE BTVLDT    W0VLDT                          CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      * Move non-key fields to @BTREAK
     C                     MOVEL#1IBCA    BTIBCA           Input Branch Co
     C                     MOVEL#1CUST    BTCUST           Customer number
     C                     MOVEL#1CYCD    BTCYCD           Currency code
     C                     MOVEL#1ACCD    BTACCD           Account code
     C                     MOVEL#1ACSN    BTACSN           Account sequenc
     C                     MOVEL#1NNBI    BTNNBI           Nostro number (
     C                     Z-ADD#1RACN    BTRACN           Retail account
     C                     MOVEL#1RINO    BTRINO           Retail ind.: Ov
     C                     MOVEL#1RINE    BTRINE           Retail ind.: Er
     C                     MOVEL#1TRTY    BTTRTY           Transaction typ
     C                     Z-ADD#1PTAM    BTPTAM           Posting amount
     C                     MOVEL#1DCIN    BTDCIN           Debit/credit in
     C                     Z-ADD#1PTDT    BTPTDT           Posting date
     C                     Z-ADD#1VLDT    BTVLDT           Value date
     C                     MOVEL#1NVCD    BTNVCD           Narrative code
     C                     MOVEL#1NRDC    BTNRDC           Narrative descr
     C                     MOVEL#1ACTY    BTACTY           Account type
     C                     MOVEL#1ACNB    BTACNB           Assoc. Customer
     C                     MOVEL#1CQNB    BTCQNB           Cheque number
     C                     MOVEL#1COIN    BTCOIN           Customer origin
     C                     MOVEL#1SWCR    BTSWCR           Swift common re
     C                     MOVEL#1PRCN    BTPRCN           Profit centre
     C/COPY WNCPYSRC,GL0123RC22
     C                     MOVEL#1BCBH    BTBCBH           Branch Code (Ba
     C/COPY WNCPYSRC,GL0123RC23
     C                     MOVEL#1RADP    BTRADP           Retail advice p
     C                     MOVEL#1SHPI    BTSHPI           Shadow post ind
     C                     Z-ADD#1RRNM    BTRRNM           Relative rec no
     C                     MOVEL#1RNBE    BTRNBE           Retail Number E
     C                     MOVEL#1RARC    BTRARC           Retail Ac Refer
     C                     MOVEL#1TSTY    BTTSTY           Transaction (Su
     C                     MOVEL#1BKCD    BTBKCD           Book Code
     C                     Z-ADD#1SPFC    BTSPFC           Spread Factor
     C                     MOVEL#1RVDI    BTRVDI           Reverse/Void In
     C                     Z-ADD#1NITM    BTNITM           Number of Items
     C                     MOVEL#1OCCY    BTOCCY           Original Ccy   CEU013
     C                     Z-ADD#1OAMT    BTOAMT           Original AmountCEU013
      *
      * USER: Processing before DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * CASE: WRK.Window processing requir. is Yes
     C           WUWDPR    IFEQ 'Y'                        *IF
      * Start of Fix LN0334
      * Call Window Manager - Standard functions  *
     C*  Call Window Manager Program
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0123RC13                                           S01408
     C*                                                                   S01408
     C                     CALL 'WN0010'
     C                     PARM ##PGM     UPGM   10        Calling PGM    LN0355
     C                     PARM *BLANK    UFKEY   2        Function Key   LN0355
     C                     PARM 'A'       UACODE  1        Action Code    LN0355
     C                     PARM           DATA             Trans Key      LN0355
     C                     PARM *BLANKS   W0RTN            Return code    LN0355
     C                     PARM           SPARE 256        Spare          LN0355
      * End of Fix LN0334
      * Check WM Return Code
      * CASE: PAR.*Return code is *User QUIT requested
     C           W0RTN     IFEQ 'Y2U9999'                  *IF
     C/COPY WNCPYSRC,GL0123RC92
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     ELSE
      * CASE: PAR.*Return code is WN Window Error
     C           W0RTN     IFEQ 'USR0563'                  *IF
      * Send message 'WN Window Error'
     C                     MOVEL'USR0563' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SFEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.*Return code is *DBF update error
     C           W0RTN     IFEQ 'Y2U0004'                  *IF
      * Send message 'WN Database Error'
     C                     MOVEL'GLX0138' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SFEXIT                     *QUIT
     C                     ELSE
      * CASE: PAR.*Return code is previous screen
     C           W0RTN     IFEQ 'USR0790'                  *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     GOTO SFEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * 00/Copy Member GL0123RBUW - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RBUW
     C*00/Copy Member GL0123R   Before Update, Window on
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0123RC14                                           S01408
     C*                                                                   S01408
     C                     END                             *FI
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC76
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RBDU - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RBDU
     C*00/Copy Member GL0123R   Processing Before Update
     C                     END                             *FI
     C                     UPDAT@BTREAK                91  *
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *                                                                   CGL016
      * Lock the record again                                             CGL016
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
      *                                                                   CGL016
B2   C           BTIBCA    IFNE W0IBCA                                    CGL016
     C           BTCUST    ORNE W0CUST                                    CGL016
     C           BTCYCD    ORNE W0CYCD                                    CGL016
     C           BTACCD    ORNE W0ACCD                                    CGL016
     C           BTACSN    ORNE W0ACSN                                    CGL016
     C           BTPTAM    ORNE W0PTAM                                    CGL016
     C           BTDCIN    ORNE W0DCIN                                    CGL016
     C           BTVLDT    ORNE W0VLDT                                    CGL016
      *                                                                   CGL016
     C           KLCHSA    CHAIN@BTREAK              9394                 CGL016
      *                                                                   CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      * DBF change successful
      *                                                                                       CGL013
      ** Additional Information Maintenance Screen                                            CGL013
      *                                                                                       CGL013
     C           PREV3     TAG                                                              BUG23742
      *                                                                                     BUG23742
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C           #1ADIN    ANDEQ'Y'                                                           CGL013
     C                     MOVEL#1BTNB    PABTNB                                              CGL013
     C                     MOVELBTBINB    PABINB                                              CGL013
     C                     MOVEL#1RACN    PARACN                                              CGL013
      *                                                                                     BUG23742
     C           CER030    IFEQ 'Y'                                                         BUG23742
     C                     EXSR SCHK86                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     CALL 'GL000185'                                                    CGL013
     C                     PARM *BLANKS   PRTCD                                               CGL013
     C                     PARM           PDETLS                                              CGL013
     C                     PARM *BLANK    PADD                                                CGL013
     C                     PARM 'M'       PMODE                                               CGL013
     C                     PARM '0'       PEXIT1                                            BUG23742
     C                     PARM '0'       PCANC1                                            BUG23742
     C                     PARM           PVBIPX                                              246418
     C                     PARM 'N'       APIMOD  1                                           246418
     C                     PARM           FLDNMA                                              246418
     C                     PARM           MSGIDA                                              246418
     C                     PARM           MSGDTA                                              246418
      *                                                                                       CGL013
     C**********           MOVE 'N'       #1ADIN                                     CGL013 BUG23742
     C           PADD      IFEQ 'Y'                                                           CGL013
     C                     MOVE '*'       #1AIPI                                              CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE *BLANK    #1AIPI                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           PCANC1    IFEQ '1'                                                         BUG23742
     C                     MOVE 'N'       #1ADIN                                            BUG23742
     C                     GOTO SFEXIT                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PEXIT1    IFEQ '1'                                                         BUG23742
     C                     EXSR ZYEXPG                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           CER030    IFEQ 'Y'                                                         BUG23742
     C           #1ADIN    ANDEQ'Y'                                                         BUG23742
      *                                                                                     BUG23742
     C                     MOVEL#1BTNB    PABTNB                                            BUG23742
     C                     MOVELBTBINB    PABINB                                            BUG23742
     C                     MOVEL#1RACN    PARACN                                            BUG23742
     C                     MOVELBTPTDT    PDATE                                             BUG23742
     C                     EXSR SCHK85                                                      BUG23742
      *                                                                                     BUG23742
     C                     CALL 'GL000186'                                                  BUG23742
     C                     PARM *BLANKS   PRTCD                                             BUG23742
     C                     PARM           PDETLS                                            BUG23742
     C                     PARM           PDATE   50                                        BUG23742
     C                     PARM *BLANKS   PADD    1                                         BUG23742
     C                     PARM 'M'       PMODE   1                                         BUG23742
     C                     PARM '0'       PEXIT   1                                         BUG23742
     C                     PARM '0'       PCANC   1                                         BUG23742
     C                     PARM           FLDNMA                                            BUG23742
     C                     PARM           MSGIDA                                            BUG23742
     C                     PARM           MSGDTA                                            BUG23742
      *                                                                                     BUG23742
     C           PADD      IFEQ 'Y'                                                         BUG23742
     C                     MOVE '*'       #1AIP1                                            BUG23742
     C                     ELSE                                                             BUG23742
     C                     MOVE *BLANK    #1AIP1                                            BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PCANC     IFEQ '1'                                                         BUG23742
      *                                                                                     BUG23742
     C           CGL013    IFEQ 'Y'                                                         BUG23742
     C                     GOTO PREV3                                                       BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PEXIT     IFEQ '1'                                                         BUG23742
     C                     EXSR ZYEXPG                                                      BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      *                                                                   CGL016
      * Verify any change in details for batch entered - CGL016           CGL016
      *                                                                   CGL016
B1   C           CGL016    IFEQ 'Y'                                       CGL016
     C           CRE023    OREQ 'Y'                                                        AR792734A
      *                                                                   CGL016
B2   C           BTIBCA    IFNE W0IBCA                                    CGL016
     C           BTCUST    ORNE W0CUST                                    CGL016
     C           BTCYCD    ORNE W0CYCD                                    CGL016
     C           BTACCD    ORNE W0ACCD                                    CGL016
     C           BTACSN    ORNE W0ACSN                                    CGL016
     C           BTPTAM    ORNE W0PTAM                                    CGL016
     C           BTDCIN    ORNE W0DCIN                                    CGL016
     C           BTVLDT    ORNE W0VLDT                                    CGL016
      *                                                                   CGL016
B3   C           BTSHPI    IFEQ 'Y'                                       CGL016
      *                                                                   CGL016
      * Revert entry                                                      CGL016
     C                     MOVE W0IBCA    BTIBCA                          CGL016
     C                     MOVE W0CUST    BTCUST                          CGL016
     C                     MOVE W0CYCD    BTCYCD                          CGL016
     C                     MOVE W0ACCD    BTACCD                          CGL016
     C                     MOVE W0ACSN    BTACSN                          CGL016
     C                     MOVE W0PTAM    BTPTAM                          CGL016
     C                     MOVE W0DCIN    BTDCIN                          CGL016
     C                     MOVE W0VLDT    BTVLDT                          CGL016
      *                                                                   CGL016
B4   C           BTDCIN    IFEQ 'D'                                       CGL016
     C                     MOVE 'C'       BTDCIN                          CGL016
X4   C                     ELSE                                           CGL016
     C                     MOVE 'D'       BTDCIN                          CGL016
E4   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     CALL 'GL004446'                                CGL016
     C                     PARM *BLANKS   UUAPRC                          CGL016
     C                     PARM           @1DBRC                          CGL016
      *                                                                   CGL016
B4   C           UUAPRC    IFNE *BLANKS                                   CGL016
     C                     MOVE *ON       *IN91                           CGL016
     C                     MOVEL'Y2U0004' W0RTN                           CGL016
     C                     GOTO SFEXIT                                    CGL016
E4   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     MOVEL#1DBRC    @1DBRC                          CGL016
      *                                                                   CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      * Accessing accounts to see whether Retail or not                   CGL016
      *                                                                   CGL016
     C                     CALL 'AOACCTR0'                                CGL016
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CGL016
     C                     PARM '*KEY'    UUAPOP  7        B:Option       CGL016
     C                     PARM *BLANKS   UUACID 10        I:Account IdentCGL016
     C                     PARM           BTCUST  6        I:Customer NumbCGL016
     C                     PARM           BTCYCD  3        I:Currency CodeCGL016
     C**********           PARM           BTACCD  4        I:Account Code              CGL016 CGL029
     C                     PARM           BTACCD                                              CGL029
     C                     PARM           BTACSN  2        I:Account SequeCGL016
     C                     PARM           BTIBCA  3        I:Branch code  CGL016
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format       CGL016
      *                                                                   CGL016
      * Accessing end date                                                CGL016
      *                                                                   CGL016
B2   C           ATYP      IFEQ 'R'                                       CGL016
      *                                                                   CGL016
      * Yes: call helper program                                          CGL016
     C                     CALL 'GL004446'                                CGL016
     C                     PARM *BLANKS   UUAPRC                          CGL016
     C                     PARM           @1DBRC                          CGL016
      *                                                                   CGL016
B4   C           UUAPRC    IFNE *BLANKS                                   CGL016
     C                     MOVE *ON       *IN91                           CGL016
     C                     MOVEL'Y2U0004' W0RTN                           CGL016
     C                     GOTO SFEXIT                                    CGL016
E4   C                     ENDIF                                          CGL016
      *                                                                   CGL016
     C                     MOVE 'Y'       BTSHPI                          CGL016
      *                                                                   CGL016
X3   C                     ELSE                                           CGL016
      *                                                                   CGL016
     C                     MOVE ' '       BTSHPI                          CGL016
      *                                                                   CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
B3   C           *IN93     IFEQ *OFF                                      CGL016
     C           *IN94     ANDEQ*OFF                                      CGL016
     C                     UPDAT@BTREAK                                   CGL016
     C                     EXSR MBFL#1                                    CGL016
E3   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E2   C                     ENDIF                                          CGL016
      *                                                                   CGL016
E1   C                     ENDIF                                          CGL016
      *                                                                   CGL016
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RADU - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RADU
     C*00/Copy Member GL0123R   Processing After Update
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC84
     C                     END
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         SGRVGN    BEGSR
      *================================================================
      * Retrieve Copy Record - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSG     KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Move fields to key list
     C                     MOVELP1BTNB    BTBTNB           Batch number
     C                     Z-ADDP4BITC    BTBINB           Batch item no.
     C           KRSSG     CHAIN@BTREAL              90    *
     C           *IN90     IFEQ '1'
      * DBF record not found
     C                     MOVEL'GLX0176' W0RTN   7
      * USER: Processing if DBF record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SGEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process DBF record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     MOVELBTIBCA    WUIBCA           Input Branch Co
     C                     MOVELBTCUST    WUCCUS           Customer number
     C                     MOVELBTCYCD    WUCCCD           Currency code
     C                     MOVELBTACCD    WUCPAC           Account code
     C                     MOVELBTACSN    WUCACS           Account sequenc
     C                     Z-ADDBTRACN    WUCRAN           Retail account
     C                     MOVELBTTRTY    WUTRTY           Transaction typ
     C                     Z-ADDBTPTAM    WUCPAM           Posting amount
     C                     MOVELBTDCIN    WUCDCI           Debit/credit in
     C                     Z-ADDBTVLDT    WUCVDN           Value date
     C                     MOVELBTNVCD    WUCNRC           Narrative code
     C                     MOVELBTNRDC    WUCNDS           Narrative descr
     C                     MOVELBTACNB    WUACNB           Assoc. Customer
     C                     MOVELBTCQNB    WUCCNB           Cheque number
     C                     MOVELBTSWCR    WUCSCR           Swift common re
     C                     MOVELBTPRCN    WUCPRC           Profit centre
     C                     MOVELBTRNBE    WUCRNE           Retail Number E
     C                     MOVELBTTSTY    WUCTST           Transaction (Su
     C                     MOVELBTBKCD    WUCBKC           Book Code
     C                     Z-ADDBTSPFC    WUSPFC           Spread Factor
     C                     MOVELBTRVDI    WUCRVI           Reverse/Void In
     C                     MOVELBTOCCY    WUCOCY           Original Ccy   CEU013
     C                     Z-ADDBTOAMT    WUCOAM           Original AmountCEU013
     C                     END
      *================================================================
     CSR         SGEXIT    ENDSR
      /EJECT                                                              CGL002
     CSR         SRGLOV    BEGSR                                          CGL002
      *================================================================   CGL002
      **  Check Overrideable GL Errors                                    CGL002
      *================================================================   CGL002
      *                                                                   CGL002
      **  Initialise work fields                                          CGL002
      *                                                                   CGL002
     C                     MOVELWURETB    URRETI                          CGL002
     C                     MOVEL#1DCIN    URIND                           CGL002
     C                     MOVEL'NNNNNNNN'WURARC                          CGL002
     C                     MOVE 'NN'      WURARC                          CGL002
      *                                                                   CGL002
      **  Check GL Account Status                                         CGL002
      *                                                                   CGL002
     C                     EXSR SRGLST                                    CGL002
     C                     MOVELURERST    #DIEST                          CGL002
     C                     MOVELURERTX    #DIEMG                          CGL002
     C                     MOVELWURARC    #1RARC                          CGL002
      *                                                                   CGL002
      **  Determine Item Error State...                                   CGL002
     C                     SELEC                                          CGL002
      *                                                                   CGL002
      **  ...Errors in Item, send message 'Can't Override GL A/c Error'   CGL002
      *                                                                   CGL002
     C           #DIEST    WHEQ 'E'                                       CGL002
     C                     MOVEL'Y'       #1RINE                          CGL002
     C                     MOVEL'N'       #1RINO                          CGL002
     C                     MOVEL#DACID    ZA0089                          CGL002
     C                     MOVEL#1CYCD    ZA0090                          CGL002
     C                     MOVEL#1ACCD    ZA0091                          CGL002
     C                     MOVEL#1ACSN    ZA0092                          CGL002
     C                     MOVEL'GLX0395' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     993132               CGL002
     C                     SETON                     3334                 CGL002
      *                                                                   CGL002
      **  ...Overridable Errors                                           CGL002
      *                                                                   CGL002
     C           #DIEST    WHEQ 'O'                                       CGL002
     C                     MOVEL'Y'       #1RINE                          CGL002
      *                                                                   CGL002
     C           #1RINO    IFNE 'Y'                                       CGL002
     C           #1RINO    ANDNE'N'                                       CGL002
      *                                                                   CGL002
      **  Override indicator is *Blank, send message 'GL A/c              CGL002
      **  Error Requires Override'                                        CGL002
     C           #1RINO    IFEQ *BLANK                                    CGL002
     C                     MOVEL#1RINO    ZA0093                          CGL002
     C                     MOVEL'GLX0141' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     9949                 CGL002
      *                                                                   CGL002
      **  Else, send message 'GL A/c Override Invalid'                    CGL002
     C                     ELSE                                           CGL002
     C                     MOVEL#1RINO    ZA0094                          CGL002
     C                     MOVEL'GLX0214' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     9949                 CGL002
     C                     ENDIF                                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  ...No errors in Item                                            CGL002
      *                                                                   CGL002
     C           #DIEST    WHEQ *BLANK                                    CGL002
     C                     MOVEL'N'       #1RINE                          CGL002
     C                     MOVEL*BLANK    #1RINO                          CGL002
      *                                                                   CGL002
      ** Retrieve message Lots of blanks                                  CGL002
     C                     MOVELZADFMF    ZAMSGF                          CGL002
     C                     CALL 'Y2RVMGC'              90                 CGL002
     C                     PARM *BLANK    W0RTN   7                       CGL002
     C                     PARM 'GLX0092' ZAMSID  7                       CGL002
     C                     PARM           ZAMSGF 10                       CGL002
     C                     PARM           ZAMSDA132                       CGL002
     C           #DIEMG    PARM           W0MTX 132                       CGL002
     C                     MOVEL*BLANK    ZAMSDA                          CGL002
     C                     MOVEL*BLANK    ZAMSGF                          CGL002
      *                                                                   CGL002
     C                     ENDSL                                          CGL002
      *                                                                   CGL002
      *================================================================   CGL002
     CSR                   ENDSR                                          CGL002
      /EJECT                                                              CGL002
     CSR         SRGLST    BEGSR                                          CGL002
      *================================================================   CGL002
      **  Check GL Account Status                                         CGL002
      *================================================================   CGL002
      *                                                                   CGL002
     C                     MOVE *IN90     URSI90  1                       CGL002
     C                     MOVE *IN91     URSI91  1                       CGL002
     C                     MOVE *BLANK    URIESL                          CGL002
     C                     MOVE *BLANK    URERST  1                       CGL002
     C                     Z-ADD1         U1      30                      CGL002
     C                     SETOF                     91                   CGL002
      *                                                                   CGL002
      **  Determine if user is authorised to perform GL Account           CGL002
      **  Overrides in all cases                                          CGL002
      *                                                                   CGL002
     C                     CALL 'ZVACTBU'              90                 CGL002
     C                     PARM 'O'       WQ0072  1                       CGL002
     C                     PARM #1IBCA    WQ0073  3                       CGL002
     C           WUSPEC    PARM *ZERO     WQ0074  10                      CGL002
      *                                                                   CGL002
      **  Call to program ended in error                                  CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C                     MOVEL'Y2U0021' W0RTN   7                       CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Error Condition                                           CGL002
     C           WUSPEC    IFEQ 0                                         CGL002
     C                     MOVE 'Y'       WUAUTH  1                       CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'N'       WUAUTH                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Refer Debits:                                             CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'D'                                       CGL002
     C                     TESTB'0'       URRETI  1      90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE01    IFNE 'Y'                                       CGL002
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Refer Dr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSRD                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Refer Credits:                                            CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'C'                                       CGL002
     C                     TESTB'1'       URRETI         90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE02    IFNE 'Y'                                       CGL002
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Refer Cr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSRC                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Block Debits:                                             CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'D'                                       CGL002
     C                     TESTB'2'       URRETI         90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE03    IFNE 'Y'                                       CGL002
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Block Dr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSBD                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Block Credits:                                            CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'C'                                       CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C                     TESTB'3'       URRETI         90               CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE04    IFNE 'Y'                                       CGL002
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Block Cr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSBC                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  If there are any errors, setup non-overrideable error status    CGL002
      *                                                                   CGL002
     C           U1        IFGT 1                                         CGL002
     C           U1        IFLT 5                                         CGL002
     C                     MOVELURNORM    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE URERMG    URERTX                          CGL002
     C           *IN91     IFEQ '1'                                       CGL002
     C                     MOVE 'E'       URERST                          CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'O'       URERST                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Else, no errors found                                           CGL002
     C                     ELSE                                           CGL002
     C                     MOVE *BLANK    URERST                          CGL002
     C                     MOVE URDASH    URERTX 76                       CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     MOVE URSI90    *IN90                           CGL002
     C                     MOVE URSI91    *IN91                           CGL002
      *                                                                   CGL002
      *================================================================   CGL002
     CSR                   ENDSR                                          CGL002
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Account Identifier validation
      *================================================================
     C                     MOVEL'Y'       WUACIC           Account Identif
      * CASE: DTL.Account Identifier is Select Requested
     C           #DACID    IFEQ '?'                        *IF
      * Select Customer Number - Standard functions  *
     C                     CALL 'SD0010S'              90  Select Customer
     C           W0RTN     PARM W0RTN     WQ0001  7        *Return code
     C           #DACID    PARM #DACID    WQ0002  6        Customer number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Determine Account type - Standard functions  *
     C                     MOVEL#DACID    UKACID           10-Char.A/C ID
     C******               EXSR UKACCK                                    E17819
     C                     EXSR XXIN                                      E17819
     C                     MOVELUKTYPE    WUAISF           Account type
     C*SR***      UKACCK    BEGSR                                         E17819
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Account Code Validation
      *================================================================
     C/COPY WNCPYSRC,GL0123RC36
      * CASE: DTL.Account code is Not blank
     C           #1ACCD    IFNE *BLANK                     *IF
      * CASE: DTL.Account code is Select Requested
     C           #1ACCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Start of Fix LN0334
      * Access Account Codes. - Account Codes  *
     C*
     C*  Access Account codes file for the following fields
     C*  A/c Type, A/c Name, Account Section, Account Subtype
     C*
     C                     MOVEL#1ACCD    UUACCD                          LN0334
     C/COPY WNCPYSRC,GL0123RC59
     C                     CALL 'AOACODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C**********           PARM           UUACCD  4        I:Account Code              LN0334 CGL029
     C********** D@ACOD    PARM *BLANK    UUFDY            O:Format                           CGL029
     C                     PARM           UUACCD                                              CGL029
     C           D@ACOD    PARM *BLANK    UUSDY                                               CGL029
      *                                                                                       CGL037
     C           CGL037    IFEQ 'Y'                                                           CGL037
      *                                                                                       CGL037
      ** If indicator U5 is ON, then Account Type should not be                               CGL037
      ** 'R'. If it is 'R', Account Subtype must be 'V' or 'I'.                               CGL037
      *                                                                                       CGL037
     C           *INU5     IFEQ '1'                                                           CGL037
     C           A5ACTY    IFEQ 'R'                                                           CGL037
     C           A5ACST    IFNE 'V'                                                           CGL037
     C           A5ACST    ANDNE'I'                                                           CGL037
     C                     MOVEL'XXX0202' ZAMSID                                              CGL037
     C                     EXSR ZASNMS                                                        CGL037
     C                     SETON                     993132                                   CGL037
     C                     SETON                     333435                                   CGL037
     C                     GOTO UBEXIT                                                        CGL037
     C                     END                                                                CGL037
     C                     END                                                                CGL037
     C                     END                                                                CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C/COPY WNCPYSRC,GL0123RC60
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA5ACCD    WUACCD           A/c Code       LN0334
     C                     MOVELA5ACTY    WUACTY           A/C Type
     C                     MOVELA5ACCN    WUACCN           A/c Name
     C                     MOVELA5ACSC    WUACSC           A/c Section
     C                     MOVELA5ACST    WUACST           A/c Sub-Type
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL'N'       WUACIC           Account Identif
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0003           Account code
      * Send message 'Account Code not found'
     C                     MOVEL'GLX0046' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     ELSE
     C/COPY WNCPYSRC,GL0123RC77
      * CASE: *OTHERWISE
     C                     MOVELWUACCD    #1ACCD           Account code
      *                                                                   CGL008
      ** If Feature CGL008 is ON                                          CGL008
      *                                                                   CGL008
     C           CGL008    IFEQ 'Y'                                       CGL008
      *                                                                   CGL008
      ** Check the Access to all account codes                            CGL008
      *                                                                   CGL008
     C           WMACOD    IFNE 'Y'                                       CGL008
      *                                                                   CGL008
      ** Check the Authorities of this account code                       CGL008
      *                                                                   CGL008
     C                     MOVE #1ACCD    WWACCD                          CGL008
      *                                                                   CGL008
     C           KCAUAC    CHAINSFACAUL0             22                   CGL008
      *                                                                   CGL008
      ** If no record found, the input is not allowed                     CGL008
      *                                                                   CGL008
     C           *IN22     IFEQ *ON                                       CGL008
     C                     MOVEL'CGL0001' ZAMSID                          CGL008
     C                     MOVEL'GLUSRMSG'ZAMSGF                          CGL008
     C                     EXSR ZASNMS                                    CGL008
     C                     MOVE *ON       *IN99                           CGL008
     C                     MOVE *ON       *IN33                           CGL008
     C                     ENDIF                                          CGL008
     C                     ENDIF                                          CGL008
     C                     ENDIF                                          CGL008
     C/COPY WNCPYSRC,GL0123RC40
     C                     END                             *FI
      * End of Fix LN0334
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Account ID Status Flag is Customer No or short name
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
     C                     MOVEL'N'       WUACIC           Account Identif
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0004           Account code
      * Send message 'Account Code Required'
     C                     MOVEL'GLX0124' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Account Sequence Validation
      *================================================================
      * CASE: DTL.Account sequence number is Blank
     C           #1ACSN    IFEQ *BLANK                     *IF
      * CASE: WRK.Account ID Status Flag is Customer No or short name
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
     C                     MOVEL'N'       WUACIC           Account Identif
      * Setup message data for message
     C                     MOVEL#1ACSN    ZA0005           Account sequenc
      * Send message 'Ac Sequence Not Blank'
     C                     MOVEL'GLX0122' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9934  *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: DTL.Account sequence number is First to Last
     C           #1ACSN    IFGE '01'                       *IF
     C           #1ACSN    ANDLE'99'
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUACIC           Account Identif
      * Setup message data for message
     C                     MOVEL#1ACSN    ZA0006           Account sequenc
      * Send message 'Ac Seq Number Required'
     C                     MOVEL'GLX0134' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9934  *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      * Branch Code Validation
      *================================================================
     C           P2MBRB    IFNE 'Y'                                       088589
     C           #1IBCA    ANDNEP2BCDA                                    088589
      * Setup message data for message                                    088589
     C                     MOVEL#1IBCA    ZA0007           Input Branch Co088589
      * Send message 'Branch Code INVALID'                                088589
     C                     MOVEL'GLX004A' ZAMSID                          088589
     C                     EXSR ZASNMS                                    088589
     C                     SETON                     9935  *              088589
     C                     END                                            088589
      * CASE: PAR.Multiple Branch Batch is Yes
     C           P2MBRB    IFEQ 'Y'                        *IF
      * CASE: DTL.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * CASE: DTL.Input Branch Code - Alpha is Select Request
     C           #1IBCA    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1IBCA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0007           Input Branch Co
      * Send message 'Branch Code not found'
     C                     MOVEL'GLX0045' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9935  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUBRCD    #1IBCA           Input Branch Co
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         UESUBR    BEGSR
      *================================================================
      * Validate Customer report name & Account name
      *================================================================
      * SAR017 Start
      * CASE: WRK.GL Description Ind. is Yes
     C           WUGLDI    IFEQ 'Y'                        *IF
      * Determine whether to display Account Name
     C                     EXSR UFSUBR                     Determine wheth
      * Determine whether to display Customer Report Name
     C                     EXSR UGSUBR                     Determine wheth
      * Determine Whether to Re-display screen for Cust & A/c Name
      * CASE: WRK.Disp Screen Loop is Equal First
     C           WUDSLP    IFEQ 1                          *IF
     C                     MOVEL#DDCNM    WUCDCN           Copy:Display Cu
     C                     MOVEL#DDACN    WUCDAN           Copy:Display Ac
     C                     ADD  1         WUDSLP           Disp Screen Loo
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Copy:Display Cust Name NE DTL.Display Customer Name
     C           WUCDCN    IFNE #DDCNM                     *IF
     C                     Z-ADD1         WUDSLP           Disp Screen Loo
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: WRK.Copy:Display Account name NE DTL.Display Account Name
     C           WUCDAN    IFNE #DDACN                     *IF
     C                     Z-ADD1         WUDSLP           Disp Screen Loo
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     MOVEL'N'       WUDCUS           Display Custome
     C                     END                             *FI
      * SAR017 End
      *================================================================
     CSR         UEEXIT    ENDSR
      /EJECT
     CSR         UFSUBR    BEGSR
      *================================================================
      * Determine whether to display Account Name
      *================================================================
     C                     MOVEL'Y'       WUDSAC           Display Account
      * CASE: DTL.Account Identifier is Not Entered
     C           #DACID    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Not Retail
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
     C***********WUAISF    OREQ '*NOSTRO'                                 128957
      * CASE: DTL.Currency code is Blank
     C           #1CYCD    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     END                             *FI
      * CASE: DTL.Account code is Blank
     C           #1ACCD    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     END                             *FI
      * CASE: DTL.Account sequence number is Blank
     C           #1ACSN    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Customer Number
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C                     MOVEL#DACID    #1CUST           Customer number
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.Display Account is Yes
     C           WUDSAC    IFEQ 'Y'                        *IF
      *     E18852  - Branch Code Of trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#DACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C/COPY WNCPYSRC,GL0123RC49
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0123RC50
     C*
     C* Assign work field to file field values.
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C           #1ACCD    IFNE *BLANKS                                   CEU013
     C                     MOVELA5ACTY    WUACTY           Account Type   CEU013
     C                     ELSE                                           CEU013
     C                     MOVEL#1ACTY    WUACTY           Account Type   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVEL*BLANKS   WUBPST           Account Sub-TypCEU013
     C                     MOVEL*BLANKS   WUACCS           Account Status CEU013
     C                     MOVE *ZEROS    WUDACO           Date Account OpCEU013
     C                     MOVEL*BLANKS   WUACNM           Account Name   CEU013
     C                     MOVEL#1RACN    WURACN           Retails AccountCEU013
     C                     MOVE *ZEROS    WURRNM           Relative rec NoCEU013
     C**********           MOVEL*BLANK    WURETB           Retail Indic'tr             CEU013 203566
     C                     BITOF'01234567'WURETB                                              203566
     C                     ELSE                                           CEU013
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C***********          MOVELSTYP      WUACTY           Account Sub-TypCEU013
     C                     MOVELSTYP      WUBPST           Account Sub-TypCEU013
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUDACN           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     ENDIF                                          CEU013
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUDACN    #DDACN           Display Account
     C                     MOVELCNUM      #1CUST           Customer Number128957
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UFEXIT    ENDSR
      /EJECT
     CSR         UGSUBR    BEGSR
      *================================================================
      * Determine whether to display Customer Report Name
      *================================================================
      * CASE: DTL.Account Identifier is Entered
     C           #DACID    IFNE *BLANK                     *IF
      * CASE: WRK.Account ID Status Flag is Retail
     C           WUAISF    IFEQ '*RETAIL'                  *IF
     C                     MOVEL*BLANK    WUCNCD           Client key
     C                     MOVEL#1CUST    WUCNCD           Client key
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#DACID    WUCNCD           Client key
     C                     END                             *FI
      * Access Cust Report Name - Standard functions  *
      *********P@AORF    E DSSDCUSTPD                                     S01117
     C*
     C* Access Customer Report Name Off Client File
     C*
     C                     MOVE *BLANK    WUCRST  7
     C**
     C                     CALL 'AOCUSTR0'
     C***********#BAORC****PARM #BAORC    P@RTN   7        B:Return code  S01117
     C           WUAPRC    PARM WUAPRC    P@RTN   7        B:Access Pgm ReS01117
     C*********************PARM #IAOPN    P@OPTN  7        I:Option       S01117
     C                     PARM '*KEY'    P@OPTN  7        I:Access Pgm OpS01117
     C                     PARM WUCNCD    P@CKEY 10        I:Key field
     C           WUCRST    PARM *BLANK    P@FLD1  7        O:Client Key Id.
     C*********************PARM           P@AORF           O:Format       S01117
     C           D@CUST    PARM *BLANK    UUSDY            O:Format       S01117
     C*
     C                     MOVELBBCRNM    WUCRNM           O:Cust Report Nme
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C           WUAPRC    OREQ '*CUSCLS'                                                     CGL148
     C           WUAPRC    OREQ '*CUSDEL'                                                     CGL148
     C                     MOVEL'N'       WUDCUS           Display Custome
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCRNM    #DDCNM           Display Custome
     C                     MOVEL'Y'       WUDCUS           Display Custome
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDCUS           Display Custome
     C                     END                             *FI
      *================================================================
     CSR         UGEXIT    ENDSR
      /EJECT
     CSR         UHSUBR    BEGSR
      *================================================================
      * Copy Symbol Invalid Validation
      *================================================================
     C                     MOVEL'N'       WUCCIN           Copy Character
      * CASE: DTL.Account Identifier EQ WRK.JE Special Character
     C           #DACID    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#DACID    ZA0019           Account Identif
     C                     MOVELWUJESP    ZA0020           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Currency code EQ WRK.JE Special Character
     C           #1CYCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0021           Currency code
     C                     MOVELWUJESP    ZA0022           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Account code EQ WRK.JE Special Character
     C           #1ACCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0023           Account code
     C                     MOVELWUJESP    ZA0024           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Account sequence number EQ WRK.JE Special Character
     C           #1ACSN    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1ACSN    ZA0025           Account sequenc
     C                     MOVELWUJESP    ZA0026           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9934  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Input Branch Code - Alpha EQ WRK.JE Special Character
     C           #1IBCA    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0027           Input Branch Co
     C                     MOVELWUJESP    ZA0028           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9935  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Formatted Posting amount EQ WRK.JE Special Character
     C           #DFMPA    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#DFMPA    ZA0029           Formatted Posti
     C                     MOVELWUJESP    ZA0030           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9936  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1DCIN    ZA0031           Debit/credit in
     C                     MOVELWUJESP    ZA0032           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9937  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Narrative EQ WRK.JE Special Character
     C           #DNRTV    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#DNRTV    ZA0033           Narrative
     C                     MOVELWUJESP    ZA0034           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9939  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Transaction type EQ WRK.JE Special Character
     C           #1TRTY    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1TRTY    ZA0035           Transaction typ
     C                     MOVELWUJESP    ZA0036           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9941  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Cheque number EQ WRK.JE Special Character
     C           #1CQNB    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0037           Cheque number
     C                     MOVELWUJESP    ZA0038           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9944  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Associated Cust - Display EQ WRK.JE Special Character
     C           #DASCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#DASCD    ZA0039           Associated Cust
     C                     MOVELWUJESP    ZA0040           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9945  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Value date (display) EQ WRK.JE Special Character
     C           #DVDDS    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0041           Value date (dis
     C                     MOVELWUJESP    ZA0042           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Swift common reference EQ WRK.JE Special Character
     C           #1SWCR    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1SWCR    ZA0043           Swift common re
     C                     MOVELWUJESP    ZA0044           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9946  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Profit centre EQ WRK.JE Special Character
     C           #1PRCN    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0045           Profit centre
     C                     MOVELWUJESP    ZA0046           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9947  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Retail ind.: Override EQ WRK.JE Special Character
     C           #1RINO    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1RINO    ZA0047           Retail ind.: Ov
     C                     MOVELWUJESP    ZA0048           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9949  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * Start of S10736
      * CASE: DTL.Transaction (Sub - Type) EQ WRK.JE Special Character
     C           #1TSTY    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1TSTY    ZA0049           Transaction (Su
     C                     MOVELWUJESP    ZA0050           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9942  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Book Code EQ WRK.JE Special Character
     C           #1BKCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1BKCD    ZA0051           Book Code
     C                     MOVELWUJESP    ZA0052           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9948  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: DTL.Reverse/Void Indicator EQ WRK.JE Special Character
     C           #1RVDI    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1RVDI    ZA0053           Reverse/Void In
     C                     MOVELWUJESP    ZA0054           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9938  *
      *
     C                     MOVEL'Y'       WUCCIN           Copy Character
     C                     END                             *FI
      * CASE: RCD.Original currency code EQ WRK.JE Special Character      CEU013
     C           #1OCCY    IFEQ WUJESP                     *IF            CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0119           Original ccy   CEU013
     C                     MOVELWUJESP    ZA0120           JE Special CharCEU013
      * Send message 'Copy function not valid'                            CEU013
     C                     MOVEL'GLX0090' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9950  *              CEU013
      *                                                                   CEU013
     C                     END                             *FI            CEU013
      * CASE: RCD.Formatted Original amount EQ WRK.JE Special Character   CEU013
     C           #DFMOA    IFEQ WUJESP                     *IF            CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#DFMOA    ZA0121           Formatted OrigiCEU013
     C                     MOVELWUJESP    ZA0122           JE Special CharCEU013
      * Send message 'Copy function not valid'                            CEU013
     C                     MOVEL'GLX0090' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9951  *              CEU013
      *                                                                   CEU013
     C                     END                             *FI            CEU013
      * End of S10736
      *================================================================
     CSR         UHEXIT    ENDSR
      /EJECT
     CSR         UISUBR    BEGSR
      *================================================================
      * Copy Symbol valid
      *================================================================
      * CASE: DTL.Account Identifier EQ WRK.JE Special Character
     C           #DACID    IFEQ WUJESP                     *IF
      * CASE: WRK.Copy:Retail Number Enter is Retail Account
     C           WUCRNE    IFEQ 'Y'                        *IF
     C                     MOVELWUCRAN    #DACID           Account Identif
     C                     MOVELWUCRNE    #1RNBE           Retail Number E
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DACID           Account Identif
     C                     MOVELWUCCUS    #DACID           Account Identif
     C                     END                             *FI
     C                     END                             *FI
      * CASE: DTL.Currency code EQ WRK.JE Special Character
     C           #1CYCD    IFEQ WUJESP                     *IF
     C                     MOVELWUCCCD    #1CYCD           Currency code
     C                     END                             *FI
      * CASE: DTL.Account code EQ WRK.JE Special Character
     C           #1ACCD    IFEQ WUJESP                     *IF
     C                     MOVELWUCPAC    #1ACCD           Account code
     C                     END                             *FI
      * CASE: DTL.Account sequence number EQ WRK.JE Special Character
     C           #1ACSN    IFEQ WUJESP                     *IF
     C                     MOVELWUCACS    #1ACSN           Account sequenc
     C                     END                             *FI
      * CASE: DTL.Input Branch Code - Alpha EQ WRK.JE Special Character
     C           #1IBCA    IFEQ WUJESP                     *IF
     C                     MOVELWUCBCA    #1IBCA           Input Branch Co
     C                     END                             *FI
      * CASE: DTL.Formatted Posting amount EQ WRK.JE Special Character
     C           #DFMPA    IFEQ WUJESP                     *IF
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * Format amount (short) - Standard functions  *
     C                     Z-ADDWUCPAM    ULVALU           Value
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALU 150       I:Value
     C                     PARM WUNBDP    ULDECP  10       I:Decimal place
     C***********          PARM 'L'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM '3'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLF 23        O:Formatted
     C                     MOVE ULRSLF    #DFMPA           Formatted data
     C                     END                             *FI
      * CASE: DTL.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
     C                     MOVELWUCDCI    #1DCIN           Debit/credit in
     C                     END                             *FI
      * CASE: DTL.Narrative EQ WRK.JE Special Character
     C           #DNRTV    IFEQ WUJESP                     *IF
      * CASE: WRK.Copy:Narrative Code is No Narrative code
     C           WUCNRC    IFEQ *BLANK                     *IF
     C                     MOVELWUCNDS    #DNRTV           Narrative
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DNRTV           Narrative
     C                     MOVELWUCNRC    #DNRTV           Narrative
     C                     END                             *FI
     C                     END                             *FI
      * CASE: DTL.Transaction type EQ WRK.JE Special Character
     C           #1TRTY    IFEQ WUJESP                     *IF
     C                     MOVELWUCTRT    #1TRTY           Transaction typ
     C                     END                             *FI
      * CASE: DTL.Cheque number EQ WRK.JE Special Character
     C           #1CQNB    IFEQ WUJESP                     *IF
     C                     MOVELWUCCNB    #1CQNB           Cheque number
     C                     END                             *FI
      * CASE: DTL.Associated Cust - Display EQ WRK.JE Special Character
     C           #DASCD    IFEQ WUJESP                     *IF
     C                     MOVELWUASSC    #DASCD           Associated Cust
     C                     END                             *FI
      * CASE: DTL.Value date (display) EQ WRK.JE Special Character
     C           #DVDDS    IFEQ WUJESP                     *IF
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM WUCVDN    WQ0021  50       Runday Number
     C                     PARM WUDTFF    WQ0022  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0023  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0024  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     MOVELWUDTNF    WUCVDT           Copy:Value Date
     C                     MOVELWUCVDT    #DVDDS           Value date (dis
     C                     END                             *FI
      * CASE: DTL.Swift common reference EQ WRK.JE Special Character
     C           #1SWCR    IFEQ WUJESP                     *IF
     C                     MOVELWUCSCR    #1SWCR           Swift common re
     C                     END                             *FI
      * CASE: DTL.Profit centre EQ WRK.JE Special Character
     C           #1PRCN    IFEQ WUJESP                     *IF
     C                     MOVELWUCPRC    #1PRCN           Profit centre
     C                     END                             *FI
      * Start of S10736
      * CASE: DTL.Transaction (Sub - Type) EQ WRK.JE Special Character
     C           #1TSTY    IFEQ WUJESP                     *IF
     C                     MOVELWUCTST    #1TSTY           Transaction (Su
     C                     END                             *FI
      * CASE: DTL.Book Code EQ WRK.JE Special Character
     C           #1BKCD    IFEQ WUJESP                     *IF
     C                     MOVELWUCBKC    #1BKCD           Book Code
     C                     END                             *FI
      * CASE: DTL.Reverse/Void Indicator EQ WRK.JE Special Character
     C           #1RVDI    IFEQ WUJESP                     *IF
     C                     MOVELWUCRVI    #1RVDI           Reverse/Void In
     C                     END                             *FI
      * End of S10736
      * CASE: RCD.Original Currency code EQ WRK.JE Special Character      CEU013
     C           #1OCCY    IFEQ WUJESP                     *IF            CEU013
     C                     MOVELWUCOCY    #1OCCY           Original ccy   CEU013
     C                     END                             *FI            CEU013
     C*                                                                   CEU013
     C           #DFMOA    IFEQ WUJESP                                    CEU013
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Number of decimal places and 'In' currency flag                  CEU013
     C*                                                                   CEU013
     C                     MOVEL#1OCCY    UUCYCD                          CEU013
     C                     CALL 'AOCURRR0'                                CEU013
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CEU013
     C                     PARM '*KEY'    UUAPOP  7        I:Option       CEU013
     C                     PARM           UUCYCD  3        I:Currency CodeCEU013
     C           D@CURR    PARM *BLANK    UUSDY            O:Format       CEU013
     C*                                                                   CEU013
     C* Assign work field to file field values.                           CEU013
     C*                                                                   CEU013
     C                     MOVELA6NBDP    WKNBDP  10       No. Decimal PlcCEU013
     C                     MOVELA6INCY    WKINCY  1        'In' Currency  CEU013
      * Format amount (short) - Standard functions  *                     CEU013
     C                     Z-ADDWUCOAM    ULVALU           Value          CEU013
      *                                                                   CEU013
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>CEU013
     C                     PARM           ULVALU 150       I:Value        CEU013
     C                     PARM WKNBDP    ULDECP  10       I:Decimal placeCEU013
     C                     PARM '3'       ULEDIT  1        I:IBM Edit codeCEU013
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.CEU013
     C                     PARM           ULRSLF 23        O:Formatted    CEU013
      *                                                                   CEU013
     C                     MOVE ULRSLF    #DFMOA           Formatted data CEU013
     C                     MOVE ULRSLF    #1SVOA           Screen save dtaCEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      *================================================================
     CSR         UIEXIT    ENDSR
      /EJECT
     CSR         UJSUBR    BEGSR
      *================================================================
      * Account Identifier validation
      *================================================================
     C                     MOVEL'Y'       WUACIC           Account Identif
      * CASE: DTL.Account Identifier is Select Requested
     C           #DACID    IFEQ '?'                        *IF
      * Select Customer Number - Standard functions  *
     C                     CALL 'SD0010S'              90  Select Customer
     C           W0RTN     PARM W0RTN     WQ0025  7        *Return code
     C           #DACID    PARM #DACID    WQ0026  6        Customer number
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9931  *
     C                     END
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Determine Account type - Standard functions  *
     C                     MOVEL#DACID    UKACID           10-Char.A/C ID
     C******               EXSR UKACCK                                    E17819
     C                     EXSR XXIN                                      E17819
     C                     MOVELUKTYPE    WUAISF           Account type
     C*SR***      UKACCK    BEGSR                                         E17819
      *================================================================
     CSR         UJEXIT    ENDSR
      /EJECT
     CSR         UKSUBR    BEGSR
      *================================================================
      * Account Code Validation
      *================================================================
      * CASE: DTL.Account code is Not blank
     C           #1ACCD    IFNE *BLANK                     *IF
      * CASE: DTL.Account code is Select Requested
     C           #1ACCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Start of Fix LN0334
      * Access Account Codes. - Account Codes  *
     C*
     C*  Access Account codes file for the following fields
     C*  A/c Type, A/c Name, Account Section, Account Subtype
     C*
     C                     MOVEL#1ACCD    UUACCD                          LN0334
     C/COPY WNCPYSRC,GL0123RC61
     C                     CALL 'AOACODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C**********           PARM           UUACCD  4        I:Account Code              LN0334 CGL029
     C********** D@ACOD    PARM *BLANK    UUFDY            O:Format                           CGL029
     C                     PARM           UUACCD                                              CGL029
     C           D@ACOD    PARM *BLANK    UUSDY                                               CGL029
      *                                                                                       CGL037
     C           CGL037    IFEQ 'Y'                                                           CGL037
      *                                                                                       CGL037
      ** If indicator U5 is ON, then Account Type should not be                               CGL037
      ** 'R'. If it is 'R', Account Subtype must be 'V' or 'I'.                               CGL037
      *                                                                                       CGL037
     C           *INU5     IFEQ '1'                                                           CGL037
     C           A5ACTY    IFEQ 'R'                                                           CGL037
     C           A5ACST    IFNE 'V'                                                           CGL037
     C           A5ACST    ANDNE'I'                                                           CGL037
     C                     MOVEL'XXX0202' ZAMSID                                              CGL037
     C                     EXSR ZASNMS                                                        CGL037
     C                     SETON                     993132                                   CGL037
     C                     SETON                     333435                                   CGL037
     C                     GOTO UKEXIT                                                        CGL037
     C                     END                                                                CGL037
     C                     END                                                                CGL037
     C                     END                                                                CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C/COPY WNCPYSRC,GL0123RC62
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA5ACCD    WUACCD           A/c Code       LN0334
     C                     MOVELA5ACTY    WUACTY           A/C Type
     C                     MOVELA5ACCN    WUACCN           A/c Name
     C                     MOVELA5ACSC    WUACSC           A/c Section
     C                     MOVELA5ACST    WUACST           A/c Sub-Type
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL'N'       WUACIC           Account Identif
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0057           Account code
      * Send message 'Account Code not found'
     C                     MOVEL'GLX0046' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     ELSE
     C/COPY WNCPYSRC,GL0123RC78
      * CASE: *OTHERWISE
     C                     MOVELWUACCD    #1ACCD           Account code
      *                                                                   CGL008
      ** If Feature CGL008 is ON                                          CGL008
      *                                                                   CGL008
     C           CGL008    IFEQ 'Y'                                       CGL008
      *                                                                   CGL008
      ** Check the Access to all account codes                        f   CGL008
      *                                                                   CGL008
     C           WMACOD    IFNE 'Y'                                       CGL008
      *                                                                   CGL008
      ** Check the Authorities of this account code                       CGL008
      *                                                                   CGL008
     C                     MOVE #1ACCD    WWACCD                          CGL008
      *                                                                   CGL008
     C           KCAUAC    CHAINSFACAUL0             22                   CGL008
      *                                                                   CGL008
      ** If no record found, the input is not allowed                     CGL008
      *                                                                   CGL008
     C           *IN22     IFEQ *ON                                       CGL008
     C                     MOVEL'CGL0001' ZAMSID                          CGL008
     C                     MOVEL'GLUSRMSG'ZAMSGF                          CGL008
     C                     EXSR ZASNMS                                    CGL008
     C                     MOVE *ON       *IN99                           CGL008
     C                     MOVE *ON       *IN33                           CGL008
     C                     ENDIF                                          CGL008
     C                     ENDIF                                          CGL008
     C                     ENDIF                                          CGL008
      *                                                                   CGL008
     C/COPY WNCPYSRC,GL0123RC37
     C                     END                             *FI
      * End of Fix LN0334
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Account ID Status Flag is Customer No or short name
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
     C                     MOVEL'N'       WUACIC           Account Identif
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0058           Account code
      * Send message 'Account Code Required'
     C                     MOVEL'GLX0124' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UKEXIT    ENDSR
      /EJECT
     CSR         ULSUBR    BEGSR
      *================================================================
      * Account Sequence Validation
      *================================================================
      * CASE: DTL.Account sequence number is Blank
     C           #1ACSN    IFEQ *BLANK                     *IF
      * CASE: WRK.Account ID Status Flag is Customer No or short name
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
     C                     MOVEL'N'       WUACIC           Account Identif
      * Setup message data for message
     C                     MOVEL#1ACSN    ZA0059           Account sequenc
      * Send message 'Ac Sequence Not Blank'
     C                     MOVEL'GLX0122' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9934  *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: DTL.Account sequence number is First to Last
     C           #1ACSN    IFGE '01'                       *IF
     C           #1ACSN    ANDLE'99'
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUACIC           Account Identif
      * Setup message data for message
     C                     MOVEL#1ACSN    ZA0060           Account sequenc
      * Send message 'Ac Seq Number Required'
     C                     MOVEL'GLX0134' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9934  *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         ULEXIT    ENDSR
      /EJECT
     CSR         UMSUBR    BEGSR
      *================================================================
      * Branch Code Validation
      *================================================================
      * CASE: PAR.Multiple Branch Batch is Yes
     C           P2MBRB    IFEQ 'Y'                        *IF
      * CASE: DTL.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * CASE: DTL.Input Branch Code - Alpha is Select Request
     C           #1IBCA    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1IBCA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0061           Input Branch Co
      * Send message 'Branch Code not found'
     C                     MOVEL'GLX0045' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9935  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUBRCD    #1IBCA           Input Branch Co
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UMEXIT    ENDSR
      /EJECT
     CSR         UNSUBR    BEGSR
      *================================================================
      * Validate Customer report name & Account name
      *================================================================
      * SAR017 Start
      * CASE: WRK.GL Description Ind. is Yes
     C           WUGLDI    IFEQ 'Y'                        *IF
      * Determine whether to display Account Name
     C           WUAISF    IFNE '*SHNAME'                                 128957
     C                     EXSR UOSUBR                     Determine wheth
      * Determine whether to display Customer Report Name
     C                     EXSR UPSUBR                     Determine wheth
     C                     ELSE                                           128957
     C                     EXSR UPSUBR                     Determine wheth128957
     C                     EXSR UOSUBR                     Determine wheth128957
     C                     END                                            128957
      * Determine Whether to Re-display screen for Cust & A/c Name
      * CASE: WRK.Disp Screen Loop is Equal First
     C           #DDCNM    IFNE ##DCNM                                    128957
     C           #DDACN    ORNE ##DACN                                    128957
     C/COPY WNCPYSRC,GL0123RC85
     C                     Z-ADD1         WUDSLP                          128957
     C                     MOVE 'Y'       #CNFRM                          128957
     C                     END                             *FI            128957
     C           WUDSLP    IFEQ 1                          *IF
      * If already confirmed, don't set again - if 1st time do set        128957
     C           #CNFRM    IFEQ 'Y'                        *IF            128957
     C/COPY WNCPYSRC,GL0123RC93
     C                     MOVE 'Y'       W0DCF            *Defer confirm 128957
     C                     ELSE                                           128957
     C                     MOVE *BLANK    #CNFRM  1                    rm 128957
     C                     END                             *FI            128957
     C                     MOVEL#DDCNM    WUCDCN           Copy:Display Cu
     C                     MOVEL#DDACN    WUCDAN           Copy:Display Ac
     C                     ADD  1         WUDSLP           Disp Screen Loo
     C************         MOVEL'Y'       W0DCF            *Defer confirm 085282
     C                     ELSE
     C                     MOVE *BLANKS   #CNFRM           *Defer confirm 128957
      * CASE: *OTHERWISE
      * CASE: WRK.Copy:Display Cust Name NE DTL.Display Customer Name
     C           WUCDCN    IFNE #DDCNM                     *IF
     C                     Z-ADD1         WUDSLP           Disp Screen Loo
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     MOVEL'Y'       #CNFRM           *Defer confirm 128957
     C                     END                             *FI
      * CASE: WRK.Copy:Display Account name NE DTL.Display Account Name
     C           WUCDAN    IFNE #DDACN                     *IF
     C                     Z-ADD1         WUDSLP           Disp Screen Loo
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     MOVEL'Y'       #CNFRM           *Defer confirm 128957
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVE #DDCNM    ##DCNM 20                       128957
     C                     MOVE #DDACN    ##DACN 20                       128957
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     MOVEL'N'       WUDCUS           Display Custome
     C                     END                             *FI
      * SAR017 End
      *================================================================
     CSR         UNEXIT    ENDSR
      /EJECT
     CSR         UOSUBR    BEGSR
      *================================================================
      * Determine whether to display Account Name
      *================================================================
     C                     MOVEL'Y'       WUDSAC           Display Account
      * CASE: DTL.Account Identifier is Not Entered
     C           #DACID    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Not Retail
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
     C***********WUAISF    OREQ '*NOSTRO'                                 128957
      * CASE: DTL.Currency code is Blank
     C           #1CYCD    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     END                             *FI
      * CASE: DTL.Account code is Blank
     C           #1ACCD    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     END                             *FI
      * CASE: DTL.Account sequence number is Blank
     C           #1ACSN    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Customer Number
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C                     MOVEL#DACID    #1CUST           Customer number
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Retail                        128957
      * Cannot use #1CUST as it contains the previous value as it is a    128957
      * hidden field (6 A) on the display file                            128957
     C           WUAISF    IFEQ '*RETAIL'                  *IF            128957
     C                     MOVE *BLANKS   #1CUST                          128957
     C                     END                             *FI            128957
     C           WUAISF    IFEQ '*NOSTRO'                  *IF            128957
     C                     EXSR NOSUBR                                    128957
     C                     END                             *FI            128957
      * CASE: WRK.Display Account is Yes
     C           WUDSAC    IFEQ 'Y'                        *IF
      *     E18852  - Branch Code Of trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C           WUAISF    IFNE '*NOSTRO'                  *IF            128957
     C                     MOVEL#DACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C                     END                             *FI            128957
     C/COPY WNCPYSRC,GL0123RC51
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0123RC52
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C***********          MOVELSTYP      WUACTY           Account Sub-TypCEU013
     C                     MOVELSTYP      WUBPST           Account Sub-TypCEU013
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUDACN           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL'N'       WUDSAC           Display Account
     C                     MOVE *BLANKS   CNUM             Customer Number128957
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUDACN    #DDACN           Display Account
     C                     MOVELCNUM      #1CUST           Customer Number128957
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UOEXIT    ENDSR
      /EJECT
     CSR         NOSUBR    BEGSR                                          128957
      *                                                                   128957
      * Obtain nostro code - Standard functions  *                        128957
     C                     MOVEL#DACID    UXNOST  5        Nostro         128957
     C                     MOVELUXNOST    #1CYCD           Nostro Ccy.    128957
     C                     MOVE UXNOST    #1NNBI           Nostro No.     128957
      * Access Nostro Details. - Nostro Details  *                        128957
     C*                                                                   128957
     C* Set up Parameters for call to AONOSTR0                            128957
     C*                                                                   128957
     C                     MOVEL#1CUST    UUCUST                          128957
     C                     MOVEL#1CYCD    UUCYCD                          128957
     C                     MOVE *BLANKS   UUACCD                          128957
     C                     MOVE *BLANKS   UUACSN                          128957
     C                     MOVEL#1NNBI    UUNONB                          128957
     C                     MOVEL#1IBCA    UUBRCD                          128957
     C*                                                                   128957
     C*  Access Nostro Details file for the file fields                   128957
     C*                                                                   128957
     C                     CALL 'AONOSTR0'                                128957
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    128957
     C                     PARM '*KEY'    UUAPOP  7        I:Option       128957
     C                     PARM           UUCUST  6        I:Customer No. 128957
     C                     PARM           UUCYCD  3        I:Currency Code128957
     C**********           PARM           UUACCD  4        I:Account Code              128957 CGL029
     C                     PARM           UUACCD                                              CGL029
     C                     PARM           UUACSN  2        I:Account Seque128957
     C                     PARM           UUNONB  2        I:Nostro Number128957
     C                     PARM           UUBRCD  3        I:Branch Code  128957
     C                     PARM *BLANK    UUCSSN 10        I:Cust ShortN  128957
     C                     PARM *BLANK    UUPNOI  1        I:Prime Nost In128957
     C           D@NOST    PARM *BLANK    UUFDY            O:Format       128957
     C*                                                                   128957
     C* Assign work field to file field values.                           128957
     C*                                                                   128957
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL*BLANKS   WUNOSN           Nostro ShortnamCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C                     ELSE                                           CEU013
     C                     MOVELA7CYCD    WUCYCD           Currency Code  128957
     C                     MOVELA7ACCD    WUACCD           Account Code   128957
     C                     MOVELA7CUST    WUCUST           Customer Number128957
     C                     MOVELA7ACSN    WUACSN           Account Sequenc128957
     C                     MOVELA7NOSN    WUNOSN           Nostro Shortnam128957
     C                     MOVELA7BRCD    WUIBCA           Branch Code    128957
     C                     ENDIF                                          CEU013
     C*                                                                   128957
      * CASE: WRK.Access Pgm Return Code is Access Error                  128957
     C           WUAPRC    IFEQ '*CLOSE'                   *IF            128957
     C           WUAPRC    OREQ '*ERROR'                                  128957
     C           WUAPRC    OREQ '*OPEN'                                   128957
     C           WUAPRC    OREQ '*KEY'                                    128957
     C           WUAPRC    OREQ '*NRF'                                    128957
     C           WUAPRC    OREQ '*EMPTY'                                  128957
     C           WUAPRC    OREQ '*EOF'                                    128957
     C           WUAPRC    OREQ '*OPTION'                                 128957
     C           WUAPRC    OREQ '*CALL'                                   128957
     C           WUAPRC    OREQ '*SELECT'                                 128957
     C           WUAPRC    OREQ '*NOSEL'                                  128957
     C           WUAPRC    OREQ '*ID'                                     128957
      * Setup message data for message                                    128957
     C                     MOVEL#DACID    ZA0066           Account Identif128957
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*    Nost code not valid is changed as a warning.                   CEU013
     C*                                                                   CEU013
     C           WP0009    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0410' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     MOVEL#DACID    UUACID                          CEU013
     C                     MOVELWUCUST    UUCUST                          CEU013
     C                     MOVELWUCYCD    UUCYCD                          CEU013
     C                     MOVELWUACCD    UUACNO                          CEU013
     C                     MOVELWUACSN    UUACSN                          CEU013
     C                     MOVELWUIBCA    UUBRCD                          CEU013
     C                     MOVEL'Y'       WUDCUS           Display CUST   CEU013
     C                     ELSE                                           CEU013
      *                                                                   CEU013
      * Send message 'Nostro code not valid'                              128957
     C                     MOVEL'GLX0065' ZAMSID                          128957
     C                     MOVEL'N'       WUDSAC           Display AccountCEU013
     C                     MOVEL'N'       WUDCUS           Display CUST   CEU013
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS                                    128957
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     9931  *              128957
     C*********************MOVEL'N'       WUDSAC           Display A128957CEU013
     C*********************MOVEL'N'       WUDCUS           Display C128957CEU013
      *                                                                   128957
     C                     ELSE                                           128957
     C                     MOVEL#DACID    UUACID                          128957
     C                     MOVELWUCUST    UUCUST                          128957
     C                     MOVELWUCYCD    UUCYCD                          128957
     C                     MOVELWUACCD    UUACNO                          128957
     C                     MOVELWUACSN    UUACSN                          128957
     C                     MOVELWUIBCA    UUBRCD                          128957
     C                     MOVEL'Y'       WUDCUS           Display CUST   128957
     C                     END                                            128957
      *                                                                   128957
     CSR         NOEXIT    ENDSR                                          128957
      /EJECT                                                              128957
     CSR         UPSUBR    BEGSR
      *================================================================
      * Determine whether to display Customer Report Name
      *================================================================
      * CASE: DTL.Account Identifier is Entered
     C           #DACID    IFNE *BLANK                     *IF
      * CASE: WRK.Account ID Status Flag is Retail
     C           WUAISF    IFEQ '*RETAIL'                  *IF
     C***********          MOVEL*BLANK    WUCNCD           Client key     128957
     C***********          MOVEL#1CUST    WUCNCD           Client key     128957
     C                     MOVELWUCUST    WUCNCD    P      Client key     128957
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#DACID    WUCNCD           Client key
     C                     END                             *FI
      *                                                                   128957
     C           WUAISF    IFEQ '*NOSTRO'                  *IF            128957
     C           WUDCUS    IFEQ 'N'                        *IF            128957
     C                     MOVE *BLANKS   WUCNCD           Client key     128957
     C                     ELSE                            *FI            128957
     C                     MOVELWUCUST    WUCNCD    P      Client key     128957
     C                     END                             *FI            128957
     C                     END                             *FI            128957
      * Access Cust Report Name - Standard functions  *
     C*
     C* Access Customer Report Name Off Client File
     C*
     C                     MOVE *BLANK    WUCRST  7
     C**
     C                     CALL 'AOCUSTR0'
     C***********#BAORC****PARM #BAORC    P@RTN   7        B:Return code  S01117
     C           WUAPRC    PARM WUAPRC    P@RTN   7        B:Access Pgm ReS01117
     C*********************PARM #IAOPN    P@OPTN  7        I:Option       S01117
     C                     PARM '*KEY'    P@OPTN  7        I:Access Pgm OpS01117
     C                     PARM WUCNCD    P@CKEY 10        I:Key field
     C           WUCRST    PARM *BLANK    P@FLD1  7        O:Client Key Id.
     C*********************PARM           P@AORF           O:Format       S01117
     C           D@CUST    PARM *BLANK    UUSDY            O:Format       S01117
     C*
     C                     MOVELBBCRNM    WUCRNM           O:Cust Report Nme
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C           WUAPRC    OREQ '*CUSCLS'                                                     CGL148
     C           WUAPRC    OREQ '*CUSDEL'                                                     CGL148
     C                     MOVEL'N'       WUDCUS           Display Custome
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCRNM    #DDCNM           Display Custome
     C                     MOVEL'Y'       WUDCUS           Display Custome
     C                     MOVELBBCUST    #1CUST           Display Custome128957
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUDCUS           Display Custome
     C                     END                             *FI
      *================================================================
     CSR         UPEXIT    ENDSR
      /EJECT
     CSR         UQSUBR    BEGSR
      *================================================================
      * Check Account Identifier
      *================================================================
      * Check Account Identifier. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTV0
     C*
     C                     MOVEL#DACID    UUACID
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACCD
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C/COPY WNCPYSRC,GL0123RC53
     C*
     C*  Call to Access Program - AOACCTV0 Check Account Identifier
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTV0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACCD  4        I:Account Code                     CGL029
     C                     PARM           UUACCD                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch Code  nce
     C           UUAISF    PARM           UUAISF  7        O:Account ID Status
     C           UUNNBI    PARM           UUNNBI  2        O:Nostro Number -Item
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0123RC54
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUAISF    WUAISF           Account Id Status
     C                     MOVELUUNNBI    WUNNBI           Nostro No Item
     C*
     C* Screen field values are moved into work fields, if the record     CEU013
     C*  is not found.  This prevents the default of previous record's    CEU013
     C*  values for the current record.                                   CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WUAPRC    ANDNE*BLANKS                                   CEU013
     C                     MOVEL#1NNBI    WUNNBI           Nostro No Item CEU013
     C                     MOVEL#1CUST    WUCUST           Customer NumberCEU013
     C                     MOVEL#1CYCD    WUCYCD           Currency Code  CEU013
     C                     MOVEL#1ACCD    WUACCD           Account Code   CEU013
     C                     MOVEL#1ACSN    WUACSN           Account SequencCEU013
     C                     MOVEL#1IBCA    WUIBCA           Branch Code    CEU013
     C           #1ACCD    IFNE *BLANKS                                   CEU013
     C                     MOVELA5ACTY    WUACTY           Account Type   CEU013
     C                     ELSE                                           CEU013
     C                     MOVEL#1ACTY    WUACTY           Account Type   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVEL*BLANKS   WUBPST           Account Sub-TypCEU013
     C                     MOVEL*BLANKS   WUACCS           Account Status CEU013
     C                     MOVE *ZEROS    WUDACO           Date Account OpCEU013
     C                     MOVEL*BLANKS   WUACNM           Account Name   CEU013
     C                     MOVEL#1RACN    WURACN           Retails AccountCEU013
     C                     MOVE *ZEROS    WURRNM           Relative rec NoCEU013
     C**********           MOVEL*BLANK    WURETB           Retail Indic'tr             CEU013 203566
     C                     BITOF'01234567'WURETB                                              203566
     C                     ELSE                                           CEU013
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     ENDIF                                          CEU013
     C/COPY WNCPYSRC,GL0123RC69
     C*
      * CASE: WRK.Account ID Status Flag is Customer Not Found
     C           WUAISF    IFEQ '*CUSTNO'                  *IF
      * Setup message data for message
     C                     MOVEL#DACID    ZA0065           Account Identif
      * Send message 'Customer not found'
     C                     MOVEL'GLX0084' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Nostro Not Found
     C           WUAISF    IFEQ '*NOSTNO'                  *IF
      * Setup message data for message
     C                     MOVEL#DACID    ZA0066           Account Identif
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*    Nost code not valid is changed as a warning.                   CEU013
     C*                                                                   CEU013
     C           WP0009    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C                     MOVEL'GLX0410' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     ELSE                                           CEU013
      *                                                                   CEU013
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     9931  *
      *
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Customer Shortname Err
     C           WUAISF    IFEQ '*SHNERR'                  *IF
      * Setup message data for message
     C                     MOVEL#DACID    ZA0067           Account Identif
      * Send message 'Nostro/Cust Shortname NF'
     C                     MOVEL'GLX0129' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Account Id Error
     C           WUAISF    IFEQ '*ERROR'                   *IF
      * Setup message data for message
     C                     MOVEL#DACID    ZA0068           Account Identif
      * Send message 'Account ID not valid ERR'
     C                     MOVEL'GLX0119' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Account Identifier Check is Yes
     C           WUACIC    IFEQ 'Y'                        *IF
     C/COPY WNCPYSRC,GL0123RC63
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C/COPY WNCPYSRC,GL0123RC26
      *                                                                                       CGL148
      ** Check if:                                                                            CGL148
      **  -- account does not exist but all fields are valid and                              CGL148
      **  -- account type is not retail or nostro                                             CGL148
      **  -- account is not "Title Only"                                                      CGL148
      **  -- if CGL148 is on                                                                  CGL148
      ** then allow the entry (system will open the account during COB)                       CGL148
      *                                                                                       CGL148
     C           A5ACTY    IFNE 'R'                                                           CGL148
     C           A5ACTY    ANDNE'N'                                                           CGL148
      *                                                                                       CGL148
     C           A5TOIN    IFNE 'Y'                                                           CGL148
     C           CGL148    ANDEQ'Y'                                                           CGL148
      *                                                                                       CGL148
     C                     MOVEL#DACID    WUCUST                                              CGL148
     C                     MOVEL#1CYCD    WUCYCD                                              CGL148
     C                     MOVEL#1ACCD    WUACCD                                              CGL148
     C                     MOVEL#1ACSN    WUACSN                                              CGL148
     C                     MOVEL#1IBCA    WUIBCA                                              CGL148
     C                     MOVELA5ACTY    WUACTY                                              CGL148
     C                     MOVEL*BLANKS   WUBPST                                              CGL148
     C                     MOVEL*BLANKS   WUACCS                                              CGL148
     C                     MOVEL*BLANKS   WUDACO                                              CGL148
     C                     MOVEL*BLANKS   WUACNM                                              CGL148
     C                     MOVEL*BLANKS   WURACN                                              CGL148
     C                     MOVEL*BLANKS   WURRNM                                              CGL148
     C                     MOVEL*BLANKS   WURETB                                              CGL148
     C                     MOVEL#DACID    ZA0069                                              CGL148
     C                     MOVEL#1CYCD    ZA0070                                              CGL148
     C                     MOVEL#1ACCD    ZA0071                                              CGL148
     C                     MOVEL#1ACSN    ZA0072                                              CGL148
      * Send Warning - GL Account does not exist                                              CGL148
     C                     MOVEL'GLW0054' ZAMSID                                              CGL148
     C                     EXSR ZASNMS                                                        CGL148
     C                     GOTO SKIP1                                                         CGL148
     C                     ELSE                                                               CGL148
      * Setup message data for message                                                        CGL148
     C                     MOVEL#DACID    ZA0069                                              CGL148
     C                     MOVEL#1CYCD    ZA0070                                              CGL148
     C                     MOVEL#1ACCD    ZA0071                                              CGL148
     C                     MOVEL#1ACSN    ZA0072                                              CGL148
      * Send message 'Account number not valid'                                               CGL148
     C                     MOVEL'GLX0054' ZAMSID                                              CGL148
     C                     EXSR ZASNMS                                                        CGL148
     C                     SETON                     993132                                   CGL148
     C                     SETON                     3334                                     CGL148
     C                     GOTO SKIP1                                                         CGL148
     C                     ENDIF                                                              CGL148
      **                                                                                      CGL148
     C                     ENDIF                                                              CGL148
      **                                                                                      CGL148
     C           A5ACTY    IFEQ 'R'                                                           CGL148
     C           A5ACTY    OREQ 'N'                                                           CGL148
      **                                                                                      CGL148
      * Setup message data for message
     C                     MOVEL#DACID    ZA0069           Account Identif
     C                     MOVEL#1CYCD    ZA0070           Currency code
     C                     MOVEL#1ACCD    ZA0071           Account code
     C                     MOVEL#1ACSN    ZA0072           Account sequenc
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*    posting account code type is Retail or Nostro,                 CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*                                                                   CEU013
     C           WP0009    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           WP0009    OREQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'N'                                       CEU013
     C                     MOVEL'GLX0407' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     ELSE                                           CEU013
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     993132*
     C                     SETON                     3334  *
     C/COPY WNCPYSRC,GL0123RC27
     C                     ENDIF                                                              CGL148
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Account status is Closed
     C********** WUACCS    IFEQ 'C'                        *IF                                206317
     C********** WUAPRC    IFEQ '*ACST  '                                              206317 237508
     C           WUACCS    IFEQ 'C'                        *IF                                237508
     C           WURECI    ANDEQ'C'                        *IF                                237508
      * Setup message data for message
     C                     MOVEL#DACID    ZA0073           Account Identif
     C                     MOVEL#1CYCD    ZA0074           Currency code
     C                     MOVEL#1ACCD    ZA0075           Account code
     C                     MOVEL#1ACSN    ZA0076           Account sequenc
     C*                                                                   CEU013
     C* If switchable function CEU013 is installed, the batch is from     CEU013
     C*   external interface and the currency is an 'In' currency,        CEU013
     C*   the account is Retail or Nostro, then the                       CEU013
     C*   'account is closed' is converted as a warning.                  CEU013
     C*                                                                   CEU013
     C           WP0009    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           WUAISF    ANDEQ'*RETAIL'                                 CEU013
     C           WP0009    OREQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           WUAISF    ANDEQ'*NOSTRO'                                 CEU013
     C                     MOVEL'GLX0409' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR                           CEU013
     C                     ELSE                                           CEU013
      * Send message 'Account is Closed'
     C                     MOVEL'GLX0126' ZAMSID
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     993132*
     C                     SETON                     3334  *
      *
     C                     END                             *FI
      * Account flagged for closure                                                           237508
     C           WUACCS    IFEQ 'C'                        *IF                                237508
     C           WURECI    ANDEQ'D'                        *IF                                237508
      * Setup message data for message                                                        237508
     C                     MOVEL#DACID    ZA0073           Account Identif                    237508
     C                     MOVEL#1CYCD    ZA0074           Currency code                      237508
     C                     MOVEL#1ACCD    ZA0075           Account code                       237508
     C                     MOVEL#1ACSN    ZA0076           Account sequenc                    237508
      *                                                                                       237508
      * Send message 'Account is flagged for closure                                          237508
     C**********           MOVEL'GLX0427' ZAMSID                                     237508 AR782538
     C                     MOVEL'GLX0409' ZAMSID                                            AR782538
     C                     MOVE 'Y'       WWFLG                                               237508
     C                     EXSR ZASNMS                                                        237508
     C                     END                             *FI                                237508
      *                                                                                       237508
      *                                                                                       237508
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.Account ID Status Flag is Retail
     C           WUAISF    IFEQ '*RETAIL'                  *IF
     C                     MOVEL'Y'       #1RNBE           Retail Number E
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       #1RNBE           Retail Number E
     C                     END                             *FI
      * CASE: WRK.Access Pgm Return Code is *No Errors
     C           WUAPRC    IFEQ *BLANK                     *IF
      * CASE: WRK.Account ID Status Flag is Customer No or short name
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
      * Set Screen Fields = File Fields
     C                     EXSR URSUBR                     Set Screen Fiel
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUAIVL           Ac Id Valid-Ret
      * Check Input Of Currency
      * CASE: PAR.Currency code is Not blank
     C           #1CYCD    IFNE *BLANK                     *IF
      * CASE: WRK.Currency code EQ PAR.Currency code
     C           WUCYCD    IFEQ #1CYCD                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUAIVL           Ac Id Valid-Ret
     C                     END                             *FI
     C                     END                             *FI
      * Check Input Of Account Code
      * CASE: PAR.Account code is Not blank
     C           #1ACCD    IFNE *BLANK                     *IF
      * CASE: WRK.Account code EQ PAR.Account code
     C           WUACCD    IFEQ #1ACCD                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUAIVL           Ac Id Valid-Ret
     C                     END                             *FI
     C                     END                             *FI
      * Check Input Of Account Sequence
      * CASE: PAR.Account sequence number is Not blank
     C           #1ACSN    IFNE *BLANK                     *IF
      * CASE: WRK.Account sequence number EQ PAR.Account sequence number
     C           WUACSN    IFEQ #1ACSN                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUAIVL           Ac Id Valid-Ret
     C                     END                             *FI
     C                     END                             *FI
      * Check Input Of Branch Code
      * CASE: PAR.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * CASE: WRK.Input Branch Code - Alpha EQ PAR.Input Branch Code - Alpha
     C           WUIBCA    IFEQ #1IBCA                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUAIVL           Ac Id Valid-Ret
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.Ac Id Valid-Ret & Nost is Yes
     C           WUAIVL    IFEQ 'Y'                        *IF
      * Set Screen Fields = File Fields
     C                     EXSR USSUBR                     Set Screen Fiel
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#DACID    ZA0077           Account Identif
     C                     MOVEL#1CYCD    ZA0078           Currency code
     C                     MOVEL#1ACCD    ZA0079           Account code
     C                     MOVEL#1ACSN    ZA0080           Account sequenc
      *                                                                   CEU013
     C* If switchable function 'EMU Account Postings Narrative' is        CEU013
     C*    installed and the Posting currency is an 'In' currency,        CEU013
     C*    posting account code type is Retail or Nostro,                 CEU013
     C*     and is an interface journal header, issue a warning message.  CEU013
     C*                                                                   CEU013
     C           WP0009    IFEQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           WP0009    OREQ 'V'                                       CEU013
     C           CEU013    ANDEQ'Y'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'N'                                       CEU013
     C                     MOVEL'GLX0407' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     ELSE                                           CEU013
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     ENDIF                                          CEU013
     C                     EXSR ZASNMS
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     993132*
     C                     SETON                     3334  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Start of Fix LN0334
     C                     MOVEL*BLANK    WUACTY           Account type
      * End of Fix LN0334
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC28
     C           SKIP1     TAG                                                                CGL148
      *================================================================
     CSR         UQEXIT    ENDSR
      /EJECT
     CSR         URSUBR    BEGSR
      *================================================================
      * Set Screen Fields = File Fields
      *================================================================
      * CASE: WRK.Account ID Status Flag is Customer Short Name
     C           WUAISF    IFEQ '*SHNAME'                  *IF
     C                     MOVEL*BLANK    #DACID           Account Identif
     C                     MOVELWUCUST    #DACID           Account Identif
     C                     END                             *FI
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUIBCA    #1IBCA           Input Branch Co
     C                     MOVELWUNNBI    #1NNBI           Nostro number (
     C                     MOVELWUACTY    #1ACTY           Account type
     C                     Z-ADDWURACN    #1RACN           Retail account
     C                     Z-ADDWURRNM    #1RRNM           Relative rec no
      *================================================================
     CSR         UREXIT    ENDSR
     CSR         URRETK    BEGSR
      *====================================================
      * Check Retail Account status
      *----------------------------------------------------
      *
     C                     MOVE *IN90     URSI90  1        Save indicator
     C                     MOVE *IN91     URSI91  1        Save indicator
     C                     MOVE *BLANK    URIESL           Blank msg.text
     C                     MOVE *BLANK    URERST  1        Error status
     C                     Z-ADD1         U1      30       Set pointer
     C                     SETOF                     91    Set ind.
      *
      * Check Refer Debits :
      *
     C           URIND     IFEQ 'D'                        ONLY IF DEBIT  E17600
      *
     C                     TESTB'0'       URRETI  1      90=Refer debits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE01    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Refer Dr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSRD             Refer DR
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Refer Credits :
      *
     C           URIND     IFEQ 'C'                        ONLY IF CREDIT E17600
      *
     C                     TESTB'1'       URRETI         90 Refer credits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE02    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Refer Cr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSRC             Refer CR     S01212
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Block Debits :
      *
     C           URIND     IFEQ 'D'                        ONLY IF DEBIT  E17600
      *
     C                     TESTB'2'       URRETI         90 Block debits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE03    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Block Dr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSBD             Block DR     S01212
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Block Credits :
      *
     C           URIND     IFEQ 'C'                        ONLY IF CREDIT E17600
      *
     C                     TESTB'3'       URRETI         90 Block credits
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE04    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Block Cr'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSBC             Block CR     S01212
     C                     END                             FI
     C                     END                             FI             E17600
      *
      * Check Inactive A/C :
      *
     C                     TESTB'4'       URRETI         90 Inactive a/c
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE05    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Inactive'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSIN             Inactive     S01212
     C                     END                             FI
      *
      * Check Not in Use :   ***REMOVE COMMENTS IF FLAG TO BE USED LATER***
      *
     C*****                TESTB'5'       URRETI         90 -Not in Use-
      *
     C*****      *IN90     IFEQ '1'                        IF BIT SET
     C*****      URRE06    IFNE 'Y'                        IF NO O'RIDE
     C*****                MOVELURRIHF    @IH,U1             Blnk.H'Light
     C*****                SETON                     91      No O'ride
     C*****                ELSE                            EL O'RIDEABLE
     C*****                MOVELURRIHS    @IH,U1             Highlight
     C*****                END                             FI
     C*****                MOVE 'Not used'@IH,U1             Message text
     C*****                ADD  1         U1                 Incr.pointer
     C*****                MOVE 'Y'       WURTSS             Spare Cond.  S01212
     C*****                END                             FI
      *
      * Check Bankrupt :
      *
     C                     TESTB'6'       URRETI         90 B'rupt/L'dated
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE07    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Bankrupt'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSBR             Bankrupt     S01212
     C                     END                             FI
      *
      * Check Bad Debt :
      *
     C                     TESTB'7'       URRETI         90 Bad debt
      *
     C           *IN90     IFEQ '1'                        IF BIT SET
     C           URRE08    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Bad Debt'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURTSB             Bad Debt     S01212
     C                     END                             FI
      *
      * Check Stopped cheque :
      *
     C           URSTOP    IFEQ '*STOP  '                  IF STOPPED
     C           URRE09    IFNE 'Y'                        IF NO O'RIDE
     C                     MOVELURRIHF    @IH,U1             Blnk.H'Light
     C                     SETON                     91      No O'ride
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVELURRIHS    @IH,U1             Highlight
     C                     END                             FI
     C                     MOVE 'Chq.Stop'@IH,U1             Message text
     C                     ADD  1         U1                 Incr.pointer
     C                     MOVE 'Y'       WURSSC             Stop.Chq     S01212
     C                     END                             FI
      *
     C           CRE008    IFEQ 'Y'                                                           216088
     C           URIND     ANDEQ'D'                                                           216088
      *                                                                                       216088
     C                     MOVEL#1IBCA    PIBRCH                                              216088
     C                     MOVEL#1CUST    PICUST                                              216088
     C                     MOVEL#1CYCD    PICURR                                              216088
     C                     MOVEL#1ACCD    PIACOD                                              216088
     C                     MOVEL#1ACSN    PIACSQ                                              216088
     C                     Z-ADD#1PTAM    PIDAMT                                              216088
      *                                                                                       216088
      ** Call Group Account Overdraft Limit Check Function.                                   216088
      *                                                                                       216088
     C                     CALL 'RE101901'                                                    216088
      *                                                                                       216088
     C                     PARM *BLANKS   PRCODE  7                                           216088
      *                                                                                       216088
      ** Input parameters                                                                     216088
      *                                                                                       216088
     C                     PARM           PIBRCH  3                                           216088
     C**********           PARM           PICUST  60                                   216088 CSD027
     C                     PARM           PICUST  6                                           CSD027
     C                     PARM           PICURR  3                                           216088
     C                     PARM           PIACOD  40                                          216088
     C                     PARM           PIACSQ  20                                          216088
     C                     PARM           PIDAMT 150                                          216088
      *                                                                                       216088
      ** Output parameters                                                                    216088
      *                                                                                       216088
     C                     PARM *BLANKS   POBRCH  3                                           216088
     C**********           PARM *ZERO     POCUST  60                                   216088 CSD027
     C                     PARM *BLANKS   POCUST  6                                           CSD027
     C                     PARM *BLANKS   POCURR  3                                           216088
     C                     PARM *ZERO     POACOD  40                                          216088
     C                     PARM *ZERO     POACSQ  20                                          216088
     C                     PARM *ZERO     PORETN 100                                          216088
      *                                                                                       216088
     C           PRCODE    IFEQ '*ODLMTX'                                                     216088
      *                                                                                       216088
     C           URRE10    IFNE 'Y'                                                           216088
     C                     MOVELURRIHF    @IH,U1                                              216088
     C                     SETON                     91                                       216088
     C                     ELSE                                                               216088
     C                     MOVELURRIHS    @IH,U1                                              216088
     C                     ENDIF                                                              216088
      *                                                                                       216088
     C                     MOVE 'Exceeded'@IH,U1                                              216088
     C                     ADD  1         U1                                                  216088
     C                     MOVE 'Y'       WUFMST                                              216088
      *                                                                                       216088
      ** Set up warning message.                                                              216088
      *                                                                                       216088
     C                     MOVE POBRCH    WBRCDE                                              216088
     C                     MOVE '-'       WDASH1                                              216088
     C                     MOVE POCUST    WCUSTN                                              216088
     C                     MOVE '-'       WDASH2                                              216088
     C                     MOVE POACOD    WACOD                                               216088
     C                     MOVE '-'       WDASH3                                              216088
     C                     MOVE POACSQ    WACSQ                                               216088
     C                     MOVE '/'       WSLSH                                               216088
     C                     MOVE PORETN    WRETN                                               216088
      *                                                                                       216088
     C           PORETN    IFEQ *ZERO                                                         216088
     C                     MOVELWMDTA1    ZAMSDA    P                                         216088
     C                     ELSE                                                               216088
     C                     MOVELWMDTA2    ZAMSDA    P                                         216088
     C                     ENDIF                                                              216088
      *                                                                                       216088
     C                     MOVEL'CGL0005' ZAMSID                                              216088
     C                     MOVEL'GLUSRMSG'ZAMSGF                                              216088
     C                     EXSR ZASNMS                                                        216088
     C                     ENDIF                                                              216088
     C                     ENDIF                                                              216088
      *                                                                                       216088
      * Check Non-Overrideable error status :
      *
     C           U1        IFGT 1                          IF ERRORS
     C           U1        IFLT 9                          IF NOT MAXIMUM
     C                     MOVELURNORM    @IH,U1             End Highlight
     C                     END                             FI
     C                     MOVE URERMG    URERTX             Error line
     C           *IN91     IFEQ '1'                        IF NOT O'RIDE
     C                     MOVE 'E'       URERST             Error Status
     C                     ELSE                            EL O'RIDEABLE
     C                     MOVE 'O'       URERST             Error Status
     C                     END                             FI
     C                     ELSE                            EL NO ERRORS
     C                     MOVE *BLANK    URERST             Error Status
     C                     MOVE URDASH    URERTX 76          Dashes
     C                     END                             FI
      *
     C                     MOVE URSI90    *IN90            Restore ind.
     C                     MOVE URSI91    *IN91            Restore ind.
      *
      *----------------------------------------------------
      *
      *====================================================
     C**         UREXIT    ENDSR
     CSR         XXET      ENDSR
      /EJECT
     CSR         USSUBR    BEGSR
      *================================================================
      * Set Screen Fields = File Fields
      *================================================================
      * CASE: WRK.Account ID Status Flag is Customer Short Name
     C           WUAISF    IFEQ '*SHNAME'                  *IF
     C                     MOVEL*BLANK    #DACID           Account Identif
     C                     MOVELWUCUST    #DACID           Account Identif
     C                     ELSE
      * CASE: WRK.Account ID Status Flag is Retail
     C           WUAISF    IFEQ '*RETAIL'                  *IF
     C                     MOVELWURACN    #DACID           Account Identif
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUIBCA    #1IBCA           Input Branch Co
     C                     MOVELWUNNBI    #1NNBI           Nostro number (
     C                     MOVELWUACTY    #1ACTY           Account type
     C                     Z-ADDWURACN    #1RACN           Retail account
     C                     Z-ADDWURRNM    #1RRNM           Relative rec no
     C/COPY WNCPYSRC,GL0123RC86
      *================================================================
     CSR         USEXIT    ENDSR
      /EJECT
     CSR         UTSUBR    BEGSR
      *================================================================
      * Check Posting Amount
      *================================================================
      * Start of Fix LN0334
      * CASE: PAR.Currency code is Not Question Mark
     C           #1CYCD    IFNE '?'                        *IF
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUZNDE           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     Z-ADD*ZERO     WUZNDE           ZALIGN No Of De
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     WUZNDE           ZALIGN No Of De
     C                     END                             *FI
      * Set up Number of digits
      * CASE: WRK.ZALIGN No Of Decimals is Zero
     C           WUZNDE    IFEQ *ZERO                      *IF
     C***********          Z-ADD12        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD13        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.ZALIGN No Of Decimals is One
     C           WUZNDE    IFEQ 1                          *IF
     C***********          Z-ADD11        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD12        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.ZALIGN No Of Decimals is Two
     C           WUZNDE    IFEQ 2                          *IF
     C***********          Z-ADD10        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD11        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.ZALIGN No Of Decimals is Three
     C           WUZNDE    IFEQ 3                          *IF
     C***********          Z-ADD9         WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD10        WUZNDI           ZALIGN No Of Di089856
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DFMPA    WUZASF           ZALIGN Screen F
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0123RCP2                                           S01408
     C*                                                                   S01408
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0027  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0028 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0029  10       ZALIGN No Of De
     C                     PARM WUZNDI    WQ0030  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0031 16        ZALIGN File Fie
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0123RCP3                                           S01408
     C*                                                                   S01408
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0123RCP4                                           S01408
     C*                                                                   S01408
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0032 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0033  10       ZALIGN No Of De
      *
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0123RCP3                                           S01408
     C*                                                                   S01408
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#DFMPA    ZA0081           Formatted Posti
      * Send message 'Amount not valid'
     C                     MOVEL'GLX0063' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9936  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Move Fmt Posting Amount - Journal Entry Posting  *
     C*  MOVE ZALIGN FUNCTION FIELD INTO FORMATTED POSTING AMOUNT
     C                     MOVE WUZASF    #DFMPA
      * MOVE Posting Amount - Journal Entry Posting  *
     C*  MOVE ZALIGN FILE FIELD INTO POSTING AMOUNT
     C                     MOVE WUZAFF    #1PTAM
      * CASE: PAR.Posting amount is LE Zero
     C           #1PTAM    IFLE *ZERO                      *IF
      * Setup message data for message
     C                     MOVEL#DFMPA    ZA0082           Formatted Posti
      * Send message 'Amount not valid'
     C                     MOVEL'GLX0063' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9936  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * End of Fix LN0334
      *================================================================
     CSR         UTEXIT    ENDSR
      /EJECT
     CSR         UUSUBR    BEGSR
      *================================================================
      * Check Narrative
      *================================================================
     C                     MOVEL*BLANK    #1NVCD           Narrative code
     C                     MOVEL*BLANK    #1NRDC           Narrative descr
      * CASE: PAR.Narrative is Select Request
     C           #DNRTV    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Check Narrative - Standard functions  *
     C*  Check Narrative for Narrative code
     C*
     C                     MOVE #DNRTV    URNARR 28        Narrative slice
      *
     C           #DNRTV    IFNE *BLANK                     IF ¬BLANK
     C           URNARR    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*CODE  ' WUNRST             Code entered
     C                     MOVEL#DNRTV    #1NVCD             Narrative code
     C                     ELSE                            EL ¬BLANK
     C                     MOVE '*TEXT  ' WUNRST             Narrative text
     C                     MOVE *BLANK    #1NVCD             No Narr.code
     C                     END                             FI
     C                     ELSE                            EL BLANK
     C                     MOVE '*ERROR ' WUNRST             No narrative
     C                     MOVE *BLANK    #1NVCD             No Narr.code
     C                     END                             FI
      *
      * CASE: WRK.Narrative status is No narrative
     C           WUNRST    IFEQ '*ERROR'                   *IF
      * Setup message data for message
     C                     MOVEL#DNRTV    ZA0083           Narrative
      * Send message 'No Narrative entered'
     C                     MOVEL'GLX0055' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9939  *
      *
     C                     END                             *FI
      * CASE: WRK.Narrative status is Narrative code entered
     C           WUNRST    IFEQ '*CODE'                    *IF
      * Access Narrative. - Narrative Codes  *
     C*
     C*  Access Narrative codes file for the following fields
     C*  Narrative Code, Narrative Description
     C*
     C                     MOVEL#1NVCD    UUNVCD
     C                     CALL 'AONARRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUNVCD  2        I:Narrative Code
     C           D@NARR    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELALNVCD    WUNVCD           Narrative Code
     C                     MOVELALDON     WUDON            Description
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#DNRTV    ZA0084           Narrative
      * Send message 'Narrative Code not found'
     C                     MOVEL'GLX0049' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9939  *
      *
     C                     ELSE
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0123RC15                                           S01408
     C*                                                                   S01408
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DNRTV           Narrative
     C                     MOVELWUNVCD    #DNRTV           Narrative
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#DNRTV    #1NRDC           Narrative descr
     C                     END                             *FI
      *================================================================
     CSR         UUEXIT    ENDSR
      /EJECT
     CSR         UVSUBR    BEGSR
      *================================================================
      * Check Retail/Non-Retail Fields
      *================================================================
     C/COPY WNCPYSRC,GL0123RC03
      * CASE: WRK.Account type is Retail
     C* If CEU013 is installed, the batch is from external interface,     CEU013
     C*  account currency is an 'In' currency, and the account doesn't    CEU013
     C*  exist, the field from Account code is used instead of the        CEU013
     C*  work field. The work field has been overwritten with the         CEU013
     C*  previous account value.                                          CEU013
     C*                                                                   CEU013
     C           CGL002    IFEQ 'Y'                                       CGL010
     C           WUACTY    ANDEQ'G'                                       CGL010
     C***********WUACTY    OREQ 'R'                                                    CGL010 216088
     C                     EXSR SRGLOV                                    CGL010
     C                     ENDIF                                          CGL010
      *                                                                   CGL010
     C           CGL010    IFEQ 'N'                                       CGL010
      *                                                                   CGL010
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           *IN31     ANDEQ*ON                                       CEU013
     C           WWFLG     ANDEQ'Y'                                       CEU013
     C                     MOVE A5ACTY    WUACTY                          CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C           WUACTY    IFEQ 'R'                        *IF
      * Check Transaction Type
     C                     EXSR UWSUBR                     Check Transacti
      * Check Overridable Retail Errors
     C                     EXSR UXSUBR                     Check Overridab
      * Check Value Date
     C                     EXSR UYSUBR                     Check Value Dat
     C/COPY WNCPYSRC,GL0123RC55
     C                     ELSE
      * CASE: *OTHERWISE
      *                                                                   CGL002
      **  If Block GL Accounts Enhancement feature is switched on         CGL002
      **  and account type is GL, check overrideable GL errors            CGL002
      *                                                                   CGL002
     C           CGL002    IFEQ 'Y'                                       CGL002
     C           WUACTY    ANDEQ'G'                                       CGL002
     C                     EXSR SRGLOV                                    CGL002
     C                     ELSE                                           CGL002
      *                                                                   CGL002
      * Reset Retail Error Indicators
     C                     EXSR UZSUBR                     Reset Retail Er
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      * Check Transaction Type is Blank                                   092723
     C                     EXSR TTSUBR                     Check Transacti092723
      * Check Cheque No is Blank
     C                     EXSR NASUBR                     Check Cheque No
      * Check For Back Valuations
     C                     EXSR NBSUBR                     Check For Back
     C/COPY WNCPYSRC,GL0123RC24
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC04
     C                     ELSE                                           CGL010
      *                                                                   CGL010
      ** CASE: WRK.Account type is Retail                                 CGL010
      *                                                                   CGL010
     C           WUACTY    IFEQ 'R'                                       CGL010
      *                                                                   CGL010
      ** Check Transaction Type                                           CGL010
      *                                                                   CGL010
     C                     EXSR UWSUBR                                    CGL010
      *                                                                   CGL010
      ** Check Overridable Retail Errors                                  CGL010
      *                                                                   CGL010
     C                     EXSR UXSUBR                                    CGL010
     C                     ELSE                                           CGL010
      *                                                                   CGL010
      ** CASE: *Otherwise                                                 CGL010
      ** Reset Retail Error Indicators                                    CGL010
      *                                                                   CGL010
     C                     EXSR UZSUBR                                    CGL010
      *                                                                   CGL010
      ** Check Transaction Type is Blank                                  CGL010
      *                                                                   CGL010
     C                     EXSR TTSUBR                                    CGL010
      *                                                                   CGL010
      ** Check Cheque No is Blank                                         CGL010
      *                                                                   CGL010
     C                     EXSR NASUBR                                    CGL010
     C                     ENDIF                                          CGL010
      *                                                                   CGL010
      ** Test, if value date allowed                                      CGL010
      *                                                                   CGL010
     C                     MOVE *OFF      *IN19                           CGL010
     C                     SELEC                                          CGL010
     C           WUACTY    WHEQ 'R'                                       CGL010
     C                     MOVE *ON       *IN19                           CGL010
     C           WUACTY    WHEQ 'N'                                       CGL010
     C           BKAFVN    IFEQ 'Y'                                       CGL010
     C                     MOVE *ON       *IN19                           CGL010
     C                     ENDIF                                          CGL010
     C           WUACTY    WHEQ 'D'                                       CGL010
     C           BKAFVD    IFEQ 'Y'                                       CGL010
     C                     MOVE *ON       *IN19                           CGL010
     C                     ENDIF                                          CGL010
     C           WUACTY    WHEQ 'C'                                       CGL010
     C           BKAFVC    IFEQ 'Y'                                       CGL010
     C                     MOVE *ON       *IN19                           CGL010
     C                     ENDIF                                          CGL010
     C           WUACTY    WHEQ 'G'                                       CGL010
     C           BKAFVG    IFEQ 'Y'                                       CGL010
     C                     MOVE *ON       *IN19                           CGL010
     C                     ENDIF                                          CGL010
     C                     ENDSL                                          CGL010
      *                                                                   CGL010
      **  Check value date                                                CGL010
      *                                                                   CGL010
     C           *IN19     IFEQ *ON                                       CGL010
     C                     EXSR UYSUBR                                    CGL010
     C                     ELSE                                           CGL010
     C                     EXSR NBSUBR                                    CGL010
     C                     ENDIF                                          CGL010
     C                     ENDIF                                          CGL010
      *================================================================
     CSR         UVEXIT    ENDSR
      /EJECT
     CSR         UWSUBR    BEGSR
      *================================================================
      * Check Transaction Type
      *================================================================
      * CASE: PAR.Transaction type is Entered
     C           #1TRTY    IFNE *BLANK                     *IF
      * CASE: PAR.Transaction type is Select Request
     C           #1TRTY    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      *                                                                   176744
      ** If entry is Retail, move Rundate to value date field for         176744
      ** update if display field is blank.                                176744
      *                                                                   176744
     C           #DVDDS    IFEQ *BLANKS                                   176744
     C                     MOVE WURDNO    #1VLDT                          176744
     C                     END                                            176744
      * Access Retail Transact. - Retail Transaction Types  *
     C*
     C*  Access Retail Transaction types for the file fields
     C*
     C                     MOVEL#1TRTY    UURTTY
     C                     CALL 'AORETRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UURTTY  5        I:Retail Tran Type
     C           D@RETR    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA1RTTY    WURTTY           Retail Transaction Ty
     C                     MOVELA1RTNM    WURTNM           Retail Tran Name
     C                     MOVELA1COIN    WUCOIN           Cust Originated Ind
     C                     MOVELA1DCIN    WUDCIN           Debit/Credit Ind
     C                     MOVELA1RVIN    WURVIN           Reversal Indicator
     C                     MOVELA1PADI    WUPADI           Print Advices Ind
     C/COPY WNCPYSRC,GL0123RC08
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C*                                                                   CEU013
     C* If transaction type is not found, it is given as an error.        CEU013
     C*   This is in line with GL0122D validation.                        CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1TRTY    ZA0085           Transaction typCEU013
      * Send message 'Trans. type not valid'                              CEU013
     C                     MOVEL'GLX0059' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9941  *              CEU013
     C                     ELSE                                           CEU013
     C*                                                                   CEU013
      * CASE: PAR.Transaction (Sub - Type) is Entered
     C           #1TSTY    IFNE *BLANK                     *IF
     C                     ELSE
      * CASE: PAR.Book Code is Entered
     C           #1BKCD    IFNE *BLANK                     *IF
     C                     ELSE
      * CASE: PAR.Profit centre is Entered
     C           #1PRCN    IFNE *BLANK                     *IF
     C                     ELSE
      * CASE: PAR.Reverse/Void Indicator is Void
     C           #1RVDI    IFEQ 'Y'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1TRTY    ZA0085           Transaction typ
      * Send message 'Trans. type not valid'
     C                     MOVEL'GLX0059' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9941  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ENDIF                                          CEU013
     C                     ELSE
      *                                                                   132198
      ** Check that transaction type indicator is same as screen input    132198
      ** field indicator #1DCIN. If it is not output new error code.      132198
      *                                                                   132198
     C           WUAPRC    IFEQ *BLANK                                    132198
     C           #1DCIN    IFNE WUDCIN                                    132198
     C           WUDCIN    IFNE *BLANK                                    132198
     C                     MOVEL'GLX0997' ZAMSID                          132198
     C                     EXSR ZASNMS                                    132198
     C                     SETON                     9937                 132198
     C                     END                                            132198
     C                     END                                            132198
     C                     END                                            132198
      * CASE: *OTHERWISE
     C                     MOVELWURTTY    #1TRTY           Transaction typ
     C                     MOVELA1COIN    #1COIN           Customer Orig'd100028
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1TRTY    ZA0086           Transaction typ
      * Send message 'Must enter Trans Type'
     C                     MOVEL'GLX0107' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9941  *
      *
     C                     END                             *FI
      *================================================================
     CSR         UWEXIT    ENDSR
      /EJECT
     CSR         TTSUBR    BEGSR                                          092723
      *================================================================   092723
      * Check Transaction Type is Blank                                   092723
      *================================================================   092723
      * CASE: PAR.Transaction type is Entered                             092723
     C           #1TRTY    IFNE *BLANK                     *IF            092723
     C/COPY WNCPYSRC,GL0123RC79
      * Setup message data for message                                    092723
     C                     MOVEL#1TRTY    ZA0086           Transaction typ092723
      * Send message 'Trans. type must be blank'                          092723
     C                     MOVEL'GLX0061' ZAMSID                          092723
     C                     EXSR ZASNMS                                    092723
     C                     SETON                     9941  *              092723
     C/COPY WNCPYSRC,GL0123RC81
      *                                                                   092723
     C                     END                             *FI            092723
     C/COPY WNCPYSRC,GL0123RC09
      *================================================================   092723
     CSR         TTEXIT    ENDSR                                          092723
      /EJECT
     CSR         UXSUBR    BEGSR
      *================================================================
      * Check Overridable Retail Errors
      *================================================================
      * Validate Cheque Number
      * CASE: PAR.Cheque number is Not entered
     C           #1CQNB    IFEQ *BLANK                     *IF
     C                     MOVEL'00000000'WUCQNB           Cheque number
     C                     ELSE
      * CASE: *OTHERWISE
      * Start of Fix LN0334
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#1CQNB    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0034  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0035 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0036  10       ZALIGN No Of De
     C                     PARM 8         WQ0037  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0038 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0039 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0040  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0087           Cheque number
      * Send message 'Cheque Number Numeric'
     C                     MOVEL'GLX0209' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9944  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * ZALIGN Screen- Cheque No - Standard functions  *
     C* Move ZALIGNed screen field to Cheque Number field before
     C* checking for a Stopped Cheque.
     C*********************MOVE #IZASF    #OCQNB
     C***********          MOVE WUZSCO    #1CQNB                          126299
     C                     MOVE WUZASF    #1CQNB                          126299
     C                     MOVEL#1CQNB    WUCQNB                          118976
     C*
      * Verify Stopped Cheque
      * CASE: PAR.Debit/credit indicator is Debit
     C           #1DCIN    IFEQ 'D'                        *IF
      * Verify Stopped Cheque. - Standard functions  *
     C*
     C*  Call to Access Program - AOSTOPV0 Verify Stoppped Cheque
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOSTOPV0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM #1PTAM    UUCQAM 130       I:Cheque Amount
     C**********           PARM WUCQNB    UUCQNB  8        I:Cheque Number126299
     C                     PARM #1CQNB    UUCQNB  8        I:Cheque Number126299
     C                     PARM WURACN    UURACN 100       I:Retail Account No
     C                     PARM WUCUST    UUCUST  6        I:Customer Number
     C                     PARM WUCYCD    UUCYCD  3        I:Currency Code
     C**********           PARM WUACCD    UUACCD  4        I:Account Code                     CGL029
     C                     PARM WUACCD    UUACCD                                              CGL029
     C                     PARM WUACSN    UUACSN  2        I:Acount Sequence
     C                     PARM WUIBCA    UUBRCD  3        I:Branch Code
     C*
      * CASE: WRK.Access Pgm Return Code is Cheque's a stopped cheque
     C           WUAPRC    IFEQ '*STOP'                    *IF
      * CASE: PAR.Retail ind.: Override is Error(s) Overridden
     C           #1RINO    IFEQ 'Y'                        *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0088           Cheque number
      * Send message 'Stopped Cheque'
     C                     MOVEL'GLX0133' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9944  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * End of Fix LN0334
     C                     END                             *FI
     C                     END                             *FI
      * Check Retail indicator - Standard functions  *
     C*********************MOVEL#IRTIN    URRETI           Retail ind.    LN0315
     C                     MOVELWURETB    URRETI           Retail ind.    LN0315
     C*********************MOVEL#IAORC    URSTOP  7        A/O Rtn.Code   S01117
     C                     MOVELWUAPRC    URSTOP  7        A/P Rtn.Code   S01117
     C                     MOVEL#1DCIN    URIND   1                       E17600
     C                     MOVEL'NNNNNNNN'WURARC             CLEAR OVR    S01212
     C                     MOVE 'NN'      WURARC              FIELD       S01212
      *
     C*                                                                   CEU013
     C* If switchable function CEU013 is installed, the batch is an       CEU013
     C*   external interface, the account code type is Retail, the        CEU013
     C*   account currency is an 'In' currency, and the account           CEU013
     C*   does'nt exist, then the account file field values are not       CEU013
     C*   used for validation.                                            CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           *IN31     ANDEQ*ON                                       CEU013
     C           WWFLG     ANDEQ'Y'                                       CEU013
     C                     MOVE *BLANKS   URRETI           Retail Indicat CEU013
     C                     MOVE *BLANKS   #DIEST           Error status   CEU013
     C                     MOVE *BLANKS   #DIEMG           Error message  CEU013
     C                     ELSE                                           CEU013
     C                     EXSR URRETK                     Check Retail
     C                     ENDIF                                          CEU013
      *
     C/COPY WNCPYSRC,GL0123RC87
     C                     MOVELURERST    #DIEST           Error status
     C                     MOVELURERTX    #DIEMG           Error message
      *
      * 99. Extra Overrides - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123ROVR
     C                     MOVELWURARC    #1RARC           Retail Ac Refer
      * Start of case statement SAR017
      * CASE: PAR.Item error state is No errors in Item
     C           #DIEST    IFEQ *BLANK                     *IF
      * Setup message data for message
      * Retrieve message Lots of blanks
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0092' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           #DIEMG    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
     C                     END                             *FI
      * End of case statement SAR017
      * Check Overrides
      * CASE: PAR.Item error state is Errors in Item
     C           #DIEST    IFEQ 'E'                        *IF
     C                     MOVEL'Y'       #1RINE           Retail ind.: Er
     C                     MOVEL'N'       #1RINO           Retail ind.: Ov
      * Setup message data for message
     C                     MOVEL#DACID    ZA0089           Account Identif
     C                     MOVEL#1CYCD    ZA0090           Currency code
     C                     MOVEL#1ACCD    ZA0091           Account code
     C                     MOVEL#1ACSN    ZA0092           Account sequenc
      * Send message 'Can't O'ride Retail error'
     C                     MOVEL'GLX0085' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993132*
     C                     SETON                     3334  *
      *
     C                     ELSE
      * CASE: PAR.Item error state is Overridable Errors
     C           #DIEST    IFEQ 'O'                        *IF
     C                     MOVEL'Y'       #1RINE           Retail ind.: Er
      * CASE: PAR.Retail ind.: Override is Error(s) Overridden
     C           #1RINO    IFEQ 'Y'                        *IF
      * Start of Fix LN0320
     C                     ELSE
      * CASE: PAR.Retail ind.: Override is Error(s) not Overridden
     C           #1RINO    IFEQ 'N'                        *IF
     C                     ELSE
      * CASE: PAR.Retail ind.: Override is *Blank
     C           #1RINO    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1RINO    ZA0093           Retail ind.: Ov
      * Send message 'Retail Error Req's Overde'
     C                     MOVEL'GLX0141' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9949  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1RINO    ZA0094           Retail ind.: Ov
      * Send message 'Retail Override Invalid'
     C                     MOVEL'GLX0214' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9949  *
      *
      * End of Fix LN0320
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: PAR.Item error state is No errors in Item
     C           #DIEST    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       #1RINE           Retail ind.: Er
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UXEXIT    ENDSR
      /EJECT
     CSR         UYSUBR    BEGSR
      *================================================================
      * Check Value Date
      *================================================================
      *                                                                   176744
      ** Restore Value Date (display) if blanked out -                    176744
      ** default the Value Date to the Posting Date                       176744
      *                                                                   176744
     C           #DVDDS    IFEQ *BLANK                                    176744
     C                     Z-ADD#1PTDT    #1VLDT           Value date     176744
      *                                                                   176744
      ** Midas Conv. Day to Date - Standard functions                     176744
      *                                                                   176744
     C                     CALL 'ZDATE2'               90  Midas Conv. Day176744
     C                     PARM #1VLDT    WQ0088  50       Value date     176744
     C                     PARM WUDTFF    WQ0089  1        Date Format fla176744
     C           WUDTNF    PARM *ZERO     WQ0090  60       Date (numeric) 176744
     C           WUDDCD    PARM *BLANK    WQ0091  7        Date Julian    176744
     C           *IN90     IFEQ '1'                                       176744
     C                     MOVEL'Y2U0021' W0RTN   7                       176744
     C                     END                                            176744
      *                                                                   176744
      ** Copy Num to VDate Display - Standard functions                   176744
      *                                                                   176744
     C                     Z-ADDWUDTNF    UUDNMA                          176744
     C                     MOVE UUDNMA    #DVDDS                          176744
     C                     END                                            176744
      *                                                                   176744
      * CASE: PAR.Value date (display) is Date entered
     C           #DVDDS    IFNE *BLANK                     *IF
     C                     MOVEL#DVDDS    WUWVDD           Work Value Date
      * Check VDate Blank Entries - Standard functions  *
     C                     CALL 'GL0131U'              90  Check VDate Bla
     C           WUWVDD    PARM WUWVDD    WQ0041  6        Value date (dis
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Check Numeric - Standard functions  *
     C                     MOVE *IN20     UUIN20  1
     C                     MOVE *IN21     UUIN21  1
     C           *LIKE     DEFN WUWVDD    UUVLDT+ 1
     C                     MOVELWUWVDD    UUVLDT
     C                     MOVE '0'       UUVLDT
     C                     TESTN          UUVLDT       21
     C           *IN21     IFEQ '1'
     C                     MOVEL'0'       UUVLDT
     C                     END
     C                     TESTN          UUVLDT     20
     C           *IN20     IFEQ '0'
     C                     MOVE '*NUMERR' W0RTN
     C                     ELSE
     C                     MOVE *BLANKS   W0RTN
     C                     END
     C                     MOVE UUIN20    *IN20
     C                     MOVE UUIN21    *IN21
      * CASE: PGM.*Return code is *Numeric Error
     C           W0RTN     IFEQ '*NUMERR'                  *IF
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0095           Value date (dis
      * Send message 'Value Date not valid 1'
     C                     MOVEL'GLX0109' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * CASE: WRK.Date (numeric format) is Gt 30
     C           WUDTNF    IFGT 30                         *IF
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0042  7        *Return code
     C                     PARM WUDTNF    WQ0043  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0044  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0045  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0096           Value date (dis
      * Send message 'Value Date not valid 2'
     C                     MOVEL'GLX0110' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    #DVDDS           Value date (dis
     C/COPY WNCPYSRC,GL0123RK06
      * CASE: PAR.Value date GE WRK.Runday Number
     C           #1VLDT    IFGE WURDNO                     *IF
     C/COPY WNCPYSRC,GL0123RK07
      * START - E19779
      * Validation of Forward Date - REMOVED
      * END - E19779
      * CASE: PAR.Value date GT WRK.Forward Day Number
     C           #1VLDT    IFGT WUFDNB                     *IF
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0097           Value date (dis
      * Send message 'Value Date not valid 3'
     C                     MOVEL'GLX0111' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     END                             *FI
      *                                                                   179591
     C           #1VLDT    IFNE PVALD                                     179591
     C           WULCCY    ORNE PCCY                                      179591
      *                                                                   179591
     C**********           CALL 'AOBRCHR0'                                             179591 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    179591
     C                     PARM '*KEY'    UUAPOP  7        I:Option       179591
     C                     PARM #1IBCA    UUBRCD  3        I:Branch Code  179591
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                    179591 CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
      *                                                                   179591
      * Check Value Date NE Hol. - Standard functions  *
     C                     CALL 'GL0130U'              90  Check Value Dat
     C                     PARM #1VLDT    WQ0046  50       Value date
     C**********           PARM WULCCY    WQ0047  3        Local Currency 179591
     C**********           PARM WULCCD    WQ0048  3        Location Code  179591
     C                     PARM #1CYCD    WQ0047  3        Local Currency 179591
     C                     PARM A8LCCD    WQ0048  3        Location Code  179591
     C           WUJJST    PARM *BLANK    WQ0049  1        Error Ind - Day
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.Error Ind - Day - Holiday is Record Found
     C           WUJJST    IFEQ 'H'                        *IF
      * Setup message data for message
     C**********           MOVEL#DVDDS    ZA0098           Value date (di 179591
      * Send message 'Value Date Not Valid 9'
     C**********           MOVEL'GLX0117' ZAMSID                          179591
     C                     MOVEL#DVDDS    ZA0144                          179591
     C                     MOVE #1CYCD    ZA0145                          179591
     C                     MOVE A8LCCD    ZA0146                          179591
     C                     MOVEL'GLX0397' ZAMSID                          179591
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     END                             *FI
      *                                                                   179591
     C                     MOVE #1VLDT    PVALD                           179591
     C                     MOVE WULCCY    PCCY                            179591
     C                     ENDIF                                          179591
      *                                                                   179591
     C/COPY WNCPYSRC,GL0123RK08
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RK09
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    #DVDDS           Value date (dis
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C                     MOVELBJLCCY    WULCCY
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE #DVDDS    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVELP2BCDA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * Locate Local.CCY.Fwd.Days - Standard functions  *
     C                     CALL 'SZDATE3'              90  Locate Local.CC
     C                     PARM WURDNO    WQ0050  50       Runday Number
     C                     PARM WULCCY    WQ0051  3        Local Currency
     C                     PARM WULCCD    WQ0052  3        Location Code
     C                     PARM WUNBFD    WQ0053  20       Number of Forwa
     C           WUFDNB    PARM *ZERO     WQ0054  50       Forward Day Num
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0055  7        *Return code
     C                     PARM WUDTNF    WQ0056  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0057  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0058  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    #DVDDS
     C                     END                             *FI
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE #DVDDS    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0059  7        *Return code
     C                     PARM WUDTNF    WQ0060  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0061  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0062  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * Value Date A/c Validation - Standard functions  *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANK    P@RTCD  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option
     C                     PARM '*FIRST'  P@OPTN  7        I:Option
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C* Set Retail Key = Numeric Retail Account Number
     C                     MOVEL#1RACN    P@RETK 10
     C*
     C/COPY WNCPYSRC,GL0123RC33
     C                     CALL 'AOACCTR0'
     C                     PARM *BLANK    P@RTCD  7        B:Return code
     C                     PARM '*KEY'    P@OPTN  7        I:Option
     C*********************PARM #IRACN    P@RETK 10        I:Key field
     C                     PARM           P@RETK           I:Key field
     C                     PARM #1CUST    P@CNUM  6        I:Key field
     C                     PARM #1CYCD    P@CCY   3        I:Key field
     C**********           PARM #1ACCD    P@ACOD  4        I:Key field                        CGL029
     C                     PARM #1ACCD    P@ACOD                                              CGL029
     C                     PARM #1ACSN    P@ACSQ  2        I:Key field
     C                     PARM #1IBCA    P@IBCA  3        I:Key Field
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C/COPY WNCPYSRC,GL0123RC34
     C*
     C* EXTRACT BACK VALUEING PERIOD & CALCULATE BACK VALUE DATE
     C*
     C           WURDNO    SUB  BJBVPD    UUBRUN  50
     C*                                                                   CEU013
     C* If CEU013 switchable function is installed, the batch is from     CEU013
     C*   external interface, account currency is an 'In' currency,       CEU013
     C*   account code type is Retail and the account is not found,       CEU013
     C*   the tests on account dates are skipped.  Account not found      CEU013
     C*   is not an error and only a warning.                             CEU013
     C*                                                                   CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           WP0009    ANDEQ'V'                                       CEU013
     C           WUINCY    ANDEQ'Y'                                       CEU013
     C           A5ACTY    ANDEQ'R'                                       CEU013
     C           P@RTCD    ANDNE*BLANKS                                   CEU013
     C                     ELSE                                           CEU013
     C*                                                                   CEU013
     C*
     C* SAVE INDICATORS
     C*
     C                     MOVE *IN33     UUIN33  10
     C                     MOVE *IN64     UUIN64  10
     C                     MOVE *IN69     UUIN69  10
     C*
     C                     SETOF                     336469
     C*
     C** DR/CR INT.BEARING
     C*
     C***********AADRIF****IFEQ ' '                         IF 1          S01117
     C           DRIF      IFEQ ' '                         IF 1          S01117
     C***********AACRIF****ANDEQ' '                                       S01117
     C           CRIF      ANDEQ' '                                       S01117
     C***********AALDID****COMP AALCID               64                   S01117
     C           LDID      COMP LCID                 64                   S01117
     C***64******UUBRUN****COMP AALDID                 69                 S01117
     C   64      UUBRUN    COMP LDID                   69                 S01117
     C**N64******UUBRUN****COMP AALCID                 69                 S01117
     C  N64      UUBRUN    COMP LCID                   69                 S01117
     C*
     C   69      #1VLDT    COMP UUBRUN                 33
     C***64N69***#1VLDT****COMP AALDID                 3333               S01117
     C   64N69   #1VLDT    COMP LDID                   3333               S01117
     C**N64N69***#1VLDT****COMP AALCID                 3333               S01117
     C  N64N69   #1VLDT    COMP LCID                   3333               S01117
     C   33                MOVE '*DRCRER' W0RTN
     C                     ELSE                              ELSE 1
     C*
     C** CR INT BEARING ONLY
     C*
     C***********AADRIF****IFEQ ' '                          IF 2         S01117
     C           DRIF      IFEQ ' '                          IF 2         S01117
     C***********AALCID****COMP UUBRUN               64                   S01117
     C           LCID      COMP UUBRUN               64                   S01117
     C      64   #1VLDT    COMP UUBRUN                 33
     C*****N64***#1VLDT****COMP AALCID                 3333               S01117
     C     N64   #1VLDT    COMP LCID                   3333               S01117
     C   33                MOVE '*DTCRER' W0RTN
     C                     ELSE                              ELSE 2
     C*
     C** DR INT.BEARING ONLY
     C*
     C***********AACRIF****IFEQ ' '                          IF 3         S01117
     C           CRIF      IFEQ ' '                          IF 3         S01117
     C***********AALDID****COMP UUBRUN               64                   S01117
     C           LDID      COMP UUBRUN               64                   S01117
     C      64   #1VLDT    COMP UUBRUN                 33
     C*****N64***#1VLDT****COMP AALDID                 3333               S01117
     C     N64   #1VLDT    COMP LDID                   3333               S01117
     C   33                MOVE '*DTDRER' W0RTN
     C                     ELSE                              ELSE 3
     C*
     C**   NOT INT.BEARING
     C*
     C           #1VLDT    COMP UUBRUN                 33
     C   33                MOVE '*BVLDER' W0RTN
     C                     END                               END 3
     C                     END                               END 2
     C                     END                               END 1
     C*
     C**   CHECK AGAINST DATE THE ACCOUNT WAS OPENED
     C*
     C/COPY WNCPYSRC,GL0123RC05
     C           DACO      IFGT #1VLDT                       IF 1
     C                     MOVE '*DTOPER' W0RTN
     C                     END                               END 1
     C*
     C* RESTORE INDICATORS
     C*
     C                     MOVE UUIN33    *IN33
     C                     MOVE UUIN64    *IN64
     C                     MOVE UUIN69    *IN69
      * CASE: PGM.*Return code is Value Date Before Ac Open
     C           W0RTN     IFEQ '*DTOPER'                  *IF
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0099           Value date (dis
      * Send message 'Value Date not valid 4'
     C                     MOVEL'GLX0112' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef Back Value Date
     C           W0RTN     IFEQ '*BVLDER'                  *IF
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0100           Value date (dis
      * Send message 'Value Date not valid 5'
     C                     MOVEL'GLX0113' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0123RC06
      * CASE: PGM.*Return code is VDate Before Last CR Int
     C           W0RTN     IFEQ '*DTCRER'                  *IF
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0101           Value date (dis
      * Send message 'Value Date Not Valid 6'
     C                     MOVEL'GLX0114' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Before Last DR Int
     C           W0RTN     IFEQ '*DTDRER'                  *IF
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0102           Value date (dis
      * Send message 'Value Date Not Valid 7'
     C                     MOVEL'GLX0115' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef. Last CR/DR Int
     C           W0RTN     IFEQ '*DRCRER'                  *IF
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0103           Value date (dis
      * Send message 'Value Date Not Valid 8'
     C                     MOVEL'GLX0116' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     END                             *FI
     C                     ENDIF                                          CEU013
     C                     END                             *FI
     C                     ELSE                                           104847
     C                     MOVEL#DVDDS    ZA0096           Value date (dis104847
      * Send message 'Value Date not valid 2'                             104847
     C                     MOVEL'GLX0110' ZAMSID                          104847
     C                     EXSR ZASNMS                                    104847
     C                     SETON                     9943  *              104847
     C                     END                             *FI
      *                                                                   CGL010
      ** Validate forward value dates for non-retail accounts.            CGL010
      *                                                                   CGL010
     C           CGL010    IFEQ 'Y'                                       CGL010
     C           WUACTY    IFEQ 'N'                                       CGL010
     C           WAFVN     ANDEQ'Y'                                       CGL010
     C           WUACTY    OREQ 'D'                                       CGL010
     C           WAFVD     ANDEQ'Y'                                       CGL010
     C           WUACTY    OREQ 'C'                                       CGL010
     C           WAFVC     ANDEQ'Y'                                       CGL010
     C           WUACTY    OREQ 'G'                                       CGL010
     C           WAFVG     ANDEQ'Y'                                       CGL010
      *                                                                   CGL010
      ** Send error message if value date is later than maximum forward   CGL010
      ** date.                                                            CGL010
      *                                                                   CGL010
     C           WNDFV     ADD  WURDNO    WMFDN   50                      CGL010
      *                                                                   CGL010
     C           #1VLDT    IFGT WMFDN                                     CGL010
     C                     MOVEL#DVDDS    ZA0097                          CGL010
     C                     MOVEL'GLX0111' ZAMSID                          CGL010
     C                     EXSR ZASNMS                                    CGL010
     C                     MOVE *ON       *IN99                           CGL010
     C                     MOVE *ON       *IN43                           CGL010
     C                     ENDIF                                          CGL010
      *                                                                   CGL010
     C                     ENDIF                                          CGL010
     C                     ENDIF                                          CGL010
      *================================================================
     CSR         UYEXIT    ENDSR
      /EJECT
     CSR         UZSUBR    BEGSR
      *================================================================
      * Reset Retail Error Indicators
      *================================================================
     C                     MOVEL'N'       #1RINE           Retail ind.: Er
     C                     MOVEL*BLANK    #DIEST           Item error stat
      * Start of Fix LN0334
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
      * Setup message data for message
      * Retrieve message Lots of blanks
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0092' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           #DIEMG    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * End of Fix LN0334
      *================================================================
     CSR         UZEXIT    ENDSR
      /EJECT
     C/COPY WNCPYSRC,GL0123RC25
     CSR         VACKRL    BEGSR
      *================================================================
      * Check reference to Journal Entry Header
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Name search required?
     C                     MOVEL#1BTNB    WK1X01  1
     C           WK1X01    IFEQ '?'                        Batch number
     C                     CALL 'GL0140S'              90  *
     C                     PARM           W0RTN   7
     C           #1BTNB    PARM #1BTNB    WQ0018  3        Batch number
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     CABNE*BLANK    VAEXIT
     C                     END
      *................................................................
      * If all low order keys not entered, exit
     C           #1BTNB    IFEQ *BLANK                     Batch number
     C                     GOTO VAEXIT
     C                     END
      *
     C           KLVABR    KLIST
     C                     KFLD           BRBTNB           Batch number
      * Setup key
     C                     MOVEL#1BTNB    BRBTNB           Batch number
     C           KLVABR    CHAIN@BRREAH              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
      * Send message 'Journal Entry Header   NF'
     C                     MOVEL'GLX0172' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEL'GLX0172' W0RTN
      *================================================================
     CSR         VAEXIT    ENDSR
     CSR         XXIN      BEGSR                                          E17819
      *====================================================
      * Determine Account type
      *----------------------------------------------------
      *
     C                     MOVE *IN90     UKSI90  1        Save indicator
      *
      * 1. Check for invalid input :
      *
     C           UKACID    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*ERROR*' UKTYPE  7          Error
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 2. Check for Retail A/C :
      *
     C                     TESTN          UKACID     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF ALL NUMERIC
     C                     MOVE '*RETAIL' UKTYPE             Retail A/C
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * Due to alphanumeric customer change need to check nostro first                        CSD027
      **3.*Check for Customer number :                                                        CSD027
      **********                                                                              CSD027
     C**********           TESTN          UKACF6     90    All numeric?                       CSD027
      **********                                                                              CSD027
     C********** *IN90     IFEQ '1'                        IF ALL NUMERIC                     CSD027
     C********** UKACL4    IFEQ *BLANK                     IF 6 DIGITS ONLY                   CSD027
     C**********           MOVE '*NUMBER' UKTYPE             Cust.number                      CSD027
     C**********           ELSE                            EL INVALID                         CSD027
     C**********           MOVE '*ERROR*' UKTYPE  7          Error                            CSD027
     C**********           END                             FI                                 CSD027
     C**********           GOTO UKSK01                       Return                           CSD027
     C**********           END                             FI                                 CSD027
      **********                                                                              CSD027
      * 4. Check for Nostro :
      *
     C                     TESTN          UKACM2     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF NUMERIC
     C           UKACA1    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA1    ANDLT'0'                         AND ¬NUMERIC
     C           UKACA2    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA2    ANDLT'0'                         AND ¬NUMERIC
     C           UKACA3    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA3    ANDLT'0'                         AND ¬NUMERIC
     C           UKACL5    ANDEQ*BLANK                      AND NO MORE
     C                     MOVE '*NOSTRO' UKTYPE             Nostro
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 4a. Check for Customer number :                                                       CSD027
      * Really if the input is 6 long it might be a customer number                           CSD027
      * or a shortname. Without checking the database there is no way to                      CSD027
      * know. It shouldn;t matter in this program as all code for *NUMBER                     CSD027
      * and *SHNAME is common                                                                 CSD027
      *                                                                                       CSD027
      *                                                                                       CSD027
     C           ' '       SCAN UKACF6                   90Blank Found?                       CSD027
      *                                                                                       CSD027
     C           *IN90     IFEQ '0'                        IF no blanks                       CSD027
     C           UKACL4    ANDEQ*BLANKS                    IF 6 DIGITS ONLY                   CSD027
     C                     MOVE '*NUMBER' UKTYPE             Cust.number                      CSD027
     C                     GOTO UKSK01                       Return                           CSD027
     C                     END                                                                CSD027
      *                                                                                       CSD027
      * 5. Check for Customer Shortname :
      *
     C********** UKACF1    IFLT '0'                        IF ¬NUMERIC                        CSD027
     C********** UKACF1    ANDNE*BLANK                      AND ¬BLANK                        CSD027
     C           UKACF1    IFNE *BLANKS                    IF ¬BLANKS                         CSD027
     C                     MOVE '*SHNAME' UKTYPE             Shortname
     C                     ELSE                            EL NUMERIC
     C                     MOVE '*ERROR*' UKTYPE             Invalid
     C                     END                             FI
      *          _____________
     C           UKSK01    TAG
      *          ~~~~~~~~~~~~~
     C                     MOVE UKSI90    *IN90            Restore ind.
      *
      *----------------------------------------------------
      *
      *====================================================
     C*SR****     UKEXIT    ENDSR                                         E17819
     CSR         XXOUT     ENDSR                                          E17819
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      *                                                                   CEU013
     C           WWERR     IFEQ 'Y'                                       CEU013
     C                     MOVE 'Y'       WWFLG                           CEU013
     C                     ELSE                                           CEU013
     C                     MOVE 'Y'       WERRF                           CEU013
     C                     ENDIF                                          CEU013
      *                                                                   CEU013
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM 1         YYLGCT  50       # of grps
     C                     PARM W0GRP     YYLGVN 10        Label grps
      *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel and exit from key screen
      *================================================================
      * USER: Exit program processing
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123REPP - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123REPP
     C*00/Copy Member GL0123R   Exit Program Processing
     C                     END                             *FI
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
     C/COPY WNCPYSRC,GL0123RC56
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0123RCP1                                           S01408
     C*                                                                   S01408
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Obtain default message file
     C           *NAMVAR   DEFN MIMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Account Identifier Check
     C                     MOVEL*BLANK    WUACIC  1
      * Define work field Account ID Status Flag
     C                     MOVEL*BLANK    WUAISF  7
      * Define work field Access Pgm Return Code
     C                     MOVEL*BLANK    WUAPRC  7
      * Define work field Currency code
     C                     MOVEL*BLANK    WUCYCD  3
      * Define work field Currency Name
     C                     MOVEL*BLANK    WUCYNM 14
      * Define work field Number of Decimal Places
     C                     Z-ADD*ZERO     WUNBDP  10
      * Define work field Nostro Shortname
     C                     MOVEL*BLANK    WUNOSN 10
      * Define work field Account code
     C**********           MOVEL*BLANK    WUACCD  4                                           CGL029
     C                     MOVEL*BLANK    WUACCD 10                                           CGL029
      * Define work field Account type
     C                     MOVEL*BLANK    WUACTY  1
      * Define work field Account Code Name
     C                     MOVEL*BLANK    WUACCN 25
      * Define work field Account Section
     C                     MOVEL*BLANK    WUACSC  2
      * Define work field Account Sub-type
     C                     MOVEL*BLANK    WUACST  1
      * Define work field Branch code
     C                     MOVEL*BLANK    WUBRCD  3
      * Define work field Company Code
     C                     MOVEL*BLANK    WUCMCD  3
      * Define work field Location Code
     C                     MOVEL*BLANK    WULCCD  3
      * Define work field Due From Account Code
     C**********           MOVEL*BLANK    WUDFAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDFAC 10                                           CGL029
      * Define work field Due To Account Code
     C**********           MOVEL*BLANK    WUDTAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDTAC 10                                           CGL029
      * Define work field Branch Internal Customer
     C                     MOVEL*BLANK    WUBICN  6
      * Define work field Branch Name
     C                     MOVEL*BLANK    WUBRNM 30
      * Define work field Global Branch Code
     C                     MOVEL*BLANK    WUGBCD  3
      * Define work field Branch Shortname
     C                     MOVEL*BLANK    WUBRSN  3
      * Define work field JE Special Character
     C                     MOVEL*BLANK    WUJESP  1
      * Define work field Book Code
     C                     MOVEL*BLANK    WUBKCD  2
      * Define work field Book Description
     C                     MOVEL*BLANK    WUBKD  30
      * Define work field Hedge Indicator
     C                     MOVEL*BLANK    WUHGIN  1
      * Define work field Automatic Closure ind
     C                     MOVEL*BLANK    WUACIN  1
      * Define work field Book Consolidation Code
     C                     MOVEL*BLANK    WUBKCC  1
      * Define work field ST Amortise Discounts
     C                     MOVEL*BLANK    WUSTAM  1
      * Define work field ST Revalue Mark to Market
     C                     MOVEL*BLANK    WUSTRM  1
      * Define work field ST Exposure Percentage
     C                     Z-ADD*ZERO     WUSTEP  30
      * Define work field Include In Account Key
     C                     MOVEL*BLANK    WUIACK  1
      * Define work field GL Description Ind.
     C                     MOVEL*BLANK    WUGLDI  1
      * Define work field Display Account
     C                     MOVEL*BLANK    WUDSAC  1
      * Define work field Customer number
     C                     MOVEL*BLANK    WUCUST  6
      * Define work field Record ID                                                           237508
     C                     MOVEL*BLANK    WURECI  1                                           237508
      * Define work field Account sequence number
     C                     MOVEL*BLANK    WUACSN  2
      * Define work field Input Branch Code - Alpha
     C                     MOVEL*BLANK    WUIBCA  3
      * Define work field Account status
     C                     MOVEL*BLANK    WUACCS  1
      * Define work field Date account opened
     C                     Z-ADD*ZERO     WUDACO  50
      * Define work field Display Account Name
     C                     MOVEL*BLANK    WUDACN 20
      * Define work field Retail account number
     C                     Z-ADD*ZERO     WURACN 100
      * Define work field Retail Indicators   MIDAS
     C*********************MOVEL*BLANK    WURETB  1                       092723
     C                     BITOF'01234567'WURETB  1                       092723
      * Define work field Relative rec no of memos
     C                     Z-ADD*ZERO     WURRNM  50
      * Define work field Client key
     C                     MOVEL*BLANK    WUCNCD 10
      * Define work field Customer Report Name
     C                     MOVEL*BLANK    WUCRNM 20
      * Define work field Display Customer
     C                     MOVEL*BLANK    WUDCUS  1
      * Define work field Disp Screen Loop
     C                     Z-ADD*ZERO     WUDSLP  50
      * Define work field Copy:Display Cust Name
     C                     MOVEL*BLANK    WUCDCN 20
      * Define work field Copy:Display Account name
     C                     MOVEL*BLANK    WUCDAN 20
      * Define work field S01212
     C                     MOVEL*BLANK    WUFKST  1
      * Define work field Retail Ac Referral Cond.
     C                     MOVEL*BLANK    WURARC 10
      * Define work field Account subtype
     C                     MOVEL*BLANK    WUBPST  1
      * Define work field Account name
     C                     MOVEL*BLANK    WUACNM 20
      * Define work field Date Format flag
     C                     MOVEL*BLANK    WUDTFF  1
      * Define work field Date (numeric format)
     C                     Z-ADD*ZERO     WUDTNF  60
      * Define work field Midas Run Date
     C                     MOVEL*BLANK    WUDDCD  7
      * Define work field Branch Code (Batch Headr)
     C                     MOVEL*BLANK    WUBCBH  3
      * Define work field Abbreviated Posting?
     C                     MOVEL*BLANK    WUABPS  1
      * Define work field Account Identifier
     C                     MOVEL*BLANK    WUACID 10
      * Define work field Display no of items
     C                     MOVEL*BLANK    WUDNIT  1
      * Define work field ZALIGN Screen Fun Field
     C                     MOVEL*BLANK    WUZASF 16
      * Define work field ZALIGN File Field
     C                     MOVEL*BLANK    WUZAFF 16
      * Define work field Error Code
     C                     MOVEL*BLANK    WUERCD  1
      * Define work field Template Facility Used
     C                     MOVEL*BLANK    WUTFUS  1
      * Define work field Runday Number
     C                     Z-ADD*ZERO     WURDNO  50
      * Define work field Item error message
     C                     MOVEL*BLANK    WUIEMG 76
      * Define work field Local Currency code
     C                     MOVEL*BLANK    WULCCY  3
      * Define work field Last item number
     C                     Z-ADD*ZERO     WULINB  30
      * Define work field Copy Character Invalid
     C                     MOVEL*BLANK    WUCCIN  1
      * Define work field Copy:Retail Number Enter
     C                     MOVEL*BLANK    WUCRNE  1
      * Define work field Copy:Retail Account Num
     C                     Z-ADD*ZERO     WUCRAN 100
      * Define work field Copy:Customer Number
     C                     MOVEL*BLANK    WUCCUS  6
      * Define work field Copy:Currency code
     C                     MOVEL*BLANK    WUCCCD  3
      * Define work field Copy:Account code
     C**********           MOVEL*BLANK    WUCPAC  4                                           CGL029
     C                     MOVEL*BLANK    WUCPAC 10                                           CGL029
      * Define work field Copy:Account Sequence
     C                     MOVEL*BLANK    WUCACS  2
      * Define work field Copy:Branch Code - Alpha
     C                     MOVEL*BLANK    WUCBCA  3
      * Define work field Copy:Posting amount
     C                     Z-ADD*ZERO     WUCPAM 130
      * Define work field Copy:DR/CR Indicator
     C                     MOVEL*BLANK    WUCDCI  1
      * Define work field Copy:Narrative Code
     C                     MOVEL*BLANK    WUCNRC  2
      * Define work field Copy:Narrative Descriptn
     C                     MOVEL*BLANK    WUCNDS 30
      * Define work field Copy:Transaction Type
     C                     MOVEL*BLANK    WUCTRT  5
      * Define work field Copy:Cheque Number
     C                     MOVEL*BLANK    WUCCNB  8
      * Define work field Copy:Assoc Cust - Display
     C                     MOVEL*BLANK    WUASSC 10
      * Define work field Copy:Value Date Nbr
     C                     Z-ADD*ZERO     WUCVDN  50
      * Define work field Copy:Value Date
     C                     MOVEL*BLANK    WUCVDT  6
      * Define work field Copy:Swift Common Ref
     C                     MOVEL*BLANK    WUCSCR 16
      * Define work field Copy:Profit Centre
     C                     MOVEL*BLANK    WUCPRC  4
      * Define work field Copy:Transaction Sub-Type
     C                     MOVEL*BLANK    WUCTST 10
      * Define work field Copy:Book Code
     C                     MOVEL*BLANK    WUCBKC  2
      * Define work field Copy:Reverse/Void Ind.
     C                     MOVEL*BLANK    WUCRVI  1
      * Define work field Dept Code
     C                     MOVEL*BLANK    WUDPCD  3
      * Define work field Account Officer Code
     C                     MOVEL*BLANK    WUACOC  2
      * Define work field Nostro number (Item)
     C                     MOVEL*BLANK    WUNNBI  2
      * Define work field Ac Id Valid-Ret & Nost
     C                     MOVEL*BLANK    WUAIVL  1
      * Define work field ZALIGN No Of Decimals
     C                     Z-ADD*ZERO     WUZNDE  10
      * Define work field ZALIGN No Of Digits
     C                     Z-ADD*ZERO     WUZNDI  20
      * Define work field Narrative status
     C                     MOVEL*BLANK    WUNRST  7
      * Define work field Narrative code
     C                     MOVEL*BLANK    WUNVCD  2
      * Define work field Description of Narrative
     C                     MOVEL*BLANK    WUDON  30
      * Define work field Retail Transaction Type
     C                     MOVEL*BLANK    WURTTY  5
      * Define work field Retail Transaction Name
     C                     MOVEL*BLANK    WURTNM 30
      * Define work field Customer originated ind.
     C                     MOVEL*BLANK    WUCOIN  1
      * Define work field Debit/credit indicator
     C                     MOVEL*BLANK    WUDCIN  1
      * Define work field Reversal Indicator
     C                     MOVEL*BLANK    WURVIN  1
      * Define work field Print Advices Indicator
     C                     MOVEL*BLANK    WUPADI  1
      * Define work field Cheque number
     C                     MOVEL*BLANK    WUCQNB  8
      * Define work field ZSEDIT Char Output(21)
     C                     MOVEL*BLANK    WUZSCO 21
      * Define work field Work Value Date (display)
     C                     MOVEL*BLANK    WUWVDD  6
      * Define work field Forward Day Number
     C                     Z-ADD*ZERO     WUFDNB  50
      * Define work field Error Ind - Day - Holiday
     C                     MOVEL*BLANK    WUJJST  1
      * Define work field Number of Forward Days
     C                     Z-ADD*ZERO     WUNBFD  20
      * Define work field Client key identity
     C                     MOVEL*BLANK    WUCRST  7
      * Define work field Assoc. Customer number
     C                     MOVEL*BLANK    WUACNB  6
      * Define work field Customer Shortname
     C                     MOVEL*BLANK    WUCSSN 10
      * Define work field DRS Customer Shortname
     C                     MOVEL*BLANK    WUDRCS  7
      * Define work field Customer Swift Id
     C                     MOVEL*BLANK    WUCSID 12
      * Define work field Profit Centres Used
     C                     MOVEL*BLANK    WUPRCU  1
      * Define work field Profit centre
     C                     MOVEL*BLANK    WUPRCN  4
      * Define work field Profit Centre Description
     C                     MOVEL*BLANK    WUPCDS 30
      * Define work field Profit Centre Def'ts Used
     C                     MOVEL*BLANK    WUPCDU  1
      * Define work field SPF Error Condition
     C                     Z-ADD*ZERO     WUSPEC  10
      * Define work field Window processing requir.
     C                     MOVEL*BLANK    WUWDPR  1
      * Define work field Multibranching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Define work field Midas Rundate
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Setup Complete
     C                     MOVEL*BLANK    WUSUCP  1
      * Define work field Midas/Telex Module Ind.
     C                     MOVEL*BLANK    WUMTMI  1
      * Define work field SWIFT Funds Transfer
     C                     MOVEL*BLANK    WUSWFT  1
      * Define work field SWIFT Securities Trading
     C                     MOVEL*BLANK    WUSWST  1
      * Define work field SWIFT Customer Lending
     C                     MOVEL*BLANK    WUSWCL  1
      * Define work field SWIFT Syndicated Loans
     C                     MOVEL*BLANK    WUSWSL  1
      * Define work field SWIFT Statements
     C                     MOVEL*BLANK    WUSWSM  1
      * Define work field SWIFT Dealing
     C                     MOVEL*BLANK    WUSWDL  1
      * Define work field Standing data/Gen.Ledger
     C                     MOVEL*BLANK    WUSDGL  1
      * Define work field Dealing: FX
     C                     MOVEL*BLANK    WUDLFX  1
      * Define work field Syndicated Loans
     C                     MOVEL*BLANK    WUSYLN  1
      * Define work field Exposure Management
     C                     MOVEL*BLANK    WUEXMG  1
      * Define work field Financial Modeller
     C                     MOVEL*BLANK    WUFNMO  1
      * Define work field Statutary Returns
     C                     MOVEL*BLANK    WUSTRT  1
      * Define work field Customer Lending
     C                     MOVEL*BLANK    WUCSLN  1
      * Define work field Retail Banking
     C                     MOVEL*BLANK    WURTBN  1
      * Define work field Midas/Swift direct link
     C                     MOVEL*BLANK    WUMSDL  1
      * Define work field Securities
     C                     MOVEL*BLANK    WUSECS  1
      * Define work field Auto-reconciliations
     C                     MOVEL*BLANK    WUAURC  1
      * Define work field Bond Dealers Interface
     C                     MOVEL*BLANK    WUBDLI  1
      * Define work field DRS Standing Data
     C                     MOVEL*BLANK    WUDRSD  1
      * Define work field DRS Control module
     C                     MOVEL*BLANK    WUDRCM  1
      * Define work field DRS Foreign Exchange
     C                     MOVEL*BLANK    WUDRFE  1
      * Define work field DRS Money Market
     C                     MOVEL*BLANK    WUDRMM  1
      * Define work field DRS Arbitrage
     C                     MOVEL*BLANK    WUDRAR  1
      * Define work field Funds Transfer
     C                     MOVEL*BLANK    WUFDTR  1
      * Define work field DRS Common Applications
     C                     MOVEL*BLANK    WUDRCA  1
      * Define work field Futures & Options
     C                     MOVEL*BLANK    WUFUOP  1
      * Define work field Midas/Telex Synd. Loans
     C                     MOVEL*BLANK    WUMTSL  1
      * Define work field Midas/Telex Dealing
     C                     MOVEL*BLANK    WUMTDL  1
      * Define work field Midas/Telex Gen. Ledger
     C                     MOVEL*BLANK    WUMTGL  1
      * Define work field Midas/Telex Cust. Lending
     C                     MOVEL*BLANK    WUMTCL  1
      * Define work field Network Midas
     C                     MOVEL*BLANK    WUNWMI  1
      * Define work field FRA/IRS Indicator
     C                     MOVEL*BLANK    WUFIIN  1
      * Define work field Dealing: MM
     C                     MOVEL*BLANK    WUDLMM  1
      * Define work field Internal Contracts
     C                     MOVEL*BLANK    WUINCN  1
      * Define work field Treasury Management
     C                     MOVEL*BLANK    WUTRMG  1
      * Define work field Risk Management
     C                     MOVEL*BLANK    WURKMG  1
      * Define work field Testkey
     C                     MOVEL*BLANK    WUTSKY  1
      * Define work field Midas/Q
     C                     MOVEL*BLANK    WUMIDQ  1
      * Define work field Microfiche
     C                     MOVEL*BLANK    WUMFIC  1
      * Define work field Interest on accounts
     C                     MOVEL*BLANK    WUIOAC  1
      * Define work field SAR's processing required
     C                     MOVEL*BLANK    WUSARP  1
      * Define work field French  return indicator
     C                     MOVEL*BLANK    WUFRIN  1
      * Define work field Lux     return indicator
     C                     MOVEL*BLANK    WULRIN  1
      * Define work field Dutch   return indicator
     C                     MOVEL*BLANK    WUDRIN  1
      * Define work field German  return indicator
     C                     MOVEL*BLANK    WUGRIN  1
      * Define work field Belgian return indicator
     C                     MOVEL*BLANK    WUBRIN  1
      * Define work field Italian return indicator
     C                     MOVEL*BLANK    WUIRIN  1
      * Define work field Swift External Interface
     C                     MOVEL*BLANK    WUSWEI  1
      * Define work field Portfolio Management
     C                     MOVEL*BLANK    WUPFMG  1
      * Define work field Credit Management.
     C                     MOVEL*BLANK    WUCRMG  1
      * Define work field Head Office Reporting
     C                     MOVEL*BLANK    WUHORP  1
      * Define work field Average Balances
     C                     MOVEL*BLANK    WUAVBL  1
      * Define work field Margins
     C                     MOVEL*BLANK    WUMARG  1
      * Define work field Taxes
     C                     MOVEL*BLANK    WUNTST  1
      * Define work field Retail 3
     C                     MOVEL*BLANK    WUNXST  1
      * Define work field Interest on Accounts 3
     C                     MOVEL*BLANK    WUNYST  1
      * Define work field Transaction type
     C                     MOVEL*BLANK    WUTRTY  5
      * Define work field Spread Factor
     C                     Z-ADD*ZERO     WUSPFC  80
      * Define work field General Ledger
     C                     MOVEL*BLANK    WUGNLG 10
      * Define work field Profit & Loss Accnt Code
     C**********           MOVEL*BLANK    WUPLAC  4                                           CGL029
     C                     MOVEL*BLANK    WUPLAC 10                                           CGL029
      * Define work field Base Currency Transfer Fq
     C                     MOVEL*BLANK    WUBCTF  1
      * Define work field Accrual Key Summary Ind.
     C                     MOVEL*BLANK    WUAKSI  1
      * Define work field Accruals/Profit Date
     C                     Z-ADD*ZERO     WUAPDT  50
      * Define work field Accruals/Profit Frequency
     C                     MOVEL*BLANK    WUAPFQ  1
      * Define work field Accruals/Profit Fq. Day
     C                     Z-ADD*ZERO     WUAPFD  20
      * Define work field Accrue on Last Day Ind.
     C                     MOVEL*BLANK    WUALDI  1
      * Define work field A/c Posting Retention Pd
     C                     Z-ADD*ZERO     WUAPRP  20
      * Define work field Accrual Non-Wk Day Ind
     C                     MOVEL*BLANK    WUANWD  1
      * Define work field Spot Rates Retention Pd
     C                     Z-ADD*ZERO     WUSRRP  20
      * Define work field Base Rates Retention Pd
     C                     Z-ADD*ZERO     WUBRRP  20
      * Define work field Profit Centres Amendable
     C                     MOVEL*BLANK    WUPRCA  1
      * Define work field Prof C Def Matrix-Book
     C                     MOVEL*BLANK    WUPMBK  1
      * Define work field Prof C Def Matrix-T Type
     C                     MOVEL*BLANK    WUPMTT  1
      * Define work field Prof C Def Matrix-S Type
     C                     MOVEL*BLANK    WUPMST  1
      * Define work field Prof C Def Matrix-Branch
     C                     MOVEL*BLANK    WUPMBH  1
      * Define work field Prof C Def Matrix-Dept
     C                     MOVEL*BLANK    WUPMDT  1
      * Define work field Prof C Def Matrix-User
     C                     MOVEL*BLANK    WUPMUR  1
      * Define work field Prof C Def Matrix-A/c Off
     C                     MOVEL*BLANK    WUPMAO  1
      * Define work field Prof C Def Matrix-Cust
     C                     MOVEL*BLANK    WUPMCU  1
      * Define work field Originating Branch Used
     C                     MOVEL*BLANK    WUOBRU  1
      * Define work field Orig Branch User/Vald Req
     C                     MOVEL*BLANK    WUOBUV  1
      * Define work field JE Int-Bch Ents @ Bch/Itm
     C                     MOVEL*BLANK    WUIEBI  1
      * Define work field Main Branch
     C                     MOVEL*BLANK    WUMABR  3
      * Define work field Int-Bch Ent Via Main Brch
     C                     MOVEL*BLANK    WUIEMB  1
      * Define work field End of Last Activity Per.
     C                     Z-ADD*ZERO     WUELAP  50
      * Define work field End of Current Act Period
     C                     Z-ADD*ZERO     WUECAP  50
      * Define work field Screen Footer / Copy Char
     C                     MOVEL*BLANK    WUSFCC 78
      * Define work field Last Day Accrual Ind.
     C                     MOVEL*BLANK    WULDAI  1
      * Define work field Cleared Balance Accr. Ind
     C                     MOVEL*BLANK    WUCBAI  1
      * Define work field No. Days Forward Value
     C                     Z-ADD*ZERO     WUNDFV  30
      * Define work field Rate Change Print Ind.
     C                     MOVEL*BLANK    WURCPI  1
      * Define work field Retail A/C Nos. Required?
     C                     MOVEL*BLANK    WURANR  1
      * Define work field No. Days Before Inactive
     C                     Z-ADD*ZERO     WUNDBI  30
      * Define work field Branch name on Retail Adv
     C                     MOVEL*BLANK    WUBNRA  1
      * Define work field Charge for Mult Transacts
     C                     MOVEL*BLANK    WUCHMT  1
     C* Define work field 'In' Currency flag of Posting currency          CEU013
     C                     MOVE *BLANK    WUINCY  1        'In' Currency  CEU013
     C                     MOVE *BLANKS   WUCOCY  3        Copy:Origin ccyCEU013
     C                     MOVE *ZEROS    WUCOAM 150       Copy:Origin amtCEU013
     C                     MOVE *BLANKS   WZCOCY  3        Tmpl:Origin ccyCEU013
     C                     MOVE *BLANKS   WZCOAM 16        Tmpl:Origin amtCEU013
     C                     MOVE *BLANKS   WKSKIP  1        Skip warning   CEU013
     C                     MOVE *BLANKS   WWFLG   1        Warning flag   CEU013
     C                     MOVE *BLANKS   WERRF   1        Error found flgCEU013
     C                     MOVE *BLANKS   WWERR   1        Warning work flCEU013
     C                     MOVE *LOVAL    URNORM  1        ¦ Highlight 0
     C                     BITON'2'       URNORM           ¦ NORMAL
      *
     C                     MOVE *LOVAL    URRIHS  1        ¦ Highlight 1
     C                     BITON'27'      URRIHS           ¦ RI/STEADY
      *
     C                     MOVE *LOVAL    URRIHF  1        ¦ Highlight 2
     C                     BITON'2467'    URRIHF           ¦ RI/HI/BLINK
     C           *NAMVAR   DEFN           GLREOV           Override DTAARA
     C                     IN   GLREOV                     Obtain   DTAARA
      *
      * Set highlights for error message line :
      *
     C                     MOVE *LOVAL    URNORM  1        ¦ Highlight 0
     C                     BITON'2'       URNORM           ¦ NORMAL
      *
     C                     MOVE *LOVAL    URRIHS  1        ¦ Highlight 1
     C                     BITON'27'      URRIHS           ¦ RI/STEADY
      *
     C                     MOVE *LOVAL    URRIHF  1        ¦ Highlight 2
     C                     BITON'2467'    URRIHF           ¦ RI/HI/BLINK
      * Select initial mode
     C           @1NROP    IFEQ *ZERO
      * Add mode
     C                     MOVEL'ADD'     W0PMD   3
     C                     ELSE
      * Change mode
     C                     MOVEL'CHG'     W0PMD
     C                     END
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialise program
      * Standard RPG Creation Par - Standard functions  *
      * Last Amend Box GL0123R - Journal Entry Posting  *
      * Window Processing Hdr Box - Standard functions  *
      * Access Midas rundate - Standard functions  *
     C*   Access MIDAS Rundate from data-area RUNDAT
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT
     C                     MOVE RDNO      WURDNO
     C                     MOVE SUCP      WUSUCP
     C                     MOVE DTFF      WUDTFF
     C                     MOVE MBIN      WUMBIN
      * Copyright notice - Standard functions  *
      * Define 200 Byte Dummy DS - Standard functions  *
      * Define 800 Byte Dummy DS - Standard functions  *
      * Account Codes DS - Account Codes  *
      * Account Details DS - Standard functions  *
      * Declare Bank File DS - Standard functions  *
      * Branch Codes DS - Branch Codes  *
      * Client Details DS - Client Details  *
      * Currency Codes DS - Currency Codes  *
      * Book Codes DS - Book Codes  *
      * General Ledger Details DS - General Ledger Details  *
      * MIDAS Modules DS - MIDAS Modules  *
      * Narrative Codes DS - Narrative Codes  *
      * Retail Transactions DS - Retail Transaction Types  *
      * Prof C Def Matrix DS - Profit Centre Dft Matrix  *
      * Profit Centre DS - Profit Centres  *
      * START - E19779
      * Retail Details DS - Retail Details  *
      * END - E19779
      * Setup message data for message
      * Retrieve message Lots of blanks
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0092' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUIEMG    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
     C                     Z-ADD*ZERO     WULINB           Last item numbe
      * RTV Last Batch Item - Standard functions  *
     C                     CALL 'GL0137U'              90  RTV Last Batch
     C                     PARM P1BTNB    WQ0084  3        Batch number
     C           WULINB    PARM *ZERO     WQ0085  30       Last item numbe
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: PAR.Action Code is *Insert
     C           P6ACTC    IFEQ 'I'                        *IF
     C                     MOVEL'ADD'     W0PMD            *Program mode
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'CHG'     W0PMD            *Program mode
     C                     END                             *FI
     C                     MOVEL'Y'       WUFKST           S01212
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * Access MIDAS Modules. - MIDAS Modules  *
     C*
     C*  Access Midas Modules file for the file fields
     C*
     C                     CALL 'AOMMODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*FIRST'  UUAPOP  7        I:Option
     C           D@MMOD    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELBGMTMI    WUMTMI           Midas/Telex Module in
     C                     MOVELBGSWFT    WUSWFT           SWIFT Funds Transfer
     C                     MOVELBGSWST    WUSWST           SWIFT Securities Trad
     C                     MOVELBGSWCL    WUSWCL           SWIFT Customer Lend
     C                     MOVELBGSWSL    WUSWSL           SWIFT Syndicated Loan
     C                     MOVELBGSWSM    WUSWSM           SWIFT Statements
     C                     MOVELBGSWDL    WUSWDL           SWIFT Dealing
     C                     MOVELBGSDGL    WUSDGL           Standing Data/Gen Leg
     C                     MOVELBGDLFX    WUDLFX           Dealing : FX
     C                     MOVELBGSYLN    WUSYLN           Syndicated Loans
     C                     MOVELBGEXMG    WUEXMG           Exposure Management
     C                     MOVELBGFNMO    WUFNMO           Financial Modeller
     C                     MOVELBGSTRT    WUSTRT           Statuatory Returns
     C                     MOVELBGCSLN    WUCSLN           Customer Lending
     C                     MOVELBGRTBN    WURTBN           Retail Banking
     C                     MOVELBGMSDL    WUMSDL           Midas/SWIFT Direct lk
     C                     MOVELBGSECS    WUSECS           Securities
     C                     MOVELBGAURC    WUAURC           Auto-Reconcilliations
     C                     MOVELBGBDLI    WUBDLI           Bond Dealers Interfce
     C                     MOVELBGDRSD    WUDRSD           DRS Standing Data
     C                     MOVELBGDRCM    WUDRCM           DRS Control Module
     C                     MOVELBGDRFE    WUDRFE           DRS Foreign Exchange
     C                     MOVELBGDRMM    WUDRMM           DRS Money Markets
     C                     MOVELBGDRAR    WUDRAR           DRS Arbitrage
     C                     MOVELBGFDTR    WUFDTR           Funds Transfer
     C                     MOVELBGDRCA    WUDRCA           DRS Common Applic's
     C                     MOVELBGFUOP    WUFUOP           Futures & Options
     C                     MOVELBGMTSL    WUMTSL           Midas/Telex Syn Loans
     C                     MOVELBGMTDL    WUMTDL           Midas/Telex Dealing
     C                     MOVELBGMTGL    WUMTGL           Midas/Telex Gen Ledg
     C                     MOVELBGMTCL    WUMTCL           Midas/Telex Cust Len
     C                     MOVELBGNWMI    WUNWMI           Network Midas
     C                     MOVELBGFIIN    WUFIIN           FRA/IRS Indicator
     C                     MOVELBGDLMM    WUDLMM           Dealing:Money Markets
     C                     MOVELBGINCN    WUINCN           Internal Contracts
     C                     MOVELBGTRMG    WUTRMG           Treasury Management
     C                     MOVELBGRKMG    WURKMG           Risk Management
     C                     MOVELBGTSKY    WUTSKY           TestKey
     C                     MOVELBGMIDQ    WUMIDQ           Midas Q
     C                     MOVELBGMFIC    WUMFIC           Microfiche
     C                     MOVELBGIOAC    WUIOAC           Interest on Accounts
     C                     MOVELBGWDPR    WUWDPR           Window Processing Req
     C                     MOVELBGSARP    WUSARP           SAR's Processing Req
     C                     MOVELBGFRIN    WUFRIN           French Return Ind
     C                     MOVELBGLRIN    WULRIN           Lux Return Ind
     C                     MOVELBGDRIN    WUDRIN           Dutch Return Ind
     C                     MOVELBGGRIN    WUGRIN           German Return Ind
     C                     MOVELBGBRIN    WUBRIN           Belgian Return Ind
     C                     MOVELBGIRIN    WUIRIN           Italian Return Ind
     C                     MOVELBGSWEI    WUSWEI           SWIFT External Intfce
     C                     MOVELBGPFMG    WUPFMG           Portfolio Management
     C                     MOVELBGCRMG    WUCRMG           Credit Management
     C                     MOVELBGHORP    WUHORP           H.O. Reporting
     C                     MOVELBGAVBL    WUAVBL           Average Balances
     C                     MOVELBGMARG    WUMARG           Margins
     C                     MOVELBGNTST    WUNTST           Taxes          S01413
     C                     MOVELBGNXST    WUNXST           Retail 3       S01413
     C                     MOVELBGNYST    WUNYST           Int on A/C 3   S01413
     C*
      * Local Ret DS - GL0123R - Journal Entry Posting  *
     C                     END                             *FI
      * SAR017 Start
      * CASE: PAR.Batch Item To Copy is Greater than 0
     C           P4BITC    IFGT *ZERO                      *IF
      * Start of Fix LN0358
      * Retrieve Copy Record - Journal Entry Posting  *
     C                     EXSR SGRVGN
      * End of Fix LN0358
     C                     MOVELWUIBCA    WUCBCA           Copy:Branch Cod
     C                     MOVEL*BLANK    WUASSC           Copy:Assoc Cust
     C                     MOVELWUACNB    WUASSC           Copy:Assoc Cust
     C                     MOVELWUTRTY    WUCTRT           Copy:Transactio
     C                     ELSE
      * CASE: PAR.Batch Item To Template is Greater than 0
     C           P5BITT    IFGT *ZERO                      *IF
      * .. Record fields will be defaulted
     C                     ELSE
      * CASE: *OTHERWISE
      * RTV Last Batch Item COPY - Standard functions  *
     C*  SAVE INDICATORS
     C                     MOVEL*IN82     WUIN82  1
     C                     MOVEL*IN91     WUIN91  1
      *
      * S01234 - BATCH NUMBER IS NOW A CHARACTER FIELD. CHANGE THE
      *          FOLLOWING PROCESSING TO ALLOW FOR THIS.
      *
      * Setup key.
     C                     MOVE P1BTNB    BATNUM  30       Batch no.      S01234
     C                     Z-ADDBATNUM    W@BCHN  30                      S01234
     C           BATNUM    ADD  1         W@KEY1  30       Batch number   S01234
     C                     MOVE W@KEY1    BATCHA  3                       S01234
     C*                                                                   S01234
     C*********************Z-ADD#IJDNB    W@BCHN  30       Batch no.      S01234
     C***********#IJDNB    ADD  1         W@KEY1  30       Batch number   S01234
     C*                                                                   S01234
     C***********W@KEY1    SETLL@BTREAL              82    *82=EOF        S01234
     C           BATCHA    SETLL@BTREAL              82    *82=EOF        S01234
     C                     READP@BTREAL                9182*82=EOF
     C*
     C           *IN82     IFEQ '1'
     C           BATNUM    ORNE W@BCHN                     Batch number   S01234
     C********** #1JDNB    ORNE W@BCHN                     Batch number   S01234
      *==
      * Move BLANKS OR ZEROES TO Copy Fields..
      *==
     C                     MOVEL*BLANK    WUCCUS  6        COPY:Cust No
     C                     Z-ADD0         WUCPAM 130       COPY:Amount
     C*********************MOVEL*BLANK****WUCRAN 10        COPY:Ret A/c
     C                     Z-ADD0         WUCRAN 100       COPY:Ret A/c
     C                     MOVEL*BLANK    WUCNRC           COPY:Narr Code
     C                     MOVEL*BLANK    WUCNDS           COPY:Narr Desc
     C                     Z-ADD0         WUCVDN           COPY:Value Date
     C                     MOVEL*BLANK    WUCCCD           COPY:CCY Code
     C                     MOVEL*BLANK    WUCPAC           COPY:A/c Code
     C                     MOVEL*BLANK    WUCACS           COPY:A/c Seq
     C                     MOVEL*BLANK    WUCDCI           COPY:Dr/Cr Ind
     C                     MOVEL*BLANK    WUCTRT           COPY:Trans Typ
     C                     MOVEL*BLANK    WUCCNB           COPY:Cheque No
     C*********************MOVEL*BLANK    WUCACN           COPY:Assoc. Cust
     C                     MOVEL*BLANK    WUASSC           COPY:Assoc. Cust
     C                     MOVEL*BLANK    WUCSCR           COPY:Swift Ref
     C                     MOVEL*BLANK    WUCRNE  1        COPY:Ret A/c Ent
     C                     MOVE *BLANKS   WUCOCY  3        Copy:Origin ccyCEU013
     C                     MOVE *ZEROS    WUCOAM 150       Copy:Origin amtCEU013
      *
     C                     ELSE
      *==
      * Move @BTREAL ( GL Batch Posting ) fields to Copy: Fields..
      *==
     C           BATNUM    IFEQ W@BCHN                     Batch number   S01234
     C********** #IJDNB    IFEQ W@BCHN                     Batch number   S01234
     C                     MOVELBTCUST    WUCCUS           COPY:Cust No
     C                     Z-ADDBTPTAM    WUCPAM           COPY:Post Amount
     C*********************MOVELBTRACN    WUCRAN           COPY:Ret A/c
     C                     Z-ADDBTRACN    WUCRAN           COPY:Ret A/c
     C                     MOVELBTNVCD    WUCNRC           COPY:Narr Code
     C                     MOVELBTNRDC    WUCNDS           COPY:Narr Desc
     C                     Z-ADDBTVLDT    WUCVDN           COPY:Val Date NBR
     C                     MOVELBTCYCD    WUCCCD           COPY:CCY Code
     C                     MOVELBTACCD    WUCPAC           COPY:A/c Code
     C                     MOVELBTACSN    WUCACS           COPY:A/c Seq
     C                     MOVELBTDCIN    WUCDCI           COPY:Dr/Cr Ind
     C                     MOVELBTTRTY    WUCTRT           COPY:Trans Typ
     C                     MOVELBTCQNB    WUCCNB           COPY:Cheque No
     C*********************MOVELBTACNB    WUCACN           COPY:Assoc. Cust
     C                     MOVELBTACNB    WUASSC           COPY:Assoc. Cust
     C                     MOVELBTSWCR    WUCSCR           COPY:Swift Ref
     C                     MOVELBTRNBE    WUCRNE           COPY:Ret A/c Ent
     C                     MOVELBTOCCY    WUCOCY           Copy:Origin ccyCEU013
     C                     Z-ADDBTOAMT    WUCOAM           Copy:Origin amtCEU013
      *================================================================
      * Initialise record -
      *================================================================
     C                     MOVEL*BLANK    #DIEST           Item error stat
     C                     MOVEL*BLANK    #1RINE           Retail ind.: Er
     C                     Z-ADD*ZERO     #1PTDT           Posting date
     C                     MOVEL*BLANK    #1RADP           Retail advice p
     C                     MOVEL*BLANK    #1SHPI           Shadow post ind
     C                     Z-ADD*ZERO     #1RRNM           Relative rec no
     C                     MOVEL*BLANK    #1RNBE           Retail Number E
     C                     MOVEL*BLANK    #1RARC           Retail Ac Refer
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
     C                     MOVEL*BLANK    #DIEMG           Item error mess
     C                     END
     C                     END
     C* RESTORE INDICATORS
     C                     MOVELWUIN82    *IN82
     C                     MOVELWUIN91    *IN91
     C                     END                             *FI
     C                     END                             *FI
      * Access General Ledger. - General Ledger Details  *
     C*
     C*  Access General Ledger Details file for it' file fields
     C*
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*FIRST'  UUAPOP  7        I:Option
     C********** D@GELR    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@GELR    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELBKGNLG    WUGNLG           General Ledger
     C                     MOVELBKACCD    WUACCD           Account Code
     C                     MOVELBKPLAC    WUPLAC           Profit & Loss Account
     C                     MOVELBKCUST    WUCUST           Cutomer Number
     C                     MOVELBKBCTF    WUBCTF           Base Currency Tran
     C                     MOVELBKAKSI    WUAKSI           Accrual Key summary
     C                     MOVELBKAPDT    WUAPDT           Accruals Profit Date
     C                     MOVELBKAPFQ    WUAPFQ           Accruals Profit Freq
     C                     MOVELBKAPFD    WUAPFD           Accruals Profit Fr Dy
     C                     MOVELBKALDI    WUALDI           Accrue on Last Day
     C                     MOVELBKAPRP    WUAPRP           A/c Posting Ret Pd.
     C                     MOVELBKANWD    WUANWD           Accrual non-wk Day
     C                     MOVELBKSRRP    WUSRRP           Spot Rates Retention
     C                     MOVELBKBRRP    WUBRRP           Base Rates Retention
     C                     MOVELBKGLDI    WUGLDI           GL Description Ind
     C                     MOVELBKPRCU    WUPRCU           Profit Centres Used
     C                     MOVELBKPRCA    WUPRCA           Profit Centres Amend
     C                     MOVELBKPCDU    WUPCDU           Profit Centre Default
     C                     MOVELBKPMBK    WUPMBK           Prof C Matrix Book
     C                     MOVELBKPMTT    WUPMTT           Prof C Matrix Trans
     C                     MOVELBKPMST    WUPMST           Prof C Matrix SubType
     C                     MOVELBKPMBH    WUPMBH           Prof C Matrix Branch
     C                     MOVELBKPMDT    WUPMDT           Prof C Matrix Dept
     C                     MOVELBKPMUR    WUPMUR           Prof C Matrix User
     C                     MOVELBKPMAO    WUPMAO           Prof C Matrix Acc Off
     C                     MOVELBKPMCU    WUPMCU           Prof C Matrix Cust
     C                     MOVELBKOBRU    WUOBRU           Originating Branch Ud
     C                     MOVELBKOBUV    WUOBUV           Orig Branch/User Vald
     C                     MOVELBKJESP    WUJESP           Copy Special Char
     C                     MOVELBKELAP    WUELAP           End of Last Activity
     C                     MOVELBKECAP    WUECAP           End of Curnt Activity
      * Start of Fix LN0312
      * Setup message data for message
     C                     MOVELWUJESP    ZA0118           JE Special Char
      * Retrieve message Copy Special Char Add Mod
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0222' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUSFCC    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * End of Fix LN0312
      * START - E19779
      * Access Retail Details - Retail Details  *
     C*
     C*  Access Retail Details types for the file fields
     C** Only if RETAIL switched on.                                      084499
     C*
     C           BGRTBN    IFEQ 'Y'                                       084499
     C                     CALL 'AORETLR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*FIRST'  UUAPOP  7        I:Option
     C           D@RETL    PARM *BLANK    UUFDY            O:Format
     C                     END                                            084499
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVE BMACCD    WUACCD
     C                     MOVE BMLDAI    WULDAI
     C                     MOVE BMCBAI    WUCBAI
     C                     MOVE BMNDFV    WUNDFV
     C                     MOVE BMRCPI    WURCPI
     C                     MOVE BMRANR    WURANR
     C                     MOVE BMNDBI    WUNDBI
     C                     MOVE BMBNRA    WUBNRA
     C           WURDNO    ADD  WUNDFV    WUFDNB           Forward Day Num
      * END - E19779
      * Set Screen Ftr Copy Char - Standard functions  *
     C* Move Copy Special Character Message into screen footer field
     C*                                                                   S01117
     C                     MOVELWUSFCC    ##CTX1
     C*
      * CASE: PAR.Action Code is *Insert
     C           P6ACTC    IFEQ 'I'                        *IF
     C                     Z-ADD1         WUDSLP           Disp Screen Loo
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD2         WUDSLP           Disp Screen Loo
     C                     END                             *FI
      * SAR017 End
      * start S01413
     C                     MOVEL'N'       WUDNIT           Display no of i
      * CASE: WRK.Retail 3 is Yes
     C           WUNXST    IFEQ 'Y'                        *IF
      * Get Chrg for mult trans - Standard functions  *
     C                     CALL 'SD9343'               90  Get Chrg for mu
     C           W0RTN     PARM W0RTN     WQ0086  7        *Return code
     C           WUCHMT    PARM *BLANK    WQ0087  1        Charge for Mult
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: WRK.Charge for Mult Transacts is Yes
     C           WUCHMT    IFEQ 'Y'                        *IF
     C                     MOVEL'Y'       WUDNIT           Display no of i
     C                     END                             *FI
     C                     END                             *FI
      * end S01413
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0123RIPG - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0123RCPG
      *                                                                   CGL002
      ** Check if Block GL Accounts Enhancement feature is installed      CGL002
      *                                                                   CGL002
     C                     CALL 'AOSARDR0'                                CGL002
     C           WUAPRC    PARM WUAPRC    UUAPRC  7                       CGL002
     C                     PARM '*VERIFY' UUAPOP  7                       CGL002
     C                     PARM 'CGL002'  UUSARN  6                       CGL002
     C           D@SARD    PARM *BLANKS   UUFDY                           CGL002
      *                                                                   CGL002
     C           WUAPRC    IFEQ *BLANKS                                   CGL002
     C                     MOVE 'Y'       CGL002  1                       CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'N'       CGL002                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     END                             *FI
     C*                                                                   CEU013
     C**  Access SAR details file to see if CEU013 is installed.          CEU013
     C*                                                                   CEU013
     C                     CALL 'AOSARDR0'                                CEU013
     C                     PARM '       ' @RTCD   7                       CEU013
     C                     PARM '*VERIFY' @OPTN   7                       CEU013
     C                     PARM 'CEU013'  WSARD   6                       CEU013
     C*                                                                   CEU013
     C           @RTCD     IFEQ *BLANK                                    CEU013
     C                     MOVE 'Y'       CEU013  1                       CEU013
     C                     MOVE *OFF      *IN66            Display controlCEU013
     C                     ELSE                                           CEU013
     C                     MOVE 'N'       CEU013                          CEU013
     C                     MOVE *ON       *IN66                           CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      *                                                                   CGL008
     C           KCAUAC    KLIST                                          CGL008
     C**********           KFLD           WWACCD  40       Account Code                CGL008 CGL029
     C                     KFLD           WWACCD 100                                          CGL029
     C                     KFLD           WMUSRP           Reference USRP CGL008
      *                                                                   CGL008
      ** Access SAR details file to see if CGL008 SAR is installed.       CGL008
      *                                                                   CGL008
     C                     CALL 'AOSARDR0'                                CGL008
     C                     PARM *BLANKS   @RTCD   7                       CGL008
     C                     PARM '*VERIFY' @OPTN   7                       CGL008
     C                     PARM 'CGL008'  @SARD   6                       CGL008
      *                                                                   CGL008
     C           @RTCD     IFEQ *BLANK                                    CGL008
     C                     MOVE 'Y'       CGL008  1                       CGL008
     C                     OPEN SFACAUL0                                  CGL008
     C                     OPEN MUSER                                     CGL008
      *                                                                   CGL008
      ** Check the User details extension to retrieve the journal entry   CGL008
      ** authorisation                                                    CGL008
      *                                                                   CGL008
     C           ##USR     CHAINMUSER                22                   CGL008
     C           *IN22     IFEQ *OFF                                      CGL008
      *                                                                   CGL008
      ** Verify the content of the 'Access to all account codes' field    CGL008
      *                                                                   CGL008
     C                     MOVE ALACOD    WMACOD  1                       CGL008
     C                     MOVE REFUSR    WMUSRP 10                       CGL008
     C                     ENDIF                                          CGL008
     C                     ELSE                                           CGL008
     C                     MOVE 'N'       CGL008                          CGL008
     C                     ENDIF                                          CGL008
      *                                                                   CGL010
      ** Check if switchable feature CGL010 is switched on.               CGL010
      *                                                                   CGL010
     C                     MOVE 'N'       CGL010  1                       CGL010
      *                                                                   CGL010
     C                     CALL 'AOSARDR0'                                CGL010
     C                     PARM '       ' @RTCD                           CGL010
     C                     PARM '*VERIFY' @OPTN                           CGL010
     C                     PARM 'CGL010'  @SARD                           CGL010
      *                                                                   CGL010
     C           @RTCD     IFEQ *BLANK                                    CGL010
      *                                                                   CGL010
     C                     MOVE 'Y'       CGL010                          CGL010
      *                                                                   CGL010
      ** Set up program work fields.                                      CGL010
      *                                                                   CGL010
     C                     Z-ADDBKNDFV    WNDFV   30                      CGL010
     C                     MOVE BKAFVN    WAFVN   1                       CGL010
     C                     MOVE BKAFVD    WAFVD   1                       CGL010
     C                     MOVE BKAFVC    WAFVC   1                       CGL010
     C                     MOVE BKAFVG    WAFVG   1                       CGL010
     C                     ENDIF                                          CGL010
     C*                                                                   CEU013
      ** Access account info                                              CGL016
     C           KACCT     KLIST                                          CGL016
     C                     KFLD           W0CNUM  6                       CGL016
     C                     KFLD           W0CCY   3                       CGL016
     C**********           KFLD           W0ACOD  40                                   CGL016 CGL029
     C                     KFLD           W0ACOD 100                                          CGL029
     C                     KFLD           W0ACSQ  20                      CGL016
     C                     KFLD           W0BRCA  3                       CGL016
      *                                                                   CGL016
      ** Access SAR Details for Projected Movements Update Prior to Auth. CGL016
      *                                                                   CGL016
     C                     MOVEL'N'       CGL016  1                       CGL016
     C                     CALL 'AOSARDR0'                                CGL016
     C                     PARM *BLANKS   @RTCD                           CGL016
     C                     PARM '*VERIFY' @OPTN                           CGL016
     C                     PARM 'CGL016'  @SARD                           CGL016
     C           D@SARD    PARM D@SARD    UUSDY                           CGL016
      *                                                                   CGL016
     C           @RTCD     IFEQ *BLANK                                    CGL016
     C                     MOVEL'Y'       CGL016                          CGL016
     C                     ENDIF                                          CGL016
      *                                                                   CGL016
      ** Access SAR Details for Two O'Clock Feature                                        AR792734A
      *                                                                                    AR792734A
     C                     MOVEL'N'       CRE023  1                                        AR792734A
     C                     CALL 'AOSARDR0'                                                 AR792734A
     C                     PARM *BLANKS   @RTCD                                            AR792734A
     C                     PARM '*VERIFY' @OPTN                                            AR792734A
     C                     PARM 'CRE023'  @SARD                                            AR792734A
     C           D@SARD    PARM D@SARD    UUSDY                                            AR792734A
      *                                                                                    AR792734A
     C           @RTCD     IFEQ *BLANK                                                     AR792734A
     C                     MOVEL'Y'       CRE023                                           AR792734A
     C                     ENDIF                                                           AR792734A
      *                                                                                       CGL013
      ** Access SAR details file to see if CGL013 is installed.                               CGL013
      *                                                                                       CGL013
     C           *NAMVAR   DEFN           LDA                                                 CGL013
     C                     CALL 'AOSARDR0'                                                    CGL013
     C                     PARM *BLANKS   PRTCD   7                                           CGL013
     C                     PARM '*VERIFY' POPTN   7                                           CGL013
     C                     PARM 'CGL013'  PSARD   6                                           CGL013
     C           D@SARD    PARM D@SARD    UUFDY                                               CGL013
      *                                                                                       CGL013
     C           PRTCD     IFNE *BLANKS                                                       CGL013
     C           PRTCD     ANDNE'*NRF    '                                                    CGL013
     C           *LOCK     IN   LDA                                                           CGL013
     C                     MOVE 'SCSARDPD'DBFILE                                              CGL013
     C                     MOVEL'001'     DBASE                                               CGL013
     C                     MOVEL'CGL013'  DBKEY                                               CGL013
     C                     OUT  LDA                                                           CGL013
     C                     EXSR *PSSR                                                         CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           PRTCD     IFEQ *BLANK                                                        CGL013
     C/COPY WNCPYSRC,EML102_014                                                               EML102
     C                     MOVE 'Y'       CGL013  1                                           CGL013
     C                     MOVE *ON       *IN52                                               CGL013
     C                     MOVE *OFF      *IN53                                               CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE 'N'       CGL013                                              CGL013
     C                     MOVE *OFF      *IN52                                               CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                     BUG23742
     C                     CALL 'AOSARDR0'                                                  BUG23742
     C                     PARM *BLANKS   PRTCD   7                                         BUG23742
     C                     PARM '*VERIFY' POPTN   7                                         BUG23742
     C                     PARM 'CER030'  PSARD   6                                         BUG23742
      *                                                                                     BUG23742
     C           PRTCD     IFNE *BLANKS                                                     BUG23742
     C           PRTCD     ANDNE'*NRF    '                                                  BUG23742
     C           *LOCK     IN   LDA                                                         BUG23742
     C                     MOVE 'SCSARDPD'DBFILE                                            BUG23742
     C                     MOVEL'002'     DBASE                                             BUG23742
     C                     MOVEL'CER030'  DBKEY                                             BUG23742
     C                     OUT  LDA                                                         BUG23742
     C                     EXSR *PSSR                                                       BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                     BUG23742
     C           PRTCD     IFEQ *BLANK                                                      BUG23742
      *                                                                                     BUG23742
     C                     MOVE 'Y'       CER030  1                                         BUG23742
     C                     SETON                     55                                     BUG23742
      *                                                                                     BUG23742
     C                     ELSE                                                             BUG23742
      *                                                                                     BUG23742
     C                     MOVE 'N'       CER030                                            BUG23742
     C                     SETOF                     55                                     BUG23742
      *                                                                                     BUG23742
     C                     ENDIF                                                            BUG23742
      *                                                                                       CGL013
      ** Check if enhancement CRE008 is on.                                                   216088
      *                                                                                       216088
     C                     CALL 'AOSARDR0'                                                    216088
     C                     PARM *BLANKS   WRTCD   7                                           216088
     C                     PARM '*VERIFY' WOPTN   7                                           216088
     C                     PARM 'CRE008'  WSARD                                               216088
     C           D@SARD    PARM D@SARD    UUFDY                                               216088
      *                                                                                       216088
     C           WRTCD     IFEQ *BLANKS                                                       216088
     C                     MOVE 'Y'       CRE008  1                                           216088
     C                     ELSE                                                               216088
     C                     MOVE 'N'       CRE008                                              216088
     C                     ENDIF                                                              216088
      *                                                                                       216088
      ** Access SAR details file to determine if Account Access                               CGL037
      ** Security is switched on                                                              CGL037
      *                                                                                       CGL037
     C                     CALL 'AOSARDR0'                                                    CGL037
     C                     PARM *BLANKS   @RTCD   7                                           CGL037
     C                     PARM '*VERIFY' @OPTN   7                                           CGL037
     C                     PARM 'CGL037'  @SARD   6                                           CGL037
     C           D@SARD    PARM D@SARD    UUFDY                                               CGL037
      *                                                                                       CGL037
     C           @RTCD     IFNE *BLANKS                                                       CGL037
     C           @RTCD     ANDNE'*NRF   '                                                     CGL037
     C                     MOVEL'SCSARDPD'ERROR1 16                                           CGL037
     C                     MOVE 'CGL037'  ERROR1                                              CGL037
     C                     MOVELERROR1    ERROR  23                                           CGL037
     C                     MOVE '  ERROR' ERROR                                               CGL037
     C           ERROR     DSPLY                                                              CGL037
     C                     MOVE '1'       *INLR                                               CGL037
     C                     RETRN                                                              CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C           @RTCD     IFEQ *BLANK                                                        CGL037
     C                     MOVEL'Y'       CGL037  1                                           CGL037
     C                     ELSE                                                               CGL037
     C                     MOVEL'N'       CGL037                                              CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C/COPY WNCPYSRC,GL0123RC07
      *                                                                                       CGL148
      ** Check if CGL148 is installed                                                         CGL148
      *                                                                                       CGL148
     C                     CALL 'AOSARDR0'                                                    CGL148
     C                     PARM *BLANKS   @RTCD                                               CGL148
     C                     PARM '*VERIFY' @OPTN                                               CGL148
     C                     PARM 'CGL148'  @SARD                                               CGL148
     C           D@SARD    PARM D@SARD    UUFDY                                               CGL148
      *                                                                                       CGL148
     C           @RTCD     IFEQ *BLANKS                                                       CGL148
     C                     MOVE 'Y'       CGL148  1                                           CGL148
     C                     ELSE                                                               CGL148
     C                     MOVE 'N'       CGL148                                              CGL148
     C                     ENDIF                                                              CGL148
      *                                                                                       CGL148
      *                                                                                       CGL149
      ** Check if enhancement CGL149 is on                                                    CGL149
      *                                                                                       CGL149
     C                     CALL 'AOSARDR0'                                                    CGL149
     C                     PARM *BLANKS   PRTCD                                               CGL149
     C                     PARM '*VERIFY' POPTN                                               CGL149
     C                     PARM 'CGL149'  PSARD                                               CGL149
     C           D@SARD    PARM D@SARD    UUFDY                                               CGL149
      *                                                                                       CGL149
     C           PRTCD     IFEQ *BLANKS                                                       CGL149
     C                     MOVE 'Y'       CGL149  1                                           CGL149
     C                     ELSE                                                               CGL149
     C                     MOVE 'N'       CGL149                                              CGL149
     C                     ENDIF                                                              CGL149
      *                                                                                       CGL150
      ** Check if enhancement CGL150 is on                                                    CGL150
      *                                                                                       CGL150
     C                     CALL 'AOSARDR0'                                                    CGL150
     C                     PARM *BLANKS   PRTCD                                               CGL150
     C                     PARM '*VERIFY' POPTN                                               CGL150
     C                     PARM 'CGL150'  PSARD                                               CGL150
     C           D@SARD    PARM D@SARD    UUFDY                                               CGL150
      *                                                                                       CGL150
     C           PRTCD     IFEQ *BLANKS                                                       CGL150
     C                     MOVE 'Y'       CGL150  1                                           CGL150
     C                     ELSE                                                               CGL150
     C                     MOVE 'N'       CGL150                                              CGL150
     C                     ENDIF                                                              CGL150
      *                                                                                      LLN022A
      ** Check if Profit / Loss feature is installed                                         LLN022A
      *                                                                                      LLN022A
     C                     CALL 'AOSARDR0'                                                   LLN022A
     C           WUAPRC    PARM WUAPRC    UUAPRC  7                                          LLN022A
     C                     PARM '*VERIFY' UUAPOP  7                                          LLN022A
     C                     PARM 'LLN021'  UUSARN  6                                          LLN022A
     C           D@SARD    PARM *BLANKS   UUFDY                                              LLN022A
      *                                                                                      LLN022A
     C           WUAPRC    IFEQ *BLANKS                                                      LLN022A
     C                     MOVE 'Y'       LLN021  1                                          LLN022A
     C                     ELSE                                                              LLN022A
     C                     MOVE 'N'       LLN021                                             LLN022A
     C                     ENDIF                                                             LLN022A
      *                                                                                      LLN022A
      *================================================================
     CSR         ZZEXIT    ENDSR
     C*                                                                   CEU013
      /EJECT                                                              CEU013
     CSR         VALOAM    BEGSR                                          CEU013
      *================================================================   CEU013
      * Validate Original amount                                          CEU013
      *================================================================   CEU013
      * CASE: RCD.Formatted Original amount is Entered                    CEU013
     C           #DFMOA    IFNE *BLANK                     *IF            CEU013
      * Get Number of Decimal Places                                      CEU013
      * CASE: RCD. Original Currency code is Not Question Mark            CEU013
     C           #1OCCY    IFEQ '?'                        *IF            CEU013
     C*                                                                   CEU013
     C                     Z-ADD*ZERO     WKNBDP           Number of DecimCEU013
     C                     ENDIF                                          CEU013
      * Set up No of Decimals and no of digits for ZALIGN                 CEU013
      * CASE: WRK.Number of Decimal Places is Zero                        CEU013
     C                     SELEC                                          CEU013
     C           WKNBDP    WHEQ *ZERO                      *IF            CEU013
     C                     Z-ADD*ZERO     WUZNDE           ZALIGN No Of DeCEU013
     C                     Z-ADD15        WUZNDI           ZALIGN No Of DiCEU013
      * CASE: WRK.Number of Decimal Places is One                         CEU013
     C           WKNBDP    WHEQ 1                          *IF            CEU013
     C                     Z-ADD1         WUZNDE           ZALIGN No Of DeCEU013
     C                     Z-ADD14        WUZNDI           ZALIGN No Of DiCEU013
      * CASE: WRK.Number of Decimal Places is Two                         CEU013
     C           WKNBDP    WHEQ 2                          *IF            CEU013
     C                     Z-ADD2         WUZNDE           ZALIGN No Of DeCEU013
     C                     Z-ADD13        WUZNDI           ZALIGN No Of DiCEU013
      * CASE: WRK.Number of Decimal Places is Three                       CEU013
     C           WKNBDP    WHEQ 3                          *IF            CEU013
     C                     Z-ADD3         WUZNDE           ZALIGN No Of DeCEU013
     C                     Z-ADD12        WUZNDI           ZALIGN No Of DiCEU013
     C                     ENDSL                                          CEU013
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen FCEU013
     C                     MOVEL#DFMOA    WUZASF           ZALIGN Screen FCEU013
      *                                                                   CEU013
      *                                                                   CEU013
      * Call Zalign and Zedit                                             CEU013
      * ZALIGN Screen Field - Standard functions  *                       CEU013
     C                     CALL 'ZALIGN'               90  ZALIGN Screen FCEU013
     C           W0RTN     PARM W0RTN     WQ0027  7        *Return code   CEU013
     C           WUZASF    PARM WUZASF    WQ0028 16        ZALIGN Screen FCEU013
     C                     PARM WUZNDE    WQ0029  10       ZALIGN No Of DeCEU013
     C                     PARM WUZNDI    WQ0030  20       ZALIGN No Of DiCEU013
     C           WUZAFF    PARM *BLANK    WQ0031 16        ZALIGN File FieCEU013
      *                                                                   CEU013
      *                                                                   CEU013
      *                                                                   CEU013
     C           *IN90     IFEQ '1'                                       CEU013
      * Call to program ended in error                                    CEU013
     C                     MOVEL'Y2U0021' W0RTN   7                       CEU013
     C                     END                                            CEU013
      *                                                                   CEU013
      * Error detected?                                                   CEU013
     C           W0RTN     IFNE *BLANK                                    CEU013
     C                     SETON                     99    *              CEU013
     C                     END                                            CEU013
      * CASE: PGM.*Return code is *Normal                                 CEU013
     C           W0RTN     IFEQ *BLANK                     *IF            CEU013
     C                     MOVEL'0'       WUERCD           Error Code     CEU013
      *                                                                   CEU013
      *                                                                   CEU013
      * ZEDIT Screen Field - Standard functions  *                        CEU013
     C                     CALL 'ZEDIT'                90  ZEDIT Screen FiCEU013
     C           WUZASF    PARM WUZASF    WQ0032 16        ZALIGN Screen FCEU013
     C                     PARM WUZNDE    WQ0033  10       ZALIGN No Of DeCEU013
      *                                                                   CEU013
      *                                                                   CEU013
      *                                                                   CEU013
     C           *IN90     IFEQ '1'                                       CEU013
      * Call to program ended in error                                    CEU013
     C                     MOVEL'Y2U0021' W0RTN   7                       CEU013
     C                     END                                            CEU013
      *                                                                   CEU013
     C                     ELSE                                           CEU013
      * CASE: *OTHERWISE                                                  CEU013
     C                     MOVEL'1'       WUERCD           Error Code     CEU013
     C                     END                             *FI            CEU013
      * CASE: WRK.Error Code is Error Found                               CEU013
     C           WUERCD    IFEQ '1'                        *IF            CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#DFMOA    ZA0124           Formatted PostiCEU013
      * Send message 'Amount not valid'                                   CEU013
     C                     MOVEL'GLX0403' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9951  *              CEU013
      *                                                                   CEU013
     C                     ELSE                                           CEU013
      * CASE: *OTHERWISE                                                  CEU013
      * MOVE Posting Amount - Journal Entry Posting  *                    CEU013
     C*  MOVE ZALIGN FILE FIELD INTO POSTING AMOUNT                       CEU013
     C                     MOVE WUZAFF    #1OAMT                          CEU013
      * Move Fmt Posting Amount - Journal Entry Posting  *                CEU013
     C*  MOVE ZALIGN FUNCTION FIELD INTO FORMATTED POSTING AMOUNT         CEU013
     C                     MOVE WUZASF    #DFMOA                          CEU013
      * CASE: RCD.Posting amount is LE Zero                               CEU013
     C           #1OAMT    IFLE *ZERO                      *IF            CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#DFMOA    ZA0124           Formatted PostiCEU013
      * Send message 'Amount not valid'                                   CEU013
     C                     MOVEL'GLX0403' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9951  *              CEU013
      *                                                                   CEU013
     C                     END                             *FI            CEU013
     C                     END                             *FI            CEU013
     C                     ELSE                                           CEU013
      * CASE: *OTHERWISE                                                  CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#DFMOA    ZA0124           Formatted PostiCEU013
      * Send message 'Posting amount is req'd'                            CEU013
     C                     MOVEL'GLX0401' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9951  *              CEU013
     C                     END                             *FI            CEU013
      *                                                                   CEU013
     C* If the Original amount is changed, force the screen display       CEU013
     C*   even if the Warning message was displayed.                      CEU013
     C*                                                                   CEU013
     C           #1SVOA    IFNE #DFMOA                                    CEU013
     C                     MOVE *BLANKS   WKSKIP                          CEU013
     C                     MOVE *BLANKS   WWFLG                           CEU013
     C                     ENDIF                                          CEU013
     C                     MOVE #DFMOA    #1SVOA           Origin amt saveCEU013
      *================================================================   CEU013
     CSR                   ENDSR                                          CEU013
      /EJECT                                                              CEU013
     C           VALOCY    BEGSR                                          CEU013
      *================================================================   CEU013
      * Validate Original currency entry                                  CEU013
      *================================================================   CEU013
     C*                                                                   CEU013
     C* Validate original currency                                        CEU013
      * CASE: RCD. Original Currency code is Not blank                    CEU013
     C                     MOVE *BLANK    WKINCY  1        'In' Currency  CEU013
     C                     MOVE *ZERO     WKNBDP  10       No. Decimal PlcCEU013
     C           #1OCCY    IFNE *BLANK                                    CEU013
      * Access Currency. - Currency Codes  *                              CEU013
     C* CASE: RCD Original currency code is Select Requested              CEU013
     C           #1OCCY    IFEQ '?'                                       CEU013
     C                     MOVEL'Y'       W0DCF                           CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Number of decimal places and 'In' currency flag                  CEU013
     C*                                                                   CEU013
     C                     MOVEL#1OCCY    UUCYCD                          CEU013
     C                     CALL 'AOCURRR0'                                CEU013
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CEU013
     C                     PARM '*KEY'    UUAPOP  7        I:Option       CEU013
     C                     PARM           UUCYCD  3        I:Currency CodeCEU013
     C           D@CURR    PARM *BLANK    UUSDY            O:Format       CEU013
     C*                                                                   CEU013
      * CASE: WRK.Access Pgm Return Code is Access Error                  CEU013
     C           WUAPRC    IFNE *BLANKS                    *IF            CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0123           Original ccy   CEU013
      * Send message 'Original Currency Code not found'                   CEU013
     C                     MOVEL'GLX0400' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9950  *              CEU013
      *                                                                   CEU013
     C                     ELSE                                           CEU013
      * CASE: *OTHERWISE                                                  CEU013
     C* Assign work field to file field values.                           CEU013
     C*                                                                   CEU013
     C                     MOVE UUCYCD    #1OCCY                          CEU013
     C                     MOVELA6NBDP    WKNBDP  10       No. Decimal PlcCEU013
     C                     MOVELA6INCY    WKINCY  1        'In' Currency  CEU013
     C                     ENDIF                           *FI            CEU013
     C                     ENDIF                           *FI            CEU013
     C*                                                                   CEU013
     C*                                                                   CEU013
      *================================================================   CEU013
     C                     ENDSR                                          CEU013
      /EJECT                                                              CEU013
     C           VALORG    BEGSR                                          CEU013
      *================================================================   CEU013
      * Validate Original currency and amount combination                 CEU013
      *================================================================   CEU013
     C*                                                                   CEU013
     C* If the Original amount is blanked out, move zeros to screen       CEU013
     C*   saved field #1OAMT                                              CEU013
     C*                                                                   CEU013
     C           #DFMOA    IFEQ *BLANKS                                   CEU013
     C                     MOVE *ZEROS    #1OAMT                          CEU013
     C                     MOVE *ZEROS    #1SVOA                          CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C                     SELEC                                          CEU013
     C           WUINCY    WHNE 'Y'                                       CEU013
     C           #1CYCD    ANDNEBKEURO                                    CEU013
     C* Original currency is allowed only for 'EURO' or 'In' currency     CEU013
     C*   account.                                                        CEU013
     C*                                                                   CEU013
     C           #1OCCY    IFNE *BLANKS                                   CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0123           Original ccy   CEU013
      * Send message 'Original Currency Code not allowed'                 CEU013
     C                     MOVEL'GLX0408' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9950  *              CEU013
     C                     ENDIF                                          CEU013
     C* Original amount is allowed only for 'EURO' or 'In' currency       CEU013
     C*   account.                                                        CEU013
     C*                                                                   CEU013
     C           #DFMOA    IFNE *BLANKS                                   CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#DFMOA    ZA0124           Original amt   CEU013
      * Send message 'Original amount not allowed'                        CEU013
     C                     MOVEL'GLX0398' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9951  *              CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C* If the account currency is 'Euro' or 'In' currency, validate      CEU013
     C*  Original currency and the amount.                                CEU013
     C                     OTHER                                          CEU013
     C                     SELEC                                          CEU013
     C*                                                                   CEU013
      * CASE: RCD. Original Currency code is same as account currency     CEU013
     C* Original currency must not be same as account currency            CEU013
     C*                                                                   CEU013
     C           #1OCCY    WHEQ #1CYCD                                    CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0123           Original ccy   CEU013
      * Send message 'Original Currency Code is not valid'                CEU013
     C                     MOVEL'GLX0399' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9950  *              CEU013
     C*                                                                   CEU013
     C* Validate original currency                                        CEU013
      * CASE: RCD. Original Currency code is Not blank                    CEU013
     C           #1OCCY    WHNE *BLANK                                    CEU013
     C*                                                                   CEU013
     C                     SELEC                                          CEU013
     C           #1OCCY    WHNE BKEURO                                    CEU013
     C           WKINCY    ANDNE'Y'                                       CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#1OCCY    ZA0123           Original ccy   CEU013
      * Send message 'Original Currency must be either 'EURO' or          CEU013
     C*   'In' currency.                                                  CEU013
     C                     MOVEL'GLX0404' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9950  *              CEU013
     C*                                                                   CEU013
     C* CASE: Original currency is entered but not original amount        CEU013
     C*                                                                   CEU013
     C           #DFMOA    WHEQ *BLANKS                                   CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#DFMOA    ZA0124           Original amt   CEU013
      * Send message 'Original amount must be entered if Original         CEU013
     C*   currency is entered'                                            CEU013
     C                     MOVEL'GLX0401' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     995051*              CEU013
     C*                                                                   CEU013
     C* CASE: Original currency and Original amount are entered           CEU013
     C*                                                                   CEU013
     C                     OTHER                                          CEU013
     C                     EXSR VALOAM                                    CEU013
     C*                                                                   CEU013
     C                     SELEC                                          CEU013
     C           #1CYCD    WHEQ BKEURO                                    CEU013
     C           #1OCCY    OREQ BKEURO                                    CEU013
     C* If Posting currency or Original currency is Euro, call            CEU013
     C*   conversion program once.                                        CEU013
     C                     Z-ADD#1PTAM    W1FRAM 183       FROM Ccy AmountCEU013
     C                     MOVEL#1CYCD    W1FRCY  3        FROM Currency  CEU013
     C                     MOVEL#1OCCY    W1TOCY  3        TO Currency    CEU013
     C                     EXSR EUCNVT                                    CEU013
     C                     MOVE W1OUTA    W1OAMT 150                      CEU013
      *                                                                   CEU013
     C           W1OAMT    IFNE #1OAMT                                    CEU013
     C           #1OAMT    SUB  W1OAMT    W1DIFF 150                      CEU013
     C*                                                                   CEU013
     C           W1DIFF    IFGT 1                                         CEU013
     C           W1DIFF    ORLT -1                                        CEU013
     C*                                                                   CEU013
      * Setup message data for message                                    CEU013
      * Format amount (short) - Standard functions  *                     CEU013
     C                     Z-ADDW1OUTA    ULVALU           Value          CEU013
      *                                                                   CEU013
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>CEU013
     C                     PARM           ULVALU 150       I:Value        CEU013
     C                     PARM WKNBDP    ULDECP  10       I:Decimal placeCEU013
     C                     PARM '3'       ULEDIT  1        I:IBM Edit codeCEU013
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.CEU013
     C                     PARM           ULRSLF 23        O:Formatted    CEU013
      *                                                                   CEU013
     C                     MOVE ULRSLF    ZA0124           Formatted data CEU013
      * Send message 'The calculated original amount is W1OUTA'           CEU013
     C                     MOVEL'GLX0406' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     9951  *              CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C                     ENDIF                                          CEU013
     C                     OTHER                                          CEU013
     C* If Posting currency and Original currency are 'In' currencies,    CEU013
     C*   then conversion program is called twice.                        CEU013
     C* The first call converts the Posting amount to Euro currency.      CEU013
     C                     Z-ADD#1PTAM    W1FRAM 183       FROM Ccy AmountCEU013
     C                     MOVEL#1CYCD    W1FRCY  3        FROM Currency  CEU013
     C                     MOVELBKEURO    W1TOCY  3        TO Currency    CEU013
     C                     EXSR EUCNVT                                    CEU013
     C                     Z-ADDW1OUTA    W1FRAM 183       FROM Ccy AmountCEU013
     C                     MOVELBKEURO    W1FRCY  3        FROM Currency  CEU013
     C                     MOVEL#1OCCY    W1TOCY  3        TO Currency    CEU013
     C* The second call converts the Euro currency amount to 'In'         CEU013
     C*   currency Original amount.                                       CEU013
     C                     EXSR EUCNVT                                    CEU013
     C                     MOVE W1OUTA    W1OAMT 150                      CEU013
     C           W1OAMT    IFNE #1OAMT                                    CEU013
     C           #1OAMT    SUB  W1OAMT    W1DIFF 150                      CEU013
     C*                                                                   CEU013
     C           W1DIFF    IFGT 1                                         CEU013
     C           W1DIFF    ORLT -1                                        CEU013
      * Setup message data for message                                    CEU013
      * Format amount (short) - Standard functions  *                     CEU013
     C                     Z-ADDW1OUTA    ULVALU           Value          CEU013
      *                                                                   CEU013
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>CEU013
     C                     PARM           ULVALU 150       I:Value        CEU013
     C                     PARM WKNBDP    ULDECP  10       I:Decimal placeCEU013
     C                     PARM '3'       ULEDIT  1        I:IBM Edit codeCEU013
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.CEU013
     C                     PARM           ULRSLF 23        O:Formatted    CEU013
      *                                                                   CEU013
     C                     MOVE ULRSLF    ZA0124           Formatted data CEU013
      * Send message 'The calculated original amount is W1OUTA'           CEU013
     C                     MOVEL'GLX0406' ZAMSID                          CEU013
     C                     MOVE 'Y'       WWERR   1                       CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     MOVE *BLANK    WWERR                           CEU013
     C                     SETON                     9951  *              CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C                     ENDIF                                          CEU013
     C                     ENDSL                                          CEU013
     C                     ENDSL                                          CEU013
     C*                                                                   CEU013
     C* CASE: Original amount is entered but not original currency        CEU013
     C*                                                                   CEU013
     C           #DFMOA    WHNE *BLANKS                                   CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL#DFMOA    ZA0124           Original amt   CEU013
     C* Original amount is not allowed if the original currency is        CEU013
     C*   blank                                                           CEU013
     C                     MOVEL'GLX0402' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     9951  *              CEU013
     C                     ENDSL                                          CEU013
     C*                                                                   CEU013
     C                     ENDSL                                          CEU013
     C*                                                                   CEU013
     C* Save the orginal amount for later comparison                      CEU013
     C*                                                                   CEU013
     C*                                                                   CEU013
      *================================================================   CEU013
     C                     ENDSR                                          CEU013
      /EJECT                                                              CEU013
     C           EUCNVT    BEGSR                                          CEU013
      *================================================================   CEU013
      * Convert Euro to 'In' currency or vice versa                       CEU013
      *================================================================   CEU013
     C*                                                                   CEU013
     C                     Z-ADD0         W1OUTA 150       Outright AmountCEU013
     C                     Z-ADD0         W1INTA 183       Interim Amount CEU013
     C                     CALL 'EU0200'                                  CEU013
     C                     PARM *BLANKS   P@RTCD  7        Return Code    CEU013
     C                     PARM W1FRAM    P@FRAM 183       FROM Ccy AmountCEU013
     C                     PARM W1FRCY    P@FRCY  3        FROM Currency  CEU013
     C                     PARM W1TOCY    P@TOCY  3        TO Currency    CEU013
     C           W1OUTA    PARM W1OUTA    P@OUTA 150       Outright AmountCEU013
     C           W1INTA    PARM W1INTA    P@INTA 183       Interim Amount CEU013
     C                     PARM           P@EXRT 159       Exchange Rate  CEU013
     C                     PARM           P@MDIN  1        Mult/Div Ind   CEU013
     C           P@RTCD    IFEQ '*ERROR*'                                 CEU013
      * Setup message data for message                                    CEU013
     C                     MOVEL'EU0200  'ZA0125           Error in calledCEU013
      * Send message 'Error in called program'                            CEU013
     C                     MOVEL'GLX0405' ZAMSID                          CEU013
     C                     EXSR ZASNMS                                    CEU013
     C                     SETON                     995051*              CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
      *================================================================   CEU013
     C                     ENDSR                                          CEU013
      *                                                                                       CGL013
      *****************************************************************                       CGL013
      /EJECT                                                                                  CGL013
      *****************************************************************                       CGL013
      *                                                               *                       CGL013
      * *PSSR  - Program exception error routine                      *                       CGL013
      *          Called automatically if a program error occurs,      *                       CGL013
      *          or directly by the program code using EXSR.          *                       CGL013
      *          This subroutine DUMPs the program just once.         *                       CGL013
      *                                                               *                       CGL013
      * Called by: ZZINIT                                             *                       CGL013
      *                                                               *                       CGL013
      * Calls: None                                                   *                       CGL013
      *                                                               *                       CGL013
      *****************************************************************                       CGL013
      *                                                                                       CGL013
     C           *PSSR     BEGSR                                                              CGL013
      *                                                                                       CGL013
     C           @RUN      IFEQ *BLANK                                                        CGL013
     C                     MOVE 'Y'       @RUN    1                                           CGL013
     C                     DUMP                                                               CGL013
     C                     CALL 'DBERRCTL'                                                    CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     MOVE *ON       *INU7                                               CGL013
     C                     MOVE *ON       *INU8                                               CGL013
     C                     MOVE *ON       *INLR                                               CGL013
     C                     RETRN                                                              CGL013
      *                                                                                       CGL013
     C                     ENDSR                                                              CGL013
      *                                                                                       CGL013
      *****************************************************************                       CGL013
      /EJECT                                                                                  CGL013
      *****************************************************************                       CGL013
     O/COPY WNCPYSRC,GL0123ROPG
**
F3=Exit   F10=Delete
F3=Exit
** Item Error Message
Err:
----------------------------------------------------------------------------
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
** CPY@
(c) Finastra International Limited 2001
