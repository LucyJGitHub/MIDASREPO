     H            Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Display Journal Hist Post')                   *
     H/TITLE Midas GL Display Journal Hist Post
     Z* CRTRPGPGM
     Z* IGNDECERR(*YES)
      *
     H* SYNOPSIS :
     H* - Displays the records from DBF as a subfile
     H* - Loads the SFL from the DBF a page at a time
     H* - The DBF record at which the SFL display starts may be
     H*   controlled by positioning fields on the SFL header
     H* - Any key fields on the SFL header will be used as
     H*   positioning values
     H* - Any non-key fields on the SFL header will be used as
     H*   selection values: a maximum of W0SLM records will be
     H*   read from the DBF before giving up
      *
     H* Generated by  : SYNON/2  Version:  1080
     H* Function type : Display file
      *
     H*  Company :
     H* System        : General Ledger Synon Model
     H* User name     : LEMMONP
     H* Date          : 29/07/93  Time  : 18:20:48
      *  (c) Finastra International Limited 2001                      *
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     F********************************************************************
     F*  P R O G R A M     C R E A T I O N     P A R A M E T E R S    *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*****************************************************************
     F*                                                               *
     F*  Midas General Ledger   GL0125D
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. MD024552           Date 27Jan14               *
      *                 AR659451           Date 29Nov12               *
      *                 CER059             Date 19Jul10               *
      *                 BUG24339A          Date 21Jul09               *
      *                 BUG24339           Date 17Jun09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                  CEU013                DATE 03MAR98           *
     F*                  089856                DATE 25OCT95           *
     F*       AMEND NO : S01413                DATE 20JUL93           *
     F*       AMEND NO : S10736                DATE 09SEP92           *
     F*       AMEND NO : E38270                DATE 18JUN92           *
     F*       AMEND NO : E40888                DATE 18JUN92           *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
     F*  MD024552 - Historic batches are not displayed correctly if   *
     F*             they have extension narratives                    *
     F*             Added hooks: CGL135_034, CGL135_035, CGL135_036,  *
     F*                          CGL135_037, CGL135_038, CGL135_039,  *
     F*                          CGL135_095, CGL135_116, CGL135_117   *
      *  AR659451 - Search mechanism with scan limit is misleading to *
      *             users. Remove the scanning limitation and scan    *
      *             the database once from the first to last record   *
      *             before displaying the search result. Applied      *
      *             fix 258820. (Child: AR659452)                     *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG24339A - Extended Narrative fields are unavailable        *
      *  BUG24339 - Extended Narrative fields are unavailable         *
     F*  CEU013 - EMU Account Postings Narrative                      *
     F*  089856 - Change to allow posting amount as 13N as specified  *
     F*           in Ins Manual.                                      *
     F*  S01413 - RETAIL 3 INCORPORATION:- NUMBER OF ITEMS AVAILABLE. *
     F*           REDESIGN SCREEN TO MATCH JOURNAL ENTRY POST. MAINT. *
     F*  S10736 - ADD REVERSE/VOID INDICATOR                          *
     F*  E38270 - DO NOT DISPLAY BRANCH IF MBIN IS 'N'                *
     F*  E40888 - THE TEXT USED TO BE EBLANK FOR FIELDS WITH          *
     F*           NON-BLANK ENTRIES. (TRANS. TYPE, VALUE DATE,        *
     F*           CHEQUE NUMBER, ASSOC. CUST NO., OVERRIDE, BOOK CODE *
     F*           PROFIT CENTRE, SWIFT )                              *
     F*                                                               *
     F*****************************************************************
     F/COPY WNCPYSRC,GL0125DF01
     FGL0125D#CF  E                    WORKSTN
     F/COPY WNCPYSRC,GL0125DF02
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: Midas GL Display Journal Hist Post
      *
     F/COPY WNCPYSRC,GL0125DF03
     FGLJEHPL1IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RTV : Midas GL Journal History Posting   LF
      *
     FGLJEHHL1IF  E           K        DISK
      * RTV : Midas GL Journal History Header    LF
      *
     FGLJENXL1IF  E           K        DISK                                                 BUG24339
      * RTV : Midas GL Journal Additional Info   LF                                         BUG24339
      *                                                                                     BUG24339
     FGLMNARL1IF  E           K        DISK                                                 BUG24339
      * RTV : Midas GL Journal MultiCash Narratives LF                                      BUG24339
      *                                                                                     BUG24339
     FGLJEHXL2IF  E           K        DISK                                                BUG24339A
      * RTV : Midas GL Journal Additional Info History LF                                  BUG24339A
      *                                                                                    BUG24339A
     F/COPY OFCPYSRCZ,CGL135_034                                                            MD024552
     E                    EMSG    1   2 80               ERROR MESSAGE                      BUG24339
      *                                                                                     BUG24339
     E                    CPY@    1   1 80               Copyright     array
      * Parameters for pass to GL000185 and GL00186                                         BUG24339
     E                    FLDNMA     75 10                                                  BUG24339
     E                    MSGIDA     75  7                                                  BUG24339
     E                    MSGDTA     75 45                                                  BUG24339
      *                                                                                     BUG24339
     I*   Define MIDAS Rundate from data-area RUNDAT
     I*
     I*
     I*
     I*
     I*
      /EJECT
      * Data structures:
     ILDA       E DSLDA                         256                       CEU013
      *                                                                   CEU013
      ** Local data area for database error details                       CEU013
      ** *LOCK IN LDA immediately before and OUT LDA immediately          CEU013
      ** after each database error handling.                              CEU013
      **                                                                  CEU013
      **                                    134 141 DBFILE                CEU013
      **       Defines:                     142 170 DBKEY                 CEU013
      **                                    171 180 DBPGM                 CEU013
      **                                    181 1830DBASE                 CEU013
      *                                                                   CEU013
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
      *                                                                                     BUG24339
     ISCSARD    E DSSCSARDPD                                                                BUG24339
      ** Parameter Passed to GL000185                                                       BUG24339
     I                                        1 119 PDETLS                                  BUG24339
     I                                        1   3 #1BTNB                                  BUG24339
     I                                        4   60#1BINB                                  BUG24339
     I                                        7   9 #1BCBH                                  BUG24339
     I                                       10  15 #1CUST                                  BUG24339
     I                                       16  18 #1CYCD                                  BUG24339
     I                                       19  22 #1ACQQ                                  BUG24339
     I                                       23  24 #1ACSN                                  BUG24339
     I                                       25  340#1RACN                                  BUG24339
     I                                       35  48 #RFMPA                                  BUG24339
     I                                       49  49 #1DCIN                                  BUG24339
     I                                       50  79 #RNRTV                                  BUG24339
     I                                       80  85 #RVDDS                                  BUG24339
     I                                       86  90 #1TRTY                                  BUG24339
     I                                       91 100 #1TSTY                                  BUG24339
     I                                      101 108 #1CQNB                                  BUG24339
     I                                      109 118 #1ACCD                                  BUG24339
     I                                      119 119 PEDIT                                   BUG24339
      *                                                                                     BUG24339
      **  Valid JE Item (DS) for passing to GL000185                                        BUG24339
     IPVBIPX    E DSGLVBIPXPD                                                               BUG24339
     I              B3PTDT                          BAPTDT                                  BUG24339
     I              B3BTNB                          BABTNB                                  BUG24339
     I              B3BINB                          BABINB                                  BUG24339
     I              B3ADI1                          BAADI1                                  BUG24339
     I              B3ADI2                          BAADI2                                  BUG24339
     I              B3ADI3                          BAADI3                                  BUG24339
     I              B3ADI4                          BAADI4                                  BUG24339
     I              B3ADI5                          BAADI5                                  BUG24339
     I              B3ADI6                          BAADI6                                  BUG24339
     I              B3AERI                          BAAERI                                  BUG24339
      *                                                                                     BUG24339
      * ABO DEFINE LARGE STRING FOR CL CMD
     IYARTCM      DS                            512
     I                                        1   1 DUMMY1
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I            DS
     I                                        1   60UUDNMA
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNO
     I                                       11  11 SUCP
     I                                       12  12 DTFF
     I                                       13  13 MBIN
     I/COPY WNCPYSRC,GL0125DI01
     I*
     IUUSDY     E DSDSSDY
     I*
     I* 800 Byte Data Structure for Incoming Data from Access Program
     I*
     ID@CURR    E DSSDCURRPD
     I*
     I*  Currency Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     IUUFDY     E DSDSFDY
     I*
     I* 200 Byte Data Structure for Incoming Data from Access Program
     I*
     ID@MMOD    E DSSDMMODPD
     I*
     I*  Midas Modules DS for assigning data from Access
     I*  Programs to work fields
     I*
      /EJECT
      * Parameter declarations
     IP1PARM      DS                              8
      * KEY: Midas GL Journal History Posting   LF
      * I : RST Batch Entry Date
     I                                    P   1   30P1BEDT
      * I : RST Batch number
     I                                        4   6 P1BTNB
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Lots of Dots'
     I/COPY OFCPYSRCZ,CGL135_035                                                            MD024552
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           KEY: Journal Hi
      *****************************************************************
      * Initialise
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise & load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   05                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END                             OD W0RSF
     C                     END                             OD *HIVAL
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise and load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * Position DBF file
     C           KPOS      KLIST
     C                     KFLD           HPBEDT           Batch Entry Dat
     C                     KFLD           HPBTNB           Batch number
     C                     KFLD           HPBINB           Batch item no.
      * Setup key
     C                     Z-ADD#2BEDT    HPBEDT           Batch Entry Dat
     C                     MOVEL#2BTNB    HPBTNB           Batch number
     C                     Z-ADD#2BINB    HPBINB           Batch item no.
     C           KPOS      SETLL@BFREDE
     C           KRST      KLIST
     C                     KFLD           HPBEDT           Batch Entry Dat
     C                     KFLD           HPBTNB           Batch number
      * Setup key
     C                     Z-ADD#2BEDT    HPBEDT           Batch Entry Dat
     C                     MOVEL#2BTNB    HPBTNB           Batch number
     C           KRST      READE@BFREDE                8782*82=EOF
      * Save previous selector values
     C           *LIKE     DEFN #2BINB    WZBINB
     C                     MOVEL#2BINB    WZBINB           Batch item no.
     C           *LIKE     DEFN #2IBCA    WZIBCA
     C                     MOVEL#2IBCA    WZIBCA           Input Branch Co
     C           *LIKE     DEFN #2CUST    WZCUST
     C                     MOVEL#2CUST    WZCUST           Customer number
     C           *LIKE     DEFN #2CYCD    WZCYCD
     C                     MOVEL#2CYCD    WZCYCD           Currency code
     C           *LIKE     DEFN #2ACCD    WZACCD
     C                     MOVEL#2ACCD    WZACCD           Account code
     C           *LIKE     DEFN #2ACSN    WZACSN
     C                     MOVEL#2ACSN    WZACSN           Account sequenc
     C           *LIKE     DEFN #2NNBI    WZNNBI
     C                     MOVEL#2NNBI    WZNNBI           Nostro number (
     C           *LIKE     DEFN #2RACN    WZRACN
     C                     MOVEL#2RACN    WZRACN           Retail account
     C           *LIKE     DEFN #2RINO    WZRINO
     C                     MOVEL#2RINO    WZRINO           Retail ind.: Ov
     C           *LIKE     DEFN #2RINE    WZRINE
     C                     MOVEL#2RINE    WZRINE           Retail ind.: Er
     C           *LIKE     DEFN #2TRTY    WZTRTY
     C                     MOVEL#2TRTY    WZTRTY           Transaction typ
     C           *LIKE     DEFN #2PTAM    WZPTAM
     C                     MOVEL#2PTAM    WZPTAM           Posting amount
     C           *LIKE     DEFN #2DCIN    WZDCIN
     C                     MOVEL#2DCIN    WZDCIN           Debit/credit in
     C           *LIKE     DEFN #2PTDT    WZPTDT
     C                     MOVEL#2PTDT    WZPTDT           Posting date
     C           *LIKE     DEFN #2VLDT    WZVLDT
     C                     MOVEL#2VLDT    WZVLDT           Value date
     C           *LIKE     DEFN #2NVCD    WZNVCD
     C                     MOVEL#2NVCD    WZNVCD           Narrative code
     C           *LIKE     DEFN #2NRDC    WZNRDC
     C                     MOVEL#2NRDC    WZNRDC           Narrative descr
     C           *LIKE     DEFN #2ACTY    WZACTY
     C                     MOVEL#2ACTY    WZACTY           Account type
     C           *LIKE     DEFN #2ACNB    WZACNB
     C                     MOVEL#2ACNB    WZACNB           Assoc. Customer
     C           *LIKE     DEFN #2CQNB    WZCQNB
     C                     MOVEL#2CQNB    WZCQNB           Cheque number
     C           *LIKE     DEFN #2COIN    WZCOIN
     C                     MOVEL#2COIN    WZCOIN           Customer origin
     C           *LIKE     DEFN #2SWCR    WZSWCR
     C                     MOVEL#2SWCR    WZSWCR           Swift common re
     C           *LIKE     DEFN #2PRCN    WZPRCN
     C                     MOVEL#2PRCN    WZPRCN           Profit centre
     C           *LIKE     DEFN #2BCBH    WZBCBH
     C                     MOVEL#2BCBH    WZBCBH           Branch Code (Ba
     C           *LIKE     DEFN #2RADP    WZRADP
     C                     MOVEL#2RADP    WZRADP           Retail advice p
     C           *LIKE     DEFN #2SHPI    WZSHPI
     C                     MOVEL#2SHPI    WZSHPI           Shadow post ind
     C           *LIKE     DEFN #2RRNM    WZRRNM
     C                     MOVEL#2RRNM    WZRRNM           Relative rec no
     C           *LIKE     DEFN #2RNBE    WZRNBE
     C                     MOVEL#2RNBE    WZRNBE           Retail Number E
     C           *LIKE     DEFN #2RARC    WZRARC
     C                     MOVEL#2RARC    WZRARC           Retail Ac Refer
     C           *LIKE     DEFN #2TSTY    WZTSTY
     C                     MOVEL#2TSTY    WZTSTY           Transaction (Su
     C           *LIKE     DEFN #2BKCD    WZBKCD
     C                     MOVEL#2BKCD    WZBKCD           Book Code
     C           *LIKE     DEFN #2SPFC    WZSPFC
     C                     MOVEL#2SPFC    WZSPFC           Spread Factor
     C           *LIKE     DEFN #2RVDI    WZRVDI
     C                     MOVEL#2RVDI    WZRVDI           Reverse/Void In
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           *LIKE     DEFN #2OCCY    WZOCCY                          CEU013
     C                     MOVEL#2OCCY    WZOCCY           Original Ccy   CEU013
     C           *LIKE     DEFN #2OAMT    WZOAMT                          CEU013
     C                     MOVEL#2OAMT    WZOAMT           Original AmountCEU013
     C                     ENDIF                                          CEU013
      * Load subfile page
     C                     Z-ADD0         ##RROK  50
     C                     EXSR BBLDSF
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page
      *================================================================
      * Re-establish fields in read-ahead record
     C   27                DO
     C  N82                READP@BFREDE                  90*
     C  N82                READ @BFREDE                  90*
     C                     END
      *
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
      **Reset*count*of*DBF*records*read********************************                     AR659451
     C**********           Z-ADD0         ##RRRD  50                                        AR659451
      *................................................................
      **Load*next*SFL*page*until*SFL*page*full,*or*********************                     AR659451
      **Scan*limit*reached*********************************************                     AR659451
      ** Load next SFL page until SFL page full                                             AR659451
      *                                                                                     AR659451
     C           *IN82     DOWEQ'0'                        DO
     C           ##RROK    ANDLT##SFPG
     C********** ##RRRD    ANDLTW0SLM                                                       AR659451
      * Check selection fields - if fail, read next record
     C           #2IBCA    IFNE *BLANK                     Input Branch Co
     C           HPIBCA    CABNE#2IBCA    BB020            Input Branch Co
     C                     END
     C           #2CUST    IFNE *BLANK                     Customer number
     C           HPCUST    CABNE#2CUST    BB020            Customer number
     C                     END
     C           #2CYCD    IFNE *BLANK                     Currency code
     C           HPCYCD    CABNE#2CYCD    BB020            Currency code
     C                     END
     C           #2ACCD    IFNE *BLANK                     Account code
     C           HPACCD    CABNE#2ACCD    BB020            Account code
     C                     END
     C           #2ACSN    IFNE *BLANK                     Account sequenc
     C           HPACSN    CABNE#2ACSN    BB020            Account sequenc
     C                     END
     C           #2NNBI    IFNE *BLANK                     Nostro number (
     C           HPNNBI    CABNE#2NNBI    BB020            Nostro number (
     C                     END
     C           #2RACN    IFNE *ZERO                      Retail account
     C           HPRACN    CABNE#2RACN    BB020            Retail account
     C                     END
     C           #2RINO    IFNE *BLANK                     Retail ind.: Ov
     C           HPRINO    CABNE#2RINO    BB020            Retail ind.: Ov
     C                     END
     C           #2RINE    IFNE *BLANK                     Retail ind.: Er
     C           HPRINE    CABNE#2RINE    BB020            Retail ind.: Er
     C                     END
     C           #2TRTY    IFNE *BLANK                     Transaction typ
     C           HPTRTY    CABNE#2TRTY    BB020            Transaction typ
     C                     END
     C           #2PTAM    IFNE *ZERO                      Posting amount
     C           HPPTAM    CABNE#2PTAM    BB020            Posting amount
     C                     END
     C           #2DCIN    IFNE *BLANK                     Debit/credit in
     C           HPDCIN    CABNE#2DCIN    BB020            Debit/credit in
     C                     END
     C           #2PTDT    IFNE *ZERO                      Posting date
     C           HPPTDT    CABNE#2PTDT    BB020            Posting date
     C                     END
     C           #2VLDT    IFNE *ZERO                      Value date
     C           HPVLDT    CABNE#2VLDT    BB020            Value date
     C                     END
     C           #2NVCD    IFNE *BLANK                     Narrative code
     C           HPNVCD    CABNE#2NVCD    BB020            Narrative code
     C                     END
     C           #2NRDC    IFNE *BLANK                     Narrative descr
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           HPNRDC           Narrative descr
      * Length
     C                     PARM 30        WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           #2NRDC
      * Length
     C                     PARM 30        WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2ACTY    IFNE *BLANK                     Account type
     C           HPACTY    CABNE#2ACTY    BB020            Account type
     C                     END
     C           #2ACNB    IFNE *BLANK                     Assoc. Customer
     C           HPACNB    CABNE#2ACNB    BB020            Assoc. Customer
     C                     END
     C           #2CQNB    IFNE *BLANK                     Cheque number
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           HPCQNB           Cheque number
      * Length
     C                     PARM 8         WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           #2CQNB
      * Length
     C                     PARM 8         WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2COIN    IFNE *BLANK                     Customer origin
     C           HPCOIN    CABNE#2COIN    BB020            Customer origin
     C                     END
     C           #2SWCR    IFNE *BLANK                     Swift common re
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           HPSWCR           Swift common re
      * Length
     C                     PARM 16        WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           #2SWCR
      * Length
     C                     PARM 16        WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2PRCN    IFNE *BLANK                     Profit centre
     C           HPPRCN    CABNE#2PRCN    BB020            Profit centre
     C                     END
     C           #2BCBH    IFNE *BLANK                     Branch Code (Ba
     C           HPBCBH    CABNE#2BCBH    BB020            Branch Code (Ba
     C                     END
     C           #2RADP    IFNE *BLANK                     Retail advice p
     C           HPRADP    CABNE#2RADP    BB020            Retail advice p
     C                     END
     C           #2SHPI    IFNE *BLANK                     Shadow post ind
     C           HPSHPI    CABNE#2SHPI    BB020            Shadow post ind
     C                     END
     C           #2RRNM    IFNE *ZERO                      Relative rec no
     C           HPRRNM    CABNE#2RRNM    BB020            Relative rec no
     C                     END
     C           #2RNBE    IFNE *BLANK                     Retail Number E
     C           HPRNBE    CABNE#2RNBE    BB020            Retail Number E
     C                     END
     C           #2RARC    IFNE *BLANK                     Retail Ac Refer
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           HPRARC           Retail Ac Refer
      * Length
     C                     PARM 10        WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           #2RARC
      * Length
     C                     PARM 10        WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2TSTY    IFNE *BLANK                     Transaction (Su
      * Scan for search string
     C                     CALL 'QCLSCAN'
     C                     PARM           HPTSTY           Transaction (Su
      * Length
     C                     PARM 10        WQA3N   30
      * Start
     C                     PARM 1         WQB3N   30
      * Mask
     C                     PARM           #2TSTY
      * Length
     C                     PARM 10        WQC3N   30
      * Translate
     C                     PARM '1'       WQD1    1
      * Trim
     C                     PARM '1'       WQE1    1
      * Wild
     C                     PARM '?'       WQF1    1
      * Result
     C                     PARM           WQG3N   30
     C           WQG3N     CABLT1         BB020
     C                     END
     C           #2BKCD    IFNE *BLANK                     Book Code
     C           HPBKCD    CABNE#2BKCD    BB020            Book Code
     C                     END
     C           #2SPFC    IFNE *ZERO                      Spread Factor
     C           HPSPFC    CABNE#2SPFC    BB020            Spread Factor
     C                     END
     C           #2RVDI    IFNE *BLANK                     Reverse/Void In
     C           HPRVDI    CABNE#2RVDI    BB020            Reverse/Void In
     C                     END
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           #2OCCY    IFNE *BLANKS                    Original Ccy   CEU013
     C           HPOCCY    CABNE#2OCCY    BB020                           CEU013
     C                     ENDIF                                          CEU013
     C           #2OAMT    IFNE *ZERO                      Original Amt   CEU013
     C           HPOAMT    CABNE#2OAMT    BB020                           CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
      * Load SFL fields
     C                     EXSR MBFL#1
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialise subfile record from DBF record
      * Format Narrative
      * CASE: DB1.Narrative code is Narrative code
     C           HPNVCD    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVELHPNVCD    #RNRTV           Narrative
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELHPNRDC    #RNRTV           Narrative
     C                     END                             *FI
      * Format Account Identifier
      * CASE: DB1.Retail Number Entered is Retail Account
     C           HPRNBE    IFEQ 'Y'                        *IF
     C                     MOVELHPRACN    #RACID           Account Identif
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELHPCUST    #RACID           Account Identif
     C                     END                             *FI
      * Format Posting Amount
      * And Original Amount                                               CEU013
     C                     EXSR UASUBR                     Format Posting
      * Format Value Date
      * CASE: DB1.Value date is Not zero
     C           HPVLDT    IFNE *ZERO                      *IF
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM HPVLDT    WQ0001  50       Runday Number
     C                     PARM WUDTFF    WQ0002  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0003  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0004  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    #RVDDS
     C                     END                             *FI
     C                     MOVELWUIEMG    #RIEMG           Item error mess
      * DBF record not selected
     C           W0RSL     CABNE'Y'       BB020
      * Output to subfile
     C                     ADD  1         ##RR       81    *
     C                     ADD  1         ##RROK
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C/COPY WNCPYSRC,GL0125DC01
     C                     WRITE#SFLRCD
     C           BB020     TAG
      **Increment*scan*check*count*************************************                     AR659451
     C**********           ADD  1         ##RRRD                                            AR659451
     C           KRST      READE@BFREDE                  82*82=EOF
     C                     END                             OD 1 - ##SFPG
      *................................................................
      * If no DBF records found, display error message
     C           ##RR      IFEQ *ZERO
     C           *IN82     ANDEQ'1'
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI ##RR = *ZERO
      *
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
     C           ##RRMX    ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      **If*scan*limit*reached,*display*error*message*******************                     AR659451
     C********** ##RRRD    IFGE W0SLM                                                       AR659451
      **Send*message*'*Scan*limit*reached'*****************************                     AR659451
     C**********           MOVEL'Y2U0017' ZAMSID                                            AR659451
     C**********           MOVEL'Y2USRMSG'ZAMSGF                                            AR659451
     C**********           EXSR ZASNMS                                                      AR659451
     C**********           ELSE                                                             AR659451
     C                     Z-ADD0         ##RROK
     C**********           END                                                              AR659451
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
     C           W0HLP     DOUEQ'N'
     C                     MOVEL'N'       W0HLP   1
     C                     MOVE *IN25     HELP25  1
     C                     MOVE *ALL'0'   ##OFF  30
     C                     MOVEA##OFF     *IN,1
     C                     MOVE HELP25    *IN25
      * Update screen time
     C                     TIME           ##TME
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN81     IFNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     SETOF                     30                                    BUG24339A
     C           CER030    IFEQ 'N'                                                        BUG24339A
     C           CER031    ANDEQ'N'                                                        BUG24339A
     C                     SETON                     30                                    BUG24339A
     C                     ENDIF                                                           BUG24339A
     C                     MOVE *IN81     CAIN81  1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGMQ 10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
     C                     SETOF                       8392*
      *                                                                                     BUG24339
     C  N29                EXSR RDSFL                                                       BUG24339
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      *
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Reload subfile requested
     C           W0RSF     CABEQ'Y'       DAEXIT
      * If error, quit processing
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C                     MOVEL'0'       *IN78
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
     C                     MOVEL'0'       *IN77
     C           #1TRTY    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN77
     C                     END                             *FI
     C                     MOVEL'0'       *IN76
     C           #1TSTY    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN76
     C                     END                             *FI
     C                     MOVEL'0'       *IN75
     C           #1VLDT    IFEQ *ZERO                      *IF
     C                     MOVEL'1'       *IN75
     C                     END                             *FI
     C                     MOVEL'0'       *IN74
     C           #1CQNB    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN74
     C                     END                             *FI
     C                     MOVEL'0'       *IN73
     C           #1SWCR    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN73
     C                     END                             *FI
     C                     MOVEL'0'       *IN72
     C           #1PRCN    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN72
     C                     END                             *FI
     C                     MOVEL'0'       *IN71
     C           #1ACNB    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN71
     C                     END                             *FI
     C                     MOVEL'0'       *IN70
     C           #1BKCD    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN70
     C                     END                             *FI
     C                     MOVEL'0'       *IN69
     C           WURVDI    IFEQ *BLANK                     *IF
     C                     MOVEL'1'       *IN69
     C                     END                             *FI
     C                     MOVEL'0'       *IN68
     C           WUDNIT    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN68
     C                     END                             *FI
     C                     MOVEL'0'       *IN67
     C           #1RINE    IFEQ *BLANK                     *IF
     C           #1RINE    OREQ 'N'
     C                     MOVEL'1'       *IN67
     C                     END                             *FI
     C                     MOVE *ON       *IN88                           CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           #1OCCY    IFNE *BLANKS                                   CEU013
     C           #1OAMT    ORNE *ZERO                                     CEU013
     C                     MOVE *OFF      *IN88                           CEU013
     C                     ENDIF                                          CEU013
     C                     ENDIF                                          CEU013
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C                     MOVEL'0'       *IN79
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @BFREDE fields to subfile
      *================================================================
     C                     Z-ADDHPBEDT    #1BEDT           Batch Entry Dat
     C                     MOVELHPBTNB    #1BTNB           Batch number
     C                     Z-ADDHPBINB    #1BINB           Batch item no.
     C                     MOVELHPCUST    #1CUST           Customer number
     C                     MOVELHPNNBI    #1NNBI           Nostro number (
     C                     Z-ADDHPRACN    #1RACN           Retail account
     C                     MOVELHPRINE    #1RINE           Retail ind.: Er
     C                     Z-ADDHPPTAM    #1PTAM           Posting amount
     C/COPY OFCPYSRCZ,CGL135_036                                                            MD024552
     C                     Z-ADDHPPTDT    #1PTDT           Posting date
     C                     Z-ADDHPVLDT    #1VLDT           Value date
     C                     MOVELHPNVCD    #1NVCD           Narrative code
     C                     MOVELHPNRDC    #1NRDC           Narrative descr
     C                     MOVELHPACTY    #1ACTY           Account type
     C                     MOVELHPCOIN    #1COIN           Customer origin
     C                     MOVELHPBCBH    #1BCBH           Branch Code (Ba
     C                     MOVELHPRADP    #1RADP           Retail advice p
     C                     MOVELHPSHPI    #1SHPI           Shadow post ind
     C                     Z-ADDHPRRNM    #1RRNM           Relative rec no
     C                     MOVELHPRNBE    #1RNBE           Retail Number E
     C                     MOVELHPRARC    #1RARC           Retail Ac Refer
     C                     Z-ADDHPSPFC    #1SPFC           Spread Factor
     C                     MOVELHPCYCD    #1CYCD           Currency code
     C                     MOVELHPACCD    #1ACCD           Account code
     C                     MOVELHPACSN    #1ACSN           Account sequenc
     C                     MOVELHPIBCA    #1IBCA           Input Branch Co
     C                     MOVELHPDCIN    #1DCIN           Debit/credit in
     C                     MOVELHPTRTY    #1TRTY           Transaction typ
     C                     MOVELHPTSTY    #1TSTY           Transaction (Su
     C                     MOVELHPCQNB    #1CQNB           Cheque number
     C                     MOVELHPSWCR    #1SWCR           Swift common re
     C                     MOVELHPPRCN    #1PRCN           Profit centre
     C                     MOVELHPACNB    #1ACNB           Assoc. Customer
     C                     MOVELHPBKCD    #1BKCD           Book Code
     C                     MOVELHPRVDI    #1RVDI           Reverse/Void In
     C                     Z-ADDHPNITM    #1NITM           Number of Items
     C                     MOVELHPRINO    #1RINO           Retail ind.: Ov
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVELHPOCCY    #1OCCY           Original Ccy   CEU013
     C                     Z-ADDHPOAMT    #1OAMT           Original Amt   CEU013
     C                     ENDIF                                          CEU013
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVEL*BLANK    #RVDDS           Value date (dis
     C                     MOVEL*BLANK    #RIEMG           Item error mess
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     Z-ADDP1BEDT    #2BEDT           Batch Entry Dat
     C                     MOVELP1BTNB    #2BTNB           Batch number
     C                     Z-ADD*ZERO     #2BINB           Batch item no.
     C                     MOVEL*BLANK    #2IBCA           Input Branch Co
     C                     MOVEL*BLANK    #2CUST           Customer number
     C                     MOVEL*BLANK    #2CYCD           Currency code
     C                     MOVEL*BLANK    #2ACCD           Account code
     C                     MOVEL*BLANK    #2ACSN           Account sequenc
     C                     MOVEL*BLANK    #2NNBI           Nostro number (
     C                     Z-ADD*ZERO     #2RACN           Retail account
     C                     MOVEL*BLANK    #2RINO           Retail ind.: Ov
     C                     MOVEL*BLANK    #2RINE           Retail ind.: Er
     C                     MOVEL*BLANK    #2TRTY           Transaction typ
     C                     Z-ADD*ZERO     #2PTAM           Posting amount
     C                     MOVEL*BLANK    #2DCIN           Debit/credit in
     C                     Z-ADD*ZERO     #2PTDT           Posting date
     C                     Z-ADD*ZERO     #2VLDT           Value date
     C                     MOVEL*BLANK    #2NVCD           Narrative code
     C                     MOVEL*BLANK    #2NRDC           Narrative descr
     C                     MOVEL*BLANK    #2ACTY           Account type
     C                     MOVEL*BLANK    #2ACNB           Assoc. Customer
     C                     MOVEL*BLANK    #2CQNB           Cheque number
     C                     MOVEL*BLANK    #2COIN           Customer origin
     C                     MOVEL*BLANK    #2SWCR           Swift common re
     C                     MOVEL*BLANK    #2PRCN           Profit centre
     C                     MOVEL*BLANK    #2BCBH           Branch Code (Ba
     C                     MOVEL*BLANK    #2RADP           Retail advice p
     C                     MOVEL*BLANK    #2SHPI           Shadow post ind
     C                     Z-ADD*ZERO     #2RRNM           Relative rec no
     C                     MOVEL*BLANK    #2RNBE           Retail Number E
     C                     MOVEL*BLANK    #2RARC           Retail Ac Refer
     C                     MOVEL*BLANK    #2TSTY           Transaction (Su
     C                     MOVEL*BLANK    #2BKCD           Book Code
     C                     Z-ADD*ZERO     #2SPFC           Spread Factor
     C                     MOVEL*BLANK    #2RVDI           Reverse/Void In
     C           CEU013    IFEQ 'Y'                                       CEU013
     C                     MOVEL*BLANKS   #2OCCY           Original Ccy   CEU013
     C                     Z-ADD*ZERO     #2OAMT           Original Amt   CEU013
     C                     ENDIF                                          CEU013
      * Check restriction within
     C                     EXSR VACKRL
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Format Posting Amount
      * And Original Amount                                               CEU013
      *                                                                   CEU013
      *================================================================
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    #1CYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * Format amount (short) - Standard functions  *
     C                     Z-ADD#1PTAM    ULVALU           Value
      *
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALU 150       I:Value
     C                     PARM WUNBDP    ULDECP  10       I:Decimal place
     C***********          PARM 'L'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM '3'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLF 23        O:Formatted
      *
     C                     MOVE ULRSLF    #RFMPA           Formatted data
      *
      * Access Currency. - Original Currency                              CEU013
      * And Format Original Amount                                        CEU013
     C           CEU013    IFEQ 'Y'                                       CEU013
     C           #1OAMT    ANDNE*ZERO                                     CEU013
     C*                                                                   CEU013
     C*  Access Currency codes file for the following fields              CEU013
     C*  Currency Name, Number of decimal places, Nostro Shortname        CEU013
     C*                                                                   CEU013
     C                     MOVEL#1OCCY    UUCYCD    P                     CEU013
     C                     CALL 'AOCURRR0'                                CEU013
     C           WUAPRC    PARM WUAPRC    UUAPRC           B:Return Cd    CEU013
     C                     PARM '*KEY'    UUAPOP           I:Option       CEU013
     C                     PARM           UUCYCD           I:Currency CodeCEU013
     C           D@CURR    PARM *BLANK    UUSDY            O:Format       CEU013
     C           UUAPRC    IFNE *BLANKS                                   CEU013
     C           *LOCK     IN   LDA                                       CEU013
     C                     SETON                       U7U8               CEU013
     C                     Z-ADD001       DBASE            ***************CEU013
     C                     MOVEL'SDCURRPD'DBFILE           *DB ERROR 001 *CEU013
     C                     MOVELUUCYCD    DBKEY            ***************CEU013
     C                     OUT  LDA                                       CEU013
     C                     EXSR *PSSR                                     CEU013
     C                     ENDIF                                          CEU013
     C*                                                                   CEU013
     C* Assign work field to file field values.                           CEU013
     C*                                                                   CEU013
     C                     MOVELA6CYCD    #1OCCY           Currency Code  CEU013
     C                     MOVELA6CYNM    WUCYNM           Currency Name  CEU013
     C                     MOVELA6NBDP    WUNBDP           No. Decimal PlaCEU013
     C                     MOVELA6NOSN    WUNOSN           Nostro ShortnamCEU013
     C*                                                                   CEU013
      * Format amount (short) - Standard functions  *                     CEU013
     C                     Z-ADD#1OAMT    ULVALU           Value          CEU013
      *                                                                   CEU013
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>CEU013
     C                     PARM           ULVALU 150       I:Value        CEU013
     C                     PARM WUNBDP    ULDECP  10       I:Decimal placeCEU013
     C                     PARM '3'       ULEDIT  1        I:IBM Edit codeCEU013
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.CEU013
     C                     PARM           ULRSLF 23        O:Formatted    CEU013
      *                                                                   CEU013
     C                     MOVE ULRSLF    #RFMOA           Formatted data CEU013
     C                     ENDIF                                          CEU013
      *                                                                   CEU013
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      *
     C           KLVAHH    KLIST
     C                     KFLD           HHBEDT           Batch Entry Dat
     C                     KFLD           HHBTNB           Batch number
      * Setup key
     C                     Z-ADD#2BEDT    HHBEDT           Batch Entry Dat
     C                     MOVEL#2BTNB    HHBTNB           Batch number
     C           KLVAHH    CHAIN@BEREDB              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
      * Restrictor relation not satisfied
      * Send message 'Journal History Header NF'
     C                     MOVEL'GLX0262' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'GLX0262' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VAEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGMQ    IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGMQ
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGMQ
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
      *
      * Extract cursor row and column
     C           @#RWCL    DIV  256       ZHCSRW  50       Row
     C                     MVR            ZHCSCL  50       Column
      *
      * Save cursor position for redisplay
     C                     Z-ADDZHCSRW    ZZCSRW  30       Row
     C                     Z-ADDZHCSCL    ZZCSCL  30       Column
      *
     C                     CALL 'YDDSHPR'
     C                     PARM 'GL0125D#'W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
     C                     PARM '*START'  YYHLVN 10        Help label
     C                     PARM '*NORMAL' YYUSOP 10        Options
     C                     PARM ZHCSRW    YYRW    50       Row
     C                     PARM ZHCSCL    YYCL    50       Column
     C                     PARM *ZERO     YYLGCT  50       # of grps
     C                     PARM *BLANK    YYLGVN 10        Label grps
      *
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel & exit program
      *================================================================
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field Access Pgm Return Code
     C                     MOVEL*BLANK    WUAPRC  7
      * Define work field Currency Name
     C                     MOVEL*BLANK    WUCYNM 14
      * Define work field Number of Decimal Places
     C                     Z-ADD*ZERO     WUNBDP  10
      * Define work field Nostro Shortname
     C                     MOVEL*BLANK    WUNOSN 10
      * Define work field Date Format flag
     C                     MOVEL*BLANK    WUDTFF  1
      * Define work field Date (numeric format)
     C                     Z-ADD*ZERO     WUDTNF  60
      * Define work field Midas Run Date
     C                     MOVEL*BLANK    WUDDCD  7
      * Define work field Item error message
     C                     MOVEL*BLANK    WUIEMG 76
      * Define work field Multibranching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Define work field Reverse/Void Indicator
     C                     MOVEL*BLANK    WURVDI  1
      * Define work field Display no of items
     C                     MOVEL*BLANK    WUDNIT  1
      * Obtain default message file
     C           *NAMVAR   DEFN MIMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Midas Rundate
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Runday Number
     C                     Z-ADD*ZERO     WURDNO  50
      * Define work field Setup Complete
     C                     MOVEL*BLANK    WUSUCP  1
      * Define work field Midas/Telex Module Ind.
     C                     MOVEL*BLANK    WUMTMI  1
      * Define work field SWIFT Funds Transfer
     C                     MOVEL*BLANK    WUSWFT  1
      * Define work field SWIFT Securities Trading
     C                     MOVEL*BLANK    WUSWST  1
      * Define work field SWIFT Customer Lending
     C                     MOVEL*BLANK    WUSWCL  1
      * Define work field SWIFT Syndicated Loans
     C                     MOVEL*BLANK    WUSWSL  1
      * Define work field SWIFT Statements
     C                     MOVEL*BLANK    WUSWSM  1
      * Define work field SWIFT Dealing
     C                     MOVEL*BLANK    WUSWDL  1
      * Define work field Standing data/Gen.Ledger
     C                     MOVEL*BLANK    WUSDGL  1
      * Define work field Dealing: FX
     C                     MOVEL*BLANK    WUDLFX  1
      * Define work field Syndicated Loans
     C                     MOVEL*BLANK    WUSYLN  1
      * Define work field Exposure Management
     C                     MOVEL*BLANK    WUEXMG  1
      * Define work field Financial Modeller
     C                     MOVEL*BLANK    WUFNMO  1
      * Define work field Statutary Returns
     C                     MOVEL*BLANK    WUSTRT  1
      * Define work field Customer Lending
     C                     MOVEL*BLANK    WUCSLN  1
      * Define work field Retail Banking
     C                     MOVEL*BLANK    WURTBN  1
      * Define work field Midas/Swift direct link
     C                     MOVEL*BLANK    WUMSDL  1
      * Define work field Securities
     C                     MOVEL*BLANK    WUSECS  1
      * Define work field Auto-reconciliations
     C                     MOVEL*BLANK    WUAURC  1
      * Define work field Bond Dealers Interface
     C                     MOVEL*BLANK    WUBDLI  1
      * Define work field DRS Standing Data
     C                     MOVEL*BLANK    WUDRSD  1
      * Define work field DRS Control module
     C                     MOVEL*BLANK    WUDRCM  1
      * Define work field DRS Foreign Exchange
     C                     MOVEL*BLANK    WUDRFE  1
      * Define work field DRS Money Market
     C                     MOVEL*BLANK    WUDRMM  1
      * Define work field DRS Arbitrage
     C                     MOVEL*BLANK    WUDRAR  1
      * Define work field Funds Transfer
     C                     MOVEL*BLANK    WUFDTR  1
      * Define work field DRS Common Applications
     C                     MOVEL*BLANK    WUDRCA  1
      * Define work field Futures & Options
     C                     MOVEL*BLANK    WUFUOP  1
      * Define work field Midas/Telex Synd. Loans
     C                     MOVEL*BLANK    WUMTSL  1
      * Define work field Midas/Telex Dealing
     C                     MOVEL*BLANK    WUMTDL  1
      * Define work field Midas/Telex Gen. Ledger
     C                     MOVEL*BLANK    WUMTGL  1
      * Define work field Midas/Telex Cust. Lending
     C                     MOVEL*BLANK    WUMTCL  1
      * Define work field Network Midas
     C                     MOVEL*BLANK    WUNWMI  1
      * Define work field FRA/IRS Indicator
     C                     MOVEL*BLANK    WUFIIN  1
      * Define work field Dealing: MM
     C                     MOVEL*BLANK    WUDLMM  1
      * Define work field Internal Contracts
     C                     MOVEL*BLANK    WUINCN  1
      * Define work field Treasury Management
     C                     MOVEL*BLANK    WUTRMG  1
      * Define work field Risk Management
     C                     MOVEL*BLANK    WURKMG  1
      * Define work field Testkey
     C                     MOVEL*BLANK    WUTSKY  1
      * Define work field Midas/Q
     C                     MOVEL*BLANK    WUMIDQ  1
      * Define work field Microfiche
     C                     MOVEL*BLANK    WUMFIC  1
      * Define work field Interest on accounts
     C                     MOVEL*BLANK    WUIOAC  1
      * Define work field Window processing requir.
     C                     MOVEL*BLANK    WUWDPR  1
      * Define work field SAR's processing required
     C                     MOVEL*BLANK    WUSARP  1
      * Define work field French  return indicator
     C                     MOVEL*BLANK    WUFRIN  1
      * Define work field Lux     return indicator
     C                     MOVEL*BLANK    WULRIN  1
      * Define work field Dutch   return indicator
     C                     MOVEL*BLANK    WUDRIN  1
      * Define work field German  return indicator
     C                     MOVEL*BLANK    WUGRIN  1
      * Define work field Belgian return indicator
     C                     MOVEL*BLANK    WUBRIN  1
      * Define work field Italian return indicator
     C                     MOVEL*BLANK    WUIRIN  1
      * Define work field Swift External Interface
     C                     MOVEL*BLANK    WUSWEI  1
      * Define work field Portfolio Management
     C                     MOVEL*BLANK    WUPFMG  1
      * Define work field Credit Management.
     C                     MOVEL*BLANK    WUCRMG  1
      * Define work field Head Office Reporting
     C                     MOVEL*BLANK    WUHORP  1
      * Define work field Average Balances
     C                     MOVEL*BLANK    WUAVBL  1
      * Define work field Margins
     C                     MOVEL*BLANK    WUMARG  1
      * Define work field Taxes
     C                     MOVEL*BLANK    WUNTST  1
      * Define work field Retail 3
     C                     MOVEL*BLANK    WUNXST  1
      * Define work field Interest on Accounts 3
     C                     MOVEL*BLANK    WUNYST  1
      * Define work field Charge for Mult Transacts
     C                     MOVEL*BLANK    WUCHMT  1
     C                     Z-ADD03        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      **Scan*limit*****************************************************                     AR659451
     C**********           Z-ADD500       W0SLM   50                                        AR659451
      *................................................................
     C                     MOVEL*BLANK    W0GRP   1
      * USER: Initialise program
      * Standard RPG Creation Par - Standard functions  *
      * Copyright notice - Standard functions  *
      * Last Amend Box - GL0125D - Journal History Posting  *
      * Access Midas rundate - Standard functions  *
     C*   Access MIDAS Rundate from data-area RUNDAT
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C           *NAMVAR   DEFN           LDA                             CEU013
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT
     C                     MOVE RDNO      WURDNO
     C                     MOVE SUCP      WUSUCP
     C                     MOVE DTFF      WUDTFF
     C                     MOVE MBIN      WUMBIN
     C/COPY OFCPYSRCZ,CGL135_037                                                            MD024552
     C*                                                                   CEU013
     C** Access SAR DETAILSEFILE to determine if CEU013 is installed      CEU013
     C*                                                                   CEU013
     C                     CALL 'AOSARDR0'                                CEU013
     C                     PARM '       ' @RTCD   7                       CEU013
     C                     PARM '*VERIFY' @OPTN   7                       CEU013
     C                     PARM 'CEU013'  @SARD   6                       CEU013
     C           @RTCD     IFNE *BLANK                                    CEU013
     C           @RTCD     ANDNE'*NRF   '                                 CEU013
     C           *LOCK     IN   LDA                                       CEU013
     C                     SETON                       U7U8               CEU013
     C                     Z-ADD002       DBASE            ***************CEU013
     C                     MOVEL'SDCURRPD'DBFILE           *DB ERROR 002 *CEU013
     C                     MOVEL@OPTN     DBKEY            ***************CEU013
     C                     MOVEL@OPTN     DBOPTN  7                       CEU013
     C                     OUT  LDA                                       CEU013
     C                     EXSR *PSSR                                     CEU013
     C                     ENDIF                                          CEU013
     C           @RTCD     IFEQ *BLANK                                    CEU013
     C                     MOVE 'Y'       CEU013  1                       CEU013
     C                     END                                            CEU013
      * Define 800 Byte Dummy DS - Standard functions  *
      * Currency Codes DS - Currency Codes  *
      * Setup message data for message
      * Retrieve message Lots of Dots
     C                     MOVELZADFMF    ZAMSGF
     C                     CALL 'Y2RVMGC'              90  *
     C                     PARM *BLANK    W0RTN   7        Return code
     C                     PARM 'GLX0083' ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C           WUIEMG    PARM           W0MTX 132        Returned messag
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSGF
      * Multi-Language - GL0125D - Journal History Posting  *
      *
     C                     CALL 'AOSARDR0'                                                  BUG24339
     C                     PARM *BLANKS   @RTCD                                             BUG24339
     C                     PARM '*VERIFY' @OPTN                                             BUG24339
     C                     PARM 'CER030'  @SARD                                             BUG24339
     C           SCSARD    PARM SCSARD    UUFDY                                             BUG24339
      *                                                                                     BUG24339
     C           PRTCD     IFNE *BLANKS                                                     BUG24339
     C           PRTCD     ANDNE'*NRF    '                                                  BUG24339
     C           *LOCK     IN   LDA                                                         BUG24339
     C                     MOVE 'SCSARDPD'DBFILE                                            BUG24339
     C**********           MOVEL'002'     DBASE                                   BUG24339 BUG24339A
     C                     MOVEL'003'     DBASE                                            BUG24339A
     C                     MOVEL'CER030'  DBKEY                                             BUG24339
     C                     OUT  LDA                                                         BUG24339
     C                     EXSR *PSSR                                                       BUG24339
     C                     ENDIF                                                            BUG24339
      *                                                                                     BUG24339
     C           PRTCD     IFEQ *BLANK                                                      BUG24339
     C                     MOVE 'Y'       CER030  1                                         BUG24339
     C                     ELSE                                                             BUG24339
     C                     MOVE 'N'       CER030                                            BUG24339
     C                     ENDIF                                                            BUG24339
      *                                                                                     BUG24339
     C                     CALL 'AOSARDR0'                                                 BUG24339A
     C                     PARM *BLANKS   @RTCD                                            BUG24339A
     C                     PARM '*VERIFY' @OPTN                                            BUG24339A
     C                     PARM 'CER031'  @SARD                                            BUG24339A
     C           SCSARD    PARM SCSARD    UUFDY                                            BUG24339A
      *                                                                                    BUG24339A
     C           PRTCD     IFNE *BLANKS                                                    BUG24339A
     C           PRTCD     ANDNE'*NRF    '                                                 BUG24339A
     C           *LOCK     IN   LDA                                                        BUG24339A
     C                     MOVE 'SCSARDPD'DBFILE                                           BUG24339A
     C                     MOVEL'004'     DBASE                                            BUG24339A
     C                     MOVEL'CER031'  DBKEY                                            BUG24339A
     C                     OUT  LDA                                                        BUG24339A
     C                     EXSR *PSSR                                                      BUG24339A
     C                     ENDIF                                                           BUG24339A
      *                                                                                    BUG24339A
     C           PRTCD     IFEQ *BLANK                                                     BUG24339A
     C                     MOVE 'Y'       CER031  1                                        BUG24339A
     C                     ELSE                                                            BUG24339A
     C                     MOVE 'N'       CER031                                           BUG24339A
     C                     ENDIF                                                           BUG24339A
      *                                                                                    BUG24339A
     C                     SETOF                     30                                    BUG24339A
     C           CER030    IFEQ 'N'                                                        BUG24339A
     C           CER031    ANDEQ'N'                                                        BUG24339A
     C                     SETON                     30                                    BUG24339A
     C                     ENDIF                                                           BUG24339A
     C/COPY OFCPYSRCZ,CGL135_038                                                            MD024552
      * Call SDRTVTXT pgm to access appropriate text
      *  for a field used in a SFL
      *
      * Type
     C                     MOVEL'ZZGBMSGF'MSGNM
     C                     MOVEL'ZZM3773' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM002                          S01413
     C                     MOVELMSGTXT    ZZM002  6                       S01413
      * Sub Type:                                                         S01413
     C                     MOVEL'ZZM8533' MSGDNB                          S01413
     C                     CALL 'SDRTVTXT'                                S01413
     C                     PARM           MSGDNB  7                       S01413
     C                     PARM           MSGNM  10                       S01413
     C                     PARM           MSGTXT 80                       S01413
     C                     MOVELMSGTXT    ZZM003  9                       S01413
      * Value Date:                                                       S01413
     C                     MOVEL'ZZM0078' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM003                          S01413
     C                     MOVELMSGTXT    ZZM004 11                       S01413
      * Cheque:
     C                     MOVEL'ZZM3774' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM004                          S01413
     C                     MOVELMSGTXT    ZZM005  7                       S01413
      * Associated customer:
     C                     MOVEL'ZZM3804' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM005                          S01413
     C                     MOVELMSGTXT    ZZM008 20                       S01413
      * Swift:
     C                     MOVEL'ZZM3776' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM006                          S01413
     C                     MOVELMSGTXT    ZZM006  6                       S01413
      * Profit centre:
     C                     MOVEL'ZZM0086' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM007                          S01413
     C                     MOVELMSGTXT    ZZM007 14                       S01413
      * Book Code:
     C                     MOVEL'ZZM1604' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM008                          S01413
     C                     MOVELMSGTXT    ZZM009 10                       S01413
      * Void:                                                             S10736
     C                     MOVEL'ZZM8178' MSGDNB                          S10736
     C                     CALL 'SDRTVTXT'                                S10736
     C                     PARM           MSGDNB  7                       S10736
     C                     PARM           MSGNM  10                       S10736
     C                     PARM           MSGTXT 80                       S10736
     C***********          MOVELMSGTXT    ZZM009                    S10736S01413
     C                     MOVELMSGTXT    ZZM010  5                       S01413
      *                                                                   S10736
      * No. Items:                                                        S01413
     C                     MOVEL'ZZM8535' MSGDNB                          S01413
     C                     CALL 'SDRTVTXT'                                S01413
     C                     PARM           MSGDNB  7                       S01413
     C                     PARM           MSGNM  10                       S01413
     C                     PARM           MSGTXT 80                       S01413
     C                     MOVELMSGTXT    ZZM011 10                       S01413
      * O'ride:                                                           S10736
     C                     MOVEL'ZZM8179' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM010                    S10736S01413
     C                     MOVELMSGTXT    ZZM012  7                       S01413
      *                                                                                     MD024552
     C/COPY OFCPYSRCZ,CGL135_116                                                            MD024552
      *                                                                                     MD024552
      * Original Ccy/Amount:                                              CEU013
     C                     MOVEL'ZZN5732' MSGDNB                          CEU013
     C                     CALL 'SDRTVTXT'                                CEU013
     C                     PARM           MSGDNB  7                       CEU013
     C                     PARM           MSGNM  10                       CEU013
     C                     PARM           MSGTXT 80                       CEU013
     C/COPY OFCPYSRCZ,CGL135_095                                                            MD024552
     C                     MOVELMSGTXT    ZZM013 20                       CEU013
      *                                                                                     MD024552
     C/COPY OFCPYSRCZ,CGL135_117                                                            MD024552
      *
      * start S01413
      * Define 200 Byte Dummy DS - Standard functions  *
      * MIDAS Modules DS - MIDAS Modules  *
      * Access MIDAS Modules. - MIDAS Modules  *
     C*
     C*  Access Midas Modules file for the file fields
     C*
     C                     CALL 'AOMMODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*FIRST'  UUAPOP  7        I:Option
     C           D@MMOD    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELBGMTMI    WUMTMI           Midas/Telex Module in
     C                     MOVELBGSWFT    WUSWFT           SWIFT Funds Transfer
     C                     MOVELBGSWST    WUSWST           SWIFT Securities Trad
     C                     MOVELBGSWCL    WUSWCL           SWIFT Customer Lend
     C                     MOVELBGSWSL    WUSWSL           SWIFT Syndicated Loan
     C                     MOVELBGSWSM    WUSWSM           SWIFT Statements
     C                     MOVELBGSWDL    WUSWDL           SWIFT Dealing
     C                     MOVELBGSDGL    WUSDGL           Standing Data/Gen Leg
     C                     MOVELBGDLFX    WUDLFX           Dealing : FX
     C                     MOVELBGSYLN    WUSYLN           Syndicated Loans
     C                     MOVELBGEXMG    WUEXMG           Exposure Management
     C                     MOVELBGFNMO    WUFNMO           Financial Modeller
     C                     MOVELBGSTRT    WUSTRT           Statuatory Returns
     C                     MOVELBGCSLN    WUCSLN           Customer Lending
     C                     MOVELBGRTBN    WURTBN           Retail Banking
     C                     MOVELBGMSDL    WUMSDL           Midas/SWIFT Direct lk
     C                     MOVELBGSECS    WUSECS           Securities
     C                     MOVELBGAURC    WUAURC           Auto-Reconcilliations
     C                     MOVELBGBDLI    WUBDLI           Bond Dealers Interfce
     C                     MOVELBGDRSD    WUDRSD           DRS Standing Data
     C                     MOVELBGDRCM    WUDRCM           DRS Control Module
     C                     MOVELBGDRFE    WUDRFE           DRS Foreign Exchange
     C                     MOVELBGDRMM    WUDRMM           DRS Money Markets
     C                     MOVELBGDRAR    WUDRAR           DRS Arbitrage
     C                     MOVELBGFDTR    WUFDTR           Funds Transfer
     C                     MOVELBGDRCA    WUDRCA           DRS Common Applic's
     C                     MOVELBGFUOP    WUFUOP           Futures & Options
     C                     MOVELBGMTSL    WUMTSL           Midas/Telex Syn Loans
     C                     MOVELBGMTDL    WUMTDL           Midas/Telex Dealing
     C                     MOVELBGMTGL    WUMTGL           Midas/Telex Gen Ledg
     C                     MOVELBGMTCL    WUMTCL           Midas/Telex Cust Len
     C                     MOVELBGNWMI    WUNWMI           Network Midas
     C                     MOVELBGFIIN    WUFIIN           FRA/IRS Indicator
     C                     MOVELBGDLMM    WUDLMM           Dealing:Money Markets
     C                     MOVELBGINCN    WUINCN           Internal Contracts
     C                     MOVELBGTRMG    WUTRMG           Treasury Management
     C                     MOVELBGRKMG    WURKMG           Risk Management
     C                     MOVELBGTSKY    WUTSKY           TestKey
     C                     MOVELBGMIDQ    WUMIDQ           Midas Q
     C                     MOVELBGMFIC    WUMFIC           Microfiche
     C                     MOVELBGIOAC    WUIOAC           Interest on Accounts
     C                     MOVELBGWDPR    WUWDPR           Window Processing Req
     C                     MOVELBGSARP    WUSARP           SAR's Processing Req
     C                     MOVELBGFRIN    WUFRIN           French Return Ind
     C                     MOVELBGLRIN    WULRIN           Lux Return Ind
     C                     MOVELBGDRIN    WUDRIN           Dutch Return Ind
     C                     MOVELBGGRIN    WUGRIN           German Return Ind
     C                     MOVELBGBRIN    WUBRIN           Belgian Return Ind
     C                     MOVELBGIRIN    WUIRIN           Italian Return Ind
     C                     MOVELBGSWEI    WUSWEI           SWIFT External Intfce
     C                     MOVELBGPFMG    WUPFMG           Portfolio Management
     C                     MOVELBGCRMG    WUCRMG           Credit Management
     C                     MOVELBGHORP    WUHORP           H.O. Reporting
     C                     MOVELBGAVBL    WUAVBL           Average Balances
     C                     MOVELBGMARG    WUMARG           Margins
     C                     MOVELBGNTST    WUNTST           Taxes          S01413
     C                     MOVELBGNXST    WUNXST           Retail 3       S01413
     C                     MOVELBGNYST    WUNYST           Int on A/C 3   S01413
     C*
     C                     MOVEL'N'       WUDNIT           Display no of i
      * CASE: WRK.Retail 3 is Yes
     C           WUNXST    IFEQ 'Y'                        *IF
      * Get Chrg for mult trans - Standard functions  *
     C                     CALL 'SD9343'               90  Get Chrg for mu
     C           W0RTN     PARM W0RTN     WQ0005  7        *Return code
     C           WUCHMT    PARM *BLANK    WQ0006  1        Charge for Mult
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: WRK.Charge for Mult Transacts is Yes
     C           WUCHMT    IFEQ 'Y'                        *IF
     C                     MOVEL'Y'       WUDNIT           Display no of i
     C                     END                             *FI
     C                     END                             *FI
      * end S01413
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     CSR         ZZEXIT    ENDSR
      /EJECT                                                                                BUG24339
     CSR         RDSFL     BEGSR                                                            BUG24339
      *                                                                                     BUG24339
      *                                                                                     BUG24339
     C                     Z-ADD*ZERO     CNTR    50                                        BUG24339
     C                     MOVE 'N'       CNTER   1                                         BUG24339
     C           1         DO   ##RRMX                                                      BUG24339
      *                                                                                     BUG24339
     C                     ADD  1         CNTR                                              BUG24339
     C           CNTR      CHAIN#SFLRCD              93                                     BUG24339
     C           *IN93     IFEQ '0'                                                         BUG24339
     C                     SETOF                     95                                     BUG24339
     C           #SELXT    IFEQ 'Y'                                                         BUG24339
      *                                                                                     BUG24339
     C           KLADIN    KLIST                                                            BUG24339
     C                     KFLD           #1PTDT           Posting Date                     BUG24339
     C                     KFLD           #1BTNB           Batch number                     BUG24339
     C                     KFLD           #1BINB           Batch item no.                   BUG24339
     C/COPY OFCPYSRCZ,CGL135_039                                                            MD024552
      * CALL PROGRAMS                                                                       BUG24339
     C                     MOVE *BLANKS   BAADI1                                           BUG24339A
     C                     MOVE *BLANKS   BAADI2                                           BUG24339A
     C                     MOVE *BLANKS   BAADI3                                           BUG24339A
     C                     MOVE *BLANKS   BAADI4                                           BUG24339A
     C                     MOVE *BLANKS   BAADI5                                           BUG24339A
     C                     MOVE *BLANKS   BAADI6                                           BUG24339A
     C                     MOVE *BLANKS   BAAERI                                           BUG24339A
      *                                                                                    BUG24339A
     C           CER031    IFEQ 'Y'                                                        BUG24339A
     C           KLADIN    CHAINGLJENXD0             93                                     BUG24339
     C           *IN93     IFEQ *ON                                                        BUG24339A
     C           KLADIN    CHAINGLJEHXD0             93                                    BUG24339A
      *                                                                                    BUG24339A
     C           *IN93     IFEQ *OFF                                                       BUG24339A
     C                     MOVE HAPTDT    BAPTDT                                           BUG24339A
     C                     MOVE HABTNB    BABTNB                                           BUG24339A
     C                     MOVE HABINB    BABINB                                           BUG24339A
     C                     MOVE HAADI1    BAADI1                                           BUG24339A
     C                     MOVE HAADI2    BAADI2                                           BUG24339A
     C                     MOVE HAADI3    BAADI3                                           BUG24339A
     C                     MOVE HAADI4    BAADI4                                           BUG24339A
     C                     MOVE HAADI5    BAADI5                                           BUG24339A
     C                     MOVE HAADI6    BAADI6                                           BUG24339A
     C                     MOVE HAAERI    BAAERI                                           BUG24339A
     C                     ENDIF                                                           BUG24339A
      *                                                                                    BUG24339A
     C                     ENDIF                                                           BUG24339A
      *                                                                                    BUG24339A
     C                     ENDIF                                                           BUG24339A
      *                                                                                     BUG24339
     C           CER030    IFEQ 'Y'                                                         BUG24339
     C           KLADIN    CHAINGLMNARD0             94                                     BUG24339
     C                     ENDIF                                                            BUG24339
      *                                                                                     BUG24339
     C           *IN93     IFEQ '0'                                                         BUG24339
     C           CER031    ANDEQ'Y'                                                        BUG24339A
     C           *IN94     OREQ '0'                                                         BUG24339
     C           CER030    ANDEQ'Y'                                                         BUG24339
     C                     CALL 'GL000185'                                                  BUG24339
     C                     PARM *BLANKS   PRTCD   7                                         BUG24339
     C                     PARM           PDETLS                                            BUG24339
     C                     PARM *BLANK    PADD    1                                         BUG24339
     C                     PARM 'E'       PMODE   1                                         BUG24339
     C                     PARM '0'       PEXIT   1                                         BUG24339
     C                     PARM '0'       PCANC   1                                         BUG24339
     C                     PARM           PVBIPX                                            BUG24339
     C                     PARM 'N'       APIMOD  1                                         BUG24339
     C                     PARM           FLDNMA                                            BUG24339
     C                     PARM           MSGIDA                                            BUG24339
     C                     PARM           MSGDTA                                            BUG24339
      *                                                                                     BUG24339
     C           PCANC     IFEQ '1'                                                         BUG24339
     C                     MOVE *BLANKS   #SELXT                                            BUG24339
     C                     UPDAT#SFLRCD                                                     BUG24339
     C                     LEAVE                                                            BUG24339
     C                     ENDIF                                                            BUG24339
      *                                                                                     BUG24339
     C           PEXIT     IFEQ '1'                                                         BUG24339
     C                     EXSR ZXEXPG                                                      BUG24339
     C                     ENDIF                                                            BUG24339
      *                                                                                     BUG24339
     C                     ENDIF                                                            BUG24339
      *                                                                                     BUG24339
     C           CER030    IFEQ 'Y'                                                         BUG24339
      *                                                                                     BUG24339
     C           *IN94     IFEQ '0'                                                         BUG24339
     C           *IN93     OREQ '0'                                                         BUG24339
     C                     CALL 'GL000186'                                                  BUG24339
     C                     PARM *BLANKS   PRTCD                                             BUG24339
     C                     PARM           PDETLS                                            BUG24339
     C                     PARM #1PTDT    PDATE   50                                        BUG24339
     C                     PARM *BLANKS   PADD                                              BUG24339
     C                     PARM 'E'       PMODE                                             BUG24339
     C                     PARM '0'       PEXIT                                             BUG24339
     C                     PARM '0'       PCANC                                             BUG24339
     C                     PARM           FLDNMA                                            BUG24339
     C                     PARM           MSGIDA                                            BUG24339
     C                     PARM           MSGDTA                                            BUG24339
     C                     ENDIF                                                            BUG24339
      *                                                                                     BUG24339
     C           PCANC     IFEQ '1'                                                         BUG24339
     C                     MOVE *BLANKS   #SELXT                                            BUG24339
     C                     UPDAT#SFLRCD                                                     BUG24339
     C                     LEAVE                                                            BUG24339
     C                     ENDIF                                                            BUG24339
      *                                                                                     BUG24339
     C           PEXIT     IFEQ '1'                                                         BUG24339
     C                     EXSR ZXEXPG                                                      BUG24339
     C                     ENDIF                                                            BUG24339
      *                                                                                     BUG24339
     C           *IN93     IFEQ '1'                                                         BUG24339
     C           CER031    ANDEQ'Y'                                                        BUG24339A
     C           CER030    ANDEQ'Y'                                                         BUG24339
     C           *IN94     ANDEQ'1'                                                         BUG24339
     C********** *IN93     OREQ '1'                                               BUG24339 BUG24339A
     C********** CER030    ANDEQ'N'                                               BUG24339 BUG24339A
     C           CNTER     IFEQ 'N'                                                         BUG24339
     C                     MOVE 'Y'       CNTER                                             BUG24339
     C                     MOVELEMSG,1    ZAMSDA                                            BUG24339
     C                     MOVEL'GLX0369' ZAMSID                                            BUG24339
     C                     EXSR ZASNMS                                                      BUG24339
     C                     ENDIF                                                            BUG24339
     C                     SETON                     95                                     BUG24339
     C                     ENDIF                                                            BUG24339
     C                     ENDIF                                                            BUG24339
      *                                                                                     BUG24339
     C                     ELSE                                                             BUG24339
     C           #SELXT    IFNE *BLANKS                                                     BUG24339
     C                     MOVELEMSG,2    ZAMSDA                                            BUG24339
     C                     MOVEL'GLX0369' ZAMSID                                            BUG24339
     C                     EXSR ZASNMS                                                      BUG24339
     C                     SETON                     95                                     BUG24339
     C                     ENDIF                                                            BUG24339
     C                     ENDIF                                                            BUG24339
     C  N95                MOVE *BLANKS   #SELXT                                            BUG24339
     C                     UPDAT#SFLRCD                                                     BUG24339
     C                     ENDIF                                                            BUG24339
      *                                                                                     BUG24339
     C                     ENDDO                                                            BUG24339
      *                                                                                     BUG24339
     C                     ENDSR                                                            BUG24339
      *                                                                   CEU013
      /EJECT                                                              CEU013
      *****************************************************************   CEU013
      *                                                               *   CEU013
      * *PSSR  - Program exception error routine                      *   CEU013
      *                                                               *   CEU013
      * Called by: (**calling routines**)                             *   CEU013
      *                                                               *   CEU013
      * Calls: None                                                   *   CEU013
      *                                                               *   CEU013
      ************ CALL DBERRCTL IF INTERACTIVE PROGRAM ***************   CEU013
      *                                                               *   CEU013
      *****************************************************************   CEU013
      *                                                                   CEU013
     C           *PSSR     BEGSR                           ** *PSSR SR ** CEU013
      *                                                                   CEU013
     C           @RUN      IFEQ *BLANK                                    CEU013
     C                     MOVE 'Y'       @RUN    1                       CEU013
     C                     DUMP                                           CEU013
      *                                                                   CEU013
     C                     CALL 'DBERRCTL'                                CEU013
      *                                                                   CEU013
     C                     END                                            CEU013
      *                                                                   CEU013
      ************ END PROGRAM IF DBERRCTL NOT CALLED ********************CEU013
     C                     SETON                     U7U8LR               CEU013
     C                     RETRN                                          CEU013
     C                     ENDSR                                          CEU013
**   EMSG - ERROR MESSAGE
Additional Information not found
Option must be 'Y'
** CPY@
(c) Finastra International Limited 2001
