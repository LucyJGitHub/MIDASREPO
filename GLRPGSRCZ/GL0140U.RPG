     H            Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Load interface header to GL')
     H/TITLE Create Journal Header From Interface File
     F*****************************************************************
     F*                                                               *
     F*  Midas  GENERAL LEDGER MODULE                                 *
     F*                                                               *
     F*   GL0140U - CREATE JOURNAL HEADER FROM INTERFACE FILE         *   S01251
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CSC024             Date 07Feb05               *
      *  Prev Amend No. BUG2798            Date 26May04               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 206564             Date 28Aug02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 09Nov01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 186206             Date 26Oct00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 178093             Date 03May00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CGL008             Date 04Mar99               *
      *                 067839             Date 14Mar94               *
      *                 S01340             Date 21Feb92               *
     F*                S01199                DATE 02MAY90             *
     F*                S01251                DATE 09FEB90             *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CSC024 - Open Month End (Recompile)                          *
      *  BUG2798 - Make sure GLBTNOPD is updated.                     *
      *  206564 - Commit GLBTNOPD so that when adding a batch and     *
      *           F3 is pressed, the batch number will not be         *
      *           written. Applied 206736.                            *
      *  CPK014 - Release 4 packaging:                                *
      *           - A default timestamp string is required for        *
      *             file GLJENHL0 write.                              *
      *  186206 - Journal Entry API fixes. Produce only one dump      *
      *           per JE batch. Generate JE Valid errors report.      *
      *           Prevent record locking error in JE database         *
      *           updater.                                            *
      *  178093 - This program should have been recompiled over the   *
      *           database changes introduced at DBA3.02.             *
      *  CGL008 - Security on Journal Entry.                          *
     F*   067839 - DEFAULT TYPE OF JOURNAL ENTRY TO 'I'               *
     F*   CREATED FOR SAR S01234. GL TEMPLATE ENHANCEMENTS            *
     F*                                                               *
     F*   S01340 - RECOMPILED FOR MIS RELEASE 10                      *
     F*   S01199 - RECOMPILED FOR CURSOR SENSITIVE HELP               *
     F*   S01234 - BATCH NUMBER & TEMPLATE BATCH NUMBER USED AS       *
     F*            CHARACTER                                          *
     F*                                                               *
     F*   S01251 - PROGRAM AND FIELD NAME CHANGES                     *
     F*                                                               *
     F********************************************************************
     F*  P R O G R A M     C R E A T I O N     P A R A M E T E R S    *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F************GLBTIFL1IF  E           K        DISK                   S01251
     FGLJEIHL1IF  E           K        DISK                               S01251
      * RTV: GL Batch Header Interface File   Retrieval index
      *
     F************GLBRREL0O   E           K        DISK          A        S01251
     FGLJENHL0O   E           K        DISK                      A        S01251
     F                                              KCOMIT
      * UPD: GL Batch header           Update index
      *
      ** Today's batch numbers used                                       186206
     FGLBTNOPDO   E                    DISK                               186206
     F                                              KCOMIT                                    206564
      *                                                                   186206
     F/COPY WNCPYSRC,GL0140UF01
     E                    CPY@    1   1 80               Copyright     array
      *                                                                                       CPK014
     E                    STAMP   1   1 26                                                    CPK014
      ** Array containing dummy timestamp                                                     CPK014
      /EJECT
      * Data structures:-
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
      *                                                                   CGL008
     IZMUSER      DS                                                      CGL008
     I                                        1  10 USID                  CGL008
     I                                       11  13 UDBC                  CGL008
     I                                       14  16 UDDP                  CGL008
     I                                       17  17 UBLA                  CGL008
      *                                                                   CGL008
     I/COPY WNCPYSRC,GL0140UI01
      /EJECT
      *****************************************************************   S01234
     C********** *ENTRY    PLIST                           Entry parameter 01234
     C*******************  PARM           P0RTN   7        Return code    S01234
     C*******************  PARM           P@IFBN  30       I/Face Batch No 01234
     C*******************  PARM           P@BHNO  30       ADD Batch No   S01234
      *****************************************************************   S01234
     C           *ENTRY    PLIST                           Entry parameter 01234
     C                     PARM           P0RTN   7        Return code    S01234
     C                     PARM           P@IFBN  3        I/Face Batch NoS01234
     C                     PARM           P@BHNO  3        ADD Batch No   S01234
      *****************************************************************   S01234
      *                                                                   CGL008
      **  Access SAR details file to see if CGL008 SAR is installed.      CGL008
      *                                                                   CGL008
     C                     CALL 'AOSARDR0'                                CGL008
     C                     PARM *BLANKS   @RTCD   7                       CGL008
     C                     PARM '*VERIFY' @OPTN   7                       CGL008
     C                     PARM 'CGL008'  @SARD   6                       CGL008
      *                                                                   CGL008
     C           @RTCD     IFEQ *BLANK                                    CGL008
     C                     MOVE 'Y'       CGL008  1                       CGL008
      *                                                                   CGL008
      ** Access data area ZMUSER.                                         CGL008
      *                                                                   CGL008
     C           *NAMVAR   DEFN           ZMUSER                          CGL008
     C                     IN   ZMUSER                                    CGL008
     C                     MOVE USID      GEUSER 10                       CGL008
      *                                                                   CGL008
     C                     ELSE                                           CGL008
     C                     MOVE 'N'       CGL008                          CGL008
     C                     END                                            CGL008
      *                                                                   CGL008
      ***Access*SAR*details*file*to*see*if*CAP032*SAR*is*installed.****************   186206 BUG2798
      **********                                                                      186206 BUG2798
     C**********           CALL 'AOSARDR0'                                            186206 BUG2798
     C**********           PARM *BLANKS   @RTCD                                       186206 BUG2798
     C**********           PARM '*VERIFY' @OPTN                                       186206 BUG2798
     C**********           PARM 'CAP032'  @SARD                                       186206 BUG2798
      **********                                                                      186206 BUG2798
     C********** @RTCD     IFEQ *BLANK                                                186206 BUG2798
     C**********           MOVE 'Y'       CAP032  1                                   186206 BUG2798
     C**********           ELSE                                                       186206 BUG2798
     C**********           MOVE ' '       CAP032                                      186206 BUG2798
     C**********           ENDIF                                                      186206 BUG2798
      *                                                                               186206 BUG2798
     C/COPY WNCPYSRC,GL0140UC01
     C*
     C* Locate Interface Header Record using I/Face Batch Number
     C*
     C           P@IFBN    CHAIN@BRREAH              89
     C*
     C           *IN89     IFEQ '0'                        .IF 1
     C*                                                    ¦
     C* Once Interface Header Record found Write it to GL Batch Header File
     C* with ADD Batch Number as key to the record.
     C*                                                    ¦
     C* NB: The check to see if it already exist within the Header File is
     C*     Carried out within the Synon Program GLHWDFR before this
     C*     Program is called.
     C*                                                    ¦
     C******************** Z-ADDP@BHNO    BRJDNB           ¦              S01234
     C******************** MOVE P@BHNO    BRJDNB           ¦              S01251
     C                     MOVE P@BHNO    BRBTNB           ¦              S01251
     C                     MOVE 'I'       BRTOJE           ¦              067839
      *                                                                   CGL008
      ** If CGL008 is ON, set new field BRUSRI = User id from ZMUSER      CGL008
      *                                                                   CGL008
     C           CGL008    IFEQ 'Y'                                       CGL008
     C                     MOVELGEUSER    BRUSRI                          CGL008
     C                     ENDIF                                          CGL008
      *                                                                   186206
      ***If*Journal*Entry*API*is*on,*write*batch*to********************************   186206 BUG2798
      ** Today's batch numbers used file.                                 186206
      *                                                                   186206
     C********** CAP032    IFEQ 'Y'                                                   186206 BUG2798
     C                     MOVELBRBTNB    B3BTNB                          186206
     C                     MOVEL'N'       B3DUMP                          186206
     C                     WRITEGLBTNOD0               60                 186206
     C**********           ENDIF                                                      186206 BUG2798
      *                                                                   CGL008
     C                     MOVEASTAMP,1   BRTMST           Default Timestamp                  CPK014
      *                                                                                       CPK014
     C                     WRITE@BRREAG                11  ¦
     C*                                                    ¦
     C/COPY WNCPYSRC,GL0140UC02
     C                     END                             'FI 1
     C*
     C                     SETON                         LR
     C*
** CPY@
(c) Misys International Banking Systems Ltd. 2001
** STAMP - Dummy timestamp                                                                    CPK014
0001-01-01-00.00.00.000000                                                                    CPK014
