     H            Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Spread journal header maintenance')           *
      *****************************************************************
      *                                                               *
      *  Midas - General Ledger Module                                *
      *                                                               *
      *  GL0163R - Midas GL Spread journal header maintenance         *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. CGL148             Date 13Jul18               *
      *                 MD050992           Date 26Jun18               *
      *                 MD046248           Date 27Oct17               *
      *                 MD027587           Date 19Jun14               *
      *                 MD026748           Date 09May13               *
      *                 AR782538           Date 03Jun11               *
      *                 AR787620           Date 10Jun11               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 237508             Date 18Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSC024             Date 07Feb05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG2798            Date 26May04               *
      *                 CLE025             Date 20Oct03               *
      *                 CRE020             Date 20Jan04               *
      *                 CGL029             Date 01Sep03               *
      *                 216891             Date 13May03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 206564             Date 28Aug02               *
      *                 191175             Date 17Apr02               *
      *                 189519             Date 27Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      *                 CPK014             Date 09Nov01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 186206             Date 26Oct00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CAP032             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01Mar99               *
      *                 CGL008             Date 04Mar99               *
      *                 CTI002             Date 23Sep08               *
     F*                 S01408             DATE 13AUG98               *
     F*                 CAC001             DATE 01FEB96               *
     F*                 S01408             DATE 03FEB95               *
     F*                 S01408             DATE 22AUG94               *
     F*                 E38270           Date 16JUN92                 *
     F*                                                               *
     F*****************************************************************
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *           (Recompile)                                         *
      *  CGL148 - Automatic Opening of GL accounts                    *
      *         - Includes fix MD028234                               *
      *  MD050992 - SP17: General Ledger Errors CLE051 Switched OFF   *
      *  MD046248 - Finastra Rebranding                               *
      *  MD027587 - Unable to used the C for Copy and T for Template  *
      *             (Recompile)                                       *
      *  MD026748 - Missing narrative and value date in Spread        *
      *             Journal Entry template. During amend, populate    *
      *             narrative and value date field on screen based on *
      *             the details saved in GLJENPPD.                    *
      *  AR782538 - Misleading warning message issued when accnt is   *
      *             closed. Changed to more appropriate message       *
      *             (Child: AR782539)                                 *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,GLH00298                                 *
      *             WNCPYSRC,GLH00299                                 *
      *             WNCPYSRC,GLH00300                                 *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  237508 - Issue warning message if account is flagged for     *
      *           closure.                                            *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSC024 - Open Month End (Recompile)                          *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG2798 - Make sure GLBTNOPD is updated.                     *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  216891 - Supplement to 206564 - clear program message queue. *
      *  206564 - Commit GLBTNOPD so that when adding a batch and     *
      *           F3 is pressed, the batch number will not be         *
      *           written. Applied 206736.                            *
      *  191175 - CGL008 modification. User cannot authorise the      *
      *           batch if any amendment was made and the user        *
      *           authority level is 'Z'.                             *
      *  189519 - Can't insert multibranch batch without authority to *
      *           action code 'A'. Added P2SACD to the parameters     *
      *           passed whenever GL0182M is called by the program.   *
      *  CPK014 - Release 4 packaging:                                *
      *           - A default timestamp string is required for        *
      *             file GLJENHL0 write.                              *
      *  186206 - Journal Entry API fixes. Produce only one dump      *
      *           per JE batch. Generate JE Valid errors report.      *
      *           Prevent record locking error in JE database         *
      *           updater.                                            *
      *  CAP032 - Conversion of Journal Batch Entry inputs into       *
      *           modular structure to use as APIs.                   *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CGL008 - Security on Journal Entry.                          *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  S01408 - Add Windows processing to program                   *
     F*  CAC001 - Profit Centre Accounting Development:               *
     F*           For 'FROM ACCOUNT' processing, Profit Centre should *
     F*           be the Profit Centre of the account for Retail and  *
     F*           Nostro accounts.  For 'TO ACCOUNT' processing,      *
     F*           use of Retail or Nostro accounts are prohibited.    *
     F*  S01408 - Hook GL0163RCAU added.                              *
     F*  S01408 - Hook GL0163RCP1 added.                              *
     F*           Hook GL0163RCP2 added.                              *
     F*           Hook GL0163RCP3 added.                              *
     F*           Hook GL0163RCP4 added.                              *
     F*           Hook GL0163RCP5 added.                              *
     F*  E38270 - DO NOT DISPLAY BRANCH IF MBIN IS 'N'                *
     F*                                                               *
     F*****************************************************************
     FGL0163R#CF  E                    WORKSTN
     F                                              KINFDS INFDS#
      * DSP: Midas GL Edit Spread Journal Hdr
      *
     FGLJENHL1IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RTV : Midas GL Journal Entry Header LF Rtv
      *
     FGLSPHDL1IF  E           K        DISK
      * RTV : Midas GL Spread Profile Header Retrieval
      *
     FGLJENHL0UF  E           K        DISK                      A    UC
     F                                              KCOMIT
      * UPD : Midas GL Journal Entry Header Update
      *                                                                   186206
      ** Today's batch numbers used                                       186206
     FGLBTNOPDO   E                    DISK                               186206
     F                                              KCOMIT                                    206564
      *                                                                   186206
     FREADVCL1O   E                    DISK         KCOMIT            UC                      CRE020
      ** Midas RE Settled Transaction Index File by Ref No/Pgm Ref                            CRE020
      *                                                                                       CRE020
     FGLJENPL1IF  E           K        DISK                                                   CRE020
      ** Midas GL Journal Entry Posting by Batch No/Item No                                   CRE020
      *                                                                                       CRE020
     F/COPY WNCPYSRC,GL0163RF01
      *
     E                    CPY@    1   1 80               Copyright     array
     E* Define Footer For Display File
     E*
     E                    LNE     1   1 78
     E*
      *                                                                                       CPK014
     E                    STAMP   1   1 26                                                    CPK014
      ** Array containing dummy timestamp                                                     CPK014
     I*
     I*   Define MIDAS Rundate from data-area RUNDAT
     I*
     I* Define Data area MUSER                                         ***
     I*                                                                ***
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSGLJENHL0
      * Current/previous master file format fields for change control
      *
     I***#1DBRC**    DS                            156                    CGL008
     I***#1DBRC**    DS                            176             CGL008 CAP032
     I***#1DBRC*     DS                            244                                 CAP032 CGL029
     I#1DBRC      DS                            256                                           CGL029
      * Stored master file format fields
     I                                        1   1 #1DB1
      *
     I            DS
      * Determine Account identity
     I                                        1  10 UKACID
     I                                        1   6 UKACF6
     I                                        1   3 UKACF3
     I                                        1   1 UKACF1
     I                                        1   1 UKACA1
     I                                        2   2 UKACA2
     I                                        3   3 UKACA3
     I                                        4   5 UKACM2
     I                                        6  10 UKACL5
     I                                        7  10 UKACL4
      * Set up parameters :
     I            DS
     I                                        1   30UMVAL2
     I                                        1   99UMVALD
      * Set up parameters :
     I            DS
     I                                        1   60UUDNUM
     I            DS
     I                                        1   60UUDNMA
      * Outward parameters
     I***PARC***     DS                            156                                        CGL029
     IPARC        DS                            176                                           CGL029
      * RCD : Midas GL Journal Entry Header LF Rtv
      * I : MAP Batch number
     I                                        1   3 PABTNB
      * I : MAP Branch Code - Alpha
     I                                        4   6 PABCDA
      * I : MAP Dept Code
     I                                        7   9 PADPCD
      * I : MAP Workstation id.
     I                                       10  19 PAWSID
      * B : MAP Hash integer calculated
     I                                    P  20  270PAHICC
      * B : MAP Hash decimal calculated
     I                                    P  28  290PAHDCC
      * B : MAP Hash item no.calculated
     I                                    P  30  310PAHINC
      * B : MAP Hash integer input
     I                                    P  32  390PAHIIN
      * B : MAP Hash decimal input
     I                                    P  40  410PAHDIN
      * B : MAP Hash item no.input
     I                                    P  42  430PAHINI
      * B : MAP Batch status flag
     I                                       44  44 PABTSF
      * I : MAP Batch in use flag
     I                                       45  45 PABIUF
      * I : MAP Shadow post indicator
     I                                       46  46 PASHPI
      * I : MAP Retail advice print ind.
     I                                       47  47 PARAPI
      * I : MAP Multiple Branch Batch
     I                                       48  48 PAMBRB
      * I : MAP Reversal / Void Indicator
     I                                       49  49 PARVVD
      * I : MAP Batch Description
     I                                       50  79 PABDES
      * I : MAP Spread Total
     I                                    P  80  850PASPTT
      * I : MAP Spread Profile Code
     I                                       88  91 PASPRF
      * I : MAP Debit/credit indicator
     I                                       92  92 PADCIN
      * I : MAP Input Branch Cd  Alloc Fm
     I                                       93  95 PAIBCF
      * I : MAP Customer Number  Alloc Fm
     I                                       96 101 PACUSF
      * I : MAP Currency Code    Alloc Fm
     I                                      102 104 PACYCF
      * I : MAP Account Code     Alloc Fm
     I**********                            105 108 PAACCF                                    CGL029
     I                                      105 108 PAQQCF                                    CGL029
      * I : MAP Account Seq No.  Alloc Fm
     I                                      109 110 PAACSF
      * I : MAP Nostro No. (Item)Alloc Fm
     I                                      111 112 PANNBF
      * I : MAP Retail A/c No.   Alloc Fm
     I                                    P 113 1180PARACF
      * I : MAP Profit Centre    Alloc Fm
     I                                      119 122 PAPRCF
      * I : MAP Input Branch Cd  Alloc To
     I                                      130 132 PAIBCT
      * I : MAP Currency Code    Alloc To
     I                                      133 135 PACYCT
      * I : MAP Customer Number  Alloc To
     I                                      136 141 PACNAT
      * I : MAP Account Code     Alloc To
     I**********                            142 145 PAACCT                                    CGL029
     I                                      142 145 PAQQCT                                    CGL029
      * I : MAP Account Seq No.  Alloc To
     I                                      146 147 PAASNT
      * I : MAP Nostro No. (Item)Alloc To
     I                                      148 149 PANNBT
      * I : MAP Retail A/c No.   Alloc To
     I                                    P 150 1550PARACT
      *                                                                                       CGL029
      ** MAP New Account Code (Alloc From)                                                    CGL029
     I                                      157 166 PAACCF                                    CGL029
      *                                                                                       CGL029
      ** MAP New Account Code (Alloc To)                                                      CGL029
     I                                      167 176 PAACCT                                    CGL029
      *
      * Outward parameters
     IPBRC        DS                            156
      * RCD : Midas GL Journal Entry Header LF Rtv
      * I : RST Batch number
     I                                        1   3 PBBTNB
      * I : MAP Branch Code - Alpha
     I                                        4   6 PBBCDA
      * I : MAP Dept Code
     I                                        7   9 PBDPCD
      * I : MAP Workstation id.
     I                                       10  19 PBWSID
      * I : MAP Hash integer calculated
     I                                    P  20  270PBHICC
      * I : MAP Hash decimal calculated
     I                                    P  28  290PBHDCC
      * I : MAP Hash item no.calculated
     I                                    P  30  310PBHINC
      * B : MAP Hash integer input
     I                                    P  32  390PBHIIN
      * B : MAP Hash decimal input
     I                                    P  40  410PBHDIN
      * B : MAP Hash item no.input
     I                                    P  42  430PBHINI
      * I : MAP Batch status flag
     I                                       44  44 PBBTSF
      * I : MAP Batch in use flag
     I                                       45  45 PBBIUF
      * I : MAP Shadow post indicator
     I                                       46  46 PBSHPI
      * I : MAP Retail advice print ind.
     I                                       47  47 PBRAPI
      * I : MAP Multiple Branch Batch
     I                                       48  48 PBMBRB
      * I : MAP Reversal / Void Indicator
     I                                       49  49 PBRVVD
      * I : MAP Batch Description
     I                                       50  79 PBBDES
      *
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
     IUUFDY     E DSDSFDY
     I*
     I* 200 Byte Data Structure for Incoming Data from Access Program
     I*
     IUUSDY     E DSDSSDY
     I*
     I* 800 Byte Data Structure for Incoming Data from Access Program
     I*
     ID@ACOD    E DSSDACODPD
     I*
     I*  Account Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@ACCT    E DSACCNTAB
     I*
     I*  Account Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@BRCH    E DSSDBRCHPD
     I*
     I*  Branch Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@CUST    E DSSDCUSTPD
     I              QQDFAC                          QQDFA1                                    CGL029
     I*
     I*  Client Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@CURR    E DSSDCURRPD
     I*
     I*  Currency Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@DEPT    E DSSDDEPTPD
     I*
     I*  Department Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@NOST    E DSSDNOSTPD
     I              QQACCD                          QQACC1                                    CGL029
     I*
     I*  Nostro Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@PRFC    E DSSDPRFCPD
     I*
     I*  Profit Centre DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@NARR    E DSSDNARRPD
     I*
     I*  Narrative Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     IP@BJRF    E DSSDBANKPD
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     ID@MMOD    E DSSDMMODPD                                              CAC001
      *                                                                   CAC001
      **  Midas Modules DS for assigning data from Access                 CAC001
      **  Programs to work fields                                         CAC001
      *                                                                   CAC001
     ID@PCAC    E DSSDPCACPD                                                                MD050992
     I              QQFNIC                          QQFNC1                                  MD050992
     I              QQFNAA                          QQFNA1                                  MD050992
      **  EXTERNAL DS FOR PROFIT CENTRE ACCOUNTING ICD                                      MD050992
      *                                                                                     MD050992
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNO
     I                                       11  11 SUCP
     I                                       12  12 DTFF
     I                                       13  13 MBIN
     I*
     IZMUSER      DS
     I                                        1  10 USID
     I                                       11  13 UDBC
     I                                       14  16 UDDP
     I                                       17  17 UBLA
      /EJECT
      * Parameter declarations
     IP1PARM      DS                              3
      * KEY: Midas GL Journal Entry Header LF Rtv
      * I : MAP Batch number
     I                                        1   3 P1BTNB
     IP2PARM      DS
      * I :  SPF Action Code
     I                                        1   1 P2SACD
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Branch Code not found'
      * Branch code
     I                                        1   3 ZA0001
      * Message data for 'SPF Atn Cde ERR 1 ZVACTBU'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0002
      * Message data for 'SPF Atn Cde ERR 5 ZVACTBU'
      * SPF Action Code
     I                                        1   1 ZA0003
      * Branch Code - Alpha
     I                                        2   4 ZA0004
      * Message data for 'Branch Code Required'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0005
      * Message data for 'Department Code Required'
      * Dept Code
     I                                        1   3 ZA0006
      * Message data for 'Department Code not found'
      * Dept Code
     I                                        1   3 ZA0007
      * Message data for 'Multiple Branch ind Error'
      * Multiple Branch Batch
     I                                        1   1 ZA0008
      * Message data for 'Multiple Branch Batch Inv'
      * Multiple Branch Batch
     I                                        1   1 ZA0009
      * Message data for 'Description is required'
      * Batch Description
     I                                        1  30 ZA0010
      * Message data for 'Sprd Cd or Total+No Items'
      * Spread Profile Code
     I                                        1   4 ZA0011
      * Spread Total - alpha
     I                                        5  15 ZA0012
      * Spread Items - alpha
     I                                       16  18 ZA0013
      * Message data for 'Sprd Cd or Total+No Items'
      * Spread Profile Code
     I                                        1   4 ZA0014
      * Spread Total - alpha
     I                                        5  15 ZA0015
      * Spread Items - alpha
     I                                       16  18 ZA0016
      * Message data for 'Spread Profile Header  NF'
      * Spread Profile Code
     I                                        1   4 ZA0017
      * Message data for 'No of Items  - Numeric'
      * No of Items - Screen
     I                                        1   3 ZA0018
      * Message data for 'Spread Total invalid'
      * Spread Total - alpha
     I                                        1  11 ZA0019
      * Message data for 'Sprd Cd or Total+No Items'
      * Spread Profile Code
     I                                        1   4 ZA0020
      * Spread Total - alpha
     I                                        5  15 ZA0021
      * Spread Items - alpha
     I                                       16  18 ZA0022
      * Message data for 'Sprd Cd or Total+No Items'
      * Spread Profile Code
     I                                        1   4 ZA0023
      * Spread Total - alpha
     I                                        5  15 ZA0024
      * Spread Items - alpha
     I                                       16  18 ZA0025
      * Message data for 'Currency Code not found'
      * Currency code
     I                                        1   3 ZA0026
      * Message data for 'Account Code not found'
      * Account code
     I**********                              1   4 ZA0027                                    CGL029
     I                                        1  10 ZA0027                                    CGL029
      * Message data for 'Branch Code not found'
      * Branch code
     I                                        1   3 ZA0028
      * Message data for 'Account Seq Numeric'
      * Account sequence number
     I                                        1   2 ZA0029
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0030
      * Currency code
     I                                       11  13 ZA0031
      * Account code
     I**********                             14  17 ZA0032                                    CGL029
     I                                       14  23 ZA0032                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0033                                    CGL029
     I                                       24  25 ZA0033                                    CGL029
      * Message data for 'A/c Allocated To/From inv'
      * Account Identifier
     I                                        1  10 ZA0034
      * Message data for 'Nost/Retail A/c not valid'
      * Account Identifier
     I                                        1  10 ZA0035
      * Message data for 'Customer not found'
      * Account Identifier
     I                                        1  10 ZA0036
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0037
      * Currency code
     I                                       11  13 ZA0038
      * Account code
     I**********                             14  17 ZA0039                                    CGL029
     I                                       14  23 ZA0039                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0040                                    CGL029
     I                                       24  25 ZA0040                                    CGL029
      * Message data for 'Account is Closed'
      * Account Identifier
     I                                        1  10 ZA0041
      * Currency code
     I                                       11  13 ZA0042
      * Account code
     I**********                             14  17 ZA0043                                    CGL029
     I                                       14  23 ZA0043                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0044                                    CGL029
     I                                       24  25 ZA0044                                    CGL029
      * Message data for 'SPF Atn Cde ERR 1 ZVACTBU'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0045
      * Message data for 'SPF Atn Cde ERR 5 ZVACTBU'
      * SPF Action Code
     I                                        1   1 ZA0046
      * Branch Code - Alpha
     I                                        2   4 ZA0047
      * Message data for 'Branch Code Required'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0048
      * Message data for 'Profit Centre required'
      * Profit Centre    Alloc Fm
     I                                        1   4 ZA0049
      * Message data for 'Profit Centre From invali'
      * Profit Centre    Alloc Fm
     I                                        1   4 ZA0050
      * Message data for 'Amount from a/c not valid'
      * Amount from
     I                                        1  14 ZA0051
      * Message data for 'Debit/Credit must be Y/N'
      * Debit/credit indicator
     I                                        1   1 ZA0052
      * Message data for 'Currency Code not found'
      * Currency code
     I                                        1   3 ZA0053
      * Message data for 'Account Code not found'
      * Account code
     I**********                              1   4 ZA0054                                    CGL029
     I                                        1  10 ZA0054                                    CGL029
      * Message data for 'Branch Code not found'
      * Branch code
     I                                        1   3 ZA0055
      * Message data for 'MBrch btch ind must be Y'
      * Input Branch Cd  Alloc To
     I                                        1   3 ZA0056
      * Message data for 'Account Seq Numeric'
      * Account sequence number
     I                                        1   2 ZA0057
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0058
      * Currency code
     I                                       11  13 ZA0059
      * Account code
     I**********                             14  17 ZA0060                                    CGL029
     I                                       14  23 ZA0060                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0061                                    CGL029
     I                                       24  25 ZA0061                                    CGL029
      * Message data for 'A/c Allocated To/From inv'
      * Account Identifier
     I                                        1  10 ZA0062
      * Message data for 'Nost/Retail A/c not valid'
      * Account Identifier
     I                                        1  10 ZA0063
      * Message data for 'Customer not found'
      * Account Identifier
     I                                        1  10 ZA0064
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0065
      * Currency code
     I                                       11  13 ZA0066
      * Account code
     I**********                             14  17 ZA0067                                    CGL029
     I                                       14  23 ZA0067                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0068                                    CGL029
     I                                       24  25 ZA0068                                    CGL029
      * Message data for 'Account is Closed'
      * Account Identifier
     I                                        1  10 ZA0069
      * Currency code
     I                                       11  13 ZA0070
      * Account code
     I**********                             14  17 ZA0071                                    CGL029
     I                                       14  23 ZA0071                                    CGL029
      * Account sequence number
     I**********                             18  19 ZA0072                                    CGL029
     I                                       24  25 ZA0072                                    CGL029
      * Message data for 'SPF Atn Cde ERR 1 ZVACTBU'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0073
      * Message data for 'SPF Atn Cde ERR 5 ZVACTBU'
      * SPF Action Code
     I                                        1   1 ZA0074
      * Branch Code - Alpha
     I                                        2   4 ZA0075
      * Message data for 'Branch Code Required'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0076
      * Message data for 'Narrative Code not found'
      * Narrative
     I                                        1  30 ZA0077
      * Message data for 'Value Date not valid 1'
      * Value date (display)
     I                                        1   6 ZA0078
      * Message data for 'Value Date not valid 2'
      * Value date (display)
     I                                        1   6 ZA0079
      * Message data for 'Loading Postings'
      * Batch number
     I                                        1   3 ZA0080
      * Message data for 'Loading Postings'
      * Batch number
     I                                        1   3 ZA0081
     I/COPY WNCPYSRC,GL0163RI02
      *                                                                   S01408
     I/COPY QWINDSRC,GL0163GDTA                                           S01408
      *                                                                   S01408
      *                                                                                       CRE020
     ILDA       E DSLDA                         256                                           CRE020
     I              SPARE                           SPARE2                                    CRE020
      ** Local Data Area for Database Error Details                                           CRE020
      *                                                                                       CRE020
     ISCSARD    E DSSCSARDPD                                                                  CRE020
     I              LCD                             LCD2                                      CRE020
      ** Switchable Feature Details Data Structure                                            CRE020
      *                                                                                       CRE020
     I              'JournalEntry'        C         JRNE                                      CRE020
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C                     PARM           P1PARM           KEY: Journal En
     C           P2SACD    PARM           WP0001  1        SPF Action Code
      *****************************************************************
      * Initialise
     C                     EXSR ZZINIT
      *
      * Check passed parameters
     C                     EXSR FACKPM
      * Perform once if all passed, else repeat
     C           W0RPT     DOUEQ'N'
      * Display and process key screen
     C                     EXSR BADSKY
     C                     END
      * Terminate program
     C                     EXSR ZXEXPG
      *****************************************************************
      /EJECT
     CSR         BADSKY    BEGSR
      *================================================================
      * Display and process key screen
      *================================================================
      * Initialise key screen
     C                     EXSR MDIZ#K
      *                                                                   186206
      ** If Journal Entry API is on and action is Insert                  186206
      ** write batch to Today's Batch number used file.                   186206
      *                                                                   186206
     C********** CAP032    IFEQ 'Y'                                                   186206 BUG2798
     C********** P2SACD    ANDEQ'I'                                                   186206 BUG2798
     C           P2SACD    IFEQ 'I'                                                          BUG2798
     C                     MOVELP1BTNB    B3BTNB                          186206
     C                     MOVEL'N'       B3DUMP                          186206
     C                     WRITEGLBTNOD0                                  186206
     C                     ENDIF                                          186206
      *                                                                   186206
      * Bypass first display of key screen is possible
     C                     MOVEL'Y'       W0BYP   1
      * Signal start of transaction
     C                     MOVEL'Y'       W0TRN   1
     C           W0TRN     DOWEQ'Y'
     C           W0TRN     OREQ 'R'
      * Ensure transaction continues (if reset)
     C                     MOVEL'Y'       W0TRN   1
      * Initialise detail screen
     C                     EXSR MAIZ#1
      * Conduct screen conversation
     C           W0TRN     DOWEQ'Y'
      * Is bypass key screen still viable?
     C           W0BYP     IFEQ 'Y'
     C           #1BTNB    IFEQ *BLANK                     Batch number
      * One or more key fields is blank
     C                     MOVEL'N'       W0BYP
     C                     END
     C                     END
      * Bypass key screen
     C           W0BYP     IFNE 'Y'
      * Display key screen
     C                     EXSR BBEXFM
     C                     END
      * Cancel key screen bypass
     C                     MOVEL'N'       W0BYP
      * Process response to key screen
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * Switch between *ADD/*CHANGE modes
     C   09                CAS            BCCHMD
      * HOME: Reset screen fields
     C   05                CAS            BDHMKY
      * Process key screen input
     C                     CAS            BEPRKY
     C                     END
      *
     C                     END
     C                     END
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBEXFM    BEGSR
      *================================================================
      * Display key screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GADSAK
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
      * PUTOVR unless conditioned fields change
     C                     SETON                         86*
     C           *IN89     IFNE BBIN89
     C                     SETOF                         86*
     C                     END
     C                     MOVE *IN89     BBIN89  1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#RCDKEY
     C                     MOVEL'N'       W0HLP   1
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1
      * Reset global error indicator
     C                     SETOF                         99*
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         BCCHMD    BEGSR
      *================================================================
      * Switch between *ADD/*CHANGE modes
      *================================================================
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'CHG'     W0PMD   3
     C                     ELSE
     C                     MOVEL'ADD'     W0PMD
     C                     END
      *================================================================
     CSR         BCEXIT    ENDSR
      /EJECT
     CSR         BDHMKY    BEGSR
      *================================================================
      * Process HOME key
      *================================================================
     C                     MOVEL'N'       W0TRN
      *================================================================
     CSR         BDEXIT    ENDSR
      /EJECT
     CSR         BEPRKY    BEGSR
      *================================================================
      * Process key screen input
      *================================================================
      * Validate key fields
     C                     EXSR BFVLKY
     C           *IN99     CABEQ'1'       BEEXIT
      * Check for existing record
     C           KRTV      KLIST
     C                     KFLD           BRBTNB           Batch number
      * Setup key
     C                     MOVEL#1BTNB    BRBTNB           Batch number
     C           KRTV      CHAIN@BRREAH              9091  *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     SETON                     9931  *
     C                     GOTO BEEXIT
     C                     END                             FI 91
      *
      * If record does not exist, flip to add mode
     C           *IN90     IFEQ '1'
     C                     MOVEL'ADD'     W0PMD
      * USER: Initialise detail screen (new record)
     C                     MOVEL##JOB     #1WSID           Workstation id.
     C                     MOVEL'N'       #1MBRB           Multiple Branch
      * Set Up Default Branch Code & Name
     C                     EXSR UASUBR                     Set Up Default
      * Set Up Default Department Code & Name
     C                     EXSR UBSUBR                     Set Up Default
      * Set Up Narrative field
     C                     EXSR UCSUBR                     Set Up Narrativ
      * Set Up Value date field
     C                     EXSR UDSUBR                     Set Up Value da
      * Set up Default A/c details
     C                     EXSR UESUBR                     Set up Default
     C                     ELSE
      * If record does exist, flip to change mode
     C                     MOVEL'CHG'     W0PMD
      * Load screen fields from DBF
     C                     EXSR MBFL#1
      * USER: Initialise detail screen (existing record)
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1BCDA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
     C                     MOVELWUBRNM    #DBNMD           Branch name (di
     C                     MOVEL#1MBRB    WUSMBI           Store Multiple
      * Set up condition for output of Branch
     C                     EXSR UFSUBR                     Set up conditio
      * Set up Department Code & Name
     C                     EXSR UGSUBR                     Set up Departme
      * Set up screen Spread Total & No. of Items to Spread to
      * CASE: DTL.Spread Profile Code is blank
     C           #1SPRF    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       WUSPCU           Spread Profile
      * Set up Spread Total - alpha on screen
      * CASE: DTL.Spread Total is not blank
     C           #1SPTT    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#1SPTT    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0005  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0006 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0007  10       ZALIGN No Of De
     C                     PARM 10        WQ0008  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0009 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0010 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0011  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * Zalign Spread Total - Journal Entry Header  *
      *****************************************************************
      *
      *  Zalign Spread Total entered
      *
      *  Last Amend No. XXXXX              Date xxXXXxx
      *
      *****************************************************************
      *
      *  XXXXXX - ddddddddddddddddddddddddddddddddddddddddd
      *
      *****************************************************************
     C                     MOVE WUZASF    #DSPTA
      * Set up No. of Items
      * CASE: DTL.No. of Items to Spread to is not zero
     C           #1NIST    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#1NIST    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0012  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0013 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0014  10       ZALIGN No Of De
     C                     PARM 3         WQ0015  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0016 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0017 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0018  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * Move Right No of Items - Journal Entry Header  *
     C                     MOVE WUZASF    #DGKCD
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'Y'       WUSPCU           Spread Profile
     C                     END                             *FI
      * Account Identifier From (screen)
     C                     EXSR UHSUBR                     Account Identif
      * Account Identifier To (screen)
     C                     EXSR UISUBR                     Account Identif
      * Set up Amount Alloc From
      * CASE: DB1.Amount           Alloc Fm is not blank
     C           BRAMTF    IFNE *ZERO                      *IF
      * Get no. of Decimal places
     C                     EXSR UJSUBR                     Get no. of Deci
     C                     Z-ADDWUNBDP    WUZNDE           ZALIGN No Of De
     C                     Z-ADD*ZERO     WUZSNI           ZSEDIT Numeric
     C                     MOVE BRAMTF    WUZSNI           ZSEDIT Numeric
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0163RCP5                                           S01408
     C*                                                                   S01408
      * ZSEDIT Screen Field - Standard functions  *
     C                     CALL 'ZSEDIT'               90  ZSEDIT Screen F
     C                     PARM WUZSNI    WQ0019 150       ZSEDIT Numeric
     C                     PARM WUZNDE    WQ0020  10       ZALIGN No Of De
     C                     PARM 'L'       WQ0021  1        ZSEDIT Edit Cod
     C           WUZSCO    PARM *BLANK    WQ0022 21        ZSEDIT Char Out
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0163RCP3                                           S01408
     C*                                                                   S01408
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Zalign Amount (amend) - Journal Entry Header  *
      *****************************************************************
      *
      *  Zalign Amount From entered (ZSEDIT)
      *
      *  Last Amend No. XXXXX              Date xxXXXxx
      *
      *****************************************************************
      *
      *  XXXXXX - ddddddddddddddddddddddddddddddddddddddddd
      *
      *****************************************************************
     C                     MOVE WUZSCO    #DGLCD
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DGLCD           Amount from
     C                     END                             *FI
      *                                                                                     MD026748
      ** Retrieve narrative and value date                                                  MD026748
      *                                                                                     MD026748
     C           BRBTNB    CHAINGLJENPL1             17                                     MD026748
      *                                                                                     MD026748
      * Set Up Narrative field
     C                     EXSR UKSUBR                     Set Up Narrativ
      * Set Up Value date field
     C                     EXSR ULSUBR                     Set Up Value da
     C                     END
      *..................................................
     C   99                GOTO BEEXIT
      * No error: Display and process details
     C                     EXSR CADSDA
      *
      *================================================================
     CSR         BEEXIT    ENDSR
      /EJECT
     CSR         BFVLKY    BEGSR
      *================================================================
      * Validate key fields
      *================================================================
     C           W0PMD     IFNE 'ADD'
      * Select existing record
     C                     EXSR VACKRL
     C                     END
      * Batch number required
     C           #1BTNB    IFEQ *BLANK                     IF
     C                     SETON                     9931  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         BFEXIT    ENDSR
      /EJECT
     CSR         CADSDA    BEGSR
      *================================================================
      * Display and process detail screen
      *================================================================
      * Conduct detail screen conversation
      * - repeat until screen control flag is reset:
     C           W0TRN     DOWEQ'Y'
      * Display detail screen
     C                     EXSR CBEXFM
      * Process response to detail screen
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * Redisplay previous screen
     C   12                CAS            CCDSPV
      * Process detail screen input
     C                     CAS            CFPRSC
     C                     END
      *
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         CBEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSAD
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
      * PUTOVR unless conditioned fields change
     C                     SETON                         86*
     C           *IN89     IFNE CBIN89
     C                     SETOF                         86*
     C                     END
     C                     MOVE *IN89     CBIN89  1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT2
      *                                                                                       191175
     C                     MOVE *BLANKS   W#BCDA  3                                           191175
     C                     MOVE *BLANKS   W#MBRB  1                                           191175
     C                     MOVE *BLANKS   W#IBCF  3                                           191175
     C                     MOVEL*BLANKS   W#IBCT  3                                           191175
     C                     MOVE *BLANKS   W#GLCD 14                                           191175
     C                     MOVE *BLANKS   W#NRTV 30                                           191175
     C                     MOVE *BLANKS   W#VDDS  6                                           191175
     C                     MOVE *BLANKS   W#DCIN  1                                           191175
      *                                                                                       191175
     C                     MOVE #1BCDA    W#BCDA                                              191175
     C                     MOVE #1MBRB    W#MBRB                                              191175
     C                     MOVE #1IBCF    W#IBCF                                              191175
     C                     MOVEL#1IBCT    W#IBCT                                              191175
     C                     MOVE #DGLCD    W#GLCD                                              191175
     C                     MOVE #DNRTV    W#NRTV                                              191175
     C                     MOVE #DVDDS    W#VDDS                                              191175
     C                     MOVE #1DCIN    W#DCIN                                              191175
     C                     MOVE 'N'       WHDCHG  1                                           191175
      *                                                                                       191175
     C/COPY WNCPYSRC,GL0163RC21
     C                     EXFMT#RCDDTL1
      *                                                                                       191175
     C           #1BCDA    IFNE W#BCDA                                                        191175
     C           #1MBRB    ORNE W#MBRB                                                        191175
     C           #1IBCF    ORNE W#IBCF                                                        191175
     C           #1IBCT    ORNE W#IBCT                                                        191175
     C           #DGLCD    ORNE W#GLCD                                                        191175
     C           #DNRTV    ORNE W#NRTV                                                        191175
     C           #DVDDS    ORNE W#VDDS                                                        191175
     C           #1DCIN    ORNE W#DCIN                                                        191175
     C                     MOVE 'Y'       WHDCHG                                              191175
     C                     ENDIF                                                              191175
      *                                                                                       191175
     C/COPY WNCPYSRC,GL0163RC22
     C                     MOVEL'N'       W0HLP   1
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1
      * Reset global error indicator
     C                     SETOF                         99*
     C           WWERF     IFEQ 'Y'                                                           CGL148
     C                     SETOF                     383940                                   CGL148
     C                     SETOF                     41                                       CGL148
     C                     ENDIF                                                              CGL148
     C           WWERT     IFEQ 'Y'                                                           CGL148
     C                     SETOF                     464748                                   CGL148
     C                     SETOF                     49                                       CGL148
     C                     ENDIF                                                              CGL148
      *================================================================
     CSR         CBEXIT    ENDSR
      /EJECT
     CSR         CCDSPV    BEGSR
      *================================================================
      * Redisplay previous screen
      *================================================================
     C                     MOVEL'R'       W0TRN
      *================================================================
     CSR         CCEXIT    ENDSR
      /EJECT
     CSR         CFPRSC    BEGSR
      *================================================================
      * Validate record
      *================================================================
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Validate details
     C                     EXSR DCVLDL
      * QUIT if error:
     C   99                GOTO CFEXIT
     C           WWERF     IFEQ 'Y'                                                           CGL148
     C           WWERT     OREQ 'Y'                                                           CGL148
     C                     GOTO CFEXIT                                                        CGL148
     C                     ENDIF                                                              CGL148
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       CFEXIT
      * No error: update record
     C                     EXSR EBPR##
      *================================================================
     CSR         CFEXIT    ENDSR
      /EJECT
     CSR         DCVLDL    BEGSR
      *================================================================
      * Validate details
      *================================================================
      * Validate Debit/credit indicator
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1DCIN    W0NSRQ  1        Debit/credit in
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'MIVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1107881   Y2LSNO  70
     C           #1DCIN    PARM #1DCIN    W0EXVL 20        Debit/credit in
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      * USER: Validate detail screen fields
     C                     MOVEL'P'       #1TOJE           Type of Journal
      * Validate Branch Code
     C                     EXSR UMSUBR                     Validate Branch
      * Validate Department Code
     C                     EXSR UOSUBR                     Validate Depart
      * Validate Multiple Branch Batch
     C                     EXSR UPSUBR                     Validate Multip
      * Batch Description is required
      * CASE: DTL.Batch Description is Blank
     C           #1BDES    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1BDES    ZA0010           Batch Descripti
      * Send message 'Description is required'
     C                     MOVEL'GLX0249' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9934  *
      *
     C                     END                             *FI
      * Check relations
      * USER: Validate detail screen relations
      * Check Spread Profile Code OR Spread Total(alpha) + No. of Items
     C                     EXSR UQSUBR                     Check Spread Pr
      * Validate Allocated From A/c
     C                     EXSR UTSUBR                     Validate Alloca
      * Validate Allocated From A/c
     C                     EXSR UUSUBR                     Validate Alloca
      * Validate Profit Centre From
      * CASE: DTL.Profit Centre    Alloc Fm is blank
     C           #1PRCF    IFEQ *BLANK                     *IF
      ** If CAC004 is installed, then use the 'Unallocated Profit                           MD050992
      ** Centre' defined on ICD                                                             MD050992
     C           CAC004    IFEQ 'Y'                                                         MD050992
     C                     MOVELFTUAPC    #1PRCF                                            MD050992
     C                     ELSE
      * Setup message data for message
     C                     MOVEL#1PRCF    ZA0049           Profit Centre
      * Send message 'Profit Centre required'
     C                     MOVEL'GLX0259' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
     C                     ENDIF                                                            MD050992
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: DTL.Profit Centre    Alloc Fm is select request
     C           #1PRCF    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access profit Centre - Profit Centres  *
     C*
     C*  Access Def centre code off file.
     C*
     C                     MOVEL#1PRCF    UUPCCD
     C                     CALL 'AOPRFCR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUPCCD  4        I:Profit Cent
     C           D@PRFC    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELDSPCCD    WUPCCD           Profit Centre
     C                     MOVELDSPCCD    WUPCDS           Prof Cent Desc
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1PRCF    ZA0050           Profit Centre
      * Send message 'Profit Centre From invali'
     C                     MOVEL'GLX0260' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9943  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUPCCD    #1PRCF           Profit Centre
     C                     END                             *FI
      *                                                                   CAC001
      **  If Analytical Accounting module on, Retail or Nostro From       CAC001
      **  Account's Profit Centre must be equal to entered Profit         CAC001
      **  Centre                                                          CAC001
      *                                                                   CAC001
     C           WUN0ST    IFEQ 'Y'                                       CAC001
     C           WUACTY    IFEQ 'R'                                       CAC001
     C           WUACTY    OREQ 'N'                                       CAC001
     C           #1PRCF    IFNE WUPRFC                                    CAC001
     C                     MOVEL'GLX0392' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     SETON                     9943                 CAC001
     C                     END                                            CAC001
     C                     END                                            CAC001
     C                     END                                            CAC001
     C                     END                             *FI
      * Validate Amount From
      * CASE: DTL.Amount from is blank
     C           #DGLCD    IFEQ *BLANK                     *IF
      * Send message 'Amnt from a/c not entered'
     C                     MOVEL'GLX0320' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Amount entered
      * Get no. of decimal places
      * CASE: DTL.Currency Code    Alloc Fm is not Question Mark
     C           #1CYCF    IFNE '?'                        *IF
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCF    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
      * Set up Number of Decimals and digits for zalign
     C                     EXSR UVSUBR                     Set up Number o
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DGLCD    WUZASF           ZALIGN Screen F
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0163RCP2                                           S01408
     C*                                                                   S01408
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0050  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0051 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0052  10       ZALIGN No Of De
     C                     PARM WUZNDI    WQ0053  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0054 16        ZALIGN File Fie
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0163RCP3                                           S01408
     C*                                                                   S01408
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0163RCP4                                           S01408
     C*                                                                   S01408
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0055 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0056  10       ZALIGN No Of De
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0163RCP3                                           S01408
     C*                                                                   S01408
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#DGLCD    ZA0051           Amount from
      * Send message 'Amount from a/c not valid'
     C                     MOVEL'GLX0321' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9944  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUZAFF    #1AMTF           Amount
      * Zalign Amount From - Journal Entry Header  *
      *****************************************************************
      *
      *  Zalign Amount From entered
      *
      *  Last Amend No. XXXXX              Date xxXXXxx
      *
      *****************************************************************
      *
      *  XXXXXX - ddddddddddddddddddddddddddddddddddddddddd
      *
      *****************************************************************
     C                     MOVE WUZASF    #DGLCD
      * Add Amount to Hash field twice for From & To Postings
     C           #1AMTF    ADD  #1AMTF    WUZSNI           ZSEDIT Numeric
      * ZSEDIT Screen Field - Standard functions  *
     C                     CALL 'ZSEDIT'               90  ZSEDIT Screen F
     C                     PARM WUZSNI    WQ0057 150       ZSEDIT Numeric
     C                     PARM WUZNDE    WQ0058  10       ZALIGN No Of De
     C                     PARM 'L'       WQ0059  1        ZSEDIT Edit Cod
     C           WUZSCO    PARM *BLANK    WQ0060 21        ZSEDIT Char Out
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Hash character to numeric - Standard functions  *
     C                     MOVE WUZSCO    UMRSLT           Formatted data
      *
     C                     CALL 'GL0139U'              90  <FORMAT AMOUNT>
     C***********#BAORC****PARM #BAORC    UMRTCD  7        B:Return code  S01117
     C           WUAPRC    PARM WUAPRC    UMRTCD  7        B:Return code  S01117
     C                     PARM           UMRSLT 32        I:Formatted
     C                     PARM           UMVALI 150       O:Integer
     C           UMVALD    PARM           UMVAL3  99       O:Decimal
      *
     C                     Z-ADDUMVALI    #1HIIN           Integer portion
     C                     Z-ADDUMVAL2    #1HDIN           Decimal portion
      *
     C                     END                             *FI
     C                     END                             *FI
      * Validate Debit/Credit From
      * CASE: DTL.Debit/credit indicator is Valid Values
     C           #1DCIN    IFEQ 'C'                        *IF
     C           #1DCIN    OREQ 'D'
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1DCIN    ZA0052           Debit/credit in
      * Send message 'Debit/Credit must be Y/N'
     C                     MOVEL'GLX0207' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9945  *
      *
     C                     END                             *FI
      * Validate Allocated To A/c
     C                     EXSR UWSUBR                     Validate Alloca
      * Validate Allocated To A/c
     C                     EXSR UXSUBR                     Validate Alloca
      * Validate Narrative
     C                     EXSR UYSUBR                     Validate Narrat
      * Validate Value Date
     C                     EXSR UZSUBR                     Validate Value
      * Amount from required
     C           #DGLCD    IFEQ *BLANK                     IF
     C                     SETON                     9944  *
      * Send message '*Value required'
     C                     MOVEL'Y2U0001' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END                             FI
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         EBPR##    BEGSR
      *================================================================
      * Process record:
      *================================================================
      * Process add request
     C           W0PMD     CASEQ'ADD'     ECADRQ
      * Process update request
     C           W0PMD     CASNE'ADD'     EECHRQ
     C                     END
     C           W0RTN     IFNE *BLANK
      * Error: ROLLBACK any DBF changes
     C                     ROLBK
     C                     GOTO EBEXIT
     C                     ELSE
      * Otherwise COMMIT any DBF changes
     C                     COMIT
     C                     END
     C           W0RTN     IFEQ *BLANK
      * USER: Process command keys
      * CASE: DTL.*CMD key is *Exit
     C           *IN03     IFEQ '1'                        *IF
     C                     ROLBK
     C                     END                             *FI
      * Restart program for next record
     C                     MOVEL'N'       W0TRN
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         ECADRQ    BEGSR
      *================================================================
      * Process add request
      *================================================================
      * USER: Create DBF record
      * Create Spread Jrnl. Hdr. - Journal Entry Header  *
     C                     EXSR SBCRRC
     C           W0RTN     IFEQ *BLANK
      * Send message '*Record added'
     C                     MOVEL'Y2U0011' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Change Spread Jrnl. Hdr. - Journal Entry Header  *
     C                     EXSR SDCHRC
     C           W0RTN     IFNE *BLANK
      * DBF update error
      * Reset screen fields if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1
     C                     END
     C                     ELSE
      * Send message '*Record changed'
     C                     MOVEL'Y2U0012' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FACKPM    BEGSR
      *================================================================
      * Check passed parameters
      *================================================================
      * Is full key present?
     C           P1BTNB    IFEQ *BLANK                     Batch number
      * Not every key field passed - loop program
     C                     MOVEL'Y'       W0RPT   1
     C                     ELSE
      * Full key passed, so single shot program
     C                     MOVEL'N'       W0RPT
     C                     END
      *================================================================
     CSR         FAEXIT    ENDSR
      /EJECT
     CSR         GADSAK    BEGSR
      *================================================================
      * Set key screen conditioning indicators
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSAD    BEGSR
      *================================================================
      * Set detail screen conditioning indicators
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect key fields on detail screen
     C                     SETON                     88    *
     C                     MOVEL'0'       *IN79
     C                     MOVEL'0'       *IN78
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
     C                     MOVEL'0'       *IN77
     C           W0PMD     IFEQ 'CHG'                      *IF
     C                     MOVEL'1'       *IN77
     C                     END                             *FI
     C           W0RPT     IFEQ 'N'
      * Disable key screen - not applicable
     C                     SETOF                     87    *
     C                     ELSE
      * Enable key screen
     C                     SETON                     87    *
     C                     END
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise record - except for key fields
      *================================================================
     C                     MOVEL*BLANK    #1RVVD           Reversal / Void
     C                     Z-ADD*ZERO     #1SPTT           Spread Total
     C                     Z-ADD*ZERO     #1NIST           No. of Items to
     C                     MOVEL*BLANK    #1CUSF           Customer Number
     C                     MOVEL*BLANK    #1NNBF           Nostro No. (Ite
     C                     Z-ADD*ZERO     #1RACF           Retail A/c No.
     C                     Z-ADD*ZERO     #1AMTF           Amount
     C                     MOVEL*BLANK    #1CNAT           Customer Number
     C                     MOVEL*BLANK    #1NNBT           Nostro No. (Ite
     C                     Z-ADD*ZERO     #1RACT           Retail A/c No.
     C                     MOVEL*BLANK    #1TOJE           Type of Journal
     C                     MOVEL*BLANK    #1WSID           Workstation id.
     C                     Z-ADD*ZERO     #1HICC           Hash integer ca
     C                     Z-ADD*ZERO     #1HDCC           Hash decimal ca
     C                     Z-ADD*ZERO     #1HINC           Hash item no.ca
     C                     Z-ADD*ZERO     #1HIIN           Hash integer in
     C                     Z-ADD*ZERO     #1HDIN           Hash decimal in
     C                     Z-ADD*ZERO     #1HINI           Hash item no.in
     C                     MOVEL*BLANK    #1BTSF           Batch status fl
     C                     MOVEL*BLANK    #1BIUF           Batch in use fl
     C                     MOVEL*BLANK    #1SHPI           Shadow post ind
     C                     MOVEL*BLANK    #1RAPI           Retail advice p
     C                     MOVEL*BLANK    #1BCDA           Branch Code - A
     C                     MOVEL*BLANK    #DBNMD           Branch name (di
     C                     MOVEL*BLANK    #1DPCD           Dept Code
     C                     MOVEL*BLANK    #DDNDS           Department name
     C                     MOVEL*BLANK    #1MBRB           Multiple Branch
     C                     MOVEL*BLANK    #1BDES           Batch Descripti
     C                     MOVEL*BLANK    #1SPRF           Spread Profile
     C                     MOVEL*BLANK    #DSPTA           Spread Total -
     C                     MOVEL*BLANK    #DGKCD           Spread Items -
     C                     MOVEL*BLANK    #DACID           Account Identif
     C                     MOVEL*BLANK    #1CYCF           Currency Code
     C                     MOVEL*BLANK    #1ACCF           Account Code
     C                     MOVEL*BLANK    #1ACSF           Account Seq No.
     C                     MOVEL*BLANK    #1IBCF           Input Branch Cd
     C                     MOVEL*BLANK    #1PRCF           Profit Centre
     C                     MOVEL*BLANK    #DGLCD           Amount from
     C                     MOVEL*BLANK    #1DCIN           Debit/credit in
     C                     MOVEL*BLANK    #DAIDT           Account Identif
     C                     MOVEL*BLANK    #1CYCT           Currency Code
     C                     MOVEL*BLANK    #1ACCT           Account Code
     C                     MOVEL*BLANK    #1ASNT           Account Seq No.
     C                     MOVEL*BLANK    #1IBCT           Input Branch Cd
     C                     MOVEL*BLANK    #DNRTV           Narrative
     C                     MOVEL*BLANK    #DVDDS           Value date (dis
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @BRREAH fields to screen
      *================================================================
     C                     MOVELBRRVVD    #1RVVD           Reversal / Void
     C                     Z-ADDBRSPTT    #1SPTT           Spread Total
     C                     Z-ADDBRNIST    #1NIST           No. of Items to
     C                     MOVELBRCUSF    #1CUSF           Customer Number
     C                     MOVELBRNNBF    #1NNBF           Nostro No. (Ite
     C                     Z-ADDBRRACF    #1RACF           Retail A/c No.
     C                     Z-ADDBRAMTF    #1AMTF           Amount
     C                     MOVELBRCNAT    #1CNAT           Customer Number
     C                     MOVELBRNNBT    #1NNBT           Nostro No. (Ite
     C                     Z-ADDBRRACT    #1RACT           Retail A/c No.
     C                     MOVELBRTOJE    #1TOJE           Type of Journal
     C                     MOVELBRWSID    #1WSID           Workstation id.
     C                     Z-ADDBRHICC    #1HICC           Hash integer ca
     C                     Z-ADDBRHDCC    #1HDCC           Hash decimal ca
     C                     Z-ADDBRHINC    #1HINC           Hash item no.ca
     C                     Z-ADDBRHIIN    #1HIIN           Hash integer in
     C                     Z-ADDBRHDIN    #1HDIN           Hash decimal in
     C                     Z-ADDBRHINI    #1HINI           Hash item no.in
     C                     MOVELBRBTSF    #1BTSF           Batch status fl
     C                     MOVELBRBIUF    #1BIUF           Batch in use fl
     C                     MOVELBRSHPI    #1SHPI           Shadow post ind
     C                     MOVELBRRAPI    #1RAPI           Retail advice p
     C                     MOVELBRBTNB    #1BTNB           Batch number
     C                     MOVELBRBCDA    #1BCDA           Branch Code - A
     C                     MOVELBRDPCD    #1DPCD           Dept Code
     C                     MOVELBRMBRB    #1MBRB           Multiple Branch
     C                     MOVELBRBDES    #1BDES           Batch Descripti
     C                     MOVELBRSPRF    #1SPRF           Spread Profile
     C                     MOVELBRCYCF    #1CYCF           Currency Code
     C                     MOVELBRACCF    #1ACCF           Account Code
     C                     MOVELBRACSF    #1ACSF           Account Seq No.
     C                     MOVELBRIBCF    #1IBCF           Input Branch Cd
     C                     MOVELBRPRCF    #1PRCF           Profit Centre
     C                     MOVELBRDCIN    #1DCIN           Debit/credit in
     C                     MOVELBRCYCT    #1CYCT           Currency Code
     C                     MOVELBRACCT    #1ACCT           Account Code
     C                     MOVELBRASNT    #1ASNT           Account Seq No.
     C                     MOVELBRIBCT    #1IBCT           Input Branch Cd
      * Hold existing record image
     C                     MOVEL@1DBRC    #1DBRC
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MDIZ#K    BEGSR
      *================================================================
      * Initialise key screen
      *================================================================
     C                     MOVELP1BTNB    #1BTNB           Batch number
      *================================================================
     CSR         MDEXIT    ENDSR
      /EJECT
     CSR         SARVGN    BEGSR
      *================================================================
      * Rtv Spread Profile Header - Spread Profile Header  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSA     KLIST
     C                     KFLD           D8SPRF           Spread Profile
      * Move fields to key list
     C                     MOVEL#1SPRF    D8SPRF           Spread Profile
     C           KRSSA     CHAIN@D8REJK              90    *
     C           *IN90     IFEQ '1'
      * DBF record not found
     C                     MOVEL'GLX0250' W0RTN   7
      * USER: Processing if DBF record not found
     C                     MOVEL'Y2U0005' W0RTN            *Return code
     C                     GOTO SAEXIT
     C                     END
      *
     C           *IN90     IFEQ '0'
      * USER: Process DBF record
     C                     MOVEL'Y2U0003' W0RTN            *Return code
      * PAR = DB1 By name
     C                     Z-ADDD8CTTL    WUCTTL           Control Total
     C                     Z-ADDD8NUPC    WUNUPC           No. of Profit C
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBCRRC    BEGSR
      *================================================================
      * Create Spread Jrnl. Hdr. - Journal Entry Header  *
      *================================================================
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0163RC04
      *                                                                   S01408
      ** Call Window Manager Program                                      S01408
      *                                                                   S01408
     C                     CALL 'WN0010'                                  S01408
     C                     PARM ##PGM     #PGM   10                       S01408
     C                     PARM *BLANK    FKEY    2                       S01408
     C                     PARM 'I'       ACTION  1                       S01408
     C                     PARM           DATA                            S01408
     C                     PARM *BLANKS   #RTRN   7                       S01408
     C                     PARM           SPARE 256                       S01408
      *                                                                   S01408
     C           #RTRN     IFEQ 'Y2U9999'                  *F3 PRESSED    S01408
     C                     EXSR ZXEXPG                                    S01408
     C                     ENDIF                                          S01408
      *                                                                   S01408
     C           #RTRN     IFEQ 'USR0790'                  *F12 PRESSED   S01408
     C                     EXSR CCDSPV                                    S01408
     C                     ENDIF                                          S01408
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0163RC07
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BRREAG
     C                     MOVEL#1BTNB    BRBTNB           Batch number
     C                     MOVEL#1BCDA    BRBCDA           Branch Code - A
     C                     MOVEL#1DPCD    BRDPCD           Dept Code
     C                     MOVEL#1WSID    BRWSID           Workstation id.
     C                     Z-ADD#1HICC    BRHICC           Hash integer ca
     C                     Z-ADD#1HDCC    BRHDCC           Hash decimal ca
     C                     Z-ADD#1HINC    BRHINC           Hash item no.ca
     C                     Z-ADD#1HIIN    BRHIIN           Hash integer in
     C                     Z-ADD#1HDIN    BRHDIN           Hash decimal in
     C                     Z-ADD#1HINI    BRHINI           Hash item no.in
     C                     MOVEL#1BTSF    BRBTSF           Batch status fl
     C                     MOVEL'Y'       BRBIUF           Batch in use fl
     C                     MOVEL#1SHPI    BRSHPI           Shadow post ind
     C                     MOVEL#1RAPI    BRRAPI           Retail advice p
     C                     MOVEL#1MBRB    BRMBRB           Multiple Branch
     C                     MOVEL#1RVVD    BRRVVD           Reversal / Void
     C                     MOVEL#1BDES    BRBDES           Batch Descripti
     C                     Z-ADD#1SPTT    BRSPTT           Spread Total
     C                     Z-ADD#1NIST    BRNIST           No. of Items to
     C                     MOVEL#1SPRF    BRSPRF           Spread Profile
     C                     MOVEL#1DCIN    BRDCIN           Debit/credit in
     C                     MOVEL#1IBCF    BRIBCF           Input Branch Cd
     C                     MOVEL#1CUSF    BRCUSF           Customer Number
     C                     MOVEL#1CYCF    BRCYCF           Currency Code
     C                     MOVEL#1ACCF    BRACCF           Account Code
     C                     MOVEL#1ACSF    BRACSF           Account Seq No.
     C                     MOVEL#1NNBF    BRNNBF           Nostro No. (Ite
     C                     Z-ADD#1RACF    BRRACF           Retail A/c No.
     C                     MOVEL#1PRCF    BRPRCF           Profit Centre
     C                     Z-ADD#1AMTF    BRAMTF           Amount
     C                     MOVEL#1IBCT    BRIBCT           Input Branch Cd
     C                     MOVEL#1CYCT    BRCYCT           Currency Code
     C                     MOVEL#1CNAT    BRCNAT           Customer Number
     C                     MOVEL#1ACCT    BRACCT           Account Code
     C                     MOVEL#1ASNT    BRASNT           Account Seq No.
     C                     MOVEL#1NNBT    BRNNBT           Nostro No. (Ite
     C                     Z-ADD#1RACT    BRRACT           Retail A/c No.
     C                     MOVEL#1TOJE    BRTOJE           Type of Journal
     C                     MOVEASTAMP,1   BRTMST           Default Timestamp                  CPK014
      *                                                                                       CPK014
      *                                                                   CGL008
      ** If CGL008 is ON, update BRUSRI with the current user.            CGL008
      *                                                                   CGL008
     C           CGL008    IFEQ 'Y'                                       CGL008
     C/COPY WNCPYSRC,GL0163RC23
     C                     MOVELWUUSID    BRUSRI                          CGL008
     C                     ENDIF                                          CGL008
      *
     C           KLCRSB    KLIST
     C                     KFLD           BRBTNB           Batch number
      * Check for duplicate primary key
     C           KLCRSB    SETLL@BRREAG                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'GLX0171' W0RTN   7
      * Send message 'Journal Entry Header   EX'
     C                     MOVEL'GLX0171' ZAMSID
     C                     EXSR ZASNMS
     C                     GOTO SBEXIT
     C                     END
      *
     C                     WRITE@BRREAG                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
     C/COPY WNCPYSRC,GL0163RC09
      * DBF write successful
      * USER: Processing after DBF update
      * Setup message data for message
     C                     MOVELBRBTNB    ZA0080           Batch number
      * Send message 'Loading Postings'
     C                     MOVEL'GLX0165' ZAMSID
     C                     MOVEL'*EXT '   ZAPGRL           Rel queue
     C                     MOVEL'*STATUS' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
      * Load Spread Jnl Postings - Standard functions  *
     C                     CALL 'GL0181U'              90  Load Spread Jnl
     C                     PARM BRBTNB    WQ0078  3        Batch number
     C                     PARM WUNRTV    WQ0079 30        Narrative
     C                     PARM WUVLDT    WQ0080  50       Value date
     C                     PARM WUSPCU    WQ0081  1        Spread Profile
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     Z-ADDBRHIIN    WUHIIN           Hash integer in
     C                     Z-ADDBRHDIN    WUHDIN           Hash decimal in
     C                     Z-ADDBRHINI    WUHINI           Hash item no.in
      * DO WHILE: WRK.Exit option is Return to Journal Entries
     C           WUEXTO    DOWEQ'R'                        *DOW
      * Edit Spread Jrnl Postings - Journal Entry Posting  *
      *                                                                                       191175
     C           WHDCHG    IFEQ 'Y'                                                           191175
     C                     MOVE 'Y'       PBTAM   1                                           191175
     C                     MOVE 'Y'       WPBTAM                                              191175
     C                     ENDIF                                                              191175
      *                                                                                       191175
     C/COPY WNCPYSRC,GL0163RC24
     C                     CALL 'GL0182M'              90  Edit Spread Jrn
     C                     PARM *BLANK    W0RTN   7
     C                     PARM BRBTNB    WQ0082  3        Batch number
     C                     PARM BRBCDA    WQ0083  3        Branch Code - A
     C                     PARM WUBICN    WQ0084  6        Branch Internal
     C                     PARM BRHINI    WQ0085  30       Hash item no.in
     C                     PARM BRHINC    WQ0086  30       Hash item no.ca
     C                     PARM BRMBRB    WQ0087  1        Multiple Branch
     C                     PARM BRDPCD    WQ0088  3        Dept Code
     C                     PARM WUSPCU    WQ0089  1        Spread Profile
     C           WUEXTO    PARM *BLANK    WQ0090  1        Exit option
     C                     PARM P2SACD    WQ0116  1        Action Code                        189519
     C           PBTAM     PARM WPBTAM    WPBTAM  1                                           191175
     C                     MOVE PBTAM     WPBTAM                                              191175
     C/COPY WNCPYSRC,GL0163RC25
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     Z-ADDBRHICC    WUHICC           Hash integer ca
     C                     Z-ADDBRHDCC    WUHDCC           Hash decimal ca
     C                     Z-ADDBRHINC    WUHINC           Hash item no.ca
     C                     MOVELBRBTSF    WUBTSF           Batch status fl
     C                     MOVEL*BLANK    WUAPRC           Access Pgm Retu
     C                     MOVEL'*AMEND'  WUAPRC           Access Pgm Retu
      * Obtain Spread Jrn.Ccy.Tot - Standard functions  *
     C                     MOVEL*BLANK    PARC
     C                     MOVELBRBTNB    PABTNB           Batch number
     C                     MOVELBRBCDA    PABCDA           Branch Code - A
     C                     MOVELBRDPCD    PADPCD           Dept Code
     C                     MOVELBRWSID    PAWSID           Workstation id.
     C                     Z-ADDWUHICC    PAHICC           Hash integer ca
     C                     Z-ADDWUHDCC    PAHDCC           Hash decimal ca
     C                     Z-ADDWUHINC    PAHINC           Hash item no.ca
     C                     Z-ADDWUHIIN    PAHIIN           Hash integer in
     C                     Z-ADDWUHDIN    PAHDIN           Hash decimal in
     C                     Z-ADDWUHINI    PAHINI           Hash item no.in
     C                     MOVELWUBTSF    PABTSF           Batch status fl
     C                     MOVELBRBIUF    PABIUF           Batch in use fl
     C                     MOVELBRSHPI    PASHPI           Shadow post ind
     C                     MOVELBRRAPI    PARAPI           Retail advice p
     C                     MOVELBRMBRB    PAMBRB           Multiple Branch
     C                     MOVELBRRVVD    PARVVD           Reversal / Void
     C                     MOVELBRBDES    PABDES           Batch Descripti
     C                     Z-ADDBRSPTT    PASPTT           Spread Total
     C                     MOVELBRSPRF    PASPRF           Spread Profile
     C                     MOVELBRDCIN    PADCIN           Debit/credit in
     C                     MOVELBRIBCF    PAIBCF           Input Branch Cd
     C                     MOVELBRCUSF    PACUSF           Customer Number
     C                     MOVELBRCYCF    PACYCF           Currency Code
     C                     MOVELBRACCF    PAACCF           Account Code
     C                     MOVELBRACSF    PAACSF           Account Seq No.
     C                     MOVELBRNNBF    PANNBF           Nostro No. (Ite
     C                     Z-ADDBRRACF    PARACF           Retail A/c No.
     C                     MOVELBRPRCF    PAPRCF           Profit Centre
     C                     MOVELBRIBCT    PAIBCT           Input Branch Cd
     C                     MOVELBRCYCT    PACYCT           Currency Code
     C                     MOVELBRCNAT    PACNAT           Customer Number
     C                     MOVELBRACCT    PAACCT           Account Code
     C                     MOVELBRASNT    PAASNT           Account Seq No.
     C                     MOVELBRNNBT    PANNBT           Nostro No. (Ite
     C                     Z-ADDBRRACT    PARACT           Retail A/c No.
      *
     C                     CALL 'GL0171U'              90  Obtain Spread J
     C           WUAPRC    PARM WUAPRC    WQ0091  7        Access Pgm Retu
     C           WUEXTO    PARM WUEXTO    WQ0092  1        Exit option
     C                     PARM 'N'       WQ0093  1        Abbreviated Pos
     C                     PARM           PARC             RCD: Journal En
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     Z-ADDPAHICC    WUHICC           Hash integer ca
     C                     Z-ADDPAHDCC    WUHDCC           Hash decimal ca
     C                     Z-ADDPAHINC    WUHINC           Hash item no.ca
     C                     Z-ADDPAHIIN    WUHIIN           Hash integer in
     C                     Z-ADDPAHDIN    WUHDIN           Hash decimal in
     C                     Z-ADDPAHINI    WUHINI           Hash item no.in
     C                     MOVELPABTSF    WUBTSF           Batch status fl
      *
      * Disp Spread Journal Curr - Journal Entry Summary  *
     C                     MOVEL*BLANK    PBRC
     C                     MOVELBRBTNB    PBBTNB           Batch number
     C                     MOVELBRBCDA    PBBCDA           Branch Code - A
     C                     MOVELBRDPCD    PBDPCD           Dept Code
     C                     MOVELBRWSID    PBWSID           Workstation id.
     C                     Z-ADDWUHICC    PBHICC           Hash integer ca
     C                     Z-ADDWUHDCC    PBHDCC           Hash decimal ca
     C                     Z-ADDWUHINC    PBHINC           Hash item no.ca
     C                     Z-ADDWUHIIN    PBHIIN           Hash integer in
     C                     Z-ADDWUHDIN    PBHDIN           Hash decimal in
     C                     Z-ADDWUHINI    PBHINI           Hash item no.in
     C                     MOVELBRBTSF    PBBTSF           Batch status fl
     C                     MOVELBRBIUF    PBBIUF           Batch in use fl
     C                     MOVELBRSHPI    PBSHPI           Shadow post ind
     C                     MOVELBRRAPI    PBRAPI           Retail advice p
     C                     MOVELBRMBRB    PBMBRB           Multiple Branch
     C                     MOVELBRRVVD    PBRVVD           Reversal / Void
     C                     MOVELBRBDES    PBBDES           Batch Descripti
      *                                                                                       191175
     C           WHDCHG    IFEQ 'Y'                                                           191175
     C                     MOVE 'Y'       PBTAM                                               191175
     C                     MOVE 'Y'       WPBTAM                                              191175
     C                     ENDIF                                                              191175
      *                                                                                       191175
     C/COPY WNCPYSRC,GL0163RC26
      *
     C                     CALL 'GL0171D'              90  Disp Spread Jou
     C                     PARM *BLANK    W0RTN   7
     C           WUEXTO    PARM WUEXTO    WQ0094  1        Exit option
     C                     PARM           PBRC             RCD: Journal En
     C                     PARM           WBRUSA 10                       CGL008
     C                     PARM PBTAM     PBTMD   1                                           191175
     C/COPY WNCPYSRC,GL0163RC27
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     Z-ADDPBHIIN    WUHIIN           Hash integer in
     C                     Z-ADDPBHDIN    WUHDIN           Hash decimal in
     C                     Z-ADDPBHINI    WUHINI           Hash item no.in
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *ITR
      * CASE: WRK.Exit option is Accept Batch
     C           WUEXTO    IFEQ 'A'                        *IF
     C                     MOVEL'A'       WUBTSF           Batch status fl
     C                     END                             *FI
      * CASE: WRK.Exit option is Hold Batch
     C           WUEXTO    IFEQ 'H'                        *IF
     C                     MOVEL'H'       WUBTSF           Batch status fl
     C                     END                             *FI
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0163RCAU                                           S01408
     C*                                                                   S01408
      * Update Batch Hash Totals - Journal Entry Header  *
     C                     EXSR SCCHRC
      * CASE: WRK.Exit option is Accept Batch
     C           WUEXTO    IFEQ 'A'                        *IF
      * Submit Accepted Batch - Standard functions  *
     C                     CALL 'GLSBMBCH'             90  Submit Accepted
     C           WUAPRC    PARM *BLANK    WQ0095  7        Access Pgm Retu
     C                     PARM BRBTNB    WQ0096  3        Batch number
     C/COPY WNCPYSRC,GL0163RC03
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     END                             *FI
     C                     COMIT
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCHRC    BEGSR
      *================================================================
      * Update Batch Hash Totals - Journal Entry Header  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      *
     C           KLCHSC    KLIST
     C                     KFLD           BRBTNB           Batch number
     C           KLCHSC    CHAIN@BRREAG              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SCEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SCEXIT
     C                     END
      *
      * Move non-key fields to @BRREAG
     C                     Z-ADDWUHICC    BRHICC           Hash integer ca
     C                     Z-ADDWUHDCC    BRHDCC           Hash decimal ca
     C                     Z-ADDWUHINC    BRHINC           Hash item no.ca
     C                     Z-ADDWUHIIN    BRHIIN           Hash integer in
     C                     Z-ADDWUHDIN    BRHDIN           Hash decimal in
     C                     Z-ADDWUHINI    BRHINI           Hash item no.in
     C                     MOVELWUBTSF    BRBTSF           Batch status fl
     C                     MOVEL*BLANK    BRBIUF           Batch in use fl
      *
     C                     UPDAT@BRREAG                91  *
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF change successful
      *                                                                                       CRE020
      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     END
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDCHRC    BEGSR
      *================================================================
      * Change Spread Jrnl. Hdr. - Journal Entry Header  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move key fields to @BRREAG
     C                     MOVEL#1BTNB    BRBTNB           Batch number
      *
     C           KLCHSD    KLIST
     C                     KFLD           BRBTNB           Batch number
     C           KLCHSD    CHAIN@BRREAG              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SDEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Use SETLL to release record lock
     C           KLCHSD    SETLL@BRREAG              9091  *
     C                     GOTO SDEXIT
     C                     END                             FI #1DBRC
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0163RC05
      *                                                                   S01408
      ** Call Window Manager Program                                      S01408
      *                                                                   S01408
     C                     CALL 'WN0010'                                  S01408
     C                     PARM ##PGM     #PGM   10                       S01408
     C                     PARM *BLANK    FKEY    2                       S01408
     C                     PARM 'I'       ACTION  1                       S01408
     C                     PARM           DATA                            S01408
     C                     PARM *BLANKS   #RTRN   7                       S01408
     C                     PARM           SPARE 256                       S01408
      *                                                                   S01408
     C           #RTRN     IFEQ 'Y2U9999'                  *F3 PRESSED    S01408
     C                     EXSR ZXEXPG                                    S01408
     C                     ENDIF                                          S01408
      *                                                                   S01408
     C           #RTRN     IFEQ 'USR0790'                  *F12 PRESSED   S01408
     C                     EXSR CCDSPV                                    S01408
     C                     ENDIF                                          S01408
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0163RC08
      * Move non-key fields to @BRREAG
     C                     MOVEL#1BCDA    BRBCDA           Branch Code - A
     C                     MOVEL#1DPCD    BRDPCD           Dept Code
     C                     MOVEL#1WSID    BRWSID           Workstation id.
     C                     Z-ADD#1HICC    BRHICC           Hash integer ca
     C                     Z-ADD#1HDCC    BRHDCC           Hash decimal ca
     C                     Z-ADD#1HINC    BRHINC           Hash item no.ca
     C                     Z-ADD#1HIIN    BRHIIN           Hash integer in
     C                     Z-ADD#1HDIN    BRHDIN           Hash decimal in
     C                     Z-ADD#1HINI    BRHINI           Hash item no.in
     C                     MOVEL#1BTSF    BRBTSF           Batch status fl
     C                     MOVEL'Y'       BRBIUF           Batch in use fl
     C                     MOVEL#1SHPI    BRSHPI           Shadow post ind
     C                     MOVEL#1RAPI    BRRAPI           Retail advice p
     C                     MOVEL#1MBRB    BRMBRB           Multiple Branch
     C                     MOVEL#1RVVD    BRRVVD           Reversal / Void
     C                     MOVEL#1BDES    BRBDES           Batch Descripti
     C                     Z-ADD#1SPTT    BRSPTT           Spread Total
     C                     Z-ADD#1NIST    BRNIST           No. of Items to
     C                     MOVEL#1SPRF    BRSPRF           Spread Profile
     C                     MOVEL#1DCIN    BRDCIN           Debit/credit in
     C                     MOVEL#1IBCF    BRIBCF           Input Branch Cd
     C                     MOVEL#1CUSF    BRCUSF           Customer Number
     C                     MOVEL#1CYCF    BRCYCF           Currency Code
     C                     MOVEL#1ACCF    BRACCF           Account Code
     C                     MOVEL#1ACSF    BRACSF           Account Seq No.
     C                     MOVEL#1NNBF    BRNNBF           Nostro No. (Ite
     C                     Z-ADD#1RACF    BRRACF           Retail A/c No.
     C                     MOVEL#1PRCF    BRPRCF           Profit Centre
     C                     Z-ADD#1AMTF    BRAMTF           Amount
     C                     MOVEL#1IBCT    BRIBCT           Input Branch Cd
     C                     MOVEL#1CYCT    BRCYCT           Currency Code
     C                     MOVEL#1CNAT    BRCNAT           Customer Number
     C                     MOVEL#1ACCT    BRACCT           Account Code
     C                     MOVEL#1ASNT    BRASNT           Account Seq No.
     C                     MOVEL#1NNBT    BRNNBT           Nostro No. (Ite
     C                     Z-ADD#1RACT    BRRACT           Retail A/c No.
     C                     MOVEL#1TOJE    BRTOJE           Type of Journal
      *                                                                   CGL008
      ** If CGL008 is ON, update BRUSRA with the current user.            CGL008
      *                                                                   CGL008
     C           CGL008    IFEQ 'Y'                                       CGL008
     C/COPY WNCPYSRC,GL0163RC28
     C                     MOVELBRUSRA    WBRUSA                          CGL008
     C/COPY WNCPYSRC,GLH00298
     C                     MOVELWUUSID    BRUSRA                          CGL008
     C/COPY WNCPYSRC,GLH00299
     C                     ENDIF                                          CGL008
      *
     C                     UPDAT@BRREAG                91  *
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF change successful
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * USER: Processing after DBF update
      * Setup message data for message
     C                     MOVELBRBTNB    ZA0081           Batch number
      * Send message 'Loading Postings'
     C                     MOVEL'GLX0165' ZAMSID
     C                     MOVEL'*EXT '   ZAPGRL           Rel queue
     C                     MOVEL'*STATUS' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
      * Load Amends Sp. Jnl. Psts - Standard functions  *
     C                     CALL 'GL0182U'              90  Load Amends Sp.
     C                     PARM BRBTNB    WQ0097  3        Batch number
     C                     PARM WUNRTV    WQ0098 30        Narrative
     C                     PARM WUVLDT    WQ0099  50       Value date
     C                     PARM WUSPCU    WQ0100  1        Spread Profile
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     Z-ADDBRHIIN    WUHIIN           Hash integer in
     C                     Z-ADDBRHDIN    WUHDIN           Hash decimal in
     C                     Z-ADDBRHINI    WUHINI           Hash item no.in
      * DO WHILE: WRK.Exit option is Return to Journal Entries
     C           WUEXTO    DOWEQ'R'                        *DOW
      * Edit Spread Jrnl Postings - Journal Entry Posting  *
     C/COPY WNCPYSRC,GL0163RC01
      *                                                                                       191175
     C           WHDCHG    IFEQ 'Y'                                                           191175
     C                     MOVE 'Y'       PBTAM                                               191175
     C                     MOVE 'Y'       WPBTAM                                              191175
     C                     ENDIF                                                              191175
      *                                                                                       191175
     C                     CALL 'GL0182M'              90  Edit Spread Jrn
     C                     PARM *BLANK    W0RTN   7
     C                     PARM BRBTNB    WQ0101  3        Batch number
     C                     PARM BRBCDA    WQ0102  3        Branch Code - A
     C                     PARM WUBICN    WQ0103  6        Branch Internal
     C                     PARM BRHINI    WQ0104  30       Hash item no.in
     C                     PARM BRHINC    WQ0105  30       Hash item no.ca
     C                     PARM BRMBRB    WQ0106  1        Multiple Branch
     C                     PARM BRDPCD    WQ0107  3        Dept Code
     C                     PARM WUSPCU    WQ0108  1        Spread Profile
     C           WUEXTO    PARM *BLANK    WQ0109  1        Exit option
     C                     PARM P2SACD    WQ0116  1        Action Code                        189519
     C           PBTAM     PARM WPBTAM    WPBTAM                                              191175
     C                     MOVE PBTAM     WPBTAM                                              191175
     C/COPY WNCPYSRC,GL0163RC02
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     Z-ADDBRHICC    WUHICC           Hash integer ca
     C                     Z-ADDBRHDCC    WUHDCC           Hash decimal ca
     C                     Z-ADDBRHINC    WUHINC           Hash item no.ca
     C                     MOVELBRBTSF    WUBTSF           Batch status fl
     C                     MOVEL*BLANK    WUAPRC           Access Pgm Retu
     C                     MOVEL'*AMEND'  WUAPRC           Access Pgm Retu
      * Parameter  EXIT OPTION on Obtain Currency Totals
      * Changed from Output To Both
      * Obtain Spread Jrn.Ccy.Tot - Standard functions  *
     C                     MOVEL*BLANK    PARC
     C                     MOVELBRBTNB    PABTNB           Batch number
     C                     MOVELBRBCDA    PABCDA           Branch Code - A
     C                     MOVELBRDPCD    PADPCD           Dept Code
     C                     MOVELBRWSID    PAWSID           Workstation id.
     C                     Z-ADDWUHICC    PAHICC           Hash integer ca
     C                     Z-ADDWUHDCC    PAHDCC           Hash decimal ca
     C                     Z-ADDWUHINC    PAHINC           Hash item no.ca
     C                     Z-ADDWUHIIN    PAHIIN           Hash integer in
     C                     Z-ADDWUHDIN    PAHDIN           Hash decimal in
     C                     Z-ADDWUHINI    PAHINI           Hash item no.in
     C                     MOVELWUBTSF    PABTSF           Batch status fl
     C                     MOVELBRBIUF    PABIUF           Batch in use fl
     C                     MOVELBRSHPI    PASHPI           Shadow post ind
     C                     MOVELBRRAPI    PARAPI           Retail advice p
     C                     MOVELBRMBRB    PAMBRB           Multiple Branch
     C                     MOVELBRRVVD    PARVVD           Reversal / Void
     C                     MOVELBRBDES    PABDES           Batch Descripti
     C                     Z-ADDBRSPTT    PASPTT           Spread Total
     C                     MOVELBRSPRF    PASPRF           Spread Profile
     C                     MOVELBRDCIN    PADCIN           Debit/credit in
     C                     MOVELBRIBCF    PAIBCF           Input Branch Cd
     C                     MOVELBRCUSF    PACUSF           Customer Number
     C                     MOVELBRCYCF    PACYCF           Currency Code
     C                     MOVELBRACCF    PAACCF           Account Code
     C                     MOVELBRACSF    PAACSF           Account Seq No.
     C                     MOVELBRNNBF    PANNBF           Nostro No. (Ite
     C                     Z-ADDBRRACF    PARACF           Retail A/c No.
     C                     MOVELBRPRCF    PAPRCF           Profit Centre
     C                     MOVELBRIBCT    PAIBCT           Input Branch Cd
     C                     MOVELBRCYCT    PACYCT           Currency Code
     C                     MOVELBRCNAT    PACNAT           Customer Number
     C                     MOVELBRACCT    PAACCT           Account Code
     C                     MOVELBRASNT    PAASNT           Account Seq No.
     C                     MOVELBRNNBT    PANNBT           Nostro No. (Ite
     C                     Z-ADDBRRACT    PARACT           Retail A/c No.
      *
     C                     CALL 'GL0171U'              90  Obtain Spread J
     C           WUAPRC    PARM WUAPRC    WQ0110  7        Access Pgm Retu
     C           WUEXTO    PARM WUEXTO    WQ0111  1        Exit option
     C                     PARM 'N'       WQ0112  1        Abbreviated Pos
     C                     PARM           PARC             RCD: Journal En
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     Z-ADDPAHICC    WUHICC           Hash integer ca
     C                     Z-ADDPAHDCC    WUHDCC           Hash decimal ca
     C                     Z-ADDPAHINC    WUHINC           Hash item no.ca
     C                     Z-ADDPAHIIN    WUHIIN           Hash integer in
     C                     Z-ADDPAHDIN    WUHDIN           Hash decimal in
     C                     Z-ADDPAHINI    WUHINI           Hash item no.in
     C                     MOVELPABTSF    WUBTSF           Batch status fl
      *
      * Disp Spread Journal Curr - Journal Entry Summary  *
     C                     MOVEL*BLANK    PBRC
     C                     MOVELBRBTNB    PBBTNB           Batch number
     C                     MOVELBRBCDA    PBBCDA           Branch Code - A
     C                     MOVELBRDPCD    PBDPCD           Dept Code
     C                     MOVELBRWSID    PBWSID           Workstation id.
     C                     Z-ADDWUHICC    PBHICC           Hash integer ca
     C                     Z-ADDWUHDCC    PBHDCC           Hash decimal ca
     C                     Z-ADDWUHINC    PBHINC           Hash item no.ca
     C                     Z-ADDWUHIIN    PBHIIN           Hash integer in
     C                     Z-ADDWUHDIN    PBHDIN           Hash decimal in
     C                     Z-ADDWUHINI    PBHINI           Hash item no.in
     C                     MOVELBRBTSF    PBBTSF           Batch status fl
     C                     MOVELBRBIUF    PBBIUF           Batch in use fl
     C                     MOVELBRSHPI    PBSHPI           Shadow post ind
     C                     MOVELBRRAPI    PBRAPI           Retail advice p
     C                     MOVELBRMBRB    PBMBRB           Multiple Branch
     C                     MOVELBRRVVD    PBRVVD           Reversal / Void
     C                     MOVELBRBDES    PBBDES           Batch Descripti
      *                                                                                       191175
     C           WHDCHG    IFEQ 'Y'                                                           191175
     C                     MOVE 'Y'       PBTAM                                               191175
     C                     MOVE 'Y'       WPBTAM                                              191175
     C                     ENDIF                                                              191175
      *                                                                                       191175
     C/COPY WNCPYSRC,GL0163RC29
      *
     C                     CALL 'GL0171D'              90  Disp Spread Jou
     C                     PARM *BLANK    W0RTN   7
     C           WUEXTO    PARM WUEXTO    WQ0113  1        Exit option
     C                     PARM           PBRC             RCD: Journal En
     C                     PARM           WBRUSA                          CGL008
     C                     PARM PBTAM     PBTMD                                               191175
     C/COPY WNCPYSRC,GL0163RC30
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     Z-ADDPBHIIN    WUHIIN           Hash integer in
     C                     Z-ADDPBHDIN    WUHDIN           Hash decimal in
     C                     Z-ADDPBHINI    WUHINI           Hash item no.in
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
     C                     END                             *ITR
      * CASE: WRK.Exit option is Accept Batch
     C           WUEXTO    IFEQ 'A'                        *IF
     C                     MOVEL'A'       WUBTSF           Batch status fl
     C                     END                             *FI
      * CASE: WRK.Exit option is Hold Batch
     C           WUEXTO    IFEQ 'H'                        *IF
     C                     MOVEL'H'       WUBTSF           Batch status fl
     C                     END                             *FI
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0163RCAU                                           S01408
     C*                                                                   S01408
      * Update Batch Hash Totals - Journal Entry Header  *
     C                     EXSR SECHRC
      * CASE: WRK.Exit option is Accept Batch
     C           WUEXTO    IFEQ 'A'                        *IF
      * Submit Accepted Batch - Standard functions  *
     C                     CALL 'GLSBMBCH'             90  Submit Accepted
     C           WUAPRC    PARM *BLANK    WQ0114  7        Access Pgm Retu
     C                     PARM BRBTNB    WQ0115  3        Batch number
     C/COPY WNCPYSRC,GL0163RC06
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     END                             *FI
     C                     COMIT
     C                     MOVELW0RTN     P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECHRC    BEGSR
      *================================================================
      * Update Batch Hash Totals - Journal Entry Header  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      *
     C           KLCHSE    KLIST
     C                     KFLD           BRBTNB           Batch number
     C           KLCHSE    CHAIN@BRREAG              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SEEXIT
     C                     END
      *
      * Move non-key fields to @BRREAG
     C                     Z-ADDWUHICC    BRHICC           Hash integer ca
     C                     Z-ADDWUHDCC    BRHDCC           Hash decimal ca
     C                     Z-ADDWUHINC    BRHINC           Hash item no.ca
     C                     Z-ADDWUHIIN    BRHIIN           Hash integer in
     C                     Z-ADDWUHDIN    BRHDIN           Hash decimal in
     C                     Z-ADDWUHINI    BRHINI           Hash item no.in
     C                     MOVELWUBTSF    BRBTSF           Batch status fl
     C                     MOVEL*BLANK    BRBIUF           Batch in use fl
      *
     C                     UPDAT@BRREAG                91  *
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF change successful
      *                                                                                       CRE020
      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
     C           WSV01     ANDEQ'Y'                                                           CRE020
     C                     EXSR SRIDXT                                                        CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     END
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Set Up Default Branch Code & Name
      *================================================================
     C                     MOVELWUUDBC    #1BCDA           Branch Code - A
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1BCDA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBCDA           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
     C                     MOVELWUBRNM    #DBNMD           Branch name (di
      * CASE: WRK.Multibranching Indicator is No
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'Y'       WULGST           Output Branch
     C                     END                             *FI
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Set Up Default Department Code & Name
      *================================================================
     C                     MOVELWUUDDP    #1DPCD           Dept Code
      * Access Department. - Department Codes  *
     C*
     C*  Access Department codes file for the following field:
     C*  Department Name
     C*
     C                     MOVEL#1DPCD    UUDPCD
     C                     CALL 'AODEPTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUDPCD  3        I:Department Code
     C           D@DEPT    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELAEDPCD    WUDPCD           Department Code
     C                     MOVELAEDPNM    WUDPNM           Department Name
     C*
      * CASE: WRK.Access Pgm Return Code is *No Errors
     C           WUAPRC    IFEQ *BLANK                     *IF
     C                     MOVELWUDPCD    #1DPCD           Dept Code
     C                     MOVELWUDPNM    #DDNDS           Department name
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #1DPCD           Dept Code
     C                     MOVEL*BLANK    #DDNDS           Department name
     C                     END                             *FI
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Set Up Narrative field
      *================================================================
     C                     MOVEL*BLANK    #DNRTV           Narrative
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      * Set Up Value date field
      *================================================================
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM WURDNO    WQ0001  50       Runday Number
     C                     PARM WUDTFF    WQ0002  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0003  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0004  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     MOVELWUDTNF    #DVDDS           Value date (dis
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         UESUBR    BEGSR
      *================================================================
      * Set up Default A/c details
      *================================================================
     C                     MOVEL*BLANK    #DACID           Account Identif
     C                     MOVELWUBICN    #DACID           Account Identif
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C                     MOVELBJLCCY    WULCCY
     C                     MOVELWULCCY    #1CYCF           Currency Code
     C                     MOVEL*BLANK    #1ACCF           Account Code
     C                     MOVEL'01'      #1ACSF           Account Seq No.
     C                     MOVELWUUDBC    #1IBCF           Input Branch Cd
     C                     MOVEL*BLANK    #DAIDT           Account Identif
     C                     MOVELWUBICN    #DAIDT           Account Identif
     C                     MOVELWULCCY    #1CYCT           Currency Code
     C                     MOVEL*BLANK    #1ACCT           Account Code
     C                     MOVEL'01'      #1ASNT           Account Seq No.
     C                     MOVELWUUDBC    #1IBCT           Input Branch Cd
      *================================================================
     CSR         UEEXIT    ENDSR
      /EJECT
     CSR         UFSUBR    BEGSR
      *================================================================
      * Set up condition for output of Branch
      *================================================================
      * CASE: WRK.Multibranching Indicator is No
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'Y'       WULGST           Output Branch
     C                     END                             *FI
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
     C                     MOVEL'Y'       WULGST           Output Branch
     C                     END                             *FI
      *================================================================
     CSR         UFEXIT    ENDSR
      /EJECT
     CSR         UGSUBR    BEGSR
      *================================================================
      * Set up Department Code & Name
      *================================================================
      * Access Department. - Department Codes  *
     C*
     C*  Access Department codes file for the following field:
     C*  Department Name
     C*
     C                     MOVEL#1DPCD    UUDPCD
     C                     CALL 'AODEPTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUDPCD  3        I:Department Code
     C           D@DEPT    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELAEDPCD    WUDPCD           Department Code
     C                     MOVELAEDPNM    WUDPNM           Department Name
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL*BLANK    #DDNDS           Department name
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUDPNM    #DDNDS           Department name
     C                     END                             *FI
      *================================================================
     CSR         UGEXIT    ENDSR
      /EJECT
     CSR         UHSUBR    BEGSR
      *================================================================
      * Account Identifier From (screen)
      *================================================================
     C                     MOVEL*BLANK    #DACID           Account Identif
     C                     MOVELBRCUSF    #DACID           Account Identif
      *================================================================
     CSR         UHEXIT    ENDSR
      /EJECT
     CSR         UISUBR    BEGSR
      *================================================================
      * Account Identifier To (screen)
      *================================================================
     C                     MOVEL*BLANK    #DAIDT           Account Identif
     C                     MOVELBRCNAT    #DAIDT           Account Identif
      *================================================================
     CSR         UIEXIT    ENDSR
      /EJECT
     CSR         UJSUBR    BEGSR
      *================================================================
      * Get no. of Decimal places
      *================================================================
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVELBRCYCF    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
      *================================================================
     CSR         UJEXIT    ENDSR
      /EJECT
     CSR         UKSUBR    BEGSR
      *================================================================
      * Set Up Narrative field
      *================================================================
     C                     MOVEL*BLANK    #DNRTV           Narrative
      *                                                                                     MD026748
      ** If record exist in journal entry postings file                                     MD026748
      *                                                                                     MD026748
     C           *IN17     IFEQ *OFF                                                        MD026748
     C                     MOVELBTNRDC    #DNRTV                                            MD026748
     C                     ENDIF                                                            MD026748
      *================================================================
     CSR         UKEXIT    ENDSR
      /EJECT
     CSR         ULSUBR    BEGSR
      *================================================================
      * Set Up Value date field
      *================================================================
     C                     MOVEL*BLANK    #DVDDS           Value date (dis
      *                                                                                     MD026748
      ** If record exist in journal entry postings file                                     MD026748
      *                                                                                     MD026748
     C           *IN17     IFEQ *OFF                                                        MD026748
     C                     CALL 'ZDATE2'               90                                   MD026748
     C                     PARM BTVLDT    WQ0001                                            MD026748
     C                     PARM WUDTFF    WQ0002                                            MD026748
     C           WUDTNF    PARM *ZERO     WQ0003                                            MD026748
     C           WUDDCD    PARM *BLANK    WQ0004                                            MD026748
      *                                                                                     MD026748
     C           *IN90     IFEQ '1'                                                         MD026748
     C                     MOVEL'Y2U0021' W0RTN                                             MD026748
     C                     END                                                              MD026748
      *                                                                                     MD026748
     C                     MOVELWUDTNF    #DVDDS                                            MD026748
     C                     ENDIF                                                            MD026748
      *================================================================
     CSR         ULEXIT    ENDSR
      /EJECT
     CSR         UMSUBR    BEGSR
      *================================================================
      * Validate Branch Code
      *================================================================
      * CASE: DTL.Branch Code - Alpha is Entered
     C           #1BCDA    IFNE *BLANK                     *IF
      * CASE: DTL.Branch Code - Alpha is select
     C           #1BCDA    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1BCDA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL*BLANK    #DBNMD           Branch name (di
      * Setup message data for message
     C                     MOVEL#1BCDA    ZA0001           Branch Code - A
      * Send message 'Branch Code not found'
     C                     MOVEL'GLX0045' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUBRCD    #1BCDA           Branch Code - A
     C                     MOVELWUBRNM    #DBNMD           Branch name (di
      * Validate Action Code Against Branch Code
     C                     EXSR UNSUBR                     Validate Action
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Branch Code (Alpha) is blank
     C                     MOVEL*BLANK    #DBNMD           Branch name (di
      * Setup message data for message
     C                     MOVEL#1BCDA    ZA0005           Branch Code - A
      * Send message 'Branch Code Required'
     C                     MOVEL'GLX0201' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     END                             *FI
      *================================================================
     CSR         UMEXIT    ENDSR
      /EJECT
     CSR         UNSUBR    BEGSR
      *================================================================
      * Validate Action Code Against Branch Code
      *================================================================
      * CASE: DTL.Branch Code - Alpha is Entered
     C           #1BCDA    IFNE *BLANK                     *IF
      * Val. Action Cde & Bch U/P - Standard functions  *
     C                     CALL 'ZVACTBU'              90  Val. Action Cde
     C                     PARM P2SACD    WQ0024  1        SPF Action Code
     C                     PARM #1BCDA    WQ0025  3        Branch code
     C           WUSPEC    PARM *ZERO     WQ0026  10       SPF Error Condi
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.SPF Error Condition is One
     C           WUSPEC    IFEQ 1                          *IF
      * Setup message data for message
     C                     MOVEL#1BCDA    ZA0002           Branch Code - A
      * Send message 'SPF Atn Cde ERR 1 ZVACTBU'
     C                     MOVEL'GLX0186' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     ELSE
      * CASE: WRK.SPF Error Condition is Two
     C           WUSPEC    IFEQ 2                          *IF
      * Setup message data for message
     C                     MOVELP2SACD    ZA0003           SPF Action Code
     C                     MOVEL#1BCDA    ZA0004           Branch Code - A
      * Send message 'SPF Atn Cde ERR 5 ZVACTBU'
     C                     MOVEL'GLX0206' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9931  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UNEXIT    ENDSR
      /EJECT
     CSR         UOSUBR    BEGSR
      *================================================================
      * Validate Department Code
      *================================================================
      * CASE: DTL.Dept Code is select
     C           #1DPCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: DTL.Dept Code is Blank
     C           #1DPCD    IFEQ *BLANK                     *IF
     C                     MOVEL*BLANK    #DDNDS           Department name
      * Setup message data for message
     C                     MOVEL#1DPCD    ZA0006           Dept Code
      * Send message 'Department Code Required'
     C                     MOVEL'GLX0211' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Access Department. - Department Codes  *
     C*
     C*  Access Department codes file for the following field:
     C*  Department Name
     C*
     C                     MOVEL#1DPCD    UUDPCD
     C                     CALL 'AODEPTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUDPCD  3        I:Department Code
     C           D@DEPT    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELAEDPCD    WUDPCD           Department Code
     C                     MOVELAEDPNM    WUDPNM           Department Name
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL*BLANK    #DDNDS           Department name
      * Setup message data for message
     C                     MOVEL#1DPCD    ZA0007           Dept Code
      * Send message 'Department Code not found'
     C                     MOVEL'GLX0044' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9932  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUDPCD    #1DPCD           Dept Code
     C                     MOVELWUDPNM    #DDNDS           Department name
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UOEXIT    ENDSR
      /EJECT
     CSR         UPSUBR    BEGSR
      *================================================================
      * Validate Multiple Branch Batch
      *================================================================
      * CASE: DTL.Multiple Branch Batch is Blank
     C           #1MBRB    IFEQ *BLANK                     *IF
     C                     MOVEL'N'       #1MBRB           Multiple Branch
     C                     END                             *FI
      * CASE: DTL.Multiple Branch Batch is No
     C           #1MBRB    IFEQ 'N'                        *IF
      * CASE: WRK.Store Multiple Branch Ind is Yes
     C           WUSMBI    IFEQ 'Y'                        *IF
      * Setup message data for message
     C                     MOVEL#1MBRB    ZA0008           Multiple Branch
      * Send message 'Multiple Branch ind Error'
     C                     MOVEL'GLX0193' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: DTL.Multiple Branch Batch is Yes
     C           #1MBRB    IFEQ 'Y'                        *IF
      * ..Valid Entry..
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1MBRB    ZA0009           Multiple Branch
      * Send message 'Multiple Branch Batch Inv'
     C                     MOVEL'GLX0194' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9933  *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UPEXIT    ENDSR
      /EJECT
     CSR         UQSUBR    BEGSR
      *================================================================
      * Check Spread Profile Code OR Spread Total(alpha) + No. of Items
      *================================================================
     C                     MOVEL'N'       WUSPCU           Spread Profile
      * CASE: DTL.Spread Profile Code is Question Mark
     C           #1SPRF    IFEQ '?'                        *IF
      * Select Spread Profile Hdr - Spread Profile Header  *
     C                     CALL 'GL5500S'              90  Select Spread P
     C                     PARM *BLANK    W0RTN   7
     C           #1SPRF    PARM #1SPRF    WQ0027  4        Spread Profile
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     9935  *
     C                     END
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: DTL.Spread Profile Code is Question Mark
     C           #1SPRF    IFEQ '?'                        *IF
     C                     ELSE
      * CASE: DTL.Spread Profile Code is not blank
     C           #1SPRF    IFNE *BLANK                     *IF
      * Check Spread Total (alpha) is blank
      * CASE: DTL.Spread Total - alpha is not blank
     C           #DSPTA    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1SPRF    ZA0011           Spread Profile
     C                     MOVEL#DSPTA    ZA0012           Spread Total -
     C                     MOVEL#DGKCD    ZA0013           Spread Items -
      * Send message 'Sprd Cd or Total+No Items'
     C                     MOVEL'GLX0258' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993536*
     C                     SETON                     37    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Spread Total - alpha is blank
      * CASE: DTL.Spread Items - alpha is entered
     C           #DGKCD    IFNE *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#1SPRF    ZA0014           Spread Profile
     C                     MOVEL#DSPTA    ZA0015           Spread Total -
     C                     MOVEL#DGKCD    ZA0016           Spread Items -
      * Send message 'Sprd Cd or Total+No Items'
     C                     MOVEL'GLX0258' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993536*
     C                     SETON                     37    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * No. of Items blank
      * Check Spread Profile Code exists on file
     C                     EXSR URSUBR                     Check Spread Pr
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Spread Profile Code is blank
      * Validate against Spread Total - alpha
      * CASE: DTL.Spread Total - alpha is not blank
     C           #DSPTA    IFNE *BLANK                     *IF
      * CASE: DTL.Spread Items - alpha is entered
     C           #DGKCD    IFNE *BLANK                     *IF
      * Validate No. of Items
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DGKCD    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0028  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0029 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0030  10       ZALIGN No Of De
     C                     PARM 3         WQ0031  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0032 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0033 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0034  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#DGKCD    ZA0018           Spread Items -
      * Send message 'No of Items  - Numeric'
     C                     MOVEL'GLX0212' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9937  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * No. of Items valid
      * Move Right No of Items - Journal Entry Header  *
     C                     MOVE WUZASF    #DGKCD
     C                     MOVE WUZAFF    #1NIST           No. of Items to
     C                     MOVE WUZAFF    #1HINI           Hash item no.in
      * Add 1 to hash item no. to include Spread Psting From
     C                     ADD  1         #1HINI           Hash item no.in
      * Validate Spread Total - alpha
     C                     EXSR USSUBR                     Validate Spread
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Spread Total - alpha entered with No. of Items blank => invalid
      * Setup message data for message
     C                     MOVEL#1SPRF    ZA0020           Spread Profile
     C                     MOVEL#DSPTA    ZA0021           Spread Total -
     C                     MOVEL#DGKCD    ZA0022           Spread Items -
      * Send message 'Sprd Cd or Total+No Items'
     C                     MOVEL'GLX0258' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993536*
     C                     SETON                     37    *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Spread Profile code & Spread Total - alpha both blank => invalid
      * Setup message data for message
     C                     MOVEL#1SPRF    ZA0023           Spread Profile
     C                     MOVEL#DSPTA    ZA0024           Spread Total -
     C                     MOVEL#DGKCD    ZA0025           Spread Items -
      * Send message 'Sprd Cd or Total+No Items'
     C                     MOVEL'GLX0258' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993536*
     C                     SETON                     37    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UQEXIT    ENDSR
      /EJECT
     CSR         URSUBR    BEGSR
      *================================================================
      * Check Spread Profile Code exists on file
      *================================================================
      * Rtv Spread Profile Header - Spread Profile Header  *
     C                     EXSR SARVGN
      * CASE: PGM.*Return code is *Record does not exist
     C           W0RTN     IFEQ 'Y2U0005'                  *IF
      * Setup message data for message
     C                     MOVEL#1SPRF    ZA0017           Spread Profile
      * Send message 'Spread Profile Header  NF'
     C                     MOVEL'GLX0250' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9935  *
      *
     C                     ELSE
      * CASE: PGM.*Return code is *Record already exists
     C           W0RTN     IFEQ 'Y2U0003'                  *IF
     C                     Z-ADDWUCTTL    #1SPTT           Spread Total
     C                     Z-ADDWUNUPC    #1NIST           No. of Items to
     C                     Z-ADDWUNUPC    #1HINI           Hash item no.in
      * Add 1 to hash item no. to include Spread Psting From
     C                     ADD  1         #1HINI           Hash item no.in
     C                     MOVEL*BLANK    #DSPTA           Spread Total -
     C                     MOVEL*BLANK    #DGKCD           Spread Items -
     C                     MOVEL'Y'       WUSPCU           Spread Profile
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UREXIT    ENDSR
      /EJECT
     CSR         USSUBR    BEGSR
      *================================================================
      * Validate Spread Total - alpha
      *================================================================
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#DSPTA    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0035  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0036 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0037  10       ZALIGN No Of De
     C                     PARM 10        WQ0038  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0039 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0040 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0041  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#DSPTA    ZA0019           Spread Total -
      * Send message 'Spread Total invalid'
     C                     MOVEL'GLX0257' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9936  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUZASF    #1SPTT           Spread Total
      * Zalign Spread Total - Journal Entry Header  *
     C                     MOVE WUZASF    #DSPTA
     C                     END                             *FI
      *================================================================
     CSR         USEXIT    ENDSR
      /EJECT
     CSR         UTSUBR    BEGSR
      *================================================================
      * Validate Allocated From A/c
      *================================================================
      * Check Account Identifier From
      * CASE: DTL.Account Identifier is Entered
     C           #DACID    IFNE *BLANK                     *IF
      * CASE: DTL.Account Identifier is Select Requested
     C           #DACID    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
     C                     MOVEL'Y'       WUVCNB           Valid Customer
      * Access Client Details. - Client Details  *
     C*
     C*  Access CLient Details file for the following fields
     C*  Customer No., Customer shortname, DRS Shortname,
     C*  Location, Customer SWIFT I.D.
     C*
     C                     CALL 'AOCUSTR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM #DACID    UUCNCD 10        I:Client Key
     C                     PARM           UUCRST  7        O:Key status
     C           D@CUST    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUCRST    WUCRST           Key Status  ber
     C*
     C                     MOVELBBCUST    WUCUST           Customer Number
     C                     MOVELBBCSSN    WUCSSN           Shortname
     C                     MOVELBBDRCS    WUDRCS           DRS Shortname
     C                     MOVELBBLCCD    WULCCD           Location
     C                     MOVELBBCSID    WUCSID           SWIFT ID
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C           WUAPRC    OREQ '*CUSCLS'                                                     CGL148
     C           WUAPRC    OREQ '*CUSDEL'                                                     CGL148
     C                     MOVEL'N'       WUVCNB           Valid Customer
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DACID           Account Identif
     C                     MOVELWUCUST    #DACID           Account Identif
     C                     MOVELWUCUST    #1CUSF           Customer Number
     C                     END                             *FI
     C                     END                             *FI
      * Check Currency Code From
      * CASE: DTL.Currency Code    Alloc Fm is not blank
     C           #1CYCF    IFNE *BLANK                     *IF
      * CASE: DTL.Currency Code    Alloc Fm is select requested
     C           #1CYCF    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCF    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1CYCF    ZA0026           Currency Code
      * Send message 'Currency Code not found'
     C                     MOVEL'GLX0048' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9939  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCYCD    #1CYCF           Currency Code
     C                     END                             *FI
     C                     END                             *FI
      * Check Account Code From
      * CASE: DTL.Account Code     Alloc Fm is not blank
     C           #1ACCF    IFNE *BLANK                     *IF
      * CASE: DTL.Account Code     Alloc Fm is selected requested
     C           #1ACCF    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Account Codes. - Account Codes  *
     C*
     C*  Access Account codes file for the following fields
     C*  A/c Type, A/c Name, Account Section, Account Subtype
     C*
     C                     MOVEL#1ACCF    UUACCD                          LN0334
     C                     CALL 'AOACODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C**********           PARM           UUACCD  4        I:Account Code              LN0334 CGL029
     C********** D@ACOD    PARM *BLANK    UUFDY            O:Format                           CGL029
     C                     PARM           UUACCD 10                                           CGL029
     C           D@ACOD    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA5ACCD    WUACCD           A/c Code       LN0334
     C                     MOVELA5ACTY    WUACTY           A/C Type
     C                     MOVELA5ACCN    WUACCN           A/c Name
     C                     MOVELA5ACSC    WUACSC           A/c Section
     C                     MOVELA5ACST    WUACST           A/c Sub-Type
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1ACCF    ZA0027           Account Code
      * Send message 'Account Code not found'
     C                     MOVEL'GLX0046' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9940  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUACCD    #1ACCF           Account Code
     C                     END                             *FI
     C                     END                             *FI
      * Validate Branch Code From
      * CASE: DTL.Input Branch Cd  Alloc Fm is entered
     C           #1IBCF    IFNE *BLANK                     *IF
      * CASE: DTL.Input Branch Cd  Alloc Fm is select request
     C           #1IBCF    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1IBCF    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1IBCF    ZA0028           Input Branch Cd
      * Send message 'Branch Code not found'
     C                     MOVEL'GLX0045' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9942  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUBRCD    #1IBCF           Input Branch Cd
     C                     END                             *FI
     C                     END                             *FI
      * Validate Account Sequence Number From
      * CASE: DTL.Account Seq No.  Alloc Fm is not blank
     C           #1ACSF    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#1ACSF    WUZASF           ZALIGN Screen F
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0042  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0043 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0044  10       ZALIGN No Of De
     C                     PARM 2         WQ0045  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0046 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Zalign Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#1ACSF    ZA0029           Account Seq No.
      * Send message 'Account Seq Numeric'
     C                     MOVEL'GLX0224' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9941  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Zalign Account Sequence - Journal Entry Posting  *
     C                     MOVE WUZASF    #1ACSF
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UTEXIT    ENDSR
      /EJECT
     CSR         UUSUBR    BEGSR
      *================================================================
      * Validate Allocated From A/c
      *================================================================
      * Error message if Account Allocated From not entered
      * CASE: DTL.Account Identifier is Not Entered
     C           #DACID    IFEQ *BLANK                     *IF
      * CASE: DTL.Currency Code    Alloc Fm is blank
     C           #1CYCF    IFEQ *BLANK                     *IF
      * CASE: DTL.Account Code     Alloc Fm is blank
     C           #1ACCF    IFEQ *BLANK                     *IF
      * CASE: DTL.Account Seq No.  Alloc Fm is blank
     C           #1ACSF    IFEQ *BLANK                     *IF
      * CASE: DTL.Input Branch Cd  Alloc Fm is blank
     C           #1IBCF    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#DACID    ZA0030           Account Identif
     C                     MOVEL#1CYCF    ZA0031           Currency Code
     C                     MOVEL#1ACCF    ZA0032           Account Code
     C                     MOVEL#1ACSF    ZA0033           Account Seq No.
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993839*
     C                     SETON                     4041  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Validation if Account Identifier (From) entered
      * CASE: DTL.Account Identifier is Entered
     C           #DACID    IFNE *BLANK                     *IF
      * Determine A/c Type of Account Identifier (From) entered
      * CASE: DTL.Account Identifier is Entered
     C           #DACID    IFNE *BLANK                     *IF
      * Determine Account type - Standard functions  *
     C                     MOVEL#DACID    UKACID           10-Char.A/C ID
     C******               EXSR UKACCK                                    E17819
     C                     EXSR XXIN                                      E17819
     C                     MOVELUKTYPE    WUAISF           Account type
     C*SR***      UKACCK    BEGSR                                         E17819
      * CASE: WRK.Account ID Status Flag is Error
     C           WUAISF    IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#DACID    ZA0034           Account Identif
      * Send message 'A/c Allocated To/From inv'
     C                     MOVEL'GLX0261' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9938  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Account Identifier (From) is Retail or Nostro -> error msg
      * CASE: WRK.Account ID Status Flag is Retail or Nostro
     C           WUAISF    IFEQ '*NOSTRO'                  *IF
     C           WUAISF    OREQ '*RETAIL'
      * Setup message data for message
     C                     MOVEL#DACID    ZA0035           Account Identif
      * Send message 'Nost/Retail A/c not valid'
     C                     MOVEL'GLX0322' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9938  *
      *
     C                     END                             *FI
      * Account Identifier (From) is Customer Number or Shortname
      * CASE: WRK.Account ID Status Flag is Customer No or short name
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
     C                     MOVEL'N'       WUCNSI           Cust No or Shor
      * CASE: WRK.Valid Customer Number is Not Valid
     C           WUVCNB    IFEQ 'N'                        *IF
      * Setup message data for message
     C                     MOVEL#DACID    ZA0036           Account Identif
      * Send message 'Customer not found'
     C                     MOVEL'GLX0084' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9938  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
      * CASE: WRK.Cust No or Short Inval is No Error
     C           WUCNSI    IFEQ 'N'                        *IF
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#DACID    UUACID
     C                     MOVEL#1CUSF    UUCUST
     C                     MOVEL#1CYCF    UUCYCD
     C                     MOVEL#1ACCF    UUACNO
     C                     MOVEL#1ACSF    UUACSN
     C                     MOVEL#1IBCF    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO 10                                           CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELRECI      WURECI           Record ID                          237508
     C                     MOVELCNUM      WUCUSF           Customer Number
     C                     MOVELCCY       WUCYCF           Currency Code
     C                     MOVELACOD      WUACCF           Account Code
     C                     MOVELACSQ      WUACSF           Account Sequence No.
     C                     MOVELBRCA      WUIBCF           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACF           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      *                                                                                       CGL148
      ** Check if:                                                                            CGL148
      **  -- account does not exist but all fields are valid and                              CGL148
      **  -- account type is not retail or nostro                                             CGL148
      **  -- account is not "Title Only"                                                      CGL148
      **  -- if CGL148 is on                                                                  CGL148
      ** then allow the entry (system will open the account during COB)                       CGL148
      *                                                                                       CGL148
     C           A5ACTY    IFNE 'R'                                                           CGL148
     C           A5ACTY    ANDNE'N'                                                           CGL148
      *                                                                                       CGL148
     C           A5TOIN    IFNE 'Y'                                                           CGL148
     C           CGL148    ANDEQ'Y'                                                           CGL148
      *                                                                                       CGL148
     C                     MOVEL#DACID    WUCUSF                                              CGL148
     C                     MOVEL#1CYCF    WUCYCF                                              CGL148
     C                     MOVEL#1ACCF    WUACCF                                              CGL148
     C                     MOVEL#1ACSF    WUACSF                                              CGL148
     C                     MOVEL#1IBCF    WUIBCF                                              CGL148
     C                     MOVELA5ACTY    WUACTY                                              CGL148
     C                     MOVEL*BLANKS   WUBPST                                              CGL148
     C                     MOVEL*BLANKS   WUACCS                                              CGL148
     C                     MOVEL*BLANKS   WUDACO                                              CGL148
     C                     MOVEL*BLANKS   WUACNM                                              CGL148
     C                     MOVEL*BLANKS   WURACF                                              CGL148
     C                     MOVEL*BLANKS   WURRNM                                              CGL148
     C                     MOVEL*BLANKS   WURETB                                              CGL148
      * Save account details                                                                  CGL148
     C           WWERF     IFEQ *BLANKS                                                       CGL148
     C                     MOVELWUCUSF    W@CUSF  6                                           CGL148
     C                     MOVELWUCYCF    W@CYCF  3                                           CGL148
     C                     MOVELWUACCF    W@ACCF 10                                           CGL148
     C                     MOVELWUACSF    W@ACSF  2                                           CGL148
     C                     MOVELWUIBCF    W@IBCF  3                                           CGL148
     C                     ENDIF                                                              CGL148
      *                                                                                       CGL148
     C           WWERF     IFEQ 'Y'                                                           CGL148
     C           WUCUSF    ANDEQW@CUSF                                                        CGL148
     C           WUCYCF    ANDEQW@CYCF                                                        CGL148
     C           WUACCF    ANDEQW@ACCF                                                        CGL148
     C           WUACSF    ANDEQW@ACSF                                                        CGL148
     C           WUIBCF    ANDEQW@IBCF                                                        CGL148
     C                     MOVE *BLANKS   WWERF                                               CGL148
     C                     ELSE                                                               CGL148
     C                     MOVELWUCUSF    W@CUSF                                              CGL148
     C                     MOVELWUCYCF    W@CYCF                                              CGL148
     C                     MOVELWUACCF    W@ACCF                                              CGL148
     C                     MOVELWUACSF    W@ACSF                                              CGL148
     C                     MOVELWUIBCF    W@IBCF                                              CGL148
      * Setup message data for message                                                        CGL148
     C                     MOVEL#DACID    ZA0037                                              CGL148
     C                     MOVEL#1CYCF    ZA0038                                              CGL148
     C                     MOVEL#1ACCF    ZA0039                                              CGL148
     C                     MOVEL#1ACSF    ZA0040                                              CGL148
      * Send Warning - GL Account not open                                                    CGL148
     C                     MOVEL'GLW0054' ZAMSID                                              CGL148
     C                     MOVE 'Y'       WWERF   1                                           CGL148
     C                     EXSR ZASNMS                                                        CGL148
     C                     SETON                     3839                                     CGL148
     C                     SETON                     4041                                     CGL148
     C                     ENDIF                                                              CGL148
     C                     ELSE                                                               CGL148
      * Setup message data for message                                                        CGL148
     C                     MOVEL#DACID    ZA0037                                              CGL148
     C                     MOVEL#1CYCF    ZA0038                                              CGL148
     C                     MOVEL#1ACCF    ZA0039                                              CGL148
     C                     MOVEL#1ACSF    ZA0040                                              CGL148
      * Send message 'Account number not valid'                                               CGL148
     C                     MOVEL'GLX0054' ZAMSID                                              CGL148
     C                     EXSR ZASNMS                                                        CGL148
     C                     SETON                     993839                                   CGL148
     C                     SETON                     4041                                     CGL148
     C                     ENDIF                                                              CGL148
     C                     ENDIF                                                              CGL148
      **                                                                                      CGL148
     C           A5ACTY    IFEQ 'R'                                                           CGL148
     C           A5ACTY    OREQ 'N'                                                           CGL148
      **                                                                                      CGL148
      * Setup message data for message
     C                     MOVEL#DACID    ZA0037           Account Identif
     C                     MOVEL#1CYCF    ZA0038           Currency Code
     C                     MOVEL#1ACCF    ZA0039           Account Code
     C                     MOVEL#1ACSF    ZA0040           Account Seq No.
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993839*
     C                     SETON                     4041  *
     C                     ENDIF                                                              CGL148
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Error if account (from) is closed
      * CASE: WRK.Account status is Closed
     C           WUACCS    IFEQ 'C'                        *IF
     C           WURECI    ANDEQ'C'                                                           237508
      * Setup message data for message
     C                     MOVEL#DACID    ZA0041           Account Identif
     C                     MOVEL#1CYCF    ZA0042           Currency Code
     C                     MOVEL#1ACCF    ZA0043           Account Code
     C                     MOVEL#1ACSF    ZA0044           Account Seq No.
      * Send message 'Account is Closed'
     C                     MOVEL'GLX0126' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     993839*
     C                     SETON                     4041  *
      *
     C                     END                             *FI
      * CASE: WRK.Account status is flagged for closure                                       237508
     C           WUACCS    IFEQ 'C'                        *IF                                237508
     C           WURECI    ANDEQ'D'                                                           237508
      * Setup message data for message                                                        237508
     C                     MOVEL#DACID    ZA0041           Account Identif                    237508
     C                     MOVEL#1CYCF    ZA0042           Currency Code                      237508
     C                     MOVEL#1ACCF    ZA0043           Account Code                       237508
     C                     MOVEL#1ACSF    ZA0044           Account Seq No.                    237508
      * Send message 'Account is flagged for closure'                                         237508
     C**********           MOVEL'GLX0427' ZAMSID                                     237508 AR782538
     C                     MOVEL'GLX0409' ZAMSID                                            AR782538
     C                     EXSR ZASNMS                                                        237508
      *                                                                                       237508
     C                     END                             *FI                                237508
      * If Account Number (From) valid, move details to screen
      * CASE: WRK.Cust No or Short Inval is No Error
     C           WUCNSI    IFEQ 'N'                        *IF
     C                     Z-ADD*ZERO     WURACF           Retail A/c No.
     C                     MOVELWUIBCF    #1IBCF           Input Branch Cd
     C                     MOVELWUCUSF    #1CUSF           Customer Number
     C                     MOVELWUCYCF    #1CYCF           Currency Code
     C                     MOVELWUACCF    #1ACCF           Account Code
     C                     MOVELWUACSF    #1ACSF           Account Seq No.
     C                     Z-ADDWURACF    #1RACF           Retail A/c No.
     C                     MOVEL*BLANK    #DACID           Account Identif
     C                     MOVELWUCUSF    #DACID           Account Identif
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #1CUSF           Customer Number
     C                     Z-ADD*ZERO     #1RACF           Retail A/c No.
     C                     MOVEL*BLANK    #1NNBF           Nostro No. (Ite
     C                     END                             *FI
      * Validate SPF for Branch Code From
      * CASE: DTL.Input Branch Cd  Alloc Fm is entered
     C           #1IBCF    IFNE *BLANK                     *IF
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1IBCF    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     ELSE
      * CASE: *OTHERWISE
      * Val. Action Cde & Bch U/P - Standard functions  *
     C                     CALL 'ZVACTBU'              90  Val. Action Cde
     C**********           PARM 'A'       WQ0047  1        SPF Action Code                    189519
     C                     PARM P2SACD    WQ0047  1        SPF Action Code                    189519
     C                     PARM #1IBCF    WQ0048  3        Branch code
     C           WUSPEC    PARM *ZERO     WQ0049  10       SPF Error Condi
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.SPF Error Condition is One
     C           WUSPEC    IFEQ 1                          *IF
      * Setup message data for message
     C                     MOVEL#1IBCF    ZA0045           Input Branch Cd
      * Send message 'SPF Atn Cde ERR 1 ZVACTBU'
     C                     MOVEL'GLX0186' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9942  *
      *
     C                     ELSE
      * CASE: WRK.SPF Error Condition is Two
     C           WUSPEC    IFEQ 2                          *IF
      * Setup message data for message
     C**********           MOVEL'A'       ZA0046           SPF Action Code                    189519
     C                     MOVELP2SACD    ZA0046           SPF Action Code                    189519
     C                     MOVEL#1IBCF    ZA0047           Input Branch Cd
      * Send message 'SPF Atn Cde ERR 5 ZVACTBU'
     C                     MOVEL'GLX0206' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9942  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1IBCF    ZA0048           Input Branch Cd
      * Send message 'Branch Code Required'
     C                     MOVEL'GLX0201' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9942  *
      *
     C                     END                             *FI
      *================================================================
     CSR         UUEXIT    ENDSR
      /EJECT
     CSR         UVSUBR    BEGSR
      *================================================================
      * Set up Number of Decimals and digits for zalign
      *================================================================
      * CASE: WRK.Number of Decimal Places is Zero
     C           WUNBDP    IFEQ *ZERO                      *IF
     C                     Z-ADD*ZERO     WUZNDE           ZALIGN No Of De
     C                     Z-ADD15        WUZNDI           ZALIGN No Of Di
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is One
     C           WUNBDP    IFEQ 1                          *IF
     C                     Z-ADD1         WUZNDE           ZALIGN No Of De
     C                     Z-ADD14        WUZNDI           ZALIGN No Of Di
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is Two
     C           WUNBDP    IFEQ 2                          *IF
     C                     Z-ADD2         WUZNDE           ZALIGN No Of De
     C                     Z-ADD13        WUZNDI           ZALIGN No Of Di
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is Three
     C           WUNBDP    IFEQ 3                          *IF
     C                     Z-ADD3         WUZNDE           ZALIGN No Of De
     C                     Z-ADD12        WUZNDI           ZALIGN No Of Di
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UVEXIT    ENDSR
      /EJECT
     CSR         UWSUBR    BEGSR
      *================================================================
      * Validate Allocated To A/c
      *================================================================
      * Check Account Identifier To
      * CASE: DTL.Account Identifier To is entered
     C           #DAIDT    IFNE *BLANK                     *IF
      * CASE: DTL.Account Identifier To is select requested
     C           #DAIDT    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
     C                     MOVEL'Y'       WUVCNT           Valid Customer
      * Access Client Details. - Client Details  *
     C*
     C*  Access CLient Details file for the following fields
     C*  Customer No., Customer shortname, DRS Shortname,
     C*  Location, Customer SWIFT I.D.
     C*
     C                     CALL 'AOCUSTR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM #DAIDT    UUCNCD 10        I:Client Key
     C                     PARM           UUCRST  7        O:Key status
     C           D@CUST    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUCRST    WUCRST           Key Status  ber
     C*
     C                     MOVELBBCUST    WUCUST           Customer Number
     C                     MOVELBBCSSN    WUCSSN           Shortname
     C                     MOVELBBDRCS    WUDRCS           DRS Shortname
     C                     MOVELBBLCCD    WULCCD           Location
     C                     MOVELBBCSID    WUCSID           SWIFT ID
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C           WUAPRC    OREQ '*CUSCLS'                                                     CGL148
     C           WUAPRC    OREQ '*CUSDEL'                                                     CGL148
     C                     MOVEL'N'       WUVCNT           Valid Customer
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DAIDT           Account Identif
     C                     MOVELWUCUST    #DAIDT           Account Identif
     C                     MOVELWUCUST    #1CNAT           Customer Number
     C                     END                             *FI
     C                     END                             *FI
      * Check Currency Code To
      * CASE: DTL.Currency Code    Alloc To is not blank
     C           #1CYCT    IFNE *BLANK                     *IF
      * CASE: DTL.Currency Code    Alloc To is select requested
     C           #1CYCT    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCT    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1CYCT    ZA0053           Currency Code
      * Send message 'Currency Code not found'
     C                     MOVEL'GLX0048' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9947  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCYCD    #1CYCT           Currency Code
     C                     END                             *FI
     C                     END                             *FI
      * Check Account Code To
      * CASE: DTL.Account Code     Alloc To is not blank
     C           #1ACCT    IFNE *BLANK                     *IF
      * CASE: DTL.Account Code     Alloc To is select requested
     C           #1ACCT    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Account Codes. - Account Codes  *
     C*
     C*  Access Account codes file for the following fields
     C*  A/c Type, A/c Name, Account Section, Account Subtype
     C*
     C                     MOVEL#1ACCT    UUACCD                          LN0334
     C                     CALL 'AOACODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C**********           PARM           UUACCD  4        I:Account Code              LN0334 CGL029
     C********** D@ACOD    PARM *BLANK    UUFDY            O:Format                           CGL029
     C                     PARM           UUACCD                                              CGL029
     C           D@ACOD    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA5ACCD    WUACCD           A/c Code       LN0334
     C                     MOVELA5ACTY    WUACTY           A/C Type
     C                     MOVELA5ACCN    WUACCN           A/c Name
     C                     MOVELA5ACSC    WUACSC           A/c Section
     C                     MOVELA5ACST    WUACST           A/c Sub-Type
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1ACCT    ZA0054           Account Code
      * Send message 'Account Code not found'
     C                     MOVEL'GLX0046' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9948  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUACCD    #1ACCT           Account Code
     C                     END                             *FI
     C                     END                             *FI
      * Validate Branch Code To
      * CASE: DTL.Input Branch Cd  Alloc To is entered
     C           #1IBCT    IFNE *BLANK                     *IF
      * CASE: DTL.Input Branch Cd  Alloc To is select requested
     C           #1IBCT    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1IBCT    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1IBCT    ZA0055           Input Branch Cd
      * Send message 'Branch Code not found'
     C                     MOVEL'GLX0045' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9950  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUBRCD    #1IBCT           Input Branch Cd
     C                     END                             *FI
      * CASE: DTL.Input Branch Cd  Alloc To NE DTL.Input Branch Cd  Alloc Fm
     C           #1IBCT    IFNE #1IBCF                     *IF
      * CASE: DTL.Multiple Branch Batch is No
     C           #1MBRB    IFEQ 'N'                        *IF
      * Setup message data for message
     C                     MOVEL#1IBCT    ZA0056           Input Branch Cd
      * Send message 'MBrch btch ind must be Y'
     C                     MOVEL'GLX0334' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9950  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Validate Account Sequence Number To
      * CASE: DTL.Account Seq No.  Alloc To is not blank
     C           #1ASNT    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#1ASNT    WUZASF           ZALIGN Screen F
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0061  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0062 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0063  10       ZALIGN No Of De
     C                     PARM 2         WQ0064  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0065 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: PGM.*Return code is Zalign Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#1ASNT    ZA0057           Account Seq No.
      * Send message 'Account Seq Numeric'
     C                     MOVEL'GLX0224' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9949  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Zalign Account Sequence - Journal Entry Posting  *
     C                     MOVE WUZASF    #1ASNT
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UWEXIT    ENDSR
      /EJECT
     CSR         UXSUBR    BEGSR
      *================================================================
      * Validate Allocated To A/c
      *================================================================
      * Error message if Account Allocated To not entered
      * CASE: DTL.Account Identifier To is blank
     C           #DAIDT    IFEQ *BLANK                     *IF
      * CASE: DTL.Currency Code    Alloc To is blank
     C           #1CYCT    IFEQ *BLANK                     *IF
      * CASE: DTL.Account Code     Alloc To is blank
     C           #1ACCT    IFEQ *BLANK                     *IF
      * CASE: DTL.Account Seq No.  Alloc To is blank
     C           #1ASNT    IFEQ *BLANK                     *IF
      * CASE: DTL.Input Branch Cd  Alloc To is blank
     C           #1IBCT    IFEQ *BLANK                     *IF
      * Setup message data for message
     C                     MOVEL#DAIDT    ZA0058           Account Identif
     C                     MOVEL#1CYCT    ZA0059           Currency Code
     C                     MOVEL#1ACCT    ZA0060           Account Code
     C                     MOVEL#1ASNT    ZA0061           Account Seq No.
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     994647*
     C                     SETON                     4849  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Validation if Account Identifier (To) entered
      * CASE: DTL.Account Identifier To is entered
     C           #DAIDT    IFNE *BLANK                     *IF
      * Determine A/c Type of Account Identifier (To) entered
      * CASE: DTL.Account Identifier To is entered
     C           #DAIDT    IFNE *BLANK                     *IF
      * Determine Account type - Standard functions  *
     C                     MOVEL#DAIDT    UKACID           10-Char.A/C ID
     C******               EXSR UKACCK                                    E17819
     C                     EXSR XXIN                                      E17819
     C                     MOVELUKTYPE    WUAISF           Account type
     C*SR***      UKACCK    BEGSR                                         E17819
      * CASE: WRK.Account ID Status Flag is Error
     C           WUAISF    IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#DAIDT    ZA0062           Account Identif
      * Send message 'A/c Allocated To/From inv'
     C                     MOVEL'GLX0261' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9946  *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Account Identifier (To) is Retail or Nostro -> error msg
      * CASE: WRK.Account ID Status Flag is Retail or Nostro
     C           WUAISF    IFEQ '*NOSTRO'                  *IF
     C           WUAISF    OREQ '*RETAIL'
      * Setup message data for message
     C                     MOVEL#DAIDT    ZA0063           Account Identif
      * Send message 'Nost/Retail A/c not valid'
     C                     MOVEL'GLX0322' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9946  *
      *
     C                     END                             *FI
      * Account Identifier (To) is Customer Number or Shortname
      * CASE: WRK.Account ID Status Flag is Customer No or short name
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
     C                     MOVEL'N'       WUCNSI           Cust No or Shor
      * CASE: WRK.Valid Customer Number To is not valid
     C           WUVCNT    IFEQ 'N'                        *IF
      * Setup message data for message
     C                     MOVEL#DAIDT    ZA0064           Account Identif
      * Send message 'Customer not found'
     C                     MOVEL'GLX0084' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9946  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
      * CASE: WRK.Cust No or Short Inval is No Error
     C           WUCNSI    IFEQ 'N'                        *IF
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#DAIDT    UUACID
     C                     MOVEL#1CNAT    UUCUST
     C                     MOVEL#1CYCT    UUCYCD
     C                     MOVEL#1ACCT    UUACNO
     C                     MOVEL#1ASNT    UUACSN
     C                     MOVEL#1IBCT    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELRECI      WURECI           Record IF                          237508
     C                     MOVELCNUM      WUCNAT           Customer Number
     C                     MOVELCCY       WUCYCT           Currency Code
     C                     MOVELACOD      WUACCT           Account Code
     C                     MOVELACSQ      WUASNT           Account Sequence No.
     C                     MOVELBRCA      WUIBCT           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACT           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      *                                                                                       CGL148
      ** Check if:                                                                            CGL148
      **  -- account does not exist but all fields are valid and                              CGL148
      **  -- account type is not retail or nostro                                             CGL148
      **  -- account is not "Title Only"                                                      CGL148
      **  -- if CGL148 is on                                                                  CGL148
      ** then allow the entry (system will open the account during COB)                       CGL148
      *                                                                                       CGL148
     C           A5ACTY    IFNE 'R'                                                           CGL148
     C           A5ACTY    ANDNE'N'                                                           CGL148
      *                                                                                       CGL148
     C           A5TOIN    IFNE 'Y'                                                           CGL148
     C           CGL148    ANDEQ'Y'                                                           CGL148
      *                                                                                       CGL148
     C                     MOVEL#DAIDT    WUCNAT                                              CGL148
     C                     MOVEL#1CYCT    WUCYCT                                              CGL148
     C                     MOVEL#1ACCT    WUACCT                                              CGL148
     C                     MOVEL#1ASNT    WUASNT                                              CGL148
     C                     MOVEL#1IBCT    WUIBCT                                              CGL148
     C                     MOVELA5ACTY    WUACTY                                              CGL148
     C                     MOVEL*BLANKS   WUBPST                                              CGL148
     C                     MOVEL*BLANKS   WUACCS                                              CGL148
     C                     MOVEL*BLANKS   WUDACO                                              CGL148
     C                     MOVEL*BLANKS   WUACNM                                              CGL148
     C                     MOVEL*BLANKS   WURACT                                              CGL148
     C                     MOVEL*BLANKS   WURRNM                                              CGL148
     C                     MOVEL*BLANKS   WURETB                                              CGL148
      * Save account details                                                                  CGL148
     C           WWERT     IFEQ *BLANKS                                                       CGL148
     C                     MOVELWUCNAT    W@CUST  6                                           CGL148
     C                     MOVELWUCYCT    W@CYCT  3                                           CGL148
     C                     MOVELWUACCT    W@ACCT 10                                           CGL148
     C                     MOVELWUASNT    W@ACST  2                                           CGL148
     C                     MOVELWUIBCT    W@IBCT  3                                           CGL148
     C                     ENDIF                                                              CGL148
     C           WWERT     IFEQ 'Y'                                                           CGL148
     C           WUCNAT    ANDEQW@CUST                                                        CGL148
     C           WUCYCT    ANDEQW@CYCT                                                        CGL148
     C           WUACCT    ANDEQW@ACCT                                                        CGL148
     C           WUASNT    ANDEQW@ACST                                                        CGL148
     C           WUIBCT    ANDEQW@IBCT                                                        CGL148
     C                     MOVE *BLANKS   WWERT                                               CGL148
     C                     ELSE                                                               CGL148
     C                     MOVELWUCNAT    W@CUST                                              CGL148
     C                     MOVELWUCYCT    W@CYCT                                              CGL148
     C                     MOVELWUACCT    W@ACCT                                              CGL148
     C                     MOVELWUASNT    W@ACST                                              CGL148
     C                     MOVELWUIBCT    W@IBCT                                              CGL148
      * Setup message data for message                                                        CGL148
     C                     MOVEL#DAIDT    ZA0058                                              CGL148
     C                     MOVEL#1CYCT    ZA0059                                              CGL148
     C                     MOVEL#1ACCT    ZA0060                                              CGL148
     C                     MOVEL#1ASNT    ZA0061                                              CGL148
      * Send Warning - GL Account not open                                                    CGL148
     C                     MOVEL'GLW0054' ZAMSID                                              CGL148
     C                     MOVE 'Y'       WWERT   1                                           CGL148
     C                     EXSR ZASNMS                                                        CGL148
     C                     SETON                     4647                                     CGL148
     C                     SETON                     4849                                     CGL148
     C                     ENDIF                                                              CGL148
     C                     ELSE                                                               CGL148
      * Setup message data for message                                                        CGL148
     C                     MOVEL#DAIDT    ZA0058                                              CGL148
     C                     MOVEL#1CYCT    ZA0059                                              CGL148
     C                     MOVEL#1ACCT    ZA0060                                              CGL148
     C                     MOVEL#1ASNT    ZA0061                                              CGL148
      * Send message 'Account number not valid'                                               CGL148
     C                     MOVEL'GLX0054' ZAMSID                                              CGL148
     C                     EXSR ZASNMS                                                        CGL148
     C                     SETON                     994647                                   CGL148
     C                     SETON                     4849                                     CGL148
     C                     ENDIF                                                              CGL148
     C                     ENDIF                                                              CGL148
      **                                                                                      CGL148
     C           A5ACTY    IFEQ 'R'                                                           CGL148
     C           A5ACTY    OREQ 'N'                                                           CGL148
      **                                                                                      CGL148
      * Setup message data for message
     C                     MOVEL#DAIDT    ZA0065           Account Identif
     C                     MOVEL#1CYCT    ZA0066           Currency Code
     C                     MOVEL#1ACCT    ZA0067           Account Code
     C                     MOVEL#1ASNT    ZA0068           Account Seq No.
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     994647*
     C                     SETON                     4849  *
     C                     ENDIF                                                              CGL148
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Error if Account (To) is closed
      * CASE: WRK.Account status is Closed
     C           WUACCS    IFEQ 'C'                        *IF
     C           WURECI    ANDEQ'C'                                                           237508
      * Setup message data for message
     C                     MOVEL#DAIDT    ZA0069           Account Identif
     C                     MOVEL#1CYCT    ZA0070           Currency Code
     C                     MOVEL#1ACCT    ZA0071           Account Code
     C                     MOVEL#1ASNT    ZA0072           Account Seq No.
      * Send message 'Account is Closed'
     C                     MOVEL'GLX0126' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     994647*
     C                     SETON                     4849  *
     C                     ELSE                                           CAC001
      *                                                                   CAC001
      **  If Analytical Accounting module is on, To A/C must not be a     CAC001
      **  Retail or Nostro account                                        CAC001
      *                                                                   CAC001
     C           WUN0ST    IFEQ 'Y'                                       CAC001
     C           WUACTY    IFEQ 'R'                                       CAC001
     C           WUACTY    OREQ 'N'                                       CAC001
     C                     MOVEL'GLX0393' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     SETON                     994647               CAC001
     C                     SETON                     4849                 CAC001
     C                     END                                            CAC001
     C                     END                                            CAC001
      *
     C                     END                             *FI
      * CASE: WRK.Account status is flagged for closure                                       237508
     C           WUACCS    IFEQ 'C'                        *IF                                237508
     C           WURECI    ANDEQ'D'                                                           237508
      * Setup message data for message                                                        237508
     C                     MOVEL#DACID    ZA0041           Account Identif                    237508
     C                     MOVEL#1CYCF    ZA0042           Currency Code                      237508
     C                     MOVEL#1ACCF    ZA0043           Account Code                       237508
     C                     MOVEL#1ACSF    ZA0044           Account Seq No.                    237508
      * Send message 'Account is flagged for closure'                                         237508
     C**********           MOVEL'GLX0427' ZAMSID                                     237508 AR782538
     C                     MOVEL'GLX0409' ZAMSID                                            AR782538
     C                     EXSR ZASNMS                                                        237508
      *                                                                                       237508
     C                     END                             *FI                                237508
      * Check Account Number (To)
      * CASE: WRK.Cust No or Short Inval is No Error
     C           WUCNSI    IFEQ 'N'                        *IF
     C                     MOVELWUIBCT    #1IBCT           Input Branch Cd
     C                     MOVELWUCNAT    #1CNAT           Customer Number
     C                     MOVELWUCYCT    #1CYCT           Currency Code
     C                     MOVELWUACCT    #1ACCT           Account Code
     C                     MOVELWUASNT    #1ASNT           Account Seq No.
     C                     Z-ADDWURACT    #1RACT           Retail A/c No.
     C                     MOVEL*BLANK    #DAIDT           Account Identif
     C                     MOVELWUCNAT    #DAIDT           Account Identif
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #1CNAT           Customer Number
     C                     Z-ADD*ZERO     #1RACT           Retail A/c No.
     C                     MOVEL*BLANK    #1NNBT           Nostro No. (Ite
     C                     END                             *FI
      * Validate SPF for Branch Code To
      * CASE: DTL.Input Branch Cd  Alloc To is entered
     C           #1IBCT    IFNE *BLANK                     *IF
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1IBCT    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     ELSE
      * CASE: *OTHERWISE
      * Val. Action Cde & Bch U/P - Standard functions  *
     C                     CALL 'ZVACTBU'              90  Val. Action Cde
     C**********           PARM 'A'       WQ0066  1        SPF Action Code                    189519
     C                     PARM P2SACD    WQ0066  1        SPF Action Code                    189519
     C                     PARM #1IBCT    WQ0067  3        Branch code
     C           WUSPEC    PARM *ZERO     WQ0068  10       SPF Error Condi
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.SPF Error Condition is One
     C           WUSPEC    IFEQ 1                          *IF
      * Setup message data for message
     C                     MOVEL#1IBCT    ZA0073           Input Branch Cd
      * Send message 'SPF Atn Cde ERR 1 ZVACTBU'
     C                     MOVEL'GLX0186' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9950  *
      *
     C                     ELSE
      * CASE: WRK.SPF Error Condition is Two
     C           WUSPEC    IFEQ 2                          *IF
      * Setup message data for message
     C**********           MOVEL'A'       ZA0074           SPF Action Code                    189519
     C                     MOVELP2SACD    ZA0074           SPF Action Code                    189519
     C                     MOVEL#1IBCT    ZA0075           Input Branch Cd
      * Send message 'SPF Atn Cde ERR 5 ZVACTBU'
     C                     MOVEL'GLX0206' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9950  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1IBCT    ZA0076           Input Branch Cd
      * Send message 'Branch Code Required'
     C                     MOVEL'GLX0201' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9950  *
      *
     C                     END                             *FI
      *================================================================
     CSR         UXEXIT    ENDSR
      /EJECT
     CSR         UYSUBR    BEGSR
      *================================================================
      * Validate Narrative
      *================================================================
      * Check Narrative - Standard functions  *
     C*  Check Narrative for Narrative code
     C*
     C                     MOVE #DNRTV    URNARR 28        Narrative slice
      *
     C           #DNRTV    IFNE *BLANK                     IF ¬BLANK
     C           URNARR    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*CODE  ' WUNRST             Code entered
     C                     MOVEL#DNRTV    WUNVCD             Narrative code
     C                     ELSE                            EL ¬BLANK
     C                     MOVE '*TEXT  ' WUNRST             Narrative text
     C                     MOVE *BLANK    WUNVCD             No Narr.code
     C                     END                             FI
     C                     ELSE                            EL BLANK
     C                     MOVE '*ERROR ' WUNRST             No narrative
     C                     MOVE *BLANK    WUNVCD             No Narr.code
     C                     END                             FI
      *
      * CASE: WRK.Narrative status is Narrative code entered
     C           WUNRST    IFEQ '*CODE'                    *IF
      * Access Narrative. - Narrative Codes  *
     C*
     C*  Access Narrative codes file for the following fields
     C*  Narrative Code, Narrative Description
     C*
     C                     MOVELWUNVCD    UUNVCD
     C                     CALL 'AONARRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUNVCD  2        I:Narrative Code
     C           D@NARR    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELALNVCD    WUNVCD           Narrative Code
     C                     MOVELALDON     WUDON            Description
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#DNRTV    ZA0077           Narrative
      * Send message 'Narrative Code not found'
     C                     MOVEL'GLX0049' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9951  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DNRTV           Narrative
     C                     MOVELWUNVCD    #DNRTV           Narrative
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL#DNRTV    WUNRTV           Narrative
      *================================================================
     CSR         UYEXIT    ENDSR
      /EJECT
     CSR         UZSUBR    BEGSR
      *================================================================
      * Validate Value Date
      *================================================================
      * CASE: DTL.Value date (display) is Date entered
     C           #DVDDS    IFNE *BLANK                     *IF
     C                     MOVEL#DVDDS    WUWVDD           Work Value Date
      * Check VDate Blank Entries - Standard functions  *
     C                     CALL 'GL0131U'              90  Check VDate Bla
     C           WUWVDD    PARM WUWVDD    WQ0069  6        Value date (dis
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Check Numeric - Standard functions  *
     C                     MOVE *IN20     UUIN20  1
     C                     MOVE *IN21     UUIN21  1
     C           *LIKE     DEFN WUWVDD    UUVLDT+ 1
     C                     MOVELWUWVDD    UUVLDT
     C                     MOVE '0'       UUVLDT
     C                     TESTN          UUVLDT       21
     C           *IN21     IFEQ '1'
     C                     MOVEL'0'       UUVLDT
     C                     END
     C                     TESTN          UUVLDT     20
     C           *IN20     IFEQ '0'
     C                     MOVE '*NUMERR' W0RTN
     C                     ELSE
     C                     MOVE *BLANKS   W0RTN
     C                     END
     C                     MOVE UUIN20    *IN20
     C                     MOVE UUIN21    *IN21
      * CASE: PGM.*Return code is *Numeric Error
     C           W0RTN     IFEQ '*NUMERR'                  *IF
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0078           Value date (dis
      * Send message 'Value Date not valid 1'
     C                     MOVEL'GLX0109' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9952  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * CASE: WRK.Date (numeric format) is Gt 30
     C           WUDTNF    IFGT 30                         *IF
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0070  7        *Return code
     C                     PARM WUDTNF    WQ0071  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0072  1        Date Format fla
     C           WUVLDT    PARM *ZERO     WQ0073  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     99    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Setup message data for message
     C                     MOVEL#DVDDS    ZA0079           Value date (dis
      * Send message 'Value Date not valid 2'
     C                     MOVEL'GLX0110' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9952  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    #DVDDS           Value date (dis
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    #DVDDS           Value date (dis
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM WURDNO    WQ0074  50       Runday Number
     C                     PARM WUDTFF    WQ0075  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0076  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0077  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    #DVDDS
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #DVDDS           Value date (dis
     C                     END                             *FI
      *================================================================
     CSR         UZEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Select existing record
      *================================================================
      * Name search required?
     C                     MOVEL#1BTNB    WK1X01  1        Batch number
     C           WK1X01    IFEQ '?'                        Batch number
     C                     CALL 'GL0140S'              90  *
     C                     PARM           W0RTN   7
     C           #1BTNB    PARM #1BTNB    WQ0023  3        Batch number
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      *================================================================
     CSR         VAEXIT    ENDSR
     CSR         XXIN      BEGSR                                          E17819
      *====================================================
      * Determine Account type
      *----------------------------------------------------
      *
     C                     MOVE *IN90     UKSI90  1        Save indicator
      *
      * 1. Check for invalid input :
      *
     C           UKACID    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*ERROR*' UKTYPE  7          Error
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 2. Check for Retail A/C :
      *
     C                     TESTN          UKACID     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF ALL NUMERIC
     C                     MOVE '*RETAIL' UKTYPE             Retail A/C
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 3. Check for Customer number :
      *
     C                     TESTN          UKACF6     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF ALL NUMERIC
     C           UKACL4    IFEQ *BLANK                     IF 6 DIGITS ONLY
     C                     MOVE '*NUMBER' UKTYPE             Cust.number
     C                     ELSE                            EL INVALID
     C                     MOVE '*ERROR*' UKTYPE  7          Error
     C                     END                             FI
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 4. Check for Nostro :
      *
     C                     TESTN          UKACM2     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF NUMERIC
     C           UKACA1    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA1    ANDLT'0'                         AND ¬NUMERIC
     C           UKACA2    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA2    ANDLT'0'                         AND ¬NUMERIC
     C           UKACA3    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA3    ANDLT'0'                         AND ¬NUMERIC
     C           UKACL5    ANDEQ*BLANK                      AND NO MORE
     C                     MOVE '*NOSTRO' UKTYPE             Nostro
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 5. Check for Customer Shortname :
      *
     C           UKACF1    IFLT '0'                        IF ¬NUMERIC
     C           UKACF1    ANDNE*BLANK                      AND ¬BLANK
     C                     MOVE '*SHNAME' UKTYPE             Shortname
     C                     ELSE                            EL NUMERIC
     C                     MOVE '*ERROR*' UKTYPE             Invalid
     C                     END                             FI
      *          _____________
     C           UKSK01    TAG
      *          ~~~~~~~~~~~~~
     C                     MOVE UKSI90    *IN90            Restore ind.
      *
      *----------------------------------------------------
      *
      *====================================================
     C*SR****     UKEXIT    ENDSR                                         E17819
     CSR         XXOUT     ENDSR                                          E17819
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGM     IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGM
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGM
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Cancel and exit from key screen
      *================================================================
      * USER: Exit program processing
      * Set up return code for F3 being pressed (checked on returning to
      * GL0163D)
      * CASE: KEY.*CMD key is *Exit
     C           *IN03     IFEQ '1'                        *IF
     C                     MOVEL'Y2U9999' P0RTN            *Return code
     C                     EXSR ZYEXPG
     C                     END                             *FI
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * ROLLBACK any uncommitted DBF changes
     C                     ROLBK                       90
      *
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      ****************************************************************                        CRE020
      /EJECT                                                                                  CRE020
      *****************************************************************                       CRE020
      *                                                               *                       CRE020
      *  SRIDXT - Handles the advice index of the current             *                       CRE020
      *           transaction.                                        *                       CRE020
      *                                                               *                       CRE020
      *****************************************************************                       CRE020
     C           SRIDXT    BEGSR                                                              CRE020
      *                                                                                       CRE020
      ** Only process accepted transactions.                                                  CRE020
      *                                                                                       CRE020
     C           BRBTSF    IFEQ 'A'                                                           CRE020
      *                                                                                       CRE020
      ** Process all available batches.                                                       CRE020
      *                                                                                       CRE020
     C                     MOVE BRBTNB    KBTNB   3                                           CRE020
      *                                                                                       CRE020
     C           KBTNB     SETLLGLJENPL1                                                      CRE020
     C           KBTNB     READEGLJENPL1                 38                                   CRE020
      *                                                                                       CRE020
     C           *IN38     DOWNE*ON                                                           CRE020
      *                                                                                       CRE020
     C                     MOVE *BLANKS   WREFNO  6                                           CRE020
     C                     MOVELBTBTNB    WREFNO                                              CRE020
     C                     MOVE BTBINB    WREFNO                                              CRE020
     C                     MOVE *BLANKS   RREFNO                                              CRE020
     C                     MOVELWREFNO    RREFNO                                              CRE020
     C                     MOVE *BLANKS   RPRGMN                                              CRE020
     C                     MOVEL'GL0163R' RPRGMN                                              CRE020
     C                     MOVE *BLANKS   RSEQNO                                              CRE020
     C                     MOVE 'ME'      RTRTYP                                              CRE020
     C                     MOVE 'I'       RCHTYP                                              CRE020
     C                     MOVE 'Y'       RAUTHI                                              CRE020
     C                     MOVE 'N'       RSAPIN                                              CRE020
     C                     MOVE *BLANKS   RENARR                                              CRE020
     C                     OPEN READVCL1                                                      CRE020
     C                     WRITEREADVCD0                                                      CRE020
     C                     CLOSEREADVCL1                                                      CRE020
      *                                                                                       CRE020
     C           KBTNB     READEGLJENPL1                 38                                   CRE020
     C                     ENDDO                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDSR                                                              CRE020
      *****************************************************************                       CRE020
      /EJECT                                                                                  CRE020
      *****************************************************************                       CRE020
      *                                                               *                       CRE020
      *  *PSSR - Program Exception Subroutine                         *                       CRE020
      *                                                               *                       CRE020
      *****************************************************************                       CRE020
     C           *PSSR     BEGSR                                                              CRE020
      *                                                                                       CRE020
     C                     DUMP                                                               CRE020
      *                                                                                       CRE020
     C                     CALL 'DBERRCTL'                                                    CRE020
      *                                                                                       CRE020
     C                     MOVE *ON       *INU7                                               CRE020
     C                     MOVE *ON       *INU8                                               CRE020
     C                     MOVE *ON       *INLR                                               CRE020
      *                                                                                       CRE020
     C                     RETRN                                                              CRE020
      *                                                                                       CRE020
     C                     ENDSR                                                              CRE020
      *****************************************************************                       CRE020
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
      *                                                                                       216891
      ** Clear program message queue                                                          216891
      *                                                                                       216891
     C                     CALL 'ZA0250'                                                      216891
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0163RCP1                                           S01408
     C*                                                                   S01408
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field User Default Branch Code
     C                     MOVEL*BLANK    WUUDBC  3
      * Define work field Access Pgm Return Code
     C                     MOVEL*BLANK    WUAPRC  7
      * Define work field Branch Code - Alpha
     C                     MOVEL*BLANK    WUBCDA  3
      * Define work field Company Code
     C                     MOVEL*BLANK    WUCMCD  3
      * Define work field Location Code
     C                     MOVEL*BLANK    WULCCD  3
      * Define work field Due From Account Code
     C**********           MOVEL*BLANK    WUDFAC  4                                           CGL029
     C                     MOVE *BLANKS   WUDFAC 10                                           CGL029
      * Define work field Due To Account Code
     C**********           MOVEL*BLANK    WUDTAC  4                                           CGL029
     C                     MOVE *BLANKS   WUDTAC 10                                           CGL029
      * Define work field Branch Internal Customer
     C                     MOVEL*BLANK    WUBICN  6
      * Define work field Branch Name
     C                     MOVEL*BLANK    WUBRNM 30
      * Define work field Global Branch Code
     C                     MOVEL*BLANK    WUGBCD  3
      * Define work field Branch Shortname
     C                     MOVEL*BLANK    WUBRSN  3
      * Define work field Multibranching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Define work field Output Branch
     C                     MOVEL*BLANK    WULGST  1
      * Define work field User Default Department
     C                     MOVEL*BLANK    WUUDDP  3
      * Define work field Dept Code
     C                     MOVEL*BLANK    WUDPCD  3
      * Define work field Dept Name
     C                     MOVEL*BLANK    WUDPNM 30
      * Define work field Runday Number
     C                     Z-ADD*ZERO     WURDNO  50
      * Define work field Date Format flag
     C                     MOVEL*BLANK    WUDTFF  1
      * Define work field Date (numeric format)
     C                     Z-ADD*ZERO     WUDTNF  60
      * Define work field Midas Run Date
     C                     MOVEL*BLANK    WUDDCD  7
      * Define work field Local Currency code
     C                     MOVEL*BLANK    WULCCY  3
      * Define work field Branch code
     C                     MOVEL*BLANK    WUBRCD  3
      * Define work field Store Multiple Branch Ind
     C                     MOVEL*BLANK    WUSMBI  1
      * Define work field Spread Profile Code used
     C                     MOVEL*BLANK    WUSPCU  1
      * Define work field ZALIGN Screen Fun Field
     C                     MOVEL*BLANK    WUZASF 16
      * Define work field ZALIGN File Field
     C                     MOVEL*BLANK    WUZAFF 16
      * Define work field Error Code
     C                     MOVEL*BLANK    WUERCD  1
      * Define work field Currency code
     C                     MOVEL*BLANK    WUCYCD  3
      * Define work field Currency Name
     C                     MOVEL*BLANK    WUCYNM 14
      * Define work field Number of Decimal Places
     C                     Z-ADD*ZERO     WUNBDP  10
      * Define work field Nostro Shortname
     C                     MOVEL*BLANK    WUNOSN 10
      * Define work field ZALIGN No Of Decimals
     C                     Z-ADD*ZERO     WUZNDE  10
      * Define work field ZSEDIT Numeric Input
     C                     Z-ADD*ZERO     WUZSNI 150
      * Define work field ZSEDIT Char Output(21)
     C                     MOVEL*BLANK    WUZSCO 21
      * Obtain default message file
     C           *NAMVAR   DEFN MIMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field SPF Error Condition
     C                     Z-ADD*ZERO     WUSPEC  10
      * Define work field Control Total
     C                     Z-ADD*ZERO     WUCTTL 100
      * Define work field No. of Profit Centres
     C                     Z-ADD*ZERO     WUNUPC  20
      * Define work field Valid Customer Number
     C                     MOVEL*BLANK    WUVCNB  1
      * Define work field Client key identity
     C                     MOVEL*BLANK    WUCRST  7
      * Define work field Customer number
     C                     MOVEL*BLANK    WUCUST  6
      * Define work field Customer Shortname
     C                     MOVEL*BLANK    WUCSSN 10
      * Define work field DRS Customer Shortname
     C                     MOVEL*BLANK    WUDRCS  7
      * Define work field Customer Swift Id
     C                     MOVEL*BLANK    WUCSID 12
      * Define work field Account code
     C**********           MOVEL*BLANK    WUACCD  4                                           CGL029
     C                     MOVE *BLANKS   WUACCD 10                                           CGL029
      * Define work field Account type
     C                     MOVEL*BLANK    WUACTY  1
      * Define work field Account Code Name
     C                     MOVEL*BLANK    WUACCN 25
      * Define work field Account Section
     C                     MOVEL*BLANK    WUACSC  2
      * Define work field Account Sub-type
     C                     MOVEL*BLANK    WUACST  1
      * Define work field Account ID Status Flag
     C                     MOVEL*BLANK    WUAISF  7
      * Define work field Cust No or Short Inval
     C                     MOVEL*BLANK    WUCNSI  1
      * Define work field Record ID                                                           237508
     C                     MOVE *BLANK    WURECI  1                                           237508
      * Define work field Customer Number  Alloc Fm
     C                     MOVEL*BLANK    WUCUSF  6
      * Define work field Currency Code    Alloc Fm
     C                     MOVEL*BLANK    WUCYCF  3
      * Define work field Account Code     Alloc Fm
     C**********           MOVEL*BLANK    WUACCF  4                                           CGL029
     C                     MOVE *BLANKS   WUACCF 10                                           CGL029
      * Define work field Account Seq No.  Alloc Fm
     C                     MOVEL*BLANK    WUACSF  2
      * Define work field Input Branch Cd  Alloc Fm
     C                     MOVEL*BLANK    WUIBCF  3
      * Define work field Account subtype
     C                     MOVEL*BLANK    WUBPST  1
      * Define work field Account status
     C                     MOVEL*BLANK    WUACCS  1
      * Define work field Date account opened
     C                     Z-ADD*ZERO     WUDACO  50
      * Define work field Account name
     C                     MOVEL*BLANK    WUACNM 20
      * Define work field Retail A/c No.   Alloc Fm
     C                     Z-ADD*ZERO     WURACF 100
      * Define work field Retail Indicators   MIDAS
     C                     MOVEL*BLANK    WURETB  1
      *                                                                   CAC001
      **  Define work field for Profit Centre                             CAC001
      *                                                                   CAC001
     C                     MOVEL*BLANK    WUPRFC  4                       CAC001
      * Define work field Relative rec no of memos
     C                     Z-ADD*ZERO     WURRNM  50
      * Define work field Profit Centre Code
     C                     MOVEL*BLANK    WUPCCD  4
      * Define work field Profit Centre Description
     C                     MOVEL*BLANK    WUPCDS 30
      * Define work field ZALIGN No Of Digits
     C                     Z-ADD*ZERO     WUZNDI  20
      * Define work field Valid Customer Number To
     C                     MOVEL*BLANK    WUVCNT  1
      * Define work field Customer Number  Alloc To
     C                     MOVEL*BLANK    WUCNAT  6
      * Define work field Currency Code    Alloc To
     C                     MOVEL*BLANK    WUCYCT  3
      * Define work field Account Code     Alloc To
     C**********           MOVEL*BLANK    WUACCT  4                                           CGL029
     C                     MOVE *BLANKS   WUACCT 10                                           CGL029
      * Define work field Account Seq No.  Alloc To
     C                     MOVEL*BLANK    WUASNT  2
      * Define work field Input Branch Cd  Alloc To
     C                     MOVEL*BLANK    WUIBCT  3
      * Define work field Retail A/c No.   Alloc To
     C                     Z-ADD*ZERO     WURACT 100
      * Define work field Narrative code
     C                     MOVEL*BLANK    WUNVCD  2
      * Define work field Narrative status
     C                     MOVEL*BLANK    WUNRST  7
      * Define work field Description of Narrative
     C                     MOVEL*BLANK    WUDON  30
      * Define work field Narrative
     C                     MOVEL*BLANK    WUNRTV 30
      * Define work field Work Value Date (display)
     C                     MOVEL*BLANK    WUWVDD  6
      * Define work field Value date
     C                     Z-ADD*ZERO     WUVLDT  50
      * Define work field Hash integer input
     C                     Z-ADD*ZERO     WUHIIN 150
      * Define work field Hash decimal input
     C                     Z-ADD*ZERO     WUHDIN  30
      * Define work field Hash item no.input
     C                     Z-ADD*ZERO     WUHINI  30
      * Define work field Exit option
     C                     MOVEL*BLANK    WUEXTO  1
      * Define work field Hash integer calculated
     C                     Z-ADD*ZERO     WUHICC 150
      * Define work field Hash decimal calculated
     C                     Z-ADD*ZERO     WUHDCC  30
      * Define work field Hash item no.calculated
     C                     Z-ADD*ZERO     WUHINC  30
      * Define work field Batch status flag
     C                     MOVEL*BLANK    WUBTSF  1
      * Define work field Midas Rundate
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Setup Complete
     C                     MOVEL*BLANK    WUSUCP  1
      * Define work field User
     C                     MOVEL*BLANK    WUUSID 10
      * Define work field User Bank Level Authority
     C                     MOVEL*BLANK    WUUBLA  1
      *                                                                   CAC001
      **  Define work field Analytical Accounting module                  CAC001
      *                                                                   CAC001
     C                     MOVEL*BLANK    WUN0ST  1                       CAC001
      * Open files
      * Begin commit control
     C                     CALL 'Y2BGCMC'
     C                     PARM           W0RTN   7
     C           W0RTN     IFNE *BLANK
     C           W0RTN     ANDNE'CPF8351'
     C                     EXSR ZYEXPG
     C                     END
     C                     OPEN GLJENHL0
     C/COPY WNCPYSRC,GL0163RC10
      * Select initial mode
     C           @1NROP    IFEQ *ZERO
      * Add mode
     C                     MOVEL'ADD'     W0PMD   3
     C                     ELSE
      * Change mode
     C                     MOVEL'CHG'     W0PMD
     C                     END
      * USER: Initialise program
      * Standard RPG Creation Par - Standard functions  *
      * Last Amend Box - GL0163R - Journal Entry Header  *
      * Copyright notice - Standard functions  *
      * Ftr F3=Exit or Main Menu - Standard functions  *
     C                     MOVEALNE,1     ##CTX1                          S01229
      * Data Structures
      * Define 200 Byte Dummy DS - Standard functions  *
      * Define 800 Byte Dummy DS - Standard functions  *
      * Account Codes DS - Account Codes  *
      * Account Details DS - Standard functions  *
      * Branch Codes DS - Branch Codes  *
      * Client Details DS - Client Details  *
      * Currency Codes DS - Currency Codes  *
      * Department Codes DS - Department Codes  *
      * Nostro Details DS - Nostro Details  *
      * Profit Centre DS - Profit Centres  *
      * Narrative Codes DS - Narrative Codes  *
      * Declare Bank File DS - Standard functions  *
     C                     MOVEL'R'       WUEXTO           Exit option
      * Access Midas rundate - Standard functions  *
     C*   Access MIDAS Rundate from data-area RUNDAT
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT
     C                     MOVE RDNO      WURDNO
     C                     MOVE SUCP      WUSUCP
     C                     MOVE DTFF      WUDTFF
     C                     MOVE MBIN      WUMBIN
      * Access ZMUSER - Standard functions  *
     C*
     C* Access data-area ZMUSER
     C*
     C           *NAMVAR   DEFN           ZMUSER
     C                     IN   ZMUSER
     C                     MOVE USID      WUUSID           User Profile
     C                     MOVE UDBC      WUUDBC           User Def Branch
     C                     MOVE UDDP      WUUDDP           User Def Dept
     C                     MOVE UBLA      WUUBLA           User Bank Lvl A
      *                                                                   CAC001
      **  MIDAS Modules DS - MIDAS Modules                                CAC001
      **  Access MIDAS Modules. - MIDAS Modules                           CAC001
      *                                                                   CAC001
      **  Access Midas Modules file for the file fields                   CAC001
      *                                                                   CAC001
     C                     CALL 'AOMMODR0'                                CAC001
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd    CAC001
     C                     PARM '*FIRST'  UUAPOP  7        I:Option       CAC001
     C           D@MMOD    PARM *BLANK    UUFDY            O:Format       CAC001
      *                                                                   CAC001
      **  Assign work field to file field values.                         CAC001
      *                                                                   CAC001
     C                     MOVELBGN0ST    WUN0ST           Anal. Acctg.   CAC001
      *                                                                   CGL008
      **  Access SAR details file to see if CGL008 SAR is installed.      CGL008
      *                                                                   CGL008
     C                     CALL 'AOSARDR0'                                CGL008
     C                     PARM *BLANKS   @RTCD   7                       CGL008
     C                     PARM '*VERIFY' @OPTN   7                       CGL008
     C                     PARM 'CGL008'  @SARD   6                       CGL008
      *                                                                   CGL008
     C           @RTCD     IFEQ *BLANK                                    CGL008
     C                     MOVE 'Y'       CGL008  1                       CGL008
     C                     ELSE                                           CGL008
     C                     MOVE 'N'       CGL008                          CGL008
     C                     END                                            CGL008
      *                                                                   CGL008
      **  Access SAR details file to see if CGL008 SAR is installed.                          CGL148
      *                                                                                       CGL148
     C                     CALL 'AOSARDR0'                                                    CGL148
     C                     PARM *BLANKS   @RTCD                                               CGL148
     C                     PARM '*VERIFY' @OPTN                                               CGL148
     C                     PARM 'CGL148'  @SARD                                               CGL148
      *                                                                                       CGL148
     C           @RTCD     IFEQ *BLANK                                                        CGL148
     C                     MOVE 'Y'       CGL148  1                                           CGL148
     C                     ELSE                                                               CGL148
     C                     MOVE 'N'       CGL148                                              CGL148
     C                     ENDIF                                                              CGL148
      *                                                                                       CGL148
      ****Access*SAR*details*file*to*see*if*CAP032*SAR*is*installed.***************   186206 BUG2798
      **********                                                                      186206 BUG2798
     C**********           CALL 'AOSARDR0'                                            186206 BUG2798
     C**********           PARM *BLANKS   @RTCD                                       186206 BUG2798
     C**********           PARM '*VERIFY' @OPTN                                       186206 BUG2798
     C**********           PARM 'CAP032'  @SARD                                       186206 BUG2798
      **********                                                                      186206 BUG2798
     C********** @RTCD     IFEQ *BLANK                                                186206 BUG2798
     C**********           MOVE 'Y'       CAP032  1                                   186206 BUG2798
     C**********           ELSE                                                       186206 BUG2798
     C**********           MOVE 'N'       CAP032                                      186206 BUG2798
     C**********           ENDIF                                                      186206 BUG2798
      **********                                                                      186206 BUG2798
      *                                                                                     MD050992
      ** If Analytical Accounting installed, check if CAC004 (Default                       MD050992
      **  Unallocate Profit Centre) is switched on.                                         MD050992
      *                                                                                     MD050992
     C           WUN0ST    IFEQ 'Y'                                                         MD050992
      *                                                                                     MD050992
     C                     CALL 'AOSARDR0'                                                  MD050992
     C                     PARM *BLANKS   @RTCD                                             MD050992
     C                     PARM '*VERIFY' @OPTN                                             MD050992
     C                     PARM 'CAC004'  @SARD                                             MD050992
      *                                                                                     MD050992
     C           @RTCD     IFEQ *BLANK                                                      MD050992
     C                     MOVE 'Y'       CAC004  1                                         MD050992
     C                     ELSE                                                             MD050992
     C                     MOVE 'N'       CAC004                                            MD050992
     C                     ENDIF                                                            MD050992
      *                                                                                     MD050992
      ** Obtain the 'Unallocated Profit Centre' from PF/SDPCACPD                            MD050992
      *                                                                                     MD050992
     C                     CALL 'AOPCACR0'                                                  MD050992
     C                     PARM '*DBERR ' @RTCD                                             MD050992
     C                     PARM '*FIRST ' @OPTN                                             MD050992
     C           D@PCAC    PARM D@PCAC    UUFDY                                             MD050992
      *                                                                                     MD050992
     C                     ENDIF                                                            MD050992
      *                                                                                       CRE020
     C           *NAMVAR   DEFN           LDA                                                 CRE020
      *                                                                                       CRE020
      ** Check if CRE020 is enabled.                                                          CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSARDR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD   7                                           CRE020
     C                     PARM '*VERIFY' POPTN   7                                           CRE020
     C                     PARM 'CRE020'  PSARD   6                                           CRE020
     C           SCSARD    PARM SCSARD    UUFDY                                               CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       CRE020  1                                           CRE020
      *                                                                                       CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVE 'Y'       CRE020                                              CRE020
     C                     ELSE                                                               CRE020
      *                                                                                       CRE020
     C           PRTCD     IFNE '*NRF'                                                        CRE020
     C           *LOCK     IN   LDA                                                           CRE020
     C                     MOVEL'SCSARDPD'DBFILE                                              CRE020
     C                     MOVEL'CRE020'  DBKEY                                               CRE020
     C                     Z-ADD101       DBASE                                               CRE020
     C                     OUT  LDA                                                           CRE020
     C                     EXSR *PSSR                                                         CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
      ** Check if a System Value exists for this maintenance.                                 CRE020
      *                                                                                       CRE020
     C           CRE020    IFEQ 'Y'                                                           CRE020
      *                                                                                       CRE020
     C                     CALL 'AOSVALR0'                                                    CRE020
     C                     PARM *BLANKS   PRTCD                                               CRE020
     C                     PARM JRNE      PSV01  20                                           CRE020
     C                     PARM           PCS01 200                                           CRE020
     C                     PARM           PSV02  20                                           CRE020
     C                     PARM           PCS02 200                                           CRE020
     C                     PARM           PSV03  20                                           CRE020
     C                     PARM           PCS03 200                                           CRE020
     C                     PARM           PSV04  20                                           CRE020
     C                     PARM           PCS04 200                                           CRE020
     C                     PARM           PSV05  20                                           CRE020
     C                     PARM           PCS05 200                                           CRE020
     C                     PARM           PSV06  20                                           CRE020
     C                     PARM           PCS06 200                                           CRE020
     C                     PARM           PSV07  20                                           CRE020
     C                     PARM           PCS07 200                                           CRE020
     C                     PARM           PSV08  20                                           CRE020
     C                     PARM           PCS08 200                                           CRE020
     C                     PARM           PSV09  20                                           CRE020
     C                     PARM           PCS09 200                                           CRE020
     C                     PARM           PSV10  20                                           CRE020
     C                     PARM           PCS10 200                                           CRE020
      *                                                                                       CRE020
     C                     MOVE 'N'       WSV01   1                                           CRE020
      *                                                                                       CRE020
     C           PRTCD     IFEQ *BLANKS                                                       CRE020
     C                     MOVELPCS01     WSV01                                               CRE020
     C                     ELSE                                                               CRE020
      *                                                                                       CRE020
     C           PRTCD     IFNE '*NRF'                                                        CRE020
     C           *LOCK     IN   LDA                                                           CRE020
     C                     MOVEL'SDSVALPD'DBFILE                                              CRE020
     C                     MOVELPSV01     DBKEY                                               CRE020
     C                     Z-ADD102       DBASE                                               CRE020
     C                     OUT  LDA                                                           CRE020
     C                     EXSR *PSSR                                                         CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
      *                                                                                       CRE020
     C                     ENDIF                                                              CRE020
     C/COPY WNCPYSRC,GLH00300
      *================================================================
     CSR         ZZEXIT    ENDSR
** CPY@
(c) Finastra International Limited 2001
**
F3=Exit
** STAMP - Dummy timestamp                                                                    CPK014
0001-01-01-00.00.00.000000                                                                    CPK014
