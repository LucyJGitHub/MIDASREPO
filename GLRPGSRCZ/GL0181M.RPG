     H            Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Standing journal posting maintenance')        *
     H/TITLE Midas GL Edit Standing Journal posting
     Z* CRTRPGPGM
     Z* IGNDECERR(*YES)
      *
     H* SYNOPSIS :
     H* - Maintain database file using subfile display
     H* - Existing records may be updated or deleted
     H* - Key changes are not allowed
     H* - Program functions in two modes : *ADD and *CHANGE
     H* - Multiple new records may be added by changing to add mode
      *
     H* Generated by  : SYNON/2  Version:  9054
     H* Function type : Edit file
      *
     H*  Company :
     H* System        : General Ledger Synon Model
     H* User name     : COLMANP
     H* Date          : 22/06/92  Time  : 11:39:44
      *  (c) Finastra International Limited 2001                      *
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     F********************************************************************
     F*                                                               *
     F*   Journal Entry Postings - GL0181M                            *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. CGL154             Date 13Oct14               *
      *                 MD039461           Date 26Jul16               *
      *                 MD031707           Date 02Jul15               *
      *                 MD027587           Date 19Jun14               *
      *                 AR1093096          Date 30Sep13               *
      *                 CAP207             Date 10Feb11               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG23742           Date 09May09               *
      *                 CER047             Date 19May08               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246418             Date 16Mar07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA029             Date 22Mar04               *
      *                 CGL029             Date 01Sep03               *
      *                 CGL013             Date 29Mar02               *
      *                 210796             Date 27Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 189519             Date 27Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CPK015             Date 28Jun02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CAP032             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01MAR99               *
      *                 CTI002 EM / TI Interface 23/09/98             *
     F*                 099867             DATE 16APR97               *
     F*                 S01408             DATE 07AUG96              *
     F*                 CAC001             DATE 01FEB96               *
     F*                 078761             DATE 13DEC95               *
     F*                 089856             DATE 25OCT95               *
     F*              087770             DATE 23MAY95                  *
     F*              S01408             DATE 26JUN95                  *
     F*              S01408             DATE 21APR95                  *
     F*              S01408             DATE 08MAR95                  *
     F*              S01408             DATE 22AUG94                  *
     F*              S01413             DATE 28JUL93                  *
     F*              E38270             DATE 18JUN92                  *
     F*              S01314             Date 09May91                  *
     F*              BHF852             Date 21NOV90                  *
     F*              LN0402             Date 20JUN90                  *
     F*              LN0320             Date 06JUN90                  *
     F*              LN0253             Date 06JUN90                  *
     F*              LN0254             Date 25May90                  *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CGL154 - FATCA Reporting (Recompile)                         *
      *  MD039461 - Batch items cannot be amended or deleted in       *
      *             Standing Journal Template. Recompiled due to      *
      *             changes in GL0181M# display file.                 *
      *  MD031707 - Review account validation type as Customer Number *
      *             may not be numeric anymore.                       *
      *  MD027587 - Unable to used the C for Copy and T for Template  *
      *             (Recompile)                                       *
      *  AR1093096 - ABC - Reservations not removed for JRNE          *
      *              (Child: AR1093097) (Recompile)                   *
      *  CAP207 - Account Balance Check extended to other APIs        *
      *           (Recompile)                                         *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23742 - Improper handling of Ext Narr from Batch Interface*
      *             Input                                             *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  246418 - CGL013 changes for Midas Plus                       *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA029 - Recompiled due to changes in GL0181M#.              *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGL013 - MT94x Messages Generation                           *
      *  210796 - EXTEND OUR A/C AT NOSTRO FIELD                      *
      *  189519 - Can't insert multibranch batch without authority to *
      *           action code 'A'. Introduced P4SACD to receive the   *
      *           appropriate code passed by GL0161R.                 *
      *  CPK015 - Release 4.01 Packaging:                             *
      *           - A default timestamp string is required for WRITE. *
      *  CAP032 - Conversion of Journal Batch Entry inputs into       *
      *           modular structure to use as APIs. Recompiled        *
      *           due to change in length of #1DBRC field in the      *
      *           display file.                                       *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  099867 - Journal entry template retains value date.  Retain  *
     F*           value date keyed into the template.  Set the value  *
     F*           date in template to blank when there is no entry.   *
     F*  S01408 - Core hook GL0181MC13 added                          *
     F*         - Core hook GL0181MC12 added                          *
     F*  CAC001 - Profit Centre Accounting Development:               *
     F*           Default Profit Centre to the Profit Centre of the   *
     F*           account for Retail and Nostro accounts.  Add        *
     F*           additional processing for #1NITM field.             *
     F*  078761 - On re-using a deleted Batch No, random Batch Items  *
     F*           displayed before any have been input.               *
     F*  089856 - Change to allow posting amount as 13N as specified  *
     F*           in Ins Manual.                                      *
     F*  087770 - Screen is not redisplayed when copy character is    *
     F*           placed on a field and ENTER key is pressed. Fix is  *
     F*           tp set Defer Confirmation Ind. W0DCF to 'Y' so that *
     F*           screen will be redisplayed.                         *
      *         - Template function is not working properly; instead  *
      *           of displaying the item selected for template,       *
      *           system displays the previous item selected. Fix     *
      *           to amend SR/DFV2RC to check if WUTFUS *EQ 'N'.      *
     F*         - Amended fields are not accepted after pressing      *
     F*           the ENTER key. Fix is to move P1BTNB to BTBTNB.     *
      *         - Template and copy character '&' return incorrect    *
      *           values in ADD mode if Enter pressed before F9.      *
      *           Fix is in define separate work fields for 'Copy'    *
      *           and 'Template' functions so that they do not        *
      *           overwrite each other.                               *
     F*   S01408 - Core hook GL0181MCP8 added                         *
     F*            Core hook GL0181MCP9 added                         *
     F*            Core hook GL0181MC10 added                         *
     F*            Core hook GL0181MC11 added                         *
     F*   S01408 - Core hook GL0181MEP1 added                         *
     F*   S01408 - Core hook GL0181MRF2 added                         *
     F*            Core hook GL0181MRF1 added                         *
     F*            Core hook GL0181MCP7 added                         *
     F*            Core hook GL0181MCP6 added                         *
     F*            Core hook GL0181MCP5 added                         *
     F*            Core hook GL0181MNUL added                         *
     F*   S01408 - Core hook GL0181MCP1 added                         *
     F*            Core hook GL0181MCP2 added                         *
     F*            Core hook GL0181MCP3 added                         *
     F*            Core hook GL0181MCP4 added                         *
     F*   S01413 - RECOMPILE FOR RETAIL 3 INCORPORATION. PROGRAM NOT  *
     F*            REGENERATED FROM SYNON MODEL.                      *
     F*   E38270 - DO NOT DISPLAY BRANCH IF MBIN IS 'N'               *
     F*   S01314 - Multi-Language Subfile Coding                      *
     F*   BHF852 - ACCOUNT NUMBER NOT VALIDATED                       *
     F*   LN0402 - A/c Code, Sequence not validated correctly         *
     F*          - Also Value date and amount                         *
     F*   LN0320 - OVERRIDE DOES NOT ALLOW THE VALUES N               *
     F*   LN0253 - ADDITION OF RETAIL INDICATORS ON CALL TO AOACCTR0  *
     F*   LN0254 - Retail account number was not being blanked out    *
     F*            on the file.                                       *
     F*                                                               *
     F*****************************************************************
     F*00/Copy Member GL0181M   Initialise Program F-Spec
     F/COPY WNCPYSRC,GL0181MFPG
     FGL0181M#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: Midas GL Edit Standing Journal posting
      *
     FGLJENPL1IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RTV : Midas GL Journal Entry Posting Rtv
      *
     FGLJENHL1IF  E           K        DISK
      * RTV : Midas GL Journal Entry Header LF Rtv
      *
     FGLJENPL0UF  E           K        DISK                      A
     F                                              KCOMIT
      * UPD : Midas GL Journal Entry Posting Update
      *
     FGLJENXL2IF  E           K        DISK         KINFSR *PSSR                              CGL013
      ** RTV: Midas GL Journal Entry File - Additional Information                            CGL013
      *                                                                                       CGL013
     FGLJENXL3UF  E           K        DISK         KINFSR *PSSR                              CGL013
     F            GLJENXD0                          KRENAME@LJENXD0                           CGL013
      ** UPD: Midas GL Journal Entry File - Additional Information                            CGL013
     E*                                                                   S01408
     E/COPY WNCPYSRC,GL0181MEP1                                           S01408
     E*                                                                   S01408
     E                    STAMP   1   1 26                                                    CPK015
      ** Array containing dummy timestamp                                                     CPK015
     E                    CPY@    1   1 80               Copyright     array
     E*00/Copy Member GL0181M   Initialise Program E-Spec
     E/COPY WNCPYSRC,GL0181MEPG
      *                                                                                       246418
      * Parameters for pass to GL000185                                                       246418
     E                    FLDNMA     75 10                                                    246418
     E                    MSGIDA     75  7                                                    246418
     E                    MSGDTA     75 45                                                    246418
      *                                                                                       246418
     I*
     I* DATA STRUCTURES TO ENABLE A BATCH NUMBER TO BE INCREMENTED        S01234
     I* EVEN THOUGH IT IS AN ALPHA FIELD                                  S01234
     I*                                                                   S01234
     I*****P@BJRF    E DSSDBANKPD                                         S01117
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE                       S01117
     I*                                                                   S01117
     I*
     I*****P@ACCT    E DSACCNTAB
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     I*   Define MIDAS Rundate from data-area RUNDAT
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I* Define Data area MUSER                                         ***
     I*                                                                ***
     I*00/Copy Member GL0181M   Initialise Program I-Spec
     I/COPY WNCPYSRC,GL0181MIPG
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSGLJENPL0
      * Current/previous master file format fields for change control
      *
     I            DS
     I                                        1   60UUDNMA
     IBATCHG      DS                                                      S01234
     I                                        1   3 #1BTNB                S01234
     I                                        1   30BATNUM                S01234
      *                                                                   S01234
     I            DS                                                      S01234
     I                                        1   3 W@KEY1                S01234
     I                                        1   30BNUM2                 S01234
      *                                                                   S01234
     I            DS
      * Determine Account identity
     I                                        1  10 UKACID
     I                                        1   6 UKACF6
     I                                        1   3 UKACF3
     I                                        1   1 UKACF1
     I                                        1   1 UKACA1
     I                                        2   2 UKACA2
     I                                        3   3 UKACA3
     I                                        4   5 UKACM2
     I                                        6  10 UKACL5
     I                                        7  10 UKACL4
      * Set up parameters :
     I            DS
     I                                        1   60UUDNUM
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNO
     I                                       11  11 SUCP
     I                                       12  12 DTFF
     I                                       13  13 MBIN
     I*
     IUUFDY     E DSDSFDY
     I*
     I* 200 Byte Data Structure for Incoming Data from Access Program
     I*
     IUUSDY     E DSDSSDY
     I*
     I* 800 Byte Data Structure for Incoming Data from Access Program
     I*
     IP@BJRF    E DSSDBANKPD
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     ID@ACOD    E DSSDACODPD
     I*
     I*  Account Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@ACCT    E DSACCNTAB
     I*
     I*  Account Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@BRCH    E DSSDBRCHPD
     I*
     I*  Branch Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@CUST    E DSSDCUSTPD
     I              QQDFAC                          DFACQQ                                    CGL029
     I*
     I*  Client Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@CURR    E DSSDCURRPD
     I*
     I*  Currency Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@GELR    E DSSDGELRPD
     I              QQACCD                          QQACD1                                    CGL029
     I*
     I*  General Ledger Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@MMOD    E DSSDMMODPD                                              CAC001
     I*                                                                   CAC001
     I*  Midas Modules Details DS for assigning data from Access          CAC001
     I*  Programs to work fields                                          CAC001
     I*                                                                   CAC001
     ID@NARR    E DSSDNARRPD
     I*
     I*  Narrative Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@NOST    E DSSDNOSTPD
     I              QQACCD                          QQACD2                                    CGL029
     I*
     I*  Nostro Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@PRFC    E DSSDPRFCPD
     I*
     I*  Profit Centre DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@PRFM    E DSSDPRFMPD
     I*
     I*  Profit Centre Def Matrix DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@RETR    E DSSDRETRPD
     I*
     I*  Retail Transaction Types DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@BOOK    E DSSDBOOKPD
     I*
     I*  Book Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     IZMUSER      DS
     I                                        1  10 USID
     I                                       11  13 UDBC
     I                                       14  16 UDDP
     I                                       17  17 UBLA
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I : RST Batch number
     I                                        1   3 P1BTNB
     IP2PARM      DS
      * I :  Branch Code - Alpha
     I                                        1   3 P2BCDA
     IP3PARM      DS
      * I :  Branch Internal Customer
     I                                        1   6 P3BICN
     IP4PARM      DS
      * I :  Hash item no.calculated
     I                                    P   1   20P4HINC
     IP5PARM      DS
      * I :  Multiple Branch Batch
     I                                        1   1 P5MBRB
     IP6PARM      DS
      * I :  Dept Code
     I                                        1   3 P6DPCD
     IP7PARM      DS
      * O :  Exit option
     I                                        1   1 P7EXTO
     IP8PARM      DS                                                                          189519
      * I :  SPF Action Code                                                                  189519
     I                                        1   1 P4SACD                                    189519
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0001
      * Currency code
     I                                       11  13 ZA0002
      * Account code
     I                                       14  17 ZA0003
      * Account sequence number
     I                                       18  19 ZA0004
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0005
      * Currency code
     I                                       11  13 ZA0006
      * Account code
     I                                       14  17 ZA0007
      * Account sequence number
     I                                       18  19 ZA0008
      * Message data for 'Account ID not valid ERR'
      * Account Identifier
     I                                        1  10 ZA0009
      * Message data for 'Account ID not valid'
      * Account Identifier
     I                                        1  10 ZA0010
      * Message data for 'Retail Code not valid'
      * Account Identifier
     I                                        1  10 ZA0011
      * Message data for 'Retail Code not valid'
      * Account Identifier
     I                                        1  10 ZA0012
      * Message data for 'Retail Code not valid'
      * Account Identifier
     I                                        1  10 ZA0013
      * Message data for 'Retail Code not valid'
      * Account Identifier
     I                                        1  10 ZA0014
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0015
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0016
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0017
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0018
      * Message data for 'Nostro code not valid'
      * Account Identifier
     I                                        1  10 ZA0019
      * Message data for 'Customer not found'
      * Account Identifier
     I                                        1  10 ZA0020
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0021
      * Currency code
     I                                       11  13 ZA0022
      * Account code
     I                                       14  17 ZA0023
      * Account sequence number
     I                                       18  19 ZA0024
      * Message data for 'Account is Closed'
      * Account Identifier
     I                                        1  10 ZA0025
      * Currency code
     I                                       11  13 ZA0026
      * Account code
     I                                       14  17 ZA0027
      * Account sequence number
     I                                       18  19 ZA0028
      * Message data for 'SPF Atn Cde ERR 1 ZVACTBU'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0029
      * Message data for 'SPF Atn Cde ERR 5 ZVACTBU'
      * SPF Action Code
     I                                        1   1 ZA0030
      * Branch Code - Alpha
     I                                        2   4 ZA0031
      * Message data for 'Branch Code Required'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0032
      * Message data for 'Amount not valid'
      * Formatted Posting amount
     I                                        1  14 ZA0033
      * Message data for 'Debit Credit must be Y/N'
      * Debit/credit indicator
     I                                        1   1 ZA0034
      * Message data for 'Narrative Code not found'
      * Narrative
     I                                        1  30 ZA0035
      * Message data for 'Trans. type not valid'
      * Transaction type
     I                                        1   5 ZA0036
      * Message data for 'Value Date not valid 2'
      * Value date (display)
     I                                        1   6 ZA0037
      * Message data for 'Value Date not valid 1'
      * Value date (display)
     I                                        1   6 ZA0038
      * Message data for 'Value Date not valid 2'
      * Value date (display)
     I                                        1   6 ZA0039
      * Message data for 'Value Date not valid 3'
      * Value date (display)
     I                                        1   6 ZA0040
      * Message data for 'Value Date Not Valid 9'
      * Value date (display)
     I                                        1   6 ZA0041
      * Message data for 'Value Date not valid 4'
      * Value date (display)
     I                                        1   6 ZA0042
      * Message data for 'Value Date not valid 5'
      * Value date (display)
     I                                        1   6 ZA0043
      * Message data for 'Value Date Not Valid 6'
      * Value date (display)
     I                                        1   6 ZA0044
      * Message data for 'Value Date Not Valid 7'
      * Value date (display)
     I                                        1   6 ZA0045
      * Message data for 'Value Date Not Valid 8'
      * Value date (display)
     I                                        1   6 ZA0046
      * Message data for 'Cheque Number Numeric'
      * Cheque number
     I                                        1   8 ZA0047
      * Message data for 'Assoc.Cust.No. not found'
      * Assoc. Customer number
     I                                        1   6 ZA0048
      * Message data for 'Profit Centres         NF'
      * Profit centre
     I                                        1   4 ZA0049
      * Message data for 'Def Prof Centre Not Found'
      * Profit centre
     I                                        1   4 ZA0050
      * Message data for 'Book Codes Not Found.'
      * Book Code
     I                                        1   2 ZA0051
      * Message data for 'Currency Code not found'
      * Currency code
     I                                        1   3 ZA0052
      * Message data for 'Account Code not found'
      * Account code
     I                                        1   4 ZA0053
      * Message data for 'Branch Code not found'
      * Branch code
     I                                        1   3 ZA0054
      * Message data for 'Account Seq Numeric'
      * Account sequence number
     I                                        1   2 ZA0055
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0056
      * JE Special Character
     I                                       26  26 ZA0057
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0058
      * JE Special Character
     I                                       26  26 ZA0059
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0060
      * JE Special Character
     I                                       26  26 ZA0061
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0062
      * JE Special Character
     I                                       26  26 ZA0063
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0064
      * JE Special Character
     I                                       26  26 ZA0065
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0066
      * JE Special Character
     I                                       26  26 ZA0067
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0068
      * JE Special Character
     I                                       26  26 ZA0069
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0070
      * JE Special Character
     I                                       26  26 ZA0071
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0072
      * JE Special Character
     I                                       26  26 ZA0073
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0074
      * JE Special Character
     I                                       26  26 ZA0075
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0076
      * JE Special Character
     I                                       26  26 ZA0077
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0078
      * JE Special Character
     I                                       26  26 ZA0079
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0080
      * JE Special Character
     I                                       26  26 ZA0081
      * Message data for 'Copy function not valid'
      * *Copy Error Field
     I                                        1  25 ZA0082
      * JE Special Character
     I                                       26  26 ZA0083
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0084
      * Currency code
     I                                       11  13 ZA0085
      * Account code
     I                                       14  17 ZA0086
      * Account sequence number
     I                                       18  19 ZA0087
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0088
      * Currency code
     I                                       11  13 ZA0089
      * Account code
     I                                       14  17 ZA0090
      * Account sequence number
     I                                       18  19 ZA0091
      * Message data for 'Profit Centre NE to Account's Profit Centre'    CAC001
      * Profit centre                                                     CAC001
     I                                        1   4 ZA0092                CAC001
      * Profit centre                                                     CAC001
     I                                        1   4 ZA0093                CAC001
     I/COPY WNCPYSRC,GL0181MI01
      *                                                                                       CGL013
     ILDA       E DSLDA                         256                                           CGL013
      ** Local Data Area for Database Error Details                                           CGL013
      *                                                                                       CGL013
     ISCSARD    E DSSCSARDPD                                                                  CGL013
     I              LCD                             WLCD                                      CGL013
      ** Switchable Features DS                                                               CGL013
      *                                                                                       CGL013
     I            DS                                                                          CGL013
     I**********                              1 108 PDETLS                           CGL013 BUG23742
     I                                        1 119 PDETLS                                  BUG23742
     I                                        1   3 PABTNB                                    CGL013
     I                                        4   6 PABINB                                    CGL013
     I                                        7   9 #1BCBH                                    CGL013
     I                                       10  15 #1CUST                                    CGL013
     I                                       16  18 #1CYCD                                    CGL013
     I**********                             19  22 #1ACCD                             CGL013 CGL029
     I                                       19  22 QQ1ACD                                    CGL029
     I                                       23  24 #1ACSN                                    CGL013
     I                                       25  34 PARACN                                    CGL013
     I                                       35  48 #RFMPA                                    CGL013
     I                                       49  49 #1DCIN                                    CGL013
     I                                       50  79 #RNRTV                                    CGL013
     I                                       80  85 #RVDDS                                    CGL013
     I                                       86  90 #1TRTY                                    CGL013
     I                                       91 100 #1TSTY                                    CGL013
     I                                      101 108 #1CQNB                                    CGL013
     I                                      109 118 #1ACCD                                    CGL029
     I                                      119 119 PEDIT                                   BUG23742
      ** Parameter Passed to GL000185                                                         CGL013
      *                                                                                       CGL013
      **  Valid JE Item (DS) for passing to GL000185                                          246418
     IPVBIPX    E DSGLVBIPXPD                                                                 246418
      *                                                                                       246418
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1BTNB    PARM           WP0001  3        Batch number
     C           P2BCDA    PARM           WP0002  3        Branch Code - A
     C           P3BICN    PARM           WP0003  6        Branch Internal
     C           P4HINC    PARM           WP0004  30       Hash item no.ca
     C           P5MBRB    PARM           WP0005  1        Multiple Branch
     C           P6DPCD    PARM           WP0006  3        Dept Code
     C           P7EXTO    PARM P7EXTO    WP0007  1        Exit option
     C           P4SACD    PARM           WP0008  1        Action Code                        189519
      *****************************************************************
      * Initialise
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      *                                                                   CAC001
      ** If refresh requested, set off warning indicator.                 CAC001
      *                                                                   CAC001
     C           *IN05     IFEQ '1'                                       CAC001
     C                     MOVEL'N'       WKWARN                          CAC001
     C                     ENDIF                                          CAC001
      * Initialise and load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   05                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END
     C                     END
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * USER: Initialise subfile header
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MISH - Journal Entry Posting  *
     C*00/Copy Member GL0181M   Initialise Subfile Header
     C/COPY WNCPYSRC,GL0181MISH
     C                     END                             *FI
      * If CHANGE mode, then position file:
     C           W0PMD     IFNE 'ADD'
     C           KPOS      KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Setup key
     C                     MOVEL#2BTNB    BTBTNB           Batch number
     C                     Z-ADD#2BINB    BTBINB           Batch item no.
      * 82=EOF
     C********** KPOS **** SETLL@BTREAL  *********** 82 ** *              078761
     C                     MOVE *OFF      *IN55                           078761
     C           BTBINB    IFEQ 0                                         078761
     C           KRST      SETLL@BTREAL                  55               078761
     C                     ELSE                                           078761
     C           KPOS      SETLL@BTREAL                  55               078761
     C                     ENDIF                                          078761
     C           *IN55     COMP *OFF                     82               078761
      * 82=EOF
     C           KRST      KLIST
     C                     KFLD           BTBTNB           Batch number
      * Setup key
     C                     MOVEL#2BTNB    BTBTNB           Batch number
     C  N82      KRST      READE@BTREAL                9182*
     C                     ELSE
     C                     SETOF                     82    *
     C                     END
      * Load subfile page
     C                     EXSR BBLDSF
      * If no records (first time only), switch to add mode and load again
     C           W0APM     IFEQ 'Y'
     C           ##RR      ANDEQ*ZERO
     C                     MOVEL'ADD'     W0PMD
     C                     SETOF                     82    *
     C                     EXSR BBLDSF
     C                     END
     C                     MOVEL'N'       W0APM   1
      *................................................................
      * If no records found, display error message
     C   82      ##RR      IFEQ *ZERO                      IF
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page (write empty page if add mode)
      *================================================================
     C                     SETOF                     84    No SFLNXTCHG
      * Re-establish fields in read-ahead record
     C   27      W0PMD     IFNE 'ADD'
     C  N82                READP@BTREAL                  90*
     C  N82                READ @BTREAL                  90*
     C                     END
      *
      * Setof record error indicators
     C/COPY WNCPYSRC,GL0181MC06
     C                     MOVE *ALL'0'   WKIND0 17
     C                     MOVE *ALL'1'   WKIND1 17
     C/COPY WNCPYSRC,GL0181MC07
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
     C                     Z-ADD*ZERO     ##RROK  50
      *................................................................
      * Load next subfile page
     C  N82      ##RROK    DOWLT##SFPG                     DO
     C                     MOVEAWKIND0    *IN,31
     C                     SETOF                     87    *
      * Clear subfile fields
     C                     EXSR MAIZ#1
      * If CHANGE mode, load subfile fields
     C           W0PMD     IFNE 'ADD'
     C                     EXSR MBFL#1
      * Calculate function fields
     C                     EXSR DG#2FN
      * Record will be selected unless overridden
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialise subfile record (existing record)
     C                     MOVEL*BLANK    #RASCD           Associated Cust
     C                     MOVELBTACNB    #RASCD           Associated Cust
     C                     MOVELWUIEMG    #RIEMG           Item error mess
      * CASE: DB1.Narrative code is Narrative code
     C           BTNVCD    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVELBTNVCD    #RNRTV           Narrative
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELBTNRDC    #RNRTV           Narrative
     C                     END                             *FI
      * CASE: RCD.Retail Number Entered is Retail Account
     C           #1RNBE    IFEQ 'Y'                        *IF
     C                     MOVEL#1RACN    #RACID           Account Identif
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELBTCUST    #RACID           Account Identif
     C                     END                             *FI
      * CASE: RCD.Currency code is Blank
     C           #1CYCD    IFEQ *BLANK                     *IF
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     ELSE
      * CASE: *OTHERWISE
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
     C                     END                             *FI
      * Start of Fix LN0402
      * CASE: DB1.Posting amount is Not zero
     C           BTPTAM    IFNE *ZERO                      *IF
      * Format amount (short) - Standard functions  *
     C                     Z-ADDBTPTAM    ULVALU           Value
      *
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALU 150       I:Value
     C                     PARM WUNBDP    ULDECP  10       I:Decimal place
     C***********          PARM 'L'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM '3'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLF 23        O:Formatted
      *
     C                     MOVE ULRSLF    #RFMPA           Formatted data
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
      * End of Fix LN0402
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL*BLANK    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO 10                                           CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is *No Errors
     C           WUAPRC    IFEQ *BLANK                     *IF
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM BTVLDT    WQ0001  50       Runday Number
     C                     PARM WUDTFF    WQ0002  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0003  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0004  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C           WUDTNF    IFNE *ZEROS                                    099867
     C                     MOVE UUDNMA    #RVDDS
     C                     ELSE                                           099867
     C                     MOVE *BLANKS   #RVDDS                          099867
     C                     END                                            099867
     C                     END                             *FI
      * CASE: PAR.Branch Code - Alpha NE DB1.Branch Code (Batch Headr)
     C           P2BCDA    IFNE BTBCBH                     *IF
     C                     MOVELP2BCDA    WUBCBH           Branch Code (Ba
      * Change GL Batch posting - Journal Entry Posting  *
     C                     EXSR SACHRC
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MIRE - Journal Entry Posting  *
     C*00/Copy Member GL0181M   Initialise Exist Record
     C/COPY WNCPYSRC,GL0181MIRE
     C                     END                             *FI
      * If record dropped...
     C           W0RSL     CABNE'Y'       BB020
      * Validate subfile record and calculate derived fields
     C                     EXSR DFV2RC
     C                     ELSE
      * USER: Initialise subfile record (new record)
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0181MCP9                                           S01408
     C*                                                                   S01408
      * CASE: WRK.Template Facility Used is Yes
     C           WUTFUS    IFEQ 'Y'                        *IF
     C***********          MOVELWUCACI    #RACID           Account Identif087770
     C***********          MOVELWUCCCD    #1CYCD           Currency code  087770
     C***********          MOVELWUCPAC    #1ACCD           Account code   087770
     C***********          MOVELWUCACS    #1ACSN           Account sequenc087770
     C***********          MOVELWUCBCA    #1IBCA           Input Branch Co087770
     C***********          MOVELWUCAMT    #RFMPA           Formatted Posti087770
     C***********          MOVELWUCDCI    #1DCIN           Debit/credit in087770
     C***********          MOVELWUCNAR    #RNRTV           Narrative      087770
     C***********          MOVELWUCTRT    #1TRTY           Transaction typ087770
     C***********          MOVELWUCCNB    #1CQNB           Cheque number  087770
     C***********          MOVELWUASSC    #RASCD           Associated Cust087770
     C***********          MOVELWUCVDT    #RVDDS           Value date (dis087770
     C***********          MOVELWUCSCR    #1SWCR           Swift common re087770
     C***********          MOVELWUCPRC    #1PRCN           Profit centre  087770
      *                                                                   087770
     C                     MOVELWZCACI    #RACID           Account Identif087770
     C                     MOVELWZCCCD    #1CYCD           Currency code  087770
     C                     MOVELWZCPAC    #1ACCD           Account code   087770
     C                     MOVELWZCACS    #1ACSN           Account sequenc087770
     C                     MOVELWZCBCA    #1IBCA           Input Branch Co087770
     C                     MOVELWZCAMT    #RFMPA           Formatted Posti087770
     C                     MOVELWZCDCI    #1DCIN           Debit/credit in087770
     C                     MOVELWZCNAR    #RNRTV           Narrative      087770
     C                     MOVELWZCTRT    #1TRTY           Transaction typ087770
     C                     MOVELWZCCNB    #1CQNB           Cheque number  087770
     C                     MOVELWZASSC    #RASCD           Associated Cust087770
     C                     MOVELWZCVDT    #RVDDS           Value date (dis087770
     C                     MOVELWZCSCR    #1SWCR           Swift common re087770
     C                     MOVELWZCPRC    #1PRCN           Profit centre  087770
     C/COPY WNCPYSRC,GL0181MC08
     C                     ELSE
      * CASE: *OTHERWISE
      * Set up Default Fields                                             087770
     C                     MOVELWUIEMG    #RIEMG           Item error mess
     C                     Z-ADDWURDNO    #1PTDT           Posting date
     C                     MOVEL'N'       #1RINE           Retail ind.: Er
     C                     MOVEL'01'      #1ACSN           Account sequenc
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELP3BICN    #RACID           Account Identif
     C***********          Z-ADDWURDNO    #1VLDT           Value date     099867
     C                     Z-ADD*ZEROS    #1VLDT           Value date     099867
     C                     MOVEL'N'       #1RNBE           Retail Number E
     C                     MOVELP2BCDA    #1IBCA           Input Branch Co
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C                     MOVELBJLCCY    WULCCY
     C                     MOVELWULCCY    #1CYCD           Currency code
     C/COPY WNCPYSRC,GL0181MC09
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MIRN - Journal Entry Posting  *
     C*00/Copy Member GL0181M   Initialise New Record
     C/COPY WNCPYSRC,GL0181MIRN
     C                     END                             *FI
     C                     END
      * Output to subfile
     C                     ADD  1         ##RR       81    *
     C                     ADD  1         ##RROK
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     WRITE#SFLRCD
     C           BB020     TAG
     C           W0PMD     IFNE 'ADD'
      * 82=EOF
     C           KRST      READE@BTREAL                  82*
     C                     END
     C  N82                END
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
     C           ##RRMX    ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN89     IFNE CAIN89
     C           *IN81     ORNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN89     CAIN89  1
     C                     MOVE *IN81     CAIN81  1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
     C                     MOVEL'N'       W0HLP   1
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      *
      * CALC: Subfile control function fields
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MSFF - Journal Entry Posting  *
     C*00/Copy Member GL0181M   Calculate Control Funct
     C/COPY WNCPYSRC,GL0181MSFF
     C                     END                             *FI
      * USER: Validate subfile control
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MVSC - Journal Entry Posting  *
     C*00/Copy Member GL0181M   Validate Control
     C/COPY WNCPYSRC,GL0181MVSC
     C                     END                             *FI
      * Quit if reload requested
     C           W0RSF     CABEQ'Y'       DAEXIT
      *
     C   81                DO
      *                                                                   CAC001
      **  Upon first screen entry or refresh command, do not issue        CAC001
      **  warnings right away.                                            CAC001
      *                                                                   CAC001
     C                     MOVE 'N'       WKWARN                          CAC001
      * No data entered as yet
     C                     MOVEL'N'       WKIPIN  1
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Process subfile records
     C                     EXSR DBPRSF
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * If data entered
     C           WKIPIN    IFEQ 'Y'
      * Update DBF from subfile
     C                     EXSR EAPRSF
      * If error during update, exit:
     C           *IN99     CABEQ'1'       DAEXIT
     C                     END                             WKIPIN
     C                     END
      * Switch between *ADD/*CHANGE modes
     C   09                EXSR FACHMD
      * USER: Process command keys
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MPCK - Journal Entry Posting  *
     C*00/Copy Member GL0181M   Process Command Keys
     C/COPY WNCPYSRC,GL0181MPCK
     C                     END                             *FI
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
     C                     EXSR DCPRSR
     C                     SETOF                     87    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0181MCP8                                           S01408
     C*                                                                   S01408
      * No errors
     C                     SETOF                     98
      * No SFLNXTCHG
     C                     SETOF                     84
     C           W0PMD     IFEQ 'ADD'
      * Check for null record
     C                     EXSR DDNLRC
     C           W0NLR     IFEQ 'Y'
     C                     GOTO DCEXIT
     C                     END
      * If not null record, continue
     C                     END
      * Data entered
     C                     MOVEL'Y'       WKIPIN
     C                     MOVE 'Y'       WKWARN                          CAC001
      * SFLNXTCHG
     C                     SETON                     84
      * If delete request, bypass validation
     C           #1SEL     IFEQ 'D'
     C                     GOTO DCEXIT
     C                     END
      * Validate subfile record
     C                     EXSR DEV1RC
      * If SFLRCD invalid, note the fact
     C   98N99             Z-ADD##RR      ##SFRC     99    *
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DDNLRC    BEGSR
      *================================================================
      * Check for null record
      *================================================================
     C                     MOVEL'N'       W0NLR   1
     C           #RACID    CABNE*BLANK    DDEXIT           Account Identif
     C           #1CYCD    CABNE*BLANK    DDEXIT           Currency code
     C           #1ACCD    CABNE*BLANK    DDEXIT           Account code
     C           #1ACSN    CABNE*BLANK    DDEXIT           Account sequenc
     C           #1IBCA    CABNE*BLANK    DDEXIT           Input Branch Co
     C           #RFMPA    CABNE*BLANK    DDEXIT           Formatted Posti
     C           #1DCIN    CABNE*BLANK    DDEXIT           Debit/credit in
     C           #RNRTV    CABNE*BLANK    DDEXIT           Narrative
     C           #1TRTY    CABNE*BLANK    DDEXIT           Transaction typ
     C           #1TSTY    CABNE*BLANK    DDEXIT           Transaction (Su
     C           #RVDDS    CABNE*BLANK    DDEXIT           Value date (dis
     C           #1CQNB    CABNE*BLANK    DDEXIT           Cheque number
     C           #1SWCR    CABNE*BLANK    DDEXIT           Swift common re
     C           #1PRCN    CABNE*BLANK    DDEXIT           Profit centre
     C           #RASCD    CABNE*BLANK    DDEXIT           Associated Cust
     C           #1BKCD    CABNE*BLANK    DDEXIT           Book Code
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0181MNUL                                           S01408
     C*                                                                   S01408
     C                     MOVEL'Y'       W0NLR
      *================================================================
     CSR         DDEXIT    ENDSR
      /EJECT
     CSR         DEV1RC    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
      * Validate Debit/credit indicator
     C                     MOVEL*BLANK    W0RTN
     C                     MOVEL#1DCIN    W0NSRQ  1        Debit/credit in
      * Name search required?
     C           W0NSRQ    IFEQ '?'
     C                     CALL 'MIVLLSR'              90  *
     C                     PARM           W0RTN   7
     C                     PARM 1107881   Y2LSNO  70
     C           #1DCIN    PARM #1DCIN    W0EXVL 20        Debit/credit in
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
     C                     END
      * USER: Validate subfile record fields
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * RTV Last Btch Itm EDTFIL - Standard functions  *
     C*  SAVE INDICATORS
     C                     MOVEL*IN82     WUIN82  1
     C                     MOVEL*IN91     WUIN91  1
      * Setup key.
     C*****************    Z-ADD#IJDNB    W@BCHN  30       Batch number   S01234
     C*****************    Z-ADD#IJDNB    W@KEY1  30       Batch number   S01234
     C*                                                                   S01234
     C                     MOVE #1BTNB    W@BCHN  3        Batch number   S01234
     C                     MOVE #1BTNB    W@KEY1  3        Batch number   S01234
     C*                                                                   S01234
     C           BATNUM    ADD  1         BNUM2            Batch number   S01234
     C*
     C***********W@KEY1    SETLL@BTREAL              82    *82=EOF        087770
     C           W@KEY1    SETLL@BTREAL                  65*65=found      087770
     C           *IN65     COMP *OFF                     82 =not found    087770
     C                     READP@BTREAL                9182*82=EOF
     C*
     C           *IN82     IFEQ '1'
     C           #1BTNB    ORNE W@BCHN
      *==
      * Move BLANKS OR ZEROES TO Copy Fields..
      *==
     C                     MOVEL*BLANK    WUCCUS  6        COPY:Cust No
     C                     Z-ADD0         WUCPAM 130       COPY:Amount
     C*********************MOVEL*BLANK    WUCRAN 10        COPY:Ret A/c
     C                     Z-ADD0         WUCRAN 100       COPY:Ret A/c
     C                     MOVEL*BLANK    WUCNRC  2        COPY:Narr Code
     C                     MOVEL*BLANK    WUCNDS 30        COPY:Narr Desc
     C                     Z-ADD0         WUCVDN  50       COPY:Value Date
     C                     MOVEL*BLANK    WUCCCD           COPY:CCY Code
     C                     MOVEL*BLANK    WUCPAC           COPY:A/c Code
     C                     MOVEL*BLANK    WUCACS  2        COPY:A/c Seq
     C                     MOVEL*BLANK    WUCDCI           COPY:Dr/Cr Ind
     C                     MOVEL*BLANK    WUCTRT  5        COPY:Trans Typ
     C                     MOVEL*BLANK    WUCCNB  8        COPY:Cheque No
     C                     MOVEL*BLANK    WUCACN  6        COPY:Assoc. Cust
     C                     MOVEL*BLANK    WUASSC 10        COPY:Assoc. Cust
     C                     MOVEL*BLANK    WUCSCR 16        COPY:Swift Ref
     C                     MOVEL*BLANK    WUCRNE  1        COPY:Ret A/c Ent
     C/COPY WNCPYSRC,GL0181MC14
      *
     C                     ELSE
      *==
      * Move @BTREAL ( GL Batch Posting ) fields to Copy: Fields..
      *==
     C           #1BTNB    IFEQ W@BCHN                     Batch number
     C                     MOVELBTCUST    WUCCUS           COPY:Cust No
     C                     Z-ADDBTPTAM    WUCPAM           COPY:Post Amount
     C*********************Z-ADDBTRACN    WUCRAN           COPY:Ret A/c
     C                     MOVELBTRACN    WUCRAN           COPY:Ret A/c
     C                     MOVELBTNVCD    WUCNRC           COPY:Narr Code
     C                     MOVELBTNRDC    WUCNDS           COPY:Narr Desc
     C                     Z-ADDBTVLDT    WUCVDN           COPY:Val Date NBR
     C                     MOVELBTCYCD    WUCCCD           COPY:CCY Code
     C                     MOVELBTACCD    WUCPAC           COPY:A/c Code
     C                     MOVELBTACSN    WUCACS           COPY:A/c Seq
     C                     MOVELBTDCIN    WUCDCI           COPY:Dr/Cr Ind
     C                     MOVELBTTRTY    WUCTRT           COPY:Trans Typ
     C                     MOVELBTCQNB    WUCCNB           COPY:Cheque No
     C                     MOVELBTACNB    WUCACN           COPY:Assoc. Cust
     C                     MOVELBTACNB    WUASSC           COPY:Assoc. Cust
     C                     MOVELBTSWCR    WUCSCR           COPY:Swift Ref
     C                     MOVELBTRNBE    WUCRNE           COPY:Ret A/c Ent
     C/COPY WNCPYSRC,GL0181MC15
     C                     END
     C                     END
     C* RESTORE INDICATORS
     C                     MOVELWUIN82    *IN82
     C                     MOVELWUIN91    *IN91
      * CASE: WRK.Copy:Retail Number Enter is Retail Account
     C           WUCRNE    IFEQ 'Y'                        *IF
     C                     MOVELWUCRAN    WUCACI           Copy:Account id
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUCACI           Copy:Account id
     C                     MOVELWUCCUS    WUCACI           Copy:Account id
     C                     END                             *FI
      * CASE: WRK.Copy:Narrative Code is Narrative code
     C           WUCNRC    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUCNAR           Copy:Narrative
     C                     MOVELWUCNRC    WUCNAR           Copy:Narrative
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCNDS    WUCNAR           Copy:Narrative
     C                     END                             *FI
      * CASE: RCD.Currency code is Blank
     C           #1CYCD    IFEQ *BLANK                     *IF
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
      * CASE: RCD.Currency code is Not Question Mark
     C           #1CYCD    IFNE '?'                        *IF
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * Format amount (short) - Standard functions  *
     C                     Z-ADDWUCPAM    ULVALU           Value
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALU 150       I:Value
     C                     PARM WUNBDP    ULDECP  10       I:Decimal place
     C                     PARM 'J'       ULEDIT  1        I:IBM Edit code
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLF 23        O:Formatted
     C                     MOVE ULRSLF    WUCAMT           Formatted data
     C                     END                             *FI
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM WUCVDN    WQ0005  50       Runday Number
     C                     PARM WUDTFF    WQ0006  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0007  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0008  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    WUVDDS
     C                     MOVELWUVDDS    WUCVDT           Copy:Value Date
     C                     ELSE
      * CASE: *OTHERWISE
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MVSU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0181MVSU
     C*
     C                     END                             *FI
      * Validate subfile record relations
     C                     EXSR DFV2RC
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFV2RC    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      * Calculate function fields
     C                     EXSR DG#2FN
      * USER: Validate subfile record relations
      * Account ID
      * CASE: RCD.Account Identifier is Entered
     C           #RACID    IFNE *BLANK                     *IF
      * Check Account Identifier
     C                     EXSR UASUBR                     Check Account I
      * Account Identifier is Retail or Nostro
      * CASE: WRK.Account ID Status Flag is Retail or Nostro
     C           WUAISF    IFEQ '*NOSTRO'                  *IF
     C           WUAISF    OREQ '*RETAIL'
      * Check for Retail Account No
     C                     EXSR UBSUBR                     Check for Retai
      * Check for Nostro Account No
     C                     EXSR UCSUBR                     Check for Nostr
     C                     END                             *FI
      * Account Identifier is Customer number or Shortname
      * CASE: WRK.Account ID Status Flag is Customer No or short name
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
     C                     MOVEL'N'       WUCNSI           Cust No or Shor
      * CASE: WRK.Valid Customer Number is Not Valid
     C           WUVCNB    IFEQ 'N'                        *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0020           Account Identif
      * Send message 'Customer not found'
     C                     MOVEL'GLX0084' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
      * CASE: WRK.Cust No or Short Inval is No Error
     C           WUCNSI    IFEQ 'N'                        *IF
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Start of fix BHF852
      * Setup message data for message
     C                     MOVEL#RACID    ZA0021           Account Identif
     C                     MOVEL#1CYCD    ZA0022           Currency code
     C                     MOVEL#1ACCD    ZA0023           Account code
     C                     MOVEL#1ACSN    ZA0024           Account sequenc
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Error if account is closed
      * CASE: WRK.Account status is Closed
     C           WUACCS    IFEQ 'C'                        *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0025           Account Identif
     C                     MOVEL#1CYCD    ZA0026           Currency code
     C                     MOVEL#1ACCD    ZA0027           Account code
     C                     MOVEL#1ACSN    ZA0028           Account sequenc
      * Send message 'Account is Closed'
     C                     MOVEL'GLX0126' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     3435  *
      *
     C                     END                             *FI
      * Check Account Number
      * CASE: WRK.Cust No or Short Inval is No Error
     C           WUCNSI    IFEQ 'N'                        *IF
     C                     MOVELWUIBCA    #1IBCA           Input Branch Co
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUACTY    #1ACTY           Account type
     C                     Z-ADDWURACN    #1RACN           Retail account
     C                     Z-ADDWURRNM    #1RRNM           Relative rec no
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     MOVEL'N'       #1RNBE           Retail Number E
     C                     END                             *FI
      * Start of fix BHF852
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * Obtain NOSTRO details
     C                     EXSR UFSUBR                     Obtain NOSTRO d
      * Start of Fix LN0269
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #1CUST           Customer number
     C                     MOVEL'G'       #1ACTY           Account type
     C                     MOVEL'N'       #1RNBE           Retail Number E
     C                     Z-ADD*ZERO     #1RACN           Retail account
      * End of Fix LN0269
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0181MC27
      * SPF Branch code
     C                     EXSR UGSUBR                     SPF Branch code
      * CASE: RCD.Formatted Posting amount is Entered
     C           #RFMPA    IFNE *BLANK                     *IF
      * Check Posting amount
     C                     EXSR UHSUBR                     Check Posting a
     C                     ELSE
      * CASE: *OTHERWISE
      * Start of Fix LN402
     C                     Z-ADD*ZERO     #1PTAM           Posting amount
      * End of Fix LN402
     C                     END                             *FI
      * Check Debit/Credit Indicator
      * CASE: RCD.Debit/credit indicator is Valid Values
     C           #1DCIN    IFEQ 'C'                        *IF
     C           #1DCIN    OREQ 'D'
     C                     ELSE
      * CASE: RCD.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1DCIN    ZA0034           Debit/credit in
      * Send message 'Debit Credit must be Y/N'
     C                     MOVEL'GLX0205' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9838  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0181MC16
      * Check Narrative
     C                     EXSR UISUBR                     Check Narrative
      * Check Transaction Type & Value Date
     C                     EXSR UJSUBR                     Check Transacti
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0181MC12                                           S01408
     C*                                                                   S01408
      * Check Cheque Number
      * CASE: RCD.Cheque number is Entered
     C           #1CQNB    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#1CQNB    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0050  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0051 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0052  10       ZALIGN No Of De
     C                     PARM 8         WQ0053  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0054 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0055 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0056  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0047           Cheque number
      * Send message 'Cheque Number Numeric'
     C                     MOVEL'GLX0209' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9843  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * ZALIGN Screen- Cheque No - Standard functions  *
     C* Move ZALIGNed screen field to Cheque Number field before
     C* checking for a Stopped Cheque.
     C*********************MOVE #IZASF    #OCQNB
     C                     MOVE WUZSCO    #1CQNB
     C*
     C                     END                             *FI
     C                     END                             *FI
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0181MC13                                           S01408
     C*                                                                   S01408
      * Check Associated Customer
      * CASE: RCD.Associated Cust - Display is Entered
     C           #RASCD    IFNE *BLANK                     *IF
      * CASE: RCD.Associated Cust - Display is Select Requested
     C           #RASCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Client Details. - Client Details  *
     C*
     C*  Access CLient Details file for the following fields
     C*  Customer No., Customer shortname, DRS Shortname,
     C*  Location, Customer SWIFT I.D.
     C*
     C                     CALL 'AOCUSTR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM #RASCD    UUCNCD 10        I:Client Key
     C                     PARM           UUCRST  7        O:Key status
     C           D@CUST    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUCRST    WUCRST           Key Status  ber
     C*
     C                     MOVELBBCUST    WUACNB           Customer Number
     C                     MOVELBBCSSN    WUCSSN           Shortname
     C                     MOVELBBDRCS    WUDRCS           DRS Shortname
     C                     MOVELBBLCCD    WULCCD           Location
     C                     MOVELBBCSID    WUCSID           SWIFT ID
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RASCD    ZA0048           Associated Cust
      * Send message 'Assoc.Cust.No. not found'
     C                     MOVEL'GLX0058' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9846  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUACNB    #1ACNB           Assoc. Customer
     C                     MOVEL*BLANK    #RASCD           Associated Cust
     C                     MOVELWUACNB    #RASCD           Associated Cust
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #1ACNB           Assoc. Customer
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0181MC01
      * Check Profit Centre
     C                     EXSR ULSUBR                     Check Profit Ce
     C/COPY WNCPYSRC,GL0181MC02
      * Check Book Codes
      * CASE: RCD.Book Code is Entered
     C           #1BKCD    IFNE *BLANK                     *IF
      * CASE: RCD.Book Code is Select requested
     C           #1BKCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Book Codes - Book Codes  *
     C*
     C*  Access Book Codes for the file fields
     C*
     C                     MOVEL#1BKCD    UUBKCD
     C                     CALL 'AOBOOKR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBKCD  2        I:Book Code
     C           D@BOOK    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVE BDBKCD    WUBKCD
     C                     MOVE BDBKD     WUBKD
     C                     MOVE BDHGIN    WUHGIN
     C                     MOVE BDACIN    WUACIN
     C                     MOVE BDBKCC    WUBKCC
     C                     MOVE BDSTAM    WUSTAM
     C                     MOVE BDSTRM    WUSTRM
     C                     MOVE BDSTEP    WUSTEP
     C                     MOVE BDIACK    WUIACK
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1BKCD    ZA0051           Book Code
      * Send message 'Book Codes Not Found.'
     C                     MOVEL'GLX0240' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9847  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUBKCD    #1BKCD           Book Code
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0181MC04
     C                     END                             *FI
      *                                                                                       CGL013
      ** If MT94x Messages Generation (CGL013) is installed, validate                         CGL013
      ** Additional Information Field                                                         CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
      *                                                                                       CGL013
     C           #1ADIN    IFEQ *BLANK                                                        CGL013
     C                     MOVE 'N'       #1ADIN                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           #1ADIN    IFNE 'Y'                                                           CGL013
     C           #1ADIN    ANDNE'N'                                                           CGL013
     C                     MOVE *ON       *IN49                                               CGL013
     C                     MOVE *ON       *IN98                                               CGL013
     C                     MOVEL'USR0912' ZAMSID                                              CGL013
     C                     EXSR ZASNMS                                                        CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE *OFF      *IN49                                               CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C/COPY WNCPYSRC,GL0181MC03
      * Setup Branch code (Header) & Posting Date on RCD
     C                     EXSR UMSUBR                     Setup Branch co
      **CASE:*PGM.*Program*mode*is**ADD********************************   087770
     C***********W0PMD     IFEQ 'ADD'                      *IF            087770
      **Store*data*for**Copy*function**********************************   087770
     C***********          EXSR UNSUBR                     Store data for 087770
     C***********          END                             *FI            087770
      * CASE: WRK.Copy / Template Facility is No
     C***********WUCTFY    IFEQ 'N'                        *IF            087770
     C           WUCFUS    IFEQ 'N'                                       087770
     C           WUTFUS    OREQ 'N'                                       087770
      **Store*data*for**Copy*last*record*function*using*copy*char******   087770
      * Clear Copy / Template Function work fields                        087770
     C                     EXSR UPSUBR                     Store data for
     C                     END                             *FI
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0181MC11                                           S01408
     C*                                                                   S01408
      * Set UP Exit Option - Standard functions  *
     C*
     C* Set Error on batch indicator to P Indicating Errors outstanding
     C* In Batch Postings.. Occurred during I/Face Batch Being Read..
     C*
     C           *IN98     IFEQ '1'
     C           *BLANK    OREQ 'N'                                       LN0327
     C                     MOVEL'P'       P7EXTO            EXIT OPTION
     C***********          ELSE                                     LN0327E28994
     C***********          MOVEL' '       #OEXTO                          E28994
     C                     END                              *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MVRR - Journal Entry Posting  *
     C*00/Copy Member GL0181M   Validate Record Relations
     C/COPY WNCPYSRC,GL0181MVRR
     C                     END                             *FI
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         DG#2FN    BEGSR
      *================================================================
      * Calculate subfile record function fields
      *================================================================
      * CALC: Subfile record function fields
      * Add Mode Copy Setup
      * CASE: PGM.*Program mode is *ADD
     C           W0PMD     IFEQ 'ADD'                      *IF
      * Replace 'Copy Character' in Field with WU... field value          087770
      * CASE: RCD.Account Identifier EQ WRK.JE Special Character
     C           #RACID    IFEQ WUJESP                     *IF
     C                     MOVELWUCACI    #RACID           Account Identif
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Currency code EQ WRK.JE Special Character
     C           #1CYCD    IFEQ WUJESP                     *IF
     C                     MOVELWUCCCD    #1CYCD           Currency code
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Account code EQ WRK.JE Special Character
     C           #1ACCD    IFEQ WUJESP                     *IF
     C                     MOVELWUCPAC    #1ACCD           Account code
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Account sequence number EQ WRK.JE Special Character
     C           #1ACSN    IFEQ WUJESP                     *IF
     C                     MOVELWUCACS    #1ACSN           Account sequenc
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Input Branch Code - Alpha EQ WRK.JE Special Character
     C           #1IBCA    IFEQ WUJESP                     *IF
     C                     MOVELWUCBCA    #1IBCA           Input Branch Co
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Formatted Posting amount EQ WRK.JE Special Character
     C           #RFMPA    IFEQ WUJESP                     *IF
     C                     MOVELWUCAMT    #RFMPA           Formatted Posti
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
     C                     MOVELWUCDCI    #1DCIN           Debit/credit in
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Narrative EQ WRK.JE Special Character
     C           #RNRTV    IFEQ WUJESP                     *IF
     C                     MOVELWUCNAR    #RNRTV           Narrative
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Transaction type EQ WRK.JE Special Character
     C           #1TRTY    IFEQ WUJESP                     *IF
     C                     MOVELWUCTRT    #1TRTY           Transaction typ
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Cheque number EQ WRK.JE Special Character
     C           #1CQNB    IFEQ WUJESP                     *IF
     C                     MOVELWUCCNB    #1CQNB           Cheque number
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Associated Cust - Display EQ WRK.JE Special Character
     C           #RASCD    IFEQ WUJESP                     *IF
     C                     MOVELWUASSC    #RASCD           Associated Cust
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Value date (display) EQ WRK.JE Special Character
     C           #RVDDS    IFEQ WUJESP                     *IF
     C                     MOVELWUCVDT    #RVDDS           Value date (dis
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Swift common reference EQ WRK.JE Special Character
     C           #1SWCR    IFEQ WUJESP                     *IF
     C                     MOVELWUCSCR    #1SWCR           Swift common re
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
      * CASE: RCD.Profit centre EQ WRK.JE Special Character
     C           #1PRCN    IFEQ WUJESP                     *IF
     C                     MOVELWUCPRC    #1PRCN           Profit centre
     C                     MOVEL'Y'       W0DCF            *Defer confirm 087770
     C                     END                             *FI
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0181MRF1                                           S01408
     C*                                                                   S01408
     C                     END                             *FI
      * Check Account Identifier
      * CASE: RCD.Account Identifier is Entered
     C           #RACID    IFNE *BLANK                     *IF
      * CASE: RCD.Account Identifier is Select Requested
     C           #RACID    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
     C                     MOVEL'Y'       WUVCNB           Valid Customer
      * Access Client Details. - Client Details  *
     C*
     C*  Access CLient Details file for the following fields
     C*  Customer No., Customer shortname, DRS Shortname,
     C*  Location, Customer SWIFT I.D.
     C*
     C                     CALL 'AOCUSTR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM #RACID    UUCNCD 10        I:Client Key
     C                     PARM           UUCRST  7        O:Key status
     C           D@CUST    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUCRST    WUCRST           Key Status  ber
     C*
     C                     MOVELBBCUST    WUCUST           Customer Number
     C                     MOVELBBCSSN    WUCSSN           Shortname
     C                     MOVELBBDRCS    WUDRCS           DRS Shortname
     C                     MOVELBBLCCD    WULCCD           Location
     C                     MOVELBBCSID    WUCSID           SWIFT ID
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL'N'       WUVCNB           Valid Customer
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     END                             *FI
     C                     END                             *FI
      * Check Currency Code
      * CASE: RCD.Currency code is Not blank
     C           #1CYCD    IFNE *BLANK                     *IF
      * CASE: RCD.Currency code is Select Requested
     C           #1CYCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0052           Currency code
      * Send message 'Currency Code not found'
     C                     MOVEL'GLX0048' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     END                             *FI
     C                     END                             *FI
      * Check Account code
      * CASE: RCD.Account code is Not blank
     C           #1ACCD    IFNE *BLANK                     *IF
      * Start of Fix LN0402
      * CASE: RCD.Account code is Select Requested
     C           #1ACCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Account Codes. - Account Codes  *
     C*
     C*  Access Account codes file for the following fields
     C*  A/c Type, A/c Name, Account Section, Account Subtype
     C*
     C                     MOVEL#1ACCD    UUACCD                          LN0334
     C                     CALL 'AOACODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C**********           PARM           UUACCD  4        I:Account Code              LN0334 CGL029
     C********** D@ACOD    PARM *BLANK    UUFDY            O:Format                           CGL029
     C                     PARM           UUACCD 10        I:Account Code                     CGL029
     C           D@ACOD    PARM *BLANK    UUSDY            O:Format                           CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA5ACCD    WUACCD           A/c Code       LN0334
     C                     MOVELA5ACTY    WUACTY           A/C Type
     C                     MOVELA5ACCN    WUACCN           A/c Name
     C                     MOVELA5ACSC    WUACSC           A/c Section
     C                     MOVELA5ACST    WUACST           A/c Sub-Type
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0053           Account code
      * Send message 'Account Code not found'
     C                     MOVEL'GLX0046' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9834  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     END                             *FI
      * End of Fix LN0402
     C                     END                             *FI
      * Branch Code Validation
     C                     EXSR URSUBR                     Branch Code Val
      * Start of Fix LN0402
      * Account sequence validation
      * CASE: RCD.Account sequence number is Not blank
     C           #1ACSN    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#1ACSN    WUZASF           ZALIGN Screen F
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0057  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0058 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0059  10       ZALIGN No Of De
     C                     PARM 2         WQ0060  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0061 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is Zalign Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#1ACSN    ZA0055           Account sequenc
      * Send message 'Account Seq Numeric'
     C                     MOVEL'GLX0224' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Zalign Account Sequence - Journal Entry Posting  *
     C                     MOVE WUZASF    #1ACSN
     C                     END                             *FI
     C                     END                             *FI
      * End of Fix LN0402
      * Change Copy Function
      * CASE: PGM.*Program mode is *CHANGE
     C           W0PMD     IFEQ 'CHG'                      *IF
      * CASE: RCD.*SFLSEL is Copy/Template
     C           #1SEL     IFEQ 'C'                        *IF
     C           #1SEL     OREQ 'T'
      * CASE: RCD.*SFLSEL is Copy
     C           #1SEL     IFEQ 'C'                        *IF
     C                     MOVEL'Y'       WUCFUS           Copy Facility U
     C                     END                             *FI
      * CASE: RCD.*SFLSEL is Template
     C           #1SEL     IFEQ 'T'                        *IF
     C                     MOVEL'Y'       WUTFUS           Template Facili
     C                     END                             *FI
      * Store Data For Copy / template Function
     C                     MOVEL'Y'       WUCTFY           Cpy/Tmpl Facili087770
     C                     EXSR USSUBR                     Store Data For
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUCTFY           Cpy/Tmpl Facili087770
     C                     MOVEL'N'       WUTFUS           Template Facili
     C                     MOVEL'N'       WUCFUS           Copy Facility U
     C                     END                             *FI
      * Check for Copy character in Screen Field
     C                     EXSR UTSUBR                     Check for Copy
     C                     END                             *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MRFF - Journal Entry Posting  *
     C*00/Copy Member GL0181M   Calculate Record Funct
     C/COPY WNCPYSRC,GL0181MRFF
     C                     END                             *FI
      *================================================================
     CSR         DGEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
      * Initialise subfile reload flag
     C           W0PMD     IFEQ 'ADD'
     C                     MOVEL'Y'       W0RSF
     C                     ELSE
     C                     MOVEL'N'       W0RSF
     C                     END
      * Process all modified subfile records
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
     C           W0RTN     IFNE *BLANK
      * ROLLBACK required
      * Send message '*ROLLBACK required'
     C                     MOVEL'Y2U0018' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     MOVEL'Y2U0018' P0RTN
     C                     EXSR ZYEXPG
     C                     END
     C                     MOVEL*BLANK    #1SEL
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      *                                                                   CAC001
      **  Restore status of *IN45 for later use                           CAC001
      *                                                                   CAC001
     C                     MOVE *IN45     WKIN45  1                       CAC001
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
     C                     MOVE WKIN45    *IN45                           CAC001
     C                     SETOF                     98
      *
     C           W0PMD     IFEQ 'ADD'
      * Process add request
     C           #1SEL     IFNE 'D'
     C                     EXSR DDNLRC
     C           W0NLR     IFNE 'Y'
     C                     EXSR ECADRQ
     C                     END
     C                     END
     C                     ELSE
     C           #1SEL     IFEQ 'D'
      * Process delete request
     C                     EXSR EDDLRQ
     C                     ELSE
      * Process change request
     C                     EXSR EECHRQ
     C                     END
     C                     END
      * If error occurred on update, note the fact
     C           *IN98     IFEQ '1'
     C           *IN99     IFEQ '0'
     C                     Z-ADD##RR      ##SFRC     99    *
     C                     END
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         ECADRQ    BEGSR
      *================================================================
      * Process add request
      *================================================================
      * USER: Create DBF record
      * Create GL Batch posting - Journal Entry Posting  *
     C                     EXSR SCCRRC
     C           W0RTN     IFNE *BLANK
      * Write error detected
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
     C                     ELSE
      * DBF write successful
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         ECEXIT    ENDSR
      /EJECT
     CSR         EDDLRQ    BEGSR
      *================================================================
      * Process delete request
      *================================================================
      * USER: Delete DBF record
      * Delete GL Batch posting - Journal Entry Posting  *
     C                     EXSR SDDLRC
     C           W0RTN     IFNE *BLANK
      * Delete unsuccessful
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * If record altered, reset subfile record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF delete successful
      * Blank out record and protect from entry
     C                     EXSR MAIZ#1
      * disable entry
     C                     SETON                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
      * Reload subfile
     C                     MOVEL'Y'       W0RSF   1
     C                     END
      *================================================================
     CSR         EDEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Change GL Batch posting - Journal Entry Posting  *
     C                     EXSR SECHRC
     C           W0RTN     IFNE *BLANK
      * DBF update error
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * Reset subfile record if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF update successful
      * Enable entry
     C                     SETOF                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FACHMD    BEGSR
      *================================================================
      * Switch between *ADD/*CHANGE modes
      *================================================================
     C           W0PMD     IFNE 'ADD'
     C                     MOVEL'ADD'     W0PMD
     C                     ELSE
     C                     MOVEL'CHG'     W0PMD
     C                     END
      *                                                                   CAC001
      ** If switch has been done, set on warning indicator.               CAC001
      *                                                                   CAC001
     C                     MOVE 'Y'       WKWARN                          CAC001
     C                     EXSR FBRQRL
      *================================================================
     CSR         FAEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
     C/COPY WNCPYSRC,GL0181MC17
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect keys if change mode or updated record
     C                     SETON                     88    *
     C   89N87             SETOF                     88    *
     C                     MOVEL*IN87     *IN78
     C           W0PMD     IFEQ 'ADD'                      *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
     C                     MOVEL*IN87     *IN77
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN77
     C                     END                             *FI
     C                     MOVEL'0'       *IN76
     C           #RIEST    IFEQ 'E'                        *IF
     C                     MOVEL'1'       *IN76
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
     C                     MOVEL'0'       *IN79
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise subfile record
      *================================================================
      * Previous values
     C                     MOVEL*BLANK    #1DBRC
     C                     MOVEL*BLANK    #RIEST           Item error stat
     C                     MOVELP1BTNB    #1BTNB           Batch number
     C                     Z-ADD*ZERO     #1BINB           Batch item no.
     C                     MOVEL*BLANK    #1CUST           Customer number
     C                     MOVEL*BLANK    #1NNBI           Nostro number (
     C                     Z-ADD*ZERO     #1RACN           Retail account
     C                     Z-ADD*ZERO     #1PTAM           Posting amount
     C                     MOVEL*BLANK    #1RINE           Retail ind.: Er
     C                     Z-ADD*ZERO     #1PTDT           Posting date
     C                     MOVEL*BLANK    #1NVCD           Narrative code
     C                     MOVEL*BLANK    #1NRDC           Narrative descr
     C                     MOVEL*BLANK    #1ACTY           Account type
     C                     Z-ADD*ZERO     #1VLDT           Value date
     C                     MOVEL*BLANK    #1ACNB           Assoc. Customer
     C                     MOVEL*BLANK    #1COIN           Customer origin
     C                     Z-ADD*ZERO     #1SPFC           Spread Factor
     C                     Z-ADD*ZERO     #1NITM           Number of ItemsCAC001
     C                     MOVEL*BLANK    #1RVDI           Reverse/Void In
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
     C                     MOVEL*BLANK    #1BCBH           Branch Code (Ba
     C                     MOVEL*BLANK    #1RADP           Retail advice p
     C                     MOVEL*BLANK    #1SHPI           Shadow post ind
     C                     Z-ADD*ZERO     #1RRNM           Relative rec no
     C                     MOVEL*BLANK    #1RNBE           Retail Number E
     C                     MOVEL*BLANK    #1RARC           Retail Ac Refer
     C                     MOVEL*BLANK    #1SEL            *SFLSEL
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVEL*BLANK    #1CYCD           Currency code
     C                     MOVEL*BLANK    #1ACCD           Account code
     C                     MOVEL*BLANK    #1ACSN           Account sequenc
     C                     MOVEL*BLANK    #1IBCA           Input Branch Co
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     MOVEL*BLANK    #1DCIN           Debit/credit in
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVEL*BLANK    #1TRTY           Transaction typ
     C                     MOVEL*BLANK    #1TSTY           Transaction (Su
     C                     MOVEL*BLANK    #RVDDS           Value date (dis
     C                     MOVEL*BLANK    #1CQNB           Cheque number
     C                     MOVEL*BLANK    #1SWCR           Swift common re
     C                     MOVEL*BLANK    #1PRCN           Profit centre
     C                     MOVEL*BLANK    #RASCD           Associated Cust
     C                     MOVEL*BLANK    #1BKCD           Book Code
     C                     MOVEL*BLANK    #RIEMG           Item error mess
      *                                                                                       CGL013
      ** If CGL013 is installed                                                               CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C                     MOVEL*BLANKS   #1ADIN                                              CGL013
     C                     MOVEL*BLANKS   #1AIPI                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C/COPY WNCPYSRC,GL0181MC18
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @BTREAL fields to subfile
      *================================================================
     C                     MOVELBTBTNB    #1BTNB           Batch number
     C                     Z-ADDBTBINB    #1BINB           Batch item no.
     C                     MOVELBTCUST    #1CUST           Customer number
     C                     MOVELBTNNBI    #1NNBI           Nostro number (
     C                     Z-ADDBTRACN    #1RACN           Retail account
     C                     Z-ADDBTPTAM    #1PTAM           Posting amount
     C                     MOVELBTRINE    #1RINE           Retail ind.: Er
     C                     Z-ADDBTPTDT    #1PTDT           Posting date
     C                     MOVELBTNVCD    #1NVCD           Narrative code
     C                     MOVELBTNRDC    #1NRDC           Narrative descr
     C                     MOVELBTACTY    #1ACTY           Account type
     C                     Z-ADDBTVLDT    #1VLDT           Value date
     C                     MOVELBTACNB    #1ACNB           Assoc. Customer
     C                     MOVELBTCOIN    #1COIN           Customer origin
     C                     Z-ADDBTSPFC    #1SPFC           Spread Factor
     C                     Z-ADDBTNITM    #1NITM           Number of ItemsCAC001
     C                     MOVELBTRVDI    #1RVDI           Reverse/Void In
     C                     MOVELBTRINO    #1RINO           Retail ind.: Ov
     C                     MOVELBTBCBH    #1BCBH           Branch Code (Ba
     C                     MOVELBTRADP    #1RADP           Retail advice p
     C                     MOVELBTSHPI    #1SHPI           Shadow post ind
     C                     Z-ADDBTRRNM    #1RRNM           Relative rec no
     C                     MOVELBTRNBE    #1RNBE           Retail Number E
     C                     MOVELBTRARC    #1RARC           Retail Ac Refer
     C                     MOVELBTCYCD    #1CYCD           Currency code
     C                     MOVELBTACCD    #1ACCD           Account code
     C                     MOVELBTACSN    #1ACSN           Account sequenc
     C                     MOVELBTIBCA    #1IBCA           Input Branch Co
     C                     MOVELBTDCIN    #1DCIN           Debit/credit in
     C                     MOVELBTTRTY    #1TRTY           Transaction typ
     C                     MOVELBTTSTY    #1TSTY           Transaction (Su
     C                     MOVELBTCQNB    #1CQNB           Cheque number
     C                     MOVELBTSWCR    #1SWCR           Swift common re
     C                     MOVELBTPRCN    #1PRCN           Profit centre
     C                     MOVELBTBKCD    #1BKCD           Book Code
      *                                                                                       CGL013
      ** If CGL013 is installed                                                               CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C                     MOVEL'N'       #1ADIN                                              CGL013
      *                                                                                       CGL013
     C           KPOS      CHAINGLJENXL2             50                                       CGL013
     C           *IN50     IFEQ *OFF                                                          CGL013
     C           BAADI1    ANDNE*BLANKS                                                       CGL013
     C                     MOVEL'*'       #1AIPI                                              CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE *BLANK    #1AIPI                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
      * Hold current record image for change detection
     C                     MOVEL@1DBRC    #1DBRC
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0181MC10                                           S01408
     C*                                                                   S01408
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVELP1BTNB    #2BTNB           Batch number
     C                     Z-ADD*ZERO     #2BINB           Batch item no.
      * Check restriction within
     C                     EXSR VACKRL
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         SACHRC    BEGSR
      *================================================================
      * Change GL Batch posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before DBF read
      * CASE: WRK.Abbreviated Posting? is Yes
     C           WUABPS    IFEQ 'Y'                        *IF
      * E18852 - Branch Code of Trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL*BLANK    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C*
      * End of Fix LN0315
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0001           Account Identif
     C                     MOVEL#1CYCD    ZA0002           Currency code
     C                     MOVEL#1ACCD    ZA0003           Account code
     C                     MOVEL#1ACSN    ZA0004           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983334*
     C                     SETON                     35    *
      *
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
      * Was posting Retail? - Journal Entry Posting  *
     C                     EXSR SBRVGN
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0005           Account Identif
     C                     MOVEL#1CYCD    ZA0006           Currency code
     C                     MOVEL#1ACCD    ZA0007           Account code
     C                     MOVEL#1ACSN    ZA0008           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983334*
     C                     SETON                     35    *
      *
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Move key fields to @BTREAK
     C***********          MOVEL#1BTNB    BTBTNB           Batch number   087770
     C                     MOVELP1BTNB    BTBTNB           Batch number   087770
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
      *
     C           KLCHSA    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
     C           KLCHSA    CHAIN@BTREAK              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SAEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SAEXIT
     C                     END
      *
      * Move non-key fields to @BTREAK
     C                     MOVEL#1IBCA    BTIBCA           Input Branch Co
     C                     MOVEL#1CUST    BTCUST           Customer number
     C                     MOVEL#1CYCD    BTCYCD           Currency code
     C                     MOVEL#1ACCD    BTACCD           Account code
     C                     MOVEL#1ACSN    BTACSN           Account sequenc
     C                     MOVEL#1NNBI    BTNNBI           Nostro number (
     C                     Z-ADD#1RACN    BTRACN           Retail account
     C                     MOVEL#1RINO    BTRINO           Retail ind.: Ov
     C                     MOVEL#1RINE    BTRINE           Retail ind.: Er
     C                     MOVEL#1TRTY    BTTRTY           Transaction typ
     C                     Z-ADD#1PTAM    BTPTAM           Posting amount
     C                     MOVEL#1DCIN    BTDCIN           Debit/credit in
     C                     Z-ADD#1PTDT    BTPTDT           Posting date
     C                     Z-ADD#1VLDT    BTVLDT           Value date
     C                     MOVEL#1NVCD    BTNVCD           Narrative code
     C                     MOVEL#1NRDC    BTNRDC           Narrative descr
     C                     MOVEL#1ACTY    BTACTY           Account type
     C                     MOVEL#1ACNB    BTACNB           Assoc. Customer
     C                     MOVEL#1CQNB    BTCQNB           Cheque number
     C                     MOVEL#1COIN    BTCOIN           Customer origin
     C                     MOVEL#1SWCR    BTSWCR           Swift common re
     C                     MOVEL#1PRCN    BTPRCN           Profit centre
     C                     MOVELWUBCBH    BTBCBH           Branch Code (Ba
     C                     MOVEL#1RADP    BTRADP           Retail advice p
     C                     MOVEL#1SHPI    BTSHPI           Shadow post ind
     C                     Z-ADD#1RRNM    BTRRNM           Relative rec no
     C                     MOVEL#1RNBE    BTRNBE           Retail Number E
     C                     MOVEL#1RARC    BTRARC           Retail Ac Refer
     C                     MOVEL#1TSTY    BTTSTY           Transaction (Su
     C                     MOVEL#1BKCD    BTBKCD           Book Code
     C                     Z-ADD#1SPFC    BTSPFC           Spread Factor
     C                     MOVEL#1RVDI    BTRVDI           Reverse/Void In
     C                     Z-ADD#1NITM    BTNITM           Number of ItemsCAC001
      *
      * USER: Processing before DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MBDU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0181MBDU
     C*
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0181MC19
     C                     UPDAT@BTREAK                91  *
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF change successful
      *                                                                                       CGL013
      ** Additional Information Maintenance Screen                                            CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C           #1ADIN    ANDEQ'Y'                                                           CGL013
     C                     MOVELBTBTNB    PABTNB                                              CGL013
     C                     MOVELBTBINB    PABINB                                              CGL013
     C                     MOVEL#1RACN    PARACN                                              CGL013
     C                     CALL 'GL000185'                                                    CGL013
     C                     PARM *BLANKS   PRTCD                                               CGL013
     C                     PARM           PDETLS                                              CGL013
     C                     PARM *BLANK    PADD                                                CGL013
     C                     PARM 'M'       PMODE                                               CGL013
     C                     PARM '0'       PEXIT1  1                                         BUG23742
     C                     PARM '0'       PCANC1  1                                         BUG23742
     C                     PARM           PVBIPX                                              246418
     C                     PARM 'N'       APIMOD  1                                           246418
     C                     PARM           FLDNMA                                              246418
     C                     PARM           MSGIDA                                              246418
     C                     PARM           MSGDTA                                              246418
      *                                                                                       CGL013
     C                     MOVE 'N'       #1ADIN                                              CGL013
     C           PADD      IFEQ 'Y'                                                           CGL013
     C                     MOVE '*'       #1AIPI                                              CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE *BLANK    #1AIPI                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MADU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0181MADU
     C*
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Was posting Retail? - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Move fields to key list
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
     C           KRSSB     CHAIN@BTREAL              90    *
      * DBF record not found
     C   90                MOVEL'GLX0176' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process DBF record
      * PAR = DB1 By name
     C                     MOVELBTACTY    WUACTY           Account type
     C                     END
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT
     CSR         SCCRRC    BEGSR
      *================================================================
      * Create GL Batch posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Move all fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
     C                     MOVEL#1IBCA    BTIBCA           Input Branch Co
     C                     MOVEL#1CUST    BTCUST           Customer number
     C                     MOVEL#1CYCD    BTCYCD           Currency code
     C                     MOVEL#1ACCD    BTACCD           Account code
     C                     MOVEL#1ACSN    BTACSN           Account sequenc
     C                     MOVEL#1NNBI    BTNNBI           Nostro number (
     C                     Z-ADD#1RACN    BTRACN           Retail account
     C                     MOVEL#1RINO    BTRINO           Retail ind.: Ov
     C                     MOVEL#1RINE    BTRINE           Retail ind.: Er
     C                     MOVEL#1TRTY    BTTRTY           Transaction typ
     C                     Z-ADD#1PTAM    BTPTAM           Posting amount
     C                     MOVEL#1DCIN    BTDCIN           Debit/credit in
     C                     Z-ADD#1PTDT    BTPTDT           Posting date
     C                     Z-ADD#1VLDT    BTVLDT           Value date
     C                     MOVEL#1NVCD    BTNVCD           Narrative code
     C                     MOVEL#1NRDC    BTNRDC           Narrative descr
     C                     MOVEL#1ACTY    BTACTY           Account type
     C                     MOVEL#1ACNB    BTACNB           Assoc. Customer
     C                     MOVEL#1CQNB    BTCQNB           Cheque number
     C                     MOVEL#1COIN    BTCOIN           Customer origin
     C                     MOVEL#1SWCR    BTSWCR           Swift common re
     C                     MOVEL#1PRCN    BTPRCN           Profit centre
     C                     MOVEL#1BCBH    BTBCBH           Branch Code (Ba
     C                     MOVEL#1RADP    BTRADP           Retail advice p
     C                     MOVEL#1SHPI    BTSHPI           Shadow post ind
     C                     Z-ADD#1RRNM    BTRRNM           Relative rec no
     C                     MOVEL#1RNBE    BTRNBE           Retail Number E
     C                     MOVEL#1RARC    BTRARC           Retail Ac Refer
     C                     MOVEL#1TSTY    BTTSTY           Transaction (Su
     C                     MOVEL#1BKCD    BTBKCD           Book Code
     C                     Z-ADD#1SPFC    BTSPFC           Spread Factor
     C                     MOVEL#1RVDI    BTRVDI           Reverse/Void In
     C                     Z-ADD#1NITM    BTNITM           Number of ItemsCAC001
      *
      * USER: Processing before DBF update
      * RTV Last Batch Item - Standard functions  *
     C                     CALL 'GL0137U'              90  RTV Last Batch
     C                     PARM BTBTNB    WQ0062  3        Batch number
     C           WULINB    PARM *ZERO     WQ0063  30       Last item numbe
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ADD  1         WULINB           Last item numbe
     C                     Z-ADDWULINB    BTBINB           Batch item no.
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MCBU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0181MCBU
     C*
     C                     END                             *FI
     C           KLCRSC    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Check for duplicate primary key
     C           KLCRSC    SETLL@BTREAK                  90*
     C           *IN90     IFEQ '1'
     C                     MOVEL'GLX0175' W0RTN   7
      * USER: Processing if DBF record already exists
     C                     SUB  1         WULINB           Last item numbe
     C                     GOTO SCEXIT
     C                     END
     C/COPY WNCPYSRC,GL0181MC20
      *
     C                     MOVEASTAMP,1   BTTMST           Default Timestamp                  CPK015
     C                     WRITE@BTREAK                91  *
      *
     C           *IN91     IFEQ '1'
      * Write error detected
     C                     MOVEL'Y2U0004' W0RTN   7
      * USER: Processing if DBF update error
     C                     SUB  1         WULINB           Last item numbe
     C                     ELSE
      *                                                                                       CGL013
      ** Additional Information Maintenance Screen                                            CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C           #1ADIN    ANDEQ'Y'                                                           CGL013
     C                     MOVELBTBTNB    PABTNB                                              CGL013
     C                     MOVELBTBINB    PABINB                                              CGL013
     C                     MOVEL#1RACN    PARACN                                              CGL013
     C                     CALL 'GL000185'                                                    CGL013
     C                     PARM *BLANKS   PRTCD                                               CGL013
     C                     PARM           PDETLS                                              CGL013
     C                     PARM *BLANK    PADD    1                                           CGL013
     C                     PARM 'M'       PMODE   1                                           CGL013
     C                     PARM '0'       PEXIT1  1                                         BUG23742
     C                     PARM '0'       PCANC1  1                                         BUG23742
     C                     PARM           PVBIPX                                              246418
     C                     PARM 'N'       APIMOD  1                                           246418
     C                     PARM           FLDNMA                                              246418
     C                     PARM           MSGIDA                                              246418
     C                     PARM           MSGDTA                                              246418
      *                                                                                       CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
      * DBF write successful
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MCAU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0181MCAU
     C*
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SCEXIT    ENDSR
      /EJECT
     CSR         SDDLRC    BEGSR
      *================================================================
      * Delete GL Batch posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MDBU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0181MDBU
     C*
     C                     END                             *FI
      * Move key fields to @BTREAK
     C***********          MOVEL#1BTNB    BTBTNB           Batch number   087770
     C                     MOVELP1BTNB    BTBTNB           Batch number   087770
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
      *
     C           KLDLSD    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
     C           KLDLSD    CHAIN@BTREAK              9091  *
     C           *IN90     IFEQ '1'
      * Record already deleted
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SDEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SDEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Use SETLL to release record lock
     C           KLDLSD    SETLL@BTREAK              9091  *
     C                     GOTO SDEXIT
     C                     END                             FI #1DBRC
      *................................................................
     C/COPY WNCPYSRC,GL0181MC21
     C                     DELET@BTREAK                91  *
     C           *IN91     IFEQ '1'
      * Delete error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      *                                                                                       CGL013
      ** If Additional Information Exist in PF/GLJENXPD, delete.                              CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C           KLDLSD    CHAINGLJENXL3             65                                       CGL013
     C           *IN65     IFEQ *OFF                                                          CGL013
     C                     DELET@LJENXD0                                                      CGL013
     C                     ENDIF                                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
      * DBF delete successful
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MDAU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0181MDAU
     C*
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SDEXIT    ENDSR
      /EJECT
     CSR         SECHRC    BEGSR
      *================================================================
      * Change GL Batch posting - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before DBF read
      * CASE: WRK.Abbreviated Posting? is Yes
     C           WUABPS    IFEQ 'Y'                        *IF
      * E18852 - Branch Code of Trade Parm Added 28.09.89
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL*BLANK    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C*
      * End of Fix LN0315
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0084           Account Identif
     C                     MOVEL#1CYCD    ZA0085           Currency code
     C                     MOVEL#1ACCD    ZA0086           Account code
     C                     MOVEL#1ACSN    ZA0087           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983334*
     C                     SETON                     35    *
      *
     C                     GOTO SEEXIT                     *QUIT
     C                     END                             *FI
      * Was posting Retail? - Journal Entry Posting  *
     C                     EXSR SFRVGN
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0088           Account Identif
     C                     MOVEL#1CYCD    ZA0089           Currency code
     C                     MOVEL#1ACCD    ZA0090           Account code
     C                     MOVEL#1ACSN    ZA0091           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983334*
     C                     SETON                     35    *
      *
     C                     GOTO SEEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Move key fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
      *
     C           KLCHSE    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
     C           KLCHSE    CHAIN@BTREAK              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SEEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SEEXIT
     C                     END
      *
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Use SETLL to release record lock
     C           KLCHSE    SETLL@BTREAK              9091  *
     C                     GOTO SEEXIT
     C                     END                             FI #1DBRC
      * Move non-key fields to @BTREAK
     C                     MOVEL#1IBCA    BTIBCA           Input Branch Co
     C                     MOVEL#1CUST    BTCUST           Customer number
     C                     MOVEL#1CYCD    BTCYCD           Currency code
     C                     MOVEL#1ACCD    BTACCD           Account code
     C                     MOVEL#1ACSN    BTACSN           Account sequenc
     C                     MOVEL#1NNBI    BTNNBI           Nostro number (
     C                     Z-ADD#1RACN    BTRACN           Retail account
     C                     MOVEL#1RINO    BTRINO           Retail ind.: Ov
     C                     MOVEL#1RINE    BTRINE           Retail ind.: Er
     C                     MOVEL#1TRTY    BTTRTY           Transaction typ
     C                     Z-ADD#1PTAM    BTPTAM           Posting amount
     C                     MOVEL#1DCIN    BTDCIN           Debit/credit in
     C                     Z-ADD#1PTDT    BTPTDT           Posting date
     C                     Z-ADD#1VLDT    BTVLDT           Value date
     C                     MOVEL#1NVCD    BTNVCD           Narrative code
     C                     MOVEL#1NRDC    BTNRDC           Narrative descr
     C                     MOVEL#1ACTY    BTACTY           Account type
     C                     MOVEL#1ACNB    BTACNB           Assoc. Customer
     C                     MOVEL#1CQNB    BTCQNB           Cheque number
     C                     MOVEL#1COIN    BTCOIN           Customer origin
     C                     MOVEL#1SWCR    BTSWCR           Swift common re
     C                     MOVEL#1PRCN    BTPRCN           Profit centre
     C                     MOVEL#1BCBH    BTBCBH           Branch Code (Ba
     C                     MOVEL#1RADP    BTRADP           Retail advice p
     C                     MOVEL#1SHPI    BTSHPI           Shadow post ind
     C                     Z-ADD#1RRNM    BTRRNM           Relative rec no
     C                     MOVEL#1RNBE    BTRNBE           Retail Number E
     C                     MOVEL#1RARC    BTRARC           Retail Ac Refer
     C                     MOVEL#1TSTY    BTTSTY           Transaction (Su
     C                     MOVEL#1BKCD    BTBKCD           Book Code
     C                     Z-ADD#1SPFC    BTSPFC           Spread Factor
     C                     MOVEL#1RVDI    BTRVDI           Reverse/Void In
      *
      * USER: Processing before DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MBDU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0181MBDU
     C*
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0181MC22
     C                     UPDAT@BTREAK                91  *
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF change successful
      *                                                                                       CGL013
      ** Additional Information Maintenance Screen                                            CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C           #1ADIN    ANDEQ'Y'                                                           CGL013
     C                     MOVELBTBTNB    PABTNB                                              CGL013
     C                     MOVELBTBINB    PABINB                                              CGL013
     C                     MOVEL#1RACN    PARACN                                              CGL013
     C                     CALL 'GL000185'                                                    CGL013
     C                     PARM *BLANKS   PRTCD                                               CGL013
     C                     PARM           PDETLS                                              CGL013
     C                     PARM *BLANK    PADD                                                CGL013
     C                     PARM 'M'       PMODE                                               CGL013
     C                     PARM '0'       PEXIT1  1                                         BUG23742
     C                     PARM '0'       PCANC1  1                                         BUG23742
     C                     PARM           PVBIPX                                              246418
     C                     PARM 'N'       APIMOD  1                                           246418
     C                     PARM           FLDNMA                                              246418
     C                     PARM           MSGIDA                                              246418
     C                     PARM           MSGDTA                                              246418
      *                                                                                       CGL013
     C                     MOVE 'N'       #1ADIN                                              CGL013
     C           PADD      IFEQ 'Y'                                                           CGL013
     C                     MOVE '*'       #1AIPI                                              CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE *BLANK    #1AIPI                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     ENDIF                                                              CGL013
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MADU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0181MADU
     C*
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SEEXIT    ENDSR
      /EJECT
     CSR         SFRVGN    BEGSR
      *================================================================
      * Was posting Retail? - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSF     KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Move fields to key list
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
     C           KRSSF     CHAIN@BTREAL              90    *
      * DBF record not found
     C   90                MOVEL'GLX0176' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process DBF record
      * PAR = DB1 By name
     C                     MOVELBTACTY    WUACTY           Account type
     C                     END
      *================================================================
     CSR         SFEXIT    ENDSR
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Check Account Identifier
      *================================================================
      * CASE: RCD.Account Identifier is Entered
     C           #RACID    IFNE *BLANK                     *IF
      * Determine Account type - Standard functions  *
     C                     MOVEL#RACID    UKACID           10-Char.A/C ID
     C******               EXSR UKACCK                                    E17819
     C                     EXSR XXIN                                      E17819
     C                     MOVELUKTYPE    WUAISF           Account type
     C*SR***      UKACCK    BEGSR                                         E17819
      * CASE: WRK.Account ID Status Flag is Error
     C           WUAISF    IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0009           Account Identif
      * Send message 'Account ID not valid ERR'
     C                     MOVEL'GLX0119' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Check for Retail Account No
      *================================================================
      * CASE: WRK.Account ID Status Flag is Retail
     C           WUAISF    IFEQ '*RETAIL'                  *IF
     C                     MOVEL'N'       WURNIA           Ret / Nostro In
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RACID    ZA0010           Account Identif
      * Send message 'Account ID not valid'
     C                     MOVEL'GLX0050' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.Currency code is Not blank
     C           #1CYCD    IFNE *BLANK                     *IF
      * CASE: RCD.Currency code NE WRK.Currency code
     C           #1CYCD    IFNE WUCYCD                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0011           Account Identif
      * Send message 'Retail Code not valid'
     C                     MOVEL'GLX0170' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     MOVEL'Y'       WURNIA           Ret / Nostro In
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Account code is Not blank
     C           #1ACCD    IFNE *BLANK                     *IF
      * CASE: RCD.Account code NE WRK.Account code
     C           #1ACCD    IFNE WUACCD                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0012           Account Identif
      * Send message 'Retail Code not valid'
     C                     MOVEL'GLX0170' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     MOVEL'Y'       WURNIA           Ret / Nostro In
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Account sequence number is Not blank
     C           #1ACSN    IFNE *BLANK                     *IF
      * CASE: RCD.Account sequence number NE WRK.Account sequence number
     C           #1ACSN    IFNE WUACSN                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0013           Account Identif
      * Send message 'Retail Code not valid'
     C                     MOVEL'GLX0170' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     MOVEL'Y'       WURNIA           Ret / Nostro In
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * CASE: RCD.Input Branch Code - Alpha NE WRK.Input Branch Code - Alpha
     C           #1IBCA    IFNE WUIBCA                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0014           Account Identif
      * Send message 'Retail Code not valid'
     C                     MOVEL'GLX0170' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     MOVEL'Y'       WURNIA           Ret / Nostro In
     C                     END                             *FI
     C                     END                             *FI
      * CASE: WRK.Ret / Nostro Inval Ac is No Error
     C           WURNIA    IFEQ 'N'                        *IF
     C                     MOVELWUIBCA    #1IBCA           Input Branch Co
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUACTY    #1ACTY           Account type
     C                     Z-ADDWURACN    #1RACN           Retail account
     C                     Z-ADDWURRNM    #1RRNM           Relative rec no
     C                     MOVEL'Y'       #1RNBE           Retail Number E
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Check for Nostro Account No
      *================================================================
      * CASE: WRK.Account ID Status Flag is Nostro
     C           WUAISF    IFEQ '*NOSTRO'                  *IF
      * Obtain nostro code - Standard functions  *
     C                     MOVEL#RACID    UXNOST  5        Nostro
     C                     MOVELUXNOST    #1CYCD           Nostro Ccy.
     C                     MOVE UXNOST    #1NNBI           Nostro No.
      * Access Nostro Details. - Nostro Details  *
     C*
     C* Set up Parameters for call to AONOSTR0
     C*
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACCD
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1NNBI    UUNONB
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Access Nostro Details file for the file fields
     C*
     C                     CALL 'AONOSTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCUST  6        I:Customer No.
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACCD  4        I:Account Code                     CGL029
     C                     PARM           UUACCD                                              CGL029
     C                     PARM           UUACSN  2        I:Account Seque
     C                     PARM           UUNONB  2        I:Nostro Number
     C                     PARM           UUBRCD  3        I:Branch Code
     C                     PARM *BLANK    UUCSSN 10        I:Cust ShortN  S01230
     C                     PARM *BLANK    UUPNOI  1        I:Prime Nost InS01230
     C           D@NOST    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA7CYCD    WUCYCD           Currency Code
     C                     MOVELA7NONB    WUNNBI           Nostro Number
     C                     MOVELA7ACCD    WUACCD           Account Code
     C                     MOVELA7CUST    WUCUST           Customer Number
     C                     MOVELA7ACSN    WUACSN           Account Sequenc
     C                     MOVELA7NOSN    WUNOSN           Nostro Shortnam
     C***********          MOVELA7OANN    WUOANN           Our A/c Nost                       210796
     C                     MOVELA7OACN    WUOANN           Our A/c Nost                       210796
     C                     MOVELA7ORAC    WUORAC           Our Rec A/c
     C                     MOVELA7PNOI    WUPNOI           Prime Nostro In
     C                     MOVELA7BRCD    WUIBCA           Branch Code
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RACID    ZA0015           Account Identif
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVELWUCUST    UUCUST
     C                     MOVELWUCYCD    UUCYCD
     C                     MOVELWUACCD    UUACNO
     C                     MOVELWUACSN    UUACSN
     C                     MOVELWUIBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C*
      * end of Fix LN0315
      * Check Account Number
     C                     EXSR UDSUBR                     Check Account N
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      * Check Account Number
      *================================================================
      * Check Rest of Account Number
     C                     EXSR UESUBR                     Check Rest of A
      * CASE: WRK.Ret / Nostro Inval Ac is No Error
     C           WURNIA    IFEQ 'N'                        *IF
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUNNBI    #1NNBI           Nostro number (
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     MOVELWUIBCA    #1IBCA           Input Branch Co
     C                     END                             *FI
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         UESUBR    BEGSR
      *================================================================
      * Check Rest of Account Number
      *================================================================
     C                     MOVEL'N'       WURNIA           Ret / Nostro In
      * CASE: RCD.Currency code is Not blank
     C           #1CYCD    IFNE *BLANK                     *IF
      * CASE: RCD.Currency code NE WRK.Currency code
     C           #1CYCD    IFNE WUCYCD                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0016           Account Identif
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     MOVEL'Y'       WURNIA           Ret / Nostro In
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Account code is Not blank
     C           #1ACCD    IFNE *BLANK                     *IF
      * CASE: RCD.Account code NE WRK.Account code
     C           #1ACCD    IFNE WUACCD                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0017           Account Identif
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     MOVEL'Y'       WURNIA           Ret / Nostro In
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Account sequence number is Not blank
     C           #1ACSN    IFNE *BLANK                     *IF
      * CASE: RCD.Account sequence number NE WRK.Account sequence number
     C           #1ACSN    IFNE WUACSN                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0018           Account Identif
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     MOVEL'Y'       WURNIA           Ret / Nostro In
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * CASE: RCD.Input Branch Code - Alpha NE WRK.Input Branch Code - Alpha
     C           #1IBCA    IFNE WUIBCA                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0019           Account Identif
      * Send message 'Nostro code not valid'
     C                     MOVEL'GLX0065' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     MOVEL'Y'       WURNIA           Ret / Nostro In
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UEEXIT    ENDSR
      /EJECT
     CSR         UFSUBR    BEGSR
      *================================================================
      * Obtain NOSTRO details
      *================================================================
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is *No Errors
     C           WUAPRC    IFEQ *BLANK                     *IF
      * Access Nostro Details. - Nostro Details  *
     C*
     C* Set up Parameters for call to AONOSTR0
     C*
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACCD
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1NNBI    UUNONB
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Access Nostro Details file for the file fields
     C*
     C                     CALL 'AONOSTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCUST  6        I:Customer No.
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACCD  4        I:Account Code                     CGL029
     C                     PARM           UUACCD                                              CGL029
     C                     PARM           UUACSN  2        I:Account Seque
     C                     PARM           UUNONB  2        I:Nostro Number
     C                     PARM           UUBRCD  3        I:Branch Code
     C                     PARM *BLANK    UUCSSN 10        I:Cust ShortN  S01230
     C                     PARM *BLANK    UUPNOI  1        I:Prime Nost InS01230
     C           D@NOST    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA7CYCD    WUCYCD           Currency Code
     C                     MOVELA7NONB    WUNONB           Nostro Number
     C                     MOVELA7ACCD    WUACCD           Account Code
     C                     MOVELA7CUST    WUCUST           Customer Number
     C                     MOVELA7ACSN    WUACSN           Account Sequenc
     C                     MOVELA7NOSN    WUNOSN           Nostro Shortnam
     C***********          MOVELA7OANN    WUOANN           Our A/c Nost                       210796
     C                     MOVELA7OACN    WUOANN           Our A/c Nost                       210796
     C                     MOVELA7ORAC    WUORAC           Our Rec A/c
     C                     MOVELA7PNOI    WUPNOI           Prime Nostro In
     C                     MOVELA7BRCD    WUIBCA           Branch Code
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     MOVEL*BLANK    #1NNBI           Nostro number (
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUNONB    #1NNBI           Nostro number (
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UFEXIT    ENDSR
      /EJECT
     CSR         UGSUBR    BEGSR
      *================================================================
      * SPF Branch code
      *================================================================
      * CASE: RCD.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1IBCA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     ELSE
      * CASE: *OTHERWISE
      * Val. Action Cde & Bch U/P - Standard functions  *
     C                     CALL 'ZVACTBU'              90  Val. Action Cde
     C**********           PARM 'A'       WQ0009  1        SPF Action Code                    189519
     C                     PARM P4SACD    WQ0009  1        SPF Action Code                    189519
     C                     PARM #1IBCA    WQ0010  3        Branch code
     C           WUSPEC    PARM *ZERO     WQ0011  10       SPF Error Condi
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.SPF Error Condition is One
     C           WUSPEC    IFEQ 1                          *IF
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0029           Input Branch Co
      * Send message 'SPF Atn Cde ERR 1 ZVACTBU'
     C                     MOVEL'GLX0186' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     ELSE
      * CASE: WRK.SPF Error Condition is Two
     C           WUSPEC    IFEQ 2                          *IF
      * Setup message data for message
     C**********           MOVEL'A'       ZA0030           SPF Action Code                    189519
     C                     MOVELP4SACD    ZA0030           SPF Action Code                    189519
     C                     MOVEL#1IBCA    ZA0031           Input Branch Co
      * Send message 'SPF Atn Cde ERR 5 ZVACTBU'
     C                     MOVEL'GLX0206' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0032           Input Branch Co
      * Send message 'Branch Code Required'
     C                     MOVEL'GLX0201' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     END                             *FI
      *================================================================
     CSR         UGEXIT    ENDSR
      /EJECT
     CSR         UHSUBR    BEGSR
      *================================================================
      * Check Posting amount
      *================================================================
      * Get Number of Decimal Places
      * CASE: RCD.Currency code is Not Question Mark
     C           #1CYCD    IFNE '?'                        *IF
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
      * Set up Number of Decimals and digits for zalign
      * CASE: WRK.Number of Decimal Places is Zero
     C           WUNBDP    IFEQ *ZERO                      *IF
     C                     Z-ADD*ZERO     WUZNDE           ZALIGN No Of De
     C***********          Z-ADD12        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD13        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is One
     C           WUNBDP    IFEQ 1                          *IF
     C                     Z-ADD1         WUZNDE           ZALIGN No Of De
     C***********          Z-ADD11        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD12        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is Two
     C           WUNBDP    IFEQ 2                          *IF
     C                     Z-ADD2         WUZNDE           ZALIGN No Of De
     C***********          Z-ADD10        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD11        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is Three
     C           WUNBDP    IFEQ 3                          *IF
     C                     Z-ADD3         WUZNDE           ZALIGN No Of De
     C***********          Z-ADD9         WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD10        WUZNDI           ZALIGN No Of Di089856
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#RFMPA    WUZASF           ZALIGN Screen F
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0181MCP2                                           S01408
     C*                                                                   S01408
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0012  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0013 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0014  10       ZALIGN No Of De
     C                     PARM WUZNDI    WQ0015  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0016 16        ZALIGN File Fie
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0181MCP3                                           S01408
     C*                                                                   S01408
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0181MCP4                                           S01408
     C*                                                                   S01408
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0017 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0018  10       ZALIGN No Of De
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0181MCP3                                           S01408
     C*                                                                   S01408
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0033           Formatted Posti
      * Send message 'Amount not valid'
     C                     MOVEL'GLX0063' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9837  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * MOVE Posting Amount - Journal Entry Posting  *
     C*  MOVE ZALIGN FILE FIELD INTO POSTING AMOUNT
     C                     MOVE WUZAFF    #1PTAM
      * Move Fmt Posting Amount - Journal Entry Posting  *
     C*  MOVE ZALIGN FUNCTION FIELD INTO FORMATTED POSTING AMOUNT
     C                     MOVE WUZASF    #RFMPA
     C                     END                             *FI
      *================================================================
     CSR         UHEXIT    ENDSR
      /EJECT
     CSR         UISUBR    BEGSR
      *================================================================
      * Check Narrative
      *================================================================
     C                     MOVEL*BLANK    #1NVCD           Narrative code
     C                     MOVEL*BLANK    #1NRDC           Narrative descr
      * Check Narrative - Standard functions  *
     C*  Check Narrative for Narrative code
     C*
     C                     MOVE #RNRTV    URNARR 28        Narrative slice
      *
     C           #RNRTV    IFNE *BLANK                     IF ¬BLANK
     C           URNARR    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*CODE  ' WUNRST             Code entered
     C                     MOVEL#RNRTV    #1NVCD             Narrative code
     C                     ELSE                            EL ¬BLANK
     C                     MOVE '*TEXT  ' WUNRST             Narrative text
     C                     MOVE *BLANK    #1NVCD             No Narr.code
     C                     END                             FI
     C                     ELSE                            EL BLANK
     C                     MOVE '*ERROR ' WUNRST             No narrative
     C                     MOVE *BLANK    #1NVCD             No Narr.code
     C                     END                             FI
      *
      * CASE: WRK.Narrative status is Narrative code entered
     C           WUNRST    IFEQ '*CODE'                    *IF
      * Access Narrative. - Narrative Codes  *
     C*
     C*  Access Narrative codes file for the following fields
     C*  Narrative Code, Narrative Description
     C*
     C                     MOVEL#1NVCD    UUNVCD
     C                     CALL 'AONARRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUNVCD  2        I:Narrative Code
     C           D@NARR    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELALNVCD    #1NVCD           Narrative Code
     C                     MOVELALDON     WUDON            Description
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RNRTV    ZA0035           Narrative
      * Send message 'Narrative Code not found'
     C                     MOVEL'GLX0049' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVEL#1NVCD    #RNRTV           Narrative
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#RNRTV    #1NRDC           Narrative descr
     C                     END                             *FI
      *================================================================
     CSR         UIEXIT    ENDSR
      /EJECT
     CSR         UJSUBR    BEGSR
      *================================================================
      * Check Transaction Type & Value Date
      *================================================================
      * Check Transaction type
     C                     EXSR UKSUBR                     Check Transacti
      * Check Value Date
      * CASE: RCD.Value date (display) is Date entered
     C           #RVDDS    IFNE *BLANK                     *IF
      * Start of Fix LN0315
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C                     MOVELPRFC      WUPRFC           Profit Centre  CAC001
     C*
      * End of Fix LN0315
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE #RVDDS    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0019  7        *Return code
     C                     PARM WUDTNF    WQ0020  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0021  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0022  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0037           Value date (dis
      * Send message 'Value Date not valid 2'
     C                     MOVEL'GLX0110' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#RVDDS    WUWVDD           Work Value Date
      * Check VDate Blank Entries - Standard functions  *
     C                     CALL 'GL0131U'              90  Check VDate Bla
     C           WUWVDD    PARM WUWVDD    WQ0023  6        Value date (dis
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Check Numeric - Standard functions  *
     C                     MOVE *IN20     UUIN20  1
     C                     MOVE *IN21     UUIN21  1
     C           *LIKE     DEFN WUWVDD    UUVLDT+ 1
     C                     MOVELWUWVDD    UUVLDT
     C                     MOVE '0'       UUVLDT
     C                     TESTN          UUVLDT       21
     C           *IN21     IFEQ '1'
     C                     MOVEL'0'       UUVLDT
     C                     END
     C                     TESTN          UUVLDT     20
     C           *IN20     IFEQ '0'
     C                     MOVE '*NUMERR' W0RTN
     C                     ELSE
     C                     MOVE *BLANKS   W0RTN
     C                     END
     C                     MOVE UUIN20    *IN20
     C                     MOVE UUIN21    *IN21
      * CASE: PGM.*Return code is *Numeric Error
     C           W0RTN     IFEQ '*NUMERR'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0038           Value date (dis
      * Send message 'Value Date not valid 1'
     C                     MOVEL'GLX0109' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * CASE: WRK.Date (numeric format) is Gt 30
     C           WUDTNF    IFGT 30                         *IF
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0024  7        *Return code
     C                     PARM WUDTNF    WQ0025  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0026  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0027  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0039           Value date (dis
      * Send message 'Value Date not valid 2'
     C                     MOVEL'GLX0110' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    #RVDDS           Value date (dis
      * CASE: RCD.Value date GE WRK.Runday Number
     C           #1VLDT    IFGE WURDNO                     *IF
     C                     Z-ADD30        WUNBFD           Number of Forwa
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C                     MOVELBJLCCY    WULCCY
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVELP2BCDA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * Locate Local.CCY.Fwd.Days - Standard functions  *
     C                     CALL 'SZDATE3'              90  Locate Local.CC
     C                     PARM WURDNO    WQ0028  50       Runday Number
     C                     PARM WULCCY    WQ0029  3        Local Currency
     C                     PARM WULCCD    WQ0030  3        Location Code
     C                     PARM WUNBFD    WQ0031  20       Number of Forwa
     C           WUFDNB    PARM *ZERO     WQ0032  50       Forward Day Num
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: RCD.Value date GT WRK.Forward Day Number
     C           #1VLDT    IFGT WUFDNB                     *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0040           Value date (dis
      * Send message 'Value Date not valid 3'
     C                     MOVEL'GLX0111' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      * Check Value Date NE Hol. - Standard functions  *
     C                     CALL 'GL0130U'              90  Check Value Dat
     C                     PARM #1VLDT    WQ0033  50       Value date
     C                     PARM WULCCY    WQ0034  3        Local Currency
     C                     PARM WULCCD    WQ0035  3        Location Code
     C           WUJJST    PARM *BLANK    WQ0036  1        Error Ind - Day
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.Error Ind - Day - Holiday is Record Found
     C           WUJJST    IFEQ 'H'                        *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0041           Value date (dis
      * Send message 'Value Date Not Valid 9'
     C                     MOVEL'GLX0117' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    #RVDDS           Value date (dis
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C                     MOVELBJLCCY    WULCCY
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVELP2BCDA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE #RVDDS    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Locate Local.CCY.Fwd.Days - Standard functions  *
     C                     CALL 'SZDATE3'              90  Locate Local.CC
     C                     PARM WURDNO    WQ0037  50       Runday Number
     C                     PARM WULCCY    WQ0038  3        Local Currency
     C                     PARM WULCCD    WQ0039  3        Location Code
     C                     PARM WUNBFD    WQ0040  20       Number of Forwa
     C           WUFDNB    PARM *ZERO     WQ0041  50       Forward Day Num
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM WUFDNB    WQ0042  50       Runday Number
     C                     PARM WUDTFF    WQ0043  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0044  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0045  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    #RVDDS
     C                     END                             *FI
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE #RVDDS    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           W0RTN     PARM W0RTN     WQ0046  7        *Return code
     C                     PARM WUDTNF    WQ0047  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0048  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0049  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Invalid Date - No further validation required
     C                     ELSE
      * CASE: *OTHERWISE
      * Value Date A/c Validation - Standard functions  *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANK    P@RTCD  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option
     C                     PARM '*FIRST'  P@OPTN  7        I:Option
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C* Set Retail Key = Numeric Retail Account Number
     C                     MOVEL#1RACN    P@RETK 10
     C*
     C                     CALL 'AOACCTR0'
     C                     PARM *BLANK    P@RTCD  7        B:Return code
     C                     PARM '*KEY'    P@OPTN  7        I:Option
     C*********************PARM #IRACN    P@RETK 10        I:Key field
     C                     PARM           P@RETK           I:Key field
     C                     PARM #1CUST    P@CNUM  6        I:Key field
     C                     PARM #1CYCD    P@CCY   3        I:Key field
     C**********           PARM #1ACCD    P@ACOD  4        I:Key field                        CGL029
     C                     PARM #1ACCD    P@ACOD 10        I:Key field                        CGL029
     C                     PARM #1ACSN    P@ACSQ  2        I:Key field
     C                     PARM #1IBCA    P@IBCA  3        I:Key Field
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* EXTRACT BACK VALUEING PERIOD & CALCULATE BACK VALUE DATE
     C*
     C           WURDNO    SUB  BJBVPD    UUBRUN  50
     C*
     C* SAVE INDICATORS
     C*
     C                     MOVE *IN33     UUIN33  10
     C                     MOVE *IN64     UUIN64  10
     C                     MOVE *IN69     UUIN69  10
     C*
     C                     SETOF                     336469
     C*
     C** DR/CR INT.BEARING
     C*
     C***********AADRIF****IFEQ ' '                         IF 1          S01117
     C           DRIF      IFEQ ' '                         IF 1          S01117
     C***********AACRIF****ANDEQ' '                                       S01117
     C           CRIF      ANDEQ' '                                       S01117
     C***********AALDID****COMP AALCID               64                   S01117
     C           LDID      COMP LCID                 64                   S01117
     C***64******UUBRUN****COMP AALDID                 69                 S01117
     C   64      UUBRUN    COMP LDID                   69                 S01117
     C**N64******UUBRUN****COMP AALCID                 69                 S01117
     C  N64      UUBRUN    COMP LCID                   69                 S01117
     C*
     C   69      #1VLDT    COMP UUBRUN                 33
     C***64N69***#1VLDT****COMP AALDID                 3333               S01117
     C   64N69   #1VLDT    COMP LDID                   3333               S01117
     C**N64N69***#1VLDT****COMP AALCID                 3333               S01117
     C  N64N69   #1VLDT    COMP LCID                   3333               S01117
     C   33                MOVE '*DRCRER' W0RTN
     C                     ELSE                              ELSE 1
     C*
     C** CR INT BEARING ONLY
     C*
     C***********AADRIF****IFEQ ' '                          IF 2         S01117
     C           DRIF      IFEQ ' '                          IF 2         S01117
     C***********AALCID****COMP UUBRUN               64                   S01117
     C           LCID      COMP UUBRUN               64                   S01117
     C      64   #1VLDT    COMP UUBRUN                 33
     C*****N64***#1VLDT****COMP AALCID                 3333               S01117
     C     N64   #1VLDT    COMP LCID                   3333               S01117
     C   33                MOVE '*DTCRER' W0RTN
     C                     ELSE                              ELSE 2
     C*
     C** DR INT.BEARING ONLY
     C*
     C***********AACRIF****IFEQ ' '                          IF 3         S01117
     C           CRIF      IFEQ ' '                          IF 3         S01117
     C***********AALDID****COMP UUBRUN               64                   S01117
     C           LDID      COMP UUBRUN               64                   S01117
     C      64   #1VLDT    COMP UUBRUN                 33
     C*****N64***#1VLDT****COMP AALDID                 3333               S01117
     C     N64   #1VLDT    COMP LDID                   3333               S01117
     C   33                MOVE '*DTDRER' W0RTN
     C                     ELSE                              ELSE 3
     C*
     C**   NOT INT.BEARING
     C*
     C           #1VLDT    COMP UUBRUN                 33
     C   33                MOVE '*BVLDER' W0RTN
     C                     END                               END 3
     C                     END                               END 2
     C                     END                               END 1
     C*
     C**   CHECK AGAINST DATE THE ACCOUNT WAS OPENED
     C*
     C           DACO      IFGT #1VLDT                       IF 1
     C                     MOVE '*DTOPER' W0RTN
     C                     END                               END 1
     C*
     C* RESTORE INDICATORS
     C*
     C                     MOVE UUIN33    *IN33
     C                     MOVE UUIN64    *IN64
     C                     MOVE UUIN69    *IN69
      * CASE: PGM.*Return code is Value Date Before Ac Open
     C           W0RTN     IFEQ '*DTOPER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0042           Value date (dis
      * Send message 'Value Date not valid 4'
     C                     MOVEL'GLX0112' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef Back Value Date
     C           W0RTN     IFEQ '*BVLDER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0043           Value date (dis
      * Send message 'Value Date not valid 5'
     C                     MOVEL'GLX0113' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Before Last CR Int
     C           W0RTN     IFEQ '*DTCRER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0044           Value date (dis
      * Send message 'Value Date Not Valid 6'
     C                     MOVEL'GLX0114' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Before Last DR Int
     C           W0RTN     IFEQ '*DTDRER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0045           Value date (dis
      * Send message 'Value Date Not Valid 7'
     C                     MOVEL'GLX0115' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef. Last CR/DR Int
     C           W0RTN     IFEQ '*DRCRER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0046           Value date (dis
      * Send message 'Value Date Not Valid 8'
     C                     MOVEL'GLX0116' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RVDDS           Value date (dis
     C***********          Z-ADDWURDNO    #1VLDT           Value date     099867
     C                     Z-ADD*ZEROS    #1VLDT           Value date     099867
     C                     END                             *FI
      *================================================================
     CSR         UJEXIT    ENDSR
      /EJECT
     CSR         UKSUBR    BEGSR
      *================================================================
      * Check Transaction type
      *================================================================
      * CASE: RCD.Transaction type is Select Request
     C           #1TRTY    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * CASE: RCD.Transaction type is Entered
     C           #1TRTY    IFNE *BLANK                     *IF
      * Access Retail Transact. - Retail Transaction Types  *
     C*
     C*  Access Retail Transaction types for the file fields
     C*
     C                     MOVEL#1TRTY    UURTTY
     C                     CALL 'AORETRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UURTTY  5        I:Retail Tran Type
     C           D@RETR    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA1RTTY    WUTRTY           Retail Transaction Ty
     C                     MOVELA1RTNM    WURTNM           Retail Tran Name
     C                     MOVELA1COIN    WUCOIN           Cust Originated Ind
     C                     MOVELA1DCIN    WUDCIN           Debit/Credit Ind
     C                     MOVELA1RVIN    WURVIN           Reversal Indicator
     C                     MOVELA1PADI    WUPADI           Print Advices Ind
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1TRTY    ZA0036           Transaction typ
      * Send message 'Trans. type not valid'
     C                     MOVEL'GLX0059' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9840  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUTRTY    #1TRTY           Transaction typ
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UKEXIT    ENDSR
      /EJECT
     CSR         ULSUBR    BEGSR
      *================================================================
      * Check Profit Centre
      *================================================================
      * CASE: RCD.Profit centre is Entered
     C           #1PRCN    IFNE *BLANK                     *IF
      * CASE: WRK.Profit Centres Used is Yes
     C           WUPRCU    IFEQ 'Y'                        *IF
      * CASE: RCD.Profit centre is Select requested
     C           #1PRCN    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access profit Centre - Profit Centres  *
     C*
     C*  Access Def centre code off file.
     C*
     C                     MOVEL#1PRCN    UUPCCD
     C                     CALL 'AOPRFCR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUPCCD  4        I:Profit Cent
     C           D@PRFC    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELDSPCCD    WUPCCD           Profit Centre
     C                     MOVELDSPCCD    WUPCDS           Prof Cent Desc
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0049           Profit centre
      * Send message 'Profit Centres         NF'
     C                     MOVEL'GLX0182' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9845  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUPCCD    #1PRCN           Profit centre
     C                     END                             *FI
      *                                                                   CAC001
      **  Analytical Accounting module is switched on                     CAC001
      **  and Account type is either Retail or Nostro                     CAC001
      *                                                                   CAC001
     C           WUN0ST    IFEQ 'Y'                        *IF            CAC001
     C           WUACTY    ANDEQ'R'                                       CAC001
     C           WUN0ST    OREQ 'Y'                                       CAC001
     C           WUACTY    ANDEQ'N'                                       CAC001
      * Check if Profit Centre entered is the Profit Centre of Account    CAC001
     C           #1PRCN    IFNE WUPRFC                     *IF            CAC001
     C           WKWARN    ANDEQ'Y'                                       CAC001
      * Setup message data for message                                    CAC001
     C                     MOVEL#1PRCN    ZA0092           Profit centre  CAC001
      * Send message 'Profit Centres         NF'                          CAC001
     C                     MOVEL'GLX0391' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     SETON                     45    *              CAC001
      *                                                                   CAC001
     C                     END                             *FI            CAC001
     C                     END                             *FI            CAC001
      *                                                                   CAC001
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: WRK.Profit Centre Def'ts Used is Yes
     C           WUPCDU    IFEQ 'Y'                        *IF
      * CASE: RCD.Transaction type is Not entered
     C           #1TRTY    IFEQ *BLANK                     *IF
     C                     MOVEL*BLANK    WUTRTY           Transaction typ
     C                     MOVEL'JE'      WUTRTY           Transaction typ
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#1TRTY    WUTRTY           Transaction typ
     C                     END                             *FI
      *                                                                   CAC001
      **  If Analytical Accounting module is switched on, default         CAC001
      **  the profit centre to the profit centre of the account for       CAC001
      **  Retail and Nostro Accounts only.                                CAC001
      *                                                                   CAC001
     C           WUN0ST    IFEQ 'Y'                                       CAC001
     C           #1ACTY    ANDEQ'R'                                       CAC001
     C           WUN0ST    OREQ 'Y'                                       CAC001
     C           #1ACTY    ANDEQ'N'                                       CAC001
     C                     MOVELWUPRFC    WUPRCN                          CAC001
     C                     MOVELWUPRFC    #1PRCN                          CAC001
     C                     ELSE                                           CAC001
      * Set Prof C Def Mat Key *s - Standard functions  *
     C                     MOVEL'**'      WUBKCD
     C                     MOVEL'**'      WUSBTY
     C                     MOVEL'**'      WUACOC
      * Access Prof C Def Matrix. - Profit Centre Dft Matrix  *
     C*
     C*  Access Def Prof centre code off file.
     C*
     C                     CALL 'AOPRFMR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM WUBKCD    UUBKCD  2        I:Book Code
     C                     PARM #1TRTY    UUPCTT  5        I:Trans Type
     C                     PARM WUSBTY    UUSBTY  2        I:Sub Type
     C                     PARM #1IBCA    UUBRCD  3        I:Branch Code
     C                     PARM P6DPCD    UUDPCD  3        I:Department
     C                     PARM ##USR     UUUSID 10        I:User Profile
     C                     PARM WUACOC    UUACOC  2        I:A/c Officer
     C                     PARM #1CUST    UUCUST  6        I:Customer No.
     C                     PARM *BLANK    UUPCCD  4        O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUPCCD    WUPRCN           Profit Centre
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 0
     C           WUAPRC    IFEQ '0'                        *IF
     C                     MOVELWUPRCN    #1PRCN           Profit centre
     C                     ELSE
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 1
     C           WUAPRC    IFEQ '1'                        *IF
     C                     MOVEL*BLANK    #1PRCN           Profit centre
     C                     ELSE
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 2
     C           WUAPRC    IFEQ '2'                        *IF
     C                     MOVELWUPRCN    #1PRCN           Profit centre
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0050           Profit centre
      * Send message 'Def Prof Centre Not Found'
     C                     MOVEL'GLX0203' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9845  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *                                                                   CAC001
      **  If Analytical Accounting is on and default profit centre is     CAC001
      **  blank, send an error message                                    CAC001
      *                                                                   CAC001
     C           WUN0ST    IFEQ 'Y'                                       CAC001
     C           #1PRCN    ANDEQ*BLANK                                    CAC001
     C                     MOVEL#1PRCN    ZA0093                          CAC001
     C                     MOVEL'GLX0390' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     SETON                     9845                 CAC001
     C                     END                                            CAC001
      *                                                                   CAC001
     C                     END                             *FI            CAC001
     C                     ELSE                                           CAC001
      * CASE: *OTHERWISE                                                  CAC001
      * CASE: WRK. Profit Centre Def'ts Used is No                        CAC001
      * IF Analytical Accounting Module is switched on, make profit       CAC001
      * centre field mandatory.                                           CAC001
     C           WUN0ST    IFEQ 'Y'                                       CAC001
     C                     MOVEL#1PRCN    ZA0093                          CAC001
      * Send message 'Prof Centre must be entered'                        CAC001
     C                     MOVEL'GLX0390' ZAMSID                          CAC001
     C                     EXSR ZASNMS                                    CAC001
     C                     SETON                     9845                 CAC001
     C                     END                                            CAC001
      *                                                                   CAC001
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         ULEXIT    ENDSR
      /EJECT
     CSR         UMSUBR    BEGSR
      *================================================================
      * Setup Branch code (Header) & Posting Date on RCD
      *================================================================
     C                     MOVELP2BCDA    #1BCBH           Branch Code (Ba
     C                     Z-ADDWURDNO    #1PTDT           Posting date
      *================================================================
     CSR         UMEXIT    ENDSR
      /EJECT
     CSR         UNSUBR    BEGSR
      *================================================================
      * Store data for *Copy function
      *================================================================
     C                     EXSR UOSUBR
      *================================================================
     CSR         UNEXIT    ENDSR
      /EJECT
     CSR         UOSUBR    BEGSR
      *================================================================
      *
      *================================================================
     C                     MOVEL#RACID    WUCACI           Copy:Account id
     C                     MOVEL#1CYCD    WUCCCD           Copy:Currency c
     C                     MOVEL#1ACCD    WUCPAC           Copy:Account co
     C                     MOVEL#1ACSN    WUCACS           Copy:Account Se
     C                     MOVEL#1IBCA    WUCBCA           Copy:Branch Cod
     C                     MOVEL#RFMPA    WUCAMT           Copy:Amount
     C                     MOVEL#1DCIN    WUCDCI           Copy:DR/CR Indi
     C                     MOVEL#RNRTV    WUCNAR           Copy:Narrative
     C                     MOVEL#1TRTY    WUCTRT           Copy:Transactio
     C                     MOVEL#1CQNB    WUCCNB           Copy:Cheque Num
     C                     MOVEL#RASCD    WUASSC           Copy:Assoc Cust
     C                     MOVEL#RVDDS    WUCVDT           Copy:Value Date
     C                     MOVEL#1SWCR    WUCSCR           Copy:Swift Comm
     C                     MOVEL#1PRCN    WUCPRC           Copy:Profit Cen
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0181MCP5                                           S01408
     C*                                                                   S01408
      *================================================================
     CSR         UOEXIT    ENDSR
      /EJECT
     CSR         UPSUBR    BEGSR
      *================================================================
      **Store*data*for**Copy/last*record*function*using*copy*char******   087770
      * Clear Copy / Template Function work fields                        087770
      *================================================================
     C                     EXSR UQSUBR
      *================================================================
     CSR         UPEXIT    ENDSR
      /EJECT
     CSR         UQSUBR    BEGSR
      *================================================================
      *
      * Clear Copy / Template Function work fields                        087770
      *
      *================================================================
     C***********          MOVEL#RACID    WUCACI           Copy:Account id087770
     C***********          MOVEL#1CYCD    WUCCCD           Copy:Currency c087770
     C***********          MOVEL#1ACCD    WUCPAC           Copy:Account co087770
     C***********          MOVEL#1ACSN    WUCACS           Copy:Account Se087770
     C***********          MOVEL#1IBCA    WUCBCA           Copy:Branch Cod087770
     C***********          MOVEL#RFMPA    WUCAMT           Copy:Amount    087770
     C***********          MOVEL#1DCIN    WUCDCI           Copy:DR/CR Indi087770
     C***********          MOVEL#RNRTV    WUCNAR           Copy:Narrative 087770
     C***********          MOVEL#1TRTY    WUCTRT           Copy:Transactio087770
     C***********          MOVEL#1CQNB    WUCCNB           Copy:Cheque Num087770
     C***********          MOVEL#RASCD    WUASSC           Copy:Assoc Cust087770
     C***********          MOVEL#RVDDS    WUCVDT           Copy:Value Date087770
     C***********          MOVEL#1SWCR    WUCSCR           Copy:Swift Comm087770
     C***********          MOVEL#1PRCN    WUCPRC           Copy:Profit Cen087770
      *                                                                   087770
     C           WUCFUS    IFEQ 'N'                                       087770
     C                     MOVE *BLANKS   WUCACI           Copy:Account id087770
     C                     MOVE *BLANKS   WUCCCD           Copy:Currency c087770
     C                     MOVE *BLANKS   WUCPAC           Copy:Account co087770
     C                     MOVE *BLANKS   WUCACS           Copy:Account Se087770
     C                     MOVE *BLANKS   WUCBCA           Copy:Branch Cod087770
     C                     MOVE *BLANKS   WUCAMT           Copy:Amount    087770
     C                     MOVE *BLANKS   WUCDCI           Copy:DR/CR Indi087770
     C                     MOVE *BLANKS   WUCNAR           Copy:Narrative 087770
     C                     MOVE *BLANKS   WUCTRT           Copy:Transactio087770
     C                     MOVE *BLANKS   WUCCNB           Copy:Cheque Num087770
     C                     MOVE *BLANKS   WUASSC           Copy:Assoc Cust087770
     C                     MOVE *BLANKS   WUCVDT           Copy:Value Date087770
     C                     MOVE *BLANKS   WUCSCR           Copy:Swift Comm087770
     C                     MOVE *BLANKS   WUCPRC           Copy:Profit Cen087770
     C                     ENDIF                                          087770
      *                                                                   087770
     C           WUTFUS    IFEQ 'N'                                       087770
     C                     MOVE *BLANKS   WZCACI           Tmpl:Account id087770
     C                     MOVE *BLANKS   WZCCCD           Tmpl:Currency c087770
     C                     MOVE *BLANKS   WZCPAC           Tmpl:Account co087770
     C                     MOVE *BLANKS   WZCACS           Tmpl:Account Se087770
     C                     MOVE *BLANKS   WZCBCA           Tmpl:Branch Cod087770
     C                     MOVE *BLANKS   WZCAMT           Tmpl:Amount    087770
     C                     MOVE *BLANKS   WZCDCI           Tmpl:DR/CR Indi087770
     C                     MOVE *BLANKS   WZCNAR           Tmpl:Narrative 087770
     C                     MOVE *BLANKS   WZCTRT           Tmpl:Transactio087770
     C                     MOVE *BLANKS   WZCCNB           Tmpl:Cheque Num087770
     C                     MOVE *BLANKS   WZASSC           Tmpl:Assoc Cust087770
     C                     MOVE *BLANKS   WZCVDT           Tmpl:Value Date087770
     C                     MOVE *BLANKS   WZCSCR           Tmpl:Swift Comm087770
     C                     MOVE *BLANKS   WZCPRC           Tmpl:Profit Cen087770
     C                     ENDIF                                          087770
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0181MCP6                                           S01408
     C*                                                                   S01408
      *================================================================
     CSR         UQEXIT    ENDSR
      /EJECT
     CSR         URSUBR    BEGSR
      *================================================================
      * Branch Code Validation
      *================================================================
      * CASE: PAR.Multiple Branch Batch is Yes
     C           P5MBRB    IFEQ 'Y'                        *IF
      * CASE: RCD.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * CASE: RCD.Input Branch Code - Alpha is Select Request
     C           #1IBCA    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1IBCA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0054           Input Branch Co
      * Send message 'Branch Code not found'
     C                     MOVEL'GLX0045' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUBRCD    #1IBCA           Input Branch Co
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UREXIT    ENDSR
      /EJECT
     CSR         USSUBR    BEGSR
      *================================================================
      * Store Data For Copy / template Function
      *================================================================
      * IF:*SFLSEL is COPY                                                087770
     C           #1SEL     IFEQ 'C'                                       087770
     C                     MOVEL#RACID    WUCACI           Copy:Account id
     C                     MOVEL#1CYCD    WUCCCD           Copy:Currency c
     C                     MOVEL#1ACCD    WUCPAC           Copy:Account co
     C                     MOVEL#1ACSN    WUCACS           Copy:Account Se
     C                     MOVEL#1IBCA    WUCBCA           Copy:Branch Cod
     C                     MOVEL#RFMPA    WUCAMT           Copy:Amount
     C                     MOVEL#1DCIN    WUCDCI           Copy:DR/CR Indi
     C                     MOVEL#RNRTV    WUCNAR           Copy:Narrative
     C                     MOVEL#1TRTY    WUCTRT           Copy:Transactio
     C                     MOVEL#1CQNB    WUCCNB           Copy:Cheque Num
     C                     MOVEL#RASCD    WUASSC           Copy:Assoc Cust
     C                     MOVEL#RVDDS    WUCVDT           Copy:Value Date
     C                     MOVEL#1SWCR    WUCSCR           Copy:Swift Comm
     C                     MOVEL#1PRCN    WUCPRC           Copy:Profit Cen
     C                     ENDIF                                          087770
      *                                                                   087770
      * IF:*SFLSEL is Template                                            087770
     C           #1SEL     IFEQ 'T'                                       087770
     C                     MOVEL#RACID    WZCACI           Tmpl:Account id087770
     C                     MOVEL#1CYCD    WZCCCD           Tmpl:Currency c087770
     C                     MOVEL#1ACCD    WZCPAC           Tmpl:Account co087770
     C                     MOVEL#1ACSN    WZCACS           Tmpl:Account Se087770
     C                     MOVEL#1IBCA    WZCBCA           Tmpl:Branch Cod087770
     C                     MOVEL#RFMPA    WZCAMT           Tmpl:Amount    087770
     C                     MOVEL#1DCIN    WZCDCI           Tmpl:DR/CR Indi087770
     C                     MOVEL#RNRTV    WZCNAR           Tmpl:Narrative 087770
     C                     MOVEL#1TRTY    WZCTRT           Tmpl:Transactio087770
     C                     MOVEL#1CQNB    WZCCNB           Tmpl:Cheque Num087770
     C                     MOVEL#RASCD    WZASSC           Tmpl:Assoc Cust087770
     C                     MOVEL#RVDDS    WZCVDT           Tmpl:Value Date087770
     C                     MOVEL#1SWCR    WZCSCR           Tmpl:Swift Comm087770
     C                     MOVEL#1PRCN    WZCPRC           Tmpl:Profit Cen087770
     C                     ENDIF                                          087770
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0181MCP7                                           S01408
     C*                                                                   S01408
      *================================================================
     CSR         USEXIT    ENDSR
      /EJECT
     CSR         UTSUBR    BEGSR
      *================================================================
      * Check for Copy character in Screen Field
      *================================================================
      * CASE: RCD.Account Identifier EQ WRK.JE Special Character
     C           #RACID    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0056           Account Identif
     C                     MOVELWUJESP    ZA0057           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     END                             *FI
      * CASE: RCD.Currency code EQ WRK.JE Special Character
     C           #1CYCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0058           Currency code
     C                     MOVELWUJESP    ZA0059           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     END                             *FI
      * CASE: RCD.Account code EQ WRK.JE Special Character
     C           #1ACCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0060           Account code
     C                     MOVELWUJESP    ZA0061           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9834  *
      *
     C                     END                             *FI
      * CASE: RCD.Account sequence number EQ WRK.JE Special Character
     C           #1ACSN    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1ACSN    ZA0062           Account sequenc
     C                     MOVELWUJESP    ZA0063           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     END                             *FI
      * CASE: RCD.Input Branch Code - Alpha EQ WRK.JE Special Character
     C           #1IBCA    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0064           Input Branch Co
     C                     MOVELWUJESP    ZA0065           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     END                             *FI
      * CASE: RCD.Formatted Posting amount EQ WRK.JE Special Character
     C           #RFMPA    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0066           Formatted Posti
     C                     MOVELWUJESP    ZA0067           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9837  *
      *
     C                     END                             *FI
      * CASE: RCD.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1DCIN    ZA0068           Debit/credit in
     C                     MOVELWUJESP    ZA0069           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9838  *
      *
     C                     END                             *FI
      * CASE: RCD.Narrative EQ WRK.JE Special Character
     C           #RNRTV    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RNRTV    ZA0070           Narrative
     C                     MOVELWUJESP    ZA0071           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     END                             *FI
      * CASE: RCD.Transaction type EQ WRK.JE Special Character
     C           #1TRTY    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1TRTY    ZA0072           Transaction typ
     C                     MOVELWUJESP    ZA0073           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9840  *
      *
     C                     END                             *FI
      * CASE: RCD.Cheque number EQ WRK.JE Special Character
     C           #1CQNB    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1CQNB    ZA0074           Cheque number
     C                     MOVELWUJESP    ZA0075           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9843  *
      *
     C                     END                             *FI
      * CASE: RCD.Associated Cust - Display EQ WRK.JE Special Character
     C           #RASCD    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RASCD    ZA0076           Associated Cust
     C                     MOVELWUJESP    ZA0077           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9846  *
      *
     C                     END                             *FI
      * CASE: RCD.Value date (display) EQ WRK.JE Special Character
     C           #RVDDS    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0078           Value date (dis
     C                     MOVELWUJESP    ZA0079           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9842  *
      *
     C                     END                             *FI
      * CASE: RCD.Swift common reference EQ WRK.JE Special Character
     C           #1SWCR    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1SWCR    ZA0080           Swift common re
     C                     MOVELWUJESP    ZA0081           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9844  *
      *
     C                     END                             *FI
      * CASE: RCD.Profit centre EQ WRK.JE Special Character
     C           #1PRCN    IFEQ WUJESP                     *IF
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0082           Profit centre
     C                     MOVELWUJESP    ZA0083           JE Special Char
      * Send message 'Copy function not valid'
     C                     MOVEL'GLX0090' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9845  *
      *
     C                     END                             *FI
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0181MRF2                                           S01408
     C*                                                                   S01408
      *================================================================
     CSR         UTEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C                     MOVEL#2BTNB    WK1X01  1        Batch number
     C           WK1X01    IFEQ '?'                        Batch number
     C                     CALL 'GL0140S'              90  *
     C                     PARM           W0RTN   7
     C           #2BTNB    PARM #2BTNB    WQ0064  3        Batch number
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     CABNE*BLANK    VA999
     C                     END
      *................................................................
      *
     C           KLVABR    KLIST
     C                     KFLD           BRBTNB           Batch number
      * Setup key
     C                     MOVEL#2BTNB    BRBTNB           Batch number
     C           KLVABR    CHAIN@BRREAH              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
     C           VA999     TAG
      * Restrictor relation not satisfied
      * Send message 'Journal Entry Header   NF'
     C                     MOVEL'GLX0172' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'GLX0172' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VAEXIT    ENDSR
     CSR         XXIN      BEGSR                                          E17819
      *====================================================
      * Determine Account type
      *----------------------------------------------------
      *
     C                     MOVE *IN90     UKSI90  1        Save indicator
      *
      * 1. Check for invalid input :
      *
     C           UKACID    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*ERROR*' UKTYPE  7          Error
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 2. Check for Retail A/C :
      *
     C                     TESTN          UKACID     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF ALL NUMERIC
     C                     MOVE '*RETAIL' UKTYPE             Retail A/C
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      **3.*Check for Customer number :                                                      MD031707
      **********                                                                            MD031707
     C**********           TESTN          UKACF6     90    All numeric?                     MD031707
      **********                                                                            MD031707
     C********** *IN90     IFEQ '1'                        IF ALL NUMERIC                   MD031707
     C********** UKACL4    IFEQ *BLANK                     IF 6 DIGITS ONLY                 MD031707
     C**********           MOVE '*NUMBER' UKTYPE             Cust.number                    MD031707
     C**********           ELSE                            EL INVALID                       MD031707
     C**********           MOVE '*ERROR*' UKTYPE  7          Error                          MD031707
     C**********           END                             FI                               MD031707
     C**********           GOTO UKSK01                       Return                         MD031707
     C**********           END                             FI                               MD031707
      *
      * 4. Check for Nostro :
      *
     C                     TESTN          UKACM2     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF NUMERIC
     C           UKACA1    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA1    ANDLT'0'                         AND ¬NUMERIC
     C           UKACA2    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA2    ANDLT'0'                         AND ¬NUMERIC
     C           UKACA3    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA3    ANDLT'0'                         AND ¬NUMERIC
     C           UKACL5    ANDEQ*BLANK                      AND NO MORE
     C                     MOVE '*NOSTRO' UKTYPE             Nostro
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 3. Check for Customer number :                                                      MD031707
      *                                                                                     MD031707
     C           UKACF6    IFNE *BLANK                     IF Pos 1 to 6                    MD031707
     C           UKACL4    ANDEQ*BLANK                     and 7 to 10                      MD031707
     C                     MOVE '*NUMBER' UKTYPE             Cust.number                    MD031707
     C                     GOTO UKSK01                       Return                         MD031707
     C                     END                             FI                               MD031707
      *                                                                                     MD031707
      * 5. Check for Customer Shortname :
      *
     C           UKACF1    IFLT '0'                        IF ¬NUMERIC
     C           UKACF1    ANDNE*BLANK                      AND ¬BLANK
     C                     MOVE '*SHNAME' UKTYPE             Shortname
     C                     ELSE                            EL NUMERIC
     C                     MOVE '*ERROR*' UKTYPE             Invalid
     C                     END                             FI
      *          _____________
     C           UKSK01    TAG
      *          ~~~~~~~~~~~~~
     C                     MOVE UKSI90    *IN90            Restore ind.
      *
      *----------------------------------------------------
      *
      *====================================================
     C*SR****     UKEXIT    ENDSR                                         E17819
     CSR         XXOUT     ENDSR                                          E17819
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGM     IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGM
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGM
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
      * USER: Exit program processing
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MEPP - Journal Entry Posting  *
     C*00/Copy Member GL0181M   Exit Program Processing
     C/COPY WNCPYSRC,GL0181MEPP
     C                     END                             *FI
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
     C/COPY WNCPYSRC,GL0181MC23
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
     C/COPY WNCPYSRC,GL0181MC24
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0181MCP1                                           S01408
     C*                                                                   S01408
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
     C                     MOVEL*BLANK    WKWARN  1                       CAC001
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field S01212
     C                     MOVEL*BLANK    WUFKST  1
      * Define work field Item error message
     C                     MOVEL*BLANK    WUIEMG 76
      * Define work field Number of Decimal Places
     C                     Z-ADD*ZERO     WUNBDP  10
      * Define work field Access Pgm Return Code
     C                     MOVEL*BLANK    WUAPRC  7
      * Define work field Currency code
     C                     MOVEL*BLANK    WUCYCD  3
      * Define work field Currency Name
     C                     MOVEL*BLANK    WUCYNM 14
      * Define work field Nostro Shortname
     C                     MOVEL*BLANK    WUNOSN 10
      * Define work field Customer number
     C                     MOVEL*BLANK    WUCUST  6
      * Define work field Account code
     C**********           MOVEL*BLANK    WUACCD  4                                           CGL029
     C                     MOVEL*BLANK    WUACCD 10                                           CGL029
      * Define work field Account sequence number
     C                     MOVEL*BLANK    WUACSN  2
      * Define work field Branch code
     C                     MOVEL*BLANK    WUBRCD  3
      * Define work field Account type
     C                     MOVEL*BLANK    WUACTY  1
      * Define work field Account subtype
     C                     MOVEL*BLANK    WUBPST  1
      * Define work field Account status
     C                     MOVEL*BLANK    WUACCS  1
      * Define work field Date account opened
     C                     Z-ADD*ZERO     WUDACO  50
      * Define work field Account name
     C                     MOVEL*BLANK    WUACNM 20
      * Define work field Retail account number
     C                     Z-ADD*ZERO     WURACN 100
      * Define work field Retail Indicators   MIDAS
     C                     MOVEL*BLANK    WURETB  1
      * Define work field Relative rec no of memos
     C                     Z-ADD*ZERO     WURRNM  50
      * Define work field Date Format flag
     C                     MOVEL*BLANK    WUDTFF  1
      * Define work field Date (numeric format)
     C                     Z-ADD*ZERO     WUDTNF  60
      * Define work field Midas Run Date
     C                     MOVEL*BLANK    WUDDCD  7
      * Define work field Branch Code (Batch Headr)
     C                     MOVEL*BLANK    WUBCBH  3
      * Define work field Abbreviated Posting?
     C                     MOVEL*BLANK    WUABPS  1
      * Define work field Account Identifier
     C                     MOVEL*BLANK    WUACID 10
      * Obtain default message file
     C           *NAMVAR   DEFN MIMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Template Facility Used
     C                     MOVEL*BLANK    WUTFUS  1
      * Define work field Copy:Account identifier
     C                     MOVEL*BLANK    WUCACI 10
      * Define work field Copy:Currency code
     C                     MOVEL*BLANK    WUCCCD  3
      * Define work field Copy:Account code
     C                     MOVEL*BLANK    WUCPAC  4
      * Define work field Copy:Account Sequence
     C                     MOVEL*BLANK    WUCACS  2
      * Define work field Copy:Branch Code - Alpha
     C                     MOVEL*BLANK    WUCBCA  3
      * Define work field Copy:Amount
     C                     MOVEL*BLANK    WUCAMT 14
      * Define work field Copy:DR/CR Indicator
     C                     MOVEL*BLANK    WUCDCI  1
      * Define work field Copy:Narrative
     C                     MOVEL*BLANK    WUCNAR 30
      * Define work field Copy:Transaction Type
     C                     MOVEL*BLANK    WUCTRT  5
      * Define work field Copy:Cheque Number
     C                     MOVEL*BLANK    WUCCNB  8
      * Define work field Copy:Assoc Cust - Display
     C                     MOVEL*BLANK    WUASSC 10
      * Define work field Copy:Value Date
     C                     MOVEL*BLANK    WUCVDT  6
      * Define work field Copy:Swift Common Ref
     C                     MOVEL*BLANK    WUCSCR 16
      * Define work field Copy:Profit Centre
     C                     MOVEL*BLANK    WUCPRC  4
      * Define work field Tmpl:Account identifier                         087770
     C                     MOVEL*BLANK    WZCACI 10                       087770
      * Define work field Tmpl:Currency code                              087770
     C                     MOVEL*BLANK    WZCCCD  3                       087770
      * Define work field Tmpl:Account code                               087770
     C                     MOVEL*BLANK    WZCPAC  4                       087770
      * Define work field Tmpl:Account Sequence                           087770
     C                     MOVEL*BLANK    WZCACS  2                       087770
      * Define work field Tmpl:Branch Code - Alpha                        087770
     C                     MOVEL*BLANK    WZCBCA  3                       087770
      * Define work field Tmpl:Amount                                     087770
     C                     MOVEL*BLANK    WZCAMT 14                       087770
      * Define work field Tmpl:DR/CR Indicator                            087770
     C                     MOVEL*BLANK    WZCDCI  1                       087770
      * Define work field Tmpl:Narrative                                  087770
     C                     MOVEL*BLANK    WZCNAR 30                       087770
      * Define work field Tmpl:Transaction Type                           087770
     C                     MOVEL*BLANK    WZCTRT  5                       087770
      * Define work field Tmpl:Cheque Number                              087770
     C                     MOVEL*BLANK    WZCCNB  8                       087770
      * Define work field Tmpl:Assoc Cust - Display                       087770
     C                     MOVEL*BLANK    WZASSC 10                       087770
      * Define work field Tmpl:Value Date                                 087770
     C                     MOVEL*BLANK    WZCVDT  6                       087770
      * Define work field Tmpl:Swift Common Ref                           087770
     C                     MOVEL*BLANK    WZCSCR 16                       087770
      * Define work field Tmpl:Profit Centre                              087770
     C                     MOVEL*BLANK    WZCPRC  4                       087770
     C/COPY WNCPYSRC,GL0181MC25
      * Define work field Runday Number
     C                     Z-ADD*ZERO     WURDNO  50
      * Define work field Local Currency code
     C                     MOVEL*BLANK    WULCCY  3
      * Define work field Copy:Retail Number Enter
     C                     MOVEL*BLANK    WUCRNE  1
      * Define work field Copy:Retail Account Num
     C                     Z-ADD*ZERO     WUCRAN 100
      * Define work field Copy:Customer Number
     C                     MOVEL*BLANK    WUCCUS  6
      * Define work field Copy:Narrative Code
     C                     MOVEL*BLANK    WUCNRC  2
      * Define work field Copy:Narrative Descriptn
     C                     MOVEL*BLANK    WUCNDS 30
      * Define work field Copy:Posting amount
     C                     Z-ADD*ZERO     WUCPAM 130
      * Define work field Copy:Value Date Nbr
     C                     Z-ADD*ZERO     WUCVDN  50
      * Define work field Value date (display)
     C                     MOVEL*BLANK    WUVDDS  6
      * Define work field Account ID Status Flag
     C                     MOVEL*BLANK    WUAISF  7
      * Define work field Ret / Nostro Inval Ac
     C                     MOVEL*BLANK    WURNIA  1
      * Define work field Input Branch Code - Alpha
     C                     MOVEL*BLANK    WUIBCA  3
      * Define work field Nostro number (Item)
     C                     MOVEL*BLANK    WUNNBI  2
      * Define work field Our Account No. at Nostro
     C*************        MOVEL*BLANK    WUOANN 14                                           210796
     C                     MOVEL*BLANK    WUOANN 35                                           210796
      * Define work field Our Receive Account
     C                     MOVEL*BLANK    WUORAC 25
      * Define work field Prime Nostro Indicator
     C                     MOVEL*BLANK    WUPNOI  1
      * Define work field Cust No or Short Inval
     C                     MOVEL*BLANK    WUCNSI  1
      * Define work field Valid Customer Number
     C                     MOVEL*BLANK    WUVCNB  1
      * Define work field Nostro Number
     C                     MOVEL*BLANK    WUNONB  2
      * Define work field Company Code
     C                     MOVEL*BLANK    WUCMCD  3
      * Define work field Location Code
     C                     MOVEL*BLANK    WULCCD  3
      * Define work field Due From Account Code
     C**********           MOVEL*BLANK    WUDFAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDFAC 10                                           CGL029
      * Define work field Due To Account Code
     C**********           MOVEL*BLANK    WUDTAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDTAC 10                                           CGL029
      * Define work field Branch Internal Customer
     C                     MOVEL*BLANK    WUBICN  6
      * Define work field Branch Name
     C                     MOVEL*BLANK    WUBRNM 30
      * Define work field Global Branch Code
     C                     MOVEL*BLANK    WUGBCD  3
      * Define work field Branch Shortname
     C                     MOVEL*BLANK    WUBRSN  3
      * Define work field SPF Error Condition
     C                     Z-ADD*ZERO     WUSPEC  10
      * Define work field ZALIGN No Of Decimals
     C                     Z-ADD*ZERO     WUZNDE  10
      * Define work field ZALIGN No Of Digits
     C                     Z-ADD*ZERO     WUZNDI  20
      * Define work field ZALIGN Screen Fun Field
     C                     MOVEL*BLANK    WUZASF 16
      * Define work field ZALIGN File Field
     C                     MOVEL*BLANK    WUZAFF 16
      * Define work field Error Code
     C                     MOVEL*BLANK    WUERCD  1
      * Define work field JE Special Character
     C                     MOVEL*BLANK    WUJESP  1
      * Define work field Narrative status
     C                     MOVEL*BLANK    WUNRST  7
      * Define work field Description of Narrative
     C                     MOVEL*BLANK    WUDON  30
      * Define work field Transaction type
     C                     MOVEL*BLANK    WUTRTY  5
      * Define work field Retail Transaction Name
     C                     MOVEL*BLANK    WURTNM 30
      * Define work field Customer originated ind.
     C                     MOVEL*BLANK    WUCOIN  1
      * Define work field Debit/credit indicator
     C                     MOVEL*BLANK    WUDCIN  1
      * Define work field Reversal Indicator
     C                     MOVEL*BLANK    WURVIN  1
      * Define work field Print Advices Indicator
     C                     MOVEL*BLANK    WUPADI  1
      * Define work field Work Value Date (display)
     C                     MOVEL*BLANK    WUWVDD  6
      * Define work field Number of Forward Days
     C                     Z-ADD*ZERO     WUNBFD  20
      * Define work field Forward Day Number
     C                     Z-ADD*ZERO     WUFDNB  50
      * Define work field Error Ind - Day - Holiday
     C                     MOVEL*BLANK    WUJJST  1
      * Define work field ZSEDIT Char Output(21)
     C                     MOVEL*BLANK    WUZSCO 21
      * Define work field Client key identity
     C                     MOVEL*BLANK    WUCRST  7
      * Define work field Assoc. Customer number
     C                     MOVEL*BLANK    WUACNB  6
      * Define work field Customer Shortname
     C                     MOVEL*BLANK    WUCSSN 10
      * Define work field DRS Customer Shortname
     C                     MOVEL*BLANK    WUDRCS  7
      * Define work field Customer Swift Id
     C                     MOVEL*BLANK    WUCSID 12
      * Define work field Profit Centres Used
     C                     MOVEL*BLANK    WUPRCU  1
      * Define work field Profit Centre Code
     C                     MOVEL*BLANK    WUPCCD  4
      * Define work field Profit Centre Description
     C                     MOVEL*BLANK    WUPCDS 30
      * Define work field Profit Centre Def'ts Used
     C                     MOVEL*BLANK    WUPCDU  1
      * Define work field Book Code
     C                     MOVEL*BLANK    WUBKCD  2
      * Define work field Sub Type
     C                     MOVEL*BLANK    WUSBTY  2
      * Define work field Account Officer Code
     C                     MOVEL*BLANK    WUACOC  2
      * Define work field Profit centre
     C                     MOVEL*BLANK    WUPRCN  4
      * Define work field Book Description
     C                     MOVEL*BLANK    WUBKD  30
      * Define work field Hedge Indicator
     C                     MOVEL*BLANK    WUHGIN  1
      * Define work field Automatic Closure ind
     C                     MOVEL*BLANK    WUACIN  1
      * Define work field Book Consolidation Code
     C                     MOVEL*BLANK    WUBKCC  1
      * Define work field ST Amortise Discounts
     C                     MOVEL*BLANK    WUSTAM  1
      * Define work field ST Revalue Mark to Market
     C                     MOVEL*BLANK    WUSTRM  1
      * Define work field ST Exposure Percentage
     C                     Z-ADD*ZERO     WUSTEP  30
      * Define work field Include In Account Key
     C                     MOVEL*BLANK    WUIACK  1
      * Define work field Copy / Template Facility
     C                     MOVEL*BLANK    WUCTFY  1
      * Define work field Account Code Name
     C                     MOVEL*BLANK    WUACCN 25
      * Define work field Account Section
     C                     MOVEL*BLANK    WUACSC  2
      * Define work field Account Sub-type
     C                     MOVEL*BLANK    WUACST  1
      * Define work field Copy Facility Used
     C                     MOVEL*BLANK    WUCFUS  1
      * Define work field Last item number
     C                     Z-ADD*ZERO     WULINB  30
      * Define work field Multibranching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Define work field Midas Rundate
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Setup Complete
     C                     MOVEL*BLANK    WUSUCP  1
      * Define work field User
     C                     MOVEL*BLANK    WUUSID 10
      * Define work field User Default Branch Code
     C                     MOVEL*BLANK    WUUDBC  3
      * Define work field User Default Department
     C                     MOVEL*BLANK    WUUDDP  3
      * Define work field User Bank Level Authority
     C                     MOVEL*BLANK    WUUBLA  1
      * Define work field General Ledger
     C                     MOVEL*BLANK    WUGNLG 10
      * Define work field Profit & Loss Accnt Code
     C**********           MOVEL*BLANK    WUPLAC  4                                           CGL029
     C                     MOVEL*BLANK    WUPLAC 10                                           CGL029
      * Define work field Base Currency Transfer Fq
     C                     MOVEL*BLANK    WUBCTF  1
      * Define work field Accrual Key Summary Ind.
     C                     MOVEL*BLANK    WUAKSI  1
      * Define work field Accruals/Profit Date
     C                     Z-ADD*ZERO     WUAPDT  50
      * Define work field Accruals/Profit Frequency
     C                     MOVEL*BLANK    WUAPFQ  1
      * Define work field Accruals/Profit Fq. Day
     C                     Z-ADD*ZERO     WUAPFD  20
      * Define work field Accrue on Last Day Ind.
     C                     MOVEL*BLANK    WUALDI  1
      * Define work field A/c Posting Retention Pd
     C                     Z-ADD*ZERO     WUAPRP  20
      * Define work field Accrual Non-Wk Day Ind
     C                     MOVEL*BLANK    WUANWD  1
      * Define work field Spot Rates Retention Pd
     C                     Z-ADD*ZERO     WUSRRP  20
      * Define work field Base Rates Retention Pd
     C                     Z-ADD*ZERO     WUBRRP  20
      * Define work field GL Description Ind.
     C                     MOVEL*BLANK    WUGLDI  1
      * Define work field Profit Centres Amendable
     C                     MOVEL*BLANK    WUPRCA  1
      * Define work field Prof C Def Matrix-Book
     C                     MOVEL*BLANK    WUPMBK  1
      * Define work field Prof C Def Matrix-T Type
     C                     MOVEL*BLANK    WUPMTT  1
      * Define work field Prof C Def Matrix-S Type
     C                     MOVEL*BLANK    WUPMST  1
      * Define work field Prof C Def Matrix-Branch
     C                     MOVEL*BLANK    WUPMBH  1
      * Define work field Prof C Def Matrix-Dept
     C                     MOVEL*BLANK    WUPMDT  1
      * Define work field Prof C Def Matrix-User
     C                     MOVEL*BLANK    WUPMUR  1
      * Define work field Prof C Def Matrix-A/c Off
     C                     MOVEL*BLANK    WUPMAO  1
      * Define work field Prof C Def Matrix-Cust
     C                     MOVEL*BLANK    WUPMCU  1
      * Define work field Originating Branch Used
     C                     MOVEL*BLANK    WUOBRU  1
      * Define work field Orig Branch User/Vald Req
     C                     MOVEL*BLANK    WUOBUV  1
      * Define work field JE Int-Bch Ents @ Bch/Itm
     C                     MOVEL*BLANK    WUIEBI  1
      * Define work field Main Branch
     C                     MOVEL*BLANK    WUMABR  3
      * Define work field Int-Bch Ent Via Main Brch
     C                     MOVEL*BLANK    WUIEMB  1
      * Define work field End of Last Activity Per.
     C                     Z-ADD*ZERO     WUELAP  50
      * Define work field End of Current Act Period
     C                     Z-ADD*ZERO     WUECAP  50
      * Define work field Analytical Accounting                           CAC001
     C                     MOVEL*BLANK    WUN0ST  1                       CAC001
      * Define work field Profit Centre                                   CAC001
     C                     MOVEL*BLANK    WUPRFC  4                       CAC001
      *
     C                     Z-ADD03        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      *................................................................
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
     C                     MOVEL'Y'       W0APM   1
      * USER: Initialise program
      * Standard RPG Creation Par - Standard functions  *
      * Last Amend Box - GL0181M - Journal Entry Posting  *
      * Copyright notice - Standard functions  *
      * Start of S01314
      * Multi-Language - GL0181M - Journal Entry Posting  *
      *
      * Call SDRTVTXT pgm to access appropriate text
      *  for a field used in a SFL
      *
      * Type
     C                     MOVEL'ZZGBMSGF'MSGNM
     C                     MOVEL'ZZM3781' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C                     MOVELMSGTXT    ZZM002
     C* Sub Type
     C                     MOVEL'ZZM6338' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C                     MOVELMSGTXT    ZZM003
      * Value Date
     C                     MOVEL'ZZM1938' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C                     MOVELMSGTXT    ZZM004
      * Cheque
     C                     MOVEL'ZZM1718' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C                     MOVELMSGTXT    ZZM005
      * SWIFT
     C                     MOVEL'ZZM6340' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C                     MOVELMSGTXT    ZZM006
      * Profit Centre
     C                     MOVEL'ZZM3784' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C                     MOVELMSGTXT    ZZM007
      * Associated Customer
     C                     MOVEL'ZZM3782' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C                     MOVELMSGTXT    ZZM008
      * Book Code
     C                     MOVEL'ZZM6341' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C                     MOVELMSGTXT    ZZM009
     C/COPY WNCPYSRC,GL0181MC26
      *
      * End of S01314
     C                     Z-ADD*ZERO     WULINB           Last item numbe
      * Access Midas rundate - Standard functions  *
     C*   Access MIDAS Rundate from data-area RUNDAT
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT
     C                     MOVE RDNO      WURDNO
     C                     MOVE SUCP      WUSUCP
     C                     MOVE DTFF      WUDTFF
     C                     MOVE MBIN      WUMBIN
      * Define 200 Byte Dummy DS - Standard functions  *
      * Define 800 Byte Dummy DS - Standard functions  *
      * Declare Bank File DS - Standard functions  *
      * Account Codes DS - Account Codes  *
      * Account Details DS - Standard functions  *
      * Branch Codes DS - Branch Codes  *
      * Client Details DS - Client Details  *
      * Currency Codes DS - Currency Codes  *
      * General Ledger Details DS - General Ledger Details  *
      * Narrative Codes DS - Narrative Codes  *
      * Nostro Details DS - Nostro Details  *
      * Profit Centre DS - Profit Centres  *
      * Prof C Def Matrix DS - Profit Centre Dft Matrix  *
      * Retail Transactions DS - Retail Transaction Types  *
      * Book Codes DS - Book Codes  *
      * Access ZMUSER - Standard functions  *
     C*
     C* Access data-area ZMUSER
     C*
     C           *NAMVAR   DEFN           ZMUSER
     C                     IN   ZMUSER
     C                     MOVE USID      WUUSID           User Profile
     C                     MOVE UDBC      WUUDBC           User Def Branch
     C                     MOVE UDDP      WUUDDP           User Def Dept
     C                     MOVE UBLA      WUUBLA           User Bank Lvl A
      *                                                                                       CGL013
      ** Access SAR details file to see if CGL013 is installed.                               CGL013
      *                                                                                       CGL013
     C           *NAMVAR   DEFN           LDA                                                 CGL013
     C                     CALL 'AOSARDR0'                                                    CGL013
     C                     PARM *BLANKS   PRTCD   7                                           CGL013
     C                     PARM '*VERIFY' POPTN   7                                           CGL013
     C                     PARM 'CGL013'  PSARD   6                                           CGL013
     C           SCSARD    PARM SCSARD    UUFDY                                               CGL013
      *                                                                                       CGL013
     C           PRTCD     IFNE *BLANKS                                                       CGL013
     C           PRTCD     ANDNE'*NRF    '                                                    CGL013
     C           *LOCK     IN   LDA                                                           CGL013
     C                     MOVE 'SCSARDPD'DBFILE                                              CGL013
     C                     MOVEL'001'     DBASE                                               CGL013
     C                     MOVEL'CGL013'  DBKEY                                               CGL013
     C                     OUT  LDA                                                           CGL013
     C                     EXSR *PSSR                                                         CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C           PRTCD     IFEQ *BLANK                                                        CGL013
     C                     MOVE 'Y'       CGL013  1                                           CGL013
     C                     MOVE *ON       *IN48                                               CGL013
     C                     MOVE *OFF      *IN49                                               CGL013
     C                     ELSE                                                               CGL013
     C                     MOVE 'N'       CGL013                                              CGL013
     C                     MOVE *OFF      *IN48                                               CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
      ** If CGL013 is installed, show 'Additional Information'                                CGL013
      *                                                                                       CGL013
     C           CGL013    IFEQ 'Y'                                                           CGL013
     C                     MOVEL'ZZN9641' MSGDNB                                              CGL013
     C                     CALL 'SDRTVTXT'                                                    CGL013
     C                     PARM           MSGDNB                                              CGL013
     C                     PARM           MSGNM                                               CGL013
     C                     PARM           MSGTXT                                              CGL013
     C                     MOVELMSGTXT    ZZM010                                              CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
      * Access General Ledger. - General Ledger Details  *
     C*
     C*  Access General Ledger Details file for it' file fields
     C*
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*FIRST'  UUAPOP  7        I:Option
     C********** D@GELR    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@GELR    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELBKGNLG    WUGNLG           General Ledger
     C                     MOVELBKACCD    WUACCD           Account Code
     C                     MOVELBKPLAC    WUPLAC           Profit & Loss Account
     C                     MOVELBKCUST    WUCUST           Cutomer Number
     C                     MOVELBKBCTF    WUBCTF           Base Currency Tran
     C                     MOVELBKAKSI    WUAKSI           Accrual Key summary
     C                     MOVELBKAPDT    WUAPDT           Accruals Profit Date
     C                     MOVELBKAPFQ    WUAPFQ           Accruals Profit Freq
     C                     MOVELBKAPFD    WUAPFD           Accruals Profit Fr Dy
     C                     MOVELBKALDI    WUALDI           Accrue on Last Day
     C                     MOVELBKAPRP    WUAPRP           A/c Posting Ret Pd.
     C                     MOVELBKANWD    WUANWD           Accrual non-wk Day
     C                     MOVELBKSRRP    WUSRRP           Spot Rates Retention
     C                     MOVELBKBRRP    WUBRRP           Base Rates Retention
     C                     MOVELBKGLDI    WUGLDI           GL Description Ind
     C                     MOVELBKPRCU    WUPRCU           Profit Centres Used
     C                     MOVELBKPRCA    WUPRCA           Profit Centres Amend
     C                     MOVELBKPCDU    WUPCDU           Profit Centre Default
     C                     MOVELBKPMBK    WUPMBK           Prof C Matrix Book
     C                     MOVELBKPMTT    WUPMTT           Prof C Matrix Trans
     C                     MOVELBKPMST    WUPMST           Prof C Matrix SubType
     C                     MOVELBKPMBH    WUPMBH           Prof C Matrix Branch
     C                     MOVELBKPMDT    WUPMDT           Prof C Matrix Dept
     C                     MOVELBKPMUR    WUPMUR           Prof C Matrix User
     C                     MOVELBKPMAO    WUPMAO           Prof C Matrix Acc Off
     C                     MOVELBKPMCU    WUPMCU           Prof C Matrix Cust
     C                     MOVELBKOBRU    WUOBRU           Originating Branch Ud
     C                     MOVELBKOBUV    WUOBUV           Orig Branch/User Vald
     C                     MOVELBKJESP    WUJESP           Copy Special Char
     C                     MOVELBKELAP    WUELAP           End of Last Activity
     C                     MOVELBKECAP    WUECAP           End of Curnt Activity
     C                     MOVEL'Y'       WUFKST           S01212
      * Access Module Setup - Standard functions  *                       CAC001
     C*                                                                   CAC001
     C*   Access Midas Module Setup Details                               CAC001
     C*                                                                   CAC001
     C                     CALL 'AOMMODR0'                                CAC001
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return code  CAC001
     C                     PARM '*FIRST  'UUAPOP  7        I:Option       CAC001
     C           D@MMOD    PARM D@MMOD    UUFDY            O:Format       CAC001
     C*                                                                   CAC001
     C* Assign work field to file field values.                           CAC001
     C*                                                                   CAC001
     C                     MOVELBGN0ST    WUN0ST           Analytical Acc CAC001
      * RTV Last Batch Item - Standard functions  *
     C                     CALL 'GL0137U'              90  RTV Last Batch
     C                     PARM P1BTNB    WQ0065  3        Batch number
     C           WULINB    PARM *ZERO     WQ0066  30       Last item numbe
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0181MFPG - Journal Entry Posting  *
      * 00/Copy Member GL0181MEPG - Journal Entry Posting  *
      * 00/Copy Member GL0181MIPG - Journal Entry Posting  *
      * 00/Copy Member GL0181MCPG - Journal Entry Posting  *
     C*00/Copy Member GL0181M   Initialise Program C-Spec
     C/COPY WNCPYSRC,GL0181MCPG
      * 00/Copy Member GL0181MOPG - Journal Entry Posting  *
     C                     END                             *FI
      * Initialise subfile control
     C                     EXSR MEIZ#2
      *================================================================
     C/COPY WNCPYSRC,GL0181MC05
     CSR         ZZEXIT    ENDSR
      *                                                                                       CGL013
      *****************************************************************                       CGL013
      *                                                               *                       CGL013
      * *PSSR  - Program exception error routine                      *                       CGL013
      *          Called automatically if a program error occurs,      *                       CGL013
      *          or directly by the program code using EXSR.          *                       CGL013
      *          This subroutine DUMPs the program just once.         *                       CGL013
      *                                                               *                       CGL013
      * Called by: ZZINIT                                             *                       CGL013
      *                                                               *                       CGL013
      * Calls: None                                                   *                       CGL013
      *                                                               *                       CGL013
      *****************************************************************                       CGL013
      *                                                                                       CGL013
     C           *PSSR     BEGSR                                                              CGL013
      *                                                                                       CGL013
     C           @RUN      IFEQ *BLANK                                                        CGL013
     C                     MOVE 'Y'       @RUN    1                                           CGL013
     C                     DUMP                                                               CGL013
     C                     CALL 'DBERRCTL'                                                    CGL013
     C                     ENDIF                                                              CGL013
      *                                                                                       CGL013
     C                     MOVE *ON       *INU7                                               CGL013
     C                     MOVE *ON       *INU8                                               CGL013
     C                     MOVE *ON       *INLR                                               CGL013
     C                     RETRN                                                              CGL013
      *                                                                                       CGL013
     C                     ENDSR                                                              CGL013
      *                                                                                       CGL013
      *****************************************************************                       CGL013
      /EJECT                                                                                  CGL013
      *****************************************************************                       CGL013
     O*00/Copy Member GL0181M   Initialise Program O-Spec
     O/COPY WNCPYSRC,GL0181MOPG
** STAMP - Dummy timestamp                                                                    CPK015
0001-01-01-00.00.00.000000                                                                    CPK015
** CPY@
(c) Finastra International Limited 2001
