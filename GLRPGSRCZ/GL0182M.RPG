     H            Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Spread journal postings maintenance')         *
     H/TITLE Midas GL Edit Spread Jrnl Postings
     Z* CRTRPGPGM
     Z* IGNDECERR(*YES)
      *
     H* SYNOPSIS :
     H* - Maintain database file using subfile display
     H* - Existing records may be updated
     H* - Key changes are not allowed
     H* - New records cannot be added
      *
     H* Generated by  : SYNON/2  Version:  9054
     H* Function type : Edit file
      *
     H*  Company :
     H* System        : General Ledger Synon Model
     H* User name     : COLMANP
     H* Date          : 22/06/92  Time  : 11:32:23
      *  (c) Finastra International Limited 2001                      *
      *
      *================================================================
     M* Maintenance   :
      *================================================================
     F*****************************************************************
     F*                                                               *
      *  Last Amend No. CGL148             Date 13Jul18               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 MD038989           Date 11Jul16               *
      *                 CGL154             Date 13Oct14               *
      *                 MD027557           Date 25Jun14               *
      *                 MD027587           Date 19Jun14               *
      *                 AR1093096          Date 30Sep13               *
      *                 AR802562           Date 07Sep11               *
      *                 AR787620           Date 10Jun11               *
      *                 CAP207             Date 10Feb11               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA035             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 191175             Date 17Apr02               *
      *                 189519             Date 27Mar02               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CAP032             Date 26Apr99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01Mar99               *
      *                 CGL008             Date 03Mar99               *
      *                 CTI002             Date 23Sep98               *
     F*                 CGL002          Date 28OCT96                  *
     F*                 110309          Date 28OCT96                  *
     F*                 089856          Date 25OCT95                  *
     F*                 S01408          DATE 26JUN95                  *
     F*                 S01408          DATE 21APR95                  *
     F*                 S01408          DATE 06MAR95                  *
     F*                 S01408          DATE 22AUG94                  *
     F*                 067764          DATE 17JUL94                  *
     F*                 S01413          DATE 28JUL93                  *
     F*                 E38270          DATE 18JUN92                  *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  CGL148 - Automatic Opening of GL accounts                    *
      *         - Includes fix MD028234                               *
      *  MD046248 - Finastra Rebranding                               *
      *  MD038989 - Journal Entry is allowed for Blocked Nostro a/c.  *
      *             Ensure that RETB will be validated for nostro a/cs*
      *  CGL154 - FATCA Reporting (Recompile)                         *
      *  MD027557 - The credit amount input becomes blank once press  *
      *             enter(Recompile)                                  *
      *  MD027587 - Unable to used the C for Copy and T for Template  *
      *             (Recompile)                                       *
      *  AR1093096 - ABC - Reservations not removed for JRNE          *
      *              (Child: AR1093097) (Recompile)                   *
      *  AR802562 - Prevented entries that use Retail Accounts to be  *
      *             entered.(Child: AR802563)                         *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,GLH00252                                 *
      *             WNCPYSRC,GLH00253                                 *
      *  CAP207 - Account Balance Check extended to other APIs        *
      *           (Recompile)                                         *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  191175 - CGL008 modification. User cannot authorise the      *
      *           batch if any amendment was made and the user        *
      *           authority level is 'Z'.                             *
      *  189519 - Can't insert multibranch batch without authority to *
      *           action code 'A'. Introduced P2SACD to receive the   *
      *           appropriate code passed by GL0163R.                 *
      *  CAP032 - Conversion of Journal Batch Entry inputs into       *
      *           modular structure to use as APIs. Recompiled        *
      *           due to change in length of #1DBRC field in the      *
      *           display file.                                       *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CGL008 - Security on Journal Entry                           *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  CGL002 - Block GL Accounts in Journal Entry Input            *
     F*  110309 - Batch cannot be accepted even if all fields are     *
     F*           correct.  Reset exit option when reloading subfile  *
     F*           and ensure reload of subfile to reset error status. *
     F*   089856 - Change to allow posting amount as 13N as specified *
     F*            in Ins Manual.                                     *
     F*   S01408 - Core hook GL0182MCP5 added                         *
     F*            Core hook GL0182MCP6 added                         *
     F*            Core hook GL0182MCP7 added                         *
     F*            Core hook GL0182MCP8 added                         *
     F*   S01408 - Core hook GL0182MEP1 added                         *
     F*   S01408 - Core hook GL0182MBD1 added                         *
     F*   S01408 - Core hook GL0182MCP1 added                         *
     F*            Core hook GL0182MCP2 added                         *
     F*            Core hook GL0182MCP3 added                         *
     F*            Core hook GL0182MCP4 added                         *
     F*  067764 - Spread factor is not showing on screen              *
     F*  S01413 - Recompile for Retail 3 incorporation. Program is not*
     F*           regenerated from Synon model.                       *
     F*  E38270 - DO NOT DISPLAY BRANCH IF MBIN IS 'N'                *
     F*                                                               *
     F*****************************************************************
     F*00/Copy Member GL0182M   Initialise Program F-Spec
      *                                                                   CGL008
     FMUSER   IF  E           K        DISK                           UC  CGL008
      ** RTV : Midas SF Midas Users                                       CGL008
      *                                                                   CGL008
     FSFACAUL0IF  E           K        DISK                           UC  CGL008
      ** RTV : Account Code/Authorities File By Account Code              CGL008
      *                                                                   CGL008
     F/COPY WNCPYSRC,GL0182MFPG
     FGL0182M#CF  E                    WORKSTN
     F                                        ##RR  KSFILE #SFLRCD
     F                                              KINFDS INFDS#
      * DSP: Midas GL Edit Spread Jrnl Postings
      *
     FGLJENPL1IF  E           K        DISK
     F                                              KINFDS INFDS1
      * RTV : Midas GL Journal Entry Posting Rtv
      *
     FGLJENHL1IF  E           K        DISK
      * RTV : Midas GL Journal Entry Header LF Rtv
      *
     FGLJENPL0UF  E           K        DISK
     F                                              KCOMIT
      * UPD : Midas GL Journal Entry Posting Update
      *
     E*                                                                   S01408
     E/COPY WNCPYSRC,GL0182MEP1                                           S01408
     E*                                                                   S01408
     E                    CPY@    1   1 80               Copyright     array
     E* Define Footer For Display File
      *
     E/COPY WNCPYSRC,GLH00252
     E                    LNE     1   2 78
     E/COPY WNCPYSRC,GLH00253
      *                                                                   CGL002
     E                    @IE     1   1 76                                CGL002
      * Item Error Messages                                               CGL002
     E                    @IH         8  9                                CGL002
      * Item Error Slots                                                  CGL002
      *
     E*00/Copy Member GL0182M   Initialise Program E-Spec
     E/COPY WNCPYSRC,GL0182MEPG
     I*
     I* DATA STRUCTURES TO ENABLE A BATCH NUMBER TO BE INCREMENTED        S01234
     I* EVEN THOUGH IT IS AN ALPHA FIELD                                  S01234
     I*                                                                   S01234
     I*****P@BJRF    E DSSDBANKPD                                         S01117
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE                       S01117
     I*                                                                   S01117
     I*
     I*****P@ACCT    E DSACCNTAB
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     I*   Define MIDAS Rundate from data-area RUNDAT
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I*
     I* Define Data area MUSER                                         ***
     I*                                                                ***
     I*00/Copy Member GL0182M   Initialise Program I-Spec
     I/COPY WNCPYSRC,GL0182MIPG
      /EJECT
      * Data structures:
     IPGMDS     ESDSY2PGDSP
      * Program data structure
     IJBDTTM      DS
      * Job date/time
     I                                        1   60##JDT
     I                                        1   20##JYY
     I                                        3   40##JMM
     I                                        5   60##JDD
     I                                        7  120##JTM
     I                                        7   80##JHH
     I                                        9  100##JNN
     I                                       11  120##JSS
     IINFDS#    E DSY2I#DSP
      * Display file information data structure
      *
     IINFDS1    E DSY2I1DSP
      * File information data structure
      *
     I@1DBRC    E DSGLJENPL0
      * Current/previous master file format fields for change control
      *
     I            DS
     I                                        1   60UUDNMA
     IBATCHG      DS                                                      S01234
     I                                        1   3 #1BTNB                S01234
     I                                        1   30BATNUM                S01234
      *                                                                   S01234
     I            DS                                                      S01234
     I                                        1   3 W@KEY1                S01234
     I                                        1   30BNUM2                 S01234
      *                                                                   S01234
     I            DS
      * Determine Account identity
     I                                        1  10 UKACID
     I                                        1   6 UKACF6
     I                                        1   3 UKACF3
     I                                        1   1 UKACF1
     I                                        1   1 UKACA1
     I                                        2   2 UKACA2
     I                                        3   3 UKACA3
     I                                        4   5 UKACM2
     I                                        6  10 UKACL5
     I                                        7  10 UKACL4
      * Set up parameters :
     I            DS
     I                                        1   60UUDNUM
     IGLREOV      DS                                                      CGL002
      **  Retail Override data area data structure                        CGL002
     I                                        1   1 URRE01                CGL002
     I                                        2   2 URRE02                CGL002
     I                                        3   3 URRE03                CGL002
     I                                        4   4 URRE04                CGL002
     I                                        5   5 URRE05                CGL002
     I                                        6   6 URRE06                CGL002
     I                                        7   7 URRE07                CGL002
     I                                        8   8 URRE08                CGL002
     I                                        9   9 URRE09                CGL002
     I                                       10  10 URRE10                CGL002
      *                                                                   CGL002
     I            DS                                                      CGL002
      **  Item error status data structure                                CGL002
     I                                        1  76 @IE                   CGL002
     I                                        1  76 URERMG                CGL002
     I                                        5  76 @IH                   CGL002
     I                                        5  76 URIESL                CGL002
     I                                        5   5 URHL01                CGL002
     I                                       14  14 URHL02                CGL002
     I                                       23  23 URHL03                CGL002
     I                                       32  32 URHL04                CGL002
     I                                       41  41 URHL05                CGL002
     I                                       50  50 URHL06                CGL002
     I                                       59  59 URHL07                CGL002
     I                                       68  68 URHL08                CGL002
     IWURARC      DS                                                      CGL002
     I                                        1   1 WURSRD                CGL002
     I                                        2   2 WURSRC                CGL002
     I                                        3   3 WURSBD                CGL002
     I                                        4   4 WURSBC                CGL002
     I                                        5   5 WURSIN                CGL002
     I                                        6   6 WUDBST                CGL002
     I                                        7   7 WURSBR                CGL002
     I                                        8   8 WURTSB                CGL002
     I                                        9   9 WURSSC                CGL002
     I                                       10  10 WUFMST                CGL002
     IA@CPY       DS
      * Copyright array
     I                                        1  80 CPY@
     IRUNDAT      DS
     I                                        1   7 MRDT
     I                                    P   8  100RDNO
     I                                       11  11 SUCP
     I                                       12  12 DTFF
     I                                       13  13 MBIN
     I*
     IUUFDY     E DSDSFDY
     I*
     I* 200 Byte Data Structure for Incoming Data from Access Program
     I*
     IUUSDY     E DSDSSDY
     I*
     I* 800 Byte Data Structure for Incoming Data from Access Program
     I*
     IP@BJRF    E DSSDBANKPD
     I* @BTREE4 - BANK RECORD FORMAT DATA STRUCTURE
     I*
     ID@ACOD    E DSSDACODPD
     I*
     I*  Account Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@ACCT    E DSACCNTAB
     I*
     I*  Account Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@BRCH    E DSSDBRCHPD
     I*
     I*  Branch Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@CUST    E DSSDCUSTPD
     I              QQDFAC                          DFACQQ                                    CGL029
     I*
     I*  Client Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@CURR    E DSSDCURRPD
     I*
     I*  Currency Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@GELR    E DSSDGELRPD
     I              QQACCD                          QQACD1                                    CGL029
     I*
     I*  General Ledger Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@NARR    E DSSDNARRPD
     I*
     I*  Narrative Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@NOST    E DSSDNOSTPD
     I              QQACCD                          QQACD2                                    CGL029
     I*
     I*  Nostro Details DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@PRFC    E DSSDPRFCPD
     I*
     I*  Profit Centre DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@PRFM    E DSSDPRFMPD
     I*
     I*  Profit Centre Def Matrix DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@RETR    E DSSDRETRPD
     I*
     I*  Retail Transaction Types DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@BOOK    E DSSDBOOKPD
     I*
     I*  Book Codes DS for assigning data from Access
     I*  Programs to work fields
     I*
     ID@SARD    E DSSCSARDPD                                              CGL002
     I*                                                                   CGL002
     I*  Switchable Features DS                                           CGL002
     I              LCD                             LCDX                  CGL002
     I*                                                                   CGL002
     IZMUSER      DS
     I                                        1  10 USID
     I                                       11  13 UDBC
     I                                       14  16 UDDP
     I                                       17  17 UBLA
      /EJECT
      * Parameter declarations
     IP1PARM      DS
      * I : RST Batch number
     I                                        1   3 P1BTNB
     IP2PARM      DS
      * I :  Branch Code - Alpha
     I                                        1   3 P2BCDA
     IP3PARM      DS
      * I :  Branch Internal Customer
     I                                        1   6 P3BICN
     IP4PARM      DS
      * I :  Hash item no.input
     I                                    P   1   20P4HINI
     IP5PARM      DS
      * I :  Hash item no.calculated
     I                                    P   1   20P5HINC
     IP6PARM      DS
      * I :  Multiple Branch Batch
     I                                        1   1 P6MBRB
     IP7PARM      DS
      * I :  Dept Code
     I                                        1   3 P7DPCD
     IP8PARM      DS
      * I :  Spread Profile Code used
     I                                        1   1 P8SPCU
     IP9PARM      DS
      * O :  Exit option
     I                                        1   1 P9EXTO
     IP10PAR      DS                                                                          189519
      * I :  SPF Action Code                                                                  189519
     I                                        1   1 P2SACD                                    189519
     I            DS
     I                                        1 132 ZAMSDA
      * Message data for 'Account ID not valid ERR'
      * Account Identifier
     I                                        1  10 ZA0001
      * Message data for 'Nost/Retail A/c not valid'
      * Account Identifier
     I                                        1  10 ZA0002
      * Message data for 'Customer not found'
      * Account Identifier
     I                                        1  10 ZA0003
      * Message data for 'Account number not valid'
      * Account Identifier
     I                                        1  10 ZA0004
      * Currency code
     I                                       11  13 ZA0005
      * Account code
     I                                       14  17 ZA0006
      * Account sequence number
     I                                       18  19 ZA0007
      * Message data for 'Account is Closed'
      * Account Identifier
     I                                        1  10 ZA0008
      * Currency code
     I                                       11  13 ZA0009
      * Account code
     I                                       14  17 ZA0010
      * Account sequence number
     I                                       18  19 ZA0011
      * Message data for 'A/c Allocated To/From inv'
      * Account Identifier
     I                                        1  10 ZA0012
      * Message data for 'SPF Atn Cde ERR 1 ZVACTBU'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0013
      * Message data for 'SPF Atn Cde ERR 5 ZVACTBU'
      * SPF Action Code
     I                                        1   1 ZA0014
      * Branch Code - Alpha
     I                                        2   4 ZA0015
      * Message data for 'Branch Code Required'
      * Input Branch Code - Alpha
     I                                        1   3 ZA0016
      * Message data for 'Amount not valid'
      * Formatted Posting amount
     I                                        1  14 ZA0017
      * Message data for 'Debit Credit must be Y/N'
      * Debit/credit indicator
     I                                        1   1 ZA0018
      * Message data for 'Narrative Code not found'
      * Narrative
     I                                        1  30 ZA0019
      * Message data for 'Narrative must be entered'
      * Narrative
     I                                        1  30 ZA0020
      * Message data for 'Value Date not valid 2'
      * Value date (display)
     I                                        1   6 ZA0021
      * Message data for 'Value Date not valid 1'
      * Value date (display)
     I                                        1   6 ZA0022
      * Message data for 'Value Date not valid 2'
      * Value date (display)
     I                                        1   6 ZA0023
      * Message data for 'Value Date not valid 3'
      * Value date (display)
     I                                        1   6 ZA0024
      * Message data for 'Value Date Not Valid 9'
      * Value date (display)
     I                                        1   6 ZA0025
      * Message data for 'Value Date not valid 4'
      * Value date (display)
     I                                        1   6 ZA0026
      * Message data for 'Value Date not valid 5'
      * Value date (display)
     I                                        1   6 ZA0027
      * Message data for 'Value Date Not Valid 6'
      * Value date (display)
     I                                        1   6 ZA0028
      * Message data for 'Value Date Not Valid 7'
      * Value date (display)
     I                                        1   6 ZA0029
      * Message data for 'Value Date Not Valid 8'
      * Value date (display)
     I                                        1   6 ZA0030
      * Message data for 'Profit Centres         NF'
      * Profit centre
     I                                        1   4 ZA0031
      * Message data for 'Def Prof Centre Not Found'
      * Profit centre
     I                                        1   4 ZA0032
      * Message data for 'Profit ctr = From Ac pc'
      * Profit centre
     I                                        1   4 ZA0033
      * Message data for 'Currency Code not found'
      * Currency code
     I                                        1   3 ZA0034
      * Message data for 'Account Code not found'
      * Account code
     I                                        1   4 ZA0035
      * Message data for 'Branch Code not found'
      * Branch code
     I                                        1   3 ZA0036
      * Message data for 'Account Seq Numeric'
      * Account sequence number
     I                                        1   2 ZA0037
      * Message data for 'Spread fact. num & GT 0'
      * Spread details
     I                                        1   9 ZA0038
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0039
      * Currency code
     I                                       11  13 ZA0040
      * Account code
     I                                       14  17 ZA0041
      * Account sequence number
     I                                       18  19 ZA0042
      * Message data for 'Retail not valid for abrv'
      * Account Identifier
     I                                        1  10 ZA0043
      * Currency code
     I                                       11  13 ZA0044
      * Account code
     I                                       14  17 ZA0045
      * Account sequence number
     I                                       18  19 ZA0046
      * Message data for 'Can't O'ride GL a/c error'                      CGL002
      * Account Identifier                                                CGL002
     I                                        1  10 ZA0047                CGL002
      * Currency code                                                     CGL002
     I                                       11  13 ZA0048                CGL002
      * Account code                                                      CGL002
     I                                       14  17 ZA0049                CGL002
      * Account sequence number                                           CGL002
     I                                       18  19 ZA0050                CGL002
      * Message data for 'GL A/c Error Req's Overde'                      CGL002
      * Retail ind.: Override                                             CGL002
     I                                        1   1 ZA0051                CGL002
      * Message data for 'GL A/c Override Invalid'                        CGL002
      * Retail ind.: Override                                             CGL002
     I                                        1   1 ZA0052                CGL002
     I                                        1  10 ZA0094                                    CGL148
     I                                       11  13 ZA0095                                    CGL148
     I                                       14  23 ZA0096                                    CGL148
     I                                       24  25 ZA0097                                    CGL148
     I                                       26  28 ZA0098                                    CGL148
     I/COPY WNCPYSRC,GL0182MI01
      /EJECT
      *****************************************************************
      * Entry parameters
     C           *ENTRY    PLIST
     C                     PARM           P0RTN   7
     C           P1BTNB    PARM           WP0001  3        Batch number
     C           P2BCDA    PARM           WP0002  3        Branch Code - A
     C           P3BICN    PARM           WP0003  6        Branch Internal
     C           P4HINI    PARM           WP0004  30       Hash item no.in
     C           P5HINC    PARM           WP0005  30       Hash item no.ca
     C           P6MBRB    PARM           WP0006  1        Multiple Branch
     C           P7DPCD    PARM           WP0007  3        Dept Code
     C           P8SPCU    PARM           WP0008  1        Spread Profile
     C           P9EXTO    PARM P9EXTO    WP0009  1        Exit option
     C           P2SACD    PARM           WP0010  1        Action Code                        189519
     C           PBTAM     PARM PBTAM     WPBTAM  1                                           191175
     C/COPY WNCPYSRC,GL0182MC10
      *****************************************************************
      * Initialise
     C                     EXSR ZZINIT
      *
     C                     DO   *HIVAL
      * Initialise and load subfile page
     C                     EXSR BAIZSF
     C                     MOVEL'N'       W0RSF   1
      * Display screen until reload requested
     C           W0RSF     DOWEQ'N'
      * Display screen
     C                     EXSR CAEXFM
      * Process response
      * Cancel & exit program
     C   03                CAS            ZXEXPG
      * HOME: Request subfile reload
     C   05                CAS            FBRQRL
      * Display next SFL page
     C   27                CAS            BBLDSF
      * Process screen input
     C                     CAS            DAPR##
     C                     END
      *
     C                     END
     C                     END
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & load subfile page
      *================================================================
      * Clear subfile
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     80
      * Reset no of records in subfile
     C                     Z-ADD*ZERO     ##RRMX  50 81     SETOF 81
      * USER: Initialise subfile header
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0182MISH - Journal Entry Posting  *
     C*00/Copy Member GL0182M   Initialise Subfile Header
     C/COPY WNCPYSRC,GL0182MISH
     C                     END                             *FI
      * Position file
     C           KPOS      KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Setup key
     C                     MOVEL#2BTNB    BTBTNB           Batch number
     C                     Z-ADD#2BINB    BTBINB           Batch item no.
      * 82=EOF
     C           KPOS      SETLL@BTREAL              82    *
      * 82=EOF
     C/COPY WNCPYSRC,GL0182MC12
     C           KRST      KLIST
     C                     KFLD           BTBTNB           Batch number
      * Setup key
     C                     MOVEL#2BTNB    BTBTNB           Batch number
     C  N82      KRST      READE@BTREAL                9182*
     C/COPY WNCPYSRC,GL0182MC13
      * Load subfile page
     C                     EXSR BBLDSF
      *................................................................
      * If no records found, display error message
     C   82      ##RR      IFEQ *ZERO                      IF
      * Send message '*No data to display'
     C                     MOVEL'Y2U0008' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     END
      *
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile page
      *================================================================
     C                     SETOF                     84    No SFLNXTCHG
      * Re-establish fields in read-ahead record
     C   27                DO
     C  N82                READP@BTREAL                  90*
     C/COPY WNCPYSRC,GL0182MC14
     C  N82                READ @BTREAL                  90*
     C                     END
     C/COPY WNCPYSRC,GL0182MC15
      *
      * Setof record error indicators
     C                     MOVE *ALL'0'   WKIND0  9
     C                     MOVE *ALL'1'   WKIND1  9
      *                                                                   110309
      * Initialise exit option                                            110309
     C                     MOVE *BLANK    P9EXTO                          110309
      *                                                                   110309
      * Start at previous highest record in SFL
     C                     Z-ADD##RRMX    ##RR    50
     C                     Z-ADD*ZERO     ##RROK  50
      *................................................................
      * Load next subfile page
     C  N82      ##RROK    DOWLT##SFPG                     DO
     C                     MOVEAWKIND0    *IN,31
     C                     SETOF                     40                   CGL002
     C                     SETOF                     87    *
      * Clear subfile fields
     C                     EXSR MAIZ#1
      * Load SFL fields
     C                     EXSR MBFL#1
      * Calculate function fields
     C                     EXSR DG#2FN
      * Record will be selected unless overridden
     C                     MOVEL'Y'       W0RSL   1
      * USER: Initialise subfile record (existing record)
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELBTCUST    #RACID           Account Identif
      * Access Currency decimal places
      * CASE: RCD.Currency code is Blank
     C           #1CYCD    IFEQ *BLANK                     *IF
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     ELSE
      * CASE: *OTHERWISE
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
     C                     END                             *FI
      * Format Posting Amount
      * CASE: DB1.Posting amount is Not zero
     C           BTPTAM    IFNE *ZERO                      *IF
      * Format amount (short) - Standard functions  *
     C                     Z-ADDBTPTAM    ULVALU           Value
      *
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALU 150       I:Value
     C                     PARM WUNBDP    ULDECP  10       I:Decimal place
     C***********          PARM 'L'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM '3'       ULEDIT  1        I:IBM Edit code089856
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLF 23        O:Formatted
      *
     C                     MOVE ULRSLF    #RFMPA           Formatted data
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
      * Check condition for Output of Spread Factor & P.Centre
     C                     EXSR UASUBR                     Check condition
      * Check output condition for Branch field
     C                     EXSR UCSUBR                     Check output co
      * Initialise Narrative Code
      * CASE: DB1.Narrative code is Narrative code
     C           BTNVCD    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVELBTNVCD    #RNRTV           Narrative
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELBTNRDC    #RNRTV           Narrative
     C                     END                             *FI
      * Format Value Date & move to Work Fields
     C                     EXSR UDSUBR                     Format Value Da
      * Branch Code Batch Header
      * CASE: PAR.Branch Code - Alpha NE DB1.Branch Code (Batch Headr)
     C           P2BCDA    IFNE BTBCBH                     *IF
     C                     MOVELP2BCDA    #1BCBH           Branch Code (Ba
     C                     END                             *FI
      * S01212 Fix installed
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0182MIRE - Journal Entry Posting  *
     C*00/Copy Member GL0182M   Initialise Exist Record
     C/COPY WNCPYSRC,GL0182MIRE
     C                     END                             *FI
      * If record dropped...
     C           W0RSL     CABNE'Y'       BB020
      * Validate subfile record and calculate derived fields
     C                     EXSR DFV2RC
      * Output to subfile
     C                     ADD  1         ##RR       81    *
     C                     ADD  1         ##RROK
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C/COPY WNCPYSRC,GL0182MC02
     C                     WRITE#SFLRCD
     C           BB020     TAG
      * 82=EOF
     C           KRST      READE@BTREAL                  82*
     C/COPY WNCPYSRC,GL0182MC16
     C  N82                END
      *................................................................
      * Save highest SFL record load can continue at end point
     C           ##RR      IFGT ##RRMX
     C           ##RRMX    ADD  1         ##SFRC
     C                     Z-ADD##RR      ##RRMX
     C                     END
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen and process HELP requests
      *================================================================
      * Set screen conditioning indicators
     C                     EXSR GBDSA2
      * Update screen time
     C                     TIME           ##TME
     C           W0HLP     DOUEQ'N'
      * PUTOVR unless conditioned fields change
     C                     SETON                     86
     C           *IN89     IFNE CAIN89
     C           *IN81     ORNE CAIN81
     C                     SETOF                     86
     C                     END
     C                     MOVE *IN89     CAIN89  1
     C                     MOVE *IN81     CAIN81  1
     C                     WRITE#MSGCTL
     C                     WRITE#CMDTXT1
     C                     EXFMT#SFLCTL
     C                     MOVEL'N'       W0HLP   1
      * If help requested, display help text
     C   25                EXSR ZHHPKY
     C                     END
      * Update job time
     C                     TIME           ##JTM
      * Clear messages from program message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag
     C                     MOVEL'Y'       ZAFSMS  1      99*
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process screen input
      *================================================================
      * Maintain subfile position where possible
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      *
      * CALC: Subfile control function fields
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0182MSFF - Journal Entry Posting  *
     C*00/Copy Member GL0182M   Calculate Control Funct
     C/COPY WNCPYSRC,GL0182MSFF
     C                     END                             *FI
      * USER: Validate subfile control
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0182MVSC - Journal Entry Posting  *
     C*00/Copy Member GL0182M   Validate Control
     C/COPY WNCPYSRC,GL0182MVSC
     C                     END                             *FI
      * Quit if reload requested
     C           W0RSF     CABEQ'Y'       DAEXIT
      *
     C   81                DO
      * No data entered as yet
     C                     MOVEL'N'       WKIPIN  1
      * Confirm/update is not deferred
     C                     MOVEL'N'       W0DCF   1
      * Process subfile records
     C                     EXSR DBPRSF
      * If error, exit
     C           *IN99     CABEQ'1'       DAEXIT
      * Defer confirm/update requested
     C           W0DCF     CABEQ'Y'       DAEXIT
      * If data entered
     C           WKIPIN    IFEQ 'Y'
      * Update DBF from subfile
     C                     EXSR EAPRSF
      * If error during update, exit:
     C           *IN99     CABEQ'1'       DAEXIT
     C                     END                             WKIPIN
     C                     END
      * USER: Process command keys
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0182MPCK - Journal Entry Posting  *
     C*00/Copy Member GL0182M   Process Command Keys
     C/COPY WNCPYSRC,GL0182MPCK
     C                     END                             *FI
      * CASE: CTL.*CMD key is CF08
     C           *IN08     IFEQ '1'                        *IF
      * CASE: PAR.Spread Profile Code used is No
     C           P8SPCU    IFEQ 'N'                        *IF
      * Calculate Total Spread Factors
     C                     EXSR UFSUBR                     Calculate Total
      * CASE: WRK.Total Spread Factors NE WRK.Save Spread Factor
     C           WUKGNB    IFNE WUKDNB                     *IF
      * Send message 'Tot. Spread Factors Inval'
     C                     MOVEL'GLX0324' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     99    *
      *
     C                     ELSE
      * CASE: WRK.Total Spread Factors EQ WRK.Save Spread Factor
     C           WUKGNB    IFEQ WUKDNB                     *IF
      * Calculate posting amounts for TO postings
     C                     EXSR UGSUBR                     Calculate posti
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DBPRSF    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
     C           WPBTAM    IFEQ ' '                                                           191175
     C                     MOVE 'N'       PBTAM   1                                           191175
     C                     MOVE 'N'       WPBTAM                                              191175
     C                     ENDIF                                                              191175
     C/COPY WNCPYSRC,GL0182MC03
     C                     READC#SFLRCD                  92*
     C           *IN92     IFEQ '0'                                                           191175
     C                     MOVE 'Y'       PBTAM                                               191175
     C                     ENDIF                                                              191175
     C           WPBTAM    IFEQ 'Y'                                                           191175
     C                     MOVE 'Y'       PBTAM                                               191175
     C                     ENDIF                                                              191175
     C/COPY WNCPYSRC,GL0182MC11
     C           *IN92     DOWEQ'0'
     C                     EXSR DCPRSR
     C                     SETOF                     87    *
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C/COPY WNCPYSRC,GL0182MC04
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0182MCP7                                           S01408
     C*                                                                   S01408
     C                     END
      *================================================================
     CSR         DBEXIT    ENDSR
      /EJECT
     CSR         DCPRSR    BEGSR
      *================================================================
      * Process subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
     C                     SETOF                     40                   CGL002
      * No errors
     C                     SETOF                     98
      * Data entered
     C                     MOVEL'Y'       WKIPIN
      * SFLNXTCHG
     C                     SETON                     84
      * Validate subfile record
     C                     EXSR DEV1RC
      * If SFLRCD invalid, note the fact
     C   98N99             Z-ADD##RR      ##SFRC     99    *
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         DEV1RC    BEGSR
      *================================================================
      * Validate subfile record
      *================================================================
      * USER: Validate subfile record fields
      * S01212 Fix Installed
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * RTV Last Btch Itm EDTFIL - Standard functions  *
     C*  SAVE INDICATORS
     C                     MOVEL*IN82     WUIN82  1
     C                     MOVEL*IN91     WUIN91  1
      * Setup key.
     C*****************    Z-ADD#IJDNB    W@BCHN  30       Batch number   S01234
     C*****************    Z-ADD#IJDNB    W@KEY1  30       Batch number   S01234
     C*                                                                   S01234
     C                     MOVE #1BTNB    W@BCHN  3        Batch number   S01234
     C                     MOVE #1BTNB    W@KEY1  3        Batch number   S01234
     C*                                                                   S01234
     C           BATNUM    ADD  1         BNUM2            Batch number   S01234
     C*
     C           W@KEY1    SETLL@BTREAL              82    *82=EOF
     C                     READP@BTREAL                9182*82=EOF
     C*
     C           *IN82     IFEQ '1'
     C           #1BTNB    ORNE W@BCHN
      *==
      * Move BLANKS OR ZEROES TO Copy Fields..
      *==
     C                     MOVEL*BLANK    WUCCUS  6        COPY:Cust No
     C                     Z-ADD0         WUCPAM 130       COPY:Amount
     C*********************MOVEL*BLANK    WUCRAN 10        COPY:Ret A/c
     C                     Z-ADD0         WUCRAN 100       COPY:Ret A/c
     C                     MOVEL*BLANK    WUCNRC  2        COPY:Narr Code
     C                     MOVEL*BLANK    WUCNDS 30        COPY:Narr Desc
     C                     Z-ADD0         WUCVDN  50       COPY:Value Date
     C                     MOVEL*BLANK    WUCCCD           COPY:CCY Code
     C                     MOVEL*BLANK    WUCPAC           COPY:A/c Code
     C                     MOVEL*BLANK    WUCACS  2        COPY:A/c Seq
     C                     MOVEL*BLANK    WUCDCI           COPY:Dr/Cr Ind
     C                     MOVEL*BLANK    WUCTRT  5        COPY:Trans Typ
     C                     MOVEL*BLANK    WUCCNB  8        COPY:Cheque No
     C                     MOVEL*BLANK    WUCACN  6        COPY:Assoc. Cust
     C                     MOVEL*BLANK    WUASSC 10        COPY:Assoc. Cust
     C                     MOVEL*BLANK    WUCSCR 16        COPY:Swift Ref
     C                     MOVEL*BLANK    WUCRNE  1        COPY:Ret A/c Ent
      *
     C                     ELSE
      *==
      * Move @BTREAL ( GL Batch Posting ) fields to Copy: Fields..
      *==
     C           #1BTNB    IFEQ W@BCHN                     Batch number
     C                     MOVELBTCUST    WUCCUS           COPY:Cust No
     C                     Z-ADDBTPTAM    WUCPAM           COPY:Post Amount
     C*********************Z-ADDBTRACN    WUCRAN           COPY:Ret A/c
     C                     MOVELBTRACN    WUCRAN           COPY:Ret A/c
     C                     MOVELBTNVCD    WUCNRC           COPY:Narr Code
     C                     MOVELBTNRDC    WUCNDS           COPY:Narr Desc
     C                     Z-ADDBTVLDT    WUCVDN           COPY:Val Date NBR
     C                     MOVELBTCYCD    WUCCCD           COPY:CCY Code
     C                     MOVELBTACCD    WUCPAC           COPY:A/c Code
     C                     MOVELBTACSN    WUCACS           COPY:A/c Seq
     C                     MOVELBTDCIN    WUCDCI           COPY:Dr/Cr Ind
     C                     MOVELBTTRTY    WUCTRT           COPY:Trans Typ
     C                     MOVELBTCQNB    WUCCNB           COPY:Cheque No
     C                     MOVELBTACNB    WUCACN           COPY:Assoc. Cust
     C                     MOVELBTACNB    WUASSC           COPY:Assoc. Cust
     C                     MOVELBTSWCR    WUCSCR           COPY:Swift Ref
     C                     MOVELBTRNBE    WUCRNE           COPY:Ret A/c Ent
     C                     END
     C                     END
     C* RESTORE INDICATORS
     C                     MOVELWUIN82    *IN82
     C                     MOVELWUIN91    *IN91
      * CASE: WRK.Copy:Retail Number Enter is Retail Account
     C           WUCRNE    IFEQ 'Y'                        *IF
     C                     MOVELWUCRAN    WUCACI           Copy:Account id
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    WUCACI           Copy:Account id
     C                     MOVELWUCCUS    WUCACI           Copy:Account id
     C                     END                             *FI
      * CASE: WRK.Copy:Narrative Code is Narrative code
     C           WUCNRC    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUCNAR           Copy:Narrative
     C                     MOVELWUCNRC    WUCNAR           Copy:Narrative
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCNDS    WUCNAR           Copy:Narrative
     C                     END                             *FI
      * CASE: RCD.Currency code is Blank
     C           #1CYCD    IFEQ *BLANK                     *IF
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
      * CASE: RCD.Currency code is Not Question Mark
     C           #1CYCD    IFNE '?'                        *IF
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * Format amount (short) - Standard functions  *
     C                     Z-ADDWUCPAM    ULVALU           Value
     C                     CALL 'GL0135U'              90  <FORMAT AMOUNT>
     C                     PARM           ULVALU 150       I:Value
     C                     PARM WUNBDP    ULDECP  10       I:Decimal place
     C                     PARM 'J'       ULEDIT  1        I:IBM Edit code
     C                     PARM *BLANK    ULCHQP  1        I:Cheque prtct.
     C                     PARM           ULRSLF 23        O:Formatted
     C                     MOVE ULRSLF    WUCAMT           Formatted data
     C                     END                             *FI
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM WUCVDN    WQ0012  50       Runday Number
     C                     PARM WUDTFF    WQ0013  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0014  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0015  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    WUVDDS
     C                     MOVELWUVDDS    WUCVDT           Copy:Value Date
     C                     ELSE
      * CASE: *OTHERWISE
     C                     END                             *FI
      * /COPY S01212 Fix installed
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0182MVSU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0182MVSU
     C*
     C                     END                             *FI
      * Re-set Output conditions for 1st Posting
     C                     EXSR UHSUBR                     Re-set Output c
      * Validate subfile record relations
     C                     EXSR DFV2RC
      *================================================================
     CSR         DEEXIT    ENDSR
      /EJECT
     CSR         DFV2RC    BEGSR
      *================================================================
      * Validate subfile record relations
      *================================================================
      *                                                                   CGL008
      ** If Feature CGL008 is ON                                          CGL008
      *                                                                   CGL008
     C           CGL008    IFEQ 'Y'                                       CGL008
      *                                                                   CGL008
      ** Check the Access to all account codes                            CGL008
      *                                                                   CGL008
     C           WMACOD    IFNE 'Y'                                       CGL008
     C           #1ACCD    ANDNE'?'                                       CGL008
     C           #1ACCD    ANDNE*BLANKS                                   CGL008
      *                                                                   CGL008
      ** Check the Authorities of this account code                       CGL008
      *                                                                   CGL008
     C                     MOVE #1ACCD    WWACCD                          CGL008
      *                                                                   CGL008
     C           KCAUAC    CHAINSFACAUL0             22                   CGL008
      *                                                                   CGL008
      ** If no record found, the input is not allowed                     CGL008
      *                                                                   CGL008
     C           *IN22     IFEQ *ON                                       CGL008
     C                     MOVEL'CGL0001' ZAMSID                          CGL008
     C                     MOVEL'GLUSRMSG'ZAMSGF                          CGL008
     C                     EXSR ZASNMS                                    CGL008
     C                     MOVE *ON       *IN99                           CGL008
     C                     MOVE *ON       *IN33                           CGL008
     C                     GOTO DFEXIT                                    CGL008
     C                     ENDIF                                          CGL008
     C                     ENDIF                                          CGL008
     C                     ENDIF                                          CGL008
      *                                                                   CGL008
      * Calculate function fields
     C                     EXSR DG#2FN
      * USER: Validate subfile record relations
      * Account ID
      * CASE: RCD.Account Identifier is Entered
     C           #RACID    IFNE *BLANK                     *IF
      * Check Account Identifier
     C                     EXSR UISUBR                     Check Account I
      * Account Identifier is Retail or Nostro -> snd errmsg
      * CASE: WRK.Account ID Status Flag is Retail or Nostro
     C           WUAISF    IFEQ '*NOSTRO'                  *IF
     C           WUAISF    OREQ '*RETAIL'
      * Setup message data for message
     C                     MOVEL#RACID    ZA0002           Account Identif
      * Send message 'Nost/Retail A/c not valid'
     C                     MOVEL'GLX0322' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     END                             *FI
      * Account Identifier is Customer number or Shortname
      * CASE: WRK.Account ID Status Flag is Customer No or short name
     C           WUAISF    IFEQ '*NUMBER'                  *IF
     C           WUAISF    OREQ '*SHNAME'
     C                     MOVEL'N'       WUCNSI           Cust No or Shor
      * CASE: WRK.Valid Customer Number is Not Valid
     C           WUVCNB    IFEQ 'N'                        *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0003           Account Identif
      * Send message 'Customer not found'
     C                     MOVEL'GLX0084' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     MOVEL'Y'       WUCNSI           Cust No or Shor
     C                     END                             *FI
      * CASE: WRK.Cust No or Short Inval is No Error
     C           WUCNSI    IFEQ 'N'                        *IF
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO 10                                           CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUIBCA           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      *                                                                                       CGL148
      ** Check if:                                                                            CGL148
      **  -- account does not exist but all fields are valid and                              CGL148
      **  -- account type is not retail or nostro                                             CGL148
      **  -- account is not "Title Only"                                                      CGL148
      **  -- if CGL148 is on                                                                  CGL148
      ** then allow the entry (system will open the account during COB)                       CGL148
      *                                                                                       CGL148
     C           A5ACTY    IFNE 'R'                                                           CGL148
     C           A5ACTY    ANDNE'N'                                                           CGL148
      *                                                                                       CGL148
     C           A5TOIN    IFNE 'Y'                                                           CGL148
     C           CGL148    ANDEQ'Y'                                                           CGL148
      *                                                                                       CGL148
     C                     MOVEL#RACID    WUCUST                                              CGL148
     C                     MOVEL#1CYCD    WUCYCD                                              CGL148
     C                     MOVEL#1ACCD    WUACCD                                              CGL148
     C                     MOVEL#1ACSN    WUACSN                                              CGL148
     C                     MOVEL#1IBCA    WUIBCA                                              CGL148
     C                     MOVELA5ACTY    WUACTY                                              CGL148
     C                     MOVEL*BLANKS   WUBPST                                              CGL148
     C                     MOVEL*BLANKS   WUACCS                                              CGL148
     C                     MOVEL*BLANKS   WUDACO                                              CGL148
     C                     MOVEL*BLANKS   WUACNM                                              CGL148
     C                     MOVEL*BLANKS   WURACN                                              CGL148
     C                     MOVEL*BLANKS   WURRNM                                              CGL148
     C                     MOVEL*BLANKS   WURETB                                              CGL148
      * Setup message data for message                                                        CGL148
     C                     MOVEL#RACID    ZA0094                                              CGL148
     C                     MOVEL#1CYCD    ZA0095                                              CGL148
     C                     MOVEL#1ACCD    ZA0096                                              CGL148
     C                     MOVEL#1ACSN    ZA0097                                              CGL148
     C                     MOVEL#1IBCA    ZA0098                                              CGL148
      * Send Warning - GL Account not open                                                    CGL148
     C                     MOVEL'GLW0054' ZAMSID                                              CGL148
     C                     EXSR ZASNMS                                                        CGL148
     C                     ELSE                                                               CGL148
      * Setup message data for message                                                        CGL148
     C                     MOVEL#RACID    ZA0004                                              CGL148
     C                     MOVEL#1CYCD    ZA0005                                              CGL148
     C                     MOVEL#1ACCD    ZA0006                                              CGL148
     C                     MOVEL#1ACSN    ZA0007                                              CGL148
      * Send message 'Account number not valid'                                               CGL148
     C                     MOVEL'GLX0054' ZAMSID                                              CGL148
     C                     EXSR ZASNMS                                                        CGL148
     C                     SETON                     983132                                   CGL148
     C                     SETON                     3334                                     CGL148
     C                     ENDIF                                                              CGL148
     C                     ENDIF                                                              CGL148
      **                                                                                      CGL148
     C           A5ACTY    IFEQ 'R'                                                           CGL148
     C           A5ACTY    OREQ 'N'                                                           CGL148
      **                                                                                      CGL148
      * Setup message data for message
     C                     MOVEL#RACID    ZA0004           Account Identif
     C                     MOVEL#1CYCD    ZA0005           Currency code
     C                     MOVEL#1ACCD    ZA0006           Account code
     C                     MOVEL#1ACSN    ZA0007           Account sequenc
      * Send message 'Account number not valid'
     C                     MOVEL'GLX0054' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
     C                     SETON                     3334  *
     C                     ENDIF                                                              CGL148
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Error if account is closed
      * CASE: WRK.Account status is Closed
     C           WUACCS    IFEQ 'C'                        *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0008           Account Identif
     C                     MOVEL#1CYCD    ZA0009           Currency code
     C                     MOVEL#1ACCD    ZA0010           Account code
     C                     MOVEL#1ACSN    ZA0011           Account sequenc
      * Send message 'Account is Closed'
     C                     MOVEL'GLX0126' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983132*
     C                     SETON                     3334  *
      *
     C                     END                             *FI
      * Check Account Number
      * CASE: WRK.Cust No or Short Inval is No Error
     C           WUACTY    IFEQ 'R'                                                         AR802562
     C           WUACTY    OREQ 'N'                                                         AR802562
      *                                                                                     AR802562
      ** Setup message data for message                                                     AR802562
      *                                                                                     AR802562
     C                     MOVEL#RACID    ZA0002                                            AR802562
      *                                                                                     AR802562
      ** Send message 'Nost/Retail A/c not valid'                                           AR802562
      *                                                                                     AR802562
     C                     MOVEL'GLX0322' ZAMSID                                            AR802562
     C                     EXSR ZASNMS                                                      AR802562
     C                     SETON                     9831                                   AR802562
      *                                                                                     AR802562
     C                     ELSE                                                             AR802562
     C           WUCNSI    IFEQ 'N'                        *IF
     C                     MOVELWUIBCA    #1IBCA           Input Branch Co
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     MOVELWUACSN    #1ACSN           Account sequenc
     C                     MOVELWUACTY    #1ACTY           Account type
     C                     Z-ADDWURACN    #1RACN           Retail account
     C                     Z-ADDWURRNM    #1RRNM           Relative rec no
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     MOVEL'N'       #1RNBE           Retail Number E
     C                     END                             *FI
     C                     ENDIF                                                            AR802562
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #1CUST           Customer number
     C                     MOVEL'G'       #1ACTY           Account type
     C                     MOVEL'N'       #1RNBE           Retail Number E
     C                     Z-ADD*ZERO     #1RACN           Retail account
      * Setup message data for message
     C                     MOVEL#RACID    ZA0012           Account Identif
      * Send message 'A/c Allocated To/From inv'
     C                     MOVEL'GLX0261' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     END                             *FI
     C/COPY WNCPYSRC,GL0182MC01
      * SPF Branch code
     C                     EXSR UJSUBR                     SPF Branch code
      * Validate Posting Amount
      * CASE: RCD.Formatted Posting amount is Entered
     C           #RFMPA    IFNE *BLANK                     *IF
      * Check Posting amount
     C                     EXSR UKSUBR                     Check Posting a
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     #1PTAM           Posting amount
     C                     END                             *FI
      * Check Debit/Credit Indicator
      * CASE: RCD.Debit/credit indicator is Valid Values
     C           #1DCIN    IFEQ 'C'                        *IF
     C           #1DCIN    OREQ 'D'
     C                     ELSE
      * CASE: RCD.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1DCIN    ZA0018           Debit/credit in
      * Send message 'Debit Credit must be Y/N'
     C                     MOVEL'GLX0205' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     END                             *FI
      * Check Narrative
     C                     EXSR ULSUBR                     Check Narrative
      * Check Value Date
     C                     EXSR UMSUBR                     Check Value Dat
      * Check Profit Centre
     C                     EXSR UPSUBR                     Check Profit Ce
      * Setup Branch code (Header) & Posting Date on RCD
     C                     EXSR UQSUBR                     Setup Branch co
      *                                                                   CGL002
      **  If Block GL Accounts Enhancement feature is switched on         CGL002
      **  and account type is GL, check overrideable GL errors            CGL002
      *                                                                   CGL002
     C                     EXSR SRNOST                                                      MD038989
     C           CGL002    IFEQ 'Y'                                       CGL002
     C           WUACTY    ANDEQ'G'                                       CGL002
     C           WUACTY    OREQ 'N'                                                         MD038989
     C           NSTFLG    OREQ 'Y'                                                         MD038989
     C                     EXSR SRGLOV                                    CGL002
     C                     ELSE                                           CGL002
      *                                                                   CGL002
      ** Reset Retail Error Indicators                                    CGL002
     C                     MOVEL' '       #1RINO                          CGL002
     C                     MOVEL'N'       #1RINE                          CGL002
     C                     MOVEL*BLANK    #RIEMG                          CGL002
     C                     ENDIF                                          CGL002
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0182MCP8                                           S01408
     C*                                                                   S01408
      * Set UP Exit Option - Standard functions  *
     C*
     C* Set Error on batch indicator to P Indicating Errors outstanding
     C* In Batch Postings.. Occurred during I/Face Batch Being Read..
     C*
     C           *IN98     IFEQ '1'
     C           #1RINO    OREQ 'N'                                       LN0327
     C                     MOVEL'P'       P9EXTO            EXIT OPTION
     C***********          ELSE                                     LN0327E28994
     C***********          MOVEL' '       #OEXTO                          E28994
     C                     END                              *FI
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0182MVRR - Journal Entry Posting  *
     C*00/Copy Member GL0182M   Validate Record Relations
     C/COPY WNCPYSRC,GL0182MVRR
     C                     END                             *FI
      *================================================================
     CSR         DFEXIT    ENDSR
      /EJECT
     CSR         DG#2FN    BEGSR
      *================================================================
      * Calculate subfile record function fields
      *================================================================
      * CALC: Subfile record function fields
      * Add Mode Copy Setup
      * CASE: PGM.*Program mode is *ADD
     C           W0PMD     IFEQ 'ADD'                      *IF
      * CASE: RCD.Account Identifier EQ WRK.JE Special Character
     C           #RACID    IFEQ WUJESP                     *IF
     C                     MOVELWUCACI    #RACID           Account Identif
     C                     END                             *FI
      * CASE: RCD.Currency code EQ WRK.JE Special Character
     C           #1CYCD    IFEQ WUJESP                     *IF
     C                     MOVELWUCCCD    #1CYCD           Currency code
     C                     END                             *FI
      * CASE: RCD.Account code EQ WRK.JE Special Character
     C           #1ACCD    IFEQ WUJESP                     *IF
     C                     MOVELWUCPAC    #1ACCD           Account code
     C                     END                             *FI
      * CASE: RCD.Account sequence number EQ WRK.JE Special Character
     C           #1ACSN    IFEQ WUJESP                     *IF
     C                     MOVELWUCACS    #1ACSN           Account sequenc
     C                     END                             *FI
      * CASE: RCD.Input Branch Code - Alpha EQ WRK.JE Special Character
     C           #1IBCA    IFEQ WUJESP                     *IF
     C                     MOVELWUCBCA    #1IBCA           Input Branch Co
     C                     END                             *FI
      * CASE: RCD.Formatted Posting amount EQ WRK.JE Special Character
     C           #RFMPA    IFEQ WUJESP                     *IF
     C                     MOVELWUCAMT    #RFMPA           Formatted Posti
     C                     END                             *FI
      * CASE: RCD.Debit/credit indicator EQ WRK.JE Special Character
     C           #1DCIN    IFEQ WUJESP                     *IF
     C                     MOVELWUCDCI    #1DCIN           Debit/credit in
     C                     END                             *FI
      * CASE: RCD.Narrative EQ WRK.JE Special Character
     C           #RNRTV    IFEQ WUJESP                     *IF
     C                     MOVELWUCNAR    #RNRTV           Narrative
     C                     END                             *FI
      * CASE: RCD.Transaction type EQ WRK.JE Special Character
     C           #1TRTY    IFEQ WUJESP                     *IF
     C                     MOVELWUCTRT    #1TRTY           Transaction typ
     C                     END                             *FI
      * CASE: RCD.Cheque number EQ WRK.JE Special Character
     C           #1CQNB    IFEQ WUJESP                     *IF
     C                     MOVELWUCCNB    #1CQNB           Cheque number
     C                     END                             *FI
      * CASE: RCD.Associated Cust - Display EQ WRK.JE Special Character
     C           #RASCD    IFEQ WUJESP                     *IF
     C                     MOVELWUASSC    #RASCD           Associated Cust
     C                     END                             *FI
      * CASE: RCD.Value date (display) EQ WRK.JE Special Character
     C           #RVDDS    IFEQ WUJESP                     *IF
     C                     MOVELWUCVDT    #RVDDS           Value date (dis
     C                     END                             *FI
      * CASE: RCD.Swift common reference EQ WRK.JE Special Character
     C           #1SWCR    IFEQ WUJESP                     *IF
     C                     MOVELWUCSCR    #1SWCR           Swift common re
     C                     END                             *FI
      * CASE: RCD.Profit centre EQ WRK.JE Special Character
     C           #1PRCN    IFEQ WUJESP                     *IF
     C                     MOVELWUCPRC    #1PRCN           Profit centre
     C                     END                             *FI
     C                     END                             *FI
      * Check Account Identifier
      * CASE: RCD.Account Identifier is Entered
     C           #RACID    IFNE *BLANK                     *IF
      * CASE: RCD.Account Identifier is Select Requested
     C           #RACID    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
     C                     MOVEL'Y'       WUVCNB           Valid Customer
      * Access Client Details. - Client Details  *
     C*
     C*  Access CLient Details file for the following fields
     C*  Customer No., Customer shortname, DRS Shortname,
     C*  Location, Customer SWIFT I.D.
     C*
     C                     CALL 'AOCUSTR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM #RACID    UUCNCD 10        I:Client Key
     C                     PARM           UUCRST  7        O:Key status
     C           D@CUST    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUCRST    WUCRST           Key Status  ber
     C*
     C                     MOVELBBCUST    WUCUST           Customer Number
     C                     MOVELBBCSSN    WUCSSN           Shortname
     C                     MOVELBBDRCS    WUDRCS           DRS Shortname
     C                     MOVELBBLCCD    WULCCD           Location
     C                     MOVELBBCSID    WUCSID           SWIFT ID
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C           WUAPRC    OREQ '*CUSCLS'                                                     CGL148
     C           WUAPRC    OREQ '*CUSDEL'                                                     CGL148
     C                     MOVEL'N'       WUVCNB           Valid Customer
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVELWUCUST    #RACID           Account Identif
     C                     MOVELWUCUST    #1CUST           Customer number
     C                     END                             *FI
     C                     END                             *FI
      * Check Currency Code
      * CASE: RCD.Currency code is Not blank
     C           #1CYCD    IFNE *BLANK                     *IF
      * CASE: RCD.Currency code is Select Requested
     C           #1CYCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1CYCD    ZA0034           Currency code
      * Send message 'Currency Code not found'
     C                     MOVEL'GLX0048' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9832  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUCYCD    #1CYCD           Currency code
     C                     END                             *FI
     C                     END                             *FI
      * Check Account code
      * CASE: RCD.Account code is Not blank
     C           #1ACCD    IFNE *BLANK                     *IF
      * CASE: RCD.Account code is Select Requested
     C           #1ACCD    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Account Codes. - Account Codes  *
     C*
     C*  Access Account codes file for the following fields
     C*  A/c Type, A/c Name, Account Section, Account Subtype
     C*
     C                     MOVEL#1ACCD    UUACCD                          LN0334
     C                     CALL 'AOACODR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C**********           PARM           UUACCD  4        I:Account Code              LN0334 CGL029
     C********** D@ACOD    PARM *BLANK    UUFDY            O:Format                           CGL029
     C                     PARM           UUACCD 10        I:Account Code                     CGL029
     C           D@ACOD    PARM *BLANK    UUSDY            O:Format                           CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA5ACCD    WUACCD           A/c Code       LN0334
     C                     MOVELA5ACTY    WUACTY           A/C Type
     C                     MOVELA5ACCN    WUACCN           A/c Name
     C                     MOVELA5ACSC    WUACSC           A/c Section
     C                     MOVELA5ACST    WUACST           A/c Sub-Type
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1ACCD    ZA0035           Account code
      * Send message 'Account Code not found'
     C                     MOVEL'GLX0046' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9833  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUACCD    #1ACCD           Account code
     C                     END                             *FI
     C                     END                             *FI
      * Branch Code Validation
     C                     EXSR URSUBR                     Branch Code Val
      * Account sequence validation
      * CASE: RCD.Account sequence number is Not blank
     C           #1ACSN    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#1ACSN    WUZASF           ZALIGN Screen F
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0057  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0058 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0059  10       ZALIGN No Of De
     C                     PARM 2         WQ0060  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0061 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is Zalign Error
     C           W0RTN     IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#1ACSN    ZA0037           Account sequenc
      * Send message 'Account Seq Numeric'
     C                     MOVEL'GLX0224' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9834  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Zalign Account Sequence - Journal Entry Posting  *
     C                     MOVE WUZASF    #1ACSN
     C                     END                             *FI
     C                     END                             *FI
      * Validate Spread factors TO postings
      * CASE: PAR.Spread Profile Code used is No
     C           P8SPCU    IFEQ 'N'                        *IF
      * CASE: RCD.Batch item no. is not first posting
     C           #1BINB    IFGT 1                          *IF
      * Validate Spread Factors and move to Work fields
      * CASE: RCD.Spread details is not blank
     C           #RKCNB    IFNE *BLANK                     *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#RKCNB    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0062  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0063 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0064  10       ZALIGN No Of De
     C                     PARM 8         WQ0065  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0066 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0067 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0068  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Send message 'Spread Factor invalid'
     C                     MOVEL'GLX0327' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVE WUZASF    #1SPFC           Spread Factor
      * Zalign Spread Factor - Journal Entry Posting  *
     E* Y2V3114 - Source member  not found.
      * CASE: RCD.Spread Factor is zero
     C           #1SPFC    IFEQ *ZERO                      *IF
      * Setup message data for message
     C                     MOVEL#RKCNB    ZA0038           Spread details
      * Send message 'Spread fact. num & GT 0'
     C                     MOVEL'GLX0329' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9837  *
      *
     C                     END                             *FI
      * Move Spread Factors to Work fields
     C                     EXSR USSUBR                     Move Spread Fac
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * CASE: RCD.Spread Factor is zero
     C           #1SPFC    IFEQ *ZERO                      *IF
      * Send message 'Sprd Fact.must be entered'
     C                     MOVEL'GLX0330' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * /Copy S01212 Fix installed
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0182MRFF - Journal Entry Posting  *
     C*00/Copy Member GL0182M   Calculate Record Funct
     C/COPY WNCPYSRC,GL0182MRFF
     C                     END                             *FI
      *================================================================
     CSR         DGEXIT    ENDSR
      /EJECT
     CSR         EAPRSF    BEGSR
      *================================================================
      * Update DBF from subfile
      *================================================================
      * Initialise subfile reload flag
     C                     MOVEL'N'       W0RSF
      * Process all modified subfile records
     C/COPY WNCPYSRC,GL0182MC05
     C                     READC#SFLRCD                  92*
     C           *IN92     DOWEQ'0'
      * Process modified subfile record
     C                     EXSR EBPRSR
     C           W0RTN     IFNE *BLANK
      * ROLLBACK required
      * Send message '*ROLLBACK required'
     C                     MOVEL'Y2U0018' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     MOVEL'Y2U0018' P0RTN
     C                     EXSR ZYEXPG
     C                     END
      * Set screen conditioning indicators
     C                     EXSR GADSA1
     C/COPY WNCPYSRC,GL0182MC06
     C                     UPDAT#SFLRCD
     C                     READC#SFLRCD                  92*
     C                     END
      * If any errors, cancel reload
     C           *IN99     IFEQ '1'
     C                     MOVEL'N'       W0RSF   1
     C                     END
      *================================================================
     CSR         EAEXIT    ENDSR
      /EJECT
     CSR         EBPRSR    BEGSR
      *================================================================
      * Process modified subfile record
      *================================================================
      * Set off error indicators
     C                     MOVEAWKIND0    *IN,31
     C                     SETOF                     40                   CGL002
     C                     SETOF                     98
      *
      * Process change request
     C                     EXSR EECHRQ
      * If error occurred on update, note the fact
     C           *IN98     IFEQ '1'
     C           *IN99     IFEQ '0'
     C                     Z-ADD##RR      ##SFRC     99    *
     C                     END
     C                     ELSE
      * USER: Extra processing after DBF update
      * CASE: WRK.value date changed is yes
     C           WULHST    IFEQ 'Y'                        *IF
      * Send message 'Value Dte not same as prv'
     C                     MOVEL'GLX0326' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     MOVEL'N'       WULHST           value date chan
     C                     END                             *FI
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0182MCP5                                           S01408
     C*                                                                   S01408
     C                     MOVEL'Y'       W0RSF            *Reload subfile
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0182MCP6                                           S01408
     C*                                                                   S01408
     C                     END
      *================================================================
     CSR         EBEXIT    ENDSR
      /EJECT
     CSR         EECHRQ    BEGSR
      *================================================================
      * Process update request
      *================================================================
      * USER: Change DBF record
      * Chg Spread Jrnl Postings - Journal Entry Posting  *
     C                     EXSR SACHRC
     C           W0RTN     IFNE *BLANK
      * DBF update error
      * Screen errors
     C                     MOVEAWKIND1    *IN,31
      *                                                                   CGL002
     C           CGL002    IFEQ 'Y'                                       CGL002
     C           *IN74     ANDEQ'1'                                       CGL002
     C                     SETON                     40                   CGL002
     C                     ENDIF                                          CGL002
      * Format error
     C                     SETON                     98    *
      * Enable entry
     C                     SETOF                     87    *
      * SFLNXTCHG
     C                     SETON                     84    *
      * Reset subfile record if changed record
     C           W0RTN     CASEQ'Y2U0007' MBFL#1           IF
     C                     END
     C                     ELSE
      * DBF update successful
      * Enable entry
     C                     SETOF                     87    *
      * No SFLNXTCHG
     C                     SETOF                     84    *
     C                     END
      *================================================================
     CSR         EEEXIT    ENDSR
      /EJECT
     CSR         FBRQRL    BEGSR
      *================================================================
      * Request subfile reload
      *================================================================
     C                     MOVEL'Y'       W0RSF
      *================================================================
     CSR         FBEXIT    ENDSR
      /EJECT
     CSR         GADSA1    BEGSR
      *================================================================
      * Set display attributes for Subfile record
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
      * Protect keys if change mode or updated record
     C                     SETON                     88    *
     C   89N87             SETOF                     88    *
     C                     MOVEL*IN87     *IN78
     C           P8SPCU    IFEQ 'Y'                        *IF
     C                     MOVEL'1'       *IN78
     C                     END                             *FI
     C                     MOVEL*IN87     *IN77
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN77
     C                     END                             *FI
     C                     MOVEL*IN87     *IN76
     C           WUOUTP    IFEQ 'Y'                        *IF
     C                     MOVEL'1'       *IN76
     C                     END                             *FI
     C                     MOVEL*IN87     *IN74                           CGL002
     C           #1RINE    IFEQ *BLANK                                    CGL002
     C           #1RINE    OREQ 'N'                                       CGL002
     C                     MOVEL'1'       *IN74                           CGL002
     C                     END                                            CGL002
     C                     MOVEL'0'       *IN75
     C           #RIEST    IFEQ 'E'                        *IF
     C                     MOVEL'1'       *IN75
     C                     END                             *FI
      *================================================================
     CSR         GAEXIT    ENDSR
      /EJECT
     CSR         GBDSA2    BEGSR
      *================================================================
      * Set display attributes for Subfile control
      *================================================================
     C           W0PMD     COMP 'ADD'                    89*
     C                     MOVEL'0'       *IN79
     C           WUMBIN    IFEQ 'N'                        *IF
     C                     MOVEL'1'       *IN79
     C                     END                             *FI
      *================================================================
     CSR         GBEXIT    ENDSR
      /EJECT
     CSR         MAIZ#1    BEGSR
      *================================================================
      * Initialise subfile record
      *================================================================
      * Previous values
     C                     MOVEL*BLANK    #1DBRC
     C                     MOVEL*BLANK    #RIEST           Item error stat
     C                     MOVELP1BTNB    #1BTNB           Batch number
     C                     Z-ADD*ZERO     #1BINB           Batch item no.
     C                     MOVEL*BLANK    #1CUST           Customer number
     C                     MOVEL*BLANK    #1NNBI           Nostro number (
     C                     Z-ADD*ZERO     #1RACN           Retail account
     C                     Z-ADD*ZERO     #1PTAM           Posting amount
     C                     MOVEL*BLANK    #1RINE           Retail ind.: Er
     C                     Z-ADD*ZERO     #1PTDT           Posting date
     C                     MOVEL*BLANK    #1NVCD           Narrative code
     C                     MOVEL*BLANK    #1NRDC           Narrative descr
     C                     MOVEL*BLANK    #1ACTY           Account type
     C                     MOVEL*BLANK    #1TRTY           Transaction typ
     C                     MOVEL*BLANK    #1TSTY           Transaction (Su
     C                     MOVEL*BLANK    #1CQNB           Cheque number
     C                     Z-ADD*ZERO     #1VLDT           Value date
     C                     MOVEL*BLANK    #1ACNB           Assoc. Customer
     C                     MOVEL*BLANK    #1COIN           Customer origin
     C                     MOVEL*BLANK    #1SWCR           Swift common re
     C                     MOVEL*BLANK    #RASCD           Associated Cust
     C                     MOVEL*BLANK    #1BKCD           Book Code
     C                     Z-ADD*ZERO     #1SPFC           Spread Factor
     C                     MOVEL*BLANK    #1RVDI           Reverse/Void In
     C                     MOVEL*BLANK    #1RINO           Retail ind.: Ov
     C                     MOVEL*BLANK    #1BCBH           Branch Code (Ba
     C                     MOVEL*BLANK    #1RADP           Retail advice p
     C                     MOVEL*BLANK    #1SHPI           Shadow post ind
     C                     Z-ADD*ZERO     #1RRNM           Relative rec no
     C                     MOVEL*BLANK    #1RNBE           Retail Number E
     C                     MOVEL*BLANK    #1RARC           Retail Ac Refer
     C                     MOVEL*BLANK    #RACID           Account Identif
     C                     MOVEL*BLANK    #1CYCD           Currency code
     C                     MOVEL*BLANK    #1ACCD           Account code
     C                     MOVEL*BLANK    #1ACSN           Account sequenc
     C                     MOVEL*BLANK    #1IBCA           Input Branch Co
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     MOVEL*BLANK    #1DCIN           Debit/credit in
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVEL*BLANK    #RKCNB           Spread details
     C                     MOVEL*BLANK    #1PRCN           Profit centre
     C                     MOVEL*BLANK    #RVDDS           Value date (dis
     C                     MOVEL*BLANK    #RIEMG           Item error mess
     C/COPY WNCPYSRC,GL0182MC17
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @BTREAL fields to subfile
      *================================================================
     C                     MOVELBTBTNB    #1BTNB           Batch number
     C                     Z-ADDBTBINB    #1BINB           Batch item no.
     C                     MOVELBTCUST    #1CUST           Customer number
     C                     MOVELBTNNBI    #1NNBI           Nostro number (
     C                     Z-ADDBTRACN    #1RACN           Retail account
     C                     Z-ADDBTPTAM    #1PTAM           Posting amount
     C                     MOVELBTRINE    #1RINE           Retail ind.: Er
     C                     Z-ADDBTPTDT    #1PTDT           Posting date
     C                     MOVELBTNVCD    #1NVCD           Narrative code
     C                     MOVELBTNRDC    #1NRDC           Narrative descr
     C                     MOVELBTACTY    #1ACTY           Account type
     C                     MOVELBTTRTY    #1TRTY           Transaction typ
     C                     MOVELBTTSTY    #1TSTY           Transaction (Su
     C                     MOVELBTCQNB    #1CQNB           Cheque number
     C                     Z-ADDBTVLDT    #1VLDT           Value date
     C                     MOVELBTACNB    #1ACNB           Assoc. Customer
     C                     MOVELBTCOIN    #1COIN           Customer origin
     C                     MOVELBTSWCR    #1SWCR           Swift common re
     C                     MOVELBTBKCD    #1BKCD           Book Code
     C                     Z-ADDBTSPFC    #1SPFC           Spread Factor
     C                     MOVELBTRVDI    #1RVDI           Reverse/Void In
     C                     MOVELBTRINO    #1RINO           Retail ind.: Ov
     C                     MOVELBTBCBH    #1BCBH           Branch Code (Ba
     C                     MOVELBTRADP    #1RADP           Retail advice p
     C                     MOVELBTSHPI    #1SHPI           Shadow post ind
     C                     Z-ADDBTRRNM    #1RRNM           Relative rec no
     C                     MOVELBTRNBE    #1RNBE           Retail Number E
     C                     MOVELBTRARC    #1RARC           Retail Ac Refer
     C                     MOVELBTCYCD    #1CYCD           Currency code
     C                     MOVELBTACCD    #1ACCD           Account code
     C                     MOVELBTACSN    #1ACSN           Account sequenc
     C                     MOVELBTIBCA    #1IBCA           Input Branch Co
     C                     MOVELBTDCIN    #1DCIN           Debit/credit in
     C                     MOVELBTPRCN    #1PRCN           Profit centre
      * Hold current record image for change detection
     C                     MOVEL@1DBRC    #1DBRC
     C/COPY WNCPYSRC,GL0182MC18
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         MEIZ#2    BEGSR
      *================================================================
      * Initialise subfile control
      *================================================================
     C                     MOVELP1BTNB    #2BTNB           Batch number
     C                     Z-ADD*ZERO     #2BINB           Batch item no.
      * Check restriction within
     C                     EXSR VACKRL
      *================================================================
     CSR         MEEXIT    ENDSR
      /EJECT
     CSR         SACHRC    BEGSR
      *================================================================
      * Chg Spread Jrnl Postings - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * USER: Processing before DBF read
      * CASE: WRK.Abbreviated Posting? is Yes
     C           WUABPS    IFEQ 'Y'                        *IF
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL*BLANK    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0039           Account Identif
     C                     MOVEL#1CYCD    ZA0040           Currency code
     C                     MOVEL#1ACCD    ZA0041           Account code
     C                     MOVEL#1ACSN    ZA0042           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     34    *
      *
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
      * Was posting Retail? - Journal Entry Posting  *
     C                     EXSR SBRVGN
      * CASE: WRK.Account type is Retail
     C           WUACTY    IFEQ 'R'                        *IF
      * Setup message data for message
     C                     MOVELWUACID    ZA0043           Account Identif
     C                     MOVEL#1CYCD    ZA0044           Currency code
     C                     MOVEL#1ACCD    ZA0045           Account code
     C                     MOVEL#1ACSN    ZA0046           Account sequenc
      * Send message 'Retail not valid for abrv'
     C                     MOVEL'GLX0118' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     983233*
     C                     SETON                     34    *
      *
     C                     GOTO SAEXIT                     *QUIT
     C                     END                             *FI
     C                     END                             *FI
      * Move key fields to @BTREAK
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
      *
     C           KLCHSA    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
     C           KLCHSA    CHAIN@BTREAK              9091  *
      *
     C           *IN90     IFEQ '1'
      * Record not found
     C                     MOVEL'Y2U0009' W0RTN   7
      * Send message '*Record no longer on file'
     C                     MOVEL'Y2U0009' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
     C                     GOTO SAEXIT
     C                     END
      *
     C           *IN91     IFEQ '1'
      * Record locked
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     GOTO SAEXIT
     C                     END
      *
     C/COPY WNCPYSRC,GL0182MC19
      * Check for changed record
     C           #1DBRC    IFNE @1DBRC                     IF
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0182MBD1                                           S01408
     C*                                                                   S01408
     C                     MOVEL'Y2U0007' W0RTN   7
      * Send message '*Update not accepted'
     C                     MOVEL'Y2U0007' ZAMSID
     C                     MOVEL'Y2USRMSG'ZAMSGF
     C                     EXSR ZASNMS
      * Use SETLL to release record lock
     C           KLCHSA    SETLL@BTREAK              9091  *
     C/COPY WNCPYSRC,GL0182MC20
     C                     GOTO SAEXIT
     C                     END                             FI #1DBRC
      * Move non-key fields to @BTREAK
     C                     MOVEL#1IBCA    BTIBCA           Input Branch Co
     C                     MOVEL#1CUST    BTCUST           Customer number
     C                     MOVEL#1CYCD    BTCYCD           Currency code
     C                     MOVEL#1ACCD    BTACCD           Account code
     C                     MOVEL#1ACSN    BTACSN           Account sequenc
     C                     MOVEL#1NNBI    BTNNBI           Nostro number (
     C                     Z-ADD#1RACN    BTRACN           Retail account
     C                     MOVEL#1RINO    BTRINO           Retail ind.: Ov
     C                     MOVEL#1RINE    BTRINE           Retail ind.: Er
     C                     MOVEL#1TRTY    BTTRTY           Transaction typ
     C                     Z-ADD#1PTAM    BTPTAM           Posting amount
     C                     MOVEL#1DCIN    BTDCIN           Debit/credit in
     C                     Z-ADD#1PTDT    BTPTDT           Posting date
     C                     Z-ADD#1VLDT    BTVLDT           Value date
     C                     MOVEL#1NVCD    BTNVCD           Narrative code
     C                     MOVEL#1NRDC    BTNRDC           Narrative descr
     C/COPY WNCPYSRC,GL0182MC21
     C                     MOVEL#1ACTY    BTACTY           Account type
     C                     MOVEL#1ACNB    BTACNB           Assoc. Customer
     C                     MOVEL#1CQNB    BTCQNB           Cheque number
     C                     MOVEL#1COIN    BTCOIN           Customer origin
     C                     MOVEL#1SWCR    BTSWCR           Swift common re
     C                     MOVEL#1PRCN    BTPRCN           Profit centre
     C                     MOVEL#1BCBH    BTBCBH           Branch Code (Ba
     C                     MOVEL#1RADP    BTRADP           Retail advice p
     C                     MOVEL#1SHPI    BTSHPI           Shadow post ind
     C                     Z-ADD#1RRNM    BTRRNM           Relative rec no
     C                     MOVEL#1RNBE    BTRNBE           Retail Number E
     C                     MOVEL#1RARC    BTRARC           Retail Ac Refer
     C                     MOVEL#1TSTY    BTTSTY           Transaction (Su
     C                     MOVEL#1BKCD    BTBKCD           Book Code
     C                     Z-ADD#1SPFC    BTSPFC           Spread Factor
     C                     MOVEL#1RVDI    BTRVDI           Reverse/Void In
      *
      * USER: Processing before DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0182MBDU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0182MBDU
     C*
     C                     END                             *FI
     C                     UPDAT@BTREAK                91  *
     C/COPY WNCPYSRC,GL0182MC22
     C           *IN91     IFEQ '1'
      * Change error detected
     C                     MOVEL'Y2U0004' W0RTN   7
     C                     ELSE
      * DBF change successful
      * Update saved record image
     C                     MOVEL@1DBRC    #1DBRC
      * USER: Processing after DBF update
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0182MADU - Journal Entry Posting  *
     C*
     C/COPY WNCPYSRC,GL0182MADU
     C*
     C                     END                             *FI
     C                     END
      *================================================================
     CSR         SAEXIT    ENDSR
      /EJECT
     CSR         SBRVGN    BEGSR
      *================================================================
      * Was posting Retail? - Journal Entry Posting  *
      *================================================================
     C                     MOVEL*BLANK    W0RTN   7
      * Define keylist
     C           KRSSB     KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      * Move fields to key list
     C                     MOVEL#1BTNB    BTBTNB           Batch number
     C                     Z-ADD#1BINB    BTBINB           Batch item no.
     C           KRSSB     CHAIN@BTREAL              90    *
     C/COPY WNCPYSRC,GL0182MC23
      * DBF record not found
     C   90                MOVEL'GLX0176' W0RTN   7
     C           *IN90     IFEQ '0'
      * USER: Process DBF record
      * PAR = DB1 By name
     C                     MOVELBTACTY    WUACTY           Account type
     C                     END
      *================================================================
     CSR         SBEXIT    ENDSR
      /EJECT                                                              CGL002
     CSR         SRGLOV    BEGSR                                          CGL002
      *================================================================   CGL002
      **  Check Overrideable GL Errors                                    CGL002
      *================================================================   CGL002
      *                                                                   CGL002
      **  Initialise work fields                                          CGL002
      *                                                                   CGL002
     C                     MOVELWURETB    URRETI                          CGL002
     C                     MOVEL#1DCIN    URIND   1                       CGL002
     C                     MOVEL'NNNNNNNN'WURARC                          CGL002
     C                     MOVE 'NN'      WURARC                          CGL002
      *                                                                   CGL002
      **  Check GL Account Status                                         CGL002
      *                                                                   CGL002
     C                     EXSR SRGLST                                    CGL002
     C                     MOVELURERST    #RIEST                          CGL002
     C                     MOVELURERTX    #RIEMG                          CGL002
      *                                                                   CGL002
      **  Determine Item Error State...                                   CGL002
     C                     SELEC                                          CGL002
      *                                                                   CGL002
      **  ...Errors in Item, send message 'Can't Override GL A/c Error'   CGL002
      *                                                                   CGL002
     C           #RIEST    WHEQ 'E'                                       CGL002
     C                     MOVEL'Y'       #1RINE                          CGL002
     C                     MOVEL'N'       #1RINO                          CGL002
     C                     MOVEL#RACID    ZA0047                          CGL002
     C                     MOVEL#1CYCD    ZA0048                          CGL002
     C                     MOVEL#1ACCD    ZA0049                          CGL002
     C                     MOVEL#1ACSN    ZA0050                          CGL002
     C                     MOVEL'GLX0395' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     983132               CGL002
     C                     SETON                     3334                 CGL002
      *                                                                   CGL002
      **  ...Overridable Errors                                           CGL002
      *                                                                   CGL002
     C           #RIEST    WHEQ 'O'                                       CGL002
     C                     MOVEL'Y'       #1RINE                          CGL002
      *                                                                   CGL002
     C           #1RINO    IFNE 'Y'                                       CGL002
     C           #1RINO    ANDNE'N'                                       CGL002
      *                                                                   CGL002
      **  Override indicator is *Blank, send message 'GL A/c              CGL002
      **  Error Requires Override'                                        CGL002
     C           #1RINO    IFEQ *BLANK                                    CGL002
     C                     MOVEL#1RINO    ZA0051                          CGL002
     C                     MOVEL'GLX0141' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     9840                 CGL002
      *                                                                   CGL002
      **  Else, send message 'GL A/c Override Invalid'                    CGL002
     C                     ELSE                                           CGL002
     C                     MOVEL#1RINO    ZA0052                          CGL002
     C                     MOVEL'GLX0214' ZAMSID                          CGL002
     C                     EXSR ZASNMS                                    CGL002
     C                     SETON                     9840                 CGL002
     C                     ENDIF                                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  ...No errors in Item                                            CGL002
      *                                                                   CGL002
     C           #RIEST    WHEQ *BLANK                                    CGL002
     C                     MOVEL'N'       #1RINE                          CGL002
     C                     MOVEL*BLANK    #1RINO                          CGL002
      *                                                                   CGL002
     C                     ENDSL                                          CGL002
      *                                                                   CGL002
      *================================================================   CGL002
     CSR                   ENDSR                                          CGL002
      /EJECT                                                              CGL002
     CSR         SRGLST    BEGSR                                          CGL002
      *================================================================   CGL002
      **  Check GL Account Status                                         CGL002
      *================================================================   CGL002
      *                                                                   CGL002
     C                     MOVE *IN90     URSI90  1                       CGL002
     C                     MOVE *IN91     URSI91  1                       CGL002
     C                     MOVE *BLANK    URIESL                          CGL002
     C                     MOVE *BLANK    URERST  1                       CGL002
     C                     Z-ADD1         U1      30                      CGL002
     C                     SETOF                     91                   CGL002
      *                                                                   CGL002
      **  Determine if user is authorised to perform GL Account           CGL002
      **  Overrides in all cases                                          CGL002
      *                                                                   CGL002
     C                     CALL 'ZVACTBU'              90                 CGL002
     C                     PARM 'O'       WQ0016  1                       CGL002
     C                     PARM #1IBCA    WQ0017  3                       CGL002
     C           WUSPEC    PARM *ZERO     WQ0018  10                      CGL002
      *                                                                   CGL002
      **  Call to program ended in error                                  CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C                     MOVEL'Y2U0021' W0RTN   7                       CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Error Condition                                           CGL002
     C           WUSPEC    IFEQ 0                                         CGL002
     C                     MOVE 'Y'       WUAUTH  1                       CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'N'       WUAUTH                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Refer Debits:                                             CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'D'                                       CGL002
     C                     TESTB'0'       URRETI  1      90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE01    IFNE 'Y'                                       CGL002
     C           CGL002    OREQ 'Y'                                                         MD038989
     C           WUACTY    ANDEQ'G'                                                         MD038989
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Refer Dr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSRD                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Refer Credits:                                            CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'C'                                       CGL002
     C                     TESTB'1'       URRETI         90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE02    IFNE 'Y'                                       CGL002
     C           CGL002    OREQ 'Y'                                                         MD038989
     C           WUACTY    ANDEQ'G'                                                         MD038989
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Refer Cr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSRC                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Block Debits:                                             CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'D'                                       CGL002
     C                     TESTB'2'       URRETI         90               CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE03    IFNE 'Y'                                       CGL002
     C           CGL002    OREQ 'Y'                                                         MD038989
     C           WUACTY    ANDEQ'G'                                                         MD038989
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Block Dr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSBD                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Check Block Credits:                                            CGL002
      *                                                                   CGL002
     C           URIND     IFEQ 'C'                                       CGL002
      *                                                                   CGL002
      **  If Bit set and no overrides allowed for unauthorised users,     CGL002
      **  send error message                                              CGL002
      *                                                                   CGL002
     C                     TESTB'3'       URRETI         90               CGL002
      *                                                                   CGL002
     C           *IN90     IFEQ '1'                                       CGL002
     C           URRE04    IFNE 'Y'                                       CGL002
     C           CGL002    OREQ 'Y'                                                         MD038989
     C           WUACTY    ANDEQ'G'                                                         MD038989
     C           WUAUTH    ANDNE'Y'                                       CGL002
     C                     MOVELURRIHF    @IH,U1                          CGL002
     C                     SETON                     91                   CGL002
     C                     ELSE                                           CGL002
     C                     MOVELURRIHS    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE 'Block Cr'@IH,U1                          CGL002
     C                     ADD  1         U1                              CGL002
     C                     MOVE 'Y'       WURSBC                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  If there are any errors, setup non-overrideable error status    CGL002
      *                                                                   CGL002
     C           U1        IFGT 1                                         CGL002
     C           U1        IFLT 5                                         CGL002
     C                     MOVELURNORM    @IH,U1                          CGL002
     C                     ENDIF                                          CGL002
     C                     MOVE URERMG    URERTX 76                       CGL002
     C           *IN91     IFEQ '1'                                       CGL002
     C                     MOVE 'E'       URERST                          CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'O'       URERST                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      **  Else, no errors found                                           CGL002
     C                     ELSE                                           CGL002
     C                     MOVE *BLANK    URERST                          CGL002
     C                     MOVE *BLANK    URERTX                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
     C                     MOVE URSI90    *IN90                           CGL002
     C                     MOVE URSI91    *IN91                           CGL002
      *                                                                   CGL002
      *================================================================   CGL002
     CSR                   ENDSR                                          CGL002
      /EJECT
     CSR         UASUBR    BEGSR
      *================================================================
      * Check condition for Output of Spread Factor & P.Centre
      *================================================================
      * CASE: RCD.Spread Factor is not zero
     C           #1SPFC    IFNE *ZERO                      *IF
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#1SPFC    WUZASF           ZALIGN Screen F
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0001  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0002 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0003  10       ZALIGN No Of De
     C                     PARM 8         WQ0004  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0005 16        ZALIGN File Fie
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0006 16        ZALIGN Screen F
     C                     PARM *ZERO     WQ0007  10       ZALIGN No Of De
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
      *                                                                   067764
     C                     ELSE                                           067764
     C                     MOVE WUZASF    #RKCNB                          067764
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * Zalign Spread Factor - Journal Entry Posting  *
     E* Y2V3114 - Source member  not found.
     C                     END                             *FI
      * CASE: PAR.Spread Profile Code used is No
     C           P8SPCU    IFEQ 'N'                        *IF
      * CASE: RCD.Batch item no. is first
     C           #1BINB    IFEQ 1                          *IF
     C                     MOVEL'Y'       WUOUTP           Output
     C                     MOVEL#1PRCN    WUGNCD           Save profit cen
     C                     Z-ADD#1SPFC    WUKDNB           Save Spread Fac
     C                     Z-ADD#1PTAM    WUKHNB           save Posting Am
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUOUTP           Output
      * Move Spread Factors To Saved Work fields
     C                     EXSR UBSUBR                     Move Spread Fac
     C                     END                             *FI
     C                     ELSE
      * CASE: PAR.Spread Profile Code used is Yes
     C           P8SPCU    IFEQ 'Y'                        *IF
     C                     MOVEL'Y'       WUOUTP           Output
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UAEXIT    ENDSR
      /EJECT
     CSR         UBSUBR    BEGSR
      *================================================================
      * Move Spread Factors To Saved Work fields
      *================================================================
      * CASE: RCD.Batch item no. is 2nd
     C           #1BINB    IFEQ 2                          *IF
     C                     Z-ADD#1SPFC    WUKNNB           Spread factor 2
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 3rd
     C           #1BINB    IFEQ 3                          *IF
     C                     Z-ADD#1SPFC    WUKONB           Spread factor 3
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 4th
     C           #1BINB    IFEQ 4                          *IF
     C                     Z-ADD#1SPFC    WUKPNB           spread factor 4
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 5th
     C           #1BINB    IFEQ 5                          *IF
     C                     Z-ADD#1SPFC    WUKQNB           spread factor 5
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 6th
     C           #1BINB    IFEQ 6                          *IF
     C                     Z-ADD#1SPFC    WUKRNB           spread factor 6
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 7th
     C           #1BINB    IFEQ 7                          *IF
     C                     Z-ADD#1SPFC    WUKSNB           spread factor 7
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 8th
     C           #1BINB    IFEQ 8                          *IF
     C                     Z-ADD#1SPFC    WUKTNB           spread factor 8
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 9th
     C           #1BINB    IFEQ 9                          *IF
     C                     Z-ADD#1SPFC    WUKUNB           spread factor 9
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 10th
     C           #1BINB    IFEQ 10                         *IF
     C                     Z-ADD#1SPFC    WUKVNB           spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 11th
     C           #1BINB    IFEQ 11                         *IF
     C                     Z-ADD#1SPFC    WUKWNB           Spread Factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 12th
     C           #1BINB    IFEQ 12                         *IF
     C                     Z-ADD#1SPFC    WUKXNB           Spread Factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 13th
     C           #1BINB    IFEQ 13                         *IF
     C                     Z-ADD#1SPFC    WUKYNB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 14th
     C           #1BINB    IFEQ 14                         *IF
     C                     Z-ADD#1SPFC    WUKZNB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 15th
     C           #1BINB    IFEQ 15                         *IF
     C                     Z-ADD#1SPFC    WUK0NB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 16th
     C           #1BINB    IFEQ 16                         *IF
     C                     Z-ADD#1SPFC    WUK1NB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 17th
     C           #1BINB    IFEQ 17                         *IF
     C                     Z-ADD#1SPFC    WUK2NB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 18th
     C           #1BINB    IFEQ 18                         *IF
     C                     Z-ADD#1SPFC    WUK3NB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 19th
     C           #1BINB    IFEQ 19                         *IF
     C                     Z-ADD#1SPFC    WUK4NB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 20th
     C           #1BINB    IFEQ 20                         *IF
     C                     Z-ADD#1SPFC    WUK5NB           Spread factor 2
     C                     END                             *FI
      *================================================================
     CSR         UBEXIT    ENDSR
      /EJECT
     CSR         UCSUBR    BEGSR
      *================================================================
      * Check output condition for Branch field
      *================================================================
      * CASE: PAR.Multiple Branch Batch is No
     C           P6MBRB    IFEQ 'N'                        *IF
     C                     MOVEL'Y'       WULGST           Output Branch
     C                     END                             *FI
      * CASE: PAR.Spread Profile Code used is Yes
     C           P8SPCU    IFEQ 'Y'                        *IF
     C                     MOVEL'Y'       WULGST           Output Branch
     C                     END                             *FI
      *================================================================
     CSR         UCEXIT    ENDSR
      /EJECT
     CSR         UDSUBR    BEGSR
      *================================================================
      * Format Value Date & move to Work Fields
      *================================================================
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL*BLANK    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * CASE: WRK.Access Pgm Return Code is *No Errors
     C           WUAPRC    IFEQ *BLANK                     *IF
      *                                                                                       CGL148
      ** If account NOT found and CGL148 is on,                                               CGL148
      ** convert the Midas day number for value date                                          CGL148
      *                                                                                       CGL148
     C           WUAPRC    OREQ '*NRF'                                                        CGL148
     C           CGL148    ANDEQ'Y'                                                           CGL148
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM BTVLDT    WQ0008  50       Runday Number
     C                     PARM WUDTFF    WQ0009  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0010  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0011  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    #RVDDS
     C                     END                             *FI
      * Move Value Dates To Saved Work fields
     C                     EXSR UESUBR                     Move Value Date
      *================================================================
     CSR         UDEXIT    ENDSR
      /EJECT
     CSR         UESUBR    BEGSR
      *================================================================
      * Move Value Dates To Saved Work fields
      *================================================================
      * CASE: RCD.Batch item no. is 1st
     C           #1BINB    IFEQ 1                          *IF
     C                     MOVEL#RVDDS    WUD2TX           Value date 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 2nd
     C           #1BINB    IFEQ 2                          *IF
     C                     MOVEL#RVDDS    WUDJTX           Value date 2
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 3rd
     C           #1BINB    IFEQ 3                          *IF
     C                     MOVEL#RVDDS    WUDKTX           Value date 3
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 4th
     C           #1BINB    IFEQ 4                          *IF
     C                     MOVEL#RVDDS    WUDLTX           Value date 4
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 5th
     C           #1BINB    IFEQ 5                          *IF
     C                     MOVEL#RVDDS    WUDMTX           Value date 5
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 6th
     C           #1BINB    IFEQ 6                          *IF
     C                     MOVEL#RVDDS    WUDNTX           Value date 6
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 7th
     C           #1BINB    IFEQ 7                          *IF
     C                     MOVEL#RVDDS    WUDOTX           Value date 7
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 8th
     C           #1BINB    IFEQ 8                          *IF
     C                     MOVEL#RVDDS    WUDPTX           Value date 8
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 9th
     C           #1BINB    IFEQ 9                          *IF
     C                     MOVEL#RVDDS    WUDQTX           Value date 9
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 10th
     C           #1BINB    IFEQ 10                         *IF
     C                     MOVEL#RVDDS    WUDRTX           Value date 10
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 11th
     C           #1BINB    IFEQ 11                         *IF
     C                     MOVEL#RVDDS    WUDSTX           Value date 11
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 12th
     C           #1BINB    IFEQ 12                         *IF
     C                     MOVEL#RVDDS    WUDTTX           Value date 12
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 13th
     C           #1BINB    IFEQ 13                         *IF
     C                     MOVEL#RVDDS    WUDUTX           Value date 13
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 14th
     C           #1BINB    IFEQ 14                         *IF
     C                     MOVEL#RVDDS    WUDVTX           Value date 14
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 15th
     C           #1BINB    IFEQ 15                         *IF
     C                     MOVEL#RVDDS    WUDWTX           Value date 15
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 16th
     C           #1BINB    IFEQ 16                         *IF
     C                     MOVEL#RVDDS    WUDXTX           Value date 16
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 17th
     C           #1BINB    IFEQ 17                         *IF
     C                     MOVEL#RVDDS    WUDYTX           Value date 17
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 18th
     C           #1BINB    IFEQ 18                         *IF
     C                     MOVEL#RVDDS    WUDZTX           Value date 18
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 19th
     C           #1BINB    IFEQ 19                         *IF
     C                     MOVEL#RVDDS    WUD0TX           Value date 19
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 20th
     C           #1BINB    IFEQ 20                         *IF
     C                     MOVEL#RVDDS    WUD1TX           Value date 20
     C                     END                             *FI
      *================================================================
     CSR         UEEXIT    ENDSR
      /EJECT
     CSR         UFSUBR    BEGSR
      *================================================================
      * Calculate Total Spread Factors
      *================================================================
     C                     Z-ADD*ZERO     WUKGNB           Total Spread Fa
     C                     ADD  WUKNNB    WUKGNB           Total Spread Fa
     C                     ADD  WUKONB    WUKGNB           Total Spread Fa
     C                     ADD  WUKPNB    WUKGNB           Total Spread Fa
     C                     ADD  WUKQNB    WUKGNB           Total Spread Fa
     C                     ADD  WUKRNB    WUKGNB           Total Spread Fa
     C                     ADD  WUKSNB    WUKGNB           Total Spread Fa
     C                     ADD  WUKTNB    WUKGNB           Total Spread Fa
     C                     ADD  WUKUNB    WUKGNB           Total Spread Fa
     C                     ADD  WUKVNB    WUKGNB           Total Spread Fa
     C                     ADD  WUKWNB    WUKGNB           Total Spread Fa
     C                     ADD  WUKXNB    WUKGNB           Total Spread Fa
     C                     ADD  WUKYNB    WUKGNB           Total Spread Fa
     C                     ADD  WUKZNB    WUKGNB           Total Spread Fa
     C                     ADD  WUK0NB    WUKGNB           Total Spread Fa
     C                     ADD  WUK1NB    WUKGNB           Total Spread Fa
     C                     ADD  WUK2NB    WUKGNB           Total Spread Fa
     C                     ADD  WUK3NB    WUKGNB           Total Spread Fa
     C                     ADD  WUK4NB    WUKGNB           Total Spread Fa
     C                     ADD  WUK5NB    WUKGNB           Total Spread Fa
      *================================================================
     CSR         UFEXIT    ENDSR
      /EJECT
     CSR         UGSUBR    BEGSR
      *================================================================
      * Calculate posting amounts for TO postings
      *================================================================
      * Calc. Posting Amts - Standard functions  *
      *
      **  Read First posting record for batch
      *
     C                     MOVELP1BTNB    BTBTNB           Batch number
     C                     Z-ADD1         BTBINB           Batch item no.
      *
     C           KLCHSE    KLIST
     C                     KFLD           BTBTNB           Batch number
     C                     KFLD           BTBINB           Batch item no.
      *
     C                     Z-ADD0         WUKINB
      *
     C           KLCHSE    SETLL@BTREAK
     C                     READ @BTREAK                  90
      *
      **  Save Spread Total amount ie 1st record's posting amount
      *
     C           BTBINB    IFEQ 1
     C                     Z-ADDBTPTAM    WUKHNB
     C                     Z-ADDBTSPFC    WUKDNB
     C                     END
      *
     C                     READ @BTREAK                  90
     C           *IN90     IFEQ '0'
      *
      **  Add posting amounts for all other records to Work Total
      *
     C           BTBTNB    DOWEQP1BTNB
     C           *IN90     ANDEQ'0'
     C           BTSPFC    DIV  WUKDNB    WUKENB  99
     C           WUKENB    MULT WUKHNB    BTPTAM    H
     C                     ADD  BTPTAM    WUKINB 130
     C                     UPDAT@BTREAK
     C                     READ @BTREAK                  90
     C                     END
      *
      **  If last posting record,
      **  Calc difference = FROM Posting amt - Total TO Posting amts
      **  Add difference to last posting amt
      *
     C           WUKHNB    SUB  WUKINB    WRKREM 130
     C           WRKREM    IFNE 0
     C                     MOVELP1BTNB    BTBTNB           Batch number
     C                     Z-ADD2         BTBINB           Batch item no.
     C           KLCHSE    SETLL@BTREAK
     C                     READ @BTREAK                  90
     C           BTPTAM    ADD  WRKREM    BTPTAM
     C                     UPDAT@BTREAK
     C                     END
     C                     END
      *================================================================
     CSR         UGEXIT    ENDSR
      /EJECT
     CSR         UHSUBR    BEGSR
      *================================================================
      * Re-set Output conditions for 1st Posting
      *================================================================
      * CASE: PAR.Spread Profile Code used is No
     C           P8SPCU    IFEQ 'N'                        *IF
      * CASE: RCD.Batch item no. is 1st
     C           #1BINB    IFEQ 1                          *IF
     C                     MOVEL'Y'       WUOUTP           Output
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WUOUTP           Output
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UHEXIT    ENDSR
      /EJECT
     CSR         UISUBR    BEGSR
      *================================================================
      * Check Account Identifier
      *================================================================
      * CASE: RCD.Account Identifier is Entered
     C           #RACID    IFNE *BLANK                     *IF
      * Determine Account type - Standard functions  *
     C                     MOVEL#RACID    UKACID           10-Char.A/C ID
     C******               EXSR UKACCK                                    E17819
     C                     EXSR XXIN                                      E17819
     C                     MOVELUKTYPE    WUAISF           Account type
     C*SR***      UKACCK    BEGSR                                         E17819
      * CASE: WRK.Account ID Status Flag is Error
     C           WUAISF    IFEQ '*ERROR*'                  *IF
      * Setup message data for message
     C                     MOVEL#RACID    ZA0001           Account Identif
      * Send message 'Account ID not valid ERR'
     C                     MOVEL'GLX0119' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9831  *
      *
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UIEXIT    ENDSR
      /EJECT
     CSR         UJSUBR    BEGSR
      *================================================================
      * SPF Branch code
      *================================================================
      * CASE: RCD.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1IBCA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     ELSE
      * CASE: *OTHERWISE
      * Val. Action Cde & Bch U/P - Standard functions  *
     C                     CALL 'ZVACTBU'              90  Val. Action Cde
     C**********           PARM 'A'       WQ0016  1        SPF Action Code                    189519
     C                     PARM P2SACD    WQ0016  1        SPF Action Code                    189519
     C                     PARM #1IBCA    WQ0017  3        Branch code
     C           WUSPEC    PARM *ZERO     WQ0018  10       SPF Error Condi
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.SPF Error Condition is One
     C           WUSPEC    IFEQ 1                          *IF
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0013           Input Branch Co
      * Send message 'SPF Atn Cde ERR 1 ZVACTBU'
     C                     MOVEL'GLX0186' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     ELSE
      * CASE: WRK.SPF Error Condition is Two
     C           WUSPEC    IFEQ 2                          *IF
      * Setup message data for message
     C**********           MOVEL'A'       ZA0014           SPF Action Code                    189519
     C                     MOVELP2SACD    ZA0030           SPF Action Code                    189519
     C                     MOVEL#1IBCA    ZA0015           Input Branch Co
      * Send message 'SPF Atn Cde ERR 5 ZVACTBU'
     C                     MOVEL'GLX0206' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0016           Input Branch Co
      * Send message 'Branch Code Required'
     C                     MOVEL'GLX0201' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     END                             *FI
      *================================================================
     CSR         UJEXIT    ENDSR
      /EJECT
     CSR         UKSUBR    BEGSR
      *================================================================
      * Check Posting amount
      *================================================================
      * Get Number of Decimal Places
      * CASE: RCD.Currency code is Not Question Mark
     C           #1CYCD    IFNE '?'                        *IF
      * Access Currency. - Currency Codes  *
     C*
     C*  Access Currency codes file for the following fields
     C*  Currency Name, Number of decimal places, Nostro Shortname
     C*
     C                     MOVEL#1CYCD    UUCYCD
     C                     CALL 'AOCURRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUCYCD  3        I:Currency Code
     C           D@CURR    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA6CYCD    WUCYCD           Currency Code
     C                     MOVELA6CYNM    WUCYNM           Currency Name
     C                     MOVELA6NBDP    WUNBDP           No. Decimal Places
     C                     MOVELA6NOSN    WUNOSN           Nostro Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     Z-ADD*ZERO     WUNBDP           Number of Decim
     C                     END                             *FI
      * Set up Number of Decimals and digits for zalign
      * CASE: WRK.Number of Decimal Places is Zero
     C           WUNBDP    IFEQ *ZERO                      *IF
     C                     Z-ADD*ZERO     WUZNDE           ZALIGN No Of De
     C***********          Z-ADD12        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD13        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is One
     C           WUNBDP    IFEQ 1                          *IF
     C                     Z-ADD1         WUZNDE           ZALIGN No Of De
     C***********          Z-ADD11        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD12        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is Two
     C           WUNBDP    IFEQ 2                          *IF
     C                     Z-ADD2         WUZNDE           ZALIGN No Of De
     C***********          Z-ADD10        WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD11        WUZNDI           ZALIGN No Of Di089856
     C                     ELSE
      * CASE: WRK.Number of Decimal Places is Three
     C           WUNBDP    IFEQ 3                          *IF
     C                     Z-ADD3         WUZNDE           ZALIGN No Of De
     C***********          Z-ADD9         WUZNDI           ZALIGN No Of Di089856
     C                     Z-ADD10        WUZNDI           ZALIGN No Of Di089856
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     MOVEL*BLANK    WUZASF           ZALIGN Screen F
     C                     MOVEL#RFMPA    WUZASF           ZALIGN Screen F
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0182MCP2                                           S01408
     C*                                                                   S01408
      * Call Zalign and Zedit
      * ZALIGN Screen Field - Standard functions  *
     C                     CALL 'ZALIGN'               90  ZALIGN Screen F
     C           W0RTN     PARM W0RTN     WQ0019  7        *Return code
     C           WUZASF    PARM WUZASF    WQ0020 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0021  10       ZALIGN No Of De
     C                     PARM WUZNDI    WQ0022  20       ZALIGN No Of Di
     C           WUZAFF    PARM *BLANK    WQ0023 16        ZALIGN File Fie
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0182MCP3                                           S01408
     C*                                                                   S01408
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: PGM.*Return code is *Normal
     C           W0RTN     IFEQ *BLANK                     *IF
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0182MCP4                                           S01408
     C*                                                                   S01408
     C                     MOVEL'0'       WUERCD           Error Code
      * ZEDIT Screen Field - Standard functions  *
     C                     CALL 'ZEDIT'                90  ZEDIT Screen Fi
     C           WUZASF    PARM WUZASF    WQ0024 16        ZALIGN Screen F
     C                     PARM WUZNDE    WQ0025  10       ZALIGN No Of De
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0182MCP3                                           S01408
     C*                                                                   S01408
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'1'       WUERCD           Error Code
     C                     END                             *FI
      * CASE: WRK.Error Code is Error Found
     C           WUERCD    IFEQ '1'                        *IF
      * Setup message data for message
     C                     MOVEL#RFMPA    ZA0017           Formatted Posti
      * Send message 'Amount not valid'
     C                     MOVEL'GLX0063' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * MOVE Posting Amount - Journal Entry Posting  *
     C*  MOVE ZALIGN FILE FIELD INTO POSTING AMOUNT
     C                     MOVE WUZAFF    #1PTAM
      * Move Fmt Posting Amount - Journal Entry Posting  *
     C*  MOVE ZALIGN FUNCTION FIELD INTO FORMATTED POSTING AMOUNT
     C                     MOVE WUZASF    #RFMPA
     C                     END                             *FI
      *================================================================
     CSR         UKEXIT    ENDSR
      /EJECT
     CSR         ULSUBR    BEGSR
      *================================================================
      * Check Narrative
      *================================================================
     C                     MOVEL*BLANK    #1NVCD           Narrative code
     C                     MOVEL*BLANK    #1NRDC           Narrative descr
      * Check Narrative - Standard functions  *
     C*  Check Narrative for Narrative code
     C*
     C                     MOVE #RNRTV    URNARR 28        Narrative slice
      *
     C           #RNRTV    IFNE *BLANK                     IF ¬BLANK
     C           URNARR    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*CODE  ' WUNRST             Code entered
     C                     MOVEL#RNRTV    #1NVCD             Narrative code
     C                     ELSE                            EL ¬BLANK
     C                     MOVE '*TEXT  ' WUNRST             Narrative text
     C                     MOVE *BLANK    #1NVCD             No Narr.code
     C                     END                             FI
     C                     ELSE                            EL BLANK
     C                     MOVE '*ERROR ' WUNRST             No narrative
     C                     MOVE *BLANK    #1NVCD             No Narr.code
     C                     END                             FI
      *
      * CASE: WRK.Narrative status is Narrative code entered
     C           WUNRST    IFEQ '*CODE'                    *IF
      * Access Narrative. - Narrative Codes  *
     C*
     C*  Access Narrative codes file for the following fields
     C*  Narrative Code, Narrative Description
     C*
     C                     MOVEL#1NVCD    UUNVCD
     C                     CALL 'AONARRR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUNVCD  2        I:Narrative Code
     C           D@NARR    PARM *BLANK    UUFDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELALNVCD    #1NVCD           Narrative Code
     C                     MOVELALDON     WUDON            Description
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#RNRTV    ZA0019           Narrative
      * Send message 'Narrative Code not found'
     C                     MOVEL'GLX0049' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RNRTV           Narrative
     C                     MOVEL#1NVCD    #RNRTV           Narrative
     C                     END                             *FI
     C                     ELSE
      * CASE: WRK.Narrative status is No narrative
     C           WUNRST    IFEQ '*ERROR'                   *IF
      * Setup message data for message
     C                     MOVEL#RNRTV    ZA0020           Narrative
      * Send message 'Narrative must be entered'
     C                     MOVEL'GLX0325' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9836  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C/COPY WNCPYSRC,GL0182MC24
     C                     MOVEL#RNRTV    #1NRDC           Narrative descr
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         ULEXIT    ENDSR
      /EJECT
     CSR         UMSUBR    BEGSR
      *================================================================
      * Check Value Date
      *================================================================
      * Validate Value date
      * CASE: RCD.Value date (display) is Date entered
     C           #RVDDS    IFNE *BLANK                     *IF
      * Check Account Number. - Standard functions  *
     C*
     C* Set up Parameters for call to AOACCTR0
     C*
     C                     MOVEL#RACID    UUACID
     C                     MOVEL#1CUST    UUCUST
     C                     MOVEL#1CYCD    UUCYCD
     C                     MOVEL#1ACCD    UUACNO
     C                     MOVEL#1ACSN    UUACSN
     C                     MOVEL#1IBCA    UUBRCD
     C*
     C*  Call to Access Program - AOACCTR0 Check Account Number
     C*  Access Account Details file for the file fields
     C*
     C                     CALL 'AOACCTR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        B:Option
     C                     PARM           UUACID 10        I:Account Identifier
     C                     PARM           UUCUST  6        I:Customer Number
     C                     PARM           UUCYCD  3        I:Currency Code
     C**********           PARM           UUACNO  4        I:Account Code Num                 CGL029
     C                     PARM           UUACNO                                              CGL029
     C                     PARM           UUACSN  2        I:Account Sequence
     C                     PARM           UUBRCD  3        I:Branch code
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELCNUM      WUCUST           Customer Number
     C                     MOVELCCY       WUCYCD           Currency Code
     C                     MOVELACOD      WUACCD           Account Code
     C                     MOVELACSQ      WUACSN           Account Sequence No.
     C                     MOVELBRCA      WUBRCD           Branch Code
     C                     MOVELATYP      WUACTY           Account Type
     C                     MOVELSTYP      WUBPST           Account Sub-Type
     C                     MOVELACST      WUACCS           Account Status
     C                     MOVELDACO      WUDACO           Date Account Opened
     C                     MOVELANAM      WUACNM           Account Name
     C                     MOVELACNO      WURACN           Retails Account Num
     C                     MOVELRRNM      WURRNM           Relative rec No Memos
     C                     MOVELRETB      WURETB           Retail Indic'trLN0315
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE #RVDDS    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0026  7        *Return code
     C                     PARM WUDTNF    WQ0027  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0028  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0029  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0021           Value date (dis
      * Send message 'Value Date not valid 2'
     C                     MOVEL'GLX0110' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#RVDDS    WUWVDD           Work Value Date
      * Check VDate Blank Entries - Standard functions  *
     C                     CALL 'GL0131U'              90  Check VDate Bla
     C           WUWVDD    PARM WUWVDD    WQ0030  6        Value date (dis
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Check Numeric - Standard functions  *
     C                     MOVE *IN20     UUIN20  1
     C                     MOVE *IN21     UUIN21  1
     C           *LIKE     DEFN WUWVDD    UUVLDT+ 1
     C                     MOVELWUWVDD    UUVLDT
     C                     MOVE '0'       UUVLDT
     C                     TESTN          UUVLDT       21
     C           *IN21     IFEQ '1'
     C                     MOVEL'0'       UUVLDT
     C                     END
     C                     TESTN          UUVLDT     20
     C           *IN20     IFEQ '0'
     C                     MOVE '*NUMERR' W0RTN
     C                     ELSE
     C                     MOVE *BLANKS   W0RTN
     C                     END
     C                     MOVE UUIN20    *IN20
     C                     MOVE UUIN21    *IN21
      * CASE: PGM.*Return code is *Numeric Error
     C           W0RTN     IFEQ '*NUMERR'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0022           Value date (dis
      * Send message 'Value Date not valid 1'
     C                     MOVEL'GLX0109' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * CASE: WRK.Date (numeric format) is Gt 30
     C           WUDTNF    IFGT 30                         *IF
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE WUWVDD    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           WUAPRC    PARM WUAPRC    WQ0031  7        *Return code
     C                     PARM WUDTNF    WQ0032  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0033  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0034  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           WUAPRC    IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0023           Value date (dis
      * Send message 'Value Date not valid 2'
     C                     MOVEL'GLX0110' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    #RVDDS           Value date (dis
      * CASE: RCD.Value date GE WRK.Runday Number
     C           #1VLDT    IFGE WURDNO                     *IF
     C                     Z-ADD30        WUNBFD           Number of Forwa
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C                     MOVELBJLCCY    WULCCY
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVELP2BCDA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * Locate Local.CCY.Fwd.Days - Standard functions  *
     C                     CALL 'SZDATE3'              90  Locate Local.CC
     C                     PARM WURDNO    WQ0035  50       Runday Number
     C                     PARM WULCCY    WQ0036  3        Local Currency
     C                     PARM WULCCD    WQ0037  3        Location Code
     C                     PARM WUNBFD    WQ0038  20       Number of Forwa
     C           WUFDNB    PARM *ZERO     WQ0039  50       Forward Day Num
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: RCD.Value date GT WRK.Forward Day Number
     C           #1VLDT    IFGT WUFDNB                     *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0024           Value date (dis
      * Send message 'Value Date not valid 3'
     C                     MOVEL'GLX0111' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     END                             *FI
      * Check Value Date NE Hol. - Standard functions  *
     C                     CALL 'GL0130U'              90  Check Value Dat
     C                     PARM #1VLDT    WQ0040  50       Value date
     C                     PARM WULCCY    WQ0041  3        Local Currency
     C                     PARM WULCCD    WQ0042  3        Location Code
     C           WUJJST    PARM *BLANK    WQ0043  1        Error Ind - Day
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * CASE: WRK.Error Ind - Day - Holiday is Record Found
     C           WUJJST    IFEQ 'H'                        *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0025           Value date (dis
      * Send message 'Value Date Not Valid 9'
     C                     MOVEL'GLX0117' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUWVDD    #RVDDS           Value date (dis
      * Access Local Currency - Standard functions  *
     C*
     C*   Access Local Currency Off Bank Details
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM           P@RTNC  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option       S01117
     C                     PARM '*FIRST'  P@OPTN  7        I:Option       S01117
     C*********************PARM 'BANK'    P@BYCD 10        I:Key field    S01117
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C                     MOVELBJLCCY    WULCCY
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVELP2BCDA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE #RVDDS    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Locate Local.CCY.Fwd.Days - Standard functions  *
     C                     CALL 'SZDATE3'              90  Locate Local.CC
     C                     PARM WURDNO    WQ0044  50       Runday Number
     C                     PARM WULCCY    WQ0045  3        Local Currency
     C                     PARM WULCCD    WQ0046  3        Location Code
     C                     PARM WUNBFD    WQ0047  20       Number of Forwa
     C           WUFDNB    PARM *ZERO     WQ0048  50       Forward Day Num
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Midas Conv. Day to Date - Standard functions  *
     C                     CALL 'ZDATE2'               90  Midas Conv. Day
     C                     PARM WUFDNB    WQ0049  50       Runday Number
     C                     PARM WUDTFF    WQ0050  1        Date Format fla
     C           WUDTNF    PARM *ZERO     WQ0051  60       Date (numeric f
     C           WUDDCD    PARM *BLANK    WQ0052  7        Midas Run Date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Copy Num to VDate Display - Standard functions  *
     C*
     C                     Z-ADDWUDTNF    UUDNMA
     C                     MOVE UUDNMA    #RVDDS
     C                     END                             *FI
      * Copy VDate Display To Num - Standard functions  *
     C*
     C                     MOVE *BLANK    UUDNUM                          LN0402
     C                     MOVE #RVDDS    UUDNUM
     C                     Z-ADDUUDNUM    WUDTNF
      * Midas Conv. Date to Day - Standard functions  *
     C                     CALL 'ZDATE1'               90  Midas Conv. Dat
     C           W0RTN     PARM W0RTN     WQ0053  7        *Return code
     C                     PARM WUDTNF    WQ0054  60       Date (numeric f
     C           WUDTFF    PARM WUDTFF    WQ0055  1        Date Format fla
     C           #1VLDT    PARM *ZERO     WQ0056  50       Value date
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
      * Error detected?
     C           W0RTN     IFNE *BLANK
     C                     SETON                     98    *
     C                     END
      * CASE: WRK.Access Pgm Return Code is Date Conversion Error
     C           WUAPRC    IFEQ '*FORMAT'                  *IF
     C           WUAPRC    OREQ '*DAY'
     C           WUAPRC    OREQ '*LEAP'
     C           WUAPRC    OREQ '*MONTH'
     C           WUAPRC    OREQ '*ERROR*'
      * Invalid Date - No further validation required
     C                     ELSE
      * CASE: *OTHERWISE
      * Value Date A/c Validation - Standard functions  *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANK    P@RTCD  7        B:Return code
     C*********************PARM '*KEY'    P@OPTN  7        I:Option
     C                     PARM '*FIRST'  P@OPTN  7        I:Option
     C           P@BJRF    PARM *BLANK    UUFDY            O:Format
     C*
     C* Set Retail Key = Numeric Retail Account Number
     C                     MOVEL#1RACN    P@RETK 10
     C*
     C                     CALL 'AOACCTR0'
     C                     PARM *BLANK    P@RTCD  7        B:Return code
     C                     PARM '*KEY'    P@OPTN  7        I:Option
     C*********************PARM #IRACN    P@RETK 10        I:Key field
     C                     PARM           P@RETK           I:Key field
     C                     PARM #1CUST    P@CNUM  6        I:Key field
     C                     PARM #1CYCD    P@CCY   3        I:Key field
     C**********           PARM #1ACCD    P@ACOD  4        I:Key field                        CGL029
     C                     PARM #1ACCD    P@ACOD 10        I:Key field                        CGL029
     C                     PARM #1ACSN    P@ACSQ  2        I:Key field
     C                     PARM #1IBCA    P@IBCA  3        I:Key Field
     C           D@ACCT    PARM *BLANK    UUSDY            O:Format
     C*
     C* EXTRACT BACK VALUEING PERIOD & CALCULATE BACK VALUE DATE
     C*
     C           WURDNO    SUB  BJBVPD    UUBRUN  50
     C*
     C* SAVE INDICATORS
     C*
     C                     MOVE *IN33     UUIN33  10
     C                     MOVE *IN64     UUIN64  10
     C                     MOVE *IN69     UUIN69  10
     C*
     C                     SETOF                     336469
     C*
     C** DR/CR INT.BEARING
     C*
     C***********AADRIF****IFEQ ' '                         IF 1          S01117
     C           DRIF      IFEQ ' '                         IF 1          S01117
     C***********AACRIF****ANDEQ' '                                       S01117
     C           CRIF      ANDEQ' '                                       S01117
     C***********AALDID****COMP AALCID               64                   S01117
     C           LDID      COMP LCID                 64                   S01117
     C***64******UUBRUN****COMP AALDID                 69                 S01117
     C   64      UUBRUN    COMP LDID                   69                 S01117
     C**N64******UUBRUN****COMP AALCID                 69                 S01117
     C  N64      UUBRUN    COMP LCID                   69                 S01117
     C*
     C   69      #1VLDT    COMP UUBRUN                 33
     C***64N69***#1VLDT****COMP AALDID                 3333               S01117
     C   64N69   #1VLDT    COMP LDID                   3333               S01117
     C**N64N69***#1VLDT****COMP AALCID                 3333               S01117
     C  N64N69   #1VLDT    COMP LCID                   3333               S01117
     C   33                MOVE '*DRCRER' W0RTN
     C                     ELSE                              ELSE 1
     C*
     C** CR INT BEARING ONLY
     C*
     C***********AADRIF****IFEQ ' '                          IF 2         S01117
     C           DRIF      IFEQ ' '                          IF 2         S01117
     C***********AALCID****COMP UUBRUN               64                   S01117
     C           LCID      COMP UUBRUN               64                   S01117
     C      64   #1VLDT    COMP UUBRUN                 33
     C*****N64***#1VLDT****COMP AALCID                 3333               S01117
     C     N64   #1VLDT    COMP LCID                   3333               S01117
     C   33                MOVE '*DTCRER' W0RTN
     C                     ELSE                              ELSE 2
     C*
     C** DR INT.BEARING ONLY
     C*
     C***********AACRIF****IFEQ ' '                          IF 3         S01117
     C           CRIF      IFEQ ' '                          IF 3         S01117
     C***********AALDID****COMP UUBRUN               64                   S01117
     C           LDID      COMP UUBRUN               64                   S01117
     C      64   #1VLDT    COMP UUBRUN                 33
     C*****N64***#1VLDT****COMP AALDID                 3333               S01117
     C     N64   #1VLDT    COMP LDID                   3333               S01117
     C   33                MOVE '*DTDRER' W0RTN
     C                     ELSE                              ELSE 3
     C*
     C**   NOT INT.BEARING
     C*
     C           #1VLDT    COMP UUBRUN                 33
     C   33                MOVE '*BVLDER' W0RTN
     C                     END                               END 3
     C                     END                               END 2
     C                     END                               END 1
      *                                                                                  MD024246
      ** If CGL148 is on and Rundate <> Value date, OR                                   MD024246
      **    CGL148 is not On:                                                            MD024246
      ** Test the date account opened                                                    MD024246
      *                                                                                  MD024246
     C           WURDNO    IFNE #1VLDT                                                   MD024246
     C           CGL148    ANDEQ'Y'                                                      MD024246
     C           CGL148    ORNE 'Y'                                                      MD024246
     C*
     C**   CHECK AGAINST DATE THE ACCOUNT WAS OPENED
     C*
     C           DACO      IFGT #1VLDT                       IF 1
     C                     MOVE '*DTOPER' W0RTN
     C                     END                               END 1
     C                     ENDIF                                                         MD024246
     C*
     C* RESTORE INDICATORS
     C*
     C                     MOVE UUIN33    *IN33
     C                     MOVE UUIN64    *IN64
     C                     MOVE UUIN69    *IN69
      * CASE: PGM.*Return code is Value Date Before Ac Open
     C           W0RTN     IFEQ '*DTOPER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0026           Value date (dis
      * Send message 'Value Date not valid 4'
     C                     MOVEL'GLX0112' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef Back Value Date
     C           W0RTN     IFEQ '*BVLDER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0027           Value date (dis
      * Send message 'Value Date not valid 5'
     C                     MOVEL'GLX0113' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Before Last CR Int
     C           W0RTN     IFEQ '*DTCRER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0028           Value date (dis
      * Send message 'Value Date Not Valid 6'
     C                     MOVEL'GLX0114' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Before Last DR Int
     C           W0RTN     IFEQ '*DTDRER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0029           Value date (dis
      * Send message 'Value Date Not Valid 7'
     C                     MOVEL'GLX0115' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     END                             *FI
      * CASE: PGM.*Return code is VDate Bef. Last CR/DR Int
     C           W0RTN     IFEQ '*DRCRER'                  *IF
      * Setup message data for message
     C                     MOVEL#RVDDS    ZA0030           Value date (dis
      * Send message 'Value Date Not Valid 8'
     C                     MOVEL'GLX0116' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9839  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL*BLANK    #RVDDS           Value date (dis
     C                     Z-ADDWURDNO    #1VLDT           Value date
     C                     END                             *FI
      * Check all Value dates are same
     C                     EXSR UNSUBR                     Check all Value
      *================================================================
     CSR         UMEXIT    ENDSR
      /EJECT
     CSR         UNSUBR    BEGSR
      *================================================================
      * Check all Value dates are same
      *================================================================
      * Save Value dates
     C                     EXSR UOSUBR                     Save Value date
      * Value date 2
      * CASE: WRK.Value date 2 is Date entered
     C           WUDJTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 2 NE WRK.Value date 1
     C           WUDJTX    IFNE WUD2TX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL'N'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 3
      * CASE: WRK.Value date 3 is Date entered
     C           WUDKTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 3 NE WRK.Value date 2
     C           WUDKTX    IFNE WUDJTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 4
      * CASE: WRK.Value date 4 is Date entered
     C           WUDLTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 4 NE WRK.Value date 3
     C           WUDLTX    IFNE WUDKTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 5
      * CASE: WRK.Value date 5 is Date entered
     C           WUDMTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 5 NE WRK.Value date 4
     C           WUDMTX    IFNE WUDLTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 6
      * CASE: WRK.Value date 6 is Date entered
     C           WUDNTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 6 NE WRK.Value date 5
     C           WUDNTX    IFNE WUDMTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 7
      * CASE: WRK.Value date 7 is Date entered
     C           WUDOTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 7 NE WRK.Value date 6
     C           WUDOTX    IFNE WUDNTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 8
      * CASE: WRK.Value date 8 is Date entered
     C           WUDPTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 8 NE WRK.Value date 7
     C           WUDPTX    IFNE WUDOTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 9
      * CASE: WRK.Value date 9 is Date entered
     C           WUDQTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 9 NE WRK.Value date 8
     C           WUDQTX    IFNE WUDPTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 10
      * CASE: WRK.Value date 10 is Date entered
     C           WUDRTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 10 NE WRK.Value date 9
     C           WUDRTX    IFNE WUDQTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 11
      * CASE: WRK.Value date 11 is Date entered
     C           WUDSTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 11 NE WRK.Value date 10
     C           WUDSTX    IFNE WUDRTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 12
      * CASE: WRK.Value date 12 is Date entered
     C           WUDTTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 12 NE WRK.Value date 11
     C           WUDTTX    IFNE WUDSTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 13
      * CASE: WRK.Value date 13 is Date entered
     C           WUDUTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 13 NE WRK.Value date 12
     C           WUDUTX    IFNE WUDTTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 14
      * CASE: WRK.Value date 14 is Date entered
     C           WUDVTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 14 NE WRK.Value date 13
     C           WUDVTX    IFNE WUDUTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 15
      * CASE: WRK.Value date 15 is Date entered
     C           WUDWTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 15 NE WRK.Value date 14
     C           WUDWTX    IFNE WUDVTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 16
      * CASE: WRK.Value date 16 is Date entered
     C           WUDXTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 16 NE WRK.Value date 15
     C           WUDXTX    IFNE WUDWTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 17
      * CASE: WRK.Value date 17 is Date entered
     C           WUDYTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 17 NE WRK.Value date 16
     C           WUDYTX    IFNE WUDXTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 18
      * CASE: WRK.Value date 18 is Date entered
     C           WUDZTX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 18 NE WRK.Value date 17
     C           WUDZTX    IFNE WUDYTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 19
      * CASE: WRK.Value date 19 is Date entered
     C           WUD0TX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 19 NE WRK.Value date 18
     C           WUD0TX    IFNE WUDZTX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * Value date 20
      * CASE: WRK.Value date 20 is Date entered
     C           WUD1TX    IFNE *BLANK                     *IF
      * CASE: WRK.Value date 20 NE WRK.Value date 19
     C           WUD1TX    IFNE WUD0TX                     *IF
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UNEXIT    ENDSR
      /EJECT
      *================================================================                     MD038989
      * Validate If account is a Nostro                               *                     MD038989
      *================================================================                     MD038989
     CSR         SRNOST    BEGSR                                                            MD038989
      *                                                                                     MD038989
     C                     TESTN          UKACM2     72                                     MD038989
     C           *IN72     IFEQ '0'                                                         MD038989
     C                     CALL 'AONOSTR0'                                                  MD038989
     C                     PARM           XXAPRC  7                                         MD038989
     C                     PARM '*KEY'    XXAPOP  7                                         MD038989
     C                     PARM BTCUST    XXCUST  6                                         MD038989
     C                     PARM BTCYCD    XXCYCD  3                                         MD038989
     C                     PARM BTACCD    XXACCD 10                                         MD038989
     C                     PARM BTACSN    XXACSN  2                                         MD038989
     C                     PARM           XXNONB  2                                         MD038989
     C                     PARM BTIBCA    XXBRCD  3                                         MD038989
     C                     PARM           XXCSSN 10                                         MD038989
     C                     PARM           XXPNOI  1                                         MD038989
     C                     PARM           UUFDY                                             MD038989
      *                                                                                     MD038989
     C           XXAPRC    IFEQ '      '                                                    MD038989
     C                     MOVEL'Y'       NSTFLG  1                                         MD038989
     C                     ELSE                                                             MD038989
     C                     MOVEL'N'       NSTFLG                                            MD038989
     C                     END                                                              MD038989
      *                                                                                     MD038989
     C                     ELSE                                                             MD038989
     C                     MOVEL'Y'       NSTFLG                                            MD038989
     C                     ENDIF                                                            MD038989
      *                                                                                     MD038989
     CSR                   ENDSR                                                            MD038989
     C/EJECT                                                                                MD038989
     CSR         UOSUBR    BEGSR
      *================================================================
      * Save Value dates
      *================================================================
      * CASE: RCD.Batch item no. is 1st
     C           #1BINB    IFEQ 1                          *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 1
     C           #RVDDS    IFNE WUD2TX                     *IF
     C                     MOVEL#RVDDS    WUD2TX           Value date 1
     C                     MOVEL'Y'       WULHST           value date chan
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 2nd
     C           #1BINB    IFEQ 2                          *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 2
     C           #RVDDS    IFNE WUDJTX                     *IF
     C                     MOVEL#RVDDS    WUDJTX           Value date 2
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 3rd
     C           #1BINB    IFEQ 3                          *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 3
     C           #RVDDS    IFNE WUDKTX                     *IF
     C                     MOVEL#RVDDS    WUDKTX           Value date 3
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 4th
     C           #1BINB    IFEQ 4                          *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 4
     C           #RVDDS    IFNE WUDLTX                     *IF
     C                     MOVEL#RVDDS    WUDLTX           Value date 4
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 5th
     C           #1BINB    IFEQ 5                          *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 5
     C           #RVDDS    IFNE WUDMTX                     *IF
     C                     MOVEL#RVDDS    WUDMTX           Value date 5
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 6th
     C           #1BINB    IFEQ 6                          *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 6
     C           #RVDDS    IFNE WUDNTX                     *IF
     C                     MOVEL#RVDDS    WUDNTX           Value date 6
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 7th
     C           #1BINB    IFEQ 7                          *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 7
     C           #RVDDS    IFNE WUDOTX                     *IF
     C                     MOVEL#RVDDS    WUDOTX           Value date 7
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 8th
     C           #1BINB    IFEQ 8                          *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 8
     C           #RVDDS    IFNE WUDPTX                     *IF
     C                     MOVEL#RVDDS    WUDPTX           Value date 8
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 9th
     C           #1BINB    IFEQ 9                          *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 9
     C           #RVDDS    IFNE WUDQTX                     *IF
     C                     MOVEL#RVDDS    WUDQTX           Value date 9
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 10th
     C           #1BINB    IFEQ 10                         *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 10
     C           #RVDDS    IFNE WUDRTX                     *IF
     C                     MOVEL#RVDDS    WUDRTX           Value date 10
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 11th
     C           #1BINB    IFEQ 11                         *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 11
     C           #RVDDS    IFNE WUDSTX                     *IF
     C                     MOVEL#RVDDS    WUDSTX           Value date 11
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 12th
     C           #1BINB    IFEQ 12                         *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 12
     C           #RVDDS    IFNE WUDTTX                     *IF
     C                     MOVEL#RVDDS    WUDTTX           Value date 12
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 13th
     C           #1BINB    IFEQ 13                         *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 13
     C           #RVDDS    IFNE WUDUTX                     *IF
     C                     MOVEL#RVDDS    WUDUTX           Value date 13
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 14th
     C           #1BINB    IFEQ 14                         *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 14
     C           #RVDDS    IFNE WUDVTX                     *IF
     C                     MOVEL#RVDDS    WUDVTX           Value date 14
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 15th
     C           #1BINB    IFEQ 15                         *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 15
     C           #RVDDS    IFNE WUDWTX                     *IF
     C                     MOVEL#RVDDS    WUDWTX           Value date 15
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 16th
     C           #1BINB    IFEQ 16                         *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 16
     C           #RVDDS    IFNE WUDXTX                     *IF
     C                     MOVEL#RVDDS    WUDXTX           Value date 16
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 17th
     C           #1BINB    IFEQ 17                         *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 17
     C           #RVDDS    IFNE WUDYTX                     *IF
     C                     MOVEL#RVDDS    WUDYTX           Value date 17
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 18th
     C           #1BINB    IFEQ 18                         *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 18
     C           #RVDDS    IFNE WUDZTX                     *IF
     C                     MOVEL#RVDDS    WUDZTX           Value date 18
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 19th
     C           #1BINB    IFEQ 19                         *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 19
     C           #RVDDS    IFNE WUD0TX                     *IF
     C                     MOVEL#RVDDS    WUD0TX           Value date 19
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 20th
     C           #1BINB    IFEQ 20                         *IF
      * CASE: RCD.Value date (display) NE WRK.Value date 20
     C           #RVDDS    IFNE WUD1TX                     *IF
     C                     MOVEL#RVDDS    WUD1TX           Value date 20
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UOEXIT    ENDSR
      /EJECT
     CSR         UPSUBR    BEGSR
      *================================================================
      * Check Profit Centre
      *================================================================
      * CASE: RCD.Profit centre is Entered
     C           #1PRCN    IFNE *BLANK                     *IF
      * Profit Centres Used
      * CASE: WRK.Profit Centres Used is Yes
     C           WUPRCU    IFEQ 'Y'                        *IF
      * CASE: RCD.Profit centre is Select requested
     C           #1PRCN    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access profit Centre - Profit Centres  *
     C*
     C*  Access Def centre code off file.
     C*
     C                     MOVEL#1PRCN    UUPCCD
     C                     CALL 'AOPRFCR0'
     C           WUAPRC    PARM           WUAPRC           B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUPCCD  4        I:Profit Cent
     C           D@PRFC    PARM *BLANK    UUSDY            O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELDSPCCD    WUPCCD           Profit Centre
     C                     MOVELDSPCCD    WUPCDS           Prof Cent Desc
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0031           Profit centre
      * Send message 'Profit Centres         NF'
     C                     MOVEL'GLX0182' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9838  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUPCCD    #1PRCN           Profit centre
     C                     END                             *FI
     C                     END                             *FI
     C                     ELSE
      * CASE: *OTHERWISE
      * Profit Centre Defaults used
      * CASE: WRK.Profit Centre Def'ts Used is Yes
     C           WUPCDU    IFEQ 'Y'                        *IF
      * CASE: RCD.Transaction type is Not entered
     C           #1TRTY    IFEQ *BLANK                     *IF
     C                     MOVEL*BLANK    WUTRTY           Transaction typ
     C                     MOVEL'JE'      WUTRTY           Transaction typ
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVEL#1TRTY    WUTRTY           Transaction typ
     C                     END                             *FI
      * Set Prof C Def Mat Key *s - Standard functions  *
     C                     MOVEL'**'      WUBKCD
     C                     MOVEL'**'      WUSBTY
     C                     MOVEL'**'      WUACOC
      * Access Prof C Def Matrix. - Profit Centre Dft Matrix  *
     C*
     C*  Access Def Prof centre code off file.
     C*
     C                     CALL 'AOPRFMR0'
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM WUBKCD    UUBKCD  2        I:Book Code
     C                     PARM #1TRTY    UUPCTT  5        I:Trans Type
     C                     PARM WUSBTY    UUSBTY  2        I:Sub Type
     C                     PARM #1IBCA    UUBRCD  3        I:Branch Code
     C                     PARM P7DPCD    UUDPCD  3        I:Department
     C                     PARM ##USR     UUUSID 10        I:User Profile
     C                     PARM WUACOC    UUACOC  2        I:A/c Officer
     C                     PARM #1CUST    UUCUST  6        I:Customer No.
     C                     PARM *BLANK    UUPCCD  4        O:Format
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELUUPCCD    WUPRCN           Profit Centre
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 0
     C           WUAPRC    IFEQ '0'                        *IF
     C                     MOVELWUPRCN    #1PRCN           Profit centre
     C                     ELSE
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 1
     C           WUAPRC    IFEQ '1'                        *IF
     C                     MOVEL*BLANK    #1PRCN           Profit centre
     C                     ELSE
      * CASE: WRK.Access Pgm Return Code is Profit Cent Def Access 2
     C           WUAPRC    IFEQ '2'                        *IF
     C                     MOVELWUPRCN    #1PRCN           Profit centre
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0032           Profit centre
      * Send message 'Def Prof Centre Not Found'
     C                     MOVEL'GLX0203' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9838  *
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Profit centre is Not Entered
     C           #1PRCN    IFEQ *BLANK                     *IF
      * Send message 'Profit Centre not entered'
     C                     MOVEL'GLX0328' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     98    *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     END                             *FI
     C                     END                             *FI
      * CASE: RCD.Profit centre is Entered
     C           #1PRCN    IFNE *BLANK                     *IF
      * CASE: PAR.Spread Profile Code used is No
     C           P8SPCU    IFEQ 'N'                        *IF
      * CASE: RCD.Batch item no. is not first posting
     C           #1BINB    IFGT 1                          *IF
      * CASE: RCD.Profit centre EQ WRK.Save profit centre
     C           #1PRCN    IFEQ WUGNCD                     *IF
      * Setup message data for message
     C                     MOVEL#1PRCN    ZA0033           Profit centre
      * Send message 'Profit ctr = From Ac pc'
     C                     MOVEL'GLX0323' ZAMSID
     C                     MOVEL'*INFO  ' ZAMSTP           Message type
     C                     EXSR ZASNMS
      *
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UPEXIT    ENDSR
      /EJECT
     CSR         UQSUBR    BEGSR
      *================================================================
      * Setup Branch code (Header) & Posting Date on RCD
      *================================================================
     C                     MOVELP2BCDA    #1BCBH           Branch Code (Ba
     C                     Z-ADDWURDNO    #1PTDT           Posting date
      *================================================================
     CSR         UQEXIT    ENDSR
      /EJECT
     CSR         URSUBR    BEGSR
      *================================================================
      * Branch Code Validation
      *================================================================
      * CASE: PAR.Multiple Branch Batch is Yes
     C           P6MBRB    IFEQ 'Y'                        *IF
      * CASE: RCD.Input Branch Code - Alpha is Entered
     C           #1IBCA    IFNE *BLANK                     *IF
      * CASE: RCD.Input Branch Code - Alpha is Select Request
     C           #1IBCA    IFEQ '?'                        *IF
     C                     MOVEL'Y'       W0DCF            *Defer confirm
     C                     END                             *FI
      * Access Branch Codes. - Branch Codes  *
     C*
     C*  Access Branch codes file for the file fields
     C*
     C                     MOVEL#1IBCA    UUBRCD
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*KEY'    UUAPOP  7        I:Option
     C                     PARM           UUBRCD  3        I:Branch Code
     C********** D@BRCH    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@BRCH    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELA8BRCD    WUBRCD           O:Branc Code
     C                     MOVELA8CMCD    WUCMCD           O:Company Code
     C                     MOVELA8LCCD    WULCCD           O:Location Code
     C                     MOVELA8DFAC    WUDFAC           O:Due From a/c Code
     C                     MOVELA8DTAC    WUDTAC           O:Due To a/c Code
     C                     MOVELA8BICN    WUBICN           O:Branch Internal Cus
     C                     MOVELA8BRNM    WUBRNM           O:Branch Name
     C                     MOVELA8GBCD    WUGBCD           O:Global Branch Code
     C                     MOVELA8BRSN    WUBRSN           O:Branch Shortname
     C*
      * CASE: WRK.Access Pgm Return Code is Access Error
     C           WUAPRC    IFEQ '*CLOSE'                   *IF
     C           WUAPRC    OREQ '*ERROR'
     C           WUAPRC    OREQ '*OPEN'
     C           WUAPRC    OREQ '*KEY'
     C           WUAPRC    OREQ '*NRF'
     C           WUAPRC    OREQ '*EMPTY'
     C           WUAPRC    OREQ '*EOF'
     C           WUAPRC    OREQ '*OPTION'
     C           WUAPRC    OREQ '*CALL'
     C           WUAPRC    OREQ '*SELECT'
     C           WUAPRC    OREQ '*NOSEL'
     C           WUAPRC    OREQ '*ID'
      * Setup message data for message
     C                     MOVEL#1IBCA    ZA0036           Input Branch Co
      * Send message 'Branch Code not found'
     C                     MOVEL'GLX0045' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     9835  *
      *
     C                     ELSE
      * CASE: *OTHERWISE
     C                     MOVELWUBRCD    #1IBCA           Input Branch Co
     C                     END                             *FI
     C                     END                             *FI
     C                     END                             *FI
      *================================================================
     CSR         UREXIT    ENDSR
      /EJECT
     CSR         USSUBR    BEGSR
      *================================================================
      * Move Spread Factors to Work fields
      *================================================================
      * CASE: RCD.Batch item no. is 2nd
     C           #1BINB    IFEQ 2                          *IF
      * CASE: RCD.Spread Factor NE WRK.Spread factor 2
     C           #1SPFC    IFNE WUKNNB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKNNB           Spread factor 2
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 3rd
     C           #1BINB    IFEQ 3                          *IF
      * CASE: RCD.Spread Factor NE WRK.Spread factor 3
     C           #1SPFC    IFNE WUKONB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKONB           Spread factor 3
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 4th
     C           #1BINB    IFEQ 4                          *IF
      * CASE: RCD.Spread Factor NE WRK.spread factor 4
     C           #1SPFC    IFNE WUKPNB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKPNB           spread factor 4
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 5th
     C           #1BINB    IFEQ 5                          *IF
      * CASE: RCD.Spread Factor NE WRK.spread factor 5
     C           #1SPFC    IFNE WUKQNB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKQNB           spread factor 5
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 6th
     C           #1BINB    IFEQ 6                          *IF
      * CASE: RCD.Spread Factor NE WRK.spread factor 6
     C           #1SPFC    IFNE WUKRNB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKRNB           spread factor 6
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 7th
     C           #1BINB    IFEQ 7                          *IF
      * CASE: RCD.Spread Factor NE WRK.spread factor 7
     C           #1SPFC    IFNE WUKSNB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKSNB           spread factor 7
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 8th
     C           #1BINB    IFEQ 8                          *IF
      * CASE: RCD.Spread Factor NE WRK.spread factor 8
     C           #1SPFC    IFNE WUKTNB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKTNB           spread factor 8
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 9th
     C           #1BINB    IFEQ 9                          *IF
      * CASE: RCD.Spread Factor NE WRK.spread factor 9
     C           #1SPFC    IFNE WUKUNB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKUNB           spread factor 9
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 10th
     C           #1BINB    IFEQ 10                         *IF
      * CASE: RCD.Spread Factor NE WRK.spread factor 10
     C           #1SPFC    IFNE WUKVNB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKVNB           spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 11th
     C           #1BINB    IFEQ 11                         *IF
      * CASE: RCD.Spread Factor NE WRK.Spread Factor 11
     C           #1SPFC    IFNE WUKWNB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKWNB           Spread Factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 12th
     C           #1BINB    IFEQ 12                         *IF
      * CASE: RCD.Spread Factor NE WRK.Spread Factor 12
     C           #1SPFC    IFNE WUKXNB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKXNB           Spread Factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 13th
     C           #1BINB    IFEQ 13                         *IF
      * CASE: RCD.Spread Factor NE WRK.Spread factor 13
     C           #1SPFC    IFNE WUKYNB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKYNB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 14th
     C           #1BINB    IFEQ 14                         *IF
      * CASE: RCD.Spread Factor NE WRK.Spread factor 14
     C           #1SPFC    IFNE WUKZNB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUKZNB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 15th
     C           #1BINB    IFEQ 15                         *IF
      * CASE: RCD.Spread Factor NE WRK.Spread factor 15
     C           #1SPFC    IFNE WUK0NB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUK0NB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 16th
     C           #1BINB    IFEQ 16                         *IF
      * CASE: RCD.Spread Factor NE WRK.Spread factor 16
     C           #1SPFC    IFNE WUK1NB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUK1NB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 17th
     C           #1BINB    IFEQ 17                         *IF
      * CASE: RCD.Spread Factor NE WRK.Spread factor 17
     C           #1SPFC    IFNE WUK2NB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUK2NB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 18th
     C           #1BINB    IFEQ 18                         *IF
      * CASE: RCD.Spread Factor NE WRK.Spread factor 18
     C           #1SPFC    IFNE WUK3NB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUK3NB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 19th
     C           #1BINB    IFEQ 19                         *IF
      * CASE: RCD.Spread Factor NE WRK.Spread factor 19
     C           #1SPFC    IFNE WUK4NB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUK4NB           Spread factor 1
     C                     END                             *FI
      * CASE: RCD.Batch item no. is 20th
     C           #1BINB    IFEQ 20                         *IF
      * CASE: RCD.Spread Factor NE WRK.Spread factor 20
     C           #1SPFC    IFNE WUK5NB                     *IF
     C                     MOVEL*BLANK    #RFMPA           Formatted Posti
     C                     END                             *FI
     C                     Z-ADD#1SPFC    WUK5NB           Spread factor 2
     C                     END                             *FI
      *================================================================
     CSR         USEXIT    ENDSR
      /EJECT
     CSR         VACKRL    BEGSR
      *================================================================
      * Check restriction within
      *================================================================
      * Name search required?
     C                     MOVEL#2BTNB    WK1X01  1        Batch number
     C           WK1X01    IFEQ '?'                        Batch number
     C                     CALL 'GL0140S'              90  *
     C                     PARM           W0RTN   7
     C           #2BTNB    PARM #2BTNB    WQ0069  3        Batch number
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      * Defer confirm
     C                     MOVEL'Y'       W0DCF   1
      * No value selected, exit
     C           W0RTN     CABNE*BLANK    VA999
     C                     END
      *................................................................
      *
     C           KLVABR    KLIST
     C                     KFLD           BRBTNB           Batch number
      * Setup key
     C                     MOVEL#2BTNB    BRBTNB           Batch number
     C           KLVABR    CHAIN@BRREAH              9091  *
     C           *IN90     IFEQ '0'
      * Record found - move back any virtuals
     C                     GOTO VAEXIT
     C                     END
     C           VA999     TAG
      * Restrictor relation not satisfied
      * Send message 'Journal Entry Header   NF'
     C                     MOVEL'GLX0172' ZAMSID
     C                     MOVEL'*PRV '   ZAPGRL           Rel queue
     C                     EXSR ZASNMS
     C                     MOVEL'GLX0172' P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         VAEXIT    ENDSR
     CSR         XXIN      BEGSR                                          E17819
      *====================================================
      * Determine Account type
      *----------------------------------------------------
      *
     C                     MOVE *IN90     UKSI90  1        Save indicator
      *
      * 1. Check for invalid input :
      *
     C           UKACID    IFEQ *BLANK                     IF BLANK
     C                     MOVE '*ERROR*' UKTYPE  7          Error
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 2. Check for Retail A/C :
      *
     C                     TESTN          UKACID     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF ALL NUMERIC
     C                     MOVE '*RETAIL' UKTYPE             Retail A/C
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 3. Check for Customer number :
      *
     C                     TESTN          UKACF6     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF ALL NUMERIC
     C           UKACL4    IFEQ *BLANK                     IF 6 DIGITS ONLY
     C                     MOVE '*NUMBER' UKTYPE             Cust.number
     C                     ELSE                            EL INVALID
     C                     MOVE '*ERROR*' UKTYPE  7          Error
     C                     END                             FI
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 4. Check for Nostro :
      *
     C                     TESTN          UKACM2     90    All numeric?
      *
     C           *IN90     IFEQ '1'                        IF NUMERIC
     C           UKACA1    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA1    ANDLT'0'                         AND ¬NUMERIC
     C           UKACA2    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA2    ANDLT'0'                         AND ¬NUMERIC
     C           UKACA3    ANDNE*BLANK                      AND ¬BLANK
     C           UKACA3    ANDLT'0'                         AND ¬NUMERIC
     C           UKACL5    ANDEQ*BLANK                      AND NO MORE
     C                     MOVE '*NOSTRO' UKTYPE             Nostro
     C                     GOTO UKSK01                       Return
     C                     END                             FI
      *
      * 5. Check for Customer Shortname :
      *
     C           UKACF1    IFLT '0'                        IF ¬NUMERIC
     C           UKACF1    ANDNE*BLANK                      AND ¬BLANK
     C                     MOVE '*SHNAME' UKTYPE             Shortname
     C                     ELSE                            EL NUMERIC
     C                     MOVE '*ERROR*' UKTYPE             Invalid
     C                     END                             FI
      *          _____________
     C           UKSK01    TAG
      *          ~~~~~~~~~~~~~
     C                     MOVE UKSI90    *IN90            Restore ind.
      *
      *----------------------------------------------------
      *
      *====================================================
     C*SR****     UKEXIT    ENDSR                                         E17819
     CSR         XXOUT     ENDSR                                          E17819
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue
      *================================================================
     C           ZAPGM     IFEQ *BLANK
     C                     MOVEL##PGM     ZAPGM
     C                     END
      * If no message file specified, use default
     C           ZAMSGF    IFEQ *BLANK
     C                     MOVELZADFMF    ZAMSGF
     C                     END
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message ID
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data
     C                     PARM           ZAMSTP  7        Message type
      * Clear all fields for default mechanism next time
     C                     MOVEL*BLANK    ZAPGM
     C                     MOVEL*BLANK    ZAPGRL
     C                     MOVEL*BLANK    ZAMSID
     C                     MOVEL*BLANK    ZAMSGF
     C                     MOVEL*BLANK    ZAMSDA
     C                     MOVEL*BLANK    ZAMSTP
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text
      *================================================================
      * Signal help request
     C                     MOVEL'Y'       W0HLP   1
     C                     CALL 'YDDSHPR'
     C                     PARM ##PGM     W0HPMB 10        Help text sourc
     C                     PARM *BLANK    YYHPFL 10        Help text file
     C                     PARM *BLANK    YYHPLB 10        Help text libra
     C                     PARM           W0RTN   7
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program: Normal
      *================================================================
      * USER: Exit program processing
      *                                                                   110309
      **  If F3 is pressed, check for posting errors                      110309
      *                                                                   110309
     C           *IN03     IFEQ '1'                                       110309
     C                     MOVEL'CHG'     W0PMD                           110309
     C                     MOVE *BLANK    P9EXTO                          110309
     C                     SETON                     80                   110309
     C                     WRITE#SFLCTL                                   110309
     C                     SETOF                     80                   110309
     C                     Z-ADD*ZERO     ##RRMX     81                   110309
     C                     MOVEL#2BTNB    BTBTNB                          110309
     C           KRST      SETLL@BTREAL              82                   110309
     C  N82      KRST      READE@BTREAL                9182               110309
     C/COPY WNCPYSRC,GL0182MC25
     C           *IN82     DOWEQ'0'                                       110309
     C           P9EXTO    ANDEQ' '                                       110309
     C                     EXSR BBLDSF                                    110309
     C                     ENDDO                                          110309
     C                     ENDIF                                          110309
      *                                                                   110309
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0182MEPP - Journal Entry Posting  *
     C*00/Copy Member GL0182M   Exit Program Processing
     C/COPY WNCPYSRC,GL0182MEPP
     C                     END                             *FI
     C                     MOVEL*BLANK    P0RTN
     C                     EXSR ZYEXPG
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZYEXPG    BEGSR
      *================================================================
      * Exit program: Direct
      *================================================================
      * Terminate program
     C                     SETON                     LR
      *
      * Exit program
     C                     RETRN
      *
      *================================================================
     CSR         ZYEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation
      *================================================================
     C*                                                                   S01408
     C** Core hook for externalisation.                                   S01408
     C/COPY WNCPYSRC,GL0182MCP1                                           S01408
     C*                                                                   S01408
     C                     MOVE *BLANK    P0RTN
     C                     MOVE *BLANK    W0RTN   7
     C                     MOVEL*BLANK    W0RSL   1
     C                     MOVEL*BLANK    W0RSF   1
      * Setup job date/time
      *
     C                     Z-ADDUDATE     ##JDT
     C                     TIME           ##JTM
      * Update screen time
     C                     TIME           ##TME   60
      * Define work field S01212
     C                     MOVEL*BLANK    WUFKST  1
      * Define work field Number of Decimal Places
     C                     Z-ADD*ZERO     WUNBDP  10
      * Define work field Access Pgm Return Code
     C                     MOVEL*BLANK    WUAPRC  7
      * Define work field Currency code
     C                     MOVEL*BLANK    WUCYCD  3
      * Define work field Currency Name
     C                     MOVEL*BLANK    WUCYNM 14
      * Define work field Nostro Shortname
     C                     MOVEL*BLANK    WUNOSN 10
      * Define work field ZALIGN Screen Fun Field
     C                     MOVEL*BLANK    WUZASF 16
      * Define work field ZALIGN File Field
     C                     MOVEL*BLANK    WUZAFF 16
      * Define work field Error Code
     C                     MOVEL*BLANK    WUERCD  1
      * Define work field Output
     C                     MOVEL*BLANK    WUOUTP  1
      * Define work field Save profit centre
     C                     MOVEL*BLANK    WUGNCD  4
      * Define work field Save Spread Factor
     C                     Z-ADD*ZERO     WUKDNB  80
      * Define work field save Posting Amt
     C                     Z-ADD*ZERO     WUKHNB 130
      * Define work field Spread factor 2
     C                     Z-ADD*ZERO     WUKNNB  80
      * Define work field Spread factor 3
     C                     Z-ADD*ZERO     WUKONB  80
      * Define work field spread factor 4
     C                     Z-ADD*ZERO     WUKPNB  80
      * Define work field spread factor 5
     C                     Z-ADD*ZERO     WUKQNB  80
      * Define work field spread factor 6
     C                     Z-ADD*ZERO     WUKRNB  80
      * Define work field spread factor 7
     C                     Z-ADD*ZERO     WUKSNB  80
      * Define work field spread factor 8
     C                     Z-ADD*ZERO     WUKTNB  80
      * Define work field spread factor 9
     C                     Z-ADD*ZERO     WUKUNB  80
      * Define work field spread factor 10
     C                     Z-ADD*ZERO     WUKVNB  80
      * Define work field Spread Factor 11
     C                     Z-ADD*ZERO     WUKWNB  80
      * Define work field Spread Factor 12
     C                     Z-ADD*ZERO     WUKXNB  80
      * Define work field Spread factor 13
     C                     Z-ADD*ZERO     WUKYNB  80
      * Define work field Spread factor 14
     C                     Z-ADD*ZERO     WUKZNB  80
      * Define work field Spread factor 15
     C                     Z-ADD*ZERO     WUK0NB  80
      * Define work field Spread factor 16
     C                     Z-ADD*ZERO     WUK1NB  80
      * Define work field Spread factor 17
     C                     Z-ADD*ZERO     WUK2NB  80
      * Define work field Spread factor 18
     C                     Z-ADD*ZERO     WUK3NB  80
      * Define work field Spread factor 19
     C                     Z-ADD*ZERO     WUK4NB  80
      * Define work field Spread factor 20
     C                     Z-ADD*ZERO     WUK5NB  80
      * Define work field Output Branch
     C                     MOVEL*BLANK    WULGST  1
      * Define work field Customer number
     C                     MOVEL*BLANK    WUCUST  6
      * Define work field Account code
     C**********           MOVEL*BLANK    WUACCD  4                                           CGL029
     C                     MOVEL*BLANK    WUACCD 10                                           CGL029
      * Define work field Account sequence number
     C                     MOVEL*BLANK    WUACSN  2
      * Define work field Branch code
     C                     MOVEL*BLANK    WUBRCD  3
      * Define work field Account type
     C                     MOVEL*BLANK    WUACTY  1
      * Define work field Account subtype
     C                     MOVEL*BLANK    WUBPST  1
      * Define work field Account status
     C                     MOVEL*BLANK    WUACCS  1
      * Define work field Date account opened
     C                     Z-ADD*ZERO     WUDACO  50
      * Define work field Account name
     C                     MOVEL*BLANK    WUACNM 20
      * Define work field Retail account number
     C                     Z-ADD*ZERO     WURACN 100
      * Define work field Retail Indicators   MIDAS
     C                     MOVEL*BLANK    WURETB  1
      * Define work field Relative rec no of memos
     C                     Z-ADD*ZERO     WURRNM  50
      * Define work field Date Format flag
     C                     MOVEL*BLANK    WUDTFF  1
      * Define work field Date (numeric format)
     C                     Z-ADD*ZERO     WUDTNF  60
      * Define work field Midas Run Date
     C                     MOVEL*BLANK    WUDDCD  7
      * Define work field Value date 1
     C                     MOVEL*BLANK    WUD2TX  6
      * Define work field Value date 2
     C                     MOVEL*BLANK    WUDJTX  6
      * Define work field Value date 3
     C                     MOVEL*BLANK    WUDKTX  6
      * Define work field Value date 4
     C                     MOVEL*BLANK    WUDLTX  6
      * Define work field Value date 5
     C                     MOVEL*BLANK    WUDMTX  6
      * Define work field Value date 6
     C                     MOVEL*BLANK    WUDNTX  6
      * Define work field Value date 7
     C                     MOVEL*BLANK    WUDOTX  6
      * Define work field Value date 8
     C                     MOVEL*BLANK    WUDPTX  6
      * Define work field Value date 9
     C                     MOVEL*BLANK    WUDQTX  6
      * Define work field Value date 10
     C                     MOVEL*BLANK    WUDRTX  6
      * Define work field Value date 11
     C                     MOVEL*BLANK    WUDSTX  6
      * Define work field Value date 12
     C                     MOVEL*BLANK    WUDTTX  6
      * Define work field Value date 13
     C                     MOVEL*BLANK    WUDUTX  6
      * Define work field Value date 14
     C                     MOVEL*BLANK    WUDVTX  6
      * Define work field Value date 15
     C                     MOVEL*BLANK    WUDWTX  6
      * Define work field Value date 16
     C                     MOVEL*BLANK    WUDXTX  6
      * Define work field Value date 17
     C                     MOVEL*BLANK    WUDYTX  6
      * Define work field Value date 18
     C                     MOVEL*BLANK    WUDZTX  6
      * Define work field Value date 19
     C                     MOVEL*BLANK    WUD0TX  6
      * Define work field Value date 20
     C                     MOVEL*BLANK    WUD1TX  6
      * Define work field Total Spread Factors
     C                     Z-ADD*ZERO     WUKGNB  80
      * Obtain default message file
     C           *NAMVAR   DEFN MIMGFLA   ZADFMF 10
     C                     IN   ZADFMF
      * Define work field Copy:Retail Number Enter
     C                     MOVEL*BLANK    WUCRNE  1
      * Define work field Copy:Account identifier
     C                     MOVEL*BLANK    WUCACI 10
      * Define work field Copy:Retail Account Num
     C                     Z-ADD*ZERO     WUCRAN 100
      * Define work field Copy:Customer Number
     C                     MOVEL*BLANK    WUCCUS  6
      * Define work field Copy:Narrative Code
     C                     MOVEL*BLANK    WUCNRC  2
      * Define work field Copy:Narrative
     C                     MOVEL*BLANK    WUCNAR 30
      * Define work field Copy:Narrative Descriptn
     C                     MOVEL*BLANK    WUCNDS 30
      * Define work field Copy:Posting amount
     C                     Z-ADD*ZERO     WUCPAM 130
      * Define work field Copy:Amount
     C                     MOVEL*BLANK    WUCAMT 14
      * Define work field Copy:Value Date Nbr
     C                     Z-ADD*ZERO     WUCVDN  50
      * Define work field Value date (display)
     C                     MOVEL*BLANK    WUVDDS  6
      * Define work field Copy:Value Date
     C                     MOVEL*BLANK    WUCVDT  6
      * Define work field Account ID Status Flag
     C                     MOVEL*BLANK    WUAISF  7
      * Define work field Cust No or Short Inval
     C                     MOVEL*BLANK    WUCNSI  1
      * Define work field Valid Customer Number
     C                     MOVEL*BLANK    WUVCNB  1
      * Define work field Input Branch Code - Alpha
     C                     MOVEL*BLANK    WUIBCA  3
      * Define work field Company Code
     C                     MOVEL*BLANK    WUCMCD  3
      * Define work field Location Code
     C                     MOVEL*BLANK    WULCCD  3
      * Define work field Due From Account Code
     C**********           MOVEL*BLANK    WUDFAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDFAC 10                                           CGL029
      * Define work field Due To Account Code
     C**********           MOVEL*BLANK    WUDTAC  4                                           CGL029
     C                     MOVEL*BLANK    WUDTAC 10                                           CGL029
      * Define work field Branch Internal Customer
     C                     MOVEL*BLANK    WUBICN  6
      * Define work field Branch Name
     C                     MOVEL*BLANK    WUBRNM 30
      * Define work field Global Branch Code
     C                     MOVEL*BLANK    WUGBCD  3
      * Define work field Branch Shortname
     C                     MOVEL*BLANK    WUBRSN  3
      * Define work field SPF Error Condition
     C                     Z-ADD*ZERO     WUSPEC  10
      * Define work field ZALIGN No Of Decimals
     C                     Z-ADD*ZERO     WUZNDE  10
      * Define work field ZALIGN No Of Digits
     C                     Z-ADD*ZERO     WUZNDI  20
      * Define work field JE Special Character
     C                     MOVEL*BLANK    WUJESP  1
      * Define work field Narrative status
     C                     MOVEL*BLANK    WUNRST  7
      * Define work field Description of Narrative
     C                     MOVEL*BLANK    WUDON  30
      * Define work field Work Value Date (display)
     C                     MOVEL*BLANK    WUWVDD  6
      * Define work field Runday Number
     C                     Z-ADD*ZERO     WURDNO  50
      * Define work field Number of Forward Days
     C                     Z-ADD*ZERO     WUNBFD  20
      * Define work field Local Currency code
     C                     MOVEL*BLANK    WULCCY  3
      * Define work field Forward Day Number
     C                     Z-ADD*ZERO     WUFDNB  50
      * Define work field Error Ind - Day - Holiday
     C                     MOVEL*BLANK    WUJJST  1
      * Define work field value date changed
     C                     MOVEL*BLANK    WULHST  1
      * Define work field Profit Centres Used
     C                     MOVEL*BLANK    WUPRCU  1
      * Define work field Profit Centre Code
     C                     MOVEL*BLANK    WUPCCD  4
      * Define work field Profit Centre Description
     C                     MOVEL*BLANK    WUPCDS 30
      * Define work field Profit Centre Def'ts Used
     C                     MOVEL*BLANK    WUPCDU  1
      * Define work field Transaction type
     C                     MOVEL*BLANK    WUTRTY  5
      * Define work field Book Code
     C                     MOVEL*BLANK    WUBKCD  2
      * Define work field Sub Type
     C                     MOVEL*BLANK    WUSBTY  2
      * Define work field Account Officer Code
     C                     MOVEL*BLANK    WUACOC  2
      * Define work field Profit centre
     C                     MOVEL*BLANK    WUPRCN  4
      * Define work field Copy:Currency code
     C                     MOVEL*BLANK    WUCCCD  3
      * Define work field Copy:Account code
     C                     MOVEL*BLANK    WUCPAC  4
      * Define work field Copy:Account Sequence
     C                     MOVEL*BLANK    WUCACS  2
      * Define work field Copy:Branch Code - Alpha
     C                     MOVEL*BLANK    WUCBCA  3
      * Define work field Copy:DR/CR Indicator
     C                     MOVEL*BLANK    WUCDCI  1
      * Define work field Copy:Transaction Type
     C                     MOVEL*BLANK    WUCTRT  5
      * Define work field Copy:Cheque Number
     C                     MOVEL*BLANK    WUCCNB  8
      * Define work field Copy:Assoc Cust - Display
     C                     MOVEL*BLANK    WUASSC 10
      * Define work field Copy:Swift Common Ref
     C                     MOVEL*BLANK    WUCSCR 16
      * Define work field Copy:Profit Centre
     C                     MOVEL*BLANK    WUCPRC  4
      * Define work field Client key identity
     C                     MOVEL*BLANK    WUCRST  7
      * Define work field Customer Shortname
     C                     MOVEL*BLANK    WUCSSN 10
      * Define work field DRS Customer Shortname
     C                     MOVEL*BLANK    WUDRCS  7
      * Define work field Customer Swift Id
     C                     MOVEL*BLANK    WUCSID 12
      * Define work field Account Code Name
     C                     MOVEL*BLANK    WUACCN 25
      * Define work field Account Section
     C                     MOVEL*BLANK    WUACSC  2
      * Define work field Account Sub-type
     C                     MOVEL*BLANK    WUACST  1
      * Define work field Abbreviated Posting?
     C                     MOVEL*BLANK    WUABPS  1
      * Define work field Account Identifier
     C                     MOVEL*BLANK    WUACID 10
      * Define work field Multibranching Indicator
     C                     MOVEL*BLANK    WUMBIN  1
      * Define work field Midas Rundate
     C                     MOVEL*BLANK    WUMRDT  7
      * Define work field Setup Complete
     C                     MOVEL*BLANK    WUSUCP  1
      * Define work field No. of Postings entered
     C                     Z-ADD*ZERO     WUNOPE  50
      * Define work field Sum of Spread Factors
     C                     Z-ADD*ZERO     WUSOSF  50
      * Define work field Last item number
     C                     Z-ADD*ZERO     WULINB  30
      * Define work field User
     C                     MOVEL*BLANK    WUUSID 10
      * Define work field User Default Branch Code
     C                     MOVEL*BLANK    WUUDBC  3
      * Define work field User Default Department
     C                     MOVEL*BLANK    WUUDDP  3
      * Define work field User Bank Level Authority
     C                     MOVEL*BLANK    WUUBLA  1
      * Define work field General Ledger
     C                     MOVEL*BLANK    WUGNLG 10
      * Define work field Profit & Loss Accnt Code
     C**********           MOVEL*BLANK    WUPLAC  4                                           CGL029
     C                     MOVEL*BLANK    WUPLAC 10                                           CGL029
      * Define work field Base Currency Transfer Fq
     C                     MOVEL*BLANK    WUBCTF  1
      * Define work field Accrual Key Summary Ind.
     C                     MOVEL*BLANK    WUAKSI  1
      * Define work field Accruals/Profit Date
     C                     Z-ADD*ZERO     WUAPDT  50
      * Define work field Accruals/Profit Frequency
     C                     MOVEL*BLANK    WUAPFQ  1
      * Define work field Accruals/Profit Fq. Day
     C                     Z-ADD*ZERO     WUAPFD  20
      * Define work field Accrue on Last Day Ind.
     C                     MOVEL*BLANK    WUALDI  1
      * Define work field A/c Posting Retention Pd
     C                     Z-ADD*ZERO     WUAPRP  20
      * Define work field Accrual Non-Wk Day Ind
     C                     MOVEL*BLANK    WUANWD  1
      * Define work field Spot Rates Retention Pd
     C                     Z-ADD*ZERO     WUSRRP  20
      * Define work field Base Rates Retention Pd
     C                     Z-ADD*ZERO     WUBRRP  20
      * Define work field GL Description Ind.
     C                     MOVEL*BLANK    WUGLDI  1
      * Define work field Profit Centres Amendable
     C                     MOVEL*BLANK    WUPRCA  1
      * Define work field Prof C Def Matrix-Book
     C                     MOVEL*BLANK    WUPMBK  1
      * Define work field Prof C Def Matrix-T Type
     C                     MOVEL*BLANK    WUPMTT  1
      * Define work field Prof C Def Matrix-S Type
     C                     MOVEL*BLANK    WUPMST  1
      * Define work field Prof C Def Matrix-Branch
     C                     MOVEL*BLANK    WUPMBH  1
      * Define work field Prof C Def Matrix-Dept
     C                     MOVEL*BLANK    WUPMDT  1
      * Define work field Prof C Def Matrix-User
     C                     MOVEL*BLANK    WUPMUR  1
      * Define work field Prof C Def Matrix-A/c Off
     C                     MOVEL*BLANK    WUPMAO  1
      * Define work field Prof C Def Matrix-Cust
     C                     MOVEL*BLANK    WUPMCU  1
      * Define work field Originating Branch Used
     C                     MOVEL*BLANK    WUOBRU  1
      * Define work field Orig Branch User/Vald Req
     C                     MOVEL*BLANK    WUOBUV  1
      * Define work field JE Int-Bch Ents @ Bch/Itm
     C                     MOVEL*BLANK    WUIEBI  1
      * Define work field Main Branch
     C                     MOVEL*BLANK    WUMABR  3
      * Define work field Int-Bch Ent Via Main Brch
     C                     MOVEL*BLANK    WUIEMB  1
      * Define work field End of Last Activity Per.
     C                     Z-ADD*ZERO     WUELAP  50
      * Define work field End of Current Act Period
     C                     Z-ADD*ZERO     WUECAP  50
      *
      **  Access override data area                                       CGL002
     C           *NAMVAR   DEFN           GLREOV                          CGL002
     C                     IN   GLREOV                                    CGL002
      *                                                                   CGL002
      **  Set highlights for error message line                           CGL002
      *                                                                   CGL002
     C                     MOVE *LOVAL    URNORM  1        ¦ Highlight 0  CGL002
     C                     BITON'2'       URNORM           ¦ NORMAL       CGL002
      *                                                                   CGL002
     C                     MOVE *LOVAL    URRIHS  1        ¦ Highlight 1  CGL002
     C                     BITON'27'      URRIHS           ¦ RI/STEADY    CGL002
      *                                                                   CGL002
     C                     MOVE *LOVAL    URRIHF  1        ¦ Highlight 2  CGL002
     C                     BITON'2467'    URRIHF           ¦ RI/HI/BLINK  CGL002
      *                                                                   CGL002
     C                     Z-ADD05        ##SFPG  30       SFLPAG
     C                     Z-ADD1         ##SFRC
      * Maximum record number
     C                     Z-ADD*ZERO     ##RRMX
      *................................................................
      * Set to *CHANGE mode
     C                     MOVEL'CHG'     W0PMD   3
      * USER: Initialise program
      * Standard RPG Creation Par - Standard functions  *
      * Last Amend Box - GL0182M - Journal Entry Posting  *
      * Copyright notice - Standard functions  *
      * Multi-Language - GL0182M - Journal Entry Posting  *
      *
      * Call SDRTVTXT pgm to access appropriate text
      *  for a field used in a SFL
      *
      * Spread Factor
     C                     MOVEL'ZZGBMSGF'MSGNM
     C                     MOVEL'ZZM6392' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM002                          CGL002
     C                     MOVELMSGTXT    ZZM002 13                       CGL002
      * Profit Centre
     C                     MOVEL'ZZM3784' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM003                          CGL002
     C                     MOVELMSGTXT    ZZM003 13                       CGL002
      * Value Date
     C                     MOVEL'ZZM1938' MSGDNB
     C                     CALL 'SDRTVTXT'
     C                     PARM           MSGDNB  7
     C                     PARM           MSGNM  10
     C                     PARM           MSGTXT 80
     C***********          MOVELMSGTXT    ZZM004                          CGL002
     C                     MOVELMSGTXT    ZZM004 10                       CGL002
      * Override                                                          CGL002
     C                     MOVEL'ZZM0384' MSGDNB                          CGL002
     C                     CALL 'SDRTVTXT'                                CGL002
     C                     PARM           MSGDNB  7                       CGL002
     C                     PARM           MSGNM  10                       CGL002
     C                     PARM           MSGTXT 80                       CGL002
     C                     MOVELMSGTXT    ZZM005  8                       CGL002
      *
      * Access Midas rundate - Standard functions  *
     C*   Access MIDAS Rundate from data-area RUNDAT
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C                     MOVE MRDT      ##MRDT
     C                     MOVE RDNO      WURDNO
     C                     MOVE SUCP      WUSUCP
     C                     MOVE DTFF      WUDTFF
     C                     MOVE MBIN      WUMBIN
      * Spread Postings Footer - Standard functions  *
     C           P8SPCU    IFEQ 'N'
     C                     MOVEALNE,1     ##CTX1
     C                     ELSE
     C                     MOVEALNE,2     ##CTX1
     C                     END
      * Define 200 Byte Dummy DS - Standard functions  *
      * Define 800 Byte Dummy DS - Standard functions  *
      * Declare Bank File DS - Standard functions  *
      * Account Codes DS - Account Codes  *
      * Account Details DS - Standard functions  *
      * Branch Codes DS - Branch Codes  *
      * Client Details DS - Client Details  *
      * Currency Codes DS - Currency Codes  *
      * General Ledger Details DS - General Ledger Details  *
      * Narrative Codes DS - Narrative Codes  *
      * Nostro Details DS - Nostro Details  *
      * Profit Centre DS - Profit Centres  *
      * Prof C Def Matrix DS - Profit Centre Dft Matrix  *
      * Retail Transactions DS - Retail Transaction Types  *
      * Book Codes DS - Book Codes  *
     C                     Z-ADD*ZERO     WUNOPE           No. of Postings
     C                     Z-ADD*ZERO     WUSOSF           Sum of Spread F
     C                     Z-ADD*ZERO     WULINB           Last item numbe
      * Access ZMUSER - Standard functions  *
     C*
     C* Access data-area ZMUSER
     C*
     C           *NAMVAR   DEFN           ZMUSER
     C                     IN   ZMUSER
     C                     MOVE USID      WUUSID           User Profile
     C                     MOVE UDBC      WUUDBC           User Def Branch
     C                     MOVE UDDP      WUUDDP           User Def Dept
     C                     MOVE UBLA      WUUBLA           User Bank Lvl A
      * Access General Ledger. - General Ledger Details  *
     C*
     C*  Access General Ledger Details file for it' file fields
     C*
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C           WUAPRC    PARM WUAPRC    UUAPRC  7        B:Return Cd
     C                     PARM '*FIRST'  UUAPOP  7        I:Option
     C********** D@GELR    PARM *BLANK    UUFDY            O:Format                           CGL029
     C           D@GELR    PARM *BLANK    UUSDY                                               CGL029
     C*
     C* Assign work field to file field values.
     C*
     C                     MOVELBKGNLG    WUGNLG           General Ledger
     C                     MOVELBKACCD    WUACCD           Account Code
     C                     MOVELBKPLAC    WUPLAC           Profit & Loss Account
     C                     MOVELBKCUST    WUCUST           Cutomer Number
     C                     MOVELBKBCTF    WUBCTF           Base Currency Tran
     C                     MOVELBKAKSI    WUAKSI           Accrual Key summary
     C                     MOVELBKAPDT    WUAPDT           Accruals Profit Date
     C                     MOVELBKAPFQ    WUAPFQ           Accruals Profit Freq
     C                     MOVELBKAPFD    WUAPFD           Accruals Profit Fr Dy
     C                     MOVELBKALDI    WUALDI           Accrue on Last Day
     C                     MOVELBKAPRP    WUAPRP           A/c Posting Ret Pd.
     C                     MOVELBKANWD    WUANWD           Accrual non-wk Day
     C                     MOVELBKSRRP    WUSRRP           Spot Rates Retention
     C                     MOVELBKBRRP    WUBRRP           Base Rates Retention
     C                     MOVELBKGLDI    WUGLDI           GL Description Ind
     C                     MOVELBKPRCU    WUPRCU           Profit Centres Used
     C                     MOVELBKPRCA    WUPRCA           Profit Centres Amend
     C                     MOVELBKPCDU    WUPCDU           Profit Centre Default
     C                     MOVELBKPMBK    WUPMBK           Prof C Matrix Book
     C                     MOVELBKPMTT    WUPMTT           Prof C Matrix Trans
     C                     MOVELBKPMST    WUPMST           Prof C Matrix SubType
     C                     MOVELBKPMBH    WUPMBH           Prof C Matrix Branch
     C                     MOVELBKPMDT    WUPMDT           Prof C Matrix Dept
     C                     MOVELBKPMUR    WUPMUR           Prof C Matrix User
     C                     MOVELBKPMAO    WUPMAO           Prof C Matrix Acc Off
     C                     MOVELBKPMCU    WUPMCU           Prof C Matrix Cust
     C                     MOVELBKOBRU    WUOBRU           Originating Branch Ud
     C                     MOVELBKOBUV    WUOBUV           Orig Branch/User Vald
     C                     MOVELBKJESP    WUJESP           Copy Special Char
     C                     MOVELBKELAP    WUELAP           End of Last Activity
     C                     MOVELBKECAP    WUECAP           End of Curnt Activity
      * RTV Last Batch Item - Standard functions  *
     C                     CALL 'GL0137U'              90  RTV Last Batch
     C                     PARM P1BTNB    WQ0070  3        Batch number
     C           WULINB    PARM *ZERO     WQ0071  30       Last item numbe
      *
     C           *IN90     IFEQ '1'
      * Call to program ended in error
     C                     MOVEL'Y2U0021' W0RTN   7
     C                     END
      *
     C                     MOVEL'Y'       WUFKST           S01212
      * CASE: WRK.S01212 is Fix Installed
     C           WUFKST    IFEQ 'Y'                        *IF
      * 00/Copy Member GL0182MFPG - Journal Entry Posting  *
      * 00/Copy Member GL0182MEPG - Journal Entry Posting  *
      * 00/Copy Member GL0182MIPG - Journal Entry Posting  *
      * 00/Copy Member GL0182MCPG - Journal Entry Posting  *
     C*00/Copy Member GL0182M   Initialise Program C-Spec
     C/COPY WNCPYSRC,GL0182MCPG
      * 00/Copy Member GL0182MOPG - Journal Entry Posting  *
     C                     END                             *FI
      *                                                                   CGL002
      ** Check if Block GL Accounts Enhancement feature is installed      CGL002
      *                                                                   CGL002
     C                     CALL 'AOSARDR0'                                CGL002
     C           WUAPRC    PARM WUAPRC    UUAPRC  7                       CGL002
     C                     PARM '*VERIFY' UUAPOP  7                       CGL002
     C                     PARM 'CGL002'  UUSARN  6                       CGL002
     C           D@SARD    PARM *BLANKS   UUFDY                           CGL002
      *                                                                   CGL002
     C           WUAPRC    IFEQ *BLANKS                                   CGL002
     C                     MOVE 'Y'       CGL002  1                       CGL002
     C                     ELSE                                           CGL002
     C                     MOVE 'N'       CGL002                          CGL002
     C                     ENDIF                                          CGL002
      *                                                                   CGL002
      * Initialise subfile control
     C                     EXSR MEIZ#2
     C/COPY WNCPYSRC,GL0182MC07
      *                                                                   CGL008
     C           KCAUAC    KLIST                                          CGL008
     C**********           KFLD           WWACCD  40       Account Code                CGL008 CGL029
     C                     KFLD           WWACCD 100                                          CGL029
     C                     KFLD           WMUSRP           Reference USRP CGL008
      *                                                                   CGL008
      ** Access SAR details file to see if CGL008 SAR is installed.       CGL008
      *                                                                   CGL008
     C                     CALL 'AOSARDR0'                                CGL008
     C                     PARM *BLANKS   @RTCD   7                       CGL008
     C                     PARM '*VERIFY' @OPTN   7                       CGL008
     C                     PARM 'CGL008'  @SARD   6                       CGL008
      *                                                                   CGL008
     C           @RTCD     IFEQ *BLANK                                    CGL008
     C                     MOVE 'Y'       CGL008  1                       CGL008
     C                     OPEN SFACAUL0                                  CGL008
     C                     OPEN MUSER                                     CGL008
      *                                                                   CGL008
      ** Check the User details extension to retrieve the journal entry   CGL008
      ** authorisation                                                    CGL008
      *                                                                   CGL008
     C           WUUSID    CHAINMUSER                22                   CGL008
     C           *IN22     IFEQ *OFF                                      CGL008
      *                                                                   CGL008
      ** Verify the content of the 'Access to all account codes' field    CGL008
      *                                                                   CGL008
     C                     MOVE ALACOD    WMACOD  1                       CGL008
     C                     MOVE REFUSR    WMUSRP 10                       CGL008
     C                     ENDIF                                          CGL008
     C                     ELSE                                           CGL008
     C                     MOVE 'N'       CGL008                          CGL008
     C                     ENDIF                                          CGL008
      *                                                                   CGL008
     C                     CALL 'AOSARDR0'                                                    CGL148
     C                     PARM *BLANKS   @RTCD                                               CGL148
     C                     PARM '*VERIFY' @OPTN                                               CGL148
     C                     PARM 'CGL148'  @SARD                                               CGL148
      *                                                                                       CGL148
     C           @RTCD     IFEQ *BLANKS                                                       CGL148
     C                     MOVE 'Y'       CGL148  1                                           CGL148
     C                     ELSE                                                               CGL148
     C                     MOVE 'N'       CGL148                                              CGL148
     C                     ENDIF                                                              CGL148
      *================================================================
     CSR         ZZEXIT    ENDSR
     O**  Add item error message array                                    CGL002
     O*00/Copy Member GL0182M   Initialise Program O-Spec
     O/COPY WNCPYSRC,GL0182MOPG
** CPY@
(c) Finastra International Limited 2001
**
F3=Batch Summary    F5=Refresh    F8=Calculate Posting Amounts
F3=Batch Summary    F5=Refresh
** Item Error Message                                                     CGL002
Err:
