0001 H***********                                                         S01194
0001 H        1                                                           S01194
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Transfer foreign ccy inc and expense')        *
      *****************************************************************
      *                                                               *
      *  Midas  GENERAL LEDGER MODULE                                 *
      *                                                               *
      *  GL0800 - (REWRITE)  TRANSFER OF FOREIGN CCY. INCOME &        *
      *           EXPENSE TO BASE CCY AND TRANSFER TO PROFIT &        *
      *           LOSS, IF NECESSARY.                                 *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. MD037086           Date 21Jan16               *
      *                 MD036521           Date 02Dec15               *
      *                 MD020563           Date 21May13               *
      *                 AR1097176          Date 22Mar13               *
      *                 CFC006             Date 06Aug12               *
      *                 AR865963           Date 30Jul12               *
      *                 CRE073             Date 06Dec10               *
      *                 AR787620           Date 10Jun11               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CSC042             Date 16Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 248795             Date 06Jul07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CGL052             Date 03Feb06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CGL020             Date 12Dec02               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01Mar99               *
      *                 CTI002             Date 23Sep98               *
     F*                 112277             DATE 01JUN98               *
     F*                 096487             DATE 09FEB98               *
     F*                 110241             DATE 10MAR97               *
     F*                 101582             DATE 06Jan98               *
     F*                 100543             DATE 27AUG96               *
     F*                 S01408             DATE 25JUL96               *
     F*                 S01408             DATE 25JAN96               *
     F*                 S01408             DATE 05SEP95               *
     F*                 S01408             DATE 18AUG95               *
     F*                 087944             DATE 09JUN95               *
     F*                 088568             DATE 02JUN95               *
     F*                 086125             DATE 16MAR95               *
     F*                 S01522             DATE 25JAN95               *
     F*                 S01408             DATE 10MAR95               *
     F*                 084504             DATE 10MAR95               *
     F*                 064335             DATE 03MAR94               *
     F*                 S10736             DATE 03SEP92               *
     F*                 E33769             DATE 02JUL92               *
     F*                 E25969             DATE 11SEP91               *
     F*                 S01314             DATE 07MAR89               *
     F*                 S01182             DATE 07FEB89               *
     F*                 LN0889             DATE 23OCT90               *
     F*                 E21839             DATE  1OCT90               *
     F*                 E15192             DATE  1OCT90               *
     F*                 BHF240             DATE 01JUL90               *
     F*                 BHF100             DATE 26JUN90               *
     F*                 BHF117             DATE 08JUN90               *
     F*                 S01117             DATE 28/02/89              *
     F*                 S01194             DATE 28/02/89              *
     F*                 E15781             DATE 31/01/89              *
     F*                 E11059             DATE 19/02/88              *
     F*                 E10858             DATE 15/05/87              *
     F*                 E10859             DATE 15/05/87              *
     F*                 E10599             DATE 08/04/87              *
     F*                 S01099             DATE 22/05/86              *
     F*                                                               *
     F*---------------------------------------------------------------*
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  MD037086 -  GLC39 00001 in MSGW during COB run               *
      *  MD036521 -  Error encountered in Branches maintenance        *
      *               during Enquire, Edit action (Recompile)         *
      *  MD020563 - CFC006 issues                                     *
      *  AR1097176 - Accessing AOCOMR0 multiple times slows down      *
      *              the system                                       *
      *  CFC006 - COB Restructure - Remove reports from COB           *
      *  AR865963 - GLC35XB COB component failed due to FOOB. Applied *
      *             fix 250521. (Child: AR865964)                     *
      *  250521 - Split the postings if it is bigger than PSTA field  *
      *           (13,0) to avoid truncation of the most significant  *
      *           figure.                                             *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,GLH00073                                 *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *  CSC042 - COB performance fix.                                *
      *           Keep number of calls to AOCUST to a minimum by      *
      *           reusing data if current lookup is same as previous  *
      *  248795 - Increase size of account code arrays to prevent     *
      *           array index error.                                  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CGL052 - Upgrade LBV058 to Midas Plus.                       *
      *           Amend Washout Processing.                           *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
     F*           Information (Recompile)                             *
      *  CGL007 - Account Postings Enquiry (Recompile)                *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  112277 - Transfer postings should not have profit centres.   *
     F*  096487 - Value dates for transfer postings should be the     *
     F*           Accrual Profit Date, instead of the run date.       *
     F*  110241 - Correct processing with no base ccy equivalent      *
     F*  101582 - CCY on UDC posting narrative is always base ccy     *
     F*         - Compress narratives to allow new batch number       *
     F*  100543 - Array index error in GL0800. Fix 087944 incomplete; *
     F*           also need to increase field MAX to 5,0 to cater for *
     F*           more than 999 account codes.                        *
     F*         - Remove DS definition with no subfields.             *
     F*  S01408 - Addition of core hook   GL0800CP15                  *
     F*  S01408 - Addition of core hook   GL0800CP14                  *
     F*  S01408 - Addition of core hook   GL0800CCP3                  *
     F*                                   GL0800CCP4                  *
     F*                                   GL0800CCP5                  *
     F*                                   GL0800CCP6                  *
     F*                                   GL0800CCP7                  *
     F*                                   GL0800CCP8                  *
     F*                                   GL0800CCP9                  *
     F*                                   GL0800CC10                  *
     F*                                   GL0800CC11                  *
     F*                                   GL0800CC12                  *
     F*                                   GL0800CC13                  *
     F*                                   GL0800FFP1                  *
     F*  S01408 - Addition of core hook   GL0800CCP2                  *
     F*  087944 - Increase size of 'X' and 'Y' to 5,0 to prevent      *
     F*           array index errors.                                 *
     F*  088568 - Array index X overlaps with Y resulting in very few *
     F*           accounts being transferred. This problem has been   *
     F*           introduced by SC 084504.                            *
     F*  086125 - Add new parameter to AOPNARR0                       *
     F*  S01522 - Call to AOPNARR0 if switchable feature installed    *
     F*           and UDC present                                     *
     F*  S01408 - Addition of core hooks  GL0800CCPG                  *
     F*                                   GL0800CADU                  *
     F*                                   GL0800CCP1                  *
     F*  084504 - Increase size of 'X' to 4,0 to prevent array        *
     F*           index errors.                                       *
     F*  064335 - Maintain Transfer of Foreign Ccy I/E To Base Ccy to *
     F*           the orig. customer when BKFCRC is 'B' or 'C'; and   *
     F*           to the orig. a/c seq no when BKFCRC is 'B' or 'S'.  *
     F*  S10736 - Management Accounting                               *
     F*  E33769 - Base currency income/expense transfer produces a    *
     F*           one page report per branch with no headings and     *
     F*           no data.  /Limited the opening and closing of       *
     F*           printer file GL0800P1 and ENDBRN (End of Branch)    *
     F*           exception printing to only the foreign curency      *
     F*           transfer processing. Also conditioned ENDBRN        *
     F*           to print only if there are details for branch.      *
     F*  E25969 - ALWAYS PERFORM TRANSFER OF FOREIGN CURRENCY         *
     F*           INCOME AND EXPENSE IF IT IS REQUIRED (I.E. WHEN     *
     F*           FORB = F)                                           *
     F*  S01314 - Changes made during PTF incorporation: the END      *
     F*           statement for E15192 was in the wrong place         *
     F*  S01182 - Writes new account posting fields to the            *
     F*           Generated Entries file PF/GEXFPD for MIS.           *
     F*  LN0889 - WHEN NO DETAILS TO REPORT P1 REPOST SHOULD NOT      *
     F*           BE PRODUCED.                                        *
     F*           WHEN NOT TRANSFERRING TO P/L SAY SO ON AU.          *
     F*  E21839 - POSTINGS CREATED FOR FCCY IN/EX TRANSFER TO         *
     F*           P/L AC NO LONGER RELEVANT AS FCCY IS NOW            *
     F*           TRANSFERED TO BCCY WHEN GL0800 RUN IN 'F' MODE'     *
     F*           AND THEN IN/EX TRANSFERED TO P/L IN 'B' MODE        *
     F*  E15192 - RUN PROGRAM IN TWO MODES TO SPLIT TRANS             *
     F*           FCCY AND TRANS BCCY. (MODES 'F' AND 'B'             *
     F*           RESPECTIVELY.) GL0080P1 NOT PRODUCED FOR MODE 'B'   *
     F*           FIX ALSO CATERS FOR 'NO DETAILS' SO E15781          *
     F*           REMOVED                                             *
     F*  BHF240 - ONLY WRITE TO GL0800P1 EXCPT ERROR WHEN FILE        *
     F*           OPEN                                                *
     F*  BHF100 - SDCURRL0 POSITIONS DEFINED INCORRECTLY              *
     F*  BHF117 - BRCA WAS BLANK, NEED TO MOVE IN A8BRCD              *
     F*  S01117 - MULTIBRANCHING                                      *
     F*  S01194 - NEW STANDING DATA                                   *
     F*  E15781 - NEITHER HEADINGS OR 'NO DETAILS' MESSAGE ARE        *
     F*           PRINTED FOR EMPTY FILE                              *
     F*  E11059 - EXCEPTION OUTPUT OF 'TITLE' (+NEW PAGE) OCCURS      *
     F*           EVEN IF THERE ARE NO DETAILS FOR THIS PAGE.         *
     F*  E10858 - INCREASE INCOME AND EXPENSE ARRAY                   *
     F*  E10859 - REPORT PRINTS PAGES FOR DELETED BRANCHES            *
     F*  E10599 - TRANSFER FOREIGN CURRENCY AND BASE CURRENCY         *
     F*           INCOME/EXPENSE NOT WORKING DUE TO INVALID           *
     F*           BRANCH CODE.                                        *
     F*  S01099 - REWRITE AND INCLUDE TRANSFER OF BASE CURRENCY       *
     F*           INCOME/EXPENSE TO PROFIT AND LOSS IF REQUIRED       *
     F*                                                               *
0013 F*****************************************************************
     F*                                                               *
     F*                INDICATOR USAGE
     F*
     F*      20      Foreign currency, 0 decimal places
     F*      21      Foreign currency, 1 decimal place
     F*      22      Foreign currency, 2 decimal places
     F*      23      Foreign currency, 3 decimal places
     F*
     F*      25      Negative old year to date balance
     F*      26      Negative ledger balance
     F*      27      Negative new year to date balance
     F*
     F*      30      Transfer to profit+loss required
     F*
     F*      32      Multibranch indicator = 'Y'                          S01117
     F*                                                                   S01117
     F*      60      To control output of first page for each branch.     E11059
     F*******61******Controls 'No details' exception output.        E15781E15192
     F*      62      Controls 'No details' exception output for           S01117
     F*              specific branch when all branches are requested      S01117
     F*      63      Transfer of F/C income & expense for a specific      S01117
     F*              branch                                               S01117
     F*      64      Conditions header output                             S01117
     F*                                                                   S01117
     F*******70**    ICD 1-3 table records end of file                    S01194
     F*      71      Table file - end of account codes (TABGL)
     F*      72      Branch file - end of file
     F*      73      Accounts file - end of READE for branch/acc code
     F*
     F*      75      General Purpose
     F*
     F*****************************************************************
     F*ABTB10*IF* E                    DISK                               S01194
      ***Installation*Control*Data #1                                     S01194
     F*ABTB11*IF* E                    DISK                               S01194
      ***Installation*Control*Data #2                                     S01194
     F*ABTB20*IF* E                    DISK                               S01194
      ***Installation*Control*Data #3                                     S01194
     F*ABTG30*IT* F      40           EDISK                               S01194
      ***Currency*Details*for*pre-execution time array                    S01194
     F*ABLETR*IF* E                    DISK                               S01194
      ***Branch*Codes*********                                            S01194
     F*ABGL***IF* E           K        DISK                               S01194
      ***Accounting*Codes*Details                                         S01194
     F*********** TABLETAF                          KIGNORE               S01194
     F*********** TABTB10F                          KIGNORE               S01194
     F*********** TABTB11F                          KIGNORE               S01194
     F*********** TABTB20F                          KIGNORE               S01194
     F*********** TABTB30F                          KIGNORE               S01194
     F*********** TABTE20F                          KIGNORE               S01194
     F*********** TABTG10F                          KIGNORE               S01194
     F*********** TABTG20F                          KIGNORE               S01194
     F*********** TABLETJF                          KIGNORE               S01194
     F*********** TABLETKF                          KIGNORE               S01194
     F*********** TABLETPF                          KIGNORE               S01194
     F*********** TABLETQF                          KIGNORE               S01194
     F*********** TABLETRF                          KIGNORE               S01194
     F*********** TABLETVF                          KIGNORE               S01194
     F*********** TABLETWF                          KIGNORE               S01194
     F*********** TABLETZF                          KIGNORE               S01194
     F*********** TABLET3F                          KIGNORE               S01194
     F*********** TABLETXF                          KIGNORE               S01194
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL0800FFP1                                           S01408
     FSDBRCHY0IF  E           K        DISK                           UC                      CGL052
      ** Branch Extension details                                                             CGL052
     FSDACODY0IF  E           K        DISK                           UC                      CGL052
      ** Branch Extension details                                                             CGL052
     F*                                                                   S01408
     FSDBRCHL1IF  E           K        DISK                               S01194
      ** Branch Details                                                   S01194
     FSDACODL0IF  E           K        DISK                               S01194
      ** Account Code Details                                             S01194
     F*SDCURRL0IT**F*****202           EDISK                       S01194 BHF100
     F***SDCURRL0IT  F     208           EDISK                                         BHF100 CGL029
     FSDCURRL0IT  F     718           EDISK                                                   CGL029
      ** Currency Details for pre-execution time array                    S01194
     FACCNR   UF  E           K        DISK
      ** Account Master in Branch Code/Account Code Sequence
     FGEXFHH  O   E                    DISK
      ** Generated Entries Header file
     FGEXFPD  O   E                    DISK
      ** Generated Entries Details
     FGEXFZZ  UF  E                    DISK                      A
      ** Generated Entries Trailer
      ** N.B  Defined as an update file only to rename field: dummy
      **      read performed after LR set on.
     F*L0800P3O** F     132            PRINTER                            S01117
      ** Data Base Error
     F*L0800P2O** F     132            PRINTER                            S01117
      ** File Control Report
     F*L0800P1O** F     132            PRINTER      KPRTCTLPRTDS          S01117
     FGL0800P1O   F     132            PRINTER      KPRTCTLPRTDS      UC  S01117
     F                                              KINFDS OFLOW          S01103
     FGL0800AUO   F     132            PRINTER                            S01117
     F                                              KINFDS SPOOL          S01117
      ** Foreign Currency Income and Expense Report
      /EJECT
     E                    CPY@    1   1 80
     E****TABTG30         CUR     1 150  3   CYD    37                    S01194
     E****SDCURRL0********CUR     1 150  3   CYD   199             S01194 BHF100
     E****SDCURRL0        CUR     1 150  3   CYD   205                                 BHF100 CGL029
     E    SDCURRL0        CUR     1 150  3   CYD   235                                        CGL029
      ** Pre-execution time array: Currency Codes in CUR, corresponding
      ** details in CYD
     E/COPY WNCPYSRC,GL0800E001
     E** Transfer at end of year flag for income/expense accounts                             CGL052
     E**********          ACF      1500  1                                           CGL052 MD037086
     E                    ACF      9999  1                                                  MD037086
     E                    NAR     1   3 30
     E** Posting narratives
     E********************ACD       500  4 0                              E10858
     E***********         ACD      1500  4 0                        E10858S01194
     E**********          ACD      1500  4                                             S01194 CGL029
     E**********          ACD      1500 10                                             CGL029 248795
     E                    ACD      9999 10                                                    248795
     E** Income/expense accounting codes
     E**********          ACS      1500  2                                             S10736 248795
     E                    ACS      9999  2                                                    248795
     E** Income/expense account sections                                  S10736
     E                    ATY       150  1
     E** Account types for trade equivalent account codes (held in same
     E** order as currencies in CUR
     E                    ASC       150  2                                S10736
     E** Account sections for trade equivalent account codes (held in     S10736
     E** same order as currencies in CUR)                                 S10736
0137 E                    ZYDY    4   4  4 0             ZDATE1 YEAR
0138 E                    ZMDY   13  13  3 0             ZDATE1 MONTH
0139 E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E* Text for report                                                   E15192
     E**********          TXT     1   8 60               Report text      E15192
     E                    TXT     1   9 60               Report text      E15192
      /SPACE 3
     IACCNTABF
     I              CNUM                            #CNUM
     I              CCY                             #CCY
     I              ACOD                            #ACOD
     I              ACSQ                            #ACSQ
     I              ATYP                            #ATYP
     I              PRFC                            #PRFC                 112277
     IAPOSTZZF
     I*             ZZ0017                          #Z0017
     I*                                                                   S01103
     I/COPY WNCPYSRC,GL0800I006
     IOFLOW       DS                                                      S01103
     I* Overflow line from INFDS                                          S01103
     I                                       83  90 SFILE                 S01117
     I                                    B 123 1240SFNUM                 S01117
     I                                    B 188 1890OVFLW                 S01103
     ISPOOL       DS                                                      S01117
     I                                       83  90 SFILEU                S01117
     I                                    B 123 1240SFNUMU                S01117
     IPRTDS       DS
     I                                        8   90CURLIN
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      /SPACE
     ILDA        UDS                            256
     I***********                           131 141 DBFILE                S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY
     I                                      142 153 DBTABK
     I                                      171 180 DBPGM
     I***********                           181 183 DBASE                 S01194
     I                                      181 1830DBASE                 S01194
     I/COPY WNCPYSRC,GL0800I003
      /SPACE
     I            DS
     I** Ccy details from array CYD
     I***********                             1  37 CCYDET                S01194
     I***********                             1   10CDP                   S01194
     I***********                         P   2   88SPOT                  S01194
     I***********                             9   90MDIN                  S01194
     I***********                            32  350TACC                  S01194
     I*************                           1 199 CCYDET         S01194 BHF100
     I*************                           1   40TACC           S01194 BHF100
     I*************                       P  39  458SPOT           S01194 BHF100
     I*************                          49  490CDP            S01194 BHF100
     I*************                          76  76 MDIN           S01194 BHF100
     I**********                              1  80 CCYDET                             BHF100 CGL029
     I                                        1 110 CCYDET                                    CGL029
     I/COPY WNCPYSRC,GL0800I005
     I**********                              1   40TACC                               BHF100 CGL029
     I**********                              1   4 TACCA                              110241 CGL029
     I                                        1  100TACC                                      CGL029
     I                                        1  10 TACCA                                     CGL029
     I/COPY WNCPYSRC,GL0800I004
     I**********                          P  43  498SPOT                               BHF100 CGL029
     I**********                             53  530CDP                                BHF100 CGL029
     I**********                             80  80 MDIN                               BHF100 CGL029
     I                                    P  73  798SPOT                                      CGL029
     I                                       83  830CDP                                       CGL029
     I                                      110 110 MDIN                                      CGL029
      /SPACE
     I            DS
     I** Definition of alpha dates for today and next working day
     I** to test for end of month.
     I                                        1   7 ZADATE
     I                                        3   5 ZMMM
     I***********                             8  14 RUNA                  S01194
     I                                        8  14 TODAY                 S01194
     I                                       10  12 RUNMMM
      /SPACE
     I** Set up of special posting narratives
     I            DS
     I                                        1  30 PNAR2
     I**********                              1  14 PNTR                  101582
     I**********                             15  200#CNUM                 101582
     I**********                             21  23 #CCY                  101582
     I**********                             24  270#ACOD                 101582
     I**********                             28  290#ACSQ                 101582
     I**********                              1  11 PNTR                               101582 CGL029
     I**********                             12  170#CNUM                              101582 CGL029
     I**********                             18  20 #CCY                               101582 CGL029
     I**********                             21  240#ACOD                              101582 CGL029
     I**********                             25  260#ACSQ                              101582 CGL029
     I                                        1   8 PNTR                                      CGL029
     I                                        9   9 SP                                        CGL029
     I**********                             10  150#CNUM                              CGL029 CSD027
     I                                       10  15 #CNUM                                     CSD027
     I                                       16  18 #CCY                                      CGL029
     I                                       19  280#ACOD                                     CGL029
     I                                       29  300#ACSQ                                     CGL029
     I            DS
     I                                        1  30 PNAR3
     I**********                              1  14 PNTR2                 101582
     I**********                             15  200BICN                  101582
     I**********                             21  23 BCCY           S01194 101582
     I**********                             24  270PACOD                 101582
     I**********                             28  290ASQ01                 101582
     I                                        1  11 PNTR2                 101582
     I**********                             12  170BICN                               101582 CSD027
     I                                       12  17 BICN                                      CSD027
     I                                       18  20 BCCY                  101582
     I                                       21  240PACOD                 101582
     I                                       25  260ASQ01                 101582
      /SPACE
     I            DS
     I*  No. of income/expense a/c code in array ACD                      100543
     I                                        1   50MAX                   100543
     I***Key*for*accessing acode tables                                   S01194
     I***********                             1  12 TABKEY                S01194
     I***********                             1   20RECT30                S01194
     I***********                             3   7 BLANK5                S01194
     I***********                             8  110KACOD                 S01194
     I***********                            12  120STYPE                 S01194
     I***No.*of*income/expense*a/c*code*in*array*ACD**              S01194100543
     I***********                            13  150MAX                   100543
      /SPACE
     I            DS
     I* Special account types
     I                                        1   1 BSEQTY
     I                                        2   2 TRDTY
     I                                        3   3 PLTY
      /SPACE
     I            DS
     I* Hash totalling fields
     I                                        1  153ZZAMT
     I                                       16  300ZZAMTI
     I                                       31  450ZZTOTI
     I                                       46  480ZZAMTD
     I                                       49  510ZZTOTD
     I                                       52  660SUBTOT
      /SPACE
     I            DS
     I                                        1  150NEWYTD
      /SPACE
     I* Conversion routine work fields
     I            DS
     I                                        1  150AMT0
     I                                        1  151AMT1
     I                                        1  152AMT2
     I                                        1  153AMT3
     I            DS
     I                                        1  150BASAM0
     I                                        1  151BASAM1
     I                                        1  152BASAM2
     I                                        1  153BASAM3
     I***/COPY*WNCPYSRC,GL0800I001                                                            CFC006
     I/COPY WNCPYSRC,GL0800I001                                                             MD020563
     I            DS
     I* Record/entries count
     I                                        1   60RECCNT
     I                                        7  120ENTCNT
     I            DS
     I* Base currency trade equiv account code, decimal places
     I**********                              1   40BSTACC                                    CGL029
     I**********                              5   50BASDP                                     CGL029
     I                                        1  100BSTACC                                    CGL029
     I                                       11  110BASDP                                     CGL029
     I************DS                                                      100543
     I**Redefinition*of TABGL key account codes                           S01194
     I***********                             1  12 KEY                   S01194
     I***********                             8  110ACODE                 S01194
     I***********                            12  120SREC                  S01194
     I            DS
     I* Handling of composite key to read accounts logical file
     I                                        1  12 BCHKEY
     I***********                            10  120BRCH                  S01117
     I***********                            13  160KLACD                 S01117
     I            DS
     I* General purpose array index
     I******                                  1   30X                     084504
     I******                                  1   40X              084504 087944
     I                                        1   50X                     087944
     I* Array index for controlling SETLL on ACCNR
     I**********                              4   60Y                     088568
     I            DS                                                      088568
     I******                                  1   30Y              088568 087944
     I                                        1   50Y                     087944
     I*                                                                   S01194
     I*    Data structure for external dataarea RUNDAT                    S01194
     I*                                                                   S01194
     IRUNDT       DS                                                      S01194
     I                                        1   7 RUNA                  S01194
     I                                    P   8  100RUND                  S01194
     I                                       11  11 SSF                   S01194
     I                                       12  12 DATF                  S01194
     I                                       13  13 MBIN                  S01194
     I**                                                                  S01194
     I**   Define External DS over Dummy Physical Files                   S01194
     I**                                                                  S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I*    Bank Details                                                   S01194
     i*                                                                   S01194
     ISDMMOD    E DSSDMMODPD                                              S01522
     I* Module Details Accessed via access program                        S01522
     I*                                                                   S01522
     ISCSARD    E DSSCSARDPD                                              S01522
     I* SAR File Details Accessed via Access Program AOSARDR0             S01522
     I*                                                                   S01522
     ICGPNAR    E DSCGPNARPD                                              S01522
     I* UDC Multi-Language Narrative Data Structure                       S01522
     I*                                                                   S01522
     I##PRM1      DS                                                      086125
      **  Data Structure for Customer and Branch                          086125
      *                                                                   086125
     I                                        1   6 A#CUST                086125
     I                                        7   9 A#BRCA                086125
      *                                                                   086125
     ISDCUST    E DSSDCUSTPD                                              S01522
     I**  Customer Details                                                S01522
     I*                                                                   S01522
     ISDGELR    E DSSDGELRPD                                              S01194
     I*    General Ledger Details                                         S01194
     I*                                                                   S01194
     I              QQACCD                          QQACC1                                    CGL029
     ISDTRAD    E DSSDTRADPD                                              S01194
     I*    Trading Data                                                   S01194
     I*                                                                   S01194
     I              QQACCD                          QQACC2                                    CGL029
     ISDACOD    E DSSDACODPD                                              S01194
     I*    Account Code Details                                           S01194
     I*
     I              QQACCD                          QQACC3                                    CGL029
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01522
     IDSSDY     E DSDSSDY                                                 S01522
     I*  SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE               S01522
     I*****************************************************************
     I***/COPY*WNCPYSRC,GL0800I002                                                            CFC006
     I/COPY WNCPYSRC,GL0800I002                                                             MD020563
     I              9999999999900         C         WLMTPA                                    250521
     I              'GL0800001'           C         SECTN                                     CFC006
     C/EJECT
     C**                                                                  S01117
     C*****************************************************************
     C**                  Compiler Directives                        **
     C*****************************************************************
     C*                                                                   E15192
     C           *ENTRY    PLIST                                          E15192
     C                     PARM           FORB    1                       E15192
     C*                                                                   E15192
     C           KLIST1    KLIST
     C***********          KFLD           BRCH                            S01117
     C                     KFLD           BRCA                            S01117
     C**********           KFLD           KLACD   40                                          CGL029
     C                     KFLD           KLACD  100                                          CGL029
     C/COPY WNCPYSRC,GL0800C035
     C*    DEFINE LDA                                                     S01117
     C           *NAMVAR   DEFN           LDA                             S01117
      /SPACE 3
     C*****************************************************************
     C**                  Main Processing
     C*****************************************************************
     C*****Main*processing.*For*every*branch*on*TABLETR,*read*all*open*   S01194
     C*    Main processing. For every branch on SDBRCHL1,read all open*   S01194
     C*    account master records for each income/expense accounting  *
     C*    code held in the array ACD.                                *
     C*     1. If account currency differs from base,  detail line    *
     C*        written to GL0800P1 and postings generated (if non-zero*
     C*        ledger balance). Year to date total on account record  *
     C*        updated.                                               *
     C*     2. If account is in base currency, postings may or may not*
     C*        be required,  depending on whether or not transfer to  *
     C*        profit and loss is required.                           *
     C*****************************************************************
      /SPACE 2
      * Initialisation
     C                     EXSR AINIT
     C           *INU7     CABEQ'1'       TAGOUT
     C*                                                                   S01117
     C* Set to start of branch code file                                  S01117
     C                     MOVE *BLANKS   W@BRKY  3                       S01117
     C           W@BRKY    SETLLSDBRCHL1                                  S01117
      /SPACE
      * Loop until all branch table records read
     C           *IN72     DOUEQ'1'                         B001
     C           RDAGN     TAG                                            E10859
     C*                                                                   S01117
     C***********          READ TABLETR                  72               S01194
     C                     READ SDBRCHL1                 72               S01194
     C*                                                                   S01117
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CP14                                           S01408
      ** If CGL052 is on and the program is to process foreign                                CGL052
      ** currency accounts, access the branch code extension file                             CGL052
      ** SDBRCHY0 to see if this branch allows the transfer of                                CGL052
      ** foreign currency accounts at year end only, or not.                                  CGL052
      ** Assume a value of 'N' for the flag if no record found.                               CGL052
      *                                                                                       CGL052
     C           CGL052    IFEQ 'Y'                                                           CGL052
     C           *IN72     ANDEQ*OFF                                                          CGL052
     C           FORB      ANDEQ'F'                                                           CGL052
     C                     MOVE *IN99     SVIN99  1                                           CGL052
     C           A8BRCD    CHAINSDBRCHF0             99                                       CGL052
      *                                                                                       CGL052
     C           *IN99     IFEQ *ON                                                           CGL052
     C                     MOVE 'N'       A8ATEY                                              CGL052
     C                     ENDIF                                                              CGL052
      *                                                                                       CGL052
     C                     MOVE SVIN99    *IN99                                               CGL052
     C                     ENDIF                                                              CGL052
     C*                                                                   S01408
     C                     MOVE A8BICN    BICN                            S01194
     C/COPY WNCPYSRC,GL0800C005
     C                     MOVE A8BRCD    BRCA                            BHF117
     C                     MOVE '0'       *IN60                           E11059
     C***********RECI      IFEQ '*'                                 E10859S01194
     C************IN72     ANDEQ'0'                                 E10859S01194
     C***********          GOTO RDAGN                               E10859S01194
     C***********          END                                      E10859S01194
     C*                                                                   S01117
     C/COPY WNCPYSRC,GL0800C001
      /SPACE
     C*                                                                   E25969
     C** PERFORM TRANSFER IF BASE CURRENCY TRANSFER REQUIRED (*IN30 ON)   E25969
     C** OR IF THIS IS A FOREIGN CURRENCY INCOME/EXPENSE                  E25969
     C**    TRANSFER (FORB= F)                                            E25969
     C*                                                                   E25969
     C           *IN72     IFEQ '0'                         B002
     C           *IN30     ANDEQ'1'                         B002          LN0889
     C           *IN72     OREQ '0'                         B002          E25969
     C           FORB      ANDEQ'F'                         B002          E25959
     C*                                                                   E33769
     C**  Perform End of Branch printing and GL0800P1 file handling       E33769
     C**  only if not a Base Currency transfer                            S01117
     C*                                                                   E33769
     C           FORB      IFNE 'B'                                       E33769
     C*                                                                   E33769
     C           *IN62     IFEQ '1'                                       E33769
     C***/COPY*WNCPYSRC,GLH00597                                                              CFC006
     C/COPY WNCPYSRC,GLH00597                                                               MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
     C                     EXCPTENDBRN                                    S01117
     C                     END                                            E33769
     C*                                                                   E33769
     C                     CLOSEGL0800P1                                  S01117
     C                     OPEN GL0800P1                                  S01117
     C                     SETON                     64                   S01117
     C                     Z-ADD0         PAGE1                           S01117
     C*                                                                   S01117
     C**  ENSURE REPORT SPOOL FILE RECORDED BY RCF IF MULTIBRANCHING      S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUM     SFNO    60                      S01117
     C                     OUT  LDA                                       S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ     5                       S01117
     C                     PARM A8BRCD    SENTY   3                       S01117
     C                     PARM           SFILE                           S01117
     C                     PARM           SFNO                            S01117
     C                     PARM           ZSERR   1                       S01117
     C*                                                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C* ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAMME       S01117
     C*                                                                   S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C                     END                                            E33769
0170 C**                                                                  S01117
      * New page per branch
     C*********************MOVELKEY       BCHKEY                          E10599
     C***********          MOVE BRCD      BRCH                      E10599E10599
     C                     MOVE BRCA      BCHKEY                          E10599
     C*********************EXCPTTITLE                                     E11059
     C                     Z-ADD0         Y
     C                     MOVE BRCA      BRNO    3                       S01117
     C                     SETOF                     62                   S01117
     C                     SETOF                     63                   S01117
     C/COPY WNCPYSRC,GL0800C039
      /SPACE
     C* Read all accounts for each account code in ACD
     C                     DO   MAX                         B003
     C                     ADD  1         Y
     C***********          Z-ADDACD,Y     KLACD                           S01194
     C                     MOVE ACD,Y     KLACD                           S01194
     C           KLIST1    SETLLACCNR                    75
     C           *IN75     CABEQ'0'       TAG10             None
      /SPACE
     C* Read accounts for this branch/account code
     C           *IN73     DOUEQ'1'                         B004
     C           KLIST1    READEACCNR                    73
     C           *IN73     IFEQ '0'                         B005
     C           ACST      ANDNE'C'
     C/COPY WNCPYSRC,GL0800C038
      ** If CGL052 is on and the program is to process a foreign                              CGL052
      ** currency account, always allow it except when the account                            CGL052
      ** must be transferred at end of year only and it is not EoY.                           CGL052
      *                                                                                       CGL052
     C                     MOVE 'Y'       WWPACC  1        Allows Process                     CGL052
      *                                                                                       CGL052
     C           CGL052    IFEQ 'Y'                        CGL052 on                          CGL052
     C           FORB      ANDEQ'F'                        Process Foreign                    CGL052
     C           #CCY      ANDNEBJCYCD                     Foreign Ccy                        CGL052
     C           BJEYD     ANDGEBJDNWD                     Not EoY                            CGL052
     C           A8ATEY    ANDEQ'Y'                        Brch allow EoY                     CGL052
     C           ACF,Y     ANDEQ'Y'                        AcCd allow EoY                     CGL052
     C                     MOVE 'N'       WWPACC                                              CGL052
     C                     ENDIF                                                              CGL052
      *                                                                                       CGL052
      ** Account transferred if all's right                                                   CGL052
      *                                                                                       CGL052
     C           WWPACC    IFEQ 'Y'                                                           CGL052
     C********File*contains some details to print                   E15781E15192
     C**N61****************SETON                         61         E15781E15192
     C  N62                SETON                         62               S01117
     C* Postings/details print routine
     C/COPY WNCPYSRC,GL0800C002
     C                     EXSR BPSPRT
      ** End of CGL052 enhancement                                                            CGL052
     C                     ENDIF                                                              CGL052
     C/COPY WNCPYSRC,GL0800C003
     C                     END                              E005
     C                     END                              E004
      **
     C           TAG10     TAG                               **TAG10**
     C                     END                              E003
     C*                                                                   S01117
     C********** *IN62     IFNE '1'                                 S01117LN0889
     C********** *IN63     ORNE '1'                                 S01117LN0889
     C**********           EXCPTNODET                               S01117LN0889
     C**********           END                                      S01117LN0889
     C*                                                                   S01117
     C                     END                              E002
     C/COPY WNCPYSRC,GL0800C014
     C                     END                              E001
     C/COPY WNCPYSRC,GL0800C020
      /SPACE
     C           TAGEB     TAG                                            S01117
      /SPACE                                                              S01117
     C                     EXSR CTERM
     C/SPACE
     C           TAGOUT    TAG                               **TAGOUT**
     C*                                                                   S01117
     C**  ENSURE REPORT SPOOL FILE RECORDED BY RCF IF MULTIBRANCHING      S01117
     C*                                                                   S01117
     C                     Z-ADDSFNUMU    SFNO1   60                      S01117
     C                     OUT  LDA                                       S01117
     C                     CALL 'ZSFILE'                                  S01117
     C                     PARM           SEQ                             S01117
     C                     PARM           SENTY                           S01117
     C                     PARM           SFILEU                          S01117
     C                     PARM           SFNO1                           S01117
     C                     PARM           ZSERR                           S01117
     C*                                                                   S01117
     C           *LOCK     IN   LDA                                       S01117
     C           ZSERR     IFEQ 'Y'                                       S01117
     C*                                                                   S01117
     C* ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAMME       S01117
     C*                                                                   S01117
     C                     SETON                     U7U8LR               S01117
     C                     RETRN                                          S01117
     C                     END                                            S01117
     C**                                                                  S01117
     C           *INU7     IFEQ '1'                         B001
     C           *INU8     ANDEQ'1'
     C***/COPY*WNCPYSRC,GLH00598                                                              CFC006
     C/COPY WNCPYSRC,GLH00598                                                               MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
     C* Report data base error
     C                     EXCPTERROR
     C                     END                              E001
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CCPG                                           S01408
     C*                                                                   S01408
     C                     SETON                     LR
     C                     RETRN
     C* Dummy read of GEXFZZ
     C                     READ GEXFZZ                   75
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*    Initialisation routine: sets up array of income/expense    *
     C*    accounting codes, decides if transfer to profit and loss   *
     C*    required, obtains paramaters from ICD tables.              *
     C*****************************************************************
      /SPACE 2
     C           AINIT     BEGSR
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CCP3                                           S01408
     C*                                                                   S01408
     C                     MOVEACPY@      BIS@   80
     C                     Z-ADD0         RECCNT
     C                     Z-ADD0         ENTCNT
     C                     Z-ADD0         AMT0
     C                     Z-ADD0         BASAM0
     C                     Z-ADD0         NEWYTD
     C                     Z-ADD0         ZZAMT
     C                     Z-ADD0         ZZAMTI
     C                     Z-ADD0         ZZTOTI
     C                     Z-ADD0         ZZAMTD
     C                     Z-ADD0         ZZTOTD
     C                     Z-ADD0         SUBTOT
     C                     Z-ADD0         X
     C                     Z-ADD0         VOIN                            S10736
     C                     Z-ADD235959    PTIM                            S10736
     C                     SUB  1         OVFLW                           S01103
     C*                                                                   S01182
     C**  INITIALISE ACCOUNT POSTING FIELDS FOR PF/EODPOPD.               S01182
     C                     Z-ADD*ZEROS    SDLB   150                      S01182
     C                     Z-ADD*ZEROS    SDCB   150                      S01182
     C                     MOVE *BLANKS   PRFC    4                       S01182
     C**********           MOVE *BLANKS   OTRF   15                                    S01182 CGL029
     C                     MOVE *BLANKS   OTRF   21                                           CGL029
     C                     MOVE *BLANKS   OTTP   10                       S01182
     C                     MOVE *BLANKS   OTST   10                       S01182
     C                     MOVE *BLANKS   BOKC    2                       S01182
     C/SPACE
     C                     MOVEL'GL0800'  DBPGM
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE *BLANKS   DBASE
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   SP                                                  CGL029
     C                     SETOF                     U7U8
     C*                                                                   E15192
     C           FORB      IFEQ 'F'                                       E15192
     C                     MOVE 'GE-XF'   SPOS                            E15192
     C                     MOVELTXT,1     F35    35                       E15192
     C                     MOVELTXT,2     F35U   35                       E15192
     C                     MOVELTXT,3     F55    55                       E15192
     C                     MOVELTXT,4     F55U   55                       E15192
     C                     MOVELTXT,5     F48    48                       E15192
     C                     ELSE                                           E15192
     C                     MOVE 'GE-XB'   SPOS                            E15192
     C                     MOVELTXT,6     F55                             E15192
     C                     MOVELTXT,7     F55U                            E15192
     C                     MOVELTXT,8     F48                             E15192
     C                     END                                            E15192
     C*                                                                   E15192
     C**                                                                  S01194
     C**   READ DTAARA 'RUNDAT'                                           S01194
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01194
     C                     IN   RUNDT                                     S01194
     C                     MOVE RUNA      TODAY                           S01194
     C**                                                                  S01194
     C**   CHECK MULTIBRANCHING INDICATOR AND TYPE OF REPORT REQUESTED    S01194
     C                     SETOF                     3234                 S01194
     C*                                                                   S01194
     C           MBIN      IFEQ 'Y'                        B1             S01194
     C                     SETON                     32                   S01194
     C                     END                             E1             S01194
     C/SPACE
     C***********          READ TABTB10                  70               S01194
     C************IN70     IFEQ '1'                         B001          S01194
     C***********          SETON                     U7U8                 S01194
     C***********          MOVEL'TABTB10' DBFILE            DBERR #1      S01194
     C***********          MOVEL'001'     DBASE                           S01194
     C***********          MOVEL'01      'DBTABK                          S01194
     C***********          MOVE '  10'    DBTABK                          S01194
     C***********          GOTO AEND                                      S01194
     C***********          END                              E001          S01194
     C**                                                                  S01194
     C**  Use access program to read bank detail file                     S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                     U7U8                 S01194
     C                     MOVEL'001'     DBASE             DBERR #1      S01194
     C                     MOVEL'SDBANKPD'DBFILE                          S01194
     C                     MOVEL@OPTN     DBKEY                           S01194
     C                     MOVEL@OPTN     DBOPTN  7                       S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO AEND                                      S01194
     C                     END                                            S01194
     c**                                                                  S01194
     C**  Save base currency in subfield of DS                            S01194
     C                     MOVELBJCYCD    BCCY                            S01194
     C*
     C***********          READ TABTB11                  70               S01194
     C************IN70     IFEQ '1'                         B001          S01194
     C***********          SETON                     U7U8                 S01194
     C***********          MOVEL'TABTB11' DBFILE            DBERR #2      S01194
     C***********          MOVEL'002'     DBASE                           S01194
     C***********          MOVEL'01      'DBTABK                          S01194
     C***********          MOVE '  11'    DBTABK                          S01194
     C***********          GOTO AEND                                      S01194
     C***********          END                              E001          S01194
     C**                                                                  S01194
     C**  Use access program to read general ledger detail file           S01194
     C**********           CALL 'AOGELRR0'                                S01194              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDGELR    PARM SDGELR    DSFDY                           S01194              CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                     U7U8                 S01194
     C                     MOVEL'002'     DBASE             DBERR #2      S01194
     C                     MOVEL'SDGELRPD'DBFILE                          S01194
     C                     MOVEL@OPTN     DBKEY                           S01194
     C                     MOVEL@OPTN     DBOPTN                          S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO AEND                                      S01194
     C                     END                                            S01194
     C*
     C***********          READ TABTB20                  70               S01194
     C************IN70     IFEQ '1'                         B001          S01194
     C***********          SETON                     U7U8                 S01194
     C***********          MOVEL'TABTB20' DBFILE            DBERR #3      S01194
     C***********          MOVEL'003'     DBASE                           S01194
     C***********          MOVEL'01      'DBTABK                          S01194
     C***********          MOVE '  20'    DBTABK                          S01194
     C***********          GOTO AEND                                      S01194
     C***********          END                              E001          S01194
     C**                                                                  S01194
     C**  Use access program to read trading data file                    S01194
     C                     CALL 'AOTRADR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDTRAD    PARM SDTRAD    DSFDY                           S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                     U7U8                 S01194
     C                     MOVEL'003'     DBASE             DBERR #3      S01194
     C                     MOVEL'SDTRADPD'DBFILE                          S01194
     C                     MOVEL@OPTN     DBKEY                           S01194
     C                     MOVEL@OPTN     DBOPTN                          S01194
     C                     EXSR *PSSR                                     S01194
     C                     GOTO AEND                                      S01194
     C                     END                                            S01194
     C***/COPY*WNCPYSRC,GL0800C006                                                            CFC006
     C/COPY WNCPYSRC,GL0800C006                                                             MD020563
      *****************************************************************           AR1097176 MD020563
      ***Check*if*CFC006*is*installed**********************************           AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
     C**********           MOVE 'N'       CFC006  1                               AR1097176 MD020563
     C**********           CALL 'AOSARDR0'                                        AR1097176 MD020563
     C**********           PARM *BLANKS   @RTCD                                   AR1097176 MD020563
     C**********           PARM '*VERIFY' @OPTN                                   AR1097176 MD020563
     C**********           PARM 'CFC006'  @SARD                                   AR1097176 MD020563
     C********** SCSARD    PARM SCSARD    DSSDY                                   AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
     C********** @RTCD     IFEQ *BLANKS                                           AR1097176 MD020563
     C**********           MOVE 'Y'       CFC006                                  AR1097176 MD020563
     C**********           ELSE                                                   AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
     C********** @RTCD     IFNE '*NRF   '                                         AR1097176 MD020563
     C**********           MOVEL'SCSARDPD'DBFILE                                  AR1097176 MD020563
     C**********           MOVEL'CFC006'  DBKEY                                   AR1097176 MD020563
     C**********           EXSR *PSSR                                             AR1097176 MD020563
     C**********           SETON                     U7U8LR                       AR1097176 MD020563
     C**********           GOTO AEND                                              AR1097176 MD020563
     C**********           ENDIF                                                  AR1097176 MD020563
     C**********           ENDIF                                                  AR1097176 MD020563
      *                                                                                       CFC006
      ** Enable output indicator for GL0800P1                                                 CFC006
      *                                                                                       CFC006
     C                     MOVEL'N'       SUPFLG  1                                           CFC006
      *                                                                                    AR1097176
     C********** CFC006    IFEQ 'Y'                                               AR1097176 MD020563
     C                     CALL 'AOCOMR0'                                                     CFC006
     C                     PARM 'GLC39  ' PNAME  10                                           CFC006
     C                     PARM '*ALL '   PCSEQ   5                                           CFC006
     C                     PARM SECTN     PSCTN  50                                           CFC006
     C                     PARM *BLANKS   PRTCD   7                                           CFC006
      *                                                                                       CFC006
     C           PRTCD     IFEQ 'Y      '                                                     CFC006
     C                     MOVEL'Y'       SUPFLG                                              CFC006
     C                     ENDIF                                                              CFC006
     C**********           ENDIF                                                  AR1097176 MD020563
      *                                                                                       CFC006
      ** Check if CGL052 - Amend Wash Out Processing - is on                                  CGL052
     C                     MOVE 'N'       CGL052  1                                           CGL052
     C                     CALL 'AOSARDR0'                                                    CGL052
     C                     PARM *BLANKS   @RTCD                                               CGL052
     C                     PARM '*VERIFY' @OPTN                                               CGL052
     C                     PARM 'CGL052'  @SARD                                               CGL052
      *                                                                                       CGL052
     C           @RTCD     IFEQ *BLANK                                                        CGL052
     C                     MOVE 'Y'       CGL052                                              CGL052
     C                     OPEN SDBRCHY0                                                      CGL052
     C                     OPEN SDACODY0                                                      CGL052
     C                     ENDIF                                                              CGL052
      /SPACE
     C***********          Z-ADD30        RECT30                          S01194
     C***********          Z-ADD0         KACOD                           S01194
     C***********          Z-ADD0         STYPE                           S01194
     C***********          MOVE *BLANKS   BLANK5                          S01194
     C***********TABKEY    SETLLTABGL                                     S01194
     C**********           MOVE *BLANKS   ACODKY  4                                    S01194 CGL029
     C                     MOVE *BLANKS   ACODKY 10                                           CGL029
     C           ACODKY    SETLLSDACODL0                                  S01194
      * Construct array of income/expense accounting codes
     C           *IN71     DOUEQ'1'                         B001
     C***********          READ TABGL                    71  Read acode   S01194
     C                     READ SDACODL0                 71  Read acode   S01194
     C           *IN71     IFEQ '0'                         B002
     C***********SREC      ANDEQ1                                         S01194
     C***********RECI      ANDEQ'D'                                       S01194
     C***********TITO      ANDEQ'N'                                       S01194
     C           A5TOIN    ANDEQ'N'                                       S01194
     C***********ACCS      IFEQ 'IN'                        B003          S01194
     C***********ACCS      OREQ 'EX'                         Income or    S01194
     C           A5ACSC    IFEQ 'IN'                        B003          S01194
     C           A5ACSC    OREQ 'EX'                         Income or    S01194
     C                     ADD  1         X                  Expense
     C***********          Z-ADDACODE     ACD,X                           S01194
     C                     MOVE A5ACCD    ACD,X                           S01194
     C                     MOVE A5ACSC    ACS,X                           S10736
     C/COPY WNCPYSRC,GL0800C051
      ** If CGL052 is on and the program is to process foreign                                CGL052
      ** currency accounts, fill the array ACF with the value of                              CGL052
      ** the flag found in SDACODY0 or the current account code.                              CGL052
      ** Assume a value of 'N' for the flag if no record found.                               CGL052
      *                                                                                       CGL052
     C           CGL052    IFEQ 'Y'                                                           CGL052
     C           FORB      ANDEQ'F'                                                           CGL052
     C                     MOVE *IN99     SVIN99  1                                           CGL052
     C           A5ACCD    CHAINSDACODF0             99                                       CGL052
      *                                                                                       CGL052
     C           *IN99     IFEQ *OFF                                                          CGL052
     C                     MOVE A5TEYF    ACF,X                                               CGL052
     C                     ELSE                                                               CGL052
     C                     MOVE 'N'       ACF,X                                               CGL052
     C                     ENDIF                                                              CGL052
      *                                                                                       CGL052
     C                     MOVE SVIN99    *IN99                                               CGL052
     C                     ENDIF                                                              CGL052
     C                     END                              E003
     C                     END                              E002
     C                     END                              E001
      /SPACE
      * Save number of acodes in ACD
     C                     Z-ADDX         MAX
      /SPACE
      * Decide if transfer of income/expense to profit/loss required
      * Check Base Currency Transfer Freq.,  Accruals/Profit Date,        S01194
      * End of Year Date & Date of Next Working Day                       S01194
     C***********BCXF      IFEQ 'A'                         B001          S01194
     C***********APDA      ANDLTDNWD                                      S01194
     C           BKBCTF    IFEQ 'A'                         B001          S01194
     C           BKAPDT    ANDLTBJDNWD                                    S01194
     C                     SETON                     30      Required
     C                     ELSE                             X001
     C***********BCXF      IFEQ 'Y'                         B002          S01194
     C***********EOYD      ANDLTDNWD                                      S01194
     C/COPY WNCPYSRC,GL0800C015
     C           BKBCTF    IFEQ 'Y'                         B002          S01194
     C           BJEYD     ANDLTBJDNWD                                    S01194
     C/COPY WNCPYSRC,GL0800C034
     C                     SETON                     30      Required
     C                     ELSE                             X002
     C/COPY WNCPYSRC,GL0800C016
     C***********BCXF      IFEQ 'M'                         B003          S01194
     C           BKBCTF    IFEQ 'M'                         B003          S01194
     C***********          Z-ADDDNWD      ZDAYNO                          S01194
     C                     Z-ADDBJDNWD    ZDAYNO                          S01194
     C                     MOVE '0'       *IN98
     C                     EXSR ZDATE2
     C           ZMMM      IFNE RUNMMM                      B004
     C                     SETON                     30      Required
     C                     END                              E004
     C                     END                              E003
     C/COPY WNCPYSRC,GL0800C017
     C                     END                              E002
     C/COPY WNCPYSRC,GL0800C018
     C                     END                              E001
     C           FORB      IFEQ 'B'                                       LN0889
     C           *IN30     ANDNE'1'                                       LN0889
     C                     MOVELTXT,9     F48                             LN0889
     C                     END                                            LN0889
      /SPACE
      * Obtain base ccy decimals and trading equivalent account code
     C                     Z-ADD1         X
     C***********BCCY      LOKUPCUR,X                    75               S01194
     C           BJCYCD    LOKUPCUR,X                    75               S01194
     C                     MOVELCYD,X     CCYDET
     C**********           Z-ADDTACC      BSTACC                          110241
     C                     MOVELTACCA     BSTACC                          110241
     C                     Z-ADDCDP       BASDP
     C/COPY WNCPYSRC,GL0800C026
      * Set up array of account types for trading equivalent account
      * codes
      * Set up array of account sections too                              S10736
     C***********          Z-ADD30        RECT30                          S01194
     C***********          MOVE *BLANKS   BLANK5                          S01194
     C***********          Z-ADD1         STYPE                           S01194
     C                     MOVEL'004'     DBASE
     C                     Z-ADD1         X
     C           CUR,X     DOUEQ*BLANKS                     B001
     C                     MOVELCYD,X     CCYDET
     C***********CUR,X     IFNE BCCY                        B002          S01194
     C           CUR,X     IFNE BJCYCD                      B002          S01194
     C           TACC      ORNE 0
     C           TACCA     IFNE *BLANKS                     B003          110241
     C***********          Z-ADDTACC      KACOD                           S01194
     C                     MOVE TACC      ACODKY                          S01194
     C                     EXSR TABCHN
     C           *INU7     CABEQ'1'       AEND               DBERR #4
     C***********          MOVELATYP      ATY,X                           S01194
     C                     MOVELA5ACTY    ATY,X                           S01194
     C                     MOVELA5ACSC    ASC,X                           S10736
     C                     ENDIF                            E003          110241
     C                     END                              E002
     C/COPY WNCPYSRC,GL0800C046
     C                     ADD  1         X
     C                     END                              E001
      * Obtain account types for trade account code,profit+loss, and
      * base ccy trading equivalent if necessary.
      * Obtain account sections too                                       S10736
     C           BSTACC    IFNE 0                           B001
     C                     Z-ADD1         X
     C***********BCCY      LOKUPCUR,X                    75  Eqv Type     S01194
     C           BJCYCD    LOKUPCUR,X                    75  Eqv Type     S01194
     C                     MOVE ATY,X     BSEQTY
     C                     MOVE ASC,X     BSEQSC  2                       S10736
     C/COPY WNCPYSRC,GL0800C047
     C                     END                              E001
     C***********          Z-ADDSPAC      KACOD                           S01194
     C                     MOVE BLSPTA    ACODKY                          S01194
     C                     MOVEL'005'     DBASE
     C                     EXSR TABCHN                       Trade Type
     C           *INU7     CABEQ'1'       AEND                DBERR #5
     C***********          MOVE ATYP      TRDTY                           S01194
     C                     MOVE A5ACTY    TRDTY                           S01194
     C                     MOVE A5ACSC    TRDSC   2                       S10736
      * get a/c type for P&L a/c if base ccy xfer being performed
      * get a/c section too                                               S10736
     C           *IN30     IFEQ '1'                         B001
     C/COPY WNCPYSRC,GL0800C019
     C***********          Z-ADDPLAC      KACOD                           S01194
     C                     MOVE BKPLAC    ACODKY                          S01194
     C                     MOVEL'006'     DBASE
     C                     EXSR TABCHN
     C           *INU7     CABEQ'1'       AEND                DBERR #6
     C***********          MOVE ATYP      PLTY               P+L Type     S01194
     C                     MOVE A5ACTY    PLTY               P+L Type     S01194
     C                     MOVE A5ACSC    PLSC    2          P+L Section  S10736
     C                     END                              E001
     C/COPY WNCPYSRC,GL0800C011
      *                                                                   S01522
      * Call Module Prog. for Module Details.                             S01522
     C                     CALL 'AOMMODR0'                                S01522
     C                     PARM '*MSG   ' @RTCD                           S01522
     C                     PARM '*FIRST ' @OPTN                           S01522
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01522
      *                                                                   S01522
     C           @RTCD     IFNE *BLANK                     B1             S01522
     C                     MOVEL'SDMMODPD'DBFILE           * * * * * * *  S01522
     C                     MOVEL'006'     DBASE            * DBERR 008 *  S01522
     C                     MOVEL@OPTN     DBOPTN           * * * * * * *  S01522
     C                     MOVEL@OPTN     DBKEY             1             S01522
     C                     EXSR *PSSR                       1             S01522
     C                     SETON                     U7U8LR 1             S01522
     C                     GOTO AEND                        1             S01522
     C                     ELSE                            X1             S01522
     C/COPY WNCPYSRC,GLH00751
     C*                                                                   S01522
     C* Call SAR Prog. for Switchable feature                             S01522
     C                     MOVE 'N'       GLPNAR  1                       S01522
     C           BGN1ST    IFEQ 'Y'                        B2             S01522
     C/COPY WNCPYSRC,GLH00752
     C*                                                                   S01522
     C                     CALL 'AOSARDR0'                  2             S01522
     C                     PARM '       ' @RTCD             2             S01522
     C                     PARM '*VERIFY' @OPTN             2             S01522
     C                     PARM 'GLPNAR'  @SARD   6         2             S01522
     C           SCSARD    PARM SCSARD    DSFDY             2             S01522
     C*                                                                   S01522
     C           @RTCD     IFNE *BLANK                     B3             S01522
     C           @RTCD     ANDNE'*NRF   '                   3             S01522
     C                     MOVEL'SCSARDPD'DBFILE            ************* S01522
     C                     MOVEL'009'     DBASE             *DBERROR 009* S01522
     C                     MOVEL@RTCD     DBKEY             ************* S01522
     C                     EXSR *PSSR                       3             S01522
     C                     SETON                     U7U8LR 3             S01522
     C                     GOTO AEND                        3             S01522
     C                     ENDIF                           E3             S01522
     C*                                                                   S01522
     C           @RTCD     IFEQ *BLANK                     B3             S01522
     C                     MOVE 'Y'       GLPNAR            3             S01522
     C                     ENDIF                           E3             S01522
     C                     ENDIF                           E2             S01522
     C                     ENDIF                           E1             S01522
      /SPACE
      * Write posting header record to GLXFHH
     C                     MOVE 'H'       RECI
     C                     WRITEAPOSTHHF
     C                     ADD  1         RECCNT
     C                     MOVELNAR,2     PNTR
     C                     MOVELNAR,2     PNTR2
     C                     Z-ADD1         ASQ01
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CCP4                                           S01408
     C*                                                                   S01408
      /SPACE
     C           AEND      ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*     Performs any necessary output of postings/report details. *
     C*     Updates year to date balance on account master record for *
     C*     non-base currency accounts with non-zero ledger balances. *
     C*****************************************************************
      /SPACE 2
     C           BPSPRT    BEGSR
      /SPACE
     C                     MOVE 'P'       RECI
      /SPACE
     C/COPY WNCPYSRC,GL0800C032
     C***********#CCY      IFNE BCCY                        B001          S01194
     C           #CCY      IFNE BJCYCD                      B001          S01194
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CCP5                                           S01408
     C*                                                                   S01408
     C* Account in foreign currency
     C/SPACE
     C                     SETON                     63                   S01117
     C*                                                                   S01117
     C                     Z-ADD1         X
     C           #CCY      LOKUPCUR,X                    75  Get ccy
     C                     MOVELCYD,X     CCYDET              details
     C                     MOVEA'0000'    *IN,20
     C           CDP       COMP 1                    752021
     C           *IN75     IFEQ '1'                         B002
     C           CDP       COMP 2                    23  22
     C                     END                              E002
     C/COPY WNCPYSRC,GL0800C021
     C           YTDB      ADD  LDBL      NEWYTD
     C           YTDB      COMP 0                      25
     C           LDBL      COMP 0                      26
     C           NEWYTD    COMP 0                      27
     C           CURLIN    IFGE OVFLW                       B002
     C           *IN60     OREQ '0'                                       E11059
     C* New page required
     C           FORB      IFEQ 'F'                                       E15192
     C***/COPY*WNCPYSRC,GLH00599                                                              CFC006
     C/COPY WNCPYSRC,GLH00599                                                               MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
     C                     EXCPTTITLE
     C                     MOVE '1'       *IN60                           E11059
     C                     END                                            E15192
     C                     END                              E002
     C*                                                                   E15192
     C* Write detail line to Foreign Currency Income/Expense Report
     C           FORB      IFEQ 'F'                                       E15192
     C***/COPY*WNCPYSRC,GL0800C036                                                            CFC006
     C/COPY WNCPYSRC,GL0800C036                                                             MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
     C                     EXCPTDETL
     C/COPY WNCPYSRC,GL0800C033
     C                     END                                            E15192
      /SPACE
     C/COPY WNCPYSRC,GL0800C037
     C* If ledger balance is non-zero, write postings and update year
     C* to date balance on account record.
     C           LDBL      IFNE 0                           B002
     C*                                                                   E15192
     C           FORB      IFEQ 'F'                                       E15192
     C*                                                                   E15192
     C                     Z-ADDNEWYTD    YTDB
     C                     EXCPTUPDAC
     C                     Z-ADDLDBL      AMT0
     C* Convert to base currency
     C                     EXSR SB1CON
     C* Postings
     C***********          Z-ADDRUND      VALD                            096487
     C/COPY WNCPYSRC,GL0800C042
     C                     Z-ADDBKAPDT    VALD                            096487
     C/COPY WNCPYSRC,GL0800C043
     C                     Z-ADDRUND      PSTD
     C*********************MOVE 'GE-XF'   SPOS                            E15192
     C                     MOVEL#ATYP     ATYP
     C                     MOVE ACS,Y     ACSC                            S10736
     C           ATYP      IFEQ 'R'                         B003
     C                     Z-ADD1         RIND
     C                     ELSE                             X003
     C                     Z-ADD0         RIND
     C                     END                              E003
     C                     MOVE 'X'       GETP
     C                     Z-ADDLDBL      PSTA         75
     C           *IN75     IFEQ '1'                         B003
     C                     Z-SUBLDBL      PSTA
     C                     END                              E003
     C                     MOVELNAR,1     PNAR
     C           LDBL      IFGT 0                           B003
     C                     Z-ADD1         DRCR
     C                     ELSE                             X003
     C                     Z-ADD0         DRCR
     C                     END                              E003
     C**********           Z-ADD#CNUM     CNUM                                                CSD027
     C                     MOVE #CNUM     CNUM                                                CSD027
     C                     MOVEL#CCY      CCY
     C                     Z-ADD#ACOD     ACOD
     C                     Z-ADD#ACSQ     ACSQ
     C/COPY WNCPYSRC,GL0800C022
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C                     MOVE ACNO      ##ACNO                          S01522
     C                     MOVE 'GB00060' ##MGID                          S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   S01522
     C                     WRITEAPOSTPDF
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CADU                                           S01408
     C*                                                                   S01408
     C*
     C***********          Z-ADDBICN      CNUM                            S01194
     C                     MOVE A8BICN    CNUM                            S01194
     C/COPY WNCPYSRC,GL0800C007
     C***********          Z-ADDSPAC      ACOD                            S01194
     C                     MOVE BLSPTA    ACOD                            S01194
     C                     MOVE TRDTY     ATYP                            S10736
     C                     MOVE TRDSC     ACSC                            S10736
     C                     Z-ADD1         ACSQ
     C/COPY WNCPYSRC,GL0800C008
     C           LDBL      IFGT 0                           B003
     C                     Z-ADD0         DRCR
     C                     ELSE
     C                     Z-ADD1         DRCR
     C                     END                              E003
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C                     MOVE *BLANKS   ##ACNO                          S01522
     C                     MOVE 'GB00060' ##MGID                          S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   S01522
     C                     WRITEAPOSTPDF
     C/COPY WNCPYSRC,GLH00366
     C* If base currency amount is zero , no more postings
     C           BASAM0    CABEQ0         HASH1
     C*
     C***********          MOVELBCCY      CCY                             S01194
     C                     MOVELBJCYCD    CCY                             S01194
     C                     Z-ADDTACC      ACOD
     C/COPY WNCPYSRC,GL0800C012
     C           LDBL      IFGT 0                           B003
     C                     Z-ADD1         DRCR
     C                     ELSE                             X003
     C                     Z-ADD0         DRCR
     C                     END                              E003
     C                     Z-ADDBASAM0    PSTA         75
     C           *IN75     IFEQ '1'                         B003
     C                     Z-SUBBASAM0    PSTA
     C                     END                              E003
     C                     Z-ADD1         X
     C           #CCY      LOKUPCUR,X                    75
     C                     MOVE ATY,X     ATYP
     C                     MOVE ASC,X     ACSC                            S10736
     C/COPY WNCPYSRC,GL0800C048
     C           ATYP      IFEQ 'R'                         B003
     C                     Z-ADD1         RIND
     C                     ELSE                             X003
     C                     Z-ADD0         RIND
     C                     END                              E003
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C                     MOVE *BLANKS   ##ACNO                          S01522
     C                     MOVE 'GB00060' ##MGID                          S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   S01522
     C                     WRITEAPOSTPDF
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CCP6                                           S01408
     C*                                                                   S01408
     C*                                                                   064335
     C** Set cust no & a/c seq of this posting to the original cust no    064335
     C** and a/c seq.                                                     064335
     C*                                                                   064335
     C           BKFCRC    IFEQ 'B'                                       064335
     C           BKFCRC    OREQ 'C'                                       064335
     C**********           Z-ADD#CNUM     CNUM                                         064335 CSD027
     C                     MOVE #CNUM     CNUM                                                CSD027
     C                     END                                            064335
     C           BKFCRC    IFEQ 'B'                                       064335
     C           BKFCRC    OREQ 'S'                                       064335
     C                     Z-ADD#ACSQ     ACSQ                            064335
     C/COPY WNCPYSRC,GL0800C049
     C                     END                                            064335
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CP15                                           S01408
     C*                                                                   S01408
     C*
     C                     Z-ADD#ACOD     ACOD
     C/COPY WNCPYSRC,GL0800C023
     C                     MOVELPNAR2     PNAR
     C           LDBL      IFGT 0                           B003
     C                     Z-ADD0         DRCR
     C                     ELSE                             X003
     C                     Z-ADD1         DRCR
     C                     END                              E003
     C                     MOVE #ATYP     ATYP
     C                     MOVE ACS,Y     ACSC                            S10736
     C           ATYP      IFEQ 'R'                         B003
     C                     Z-ADD1         RIND
     C                     ELSE                             X003
     C                     Z-ADD0         RIND
     C                     END                              E003
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C*                                                                   S01522
     C                     MOVE *BLANKS   ##ACNO                          S01522
     C                     MOVE 'GB00070' ##MGID                          S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   S01522
     C                     WRITEAPOSTPDF
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CCP7                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CADU                                           S01408
     C*                                                                   S01408
     C* Maintain hash totals
     C           HASH1     TAG
     C                     ADD  2         RECCNT
     C           LDBL      MULT 2         SUBTOT
     C           BASAM0    IFNE 0                           B003
     C                     DO   2                           B004
     C                     ADD  BASAM0    SUBTOT
     C                     END                              E004
     C                     ADD  2         RECCNT
     C                     END                              E003
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CCP8                                           S01408
     C*                                                                   S01408
     C           SUBTOT    DIV  1000      ZZAMT
     C           ZZAMT     IFLT 0                           B003
     C                     Z-SUBZZAMT     ZZAMT
     C                     END                              E003
     C                     Z-ADDZZAMT     ZZAMTI
     C                     MOVE ZZAMT     ZZAMTD
     C                     ADD  ZZAMTD    ZZTOTD
     C           ZZTOTD    IFLT ZZAMTD                      B003
     C                     ADD  1         ZZAMTI
     C                     END                              E003
     C**********                                                    E15192S01314
     C**********           END                                      E15192S01314
     C                     ADD  ZZAMTI    ZZTOTI
     C           BASAM0    CABEQ0         BEND
      /SPACE
     C/COPY WNCPYSRC,GL0800C027
     C           BSTACC    IFNE 0                           B003
     C/COPY WNCPYSRC,GL0800C028
     C* Additional pair of postings generated if base currency trade
     C* and trade equivalent accounts used by installation
     C***********          Z-ADDSPAC      ACOD                            S01194
     C*                                                                   064335
     C** Set cust no back to branch internal customer & a/c seq to 1.     064335
     C*                                                                   064335
     C                     MOVE A8BICN    CNUM                            064335
     C                     Z-ADD1         ACSQ                            064335
     C/COPY WNCPYSRC,GL0800C009
     C*                                                                   064335
     C                     MOVE BLSPTA    ACOD                            S01194
     C/COPY WNCPYSRC,GL0800C029
     C                     MOVELNAR,1     PNAR
     C           LDBL      IFGT 0                           B004
     C                     Z-ADD1         DRCR
     C                     ELSE                             X004
     C                     Z-ADD0         DRCR
     C                     END                              E004
     C                     MOVE TRDTY     ATYP
     C                     MOVE TRDSC     ACSC                            S10736
     C           ATYP      IFEQ 'R'                         B004
     C                     Z-ADD1         RIND
     C                     ELSE                             X004
     C                     Z-ADD0         RIND
     C                     END                              E004
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C                     MOVE *BLANKS   ##ACNO                          S01522
     C                     MOVE 'GB00060' ##MGID                          S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   S01522
     C                     WRITEAPOSTPDF
     C*
     C/COPY WNCPYSRC,GL0800C030
     C                     Z-ADDBSTACC    ACOD
     C/COPY WNCPYSRC,GL0800C031
     C                     MOVE BSEQTY    ATYP
     C                     MOVE BSEQSC    ACSC                            S10736
     C/COPY WNCPYSRC,GL0800C050
     C           ATYP      IFEQ 'R'                         B004
     C                     Z-ADD1         RIND
     C                     ELSE                             X004
     C                     Z-ADD0         RIND
     C                     END                              E004
     C           LDBL      IFGT 0                           B004
     C                     Z-ADD0         DRCR
     C                     ELSE                             X004
     C                     Z-ADD1         DRCR
     C                     END                              E004
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C                     MOVE *BLANKS   ##ACNO                          S01522
     C                     MOVE 'GB00060' ##MGID                          S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   S01522
     C                     WRITEAPOSTPDF
     C/COPY WNCPYSRC,GLH00367
     C* Hash totalling
     C                     ADD  2         RECCNT
     C           BASAM0    MULT 2         SUBTOT
     C           SUBTOT    DIV  1000      ZZAMT
     C           ZZAMT     IFLT 0                           B004
     C                     Z-SUBZZAMT     ZZAMT
     C                     END                              E004
     C                     Z-ADDZZAMT     ZZAMTI
     C                     MOVE ZZAMT     ZZAMTD
     C                     ADD  ZZAMTD    ZZTOTD
     C           ZZTOTD    IFLT ZZAMTD                      B004
     C                     ADD  1         ZZAMTI
     C                     END                              E004
     C                     ADD  ZZAMTI    ZZTOTI
     C*
     C                     END                              E003
     C*                                                                   E15192
     C                     END                                            E15192
     C/SPACE
     C********** *IN30     IFEQ '1'                         B003          E21839
     C********** FORB      ANDEQ'B'                                 E15192E21839
     C**********ional pair of postings are to be generated if income/     E21839
     C**********is to be transfered to profit and loss.                   E21839
     C**********           Z-ADD#ACOD     ACOD                            E21839
     C**********           MOVELNAR,3     PNAR                            E21839
     C**********           MOVEL#ATYP     ATYP                            E21839
     C********** ATYP      IFEQ 'R'                         B004          E21839
     C**********           Z-ADD1         RIND                            E21839
     C**********           ELSE                             X004          E21839
     C**********           Z-ADD0         RIND                            E21839
     C**********           END                              E004          E21839
     C********** LDBL      IFGT 0                           B004          E21839
     C**********           Z-ADD1         DRCR                            E21839
     C**********           ELSE                             X004          E21839
     C**********           Z-ADD0         DRCR                            E21839
     C**********           END                              E004          E21839
     C**********           MOVE 'Y'       GETP                            E21839
     C**********           WRITEAPOSTPDF                                  E21839
     C**********                                                          E21839
     C***********          Z-ADDPLAC      ACOD                            S01194
     C**********           MOVE BKPLAC    ACOD                      S01194E21839
     C**********           Z-ADD#ACOD     PACOD                           E21839
     C**********           MOVELPNAR3     PNAR                            E21839
     C********** LDBL      IFGT 0                           B004          E21839
     C**********           Z-ADD0         DRCR                            E21839
     C**********           ELSE                             X004          E21839
     C**********           Z-ADD1         DRCR                            E21839
     C**********           END                              E004          E21839
     C**********           MOVE PLTY      ATYP                            E21839
     C********** ATYP      IFEQ 'R'                         B004          E21839
     C**********           Z-ADD1         RIND                            E21839
     C**********           ELSE                             X004          E21839
     C**********           Z-ADD0         RIND                            E21839
     C**********           END                              E004          E21839
     C**********           WRITEAPOSTPDF                                  E21839
     C**********alling                                                    E21839
     C**********           ADD  2         RECCNT                          E21839
     C********** BASAM0    MULT 2         SUBTOT                          E21839
     C********** SUBTOT    DIV  1000      ZZAMT                           E21839
     C********** ZZAMT     IFLT 0                           B004          E21839
     C**********           Z-SUBZZAMT     ZZAMT                           E21839
     C**********           END                              E004          E21839
     C**********           Z-ADDZZAMT     ZZAMTI                          E21839
     C**********           MOVE ZZAMT     ZZAMTD                          E21839
     C**********           ADD  ZZAMTD    ZZTOTD                          E21839
     C********** ZZTOTD    IFLT ZZAMTD                      B004          E21839
     C**********           ADD  1         ZZAMTI                          E21839
     C**********           END                              E004          E21839
     C**********           ADD  ZZAMTI    ZZTOTI                          E21839
     C**********                                                          E21839
     C**********           END                              E003          E21839
     C                     END                              E002
     C/COPY WNCPYSRC,GL0800C013
     C                     END                              E001
     C* End of postings for foreign currency accounts
     C************************
     C/SPACE
     C* For base currency accounts, postings required only if transfer
     C* to profit and loss required (*IN30 = 1).
     C***********#CCY      IFEQ BCCY                        B001          S01194
     C/COPY WNCPYSRC,GL0800C040
     C           #CCY      IFEQ BJCYCD                      B001          S01194
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CCP9                                           S01408
     C*                                                                   S01408
     C           *IN30     ANDEQ'1'
      *                                                                   S01408
     C/COPY WNCPYSRC,GL0800CCP2                                           S01408
      *                                                                   S01408
     C           LDBL      ANDNE0
     C           FORB      ANDEQ'B'                                       E15192
      *                                                                                       250521
      ** Check if posting amount is too big                                                   250521
      *                                                                                       250521
     C                     MOVE 'Y'       WREPT   1                                           250521
     C                     MOVE 'N'       WONCE   1                                           250521
      *                                                                                       250521
     C           WREPT     DOWEQ'Y'                                                           250521
     C           WONCE     IFEQ 'N'                                                           250521
     C                     Z-ADDLDBL      WPSTA  150   75                                     250521
     C           *IN75     IFEQ '1'                                                           250521
     C                     Z-SUBLDBL      WPSTA                                               250521
     C                     ENDIF                                                              250521
     C                     ENDIF                                                              250521
      *                                                                                       250521
     C                     MOVE 'Y'       WONCE                                               250521
     C                     Z-ADDWPSTA     WPREVA 150                                          250521
     C           WPSTA     SUB  WLMTPA    WPSTA                                               250521
     C           WPSTA     IFGT 0                                                             250521
     C                     ADD  2         RECCNT                                              250521
     C                     Z-ADDWLMTPA    PSTA                                                250521
     C                     MOVE 'Y'       WREPT                                               250521
     C                     ELSE                                                               250521
     C                     Z-ADDWPREVA    PSTA                                                250521
     C                     MOVE 'N'       WREPT                                               250521
     C                     ENDIF                                                              250521
      *                                                                                       250521
     C**********           Z-ADD#CNUM     CNUM                                                CSD027
     C                     MOVE #CNUM     CNUM                                                CSD027
     C                     Z-ADD#ACOD     ACOD
     C                     MOVEL#CCY      CCY
     C                     Z-ADD#ACSQ     ACSQ
     C                     Z-ADDRUND      PSTD
     C***********          Z-ADDRUND      VALD                            096487
     C/COPY WNCPYSRC,GL0800C044
     C                     Z-ADDBKAPDT    VALD                            096487
     C/COPY WNCPYSRC,GL0800C045
     C                     MOVELNAR,3     PNAR
     C**********           Z-ADDLDBL      PSTA         75                                     250521
     C********** *IN75     IFEQ '1'                         B002                              250521
     C**********           Z-SUBLDBL      PSTA                                                250521
     C**********           END                              E002                              250521
     C*********************MOVE 'GE-XF'   SPOS                            E15192
     C                     MOVE #ATYP     ATYP
     C                     MOVE ACS,Y     ACSC                            S10736
     C           ATYP      IFEQ 'R'                         B002
     C                     Z-ADD1         RIND
     C                     ELSE                             X002
     C                     Z-ADD0         RIND
     C                     END                              E002
     C                     MOVE 'Y'       GETP
     C           LDBL      IFGT 0                           B002
     C                     Z-ADD1         DRCR
     C                     ELSE                             X002
     C                     Z-ADD0         DRCR
     C                     END                              E002
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C*                                                                   S01522
     C                     MOVE ACNO      ##ACNO                          S01522
     C                     MOVE 'GB00080' ##MGID                          S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   S01522
     C                     WRITEAPOSTPDF
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CP10                                           S01408
     C*                                                                   S01408
     C*
     C***********          Z-ADDBICN      CNUM                            S01194
     C                     MOVE A8BICN    CNUM                            S01194
     C/COPY WNCPYSRC,GL0800C010
     C***********          Z-ADDPLAC      ACOD                            S01194
     C                     MOVE BKPLAC    ACOD                            S01194
     C/COPY WNCPYSRC,GLH00073
     C                     Z-ADD1         ACSQ
     C                     MOVELPNAR2     PNAR
     C                     MOVE PLTY      ATYP
     C                     MOVE PLSC      ACSC                            S10736
     C           ATYP      IFEQ 'R'                         B002
     C                     Z-ADD1         RIND
     C                     ELSE                             X002
     C                     Z-ADD0         RIND
     C                     END                              E002
     C           LDBL      IFGT 0                           B002
     C                     Z-ADD0         DRCR
     C                     ELSE                             X002
     C                     Z-ADD1         DRCR
     C                     END                              E002
     C*                                                                   S01522
     C* Determine the posting narrative:                                  S01522
     C*                                                                   S01522
     C                     MOVE *BLANKS   ##ACNO                          S01522
     C                     MOVE 'GB00070' ##MGID                          S01522
     C                     EXSR SRPNAR                                    S01522
     C*                                                                   S01522
     C/COPY WNCPYSRC,GLH00368
     C                     WRITEAPOSTPDF
      *                                                                                       250521
     C                     ENDDO                                                              250521
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CP11                                           S01408
     C*                                                                   S01408
     C*
     C* Hash totalling
     C                     ADD  2         RECCNT
     C           LDBL      MULT 2         SUBTOT
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CP12                                           S01408
     C*                                                                   S01408
     C           SUBTOT    DIV  1000      ZZAMT
     C           ZZAMT     IFLT 0                           B002
     C                     Z-SUBZZAMT     ZZAMT
     C                     END                              E002
     C                     Z-ADDZZAMT     ZZAMTI
     C                     MOVE ZZAMT     ZZAMTD
     C                     ADD  ZZAMTD    ZZTOTD
     C           ZZTOTD    IFLT ZZAMTD                      B002
     C                     ADD  1         ZZAMTI
     C                     END                              E002
     C                     ADD  ZZAMTI    ZZTOTI
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CP13                                           S01408
     C*                                                                   S01408
     C                     END                              E001
     C/COPY WNCPYSRC,GL0800C024
     C/SPACE
     C           BEND      ENDSR
     C*****************************************************************
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL0800CCP1                                           S01408
     C*                                                                   S01408
     C/EJECT
     C*****************************************************************
     C*           Termination/File Control Routine                    *
     C*****************************************************************
     C/SPACE 2
     C           CTERM     BEGSR
     C**                                                                  S01117
     C* Print control report
     C           RECCNT    SUB  1         ENTCNT
     C                     EXCPTTITL2
     C           ENTCNT    IFEQ 0                           B001
     C                     EXCPTNONE
     C                     ELSE                             X001
     C                     EXCPTDETL2
     C                     END                              E001
     C* Write trailer record
     C                     ADD  1         RECCNT
     C                     MOVE 'T'       RECI
     C                     Z-ADDRECCNT    NORE1
     C                     Z-ADDZZTOTI    HRWN
     C                     Z-ADDZZTOTD    HRDC
     C                     WRITEAPOSTZZF
     C**Write*title and 'No details' message IF no details          E15781S01117
     C**N61******          EXCPTNODET                               E15781S01117
     C***61******          SETOF                         61         E15781S01117
     C**End*of*report lines                                               S01117
     C***********          EXCPTENDREP                                    S01117
     C*                                                                   S01117
     C* End of Branch report for last Branch                              S01117
     C*                                                                   E33769
     C**  If not a Base Currency transfer                                 E33769
     C*                                                                   E33769
     C           FORB      IFNE 'B'                                       E33769
     C           *IN62     ANDEQ'1'                                       E33769
     C***/COPY*WNCPYSRC,GLH00600                                                              CFC006
     C/COPY WNCPYSRC,GLH00600                                                               MD020563
     C           SUPFLG    ANDNE'Y'                                                           CFC006
     C                     EXCPTENDBRN                                    S01117
     C                     END                                            E33769
     C/SPACE
     C           CEND      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*       Conversion of amount to base currency                   *
     C*****************************************************************
     C/SPACE 2
     C           SB1CON    BEGSR
     C*
     C***********MDIN      IFEQ 1                           B001          S01194
     C           MDIN      IFEQ 'M'                         B001          S01194
     C           BASDP     IFEQ 0                           B002
     C   20      AMT0      MULT SPOT      BASAM0    H
     C   21      AMT1      MULT SPOT      BASAM0    H
     C   22      AMT2      MULT SPOT      BASAM0    H
     C   23      AMT3      MULT SPOT      BASAM0    H
     C                     ELSE                             X002
     C           BASDP     IFEQ 1                           B003
     C   20      AMT0      MULT SPOT      BASAM1    H
     C   21      AMT1      MULT SPOT      BASAM1    H
     C   22      AMT2      MULT SPOT      BASAM1    H
     C   23      AMT3      MULT SPOT      BASAM1    H
     C                     ELSE                             X003
     C           BASDP     IFEQ 2                           B004
     C   20      AMT0      MULT SPOT      BASAM2    H
     C   21      AMT1      MULT SPOT      BASAM2    H
     C   22      AMT2      MULT SPOT      BASAM2    H
     C   23      AMT3      MULT SPOT      BASAM2    H
     C                     ELSE                             X004
     C   20      AMT0      MULT SPOT      BASAM3    H
     C   21      AMT1      MULT SPOT      BASAM3    H
     C   22      AMT2      MULT SPOT      BASAM3    H
     C   23      AMT3      MULT SPOT      BASAM3    H
     C                     END                              E004
     C                     END                              E003
     C                     END                              E002
     C/SPACE
     C                     ELSE                             X001
     C           BASDP     IFEQ 0                           B002
     C   20      AMT0      DIV  SPOT      BASAM0    H
     C   21      AMT1      DIV  SPOT      BASAM0    H
     C   22      AMT2      DIV  SPOT      BASAM0    H
     C   23      AMT3      DIV  SPOT      BASAM0    H
     C                     ELSE                             X002
     C           BASDP     IFEQ 1                           B003
     C   20      AMT0      DIV  SPOT      BASAM1    H
     C   21      AMT1      DIV  SPOT      BASAM1    H
     C   22      AMT2      DIV  SPOT      BASAM1    H
     C   23      AMT3      DIV  SPOT      BASAM1    H
     C                     ELSE                             X003
     C           BASDP     IFEQ 2                           B004
     C   20      AMT0      DIV  SPOT      BASAM2    H
     C   21      AMT1      DIV  SPOT      BASAM2    H
     C   22      AMT2      DIV  SPOT      BASAM2    H
     C   23      AMT3      DIV  SPOT      BASAM2    H
     C                     ELSE                             X004
     C   20      AMT0      DIV  SPOT      BASAM3    H
     C   21      AMT1      DIV  SPOT      BASAM3    H
     C   22      AMT2      DIV  SPOT      BASAM3    H
     C   23      AMT3      DIV  SPOT      BASAM3    H
     C                     END                              E004
     C                     END                              E003
     C                     END                              E002
     C                     END                              E001
     C/SPACE
     C/COPY WNCPYSRC,GL0800C041
     C           SB1END    ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*      TABCHN  -  Table Accessing Routine                       *
     C*****************************************************************
     C/SPACE 2
     C           TABCHN    BEGSR
     C***********TABKEY    CHAINTABGL                75                   S01194
     C************IN75     IFEQ '1'                         B001          S01194
     C***********          MOVEL'TABGL'   DBFILE                          S01194
     C***********          MOVELTABKEY    DBTABK                          S01194
     C                     MOVE *BLANKS   @AFNB                           S01194
     C                     MOVE ACODKY    @AFNB                           S01194
     C                     CALL 'AOACODR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C**********           PARM           @AFNB   4                                    S01194 CGL029
     C********** SDACOD    PARM SDACOD    DSFDY                                        S01194 CGL029
     C                     PARM           @AFNB  10                                           CGL029
     C           SDACOD    PARM SDACOD    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVEL'007'     DBASE            * DBERR 007 *  S01117
     C                     MOVEL'SDACODPD'DBFILE                          S01194
     C                     MOVELACODKY    DBKEY                           S01194
     C                     MOVEL@OPTN     DBOPTN                          S01194
     C                     EXSR *PSSR                                     S01194
     C                     SETON                     U7U8
     C                     END
     C           TEND      ENDSR
     C*****************************************************************
     C/EJECT
     C/COPY WNCPYSRC,GL0800C025
     C********************************************************************S01522
     C**  Subroutine SRPNAR determines the required narratives.         **S01522
     C********************************************************************S01522
     C           SRPNAR    BEGSR                           * S R P N A R *S01522
     C*                                                                   S01522
     C* Define the data structure parameter:                              S01522
     C*                                                                   S01522
     C           *LIKE     DEFN CGPNAR    ##PNAR                          S01522
     C           *LIKE     DEFN ACNO      ##ACNO                          S01522
     C*                                                                   S01522
     C* If the facility is switched off or unavailable,                   S01522
     C*  or UDC is not installed, exit this subroutine:                   S01522
     C*                                                                   S01522
     C           GLPNAR    IFNE 'Y'                                       S01522
     C                     GOTO EXPNAR                                    S01522
     C                     ENDIF                                          S01522
     C*                                                                   S01522
     C* Determine the customer's name:                                    S01522
     C*                                                                   S01522
     C                     MOVELCNUM      ##KEY     P                     S01522
     C*                                                                   S01522
      * If the customer being checked is the same as the previous                             CSC042
      * customer then just use the details rather than call AOCUST again                      CSC042
     C           *LIKE     DEFN CNUM      ##LCUS                                              CSC042
     C           *LIKE     DEFN BBCRNM    ##LCRN                                              CSC042
     C           CNUM      IFEQ ##LCUS                                                        CSC042
     C                     MOVEL##LCRN    BBCRNM                                              CSC042
     C                     ELSE                                                               CSC042
     C                     CALL 'AOCUSTR0'                                S01522
     C                     PARM           ##RTN   7                       S01522
     C                     PARM '*KEY   ' ##OPT   7                       S01522
     C                     PARM           ##KEY  10                       S01522
     C                     PARM           ##STS   7                       S01522
     C           SDCUST    PARM SDCUST    DSSDY                           S01522
     C*                                                                   S01522
     C           ##RTN     IFNE *BLANKS                                   S01522
     C                     MOVEL'SDCUSTPD'DBFILE             *************S01522
     C                     MOVEL'101'     DBASE              * DBERR 101 *S01522
     C                     MOVEL##KEY     DBKEY              *************S01522
     C                     EXSR *PSSR                                     S01522
     C                     ELSE                                                               CSC042
     C                     MOVELCNUM      ##LCUS                                              CSC042
     C                     MOVELBBCRNM    ##LCRN                                              CSC042
     C                     ENDIF                                          S01522
     C                     END                                                                CSC042
     C*...................................................................S01522
     C/EJECT                                                              S01522
     C*...................................................................S01522
     C* Determine the value for the narrative using AOPNARR0:             S01522
     C*                                                                   S01522
     C                     CLEARCGPNAR                                    S01522
     C                     CLEAR##PRM1                                    086125
     C*                                                                   S01522
     C                     MOVE 'GL'      MNMODI                          S01522
     C                     MOVE BRCA      MNBRCA                          S01522
     C**********           MOVE CNUM      MNCUST                   S01522 101582
     C**********           MOVE CCY       MNCYCD                   S01522 101582
     C**********           MOVE ACOD      MNACCD                   S01522 101582
     C**********           MOVE ACSQ      MNACSQ                   S01522 101582
     C                     MOVE #CNUM     MNCUST                          101582
     C                     MOVE #CCY      MNCYCD                          101582
     C                     MOVE #ACOD     MNACCD                          101582
     C                     MOVE #ACSQ     MNACSQ                          101582
     C                     MOVE ##ACNO    MNRACN                          S01522
     C                     MOVE BBCRNM    MNCRNM                          S01522
     C                     MOVELPNAR      MNNARR    P                     S01522
     C/COPY WNCPYSRC,GLH00753
     C*                                                                   S01522
     C                     CALL 'AOPNARR0'                                S01522
     C                     PARM           ##RTN                           S01522
     C                     PARM           ##MGID  7                       S01522
     C                     PARM           ##PRM1                          086125
     C           CGPNAR    PARM CGPNAR    ##PNAR                          S01522
     C                     PARM           ##NARR 50                       S01522
     C/COPY WNCPYSRC,GLH00754
     C*                                                                   S01522
     C           ##RTN     IFNE *BLANKS                                   S01522
     C                     MOVEL'CGPNARPD'DBFILE             *************S01522
     C                     MOVEL'102'     DBASE              * DBERR 102 *S01522
     C                     MOVELMNCUST    DBKEY              *************S01522
     C                     EXSR *PSSR                                     S01522
     C                     ENDIF                                          S01522
     C*                                                                   S01522
     C                     MOVEL##NARR    PNAR      P                     S01522
     C*                                                                   S01522
     C           EXPNAR    TAG                             < EXPNAR       S01522
     C*                                                                   S01522
     C                     ENDSR                                          S01522
     C********************************************************************S01522
     C/EJECT
3806 C********************************************************************
3807 C**
3808 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
3809 C**
3810 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
3811 C**
3812 C           ZDATE2    BEGSR                           *** ZDATE2 ***
3813 C**
3814 C**   CLEAR DATE FIELDS.
3815 C                     Z-ADD0         ZDATE   60
3816 C                     MOVEL'       ' ZADATE  7
3817 C**
3818 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
3819 C                     Z-ADDZDAYNO    ZDAYNO  50
3820 C**
3821 C**   DETERMINE YEAR NUMBER.
3822 C**
3823 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
3824 C           ZDAYNO    SUB  1         ZDAYN1  50   99
3825 C   99                GOTO ZDEND2
3826 C**
3827 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
3828 C           ZDAYN1    DIV  1461      ZLYR    20
3829 C                     MVR            ZDAYN1           SAVE REMAINING
3830 C**                                                   DAYS
3831 C**   CALCULATE NUMBER OF REMAINING YEARS.
3832 C                     Z-ADD1         ZWRK2   20
3833 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
3834 C           ZDAYN1    COMP ZYDY,ZWRK2             90
3835 C  N90      ZWRK2     ADD  1         ZWRK2
3836 C  N90                GOTO ZDTAG1
3837 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
3838 C**
3839 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
3840 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
3841 C**
3842 C**   CALCULATE ACTUAL YEAR NUMBER.
3843 C           ZLYR      MULT 4         ZWRK3   30
3844 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
3845 C                     Z-ADDZWRK3     ZYEAR   20
3846 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
3847 C**
3848 C**   DETERMINE MONTH NUMBER.
3849 C**
3850 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
3851 C                     SETOF                     9293
3852 C   91      ZDAYN1    COMP 59                     9293
3853 C   91N92   ZDAYN1    SUB  1         ZDAYN1
3854 C**
3855 C**   CALCULATE MONTH NUMBER.
3856 C                     Z-ADD2         ZWRK2
3857 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
3858 C           ZDAYN1    COMP ZMDY,ZWRK2             94
3859 C  N94      ZWRK2     ADD  1         ZWRK2
3860 C  N94                GOTO ZDTAG2
3861 C           ZWRK2     SUB  1         ZWRK2
3862 C**
3863 C                     Z-ADDZWRK2     ZMTH    20       MONTH
3864 C**
3865 C**   DETERMINE DAY OF MONTH.
3866 C**
3867 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
3868 C           ZDAYN1    ADD  1         ZDAYN1
3869 C**
3870 C**   CALCULATE DAY OF MONTH.
3871 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
3872 C**
3873 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
3874 C   93      ZDAY      ADD  1         ZDAY
3875 C**
3876 C**   FORMAT DATE, DDMMYY OR MMDDYY.
3877 C  N98                MOVELZDAY      ZWRK4   40
3878 C   98                MOVE ZDAY      ZWRK4
3879 C  N98                MOVE ZMTH      ZWRK4
3880 C   98                MOVELZMTH      ZWRK4
3881 C                     MOVELZWRK4     ZDATE
3882 C                     MOVE ZYEAR     ZDATE
3883 C**
3884 C**   FORMAT ALPHA DATE, DDMMMYY.
3885 C           ZDAY      COMP 10                     95
3886 C                     MOVELZDAY      ZWRK5   5
3887 C   95                MOVEL' '       ZWRK5
3888 C                     MOVE ZMNM,ZMTH ZWRK5
3889 C                     MOVELZWRK5     ZADATE
3890 C                     MOVE ZYEAR     ZADATE
3891 C**
3892 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
0922 C**                                                                  S01117
3903 C********************************************************************
     C**                                                                  S01194
     C**   *PSSR  SR TO DUMP PROGRAM WHEN DATABASE ERROR OCCURS           S01194
     C**                                                                  S01194
     C           *PSSR     BEGSR                                          S01194
     C           @RUN      IFEQ *BLANKS                                   S01194
     C                     MOVE 'Y'       @RUN    1                       S01194
     C                     DUMP                                           S01194
     C                     END                                            S01194
     C                     ENDSR                                          S01194
     C**                                                                  S01194
     C*****************************************************************   S01194
     C/COPY WNCPYSRC,GL0800C004
     C/EJECT
     OACCNTABFE                UPDAC
     O                         YTDB
     O/SPACE 2
     OGL0800P1E   0305         TITLE
0716 O***********                        22 'REFERENCE GL0800'            S01117
0716 O                                   24 'REFERENCE GL0800P1'          S01117
0717 O***********              TITL      89                               S01194
0717 O                         BJURPT    89                               S01194
0718 O                                  101 'DATE'
0719 O                         RUNA     110
0720 O                                  119 'PAGE'
0721 O                         PAGE1 Z  124
     O**                                                                  S01117
0722 OGL0800P1E     06         TITLE
0724 O***********                        59 'FOREIGN CURRENCY INCOME'     S01117
0725 O***********                        71 'AND EXPENSE'                 S01117
0724 O**********                         49 'FOREIGN CURRENCY INCOMES01117E15192
0725 O**********                         61 'AND EXPENSE'           S01117E15192
     O                         F35       61                               E15192
     O                    32             71 'BRANCH'                      S01117
     O                    32   BRCA      75                               S01117
     O                    32             76 '-'                           S01117
     O                    32   A8BRNM   106                               S01117
     O/COPY WNCPYSRC,GL0800O001
     O***********                        92 'BRANCH '                     S01117
     O***********              BRNM     124                               S01117
0726 OGL0800P1E     09         TITLE
0728 O***********                        60 '------------------------'    S01117
0729 O***********                        71 '-----------'                 S01117
0728 O**********                         50 '-----------------------S01117E15192
0729 O**********                         61 '-----------'           S01117E15192
     O                         F35U      61                               E15192
0738 OGL0800P1E     10         TITLE
0740 O***********                        21 'CUSTOMER NO.    CCY'         S01117
0741 O***********                        44 'A/C CODE    A/C SEQ'         S01117
     O/COPY WNCPYSRC,GL0800O003
     O                       32           6 'BRANCH'                      S01117
     O/COPY WNCPYSRC,GL0800O004
0740 O                                   29 'CUSTOMER NO.    CCY'         S01117
0741 O                                   52 'A/C CODE    A/C SEQ'         S01117
0742 O                                   78 'BALANCE TO PREVIOUS'
0743 O                                  103 'INCOME/EXPENSE'
0744 O                                  128 'BALANCE'
0745 OGL0800P1E     12         TITLE
     O/COPY WNCPYSRC,GL0800O005
0747 O                                   75 'END OF PERIOD'
0748 O                                  102 'THIS PERIOD'
0749 O                                  128 'TO DATE'
0750 OGL0800P1E  1             DETL
0751 O***********              #CNUM     10                               S01117
0752 O***********              #CCY      21                               S01117
0753 O***********              #ACOD     31                               S01117
0754 O***********              #ACSQ     41                               S01117
     O/COPY WNCPYSRC,GL0800O006
     O                       32BRCA       4                               S01117
     O/COPY WNCPYSRC,GL0800O007
0751 O                         #CNUM     18                               S01117
0752 O                         #CCY      29                               S01117
0753 O**********               #ACOD     39                                            S01117 CGL029
     O                         #ACOD     44                                                   CGL029
0754 O                         #ACSQ     49                               S01117
     O/COPY WNCPYSRC,GL0800O008
0755 O                       20YTDB      73 '   ,   ,   ,   , 0 '
0756 O                       21YTDB      75 '  ,   ,   ,   , 0 . '
0757 O                       22YTDB      76 ' ,   ,   ,   , 0 .  '
0758 O                       23YTDB      77 '   ,   ,   , 0 .   '
0759 O                       25          79 'CR'
     O/COPY WNCPYSRC,GL0800O009
0760 O                       20LDBL      98 '   ,   ,   ,   , 0 '
0761 O                       21LDBL     100 '  ,   ,   ,   , 0 . '
0762 O                       22LDBL     101 ' ,   ,   ,   , 0 .  '
0763 O                       23LDBL     102 '   ,   ,   , 0 .   '
0764 O                       26         104 'CR'
     O/COPY WNCPYSRC,GL0800O010
0765 O                       20NEWYTD   123 '   ,   ,   ,   , 0 '
0766 O                       21NEWYTD   125 '  ,   ,   ,   , 0 . '
0767 O                       22NEWYTD   126 ' ,   ,   ,   , 0 .  '
0768 O                       23NEWYTD   127 '   ,   ,   , 0 .   '
0769 O                       27         129 'CR'
     O/COPY WNCPYSRC,GL0800O002
     O*L0800P1E***0305         NODET                                      LN0889
0716 O***********                        22 'REFERENCE GL0800'      E15781S01117
0716 O**********                         24 'REFERENCE GL0800P1'    S01117LN0889
0717 O***********              TITL      89                         E15781S01194
0717 O**********               BJURPT    89                         S01194LN0889
0718 O**********                        101 'DATE'                  E15781LN0889
0719 O**********               RUNA     110                         E15781LN0889
     O**********                        119 'PAGE'                  S01117LN0889
     O**********               PAGE1 Z  124                         S01117LN0889
     O*L0800P1E**** 06         NODET                                      LN0889
     O***********                  72 'FOREIGN CURRENCY INCOME'     E15781S01117
     O***********                  84 'AND EXPENSE'                 E15781S01117
     O**********                         49 'FOREIGN CURRENCY INCOMES01117LN0889
     O**********                         61 'AND EXPENSE'           S01117LN0889
     O**********          32             71 'BRANCH'                S01117LN0889
     O**********          32   BRCA      75                         S01117LN0889
     O**********          32             76 '-'                     S01117LN0889
     O**********          32   A8BRNM   106                         S01117LN0889
0726 O*L0800P1E                NODET                                      LN0889
0728 O**********                         50 '-----------------------S01117LN0889
0729 O**********                         61 '-----------'           S01117LN0889
     O*L0800P1E***3040         NODET                                      LN0889
     O**********                         70 '***  NO DETAILS TO '   E15781LN0889
     O**********                         81 'REPORT  ***'           E15781LN0889
     O***GL0800P1E                ERROR                                   BHF240
     OGL0800P1E        64      ERROR                                      BHF240
     O                                   71 'DATABASE IN ERROR'           S01117
0808 OGL0800P1E 3      64      ENDBRN
0809 O***********                        76 '*** END OF REPORT ***'       S01117
     O                   N32             76 '*** END OF REPORT ***'       S01117
     O                    32             69 '*** END OF REPORT FOR'       S01117
     O                    32             84 'BRANCH     ***'              S01117
     O                    32   BRNO      80                               S01117
     O/SPACE 2
     O*L0800P2E** 0305         TITL2                                      S01117
     OGL0800AUE   0305         TITL2                                      S01117
0716 O***********                        22 'REFERENCE GL0800'            S01117
0716 O                                   24 'REFERENCE GL0800AU'          S01117
0717 O***********              TITL      89                               S01194
0717 O                         BJURPT    89                               S01194
0718 O                                  101 'DATE'
0719 O                         RUNA     110
0720 O                                  119 'PAGE'
0721 O                         PAGE2 Z  124
0730 O*L0800P2E**   06         TITL2                                      S01117
0730 OGL0800AUE     06         TITL2                                      S01117
0731 O***********                        57 'FOREIGN CURRENCY INCOME '    S01117
0732 O***********                        81 'AND EXPENSE FILE CONTROL'    S01117
0733 O***********                        88 ' TOTALS'                     S01117
0731 O**********                         60 'FOREIGN CURRENCY INCOMES01117E15192
0732 O**********                         79 'AND EXPENSE    RUN '   S01117E15192
     O**********                         87 'CONTROLS'                    E15192
     O                         F55       87                               E15192
0734 O*L0800P2E**              TITL2                                      S01117
0734 OGL0800AUE                TITL2                                      S01117
0735 O***********                        57 '------------------------'    S01117
0736 O***********                        81 '------------------------'    S01117
0737 O***********                        88 '-------'                     S01117
     O**********                         60 '---------------------- S01117E15192
     O**********                         71 '-----------'           S01117E15192
     O                         F55U      87                               E15192
0710 O*L0800P2E** 20           NONE                                       S01117
0710 OGL0800AUE   20           NONE                                       S01117
0711 O***********************************62 '*** NO F/C INCOME AND EX'    E15192
0712 O***********************************81 'PENSE MOVEMENTS ***'         E15192
     O                         F48       81                               E15192
0772 O*L0800P2E** 20           DETL2                                      S01117
0772 OGL0800AUE   20           DETL2                                      S01117
0773 O                                   56 'NUMBER OF ENTRIES GENERA'
0774 O                                   59 'TED'
0775 O                         ENTCNT3   79
0776 O*L0800P2E** 22           DETL2                                      S01117
0776 OGL0800AUE   22           DETL2                                      S01117
0777 O                                   56 'VALUE OF ENTRIES GENERAT'
0778 O                                   58 'ED'
0779 O***********              ZZTOTIZ   76                               S01117
0779 O                         ZZTOTIZ   76                               S01117
0780 O*************************ZZTOTD    80                               E10599
     O                         ZZTOTD    79                               E10599
     O*L0800P2E*3              ENDREP                                     S01117
     O***********                        76 '*** END OF REPORT ***'       S01117
     O*L0800P3E** 0305         ERROR                                      S01117
     OGL0800AUE   0305         ERROR                                      S01117
0716 O***********                        22 'REFERENCE GL0800'            S01117
0716 O                                   24 'REFERENCE GL0800AU'          S01117
0717 O***********              TITL      89                               S01194
0717 O                         BJURPT    89                               S01194
0718 O                                  101 'DATE'
0719 O                         RUNA     110
     O*L0800P3E**2             ERROR                                      S01117
     OGL0800AUE  2             ERROR                                      S01117
     O                                   62 'PRINT TERMINATED, '
     O                                   80 'DATABASE IN ERROR'
     O*L0800P3E**1             ERROR                                      S01117
     OGL0800AUE  1             ERROR                                      S01117
     O                                   44 'DATABASE ERROR'
     O                         DBASE     48
     O                                   60 'IN PROGRAM'
     O                         DBPGM     72
     O*L0800P3E**              ERROR                                      S01117
     OGL0800AUE                ERROR                                      S01117
     O                                   43 'DATABASE FILE'
     O                         DBFILE    55
     O                                   60 'KEY'
     O                         DBKEY     91
     O*****************************************************************
      *                                                                   101582
      ** TABLE NAR TEXT CHANGE                                            101582
      * 'TRANSFER FROM' BECOMES 'TRANS FROM'                              101582
      *                                                                   101582
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
** NAR - POSTING NARRATIVES
TRANSFER F/C INCOME+EXPENSE
TRANS FROM
TRANSFER TO PROFIT+LOSS
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** TXT                                                                    E15192
FOREIGN CURRENCY INCOME AND EXPENSE                                       E15192
-----------------------------------                                       E15192
FOREIGN CURRENCY INCOME AND EXPENSE FILE   RUN CONTROLS                   E15192
-------------------------------------------------------                   E15192
*** NO F/C INCOME AND EXPENSE MOVEMENTS ***                               E15192
BASE CURRENCY INCOME AND EXPENSE FILE   RUN CONTROLS                      E15192
----------------------------------------------------                      E15192
*** NO BASE CCY INCOME AND EXPENSE MOVEMENTS ***                          E15192
***BASE CCY TRANSFER NOT REQUIRED THIS PERIOD***                          E15192
