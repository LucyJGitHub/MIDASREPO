0001 H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas Reset Year-To-Date Figures')                     *
0002 F********************************************************************
0003 F*                                                                  *
     F*  Midas - General Ledger Module
0005 F*                                                                  *
0006 F*       GL0810 - RESET YEAR TO DATE FIGURES                        *
0007 F*                                                                  *
      *  (c) Finastra International Limited 2001                      *
0011 F*                                                                  *
      *  Last Amend No. MD046248           Date 27Oct17               *
      *  Prev Amend No. AR864876           Date 18Nov11               *
      *                 CRE073             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CLE025             Date 20Oct03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 E24147             Date 03Oct91               *
      *                 S01117             Date 10/03/89              *
     F*                        S01194          DATE 10/03/89             *
0011 F*                                                                  *
0012 F********************************************************************
0011 F*                                                                  *
      *  MD046248 - Finastra Rebranding                               *
      *  AR864876 - Extra page number not updated (Child:AR864877)    *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CLE025 - Credit Lines (Recompile)                            *
     F*         E24147   -   RESET STATEMENT PAGE NUMBER TO 999 NOT 0    *
0011 F*                      IF ACCOUNT OPENED AND STATEMENT PRODUCED    *
0011 F*                      ON THE DAY BEFORE YEAR END. THIS PREVENTS   *
0011 F*                      POSTINGS FROM APPEARING ON TWO STATEMENTS.  *
     F*         S01117   -     MULTIBRANCHING.                           *
     F*         S01194   -   NEW STANDING DATA.                          *
0011 F*                                                                  *
0012 F********************************************************************
0013 F* ID F  C  H  L    FUNCTION OF INDICATORS
0014 F* 01            ACCOUNTS MASTER FILE DETAIL RECORD
0015 F* 04            CATCHALL
0016 F*       11      1ST CYCLE
0019 F*       12      RETAIL ACCOUNT
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
0020 F*CCNT   UP  F     400 15AI     2 DISK                               S01117
     F***ACCNT   UP  F     400 18AI     2 DISK                                       S01117 AR864876
     FACCNT   UP  F     407 18AI     2 DISK                                                 AR864876
0021 F*ABLE   IF  F      96 12AI     2 DISK                               S01194
     F/COPY WNCPYSRC,GL0810F001
     E                    CPY@    1   1 80
     E/COPY WNCPYSRC,GL0810E001
0024 I*    ACCOUNTS MASTER FILE DETAIL RECORD
0025 IACCNT   NS  01   1 CD
0026 I                                       26  26 ATYP
0026 I                                    P  30  320DACO                  E24147
0027 I                                    P  56  630LDBL
0028 I                                    P  64  710CLBL
0026 I                                    P  75  770LSTD                  E24147
0026 I                                    P  81  820LSTP                  E24147
     I                                    P 406 4070EPNO                                    AR864876
     I/COPY WNCPYSRC,GL0810I001
     I        NS  03   1 CC
0029 I*
0030 I*    CATCH ALL
0031 I        NS
0032 I**   TABLE FILE - INSTALLATION CONTROL DATA RECORD 1.
0033 I**
0034 I*ABLE   NS  02   2 C0   3 C1  12 C1                                 S01194
0035 I*******AND      13 C0                                               S01194
0036 I***********                             1   1 RECI                  S01194
0037 I***********                             2   30RECT                  S01194
0038 I***********                            12  130RCDE                  S01194
0039 I***********                            14  66 TITL                  S01194
0040 I***********                            67  67 DATF                  S01194
0041 I***********                         P  77  790RUND                  S01194
0042 I***********                            80  86 RUNA                  S01194
     I********NS* 05   1 CD   2 C0   3 C1                                 S01194
     I*******AND*     12 C1  13 C1                                        S01194
     I***********                             1   1 RECI                  S01194
     I***********                             2   30RECT                  S01194
     I***********                            12  130RCDE                  S01194
     I***********                            14  16 BCCY                  S01194
     I***********                            17  19 BCYL                  S01194
     I***********                            20  22 HOCY                  S01194
     I***********                            23  280HEAD                  S01194
     I***********                         P  29  310APDA                  S01194
     I***********                            35  35 APFQ                  S01194
     I***********                         P  36  380LOGS                  S01194
     I***********                            39  40 CUZR                  S01194
     I***********                         P  41  430DNWD                  S01194
     I***********                            44  460BVLP                  S01194
     I***********                            47  49 LOCY                  S01194
     I***********                            50  510FDAY                  S01194
     I***********                            52  52 ACLD                  S01194
     I***********                         P  54  560EOYD                  S01194
     I***********                            86  86 ISAV                  S01194
     I***********                         P  87  890LLOG                  S01194
     I***********                         P  90  920LCD                   S01194
     I***********                            93  93 CHTP                  S01194
0042 I***********                         P  94  960TNLU                  S01194
0043 I********NS*                                                         S01194
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*     LOCAL DATA AREA                                               S01194
     ILDA        UDS                            256                       S01194
     I                                      134 141 DBFILE                S01194
     I                                      142 170 DBKEY                 S01194
     I                                      171 180 DBPGM                 S01194
     I                                      181 1830DBASE                 S01194
     I*                                                                   S01194
     I* External DTAARA for run-date                                      S01194
     I*                                                                   S01194
     IRUNDT       DS                                                      S01194
     I                                        1   7 RUNA                  S01194
     I                                    P   8  100RUND                  S01194
     I                                       11  11 SSF                   S01194
     I                                       12  12 DATF                  S01194
     I                                       13  13 MBIN                  S01194
0044 I*
     ISDBANK    E DSSDBANKPD                                              S01194
     I*    BANK DETAILS                                                   S01194
     I*
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I/EJECT                                                              S01194
0045 C*    1ST CYCLE
0046 C*
     C**                                                                  S01194
0047 C   11                GOTO DETAIL
     C                     MOVEACPY@      BIS@   80
     C**                                                                  S01194
     C** READ IN THE RUNDAT DATA AREA                                     S01194
     C**                                                                  S01194
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01194
     C                     IN   RUNDT                                     S01194
     C**                                                                  S01194
     C** SET PROGRAM NAME                                                 S01194
     C**                                                                  S01194
     C                     MOVEL'GL0810'  DBPGM  10                       S01194
     C**                                                                  S01194
     C** CHECK THE RUNDAT DATA AREA.                                      S01194
     C**                                                                  S01194
     C           RUNDT     IFEQ *BLANK                                    S01194
0049 C                     SETON                     LRU7U8               S01194
     C                     MOVEL'RUNDAT  'DBFILE                          S01194
     C                     MOVE *BLANKS   DBKEY                           S01194
     C                     MOVEL'001'     DBASE             ************  S01194
     C                     MOVE *BLANK    DBOPTN  7         * DBERR 01 *  S01194
     C                     EXSR *PSSR                       ************  S01194
     C                     END                                            S01194
0048 C***********          EXSR ZSYSTM                                    S01194
0049 C***99******          SETON                     LRU7U8               S01194
0050 C***99******          GOTO END                                       S01194
     C**
     C***********          MOVE '11'      ZTABKY                          S01194
     C***********ZTABKY    CHAINTABLE                99                   S01194
     C***99******                                                         S01194
     C*RN05******          SETON                     U7U8LR               S01194
     C***U8******          GOTO END                                       S01194
     C**                                                                  S01194
     C**  OBTAIN BANK DETAILS                                             S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                     U7U8LR               S01194
     C                     MOVEL'SDBANKPD'DBFILE                          S01194
     C                     MOVEL@OPTN     DBKEY                           S01194
     C                     MOVEL'002'     DBASE             ************  S01194
     C                     MOVEL@OPTN     DBOPTN  7         * DBERR 02 *  S01194
     C                     EXSR *PSSR                       ************  S01194
     C                     END                                            S01194
     C**
     C                     Z-ADD0         NULL   150
     C                     Z-ADD0         LSPN    30
0051 C*
0052 C*    FIND DIFFERENCE BETWEEN RUND(BJN0NB) AND 1ST JAN (BJH1BN)      S01149
0053 C*
     C***********DNWD      SUB  EOYD      DIFF    30                      S01149
     C           BJDNWD    SUB  BJEYD     DIFF    30                      S01149
     C           DIFF      SUB  1         DIFF
     C*
0059 C                     SETON                     11
0060 C*
0061 C*    DETAIL PROCESSING
0062 C*
0063 C           DETAIL    TAG
0064 C*
0065 C  N01                GOTO END
     C/COPY WNCPYSRC,GL0810C001
0075 C*                                                                   E24147
0075 C           DACO      IFEQ LSTD                                      E24147
0075 C           LSTP      ANDGT0                                         E24147
0075 C                     Z-ADD999       LSTP                            E24147
0075 C                     ELSE                                           E24147
0075 C                     Z-ADD0         LSTP                            E24147
0075 C                     END                                            E24147
      *                                                                                     AR864876
     C                     Z-ADD0         EPNO                                              AR864876
     C/COPY WNCPYSRC,GL0810C002
0075 C*
0076 C*    CALCULATE AVERAGE BALANCES
0077 C*
0078 C           ATYP      COMP 'R'                      12
0079 C  N12                GOTO END
0080 C           LDBL      MULT DIFF      AVLBL  150
0081 C           CLBL      MULT DIFF      AVCBL  150
0082 C           END       TAG
0083 C********************************************************************
0084 C***********                                                         S01194
0085 C*****ZSYSTM*SR.*TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   S01194
0086 C***********                                                         S01194
0087 C***********ZSYSTM    BEGSR                           *** ZSYSTM *** S01194
0088 C***********                                                         S01194
0089 C*****SET*UP KEY FOR INSTALLATION CONTROL RECORD.                    S01194
0090 C***********          MOVEL'01      'ZTABKY 12                       S01194
0091 C***********          MOVE '  10'    ZTABKY                          S01194
0092 C***********                                                         S01194
0093 C***********ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
0094 C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01194
0095 C***********                                                         S01194
0096 C*****CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
0097 C***********DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
0098 C***********                                                         S01194
0099 C***********          ENDSR                                          S01194
0100 C***********                                                         S01194
0101 C***********                                                         S01194
0102 C********************************************************************
     C*                                                                   S01194
     C* *PSSR  --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01194
     C*                                                                   S01194
     C* CALLED FROM: AFTER ABNORNAL OPERATION OCCURS                      S01194
     C*                                                                   S01194
     C* CALLS: NOTHING                                                    S01194
     C*                                                                   S01194
     C*****************************************************************   S01194
     C*                                                                   S01194
     C           *PSSR     BEGSR                           ** *PSSR **    S01194
     C*                                                                   S01194
     C           @RUN      IFEQ *BLANKS                                   S01194
     C                     MOVE 'Y'       @RUN    1                       S01194
     C*                                                                   S01194
     C                     DUMP                                           S01194
     C                     END                                            S01194
     C*                                                                   S01194
     C                     ENDSR                           ** *PSSR **    S01194
     C********************************************************************S01194
0165 OACCNT   D        01
     O/COPY WNCPYSRC,GL0810O001
0167 O                      N12NULL     117P
0169 O**      YTD RETAIL AV.BALANCES
0170 O                       12AVLBL    151P
0171 O                       12AVCBL    159P
     O*************************LSPN      82P                              E24147
     O                         LSTP      82P                              E24147
     O                         LSPN     238P
     O                         EPNO     407P                                                AR864876
     O        D        03
     O*************************LSPN      82P                              E24147
     O                         LSTP      82P                              E24147
     O                         LSPN     238P
     O                         EPNO     407P                                                AR864876
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
