     H        1
      *****************************************************************
/*S*D****RPGBASE*******************************************************                       CSD053
/*STD *  RPGBNOCVT                                                    *                       CSD053
/*EXS *  RPGCVTOPT1                                                   *                       CSD053
/*EXI *  TEXT('Midas GL Turrnover statements print')                  *
     F*****************************************************************
     F*                                                               *
     F*  Midas - General Ledger Module
     F*                                                               *
     F*  GL2000 - TURNOVER STATEMENTS PRINT                           *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. MD029255B          Date 25Nov14               *
      *  Prev Amend No. 224690             Date 20Oct14               *
      *                 181287             Date 20Oct14               *
      *                 AR864876           Date 18Nov11               *
      *                 MD020563           Date 21May13               *
      *                 AR1097176          Date 22Mar13               *
      *                 CFC006             Date 06Aug12               *
      *                 AR644700           Date 27Jul12               *
      *                 CER049             Date 06Dec10               *
      *                 CRE073             Date 06Dec10               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG24792           Date 07Jul09               *
      *                 CER047             Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSD053             Date 01Jun06               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 179282             Date 23Jan02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 109104             Date 20Feb98               *
      *                 100746             Date 19Feb98               *
     F*                 095356             DATE 09APR97               *
     F*                 086450             DATE 24JUN96               *
     F*                 085697             DATE 24JUN96               *
     F*                 087284             DATE 04MAY95               *
     F*                 084174             DATE 02MAR95               *
     F*                 S01413 *CREATE     DATE 13APR93               *
     F*                 xnnnnn             DATE nnxxxnn               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD029255B - CM STATEMENT_TURNOVER extracts wrong             *
      *              <BfwdBalance> for GL and Retail accounts.        *
      *            - Make sure to update ECFB field when statement    *
      *              frequency is 'E'.                                *
      *  224690 - Ensure B/F date is equal to last movement date in   *
      *           start of day record.                                *
      *         - Applied for MD029255.                               *
      *  181287 - For turnover reports, the last movement date is     *
      *           used in the brought forward date instead of the     *
      *           last statement date.  Applied fix 094500.           *
      *         - Applied for MD029255.                               *
      *  AR864876 - Extra page number not updated (Child:AR864877)    *
      *  MD020563 - CFC006 issues                                     *
      *  AR1097176 - Accessing AOCOMR0 multiple times slows down      *
      *              the system                                       *
      *  CFC006 - COB Restructure - Remove reports from COB           *
      *  AR644700 - Profit Centre field is being overriden and changed*
      *             to blank. Apply 231849 renaming PRFC under ACCNTAB*
      *  CER049 - Stamp Tax (Recompile)                               *
      *  CRE073 - Interest Rate Rounding (Recompile)                  *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG24792 - Next Statement date on ACCNTAB is incorrect       *
      *           - Applied fix 239343. Replace FOK015 with CGL013    *
      *         - Correct update of ACCNTAB for Multicash accounts    *
      *           Changes for FOK015=Multicash stmt.frequency         *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSD053 - Correspondence Manager Multilanguage Upgrade        *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  179282 - GL2000AU not shown in Today's / Yesterday's         *
      *           reporting enquiry.  Need to enroll the audit report *
      *           in RCF to show in the enquiry options.              *
      *  CGL007 - Account Postings Enquiry (Recompile)                *
      *  109104 - Branch name not being setup correctly.
     F*  100746 - OVERFLOW PROBLEM                                    *
     F*  095356 - Rename STYP of ACCNTAB so that it will not be       *
     F*           overwritten by STYP from the postings.              *
     F*  086450 - DB error 06 in file RECOM if a/c has been closed.   *
     F*           Fix is to produce a turnover ststement for an a/c   *
     F*           which has been closed today, but do not update      *
     F*           RECOM with no. of chargeable statements.            *
     F*  085697 - Turnover statements cannot be distributed by RCF.   *
     F*  087284 - Use AOCUSTR0 to retrieve address reference B        *
     F*  084174 - Use AOALTNR0 to retrieve alternative addresses      *
     F*  S01413 - Retail 3 Incorporation                              *
     F*                                                               *
     F*****************************************************************
     F*GL2000AUO**E************        PRINTER                            179282
     FGL2000AUO   E                    PRINTER      KINFDS SPOOLU         179282
     F*                                Audit report
     FGL2000P1O   E             01     PRINTER                        UC
     F************                                  KINFDS INFDS          085697
     F                                              KINFDS SPOOL          085697
     F*                                Statements
     FCLINT   IF  E           K        DISK
     F            CLINTCAF                          KIGNORE
     F            CLINTCCF                          KIGNORE               084174
     F            CLINTC1F                          KIGNORE
     F            CLINTSEF                          KIGNORE
     F*                                Customer details
     FEODPOTS IF  E           K        DISK
     F*                                Daily postings
     FRECOM   UF  E           K        DISK
     F                                              KINFDS COMDS
     F                                              KINFSR COMSR
     F*                                Account details
     FGLACNTL1UF  E           K        DISK
     F                                              KINFDS ACNTDS
     F                                              KINFSR ACNTSR
     F*                                Account details
     FSDBRCHL1IF  E           K        DISK
     F*                                Branch codes
     FSDCURRL1IF  E           K        DISK
     F*                                Currencies details
     FGLNW94L8IF  E           K        DISK                                                 BUG24792
     F*                                Network Transaction                                  BUG24792
     FGLACBTL0IF  E           K        DISK                                                   181287
     F/COPY WNCPYSRC,GL2000F001
     F*****************************************************************
     F*                                                               *
     F*  Function of indicators:                                      *
     F*                                                               *
     F*     01  -  Overflow on GL2000P1                               *
     F*     20  -  Output 'COPY' if current copy number GT 1          *
     F*     21  -  Output A/C name if A/C type = Retail               *
     F*     22  -  Output address if 'Print address = Yes'            *
     F*     30  -  Currency decimal positions : 0                     *
     F*     31  -  Currency decimal positions : 1                     *
     F*     32  -  Currency decimal positions : 2                     *
     F*     33  -  Currency decimal positions : 3                     *
     F*     50  -  On = Credit movement / Off = Debit movement        *
     F*     55  -  Chain fail on LF/GLACBTL0                          *                       181287
     F*     58  -  On = Multibranching. Print branch code             *
     F*     60  -  Output B/F balance details                         *
     F*     80  -  LOKUP operation successful                         *
     F*     81  -  EOF on TABTG10, i.e. CCY array completely loaded   *
     F*     84  -  CHAIN failed on RECOM                              *
     F*     85  -  CHAIN failed on CLINT/SDALTNL2                     *
     F*     86  -  No record found for SETLL on EODPOTS               *
     F*            Also used to condition output of detail line       *
     F*     88  -  Condition secondary loop on GLACNTL1               *
     F*     89  -  Condition main READ loop on TABLETR. Also used for *
     F*            ICD1.                                              *
     F*     95  -  DATABASE error                                     *
     F*     LR  -  End processing                                     *
     F*****************************************************************
     E/COPY ZSRSRC,ZDATE2Z1
     E                    CPY@    1   1 80
     E                    CY        150  3               Currencies
     E                    DP        150  1 0             Currency dec. pl.
     E                    NM        150 14               Currency name
     E                    ADR        10  1               Address reference
     E/COPY WNCPYSRC,GL2000E003
     E                    NAR         4 25
     E/COPY WNCPYSRC,GL2000E001
     E                    CMD     1   2 39
     E/COPY WNCPYSRC,GL2000E002
     E*-------------------------------------------------------------------------
     IAPOSTPDF
      *
      * Rename EODPOTS fields to avoid confusion...
      *
     I              RECI                            PORECI
     I              CNUM                            POCNUM
     I              CCY                             POCCY
     I              ACOD                            POACOD
     I              ACSQ                            POACSQ
     I              ACNO                            POACNO
     I              BRCA                            POBRCA
     I              ATYP                            POATYP
      *
     I@A8REB0
      *
      * Rename SDBRCHPD fields
      *
     I              A8BRCD                          TRBRCA
     I              A8BRNM                          TRBRNM
      *
     I@A6REA3
      *
      * Rename SDCURRPD fields
      *
     I              A6CYCD                          CCY
     I              A6NBDP                          CDP
     I              A6CYNM                          CYNM
     I*
     I*********** CLINTCCF                                                084174
     I***********                                                         084174
     I*********** Rename CLINTCC fields                                   084174
     I***********                                                         084174
     I***********   RECI                            CCRECI                084174
     ICLINTCBF
      *
      * Rename CLINTCB fields
      *
     I              RECI                            CBRECI
     I              BRCB                            CBBRCA
     IRECOMDF
      *
      * Rename RECOMD field
      *
     I              RECI                            RERECI
     IACCNTABF
      *
      * Rename ACCNTAB field
      *
     I              RRNM                            ACRRNM
     I              LCD                             ALCR
     I              CHTP                            ACHTP
     I              STYP                            ASTYP                 095356
     I              PRFC                            APRFC                                   AR644700
      *                                                                                       181287
      ** Rename GLACBTL0 fields                                                               181287
      *                                                                                       181287
     IGLACBLF                                                                                 181287
     I              RECI                            GRECI                                     181287
     I              LDBL                            GLDBL                                     181287
     I              CLBL                            GCLBL                                     181287
     I              LMVD                            GLMVD                                     181287
      *                                                                                     BUG24792
     IGLNW94D0                                                                              BUG24792
      ** SAR File Details Accessed via access program AOSARDR0                              BUG24792
      *                                                                                     BUG24792
     I              QQACCD                          QQACCS                                  BUG24792
      *-------------------------------------------------------------------------
     I*INFDS*******DS                                                     085697
      *
      **Get*current line number from printer INFDS                        085697
      *
     I***********                         B 367 3680WWLINE                085697
      *-------------------------------------------------------------------------
     I           SDS
      *
      * Get program name and exception data from PSDS.
      *
     I                                     *PROGRAM #PGM
     I                                       91 170 WWEXCP
      *-------------------------------------------------------------------------
     I            DS
      *
      * Use a DS to access file/program fields via the PRTF field names,
      * thus avoiding MOVE operations
      *
      * Debit posting amount : 1-13
     I                                        1  130WWDRAM
     I                                        1  130P1DRA0
     I                                        1  130P1DRA1
     I                                        1  130P1DRA2
     I                                        1  130P1DRA3
      * Credit posting amount : 14-26
     I                                       14  260WWCRAM
     I                                       14  260P1CRA0
     I                                       14  260P1CRA1
     I                                       14  260P1CRA2
     I                                       14  260P1CRA3
      * Brought forward balance : 27-41
     I                                       27  410WWBFWB
     I                                       27  410P1BFW0
     I                                       27  410P1BFW1
     I                                       27  410P1BFW2
     I                                       27  410P1BFW3
      * Carried forward balance : 42-56
     I                                       42  560WWCFWB
     I                                       42  560P1CFW0
     I                                       42  560P1CFW1
     I                                       42  560P1CFW2
     I                                       42  560P1CFW3
      * Account name : 57-76
     I                                       57  76 ANAM
     I                                       57  76 P1ANAM
      * Currency : 77-79
     I                                       77  79 CCY
     I                                       77  79 P1CCY
     I                                       77  79 P1CCY1
     I/COPY WNCPYSRC,GL2000I003
     I*
     I**   NAME OF MESSAGE FILE
     I*
     I            DS
     I                                        1  39 CMD1
     I                                       33  34 FILT2
     I*
     I** DATA STRUCTURE FOR RPG STATUS ERROR HANDLING
     I*
     ICOMDS       DS
     I                                     *STATUS  STSCOM
     IACNTDS      DS
     I                                     *STATUS  STSACT
     I/COPY WNCPYSRC,GL2000I005
     IRUNDT       DS
     I*
     I* External DTAARA for multi branch indicator
     I*
     I                                       13  13 MBIN
     I*
     I**   FILE INFORMATION DATA STRUCTURE
     I**
     ISPOOL       DS
     I                                       83  92 SFILE
     I                                    B 123 1240SFNUM
      * Get current line number from printer INFDS                        085697
      *                                                                   085697
     I                                    B 367 3680WWLINE                085697
     I/COPY WNCPYSRC,GL2000I001
     ISPOOLU      DS
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
     I*
     I** LOCAL DATA AREA FOR DATABASE ERROR DETAILS
     I*
     ILDA        UDS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     ISDBANK    E DSSDBANKPD
     I              BJURPT                          TITL
     I              BJMRDT                          RUNA
     I              BJDFIN                          DATF
     I*
     I** Bank Details
     I*
     I*
     ISDRETL    E DSSDRETLPD
     I*
     I** Retail details
     I*
     ISDNWRK    E DSSDNWRKPD                                                                AR864876
     I*                                                                                     AR864876
     I** Message network details                                                            AR864876
     I*                                                                                     AR864876
     IDSFDY     E DSDSFDY
     I*
     I** First DS for access programs, Short data structure
     I*
     IDSSDY     E DSDSSDY
     I*
     I** Second DS for access programs, Long data structure
     I*                                                                                     AR864876
     IDSLDY     E DSDSLDY                                                                   AR864876
      **  Third DS for access programs, very long data structure.                           AR864876
     I*
     I***/COPY*WNCPYSRC,GL2000I004                                                            CFC006
     I/COPY WNCPYSRC,GL2000I004                                                             MD020563
     I*___________________________________________________________________084174
     I* 084174                                                            084174
     I*                                                                   084174
     I***P#CORR    E DSCGCORRPD                                     084174087284
     I*                                                                   087284
     I* Data structure for returned values from AOALTNR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     IP#ALTN    E DSSDALTNPD                                              087284
     I*                                                                   087284
     I* Data structure for returned values from AOALTNR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     IP#CUSD    E DSSDCUSTPD                                              087284
     I*                                                                   087284
     I* Data structure for returned values from AOCUSTR0 --               087284
     I*  alternative names and addresses                                  087284
     I*                                                                   087284
     I* 084174                                                            084174
     I***/COPY*WNCPYSRC,GL2000I002                                                            CFC006
     I/COPY WNCPYSRC,GL2000I002                                                             MD020563
     I              'GL2000001'           C         SECTN                                     CFC006
     I*~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~084174
      /EJECT
      *-------------------------------------------------------------------------
      * Initial processing
      *-------------------------------------------------------------------------
     C                     MOVEACPY@      BIS@   80
      *
      * Redefine key fields for program
      *
     C           *LIKE     DEFN CNUM      KCNUM
     C           *LIKE     DEFN CCY       KCCY
     C           *LIKE     DEFN ACOD      KACOD
     C           *LIKE     DEFN ACSQ      KACSQ
     C           *LIKE     DEFN ATYP      KATYP
     C           *LIKE     DEFN BRCA      KBRCA
     C           *LIKE     DEFN PSTD      KPSTD
     C           *LIKE     DEFN DRCR      KDRCR
     C           *LIKE     DEFN RCDT      KRCDT
     C           *LIKE     DEFN P1CNA1    CNA1                                                CSD053
     C           *LIKE     DEFN P1CNA2    CNA2                                                CSD053
     C           *LIKE     DEFN P1CNA3    CNA3                                                CSD053
     C           *LIKE     DEFN P1CNA4    CNA4                                                CSD053
     C*
     C* Parameter list for AORETLR0
     C*
     C           PLIST3    PLIST
     C                     PARM '*DBERR ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDRETL    PARM SDRETL    DSFDY
      *
      * Define KLIST for CHAINs on CLINT
      *
     C           KCCLNT    KLIST
     C                     KFLD           CNUM
     C                     KFLD           KRCDT
      *
      * Define KLIST for SETTLs on GLACNTL1
      *
     C           KSACNT    KLIST
     C                     KFLD           KBRCA
     C                     KFLD           KATYP
     C                     KFLD           KCNUM
     C                     KFLD           KCCY
     C                     KFLD           KACOD
     C                     KFLD           KACSQ
      *
      * Define KLIST for READEs on EODPOTS
      *
     C           KREDPO    KLIST
     C                     KFLD           KBRCA
     C                     KFLD           ATYP
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
      *
      * Define KLIST for CHAIN's on RECOM
      *
     C           KCRECO    KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
      *
      * Define KLIST for SETLL's on EODPOTS
      *
     C           KSEDPO    KLIST
     C                     KFLD           KBRCA
     C                     KFLD           ATYP
     C                     KFLD           CNUM
     C                     KFLD           CCY
     C                     KFLD           ACOD
     C                     KFLD           ACSQ
     C                     KFLD           KPSTD
     C                     KFLD           KDRCR
      *                                                                                       181287
      ** Define KLIST for GLACBTL0                                                            181287
      *                                                                                       181287
     C           KGLAC     KLIST                                                              181287
     C                     KFLD           CNUM                                                181287
     C                     KFLD           CCY                                                 181287
     C                     KFLD           ACOD                                                181287
     C                     KFLD           ACSQ                                                181287
     C                     KFLD           BRCA                                                181287
     C***/COPY*WNCPYSRC,GL2000C004                                                            CFC006
     C/COPY WNCPYSRC,GL2000C004                                                             MD020563
      *****************************************************************           AR1097176 MD020563
      ***Check*if*CFC006*is*installed**********************************           AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
     C**********           MOVE 'N'       CFC006  1                               AR1097176 MD020563
     C**********           CALL 'AOSARDR0'                                        AR1097176 MD020563
     C**********           PARM *BLANKS   @RTCD                                   AR1097176 MD020563
     C**********           PARM '*VERIFY' @OPTN                                   AR1097176 MD020563
     C**********           PARM 'CFC006'  @SARD                                   AR1097176 MD020563
     C**********           PARM *BLANKS   UFFDY                                   AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
     C********** @RTCD     IFEQ *BLANKS                                           AR1097176 MD020563
     C**********           MOVE 'Y'       CFC006                                  AR1097176 MD020563
     C**********           ELSE                                                   AR1097176 MD020563
      *****************************************************************           AR1097176 MD020563
     C********** @RTCD     IFNE '*NRF   '                                         AR1097176 MD020563
     C**********           MOVEL'SCSARDPD'DBFILE                                  AR1097176 MD020563
     C**********           MOVEL'CFC006'  DBKEY                                   AR1097176 MD020563
     C**********           EXSR DBSR                                              AR1097176 MD020563
     C**********           ENDIF                                                  AR1097176 MD020563
     C**********           ENDIF                                                  AR1097176 MD020563
      *                                                                                       CFC006
      ** Enable output indicator for GL2000P1                                                 CFC006
      *                                                                                       CFC006
     C                     MOVEL'N'       SUPFLG  1                                           CFC006
      *                                                                                    AR1097176
     C********** CFC006    IFEQ 'Y'                                               AR1097176 MD020563
     C                     CALL 'AOCOMR0'                                                     CFC006
     C                     PARM 'GLC2000' PNAME  10                                           CFC006
     C                     PARM '*ALL '   PCSEQ   5                                           CFC006
     C                     PARM SECTN     PSCTN  50                                           CFC006
     C                     PARM *BLANKS   PRTCD   7                                           CFC006
      *                                                                                       CFC006
     C           PRTCD     IFEQ 'Y      '                                                     CFC006
     C                     MOVEL'Y'       SUPFLG                                              CFC006
     C                     ENDIF                                                              CFC006
     C**********           ENDIF                                                  AR1097176 MD020563
      *                                                                                     BUG24792
     C           KACNBY    KLIST                                                            BUG24792
     C                     KFLD           BRCA                                              BUG24792
     C                     KFLD           CNUM                                              BUG24792
     C                     KFLD           CCY                                               BUG24792
     C                     KFLD           ACOD                                              BUG24792
     C                     KFLD           ACSQ                                              BUG24792
      *
      * Setup key field values for KLIST's
      *
     C                     MOVE *LOVAL    KATYP
     C                     MOVE *LOVAL    KCNUM
     C                     MOVE *LOVAL    KCCY
     C                     MOVE *LOVAL    KACOD
     C                     MOVE *LOVAL    KACSQ
     C                     MOVE *LOVAL    KPSTD
     C                     MOVE *LOVAL    KDRCR
     C*
     C                     EXSR FIRST
     C/COPY WNCPYSRC,GL2000C009
     C*
      *
      * Load currencies arrays with CCY and CDP
      * Load the first 150 elements. If not all elements can be loaded,
      * the program will chain to the file and load it at that time.
      * The new element will erase an existing one.
      *
     C                     Z-ADD0         Y       30
     C                     MOVE *LOVAL    CCY
     C           CCY       SETLL@A6REA3
     C                     READ @A6REA3                  81
     C           Y         DOWLE150
     C           *IN81     ANDEQ'0'
     C                     ADD  1         Y
     C                     MOVEACCY       CY,Y
     C                     Z-ADDCDP       DP,Y
     C                     MOVEACYNM      NM,Y
     C                     READ @A6REA3                  81
     C                     END
     C*
     C                     Z-ADD39        MSGLEN 155
     C                     MOVE 'GB'      WWLGID  2
     C                     MOVE WWLGID    FILT2
     C                     MOVELCMD,1     CMD1
     C                     CALL 'QCMDEXC'
     C                     PARM           CMD1
     C                     PARM           MSGLEN
     C                     EXSR MULTL
      /EJECT
      *-------------------------------------------------------------------------
      * Main processing - Loop on Branch codes
      *
     C                     MOVE *LOVAL    TRBRCA
     C           TRBRCA    SETLL@A8REB0
     C                     READ @A8REB0                  89
     C                     MOVELTRBRNM    P1BRNM
      *
     C           *IN89     DOWEQ'0'
      *
      * Open printer file each time a new Branch code is read.
      * This will generate one spooled file for each branch.
      *
     C                     OPEN GL2000P1
      *                                                                   085697
      **  ENSURE REPORT SPOOL FILE RECORDED BY RCF                        085697
     C                     Z-ADDSFNUM     SFNO    60                      085697
     C                     OUT  LDA                                       085697
     C                     CALL 'ZSFILE'                                  085697
     C**********           PARM           SEQ     5                085697 179282
     C                     PARM ZSEQ      SEQ     5                       179282
     C                     PARM BRCA      SENTY   3                       085697
     C                     PARM           SFILE                           085697
     C                     PARM           SFNO                            085697
     C                     PARM           ZSERR   1                       085697
      *                                                                   085697
     C           *LOCK     IN   LDA                                       085697
     C           ZSERR     IFEQ 'Y'                                       085697
      *                                                                   085697
      * ERROR DURING ZSFILE PROCESSING, RETURN TO CALLING PROGRAMME       085697
      *                                                                   085697
     C                     SETON                     U7U8LR               085697
     C                     RETRN                                          085697
     C                     END                                            085697
      *
     C                     MOVE TRBRCA    KBRCA
     C           KSACNT    SETLLGLACNTL1
     C                     READ GLACNTL1                 88
      *
     C           *IN88     DOWEQ'0'
     C           BRCA      ANDEQKBRCA
      *
      * Check whether postings exist for this account
      *
     C           KSEDPO    SETLLEODPOTS
     C           KREDPO    READEEODPOTS                  86
     C/COPY WNCPYSRC,GL2000C008
      *                                                                                     BUG24792
      ** Incorporate GL2000C008 from R4                                                     BUG24792
      *                                                                                     BUG24792
     C           *IN86     IFEQ '0'                                                         BUG24792
     C*                                                                                     BUG24792
     C           CGL013    IFEQ 'Y'                                                         BUG24792
     C           CER030    ANDEQ'Y'                                                         AR864876
     C           ATYP      ANDEQ'R'                                                         BUG24792
     C*                                                                                     BUG24792
     C********** KACNBY    CHAINGLNW94L8             86                            BUG24792 AR864876
     C           KACNBY    CHAINGLNW94L8             87                                     AR864876
     C*                                                                                     BUG24792
     C********** *IN86     IFEQ '0'                                                BUG24792 AR864876
     C           *IN87     IFEQ '0'                                                         AR864876
     C           N40SFR    ANDNE'E'                                                         BUG24792
      *                                                                                     AR864876
     C                     CALL 'AONWRKR1'                                                  AR864876
     C                     PARM *BLANKS   P#RTCD                                            AR864876
     C                     PARM '*KEY'    P#OPTN                                            AR864876
     C                     PARM N4NWRK    PNWRK   6                                         AR864876
     C           SDNWRK    PARM SDNWRK    DSLDY                                             AR864876
     C           P#RTCD    IFEQ *BLANKS                                                     AR864876
     C           EDMCNW    ANDEQ'Y'                                                         AR864876
      *                                                                                     BUG24792
     C*                                                                                     BUG24792
     C                     ADD  1         EPNO                                              BUG24792
     C                     Z-ADDECFB      WWCFWB                                            BUG24792
     C*                                                                                     BUG24792
     C           *IN86     DOWEQ'0'                                                         BUG24792
     C           DRCR      IFEQ 0                                                           BUG24792
     C                     ADD  PSTA      WWCFWB                                            BUG24792
     C                     ELSE                                                             BUG24792
     C                     SUB  PSTA      WWCFWB                                            BUG24792
     C                     END                                                              BUG24792
     C           KREDPO    READEEODPOTS                  86                                 BUG24792
     C                     END                                                              BUG24792
     C*                                                                                     BUG24792
     C                     Z-ADDWWCFWB    ECFB                                              BUG24792
      *                                                                                    MD029255B
      ** Update extra carried forward balance with the ledger balance                      MD029255B
      ** amount if statement frequency is 'E' (Turnover)                                   MD029255B
      *                                                                                    MD029255B
     C           STFQ      IFEQ 'E'                                                        MD029255B
     C                     Z-ADDLDBL      ECFB                                             MD029255B
     C                     ENDIF                                                           MD029255B
      *                                                                                    MD029255B
     C                     UPDATACCNTABF                                                    BUG24792
      *                                                                                     BUG24792
     C                     ENDIF                                                            AR864876
     C                     END                                                              BUG24792
     C*                                                                                     BUG24792
     C                     END                                                              BUG24792
     C*                                                                                     BUG24792
     C                     END                                                              BUG24792
      *
     C           *IN86     IFEQ '0'                        Postings exist
     C/COPY WNCPYSRC,GL2000C010
     C*
     C                     MOVE 'A'       KRCDT
     C           KCCLNT    CHAINCLINT                65
     C*
     C           *IN65     IFEQ '1'
     C                     MOVEL'CLINT   'DBFILE           ***************
     C                     MOVELCNUM      DBKEY            * DB ERROR 01 *
     C                     Z-ADD1         DBASE            ***************
     C                     WRITEERRP1
     C                     EXSR DBSR
     C                     ELSE
     C           LGID      IFEQ *BLANKS
     C                     MOVE 'GB'      LGID    2
     C                     END
     C           LGID      IFNE WWLGID
     C                     Z-ADD11        MSGLEN
     C                     MOVELCMD,2     CMD1
     C                     CALL 'QCMDEXC'
     C                     PARM           CMD1
     C                     PARM           MSGLEN
     C*
     C                     Z-ADD39        MSGLEN
     C                     MOVE CMD,1     CMD1
     C                     MOVELLGID      FILT2
     C                     CALL 'QCMDEXC'
     C                     PARM           CMD1
     C                     PARM           MSGLEN
     C                     EXSR MULTL
     C                     MOVE LGID      WWLGID
     C                     END
     C                     END
      *
      * Setup current statement page
      *
     C                     ADD  1         EPNO
      *
      * Setup output of A/C name
      *
     C           ATYP      IFEQ 'R'
     C                     MOVE '1'       *IN21
     C                     MOVELACNO      P1ACNO
     C                     ELSE
     C                     MOVE '0'       *IN21
      *
      * If Retail numbers not used, suppress *IN21.
      *
     C           *IN21     IFEQ '1'
     C           BMRANR    ANDNE'Y'
     C                     SETOF                         21
     C                     END
     C                     END
      *
      **Setup*output*for*GL*account:*CNUM*-*ACOD*-*ACSQ
      * Setup other account reference details
      *
     C                     MOVELBRCA      P1BRCA
     C                     MOVELCNUM      P1CNUM
     C                     MOVELACOD      P1ACOD
     C                     MOVELACSQ      P1ACSQ
      *
      * Setup output for address
      *
     C                     TESTB'2'       GLBT           22
      *
      * Format address references from ACCNT
      *
     C                     MOVELADREF1    WWARRY 10
     C                     MOVE ADREF2    WWARRY
     C                     MOVEAWWARRY    ADR              Address references
     C                     Z-ADD1         A       20       ADR index
      *
      * Process last statement date
      *
      *                                                                                       181287
      ** Opening balance date should be the last movement date instead                        181287
      ** of the last statement date.                                                          181287
      *                                                                                       181287
     C           KGLAC     CHAINGLACBTL0             55                                       181287
     C           *IN55     IFEQ '0'                                                           181287
     C           GLMVD     ANDGT0                                                             181287
     C                     Z-ADDGLMVD     ZDAYNO                                              181287
     C                     ELSE                                                               181287
     C                     Z-ADDDACO      ZDAYNO                                              181287
     C                     END                                                                181287
     C**********           Z-ADDLSTD      ZDAYNO                                              224690
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    P1LSTD
     C/COPY WNCPYSRC,GL2000C011
      *
      * Process all addresses (up to 10) found in ADR
      *
     C           A         DOWLE10
     C           ADR,A     ANDNE*BLANK
      *
     C                     MOVE ADR,A     KRCDT
      *
      * Retrieve customer details
      *
     C********** KCCLNT    CHAINCLINT                85                   084174
     C***********                                                         084174
     C*********** DB error if no details found or not live                084174
     C***********                                                         084174
     C********** *IN85     IFEQ '1'                                       084174
     C***********          MOVEL'CLINT   'DBFILE           ***************084174
     C***********          MOVELCNUM      DBKEY            * DB ERROR 02 *084174
     C***********          Z-ADD2         DBASE            ***************084174
     C***********          WRITEERRP1                                     084174
     C***********          EXSR DBSR                                      084174
     C***********                                                         084174
     C                     MOVELCNUM      P#CUST                          084174
     C                     MOVEL*BLANKS   P#CUS1                          087284
     C                     MOVELCNUM      P#CUS1                          087284
      *                                                                   087284
      * If address reference is B use AOCUSTRO else AOALTNR0              087284
      *                                                                   087284
     C           KRCDT     IFEQ 'B'                                       087284
     C                     CALL 'AOCUSTR0'             9090               087284
     C                     PARM *BLANKS   P#RTCD  7                       087284
     C                     PARM '*KEY   ' P#OPTN  7                       087284
     C                     PARM           P#CUS1 10                       087284
     C                     PARM *BLANKS   P#KYST  7                       087284
     C           P#CUSD    PARM *BLANKS   DSSDY                           087284
      *                                                                   087284
     C           *IN90     IFEQ '1'                                       087284
     C                     MOVEL'AOCUSTR0'DBFILE           ***************087284
     C                     MOVELCNUM      DBKEY            * DB ERROR 22 *087284
     C                     Z-ADD22        DBASE            ***************087284
     C                     WRITEERRP1                                     087284
     C                     EXSR DBSR                                      087284
     C                     END                                            087284
     C                     ELSE                                           087284
     C*                                                                   084174
     C                     CALL 'AOALTNR0'                                084174
     C                     PARM *BLANKS   P#RTCD  7        B:Return code  084174
     C                     PARM '*KEY   ' P#OPTN  7        I:Option       084174
     C                     PARM           P#CUST  6        I:Customer no. 084174
     C                     PARM KRCDT     P#ADCD  1        I:Address code 084174
     C***********P#CORR    PARM P#CORR    DSFDY            O:Format 084174087284
     C           P#ALTN    PARM P#ALTN    DSFDY            O:Format       087284
     C*                                                                   084174
     C                     ENDIF                                          087284
      *                                                                   087284
     C           P#RTCD    IFNE *BLANKS                                   084174
     C                     MOVEL'AOALTNR0'DBFILE           ***************084174
     C                     MOVELCNUM      DBKEY            * DB ERROR 02 *084174
     C                     Z-ADD2         DBASE            ***************084174
     C                     WRITEERRP1                                     084174
     C                     EXSR DBSR                                      084174
     C*                                                                   084174
     C                     ELSE                                           084174
     C***********          MOVELCDADD1    CNA1   35                 084174087284
     C***********          MOVELCDADD2    CNA2   35                 084174087284
     C***********          MOVELCDADD3    CNA3   35                 084174087284
     C***********          MOVELCDADD4    CNA4   35                 084174087284
      *                                                                   087284
      * Move in address fields                                            087284
      *                                                                   087284
     C           KRCDT     IFEQ 'B'                                       087284
     C                     MOVELBBCNA1    CNA1                            087284
     C                     MOVELBBCNA2    CNA2                            087284
     C                     MOVELBBCNA3    CNA3                            087284
     C                     MOVELBBCNA4    CNA4                            087284
     C                     ELSE                                           087284
     C**********           MOVELBCCNA1    CNA1   35                       087284              CSD053
     C**********           MOVELBCCNA2    CNA2   35                       087284              CSD053
     C**********           MOVELBCCNA3    CNA3   35                       087284              CSD053
     C**********           MOVELBCCNA4    CNA4   35                       087284              CSD053
     C                     MOVELBCCNA1    CNA1                                                CSD053
     C                     MOVELBCCNA2    CNA2                                                CSD053
     C                     MOVELBCCNA3    CNA3                                                CSD053
     C                     MOVELBCCNA4    CNA4                                                CSD053
     C                     ENDIF                                          087284
     C***********                                                         084174
     C********** CCRECI    IFNE 'D'                                       084174
     C***********          MOVEL'CLINT   'DBFILE           ***************084174
     C***********          MOVELCNUM      DBKEY            * DB ERROR 03 *084174
     C***********          Z-ADD3         DBASE            ***************084174
     C***********          WRITEERRP1                                     084174
     C***********          EXSR DBSR                                      084174
     C***********          END                                            084174
      *
     C                     END
      *
      * Customer valid, setup customer details for printing
      * depending on flag 'Print address = Yes' (Bit 2 in GLBT=on)
      *
     C           *IN22     IFEQ '1'
     C                     MOVELCNA1      P1CNA1
     C                     MOVELCNA2      P1CNA2
     C                     MOVELCNA3      P1CNA3
     C                     MOVELCNA4      P1CNA4
     C                     ELSE
     C                     MOVE *BLANKS   P1CNA1
     C                     MOVE *BLANKS   P1CNA2
     C                     MOVE *BLANKS   P1CNA3
     C                     MOVE *BLANKS   P1CNA4
     C                     END
      *
      * Increment address counter
      *
     C                     ADD  1         WWADRC 150
      *
      *
      * Setup output depending on currency decimal places
      *
     C                     Z-ADD1         Y
     C                     MOVE '0'       *IN80
     C           CCY       LOKUPCY,Y                     80
      *
      * Currency not found in array, CHAIN to file
      *
     C           *IN80     IFEQ '0'
     C           CCY       CHAIN@A6REA3              81
      *
      * Currency not found in file, DB error
      *
     C           *IN81     IFEQ '1'
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C                     MOVELCCY       DBKEY            * DB ERROR 04 *
     C                     Z-ADD4         DBASE            ***************
     C                     WRITEERRP1
     C                     EXSR DBSR
      *
     C                     ELSE
      *
      * Currency found and live, reload the array
      *
     C                     ADD  1         Z       30
      *
      * Ensure index not too large, i.e. array already reloaded
      *
     C           Z         IFGT 150
     C                     Z-ADD1         Z
     C                     END
      *
     C                     MOVEACCY       CY,Z
     C                     Z-ADDCDP       DP,Z
      *
      * Use Y as index no matter whether LOKUP successful or currency
      * loaded now (index = Z)
      *
     C                     Z-ADDZ         Y
      *
     C                     END
     C                     END
      *
      * Currency found, format decimal places
      *
     C                     MOVE NM,Y      P1CYNM
     C                     MOVEA'0000'    *IN,30
     C           DP,Y      IFEQ 2
     C                     MOVE '1'       *IN32
     C                     ELSE
     C           DP,Y      IFEQ 0
     C                     MOVE '1'       *IN30
     C                     ELSE
     C           DP,Y      IFEQ 1
     C                     MOVE '1'       *IN31
     C                     ELSE
     C           DP,Y      IFEQ 3
     C                     MOVE '1'       *IN33
     C                     END
     C                     END
     C                     END
     C                     END
      *
      *
      * Determine whether B/F balance is DR or CR
      *
     C                     MOVE *BLANKS   P1OPNB
     C           ECFB      IFNE 0
     C           ECFB      IFGE 0
     C                     MOVELNAR,1     P1OPNB
     C                     ELSE
     C                     MOVELNAR,2     P1OPNB
     C                     END
     C                     END
      *
      * Setup opening balance
      *
     C                     Z-ADDECFB      WWBFWB
      *
      * Increment 'Number of A/C generating statements' counter
      * and setup statement number
      *
     C                     ADD  1         P2NOAC
     C                     Z-ADDEPNO      P1STNO
      *
      * Execute routine to handle and print statement for a customer
      *
     C***/COPY*WNCPYSRC,GLH00601                                                              CFC006
     C/COPY WNCPYSRC,GLH00601                                                               MD020563
     C           SUPFLG    IFNE 'Y'                                                           CFC006
     C                     EXSR SSTMT
     C***/COPY*WNCPYSRC,GLH00602                                                              CFC006
     C/COPY WNCPYSRC,GLH00602                                                               MD020563
     C                     ENDIF                                                              CFC006
      *
     C                     ADD  1         A
     C                     END
      *
      * Calculate new carried forward balance
      *
     C                     Z-ADDWWCFWB    ECFB
     C/COPY WNCPYSRC,GL2000C016                                                             BUG24792
     C           CGL013    IFEQ 'Y'                                                         BUG24792
     C           CER030    ANDEQ'Y'                                                         AR864876
     C           ATYP      ANDEQ'R'                                                         BUG24792
     C           N40SFR    ANDEQ'E'                                                         BUG24792
      *                                                                                     BUG24792
     C                     Z-ADDECFB      CFSB                                              BUG24792
     C                     Z-ADDEPNO      LSTP                                              BUG24792
     C                     Z-ADDLMVD      LSTD                                              BUG24792
     C*                                                                                     BUG24792
     C                     ENDIF                                                            BUG24792
      *                                                                                    MD029255B
      ** Update extra carried forward balance with the ledger balance                      MD029255B
      ** amount if statement frequency is 'E' (Turnover)                                   MD029255B
      *                                                                                    MD029255B
     C           STFQ      IFEQ 'E'                                                        MD029255B
     C                     Z-ADDLDBL      ECFB                                             MD029255B
     C                     ENDIF                                                           MD029255B
      *
      * Update GLACNTL1
      *
     C                     UPDATACCNTABF
      *
      * Get RECOM details for retail accounts
      * Bypass if account has been closed                                 086450
      *
     C           ATYP      IFEQ 'R'
     C           RECI      ANDNE'C'                                       086450
      *
     C           KCRECO    CHAINRECOM                84
      *
      * DB error if details not found or not live
      *
     C           *IN84     IFEQ '1'
      *
      * Execute SR to format KCRECO KLIST
      *
     C                     EXSR SFKEY
      *
     C                     MOVEL'RECOM   'DBFILE           ***************
     C                     MOVELWWFKEY    DBKEY            * DB ERROR 05 *
     C                     Z-ADD5         DBASE            ***************
     C                     WRITEERRP1
     C                     EXSR DBSR
     C                     ELSE
      *
     C           RERECI    IFNE 'D'
      *
      * Execute SR to format KCRECO KLIST
      *
     C                     EXSR SFKEY
      *
     C                     MOVEL'RECOM   'DBFILE           ***************
     C                     MOVELWWFKEY    DBKEY            * DB ERROR 06 *
     C                     Z-ADD6         DBASE            ***************
     C                     WRITEERRP1
     C                     EXSR DBSR
      *
     C                     END
     C                     END
      *
      * Calculate number of statements generated by multiplying the
      * number of address processed by the number of copies chargeable
      * and adding it to the file (NOIS)
      *
     C           WWADRC    MULT NOCC      WWNOCC 150
     C                     ADD  WWNOCC    NOIS
      *
      * Update RECOM
     C                     UPDATRECOMDF
      *
     C                     END
     C                     END
      *
      * Zeroise address counter and read next account
      *
     C                     Z-ADD0         WWADRC
      *
     C                     READ GLACNTL1                 88
     C                     END
      *
      * Close spooled file for this Branch code and read next one
      *
     C                     CLOSEGL2000P1
      *
     C                     READ @A8REB0                  89
     C                     MOVELTRBRNM    P1BRNM    P                     109104
     C                     END
      *
      * Execute subroutine for audit report and program exit
      *
     C                     WRITEDETAU
     C                     SETON                     LR
     C                     RETRN
      /EJECT
      *-------------------------------------------------------------------------
      * SSTMT - Subroutine to print all statements for a given customer
      *-------------------------------------------------------------------------
      *
     C           SSTMT     BEGSR
      *
      * Reset output of 'COPY' for first copy
      *
     C                     MOVE '0'       *IN20
      *
      *
      * Generate 'ENOC' number of copies as specified on ACCNTAB
      *
     C                     DO   ENOC
      *
      *
      * First page, condition output for B/F balance
      *
     C                     MOVE '1'       *IN60
      *
      * Setup statement sequence number
      *
     C                     Z-ADD1         P1STSQ
     C                     Z-ADDWWBFWB    WWCFWB
     C*
     C* Print first statement heading and brought forward balance
     C*
     C                     MOVELNAR,3     P1COPY
     C                     MOVELNAR,4     P1STAT
     C*
     C/COPY WNCPYSRC,GL2000C012
     C                     WRITEGL2000FA
     C                     WRITEGL2000FB
      *
     C           *IN86     DOWEQ'0'
      *
      * If source of posting (SPOS) numeric ==> Journal entry; print
      * batch number
      *
     C           GETP      IFEQ *BLANK
      *
     C                     MOVELSPOS      WFLDA4  4
     C                     MOVE WFLDA4    P1PNUM
     C                     ELSE
     C                     MOVE *BLANKS   P1PNUM
     C                     END
      *
      * Format value date
      *
     C                     Z-ADDVALD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    P1VALD
      *
      * Format posting date
      *
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    P1PSTD
     C/COPY WNCPYSRC,GL2000C013
      *
      * Setup posting narrative
      *
     C                     MOVELPNAR      P1PNAR
     C           CHQN      IFEQ *ZEROS
     C                     MOVEL*BLANKS   P1CHQN
     C                     ELSE
     C                     MOVELCHQN      P1CHQN
     C                     END
      *
      * Setup DR or CR posting
      *
     C           DRCR      IFEQ 0
     C                     MOVE '0'       *IN50
     C                     ADD  PSTA      WWCFWB
     C                     Z-ADDPSTA      WWDRAM
     C                     ELSE
     C                     MOVE '1'       *IN50
     C                     SUB  PSTA      WWCFWB
     C                     Z-ADDPSTA      WWCRAM
     C                     END
      *
      * Execute print subroutine for detail line (and customer details
      * if page full)
      *
     C                     EXSR SPRINT
     C/COPY WNCPYSRC,GL2000C005
      *
     C           KREDPO    READEEODPOTS                  86
     C                     END
      *
      * Determine whether C/F balance is DR or CR
      *
     C                     MOVE *BLANKS   P1CLOB
     C           WWCFWB    IFNE 0
     C           WWCFWB    IFGE 0
     C                     MOVELNAR,1     P1CLOB
     C                     ELSE
     C                     MOVELNAR,2     P1CLOB
     C                     END
     C                     END
      *
      * Execute print for C/F balance and setup 'COPY'
      * for next copies
      *
     C                     WRITEGL2000FC
     C                     MOVE '1'       *IN20
      *
      * Increment 'Number of statements' counter
      *
     C                     ADD  1         P2TSTM
      *
      * Ensure file is correctly positionned for multiple copies...
      *
     C           KSEDPO    SETLLEODPOTS
     C           KREDPO    READEEODPOTS                  86
      *
     C                     END
      *
     C                     ENDSR
      /EJECT
     C*****************************************************************
     C           COMSR     BEGSR                           **COMSR BEGSR**
     C*
     C*                    Z-ADD11        DBASE            ***************
     C                     MOVE 'RECOM'   DBFILE           **DB ERROR 11**
     C                     MOVELWWEXCP    DBKEY            ***************
     C                     MOVELSTSCOM    DBSTAT
     C                     MOVE '1'       *IN90
     C                     WRITEERRP1
     C                     EXSR DBSR
     C*
     C                     ENDSR                           **COMSR ENDSR**
     C*****************************************************************
     C           ACNTSR    BEGSR                           *ACNTSR BEGSR**
     C*
     C*                    Z-ADD11        DBASE            ***************
     C                     MOVE 'GLACNTL' DBFILE           **DB ERROR 11**
     C                     MOVELWWEXCP    DBKEY            ***************
     C                     MOVELSTSACT    DBSTAT
     C                     MOVE '1'       *IN90
     C                     WRITEERRP1
     C                     EXSR DBSR
     C*
     C                     ENDSR                           *ACNTSR ENDSR**
      /EJECT
      *-------------------------------------------------------------------------
      * SFKEY - Subroutine to format KLIST for output
      *-------------------------------------------------------------------------
      *
     C           SFKEY     BEGSR
      *
     C                     MOVELCNUM      WWFLD1 10
     C                     MOVE CCY       WWFLD1
      *
     C**********           MOVELWWFLD1    WWFLD2 15                                           CGL029
     C                     MOVELWWFLD1    WWFLD2 21                                           CGL029
     C                     MOVE ACOD      WWFLD2
      *
     C**********           MOVELWWFLD2    WWFKEY 18                                           CGL029
     C                     MOVELWWFLD2    WWFKEY 24                                           CGL029
     C                     MOVE ACSQ      WWFKEY
      *
     C                     ENDSR
      /EJECT
      *-------------------------------------------------------------------------
      * SPRINT - Print subroutine
      *-------------------------------------------------------------------------
      *
     C           SPRINT    BEGSR
     C/COPY WNCPYSRC,GL2000C014
      *
      * Write balance if page full or no more postings
      *
     C           WWLINE    IFEQ 11
     C           *IN86     OREQ '1'
      *
      * Print blank lines to reach totals format
      *
     C           11        SUB  WWLINE    WWBLKL  20       Blank lines
     C           WWBLKL    DOWGT0
     C                     WRITEGL2000F3
     C                     SUB  1         WWBLKL
     C                     END
      *
      * Increment statement sequence
      * and force overflow for next page
      *
     C                     MOVE '0'       *IN60
     C                     ADD  1         P1STSQ
     C                     MOVE '1'       *IN01
     C                     END
      *
      * Write detail line if posting found, reset overflow
      *
     C           *IN86     IFEQ '0'
     C                     WRITEGL2000F1
     C           *IN01     IFEQ '1'                                       100746
     C                     WRITEGL2000FA                                  100746
     C                     DO   5                                         100746
     C                     WRITEGL2000F3                                  100746
     C                     ENDDO                                          100746
     C                     END                                            100746
     C                     MOVE '0'       *IN01
     C/COPY WNCPYSRC,GL2000C001
     C                     END
     C/COPY WNCPYSRC,GL2000C015
      *
     C                     ENDSR
     C/EJECT
     C/COPY WNCPYSRC,GL2000C002
     C********************************************************************
     C**
     C** MULTL MULTILANGUAGE SUBROUTINE
     C**
     C**     Called by       FIRST, MAIN
     C**     Calls           ZA1310
     C**
     C           MULTL     BEGSR                           **MULTL BEGSR**
     C*
     C** SET UP PARAMETER TO FORM OUTPUT LINE
     C*
     C           ZA1311    PLIST
     C                     PARM           MSGID   7
     C                     PARM           MSGDT0 40
     C                     PARM           MSGDT1 40
     C                     PARM           MSGDT2 40
     C                     PARM           MSGDT3 40
     C                     PARM           MSGDT4 40
     C                     PARM           MSGDT5 40
     C                     PARM           MSGDT6 40
     C                     PARM           MSGDT7 40
     C                     PARM           MSGDT8 40
     C                     PARM           MSGDT9 40
     C                     PARM           MNARR 200
     C*
     C                     EXSR CLMSG
     C                     MOVEL'GL20001' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,1
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'GL20002' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,2
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'GL20003' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,3
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     EXSR CLMSG
     C                     MOVEL'GL20004' MSGID
     C                     CALL 'ZA1310'  ZA1311
     C                     MOVELMNARR     NAR,4
     C                     MOVEL*BLANKS   MNARR
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C***
     C***   CLEAR INPUT VARIABLES OF MESSAGE
     C***
     C           CLMSG     BEGSR                           ** SR CLMSG **
     C                     MOVEL*BLANK    MSGDT0
     C                     MOVEL*BLANK    MSGDT1
     C                     MOVEL*BLANK    MSGDT2
     C                     MOVEL*BLANK    MSGDT3
     C                     MOVEL*BLANK    MSGDT4
     C                     MOVEL*BLANK    MSGDT5
     C                     MOVEL*BLANK    MSGDT6
     C                     MOVEL*BLANK    MSGDT7
     C                     MOVEL*BLANK    MSGDT8
     C                     MOVEL*BLANK    MSGDT9
     C                     MOVEL*BLANK    MNARR
     C                     ENDSR                           **CLMSG ENDSR**
     C**
     C/EJECT
     C********************************************************************
     C           FIRST     BEGSR                           **FIRST BEGSR**
     C*
     C           *NAMVAR   DEFN           LDA
     C*
     C** INITIALISE LDA VARIABLES
     C*
     C                     MOVE 'GL2000  'DBPGM
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE *BLANKS   DBASE
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBANKPD'DBFILE           ***************
     C                     MOVEL@OPTN     DBKEY            * DBERROR 10  *
     C                     Z-ADD010       DBASE            ***************
     C                     OUT  LDA
     C                     EXSR DBSR
     C                     END
     C*
     C                     MOVE RUNA      P1STDT
     C*
     C*    FOR DATE FORMAT AND RUN DATE
     C*
     C           *NAMVAR   DEFN RUNDAT    RUNDT
     C                     IN   RUNDT
     C*
     C**  CHECK IF THE MULTIBRANCHING INDICATOR IS ON OR NOT
     C*
     C           MBIN      IFEQ 'Y'
     C                     SETON                     58
     C                     END
     C           DATF      IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
     C*
     C** Access Retail details
     C*
     C                     CALL 'AORETLR0'PLIST3
     C*
     C/COPY WNCPYSRC,GL2000C003
      *                                                                                     BUG24792
      **  Initialize internal switch indicator CGL013                                       BUG24792
      *                                                                                     BUG24792
     C                     MOVE 'N'       CGL013  1                                         BUG24792
      *                                                                                     BUG24792
      **  Check for SAR CGL013                                                              BUG24792
      *                                                                                     BUG24792
     C                     CALL 'AOSARDR0'                                                  BUG24792
     C                     PARM *BLANKS   @RTCD                                             BUG24792
     C                     PARM '*VERIFY' @OPTN                                             BUG24792
     C                     PARM 'CGL013'  @SARD   6                                         BUG24792
     C                     PARM           UFFDY 200                                         BUG24792
      *                                                                                     BUG24792
      **  If record found                                                                   BUG24792
      *                                                                                     BUG24792
     C           @RTCD     IFEQ *BLANKS                                                     BUG24792
      *                                                                                     BUG24792
      **  Set on internal switch indicator CGL013                                           BUG24792
      *                                                                                     BUG24792
     C                     MOVE 'Y'       CGL013                                            BUG24792
      *                                                                                     BUG24792
     C                     ENDIF                                                            BUG24792
      *                                                                                     AR864876
      **  Initialize internal switch indicator CER030                                       AR864876
      *                                                                                     AR864876
     C                     MOVE 'N'       CER030  1                                         AR864876
      *                                                                                     AR864876
      **  Check for SAR CGL013                                                              AR864876
      *                                                                                     AR864876
     C                     CALL 'AOSARDR0'                                                  AR864876
     C                     PARM *BLANKS   @RTCD                                             AR864876
     C                     PARM '*VERIFY' @OPTN                                             AR864876
     C                     PARM 'CER030'  @SARD   6                                         AR864876
     C                     PARM           UFFDY 200                                         AR864876
      *                                                                                     AR864876
      **  If record found                                                                   AR864876
      *                                                                                     AR864876
     C           @RTCD     IFEQ *BLANKS                                                     AR864876
      *                                                                                     AR864876
      **  Set on internal switch indicator CER030                                           AR864876
      *                                                                                     AR864876
     C                     MOVE 'Y'       CER030                                            AR864876
      *                                                                                     AR864876
     C                     ENDIF                                                            AR864876
     C** OUTPUT AUDIT HEADER
     C*
     C                     WRITEHEADAU
      *                                                                   179282
      ** Call ZSFILE to log spool file details                            179282
      *                                                                   179282
     C                     Z-ADDSFNUMU    ZSNUM                           179282
     C                     MOVELSFILEU    ZSNAM                           179282
     C                     CALL 'ZSFILE'                                  179282
     C                     PARM           ZSEQ    5                       179282
     C                     PARM *BLANKS   ZENT    3                       179282
     C                     PARM           ZSNAM  10                       179282
     C                     PARM           ZSNUM   60                      179282
     C                     PARM *BLANKS   ZERR    1                       179282
      *                                                                   179282
      ** If error perform database error handling and exit program        179282
      *                                                                   179282
     C           ZERR      IFEQ 'Y'                                       179282
     C                     SETON                     U7U8LR               179282
     C           *LOCK     IN   LDA                                       179282
     C                     MOVEL'GL2000'  DBPGM            ***************179282
     C                     MOVEL'GL2000AU'DBKEY            ** DBERR  07 **179282
     C                     MOVEL'ZSFILE'  DBFILE           ***************179282
     C                     Z-ADD7         DBASE                           179282
     C                     OUT  LDA                                       179282
     C                     RETRN                                          179282
     C                     END                                            179282
     C*
     C** INITIALIZE FIELDS TO WRITE IN AUDIT
     C*
     C                     Z-ADD*ZEROS    P2NOAC
     C                     Z-ADD*ZEROS    P2TSTM
     C                     MOVE '0'       *IN01
     C*
     C/COPY WNCPYSRC,GL2000C007
     C                     ENDSR                           **FIRST ENDSR**
     C**
     C********************************************************************
      /EJECT
     C           DBSR      BEGSR                           **PSSR BEGSR**
     C*
     C           @RUN      IFEQ *BLANKS
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     END
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     WRITEERRAU
     C*
     C                     RETRN
     C*
     C                     ENDSR                           **DBSR ENDSR**
     C*
     C/COPY ZSRSRC,ZDATE2Z2
     C*
     C/COPY WNCPYSRC,GL2000C006
      /EJECT
      *
      /COPY ZSRSRC,ZDATE2Z3
**  CPY@  OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
**   CMD - COMMAND TO OVERIDE MESSAGE FILE
OVRMSGF MSGF(QUSERMSG) TOMSGF(MIDAS)
DLTOVR *ALL
