     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Account and statement details enquiry')       *
      *****************************************************************
      *                                                               *
      *  Midas General Ledger Module                                  *
      *                                                               *
      *  GL4441 - Account and Statement Details Enquiry               *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD050886           Date 15May18               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 MD044087           Date 14Feb17               *
      *                 CGL183             Date 09Dec16               *
      *                 CGL184             Date 07Dec16               *
      *                 MD024417           Date 20Feb14               *
      *                 AR864876           Date 18Nov11               *
      *                 MD024978           Date 12Feb14               *
      *                 MD022437           Date 04Dec13               *
      *                 CRE098             Date 02Dec13               *
      *                 CGL145B            Date 01Oct13               *
      *                 MD021130           Date 25Jul13               *
      *                 MD020387           Date 14May13               *
      *                 263362             Date 30Apr13               *
      *                 MD020122           Date 20Apr13               *
      *                 MD020020           Date 12Apr13               *
      *                 AR1096226          Date 21Mar13               *
      *                 CGL131             Date 28Sep12               *
      *                 AR814736           Date 15Aug11               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG22329           Date 19Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 244331             Date 13Dec06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 239964             Date 07Jun06               *
      *                 240079             Date 03Jun06               *
      *                 239966             Date 05Jun06               *
      *                 BUG11679           Date 05Jul06               *
      *                 CRE024             Date 07Oct05               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CGL037             Date 14Jul04               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CAAA03             Date 16Apr04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 202528             Date 06Feb02               *
      *                 194699             Date 11Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 11Oct00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 184727             Date 09Oct00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CAP035             Date 11Nov99               *
      *                 163504             Date 21Oct99               *
      *                 165546             Date 06Aug99               *
      *                 CFT004             Date 22Jul99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 107938             Date 17Feb98               *
      *                 S01408             Date 08Oct96               *
      *                 S01408             DATE 31JUL96               *
      *                 S01408             DATE 21JUN96               *
      *                 S01408             DATE 14MAY96               *
      *                 S01408             DATE 24APR96               *
      *                 101264             DATE 21MAR96               *
      *                 S01408             DATE 21FEB96               *
      *                 S01408             DATE 24JUL95               *
      *                 081855             DATE 20APR95               *
      *                 S01408             DATE 03FEB95               *
      *                 S01408             DATE 12JAN95               *
      *                 S01408             DATE 22AUG94               *
      *                 S01472             DATE 12MAR94               *
      *                 049240             DATE 24JUN93               *
      *                 047515             DATE 23NOV92               *
      *                 S10736             DATE 03SEP92               *
      *                 LN1295             DATE  07JUN91              *
      *                 LN1273             DATE  20MAY91              *
      *                 BHF448             DATE  25APR91              *
      *                 S01314             DATE  17APR91              *
      *                 S01267             DATE  18SEP90              *
      *                 E21183             DATE  14MAY90              *
      *                 S01182             DATE  30MAR90              *
      *                 E21497             DATE  06APR90              *
      *                 E20538             DATE  01APR90              *
      *                 BHF677             DATE  28SEP90              *
      *                 E20463             DATE  08MAY89              *
      *                 LN0130             DATE  08MAY90              *
      *                 E19970             DATE  14FEB90              *
      *                 E18765             DATE  14FEB90              *
      *                 E19563             DATE  14FEB90              *
      *                 E18761             DATE  14FEB90              *
      *                 S01117             DATE  21/06/89             *
      *                 S01199             DATE  21/06/89             *
      *                 S01194             DATE  13/03/89             *
      *                 E17471             DATE  31/03/89             *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD050886 - No movement displayed due to incorrect            *
      *             retrieval of system value.                        *
      *  MD046248 - Finastra Rebranding                               *
      *  MD044087 - Database Error Control is encountered when        *
      *             accessing account via Account Movements           *
      *             Enquiry screen and Customer Account Balance       *
      *             Enquiry screen.                                   *
      *  CGL183 - User Access audit of Account Enquiry functions      *
      *  CGL184 - New Frequencies for Account Statements              *
      *  MD024417 - Incorrect alignment of posting details in ACMV    *
      *  AR864876 - Extra page number not updated (Child:AR864877)    *
      *  MD024978 - Batch number is displayed for every posting in    *
      *             ACMV                                              *
      *  MD022437 - BankFusion_General Ledger: Available Balance      *
      *             (former Dispo balance) is missing on the screen   *
      *  CRE098 - User-Defined Retail Transaction Types on Postings   *
      *  CGL145B - Subsidiaries Daily Sweeping Forecast               *
      *            Added hooks: CGL145_023, CGL145_024                *
      *  MD021130 - Transactions presented are not correct; enquiry   *
      *             sequence of postings should be controlled by the  *
      *             system value as in the old client system          *
      *  MD020387 - GL: There is no indication of account being       *
      *             blocked on Account.                               *
      *             Amended in such that Block Dr, Block Cr, etc will *
      *             be shown by the system during enquiry on ACMV.    *
      *           - Applied fix for 261693                            *
      *  263362 - Truncation occuring for ODLN. Increase the size of  *
      *           ODLNB to avoid high order truncation. Pattern fix   *
      *           after 257682.                                       *
      *  MD020122 - Issues on Enquiry screens on account with forward *
      *             dated OPAY transaction                            *
      *  MD020020 - Available balance is blank on Account Details     *
      *             Screen.                                           *
      *  AR1096226 - Information and value presentation issues        *
      *  CGL131 - Customer Account Balance Enquiry (with available    *
      *           balance)                                            *
      *  AR814736 - BECM048 ACMV - Missing turnover stmt details      *
      *             (Child: AR814737)                                 *
      *             Applied fix 120328                                *
      *  120328 - Display Turnover statement page for frequency 'E'   *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  BUG22329 - Account Movement Enquiry not correct for Fee      *
      *             settlement. Applied fix 209031.                   *
      *  209031 - Show all the postings for the account when Posting  *
      *           Date is left blank.                                 *
      *  244331 - Subroutine for rollup should not be invoked if      *
      *           there are no more records to pagedown.              *
      *  239964 - Applied fix 236093.                                 *
      *  240079 - Applied fix 236093.                                 *
      *  239966 - Applied fix 236093.                                 *
      *  236093 - MidasPlus Webfacing screens hanging since webfacing *
      *           doesn't support TFRGRPJOB.                          *
      *  BUG11679 - Additional Conversion of Customer Number to Alpha *
      *  CRE024  -  Country Level Switchable Feature :                *
      *             Security Features for Restricted Accounts.        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL037 - Account Access Security                             *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CAAA03 - Webfacing Changes (Recompile)                       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  202528 - Allow the system to view closed accounts in the     *
      *           Account movement enquiries.                         *
      *  194699 - Re-compile over changed Display File.               *
      *  CSD006 - Use correct parameters for Access Objects           *
      *  184727 - Line missing from fix 165546 after collection       *
      *  CAP035 - Account maintenance API; recompiled over changed    *
      *           ACCBR.                                              *
      *  163504 - If both date and amount selected, selection should  *
      *           point to those postings with that amount. This is   *
      *           only the case when sign is left blank.              *
      *  165546  -  Changed to show profit centre if analytical       *
      *             accounting is switched on.                        *
      *  CFT004 - Straight Through Processing Phase 2                 *
      *           International Bank Account Numbers (IBAN)           *
      *  CGL007 - Account Postings Enquiry (Recompile)                *
      *  107938  -  Narrative truncated by batch nbr (cfr S01472)     *
      *             Display complete narrative if not a batch         *
      *  S01408  -  Addition of Core Hook GL4441IIP1                  *
      *             Addition of Core Hook GL4441CP47                  *
      *             Addition of Core Hook GL4441CP46                  *
      *             Addition of Core Hook GL4441CP45                  *
      *             Addition of Core Hook GL4441CP44                  *
      *  S01408  -  Core hook GL4441CP43 added.                       *
      *          -  Core hook GL4441EEP2 added.                       *
      *          -  Core hook GL4441OOP1 added.                       *
      *  S01408  -  Core hook GL4441CP42 added.                       *
      *  S01408  -  Core hook GL4441FFP3 added.                       *
      *             Core hook GL4441H001 added.                       *
      *             Core hook GL4441H002 added.                       *
      *             Core hook GL4441CP41 added.                       *
      *             Core hook GL4441CP40 added.                       *
      *             Core hook GL4441CP39 added.                       *
      *             Core hook GL4441CP38 added.                       *
      *             Core hook GL4441CP37 added.                       *
      *             Core hook GL4441CP36 added.                       *
      *             Core hook GL4441CP35 added.                       *
      *             Core hook GL4441CP34 added.                       *
      *             Core hook GL4441CP33 added.                       *
      *             Core hook GL4441CP32 added.                       *
      *             Core hook GL4441CP31 added.                       *
      *             Core hook GL4441CP30 added.                       *
      *             Core hook GL4441CP29 added.                       *
      *             Core hook GL4441CP28 added.                       *
      *             Core hook GL4441CP27 added.                       *
      *             Core hook GL4441CP26 added.                       *
      *             Core hook GL4441CP25 added.                       *
      *             Core hook GL4441CP24 added.                       *
      *             Core hook GL4441CP23 added.                       *
      *             Core hook GL4441CP22 added.                       *
      *  S01408  -  Core hook GL4441CP19 added.                       *
      *             Core hook GL4441CP20 added.                       *
      *             Core hook GL4441CP21 added.                       *
      *  101264  -  Initialise fields in STATIC                       *
      *  S01408  -  Core hook GL4441CP17 added.                       *
      *             Core hook GL4441CP18 added.                       *
      *  S01408  -  Core hook GL4441EEPG added.                       *
      *             Core hook GL4441EEP1 added.                       *
      *             Core hook GL4441IPG3 added.                       *
      *             Core hook GL4441CP15 added.                       *
      *             Core hook GL4441CP16 added.                       *
      *  081855  -  The posting date used to begin the reading of     *
      *             Apost records was only recalculated from the (Last*
      *             Statement date + 1) on change of Posting date.    *
      *             So if the account is changed the posting date is  *
      *             not recalculated. I have added the logic to       *
      *             recalculate the posting date on change of account *
      *             as well.                                          *
      *  S01408  -  Core hook GL4441FFP1 added.                       *
      *             Core hook GL4441FFP2 added.                       *
      *             Core hook GL4441CP14 added.                       *
      *  S01408  -  Core hook GL4441FFPG added.                       *
      *             Core hook GL4441IIPG added.                       *
      *             Core hook GL4441IPG1 added.                       *
      *             Core hook GL4441IPG2 added.                       *
      *             Core hook GL4441CVKS added.                       *
      *             Core hook GL4441CVK1 added.                       *
      *             Core hook GL4441CCPG added.                       *
      *             Core hook GL4441CCP1 added.                       *
      *             Core hook GL4441CCP2 added.                       *
      *             Core hook GL4441CCP3 added.                       *
      *             Core hook GL4441CCP4 added.                       *
      *             Core hook GL4441CCP5 added.                       *
      *             Core hook GL4441CCP6 added.                       *
      *             Core hook GL4441CCP7 added.                       *
      *             Core hook GL4441CCP8 added.                       *
      *             Core hook GL4441CCP9 added.                       *
      *             Core hook GL4441CP10 added.                       *
      *             Core hook GL4441CP11 added.                       *
      *             Core hook GL4441CP12 added.                       *
      *             Core hook GL4441CP13 added.                       *
      *  S01408  -  Core hook GL4441CIRE added.                       *
      *  S01472  -  A/C movements enquiry to show batch number        *
      *  049240 - Postings on last statements should be excluded      *
      *           and 'MNTHLY ACCRL' freq. should be 'ACCRUAL DATE'   *
      *     047515  -  PGM FALLS OVER ON ROLLUP BECAUSE DSPREC HAS BEEN  *
      *                SET TO RRN FOR NEXT SUBFILE PAGE, BUT SUBSEQUENT  *
      *                VALIDATION EXCLUDES FURTHER RECORDS FROM BEING    *
      *                WRITTEN TO SUBFILE                                *
      *     S10736  -  RECOMPILE FOR MANAGEMENT ACCOUNTING               *
      *     LN1295  -  WHEN NOSTRO CODE OR SHORTNAME ENTERED & VALIDATED *
      *                REMAINING INPUT FIELDS SHOULD BE BLANKED OUT      *
      *     LN1273  -  IF MBIN = N, THE SINGLE BRANCH VALUE (DEFAULT     *
      *                BRANCH FROM ZMUSER) SHOULD BE USED IN CHAIN TO    *
      *                ACCOUNTS FILE                                     *
      *                BRANCH AUTHORITY ONLY CHECKED WHEN MBIN = Y.      *
      *     BHF448  -  SUPPRESS STATEMENT DAY NUMBER IF INAPPROPRIATE    *
      *                FOR STATEMENT FREQUENCY                           *
      *     S01314  -  CHANGES MADE DURING PTF INCORPORATION             *
      *                INITIALISE VARIABLE I                             *
      *     S01267  -  RECOMPILED FOR MIS RELEASE 2.2 CHANGES.
      *     E21183  -  TO DISPLAY POSTINGS ONLY IF THEY HAVE NOT AP-     *E21183
      *                PEARED ON LAST STATEMENT.(DATE FIELD LEFT BLANK)  *E21183
      *     S01182  -  ADDITIONAL FORMAT IN LOGICALS FOR MIS             *S01182
      *     E21497  -  FIX TO ZEROIZE ODLN FIELD                         *E21497
      *     E20538  -  MOVE CORRECT ACCOUNT TYPE INTO ACCOUNT TYPE FIELD *E20538
      *                AND RESTORE ERROR ROUTINE REMOVED BY E19970       *E20538
      *     BHF677  - INCORRECT ZERO SUPPRESSION IN CHEQUE NUMBER        *BHF677
      *               FIELD OF SUBFILE RECORD                            *BHF677
      *     E20463  -  NUMBER OF DECIMAL PLACES ON CURRENCY FIELD IS     *E20463
      *                NOT CHECKED WHEN ENQUIRY CHANGES.                 *E20463
      *     LN0130  -  'TYPE' ON SCREEN SHOULD ALLOW FOR A/C TYPES OTHER *LN0130
      *                THAN RETAIL AND NOSTRO                            *LN0130
      *                AND                                               *LN0130
      *                STANDARDISE PARAMETERS OF AOACCTV0                *
      *     E19970  -  THIS PROGRAM SHOULD ALLOW ENQUIRIES ON ALL TYPES  *E19970
      *                OF ACCOUNT.                                       *E19970
      *     E18765  -  E18761 CAUSES PROGRAM TO FALL OVER IF INVALID     *E18765
      *                NOSTRO INPUT.                                     *E18765
      *     E19563  -  ALL REFERNCES TO COMMAND 12 CHANGED TO COMMAND 5  *E19563
      *            +  *INKL CHANGED TO *INKE                             *E19563
      *     E18761  -  THE OVERDRAFT LIMIT IS FORMATTED WITH DECIMAL     *E18761
      *                PLACES.                                           *E18761
      *     S01199  -  HELP PROCESSING CHANGED
      *     S01117  -  Release 10 (Multibranching)                       *
      *     S01194  -  NEW STANDING DATA                                 *
      *     E17471  -  ALL ACCOUNT MOVEMENT ENQUIRIES ARE                *E17471
      *                DISPLAYED IN INCORRECT SEQUENCE                   *E17471
      *                                                                  *
      ********************************************************************
      *
      *    I N D I C A T O R   U S A G E
      *
      *    01  First time indicator
      *    02  Display subfile
      *    03  Display subfile control record
      *    04  Enable SFLEND
      *    05
      *
      *    11  Enter key pressed
      *    12  Input criteria has been changed
      *    14  Account is retail
      *    15  Unallocated nostro
      *
      *    20  Invalid account entered
      *    22  Single Branch Environment                                  S01117
      *    25  Rollup key pressed
      *    26  Suppress statement day number if frequency does not need itBHF448
      *****27**Help key pressed                                           S01199
      *    41  Analytical Accounting is ON                                165546
      *
      *    50  Input criteria is invalid
      *    51  Customer number is invalid
      *    52  User not Authorised to Branch                              S01117
      *
      *    60  Account number has changed
      *    61  Posting date has changed
      *    62  Plus/Minus indcator has changed
      *    63  Amount or cheque number has changed
      *    64  Invalid account         - display reverse image
      *    65  Invalid date            - display reverse image
      *    66  Invalid (+/-) indicator - display reverse image
      *    67  Invalid amount          - display reverse image
      *    68  Invalid cheque number   - display reverse image
      *    69  Branch Code Has Changed                                    S01117
      *
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL4441H001                                           S01408
     F*                                                                   S01408
      *    80  No more postings for this account (APOSTL1/APOSTL2)
      **       or no more postings for this account (APOSTL38,APOSTL39)                       CGL131
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL4441H002                                           S01408
     F*                                                                   S01408
      *    81  'OFF' = posting record meets selection criteria
      *    82  S01472 is switched ON                                      S01472
      *    83  No records in the subfile for this account
      *
      *    9n  all 9? indicators used for standard subroutines
      *    98  Date format is 'M'
      *    99  also used as a general purpose indicator
      *
      *    KC  Command key  3 pressed
      *    KE  Command key  5 pressed                                     E19563
      *    KL  NO LONGER IN USE                                           E19563
      *    KN  Command key 14 pressed
      *    KP  Command key 15 pressed
      *    KQ  Command key 16 pressed
      *
      *    LR  End of program
      *
     FGL4441DFCF  E                    WORKSTN      KINFDS DSPFDS
     F                                        RRN   KSFILE SFLRCD
     F                                        RRN   KSFILE SFLRCDA                            CGL131
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL4441FFPG                                           S01408
     F*                                                                   S01408
     FPRONO   IF  E           K        DISK
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL4441FFP3                                           S01408
     F*                                                                   S01408
     FAPOSTL1 IF  E           K        DISK
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL4441FFP1                                           S01408
     F*                                                                   S01408
     FAPOSTL2 IF  E           K        DISK
     F            APOSTPDF                          KRENAMEAPOST2DF
     F            GLACPHPF                          KRENAMEGLACPH2F       S01182
     F                                              KINFDS INFO2                              CGL131
     FAPOSTL9 IF  E           K        DISK                               165546
     F            APOSTPDF                          KRENAMEAPOST9DF       165546
     F            GLACPHPF                          KRENAMEGLACPH9F       165546
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL4441FFP2                                           S01408
      *                                                                                       CGL131
     FMEMOSL1 IF  E           K        DISK                                                   CGL131
      *                       Memos file                                                      CGL131
     FAPOSTL38IF  E           K        DISK                                                   CGL131
      ** Accounts postings by posting date                                                    CGL131
     F            APOSTPDF                          KRENAMEAPOST1DF                           CGL131
     F            GLACPHPF                          KRENAMEGLACPH1F                           CGL131
     F                                              KINFDS INFO1                              CGL131
     FAPOSTL39IF  E           K        DISK                                                   CGL131
      ** Accounts postings by posting amount                                                  CGL131
     F            APOSTPDF                          KRENAMEAPOST3DF                           CGL131
     F            GLACPHPF                          KRENAMEGLACPH3F                           CGL131
     F                                              KINFDS INFO3                              CGL131
     FRSACMTLDIF  E           K        DISK                                                   CGL131
      ** Account movements by posting date                                                    CGL131
     F                                              KINFDS INFO5                              CGL131
     FRSACMTLBIF  E           K        DISK                                                   CGL131
      ** Account movements by cheque number                                                   CGL131
     F            RSACMTPO                          KRENAMERSACMTP1                           CGL131
     F                                              KINFDS INFO6                              CGL131
     FRSACMTLCIF  E           K        DISK                                                   CGL131
      ** Accounts postings by posting amount                                                  CGL131
     F            RSACMTPO                          KRENAMERSACMTP2                           CGL131
     F                                              KINFDS INFO7                              CGL131
      *                                                                                       CGL131
     FREEAUDPPO   E                    DISK                                                   CGL183
     F*                                                                   S01408
      /TITLE         >>> TABLES/ARRAYS <<<
     E*                                                                   S01408
     E/COPY WNCPYSRC,GL4441EEP2                                           S01408
     E*                                                                   S01408
     E                    FCODE      10  1
     E                    FTEXT      10 30
     E                    ERCD       19  4               ERROR CODES
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    ZA1        16  1               ZALIGN INPUT
     E                    ZA2        16  1               ZALIGN OUTPUT
     E                    ZS1        15  1 0
     E                    ZS2        22  1
     E**********          FRQ    14  14  1               STMT FREQ                          AR864876
     E**********          FRQA    1  14 13               STMT DESC                          AR864876
     E**********          FRQ    15  15  1                                           AR864876 CGL184
     E**********          FRQA    1  15 13                                           AR864876 CGL184
     E                    FRQ    19  19  1                                                    CGL184
     E                    FRQA    1  19 13                                                    CGL184
     E                    REDS    1   7 13               RETL DESC
     E                    RETT        7 13               DSP RETL DESC
     E*                                                                   S01408
     E/COPY WNCPYSRC,GL4441EEPG                                           S01408
     E*                                                                   S01408
     E                    EMSG    1   2 76               ERROR MESSAGE
     E*                                                                   S01408
     E/COPY WNCPYSRC,GL4441EEP1                                           S01408
     E*                                                                   S01408
     E                    CPY@    1   1 80               COPYRIGHT STATEMENT
     E                    ACTP    5   5 11               ACC TYPE         E20538
     E/COPY WNCPYSRC,GL4441E001
      /TITLE         >>> DATA AREAS <<<
      *
      *************************************************
      **  D A T A   S T R U C T U R E    for   *LDA  **
      *************************************************
      *
     IDSLDA       DS
      *
      *  *LDA for transfering enquiry selection criteria
      *
     I**********                              2  49 LDADTA                S01117
     I**********                              2  52 LDADTA          S01117S01472
     I**********                              2  59 LDADTA                             S01472 CGL029
     I**********                              2  65 LDADTA                             CGL029 236093
     I                                        2  68 LDADTA                                    236093
     I                                        2  11 CNUMR
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL4441IIP1                                           S01408
     I*                                                                   S01408
     I                                        2   4 KPRCCY
     I                                        5   60KPRNO
     I                                        5   6 KPRNOA
     I**********                              7  20 KPREST                                    CGL029
     I                                        7  26 KPREST                                    CGL029
     I                                       12  14 CURRY
     I**********                             15  18 ACCOD                                     CGL029
     I**********                             19  20 ACSEQ                                     CGL029
     I**********                              2  20 ACNT                                      CGL029
     I**********                             21  23 BRNCH                              S01117 CGL029
     I**********                              2  23 MBACNT                             S01117 CGL029
     I***********                            21  26 POSDA                 S01117
     I**********                             24  29 POSDA                 S01117              CGL029
     I***********                            27  27 PORM                  S01117
     I**********                             30  30 PORM                  S01117              CGL029
     I***********                            28  41 AMONT                 S01117
     I**********                             31  44 AMONT                 S01117              CGL029
     I***********                            42  49 CQNMR                 S01117
     I***********                            45  52 CQNMR           S01117165546
     I**********                             45  52 TYPMR                 165546              CGL029
     I**********                             53  59 SPOS                  S01472              CGL029
     I**********                             53  59 SPOSP                 165546              CGL029
     I                                       15  24 ACCOD                                     CGL029
     I                                       25  26 ACSEQ                                     CGL029
     I                                        2  26 ACNT                                      CGL029
     I                                       27  29 BRNCH                                     CGL029
     I                                        2  29 MBACNT                                    CGL029
     I                                       30  35 POSDA                                     CGL029
     I                                       36  36 PORM                                      CGL029
     I                                       37  50 AMONT                                     CGL029
     I                                       51  58 TYPMR                                     CGL029
     I                                       59  65 SPOS                                      CGL029
     I                                       59  65 SPOSP                                     CGL029
     I                                       66  68 FUNC                                      236093
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL4441IPG2                                           S01408
      *                                                                                       CGL131
     I                                      134 141 DBFILE                                    CGL131
     I                                      142 170 DBKEY                                     CGL131
     I                                      171 180 DBPGM                                     CGL131
     I                                      181 1830DBASE                                     CGL131
      *                                                                                       CGL131
     IINFO1       DS                                                                          CGL131
     I                                      261 270 FORMA1                                    CGL131
     IINFO2       DS                                                                          CGL131
     I                                      261 270 FORMA2                                    CGL131
     IINFO3       DS                                                                          CGL131
     I                                      261 270 FORMA3                                    CGL131
     IINFO5       DS                                                                          CGL131
     I                                      261 270 FORMA5                                    CGL131
     IINFO6       DS                                                                          CGL131
     I                                      261 270 FORMA6                                    CGL131
     IINFO7       DS                                                                          CGL131
     I                                      261 270 FORMA7                                    CGL131
      *                                                                                       CGL131
     IZONEDP      DS                                                                        MD044087
     I                                        1  100PRTAC                                   MD044087
     I*                                                                   S01408
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I* External DTAARA for run-date
     I*
     IRUNDT       DS
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
     I*                                                                   S01117
     I* External DTAARA for ZMUSER                                        S01117
     I*                                                                   S01117
     IZMUSER      DS                                                      S01117
     I/COPY WNCPYSRC,GL4441I003
     I                                       11  13 BRC                   S01117
     I                                       17  17 BANK                  S01117
     I*
     IP@FMT1    E DSACCNTAB
     I              BRCA                            KBRC                  S01117
     I              CNUM                            KCUS
     I              CCY                             KCCY
     I              ACOD                            KCOD
     I              ACSQ                            KASE
     I              ACNO                            KRET                                      CGL183
     I/COPY WNCPYSRC,GL4441I002
     I                                        2   7 KCUSA
     I**********                              2  16 KEYAC                                     CGL029
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL4441IPG3                                           S01408
      *                                                                                       CGL131
      ** External DS for Account Officer file                                                 CGL131
      *                                                                                       CGL131
     ISDACOF    E DSSDACOFPD                                                                  CGL131
      *                                                                                       CGL131
     I*                                                                   S01408
     I*
     IP@FMT2    E DSSDCUSTPD
     IP@FMT3    E DSSDCURRPD
     I*
     I            DS
     I                                       49  560CQKEY
     I            DS                                                      165546
     I                                       49  52 PCKEY                 165546
     I*
     IP@ALL       DS
     I                                        1   7 P@RTCD
     I                                        8  14 P@OPTN
     I                                       15  24 P@KEY1
     I                                       25  31 P@ANY
     I                                       32  34 P@KEY2
     I**********                             35  38 P@KEY3                                    CGL029
     I**********                             39  40 P@KEY4                                    CGL029
     I**********                             41  47 P@TYPE                                    CGL029
     I**********                             48  49 P@NOSN                                    CGL029
     I**********                             50  52 P@KEY5                             S01117 CGL029
     I                                       35  44 P@KEY3                                    CGL029
     I                                       45  46 P@KEY4                                    CGL029
     I                                       47  53 P@TYPE                                    CGL029
     I                                       54  55 P@NOSN                                    CGL029
     I                                       56  58 P@KEY5                                    CGL029
     I*
     I/COPY WNCPYSRC,GL4441I004
     I            DS
     I                                        1  76 ERCD
     I                                        1  76 ERRDSP
     I*
     I*****************************************************************
     I*
     IREDSP       DS
     I                                        1  91 RETT
     I                                        1  13 REFLD1
     I                                       14  26 REFLD2
     I                                       27  39 REFLD3
     I                                       40  52 REFLD4
     I                                       53  65 REFLD5
     I                                       66  78 REFLD6
     I                                       79  91 REFLD7
     I*
     I*****************************************************************
     I*
     I            DS
     I                                        1  150ZWRK15
     I                                        1  150ZS1
     I            DS
     I                                        1  25 ZOUT25
     I                                        1  21 ZOUT0
     I                                        2  23 ZOUT1
     I                                        3  24 ZOUT2
     I                                        5  25 ZOUT3
     I*
     ISFLDS1      DS                                                      S01472
     I/COPY WNCPYSRC,GL4441I005
     I                                        1   7 PSTDZ                 S01472
     I                                        9  15 VALDZ                 S01472
     I                                       18  25 @CHQN                 S01472
     I**********                             27  56 PNARZ                              S01472 CRE098
     I                                       28  72 PNARZ                                     CRE098
     I                                       28  57 PNARX                                   MD024417
     I********                               27  52 PNARZ2         S01472 107938
     I**********                             58  76 PSTAZ                              S01472 CRE098
     I                                       59  63 TRATZ                                     CRE098
     I                                       74  92 PSTAZ                                     CRE098
     ISFLDS2      DS                                                      165546
     I                                        1   7 PSTDZP                165546
     I                                        9  15 VALDZP                165546
     I                                       20  23 @PRFCP                165546
     I**********                             27  56 PNARZP                             165546 CRE098
     I**********                             58  76 PSTAZP                             165546 CRE098
     I                                       28  65 PNARZP                                    CRE098
     I                                       59  63 TRATZP                                    CRE098
     I                                       74  92 PSTAZP                                    CRE098
     IREFLDC      DS                                                                          CGL131
     I                                        1  150PACTBA                                    CGL131
     IREFLDV      DS                                                                          CGL131
     I                                        1  150PAVLBA                                    CGL131
      *                                                                                       CGL131
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL4441IPG1                                           S01408
     I*                                                                   S01408
     I*                                                                   S01472
     I* Data structure for subfile record                                 S01472
     I*                                                                   S01472
     I*****************************************************************
     I*
     I*    PROGRAM DS TO GET WORK STN ID
     I*
     I           SDS
     I                                      244 246 WSID
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL4441IIPG                                           S01408
     I*                                                                   S01408
     I                                      244 253 SWSID                                     CGL183
     I                                      254 263 SUSER                                     CGL183
      *                                                                                       CGL183
     I            DS                                                                          CGL183
     I                                        1  140TIMDAT                                    CGL183
     I                                        1   60WTIM                                      CGL183
     I                                        7  140WDAT                                      CGL183
     I            DS                                                                          CGL183
     I                                        1   80ISODAT                                    CGL183
     I                                        1   40WISCY                                     CGL183
     I                                        5   60WISMM                                     CGL183
     I                                        7   80WISDD                                     CGL183
     IDSAAUD      DS                                                                          CGL183
     I                                        1   1 VLOSIC                                    CGL183
     I                                        2   2 VLACMV                                    CGL183
     I                                        3   3 VLCACB                                    CGL183
     I                                        4   4 VLPAMV                                    CGL183
     I*
     I*    DSPF DS  TO RETRIEVE CPF'S POSITION WITHIN THE SUBFILE
     I*
     IDSPFDS      DS
     I                                    B 378 3790CPFPOS
     I*                                                                   LN0130
     ISCSARD    E DSSCSARDPD                                              CFT004
      ** MIDAS Switchable Features Accessed Via Access Program            CFT004
      *                                                                   CFT004
     I              LCD                             LCDX                  CFT004
     IDSSDY     E DSDSSDY                                                 LN0130
      ** EXTERNAL DS FOR LONG DUMMY DATA STRUCTURE                        LN0130
     ISDMMOD    E DSSDMMODPD                                              165546
     I**  Modules File Details                                            165546
     IDSFDY     E DSDSFDY                                                 165546
      ** Short data structure for access programs (200 long)              165546
     I*                                                                   LN0130
      *                                                                                     MD021130
     I              'AccMovEnqAvlBal'     C         V#GLAB                                  MD021130
      *                                                                                     MD021130
      *                                                                                       CGL183
     I              'UserEnqAccessAudit'  C         V#AAUD                                    CGL183
      /TITLE         >>> START OF MAIN PROCESSING <<<
     I/COPY WNCPYSRC,GL4441I001
     C*
     C*****************************************************************
     C                     MOVEACPY@      BIS@   80
     C*
     C           *NAMVAR   DEFN *LDA      DSLDA
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP15                                           S01408
      *                                                                                       CGL131
     C                     MOVE *BLANKS   DBPGM                                               CGL131
     C                     MOVEL'GL4441'  DBPGM                                               CGL131
      *                                                                                       CGL131
     C           KEYSL3    KLIST                                                              CGL131
     C                     KFLD           KBRC                                                CGL131
     C                     KFLD           KCUS                                                CGL131
     C                     KFLD           KCCY                                                CGL131
     C                     KFLD           KCOD                                                CGL131
     C                     KFLD           KASE                                                CGL131
     C                     KFLD           AMTKY                                               CGL131
     C                     KFLD           DORK                                                CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C           KALL      KLIST
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C*
     C           KEYSL1    KLIST
     C                     KFLD           KBRC                            S01117
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C                     KFLD           POSDN
     C*********************KFLD           DORK                            E17471
     C                     KFLD           AMTKY
     C                     KFLD           DORK                            E17471
     C*
     C           KEYSL2    KLIST
     C                     KFLD           KBRC                            S01117
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C                     KFLD           CQKEY
     C           KEYSL9    KLIST                                          165546
     C                     KFLD           KBRC                            165546
     C                     KFLD           KCUS                            165546
     C                     KFLD           KCCY                            165546
     C                     KFLD           KCOD                            165546
     C                     KFLD           KASE                            165546
     C                     KFLD           PCKEY                           165546
     C*
     C           KEYEQ     KLIST
     C                     KFLD           KBRC                            S01117
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C*
     C           KEYPRN    KLIST
     C                     KFLD           KPRCCY
     C                     KFLD           KPRNO
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP44                                           S01408
     C**  Check if Analytical Accounting module is installed.             165546
     C                     CALL 'AOMMODR0'                                165546
     C                     PARM '*MSG   ' @RTCD   7                       165546
     C                     PARM '*FIRST ' @OPTN   7                       165546
     C           SDMMOD    PARM SDMMOD    DSFDY                           165546
     C**  If Analytical Accounting is installed, use the profit           165546
     C**  centre on the display.                                          165546
     C           BGN0ST    IFEQ 'Y'                                       165546
     C                     MOVE *ON       *IN41                           165546
     C                     ELSE                                           165546
     C                     MOVE *OFF      *IN41                           165546
     C                     ENDIF                                          165546
     C*                                                                   S01408
     C*
      *** Check the switchable features file to see if S01472 is on.      S01472
     C*                                                                   S01472
     C                     SETOF                     82                   S01472
     C                     MOVE 'N'       S01472  1                       S01472
     C                     CALL 'AOSARDR0'                                S01472
     C                     PARM '       ' @RTCD   7                       S01472
     C                     PARM '*VERIFY' @OPTN   7                       S01472
     C                     PARM 'S01472 ' @SARD   6                       S01472
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD006
      *                                                                   S01472
     C           @RTCD     IFEQ *BLANKS                                   S01472
     C                     MOVE 'Y'       S01472                          S01472
     C                     SETON                     82                   S01472
     C                     END                                            S01472
      *                                                                   CFT004
      **  Access SAR details file to see if CFT004 is installed.          CFT004
      *                                                                   CFT004
     C                     CALL 'AOSARDR0'                                CFT004
     C                     PARM *BLANKS   PRTCD   7                       CFT004
     C                     PARM '*VERIFY' POPTN   7                       CFT004
     C                     PARM 'CFT004'  PSARD   6                       CFT004
     C***********SCSARD    PARM SCSARD    DSSDY                           CFT004              CSD006
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD006
      *                                                                   CFT004
     C           PRTCD     IFEQ *BLANKS                                   CFT004
     C                     MOVE 'Y'       CFT004  1                       CFT004
     C                     ELSE                                           CFT004
     C                     MOVE 'N'       CFT004                          CFT004
     C                     ENDIF                                          CFT004
      *                                                                                       CGL184
      ** Check if CGL184 is switched ON                                                       CGL184
      *                                                                                       CGL184
     C                     CALL 'AOSARDR0'                                                    CGL184
     C                     PARM *BLANKS   PRTCD   7                                           CGL184
     C                     PARM '*VERIFY' POPTN   7                                           CGL184
     C                     PARM 'CGL184'  PSARD   6                                           CGL184
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL184
      *                                                                                       CGL184
     C           PRTCD     IFEQ *BLANKS                                                       CGL184
     C                     MOVE 'Y'       CGL184  1                                           CGL184
     C                     ELSE                                                               CGL184
     C                     MOVE 'N'       CGL184                                              CGL184
     C                     ENDIF                                                              CGL184
      *                                                                                       CGL037
      ** Access SAR details file to determine if Account Access                               CGL037
      ** Security is switched on                                                              CGL037
      *                                                                                       CGL037
     C                     CALL 'AOSARDR0'                                                    CGL037
     C                     PARM *BLANKS   @RTCD   7                                           CGL037
     C                     PARM '*VERIFY' @OPTN   7                                           CGL037
     C                     PARM 'CGL037'  @SARD   6                                           CGL037
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL037
      *                                                                                       CGL037
     C           @RTCD     IFNE *BLANKS                                                       CGL037
     C           @RTCD     ANDNE'*NRF   '                                                     CGL037
     C                     EXSR *PSSR                                                         CGL037
     C                     MOVE '1'       *INLR                                               CGL037
     C                     RETRN                                                              CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C           @RTCD     IFEQ *BLANK                                                        CGL037
     C                     MOVEL'Y'       CGL037  1                                           CGL037
     C                     ELSE                                                               CGL037
     C                     MOVEL'N'       CGL037                                              CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C/COPY OFCPYSRCZ,CGL145_023                                                             CGL145B
     C/COPY WNCPYSRC,GL4441C001
      *                                                                                       CGL183
      ** Check if feature CGL183 is On                                                        CGL183
      *                                                                                       CGL183
     C                     CALL 'AOSARDR0'                                                    CGL183
     C                     PARM *BLANKS   @RTCD   7                                           CGL183
     C                     PARM '*VERIFY' @OPTN   7                                           CGL183
     C                     PARM 'CGL183'  @SARD   6                                           CGL183
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL183
      *                                                                                       CGL183
     C           @RTCD     IFEQ *BLANKS                                                       CGL183
     C                     MOVE 'Y'       CGL183  1                                           CGL183
     C                     ELSE                                                               CGL183
     C                     MOVE 'N'       CGL183                                              CGL183
     C                     END                                                                CGL183
      *                                                                                       CGL183
      ** System value that controls user access audit for this enquiry                        CGL183
      *                                                                                       CGL183
     C**********           MOVELV#AAUD    P@OP01                                     CGL183 MD050886
     C                     MOVELV#AAUD    P@OP01    P                                       MD050886
      *                                                                                       CGL183
     C                     CALL 'AOSVALR0'                                                    CGL183
     C                     PARM *BLANKS   @RTCD   7                                           CGL183
     C                     PARM           P@OP01 20                                           CGL183
     C                     PARM *BLANKS   P@VL01200                                           CGL183
     C                     PARM *BLANKS   P@OP02 20                                           CGL183
     C                     PARM *BLANKS   P@VL02200                                           CGL183
     C                     PARM *BLANKS   P@OP03 20                                           CGL183
     C                     PARM *BLANKS   P@VL03200                                           CGL183
     C                     PARM *BLANKS   P@OP04 20                                           CGL183
     C                     PARM *BLANKS   P@VL04200                                           CGL183
     C                     PARM *BLANKS   P@OP05 20                                           CGL183
     C                     PARM *BLANKS   P@VL05200                                           CGL183
     C                     PARM *BLANKS   P@OP06 20                                           CGL183
     C                     PARM *BLANKS   P@VL06200                                           CGL183
     C                     PARM *BLANKS   P@OP07 20                                           CGL183
     C                     PARM *BLANKS   P@VL07200                                           CGL183
     C                     PARM *BLANKS   P@OP08 20                                           CGL183
     C                     PARM *BLANKS   P@VL08200                                           CGL183
     C                     PARM *BLANKS   P@OP09 20                                           CGL183
     C                     PARM *BLANKS   P@VL09200                                           CGL183
     C                     PARM *BLANKS   P@OP10 20                                           CGL183
     C                     PARM *BLANKS   P@VL10200                                           CGL183
      *                                                                                       CGL183
     C                     MOVELP@VL01    DSAAUD                                              CGL183
      *                                                                                       CGL183
      ** Get time and date, but only format date-CCYYMMDD                                     CGL183
      *                                                                                       CGL183
     C                     TIME           TIMDAT                                              CGL183
      *                                                                                       CGL183
     C                     MOVELWDAT      WISDD                                               CGL183
     C                     MOVE WDAT      WISCY                                               CGL183
     C                     MOVELWDAT      WDDMM   4                                           CGL183
     C                     MOVE WDDMM     WISMM                                               CGL183
      *                                                                                       CGL183
     C                     MOVE 'N'       AUDIT   1                                           CGL183
      *                                                                                       CGL183
      *                                                                   S01472
     C********             MOVE *BLANKS   SFLDS1                    S01472165546
     C  N41                MOVE *BLANKS   SFLDS1                          165546
     C   41                MOVE *BLANKS   SFLDS1                          165546
      *                                                                   S01472
     C* MAIN PROCESSING --- FIRST CALL INITIAL SUBROUTINE
     C*
     C                     EXSR INIT
     C*
     C* DO WHILE NOT Cmd/3 --- ie. NOT EXIT
     C*
     C           *INKC     DOWEQ'0'                        ** B001
     C           EXTFLG    ANDEQ'N'                                                           236093
     C*
     C                     WRITEHEADING
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CCP3                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     EXFMTSFLCTLRA                                                      CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C                     EXFMTSFLCTLR
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CCP4                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C* SETOF INDICATOR FOR ACTION PERFORMED
     C*
     C                     SETOF                     11
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP45                                           S01408
     C*                                                                   S01408
     C*
     C* SETON INDICATOR FOR NO POSTINGS TO DISPLAY
     C*
     C                     SETON                     83
     C*
     C           *IN25     IFEQ '1'
     C           *IN04     ANDEQ'0'                                                           244331
     C                     SETOF                     25                                       244331
     C                     SETON                     11
     C                     EXSR ROLP
     C                     END
     C*
     C*******    *INKL     IFEQ '1'              *********                E19563
     C           *INKE     IFEQ '1'                                       E19563
     C                     SETON                     11
     C                     EXSR CMD5
     C                     END
     C*
     C********** *IN27     DOWEQ'1'                                       S01199
     C**********                                                          S01199
     C***IF*HELP KEY PRESSED BUT THERE ARE NO ERRORS TO DISPLAY           S01199
     C***THEN*DISPLAY USER INSTRUCTIONS                                   S01199
     C**********                                                          S01199
     C********** *IN50     IFEQ '0'                                       S01199
     C**********           MOVEA*BLANK    ERCD                            S01199
     C**********           MOVE ' 999'    ERCD,1                          S01199
     C**********           END                                            S01199
     C**********                                                          S01199
     C**********           MOVEAERCD      HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********           READ SFLCTLR                  99               S01199
     C**********           END                                            S01199
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP46                                           S01408
     C*                                                                   S01408
      *                                                                                       236093
      ** If F03 - Exit                                                                        236093
      *                                                                                       236093
     C           *INKC     IFEQ '1'                                                           236093
     C                     MOVEL'F03'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     ENDIF                                                              236093
      *                                                                                       236093
      ** If F14 - Account Movements                                                           236093
      *                                                                                       236093
     C           *INKN     IFEQ '1'                                                           236093
     C                     MOVEL'F14'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     MOVE 'Y'       EXTFLG                                              236093
     C                     ENDIF                                                              236093
      *                                                                                       236093
      ** If F15 - Projected Account Movements                                                 236093
      *                                                                                       236093
     C           *INKP     IFEQ '1'                                                           236093
     C                     MOVEL'F15'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     MOVE 'Y'       EXTFLG                                              236093
     C                     ENDIF                                                              236093
      *                                                                                       236093
      ** If F16 - Items in Clearing                                                           236093
      *                                                                                       236093
     C           *INKQ     IFEQ '1'                                                           236093
     C                     MOVEL'F16'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     MOVE 'Y'       EXTFLG                                              236093
     C                     ENDIF                                                              236093
     C/COPY OFCPYSRCZ,CGL145_024                                                             CGL145B
     C*
     C* TRANSFER CONTROL TO OTHER ENQUIRIES VIA GROUP JOB...
     C*
     C********** *INKN     IFEQ '1'                        ** B002                            236093
     C**********           OUT  DSLDA                                                         236093
     C**********           CALL 'GL4440'                                                      236093
     C**********           PARM 'GL4442'  PARAM  10                                           236093
     C**********           SETON                     11                                       236093
     C**********           EXSR LDA                                                           236093
     C* On return check if details have changed to blank
     C**********           EXSR FLDCHG                                                        236093
     C********** LDADTA    IFEQ *BLANKS                                                       236093
     C********** *IN12     ANDEQ'1'                                                           236093
     C**********           EXSR ENTR                                                          236093
     C**********           END                                                                236093
     C**********           END                             ** E002                            236093
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CCP7                                           S01408
     C*                                                                   S01408
     C*
     C********** *INKP     IFEQ '1'                        ** B002                            236093
     C**********           OUT  DSLDA                                                         236093
     C**********           CALL 'GL4440'                                                      236093
     C**********           PARM 'GL4443'  PARAM                                               236093
     C**********           SETON                     11                                       236093
     C**********           EXSR LDA                                                           236093
     C* On return check if details have changed to blank
     C**********           EXSR FLDCHG                                                        236093
     C********** LDADTA    IFEQ *BLANKS                                                       236093
     C********** *IN12     ANDEQ'1'                                                           236093
     C**********           EXSR ENTR                                                          236093
     C**********           END                                                                236093
     C**********           END                             ** E002                            236093
     C*
     C********** *INKQ     IFEQ '1'                        ** B002                            236093
     C**********           OUT  DSLDA                                                         236093
     C**********           CALL 'GL4440'                                                      236093
     C**********           PARM 'GL4444'  PARAM                                               236093
     C**********           SETON                     11                                       236093
     C**********           EXSR LDA                                                           236093
     C* On return check if details have changed to blank
     C**********           EXSR FLDCHG                                                        236093
     C********** LDADTA    IFEQ *BLANKS                                                       236093
     C********** *IN12     ANDEQ'1'                                                           236093
     C**********           EXSR ENTR                                                          236093
     C**********           END                                                                236093
     C**********           END                             ** E002                            236093
     C*
     C           *IN11     IFEQ '0'                        ** B002
     C           EXTFLG    ANDEQ'N'                                                           236093
     C                     EXSR ENTR
     C                     END                             ** E002
     C*
     C                     END                             ** E001
     C*
     C*   IF AN ERROR OCCURED ON THE CALL TO THE TRANSFER PROGRAM
     C*   THEN EXECUTE ERROR PROCESSING SUBROUTINE
     C*
     C           *INU1     IFEQ '1'
     C                     EXSR *PSSR
     C                     END
     C*
     C* ...ELSE END PROGRAM (ie. F3)
     C*
     C                     SETON                     LR
     C/COPY WNCPYSRC,GL4441C035
     C*
      /TITLE         <<< INIT SR. >>>
     C*****************************************************************
     C*
     C* INIT --- SUBROUTINE TO PERFORM INITIAL PROCESSING
     C*
     C* 1. READS RUN-DATE AND FORMAT FROM DATA AREA
     C* 2. GETS DETAILS FROM *LDA, OR IF *LDA BLANK FROM SCREEN
     C*
     C* CALLED FROM MAIN POCESSING
     C*
     C* CALLS: LDA (S/R), RSCLDA (PROGRAM)
     C*
     C*****************************************************************
     C*
     C           INIT      BEGSR                           ** INIT **
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CCPG                                           S01408
     C*                                                                   S01408
     C*
     C           *NAMVAR   DEFN RUNDAT    RUNDT
     C                     IN   RUNDT
     C                     UNLCKRUNDT
     C                     Z-ADDRUND      RNDT    50
     C                     MOVE 'N'       EXTFLG  1                                           236093
     C*** INITIALIZE OVERDRAFT LIMIT                                      E18761
     C                     Z-ADD0         ODLN                            E18761
     C**************       Z-ADD0         ODLN                            E18765
     C*                                                                   S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C                     UNLCKZMUSER                                    S01117
     C*                                                                   S01117
     C                     Z-ADD1         I                               S01314
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       LN1273
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM           BRC                             S01117
     C                     PARM *ZERO     ERRCOD                          S01117
     C*                                                                   S01117
     C           ERRCOD    IFNE 0                                         S01117
     C                     SETON                     505164               S01117
     C                     MOVE ' 010'    ERCD,I                          S01117
     C                     ADD  1         I                               S01117
     C                     END                                            S01117
     C                     END                                            LN1273
     C*
     C           DATF      COMP 'M'                      98
     C           MBIN      COMP 'N'                      22               S01117
     C*
     C**********           CALL 'GLC440A'                                                     236093
     C**********           PARM 'I'       @PARM   1                                           236093
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP17                                           S01408
     C*                                                                   S01408
     C*
     C                     CALL 'AOSARDR0'                                                    CGL131
     C                     PARM *BLANKS   @RTCD                                               CGL131
     C                     PARM '*VERIFY' @OPTN                                               CGL131
     C                     PARM 'CGL131'  PSARD                                               CGL131
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL131
      *                                                                                       CGL131
     C           @RTCD     IFNE *BLANKS                                                       CGL131
     C           @RTCD     ANDNE'*NRF    '                                                    CGL131
     C                     MOVE 'SCSARDPD'DBFILE                                              CGL131
     C                     MOVEL'001'     DBASE                                               CGL131
     C                     MOVEL'CGL131'  DBKEY                                               CGL131
     C                     EXSR *PSSR                                                         CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           @RTCD     IFEQ *BLANK                                                        CGL131
     C                     MOVE 'Y'       CGL131  1                                           CGL131
     C                     ELSE                                                               CGL131
     C                     MOVE 'N'       CGL131                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
      ** Check if switchable feature CAP207 is on.                                            CGL131
      *                                                                                       CGL131
     C                     MOVEL'N'       CAP207  1                                           CGL131
     C                     CALL 'AOSARDR0'                                                    CGL131
     C                     PARM *BLANKS   PRTCD                                               CGL131
     C                     PARM '*VERIFY' POPTN                                               CGL131
     C                     PARM 'CAP207'  PSARD                                               CGL131
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL131
      *                                                                                       CGL131
     C           PRTCD     IFEQ *BLANKS                                                       CGL131
     C                     MOVEL'Y'       CAP207                                              CGL131
     C                     ELSE                                                               CGL131
     C                     MOVEL'N'       CAP207                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
      *                                                                                     MD021130
      ** Retrieve system value that controls the display of available balance when          MD021130
      **    CGL131 is switched On                                                           MD021130
      *                                                                                     MD021130
     C**********           MOVELV#GLAB    P@OP01                                   MD021130 MD050886
     C                     MOVELV#GLAB    P@OP01    P                                       MD050886
      *                                                                                     MD021130
     C                     CALL 'AOSVALR0'                                                  MD021130
     C                     PARM *BLANKS   @RTCD   7                                         MD021130
     C                     PARM           P@OP01 20                                         MD021130
     C                     PARM *BLANKS   P@VL01200                                         MD021130
     C                     PARM *BLANKS   P@OP02 20                                         MD021130
     C                     PARM *BLANKS   P@VL02200                                         MD021130
     C                     PARM *BLANKS   P@OP03 20                                         MD021130
     C                     PARM *BLANKS   P@VL03200                                         MD021130
     C                     PARM *BLANKS   P@OP04 20                                         MD021130
     C                     PARM *BLANKS   P@VL04200                                         MD021130
     C                     PARM *BLANKS   P@OP05 20                                         MD021130
     C                     PARM *BLANKS   P@VL05200                                         MD021130
     C                     PARM *BLANKS   P@OP06 20                                         MD021130
     C                     PARM *BLANKS   P@VL06200                                         MD021130
     C                     PARM *BLANKS   P@OP07 20                                         MD021130
     C                     PARM *BLANKS   P@VL07200                                         MD021130
     C                     PARM *BLANKS   P@OP08 20                                         MD021130
     C                     PARM *BLANKS   P@VL08200                                         MD021130
     C                     PARM *BLANKS   P@OP09 20                                         MD021130
     C                     PARM *BLANKS   P@VL09200                                         MD021130
     C                     PARM *BLANKS   P@OP10 20                                         MD021130
     C                     PARM *BLANKS   P@VL10200                                         MD021130
      *                                                                                     MD021130
     C                     MOVELP@VL01    VLGLAB  1                                         MD021130
      *                                                                                     MD021130
     C                     EXSR SRBALT                                                      MD022437
     C                     EXSR LDA
     C*
     C                     WRITEHEADING
     C*
     C                     SETON                     03
     C                     MOVEL'GL4441'  HBPGM   8
     C*
     C/COPY WNCPYSRC,GL4441C034
     C                     ENDSR                           ** INIT **
     C*
      /TITLE         <<< LDA SR. >>>
     C*****************************************************************
     C*
     C* LDA --- SUBROUTINE TO CHECK FOR LDA=BLANK
     C*
     C* CALLED FROM: MAIN PROCESSING, INIT
     C*
     C* CALLS: ENTR
     C*
     C*****************************************************************
     C*
     C           LDA       BEGSR                           ** LDA **
     C*
     C                     IN   DSLDA
     C/COPY WNCPYSRC,GL4441C014
     C           LDADTA    IFEQ *BLANKS                    ** B001
     C*
     C                     SETOF                     20
     C/COPY WNCPYSRC,GL4441C003
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C********** VLGLAB    ANDEQ'Y'                                                MD021130 MD022437
     C                     CLEARSTATICA                                                       CGL131
     C                     EXSR SRBALT                                                      MD022437
     C                     WRITESTATICA                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     CLEARSTATIC                                    101264
     C                     EXSR SRBALT                                                      MD022437
     C                     WRITESTATIC
     C/COPY WNCPYSRC,GL4441C004
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*
     C                     ELSE                            ** X001
     C*
     C                     EXSR ENTR
     C*
     C                     END                             ** E001
     C*
     C                     ENDSR                           ** LDA **
     C*
      /TITLE         <<< ENTR SR. >>>
     C*****************************************************************
     C*
     C* ENTR --- SUBROUTINE CALLED ON ENTER BEING PRESSED
     C*
     C* 1. VALIDATES INPUT CRITERIA
     C* 2. FOR VALID INPUT, IF A/C CHANGED, GETS A/C AND CLIENT DETAILS
     C* 3. BUILDS AND DISPLAYS SUBFILE OF VALID RECORDS
     C*
     C* CALLED FROM: MAIN PROCESSING, LDA
     C*
     C* CALLS: FLDCHG, VALID, STORE, BSFIL1, BSFIL2 (S/R)
     C*        AOCUSTR0 (PROGRAM)
     C*
     C*****************************************************************
     C*
     C           ENTR      BEGSR                           ** ENTR **
     C*
     C* ONLY VALIDATE AND RE-OUTPUT IF USER I/P HAS CHANGED
     C*
     C                     EXSR FLDCHG
     C*
     C           *IN12     IFEQ '1'                        ** B001
     C*
     C*
     C* CLEAR ALL OLD RECORDS FROM THE SUBFILE
     C*
     C                     SETOF                     0203
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CCP8                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     WRITESFLCTLRA                                                      CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C                     WRITESFLCTLR
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CCP9                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C                     SETON                       03
     C*
     C                     EXSR VALID
     C*                                                                   LN1295
     C*                                                                   S01408
      * If no errors and feature not off, check user authority                             CRE024
      * to account code                                                                    CRE024
     C           CRE024    IFNE 'N'                                                        CRE024
     C           *IN51     ANDEQ'0'                                                        CRE024
     C                     CALL 'SF0930'                                                   CRE024
     C                     PARM           CRE024  1                                        CRE024
     C                     PARM *BLANKS   UMAUTH  1                                        CRE024
     C                     PARM KCOD      UMACOD 100                                       CRE024
     C**********           PARM KCUS      UMCNUM  60                                 CRE024 BUG11679
     C                     PARM KCUS      UMCNUM  6                                         BUG11679
     C                     PARM KCCY      UMCCY   3                                        CRE024
     C                     PARM KASE      UMACSQ  20                                       CRE024
     C                     PARM KBRC      UMBRCA  3                                        CRE024
     C                     PARM 'GL4441'  UMPGM  10                                        CRE024
     C                     PARM '*REPT'   UMOPTN  5                                        CRE024
     C                     PARM *BLANKS   UMEMSG 50                                        CRE024
      *                                                                                    CRE024
      * If user not authorised, set on error indicators                                    CRE024
     C           UMAUTH    IFEQ 'N'                                                        CRE024
     C                     MOVEA'11'      *IN,50                                           CRE024
     C                     MOVELUMEMSG    ERRDSP    P                                      CRE024
     C                     END                                                             CRE024
     C                     END                                                             CRE024
     C/COPY WNCPYSRC,GL4441CP10                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     WRITESFLCTLRA                                                      CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C                     WRITESFLCTLR                                   LN1295
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP11                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C* IF A/C HAS CHANGED ...
     C*
     C           *IN60     IFEQ '1'                        ** B002
     C*
     C* IF A/C IS FOR AN UNALLOCATED NOSTRO THEN DONT DISPLAY
     C*   ANY ACCOUNT DETAILS
     C*
     C           *IN15     IFEQ '1'                        ** B003
     C                     SETON                     51
     C                     MOVELEMSG,2    ANAM
     C                     END                             ** E003
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP16                                           S01408
     C*                                                                   S01408
     C*
     C* IF A/C VALID ACCESS FILES FOR A/C DETAILS
     C*
     C           *IN51     IFEQ '0'                        ** B003
     C*
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   P@RTCD  7
     C                     PARM '*KEY'    P@OPTN  7
     C                     PARM KCUSA     P@KEY1 10
     C                     PARM           P@ANY   7
     C***********          PARM           P@FMT2                                              CSD006
     C           P@FMT2    PARM P@FMT2    DSSDY                                               CSD006
     C*
     C* SET-UP A/C DETAILS FOR DISPLAY
     C*
     C                     EXSR ACDETS
     C*
     C                     SETON                     20
     C/COPY WNCPYSRC,GL4441C005
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C********** VLGLAB    ANDEQ'Y'                                                MD021130 MD022437
     C                     WRITESTATICA                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     WRITESTATIC
     C/COPY WNCPYSRC,GL4441C006
     C*
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
      * Only write to file REEAUDPP if CGL183 is on & audit not yet done                      CGL183
      *                                                                                       CGL183
     C           *IN60     IFEQ '1'                                                           CGL183
     C           *IN50     ANDNE'1'                                                           CGL183
     C                     MOVE 'N'       AUDIT                                               CGL183
     C                     ENDIF                                                              CGL183
      *                                                                                       CGL183
     C           CGL183    IFEQ 'Y'                                                           CGL183
     C           AUDIT     ANDNE'Y'                                                           CGL183
     C           VLACMV    ANDEQ'Y'                                                           CGL183
      *                                                                                       CGL183
      * Format the fields for output                                                          CGL183
      *                                                                                       CGL183
     C                     MOVELSUSER     LG1ID                                               CGL183
     C                     MOVELSWSID     LG1WRK                                              CGL183
      *                                                                                       CGL183
      * Format Time and Date (ccyymmdd) Fields.                                               CGL183
      *                                                                                       CGL183
     C                     TIME           TIMDAT                                              CGL183
     C                     Z-ADDWTIM      LG1TIM                                              CGL183
     C                     Z-ADDISODAT    LG1DAT                                              CGL183
      *                                                                                       CGL183
     C                     Z-ADDKRET      LG1RTN                                              CGL183
     C                     MOVELKBRC      LG1BRN                                              CGL183
     C                     MOVE KCUS      LG1CUN                                              CGL183
     C                     MOVELKCCY      LG1CCY                                              CGL183
     C                     Z-ADDKCOD      LG1ACD                                              CGL183
     C                     Z-ADDKASE      LG1ASQ                                              CGL183
     C                     MOVEL'AC'      LG1ZDR                                              CGL183
     C                     MOVEL'A'       LG1TYP                                              CGL183
     C                     MOVE *BLANKS   LG1REF                                              CGL183
      *                                                                                       CGL183
     C                     WRITEREEAUDR1                                                      CGL183
     C                     MOVE 'Y'       AUDIT                                               CGL183
      *                                                                                       CGL183
     C                     ENDIF                                                              CGL183
      *                                                                                       CGL183
     C                     ELSE                            ** X003
     C*
     C                     SETOF                     20
     C                     SETOF                     06                   CFT004
     C/COPY WNCPYSRC,GL4441C007
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C********** VLGLAB    ANDEQ'Y'                                                MD021130 MD022437
     C                     WRITESTATICA                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     WRITESTATIC
     C/COPY WNCPYSRC,GL4441C008
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*
     C                     END                             ** E003
     C*
     C                     END                             ** E002
     C*
     C* IF NEW USER I/P IS VALID, STORE.
     C*
     C           *IN50     IFEQ '0'                        ** B002
     C*
     C                     EXSR STORE
     C                     EXSR SCRN1
     C*
     C                     ELSE                            ** X002
     C*
     C*
     C*
     C                     END                             ** E002
     C* WRITE SUB FILE HEADING RECORD
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CCP5                                           S01408
     C*                                                                   S01408
     C                     WRITESTATIC1
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CCP6                                           S01408
     C*                                                                   S01408
     C*
     C*  IF INPUT HAS NOT CHANGED ENSURE THAT THE SUBFILE IS
     C*     REDISPLAYED AT THE SAME POSTION
     C*
     C                     ELSE                            ** X001
     C*
     C                     Z-ADDCPFPOS    DSPREC
     C*
     C                     END                             ** E001
     C*
     C                     ENDSR                           ** ENTR **
     C*
     C*
      /TITLE         <<< CMD5 SR. >>>
     C*****************************************************************
     C*
     C* CMD5 --- REFRESH SCREEN WITH CURRENT DETAILS
     C*
     C* 1. RESTORE OLD USER I/P FIELDS, IF ANY CHANGED
     C* 2. CLEAR AND RESET SUBFILE
     C* 3. RE-LOAD FROM FIRST OF SELECTED RECORDS
     C*
     C* CALLED FROM: MAIN PROCESSING
     C*
     C* CALLS: FLDCHG, RSTOR, BSFIL1, BSFIL2
     C*
     C*****************************************************************
     C*
     C           CMD5      BEGSR                           ** CMD5 **
     C*
     C* IN02 CONDITIONS CLEAR/RESET OF SUBFILE...
     C*
     C                     SETON                     21
     C*
     C                     EXSR FLDCHG
     C*
     C           *IN12     IFEQ '1'                        ** B001
     C                     EXSR RSTOR
     C                     END                             ** E001
     C*
     C*
     C* CLEAR ALL OLD RECORDS FROM THE SUBFILE
     C*
     C                     SETOF                     0203
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP12                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C********** VLGLAB    ANDEQ'Y'                                                MD021130 MD022437
     C                     SETOF                         50                                   CGL131
      *                                                                                       CGL131
      ** Overdraft limit is held without decimal places - amend it                            CGL131
      ** to have decimal places to give overdraft limit                                       CGL131
      ** which can be added to cleared balance                                                CGL131
      *                                                                                       CGL131
     C           A6NBDP    IFEQ 1                                   B1                        CGL131
     C********** ODLN      MULT 10        ODLNB  110                                   CGL131 263362
     C           ODLN      MULT 10        ODLNB  140                                          263362
     C                     ELSE                                     X1                        CGL131
     C           A6NBDP    IFEQ 2                                   B2                        CGL131
     C           ODLN      MULT 100       ODLNB                                               CGL131
     C                     ELSE                                     X2                        CGL131
     C           A6NBDP    IFEQ 3                                   B3                        CGL131
     C           ODLN      MULT 1000      ODLNB                                               CGL131
     C                     ELSE                                     X3                        CGL131
     C           A6NBDP    IFEQ 0                                   B4                        CGL131
     C                     Z-ADDODLN      ODLNB                                               CGL131
     C                     ENDIF                                    E4                        CGL131
     C                     ENDIF                                    E3                        CGL131
     C                     ENDIF                                    E2                        CGL131
     C                     ENDIF                                    E1                        CGL131
      *                                                                                       CGL131
      ** Account Balance Check                                                                CGL131
      *                                                                                       CGL131
     C           CAP207    IFEQ 'Y'                                                           CGL131
     C                     MOVE ACNO      PRTAC                                             MD044087
     C                     CALL 'RE001590'                                                    CGL131
     C**********           PARM           ACNO                                       CGL131 MD044087
     C                     PARM           PRTAC                                             MD044087
     C                     PARM           KCUS                                                CGL131
     C                     PARM           KCCY                                                CGL131
     C                     PARM           KCOD                                                CGL131
     C                     PARM           KASE                                                CGL131
     C                     PARM           KBRC                                                CGL131
     C                     PARM 'BAL ENQY'TRNTYP 10                                           CGL131
     C                     PARM           RUND                                                CGL131
     C                     PARM *ZEROS    PAMT   150                                          CGL131
     C                     PARM *BLANKS   PERR01  7                                           CGL131
     C                     PARM *BLANKS   PERR02  7                                           CGL131
     C                     PARM *ZEROS    PACTBA                                              CGL131
     C                     PARM *ZEROS    PAVLBA                                              CGL131
     C                     PARM *ZEROS    PFADAT  50                                          CGL131
     C                     PARM *ZEROS    PFABAL 150                                          CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           PERR01    IFEQ *BLANKS                                                       CGL131
     C           CAP207    ANDEQ'Y'                                                           CGL131
      *                                                                                       CGL131
     C                     Z-ADDPAVLBA    ZFLD15                                              CGL131
     C                     Z-ADDA6NBDP    ZDECS                                               CGL131
     C                     MOVE 'A'       ZECODE                                              CGL131
     C                     EXSR ZFRPED                                                        CGL131
     C                     MOVE ZOUT22    DISPO                                               CGL131
      *                                                                                       CGL131
     C                     Z-ADDPACTBA    ZFLD15                                              CGL131
     C                     EXSR ZFRPED                                                        CGL131
     C                     MOVE ZOUT22    LDBLNA                                              CGL131
     C                     MOVE ZOUT22    CLBLNA                                              CGL131
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
      ** If Retail Account, access MEMOS record for closing cleared                           CGL131
      ** balance to be used in the DISPO balance calculation                                  CGL131
      *                                                                                       CGL131
     C           ATYP      IFEQ 'R'                                 B1                        CGL131
      *                                                                                       CGL131
     C           KEYML1    CHAINMEMOSL1              31                                       CGL131
     C           *IN31     IFEQ '1'                                 B2                        CGL131
     C                     MOVEL'MEMOS'   DBFILE           *************                      CGL131
     C                     MOVE *BLANKS   DBKEY            * DB ERR 99 *                      CGL131
     C                     MOVELRRNM      DBKEY            *************                      CGL131
     C                     Z-ADD99        DBASE                                               CGL131
     C                     EXSR *PSSR                                                         CGL131
     C                     ENDIF                                    E2                        CGL131
     C                     ENDIF                                    E1                        CGL131
     C           CGL131    IFEQ 'Y'                                 B1                        CGL131
     C********** VLGLAB    ANDEQ'Y'                                                MD021130 MD022437
      *                                                                                       CGL131
      ** Build actuals                                                                        CGL131
      *                                                                                       CGL131
     C                     MOVEL*BLANKS   CLBLNA                                              CGL131
     C                     MOVEL*BLANKS   LDBLNA                                              CGL131
     C                     Z-ADDCLBLN     ZFLD15                                              CGL131
     C                     Z-ADDA6NBDP    ZDECS                                               CGL131
     C                     MOVE 'A'       ZECODE                                              CGL131
     C                     EXSR ZFRPED                                                        CGL131
     C                     MOVE ZOUT22    CLBLNA 22                                           CGL131
      *                                                                                       CGL131
     C********** *LOVAL    SETLLRSACMTLD                                             CGL131 MD020122
     C********** KEYRV0    CHAINRSACMTLD             31                              CGL131 MD020122
     C********** *IN31     DOWEQ*OFF                                B2               CGL131 MD020122
     C********** VALD      IFGT RNDT                                B3               CGL131 MD020122
     C********** TRYP      IFEQ 'IN'                                B4               CGL131 MD020122
     C********** TRYP      OREQ 'OP'                                                 CGL131 MD020122
     C********** DRCR      IFEQ *ZERO                               B5               CGL131 MD020122
     C**********           SUB  PSTA      LDBLN                                      CGL131 MD020122
     C**********           ELSE                                     X5               CGL131 MD020122
     C**********           ADD  PSTA      LDBLN                                      CGL131 MD020122
     C**********           ENDIF                                    E5               CGL131 MD020122
     C**********           ENDIF                                    E4               CGL131 MD020122
     C**********           ENDIF                                    E3               CGL131 MD020122
     C********** KEYRV0    READERSACMTLD                 31                          CGL131 MD020122
     C**********           ENDDO                                    E2               CGL131 MD020122
      *                                                                                       CGL131
     C                     Z-ADDLDBLN     ZFLD15                                              CGL131
     C                     Z-ADDA6NBDP    ZDECS                                               CGL131
     C                     MOVE 'A'       ZECODE                                              CGL131
     C                     EXSR ZFRPED                                                        CGL131
     C                     MOVE ZOUT22    LDBLNA 22                                           CGL131
     C                     ENDIF                                    E1                        CGL131
     C           CGL131    IFEQ 'Y'                                 B1                        CGL131
     C********** VLGLAB    ANDEQ'Y'                                                MD021130 MD022437
      *                                                                                       CGL131
     C                     Z-ADDCLBLN     CLRHLD 150                                          CGL131
     C                     Z-ADDCLBL      ZFLD15                                              CGL131
     C                     ELSE                                     X1                        CGL131
      *                                                                                       CGL131
     C                     Z-ADDCLBL      CLRHLD                                              CGL131
     C                     Z-ADDCLBL      ZFLD15                                              CGL131
     C                     ENDIF                                    E1                        CGL131
      *                                                                                       CGL131
      ** Calculate disposable balance as follows :                                            CGL131
      **  Cleared balance + o/d limit - all held items.                                       CGL131
      *                                                                                       CGL131
      ** Dispo balance = cleared balance + overdraft limit - held                             CGL131
      ** items (signs are reversed)                                                           CGL131
      *                                                                                       CGL131
     C                     Z-ADDCLRHLD    DSPBAL 150       Cleared bal                        CGL131
     C           RNDT      IFLT ODED                                B1                        CGL131
     C                     SUB  ODLNB     DSPBAL           O/d limit                          CGL131
     C                     ENDIF                                    E1                        CGL131
     C                     ADD  HELD      DSPBAL           Held items                         CGL131
     C                     Z-ADDDSPBAL    ZFLD15                                              CGL131
     C                     Z-ADDA6NBDP    ZDECS                                               CGL131
     C                     MOVE 'A'       ZECODE                                              CGL131
     C                     EXSR ZFRPED                                                        CGL131
     C                     MOVE ZOUT22    DISPO                                               CGL131
     C                     ENDIF                                                              CGL131
     C**********           WRITESTATIC                                               CGL131 MD022437
     C                     WRITESTATICA                                                     MD022437
     C                     WRITESFLCTLRA                                                      CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C                     WRITESFLCTLR
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP13                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
      ** If F5 pressed reset posting date and set to beg. of file                             CGL131
      *                                                                                       CGL131
     C           *INKE     IFEQ *ON                                                           CGL131
     C           *LOVAL    SETLLRSACMTLD                                                      CGL131
     C**********           Z-ADD99999     POSDN                                      CGL131 MD024978
     C                     Z-ADD0         POSDN                                             MD024978
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C                     SETON                       03
     C                     EXSR SCRN1
     C*
     C                     ENDSR                           ** CMD5 **
     C*
      /TITLE         <<< SCRN1 SR. >>>
     C*****************************************************************
     C*
     C* SCRN1 -- REBUILD SUBFILE FROM THE FIRST RECORD
     C*
     C* 1. RESET RELATIVE RECORD NUMBERS
     C* 2. CLEAR THE SUBFILE
     C**3**D*T*RM*NE*IF*APOSTL1 OR APOSTL2 IS TO BE USED                  165546
     C* 3. DETERMINE IF APOSTL1 OR APOSTL2 OR APOSTL9 IS TO BE USED       165546
     C* 4. LOAD FIRST PAGE OF SUBFILE RECORDS
     C*
     C* CALLED FROM: ENTR, CMD5
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           SCRN1     BEGSR                           ** SCRN1 **
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP22                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
     C           CGL131    OREQ 'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
      *                                                                                       CGL131
     C*                                                                   S01408
     C* RESET SUBFILE AND FILE RECORD POINTER
     C*
     C                     Z-ADD1         RRN     40
     C                     SETOF                     048083
     C*
     C                     SETON                     21
     C           *IN41     IFEQ '0'                                       165546
     C*
     C           CQKEY     IFEQ *ZEROS                     ** B001
     C*
     C*  IF A '-' WAS ENTERED WE DISPLAY ANY DR/CR <= THE AMOUNT
     C*  IF A '+' WAS ENTERED OR JUST AN AMOUNT WE DISPLAY ANY
     C*      DR/CR >= THE AMOUNT
     C*
     C           PORM      IFEQ '-'
     C                     Z-ADD0         AMTKY  130
     C                     ELSE
     C                     Z-ADDAMTNUM    AMTKY
     C                     END
     C*
     C                     Z-ADD0         DORK    10
     C           KEYSL1    SETLLAPOSTL1
     C           KEYEQ     READEAPOSTL1                  80
     C                     EXSR BSFIL1
     C*
     C                     ELSE                            ** X001
     C*
     C                     MOVE *BLANK    POSDA
     C*
     C           KEYSL2    SETLLAPOSTL2
     C           KEYEQ     READEAPOSTL2                  80
     C*
     C*
     C                     EXSR BSFIL2
     C*
     C                     END                             ** E001
     C                     ENDIF                                          165546
     C           *IN41     IFEQ '1'                                       165546
     C           PCKEY     IFEQ *BLANK                     ** B001        165546
     C*  IF A '-' WAS ENTERED WE DISPLAY ANY DR/CR <= THE AMOUNT          165546
     C*  IF A '+' WAS ENTERED OR JUST AN AMOUNT WE DISPLAY ANY            165546
     C*      DR/CR >= THE AMOUNT                                          165546
     C           PORM      IFEQ '-'                                       165546
     C                     Z-ADD0         AMTKY  130                      165546
     C                     ELSE                                           165546
     C                     Z-ADDAMTNUM    AMTKY                           165546
     C                     END                                            165546
     C                     Z-ADD0         DORK    10                      165546
     C           KEYSL1    SETLLAPOSTL1                                   165546
     C           KEYEQ     READEAPOSTL1                  80               165546
     C                     EXSR BSFIL1                                    165546
     C                     ELSE                            ** X001        165546
     C                     MOVE *BLANK    POSDA                           165546
     C           KEYSL9    SETLLAPOSTL9                                   165546
     C           KEYEQ     READEAPOSTL9                  80               165546
     C                     EXSR BSFIL2                                    165546
     C                     END                             ** E001        165546
     C                     ENDIF                                          165546
     C*
     C*  DISPLAY MESSAGE - IF NO RECORDS WERE WRITTEN TO THE SUBFILE
     C*
     C           *IN83     IFEQ '0'
     C                     MOVE EMSG,1    ERRDSP
     C/COPY WNCPYSRC,GL4441C015
     C                     SETON                     50
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP23                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
      *                                                                                       CGL131
      ** RESET SUBFILE AND FILE RECORD POINTER                                                CGL131
      *                                                                                       CGL131
     C                     Z-ADD1         RRN     40                                          CGL131
     C                     SETOF                     048083                                   CGL131
      *                                                                                       CGL131
     C                     SETON                     21                                       CGL131
     C                     MOVE ' '       TODAY   1                                           CGL131
      *                                                                                       CGL131
     C           CQKEY     IFEQ *ZEROS                     ** B001                            CGL131
      *                                                                                       CGL131
      ** IF A '-' WAS ENTERED WE DISPLAY ANY DR/CR <= THE AMOUNT                              CGL131
      ** IF A '+' WAS ENTERED OR JUST AN AMOUNT WE DISPLAY ANY                                CGL131
      **     DR/CR >= THE AMOUNT                                                              CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '-'                                                           CGL131
     C                     Z-ADD0         AMTKY  130                                          CGL131
     C                     ELSE                                                               CGL131
     C                     Z-ADDAMTNUM    AMTKY                                               CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           AMONT     IFEQ *BLANKS                                                       CGL131
      *                                                                                       CGL131
     C                     Z-ADD0         DORK    10                                          CGL131
     C           POSDN     IFGE RNDT                                                          CGL131
     C                     MOVE '1'       TODAY                                               CGL131
     C                     ELSE                                                               CGL131
     C                     MOVE '2'       TODAY                                               CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           TODAY     IFEQ '1'                                                           CGL131
     C           KEYSL1    SETLLRSACMTLD                                                      CGL131
     C           KEYEQ     READERSACMTLD                 80                                   CGL131
     C                     MOVELFORMA5    FORMAT 10                                           CGL131
      *                                                                                       CGL131
      ** IF EOF ON TODAYS POSTINGS                                                            CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ *ON                                                           CGL131
     C                     MOVE RNDT      POSDN                                               CGL131
     C           KEYSL1    SETLLAPOSTL38                                                      CGL131
     C                     MOVE '2'       TODAY                                               CGL131
     C                     MOVE *OFF      *IN80                                               CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           TODAY     IFEQ '2'                                                           CGL131
     C           KEYSL1    SETLLAPOSTL38                                                      CGL131
     C           KEYEQ     READEAPOSTL38                 80                                   CGL131
     C                     MOVELFORMA1    FORMAT 10                                           CGL131
     C                     ENDIF                                                              CGL131
     C                     EXSR BSFIL1                                                        CGL131
      *                                                                                       CGL131
     C                     ELSE                            ** X001                            CGL131
      *                                                                                       CGL131
      ** IF A '-' WAS ENTERED WE DISPLAY ANY DR/CR <= THE AMOUNT                              CGL131
      ** IF A '+' WAS ENTERED OR JUST AN AMOUNT WE DISPLAY ANY                                CGL131
      **     DR/CR >= THE AMOUNT                                                              CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '-'                                                           CGL131
     C                     Z-ADD0         AMTKY  130                                          CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '+'                                                           CGL131
     C           PORM      OREQ ' '                                                           CGL131
     C                     Z-ADDAMTNUM    AMTKY                                               CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '%'                                                           CGL131
     C           AMTNUM    MULT 0.8       AMTKY            LIM <                              CGL131
     C           AMTNUM    MULT 1.2       AMTKYG 130       LIM >                              CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     MOVE *BLANK    POSDA                                               CGL131
     C                     Z-ADD0         DORK    10                                          CGL131
     C                     MOVE '1'       TODAY                                               CGL131
      *                                                                                       CGL131
     C           KEYSL3    SETLLRSACMTLC                                                      CGL131
     C           KEYEQ     READERSACMTLC                 80                                   CGL131
     C                     MOVELFORMA7    FORMAT 10                                           CGL131
      *                                                                                       CGL131
     C                     EXSR BSFIL3                                                        CGL131
      *                                                                                       CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     ELSE                            ** X001                            CGL131
      *                                                                                       CGL131
     C                     MOVE *BLANK    POSDA                                               CGL131
     C                     MOVE '1'       TODAY                                               CGL131
      *                                                                                       CGL131
     C           KEYSL2    SETLLRSACMTLB                                                      CGL131
     C           KEYEQ     READERSACMTLB                 80                                   CGL131
     C                     MOVELFORMA7    FORMAT 10                                           CGL131
      *                                                                                       CGL131
     C                     EXSR BSFIL2                                                        CGL131
      *                                                                                       CGL131
     C                     END                             ** E001                            CGL131
      *                                                                                       CGL131
      ** DISPLAY MESSAGE - IF NO RECORDS WERE WRITTEN TO THE SUBFILE                          CGL131
      *                                                                                       CGL131
     C           *IN83     IFEQ '0'                                                           CGL131
     C                     MOVE EMSG,1    ERRDSP                                              CGL131
     C                     Z-ADDRNDT      POSDN                                               CGL131
     C                     SETON                     50                                       CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C                     ENDSR                           ** SCRN1 **
     C*
      /TITLE         <<< FLDCHG SR. >>>
     C*****************************************************************
     C*
     C* FLDCHG --- SUBROUTINE TO SET FIELDS CHANGED? INDICATORS
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           FLDCHG    BEGSR                           ** FLDCHG **
     C*
     C           MBIN      IFEQ 'Y'                                       S01117
     C           MBACNT    COMP MBACSV               6060                 S01117
     C                     ELSE                                           S01117
     C           ACNT      COMP ACSV                 6060
     C                     END                                            S01117
     C           POSDA     COMP PDSV                 6161
      *
      * Force a change of posting date on change of account - this will   081855
      * cause the posting date to be recalculated                         081855
      *                                                                   081855
     C           *IN60     IFEQ '1'                        New Account?   081855
     C                     SETON                     61                   081855
     C                     ENDIF                                          081855
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP14                                           S01408
     C*                                                                   S01408
     C           PORM      COMP POSV                 6262
     C           AMONT     COMP AMSV                 6363
     C**N63***** CQNMR     COMP CHSV                 6363                 165546
     C  N63N41   CQNMR     COMP CHSV                 6363                 165546
     C  N63 41   PCAMR     COMP PCSV                 6363                 165546
     C*
     C* IF THIS IS THE FIRST TIME INTO THE PROGRAM
     C*   OR INVALID INPUT WAS ENTERED PREVIOUSLY
     C*    THEN FORCE VALIDATION TO TAKE PLACE
     C*
     C           *IN01     IFEQ '0'
     C           *IN50     OREQ '1'
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP47                                           S01408
     C*                                                                   S01408
     C                     SETON                     016061
     C                     SETON                     6263
     C                     END
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP24                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C           *INKE     IFEQ '1'                                                           CGL131
     C                     SETON                     6061                                     CGL131
     C                     END                                                                CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C           *IN60     IFEQ '1'
     C           *IN61     OREQ '1'
     C           *IN62     OREQ '1'
     C           *IN63     OREQ '1'
     C                     SETON                     12
     C                     ELSE
     C                     SETOF                     12
     C                     END
     C*
     C                     ENDSR                           ** FLDCHG **
     C*
      /TITLE         <<< VALID SR. >>>
     C*****************************************************************
     C*
     C* VALID --- SUBROUTINE TO PERFORM INITIAL PROCESSING
     C*
     C* 1. VALIDATES USER-I/P SEARCH CRITERIA, AND SETS APPROPRIATE
     C* ERROR INDICATORS FOR ANY INVALID FIELDS
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: ZDATE1, ZALIGN (STANDARD S/RS); AOACCTV0 (PROGRAM)
     C*
     C*****************************************************************
     C*
     C           VALID     BEGSR                           ** VALID **
     C*
     C* CLEAR ERROR CODE ARRAY AND SETOF INVALID INDICATOR
     C*
     C                     MOVE *BLANKS   P@ALL
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD1         I       20
     C*
     C                     SETOF                     5051
     C                     SETOF                     646566
     C                     SETOF                     6768
     C*
     C* IF A/C FIELD HAS CHANGED...
     C*
     C           *IN60     IFEQ '1'                        ** B001
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CVKS                                           S01408
     C*                                                                   S01408
     C*
     C* ...VALIDATE A/C --- BLANK=>INVALID / P@RTCD<>BLANK=>NOT ON FILE
     C*
     C           CNUMR     IFEQ *BLANKS                    ** B002
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CVK1                                           S01408
     C*                                                                   S01408
     C                     SETON                     505164
     C                     MOVE ' 001'    ERCD,I
     C                     ADD  1         I
     C                     ELSE                            ** X002
     C*                                                                   LN1295
     C**  CHECK FOR BRANCH AUTHORITY NOW DONE AFTER ACCESS TO             LN1295
     C**  ACCOUNT TO PICK UP BRANCH FOR NOSTRO CODE/SHORTNAME             LN1295
     C*                                                                   LN1295
     C***********                                                   S01117LN1295
     C**CHECK*THAT*USER*IS*AUTHORISED*TO*BRANCH******               S01117LN1295
     C***********                                                         LN1295
     C***********MBIN      IFEQ 'Y'                                 S01117LN1295
     C***********BRNCH     IFNE *BLANKS                             S01117LN1295
     C***********                                                   S01117LN1295
     C***********          CALL 'ZVBBU'                             S01117LN1295
     C***********          PARM           BRNCH                     S01117LN1295
     C***********          PARM *ZERO     ERRCOD  10                S01117LN1295
     C***********                                                   S01117LN1295
     C***********ERRCOD    IFNE 0                                   S01117LN1295
     C***********          SETON                     505164         S01117LN1295
     C***********          MOVE ' 010'    ERCD,I                    S01117LN1295
     C***********          ADD  1         I                         S01117LN1295
     C***********          END                                      S01117LN1295
     C***********          END                                      LN1273LN1295
     C***********          END                                      LN1273LN1295
     C*                                                             S01117LN1295
     C***********          ELSE                                     S01117LN1273
     C*                                                                   LN1273
     C           BRNCH     IFEQ *BLANKS                                   LN1273
     C*                                                                   S01117
     C* IF BRANCH IS LEFT BLANK AND FULL GENERAL LEDGER ACCOUNT IS USED   S01117
     C* OBTAIN DEFAULT BRANCH FROM ZMUSER                                 S01117
     C*                                                                   S01117
     C           CNUMR     IFNE *BLANKS                                   S01117
     C           CURRY     ANDNE*BLANKS                                   S01117
     C           ACCOD     ANDNE*BLANKS                                   S01117
     C           ACSEQ     ANDNE*BLANKS                                   S01117
     C                     MOVELBRC       BRNCH                           S01117
     C                     END                                            S01117
     C***********          END                                      S01117LN1273
     C***********          END                                      S01117LN1273
     C                     END                                            LN1273
     C*                                                                   S01117
     C* AOACCTV0 IS AN EXTERNAL PROGRAM WHICH ACCESSES A/C DETAILS        S01117
     C*
     C                     CALL 'AOACCTV0'
     C                     PARM           P@RTCD  7
     C                     PARM CNUMR     P@KEY1 10
     C                     PARM CURRY     P@KEY2  3
     C**********           PARM ACCOD     P@KEY3  4                                           CGL029
     C                     PARM ACCOD     P@KEY3 10                                           CGL029
     C                     PARM ACSEQ     P@KEY4  2
     C                     PARM BRNCH     P@KEY5  3                       S01117
     C                     PARM           P@TYPE  7
     C                     PARM           P@NOSN  2
     C*********************PARM           P@FMT1                          LN0130
     C           P@FMT1    PARM P@FMT1    DSSDY                           LN0130
     C*
     C* IF INVALID ACCOUNT CHECK TO SEE IF ITS AN UNALLOCATED ACCOUNT
     C*
     C                     SETOF                     15
     C           P@RTCD    IFNE *BLANKS                    ** B003
     C/COPY WNCPYSRC,GL4441C016
     C                     EXSR UNALOC
     C                     END                             ** E003
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP18                                           S01408
     C*                                                                   S01408
     C*
     C           P@RTCD    IFNE *BLANKS                    ** B003
     C           P@RTCD    ANDNE'*ACST  '                                                     202528
     C/COPY WNCPYSRC,GL4441C017
     C                     SETON                     505164
     C                     MOVE ' 002'    ERCD,I
     C                     ADD  1         I
     C                     ELSE                            ** X003
      *                                                                                       CGL037
     C           CGL037    IFEQ 'Y'                                                           CGL037
      *                                                                                       CGL037
      ** If indicator U5 is OFF, Account Code must have Account                               CGL037
      ** Type 'R' and A/C Subtype not equal to ('V' or 'I')                                   CGL037
      *                                                                                       CGL037
     C           *INU5     IFEQ '0'                        ** B004                            CGL037
     C           ATYP      IFEQ 'R'                        ** B005                            CGL037
     C           STYP      IFEQ 'V'                        ** B006                            CGL037
     C           STYP      OREQ 'I'                                                           CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE ' 013'    ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E006                            CGL037
     C                     ELSE                            ** X005                            CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE ' 013'    ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E005                            CGL037
     C                     ELSE                            ** X004                            CGL037
      *                                                                                       CGL037
      ** If indicator U5 is ON, then Account Type should not be                               CGL037
      ** 'R'. If it is 'R', Account Subtype must be 'V' or 'I'.                               CGL037
      *                                                                                       CGL037
     C           ATYP      IFEQ 'R'                        ** B005                            CGL037
     C           STYP      IFNE 'V'                        ** B006                            CGL037
     C           STYP      ANDNE'I'                                                           CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE ' 014'    ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E006                            CGL037
     C                     END                             ** E005                            CGL037
     C                     END                             ** E004                            CGL037
      *                                                                                       CGL037
     C                     ELSE                                                               CGL037
      *                                                                                       CGL037
     C           ATYP      IFEQ 'R'                        ** B004                            CGL037
     C                     SETON                     14                                       CGL037
     C                     ELSE                                                               CGL037
     C           ATYP      IFEQ 'N'                        ** B005                            CGL037
     C           ATYP      OREQ 'G'                                                           CGL037
     C           ATYP      OREQ 'D'                                                           CGL037
     C           ATYP      OREQ 'C'                                                           CGL037
     C                     SETOF                     14                                       CGL037
     C                     ELSE                            ** X005                            CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE '002'     ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E005                            CGL037
     C                     END                             ** E004                            CGL037
      *                                                                                       CGL037
     C                     END                             ** E004                            CGL037
      *                                                                                       CGL037
     C/COPY WNCPYSRC,GL4441C038
     C***********ATYP      IFEQ 'R'                        ** B004        LN1295
     C*                                                                   S01117
     C*   CHECK TO SEE IF USER IS AUTHORISED TO BRANCH ASSOCIATED WITH    S01117
     C****REQUESTED*RETAIL*ACCOUNT**********************************S01117LN1295
     C*   REQUESTED ACCOUNT                                               LN1295
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       LN1273
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM           KBRC                            S01117
     C***********          PARM *ZERO     ERRCOD                    S01117LN1295
     C                     PARM *ZERO     ERRCOD  10                      LN1295
     C*                                                                   S01117
     C           ERRCOD    IFNE 0                                         S01117
     C                     SETON                     505164               S01117
     C           ATYP      IFEQ 'R'                                       LN1295
     C                     MOVE ' 011'    ERCD,I                          S01117
     C                     ELSE                                           LN1295
     C                     MOVE ' 010'    ERCD,I                          LN1295
     C                     END                                            LN1295
     C                     ADD  1         I                               S01117
     C                     END                                            S01117
     C                     END                                            LN1273
     C*                                                                   LN1295
     C**  CHECK TYPE OF INPUT FROM RETURNED VALUE, IF NOSTRO CODE OR      LN1295
     C**  SHORTNAME OR RETAIL NO., BLANK OUT OTHER INPUT FIELDS           LN1295
     C*                                                                   LN1295
     C           P@TYPE    IFEQ '*NOSHNM'                  ** B003        LN1295
     C           P@TYPE    OREQ '*NOSTRO'                                 LN1295
     C           P@TYPE    OREQ '*RETAIL'                                 LN1295
     C                     MOVE *BLANKS   CURRY                           LN1295
     C                     MOVE *BLANKS   ACCOD                           LN1295
     C                     MOVE *BLANKS   ACSEQ                           LN1295
     C                     MOVE *BLANKS   BRNCH                           LN1295
     C                     END                             ** E003        LN1295
     C*                                                                   LN1295
     C*                                                                   S01117
     C           ATYP      IFEQ 'R'                                       LN1295
     C                     SETON                     14
     C                     ELSE
     C***********ATYP      IFEQ 'N'                        ** B005        E19970
     C           ATYP      IFEQ 'N'                        ** B005        E20538
     C           ATYP      OREQ 'G'                                       E20538
     C/COPY WNCPYSRC,GL4441C027
     C           ATYP      OREQ 'D'                                       E20538
     C           ATYP      OREQ 'C'                                       E20538
     C                     SETOF                     14
     C                     ELSE                            ** X005        E20538
     C/COPY WNCPYSRC,GL4441C028
     C                     SETON                     505164               E20538
     C                     MOVE '002'     ERCD,I                          E20538
     C                     ADD  1         I                               E20538
     C/COPY WNCPYSRC,GL4441C029
     C                     END                             ** E005        E20538
     C**************       ELSE                            ** X005        E19970
     C**************       SETON                     505164               E19970
     C**************       MOVE '002'     ERCD,I                          E19970
     C**************       ADD  1         I                               E19970
     C**************       END                             ** E005        E19970
     C                     END                             ** E004
     C/COPY WNCPYSRC,GL4441C033
     C*
     C                     END                             ** E003
     C*
     C                     END                             ** E002
     C*
     C                     END                             ** E001
     C/COPY WNCPYSRC,GL4441C023
     C*
     C* IF POSTING-DATE FIELD HAS CHANGED...
     C*
     C           *IN61     IFEQ '1'                        ** B001
     C*
     C* ...VALIDATE PDAT --- BLANK=>VALID / NON-BLANK: FORMAT?, <RUND?
     C*
     C           POSDA     IFNE *BLANKS                    ** B002
     C*
     C* VALIDATE FORMAT USING MIDAS STANDARD SUBROUTINE
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE POSDA     ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD6         ZADIG
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        ** B003
     C                     MOVE ' 003'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5065
     C*
     C                     ELSE                            ** X003
     C*
     C                     MOVE ZFIELD    ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    POSDN   50
     C           *IN99     IFEQ '1'                        ** B004
     C                     MOVE ' 003'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5065
     C*
     C                     ELSE                            ** X004
     C*
     C* INVALID IF PDAT IS LATER THAN RUN-DATE
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP25                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
     C           CGL131    OREQ 'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
      *                                                                                       CGL131
     C*                                                                   S01408
     C           POSDN     IFGT RNDT                       ** B005
     C                     MOVE ' 003'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5065
     C                     END                             ** E005
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP26                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C                     END                             ** E004
     C*
     C                     END                             ** E003
     C*
     C                     ELSE                            ** X002
     C*
     C* IF POSTING DATE IS BLANKS THEN RESET TO ZERO
     C*
     C***********          Z-ADD0         POSDN                           E21183
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP27                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
     C           CGL131    OREQ 'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
      *                                                                                       CGL131
     C*                                                                   S01408
     C**********           Z-ADDLSTD      POSDN                                        E21183 209031
     C                     Z-ADD0         POSDN                                               209031
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP28                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     Z-ADD99999     POSDN                                               CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C********** CFSB      IFNE 0                                                      049240 209031
     C********** LSTP      ORNE 0                                                      049240 209031
     C********** DACO      ORNE LSTD                                                   049240 209031
     C********** LSTD      ADD  1         POSDN                                        049240 209031
     C**********           END                                                         049240 209031
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP42                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     Z-ADD99999     POSDN                                               CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C                     END                             ** E002
     C*
     C                     END                             ** E001
     C*
     C* IF + OR - (PORM) FIELD HAS CHANGED
     C*
     C           *IN62     IFEQ '1'                        ** B001
     C*
     C/COPY WNCPYSRC,GL4441C009
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
      *                                                                                       CGL131
     C           PORM      IFNE '+'                                                           CGL131
     C           PORM      ANDNE'-'                                                           CGL131
     C           PORM      ANDNE' '                        ** B002                            CGL131
     C           PORM      ANDNE'%'                                                           CGL131
     C                     MOVE ' 004'    ERCD,I                                              CGL131
     C                     ADD  1         I                                                   CGL131
     C                     SETON                     5066                                     CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C           PORM      IFNE '+'
     C           PORM      ANDNE'-'
     C           PORM      ANDNE' '                        ** B002
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP29                                           S01408
     C*                                                                   S01408
     C                     MOVE ' 004'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5066
     C                     END                             ** E002
     C/COPY WNCPYSRC,GL4441C010
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*
     C                     END
     C*                                                    ** E001
     C*
     C* IF AMOUNT FIELD HAS CHANGED
     C*
     C           *IN63     IFEQ '1'                        ** B001
     C           *IN60     OREQ '1'                                       E20463
     C*
     C* ACCESS CCY FILE FOR NO. OF DPS OF CURRENCY
     C*
     C                     CALL 'AOCURRR0'
     C                     PARM           P@RTCD  7
     C                     PARM '*KEY'    P@OPTN  7
     C                     PARM KCCY      P@KEY2
     C***********          PARM           P@FMT3                                              CSD006
     C           P@FMT3    PARM P@FMT3    DSSDY                                               CSD006
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE AMONT     ZFIELD
     C/COPY WNCPYSRC,GL4441C030
     C                     Z-ADDA6NBDP    ZADEC
     C           13        SUB  A6NBDP    ZADIG
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'                        ** B002
     C                     MOVE ' 006'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5067
     C                     ELSE                            ** X002
     C                     MOVE ZFIELD    AMTNUM 130
     C                     END                             ** E002
     C*
     C                     END                             ** E001
     C*
     C* IF + OR - ENTERD, BUT AMOUNT IS BLANK...INVALID
     C*
     C           PORM      IFEQ '+'
     C           PORM      OREQ '-'                        ** B001
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP30                                           S01408
      *                                                                                       CGL131
     C           PORM      OREQ '%'                                                           CGL131
     C           CGL131    ANDEQ'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C           AMTNUM    IFEQ *ZEROS                     ** B002
     C                     MOVE ' 005'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     506667
     C                     END                             ** E002
     C*
     C                     END                             ** E001
     C*
     C* IF CHEQUE NUMBER <> BLANK
     C           *IN41     IFEQ '0'                                       165546
     C*
     C           CQNMR     IFEQ *BLANKS
     C                     Z-ADD0         CQKEY
     C                     ELSE
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CQNMR     ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD8         ZADIG
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    CQKEY   80
     C           *IN99     IFEQ '1'
     C                     MOVE ' 007'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5068
     C                     END
     C           ATYP      IFNE 'R'
     C/COPY WNCPYSRC,GL4441C031
     C                     MOVE ' 008'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5068
     C                     END
     C           AMTNUM    IFNE *ZEROS
     C                     MOVE ' 009'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5068
     C                     END
     C*
     C                     END
     C                     END                                            165546
     C*                                                                   165546
     C* IF PROFIT CENTRE <> BLANK                                         165546
     C*                                                                   165546
     C           *IN41     IFEQ '1'                                       165546
     C           PCAMR     IFEQ *BLANKS                                   165546
     C                     MOVE *BLANK    PCKEY                           165546
     C                     ELSE                                           165546
     C                     MOVE PCAMR     PCKEY                           184727
     C           AMTNUM    IFNE *ZEROS                                    165546
     C                     MOVE ' 012'    ERCD,I                          165546
     C                     ADD  1         I                               165546
     C                     SETON                     5068                 165546
     C                     END                                            165546
     C*                                                                   165546
     C                     END                                            165546
     C                     END                                            165546
     C*                                                                   165546
     C*
     C/COPY WNCPYSRC,GLH00594
     C                     ENDSR                           ** VALID **
     C*
      /TITLE         <<< UNALOC SR. >>>
     C*****************************************************************
     C*
     C* UNALOC --- SUBROUTINE TO CHECK IF UNALLOCATED NOSTRO ENTERED
     C*
     C*
     C* CALLED FROM: VALID
     C*
     C* CALLS:  NOTHING
     C*
     C*****************************************************************
     C*
     C           UNALOC    BEGSR                           ** UNALOC **
     C*
     C           KPRNOA    IFEQ '00'
     C           KPREST    ANDEQ*BLANK
     C           KEYPRN    CHAINPRONO                99
     C*
     C           *IN99     IFEQ '0'
     C                     SETON                     15
     C                     MOVE *BLANK    P@RTCD
     C                     MOVE 'N'       ATYP
     C**********           Z-ADD0         KCUS                                                CSD027
     C                     MOVE *BLANKS   KCUS                                                CSD027
     C                     Z-ADD0         KCOD
     C                     Z-ADD0         KASE
     C                     MOVE KPRCCY    KCCY
     C                     END
     C                     END
     C*
     C                     ENDSR                           ** UNALOC **
     C*
      /TITLE         <<< ROLP SR. >>>
     C*****************************************************************
     C*
     C* ROLP --- SUBROUTINE FOR ROLLUP
     C*
     C* 1. IF END OF SUBFILE GET MORE RECORDS AND SET-UP NEXT PAGE
     C* 2. IF NOT END OF SUBFILE, ROLL-UP WILL BE HANDLED BY CPF
     C*
     C* CALLED FROM: MAIN PROCESSING
     C*
     C* CALLS: FLDCHG, RSTOR, BSFIL1, BSFIL2
     C*
     C*****************************************************************
     C*
     C           ROLP      BEGSR                           ** ROLP **
     C*
     C                     SETOF                     21
     C*
     C                     EXSR FLDCHG
     C*
     C           *IN12     IFEQ '1'                        ** B001
     C                     EXSR RSTOR
     C                     END                             ** E001
     C*
     C************         Z-ADDRRN       DSPREC                          047515
     C           *IN41     IFEQ '0'                                       165546
     C*
     C           CQKEY     IFEQ *ZEROS                     ** B001
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP31                                           S01408
      *                                                                                       CGL131
      ** Conditioning of CQKEY should be after CGL131 so place end here                       CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
     C           CGL131    OREQ 'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
      *                                                                                       CGL131
      ** Now condition CQKEY                                                                  CGL131
      *                                                                                       CGL131
     C           CQKEY     IFEQ *ZEROS                                                        CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C                     EXSR BSFIL1
     C/COPY WNCPYSRC,GL4441C018
     C*
     C                     ELSE                            ** X001
     C*
     C                     EXSR BSFIL2
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP32                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C           AMONT     IFEQ *BLANKS                                                       CGL131
      *                                                                                       CGL131
     C                     EXSR BSFIL1                                                        CGL131
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     EXSR BSFIL3                                                        CGL131
      *                                                                                       CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C                     END                             ** E001
     C                     ENDIF                                          165546
     C           *IN41     IFEQ '1'                                       165546
     C           PCKEY     IFEQ *BLANK                     ** B001        165546
     C                     EXSR BSFIL1                                    165546
     C                     ELSE                            ** X001        165546
     C                     EXSR BSFIL2                                    165546
     C                     END                             ** E001        165546
     C                     ENDIF                                          165546
      *                                                                   047515
      **  IF NO RECORDS SELECTED FOR DISPLAY ON NEW PAGE                  047515
      **  SET DSPREC TO RRN - 1                                           047515
      *                                                                   047515
     C           *IN81     IFEQ '1'                                       047515
     C           COUNT     ANDEQ0                                         047515
     C           RRN       SUB  1         DSPREC                          047515
     C                     END                                            047515
     C*
     C                     ENDSR                           ** ROLP **
     C*
      /TITLE         <<< BSFIL1 SR. >>>
     C*****************************************************************
     C*
     C* BSFIL1 --- BUILD SUBFILE WITH RECORDS FROM APOSTL1
     C*
     C* 1. SETLL ACCORDING TO WHETHER + OR -, AND WHETHER START
     C*    FROM FIRST RECORD (IN20) REQUESTED OR NOT
     C* 2. BUILD SUBFILE PAGE
     C* 3. SET-UP OUTPUT SCREEN DETAILS
     C*
     C* CALLED FROM: ENTR, ROLP, CMD5
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           BSFIL1    BEGSR                           ** BSFIL1 **
     C*
     C*
     C                     Z-ADDRRN       DSPREC
     C                     Z-ADD0         COUNT   30
     C*
     C           COUNT     DOWLT4                          ** B001
     C           *IN80     ANDEQ'0'                                       047515
     C                     SETOF                     81
     C/COPY WNCPYSRC,GL4441C011
     C*
     C           *IN80     IFEQ '0'                        ** B002
     C           AMTNUM    IFGT 0                          ** B003
     C*                                                                   163504
     C** Post amount less or equal to selected amount                     163504
     C*                                                                   163504
     C           PORM      IFEQ '-'                        ** B004
     C*                                                                   163504
     C           PSTA      IFLE AMTNUM                     ** B005
     C                     SETOF                     81
     C                     ELSE                            ** X005
     C                     SETON                     81
     C                     END                             ** E005
     C*                                                                   163504
     C                     ELSE                            ** X004
     C*                                                                   163504
     C** Post amount greater or equal to selected amount                  163504
     C*                                                                   163504
     C           PORM      IFEQ '+'                                       163504
     C*                                                                   163504
     C           PSTA      IFGE AMTNUM                     ** B005
     C                     SETOF                     81
     C                     ELSE                            ** X005
     C                     SETON                     81
     C                     END                             ** E005
     C*                                                                   163504
     C** Post amount equal to selected amount                             163504
     C*                                                                   163504
     C                     ELSE                                           163504
     C*                                                                   163504
     C           PSTA      IFEQ AMTNUM                                    163504
     C                     SETOF                     81                   163504
     C                     ELSE                                           163504
     C                     SETON                     81                   163504
     C                     END                                            163504
     C*                                                                   163504
     C                     END                                            163504
     C*
     C                     END                             ** E004
     C                     END                             ** E003
     C                     END                             ** E002
     C*
     C           *IN80     IFEQ '0'                        ** B002
     C           *IN81     ANDEQ'0'
     C/COPY WNCPYSRC,GL4441C019
     C                     EXSR WRTSUB
     C                     ADD  1         COUNT
     C                     END                             ** E002
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP33                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
     C           CGL131    OREQ 'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
      *                                                                                       CGL131
     C*                                                                   S01408
     C           KEYEQ     READEAPOSTL1                  80
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP34                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C           TODAY     IFEQ '1'                                                           CGL131
     C           KEYEQ     READERSACMTLD                 80                                   CGL131
     C                     MOVELFORMA5    FORMAT 10                                           CGL131
      ** IF EOF ON TODAY'S POSTING                                                            CGL131
     C           *IN80     IFEQ *ON                                                           CGL131
     C                     MOVE RNDT      POSDN                                               CGL131
     C           KEYSL1    SETLLAPOSTL38                                                      CGL131
     C                     MOVE '2'       TODAY                                               CGL131
     C                     MOVE *OFF      *IN80                                               CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           TODAY     IFEQ '2'                                                           CGL131
     C           KEYEQ     READEAPOSTL38                 80                                   CGL131
     C                     MOVELFORMA1    FORMAT                                              CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C           *IN80     IFEQ '1'                        ** B002
     C/COPY WNCPYSRC,GL4441C020
     C                     SETON                     04
     C***********          Z-ADD5         COUNT                           047515
     C                     END                             ** E002
     C/COPY WNCPYSRC,GL4441C021
     C*
     C                     END                             ** E001
     C*
     C                     ENDSR                           ** BSFIL1 **
     C*
      /TITLE         <<< BSFIL2 SR. >>>
     C*****************************************************************
     C*
     C*******BSFIL2 --- BUILD SUBFILE WITH RECORDS FROM APOSTL2           165546
     C* BSFIL2 --- BUILD SUBFILE WITH RECORDS FROM APOSTL2 OR APOSTL9     165546
     C*
     C* 1. SETLL
     C* 2. BUILD SUBFILE PAGE
     C* 3. SET-UP OUTPUT SCREEN DETAILS
     C*
     C* CALLED FROM: ENTR, ROLP, CMD5
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           BSFIL2    BEGSR                           ** BSFIL2 **
     C*
     C*
     C                     Z-ADDRRN       DSPREC
     C                     Z-ADD0         COUNT   30
     C*
     C           COUNT     DOWLT4                          ** B001
     C           *IN80     ANDEQ'0'                                       047515
     C/COPY WNCPYSRC,GL4441C022
     C                     SETOF                     81
     C*
     C           *IN80     IFEQ '0'                        ** B002
     C           *IN41     IFEQ '0'                        ** B003        165546
     C           CHQN      IFGE CQKEY                      ** B003
     C                     SETOF                     81
     C                     ELSE                            ** X005
     C                     SETON                     81
     C                     END                             ** E003
     C                     ENDIF                           ** E003        165546
     C           *IN41     IFEQ '1'                        ** B003        165546
     C           PRFC      IFGE PCKEY                      ** B003        165546
     C                     SETOF                     81                   165546
     C                     ELSE                            ** X005        165546
     C                     SETON                     81                   165546
     C                     END                             ** E003        165546
     C                     ENDIF                           ** E003        165546
     C/COPY WNCPYSRC,GL4441C012
     C                     END                             ** E002
     C*
     C           *IN80     IFEQ '0'                        ** B002
     C           *IN81     ANDEQ'0'
     C                     EXSR WRTSUB
     C                     ADD  1         COUNT
     C                     END                             ** E002
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP35                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
     C           CGL131    OREQ 'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
      *                                                                                       CGL131
     C*                                                                   S01408
     C*********  KEYEQ     READEAPOSTL2                  80               165546
     C  N41      KEYEQ     READEAPOSTL2                  80               165546
     C   41      KEYEQ     READEAPOSTL9                  80               165546
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP36                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C           TODAY     IFEQ '1'                                                           CGL131
     C           KEYEQ     READERSACMTLB                 80                                   CGL131
     C                     MOVELFORMA6    FORMAT 10                                           CGL131
      *                                                                                       CGL131
      ** IF EOF ON TODAY'S POSTING                                                            CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ *ON                                                           CGL131
     C                     MOVE RNDT      POSDN                                               CGL131
     C           KEYSL2    SETLLAPOSTL2                                                       CGL131
     C                     MOVE '2'       TODAY                                               CGL131
     C                     MOVE *OFF      *IN80                                               CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           TODAY     IFEQ '2'                                                           CGL131
     C           KEYEQ     READEAPOSTL2                  80                                   CGL131
     C                     MOVELFORMA2    FORMAT                                              CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C           *IN80     IFEQ '1'                        ** B002
     C                     SETON                     04
     C***********          Z-ADD5         COUNT                           047515
     C                     END                             ** E002
     C*
     C                     END                             ** E001
     C*
     C                     ENDSR                           ** BSFIL2 **
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP37                                           S01408
      *****************************************************************                       CGL131
      /TITLE         <<< BSFIL3 SR. >>>                                                       CGL131
      *****************************************************************                       CGL131
      *                                                                                       CGL131
      ** BSFIL3 --- BUILD SUBFILE WITH RECORDS FROM APOSTL39                                  CGL131
      *                                                                                       CGL131
      ** 1. SETLL ACCORDING TO WHETHER + OR -, AND WHETHER START                              CGL131
      **    FROM FIRST RECORD (IN20) REQUESTED OR NOT                                         CGL131
      ** 2. BUILD SUBFILE PAGE                                                                CGL131
      ** 3. SET-UP OUTPUT SCREEN DETAILS                                                      CGL131
      *                                                                                       CGL131
      ** CALLED FROM: ROLP                                                                    CGL131
      *                                                                                       CGL131
      ** CALLS: NOTHING                                                                       CGL131
      *                                                                                       CGL131
      *****************************************************************                       CGL131
      *                                                                                       CGL131
     C           BSFIL3    BEGSR                                                              CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
      *                                                                                       CGL131
     C                     Z-ADDRRN       DSPREC                                              CGL131
     C                     Z-ADD0         COUNT   30                                          CGL131
      *                                                                                       CGL131
     C           COUNT     DOWLT4                                                             CGL131
     C                     SETOF                     81                                       CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ '0'                                                           CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '-'                                                           CGL131
      *                                                                                       CGL131
     C           PSTA      IFLE AMTNUM                                                        CGL131
     C           PSTD      ANDLEPOSDN                                                         CGL131
     C                     SETOF                     81                                       CGL131
     C                     ELSE                                                               CGL131
     C                     SETON                     81                                       CGL131
     C                     END                                                                CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '+'                                                           CGL131
     C           PORM      OREQ ' '                                                           CGL131
     C           PSTA      IFGE AMTNUM                                                        CGL131
     C           PSTD      ANDLEPOSDN                                                         CGL131
     C                     SETOF                     81                                       CGL131
     C                     ELSE                                                               CGL131
     C                     SETON                     81                                       CGL131
     C                     END                                                                CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '%'                                                           CGL131
     C           PSTA      IFLE AMTKYG                                                        CGL131
     C           PSTD      ANDLEPOSDN                                                         CGL131
     C                     SETOF                     81                                       CGL131
     C                     ELSE                                                               CGL131
     C                     SETON                     81                                       CGL131
     C                     END                                                                CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ '0'                                                           CGL131
     C           *IN81     ANDEQ'0'                                                           CGL131
     C                     EXSR WRTSUB                                                        CGL131
     C                     ADD  1         COUNT                                               CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           TODAY     IFEQ '1'                                                           CGL131
     C           KEYEQ     READERSACMTLC                 80                                   CGL131
     C                     MOVELFORMA7    FORMAT 10                                           CGL131
      *                                                                                       CGL131
      ** IF EOF ON TODAY'S POSTING                                                            CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ *ON                                                           CGL131
     C           KEYSL3    SETLLAPOSTL39                                                      CGL131
     C                     MOVE '2'       TODAY                                               CGL131
     C                     MOVE *OFF      *IN80                                               CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           TODAY     IFEQ '2'                                                           CGL131
     C           KEYEQ     READEAPOSTL39                 80                                   CGL131
     C                     MOVELFORMA3    FORMAT                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ '1'                                                           CGL131
      *                                                                                       CGL131
     C           COUNT     IFEQ 0                                                             CGL131
     C                     SUB  1         DSPREC                                              CGL131
     C           DSPREC    IFLE 0                                                             CGL131
     C                     Z-ADD1         DSPREC                                              CGL131
     C                     END                                                                CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     SETON                     04                                       CGL131
     C                     Z-ADD5         COUNT                                               CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDSR                                                              CGL131
      *                                                                                       CGL131
     C*****************************************************************                       CGL131
      /EJECT                                                                                  CGL131
      *****************************************************************                       CGL131
     C*                                                                   S01408
      /TITLE         <<< STORE SR. >>>
     C*****************************************************************
     C*
     C* STORE --- STORE I/P FIELDS IN 'SAVE' FIELDS
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           STORE     BEGSR                           ** STORE **
     C*
     C           MBIN      IFEQ 'Y'                                       S01117
     C**********           MOVE MBACNT    MBACSV 22                                    S01117 CGL029
     C                     MOVE MBACNT    MBACSV 28                                           CGL029
     C                     ELSE                                           S01117
     C**********           MOVE ACNT      ACSV   19                                           CGL029
     C                     MOVE ACNT      ACSV   25                                           CGL029
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE POSDA     PDSV    6
     C                     MOVE PORM      POSV    1
     C                     MOVE AMONT     AMSV   14
     C************         MOVE CQNMR     CHSV    8                       165546
     C  N41                MOVE CQNMR     CHSV    8                       165546
     C   41                MOVE PCAMR     PCSV    4                       165546
     C*
     C                     ENDSR                           ** STORE **
     C*
      /TITLE         <<< RSTOR SR. >>>
     C*****************************************************************
     C*
     C* RSTOR --- RESTORE I/P FIELDS FROM 'SAVE' FIELDS
     C*
     C           RSTOR     BEGSR                           ** RSTOR **
     C*
     C           MBIN      IFEQ 'Y'                                       S01117
     C**********           MOVE MBACSV    MBACNT 22                                    S01117 CGL029
     C                     MOVE MBACSV    MBACNT                                              CGL029
     C                     ELSE                                           S01117
     C**********           MOVE ACSV      ACNT   19                                    S01117 CGL029
     C                     MOVE ACSV      ACNT                                                CGL029
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE PDSV      POSDA
     C                     MOVE POSV      PORM
     C                     MOVE AMSV      AMONT
     C**********           MOVE CHSV      CQNMR                           165546
     C  N41                MOVE CHSV      CQNMR                           165546
     C   41                MOVE PCSV      PCAMR                           165546
     C*
     C                     ENDSR                           ** RSTOR **
     C*
      /TITLE         <<< WRTSUB SR. >>>
     C*****************************************************************
     C*
     C* WRTSUB --- WRITE RECORD TO SUBFILE
     C*
     C* 1. FORMATS OUTPUT FIELDS VIA STANDARD SUBROUTINES
     C* 2. WRITES RECORD TO SUBFILE
     C*
     C* CALLED FROM: BSFIL1, BSFIL2
     C*
     C* CALLS: ZDATE2, ZFRPED (STANDARD S/RS)
     C*
     C*****************************************************************
     C*
     C           WRTSUB    BEGSR                           ** WRTSUB **
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP38                                           S01408
      *                                                                                       CGL131
     C           PSTD      IFGE RNDT                                                          CGL131
     C           CGL131    ANDEQ'Y'                                                           CGL131
     C                     MOVEL' Today ' PSTDZ                                               CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    PSTDZ
     C                     MOVE ZADATE    PSTDZP                          165546
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP39                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C                     Z-ADDVALD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    VALDZ
     C                     MOVE ZADATE    VALDZP                          165546
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP40                                           S01408
      *                                                                                       CGL131
     C                     MOVELFORMAT    FORM6   6                                           CGL131
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C           PNAR      IFEQ *BLANKS                                                       CGL131
     C           FORM6     ANDEQ'RSACMT'                                                      CGL131
     C                     MOVELTRYP      Z9AA    9                                           CGL131
     C                     MOVE TNMR      Z9AA                                                CGL131
     C                     MOVELZ9AA      PNAR                                                CGL131
     C                     END                                                                CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           PNAR      IFEQ *BLANKS                                                       CGL131
     C                     MOVEL'NARR. NO'Z16A   16                                           CGL131
     C                     MOVE 'T AVAIL.'Z16A                                                CGL131
     C                     MOVELZ16A      PNAR                                                CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           PSTA      IFEQ 0                                                             CGL131
     C           CGL131    ANDEQ'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     MOVE *BLANKS   VALDZ                                               CGL131
     C                     MOVE *BLANKS   PSTDZ                                               CGL131
     C                     MOVE *BLANKS   PSTAZ                                               CGL131
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C           DRCR      IFEQ 1
     C           PSTA      MULT -1        PSTA
     C                     END
     C                     Z-ADDPSTA      ZFLD15
     C***********          Z-ADDA6DANB    ZDECS                           S01194
     C                     Z-ADDA6NBDP    ZDECS                           S01194
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    PSTAZ
     C                     MOVE ZOUT22    PSTAZP                          165546
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP41                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
      *                                                                   BHF677
      * Format Cheque Number for output where included                    BHF677
     C           *IN41     IFEQ '0'                                       165546
     C                     MOVELCHQN      @CHQN   8                       BHF677
     C           @CHQN     IFEQ '00000000'                                BHF677
     C                     MOVE *BLANKS   @CHQN                           BHF677
     C                     END                                            BHF677
     C                     ELSE                                           165546
     C                     MOVELPRFC      @PRFCP  4                       165546
     C                     END                                            165546
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CIRE                                           S01408
     C*                                                                   S01408
     C*
     C                     MOVE *BLANKS   ABTCH                                             MD024417
     C           *IN82     IFEQ '1'                                       S01472
     C/COPY WNCPYSRC,GL4441C024
     C*******              MOVELPNAR      PNARZ2                   S01472 107938
     C*********            MOVELSPOS      ABTCH2  2                S01472 165546
     C  N41                MOVELSPOS      ABTCH2  2                       165546
     C   41                MOVELSPOSP     ABTCH2  2                       165546
     C*                                                                   S01472
     C*  If the posting is not a batch posting, the first 2 characters    S01472
     C*     will be blank, so the batch number will be blank              S01472
     C*                                                                   S01472
     C                     MOVEL*BLANKS   PNARZ                                             MD024978
     C                     MOVEL*BLANKS   PNARZP                                            MD024978
     C           ABTCH2    IFEQ *BLANKS                                   S01472
     C/COPY WNCPYSRC,GL4441C025
     C******               MOVE *BLANKS   ABTCH   3                S01472 107938
     C                     MOVELPNAR      PNARZ                           107938
     C                     MOVELPNAR      PNARZP                          165546
     C                     MOVE TRAT      TRATZ                                               CRE098
     C                     MOVE TRAT      TRATZP                                              CRE098
     C                     ELSE                                           S01472
     C*******              MOVELSPOS      ABTCH                    S01472 107938
     C************         MOVELSPOS      ABTCH   3                107938 165546
     C  N41                MOVELSPOS      ABTCH   3                       165546
     C   41                MOVELSPOSP     ABTCH   3                       165546
     C                     MOVELPNAR      PNARZ2 26                       107938
     C                     MOVE *BLANKS   PNARZ                           107938
     C                     MOVE *BLANKS   PNARZP                          165546
     C                     MOVE ABTCH     PNARZ                           107938
     C                     MOVE ABTCH     PNARZP                          165546
     C                     MOVELPNARZ2    PNARZ                           107938
     C                     MOVELPNARZ2    PNARZP                          165546
     C                     MOVE TRAT      TRATZ                                               CRE098
     C                     MOVE TRAT      TRATZP                                              CRE098
     C                     END                                            S01472
     C/COPY WNCPYSRC,GL4441C026
     C*                                                                   S01472
     C********             MOVE ABTCH     PNARZ                    S01472 107938
     C                     ELSE                                           S01472
     C                     MOVE TRAT      TRATZ                                               CRE098
     C                     MOVE TRAT      TRATZP                                              CRE098
     C                     MOVELPNAR      PNARZ                           S01472
     C                     MOVELPNAR      PNARZP                          165546
     C                     END                                            S01472
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CCP1                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     WRITESFLRCDA                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C           *IN41     IFEQ '1'                                       165546
     C                     MOVELSFLDS2    SFLDS1                          165546
     C                     ENDIF                                          165546
     C*                                                                   S01408
     C                     WRITESFLRCD
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CCP2                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C                     ADD  1         RRN
     C                     SETON                     0283
     C*
     C                     ENDSR                           ** WRTSUB **
     C*
      /TITLE         <<< ACDETS SR. >>>
     C*****************************************************************
     C*
     C* ACDETS --- SET-UP STATIC DISPLAY DATA
     C*
     C* 1. FORMATS OUTPUT FIELDS VIA STANDARD SUBROUTINES
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: ZDATE2, ZFRPED
     C*
     C*****************************************************************
     C*
     C           ACDETS    BEGSR                           ** ACDETS **
     C*
     C           ATYP      IFEQ 'N'
     C****                 MOVE 'NOSTRO'  TYPE    6                       E20538
     C                     MOVE ACTP,1    TYPE   11                       E20538
     C                     ELSE
     C           ATYP      IFEQ 'R'                                       LN0130
     C****                 MOVE 'RETAIL'  TYPE                            E20538
     C                     MOVE ACTP,2    TYPE                            E20538
     C                     ELSE                                           LN0130
     C           ATYP      IFEQ 'G'                                       LN0130
     C**********           MOVE 'GL    '  TYPE                      LN0130E20538
     C                     MOVE ACTP,3    TYPE                            E20538
     C                     ELSE                                           LN0130
     C           ATYP      IFEQ 'D'                                       LN0130
     C**********           MOVE 'CUST  '  TYPE                      LN0130E20538
     C                     MOVE ACTP,4    TYPE                            E20538
     C                     ELSE                                           LN0130
     C                     MOVE ACTP,5    TYPE                            E20538
     C********** ATYP      IFEQ 'C'                                       LN0130
     C**********           MOVE 'CONT  '  TYPE                            LN0130
     C                     END
     C                     END                                            LN0130
     C                     END                                            LN0130
     C                     END                                            LN0130
     C*
     C           ACST      IFEQ 'C'
     C                     MOVE 'CLOSE'   STAT
     C                     ELSE
     C                     MOVE 'OPEN '   STAT
     C                     END
     C*
     C                     MOVE *BLANK    REDSP
     C********** *IN14     IFEQ '1'                                                           261693
     C/COPY WNCPYSRC,GL4441C032
     C                     EXSR REDETS
     C**********           END                                                                261693
     C*
     C                     Z-ADD1         I
     C                     MOVE *BLANK    STFQX
     C                     SETOF                     99
     C*
     C           STFQ      LOKUPFRQ,I                    99
     C*
     C           *IN99     IFEQ '1'
     C                     MOVEAFRQA,I    STFQX
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP43                                           S01408
     C*                                                                   S01408
     C                     END
     C**   IF STATEMENT FREQUENCY DOES NOT REQUIRE A DAY NUMBER           BHF448
     C**    SUPPRESS DAY NO. ON SCREEN                                    BHF448
     C           STFQ      IFEQ 'M'                                       BHF448
     C           STFQ      OREQ 'T'                                       BHF448
     C           STFQ      OREQ 'Q'                                       BHF448
     C           STFQ      OREQ 'X'                                       BHF448
     C           STFQ      OREQ 'Y'                                       BHF448
     C           STFQ      OREQ 'G'                                                           CGL184
     C           CGL184    ANDEQ'Y'                                                           CGL184
     C           STFQ      OREQ 'H'                                                           CGL184
     C           CGL184    ANDEQ'Y'                                                           CGL184
     C           STFQ      OREQ 'O'                                                           CGL184
     C           CGL184    ANDEQ'Y'                                                           CGL184
     C                     MOVE '0'       *IN26                           BHF448
     C                     ELSE                                           BHF448
     C                     MOVE '1'       *IN26                           BHF448
     C                     END                                            BHF448
     C*
     C                     SETOF                     30                                       120328
     C           STFQ      IFEQ 'E'                                                           120328
     C                     MOVE '1'       *IN30                                               120328
     C                     END                                                                120328
     C*
     C                     Z-ADDNSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    NXDT
     C*
     C                     Z-ADDLSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    LSD
     C*
     C                     Z-ADDCFSB      ZFLD15
     C***********          Z-ADDA6DANB    ZDECS                           S01194
     C                     Z-ADDA6NBDP    ZDECS                           S01194
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    LEB    22
     C*FIELD ODLN NEEDS TO BE ZEROIZED IN THE FOLLOWING WAY               E21497
     C           ODLN      IFEQ *ZEROS                                    E21497
     C                     Z-ADD*ZEROS    ODLN                            E21497
     C                     END                                            E21497
     C*
     C**************       Z-ADDODLN      ZFLD15                          E18761
     C**************       Z-ADDA6NBDP    ZDECS                           E18761
     C**************       MOVE 'A'       ZECODE                          E18761
     C**************       EXSR ZFRPED                                    E18761
     C**************       MOVE ZOUT22    OVLMT  22                       E18761
     C                     Z-ADDODLN      ZFLD15                          E18765
     C                     Z-ADD0         ZDECS                           E18765
     C                     MOVE 'A'       ZECODE                          E18765
     C                     EXSR ZFRPED                                    E18765
     C                     MOVE ZOUT22    OVLMT  22                       E18765
     C*
     C                     Z-ADDODED      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RVDAT
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP19                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
     C           CGL131    OREQ 'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
      *                                                                                       CGL131
     C*
     C                     Z-ADDCLBL      ZFLD15
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP20                                           S01408
      *                                                                                       CGL131
      *****************************************************************                       CGL131
      **      (1) Show the Cleared Balance from Last Night even if    *                       CGL131
      **          CGL131 is switched on.                              *                       CGL131
      **      (2) Adjust the Actual Ledger Balance to remove the      *                       CGL131
      **          affect of Funds Transfer Postings with a Value Date *                       CGL131
      **          greater than Today.                                 *                       CGL131
      *****************************************************************                       CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C********** VLGLAB    ANDEQ'Y'                                                MD021130 MD022437
      *                                                                                       CGL131
      ** Overdraft limit is held without decimal places - amend it                            CGL131
      ** to have decimal places to give overdraft limit                                       CGL131
      ** which can be added to cleared balance                                                CGL131
      *                                                                                       CGL131
     C           A6NBDP    IFEQ 1                                                             CGL131
     C********** ODLN      MULT 10        ODLNB  110                                   CGL131 263362
     C           ODLN      MULT 10        ODLNB  140                                          263362
     C                     ELSE                                                               CGL131
     C           A6NBDP    IFEQ 2                                                             CGL131
     C           ODLN      MULT 100       ODLNB                                               CGL131
     C                     ELSE                                                               CGL131
     C           A6NBDP    IFEQ 3                                                             CGL131
     C           ODLN      MULT 1000      ODLNB                                               CGL131
     C                     ELSE                                                               CGL131
     C           A6NBDP    IFEQ 0                                                             CGL131
     C                     Z-ADDODLN      ODLNB                                               CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
      ** Account Balance Check                                                                CGL131
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C********** VLGLAB    ANDEQ'Y'                                                MD021130 MD022437
     C           CAP207    IFEQ 'Y'                                                           CGL131
     C                     MOVE ACNO      PRTAC                                             MD044087
     C                     CALL 'RE001590'                                                    CGL131
     C**********           PARM           ACNO                                       CGL131 MD044087
     C                     PARM           PRTAC                                             MD044087
     C                     PARM           KCUS                                                CGL131
     C                     PARM           KCCY                                                CGL131
     C                     PARM           KCOD                                                CGL131
     C                     PARM           KASE                                                CGL131
     C                     PARM           KBRC                                                CGL131
     C                     PARM 'BAL ENQY'TRNTYP                                              CGL131
     C                     PARM           RUND                                                CGL131
     C                     PARM *ZEROS    PAMT                                                CGL131
     C                     PARM *BLANKS   PERR01                                              CGL131
     C                     PARM *BLANKS   PERR02                                              CGL131
     C                     PARM *ZEROS    PACTBA                                              CGL131
     C                     PARM *ZEROS    PAVLBA                                              CGL131
     C                     PARM *ZEROS    PFADAT                                              CGL131
     C                     PARM *ZEROS    PFABAL                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           PERR01    IFEQ *BLANKS                                                       CGL131
     C           CAP207    ANDEQ'Y'                                                           CGL131
      *                                                                                       CGL131
     C                     Z-ADDPAVLBA    ZFLD15                                              CGL131
     C                     Z-ADDA6NBDP    ZDECS                                               CGL131
     C                     MOVE 'A'       ZECODE                                              CGL131
     C                     EXSR ZFRPED                                                        CGL131
     C                     MOVE ZOUT22    DISPO                                               CGL131
      *                                                                                       CGL131
     C                     Z-ADDPACTBA    ZFLD15                                              CGL131
     C                     EXSR ZFRPED                                                        CGL131
     C                     MOVE ZOUT22    LDBLNA                                              CGL131
     C                     MOVE ZOUT22    CLBLNA                                              CGL131
      *                                                                                       CGL131
     C                     Z-ADDCLBL      ZFLD15                                           AR1096226
      *                                                                                    AR1096226
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
      ** If Retail Account, access MEMOS record for closing cleared                           CGL131
      ** balance to be used in the DISPO balance calculation                                  CGL131
      *                                                                                       CGL131
     C           ATYP      IFEQ 'R'                                                           CGL131
      *                                                                                       CGL131
     C           KEYML1    KLIST                                                              CGL131
     C                     KFLD           KCUS                                                CGL131
     C                     KFLD           KCCY                                                CGL131
     C                     KFLD           KCOD                                                CGL131
     C                     KFLD           KASE                                                CGL131
     C                     KFLD           KBRC                                                CGL131
     C           KEYML1    CHAINMEMOSL1              31                                       CGL131
     C           *IN31     IFEQ '1'                                                           CGL131
     C                     MOVEL'MEMOS'   DBFILE           *************                      CGL131
     C                     MOVE *BLANKS   DBKEY            * DB ERR 99 *                      CGL131
     C                     MOVELRRNM      DBKEY            *************                      CGL131
     C                     Z-ADD99        DBASE                                               CGL131
     C                     EXSR *PSSR                                                         CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C********** VLGLAB    ANDEQ'Y'                                                MD021130 MD022437
      *                                                                                       CGL131
      ** Build actuals                                                                        CGL131
      *                                                                                       CGL131
     C                     MOVEL*BLANKS   CLBLNA                                              CGL131
     C                     MOVEL*BLANKS   LDBLNA                                              CGL131
     C                     Z-ADDCLBLN     ZFLD15                                              CGL131
     C                     Z-ADDA6NBDP    ZDECS                                               CGL131
     C                     MOVE 'A'       ZECODE                                              CGL131
     C                     EXSR ZFRPED                                                        CGL131
     C                     MOVE ZOUT22    CLBLNA 22                                           CGL131
      *                                                                                       CGL131
     C           KEYRV0    KLIST                                                              CGL131
     C                     KFLD           KBRC                                                CGL131
     C                     KFLD           KCUS                                                CGL131
     C                     KFLD           KCCY                                                CGL131
     C                     KFLD           KCOD                                                CGL131
     C                     KFLD           KASE                                                CGL131
     C********** KEYRV0    CHAINRSACMTLD             31                              CGL131 MD020122
     C********** *IN31     DOWEQ*OFF                                                 CGL131 MD020122
     C********** VALD      IFGT RNDT                                                 CGL131 MD020122
     C********** TRYP      IFEQ 'IN'                                                 CGL131 MD020122
     C********** TRYP      OREQ 'OP'                                                 CGL131 MD020122
     C********** DRCR      IFEQ *ZERO                                                CGL131 MD020122
     C**********           SUB  PSTA      LDBLN                                      CGL131 MD020122
     C**********           ELSE                                                      CGL131 MD020122
     C**********           ADD  PSTA      LDBLN                                      CGL131 MD020122
     C**********           ENDIF                                                     CGL131 MD020122
     C**********           ENDIF                                                     CGL131 MD020122
     C**********           ENDIF                                                     CGL131 MD020122
     C********** KEYRV0    READERSACMTLD                 31                          CGL131 MD020122
     C**********           ENDDO                                                     CGL131 MD020122
      *                                                                                       CGL131
     C                     Z-ADDLDBLN     ZFLD15                                              CGL131
     C                     Z-ADDA6NBDP    ZDECS                                               CGL131
     C                     MOVE 'A'       ZECODE                                              CGL131
     C                     EXSR ZFRPED                                                        CGL131
     C                     MOVE ZOUT22    LDBLNA 22                                           CGL131
     C                     ENDIF                                                              CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C********** VLGLAB    ANDEQ'Y'                                                MD021130 MD022437
      *                                                                                       CGL131
     C                     Z-ADDCLBLN     CLRHLD 150                                          CGL131
     C                     Z-ADDCLBL      ZFLD15                                              CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     Z-ADDCLBL      CLRHLD                                              CGL131
     C                     Z-ADDCLBL      ZFLD15                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C***********          Z-ADDA6DANB    ZDECS                           S01194
     C                     Z-ADDA6NBDP    ZDECS                           S01194
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    STBCL  22
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4441CP21                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C********** VLGLAB    ANDEQ'Y'                                                MD021130 MD022437
     C                     MOVE *BLANKS   ACOF                                                CGL131
     C                     MOVE *BLANKS   DEPT                                                CGL131
      *                                                                                       CGL131
      ** Retrieve Account Officer using access object AOCUSTR0.                               CGL131
      *                                                                                       CGL131
     C                     CALL 'AOCUSTR0'                                                    CGL131
     C                     PARM *BLANKS   P@RTCD  7                                           CGL131
     C                     PARM '*KEY'    P@OPTN  7                                           CGL131
     C                     PARM KCUSA     P@KEY1 10                                           CGL131
     C                     PARM           P@ANY   7                                           CGL131
     C                     PARM           P@FMT2                                              CGL131
      *                                                                                       CGL131
     C           P@RTCD    IFNE *BLANK                                                        CGL131
     C                     MOVEL'SDCUSTPD'DBFILE                                              CGL131
     C                     MOVE *BLANKS   DBKEY                                               CGL131
     C                     MOVELKCUSA     DBKEY                                               CGL131
     C                     Z-ADD98        DBASE                                               CGL131
     C                     EXSR *PSSR                                                         CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
      ** Retrieve Account officer name and department.                                        CGL131
      *                                                                                       CGL131
     C           BBACOC    IFNE '  '                                                          CGL131
     C                     CALL 'AOACOFR0'                                                    CGL131
     C                     PARM '*MSG    'P@RTCD                                              CGL131
     C                     PARM '*KEY    'P@OPTN                                              CGL131
     C                     PARM BBACOC    P@ACOC  2                                           CGL131
     C           SDACOF    PARM SDACOF    DSSDY                                               CGL131
      *                                                                                       CGL131
     C           P@RTCD    IFNE *BLANKS                                                       CGL131
     C                     MOVEL'SDACOFPD'DBFILE                                              CGL131
     C                     MOVE *BLANKS   DBKEY                                               CGL131
     C                     MOVELBBACOC    DBKEY                                               CGL131
     C                     Z-ADD97        DBASE                                               CGL131
     C                     EXSR *PSSR                                                         CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     MOVE AZACON    ACOF                                                CGL131
     C                     MOVE AZDPCD    DEPT                                                CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           PERR01    IFNE *BLANKS                                                       CGL131
     C           CAP207    ANDEQ'Y'                                                         MD020020
     C           CAP207    OREQ 'N'                                                         MD020020
      *                                                                                       CGL131
      ** Calculate disposable balance as follows :                                            CGL131
      **  Cleared balance + o/d limit - all held items.                                       CGL131
      *                                                                                       CGL131
      ** Dispo balance = cleared balance + overdraft limit - held                             CGL131
      ** items (signs are reversed)                                                           CGL131
      *                                                                                       CGL131
     C                     Z-ADDCLRHLD    DSPBAL 150                                          CGL131
     C           RNDT      IFLT ODED                                                          CGL131
     C                     SUB  ODLNB     DSPBAL                                              CGL131
     C                     ENDIF                                                              CGL131
     C                     ADD  HELD      DSPBAL                                              CGL131
     C                     Z-ADDDSPBAL    ZFLD15                                              CGL131
     C                     Z-ADDA6NBDP    ZDECS                                               CGL131
     C                     MOVE 'A'       ZECODE                                              CGL131
     C                     EXSR ZFRPED                                                        CGL131
     C                     MOVE ZOUT22    DISPO                                               CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*
     C                     Z-ADDLDBL      ZFLD15
     C***********          Z-ADDA6DANB    ZDECS                           S01194
     C                     Z-ADDA6NBDP    ZDECS                           S01194
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    LEGER  22
      *                                                                   CFT004
      ** Format International Bank Account Numbers                        CFT004
      *                                                                   CFT004
     C                     MOVEL*BLANKS   SIBAN                           CFT004
     C           CFT004    IFEQ 'Y'                                       CFT004
     C           IBAN      ANDNE*BLANKS                                   CFT004
     C                     CALL 'AOIBANR3'                                CFT004
     C                     PARM *BLANKS   PRTCD   7                       CFT004
     C                     PARM IBAN      PIBAN  47                       CFT004
     C                     PARM *BLANKS   PIWITH 47                       CFT004
     C                     PARM *BLANKS   PINOBL 34                       CFT004
      *                                                                   CFT004
     C           PRTCD     IFEQ *BLANKS                                   CFT004
     C                     MOVE '1'       *IN06                           CFT004
     C                     MOVELPIWITH    SIBAN                           CFT004
     C                     ENDIF                                          CFT004
      *                                                                   CFT004
     C                     ENDIF                                          CFT004
     C/COPY WNCPYSRC,GL4441C002
     C*
     C                     ENDSR                           ** ACDETS **
     C*
      /TITLE         <<< REDETS SR. >>>
     C*****************************************************************
     C*
     C* REDETS --- SET-UP STATIC DISPLAY DATA  FOR RETAIL ACCOUNTS ONLY
     C*
     C* 1. FORMATS ACCOUNT STATUS FIELDS
     C*       EACH BIT POSITION OF THE FIELD RETB HAS THE
     C*       FOLLOWING STATUS FOR RETAIL ACCOUNTS ONLY;
     C*
     C*           BIT 1  -  REFER ALL DEBITS
     C*           BIT 2  -  REFER ALL CREDITS
     C*           BIT 3  -  BLOCK ALL DEBITS
     C*           BIT 4  -  BLOCK ALL CREDITS
     C*           BIT 5  -   (NOT USED)
     C*           BIT 6  -  BANKRUPTED/LIQUIDATED
     C*           BIT 7  -  BAD DEBT
     C*
     C* CALLED FROM: ACDETS
     C*
     C* CALLS:  NONE
     C*
     C*****************************************************************
     C*
     C           REDETS    BEGSR                           ** REDETS **
     C*
     C/COPY WNCPYSRC,GL4441C013
     C                     Z-ADD1         I
     C*
     C                     TESTB'0'       RETB           99
     C           *IN99     IFEQ '1'
     C                     MOVELREDS,1    RETT,I
     C                     ADD  1         I
     C                     END
     C*
     C                     TESTB'1'       RETB           99
     C           *IN99     IFEQ '1'
     C                     MOVELREDS,2    RETT,I
     C                     ADD  1         I
     C                     END
     C*
     C                     TESTB'2'       RETB           99
     C           *IN99     IFEQ '1'
     C                     MOVELREDS,3    RETT,I
     C                     ADD  1         I
     C                     END
     C*
     C                     TESTB'3'       RETB           99
     C           *IN99     IFEQ '1'
     C                     MOVELREDS,4    RETT,I
     C                     ADD  1         I
     C                     END
     C*
     C                     TESTB'4'       RETB           99
     C           *IN99     IFEQ '1'
     C                     MOVELREDS,5    RETT,I
     C                     ADD  1         I
     C                     END
     C*
     C                     TESTB'6'       RETB           99
     C           *IN99     IFEQ '1'
     C           ATYP      ANDEQ'R'                                                         261693
     C                     MOVELREDS,6    RETT,I
     C                     ADD  1         I
     C                     END
     C*
     C                     TESTB'7'       RETB           99
     C           *IN99     IFEQ '1'
     C           ATYP      ANDEQ'R'                                                         261693
     C                     MOVELREDS,7    RETT,I
     C                     ADD  1         I
     C                     END
     C*
     C                     ENDSR                           ** REDETS **
     C*
      /TITLE         <<< ZDATE1 SR. >>>
     C********************************************************************
     C**
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
     C**              CONVERT TO A NUMBER OF DAYS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE1    BEGSR                           ***  ZDATE1 ***
     C**
     C**   CLEAR DAY NUMBER.
     C                     Z-ADD0         ZDAYNO  50
     C**
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.
     C                     Z-ADDZDATE     ZDATE   60
     C**
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
     C                     MOVE ZDATE     ZYEAR   20
     C  N98                MOVELZDATE     ZDAY    20
     C   98                MOVELZDATE     ZMTH    20
     C                     MOVE ZDATE     ZWRK4   40
     C  N98                MOVELZWRK4     ZMTH
     C   98                MOVELZWRK4     ZDAY
     C**
     C**   ENSURE MONTH IS VALID.
     C           ZMTH      COMP 0                      9999
     C  N99      ZMTH      COMP 12                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR 30 DAY MONTHS.
     C           ZMTH      COMP 4                        90IF 90 ON, 30
     C  N90      ZMTH      COMP 6                        90DAY MONTH.
     C  N90      ZMTH      COMP 9                        90
     C  N90      ZMTH      COMP 11                       90
     C**
     C**   ENSURE DAY IS VALID.
     C           ZDAY      COMP 0                      9999
     C   90N99   ZDAY      COMP 30                   99
     C  N90N99   ZDAY      COMP 31                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.
     C           ZYEAR     ADD  28        ZYEAR
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10     91LEAP YR, 91 ON
     C           ZMTH      COMP 2                    93  92FEB., 92 ON
     C**                                                   PAST FEB, 93 ON
     C**   IF FEBUARY FURTHER VALIDATE DAY.
     C  N91 92   ZDAY      COMP 28                   99
     C   91 92   ZDAY      COMP 29                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
     C**
     C           ZDEND1    ENDSR                           ***  ZDEND1 ***
     C**
     C**
     C********************************************************************
      /TITLE         <<< ZALIGN SR. >>>
     C********************************************************************
     C**
     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
     C**
     C           ZALIGN    BEGSR                           *** ZALIGN ***
     C**
     C                     SETOF                     929399
     C**
     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
     C                     MOVEAZFIELD    ZA1
     C**
     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
     C                     Z-ADDZADIG     ZADIG   20
     C                     Z-ADDZADEC     ZADEC   10
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ' '       ZA2
     C                     MOVEAZA2       ZFIELD 16
     C                     Z-ADD0         ZX      20
     C                     Z-ADD0         ZY      20
     C**
     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
     C           ZADIG     ADD  ZADEC     ZZ      20
     C           ZZ        COMP 15                   99
     C   99                GOTO ZAEND
     C**
     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
     C           ZATAG1    TAG                             ** ZATAG1 TAG *
     C           ZX        ADD  1         ZX
     C**
     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
     C           ZA1,ZX    COMP '.'                      90
     C   90 93             SETON                     99
     C   99                GOTO ZAEND
     C**
     C**
     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'M'                      96
     C   96                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 9                    99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'T'                      97
     C   97                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 12                   99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
     C   96
     COR 97                MOVE ' '       ZA1,ZX
     C**
     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
     C           ZA1,ZX    COMP ' '                      91
     C   91 92             GOTO ZATAG2
     C**
     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
     C  N90N91   ZA1,ZX    COMP '0'                    99
     C  N90N91N99ZA1,ZX    COMP '9'                  99
     C   99                GOTO ZAEND                      NOT NUMERIC
     C**
     C**   STORE DIGITS IN ARRAY AND HOW MANY.
     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
     C  N90N91   ZY        ADD  1         ZY         92
     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
     C   90                Z-ADDZY        ZZ         93  93
     C**
     C           ZX        COMP 16                     94  CHECK IF ALL
     C   94                GOTO ZATAG1
     C**
     C           ZATAG2    TAG                             ** ZATAG2 TAG *
     C**
     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
     C   96      ZZ        ADD  6         ZZ
     C**
     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
     C   97      ZZ        ADD  3         ZZ
     C**
     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
     C   96 93
     COR 97 93   ZZ        DOWGTZY
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
     C   96N93             DO   6
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C   97N93             DO   3
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
     C  N93                Z-ADDZY        ZZ
     C**
     C**   CHECK FOR EMBEDDED BLANKS.
     C   91 92             MOVEAZA1,ZX    ZFIELD
     C   91 92   ZFIELD    COMP ' '                  9999
     C   99                GOTO ZAEND                      EMBEDDED BLANK
     C**
     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
     C           ZZ        COMP ZADIG                99
     C           ZY        SUB  ZZ        ZX
     C  N99      ZADEC     SUB  ZX        ZX           9995
     C   99                GOTO ZAEND
     C   95                GOTO ZATAG4                     NO TRAILING
     C**                                                   BLANKS.
     C**   FILL THE TRAILING BLANKS WITH ZEROS.
     C           ZY        ADD  ZX        ZZ
     C           ZATAG3    TAG                             ** ZATAG3 TAG *
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C           ZY        COMP ZZ                     94
     C   94                GOTO ZATAG3
     C**
     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
     C           ZATAG4    TAG                             ** ZATAG4 TAG *
     C                     MOVE '0'       ZA1
     C                     Z-ADD16        ZX
     C           ZATAG5    TAG                             ** ZATAG5 TAG *
     C           ZY        COMP 0                        94
     C   94                GOTO ZATAG6
     C                     MOVE ZA2,ZY    ZA1,ZX
     C           ZY        SUB  1         ZY
     C           ZX        SUB  1         ZX
     C                     GOTO ZATAG5
     C           ZATAG6    TAG                             ** ZATAG6 TAG *
     C**
     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
     C                     MOVEAZA1       ZFIELD
     C**
     C                     SETOF                     9697
     C**
     C           ZAEND     ENDSR                           * ZAEND ENDSR *
     C**
     C**
     C********************************************************************
      /TITLE         <<< ZFRPED SR. >>>
     C********************************************************************
     C**                                                                 *
     C** ZFRPED subroutine to insert a decimal point and sign into a     *
     C** numeric field and to blank out leading zeros (optionaly         *
     C** inserting commas).                                              *
     C**     Input fields:   ZFLD15 15/0                                 *
     C**                     ZDECS  1/0                                  *
     C**                     ZECODE 1/  ('A','C','J','L' or blank)       *
     C**                                ( Default is 'J')                *
     C**     Arrays:         ZS1    15/1/0                               *
     C**                     ZS2    22/1/                                *
     C**                                                                 *
     C**     Output fields:  ZOUT22 22                                   *
     C**     Output fields:  ZOUT25 25  (ALIGNED BY DECIMAL POINT)       *
     C**          (The last 2 characters will be '  ','CR',or '- ')      *
     C**
     C           ZFRPED    BEGSR                           **  ZFRPED   *
     C*
     C* Define/Clear fields
     C*
     C                     Z-ADDZFLD15    ZFLD15 150
     C                     Z-ADDZDECS     ZDECS   10
     C                     MOVE ZECODE    ZECODE  1
     C                     MOVE *BLANKS   ZOUT22 22
     C                     MOVE *BLANKS   ZOUT25 25
     C           ZECODE    IFEQ *BLANKS
     C                     MOVE 'J'       ZECODE
     C                     END
     C*
     C*       SET UP WORK FIELDS
     C*
     C                     Z-ADD0         ZS1
     C                     MOVE ' '       ZS2
     C*
     C                     Z-ADD15        Z1      20
     C                     Z-ADD20        Z2      20
     C*
     C           15        SUB  ZDECS     ZINTS   20
     C*
     C* Check if numeric field is negative
     C*
     C           ZFLD15    IFLT *ZEROS
     C           ZECODE    IFEQ 'A'
     C           ZECODE    OREQ 'C'
     C                     MOVEA'CR'      ZS2,21
     C                     ELSE
     C                     MOVE '-'       ZS2,21
     C                     END
     C                     Z-SUBZFLD15    ZFLD15
     C                     END
     C*
     C                     Z-ADDZFLD15    ZWRK15
     C*
     C*       CHECK TO SEE IF THERE ARE ANY DECIMAL PLACES
     C*
     C           ZDECS     CABEQ0         ZS10
     C*
     C*       SET UP DECIMALS
     C*
     C                     Z-ADD*ZEROS    ZCNT    10
     C           ZCNT      DOUEQZDECS
     C                     MOVE ZS1,Z1    ZS2,Z2
     C                     SUB  1         Z2
     C                     ADD  1         ZCNT
     C                     SUB  1         Z1
     C                     END
     C*
     C*       PUT IN DECIMAL PLACE
     C*
     C                     MOVE '.'       ZS2,Z2
     C                     SUB  1         Z2
     C*
     C           ZS10      TAG                             ** ZS10 TAG **
     C*
     C*       SET UP INTEGERS
     C*
     C                     Z-ADD*ZEROS    CNT3    10
     C           Z1        DOUEQ*ZEROS
     C                     MOVE ZS1,Z1    ZS2,Z2
     C                     SUB  1         Z1
     C                     SUB  1         Z2
     C*
     C* If edit code is 'J', insert a ',' before each group of three
     C* digits - not if beginning of array reached.
     C*
     C           Z2        IFGT *ZEROS
     C           ZECODE    ANDEQ'J'
     C           Z2        ORGT *ZEROS
     C           ZECODE    ANDEQ'A'
     C                     ADD  1         CNT3
     C           CNT3      IFEQ 3
     C                     MOVE ','       ZS2,Z2
     C                     SUB  1         Z2
     C                     Z-ADD*ZEROS    CNT3
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*       PUT IN LEADING BLANKS
     C*
     C                     Z-ADD1         Z2
     C           ZS2,Z2    DOWEQ'0'
     C           ZS2,Z2    OREQ ' '
     C           ZS2,Z2    OREQ ','
     C                     MOVE ' '       ZS2,Z2
     C                     ADD  1         Z2
     C           Z2        CABEQ23        ZS20
     C                     END
     C*
     C*       IF NO INTEGERS PUT IN LEADING ZERO
     C*
     C           ZS20      TAG                             ** ZS20 TAG **
     C*
     C           Z2        IFEQ 23
     C                     SUB  2         Z2
     C                     MOVE '0'       ZS2,Z2
     C                     ELSE
     C*
     C           ZS2,Z2    IFEQ '.'
     C                     SUB  1         Z2
     C                     MOVE '0'       ZS2,Z2
     C                     END
     C                     END
     C*
     C*       SET UP OUTPUT FIELD
     C*
     C                     MOVEAZS2       ZOUT22
     C*
     C           ZDECS     IFEQ 0
     C                     MOVE ZOUT22    ZOUT0
     C                     ELSE
     C**
     C           ZDECS     IFEQ 1
     C                     MOVE ZOUT22    ZOUT1
     C                     ELSE
     C**
     C           ZDECS     IFEQ 2
     C                     MOVE ZOUT22    ZOUT2
     C                     ELSE
     C**
     C                     MOVE ZOUT22    ZOUT3
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C*
     C*
      /TITLE         <<< ZDATE2 SR. >>>
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR LEAP YEAR WORK FIELD.
     C                     MOVE 'N'       ZLEAP   1
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50
     C           ZDAYN1    IFLT 0
     C                     GOTO ZDEND2
     C                     END
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    IFGE ZYDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG1
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C           ZWRK2     IFNE 0
     C           ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C                     END
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C           ZWRK2     IFEQ 0
     C           ZDAYN1    IFEQ 59
     C                     MOVE 'Y'       ZLEAP
     C                     END
     C           ZDAYN1    IFGE 59
     C           ZDAYN1    SUB  1         ZDAYN1
     C                     END
     C                     END
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    IFGE ZMDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG2
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C           ZLEAP     IFEQ 'Y'
     C           ZDAY      ADD  1         ZDAY
     C                     END
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C                     MOVELZDAY      ZWRK5   5
     C           ZDAY      IFLT 10
     C                     MOVEL' '       ZWRK5
     C                     END
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C**
     C**
     C*****************************************************************                     MD022437
      *                                                                                     MD022437
      * SRBALT - Set Start or Close balances text display                                   MD022437
      *                                                                                     MD022437
      *****************************************************************                     MD022437
     C           SRBALT    BEGSR                                                            MD022437
     C           VLGLAB    IFEQ 'Y'                                                         MD022437
     C                     MOVEL*ON       *IN53                                             MD022437
     C                     ELSE                                                             MD022437
     C                     MOVEL*OFF      *IN53                                             MD022437
     C                     ENDIF                                                            MD022437
     C                     ENDSR                                                            MD022437
      *****************************************************************                     MD022437
      /TITLE         <<< *PSSR SR. >>>
     C*****************************************************************
     C*
     C* *PSSR  --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS
     C*
     C* CALLED FROM: AFTER ABNORNAL OPERATION OCCURS
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           *PSSR     BEGSR                           ** *PSSR **
     C*
     C                     DUMP
     C*
     C                     ENDSR'*CANCL'                   ** *PSSR **
     C********************************************************************
      /TITLE         <<< ARRAY DATA >>>
      *                                                                   S01408
     O/COPY WNCPYSRC,GL4441OOP1                                           S01408
      *                                                                   S01408
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   FRQ  - STATEMENT FREQUENCY CODES
DWFSMTRBLAQXYZEKGHO                                                                  AR864876 CGL184
**   FRQA - STATEMENT FREQUENCY DESCRIPTION
DAILY
WEEKLY
FORTNIGHTLY
SEMI-MONTHLY
MONTHLY
TWO MONTHLY
6 DYS > MNTH
MNTHLY LST WD
MNTHLY LST DY
ACCRUAL DATE                     * Previously = MNTHLY ACCRL *            049240
QUARTERLY
SIX MONTHLY
YEARLY
ON REQUEST
                                                                                              CGL184
DAILY MOD                                                                                     CGL184
MONTHLY MOD                                                                                   CGL184
QUARTERLY MOD                                                                                 CGL184
YEARLY MOD                                                                                    CGL184
**   REDS - STATUS FOR RETAIL ACCOUNTS
REFER DEBITS
REFER CREDITS
BLOCK DEBITS
BLOCK CREDITS
INACTIVE
BANKRUPTED
BAD DEBT
**   EMSG - ERROR MESSAGE
No Postings To Display For This Selection
UNALLOCATED NOSTRO
**  CPY@
(c) Finastra International Limited 2001
**   ACTP  - ACCOUNT TYPE
NOSTRO     RETAIL     G/L ACCOUNTCUSTOMER   CONTINGENT                    E20538
