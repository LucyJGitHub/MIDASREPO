     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Acc Movmt to Start of Business')              *
      *****************************************************************
      *                                                               *
      *  Midas General Ledger Module                                  *
      *                                                               *
      *  GL4442 - Ledger movements - to start of business.            *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD053510           Date 07Nov19               *
      *  Prev Amend No. MD046592           Date 24Sep18               *
      *                 MD051859           Date 05Sep18               *
      *                 MD049386           Date 22Jan18               *
      *                 MD046248           Date 27Oct17               *
      *                 CGL186             Date 06Oct17               *
      *                 CGL183             Date 09Dec16               *
      *                 MD036055A          Date 21Oct15               *
      *                 MD034003           Date 14Jul15               *
      *                 243661             Date 13Mar15               *
      *                 MD025751           Date 21Mar14               *
      *                 CRE098             Date 02Dec13               *
      *                 AR1075388          Date 21Nov13               *
      *                 CGL145B            Date 01Oct13               *
      *                 MD021130           Date 25Jul13               *
      *                 MD020122           Date 20Apr13               *
      *                 AR1096350          Date 20Mar13               *
      *                 CGL131             Date 28Sep12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR873470           Date 30Nov11               *
      *                 CRE075             Date 06Dec10               *
      *                 AR747061           Date 20Apr11               *
      *                 AR745889           Date 16Apr11               *
      *                 CRE067             Date 05Oct10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG26687           Date 06Nov09               *
      *                 BUG24339           Date 17Jun09               *
      *                 BUG24143           Date 04Jun09               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP204             Date 27Jan10               *
      *                 BUG22329           Date 19Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 239964             Date 07Jun06               *
      *                 240903             Date 05Jul06               *
      *                 240079             Date 03Jun06               *
      *                 239966             Date 05Jun06               *
      *                 BUG11679           Date 05Jul06               *
      *                 CRE024             Date 07Oct05               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 11May06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG9014            Date 18Oct05               *
      *                 CGL037             Date 14Jul04               *
      *                 BUG4738            Date 04Mar05               *
      *                 CLE025             Date 20Oct03               *
      *                 CAAA03             Date 19Apr04               *
      *                 BUG1832            Date 14Apr04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01.03 ----------------------------------------*
      * Midas Release 4.01 -------------------------------------------*
      *                 202528             Date 06Feb02               *
      *                 194699             Date 11Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 11Oct00               *
      *                 180280             Date 09Mar01               *
      *                 183365             Date 09Oct00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 184727             Date 09Oct00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CAP136             Date 15Nov99               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CAP031             Date 24Jan00               *
      *                 163504             Date 21Oct99               *
      *                 165546             Date 06Aug99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 136277             DATE 30APR99               *
      *                 149619             DATE 16MAR99               *
      *                 124565             DATE 26FEB98               *
      *                 090525             DATE 20FEB98               *
      *                 107938             DATE 17FEB98               *
      *                 096486             DATE 04APR97               *
      *                 S01408             DATE 08OCT96               *
      *                 098693             DATE 23JUL96               *
      *                 S01408             DATE 13MAY96               *
      *                 S01408             DATE 21FEB96               *
      *                 093226             DATE 12OCT95               *
      *                 090574             DATE 04JUL95               *
      *                 093373             DATE 06OCT95               *
      *                 S01408             DATE 24JUL95               *
      *                 084332             DATE 02MAR95               *
      *                 081701             DATE 10MAR95               *
      *                 080994             DATE 10MAR95               *
      *                 S01408             DATE 03FEB95               *
      *                 S01408             DATE 13JAN95               *
      *                 072626             DATE 06OCT94               *
      *                 S01408             DATE 22AUG94               *
      *                 S01472             DATE 12MAR94               *
      *                 058799             DATE 18OCT93               *
      *                 058797             DATE 18OCT93               *
      *                 046902             DATE 06JUL93               *
      *                 S10736             DATE 03SEP92               *
      *                 E37456             DATE 02JUL92               *
      *                 E36720 (FUJ813)    DATE 31MAR92               *
      *                 E31803             DATE 13MAR92               *
      *                 LN1295             DATE 07JUN91               *
      *                 LN1274             DATE 22MAY91               *
      *                 LN1273             DATE 22MAY91               *
      *                 S01311             DATE 22MAY91               *
      *                 E21183             DATE 14MAY90               *
      *                 S01182             DATE 30MAR90               *
      *                 E20538             DATE 01APR90               *
      *                 BHF677             DATE 28SEP90               *
      *                 E20463             DATE 08MAY89               *
      *                 LN0130             DATE 08MAY90               *
      *                 E19970             DATE 14FEB90               *
      *                 E19563             DATE 14FEB90               *
      *                 S01117             DATE 21/06/89              *
      *                 S01199             DATE 20/06/89              *
      *                 S01194             DATE 13/03/89              *
      *                 E17471             DATE 31/03/89              *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  MD053510 - Missing today's A/C Movement Details              *
      *  MD046592 - Narrative is being truncated. Restore the length  *
      *             of the Narrative back to 30 characters.           *
      *           - Applied for MD-51749                              *
      *  MD051859 - Footer Menu Options are missing in HATS(Recompile)*
      *  MD049386 - Search does not return records when amount is     *
      *             populated                                         *
      *  MD046248 - Finastra Rebranding                               *
      *  CGL186 - Customer Report Name on Enquiries                   *
      *         - Add Cust Report Name to Account Movements & OSIC.   *
      *  CGL183 - User Access Audit of Account Enquiry functions      *
      *  MD036055A - Extend narrative to 30 characters                *
      *  MD034003 - Posting narrative was truncated in account        *
      *             movement enquiry                                  *
      *  243661 - Correct GL4441 dumps                                *
      *  MD025751 - 2nd page of Account Mvmnt display shows just one  *
      *             line and 3rd page also reflects this information  *
      *  CRE098 - User-Defined Retail Transaction Types on Postings   *
      *  AR1075388 - Account transfer fees - net (Child:AR1075389)    *
      *              Applied for MD-23536 (Recompile)                 *
      *  CGL145B - Subsidiaries Daily Sweeping Forecast               *
      *            Added hooks: CGL145_023, CGL145_024                *
      *  MD021130 -  Transactions presented are not correct; enquiry  *
      *             sequence of postings should be controlled by the  *
      *             system value as in the old client system          *
      *  MD020122 - Issues on Enquiry screens on account with forward *
      *             dated OPAY transaction                            *
      *  AR1096350 - Incorrect record number in SFLRCDNBR causing     *
      *              session device error if BSFIL1 is built twice    *
      *  CGL131 - Customer Account Balance Enquiry (with available    *
      *           balance)                                            *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR873470 - Apply fix 263647 (Child:AR873471)                 *
      *  263647 - Wrong batches displayed in GL0123E                  *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  AR747061 - Account Movements posting details not existing    *
      *             (Child: AR747062)                                 *
      *  AR745889 - Account Movements invalid option error for valid  *
      *             option(2) (Child: AR745890)                       *
      *  CRE067 - Midas Plus/Teller Interface via Bankfusion          *
      *           (Recompile)                                         *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG26687 - Enhancement of enquiries                          *
      *  BUG24339 - Extended Narrative fields are unavailable         *
      *  BUG24143 - Extended Narrative fields are unavailable         *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CAP204 - Retail Account Transfer                             *
      *  BUG22329 - Account Movement Enquiry not correct for Fee      *
      *             settlement. Applied fix 209031.                   *
      *  209031 - Show all the postings for the account when Posting  *
      *           Date is left blank.                                 *
      *  239964 - Applied fix 236093.                                 *
      *  240903 - Do not output DR against balance as it makes it     *
      *           difficult to identify balance and is inconsistent   *
      *           with other posting enquiries.  However still keep   *
      *           with intentions of 180280.                          *
      *  240079 - Applied fix 236093.                                 *
      *  239966 - Applied fix 236093.                                 *
      *  236093 - MidasPlus Webfacing screens hanging since webfacing *
      *           doesn't support TFRGRPJOB.                          *
      *  BUG11679 - Additional Conversion of Customer Number to Alpha *
      *  CRE024  -  Country Level Switchable Feature :                *
      *             Security Features for Restricted Accounts.        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG9014 - Ensure that facility details will be shown when    *
      *            the movement is facility fee. Applied fix 201716.  *
      *  CGL037 - Account Access Security                             *
      *  BUG4738- Display Ledger Balance C/F in webface screen.       *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CAAA03 - Webfacing Changes (recompile)                       *
      *  BUG1832- Projected Account Movements Enquiry Problems        *
      *           (Recompile)                                         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  202528 - Allow the system to view closed accounts in the     *
      *           Account movement enquiries.                         *
      *  194699 - Re-compile over changed Display File.               *
      *  CSD006 - Use correct parameters for Access Objects           *
      *  180280 - Correctly place appropriate DR/CR sign.             *
      *  183365 - Batch nos are not shown correctly.                  *
      *           SPOSP is not being filled on each read of APOST     *
      *  184727 - Line missing from fix 165546 after collection       *
      *  CAP136 - Conversion of FT Incoming Payment inputs into       *
      *           modular structure to use as APIs.                   *
      *  CAP031 - Conversion of FT inputs into modular structure to   *
      *           use as APIs.                                        *
      *  163504 - If both date and amount selected, selection should  *
      *           point to those postings with that amount. This is   *
      *           only the case when sign is left blank.              *
      *  165546  -  Changed to show profit centre if analytical       *
      *             accounting is switched on.                        *
      *  CGL007 - Account Postings Enquiry (Recompile)                *
      *  136277  -  Advise user of no details found when accessing    *
      *             reversed loans.                                   *
      *  149619  -  Recompile over changed DDS                        *
      *  124565  -  Allow user to enquire on movements: move ORTF     *
      *             (original trans. ref. from APOSTPD) into @HPREF   *
      *             in order to make the search consistent.           *
      *  090525  -  Reset CNUMR to blanks to avoid unnecessary        *
      *             characters coming from the current contents       *
      *             of *LDA dtaara to appear in the account no.       *
      *  107938  -  Narrative truncated by batch nbr (cfr S01472)     *
      *             Display complete narrative if not a batch         *
      *  096486  -  Previous fix (065890).                            *
      *             To enable user to enquire on FT Payments for FT   *
      *             postings.                                         *
      *  S01408 - Addition of Core Hook GL4442IIP2                    *
      *           Addition of Core Hook GL4442CP45                    *
      *           Addition of Core Hook GL4442CP44                    *
      *           Addition of Core Hook GL4442CP43                    *
      *           Addition of Core Hook GL4442CP42                    *
      *  098693  -  Impossible to review printed posting from EM      *
      *  S01408  -  Core hook GL4442FFP3 added.                       *
      *             Core hook GL4442FFP2 added.                       *
      *             Core hook GL4442H001 added.                       *
      *             Core hook GL4442H002 added.                       *
      *             Core hook GL4442CP41 added.                       *
      *             Core hook GL4442CP40 added.                       *
      *             Core hook GL4442CP39 added.                       *
      *             Core hook GL4442CP38 added.                       *
      *             Core hook GL4442CP37 added.                       *
      *             Core hook GL4442CP36 added.                       *
      *             Core hook GL4442CP35 added.                       *
      *             Core hook GL4442CP34 added.                       *
      *             Core hook GL4442CP33 added.                       *
      *             Core hook GL4442CP32 added.                       *
      *             Core hook GL4442CP31 added.                       *
      *             Core hook GL4442CP30 added.                       *
      *             Core hook GL4442CP29 added.                       *
      *             Core hook GL4442CP28 added.                       *
      *             Core hook GL4442CP27 added.                       *
      *             Core hook GL4442CP26 added.                       *
      *             Core hook GL4442CP25 added.                       *
      *             Core hook GL4442CP24 added.                       *
      *             Core hook GL4442CP23 added.                       *
      *             Core hook GL4442CP22 added.                       *
      *             Core hook GL4442CP21 added.                       *
      *             Core hook GL4442CP20 added.                       *
      *             Core hook GL4442CP19 added.                       *
      *             Core hook GL4442CP18 added.                       *
      *             Core hook GL4442CP17 added.                       *
      *             Core hook GL4442CP16 added.                       *
      *             Core hook GL4442CP15 added.                       *
      *  S01408  -  Core hook GL4442CP13 added.                       *
      *             Core hook GL4442CP14 added.                       *
      *  093226  -  S10472 not compatible with 084332, and the error  *
      *             no longer occurs - remove 084332 as no longer     *
      *             required.                                         *
      *  090574  -  Change length of @PNAR so that A/C no. is not     *
      *             truncated                                         *
      *  093373  -  Accrued Interest CR/DR wrong way round            *
      *  S01408  -  Core hook GL4442EEPG added.                       *
      *             Core hook GL4442EEP1 added.                       *
      *             Core hook GL4442IIP1 added.                       *
      *             Core hook GL4442CP11 added.                       *
      *             Core hook GL4442CP12 added.                       *
      *  084332  -  Despite 080994 field REFNUM is still being set up *
      *             incorrectly. Instead of obtaining it via a data   *
      *             structure, extract it from leftmost chars of      *
      *             field @PNAR where required.                       *
      *  081701  -  Use correct balance for Retail A/C's              *
      *  080994  -  Loan referance passed to LE0190 through data area *
      *             EMSDS now picked up from subfile record selected  *
      *             (field PNARZ) and NOT from from last APOSTL1      *
      *             record read (field PNAR) so that correct record is*
      *             displayed on loan detail enquiry                  *
      *          -  Produce program dump if DB error                  *
      *  S01408  -  Core hook GL4442FFPG added.                       *
      *             Core hook GL4442FFP1 added.                       *
      *  S01408  -  Core hook GL4442IIPG added.                       *
      *             Core hook GL4442CVK1 added.                       *
      *             Core hook GL4442CVKS added.                       *
      *             Core hook GL4442CCPG added.                       *
      *             Core hook GL4442CCP1 added.                       *
      *             Core hook GL4442CCP2 added.                       *
      *             Core hook GL4442CCP3 added.                       *
      *             Core hook GL4442CCP4 added.                       *
      *             Core hook GL4442CCP6 added.                       *
      *             Core hook GL4442CCP7 added.                       *
      *             Core hook GL4442CCP8 added.                       *
      *             Core hook GL4442CCP9 added.                       *
      *             Core hook GL4442CP10 added.                       *
      *  072626  -  System does not always respond to posting date.   *
      *  S01408  -  Core hook GL4442CIRE added.                       *
      *  S01472 - A/C Movements enquiry to show batch number          *
      *  058799 - Incorrect record number in SFLRCDNBR field when     *
      *           an account is enquired in the A/C movements screen  *
      *           while an option is also selected. This causes a     *
      *           session or device error in the subfile.             *
      *           Fix: Reset RRN to 1 when clearing the subfile.      *
      *  058797 - A/C Movements Enquiry is very slow if requested     *
      *           account has so many postings.                       *
      *           Fix: Build subfile one page at a time rather than   *
      *           build the whole subfile before any display.         *
      *  046902 - Account Movements Enquiry - Ledger Balance B/F plus *
      *           postings does not reconcile with Ledger Balance C/F *
      *           This is because postings on last statement date are *
      *           still being displayed on enquiry screen.            *
      *  S10736 - RECOMPILE FOR MANAGEMENT ACCOUNTING                 *
      *  E37456 - Accnt Movements Enquiry - (CPF5021) Incorrect       *
      *           relative record number error when historical        *
      *           postings are accessed on large accounts. Make       *
      *           sure that the subfile will only load a finite no.   *
      *           of records and then halt the processing.            *
      *  E36720 - If enquiring on movements due to Dealing don't      *
      *           dump if no record for deal found by DL0170 --       *
      *           just show 'No Details for Posting' since            *
      *           postings could still be shown for deleted deals.    *
      *  E31803 - THE PLUS SIGN INDICATING MORE DATA FOR THE          *
      *           ACCOUNT OVERWRITES THE DR/CR INDICATOR.             *
      *           REDUCE THE NARRATIVE FIELD TO BE DISPLAYED          *
      *           FROM 30 CHARS TO 29 CHARS, MOVING THE AMT. 2        *
      *           POSITION TO THE LEFT MAKING WAY FOR THE '+'         *
      *           SIGN & THE ENTIRE CR/DR INDICATOR.                  *
      *                                                               *
      *  LN1295 - WHEN NOSTRO CODE OR SHORTNAME ENTERED & VALIDATED   *
      *           REMAINING INPUT FIELDS SHOULD BE BLANKED OUT        *
      *  LN1274 - IF USER NOT AUTHORISED TO BRANCH, RECORD FMTS       *
      *           STATIC1,CLEAR1/2,NOST1/2, SHOULD NOT BE DISPLAYED   *
      *  LN1273 - IF MBIN = N, THE SINGLE BRANCH VALUE (DEFAULT       *
      *           BRANCH FROM ZMUSER) SHOULD BE USED IN CHAIN TO      *
      *           ACCOUNTS FILE                                       *
      *           BRANCH AUTHORITY CHECKED ONLY WHEN MBIN = Y.        *
      *  S01311 - Amended to allow linked enquiry for Exposure        *
      *           Management Release 10                               *
      *  E21183 - TO DISPLAY POSTINGS ONLY IF THEY HAVE NOT AP-       *
      *           PEARED ON LAST STATEMENT.(DATE FIELD LEFT BLANK)    *
      *  S01182 - ADDITIONAL FORMAT IN LOGICALS FOR MIS               *
      *  E20538 - MOVE CORRECT ACCOUNT TYPE INTO ACCOUNT TYPE FIELD   *
      *           AND RESTORE ERROR ROUTINE REMOVED BY E19970         *
      *  BHF677 - INCORRECT ZERO SUPPRESSION IN CHEQUE NUMBER         *
      *           FIELD OF SUBFILE RECORD                             *
      *  E20463 - NUMBER OF DECIMAL PLACES ON CURRENCY FIELD IS       *
      *           NOT CHECKED WHEN ENQUIRY CHANGES.                   *
      *  LN0130 - STANDARDISE PARAMETERS OF AOACCTV0                  *
      *  E19970 - THIS PROGRAM SHOULD ALLOW ENQUIRIES ON ALL TYPES    *
      *           OF ACCOUNT                                          *
      *  E19563 - ALL REFERENCES TO COMMAND 12 CHANGED TO COMMAND 5   *
      *           AND *INKL CHANGED TO *INKE                          *
      *  S01117 - RELEASE 10 MULTIBRANCHING                           *
      *  S01199 - HELP FACILITY MODIFIED                              *
      *  S01194 - NEW STANDING DATA                                   *
      *  E17471 - ALL ACCOUNT MOVEMENT ENQUIRIES ARE                  *
      *           DISPLAYED IN INCORRECT SEQUENCE                     *
      *                                                               *
      *****************************************************************
      *                                                               *
      *    I N D I C A T O R   U S A G E                              *
      *                                                               *
      *    01  First time indicator                                   *
      *    02  Display subfile                                        *
      *    03  Display subfile control record                         *
      *****04**Enable*SFLEND*                                         *   S01311
      *    04  Enable SFLEND                                          *   058797
      *                                                               *
      *    11  Enter key pressed                                      *
      *    12  Input criteria has been changed                        *
      *    14  ON = Account is retail                                 *
      *    15  Unallocated nostro                                     *
      *                                                               *
      *    20  Invalid account entered                                *
      *    21  Single Branch Environment                              *   S01117
      *****25**Rollup*key*pressed                                     *   S01311
      *    25  Rollup key pressed                                     *   058797
      *****27**Help*key*pressed                                       *   S01199
      *                                                               *
      *    30  Linked Enquiry from GL0061 or Exposure management      *   S01311
      *    31  EOF indicator for subfile                              *   S01311
      *    32  Exposure Management Error Indicator                    *   S01311
      *    33  Option selected                                        *   S01311
      *    34  Movement not printed on statement                      *   S01311
      *    35  Exposure management Linked Enquiry                     *   S01311
      *    36  Chain failure on REACR                                 *   S01311
      *    37  Accrued interest is non-zero                           *   S01311
      *                                                               *   S01311
      *    40  Reference code numeric                                 *   S01311
      *    41  Analytical accounting is on                            *   165546
      *                                                               *   S01311
      *    50  Input criteria is invalid                              *
      *    51  Customer number is invalid                             *
      *    52  User not Authorised to Branch                          *   S01117
      *                                                               *
      *    60  Account number has changed                             *
      *    61  Posting date has changed                               *
      *    62  Plus/Minus indcator has changed                        *
      *    63  Amount or cheque number has changed                    *
      *    64  Invalid account         - display reverse image        *
      *    65  Invalid date            - display reverse image        *
      *    66  Invalid (+/-) indicator - display reverse image        *
      *    67  Invalid amount          - display reverse image        *
      *    68  Invalid cheque number   - display reverse image        *
      *                                                               *
      *                                                                   S01408
     F/COPY WNCPYSRC,GL4442H001                                           S01408
      *                                                                   S01408
      *    80  No more postings for this account (APOSTL1/APOSTL2)    *
      **       or no more postings for this account (APOSTL38,APOSTL39)                       CGL131
      *                                                                   S01408
     F/COPY WNCPYSRC,GL4442H002                                           S01408
      *                                                                   S01408
      *    81  'OFF' = posting record meets selection criteria        *
      *    82  S01472 is switched ON                                      S01472
      *    83  No records in the subfile for this account             *
      *                                                               *
      *    9n  all 9? indicators used for standard subroutines        *
      *    98  Date format is 'M'                                     *
      *    99  also used as a general purpose indicator               *
      *                                                               *
      *    KC  Command key  3 pressed                                 *
      *    KE  Command key  5 pressed                                 *   E19563
      *    KL  NO LONGER IN USE                                       *   E19563
      *    KM  Command key 13 pressed                                 *
      *    KP  Command key 14 pressed                                 *
      *    KQ  Command key 15 pressed                                 *
      *                                                               *
      *    LR  End of program                                         *
      *                                                               *
      *****************************************************************
      *
     FGL4442DFCF  E                    WORKSTN      KINFDS DSPFDS
     F                                        RRN   KSFILE SFLRCD
     F                                        RRN   KSFILE SFLRCDA                            CGL131
     F/COPY WNCPYSRC,GL4442F002
     FPRONO   IF  E           K        DISK
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL4442FFP2                                           S01408
     F*                                                                   S01408
     FAPOSTL1 IF  E           K        DISK
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL4442FFPG                                           S01408
     F*                                                                   S01408
     FAPOSTL2 IF  E           K        DISK
     F            APOSTPDF                          KRENAMEAPOST2DF
     F            GLACPHPF                          KRENAMEGLACPH2F       S01182
     F                                              KINFDS INFO2                              CGL131
     FAPOSTL9 IF  E           K        DISK                               165546
     F            APOSTPDF                          KRENAMEAPOST9DF       165546
     F            GLACPHPF                          KRENAMEGLACPH9F       165546
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL4442FFP1                                           S01408
     F*                                                                   S01408
     FREACR   IF  E           K        DISK                               S01311
     F            REACRAF                           KIGNORE               S01311
     F            REACRZF                           KIGNORE               S01311
     FGLHATML1IF  E           K        DISK                                                   CAP204
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL4442FFP3                                           S01408
      *                                                                                       CGL131
     FAPOSTL38IF  E           K        DISK                                                   CGL131
      *                                                                                       CGL131
      ** Accounts postings by posting date                                                    CGL131
      *                                                                                       CGL131
     F            APOSTPDF                          KRENAMEAPOST1DF                           CGL131
     F            GLACPHPF                          KRENAMEGLACPH1F                           CGL131
     F                                              KINFDS INFO1                              CGL131
     FAPOSTL39IF  E           K        DISK                                                   CGL131
      *                                                                                       CGL131
      ** Accounts postings by posting amount                                                  CGL131
      *                                                                                       CGL131
     F            APOSTPDF                          KRENAMEAPOST3DF                           CGL131
     F            GLACPHPF                          KRENAMEGLACPH3F                           CGL131
     F                                              KINFDS INFO3                              CGL131
     FRSACMTLDIF  E           K        DISK                                                   CGL131
      *                                                                                       CGL131
      ** Account movements by posting date                                                    CGL131
      *                                                                                       CGL131
     F                                              KINFDS INFO5                              CGL131
     FRSACMTLBIF  E           K        DISK                                                   CGL131
      *                                                                                       CGL131
      ** Account movements by cheque number                                                   CGL131
      *                                                                                       CGL131
     F            RSACMTPO                          KRENAMERSACMTP1                           CGL131
     F                                              KINFDS INFO6                              CGL131
     FRSACMTLCIF  E           K        DISK                                                   CGL131
      *                                                                                       CGL131
      ** Accounts postings by posting amount                                                  CGL131
      *                                                                                       CGL131
     F            RSACMTPO                          KRENAMERSACMTP2                           CGL131
     F                                              KINFDS INFO7                              CGL131
      *                                                                                       CGL131
     FREEAUDPPO   E                    DISK                               CGL183
     F*                                                                   S01408
      /TITLE         >>> TABLES/ARRAYS <<<
     F/COPY WNCPYSRC,GL4442F001
     E                    FCODE      10  1
     E                    FTEXT      10 30
     E                    ERCD       19  4               ERROR CODES
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    ZA1        16  1               ZALIGN INPUT
     E                    ZA2        16  1               ZALIGN OUTPUT
     E                    ZS1        15  1 0
     E                    ZS2        22  1
     E***********         EMSG    1   2 76               ERROR MESSAGE    S01311
     E*                                                                   S01408
     E/COPY WNCPYSRC,GL4442EEPG                                           S01408
     E*                                                                   S01408
     E**********          EMSG    1   4 76               ERROR MESSAGE                 S01311 CAP204
     E**********          EMSG    1   5 76               ERROR MESSAGE               CAP204 BUG26687
     E                    EMSG    1   6 76               ERROR MESSAGE                      BUG26687
     E*                                                                   S01408
     E/COPY WNCPYSRC,GL4442EEP1                                           S01408
     E*                                                                   S01408
     E                    CPY@    1   1 80               COPYRIGHT STATEMENT
     E                    REF        12  8               DEAL/LOAN NOS.   S01311
      /TITLE         >>> DATA AREAS <<<
      *
      *************************************************
      **  D A T A   S T R U C T U R E    for   *LDA  **
      *************************************************
     E/COPY WNCPYSRC,GL4442E001
      *
     IDSLDA       DS
      *
      *  *LDA for transfering enquiry selection criteria
      *
     I**********                              2  49 LDADTA                S01117
     I**********                              2  52 LDADTA          S01117S01472
     I**********                              2  59 LDADTA                             S01472 CGL029
     I**********                              2  65 LDADTA                             CGL029 236093
     I                                        2  68 LDADTA                                    236093
     I                                        2  11 CNUMR
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL4442IIP2                                           S01408
     I*                                                                   S01408
     I                                       12  14 CURRY
     I                                        2   4 KPRCCY
     I                                        5   60KPRNO
     I                                        5   6 KPRNOA
     I**********                              7  20 KPREST                                    CGL029
     I**********                             15  18 ACCOD                                     CGL029
     I**********                             19  20 ACSEQ                                     CGL029
     I**********                              2  20 ACNT                                      CGL029
     I**********                             21  23 BRNCH                              S01117 CGL029
     I**********                              2  23 MBACNT                             S01117 CGL029
     I***********                            21  26 POSDA                 S01117
     I**********                             24  29 POSDA                              S01117 CGL029
     I***********                            27  27 PORM                  S01117
     I**********                             30  30 PORM                               S01117 CGL029
     I***********                            28  41 AMONT                 S01117
     I**********                             31  44 AMONT                              S01117 CGL029
     I***********                            42  49 CQNMR                 S01117
     I***********                            45  52 CQNMR           S01117165546
     I**********                             45  52 TYPMR                              165546 CGL029
     I**********                             53  59 SPOSR                              S01472 CGL029
     I**********                             53  59 SPOSP                              165546 CGL029
     I                                        7  26 KPREST                                    CGL029
     I                                       15  24 ACCOD                                     CGL029
     I                                       25  26 ACSEQ                                     CGL029
     I                                        2  26 ACNT                                      CGL029
     I                                       27  29 BRNCH                                     CGL029
     I                                        2  29 MBACNT                                    CGL029
     I                                       30  35 POSDA                                     CGL029
     I                                       36  36 PORM                                      CGL029
     I                                       37  50 AMONT                                     CGL029
     I                                       51  58 TYPMR                                     CGL029
     I                                       59  65 SPOSR                                     CGL029
     I                                       59  65 SPOSP                                     CGL029
     I                                       66  68 FUNC                                      236093
     I*
     I* External DTAARA for run-date
     I*
     IRUNDT       DS
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
     I*                                                                   S01117
     I* External DTAARA for ZMUSER                                        S01117
     I*                                                                   S01117
     IZMUSER      DS                                                      S01117
     I                                       11  13 BRC                   S01117
     I                                       17  17 BANK                  S01117
     I*
     IP@FMT1    E DSACCNTAB
     I              BRCA                            KBRC                  S01117
     I              CNUM                            KCUS
     I              CCY                             KCCY
     I              ACOD                            KCOD
     I              ACSQ                            KASE
     I                                        2   7 KCUSA
     I**********                              2  16 KEYAC                                     CGL029
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL4442IIP1                                           S01408
      *                                                                                       CGL131
     IINFO1       DS                                                                          CGL131
     I                                      261 270 FORMA1                                    CGL131
     IINFO2       DS                                                                          CGL131
     I                                      261 270 FORMA2                                    CGL131
     IINFO3       DS                                                                          CGL131
     I                                      261 270 FORMA3                                    CGL131
     IINFO5       DS                                                                          CGL131
     I                                      261 270 FORMA5                                    CGL131
     IINFO6       DS                                                                          CGL131
     I                                      261 270 FORMA6                                    CGL131
     IINFO7       DS                                                                          CGL131
     I                                      261 270 FORMA7                                    CGL131
      *                                                                                       CGL131
     I*                                                                   S01408
     I*
     IP@FMT2    E DSSDCURRPD
     I*
     IP@FMT3    E DSSDCUSTPD                                                                  CGL186
     I            DS
     I                                       49  560CQKEY
     I            DS                                                      165546
     I                                       49  52 PCKEY                 165546
     I*
     IP@ALL       DS
     I                                        1   7 P@RTCD
     I                                        8  14 P@OPTN
     I                                       15  24 P@KEY1
     I                                       25  31 P@ANY
     I                                       32  34 P@KEY2
     I**********                             35  38 P@KEY3                                    CGL029
     I**********                             39  40 P@KEY4                                    CGL029
     I**********                             41  47 P@TYPE                                    CGL029
     I**********                             48  49 P@NOSN                                    CGL029
     I**********                             50  52 P@KEY5                             S01117 CGL029
     I                                       35  44 P@KEY3                                    CGL029
     I                                       45  46 P@KEY4                                    CGL029
     I                                       47  53 P@TYPE                                    CGL029
     I                                       54  55 P@NOSN                                    CGL029
     I                                       56  58 P@KEY5                                    CGL029
     I*
     I            DS
     I                                        1  76 ERCD
     I                                        1  76 ERRDSP
     I*
     ISFLDS2      DS                                                      S01472
     I/COPY WNCPYSRC,GL4442I002
     I                                        1   7 PSTDZ                 S01472
     I                                        9  15 VALDZ                 S01472
     I                                       17  24 @CHQN                 S01472
     I**********                             26  55 PNARZ                              S01472 CRE098
     I**********                             26  70 PNARZ                            CRE098 MD025751
     I**********                             26  52 PNARZ                          MD025751 MD034003
     I**********                             26  54 PNARZ                         MD034003 MD036055A
     I                                       26  55 PNARZ                                  MD036055A
     I***************************            26  31 REFNUM          080994084332
     I**********                             26  31 REFNUM                           093226 MD025751
     I********                               26  51 PNARZ2         S01472 107938
     I**********                             57  75 PSTAZ                              S01472 CRE098
     I**********                             54  61 TRATZ                            CRE098 MD025751
     I                                       56  63 TRATZ                                   MD025751
     I                                       68  70 @ABTC                                   MD025751
     I                                       77  95 PSTAZ                                     CRE098
     I/COPY WNCPYSRC,GL4442I003
     I*                                                                   165546
     I* Data structure for subfile record                                 165546
     I*****************************************************************   165546
     I*                                                                   165546
     ISFLDS3      DS                                                      165546
     I                                        1   7 PSTDZP                165546
     I                                        9  15 VALDZP                165546
     I**********                             20  23 @PRFCP                           165546 MD025751
     I                                       17  20 @PRFCP                                  MD025751
     I**********                             27  56 PNARZP                             165546 CRE098
     I**********                             57  75 PSTAZP                             165546 CRE098
     I**********                             27  64 PNARZP                           CRE098 MD025751
     I**********                             38  45 TRATZP                           CRE098 MD025751
     I**********                             26  52 PNARZP                         MD025751 MD046592
     I                                       26  70 PNARZP                                  MD046592
     I                                       56  63 TRATZP                                  MD025751
     I                                       68  70 @ABTCP                                  MD025751
     I                                       77  95 PSTAZP                                    CRE098
     I*                                                                   S01472
     I* Data structure for subfile record                                 S01472
     I*****************************************************************
     I*
     I            DS
     I                                        1  150ZWRK15
     I                                        1  150ZS1
     I            DS
     I                                        1  25 ZOUT25
     I                                        1  21 ZOUT0
     I                                        2  23 ZOUT1
     I                                        3  24 ZOUT2
     I                                        5  25 ZOUT3
     I*
     I*****************************************************************
     I*
     I*    PROGRAM DS TO GET WORK STN ID
     I*
     I           SDS
     I                                      244 246 WSID
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL4442IIPG                                           S01408
     I*                                                                   S01408
     I                                      244 253 SWSID                 CGL183
     I                                      254 263 SUSER                 CGL183
      *                                                                   CGL183
     I            DS                                                      CGL183
     I                                        1  140TIMDAT                CGL183
     I                                        1   60WTIM                  CGL183
     I                                        7  140WDAT                  CGL183
     I            DS                                                      CGL183
     I                                        1   80ISODAT                CGL183
     I                                        1   40WISCY                 CGL183
     I                                        5   60WISMM                 CGL183
     I                                        7   80WISDD                 CGL183
     IDSAAUD      DS                                                      CGL183
     I                                        1   1 VLOSIC                CGL183
     I                                        2   2 VLACMV                CGL183
     I                                        3   3 VLCACB                CGL183
     I                                        4   4 VLPAMV                CGL183
     I*
     I*    DSPF DS  TO RETRIEVE CPF'S POSITION WITHIN THE SUBFILE
     I*
     IDSPFDS      DS
     I                                    B 378 3790CPFPOS
     I*                                                                   LN0130
     IDSSDY     E DSDSSDY                                                 LN0130
      ** EXTERNAL DS FOR LONG DUMMY DATA STRUCTURE                        LN0130
     IDSLDY     E DSDSLDY                                                                     CGL186
      ** Long data structure for access programs                                              CGL186
     ISDMMOD    E DSSDMMODPD                                              165546
     I**  Modules File Details                                            165546
     IDSFDY     E DSDSFDY                                                 165546
      ** Short data structure for access programs (200 long)              165546
     ISCSARD    E DSSCSARDPD                                              CAP031
     I              LCD                             @LCD                  CAP031
      ** Switcable Features file                                          CAP031
     I*                                                                   LN0130
     IEMSDS     E DSEMDTA                                                 S01311
      * External Data Area for Linked Enquiry Processing                  S01311
     I                                      141 146 CNUMP                 S01311
     I                                      147 149 CURRP                 S01311
     I**********                            150 153 ACODP                              S01311 CGL029
     I**********                            154 155 ACSQP                              S01311 CGL029
     I**********                            156 158 BRCHP                              S01311 CGL029
     I**********                            159 160 LINKP                              S01311 CGL029
     I                                      150 159 ACODP                                     CGL029
     I                                      160 161 ACSQP                                     CGL029
     I                                      162 164 BRCHP                                     CGL029
     I                                      165 166 LINKP                                     CGL029
      *                                                                   S01311
     IDLSDS     E DSDLDTA                                                 S01311
     I              RECID                           DRECI                 S01311
     I              PGN1D                           DPGN1                 S01311
     I              PGT1D                           DPGT1                 S01311
     I              PGL1D                           DPGL1                 S01311
     I              PGO1D                           DPGO1                 S01311
     I              PGN2D                           DPGN2                 S01311
     I              PGT2D                           DPGT2                 S01311
     I              RQDTD                           DRQDT                 S01311
     I              RETND                           DRETN                 S01311
     I*                                                                   S01136
0155 I*    LOAN/DEAL/SECURITY REFERENCE                                   S01311
0098 I            DS                                                      S01311
0099 I                                        1  30 PNAR                  S01311
0099 I**********                              1   6 REFNUM          S01311080994
     I**********                              1  29 @PNAR           E31803090574
     I                                        1  30 @PNAR                 090574
     I                                        1  15 @PREF                 096486
     I/COPY WNCPYSRC,GL4442I004
0383 I**   DATA STRUCTURE SCREEN AMOUNTS                                  S01311
0384 I            DS                                                      S01311
0385 I                                        1  19 COMPLT                S01311
0386 I                                        1  17 ZAMNTQ                S01311
0386 I                                       18  19 CRTEXT                S01311
0154 I*                                                                   S01311
0098 I            DS                                                      S01311
0099 I                                        1   7 SPOS                  S01311
     I                                        1   2 ABTCH2                S01472
0099 I                                        6   7 MODULE                S01311
      *                                                                                      BUG9014
     I            DS                                                                         BUG9014
     I                                        1   8 DLREF                                    BUG9014
     I                                        3   5 REFER                                    BUG9014
     I/COPY WNCPYSRC,GLH00563
      *                                                                                      BUG9014
     I            DS                                                                         BUG9014
     I                                        1  10 OTTP                                     BUG9014
     I                                        1   3 FCLTY                                    BUG9014
      *                                                                                      BUG9014
     I            DS                                                                         BUG9014
     I**********                              1   60ASOC                             BUG9014 CSD027A
     I                                        1   6 ASOC                                     CSD027A
     I                                        1   6 ACUST                                    BUG9014
0099  *                                                                   S01311
     I/COPY WNCPYSRC,GL4442I001
     I*                                                                   096486
     I            DS                                                      096486
     I**********                              1  15 PREF            096486124565
     I**********                              1  15 @HPREF                             096486 CGL029
     I                                        1  21 @HPREF                                    CGL029
     I                                       12  13 @PYTP                 096486
     I*                                                                   096486
     IDBERR       DS                            256                       S01311
     I                                      134 141 DBFIL                 CAP031
     I                                      142 170 DBKEY                 S01311
     I                                      171 180 DBPGM                 S01311
     I                                      181 1830DBASE                 CAP031
      *                                                                   S01311
     I* Rename API PGM as name is too long to be called from ILE prog.    CAP031
     I              'FTOPAY1SN'           C         FTOPAY                CAP031
     I              'FTIPAYSIN'           C         FTIPAY                                  BUG24143
     I              'GBSDUSRMSG'          C         XMSGFN                                  BUG26687
      *                                                                                     MD021130
     I              'AccMovEnqAvlBal'     C         V#GLAB                                  MD021130
      *                                                                                       CGL183
     I              'UserEnqAccessAudit'  C         V#AAUD                                    CGL183
     I*                                                                   CAP031
      /TITLE         >>> START OF MAIN PROCESSING <<<
     C*
     C*****************************************************************
     C                     MOVEACPY@      BIS@   80
     C*
     C           *NAMVAR   DEFN *LDA      DSLDA
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP11                                           S01408
      *                                                                                       CGL131
     C           KEYSL3    KLIST                                                              CGL131
     C                     KFLD           KBRC                                                CGL131
     C                     KFLD           KCUS                                                CGL131
     C                     KFLD           KCCY                                                CGL131
     C                     KFLD           KCOD                                                CGL131
     C                     KFLD           KASE                                                CGL131
     C                     KFLD           AMTKY                                               CGL131
     C                     KFLD           DORK                                                CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C           KALL      KLIST
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C                     KFLD           KBRC                            S01311
     C*
     C           KEYSL1    KLIST
     C                     KFLD           KBRC                            S01117
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C                     KFLD           POSDN
     C*********************KFLD           DORK                            E17471
     C                     KFLD           AMTKY
     C                     KFLD           DORK                            E17471
     C*
     C           KEYSL2    KLIST
     C                     KFLD           KBRC                            S01117
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C                     KFLD           CQKEY
     C*                                                                   165546
     C           KEYSL9    KLIST                                          165546
     C                     KFLD           KBRC                            165546
     C                     KFLD           KCUS                            165546
     C                     KFLD           KCCY                            165546
     C                     KFLD           KCOD                            165546
     C                     KFLD           KASE                            165546
     C                     KFLD           PCKEY                           165546
     C*
     C           KEYEQ     KLIST
     C                     KFLD           KBRC                            S01117
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C*
     C           KEYPRN    KLIST
     C                     KFLD           KPRCCY
     C                     KFLD           KPRNO
     C*                                                                                       CAP204
     C           KEYHAT    KLIST                                                              CAP204
     C                     KFLD           KBRC                                                CAP204
     C                     KFLD           FTREF                                               CAP204
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP42                                           S01408
     C*                                                                   165546
     C**  Check if Analytical Accounting module is installed.             165546
     C*                                                                   165546
     C                     CALL 'AOMMODR0'                                165546
     C                     PARM '*MSG   ' @RTCD   7                       165546
     C                     PARM '*FIRST ' @OPTN   7                       165546
     C           SDMMOD    PARM SDMMOD    DSFDY                           165546
     C*                                                                   165546
     C**  If Analytical Accounting is installed, use the profit           165546
     C**  centre on the display.                                          165546
     C*                                                                   165546
     C           BGN0ST    IFEQ 'Y'                                       165546
     C                     MOVE *ON       *IN41                           165546
     C                     ELSE                                           165546
     C                     MOVE *OFF      *IN41                           165546
     C                     ENDIF                                          165546
     C*                                                                   S01408
     C*
      *** Check the switchable features file to see if S01472 is on.      S01472
     C*                                                                   S01472
     C                     SETOF                     82                   S01472
     C                     MOVE 'N'       S01472  1                       S01472
     C                     CALL 'AOSARDR0'                                S01472
     C                     PARM '       ' @RTCD   7                       S01472
     C                     PARM '*VERIFY' @OPTN   7                       S01472
     C                     PARM 'S01472 ' @SARD   6                       S01472
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD006
      *                                                                   S01472
     C           @RTCD     IFEQ *BLANKS                                   S01472
     C                     MOVE 'Y'       S01472                          S01472
     C                     SETON                     82                   S01472
     C                     END                                            S01472
      *                                                                   S01472
     C/COPY WNCPYSRC,GLH00668
     C********             MOVE *BLANKS   SFLDS2                    S01472165546
     C  N41                MOVE *BLANKS   SFLDS2                          165546
     C   41                MOVE *BLANKS   SFLDS2                          165546
      *                                                                   S01472
     C* MAIN PROCESSING --- FIRST CALL INITIAL SUBROUTINE
     C*
     C                     EXSR INIT
     C*
     C* DO WHILE NOT Cmd/3 --- ie. NOT EXIT
     C*
     C           *INKC     DOWEQ'0'
     C           EXTFLG    ANDEQ'N'                                                           236093
     C*
      *                                                                   S01311
      *  Test for Exposure Management Command Keys                        S01311
      *                                                                   S01311
     C           *IN30     IFEQ '1'                                       S01311
     C                     EXSR CMD                                       S01311
     C                     END                                            S01311
     C***********                                                  S01311 058797
     C***Test*whether*option*selected******************************S01311 058797
     C***********                                                  S01311 058797
     C************IN33     IFEQ '0'                                S01311 058797
     C***********CPFPOS    IFGT 0                                  S01311 058797
     C***********          Z-ADDCPFPOS    DSPREC                   S01311 058797
     C***********          ELSE                                    S01311 058797
     C***********          Z-ADD1         DSPREC                   S01311 058797
     C***********          END                                     S01311 058797
     C***********          END                                     S01311 058797
     C                     SETOF                     33                   S01311
      *                                                                   S01311
     C                     WRITEHEADING
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CCP9                                           S01408
     C           S01472    IFEQ 'Y'                                                         AR747061
     C           CGL013    IFEQ 'Y'                                                         BUG26687
     C           CER030    OREQ 'Y'                                                         BUG26687
     C                     MOVEL'USR9927' PMSGID                                            BUG26687
     C                     EXSR RTVMSG                                                      BUG26687
     C                     MOVELPMSGDS    OFKEY                                             BUG26687
     C                     ENDIF                                                            BUG26687
     C                     ENDIF                                                            AR747061
     C*                                                                   S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     EXFMTSFLCTLRA                                                      CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     EXFMTSFLCTLR
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP10                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C* SETOF INDICATOR FOR ACTION PERFORMED
     C*
     C                     SETOF                     11
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP43                                           S01408
     C*                                                                   S01408
     C                     SETOF                     32                   S01311
     C*
     C* SETON INDICATOR FOR NO POSTINGS TO DISPLAY
     C*
     C                     SETON                     83
     C*
     C************IN25     IFEQ '1'                                       S01311
     C***********          SETON                     11                   S01311
     C***********          EXSR ROLP                                      S01311
     C***********          END                                            S01311
     C*                                                                   058797
     C           *IN25     IFEQ '1'                                       058797
     C                     SETON                     11                   058797
     C                     EXSR ROLP                                      058797
     C                     ELSE                                           058797
     C*
     C************INKL     IFEQ '1'                                       E19563
     C           *INKE     IFEQ '1'                                       E19563
     C                     SETON                     11
     C                     EXSR CMD5
     C                     END
     C*
     C********** *IN27     DOWEQ'1'                                       S01199
     C**********                                                          S01199
     C***IF*HELP KEY PRESSED BUT THERE ARE NO ERRORS TO DISPLAY           S01199
     C***THEN*DISPLAY USER INSTRUCTIONS                                   S01199
     C**********                                                          S01199
     C********** *IN50     IFEQ '0'                                       S01199
     C**********           MOVEA*BLANK    ERCD                            S01199
     C**********           MOVE ' 999'    ERCD,1                          S01199
     C**********           END                                            S01199
     C**********                                                          S01199
     C**********           MOVEAERCD      HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********           READ SFLCTLR                  99               S01199
     C**********           END                                            S01199
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP44                                           S01408
     C*                                                                   S01408
      *                                                                                       236093
      ** If F03 - Exit                                                                        236093
      *                                                                                       236093
     C           *INKC     IFEQ '1'                                                           236093
     C                     MOVEL'F03'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     ENDIF                                                              236093
      *                                                                                       236093
      ** If F13 - Account & Statement Details                                                 236093
      *                                                                                       236093
     C           *INKM     IFEQ '1'                                                           236093
     C                     MOVEL'F13'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     MOVE 'Y'       EXTFLG                                              236093
     C                     ENDIF                                                              236093
      *                                                                                       236093
      ** If F15 - Projected Account Movements                                                 236093
      *                                                                                       236093
     C           *INKP     IFEQ '1'                                                           236093
     C                     MOVEL'F15'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     MOVE 'Y'       EXTFLG                                              236093
     C                     ENDIF                                                              236093
      *                                                                                       236093
      ** If F16 - Items in Clearing                                                           236093
      *                                                                                       236093
     C           *INKQ     IFEQ '1'                                                           236093
     C                     MOVEL'F16'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     MOVE 'Y'       EXTFLG                                              236093
     C                     ENDIF                                                              236093
     C/COPY OFCPYSRCZ,CGL145_024                                                             CGL145B
     C* TRANSFER CONTROL TO OTHER ENQUIRIES VIA GROUP JOB...
     C*
     C********** *INKM     IFEQ '1'                                                           236093
     C**********           OUT  DSLDA                                                         236093
     C**********           CALL 'GL4440'                                                      236093
     C**********           PARM 'GL4441'  PARAM  10                                           236093
     C**********           SETON                     11                                       236093
     C**********           EXSR LDA                                                           236093
     C* On return check if details have changed to blank
     C**********           EXSR FLDCHG                                                        236093
     C********** LDADTA    IFEQ *BLANKS                                                       236093
     C********** *IN12     ANDEQ'1'                                                           236093
     C**********           EXSR ENTR                                                          236093
     C**********           END                                                                236093
     C**********           END                                                                236093
     C*
     C********** *INKP     IFEQ '1'                                                           236093
     C**********           OUT  DSLDA                                                         236093
     C**********           CALL 'GL4440'                                                      236093
     C**********           PARM 'GL4443'  PARAM                                               236093
     C**********           SETON                     11                                       236093
     C**********           EXSR LDA                                                           236093
     C* On return check if details have changed to blank
     C**********           EXSR FLDCHG                                                        236093
     C********** LDADTA    IFEQ *BLANKS                                                       236093
     C********** *IN12     ANDEQ'1'                                                           236093
     C**********           EXSR ENTR                                                          236093
     C**********           END                                                                236093
     C**********           END                                                                236093
     C*
     C********** *INKQ     IFEQ '1'                                                           236093
     C**********           OUT  DSLDA                                                         236093
     C**********           CALL 'GL4440'                                                      236093
     C**********           PARM 'GL4444'  PARAM                                               236093
     C**********           SETON                     11                                       236093
     C**********           EXSR LDA                                                           236093
     C* On return check if details have changed to blank
     C**********           EXSR FLDCHG                                                        236093
     C********** LDADTA    IFEQ *BLANKS                                                       236093
     C********** *IN12     ANDEQ'1'                                                           236093
     C**********           EXSR ENTR                                                          236093
     C**********           END                                                                236093
     C**********           END                                                                236093
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP15                                           S01408
     C*                                                                   S01408
      *                                                                   S01311
      *  Check if Option number entered                                   S01311
      *                                                                   S01311
     C                     EXSR OPTN                                      S01311
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP16                                           S01408
     C*                                                                   S01408
     C*                                                                   058797
     C** Allow ENTER to be processed in sr/ENTR if no option has been     058797
     C** made for a record on the subfile, and no new account requested.  058797
     C*                                                                   058797
     C***********          SETON                     11            S01311 058797
     C                     EXSR FLDCHG                                    S01311
     C           *IN12     IFEQ '1'                                       S01311
     C                     SETON                     11                   058797
     C                     EXSR ENTR                                      S01311
     C                     END                                            S01311
     C*
     C           *IN11     IFEQ '0'
     C                     EXSR ENTR
     C                     END
     C*                                                                   058797
     C                     END                                            058797
     C*
     C                     END
     C*
     C* ...ELSE END PROGRAM (ie. Cmd/3)
      *                                                                   S01311
      *  Test for CMD 3 pressed within Exposure Management stack          S01311
      *                                                                   S01311
     C           *IN30     IFEQ '1'                                       S01311
     C                     MOVE 'Q'       RETNWF                          S01311
     C                     EXSR RETSR                                     S01311
     C                     END                                            S01311
     C*
     C                     SETON                     LR
     C/COPY WNCPYSRC,GL4442C042
     C*
      /TITLE         <<< INIT SR. >>>
     C*****************************************************************
     C*
     C* INIT --- SUBROUTINE TO PERFORM INITIAL PROCESSING
     C*
     C* 1. READS RUN-DATE AND FORMAT FROM DATA AREA
     C* 2. GETS DETAILS FROM *LDA, OR IF *LDA BLANK FROM SCREEN
     C*
     C* CALLED FROM MAIN POCESSING
     C*
     C* CALLS: LDA (S/R), RSCLDA (PROGRAM)
     C*
     C*****************************************************************
     C*
     C           INIT      BEGSR                           ** INIT **
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CCPG                                           S01408
     C*                                                                   S01408
     C*
     C           *NAMVAR   DEFN RUNDAT    RUNDT
     C                     IN   RUNDT
     C                     UNLCKRUNDT
     C                     Z-ADDRUND      RNDT    50
     C                     MOVE 'N'       EXTFLG  1                                           236093
     C*
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C                     UNLCKZMUSER                                    S01117
     C*                                                                   S01117
      *  Retrieve EM data area for Exposure Management linked enquiry     S01311
      *                                                                   S01311
     C           *NAMVAR   DEFN           DLSDS                           S01311
     C           *NAMVAR   DEFN           EMSDS                           S01311
     C                     IN   EMSDS                                     S01311
      *                                                                   CAP136
      ** Access SAR file to determine if CAP136 (New Maint.               CAP136
      ** Funct - Incoming Payments) is installed.                         CAP136
      *                                                                   CAP136
     C                     CALL 'AOSARDR0'                                CAP136
     C                     PARM *BLANKS   @RTCD                           CAP136
     C                     PARM '*VERIFY' @OPTN                           CAP136
     C                     PARM 'CAP136'  @SARD                           CAP136
     C           SCSARD    PARM SCSARD    DSFDY                           CAP136
      *                                                                   CAP136
      ** An NRF (No Record Found) return code is valid.                   CAP136
      ** Issue database error only for error return codes.                CAP136
      *                                                                   CAP136
     C           @RTCD     IFNE *BLANKS                                   CAP136
     C           @RTCD     ANDNE'*NRF   '                                 CAP136
     C                     Z-ADD002       DBASE            ***************CAP136
     C                     MOVEL'CAP136'  DBKEY            *DB ERROR 002 *CAP136
     C                     MOVEL'SCSARDPD'DBFIL            ***************CAP136
     C                     EXSR *PSSR                                     CAP136
     C                     ENDIF                                          CAP136
      *                                                                   CAP136
     C           @RTCD     IFEQ *BLANK                                    CAP136
     C                     MOVEL'Y'       CAP136  1                       CAP136
     C                     MOVEL'FTIPAY'  PPGM   10                       CAP136
     C                     MOVE 'SIN '    PPGM                            CAP136
     C                     ELSE                                           CAP136
     C                     MOVEL'N'       CAP136                          CAP136
     C                     MOVE *BLANKS   PPGM                            CAP136
     C                     ENDIF                                          CAP136
      *                                                                   S01311
     C                     MOVE RQDTD     MODI    2                       S01311
     C           MODI      IFEQ 'GL'                                      S01311
     C                     SETON                     30                   S01311
     C                     END                                            S01311
      *                                                                   S01311
     C           PGN1D     IFEQ 'EMC0301 '                                S01311
     C                     SETON                     35                   S01311
     C                     END                                            S01311
      *                                                                   S01311
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD1         I       20
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       LN1273
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM           BRC                             S01117
     C                     PARM *ZERO     ERRCOD  10                      S01117
     C*                                                                   S01117
     C           ERRCOD    IFNE 0                                         S01117
     C                     SETON                     505264               S01117
     C                     MOVE ' 010'    ERCD,I                          S01117
     C                     ADD  1         I                               S01117
     C                     END                                            S01117
     C                     END                                            LN1273
     C*                                                                   S01117
     C           DATF      COMP 'M'                      98
     C           MBIN      COMP 'N'                      21               S01117
     C*
     C           MODI      IFEQ 'GL'                                      S01311
     C                     EXSR LDAUP                                     S01311
     C**********           ELSE                                                        S01311 236093
     C**********           CALL 'GLC440A'                                                     236093
     C**********           PARM 'I'       @PARM   1                                           236093
     C                     END                                            S01311
     C*
     C*                                                                   S01408
      ** Access SAR details file to determine if Account Access                               CGL037
      ** Security is switched on                                                              CGL037
      *                                                                                       CGL037
     C                     CALL 'AOSARDR0'                                                    CGL037
     C                     PARM *BLANKS   @RTCD   7                                           CGL037
     C                     PARM '*VERIFY' @OPTN   7                                           CGL037
     C                     PARM 'CGL037'  @SARD   6                                           CGL037
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL037
      *                                                                                       CGL037
     C           @RTCD     IFNE *BLANKS                                                       CGL037
     C           @RTCD     ANDNE'*NRF   '                                                     CGL037
     C                     EXSR *PSSR                                                         CGL037
     C                     MOVE '1'       *INLR                                               CGL037
     C                     RETRN                                                              CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C           @RTCD     IFEQ *BLANK                                                        CGL037
     C                     MOVEL'Y'       CGL037  1                                           CGL037
     C                     ELSE                                                               CGL037
     C                     MOVEL'N'       CGL037                                              CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
      ** Access SAR details file to determine if Retail Account                               CAP204
      ** Transfer is switched on                                                              CAP204
      *                                                                                       CAP204
     C                     CALL 'AOSARDR0'                                                    CAP204
     C                     PARM *BLANKS   @RTCD                                               CAP204
     C                     PARM '*VERIFY' @OPTN                                               CAP204
     C                     PARM 'CAP204'  @SARD                                               CAP204
     C           SCSARD    PARM SCSARD    DSFDY                                               CAP204
      *                                                                                       CAP204
     C                     MOVEL'N'       CAP204  1                                           CAP204
     C           @RTCD     IFEQ *BLANKS                                                       CAP204
     C                     MOVEL'Y'       CAP204                                              CAP204
     C                     ELSE                                                               CAP204
     C           @RTCD     IFNE '*NRF   '                                                     CAP204
     C                     Z-ADD003       DBASE                                               CAP204
     C                     MOVEL'SCSARDPD'DBFIL                                               CAP204
     C                     MOVEL'CAP204'  DBKEY                                               CAP204
     C                     EXSR *PSSR                                                         CAP204
     C                     END                                                                CAP204
     C                     END                                                                CAP204
      *                                                                                       CAP204
     C/COPY WNCPYSRC,GL4442CP13                                           S01408
     C*                                                                   S01408
      *                                                                                       CGL131
     C                     CALL 'AOSARDR0'                                                    CGL131
     C                     PARM *BLANKS   @RTCD                                               CGL131
     C                     PARM '*VERIFY' @OPTN                                               CGL131
     C                     PARM 'CGL131'  PSARD                                               CGL131
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL131
      *                                                                                       CGL131
     C           @RTCD     IFNE *BLANKS                                                       CGL131
     C           @RTCD     ANDNE'*NRF    '                                                    CGL131
     C                     MOVE 'SCSARDPD'DBFIL                                               CGL131
     C                     MOVEL'004'     DBASE                                               CGL131
     C                     MOVEL'CGL131'  DBKEY                                               CGL131
     C                     EXSR *PSSR                                                         CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           @RTCD     IFEQ *BLANK                                                        CGL131
     C                     MOVE 'Y'       CGL131  1                                           CGL131
     C                     ELSE                                                               CGL131
     C                     MOVE 'N'       CGL131                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C/COPY OFCPYSRCZ,CGL145_023                                                             CGL145B
      *                                                                   CGL183
      ** Check if feature CGL183 is On                                    CGL183
      *                                                                   CGL183
     C                     CALL 'AOSARDR0'                                CGL183
     C                     PARM *BLANKS   @RTCD   7                       CGL183
     C                     PARM '*VERIFY' @OPTN   7                       CGL183
     C                     PARM 'CGL183'  @SARD   6                       CGL183
     C           SCSARD    PARM SCSARD    DSFDY                           CGL183
      *                                                                   CGL183
     C           @RTCD     IFEQ *BLANKS                                   CGL183
     C                     MOVE 'Y'       CGL183  1                       CGL183
     C                     ELSE                                           CGL183
     C                     MOVE 'N'       CGL183                          CGL183
     C                     END                                            CGL183
      *                                                                   CGL183
      ** System value that controls user access audit for this enquiry    CGL183
      *                                                                   CGL183
     C                     MOVELV#AAUD    P@OP01                          CGL183
      *                                                                   CGL183
     C                     CALL 'AOSVALR0'                                CGL183
     C                     PARM *BLANKS   @RTCD   7                       CGL183
     C                     PARM           P@OP01 20                       CGL183
     C                     PARM *BLANKS   P@VL01200                       CGL183
     C                     PARM *BLANKS   P@OP02 20                       CGL183
     C                     PARM *BLANKS   P@VL02200                       CGL183
     C                     PARM *BLANKS   P@OP03 20                       CGL183
     C                     PARM *BLANKS   P@VL03200                       CGL183
     C                     PARM *BLANKS   P@OP04 20                       CGL183
     C                     PARM *BLANKS   P@VL04200                       CGL183
     C                     PARM *BLANKS   P@OP05 20                       CGL183
     C                     PARM *BLANKS   P@VL05200                       CGL183
     C                     PARM *BLANKS   P@OP06 20                       CGL183
     C                     PARM *BLANKS   P@VL06200                       CGL183
     C                     PARM *BLANKS   P@OP07 20                       CGL183
     C                     PARM *BLANKS   P@VL07200                       CGL183
     C                     PARM *BLANKS   P@OP08 20                       CGL183
     C                     PARM *BLANKS   P@VL08200                       CGL183
     C                     PARM *BLANKS   P@OP09 20                       CGL183
     C                     PARM *BLANKS   P@VL09200                       CGL183
     C                     PARM *BLANKS   P@OP10 20                       CGL183
     C                     PARM *BLANKS   P@VL10200                       CGL183
      *                                                                   CGL183
     C                     MOVELP@VL01    DSAAUD                          CGL183
      *                                                                   CGL183
      ** Get time and date, but only format date-CCYYMMDD                 CGL183
      *                                                                   CGL183
     C                     TIME           TIMDAT                          CGL183
      *                                                                   CGL183
     C                     MOVELWDAT      WISDD                           CGL183
     C                     MOVE WDAT      WISCY                           CGL183
     C                     MOVELWDAT      WDDMM   4                       CGL183
     C                     MOVE WDDMM     WISMM                           CGL183
      *                                                                   CGL183
     C                     MOVE 'N'       AUDIT   1                       CGL183
      *                                                                   CGL183
      *----------------------------------------------------------------                     MD021130
      *                                                                                     MD021130
      ** Retrieve system value that controls the display of actual balance when CGL131 is   MD021130
      **    switched On                                                                     MD021130
      *                                                                                     MD021130
     C                     MOVEL*BLANKS   P@OP01                                            MD049386
     C                     MOVELV#GLAB    P@OP01                                            MD021130
      *                                                                                     MD021130
     C                     CALL 'AOSVALR0'                                                  MD021130
     C                     PARM *BLANKS   @RTCD   7                                         MD021130
     C                     PARM           P@OP01 20                                         MD021130
     C                     PARM *BLANKS   P@VL01200                                         MD021130
     C                     PARM *BLANKS   P@OP02 20                                         MD021130
     C                     PARM *BLANKS   P@VL02200                                         MD021130
     C                     PARM *BLANKS   P@OP03 20                                         MD021130
     C                     PARM *BLANKS   P@VL03200                                         MD021130
     C                     PARM *BLANKS   P@OP04 20                                         MD021130
     C                     PARM *BLANKS   P@VL04200                                         MD021130
     C                     PARM *BLANKS   P@OP05 20                                         MD021130
     C                     PARM *BLANKS   P@VL05200                                         MD021130
     C                     PARM *BLANKS   P@OP06 20                                         MD021130
     C                     PARM *BLANKS   P@VL06200                                         MD021130
     C                     PARM *BLANKS   P@OP07 20                                         MD021130
     C                     PARM *BLANKS   P@VL07200                                         MD021130
     C                     PARM *BLANKS   P@OP08 20                                         MD021130
     C                     PARM *BLANKS   P@VL08200                                         MD021130
     C                     PARM *BLANKS   P@OP09 20                                         MD021130
     C                     PARM *BLANKS   P@VL09200                                         MD021130
     C                     PARM *BLANKS   P@OP10 20                                         MD021130
     C                     PARM *BLANKS   P@VL10200                                         MD021130
      *                                                                                     MD021130
     C                     MOVELP@VL01    VLGLAB  1                                         MD021130
      *                                                                                     MD021130
     C                     EXSR LDA
     C*
     C                     WRITEHEADING
     C*
     C                     SETON                     03
     C                     MOVEL'GL4442'  HBPGM   8
     C*
     C** Access SAR details file to determine if CAP131 is switched ON    CAP031
     C*                                                                   CAP031
     C                     CALL 'AOSARDR0'                                CAP031
     C                     PARM *BLANKS   @RTCD                           CAP031
     C                     PARM '*VERIFY' @OPTN                           CAP031
     C                     PARM 'CAP131'  PSARD   6                       CAP031
     C           SCSARD    PARM SCSARD    DSFDY                                               CSD006
     C                     MOVE 'N'       CAP131  1                       CAP031
     C*                                                                   CAP031
     C** If core feature is switched ON, set on indicator that will       CAP031
     C** condition the rest of the processing                             CAP031
     C*                                                                   CAP031
     C           @RTCD     IFEQ *BLANKS                                   CAP031
     C                     MOVE 'Y'       CAP131                          CAP031
     C                     ELSE                                           CAP031
     C*                                                                   CAP031
     C** else, database error (return code other than *NRF)               CAP031
     C*                                                                   CAP031
     C           @RTCD     IFNE '*NRF   '                                 CAP031
     C                     Z-ADD001       DBASE            ***************CAP031
     C                     MOVEL'SCSARDPD'DBFIL            *DB ERROR 001 *CAP031
     C                     MOVEL'CAP131'  DBKEY            ***************CAP031
     C                     EXSR *PSSR                                     CAP031
     C                     ENDIF                                          CAP031
     C                     ENDIF                                          CAP031
      *                                                                   CAP031
      *                                                                                     BUG26687
      ** Access SAR details file to see if CGL013 is installed.                             BUG26687
      *                                                                                     BUG26687
     C                     CALL 'AOSARDR0'                                                  BUG26687
     C                     PARM *BLANKS   @RTCD                                             BUG26687
     C                     PARM '*VERIFY' @OPTN                                             BUG26687
     C                     PARM 'CGL013'  PSARD                                             BUG26687
     C           SCSARD    PARM SCSARD    DSFDY                                             BUG26687
      *                                                                                     BUG26687
     C           @RTCD     IFNE *BLANKS                                                     BUG26687
     C           @RTCD     ANDNE'*NRF    '                                                  BUG26687
     C                     MOVE 'SCSARDPD'DBFIL                                             BUG26687
     C                     MOVEL'003'     DBASE                                             BUG26687
     C                     MOVEL'CGL013'  DBKEY                                             BUG26687
     C                     EXSR *PSSR                                                       BUG26687
     C                     ENDIF                                                            BUG26687
      *                                                                                     BUG26687
     C           @RTCD     IFEQ *BLANK                                                      BUG26687
     C                     MOVE 'Y'       CGL013  1                                         BUG26687
     C                     ELSE                                                             BUG26687
     C                     MOVE 'N'       CGL013                                            BUG26687
     C                     ENDIF                                                            BUG26687
      *                                                                                     BUG26687
     C                     CALL 'AOSARDR0'                                                  BUG26687
     C                     PARM *BLANKS   @RTCD                                             BUG26687
     C                     PARM '*VERIFY' @OPTN                                             BUG26687
     C                     PARM 'CER030'  PSARD                                             BUG26687
     C           SCSARD    PARM SCSARD    DSFDY                                             BUG26687
      *                                                                                     BUG26687
     C           @RTCD     IFNE *BLANKS                                                     BUG26687
     C           @RTCD     ANDNE'*NRF    '                                                  BUG26687
     C                     MOVE 'SCSARDPD'DBFIL                                             BUG26687
     C                     MOVEL'002'     DBASE                                             BUG26687
     C                     MOVEL'CER030'  DBKEY                                             BUG26687
     C                     EXSR *PSSR                                                       BUG26687
     C                     ENDIF                                                            BUG26687
      *                                                                                     BUG26687
     C           @RTCD     IFEQ *BLANK                                                      BUG26687
     C                     MOVE 'Y'       CER030  1                                         BUG26687
     C                     ELSE                                                             BUG26687
     C                     MOVE 'N'       CER030                                            BUG26687
     C                     ENDIF                                                            BUG26687
      *                                                                                     BUG26687
     C                     ENDSR                           ** INIT **
     C*
      /TITLE         <<< LDA SR. >>>
     C*****************************************************************
     C*
     C* LDA --- SUBROUTINE TO CHECK FOR LDA=BLANK
     C*
     C* CALLED FROM: MAIN PROCESSING, INIT
     C*
     C* CALLS: ENTR
     C*
     C*****************************************************************
     C*
     C           LDA       BEGSR                           ** LDA **
     C*
     C                     IN   DSLDA
     C/COPY WNCPYSRC,GL4442C027
     C           LDADTA    IFEQ *BLANKS
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP17                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     Z-ADDRNDT      POSDN                                               CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C                     SETOF                     20
     C/COPY WNCPYSRC,GL4442C003
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     WRITESTATICA                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     WRITESTATIC1
     C/COPY WNCPYSRC,GL4442C004
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*
     C                     ELSE
     C*
     C                     EXSR ENTR
     C*
     C                     END
     C*
     C                     ENDSR                           ** LDA **
     C*
      /TITLE         <<< LDAUP SR. >>>                                    S01311
     C*****************************************************************   S01311
     C*                                                                   S01311
     C* LDAUP --- SUBROUTINE TO UPDATE LDA IF CALLED VIA EXPOSURE         S01311
     C*           MANAGEMENT ENQUIRY                                      S01311
     C*                                                                   S01311
     C* CALLED FROM: INIT                                                 S01311
     C*                                                                   S01311
     C*****************************************************************   S01311
      *                                                                   S01311
     C           LDAUP     BEGSR                           ** LDAUP **    S01311
      *                                                                   S01311
     C                     IN   EMSDS                                     S01311
     C                     IN   DSLDA                                     S01311
     C                     MOVE *BLANK    CNUMR                           090525
     C                     MOVELCNUMP     CNUMR                           S01311
     C                     MOVE CURRP     CURRY                           S01311
     C                     MOVE ACODP     ACCOD                           S01311
     C                     MOVE ACSQP     ACSEQ                           S01311
     C                     MOVE BRCHP     BRNCH                           S01311
     C                     OUT  DSLDA                                     S01311
      *                                                                   S01311
     C                     ENDSR                           ** LDAUP **    S01311
      *                                                                   S01311
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP18                                           S01408
     C*                                                                   S01408
      /TITLE         <<< OPTN SR. >>>                                     S01311
     C*****************************************************************   S01311
      *                                                               *   S01311
      *  OPTN  - SUBROUTINE TO PROCESS OPTION                         *   S01311
      *                                                               *   S01311
      *  Called by  MAIN   - Main Processing                          *   S01311
      *                                                               *   S01311
     C*****************************************************************   S01311
      *                                                                   S01311
     C           OPTN      BEGSR                                          S01311
     C/COPY WNCPYSRC,GL4442C005
      *                                                                   S01311
     C                     MOVE ' '       RETND                           S01311
     C                     MOVE ' '       DRETN                           S01311
      *                                                                   S01311
      *  Check for selected subfile record                                S01311
      *                                                                   S01311
     C           *IN31     DOUEQ'1'                                       S01311
     C           RETND     OREQ 'U'                                       S01311
     C           RETND     OREQ 'S'                                       S01311
     C           DRETN     OREQ 'U'                                       S01311
     C           DRETN     OREQ 'S'                                       S01311
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CCP6                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     READCSFLRCDA                3131                                   CGL131
     C                     MOVEL@HPREF    RFRNUM  6 P                                         CGL131
     C                     MOVEL@HPREF    FTREF  15 P                                         CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C                     READCSFLRCD                 3131               S01311
     C                     MOVEL@HPREF    RFRNUM  6 P                     124565
     C                     MOVEL@HPREF    FTREF  15 P                     124565
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CCP7                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
      *                                                                   S01311
     C           *IN31     IFEQ '0'                                       S01311
     C           OPTION    IFNE ' '                                       058799
     C                     Z-ADDRRN       DSPREC                          S01311
     C                     SETON                     33                   S01311
     C*                                                                   058797
     C** An option has been selected--no need to process ENTER in         058797
     C** sr/ENTR.                                                         058797
     C*                                                                   058797
     C                     SETON                     11                   058797
     C           OPTION    IFNE '1'                                       S01311
     C           OPTION    ANDNE'2'                                                         BUG26687
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CCP1                                           S01408
     C*                                                                   S01408
     C                     MOVE ' '       OPTION                          S01311
     C/COPY WNCPYSRC,GL4442C006
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     UPDATSFLRCDA                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     UPDATSFLRCD                                    S01311
     C/COPY WNCPYSRC,GL4442C007
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     SETON                     32                   S01311
     C**********           MOVELEMSG,3    ERRDSP                                     S01311 BUG26687
     C                     MOVELEMSG,6    ERRDSP                                            BUG26687
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CCP2                                           S01408
     C*                                                                   S01408
     C                     ELSE                                           S01311
      *                                                                   S01311
     C                     MOVE OPTION    WOPTN   1                                         BUG26687
     C                     MOVE ' '       OPTION                          S01311
     C/COPY WNCPYSRC,GL4442C008
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     UPDATSFLRCDA                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     UPDATSFLRCD                                    S01311
     C           WOPTN     IFEQ '2'                                                         BUG26687
     C           CER030    ANDEQ'N'                                                         BUG26687
     C           CGL013    ANDEQ'N'                                                         AR745889
     C                     SETON                     32                                     BUG26687
     C                     MOVELEMSG,6    ERRDSP                                            BUG26687
     C                     GOTO EOPTN                                                       BUG26687
     C                     ENDIF                                                            BUG26687
     C/COPY WNCPYSRC,GL4442C009
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
      *                                                                   084332
      ***Obtain*reference*number*from*leftmost*6*chars*of*narrative*084332093226
     C***********          MOVEL@PNAR     REFNUM  6                 084332093226
      ** Number is already available from READC on Subfile record.        093226
      *                                                                   S01311
      *  Test the reference number to make sure it is numeric             S01311
      *                                                                   S01311
     C**********           TESTN          REFNUM     40             S01311124565
     C                     TESTN          RFRNUM     40                   124565
      *                                                                   S01311
     C           *IN40     IFEQ '1'                                       S01311
     C           MODULE    OREQ 'FT'                                      096486
     C           MODULE    OREQ 'LE'                                                          CLE148
     C           MODULE    OREQ 'TX'                                                          CAP204
     C           CAP204    ANDEQ'Y'                                                           CAP204
     C           *IN40     OREQ '0'                                                         BUG24143
     C           ABTCH     ANDNE' '                                                         BUG24143
     C           ABITM     ANDNE' '                                                         BUG24143
     C           MODULE    IFEQ 'LE'                                      S01311
     C           *LOCK     IN   EMSDS                                     S01311
     C                     MOVE ' '       RETND                           S01311
     C                     MOVE *BLANKS   RQDTW  18                       S01311
     C                     MOVELRQDTW     RQDTD                           S01311
     C**********           MOVELREFNUM    RQDTD                     S01311124565
     C                     MOVELRFRNUM    RQDTD                           124565
     C                     MOVE 'LE'      RQDTD                           S01311
     C                     OUT  EMSDS                                     S01311
     C                     END                                            S01311
      *                                                                   S01311
     C           MODULE    IFEQ 'DL'                                      S01311
     C           *LOCK     IN   DLSDS                                     S01311
     C                     MOVE ' '       DRETN                           S01311
     C                     MOVE *BLANKS   DRQDW  18                       S01311
     C                     MOVELRQDTW     DRQDT                           S01311
     C**********           MOVELREFNUM    DRQDT                     S01311124565
     C                     MOVELRFRNUM    DRQDT                           124565
     C                     MOVE 'DL'      DRQDT                           S01311
     C                     MOVEL'GL4442'  DPGN2                           E36720
     C                     OUT  DLSDS                                     S01311
     C                     END                                            S01311
      *                                                                   S01311
     C           MODULE    IFEQ 'DL'                                      S01311
     C/COPY WNCPYSRC,GL4442C043
     C                     CALL 'DL0170'                                  S01311
     C/COPY WNCPYSRC,GL4442C044
     C                     ELSE                                           S01311
     C           MODULE    IFEQ 'LE'                                      S01311
      *                                                                                      BUG9014
     C           REFER     IFEQ FCLTY                                                        BUG9014
     C           *LOCK     IN   EMSDS                                                        BUG9014
     C                     MOVE ' '       RETND                                              BUG9014
     C                     MOVE *BLANKS   RQDTW  18                                          BUG9014
     C                     MOVELRQDTW     RQDTD                                              BUG9014
     C                     MOVE RFRNUM    RQTMP  11                                          BUG9014
     C                     MOVELACUST     RQTMP                                              BUG9014
     C                     MOVELRQTMP     RQDTD                                              BUG9014
     C                     MOVE 'LE'      RQDTD                                              BUG9014
     C                     OUT  EMSDS                                                        BUG9014
      *                                                                                      BUG9014
     C                     CALL 'LE0170'                                                     BUG9014
     C                     PARM           WFCDT   1                                          BUG9014
     C                     ELSE                                                              BUG9014
     C                     CALL 'LE0190'                                  S01311
     C                     ENDIF                                                             BUG9014
      *                                                                                      BUG9014
     C                     ELSE                                           S01311
     C           MODULE    IFEQ 'FT'                                      096486
     C                     EXSR FTENQ                                     096486
     C                     ELSE                                           096486
     C                     MOVE ABITM     NBITM   30                                        BUG24143
     C           ABTCH     IFNE *BLANKS                                                     BUG24143
     C           NBITM     ANDNE*ZERO                                                       BUG24143
     C           PSTD      IFEQ RNDT                                                        MD053510
     C                     MOVE *BLANKS   RET123  7                                           263647
     C                     ELSE                                                             MD053510
     C                     MOVEL'H'       RET123                                              263647
     C                     ENDIF                                                            MD053510
     C                     CALL 'GL0123E'                                                   BUG24143
     C**********           PARM *BLANKS   @RTCD                                      BUG24143 263647
     C                     PARM           RET123                                              263647
     C                     PARM           ABTCH                                             BUG24143
     C                     PARM           NBITM                                             BUG24143
     C                     PARM           PSTD                                              BUG24339
     C                     PARM           WOPTN                                             BUG26687
     C********** @RTCD     IFNE *BLANKS                                            BUG24143 MD053510
     C           RET123    IFNE *BLANKS                                                     MD053510
     C                     SETON                     32                                     BUG24143
     C                     MOVELEMSG,4    ERRDSP                                            BUG24143
     C                     ENDIF                                                            BUG24143
     C                     ELSE                                                             BUG24143
     C                     SETON                     32                   S01311
     C                     MOVELEMSG,4    ERRDSP                          S01311
     C                     ENDIF                                                            BUG24143
     C                     END                                            S01311
     C                     END                                            S01311
     C                     END                                            096486
      *                                                                                       CAP204
     C           CAP204    IFEQ 'Y'                                                           CAP204
     C           MODULE    ANDEQ'TX'                                                          CAP204
      *                                                                                       CAP204
      ** Check if record has already been dropped                                             CAP204
      *                                                                                       CAP204
     C           KEYHAT    CHAINGLHATML1             99                                       CAP204
     C           *IN99     IFEQ '0'                                                           CAP204
     C                     MOVELEMSG,5    ERRDSP                                              CAP204
     C                     ELSE                                                               CAP204
     C                     MOVELEMSG,4    ERRDSP                                              CAP204
     C                     ENDIF                                                              CAP204
     C                     ENDIF                                                              CAP204
      *  REFNUM non numeric                                               S01311
     C                     ELSE                                           S01311
     C/COPY WNCPYSRC,GL4442C039
     C                     SETON                     32                   S01311
     C           S01472    IFEQ 'N'                                                         AR747061
     C                     MOVELEMSG,6    ERRDSP                                            AR747061
     C                     ELSE                                                             AR747061
     C                     MOVELEMSG,4    ERRDSP                          S01311
     C                     ENDIF                                                            AR747061
     C/COPY WNCPYSRC,GL4442C047
     C                     GOTO EOPTN                                     S01311
     C                     END                                            S01311
     C/COPY WNCPYSRC,GL4442C040
      *                                                                   S01311
     C                     IN   EMSDS                                     S01311
     C                     IN   DLSDS                                     S01311
      *                                                                   S01311
      ****Test*for*database error in called programs                S01311E36720
      **  If posting due to Dealing module, record may not have been      E36720
      **  found due to deletion of deal. So just display 'No Details'.    E36720
      *                                                                   S01311
     C           MODULE    IFEQ 'DL'                                      S01311
     C           DRETN     IFEQ 'E'                                       S01311
     C*********************MOVEL'GL4442  'DBPGM                     S01311E36720
     C*********************MOVEL'PROGRAM 'ZDB14  14                 S01311E36720
     C*********************MOVE 'DL0170'  ZDB14                     S01311E36720
     C*********************MOVEL' DEAL '  ZDB12  12                 S01311E36720
     C*********************MOVE REFNUM    ZDB12                     S01311E36720
     C*********************MOVELZDB14     DBKEY                     S01311E36720
     C*********************MOVE ZDB12     DBKEY                     S01311E36720
     C************LOCK*****IN   @LDA                                S01311E36720
     C*********************MOVE DBERR     @LDA                      S01311E36720
     C*********************OUT  @LDA                                S01311E36720
     C************LOCK*****IN   EMSDS                               S01311E36720
     C*********************MOVE DRETN     RETND                     S01311E36720
     C*********************OUT  EMSDS                               S01311E36720
     C*********************SETON                     U1LR           S01311E36720
     C*********************RETRN                                    S01311E36720
     C                     SETON                     32                   E36720
     C                     MOVELEMSG,4    ERRDSP                          E36720
     C                     END                                            S01311
     C                     END                                            S01311
      *                                                                   S01311
     C           MODULE    IFEQ 'LE'                                      S01311
     C           RETND     IFEQ 'E'                                       S01311
     C                     MOVEL'GL4442  'DBPGM                           S01311
     C                     MOVEL'PROGRAM 'ZDB14  14                       S01311
      *                                                                                      BUG9014
     C           REFER     IFEQ FCLTY                                                        BUG9014
     C                     MOVE 'LE0170'  ZDB14                                              BUG9014
     C                     MOVEL'FACLTY'  ZDB12                                              BUG9014
     C                     ELSE                                                              BUG9014
     C                     MOVE 'LE0190'  ZDB14                           S01311
     C                     ENDIF                                                             BUG9014
      *                                                                                      BUG9014
     C                     MOVEL' LOAN '  ZDB12  12                       S01311
     C**********           MOVE REFNUM    ZDB12                     S01311124565
     C                     MOVE RFRNUM    ZDB12                           124565
     C                     MOVELZDB14     DBKEY                           S01311
     C                     MOVE ZDB12     DBKEY                           S01311
     C           *LOCK     IN   @LDA                                      S01311
     C                     MOVE DBERR     @LDA                            S01311
     C                     OUT  @LDA                                      S01311
     C                     SETON                     U1LR                 S01311
     C                     DUMP                                                               243661
     C                     RETRN                                          S01311
     C**********           DUMP                                                        080994 243661
     C                     END                                            S01311
     C           RETND     IFEQ 'N'                                       136277
     C                     SETON                     32                   136277
     C                     MOVELEMSG,4    ERRDSP                          136277
     C                     ENDIF                                          136277
     C                     END                                            S01311
      *                                                                   S01311
      *   Test for F1 or F3 pressed in lower program                      S01311
      *                                                                   S01311
     C           MODULE    IFEQ 'LE'                                      S01311
     C           RETND     IFEQ 'Q'                                       S01311
     C           RETND     OREQ 'S'                                       S01311
     C           MODI      ANDNE*BLANKS                                   S01311
     C                     SETON                     LR                   S01311
     C                     RETRN                                          S01311
     C                     END                                            S01311
     C                     END                                            S01311
      *                                                                   S01311
     C           MODULE    IFEQ 'DL'                                      S01311
     C           DRETN     IFEQ 'Q'                                       S01311
     C           DRETN     OREQ 'S'                                       S01311
     C           MODI      ANDNE*BLANKS                                   S01311
     C           *LOCK     IN   EMSDS                                     S01311
     C                     MOVE DRETN     RETND                           S01311
     C                     OUT  EMSDS                                     S01311
     C                     SETON                     LR                   S01311
     C                     RETRN                                          S01311
     C                     END                                            S01311
     C                     END                                            S01311
     C*                                                                   096486
     C           MODULE    IFEQ 'FT'                                      096486
     C/COPY WNCPYSRC,GL4442C041
     C           @RFTCD    IFEQ 'E'                                       096486
     C                     MOVE '1'       *IN32                           096486
     C                     MOVELEMSG,4    ERRDSP                          096486
     C                     ENDIF                                          096486
     C           @RFTCD    IFEQ '1'                                       096486
     C                     MOVE '1'       *INLR                           096486
     C                     RETRN                                          096486
     C                     ENDIF                                          096486
     C                     ENDIF                                          096486
      *                                                                   S01311
     C                     END                                            S01311
     C                     END                                            058799
     C                     END                                            S01311
     C                     END                                            S01311
      *                                                                   S01311
     C           EOPTN     TAG                                            S01311
      *                                                                   S01311
     C/COPY WNCPYSRC,GL4442C010
     C                     ENDSR                                          S01311
      *                                                                   S01311
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP19                                           S01408
     C*                                                                   S01408
      /TITLE         <<< CMD SR. >>>                                      S01311
     C*****************************************************************   S01311
      *                                                               *   S01311
      *  CMD - SUBROUTINE TO VALIDATE COMMAND KEYS                    *   S01311
      *                                                               *   S01311
      *  Calls      RETSR   - Process command keys                    *   S01311
      *                                                               *   S01311
      *  Called by  MAIN    - Main processing                         *   S01311
      *                                                               *   S01311
      *****************************************************************   S01311
0741  *                                                                   S01311
0740 C           CMD       BEGSR                                          S01311
      *                                                                   S01311
      *   Validate Command Keys                                           S01311
      *                                                                   S01311
     C           *INKA     IFEQ '1'                                       S01311
     C                     MOVE 'S'       RETNWF  1                       S01311
     C                     EXSR RETSR                                     S01311
     C                     END                                            S01311
      *                                                                   S01311
     C           *INKL     IFEQ '1'                                       S01311
     C                     MOVE 'U'       RETNWF                          S01311
     C                     EXSR RETSR                                     S01311
     C                     END                                            S01311
      *                                                                   S01311
     C                     ENDSR                                          S01311
      *                                                                   S01311
      /TITLE         <<< RETSR SR. >>>                                    S01311
     C*****************************************************************   S01311
      *                                                               *   S01311
      *  RETSR - SUBROUTINE TO PROCESS COMMAND KEYS                   *   S01311
      *                                                               *   S01311
      *  Called by  CMD     - Command key validation subroutine       *   S01311
      *             MAIN    - Main processing                         *   S01311
      *                                                               *   S01311
      *****************************************************************   S01311
0741  *                                                                   S01311
0740 C           RETSR     BEGSR                                          S01311
0741  *                                                                   S01311
0742 C                     SETON                     LR                   S01311
0392  *  Access EM Data Area                                              S01311
0405 C           *LOCK     IN   EMSDS                                     S01311
0402 C                     MOVE RETNWF    RETND                           S01311
0405 C                     OUT  EMSDS                                     S01311
0743 C                     RETRN                                          S01311
0744  *                                                                   S01311
0745 C                     ENDSR                                          S01311
0744  *                                                                   S01311
      /TITLE         <<< ENTR SR. >>>
     C*****************************************************************
     C*
     C* ENTR --- SUBROUTINE CALLED ON ENTER BEING PRESSED
     C*
     C* 1. VALIDATES INPUT CRITERIA
     C* 2. FOR VALID INPUT, IF A/C CHANGED, GETS A/C AND CLIENT DETAILS
     C* 3. BUILDS AND DISPLAYS SUBFILE OF VALID RECORDS
     C*
     C* CALLED FROM: MAIN PROCESSING, LDA
     C*
     C* CALLS: FLDCHG, VALID, STORE, BSFIL1, BSFIL2 (S/R)
     C*        AOCUSTR0 (PROGRAM)
     C*
     C*****************************************************************
     C*
     C           ENTR      BEGSR                           ** ENTR **
     C*
     C* ONLY VALIDATE AND RE-OUTPUT IF USER I/P HAS CHANGED
     C*
     C                     EXSR FLDCHG
     C*
     C           *IN12     IFEQ '1'
     C*
     C*
     C* CLEAR ALL OLD RECORDS FROM THE SUBFILE
     C*
     C                     Z-ADD1         RRN                             058799
     C                     Z-ADD1         @RRN                            058799
     C                     SETOF                     0203
     C/COPY WNCPYSRC,GL4442C011
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     WRITESFLCTLRA                                                      CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     WRITESFLCTLR
     C/COPY WNCPYSRC,GL4442C012
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     SETON                       03
     C*
     C                     EXSR VALID
     C*                                                                   LN1295
      * If no errors and feature not off, check user authority            CRE024
      * to account code                                                   CRE024
     C           CRE024    IFNE 'N'                                       CRE024
     C           *IN51     ANDEQ'0'                                       CRE024
     C                     CALL 'SF0930'                                  CRE024
     C                     PARM           CRE024  1                       CRE024
     C                     PARM *BLANKS   UMAUTH  1                       CRE024
     C                     PARM KCOD      UMACOD 100                      CRE024
     C**********           PARM KCUS      UMCNUM  60                                 CRE024 BUG11679
     C                     PARM KCUS      UMCNUM  6                                         BUG11679
     C                     PARM KCCY      UMCCY   3                       CRE024
     C                     PARM KASE      UMACSQ  20                      CRE024
     C                     PARM KBRC      UMBRCA  3                       CRE024
     C                     PARM 'GL4442'  UMPGM  10                       CRE024
     C                     PARM '*REPT'   UMOPTN  5                       CRE024
     C                     PARM *BLANKS   UMEMSG 50                       CRE024
      *                                                                   CRE024
      * If user not authorised, set on error indicators                   CRE024
     C           UMAUTH    IFEQ 'N'                                       CRE024
     C                     MOVEA'11'      *IN,50                          CRE024
     C                     MOVELUMEMSG    ERRDSP    P                     CRE024
     C                     END                                            CRE024
     C                     END                                            CRE024
     C/COPY WNCPYSRC,GL4442C013
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     WRITESFLCTLRA                                                      CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     WRITESFLCTLR                                   LN1295
     C/COPY WNCPYSRC,GL4442C014
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*
     C* IF A/C HAS CHANGED ...
     C*
     C           *IN60     IFEQ '1'
     C*
     C* IF A/C IS FOR AN UNALLOCATED NOSTRO THEN DONT DISPLAY
     C*   ANY ACCOUNT DETAILS
     C*
     C           *IN15     IFEQ '1'                        ** B003
     C                     SETON                     51
     C                     MOVELEMSG,2    ANAM
     C                     END                             ** E003
     C*
     C* IF USER IS AUTHORISED TO ACCOUNT BRANCH                           LN1274
     C* IF A/C VALID - SETUP ACCOUNT DETAILS
     C*
     C           *IN52     IFEQ '0'                                       LN1274
     C           *IN51     IFEQ '0'
     C*
     C                     EXSR ACDETS
     C*
     C                     SETON                     20
     C                     ELSE
     C                     SETOF                     20
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP12                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     WRITESTATICA                                                       CGL131
     C   14                WRITECLEARA                                                        CGL131
     C   14                WRITECLEARB                                                        CGL131
     C  N14                WRITENOSTA                                                         CGL131
     C  N14                WRITENOSTB                                                         CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C                     WRITESTATIC1
     C   14                WRITECLEAR1
     C***14*****           WRITECLEAR2                                                       BUG4738
     C  N14                WRITENOST1
     C**N14*****           WRITENOST2                                                        BUG4738
     C/COPY WNCPYSRC,GL4442C015
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
      *                                                                   CGL183
      * Only write to file REEAUDPP if CGL183 is on and no audit yet      CGL183
      *                                                                   CGL183
     C           *IN60     IFEQ '1'                                       CGL183
     C           *IN50     ANDNE'1'                                       CGL183
     C                     MOVE 'N'       AUDIT                           CGL183
     C                     ENDIF                                          CGL183
      *                                                                   CGL183
     C           CGL183    IFEQ 'Y'                                       CGL183
     C           AUDIT     ANDNE'Y'                                       CGL183
     C           VLACMV    ANDEQ'Y'                                       CGL183
      *                                                                   CGL183
      * Format the fields for output                                      CGL183
      *                                                                   CGL183
     C                     MOVELSUSER     LG1ID                           CGL183
     C                     MOVELSWSID     LG1WRK                          CGL183
      *                                                                   CGL183
      * Format Time and Date (ccyymmdd) Fields.                           CGL183
      *                                                                   CGL183
     C                     TIME           TIMDAT                          CGL183
     C                     Z-ADDWTIM      LG1TIM                          CGL183
     C                     Z-ADDISODAT    LG1DAT                          CGL183
      *                                                                   CGL183
     C                     Z-ADDACNO      LG1RTN                          CGL183
     C                     MOVELKBRC      LG1BRN                          CGL183
     C                     MOVE KCUS      LG1CUN                          CGL183
     C                     MOVELKCCY      LG1CCY                          CGL183
     C                     Z-ADDKCOD      LG1ACD                          CGL183
     C                     Z-ADDKASE      LG1ASQ                          CGL183
     C                     MOVEL'AM'      LG1ZDR                          CGL183
     C                     MOVEL'A'       LG1TYP                          CGL183
     C                     MOVE *BLANKS   LG1REF                          CGL183
      *                                                                   CGL183
     C                     WRITEREEAUDR1                                  CGL183
     C                     MOVE 'Y'       AUDIT                           CGL183
      *                                                                   CGL183
     C                     ENDIF                                          CGL183
      *                                                                   CGL183
     C*
     C                     END
     C                     END                                            LN1274
     C*
     C* IF NEW USER I/P IS VALID, STORE.
     C*
     C           *IN50     IFEQ '0'
     C*
     C                     EXSR STORE
     C                     EXSR SCRN1
     C*
     C                     ELSE
     C*
     C*
     C*
     C                     END
     C*     WRITE SUB-FILE HEADING
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CCP3                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     WRITESTATICB                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C                     WRITESTATIC2
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CCP4                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C***IF*INPUT*HAS*NOT*CHANGED*ENSURE*THAT*THE*SUBFILE*IS*             S01311
     C******REDISPLAYED*AT*THE*SAME*POSTION***                            S01311
     C*
     C                     ELSE
     C*
     C                     SETON                     33                   S01311
     C                     Z-ADDCPFPOS    DSPREC
     C*
     C                     END
     C*
     C                     ENDSR                           ** ENTR **
     C*
     C*
      /TITLE         <<< CMD5 SR. >>>
     C*****************************************************************
     C*
     C* CMD5 --- REFRESH SCREEN WITH CURRENT DETAILS
     C*
     C* 1. RESTORE OLD USER I/P FIELDS, IF ANY CHANGED
     C* 2. CLEAR AND RESET SUBFILE
     C* 3. RE-LOAD FROM FIRST OF SELECTED RECORDS
     C*
     C* CALLED FROM: MAIN PROCESSING
     C*
     C* CALLS: FLDCHG, RSTOR, BSFIL1, BSFIL2
     C*
     C*****************************************************************
     C*
     C           CMD5      BEGSR                           ** CMD5 **
     C*
     C* IN02 CONDITIONS CLEAR/RESET OF SUBFILE...
     C*
     C                     EXSR FLDCHG
     C*
     C           *IN12     IFEQ '1'
     C                     EXSR RSTOR
     C                     END
     C*
     C*
     C* CLEAR ALL OLD RECORDS FROM THE SUBFILE
     C*
     C                     SETOF                     0203
     C/COPY WNCPYSRC,GL4442C016
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     WRITESFLCTLRA                                                      CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     WRITESFLCTLR
     C/COPY WNCPYSRC,GL4442C017
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     SETON                       03
     C                     EXSR SCRN1
     C*
     C                     ENDSR                           ** CMD5 **
     C*
      /TITLE         <<< SCRN1 SR. >>>
     C*****************************************************************
     C*
     C* SCRN1 -- REBUILD SUBFILE FROM THE FIRST RECORD
     C*
     C* 1. RESET RELATIVE RECORD NUMBERS
     C* 2. CLEAR THE SUBFILE
     C**3**D*T*RM*NE*IF*APOSTL1 OR APOSTL2 IS TO BE USED                  165546
     C* 3. DETERMINE IF APOSTL1 OR APOSTL2 OR APOSTL9 IS TO BE USED       165546
     C* 4. LOAD FIRST PAGE OF SUBFILE RECORDS
     C*
     C* CALLED FROM: ENTR, CMD5
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           SCRN1     BEGSR                           ** SCRN1 **
     C*
     C* RESET SUBFILE AND FILE RECORD POINTER
     C*
     C                     Z-ADD1         RRN     40
     C                     Z-ADD1         @RRN    40                      058797
     C***********          SETOF                     048083               S01311
     C                     SETOF                       8083               S01311
     C***********          SETON                     04            S01311 058797
     C                     SETOF                     04                   058797
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP20                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
      *                                                                                       CGL131
     C           CGL131    OREQ 'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
     C           *IN41     IFEQ '0'                                       165546
     C*                                                                   S01408
     C           CQKEY     IFEQ *ZEROS
     C*
     C*  IF A '-' WAS ENTERED WE DISPLAY ANY DR/CR <= THE AMOUNT
     C*  IF A '+' WAS ENTERED OR JUST AN AMOUNT WE DISPLAY ANY
     C*      DR/CR >= THE AMOUNT
     C*
     C           PORM      IFEQ '-'
     C                     Z-ADD0         AMTKY  130
     C                     ELSE
     C                     Z-ADDAMTNUM    AMTKY
     C                     END
     C*
     C                     Z-ADD0         DORK    10
     C           KEYSL1    SETLLAPOSTL1
     C           KEYEQ     READEAPOSTL1                  80
     C                     MOVE SPOS      SPOSP                           183365
     C*
     C                     EXSR BSFIL1
     C*
     C                     ELSE
     C*
     C/COPY WNCPYSRC,GL4442C025
     C                     MOVE *BLANK    POSDA
     C/COPY WNCPYSRC,GL4442C026
     C*
     C           KEYSL2    SETLLAPOSTL2
     C           KEYEQ     READEAPOSTL2                  80
     C                     MOVE SPOS      SPOSP                           183365
     C*
     C                     EXSR BSFIL2
     C*
     C                     END
     C                     ENDIF                                          165546
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP21                                           S01408
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
      ** RESET SUBFILE AND FILE RECORD POINTER                                                CGL131
      *                                                                                       CGL131
     C                     MOVE ' '       TODAY   1                                           CGL131
      *                                                                                       CGL131
     C           CQKEY     IFEQ *ZEROS                                                        CGL131
      *                                                                                       CGL131
     C           AMONT     IFEQ *BLANKS                                                       CGL131
      *                                                                                       CGL131
     C                     Z-ADD0         DORK    10                                          CGL131
     C           POSDN     IFGE RNDT                                                          CGL131
     C                     MOVE '1'       TODAY                                               CGL131
     C                     ELSE                                                               CGL131
     C                     MOVE '2'       TODAY                                               CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           TODAY     IFEQ '1'                                                           CGL131
     C                     MOVE 99999     POSDN                                             MD020122
     C           KEYSL1    SETLLRSACMTLD                                                      CGL131
     C           KEYEQ     READERSACMTLD                 80                                   CGL131
     C                     MOVELFORMA5    FORMAT 10                                           CGL131
      *                                                                                       CGL131
      ** IF EOF ON TODAYS POSTINGS                                                            CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ *ON                                                           CGL131
     C                     MOVE RNDT      POSDN                                               CGL131
     C           KEYSL1    SETLLAPOSTL38                                                      CGL131
     C                     MOVE '2'       TODAY                                               CGL131
     C                     MOVE *OFF      *IN80                                               CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           TODAY     IFEQ '2'                                                           CGL131
     C           KEYSL1    SETLLAPOSTL38                                                      CGL131
     C           KEYEQ     READEAPOSTL38                 80                                   CGL131
     C                     MOVELFORMA1    FORMAT 10                                           CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     EXSR BSFIL1                                                        CGL131
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
      ** IF A '-' WAS ENTERED WE DISPLAY ANY DR/CR <= THE AMOUNT                              CGL131
      ** IF A '+' WAS ENTERED OR JUST AN AMOUNT WE DISPLAY ANY                                CGL131
      **     DR/CR >= THE AMOUNT                                                              CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '-'                                                           CGL131
     C                     Z-ADD0         AMTKY  130                                          CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '+'                                                           CGL131
     C           PORM      OREQ ' '                                                           CGL131
     C                     Z-ADDAMTNUM    AMTKY                                               CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '%'                                                           CGL131
     C           AMTNUM    MULT 0.8       AMTKY            LIM <                              CGL131
     C           AMTNUM    MULT 1.2       AMTKYG 130       LIM >                              CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     MOVE *BLANK    POSDA                                               CGL131
     C                     Z-ADD0         DORK    10                                          CGL131
     C                     MOVE '1'       TODAY                                               CGL131
      *                                                                                       CGL131
     C           KEYSL3    SETLLRSACMTLC                                                      CGL131
     C           KEYEQ     READERSACMTLC                 80                                   CGL131
     C                     MOVELFORMA7    FORMAT 10                                           CGL131
      *                                                                                       CGL131
     C                     EXSR BSFIL3                                                        CGL131
      *                                                                                       CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     MOVE *BLANK    POSDA                                               CGL131
      *                                                                                       CGL131
     C                     MOVE '1'       TODAY                                               CGL131
      *                                                                                       CGL131
     C           KEYSL2    SETLLRSACMTLB                                                      CGL131
     C           KEYEQ     READERSACMTLB                 80                                   CGL131
     C                     MOVELFORMA7    FORMAT 10                                           CGL131
      *                                                                                       CGL131
     C                     EXSR BSFIL2                                                        CGL131
      *                                                                                       CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
      *                                                                                       CGL131
     C           *IN41     IFEQ '1'                                       165546
     C           CGL131    ANDNE'Y'                                                        AR1096350
     C           *IN41     OREQ '1'                                                         MD021130
     C           CGL131    ANDEQ'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
     C           PCKEY     IFEQ *BLANK                     ** B001        165546
     C*  IF A '-' WAS ENTERED WE DISPLAY ANY DR/CR <= THE AMOUNT          165546
     C*  IF A '+' WAS ENTERED OR JUST AN AMOUNT WE DISPLAY ANY            165546
     C*      DR/CR >= THE AMOUNT                                          165546
     C           PORM      IFEQ '-'                                       165546
     C                     Z-ADD0         AMTKY  130                      165546
     C                     ELSE                                           165546
     C                     Z-ADDAMTNUM    AMTKY                           165546
     C                     END                                            165546
     C                     Z-ADD0         DORK    10                      165546
     C           KEYSL1    SETLLAPOSTL1                                   165546
     C           KEYEQ     READEAPOSTL1                  80               165546
     C                     MOVE SPOS      SPOSP                           183365
     C                     EXSR BSFIL1                                    165546
     C                     ELSE                            ** X001        165546
     C                     MOVE *BLANK    POSDA                           165546
     C           KEYSL9    SETLLAPOSTL9                                   165546
     C           KEYEQ     READEAPOSTL9                  80               165546
     C                     MOVE SPOS      SPOSP                           183365
     C                     EXSR BSFIL2                                    165546
     C                     END                             ** E001        165546
     C                     ENDIF                                          165546
     C*                                                                   S01408
     C*
     C*  DISPLAY MESSAGE - IF NO RECORDS WERE WRITTEN TO THE SUBFILE
     C*
     C           *IN83     IFEQ '0'
     C                     MOVE EMSG,1    ERRDSP
     C/COPY WNCPYSRC,GL4442C028
     C                     SETON                     50
     C                     END
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP45                                           S01408
     C*                                                                   S01408
     C                     ENDSR                           ** SCRN1 **
     C*
      /TITLE         <<< FLDCHG SR. >>>
     C*****************************************************************
     C*
     C* FLDCHG --- SUBROUTINE TO SET FIELDS CHANGED? INDICATORS
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           FLDCHG    BEGSR                           ** FLDCHG **
     C*
     C           MBIN      IFEQ 'Y'                                       S01117
     C           MBACNT    COMP MBACSV               6060                 S01117
     C                     ELSE                                           S01117
     C           ACNT      COMP ACSV                 6060
     C                     END                                            S01117
     C           POSDA     COMP PDSV                 6161
     C           PORM      COMP POSV                 6262
     C           AMONT     COMP AMSV                 6363
     C**N63***** CQNMR     COMP CHSV                 6363                 165546
     C  N63N41   CQNMR     COMP CHSV                 6363                 165546
     C  N63 41   PCAMR     COMP PCSV                 6363                 165546
     C*                                                                   072626
     C*  If account has changed force validation of posting date          072626
     C           *IN60     IFEQ '1'                                       072626
     C                     MOVE '1'       *IN61                           072626
     C                     END                                            072626
     C*
     C* IF THIS IS THE FIRST TIME INTO THE PROGRAM
     C*   OR INVALID INPUT WAS ENTERED PREVIOUSLY
     C*    THEN FORCE VALIDATION TO TAKE PLACE
     C*
     C           *IN01     IFEQ '0'
     C           *IN50     OREQ '1'
     C/COPY WNCPYSRC,GL4442C001
     C                     SETON                     016061
     C                     SETON                     6263
     C                     END
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP22                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
      *                                                                                       CGL131
     C           *INKE     IFEQ '1'                                                           CGL131
     C                     SETON                     6061                                     CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C           *IN60     IFEQ '1'
     C           *IN61     OREQ '1'
     C           *IN62     OREQ '1'
     C           *IN63     OREQ '1'
     C                     SETON                     12
     C                     ELSE
     C                     SETOF                     12
     C                     END
     C*
     C                     ENDSR                           ** FLDCHG **
     C*
      /TITLE         <<< VALID SR. >>>
     C*****************************************************************
     C*
     C* VALID --- SUBROUTINE TO PERFORM INITIAL PROCESSING
     C*
     C* 1. VALIDATES USER-I/P SEARCH CRITERIA, AND SETS APPROPRIATE
     C* ERROR INDICATORS FOR ANY INVALID FIELDS
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: ZDATE1, ZALIGN (STANDARD S/RS); AOACCTV0 (PROGRAM)
     C*
     C*****************************************************************
     C*
     C           VALID     BEGSR                           ** VALID **
     C*
     C* CLEAR ERROR CODE ARRAY AND SETOF INVALID INDICATOR
     C*
     C                     MOVE *BLANKS   P@ALL
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD1         I       20
     C*
     C                     SETOF                     5051
     C                     SETOF                     646566
     C                     SETOF                     6768
     C*
     C* IF A/C FIELD HAS CHANGED...
     C*
     C           *IN60     IFEQ '1'
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CVKS                                           S01408
     C*                                                                   S01408
     C*
     C* ...VALIDATE A/C --- BLANK=>INVALID / P@RTCD<>BLANK=>NOT ON FILE
     C*
     C           CNUMR     IFEQ *BLANKS
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CVK1                                           S01408
     C*                                                                   S01408
     C                     SETON                     505164
     C                     MOVE ' 001'    ERCD,I
     C                     ADD  1         I
     C                     ELSE
     C*                                                                   LN1295
     C**  CHECK FOR BRANCH AUTHORITY NOW DONE AFTER ACCESS TO             LN1295
     C**  ACCOUNT TO PICK UP BRANCH FOR NOSTRO CODE/SHORTNAME             LN1295
     C*                                                                   LN1295
     C***********                                                   S01117LN1295
     C**CHECK*THAT*USER*IS*AUTHORISED*TO*BRANCH******               S01117LN1295
     C***********MBIN      IFEQ 'Y'                                 S01117LN1295
     C***********BRNCH     IFNE *BLANKS                             S01117LN1295
     C***********                                                   S01117LN1295
     C***********          CALL 'ZVBBU'                             S01117LN1295
     C***********          PARM           BRNCH                     S01117LN1295
     C***********          PARM *ZERO     ERRCOD  10                S01117LN1295
     C***********                                                   S01117LN1295
     C***********ERRCOD    IFNE 0                                   S01117LN1295
     C***********          SETON                     505264         S01117LN1295
     C***********          MOVE ' 010'    ERCD,I                    S01117LN1295
     C***********          ADD  1         I                         S01117LN1295
     C***********          END                                      S01117LN1295
     C***********          END                                      LN1273LN1295
     C***********          END                                      LN1273LN1295
     C***********                                                   S01117LN1295
     C***********          ELSE                                     S01117LN1273
     C*                                                                   LN1273
     C           BRNCH     IFEQ *BLANKS                                   LN1273
     C*                                                                   S01117
     C* IF BRANCH IS LEFT BLANK AND FULL GENERAL LEDGER ACCOUNT IS USED   S01117
     C* OBTAIN DEFAULT BRANCH FROM ZMUSER                                 S01117
     C*                                                                   S01117
     C           CNUMR     IFNE *BLANKS                                   S01117
     C           CURRY     ANDNE*BLANKS                                   S01117
     C           ACCOD     ANDNE*BLANKS                                   S01117
     C           ACSEQ     ANDNE*BLANKS                                   S01117
     C                     MOVELBRC       BRNCH                           S01117
     C                     END                                            S01117
     C***********          END                                      S01117LN1273
     C***********          END                                      S01117LN1273
     C                     END                                            LN1273
     C*
     C* AOACCTV0 IS AN EXTERNAL PROGRAM WHICH ACCESSES A/C DETAILS
     C*
     C                     CALL 'AOACCTV0'
     C                     PARM           P@RTCD  7                       S01117
     C                     PARM CNUMR     P@KEY1 10
     C                     PARM CURRY     P@KEY2  3
     C**********           PARM ACCOD     P@KEY3  4                                           CGL029
     C                     PARM ACCOD     P@KEY3 10                                           CGL029
     C                     PARM ACSEQ     P@KEY4  2
     C                     PARM BRNCH     P@KEY5  3                       S01117
     C                     PARM           P@TYPE  7
     C                     PARM           P@NOSN  2
     C*********************PARM           P@FMT1                          LN0130
     C           P@FMT1    PARM P@FMT1    DSSDY                           LN0130
     C*
     C* IF INVALID ACCOUNT CHECK TO SEE IF ITS AN UNALLOCATED ACCOUNT
     C*
     C                     SETOF                     15
     C           P@RTCD    IFNE *BLANKS                    ** B003
     C/COPY WNCPYSRC,GL4442C029
     C                     EXSR UNALOC
     C                     END                             ** E003
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP14                                           S01408
     C*                                                                   S01408
     C*
     C           P@RTCD    IFNE *BLANKS
     C           P@RTCD    ANDNE'*ACST  '                                                     202528
     C/COPY WNCPYSRC,GL4442C030
     C                     SETON                     505164
     C                     MOVE ' 002'    ERCD,I
     C                     ADD  1         I
     C                     ELSE
      *                                                                                       CGL037
     C           CGL037    IFEQ 'Y'                                                           CGL037
      *                                                                                       CGL037
      ** If indicator U5 is OFF, Account Code must have Account                               CGL037
      ** Type 'R' and A/C Subtype not equal to ('V' or 'I')                                   CGL037
      *                                                                                       CGL037
     C                     SETOF                     14                                       CGL037
     C           *INU5     IFEQ '0'                        ** B004                            CGL037
     C           ATYP      IFEQ 'R'                        ** B005                            CGL037
     C                     SETON                     14                                       CGL037
     C           STYP      IFEQ 'V'                        ** B006                            CGL037
     C           STYP      OREQ 'I'                                                           CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE ' 013'    ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E006                            CGL037
     C                     ELSE                            ** X005                            CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE ' 013'    ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E005                            CGL037
     C                     ELSE                            ** X004                            CGL037
      *                                                                                       CGL037
      ** If indicator U5 is ON, then Account Type should not be                               CGL037
      ** 'R'. If it is 'R', Account Subtype must be 'V' or 'I'.                               CGL037
      *                                                                                       CGL037
     C           ATYP      IFEQ 'R'                        ** B005                            CGL037
     C                     SETON                     14                                       CGL037
     C           STYP      IFNE 'V'                        ** B006                            CGL037
     C           STYP      ANDNE'I'                                                           CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE ' 014'    ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E006                            CGL037
     C                     END                             ** E005                            CGL037
     C                     END                             ** E004                            CGL037
      *                                                                                       CGL037
     C                     ELSE                                                               CGL037
      *                                                                                       CGL037
     C           ATYP      IFEQ 'R'                                                           CGL037
     C                     SETON                     14                                       CGL037
     C                     ELSE                                                               CGL037
     C           ATYP      IFEQ 'N'                        ** B005                            CGL037
     C           ATYP      OREQ 'G'                                                           CGL037
     C           ATYP      OREQ 'D'                                                           CGL037
     C           ATYP      OREQ 'C'                                                           CGL037
     C                     SETOF                     14                                       CGL037
     C                     ELSE                            ** X005                            CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE '002'     ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E005                            CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
      ** Access Customer details.                                                             CGL186
      *                                                                                       CGL186
     C                     CALL 'AOCUSTR2'                                                    CGL186
     C                     PARM *BLANKS   P@RTCD  7                                           CGL186
     C                     PARM '*KEY'    P@OPTN  7                                           CGL186
     C                     PARM KCUSA     P@KEY1 10                                           CGL186
     C                     PARM           P@ANY   7                                           CGL186
     C           P@FMT3    PARM P@FMT3    DSLDY                                               CGL186
      *                                                                                       CGL186
     C/COPY WNCPYSRC,GL4442C050
     C*                                                                   LN1295
     C***********ATYP      IFEQ 'R'                                       LN1295
     C*                                                                   021117
     C*   CHECK TO SEE IF USER IS AUTHORISED TO BRANCH ASSOCIATED WITH    S01117
     C****REQUESTED*RETAIL*ACCOUNT**********************************S01117LN1295
     C*   REQUESTED ACCOUNT                                               LN1295
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       LN1273
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM           KBRC                            S01117
     C***********          PARM *ZERO     ERRCOD                    S01117LN1295
     C                     PARM *ZERO     ERRCOD  10                      LN1295
     C*                                                                   S01117
     C           ERRCOD    IFNE 0                                         S01117
     C                     SETON                     505164               S01117
     C           ATYP      IFEQ 'R'                                       LN1295
     C                     MOVE ' 011'    ERCD,I                          S01117
     C                     ELSE                                           LN1295
     C                     MOVE ' 010'    ERCD,I                          LN1295
     C                     END                                            LN1295
     C                     ADD  1         I                               S01117
     C                     END                                            S01117
     C                     END                                            LN1273
     C*                                                                   LN1295
     C* CHECK TYPE OF INPUT FROM RETURNED VALUE, IF NOSTRO CODE OR        LN1295
     C* SHORTNAME OR RETAIL NO., BLANK OUT OTHER INPUT FIELDS             LN1295
     C*                                                                   LN1295
     C           P@TYPE    IFEQ '*NOSHNM'                                 LN1295
     C           P@TYPE    OREQ '*NOSTRO'                                 LN1295
     C           P@TYPE    OREQ '*RETAIL'                                 LN1295
     C                     MOVE *BLANKS   CURRY                           LN1295
     C                     MOVE *BLANKS   ACCOD                           LN1295
     C                     MOVE *BLANKS   ACSEQ                           LN1295
     C                     MOVE *BLANKS   BRNCH                           LN1295
     C                     END                                            LN1295
     C*                                                                   S01117
     C           ATYP      IFEQ 'R'                                       LN1295
     C                     SETON                     14
     C                     ELSE
     C***********ATYP      IFEQ 'N'                                       E19970
     C           ATYP      IFEQ 'N'                        ** B005        E20538
     C           ATYP      OREQ 'G'                                       E20538
     C           ATYP      OREQ 'D'                                       E20538
     C           ATYP      OREQ 'C'                                       E20538
     C                     SETOF                     14
     C                     ELSE                            ** X005        E20538
     C                     SETON                     505164               E20538
     C                     MOVE '002'     ERCD,I                          E20538
     C                     ADD  1         I                               E20538
     C                     END                             ** E005        E20538
     C***********          ELSE                                           E19970
     C***********          SETON                     505164               E19970
     C***********          MOVE '002'     ERCD,I                          E19970
     C***********          ADD  1         I                               E19970
     C***********          END                                            E19970
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C* IF POSTING-DATE FIELD HAS CHANGED...
     C*
     C           *IN61     IFEQ '1'
     C*
     C* ...VALIDATE PDAT --- BLANK=>VALID / NON-BLANK: FORMAT?, <RUND?
     C*
     C           POSDA     IFNE *BLANKS
     C*
     C* VALIDATE FORMAT USING MIDAS STANDARD SUBROUTINE
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE POSDA     ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD6         ZADIG
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    ZDATE
     C           *IN99     IFEQ '1'
     C                     MOVE ' 003'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5065
     C                     ELSE
     C*
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    POSDN   50
     C           *IN99     IFEQ '1'
     C                     MOVE ' 003'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5065
     C*
     C                     ELSE
     C*
     C* INVALID IF PDAT IS LATER THAN RUN-DATE
     C*
     C           POSDN     IFGT RNDT
     C                     MOVE ' 003'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5065
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     ELSE
     C*
     C* IF POSTING DATE IS BLANKS THEN RESET TO ZERO
     C*
     C************         Z-ADD0         POSDN                           E21183
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP23                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
      *                                                                                       CGL131
     C           CGL131    OREQ 'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
     C*                                                                   S01408
     C**********           Z-ADDLSTD      POSDN                                        E21183 209031
     C                     Z-ADD0         POSDN                                               209031
     C*                                                                   046902
     C**  To get only postings after last statement date                  046902
     C*                                                                   046902
     C********** CFSB      IFNE 0                                                      046902 209031
     C********** LSTP      ORNE 0                                                      046902 209031
     C********** DACO      ORNE LSTD                                                   046902 209031
     C**********           ADD  1         POSDN                                        046902 209031
     C**********           END                                                         046902 209031
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP24                                           S01408
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
     C                     Z-ADDRNDT      POSDN                                               CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C                     END
     C*                                                                   046902
     C*                                                             046902072626
     C***********          ELSE                                     046902072626
     C*                                                             046902072626
     C****To*get*only*postings*after*last*statement*date*********** 046902072626
     C*                                                             046902072626
     C***********CFSB      IFNE 0                                   046902072626
     C***********LSTP      ORNE 0                                   046902072626
     C***********DACO      ORNE LSTD                                046902072626
     C***********LSTD      ADD  1         POSDN                     046902072626
     C***********          END                                      046902072626
     C*
     C                     END
     C*
     C* IF + OR - (PORM) FIELD HAS CHANGED
     C*
     C           *IN62     IFEQ '1'
     C*
     C/COPY WNCPYSRC,GL4442C018
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
      *                                                                                       CGL131
     C           PORM      IFNE '+'                                                           CGL131
     C           PORM      ANDNE'-'                                                           CGL131
     C           PORM      ANDNE' '                                                           CGL131
     C           PORM      ANDNE'%'                                                           CGL131
     C                     MOVE ' 004'    ERCD,I                                              CGL131
     C                     ADD  1         I                                                   CGL131
     C                     SETON                     5066                                     CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C           PORM      IFNE '+'
     C           PORM      ANDNE'-'
     C           PORM      ANDNE' '
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP25                                           S01408
     C*                                                                   S01408
     C                     MOVE ' 004'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5066
     C                     END
     C/COPY WNCPYSRC,GL4442C019
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*
     C                     END
     C*
     C*
     C* IF AMOUNT FIELD HAS CHANGED
     C*
     C           *IN63     IFEQ '1'
     C           *IN60     OREQ '1'                                       E20463
     C*
     C* ACCESS CCY FILE FOR NO. OF DPS OF CURRENCY
     C*
     C                     CALL 'AOCURRR0'
     C                     PARM           P@RTCD  7
     C                     PARM '*KEY'    P@OPTN  7
     C                     PARM KCCY      P@KEY2
     C***********          PARM           P@FMT2                                              CSD006
     C           P@FMT2    PARM P@FMT2    DSSDY                                               CSD006
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE AMONT     ZFIELD
     C***********          Z-ADDA6DANB    ZADEC                           S01194
     C***********13        SUB  A6DANB    ZADIG                           S01194
     C/COPY WNCPYSRC,GL4442C036
     C                     Z-ADDA6NBDP    ZADEC                           S01194
     C           13        SUB  A6NBDP    ZADIG                           S01194
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     MOVE ' 006'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5067
     C                     ELSE
     C                     MOVE ZFIELD    AMTNUM 130
     C                     END
     C*
     C                     END
     C*
     C* IF + OR - ENTERD, BUT AMOUNT IS BLANK...INVALID
     C*
     C           PORM      IFEQ '+'
     C           PORM      OREQ '-'
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP26                                           S01408
     C*                                                                   S01408
     C*
     C           AMTNUM    IFEQ *ZEROS
     C                     MOVE ' 005'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     506667
     C                     END
     C*
     C                     END
     C*
     C* IF CHEQUE NUMBER <> BLANK
     C           *IN41     IFEQ '0'                                       165546
     C*
     C           CQNMR     IFEQ *BLANKS
     C                     Z-ADD0         CQKEY
     C                     ELSE
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CQNMR     ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD8         ZADIG
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    CQKEY   80
     C           *IN99     IFEQ '1'
     C                     MOVE ' 007'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5068
     C                     END
     C           ATYP      IFNE 'R'
     C/COPY WNCPYSRC,GL4442C037
     C                     MOVE ' 008'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5068
     C                     END
     C           AMTNUM    IFNE *ZEROS
     C                     MOVE ' 009'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5068
     C                     END
     C*
     C                     END
     C                     END                                           165546
     C*                                                                  165546
     C* IF PROFIT CENTRE <> BLANK                                        165546
     C*                                                                  165546
     C           *IN41     IFEQ '1'                                      165546
     C           PCAMR     IFEQ *BLANKS                                  165546
     C                     MOVE *BLANK    PCKEY                          165546
     C                     ELSE                                          165546
     C                     MOVE PCAMR     PCKEY                          184727
     C           AMTNUM    IFNE *ZEROS                                   165546
     C                     MOVE ' 012'    ERCD,I                         165546
     C                     ADD  1         I                              165546
     C                     SETON                     5068                165546
     C                     END                                           165546
     C*                                                                  165546
     C                     END                                           165546
     C                     END                                           165546
     C*                                                                  165546
     C*
     C                     ENDSR                           ** VALID **
     C*
      /TITLE         <<< UNALOC SR. >>>
     C*****************************************************************
     C*
     C* UNALOC --- SUBROUTINE TO CHECK IF UNALLOCATED NOSTRO ENTERED
     C*
     C*
     C* CALLED FROM: VALID
     C*
     C* CALLS:  NOTHING
     C*
     C*****************************************************************
     C*
     C           UNALOC    BEGSR                           ** UNALOC **
     C*
     C           KPRNOA    IFEQ '00'
     C           KPREST    ANDEQ*BLANK
     C           KEYPRN    CHAINPRONO                99
     C*
     C           *IN99     IFEQ '0'
     C                     SETON                     15
     C                     MOVE *BLANK    P@RTCD
     C                     MOVE 'N'       ATYP
     C**********           Z-ADD0         KCUS                                                CSD027
     C                     MOVE *BLANKS   KCUS                                                CSD027
     C                     Z-ADD0         KCOD
     C                     Z-ADD0         KASE
     C                     MOVE KPRCCY    KCCY
     C                     END
     C                     END
     C*
     C                     ENDSR                           ** UNALOC **
     C*
      */TITLE********<<<*ROLP*SR.*>>>*                                    S01311
     C*****************************************************************
     C************                                                        S01311
     C**ROLP*---*SUBROUTINE*FOR*ROLLUP*                                   S01311
     C************                                                        S01311
     C**1.*IF*END*OF*SUBFILE*GET*MORE*RECORDS*AND*SET-UP*NEXT*PAGE*       S01311
     C**2.*IF*NOT*END*OF*SUBFILE,*ROLL-UP*WILL*BE*HANDLED*BY*CPF*         S01311
     C************                                                        S01311
     C**CALLED*FROM:*MAIN*PROCESSING*                                     S01311
     C************                                                        S01311
     C**CALLS:*FLDCHG,*RSTOR,*BSFIL1,*BSFIL2*                             S01311
     C************                                                        S01311
     C*****************************************************************
     C***********                                                         S01311
     C***********ROLP      BEGSR                           ** ROLP **     S01311
     C***********                                                         S01311
     C***********          EXSR FLDCHG                                    S01311
     C***********                                                         S01311
     C************IN12     IFEQ '1'                                       S01311
     C***********          EXSR RSTOR                                     S01311
     C***********          END                                            S01311
     C***********                                                         S01311
     C***********          Z-ADDRRN       DSPREC                          S01311
     C***********                                                         S01311
     C***********CQKEY     IFEQ *ZEROS                                    S01311
     C***********                                                         S01311
     C***********          EXSR BSFIL1                                    S01311
     C***********                                                         S01311
     C***********          ELSE                                           S01311
     C***********                                                         S01311
     C***********          EXSR BSFIL2                                    S01311
     C***********                                                         S01311
     C***********          END                                            S01311
     C***********                                                         S01311
     C***********          ENDSR                           ** ROLP **     S01311
     C***********                                                         S01311
      /TITLE    <<< ROLP SR. >>>                                          058797
     C*****************************************************************   058797
     C**                                                              *   058797
     C** ROLP --- SUBROUTINE FOR ROLLUP                               *   058797
     C**                                                              *   058797
     C** 1. IF END OF SUBFILE, GET MORE RECORDS AND SET-UP NEXT PAGE. *   058797
     C** 2. IF NOT END OF SUBFILE, ROLL-UP WILL BE HANDLED BY CPF.    *   058797
     C**                                                              *   058797
     C**                                                              *   058797
     C**     CALLED FROM: MAIN PROCESSING                             *   058797
     C**                                                              *   058797
     C**     CALLS:       FLDCHG, RSTOR, BSFIL1, BSFIL2               *   058797
     C**                                                              *   058797
     C**                                                              *   058797
     C           ROLP      BEGSR                           **  ROLP  *    058797
     C*                                                                   058797
     C                     EXSR FLDCHG                                    058797
     C*                                                                   058797
     C           *IN12     IFEQ '1'                                       058797
     C                     EXSR RSTOR                                     058797
     C                     END                                            058797
     C*                                                                   058797
     C                     Z-ADD@RRN      RRN                             058797
     C*                                                                   058797
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP27                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
      *                                                                                       CGL131
     C           CGL131    OREQ 'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
     C           *IN41     IFEQ '0'                                       165546
     C*                                                                   S01408
     C           CQKEY     IFEQ *ZEROS                                    058797
     C                     EXSR BSFIL1                                    058797
     C                     ELSE                                           058797
     C                     EXSR BSFIL2                                    058797
     C                     END                                            058797
     C                     ENDIF                                          165546
     C           *IN41     IFEQ '1'                                       165546
     C           PCKEY     IFEQ *BLANK                     ** B001        165546
     C                     EXSR BSFIL1                                    165546
     C                     ELSE                            ** X001        165546
     C                     EXSR BSFIL2                                    165546
     C                     END                             ** E001        165546
     C                     ENDIF                                          165546
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP28                                           S01408
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C           CQKEY     IFEQ *ZEROS                                                        CGL131
      *                                                                                       CGL131
     C           AMONT     IFEQ *BLANKS                                                       CGL131
      *                                                                                       CGL131
     C                     EXSR BSFIL1                                                        CGL131
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     EXSR BSFIL3                                                        CGL131
      *                                                                                       CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C                     EXSR BSFIL2                                                        CGL131
      *                                                                                       CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*                                                                   058797
     C** If no record to display on new page, set DSPREC = RRN - 1.       058797
     C*                                                                   058797
     C           COUNT     IFEQ 0                                         058797
     C           RRN       SUB  1         DSPREC                          058797
     C                     END                                            058797
     C*                                                                   058797
     C                     ENDSR                                          058797
     C*                                                                   058797
      /TITLE         <<< BSFIL1 SR. >>>
     C*****************************************************************
     C*
     C* BSFIL1 --- BUILD SUBFILE WITH RECORDS FROM APOSTL1
     C*
     C* 1. SETLL ACCORDING TO WHETHER + OR -, AND WHETHER START
     C*    FROM FIRST RECORD (IN20) REQUESTED OR NOT
     C* 2. BUILD SUBFILE PAGE
     C* 3. SET-UP OUTPUT SCREEN DETAILS
     C*
     C* CALLED FROM: ENTR, ROLP, CMD5
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           BSFIL1    BEGSR                           ** BSFIL1 **
     C*
     C*
     C***********          Z-ADDRRN       DSPREC                          S01311
     C***********          Z-ADD0         COUNT   30                      S01311
     C                     Z-ADDRRN       DSPREC                          058797
     C                     Z-ADD0         COUNT   30                      058797
     C*
     C***********COUNT     DOWLT12                                        S01311
     C************IN80     DOUEQ'1'                                S01311 058797
     C********** COUNT     DOWLT12                                                   058797 MD025751
     C           COUNT     DOWLT11                                                          MD025751
     C           *IN80     ANDEQ'0'                                       058797
     C                     SETOF                     81
     C*
     C           *IN80     IFEQ '0'
     C           AMTNUM    IFGT 0
     C** Post amount less or equal to selected amount                     163504
     C           PORM      IFEQ '-'
     C           PSTA      IFLE AMTNUM
     C                     SETOF                     81
     C                     ELSE
     C                     SETON                     81
     C                     END
     C                     ELSE
     C** Post amount greater or equal to selected amount                  163504
     C           PORM      IFEQ '+'                                       163504
     C           PSTA      IFGE AMTNUM
     C                     SETOF                     81
     C                     ELSE
     C                     SETON                     81
     C                     END
     C** Post amount equal to selected amount                             163504
     C                     ELSE                                           163504
     C           PSTA      IFEQ AMTNUM                                    163504
     C                     SETOF                     81                   163504
     C                     ELSE                                           163504
     C                     SETON                     81                   163504
     C                     END                                            163504
     C                     END                                            163504
     C*
     C                     END
     C                     END
     C                     END
     C*
     C/COPY WNCPYSRC,GL4442C023
     C           *IN80     IFEQ '0'
     C           *IN81     ANDEQ'0'
     C/COPY WNCPYSRC,GL4442C031
      *                                                                   S01311
      *  If called via Exposure Management only show movements which      S01311
      *  are posting records and have not been printed on statement       S01311
      *                                                                   S01311
     C           *IN35     IFEQ '1'                                       S01311
     C           POSDA     ANDEQ*BLANKS                                   098693
     C           RECI      IFEQ 'P'                                       S01311
     C                     TESTB'7'       PRIN       34                   S01311
     C           *IN34     IFEQ '1'                                       S01311
     C           RRN       ANDLT9999                                      E37456
     C/COPY WNCPYSRC,GLH00565
     C                     EXSR WRTSUB
     C                     ADD  1         COUNT                           058797
     C/COPY WNCPYSRC,GLH00566
     C                     END                                            S01311
     C                     END                                            S01311
     C***********          ADD  1         COUNT                           S01311
     C                     ELSE                                           S01311
     C           RRN       IFLT 9999                                      E37456
     C/COPY WNCPYSRC,GLH00567
     C                     EXSR WRTSUB                                    S01311
     C                     ADD  1         COUNT                           058797
     C/COPY WNCPYSRC,GLH00568
     C                     END                                            E37456
     C                     END
     C                     END                                            S01311
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP29                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
      *                                                                                       CGL131
     C           CGL131    OREQ 'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
     C*                                                                   S01408
     C           KEYEQ     READEAPOSTL1                  80
     C                     MOVE SPOS      SPOSP                           183365
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP30                                           S01408
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
     C           TODAY     IFEQ '1'                                                           CGL131
     C           KEYEQ     READERSACMTLD                 80                                   CGL131
     C                     MOVELFORMA5    FORMAT 10                                           CGL131
      *                                                                                       CGL131
      ** IF EOF ON TODAY'S POSTING                                                            CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ *ON                                                           CGL131
     C                     MOVE RNDT      POSDN                                               CGL131
     C           KEYSL1    SETLLAPOSTL38                                                      CGL131
     C                     MOVE '2'       TODAY                                               CGL131
     C                     MOVE *OFF      *IN80                                               CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           TODAY     IFEQ '2'                                                           CGL131
     C           KEYEQ     READEAPOSTL38                 80                                   CGL131
     C                     MOVELFORMA1    FORMAT                                              CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C************IN80     IFEQ '1'                                       S01311
     C***********          SETON                     04                   S01311
     C***********          Z-ADD13        COUNT                           S01311
     C***********          END                                            S01311
     C*                                                                   058797
     C           *IN80     IFEQ '1'                                       058797
     C/COPY WNCPYSRC,GL4442C032
     C                     SETON                     04                   058797
     C                     END                                            058797
     C/COPY WNCPYSRC,GL4442C033
     C*
     C                     END
     C*
     C                     ENDSR                           ** BSFIL1 **
     C*
      /TITLE         <<< BSFIL2 SR. >>>
     C*****************************************************************
     C*
     C*******BSFIL2 --- BUILD SUBFILE WITH RECORDS FROM APOSTL2           165546
     C* BSFIL2 --- BUILD SUBFILE WITH RECORDS FROM APOSTL2 OR APOSTL9     165546
     C*
     C* 1. SETLL
     C* 2. BUILD SUBFILE PAGE
     C* 3. SET-UP OUTPUT SCREEN DETAILS
     C*
     C* CALLED FROM: ENTR, ROLP, CMD5
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           BSFIL2    BEGSR                           ** BSFIL2 **
     C*
     C*
     C***********          Z-ADDRRN       DSPREC                          S01311
     C***********          Z-ADD0         COUNT   30                      S01311
     C                     Z-ADDRRN       DSPREC                          058797
     C                     Z-ADD0         COUNT   30                      058797
     C*
     C***********COUNT     DOWLT12                                        S01311
     C************IN80     DOUEQ'1'                                S01311 058797
     C********** COUNT     DOWLT12                                                   058797 MD025751
     C           COUNT     DOWLT11                                                          MD025751
     C           *IN80     ANDEQ'0'                                       058797
     C                     SETOF                     81
     C*
     C           *IN80     IFEQ '0'
     C           *IN41     IFEQ '0'                        ** B003        165546
     C           CHQN      IFGE CQKEY
     C                     SETOF                     81
     C                     ELSE
     C                     SETON                     81
     C                     END
     C                     ENDIF                           ** E003        165546
     C           *IN41     IFEQ '1'                        ** B003        165546
     C           PRFC      IFGE PCKEY                      ** B003        165546
     C                     SETOF                     81                   165546
     C                     ELSE                            ** X005        165546
     C                     SETON                     81                   165546
     C                     END                             ** E003        165546
     C                     ENDIF                           ** E003        165546
     C/COPY WNCPYSRC,GL4442C024
     C                     END
     C*
     C           *IN80     IFEQ '0'
     C           *IN81     ANDEQ'0'
      *                                                                   S01311
      *  If called via Exposure Management only show movements which      S01311
      *  have not been printed on statement                               S01311
      *                                                                   S01311
     C           *IN35     IFEQ '1'                                       S01311
     C           POSDA     ANDEQ*BLANKS                                   098693
     C           RECI      IFEQ 'P'                                       S01311
     C                     TESTB'7'       PRIN       34                   S01311
     C           *IN34     IFEQ '1'                                       S01311
     C           RRN       ANDLT9999                                      E37456
     C/COPY WNCPYSRC,GLH00569
     C                     EXSR WRTSUB
     C                     ADD  1         COUNT                           058797
     C/COPY WNCPYSRC,GLH00570
     C                     END                                            S01311
     C                     END                                            S01311
     C***********          ADD  1         COUNT                           S01311
     C                     ELSE                                           S01311
     C           RRN       IFLT 9999                                      E37456
     C/COPY WNCPYSRC,GLH00571
     C                     EXSR WRTSUB                                    S01311
     C                     ADD  1         COUNT                           058797
     C/COPY WNCPYSRC,GLH00572
     C                     END                                            E37456
     C                     END
     C                     END                                            S01311
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP31                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
      *                                                                                       CGL131
     C           CGL131    OREQ 'Y'                                                         MD021130
     C           VLGLAB    ANDEQ'N'                                                         MD021130
     C*                                                                   S01408
     C*********  KEYEQ     READEAPOSTL2                  80               165546
     C  N41      KEYEQ     READEAPOSTL2                  80               165546
     C   41      KEYEQ     READEAPOSTL9                  80               165546
     C                     MOVE SPOS      SPOSP                           183365
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP32                                           S01408
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
     C           TODAY     IFEQ '1'                                                           CGL131
     C           KEYEQ     READERSACMTLB                 80                                   CGL131
     C                     MOVELFORMA6    FORMAT 10                                           CGL131
      *                                                                                       CGL131
      ** IF EOF ON TODAY'S POSTING                                                            CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ *ON                                                           CGL131
     C                     MOVE RNDT      POSDN                                               CGL131
     C           KEYSL2    SETLLAPOSTL2                                                       CGL131
     C                     MOVE '2'       TODAY                                               CGL131
     C                     MOVE *OFF      *IN80                                               CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           TODAY     IFEQ '2'                                                           CGL131
     C           KEYEQ     READEAPOSTL2                  80                                   CGL131
     C                     MOVELFORMA2    FORMAT                                              CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C************IN80     IFEQ '1'                                       S01311
     C***********          SETON                     04                   S01311
     C***********          Z-ADD13        COUNT                           S01311
     C***********          END                                            S01311
     C*                                                                   058797
     C           *IN80     IFEQ '1'                                       058797
     C                     SETON                     04                   058797
     C                     END                                            058797
     C*
     C                     END
     C*
     C                     ENDSR                           ** BSFIL2 **
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP33                                           S01408
      *                                                                                       CGL131
      *****************************************************************                       CGL131
      /TITLE         <<< BSFIL3 SR. >>>                                                       CGL131
      *****************************************************************                       CGL131
      *                                                                                       CGL131
      ** BSFIL3 --- BUILD SUBFILE WITH RECORDS FROM APOSTL39                                  CGL131
      *                                                                                       CGL131
      ** 1. SETLL ACCORDING TO WHETHER + OR -, AND WHETHER START                              CGL131
      **    FROM FIRST RECORD (IN20) REQUESTED OR NOT                                         CGL131
      ** 2. BUILD SUBFILE PAGE                                                                CGL131
      ** 3. SET-UP OUTPUT SCREEN DETAILS                                                      CGL131
      *                                                                                       CGL131
      ** CALLED FROM: ROLP                                                                    CGL131
      *                                                                                       CGL131
      ** CALLS: NOTHING                                                                       CGL131
      *                                                                                       CGL131
      *****************************************************************                       CGL131
      *                                                                                       CGL131
     C           BSFIL3    BEGSR                                                              CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
      *                                                                                       CGL131
     C                     Z-ADDRRN       DSPREC                                              CGL131
     C                     Z-ADD0         COUNT   30                                          CGL131
      *                                                                                       CGL131
     C********** COUNT     DOWLT12                                                   CGL131 MD025751
     C           COUNT     DOWLT11                                                          MD025751
     C                     SETOF                     81                                       CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ '0'                                                           CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '-'                                                           CGL131
      *                                                                                       CGL131
     C           PSTA      IFLE AMTNUM                                                        CGL131
     C           PSTD      ANDLEPOSDN                                                         CGL131
     C                     SETOF                     81                                       CGL131
     C                     ELSE                                                               CGL131
     C                     SETON                     81                                       CGL131
     C                     END                                                                CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '+'                                                           CGL131
     C           PORM      OREQ ' '                                                           CGL131
     C           PSTA      IFGE AMTNUM                                                        CGL131
     C           PSTD      ANDLEPOSDN                                                         CGL131
     C                     SETOF                     81                                       CGL131
     C                     ELSE                                                               CGL131
     C                     SETON                     81                                       CGL131
     C                     END                                                                CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           PORM      IFEQ '%'                                                           CGL131
     C           PSTA      IFLE AMTKYG                                                        CGL131
     C           PSTD      ANDLEPOSDN                                                         CGL131
     C                     SETOF                     81                                       CGL131
     C                     ELSE                                                               CGL131
     C                     SETON                     81                                       CGL131
     C                     END                                                                CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ '0'                                                           CGL131
     C           *IN81     ANDEQ'0'                                                           CGL131
     C                     EXSR WRTSUB                                                        CGL131
     C                     ADD  1         COUNT                                               CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C           TODAY     IFEQ '1'                                                           CGL131
     C           KEYEQ     READERSACMTLC                 80                                   CGL131
     C                     MOVELFORMA7    FORMAT 10                                           CGL131
      *                                                                                       CGL131
      ** IF EOF ON TODAY'S POSTING                                                            CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ *ON                                                           CGL131
     C           KEYSL3    SETLLAPOSTL39                                                      CGL131
     C                     MOVE '2'       TODAY                                               CGL131
     C                     MOVE *OFF      *IN80                                               CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           TODAY     IFEQ '2'                                                           CGL131
     C           KEYEQ     READEAPOSTL39                 80                                   CGL131
     C                     MOVELFORMA3    FORMAT                                              CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           *IN80     IFEQ '1'                                                           CGL131
      *                                                                                       CGL131
     C           COUNT     IFEQ 0                                                             CGL131
     C                     SUB  1         DSPREC                                              CGL131
     C           DSPREC    IFLE 0                                                             CGL131
     C                     Z-ADD1         DSPREC                                              CGL131
     C                     END                                                                CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     SETON                     04                                       CGL131
     C                     Z-ADD13        COUNT                                               CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     END                                                                CGL131
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
     C                     ENDSR                                                              CGL131
      *                                                                                       CGL131
      *****************************************************************                       CGL131
      /EJECT                                                                                  CGL131
      *****************************************************************                       CGL131
     C*                                                                   S01408
      /TITLE         <<< STORE SR. >>>
     C*****************************************************************
     C*
     C* STORE --- STORE I/P FIELDS IN 'SAVE' FIELDS
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           STORE     BEGSR                           ** STORE **
     C*
     C           MBIN      IFEQ 'Y'                                       S01117
     C**********           MOVE MBACNT    MBACSV 22                                    S01117 CGL029
     C                     MOVE MBACNT    MBACSV 28                                           CGL029
     C                     ELSE                                           S01117
     C**********           MOVE ACNT      ACSV   19                                           CGL029
     C                     MOVE ACNT      ACSV   25                                           CGL029
     C                     END                                            S01117
     C                     MOVE POSDA     PDSV    6
     C                     MOVE PORM      POSV    1
     C                     MOVE AMONT     AMSV   14
     C************         MOVE CQNMR     CHSV    8                       165546
     C  N41                MOVE CQNMR     CHSV    8                       165546
     C   41                MOVE PCAMR     PCSV    4                       165546
     C*
     C                     ENDSR                           ** STORE **
     C*
      /TITLE         <<< RSTOR SR. >>>
     C*****************************************************************
     C*
     C* RSTOR --- RESTORE I/P FIELDS FROM 'SAVE' FIELDS
     C*
     C           RSTOR     BEGSR                           ** RSTOR **
     C*
     C           MBIN      IFEQ 'Y'                                       S01117
     C**********           MOVE MBACSV    MBACNT 22                                    S01117 CGL029
     C                     MOVE MBACSV    MBACNT                                              CGL029
     C                     ELSE                                           S01117
     C                     MOVE ACSV      ACNT
     C                     END                                            S01117
     C                     MOVE PDSV      POSDA
     C                     MOVE POSV      PORM
     C                     MOVE AMSV      AMONT
     C**********           MOVE CHSV      CQNMR                           165546
     C  N41                MOVE CHSV      CQNMR                           165546
     C   41                MOVE PCSV      PCAMR                           165546
     C**********           MOVE SPOS      SPOSR                           165546
     C  N41                MOVE SPOS      SPOSR                           165546
     C   41                MOVE SPOS      SPOSP                           165546
     C*
     C                     ENDSR                           ** RSTOR **
     C*
      /TITLE         <<< WRTSUB SR. >>>
     C*****************************************************************
     C*
     C* WRTSUB --- WRITE RECORD TO SUBFILE
     C*
     C* 1. FORMATS OUTPUT FIELDS VIA STANDARD SUBROUTINES
     C* 2. WRITES RECORD TO SUBFILE
     C*
     C* CALLED FROM: BSFIL1, BSFIL2
     C*
     C* CALLS: ZDATE2, ZFRPED (STANDARD S/RS)
     C*
     C*****************************************************************
     C*
     C           WRTSUB    BEGSR                           ** WRTSUB **
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP34                                           S01408
      *                                                                                       CGL131
     C           PSTD      IFGE RNDT                                                          CGL131
     C           CGL131    ANDEQ'Y'                                                           CGL131
     C                     MOVEL' Today ' PSTDZ                                               CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    PSTDZ
     C                     MOVE ZADATE    PSTDZP                          165546
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP35                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
     C                     Z-ADDVALD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    VALDZ
     C                     MOVE ZADATE    VALDZP                          165546
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP36                                           S01408
      *                                                                                       CGL131
     C                     MOVELFORMAT    FORM6   6                                           CGL131
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C           PNAR      IFEQ *BLANKS                                                       CGL131
     C           FORM6     ANDEQ'RSACMT'                                                      CGL131
     C                     MOVELTRYP      Z9AA    9                                           CGL131
     C                     MOVE TNMR      Z9AA                                                CGL131
     C                     MOVELZ9AA      PNAR                                                CGL131
     C                     END                                                                CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           PNAR      IFEQ *BLANKS                                                       CGL131
     C                     MOVEL'NARR. NO'Z16A   16                                           CGL131
     C                     MOVE 'T AVAIL.'Z16A                                                CGL131
     C                     MOVELZ16A      PNAR                                                CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C           PSTA      IFEQ 0                                                             CGL131
     C           CGL131    ANDEQ'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     MOVE *BLANKS   VALDZ                                               CGL131
     C                     MOVE *BLANKS   PSTDZ                                               CGL131
     C                     MOVE *BLANKS   PSTAZ                                               CGL131
      *                                                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C           DRCR      IFEQ 1
     C           PSTA      MULT -1        PSTA
     C                     END
     C                     Z-ADDPSTA      ZFLD15
     C***********          Z-ADDA6DANB    ZDECS                           S01194
     C                     Z-ADDA6NBDP    ZDECS                           S01194
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    PSTAZ
     C                     MOVE ZOUT22    PSTAZP                          165546
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP37                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
      *                                                                   BHF677
      * Format Cheque Number for output where included                    BHF677
     C           *IN41     IFEQ '0'                                       165546
     C                     MOVELCHQN      @CHQN   8                       BHF677
     C           @CHQN     IFEQ '00000000'                                BHF677
     C                     MOVE *BLANKS   @CHQN                           BHF677
     C                     END                                            BHF677
     C                     ELSE                                           165546
     C                     MOVELPRFC      @PRFCP  4                       165546
     C                     END                                            165546
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CIRE                                           S01408
     C*                                                                   S01408
     C*                                                                   S01472
     C                     MOVE *BLANKS   ABTCH                                             BUG24143
     C                     MOVE *BLANKS   ABITM                                             BUG24143
     C                     MOVE *BLANKS   @ABTC                                             MD025751
     C                     MOVE *BLANKS   @ABTCP                                            MD025751
     C           *IN82     IFEQ '1'                                       S01472
     C*******              MOVELPNAR      PNARZ2                   S01472 107938
     C*  If the posting is not a batch posting, the first 2 characters    S01472
     C*     will be blank, so the batch number will be blank              S01472
     C*                                                                   S01472
     C           ABTCH2    IFEQ *BLANKS                                   S01472
     C/COPY WNCPYSRC,GL4442C038
     C******               MOVE *BLANKS   ABTCH   3                S01472 107938
     C                     MOVEL*BLANKS   PNARZP                                            MD046592
     C                     MOVELPNAR      PNARZ                           107938
     C                     MOVELPNAR      PNARZP                          165546
     C                     MOVE TRAT      TRATZ                                               CRE098
     C                     MOVE TRAT      TRATZP                                              CRE098
     C                     MOVEL*BLANKS   @ABTC                                             MD046592
     C                     ELSE                                           S01472
     C*******              MOVELSPOS      ABTCH                    S01472 107938
     C************         MOVELSPOS      ABTCH   3                107938 165546
     C  N41                MOVELSPOS      ABTCH   3                       165546
     C   41                MOVELSPOSP     ABTCH   3                       165546
     C  N41      3         SUBSTSPOS:4    ABITM   3                                         BUG24143
     C   41      3         SUBSTSPOSP:4   ABITM   3                                         BUG24143
     C**********           MOVELPNAR      PNARZ2 26                                  107938 MD046592
     C                     MOVELPNAR      PNARZ2 30                                         MD046592
     C                     MOVE *BLANKS   PNARZ                           107938
     C                     MOVE *BLANKS   PNARZP                          165546
     C**********           MOVE ABTCH     PNARZ                                      107938 MD025751
     C**********           MOVE ABTCH     PNARZP                                     165546 MD025751
     C                     MOVE ABTCH     @ABTC                                             MD025751
     C                     MOVE ABTCH     @ABTCP                                            MD025751
     C                     MOVELPNARZ2    PNARZ                           107938
     C                     MOVELPNARZ2    PNARZP                          165546
     C                     MOVE TRAT      TRATZ                                               CRE098
     C                     MOVE TRAT      TRATZP                                              CRE098
     C                     END                                            S01472
     C*                                                                   S01472
     C********             MOVE ABTCH     PNARZ                    S01472 107938
     C                     ELSE                                           S01472
     C                     MOVE TRAT      TRATZ                                               CRE098
     C                     MOVE TRAT      TRATZP                                              CRE098
     C                     MOVEL@PNAR     PNARZ                           S01472
     C                     MOVEL@PNAR     PNARZP                          165546
     C                     END                                            S01472
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CCP8                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFEQ 'Y'                                                           CGL131
     C           VLGLAB    ANDEQ'Y'                                                         MD021130
     C                     MOVELOTRF      @HPREF    P                                         CGL131
     C                     WRITESFLRCDA                                                       CGL131
     C                     ELSE                                                               CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
     C*
      * OTRF (from APOSTPD) must be taken into account instead of         124565
      * narrative.                                                        124565
     C                     MOVELOTRF      @HPREF    P                     124565
     C/COPY WNCPYSRC,GL4442C035
     C           *IN41     IFEQ '1'                                       165546
     C                     MOVELSFLDS3    SFLDS2                          165546
     C                     ENDIF                                          165546
      *                                                                   124565
     C                     WRITESFLRCD
     C/COPY WNCPYSRC,GL4442C020
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*
     C                     ADD  1         RRN
     C                     ADD  1         @RRN                            058797
     C/COPY WNCPYSRC,GLH00564
     C                     SETON                     0283
     C*
     C                     ENDSR                           ** WRTSUB **
     C*
      /TITLE         <<< ACDETS SR. >>>
     C*****************************************************************
     C*
     C* ACDETS --- SET-UP STATIC DISPLAY DATA
     C*
     C* 1. FORMATS OUTPUT FIELDS VIA STANDARD SUBROUTINES
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: ZDATE2, ZFRPED
     C*
     C*****************************************************************
     C*
     C           ACDETS    BEGSR                           ** ACDETS **
     C*
     C                     SETOF                     37                   S01311
     C                     Z-ADDCFSB      ZFLD15
     C***********          Z-ADDA6DANB    ZDECS                           S01194
     C                     Z-ADDA6NBDP    ZDECS                           S01194
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    LEB    22
     C*
     C           *IN14     IFEQ '1'
     C***********          Z-ADDCLBL      ZFLD15                          081701
     C                     Z-ADDLDBL      ZFLD15                          081701
     C***********          Z-ADDA6DANB    ZDECS                           S01194
     C                     Z-ADDA6NBDP    ZDECS                           S01194
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    STBCL  22
     C                     MOVE STBCL     CBLNC  22                                          BUG4738
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP38                                           S01408
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
      *                                                                   S01311
      *  If Exposure Management linked enq. calculate accrued interest    S01311
      *                                                                   S01311
     C           *IN35     IFEQ '1'                                       S01311
     C                     EXSR RETAIL                                    S01311
     C                     END                                            S01311
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP39                                           S01408
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C*                                                                   S01408
      *                                                                   S01311
     C                     ELSE
     C                     Z-ADDLDBL      ZFLD15
     C***********          Z-ADDA6DANB    ZDECS                           S01194
     C                     Z-ADDA6NBDP    ZDECS                           S01194
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    LEGER  22
     C                     MOVE LEGER     CBLNC  22                                          BUG4738
     C                     END
     C/COPY WNCPYSRC,GL4442C034
     C*
     C                     ENDSR                           ** ACDETS **
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP40                                           S01408
     C*                                                                   S01408
      /TITLE         <<< RETAIL SR. >>>                                   S01311
     C*****************************************************************   S01311
     C*                                                                   S01311
     C* RETAIL --- CALCULATE ACCRUED INTEREST                             S01311
     C*                                                                   S01311
     C* CALLED FROM: ACDETS                                               S01311
     C*                                                                   S01311
     C* CALLS: ZFRPED                                                     S01311
     C*                                                                   S01311
     C*****************************************************************   S01311
     C*                                                                   S01311
     C           RETAIL    BEGSR                           ** RETAIL **   S01311
     C/COPY WNCPYSRC,GL4442C021
      *                                                                                       CGL131
     C           CGL131    IFNE 'Y'                                                           CGL131
      *                                                                                       CGL131
      *                                                                   S01311
     C                     MOVE *BLANKS   ACRINT                          S01311
     C           KALL      CHAINREACR                36                   S01311
     C           *IN36     IFEQ '0'                                       S01311
      *                                                                   S01311
      *  Format total interest                                            S01311
      *                                                                   S01311
     C********** DAIC1     ADD  MADI      ACRTOT 130               S01311 180280
     C**********           ADD  GADI      ACRTOT                   S01311 180280
     C**********           ADD  CAIC1     ACRTOT                   S01311 180280
     C**********           ADD  MACI      ACRTOT                   S01311 180280
     C**********           ADD  GACI      ACRTOT                   S01311 180280
     C           DAIC1     ADD  MADI      WDRTOT 130                      180280
     C           WDRTOT    ADD  GADI      WDRTOT                          180280
      *                                                                   180280
     C                     Z-SUBCAIC1     WCRTOT 130                      180280
     C                     SUB  MACI      WCRTOT                          180280
     C                     SUB  GACI      WCRTOT                          180280
      *                                                                   180280
     C                     Z-ADDWDRTOT    ACRTOT 130                      180280
     C                     ADD  WCRTOT    ACRTOT                          180280
      *                                                                   180280
     C           ACRTOT    IFNE 0                                         S01311
     C                     SETON                     37                   S01311
      *                                                                   S01311
      *  Edit amount                                                      S01311
      *                                                                   S01311
     C                     Z-ADDACRTOT    ZFLD15                          S01311
     C                     Z-ADDA6NBDP    ZDECS                           S01311
     C                     MOVE 'A'       ZECODE                          S01311
     C                     EXSR ZFRPED                                    S01311
     C                     MOVE ZOUT22    ZAMNTQ                          S01311
     C                     MOVE *BLANKS   WISIGN  2                                           240903
     C                     MOVE ZAMNTQ    WISIGN                                              240903
     C           WISIGN    IFEQ *BLANKS                                                       240903
     C                     MOVE 'DR'      ZAMNTQ                                              240903
     C                     ENDIF                                                              240903
      *                                                                   S01311
     C***********ACRTOT    IFLT 0                                   S01311093373
     C********** ACRTOT    IFGT 0                                  093373 180280
     C**********           MOVE 'CR'      CRTEXT                   S01311 180280
     C**********           ELSE                                    S01311 180280
     C**********           MOVE 'DR'      CRTEXT                   S01311 180280
     C**********           END                                     S01311 180280
     C                     MOVE COMPLT    ACRINT                          S01311
     C                     END                                            S01311
     C                     END                                            S01311
      *                                                                   S01311
     C/COPY WNCPYSRC,GL4442C022
      *                                                                                       CGL131
     C                     ENDIF                                                              CGL131
      *                                                                                       CGL131
     C                     ENDSR                                          S01311
      *                                                                                     BUG26687
      /TITLE         <<< RTVMSG SR. >>>                                                     BUG26687
     C*****************************************************************                     BUG26687
     C*                                                                                     BUG26687
     C* RTVMSG --- RETRIEVE TEXT FROM MESSAGE FILE                                          BUG26687
     C*                                                                                     BUG26687
     C* CALLED FROM:                                                                        BUG26687
     C*                                                                                     BUG26687
     C* CALLS:                                                                              BUG26687
     C*                                                                                     BUG26687
     C*****************************************************************                     BUG26687
     C*                                                                                     BUG26687
     C           RTVMSG    BEGSR                           ** RTVMSG **                     BUG26687
      *                                                                                     BUG26687
     C                     CALL 'SDRTVTXT'                                                  BUG26687
     C                     PARM           PMSGID  7                                         BUG26687
     C                     PARM XMSGFN    PMSGFN 10                                         BUG26687
     C                     PARM *BLANKS   PMSGDS 80                                         BUG26687
      *                                                                                     BUG26687
     C                     ENDSR                                                            BUG26687
      *                                                                   S01311
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4442CP41                                           S01408
     C*                                                                   S01408
      /TITLE         <<< ZDATE1 SR. >>>
     C********************************************************************
     C**
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
     C**              CONVERT TO A NUMBER OF DAYS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE1    BEGSR                           ***  ZDATE1 ***
     C**
     C**   CLEAR DAY NUMBER.
     C                     Z-ADD0         ZDAYNO  50
     C**
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.
     C                     Z-ADDZDATE     ZDATE   60
     C**
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
     C                     MOVE ZDATE     ZYEAR   20
     C  N98                MOVELZDATE     ZDAY    20
     C   98                MOVELZDATE     ZMTH    20
     C                     MOVE ZDATE     ZWRK4   40
     C  N98                MOVELZWRK4     ZMTH
     C   98                MOVELZWRK4     ZDAY
     C**
     C**   ENSURE MONTH IS VALID.
     C           ZMTH      COMP 0                      9999
     C  N99      ZMTH      COMP 12                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR 30 DAY MONTHS.
     C           ZMTH      COMP 4                        90IF 90 ON, 30
     C  N90      ZMTH      COMP 6                        90DAY MONTH.
     C  N90      ZMTH      COMP 9                        90
     C  N90      ZMTH      COMP 11                       90
     C**
     C**   ENSURE DAY IS VALID.
     C           ZDAY      COMP 0                      9999
     C   90N99   ZDAY      COMP 30                   99
     C  N90N99   ZDAY      COMP 31                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.
     C           ZYEAR     ADD  28        ZYEAR
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10     91LEAP YR, 91 ON
     C           ZMTH      COMP 2                    93  92FEB., 92 ON
     C**                                                   PAST FEB, 93 ON
     C**   IF FEBUARY FURTHER VALIDATE DAY.
     C  N91 92   ZDAY      COMP 28                   99
     C   91 92   ZDAY      COMP 29                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
     C**
     C           ZDEND1    ENDSR                           ***  ZDEND1 ***
     C**
     C**
     C********************************************************************
      /TITLE         <<< ZALIGN SR. >>>
     C********************************************************************
     C**
     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
     C**
     C           ZALIGN    BEGSR                           *** ZALIGN ***
     C**
     C                     SETOF                     929399
     C**
     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
     C                     MOVEAZFIELD    ZA1
     C**
     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
     C                     Z-ADDZADIG     ZADIG   20
     C                     Z-ADDZADEC     ZADEC   10
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ' '       ZA2
     C                     MOVEAZA2       ZFIELD 16
     C                     Z-ADD0         ZX      20
     C                     Z-ADD0         ZY      20
     C**
     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
     C           ZADIG     ADD  ZADEC     ZZ      20
     C           ZZ        COMP 15                   99
     C   99                GOTO ZAEND
     C**
     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
     C           ZATAG1    TAG                             ** ZATAG1 TAG *
     C           ZX        ADD  1         ZX
     C**
     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
     C           ZA1,ZX    COMP '.'                      90
     C   90 93             SETON                     99
     C   99                GOTO ZAEND
     C**
     C**
     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'M'                      96
     C   96                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 9                    99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'T'                      97
     C   97                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 12                   99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
     C   96
     COR 97                MOVE ' '       ZA1,ZX
     C**
     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
     C           ZA1,ZX    COMP ' '                      91
     C   91 92             GOTO ZATAG2
     C**
     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
     C  N90N91   ZA1,ZX    COMP '0'                    99
     C  N90N91N99ZA1,ZX    COMP '9'                  99
     C   99                GOTO ZAEND                      NOT NUMERIC
     C**
     C**   STORE DIGITS IN ARRAY AND HOW MANY.
     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
     C  N90N91   ZY        ADD  1         ZY         92
     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
     C   90                Z-ADDZY        ZZ         93  93
     C**
     C           ZX        COMP 16                     94  CHECK IF ALL
     C   94                GOTO ZATAG1
     C**
     C           ZATAG2    TAG                             ** ZATAG2 TAG *
     C**
     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
     C   96      ZZ        ADD  6         ZZ
     C**
     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
     C   97      ZZ        ADD  3         ZZ
     C**
     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
     C   96 93
     COR 97 93   ZZ        DOWGTZY
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
     C   96N93             DO   6
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C   97N93             DO   3
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
     C  N93                Z-ADDZY        ZZ
     C**
     C**   CHECK FOR EMBEDDED BLANKS.
     C   91 92             MOVEAZA1,ZX    ZFIELD
     C   91 92   ZFIELD    COMP ' '                  9999
     C   99                GOTO ZAEND                      EMBEDDED BLANK
     C**
     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
     C           ZZ        COMP ZADIG                99
     C           ZY        SUB  ZZ        ZX
     C  N99      ZADEC     SUB  ZX        ZX           9995
     C   99                GOTO ZAEND
     C   95                GOTO ZATAG4                     NO TRAILING
     C**                                                   BLANKS.
     C**   FILL THE TRAILING BLANKS WITH ZEROS.
     C           ZY        ADD  ZX        ZZ
     C           ZATAG3    TAG                             ** ZATAG3 TAG *
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C           ZY        COMP ZZ                     94
     C   94                GOTO ZATAG3
     C**
     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
     C           ZATAG4    TAG                             ** ZATAG4 TAG *
     C                     MOVE '0'       ZA1
     C                     Z-ADD16        ZX
     C           ZATAG5    TAG                             ** ZATAG5 TAG *
     C           ZY        COMP 0                        94
     C   94                GOTO ZATAG6
     C                     MOVE ZA2,ZY    ZA1,ZX
     C           ZY        SUB  1         ZY
     C           ZX        SUB  1         ZX
     C                     GOTO ZATAG5
     C           ZATAG6    TAG                             ** ZATAG6 TAG *
     C**
     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
     C                     MOVEAZA1       ZFIELD
     C**
     C                     SETOF                     9697
     C**
     C           ZAEND     ENDSR                           * ZAEND ENDSR *
     C**
     C**
     C********************************************************************
      /TITLE         <<< ZFRPED SR. >>>
     C********************************************************************
     C**                                                                 *
     C** ZFRPED subroutine to insert a decimal point and sign into a     *
     C** numeric field and to blank out leading zeros (optionaly         *
     C** inserting commas).                                              *
     C**     Input fields:   ZFLD15 15/0                                 *
     C**                     ZDECS  1/0                                  *
     C**                     ZECODE 1/  ('A','C','J','L' or blank)       *
     C**                                ( Default is 'J')                *
     C**     Arrays:         ZS1    15/1/0                               *
     C**                     ZS2    22/1/                                *
     C**                                                                 *
     C**     Output fields:  ZOUT22 22                                   *
     C**     Output fields:  ZOUT25 25  (ALIGNED BY DECIMAL POINT)       *
     C**          (The last 2 characters will be '  ','CR',or '- ')      *
     C**
     C           ZFRPED    BEGSR                           **  ZFRPED   *
     C*
     C* Define/Clear fields
     C*
     C                     Z-ADDZFLD15    ZFLD15 150
     C                     Z-ADDZDECS     ZDECS   10
     C                     MOVE ZECODE    ZECODE  1
     C                     MOVE *BLANKS   ZOUT22 22
     C                     MOVE *BLANKS   ZOUT25 25
     C           ZECODE    IFEQ *BLANKS
     C                     MOVE 'J'       ZECODE
     C                     END
     C*
     C*       SET UP WORK FIELDS
     C*
     C                     Z-ADD0         ZS1
     C                     MOVE ' '       ZS2
     C*
     C                     Z-ADD15        Z1      20
     C                     Z-ADD20        Z2      20
     C*
     C           15        SUB  ZDECS     ZINTS   20
      *                                                                   180280
      ** Check if numeric field is positive                               180280
      *                                                                   180280
     C           ZFLD15    IFGT *ZEROS                                    180280
     C           ZECODE    IFEQ 'A'                                       180280
     C           ZECODE    OREQ 'C'                                       180280
     C**********           MOVEA'DR'      ZS2,21                          180280              240903
     C                     MOVEA'  '      ZS2,21                                              240903
     C                     ELSE                                           180280
     C                     MOVE '+'       ZS2,21                          180280
     C                     END                                            180280
     C                     Z-ADDZFLD15    ZFLD15                          180280
     C                     END                                            180280
     C*
     C* Check if numeric field is negative
     C*
     C           ZFLD15    IFLT *ZEROS
     C           ZECODE    IFEQ 'A'
     C           ZECODE    OREQ 'C'
     C                     MOVEA'CR'      ZS2,21
     C                     ELSE
     C                     MOVE '-'       ZS2,21
     C                     END
     C                     Z-SUBZFLD15    ZFLD15
     C                     END
     C*
     C                     Z-ADDZFLD15    ZWRK15
     C*
     C*       CHECK TO SEE IF THERE ARE ANY DECIMAL PLACES
     C*
     C           ZDECS     CABEQ0         ZS10
     C*
     C*       SET UP DECIMALS
     C*
     C                     Z-ADD*ZEROS    ZCNT    10
     C           ZCNT      DOUEQZDECS
     C                     MOVE ZS1,Z1    ZS2,Z2
     C                     SUB  1         Z2
     C                     ADD  1         ZCNT
     C                     SUB  1         Z1
     C                     END
     C*
     C*       PUT IN DECIMAL PLACE
     C*
     C                     MOVE '.'       ZS2,Z2
     C                     SUB  1         Z2
     C*
     C           ZS10      TAG                             ** ZS10 TAG **
     C*
     C*       SET UP INTEGERS
     C*
     C                     Z-ADD*ZEROS    CNT3    10
     C           Z1        DOUEQ*ZEROS
     C                     MOVE ZS1,Z1    ZS2,Z2
     C                     SUB  1         Z1
     C                     SUB  1         Z2
     C*
     C* If edit code is 'J', insert a ',' before each group of three
     C* digits - not if beginning of array reached.
     C*
     C           Z2        IFGT *ZEROS
     C           ZECODE    ANDEQ'J'
     C           Z2        ORGT *ZEROS
     C           ZECODE    ANDEQ'A'
     C                     ADD  1         CNT3
     C           CNT3      IFEQ 3
     C                     MOVE ','       ZS2,Z2
     C                     SUB  1         Z2
     C                     Z-ADD*ZEROS    CNT3
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*       PUT IN LEADING BLANKS
     C*
     C                     Z-ADD1         Z2
     C           ZS2,Z2    DOWEQ'0'
     C           ZS2,Z2    OREQ ' '
     C           ZS2,Z2    OREQ ','
     C                     MOVE ' '       ZS2,Z2
     C                     ADD  1         Z2
     C           Z2        CABEQ23        ZS20
     C                     END
     C*
     C*       IF NO INTEGERS PUT IN LEADING ZERO
     C*
     C           ZS20      TAG                             ** ZS20 TAG **
     C*
     C           Z2        IFEQ 23
     C                     SUB  2         Z2
     C                     MOVE '0'       ZS2,Z2
     C                     ELSE
     C*
     C           ZS2,Z2    IFEQ '.'
     C                     SUB  1         Z2
     C                     MOVE '0'       ZS2,Z2
     C                     END
     C                     END
     C*
     C*       SET UP OUTPUT FIELD
     C*
     C                     MOVEAZS2       ZOUT22
     C*
     C           ZDECS     IFEQ 0
     C                     MOVE ZOUT22    ZOUT0
     C                     ELSE
     C**
     C           ZDECS     IFEQ 1
     C                     MOVE ZOUT22    ZOUT1
     C                     ELSE
     C**
     C           ZDECS     IFEQ 2
     C                     MOVE ZOUT22    ZOUT2
     C                     ELSE
     C**
     C                     MOVE ZOUT22    ZOUT3
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C*
     C*
      /TITLE         <<< ZDATE2 SR. >>>
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR LEAP YEAR WORK FIELD.
     C                     MOVE 'N'       ZLEAP   1
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50
     C           ZDAYN1    IFLT 0
     C                     GOTO ZDEND2
     C                     END
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    IFGE ZYDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG1
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C           ZWRK2     IFNE 0
     C           ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C                     END
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C           ZWRK2     IFEQ 0
     C           ZDAYN1    IFEQ 59
     C                     MOVE 'Y'       ZLEAP
     C                     END
     C           ZDAYN1    IFGE 59
     C           ZDAYN1    SUB  1         ZDAYN1
     C                     END
     C                     END
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    IFGE ZMDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG2
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C           ZLEAP     IFEQ 'Y'
     C           ZDAY      ADD  1         ZDAY
     C                     END
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C                     MOVELZDAY      ZWRK5   5
     C           ZDAY      IFLT 10
     C                     MOVEL' '       ZWRK5
     C                     END
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C**
     C**
      /TITLE         <<< *PSSR SR. >>>
     C*****************************************************************
     C*
     C* *PSSR  --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS
     C*
     C* CALLED FROM: AFTER ABNORNAL OPERATION OCCURS
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           *PSSR     BEGSR                           ** *PSSR **
     C*
     C           *LOCK     IN   EMSDS                                     S01311
     C                     MOVE 'E'       RETND                           S01311
     C                     OUT  EMSDS                                     S01311
      *                                                                   S01311
     C           *NAMVAR   DEFN LDA       @LDA  256                       S01311
     C           *LOCK     IN   @LDA                                      S01311
     C                     MOVE DBERR     @LDA                            S01311
     C                     OUT  @LDA                                      S01311
     C                     SETON                     U7U8LR               S01311
     C                     DUMP
     C*
     C                     ENDSR'*CANCL'                   ** *PSSR **
     C********************************************************************
      /TITLE         <<< FTENQ SR. >>>                                    096486
     C*****************************************************************   096486
     C*                                                                   096486
     C* FTENQ  --- SUBROUTINE TO ENQUIRE ON FT PAYMENTS                   096486
     C*                                                                   096486
     C* CALLED FROM: SUBROUTINE OPTN                                      096486
     C*                                                                   096486
     C* CALLS: FTC0040 - Outgoing Payments Maintenance                    096486
     C*        FTC0050 - Incoming Payments Maintenance                    096486
     C*        FTC0051 - Incoming Payments Maintenance (NEW)              CAP136
     C*        FTC0070 - Cheques for Collection Maintenance               096486
     C*        FTC0080 - Cheques to be Paid Maintenance                   096486
     C*        FTC0100 - Nostro Transfer Maintenance                      096486
     C*                                                                   096486
     C*****************************************************************   096486
     C*                                                                   096486
     C           FTENQ     BEGSR                           ** FTENQ **    096486
     C*                                                                   096486
     C/COPY WNCPYSRC,GL4442C045
     C                     MOVEL'G'       @RFTCD  1                       096486
     C                     MOVEL'E'       @ACTN   1                       096486
     C                     MOVEL'Y'       @LINK   1                       096486
     C*                                                                   096486
     C           @PYTP     IFEQ 'OP'                                      096486
     C/COPY WNCPYSRC,GLH00592
      *                                                                   CAP031
      * Call API PGM if new maintenance function active, else call FT0040 CAP031
      *                                                                   CAP031
     C           CAP131    IFEQ 'Y'                                       CAP031
      *                                                                   CAP031
     C**********           CALL FTOPAY                                               CAP031 BUG24143
     C                     CALL 'FTC0041'                                                   BUG24143
     C                     PARM FTOPAY    PPGM                                              BUG24143
     C                     PARM           @ACTN                           CAP031
     C                     PARM           FTREF                           CAP031
     C                     PARM           @RFTCD                          CAP031
      *                                                                   CAP031
     C                     ELSE                                           CAP031
      *                                                                   CAP031
     C                     CALL 'FTC0040'                                 096486
     C                     PARM           @ACTN                           096486
     C*******************  PARM           @PREF                           096486
     C*******************  PARM           PNARZZ                          096486
     C**********           PARM           @HPREF                    096486124565
     C                     PARM           FTREF                           124565
     C                     PARM           @RFTCD                          096486
      *                                                                   CAP031
     C                     END                                            CAP031
      *                                                                   CAP031
     C                     END                                            096486
     C*                                                                   096486
     C           @PYTP     IFEQ 'IN'                                      096486
      *                                                                   CAP136
     C           CAP136    IFNE 'Y'                                       CAP136
     C                     CALL 'FTC0050'                                 096486
     C                     PARM           @ACTN                           096486
     C*******************  PARM           @PREF                           096486
     C*******************  PARM           PNARZZ                          096486
     C**********           PARM           @HPREF                    096486124565
     C                     PARM           FTREF                           124565
     C                     PARM           @RFTCD                          096486
     C                     PARM           @LINK                           096486
     C                     ELSE                                           CAP136
     C                     CALL 'FTC0051'                                 CAP136
     C**********           PARM           PPGM                                       CAP136 BUG24143
     C                     PARM FTIPAY    PPGM                                              BUG24143
     C                     PARM           @ACTN                           CAP136
     C                     PARM           FTREF                           CAP136
     C                     PARM           @RFTCD                          CAP136
     C                     PARM           @LINK                           CAP136
     C                     PARM '1'       PLEVEL  1                       CAP136
     C                     ENDIF                                          CAP136
      *                                                                   CAP136
     C                     END                                            096486
     C*                                                                   096486
     C           @PYTP     IFEQ 'CC'                                      096486
     C                     CALL 'FTC0070'                                 096486
     C                     PARM           @ACTN                           096486
     C*******************  PARM           @PREF                           096486
     C*******************  PARM           PNARZZ                          096486
     C**********           PARM           @HPREF                    096486124565
     C                     PARM           FTREF                           124565
     C                     PARM           @RFTCD                          096486
     C                     END                                            096486
     C*                                                                   096486
     C           @PYTP     IFEQ 'CP'                                      096486
     C                     CALL 'FTC0080'                                 096486
     C                     PARM           @ACTN                           096486
     C*******************  PARM           @PREF                           096486
     C*******************  PARM           PNARZZ                          096486
     C**********           PARM           @HPREF                    096486124565
     C                     PARM           FTREF                           124565
     C                     PARM           @RFTCD                          096486
     C                     PARM           @LINK                           096486
     C                     END                                            096486
     C*                                                                   096486
     C           @PYTP     IFEQ 'NT'                                      096486
     C                     CALL 'FTC0100'                                 096486
     C                     PARM           @ACTN                           096486
     C*******************  PARM           @PREF                           096486
     C*******************  PARM           PNARZZ                          096486
     C**********           PARM           @HPREF                    096486124565
     C                     PARM           FTREF                           124565
     C                     PARM           @RFTCD                          096486
     C                     END                                            096486
     C*                                                                   096486
     C/COPY WNCPYSRC,GL4442C046
     C                     ENDSR                           ** FTENQ **    096486
     C********************************************************************096486
      /TITLE         <<< ARRAY DATA >>>
     C/COPY WNCPYSRC,GL4442C002
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   EMSG - ERROR MESSAGE
No Postings To Display For This Selection
UNALLOCATED NOSTRO
ENTER '1' FOR LOWER LEVEL ENQUIRY
NO DETAILS FOR THIS MOVEMENT
Transaction details not accessible
INVALID OPTION                                                                              BUG26687
**  CPY@
(c) Finastra International Limited 2001
