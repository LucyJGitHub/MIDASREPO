     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Projected ledger movements enquiry')          *
      *****************************************************************
      *                                                               *
      *  Midas GENERAL LEDGER MODULE                                  *
      *                                                               *
      *  GL4443 - Ledger movements - to start of business.            *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD039988           Date 08Aug16               *
      *  Prev Amend No. MD032180           Date 25Feb15               *
      *                 MD025643           Date 21Mar14               *
      *                 MD025657           Date 14Mar14               *
      *                 AR877000           Date 08Dec11               *
      *                 CGL145B            Date 01Oct13               *
      *                 AR1095995B         Date 26Mar13               *
      *                 AR1095995A         Date 18Mar13               *
      *                 AR792734A          Date 23SEP11               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG26782           Date 24Nov09               *
      *                 BUG26687           Date 06Nov08               *
      *                 CER047             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP204             Date 27Jan10               *
      *                 260753             Date 22Jun09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 252876             Date 13Feb08               *
      *                 247691A            Date 26Jul07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG12795A          Date 11Dec06               *
      *                 BUG12883           Date 12Dec06               *
      *                 BUG12807           Date 11Dec06               *
      *                 BUG12825           Date 06Dec06               *
      *                 BUG12795           Date 04Dec06               *
      *                 BUG12785           Date 29Nov06               *
      *                 CSD027A            Date 03Aug06               *
      *                 235377             Date 09Sep05               *
      *                 239964             Date 07Jun06               *
      *                 240079             Date 07Jun06               *
      *                 239966             Date 05Jun06               *
      *                 116710             DATE 26May06               *
      *                 238578             Date 14Mar06               *
      *                 CGL045             Date 14Feb06               *
      *                 BUG11679           Date 05Jul06               *
      *                 CRE024             Date 26Apr02               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CGL037             Date 14Jul04               *
      *                 BUG5334            Date 10Sep04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG1832            Date 14Apr04               *
      *                 CRE020             Date 20Jan04               *
      *                 CGL029             Date 01Sep03               *
      *                 218300             Date 24Jun03               *
      *                 217524             Date 25Jun03               *
      *                 217484             Date 03Jul03               *
      *                 217483             Date 03Jul03               *
      *                 CRE009             Date 11Sep02               *
      *                 CGL017             Date 26Jun02               *
      *                 177290             Date 03Apr00               *
      * Midas Release 4.01 -------------------------------------------*
      *                 202528             Date 06Feb02               *
      *                 193984             Date 20Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 181780             Date 30Aug00               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 11Oct00               *
      *                 165290             Date 05Mar01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CDL008             Date 02May00               *
      *                 178438             Date 12Sep00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 100293             Date 25Feb00               *
      *                 CFT006             Date 04Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 163504             Date 22Oct99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 139853             Date 04Aug98               *
      *                 137355             Date 18Jun98               *
      *                 120762             DATE 26FEB98               *
      *                 098612             DATE 10Feb98               *
      *                 117436             DATE 04FEB98               *
      *                 S01408             DATE 20FEB97               *
      *                 CCB002             DATE 19AUG96               *
      *                 S01408             DATE 05JUL96               *
      *                 S01408             DATE 03JUL96               *
      *                 S01408             DATE 21FEB96               *
      *                 088216             DATE 23JUN95               *
      *                 S01408             DATE 24JUL95               *
      *                 082738             DATE 22MAR95               *
      *                 082466             DATE 27JAN95               *
      *                 080050             DATE 26JAN95               *
      *                 S01408             DATE 13JAN95               *
      *                 088207 *REWRITE    DATE 24JAN95               *
      *                 062088             DATE 02MAY94               *
      *                 S01472             DATE 12MAR94               *
      *                 041981             DATE 14OCT93               *
      *                 058840             DATE 29JUL93               *
      *                 045014             DATE 07DEC92               *
      *                 042779             DATE 07DEC92               *
      *                 S10736             DATE 03SEP92               *
      *                 E41822             DATE 01JUL92               *
      *                 E27749             DATE 06SEP91               *
      *                 E25312             DATE 23JUL91               *
      *                 LN1295             DATE 07JUN91               *
      *                 E32880             DATE 04JUN91               *
      *                 LN1273             DATE 22MAY91               *
      *                 FO0030             DATE 25JAN91               *
      *                 S01299             DATE 20SEP90               *
      *                 LN0902             DATE 23JAN91               *
      *                 E20726             DATE 17MAY90               *
      *                 S01199             DATE 27FEB90               *
      *                 S01251             DATE 03FEB90               *
      *                 S01240             DATE 03JAN90               *
      *                 BHF677             DATE 28SEP90               *
      *                 BHF446             DATE 20AUG90               *
      *                 E20463             DATE 08MAY89               *
      *                 LN0130             DATE 08MAY90               *
      *                 E19563             DATE 15FEB90               *
      *                 E18387             DATE 14FEB90               *
      *                 E18551             DATE 14FEB90               *
      *                 S01117             DATE 21/06/89              *
      *                 S01199             DATE 20/06/89              *
      *                 S01194             DATE 13/03/89              *
      *                 E17842             DATE 11/04/89              *
      *                 E17471             DATE 31/03/89              *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD039988 - Discrepancy of Balances between enquiry screens.  *
      *             Amend to reconcile all screens.                   *
      *  MD032180 - Transaction reference not shown in PAMV. Ensure   *
      *             that STNMR field is initialised with transaction  *
      *             number regardless if S01472 is OFF or ON.         *
      *  MD025643 - Issue in batch reference in Account movement and  *
      *             projected account movements                       *
      *  MD025657 - Transaction Number is not reflected in Projected  *
      *             Account Movements                                 *
      *  AR877000 - Extended narratives enquired are not the          *
      *             expected values (Child:AR877001)                  *
      *  CGL145B - Subsidiaries Daily Sweeping Forecast               *
      *            Added hooks: CGL145_038, CGL145_039                *
      *  AR1095995B - Display projected postings for today regardless *
      *               of Value Date filtered and state of 'Financial  *
      *               Futures Module'                                 *
      *  AR1095995A - Display projected postings for today regardless *
      *               of Value Date filtered                          *
      *  AR792734A - Wrong Projected Account Movement Entries shown   *
      *              After Real Time Posting. Excluded all related    *
      *              Shadow Posting Entries (Child: AR792735A)        *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG26782 - Error message is not displayed, only red highlight*
      *  BUG26687 - Enhancement of enquiries                          *
      *  CER047 - German Features LF037-00 Reporting §24c KWG         *
      *           (Recompile)                                         *
      *  CAP204 - Retail Accounts Transfer - Projected Account        *
      *           Movements                                           *
      *  260753 - Unable to enquire "G" type account in M+ with short *
      *           nostro code RUR14. Allow accounts with type "G" and *
      *           with short nostro code.                             *
      *  252876 - Initialize CHQN to eliminate unnecessary reference  *
      *           in 'Closing Projected Cleared Balance' line.        *
      *  247691A- Patterned fix 247347. Projected account movement    *
      *           enquiry showing 0.00 events.                        *
      *  BUG12795A - Reverse BUG12795                                 *
      *  BUG12883 - PAMV truncated date text (Recompile)              *
      *  BUG12807 - Error 014 in Project Account Movements Enquiry    *
      *  BUG12825-Initialise screen if previous function is F03.      *
      *  BUG12795 - Narrative of interbranch settlements not explicit *
      *             enough.                                           *
      *  BUG12785 - Highlight message line even without error         *
      *             (Recompile)                                       *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  235377 - Dbase 4 in GL4430. Problem with CGL029              *
      *           Passed parameters are in wrong order and not all    *
      *           values are passed                                   *
      *           GL4430 expects cnum-ccy-acod-acsq-brca              *
      *           When called missing ccy and acsq                    *
      *  239964 - Applied fix 236093.                                 *
      *  240079 - Applied fix 236093.                                 *
      *  236093 - MidasPlus Webfacing screens hanging since webfacing *
      *           doesn't support TFRGRPJOB.                          *
      *  239966 - Applied fix 236093.                                 *
      *           This fix has already been catered by fix 240079.    *
      *  116710  -  Message subfile causes ERRRCD format not to work. *
      *             Revert to error codes/message being part of       *
      *             SFLCTLR.                                          *
      *  238578 - CGL017-PAMV projection with value date today not    *
      *           shown.                                              *
      *  CGL045 - Show Security Shortname when a 'PS'/'SE' Event.     *
      *  BUG11679 - Additional Conversion of Customer Number to Alpha *
      *  CRE024 - Country Level Switchable Feature :                  *
      *           Security Features for Restricted Accounts.          *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CGL037 - Account Access Security                             *
      *  BUG5334- Retail Account Balance Check. Fix for CRE010.       *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  BUG1832- Projected Account Movements Enquiry Problems        *
      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  218300 - Postings in CLEARPD do not get displayed when VALUE *
      *           DATE greater than the rundate is entered.           *
      *  217524 - PAMV error. If CRE009 in ON, include checking if    *
      *           a/c is valid before chain to REPMFWPD.              *
      *  217484 - Projected closing balance used instead of opening   *
      *           balance.                                            *
      *  217483 - Description field overwriting some ofthe amount     *
      *           field.                                              *
      *  CRE009 - Projected Account Movements for Retail Accounts     *
      *  CGL017 - Projected Account Movements for Nostros             *
      *  177290 - Core fix 087177 creates events for back-valued      *
      *           position settlements. Currently, the projected closn*
      *           ledger balance does not equal the total of the      *
      *           movements which appear on this enquiry screen       *
      *           because these back-valued position settlements don't*
      *           appear. Change this program so unsettled trades     *
      *           are also displayed.                                 *
      *         - Applied fix 162436.                                 *
      *  202528 - Allow the system to view closed accounts in the     *
      *           Account movement enquiries.                         *
      *  193984 - Displays transaction number for FX Option deals.    *
      *  181780 - Deal reference is blank in Projected Movements      *
      *           Enquiry for Interest Rate CAP (Type='RP' which      *
      *           is also a transaction type in Funds Transfer).      *
      *  CSD006 - Use correct parameters for Access Objects           *
      *  165290 - Do not show posting details on the Projected        *
      *           Account Movements screen if the account is an       *
      *           Unallocated Nostro. Also, error in display of       *
      *           'Unallocated Nostro' text was corrected.            *
      *  CDL008 - Continuous Linked Settlement                        *
      *  178438 - Position settlement entries from Securities Trading *
      *           module shown a blank transaction number - replace   *
      *           with a narrative showing the security details.      *
      *  100293 - F5 does not display up-to-date projected account    *
      *           movements or projected closing balance - amend pgm  *
      *           to re-access details if F5 option taken.            *
      *  CFT006 - Inclusion of RFT and CCT Funds Transfer Types       *
      *  163504 - If both date and amount selected, selection should  *
      *           point to those postings with that amount. This is   *
      *           only the case when sign is left blank.              *
      *  CGL007 - Account Postings Enquiry (Recompile)                *
      *  139853 - Closing Cleared Balance not shown for new Account.  *
      *  137355 - Incorrect open for file MEMOSM1.                    *
      *           Fix 98612 not correctly integrated.                 *
      *  120762 - Ensure that an RP deal type have one deal           *
      *           deal transaction number .                           *
      *  098612 - End of center restart locks. The OPEN and CLOSE     *
      *           operations for the file MEMOSM1 and PRONOM1 were    *
      *           done before and after the READ operation            *
      *           respectively to prevent the locking of the files.   *
      *  117436  -  Reconcile Closing Balance with Opening Balance    *
      *             plus Shadow Posting. Applied GEMS fix 116327.     *
      *  S01408  -  Core hook GL4443C025 added.                       *
      *             Core hook GL4443C024 added.                       *
      *             Core hook GL4443C023 added.                       *
      *             Core hook GL4443C022 added.                       *
      *             These hooks were added manually next to existing  *
      *             hooks which appeared twice in the source.         *
      *             (see GL4443CCP1 & GL4443CCP3)                     *
      *  CCB002 - COB Performance Enhancements                        *
      *           Access now via access object                        *
      *           Change MEMOS processing to use access objects.      *
      *  S01408  -  Core hook GL4443CP30 added.                       *
      *             Core hook GL4443CP29 added.                       *
      *  S01408  -  Core hook GL4443CP28 added.                       *
      *             Core hook GL4443CP27 added.                       *
      *             Core hook GL4443CP26 added.                       *
      *             Core hook GL4443CP25 added.                       *
      *             Core hook GL4443CP24 added.                       *
      *             Core hook GL4443CP23 added.                       *
      *             Core hook GL4443CP22 added.                       *
      *  S01408  -  Core hook GL4443CP20 added.                       *
      *             Core hook GL4443CP21 added.                       *
      *  088216 - F5 refresh key caused program error.                *
      *           The field RRNM in PF/CLEARPD accessed via RSACMTL1  *
      *           and RSACMTL2 overwrites RRN of Memos record held on *
      *           ACCNTAB, causing program to terminate if Refresh    *
      *           (F5) requested for account with items in clearing.  *
      *           Fix is to rename RRNM for this file.                *
      *  S01408  -  Core hook GL4443IIP1 added.                       *
      *             Core hook GL4443CP18 added.                       *
      *             Core hook GL4443CP19 added.                       *
      *  082738 - Rewrite of projected account movements. Now shows   *
      *           securities coupon transactions as type CP which is  *
      *           also a Funds Transfer type. If FT transaction ref   *
      *           is blank then use the normal transaction number.    *
      *  082466  -  DB error 02 because branch code was not being     *
      *             passed to AONARRR0 when full account number used  *
      *  080050  -  Narrative code on Shadow Postings file is now     *
      *             alphabetic - amended program                      *
      *  S01408 - Addition of core hook GL4443IIPG                    *
      *           Addition of core hook GL4443FFPG                    *
      *           Addition of core hook GL4443CIRE                    *
      *           Addition of core hook GL4443CVKS                    *
      *           Addition of core hook GL4443CVK1                    *
      *           Addition of core hook GL4443CCPG                    *
      *           Addition of core hook GL4443CCP1                    *
      *           Addition of core hook GL4443CCP2                    *
      *           Addition of core hook GL4443CCP3                    *
      *           Addition of core hook GL4443CCP4                    *
      *           Addition of core hook GL4443CCP5                    *
      *           Addition of core hook GL4443CCP6                    *
      *           Addition of core hook GL4443CCP7                    *
      *           Addition of core hook GL4443CCP8                    *
      *           Addition of core hook GL4443CCP9                    *
      *           Addition of core hook GL4443CP10                    *
      *           Addition of core hook GL4443CP11                    *
      *           Addition of core hook GL4443CP12                    *
      *           Addition of core hook GL4443CP13                    *
      *           Addition of core hook GL4443CP14                    *
      *           Addition of core hook GL4443CP15                    *
      *           Addition of core hook GL4443CP16                    *
      *           Addition of core hook GL4443CP17                    *
      *  088207 - Program was displaying balance from previous        *
      *           account enquired on, for a nostro opened today,     *
      *           because there was no PRONO record for this nostro.  *
      *           Amended pgm to display 'Unallocated Nostro' and     *
      *           'Not Available' in place of Projected Closing       *
      *           Balance for an unallocated nostro as this is not    *
      *           available until after a COB has been run.           *
      *         - Do not set up DBERR details if no record on PRONO   *
      *           as this is not a DB Error - nostro has been set up  *
      *           today                                               *
      *         - Add message handling subfile processing to program  *
      *           to display new messages added.                      *
      *         - Obtain details each time user presses enter, even   *
      *           if account has not changed, to capture up-to-date   *
      *           information                                         *
      *         - Get F5 key to refresh; this also makes core hooks   *
      *           GL4443CP16/7 redundant as F5 processing merged      *
      *           with Enter processing.                              *
      *         - Blank out return code before calling an Access      *
      *           Object program to prevent invalid database error    *
      *           - this may happen if the return code is *NRF from   *
      *           access to the SAR Descriptions file, for example    *
      *         - Externalise ZDATE1/ZDATE2/ZFRPED/ZALIGN using /COPY *
      *         - Define LDA fields correctly                         *
      *         - Because of the amount of change to the program it   *
      *           has been code-stripped and tidied up, therefore     *
      *           this fix is not annotated.                          *
      *           Note - this fix replaces 080945.                    *
      *                                                               *
      *  Previous fix details, retained for reference purposes.       *
      *                                                               *
      *  062088 - Forced update of totals when CMD5 is pressed.       *
      *  S01472 - A/C movements enquiry to show batch number          *
      *  041981 - System does not reflect correct today's projected   *
      *           nostro balance. Fix applied is to look up the run   *
      *           date in the nostro balance posting date array to    *
      *           get the corresponding closing balance of account    *
      *           movements as of run date.                           *
      *  058840 - Change spool file name to GL4430P1 and              *
      *           set action code to *BOTH if a Retail Nostro.        *
      *  045014 - Apply 045014.                                       *
      *           Incorporate list function for printing              *
      *  042779 - For Retail accounts also include postings           *
      *           from CLEARPD as these effect both balances          *
      *           and may be valued today.                            *
      *  S10736 - RECOMPILE FOR MANAGEMENT ACCOUNTING                 *
      *  E41822 - TRANSACTION REF. IS INCORRECT SHOWS ONLY FIRST      *
      *           REF FOR ALL POSTINGS.                               *
      *  E27749 - ALLOW ENQUIRY ON NOSTRO WITH ATYP NOT 'R' OR 'N'    *
      *  E25312 - PGM FALLS OVER ON ROLLUP BECAUSE DSPREC HAS BEEN    *
      *           SET TO RRN FOR NEXT SUBFILE PAGE, BUT SUBSEQUENT    *
      *           VALIDATION EXCLUDES FURTHER RECORDS FROM BEING      *
      *           WRITTEN TO SUBFILE                                  *
      *  LN1295 - WHEN NOSTRO CODE OR SHORTNAME ENTERED & VALIDATED   *
      *           REMAINING INPUT FIELDS SHOULD BE BLANKED OUT        *
      *  E32880 - FOR FUNDS TRANSFER TRANSACTIONS THE FULL REF        *
      *           SHOULD BE USED.                                     *
      *  LN1273 - IF MBIN = N, THE SINGLE BRANCH VALUE (DEFAULT       *
      *           BRANCH FROM ZMUSER) SHOULD BE USED IN CHAIN TO      *
      *           ACCOUNTS FILE                                       *
      *           BRANCH AUTHORITY ONLY CHECKED WHEN MBIN = Y.        *
      *  FO0030 - UPDATE KEY LIST DUE TO MULTIBRANCHING OF MEMOSM1    *
      *  S01299 - ALLOW 32 MARKET CENTRES AS PER ORIGINAL             *
      *           SPECIFICATION.                                      *
      *  LN0902 - RSACMTL1/2 ARE NOT BUILT OVER PF/FFACMVD ANY MORE   *
      *  E20726 - RETAIL NOSTROS ARE BEING DEALT WITH AS RETAIL       *
      *           ACCOUNTS WHEN THEY SHOULD BE TREATED AS NOSTROS     *
      *  S01199 - HELP SYSTEM                                         *
      *  S01251 - NOT NEEDED BECAUSE OF S01194.                       *
      *  S01240 - FF/AME INTERFACE INCORPORATION                      *
      *  BHF677 - INCORRECT ZERO SUPPRESSION IN CHEQUE NUMBER         *
      *           FIELD OF SUBFILE RECORD                             *
      *  BHF446 - CORRECT THE APPLICATION OF E18387                   *
      *  E20463 - NUMBER OF DECIMAL PLACES ON CURRENCY FIELD IS       *
      *           NOT CHECKED WHEN ENQUIRY CHANGES.                   *
      *  LN0130 - STANDARDISE PARAMETERS OF AOACCTV0                  *
      *  E19563 - ALL REFERNCES TO COMMAND 12 CHANGED TO COMMAND 5    *
      *         +  *INKL CHANGED TO *INKE                             *
      *  E18387 - INCORRECT PARAMETERS PASSED FOR NOSTRO              *
      *           VALIDATION.                                         *
      *  E18551 - RECOMPILE OVER CHANGED DISPLAY FILE                 *
      *  S01117 - Release 10 (Multibranching)                         *
      *  S01199 - HELP FACILITY MODIFIED                              *
      *  S01194 - NEW STANDING DATA                                   *
      *  E17842 - CALL TO WRONG A/C VALIDATION PROGRAM.               *
      *  E17471 - ALL ACCOUNT MOVEMENT ENQUIRIES ARE                  *
      *           DISPLAYED IN INCORRECT SEQUENCE                     *
      *                                                               *
      *****************************************************************
      *                                                               *
      *                                                               *
      *    I N D I C A T O R   U S A G E                              *
      *                                                               *
      *    01  First time indicator                                   *
      *    02  Display subfile                                        *
      *    03  Display subfile control record                         *
      *    04  Enable SFLEND                                          *
      *    06  List present account                                   *
      *                                                               *
      *    11  Enter key pressed                                      *
      *    12  Input criteria has been changed                        *
      *    14  ON = Account is retail                                 *
      *    15  Unallocated nostro - no record on PRONO                *
      *                                                               *
      *    20  Invalid account entered                                *
      *    21  Single branch                                          *
      *    25  Rollup key pressed                                     *
      *                                                               *
      *    47  Additional account balance record not found on         *
      *        memosm1/pronom1.                                       *
      *    50  Input criteria is invalid                              *
      *    51  Customer number is invalid                             *
      *    52  User not Authorised to Branch                          *
      *                                                               *
      *    60  Account number has changed                             *
      *    61  Posting date has changed                               *
      *    62  Plus/Minus indcator has changed                        *
      *    63  Amount or cheque number has changed                    *
      *    64  Invalid account         - display reverse image        *
      *    65  Invalid date            - display reverse image        *
      *    66  Invalid (+/-) indicator - display reverse image        *
      *    67  Invalid amount          - display reverse image        *
      *    68  Invalid cheque number   - display reverse image        *
      *    70  Indicator for SFLEND for Message subfile               *
      *    71  Indicator for SFLCLR for Message subfile               *
      *                                                               *
      *    80  No more account movements for details as specified     *
      *        by the user                                            *
      *    81  'OFF' = posting record meets selection criteria        *
      *    82  S01472 is switched ON                                  *
      *    83  No records in the subfile for this account             *
      *    84  No records on FFACMV2/FFACMV3                          *
      *    85  No records on RSACMTL1/RSACMTL2                        *
      *    86  No records on GLACBTL0                                 *   117436
      *                                                               *
      *    9n  all 9? indicators used for standard subroutines        *
      *    98  Date format is 'M'                                     *
      *    99  also used as a general purpose indicator               *
      *                                                               *
      *    KC  Command key  3 pressed                                 *
      *    KE  Command key  5 pressed                                 *
      *    KM  Command key 13 pressed                                 *
      *    KN  Command key 14 pressed                                 *
      *    KQ  Command key 16 pressed                                 *
      *                                                               *
      *    LR  End of program                                         *
      *                                                               *
      *****************************************************************
      *
     FGL4443DFCF  E                    WORKSTN      KINFDS DSPFDS
     F                                        RRN   KSFILE SFLRCD
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL4443FFPG                                           S01408
     F*                                                                   S01408
     FAPOSTL12IF  E           K        DISK                                                AR792734A
     F            APOSTPDF                          KRENAMEAPOST12                         AR792734A
     FRSACMTL1IF  E           K        DISK
     F/COPY WNCPYSRC,GL4443F002
     F            APOSTPDF                          KRENAMEAPOST1
     F            RSACMTPO                          KRENAMERSACMTP1
     FRSACMTL2IF  E           K        DISK
     F            APOSTPDF                          KRENAMEAPOST2
     F            RSACMTPO                          KRENAMERSACMTP2
     FRSACMTL5IF  E           K        DISK                               CGL017
     F            APOSTPDF                          KRENAMEAPOST5         CGL017
     F            RSACMTPO                          KRENAMERSACMTP5       CGL017
     FFFACMV2 IF  E           K        DISK                           UC
     F            FFACMVDF                          KRENAMEFFACMVD2
     F/COPY WNCPYSRC,GL4443F001
     FFFACMV3 IF  E           K        DISK                           UC
     F/COPY WNCPYSRC,GL4443F003
     F            FFACMVDF                          KRENAMEFFACMVD3
     F******MEMOS   IF  E                    DISK                         CCB002
     FPRONO   IF  E           K        DISK
     FMEMOSM1 IF  E           K        DISK                           UC
     FPRONOM1 IF  E           K        DISK                           UC
     F****GLACBTL0IF  E           K        DISK                                      117436 MD039988
     FACCNTL0 IF  E           K        DISK                                                 MD039988
     FREPMFWL1IF  E           K        DISK                               CRE009
      /TITLE         >>> TABLES/ARRAYS <<<
     E                    FCODE      10  1
     E                    FTEXT      10 30
     E                    PBAL        5 15 0             PRONO BALS
     E                    PDAT        5  5 0             PRONO DATES
     E                    ERCD       19  4               ERROR CODES
     E/COPY ZSRSRC,ZALIGNZ1
     E/COPY ZSRSRC,ZFRPEDZ1
     E                    CPY@    1   1 80               COPYRIGHT STATEMENT
     E********************TXT     1   1 80               TEXT             CGL017
     E********************TXT     1   7 80               TEXT       CGL017CRE009
     E                    TXT     1   8 80               TEXT             CRE009
     E**********          EMSG    1   1 70                                           116710 BUG26687
     E**********          EMSG    1   3 70                                         BUG26687 BUG26782
     E/COPY WNCPYSRC,GLH00338
     E                    EMSG    1   4 70                                                  BUG26782
     E/COPY WNCPYSRC,GLH00339
     E/COPY ZSRSRC,ZDATE2Z1
      /TITLE         >>> FILE FIELDS <<<
     E/COPY WNCPYSRC,GL4443E001
      *
     IMEMOSMEF
     I              LDBL                            LDBLX
     I              CLBL                            CLBLX
      *
      * Add indicators to formats of APOSTPDF and RSACMTPO
      *
     IAPOST1      31
     I              CHQN                            #CHQN
     I              RRNM                            #RRNM                 088216
      *
      ** Rename fields on RSACMTL1 by adding suffix 'A'
      *
     IRSACMTP1    32
     I              CUSN                            CUSNA
     I              CCYD                            CCYDA
     I              ACDE                            ACDEA
     I              ASNC                            ASNCA
     I              PTDT                            PTDTA
     I              VUDT                            VUDTA
     I              TRYP                            TRYPA
     I              NRTC                            NRTCA
     I              NRTD                            NRTDA
     I              TNMR                            TNMRA
     I              CQNR                            CQNRA
     I              MVAM                            MVAMA
     I              DORC                            DORCA
      *
      * Add indicators to formats of APOSTPDF and RSACMTPO
      *
     IAPOST2      33
     I              CHQN                            #CHQN
     I              RRNM                            #RRNM                 088216
      *
      ** Rename fields on RSACMTL2 by adding suffix 'B'
      *
     IRSACMTP2    34
     I              CUSN                            CUSNB
     I              CCYD                            CCYDB
     I              ACDE                            ACDEB
     I              ASNC                            ASNCB
     I              PTDT                            PTDTB
     I              VUDT                            VUDTB
     I              TRYP                            TRYPB
     I              NRTC                            NRTCB
     I              NRTD                            NRTDB
     I              TNMR                            TNMRB
     I              CQNR                            CQNRB
     I              MVAM                            MVAMB
     I              DORC                            DORCB
      *
     IAPOST5      31                                                      CGL017
     I              CHQN                            #CHQN                 CGL017
     I              RRNM                            #RRNM                 CGL017
      *                                                                   CGL017
      ** Rename fields on RSACMTL5 by adding suffix 'E'                   CGL017
      *                                                                   CGL017
     IRSACMTP5    32                                                      CGL017
     I              CUSN                            CUSNE                 CGL017
     I              CCYD                            CCYDE                 CGL017
     I              ACDE                            ACDEE                 CGL017
     I              ASNC                            ASNCE                 CGL017
     I              PTDT                            PTDTE                 CGL017
     I              VUDT                            VUDTE                 CGL017
     I              TRYP                            TRYPE                 CGL017
     I              NRTC                            NRTCE                 CGL017
     I              NRTD                            NRTDE                 CGL017
     I              TNMR                            TNMRE                 CGL017
     I              CQNR                            CQNRE                 CGL017
     I              MVAM                            MVAME                 CGL017
     I              DORC                            DORCE                 CGL017
      *                                                                   CGL017
      *                                                                                    AR792734A
     IAPOST12                                                                              AR792734A
     I              CHQN                            #CHQN                                  AR792734A
     I              RRNM                            #RRNM                                  AR792734A
      ** Rename fields on FFACMV2 by adding suffix 'C'
      *
     IFFACMVD2
     I              BRCA                            BRCAC
     I              CUSN                            CUSNC
     I              CCYD                            CCYDC
     I              ACDE                            ACDEC
     I              ASNC                            ASNCC
     I              PTDT                            PTDTC
     I              VUDT                            VUDTC
     I              TRYP                            TRYPC
     I              NRTC                            NRTCC
     I              NRTD                            NRTDC
     I              TNMR                            TNMRC
     I              CQNR                            CQNRC
     I              MVAM                            MVAMC
     I              DORC                            DORCC
      *
      ** Rename fields on FFACMV3 by adding suffix 'D'
      *
     IFFACMVD3
     I              BRCA                            BRCAD
     I              CUSN                            CUSND
     I              CCYD                            CCYDD
     I              ACDE                            ACDED
     I              ASNC                            ASNCD
     I              PTDT                            PTDTD
     I              VUDT                            VUDTD
     I              TRYP                            TRYPD
     I              NRTC                            NRTCD
     I              NRTD                            NRTDD
     I              TNMR                            TNMRD
     I              CQNR                            CQNRD
     I              MVAM                            MVAMD
     I              DORC                            DORCD
      *
      /TITLE         >>> DATA AREAS <<<
      *
     IDSLDA       DS
      *
      *  *LDA for transfering enquiry selection criteria
      *
     I**********                              2  59 LDADTA                                    CGL029
     I**********                              2  65 LDADTA                             CGL029 236093
     I                                        2  68 LDADTA                                    236093
     I                                        2  11 CNUMR
     I                                        2   4 KPRCCY
     I                                        5   60KPRNO
     I                                        5   6 KPRNOA
     I                                        7  20 KPREST
     I                                       12  14 CURRY
     I**********                             15  18 ACCOD                                     CGL029
     I**********                             19  20 ACSEQ                                     CGL029
     I                                       15  24 ACCOD                                     CGL029
     I                                       25  26 ACSEQ                                     CGL029
     I**********                              2  20 ACNT                                      CGL029
     I**********                             21  23 BRNCH                                     CGL029
     I**********                              2  23 MBACNT                                    CGL029
     I**********                             24  29 VALDA                                     CGL029
     I**********                             30  30 PORM                                      CGL029
     I**********                             31  44 AMONT                                     CGL029
     I**********                             45  52 CQNMR                                     CGL029
     I**********                             53  59 SPOS                                      CGL029
     I                                        2  26 ACNT                                      CGL029
     I                                       27  29 BRNCH                                     CGL029
     I                                        2  29 MBACNT                                    CGL029
     I                                       30  35 VALDA                                     CGL029
     I                                       36  36 PORM                                      CGL029
     I                                       37  50 AMONT                                     CGL029
     I                                       51  58 CQNMR                                     CGL029
     I**********                             59  65 SPOS                             CGL029 MD025643
     I                                       66  68 FUNC                                      236093
      *
      *  *LDA for reporting error messages
      *
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I/COPY WNCPYSRC,GL4443I006
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I* External DTAARA for run-date
     I*
     I**
     IRUNDT       DS
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
     I*
     I* External DTAARA for ZMUSER
     I*
     IZMUSER      DS
     I                                       11  13 BRC
     I                                       17  17 BANK
     I*
     IP@FMT1    E DSACCNTAB
     I              BRCA                            KBRC
     I              CNUM                            KCUS
     I              CCY                             KCCY
     I              ACOD                            KCOD
     I              ACSQ                            KASE
     I                                        2   7 KCUSA
     I                                        8  10 KCYC                                      235377
     I**********                             11  14 KCODA                                     CGL029
     I                                       15  16 KASEA
     I**********                              2  16 KEYAC                                     CGL029
     I                                      554 563 KCODA                                     CGL029
     IEMSDS     E DSEMDTA                                                                    BUG5334
      ** External Data Area for Linked Enquiry Processing                                    BUG5334
      *                                                                                      BUG5334
     I                                      141 146 CNUMP                                    BUG5334
     I                                      147 149 CURRP                                    BUG5334
     I                                      150 159 ACODP                                    BUG5334
     I                                      160 161 ACSQP                                    BUG5334
     I                                      162 164 BRCHP                                    BUG5334
     I                                      165 166 LINKP                                    BUG5334
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL4443IIP1                                           S01408
     I*                                                                   S01408
     I*
     IP@FMT2    E DSSDCURRPD
     IP@FMT3    E DSSDNOSTPD
     I*
     I            DS
     I                                       49  560CQKEY
     I*
     IP@ALL       DS
     I                                        1   7 P@RTCD
     I                                        8  14 P@OPTN
     I                                       15  24 P@KEY1
     I                                       25  31 P@ANY
     I                                       32  34 P@KEY2
     I**********                             35  38 P@KEY3                                    CGL029
     I**********                             39  40 P@KEY4                                    CGL029
     I**********                             41  47 P@TYPE                                    CGL029
     I**********                             48  49 P@NOSN                                    CGL029
     I**********                             50  55 P@CUST                                    CGL029
     I**********                             56  58 P@KEY5                                    CGL029
     I                                       35  44 P@KEY3                                    CGL029
     I                                       45  46 P@KEY4                                    CGL029
     I                                       47  53 P@TYPE                                    CGL029
     I                                       54  55 P@NOSN                                    CGL029
     I                                       56  61 P@CUST                                    CGL029
     I                                       62  64 P@KEY5                                    CGL029
     I*
     I            DS
     I                                        1  76 ERCD
     I                                        1  76 ERRDSP
     I*
     I                                       77 116 PNB
     I                                    P  77 116 PBAL
     I                                      117 131 PND
     I                                    P 117 131 PDAT
     I*
     IMMOD      E DSMMODF
     I              ZZ002                           ZZ002B
     I*
     I/COPY ZSRSRC,ZFRPEDZ2
     I*
     I/COPY WNCPYSRC,GL4443I005
     ISFLD31      DS
     I                                        2   8 VALDZ
     I                                       10  12 ABTCH
     I                                       10  11 ABTCH2
     I                                       16  23 CHQN
     I                                       25  26 TRYP
     I**********                             30  44 STNMR                                     178438
     I**********                             30  55 STNMR                            178438 BUG12795
     I**********                             30  58 STNMR                         BUG12795 BUG12795A
     I                                       30  55 STNMR                                  BUG12795A
     I**********                             58  76 PSTAZ                                   BUG12795
     I**********                             61  79 PSTAZ                         BUG12795 BUG12795A
     I                                       58  76 PSTAZ                                  BUG12795A
     I**********                             25  60 PDESC                              CGL017 217483
     I                                       22  57 PDESC                                     217483
     I/COPY WNCPYSRC,GL4443I007
     I*
     I@DESC       DS                                                                          CRE009
     I                                        1  28 LPDESC                                    CRE009
     I                                       29  36 RPDESC                                    CRE009
     I* Data structure for subfile record when switch S01472 is ON
     ISFLD32      DS
     I                                        5  11 VALDZ2
     I                                       14  21 CHQN2
     I                                       25  26 TRYP2
     I**********                             30  44 STNMR2                                    178438
     I**********                             30  55 STNMR2                           178438 BUG12795
     I**********                             30  58 STNMR2                        BUG12795 BUG12795A
     I                                       30  55 STNMR2                                 BUG12795A
     I**********                             58  76 PSTAZ2                                  BUG12795
     I**********                             61  79 PSTAZ2                        BUG12795 BUG12795A
     I                                       58  76 PSTAZ2                                 BUG12795A
      *
     I@DSFDY    E DSDSFDY                                                 CCB002
     I*  FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE               CCB002
     I*                                                                   CCB002
     IDSMEMS    E DSMEMOS                                                 CCB002
     I** External data structure for MEMOS Details                        CCB002
     I** Renamed fields in PF/MEMOS                                       CCB002
     I              RECI                            MERECI                CCB002
     I              CNUM                            MECNUM                CCB002
     I              CCY                             MECCY                 CCB002
     I              ACOD                            MEACOD                CCB002
     I              ACODQQ                          QQACOD                                    CGL029
     I              ACSQ                            MEACSQ                CCB002
     I              BRCA                            MEBRCA                CCB002
     I              ACNO                            MEACNO                CCB002
     IUMEMER      DS                                                      CCB002
      ** Data structure for database error on call to AOMEMSR0.           CCB002
     I**********                              1   60U0CNUM                             CCB002 CSD027
     I                                        1   6 U0CNUM                                    CSD027
     I                                        7   9 U0CUCD                CCB002
     I**********                             10  130U0ACCD                             CCB002 CGL029
     I**********                             14  150U0ACSQ                             CCB002 CGL029
     I**********                             16  18 U0BRCA                             CCB002 CGL029
     I                                       10  190U0ACCD                                    CGL029
     I                                       20  210U0ACSQ                                    CGL029
     I                                       22  24 U0BRCA                                    CGL029
     I*
     I*    PROGRAM DS TO GET WORK STN ID
     I*
     I           SDS
     I                                        1  10 SPGMQ
     I                                      244 246 WSID
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL4443IIPG                                           S01408
     I*                                                                   S01408
     I*
     I*    DSPF DS  TO RETRIEVE CPF'S POSITION WITHIN THE SUBFILE
     I*
     IDSPFDS      DS
     I                                    B 378 3790CPFPOS
      *
      *  Input parameters data structure
      *
     IC#DTA       DS                            256
      *  Account type F=Full nostro G=General Ledger
      *               R= Retail Number
     I                                        1   1 C#ATYP
      *               Full General Ledger - CNUM/CCY/ACOD/ACSQ
     I**********                              2  16 C#ACCT                                   BUG1832
     I                                        2  22 C#ACCT                                   BUG1832
     I**********                              2   70C#CNUM                                  BUG11679
     I                                        2   7 C#CNUM                                  BUG11679
     I                                        8  10 C#CCY
     I**********                             11  140C#ACOD                                    CGL029
     I**********                             15  160C#ACSQ                                    CGL029
     I**********                             17  19 C#BRCA                                    CGL029
     I                                       11  200C#ACOD                                    CGL029
     I                                       21  220C#ACSQ                                    CGL029
     I                                       23  25 C#BRCA                                    CGL029
      *               Full Nostro - CCY/NOSN
     I                                        2   6 C#NOS
      *               Retail Number
     I                                        2  110C#ACNO
      *               FT Memos ledger balance override
      *                        'Y' calculate ledger balance irrespective of
      *                        posting date
     I**********                             20  20 C#FTOV                                    CGL029
     I                                       26  26 C#FTOV                                    CGL029
      *               Spool file name
      *                        If blank name unchanged
      *                        Note to change name C#SPLR must be Y
      *                        Unless first call of program
     I**********                             21  30 C#SPLN                                    CGL029
     I                                       27  36 C#SPLN                                    CGL029
      *               Repeat open and close of spool file
      *                        If Y create new spool file
     I**********                             31  31 C#SPLR                                    CGL029
     I                                       37  37 C#SPLR                                    CGL029
      *
      *  Report Reference if Access checking is off
      *
     I**********                             32  41 C#REFN                                    CGL029
     I                                       38  47 C#REFN                                    CGL029
      *
      ** Key fields Value Date, Movement Amount and Dr/Cr indicator
      ** used for file RSACMTL1
      *
     IRSKY1       DS
     I                                    P   1   30VUDTA
     I/COPY WNCPYSRC,GL4443I001
     I                                    P   4  100MVAMA
     I                                       11  110DORCA
     I/COPY WNCPYSRC,GL4443I002
      *
      ** Key field of Cheque Number used for file RSACMTL2
      *
     IRSKY2       DS
     I                                        1   80CQNRB
      *
      ** Key field of Cheque Number used for file FFACMV2
      *
     IFFKY2       DS
     I                                        1   80CQNRC
      *
      ** Key fields Value Date, Movement Amount and Dr/Cr indicator
      ** used for file FFACMV3
      *
     IFFKY3       DS
     I                                    P   1   30VUDTD
     I/COPY WNCPYSRC,GL4443I003
     I                                    P   4  100MVAMD
     I                                       11  110DORCD
      *                                                                                       CGL037
      ** External DS for SAR Details                                                          CGL037
      *                                                                                       CGL037
     ISCSARD    E DSSCSARDPD                                                                  CGL037
     I              LCD                             SCLCD                                     CGL037
      *                                                                                       CGL037
     I/COPY WNCPYSRC,GL4443I004
     I            DS                                                                CGL017
     I                                        1  10 WCNUMR                          CGL017
     I                                        6   6 CNUMR6                          CGL017
      *
     I*
     IDSSDY     E DSDSSDY
      ** EXTERNAL DS FOR LONG DUMMY DATA STRUCTURE
     I*
     I              'GBSDUSRMSG'          C         XMSGFN                                  BUG26687
     I*
     I**********  DS                                                              BUG12795 BUG12795A
     I**********                              1  30 IPNRTD                        BUG12795 BUG12795A
     I**********                              1  08 IPNRDS                        BUG12795 BUG12795A
     I**********                             09  30 INTERB                        BUG12795 BUG12795A
     I*I********    'Originating Branch '    09  27 IPFRBP                        BUG12795 BUG12795A
     I**********                             28  30 IPFRBB                        BUG12795 BUG12795A
     I**********                                                                  BUG12795 BUG12795A
      /TITLE         >>> START OF MAIN PROCESSING <<<
     C*
     C                     MOVEACPY@      BIS@   80
     C*
     C           *NAMVAR   DEFN *LDA      DSLDA
     C*
      ** Rename of original fields means that they need to be
      ** re-defined for following key lists.
      *
     C           *LIKE     DEFN CUSNC     CUSN
     C           *LIKE     DEFN CCYDC     CCYD
     C           *LIKE     DEFN ACDEC     ACDE
     C           *LIKE     DEFN ASNCC     ASNC
     C           *LIKE     DEFN PTDTC     PTDT
     C           *LIKE     DEFN VUDTC     VUDT
     C           *LIKE     DEFN NRTCC     NRTC
     C           *LIKE     DEFN NRTDC     NRTD
     C           *LIKE     DEFN CQNRC     CQNR
     C           *LIKE     DEFN MVAMC     MVAM
     C           *LIKE     DEFN DORCC     DORC
     C                     MOVE 'N'       EXTFLG  1                                           236093
     C                     Z-ADD*ZEROS    VALD0   50                                      AR1095995A
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP18                                           S01408
     C*                                                                   S01408
      *
     C           KALL      KLIST
     C                     KFLD           KBRC                            FO0030
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C*
     C           KEYSL1    KLIST
     C                     KFLD           KBRC
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C                     KFLD           VALDN
     C/COPY WNCPYSRC,GL4443C002
     C                     KFLD           AMTKY
     C                     KFLD           DORK                            E17471
     C/COPY WNCPYSRC,GL4443C003
     C*
     C           KEYSLA    KLIST                                                          AR1095995A
     C                     KFLD           KBRC                                            AR1095995A
     C                     KFLD           KCUS                                            AR1095995A
     C                     KFLD           KCCY                                            AR1095995A
     C                     KFLD           KCOD                                            AR1095995A
     C                     KFLD           KASE                                            AR1095995A
     C                     KFLD           VALD0                                           AR1095995A
     C                     KFLD           AMTKY                                           AR1095995A
     C                     KFLD           DORK                                            AR1095995A
      *                                                                                   AR1095995A
     C           KEYSL2    KLIST
     C                     KFLD           KBRC
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C                     KFLD           CQKEY
     C*
     C           KEYSL5    KLIST                                          CGL017
     C                     KFLD           KBRC                            CGL017
     C                     KFLD           KCUS                            CGL017
     C                     KFLD           KCCY                            CGL017
     C                     KFLD           KCOD                            CGL017
     C                     KFLD           KASE                            CGL017
     C                     KFLD           VALDN                           CGL017
     C                     KFLD           DORK                            CGL017
     C                     KFLD           AMTKY                           CGL017
      *                                                                   CGL017
     C           KEYL12    KLIST                                                           AR792734A
     C                     KFLD           KBRC                                             AR792734A
     C                     KFLD           KCUS                                             AR792734A
     C                     KFLD           KCCY                                             AR792734A
     C                     KFLD           KCOD                                             AR792734A
     C                     KFLD           KASE                                             AR792734A
     C                     KFLD           PTDT                                             AR792734A
     C                     KFLD           KSPOS   7                                        AR792734A
     C           KEYEQ     KLIST
     C                     KFLD           KBRC
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C*
     C           KEYPRO    KLIST
     C                     KFLD           A7CYCD
     C                     KFLD           KNOST
     C*                                                                   117436
     C           KGLAC     KLIST                                          117436
     C                     KFLD           KCUS                            117436
     C                     KFLD           KCCY                            117436
     C                     KFLD           KCOD                            117436
     C                     KFLD           KASE                            117436
     C                     KFLD           KBRC                            117436
     C*
      *** Check the switchable features file to see if        is on.
     C*
     C                     SETOF                     82
     C                     MOVE 'N'       S01472  1
     C                     CALL 'AOSARDR0'
     C                     PARM '       ' @RTCD   7
     C                     PARM '*VERIFY' @OPTN   7
     C                     PARM 'S01472 ' @SARD   6
     C                     PARM           @DSFDY                                              CSD006
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       S01472
     C                     SETON                     82
     C                     END
     C*
      *** Check the switchable features file to see if CGL017 is on.      CGL017
     C*                                                                   CGL017
     C                     MOVE 'N'       CGL017  1                       CGL017
     C                     CALL 'AOSARDR0'                                CGL017
     C                     PARM '       ' @RTCD   7                       CGL017
     C                     PARM '*VERIFY' @OPTN   7                       CGL017
     C                     PARM 'CGL017 ' @SARD   6                       CGL017
     C                     PARM           @DSFDY                          CGL017
      *                                                                   CGL017
     C           @RTCD     IFEQ *BLANKS                                   CGL017
     C                     MOVE 'Y'       CGL017                          CGL017
     C                     END                                            CGL017
     C*                                                                   CRE009
      *** Check the switchable features file to see if CRE009 is on.      CRE009
     C*                                                                   CRE009
     C                     MOVE 'N'       CRE009  1                       CRE009
     C                     CALL 'AOSARDR0'                                CRE009
     C                     PARM '       ' @RTCD   7                       CRE009
     C                     PARM '*VERIFY' @OPTN   7                       CRE009
     C                     PARM 'CRE009 ' @SARD   6                       CRE009
     C                     PARM           @DSFDY                          CRE009
      *                                                                   CRE009
     C           @RTCD     IFEQ *BLANKS                                   CRE009
     C                     MOVE 'Y'       CRE009                          CRE009
     C                     END                                            CRE009
      *                                                                                      BUG5334
      ** Check if CRE010 is switched on                                                      BUG5334
      *                                                                                      BUG5334
     C                     CALL 'AOSARDR0'                                                   BUG5334
     C                     PARM *BLANKS   PRTCD   7                                          BUG5334
     C                     PARM '*VERIFY' POPTN   7                                          BUG5334
     C                     PARM 'CRE010'  PSARD   6                                          BUG5334
     C           SCSARD    PARM SCSARD    @DSFDY                                             BUG5334
      *                                                                                      BUG5334
      ** Database error                                                                      BUG5334
      *                                                                                      BUG5334
     C           PRTCD     IFNE *BLANKS                                                      BUG5334
     C           PRTCD     ANDNE'*NRF   '                                                    BUG5334
     C                     MOVEL'SCSARDPD'DBFILE                                             BUG5334
     C                     Z-ADD7         DBASE                                              BUG5334
     C                     MOVEL'CRE010  'DBKEY                                              BUG5334
     C                     EXSR *PSSR                                                        BUG5334
     C                     ENDIF                                                             BUG5334
      *                                                                                      BUG5334
     C           PRTCD     IFEQ *BLANKS                                                      BUG5334
     C                     MOVE 'Y'       CRE010  1                                          BUG5334
     C                     ELSE                                                              BUG5334
     C                     MOVE 'N'       CRE010                                             BUG5334
     C                     ENDIF                                                             BUG5334
      *                                                                                      BUG5334
     C           *NAMVAR   DEFN           EMSDS                                              BUG5334
     C                     IN   EMSDS                                                        BUG5334
      *                                                                   CRE009
     C                     MOVE *BLANKS   SFLD31
     C                     MOVE *BLANKS   SFLD32
     C*
     C*
      ** Access SAR details file to determine if Account Access                               CGL037
      ** Security is switched on                                                              CGL037
      *                                                                                       CGL037
     C                     CALL 'AOSARDR0'                                                    CGL037
     C                     PARM *BLANKS   @RTCD   7                                           CGL037
     C                     PARM '*VERIFY' @OPTN   7                                           CGL037
     C                     PARM 'CGL037'  @SARD   6                                           CGL037
     C           SCSARD    PARM SCSARD    @DSFDY                                              CGL037
      *                                                                                       CGL037
     C           @RTCD     IFNE *BLANKS                                                       CGL037
     C           @RTCD     ANDNE'*NRF   '                                                     CGL037
     C                     EXSR *PSSR                                                         CGL037
     C                     MOVE '1'       *INLR                                               CGL037
     C                     RETRN                                                              CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C           @RTCD     IFEQ *BLANK                                                        CGL037
     C                     MOVEL'Y'       CGL037  1                                           CGL037
     C                     SETON                     30                                       CGL037
     C                     ELSE                                                               CGL037
     C                     MOVEL'N'       CGL037                                              CGL037
     C                     END                                                                CGL037
      *                                                                                     BUG26687
      ** Access SAR details file to see if CGL013 is installed.                             BUG26687
      *                                                                                     BUG26687
     C                     CALL 'AOSARDR0'                                                  BUG26687
     C                     PARM *BLANKS   @RTCD                                             BUG26687
     C                     PARM '*VERIFY' @OPTN                                             BUG26687
     C                     PARM 'CGL013'  @SARD                                             BUG26687
     C           SCSARD    PARM SCSARD    @DSFDY                                            BUG26687
      *                                                                                     BUG26687
     C           @RTCD     IFNE *BLANKS                                                     BUG26687
     C           @RTCD     ANDNE'*NRF    '                                                  BUG26687
     C                     MOVE 'SCSARDPD'DBFILE                                            BUG26687
     C                     MOVEL'008'     DBASE                                             BUG26687
     C                     MOVEL'CGL013'  DBKEY                                             BUG26687
     C                     EXSR *PSSR                                                       BUG26687
     C                     ENDIF                                                            BUG26687
      *                                                                                     BUG26687
     C           @RTCD     IFEQ *BLANK                                                      BUG26687
     C                     MOVE 'Y'       CGL013  1                                         BUG26687
     C                     ELSE                                                             BUG26687
     C                     MOVE 'N'       CGL013                                            BUG26687
     C                     ENDIF                                                            BUG26687
      *                                                                                     BUG26687
     C                     CALL 'AOSARDR0'                                                  BUG26687
     C                     PARM *BLANKS   @RTCD                                             BUG26687
     C                     PARM '*VERIFY' @OPTN                                             BUG26687
     C                     PARM 'CER030'  @SARD                                             BUG26687
     C           SCSARD    PARM SCSARD    @DSFDY                                            BUG26687
      *                                                                                     BUG26687
     C           @RTCD     IFNE *BLANKS                                                     BUG26687
     C           @RTCD     ANDNE'*NRF    '                                                  BUG26687
     C                     MOVE 'SCSARDPD'DBFILE                                            BUG26687
     C                     MOVEL'009'     DBASE                                             BUG26687
     C                     MOVEL'CER030'  DBKEY                                             BUG26687
     C                     EXSR *PSSR                                                       BUG26687
     C                     ENDIF                                                            BUG26687
      *                                                                                     BUG26687
     C           @RTCD     IFEQ *BLANK                                                      BUG26687
     C                     MOVE 'Y'       CER030  1                                         BUG26687
     C                     ELSE                                                             BUG26687
     C                     MOVE 'N'       CER030                                            BUG26687
     C                     ENDIF                                                            BUG26687
      *                                                                                     BUG26687
      *                                                                                       CGL037
      *** Check the switchable features file to see if CGL045 is on.                          CGL045
     C*                                                                                       CGL045
     C                     MOVE 'N'       CGL045  1                                           CGL045
     C                     CALL 'AOSARDR0'                                                    CGL045
     C                     PARM '       ' @RTCD   7                                           CGL045
     C                     PARM '*VERIFY' @OPTN   7                                           CGL045
     C                     PARM 'CGL045 ' @SARD   6                                           CGL045
     C                     PARM           @DSFDY                                              CGL045
      *                                                                                       CGL045
     C           @RTCD     IFEQ *BLANKS                                                       CGL045
     C                     MOVE 'Y'       CGL045                                              CGL045
     C                     END                                                                CGL045
      *                                                                                       CGL045
      *** Check the switchable features file to see if CAP204 is on.                          CAP204
      *                                                                                       CAP204
     C                     MOVE 'N'       CAP204  1                                           CAP204
     C                     CALL 'AOSARDR0'                                                    CAP204
     C                     PARM '       ' @RTCD                                               CAP204
     C                     PARM '*VERIFY' @OPTN                                               CAP204
     C                     PARM 'CAP204 ' @SARD                                               CAP204
     C                     PARM           @DSFDY                                              CAP204
      *                                                                                       CAP204
      ** Database error                                                                       CAP204
      *                                                                                       CAP204
     C           @RTCD     IFNE *BLANKS                                                       CAP204
     C           @RTCD     ANDNE'*NRF   '                                                     CAP204
     C                     MOVEL'SCSARDPD'DBFILE                                              CAP204
     C                     Z-ADD8         DBASE                                               CAP204
     C                     MOVEL'CAP204  'DBKEY                                               CAP204
     C                     EXSR *PSSR                                                         CAP204
     C                     ENDIF                                                              CAP204
      *                                                                                       CAP204
     C           @RTCD     IFEQ *BLANKS                                                       CAP204
     C                     MOVE 'Y'       CAP204                                              CAP204
     C                     END                                                                CAP204
      *                                                                                       CAP204
     C/COPY OFCPYSRCZ,CGL145_038                                                             CGL145B
     C/COPY WNCPYSRC,GL4443CCPG                                           S01408
     C*                                                                   S01408
     C           *NAMVAR   DEFN RUNDAT    RUNDT
     C                     IN   RUNDT
     C                     UNLCKRUNDT
     C                     Z-ADDRUND      RNDT    50
     C*
     C           *NAMVAR   DEFN           ZMUSER
     C                     IN   ZMUSER
     C                     UNLCKZMUSER
     C*
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD1         I       20
     C*
     C           MBIN      IFEQ 'Y'
     C                     CALL 'ZVBBU'
     C                     PARM           BRC
     C                     PARM *ZERO     ERRCOD  10
     C*
     C           ERRCOD    IFNE 0
     C                     SETON                     505264
     C                     MOVE '0'       *IN15                           165290
     C                     MOVE ' 010'    ERCD,I
     C                     ADD  1         I
     C                     END
     C                     END
     C*
     C           DATF      COMP 'M'                      98
     C           MBIN      COMP 'N'                      21
      *                                                                                      BUG5334
     C           CRE010    IFEQ 'Y'                                                          BUG5334
      *                                                                                      BUG5334
     C                     MOVE RQDTD     MODI    2                                          BUG5334
     C           MODI      IFEQ 'GL'                                                         BUG5334
     C                     MOVE *ON       *IN30                                              BUG5334
     C                     EXSR LDAUP                                                        BUG5334
     C                     ENDIF                                                             BUG5334
      *                                                                                      BUG5334
     C                     ELSE                                                              BUG5334
     C*
     C** CALL GROUP JOB CONTROLLING COMPONENT
     C*
     C**********           CALL 'GLC440A'                                                     236093
     C**********           PARM 'I'       @PARM   1                                           236093
      *                                                                                      BUG5334
     C                     ENDIF                                                             BUG5334
     C*
     C** If the futures and options flag is set to 'Y'
     C**     open files lf/ffacmv2, lf/ffacmv3 , lf/memosm1
     C**     and pronom1.
     C*
     C           *NAMVAR   DEFN           MMOD
     C                     IN   MMOD
     C*
     C           FFFL      IFEQ 'Y'
     C*
     C                     OPEN FFACMV2
     C/COPY WNCPYSRC,GL4443C004
     C                     OPEN FFACMV3
     C/COPY WNCPYSRC,GL4443C005
     C**********           OPEN MEMOSM1                                   098612
     C**********           OPEN PRONOM1                                   098612
     C*
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP20                                           S01408
     C*                                                                   S01408
     C*
     C*
     C                     SETON                     03
     C                     MOVEL'GL4443'  HBPGM   8
      *                                                                                     BUG12807
      ** Initiliase title indicator                                                         BUG12807
      *                                                                                     BUG12807
     C                     MOVE *OFF      *IN35                                             BUG12807
     C           *INU5     IFEQ *ON                                                         BUG12807
     C                     MOVE *ON       *IN35                                             BUG12807
     C                     ENDIF                                                            BUG12807
     C**
     C*
     C**  OBTAIN ACCOUNT DETAILS FROM GROUP DATA AREA
     C**  FIRST TIME THROUGH, OBTAIN ACCOUNT DETAILS FROM GDA
     C                     EXSR LDA
     C                     WRITEHEADING
     C* Note: Hook GL4443CCP3 appears elsewhere in this program!          S01408
     C/COPY WNCPYSRC,GL4443CCP3                                           S01408
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443C024                                           S01408
     C*                                                                   S01408
     C*
      /TITLE         >>> LOOP TO PROCESS INPUT <<<
     C*
     C* DO WHILE NOT F3 --- ie. NOT EXIT
     C*
     C           *INKC     DOWEQ'0'
     C           EXTFLG    ANDEQ'N'                                                           236093
      *                                                                                      BUG5334
     C           CRE010    IFEQ 'Y'                                                          BUG5334
     C           *IN30     ANDEQ*ON                                                          BUG5334
     C           *INKC     ANDEQ*ON                                                          BUG5334
     C                     MOVE 'Q'       RETNWF  1                                          BUG5334
     C                     EXSR RETSR                                                        BUG5334
     C                     ENDIF                                                             BUG5334
     C*
     C                     WRITEHEADING
     C*                                                                   S01408
     C* Note: Hook GL4443CCP3 appears elsewhere in this program!          S01408
     C/COPY WNCPYSRC,GL4443CCP3                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443C025                                           S01408
     C*                                                                   S01408
      **Note*-*if*both*ERCD messages and MSGSFL messages the ERCD**                           116710
      **messages*take*priority.**                                                             116710
     C************IN50     IFEQ '1'                                                           116710
     C***********          WRITEERRRCD                                                        116710
     C***********          ELSE                                                               116710
     C***********          WRITE#MSGCTL                                                       116710
     C***********          END                                                                116710
     C           CGL013    IFEQ 'Y'                                                         BUG26687
     C           CER030    OREQ 'Y'                                                         BUG26687
     C                     MOVEL'USR9927' PMSGID                                            BUG26687
     C                     EXSR RTVMSG                                                      BUG26687
     C                     MOVELPMSGDS    OFKEY                                             BUG26687
     C                     ENDIF                                                            BUG26687
     C                     EXFMTSFLCTLR
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CCP4                                           S01408
     C*                                                                   S01408
      ** Clear messages for redisplay
     C                     CALL 'ZA0250'
     C*
     C* SETOF INDICATOR FOR ACTION PERFORMED
     C*
     C                     SETOF                     11
     C/COPY WNCPYSRC,GLH00340
     C*
     C**  R O L L U P   P R O C E S S I N G
     C*
     C           *IN25     IFEQ '1'
     C                     SETON                     11
     C                     EXSR FLDCHG
     C*
     C           *IN12     IFEQ '1'
     C                     EXSR RSTOR
     C                     END
     C*
     C           CQKEY     IFEQ *ZEROS
     C                     EXSR BSFIL1
     C                     ELSE
     C                     EXSR BSFIL2
     C                     END
      *
      **  IF NO RECORDS SELECTED FOR DISPLAY ON NEW PAGE
      **  SET DSPREC TO RRN - 1
     C           *IN81     IFEQ '1'
     C           COUNT     ANDEQ0
     C           RRN       SUB  1         DSPREC
     C                     END
     C*
     C                     END
      *                                                                                       236093
      ** If F03 - Exit                                                                        236093
      *                                                                                       236093
     C           *INKC     IFEQ '1'                                                           236093
     C                     MOVEL'F03'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     ENDIF                                                              236093
      *                                                                                       236093
      ** If F13 - Account & Statement Details                                                 236093
      *                                                                                       236093
     C           *INKM     IFEQ '1'                                                           236093
     C                     MOVEL'F13'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     MOVE 'Y'       EXTFLG                                              236093
     C                     ENDIF                                                              236093
      *                                                                                       236093
      ** If F14 - Account Movements                                                           236093
      *                                                                                       236093
     C           *INKN     IFEQ '1'                                                           236093
     C                     MOVEL'F14'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     MOVE 'Y'       EXTFLG                                              236093
     C                     ENDIF                                                              236093
      *                                                                                       236093
      ** If F16 - Items in Clearing                                                           236093
      *                                                                                       236093
     C           *INKQ     IFEQ '1'                                                           236093
     C                     MOVEL'F16'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     MOVE 'Y'       EXTFLG                                              236093
     C                     ENDIF                                                              236093
     C/COPY OFCPYSRCZ,CGL145_039                                                             CGL145B
     C*
     C*
     C* TRANSFER CONTROL TO OTHER ENQUIRIES VIA GROUP JOB...
     C*
     C********** *INKM     IFEQ '1'                                                           236093
     C**********           OUT  DSLDA                                                         236093
     C**********           CALL 'GL4440'                                                      236093
     C**********           PARM 'GL4441'  PARAM  10                                           236093
     C**********           SETON                     11                                       236093
     C**********           EXSR LDA                                                           236093
     C* On return check if details have changed to blank
     C**********           EXSR FLDCHG                                                        236093
     C********** LDADTA    IFEQ *BLANKS                                                       236093
     C********** *IN12     ANDEQ'1'                                                           236093
     C**********           EXSR ENTR                                                          236093
     C**********           END                                                                236093
     C**********           END                                                                236093
     C*
     C********** *INKN     IFEQ '1'                                                           236093
     C**********           OUT  DSLDA                                                         236093
     C**********           CALL 'GL4440'                                                      236093
     C**********           PARM 'GL4442'  PARAM                                               236093
     C**********           SETON                     11                                       236093
     C**********           EXSR LDA                                                           236093
     C* On return check if details have changed to blank
     C**********           EXSR FLDCHG                                                        236093
     C********** LDADTA    IFEQ *BLANKS                                                       236093
     C********** *IN12     ANDEQ'1'                                                           236093
     C**********           EXSR ENTR                                                          236093
     C**********           END                                                                236093
     C**********           END                                                                236093
     C*
     C********** *INKQ     IFEQ '1'                                                           236093
     C**********           OUT  DSLDA                                                         236093
     C**********           CALL 'GL4440'                                                      236093
     C**********           PARM 'GL4444'  PARAM                                               236093
     C**********           SETON                     11                                       236093
     C**********           EXSR LDA                                                           236093
     C* On return check if details have changed to blank
     C**********           EXSR FLDCHG                                                        236093
     C********** LDADTA    IFEQ *BLANKS                                                       236093
     C********** *IN12     ANDEQ'1'                                                           236093
     C**********           EXSR ENTR                                                          236093
     C**********           END                                                                236093
     C**********           END                                                                236093
     C*
     C/COPY WNCPYSRC,GL4443CCP7                                           S01408
      *                                                                                     BUG26687
     C                     MOVE *BLANKS   ERRDS1 76                                         BUG26687
     C                     SETOF                     46                                     BUG26687
     C           *IN11     IFEQ '0'                                                         BUG26687
     C           RRN       ANDGT0                                                           BUG26687
     C           *IN02     ANDEQ*ON                                                         BUG26687
     C                     Z-ADDRRN       UFWRRN  50                                        BUG26687
     C                     READCSFLRCD                   84                                 BUG26687
     C           *IN84     IFEQ '0'                                                         BUG26687
     C           SELEC     IFEQ '1'                                                         BUG26687
     C           SELEC     OREQ '2'                                                         BUG26687
      *                                                                                     BUG26687
     C           UFTRYP    IFEQ 'ME'                                                        BUG26687
     C                     MOVE UFPTDT    PDATE                                             BUG26687
     C                     MOVE UFBTNB    PABTNB  3                                         BUG26687
     C                     MOVE UFBINB    PABINB  30                                        BUG26687
     C                     CALL 'GL0123E'                                                   BUG26687
     C                     PARM *BLANKS   @RTCD                                             BUG26687
     C                     PARM           PABTNB                                            BUG26687
     C                     PARM           PABINB                                            BUG26687
     C**********           PARM           PDATE  10                                BUG26687 AR877000
     C                     PARM           PDATE   50                                        AR877000
     C                     PARM           SELEC                                             BUG26687
     C           @RTCD     IFNE *BLANKS                                                     BUG26687
     C                     SETON                     46                                     BUG26687
     C                     MOVELEMSG,2    ERRDSP                                            BUG26687
     C                     ENDIF                                                            BUG26687
     C                     ELSE                                                             BUG26782
     C                     SETON                     46                                     BUG26782
     C                     MOVELEMSG,4    ERRDSP                                            BUG26782
     C                     ENDIF                                                            BUG26687
     C                     ELSE                                                             BUG26687
      ** ERROR MESSAGE FOR INVALID OPTION                                                   BUG26687
     C                     SETON                     46                                     BUG26687
     C                     MOVELEMSG,3    ERRDSP                                            BUG26687
     C                     ENDIF                                                            BUG26687
     C                     MOVE *BLANK    SELEC                                             BUG26687
     C                     UPDATSFLRCD                                                      BUG26687
     C                     SETON                     11                                     BUG26687
     C                     Z-ADDUFWRRN    RRN                                               BUG26687
     C                     ENDIF                                                            BUG26687
     C                     ENDIF                                                            BUG26687
      *                                                                                     BUG26687
     C*
     C**  DISPLAY DETAILS
     C*
     C           *IN11     IFEQ '0'
     C           EXTFLG    ANDEQ'N'                                                           236093
     C*
     C*  IF F5 PRESSED, REFRESH OLD USER I/P FIELDS
     C           *INKE     IFEQ '1'
     C                     EXSR RSTOR
     C                     END
     C*
     C                     EXSR ENTR
     C                     END
     C*
     C                     END
     C*
     C* ...ELSE END PROGRAM (ie. Cmd/3)
     C*
     C           CRE010    IFEQ 'Y'                                                          BUG5334
     C           *IN30     ANDEQ*ON                                                          BUG5334
     C                     MOVE 'Q'       RETNWF                                             BUG5334
     C                     EXSR RETSR                                                        BUG5334
     C                     ENDIF                                                             BUG5334
      *                                                                                      BUG5334
     C                     SETON                     LR
     C*
     C*
      /TITLE         <<< LDA SR. >>>
     C*****************************************************************
     C*
     C* LDA --- SUBROUTINE TO CHECK FOR LDA=BLANK
     C*
     C* CALLED FROM: MAIN PROCESSING, INIT
     C*
     C* CALLS: ENTR
     C*
     C*****************************************************************
     C*
     C           LDA       BEGSR                           ** LDA **
     C*
     C                     IN   DSLDA
     C/COPY WNCPYSRC,GL4443C041
     C           LDADTA    IFEQ *BLANKS
     C           FUNC      OREQ 'F03'                                                       BUG12825
     C                     MOVE *BLANKS   LDADTA                                            BUG12825
     C*
     C                     SETOF                     20
     C                     WRITESTATIC1
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CCP5                                           S01408
     C*                                                                   S01408
     C                     WRITESTATIC2
     C*
     C/COPY WNCPYSRC,GL4443CCP6                                           S01408
     C*                                                                   S01408
     C                     ELSE
     C*
     C                     EXSR ENTR
     C*
     C                     END
     C*
     C                     ENDSR                           ** LDA **
     C*
      *****************************************************************                      BUG5334
      /TITLE                                                                                 BUG5334
      *****************************************************************                      BUG5334
      *                                                               *                      BUG5334
      *  LDAUP - Subroutine to Update LDA if Called via Exposure      *                      BUG5334
      *          Management Enquiry                                   *                      BUG5334
      *                                                               *                      BUG5334
      *****************************************************************                      BUG5334
      *                                                                                      BUG5334
     C           LDAUP     BEGSR                                                             BUG5334
      *                                                                                      BUG5334
     C                     IN   EMSDS                                                        BUG5334
     C                     IN   DSLDA                                                        BUG5334
     C                     MOVE *BLANK    CNUMR                                              BUG5334
     C                     MOVELCNUMP     CNUMR                                              BUG5334
     C                     MOVE CURRP     CURRY                                              BUG5334
     C                     MOVE ACODP     ACCOD                                              BUG5334
     C                     MOVE ACSQP     ACSEQ                                              BUG5334
     C                     MOVE BRCHP     BRNCH                                              BUG5334
     C                     OUT  DSLDA                                                        BUG5334
      *                                                                                      BUG5334
     C                     ENDSR                                                             BUG5334
      *                                                                                      BUG5334
      *****************************************************************                      BUG5334
      /TITLE                                                                                 BUG5334
      *****************************************************************                      BUG5334
      *                                                               *                      BUG5334
      *  CMD - Subroutine to Validate Command Keys                    *                      BUG5334
      *                                                               *                      BUG5334
      *****************************************************************                      BUG5334
      *                                                                                      BUG5334
     C           RETSR     BEGSR                                                             BUG5334
      *                                                                                      BUG5334
     C                     MOVE *ON       *INLR                                              BUG5334
      *                                                                                      BUG5334
      ** Access EM Data Area                                                                 BUG5334
      *                                                                                      BUG5334
     C           *LOCK     IN   EMSDS                                                        BUG5334
     C                     MOVE RETNWF    RETND                                              BUG5334
     C                     OUT  EMSDS                                                        BUG5334
     C                     RETRN                                                             BUG5334
      *                                                                                      BUG5334
     C                     ENDSR                                                             BUG5334
      *                                                                                      BUG5334
      *****************************************************************                      BUG5334
      /TITLE         <<< SRPRT SR. >>>
     C*****************************************************************
     C*                                                               *
     C* SRPRT - Print Movements selected                              *
     C*                                                               *
     C*  If print selected call FC0040X to submit job GLC4430 to      *
     C*  print movements selected.                                    *
     C*                                                               *
     C* Called by: ENTR                                               *
     C*                                                               *
     C*****************************************************************
     CSR         SRPRT     BEGSR
      *
      *  Clear data structure and set report printed
      *
     C                     CLEARC#DTA
     C                     MOVEL'Y'       ##PRT   1
     C                     MOVEL*BLANKS   W0ACT
      *                                                                                       CGL029
      ** Setup field KEYAC                                                                    CGL029
      *                                                                                       CGL029
     C***********KCUSA     CAT  KCODA:0   WKEY   16                                    CGL029 235377
     C***********WKEY      CAT  KASEA:0   KEYAC  21                                    CGL029 235377
     C           KCUSA     CAT  KCYC:0    WKEY1   9                                           235377
     C           KCODA     CAT  KASEA:0   WKEY2  12                                           235377
     C           WKEY1     CAT  WKEY2:0   KEYAC  21                                           235377
      *
      *  Set up data to pass
      *
     C           *IN14     IFEQ '1'
     C                     MOVEL'*RETAIL 'W0ACT
     C                     MOVEL'G'       C#ATYP
     C                     MOVELKEYAC     C#ACCT
     C                     ELSE
     C           ATYP      IFEQ 'R'
     C                     MOVEL'*BOTH   'W0ACT
     C                     ELSE
     C                     MOVEL'*NOSTRO 'W0ACT   8
     C                     END
     C                     MOVEL'G'       C#ATYP
     C                     MOVELKEYAC     C#ACCT
     C                     END
     C                     MOVELKBRC      C#BRCA
     C                     MOVEL'Y'       C#SPLR
     C                     MOVEL'GL4430P1'C#SPLN
     C                     MOVEL*BLANKS   C#REFN
     C                     MOVEL'GL4430 ' C#REFN
     C                     MOVEL*BLANKS   O#PARM
     C           W0ACT     CAT  C#DTA     O#PARM
      *
      *  Call FC0040X to report movements
      *
     C                     CALL 'FC0040X'              90  Call FC0040X RC
     C           R#RTN     PARM *BLANKS   O#RTN   7
     C                     PARM 'GL4430'  O#PRG  10        Calling Program
     C                     PARM 'GLC4430' O#CPRG 10        CL Controlling
     C                     PARM '10001'   O#CSEQ  5        CL Sequence Num
     C                     PARM           O#PARM100        Calling Paramet
     C                     PARM MBIN      O#MBIN  1        Multi-Branching
     C                     PARM 'B'       O#LVL   1        Level
     C                     PARM 'ALL'     O#ENTY  3        Entity
      *
     C           *IN90     IFEQ '1'
     C           R#RTN     ORNE *BLANKS
     C                     Z-ADD5         DBASE                  ***************
     C                     MOVE '*CALL'   DBFILE                 * DB ERROR 05 *
     C                     MOVEL'FC0040X 'DBKEY                  ***************
     C                     EXSR *PSSR
     C                     MOVEL*BLANKS   R#RTN   7
     C                     END
      *
     CSR         EXPRT     ENDSR
      *
      /TITLE         <<< ENTR SR. >>>
     C*****************************************************************
     C*
     C* ENTR --- SUBROUTINE CALLED ON ENTER BEING PRESSED
     C*
     C* 1. VALIDATES INPUT CRITERIA
     C* 2. FOR VALID INPUT, IF A/C CHANGED, GETS A/C AND CLIENT DETAILS
     C* 3. BUILDS AND DISPLAYS SUBFILE OF VALID RECORDS
     C*
     C* CALLED FROM: MAIN PROCESSING, LDA
     C*
     C* CALLS: FLDCHG, VALID, STORE, BSFIL1, BSFIL2 (S/R)
     C*
     C*****************************************************************
     C*
     C           ENTR      BEGSR                           ** ENTR **
     C*
     C* ONLY VALIDATE AND RE-OUTPUT IF SCREEN FIELDS HAVE CHANGED
     C* OR REFRESH REQUESTED
     C                     EXSR FLDCHG
     C           *IN12     IFEQ '1'
     C           *INKE     OREQ '1'
     C*
     C*
     C* CLEAR ALL OLD RECORDS FROM THE SUBFILE
     C*
     C                     SETOF                     0203
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP12                                           S01408
     C*                                                                   S01408
     C                     WRITESFLCTLR
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP13                                           S01408
     C*                                                                   S01408
     C                     SETON                       03
     C*
     C**CLEAR*ALL*OLD MESSAGES FROM THE SUBFILE                                               116710
     C*
     C**********           SETON                     71                                       116710
     C**********           WRITE#MSGCTL                                                       116710
     C**********           SETOF                     71                                       116710
     C*
     C**  C H E C K   I N P U T
     C*
     C* CLEAR ERROR CODE ARRAY AND SETOF INVALID INDICATOR
     C*
     C                     MOVE *BLANKS   P@ALL
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD1         I       20
     C*
     C                     SETOF                     5051
     C                     SETOF                     646566
     C                     SETOF                     6768
     C*
     C* IF A/C FIELD HAS CHANGED...
     C*
     C           *IN60     IFEQ '1'
     C*
     C/COPY WNCPYSRC,GL4443CVKS                                           S01408
     C*                                                                   S01408
     C* ...VALIDATE A/C --- BLANK=>INVALID / P@RTCD<>BLANK=>NOT ON FILE
     C*
     C           CNUMR     IFEQ *BLANKS
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CVK1                                           S01408
     C*                                                                   S01408
     C                     SETON                     505164
     C                     MOVE '0'       *IN15                           165290
     C                     MOVE ' 001'    ERCD,I
     C                     ADD  1         I
     C                     ELSE
     C*
     C* OBTAIN DEFAULT BRANCH FROM ZMUSER
     C*
     C           BRNCH     IFEQ *BLANKS
     C           CNUMR     IFNE *BLANKS
     C           CURRY     ANDNE*BLANKS
     C           ACCOD     ANDNE*BLANKS
     C           ACSEQ     ANDNE*BLANKS
     C                     MOVELBRC       BRNCH
     C                     END
     C                     END
     C*
     C* AOACCTV0 IS AN EXTERNAL PROGRAM WHICH ACCESSES A/C DETAILS
     C*
     C                     CALL 'AOACCTV0'
     C                     PARM '       ' P@RTCD  7
     C                     PARM CNUMR     P@KEY1 10
     C                     PARM CURRY     P@KEY2
     C                     PARM ACCOD     P@KEY3
     C                     PARM ACSEQ     P@KEY4
     C                     PARM BRNCH     P@KEY5  3
     C                     PARM           P@TYPE  7
     C                     PARM           P@NOSN  2
     C           P@FMT1    PARM P@FMT1    DSSDY
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP21                                           S01408
     C*                                                                   S01408
     C           P@RTCD    IFNE *BLANKS
     C           P@RTCD    ANDNE'*ACST  '                                                     202528
     C                     SETON                     505164
     C                     MOVE '0'       *IN15                           165290
     C                     MOVE ' 002'    ERCD,I
     C                     ADD  1         I
     C                     ELSE
      *                                                                                       CGL037
     C           CGL037    IFEQ 'Y'                                                           CGL037
      *                                                                                       CGL037
      ** If indicator U5 is OFF, Account Code must have Account                               CGL037
      ** Type  'R' and A/C Subtype not equal to ('V' or 'I')                                  CGL037
      *                                                                                       CGL037
     C                     SETOF                     14                                       CGL037
     C           *INU5     IFEQ '0'                        ** B004                            CGL037
     C           ATYP      IFEQ 'R'                        ** B005                            CGL037
     C           P@NOSN    ANDEQ*BLANKS                                                       CGL037
     C                     SETON                     14                                       CGL037
     C           STYP      IFEQ 'V'                        ** B006                            CGL037
     C           STYP      OREQ 'I'                                                           CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE ' 013'    ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E006                            CGL037
     C                     ELSE                            ** X005                            CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE ' 013'    ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E005                            CGL037
     C                     ELSE                            ** X004                            CGL037
      *                                                                                       CGL037
      ** If indicator U5 is ON, then Account Type should not be                               CGL037
      ** 'R'. If it is 'R', Account Subtype must be 'V' or 'I'.                               CGL037
      *                                                                                       CGL037
     C           ATYP      IFEQ 'R'                        ** B005                            CGL037
     C           P@NOSN    ANDEQ*BLANKS                                                       CGL037
     C                     SETON                     14                                       CGL037
     C           STYP      IFNE 'V'                        ** B006                            CGL037
     C           STYP      ANDNE'I'                                                           CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE ' 014'    ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E006                            CGL037
     C                     END                             ** E005                            CGL037
     C                     END                             ** E004                            CGL037
      *                                                                                       CGL037
     C                     ELSE                                                               CGL037
      *                                                                                       CGL037
     C           ATYP      IFEQ 'N'                                                           CGL037
     C           P@NOSN    ORNE *BLANK                                                        CGL037
     C           ATYP      ANDEQ'R'                                                           CGL037
     C           P@NOSN    ORNE *BLANK                                                        260753
     C           ATYP      ANDEQ'G'                                                           260753
     C                     SETOF                     14                                       CGL037
     C                     ELSE                                                               CGL037
     C           ATYP      IFEQ 'R'                                                           CGL037
     C                     SETON                     14                                       CGL037
     C                     ELSE                                                               CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE '002'     ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                                                                CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C/COPY WNCPYSRC,GL4443C055
     C*
     C**  CHECK TO SEE IF USER IS AUTHORISED TO BRANCH ASSOCIATED WITH
     C**  REQUESTED ACCOUNT
     C*
     C           MBIN      IFEQ 'Y'
     C                     CALL 'ZVBBU'
     C                     PARM           KBRC
     C                     PARM *ZERO     ERRCOD
     C*
     C           ERRCOD    IFNE 0
     C                     SETON                     505164
     C                     MOVE '0'       *IN15                           165290
     C           ATYP      IFEQ 'R'
     C                     MOVE ' 011'    ERCD,I
     C                     ELSE
     C                     MOVE ' 010'    ERCD,I
     C                     END
     C                     ADD  1         I
     C                     END
     C                     END
     C*
     C* CHECK TYPE OF INPUT FROM RETURNED VALUE, IF NOSTRO CODE OR
     C* SHORTNAME OR RETAIL NO., BLANK OUT OTHER INPUT FIELDS
     C*
     C                     MOVE *BLANKS   WCURRY  3                                          BUG1832
     C           P@TYPE    IFEQ '*NOSHNM'
     C           P@TYPE    OREQ '*NOSTRO'
     C           P@TYPE    OREQ '*RETAIL'
     C                     MOVE *BLANKS   CURRY
     C                     MOVE *BLANKS   ACCOD
     C                     MOVE *BLANKS   ACSEQ
     C                     MOVE *BLANKS   BRNCH
     C                     MOVE KCCY      WCURRY                                             BUG1832
     C                     END
     C/COPY WNCPYSRC,GL4443C046
     C*
     C           P@NOSN    IFNE *BLANK
     C                     SETOF                     14
     C/COPY WNCPYSRC,GL4443C047
     C                     ELSE
     C           ATYP      IFEQ 'R'
     C                     SETON                     14
     C                     MOVE '0'       *IN15                           165290
     C                     ELSE
     C                     SETON                     505164
     C                     MOVE '002'     ERCD,I
     C                     ADD  1         I
     C                     END
     C                     END
      *                                                                             CGL017
      * Additionally, if CGL017 and CRE009 are on then if a Nostro                  CGL017
      * has been entered as a retail number or as a G/L a/c                         CGL017
      * and is a retail a/c, then switch *IN14 on and *IN15 off.                    CGL017
      * This is done by checking position 6 on the Customer field,                  CGL017
      * if blank then nostro entered in CCYnn fomat, otherwise check                CGL017
      * if retail a/c.                                                              CGL017
     C                     MOVELCNUMR     WCNUMR                                    CGL017
     C           CGL017    IFEQ 'Y'                                                 CGL017
     C           CRE009    ANDEQ'Y'                                                 CGL017
     C           CNUMR6    ANDNE*BLANK                                              CGL017
     C           ATYP      ANDEQ'R'                                                 CGL017
     C                     SETON                     14                             CGL017
     C                     SETOF                     15                             CGL017
     C                     ENDIF                                                    CGL017
     C*
     C                     END
     C                     END
     C                     END
     C*
      * If no errors and feature not off, check user authority            CRE024
      * to account code                                                   CRE024
     C           CRE024    IFNE 'N'                                       CRE024
     C           *IN51     ANDEQ'0'                                       CRE024
     C                     CALL 'SF0930'                                  CRE024
     C                     PARM           CRE024  1                       CRE024
     C                     PARM *BLANKS   UMAUTH  1                       CRE024
     C                     PARM KCOD      UMACOD 100                      CRE024
     C**********           PARM KCUS      UMCNUM  60                                 CRE024 BUG11679
     C                     PARM KCUS      UMCNUM  6                                         BUG11679
     C                     PARM KCCY      UMCCY   3                       CRE024
     C                     PARM KASE      UMACSQ  20                      CRE024
     C                     PARM KBRC      UMBRCA  3                       CRE024
     C                     PARM 'GL4443'  UMPGM  10                       CRE024
     C                     PARM '*REPT'   UMOPTN  5                       CRE024
     C                     PARM *BLANKS   UMEMSG 50                       CRE024
      *                                                                   CRE024
      * If user not authorised, set on error indicators                   CRE024
     C           UMAUTH    IFEQ 'N'                                       CRE024
     C                     MOVEA'11'      *IN,50                          CRE024
     C                     MOVE '1'       *IN64                           CRE024
     C                     MOVE '0'       *IN15                           CRE024
     C                     MOVELUMEMSG    ERRDSP                          CRE024
     C                     ADD  1         I                               CRE024
     C                     END                                            CRE024
     C                     END                                            CRE024
      *                                                                   CRE024
     C* OBTAIN CURRENT PROJECTED BALANCE IF ACCOUNT ENTERED IS VALID
     C*
     C           *IN51     IFEQ '0'
     C                     EXSR PRJBAL
     C                     END
      *                                                                                       CRE009
      ** If CRE009 and account is Retail, date will be compared with the date in              CRE009
      ** REPMFWPD for the account currenty instead of the rundate.                            CRE009
      *                                                                                       CRE009
     C           CRE009    IFEQ 'Y'                                                           CRE009
     C           CURRY     ANDNE*BLANKS                                                       CRE009
     C           *IN51     ANDEQ'0'                                                           217524
     C           CRE009    OREQ 'Y'                                                          BUG1832
     C           WCURRY    ANDNE*BLANKS                                                      BUG1832
     C           *IN51     ANDEQ'0'                                                          BUG1832
      *                                                                                      BUG1832
     C           CURRY     IFNE *BLANKS                                                      BUG1832
     C                     MOVE CURRY     KCURRY  3                                          BUG1832
     C                     ELSE                                                              BUG1832
     C                     MOVE WCURRY    KCURRY                                             BUG1832
     C                     ENDIF                                                             BUG1832
      *                                                                                       CRE009
     C********** CURRY     CHAINREPMFWL1             87                               CRE009 BUG1832
     C           KCURRY    CHAINREPMFWL1             87                                      BUG1832
     C           *IN87     IFEQ *OFF                                                          CRE009
     C                     Z-ADDREPMED    NXTD    50                                          CRE009
     C                     ELSE                                                               CRE009
     C                     Z-ADD6         DBASE                  ***************              CRE009
     C                     MOVE 'REPMFWL1'DBFILE                 * DB ERROR 06 *              CRE009
     C**********           MOVELCURRY     DBKEY                  ***************      CRE009 BUG1832
     C                     MOVELKCURRY    DBKEY                                              BUG1832
     C                     EXSR *PSSR                                                         CRE009
     C                     ENDIF                                                              CRE009
     C                     ENDIF                                                              CRE009
     C*
     C*
     C* IF VALUE-DATE FIELD HAS CHANGED...
     C*
     C           *IN61     IFEQ '1'
     C*
     C* ...VALIDATE PDAT --- BLANK=>VALID / NON-BLANK: FORMAT?, <RUND?
     C*
     C           VALDA     IFNE *BLANKS
     C*
     C* VALIDATE FORMAT USING MIDAS STANDARD SUBROUTINE
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE VALDA     ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD6         ZADIG
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    ZDATE
     C           *IN99     IFEQ '1'
     C                     MOVE ' 003'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5065
     C                     ELSE
     C*
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    VALDN   50
     C           *IN99     IFEQ '1'
     C                     MOVE ' 003'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5065
     C*
     C                     ELSE
     C*
     C* FOR RETAIL ACCOUNT
     C**   DATE IS INVALID IF GT THE RUN DATE FOR RETAIL A/C
     C**   DATE IS INVALID IF GT THE 4TH NEXT WORKING DAY FOR NOSTRO A/C
     C*
     C           *IN14     IFEQ '1'
      *                                                                                     CRE009
     C           CRE009    IFEQ 'Y'                                                         CRE009
     C           VALDN     ANDGTREPMED                                                      CRE009
     C           CRE009    ORNE 'Y'                                                         CRE009
     C           VALDN     ANDGTRNDT                                                        CRE009
     C********   VALDN     IFGT RNDT                                                        CRE009
     C                     MOVE ' 003'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5065
     C                     END
     C*
     C                     ELSE
     C*
     C           VALDN     IFGT PDAT,5
     C                     MOVE ' 003'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5065
     C                     END
     C*
     C                     END
     C*
     C                     END
     C                     END
     C*
     C                     ELSE
     C*
     C* IF VALUE DATE IS BLANKS THEN RESET TO ZERO
     C*
     C                     Z-ADD0         VALDN
     C*
     C                     END
     C*
     C                     END
     C*
     C* IF + OR - (PORM) FIELD HAS CHANGED
     C*
     C           *IN62     IFEQ '1'
     C*
     C           PORM      IFNE '+'
     C           PORM      ANDNE'-'
     C           PORM      ANDNE' '
     C                     MOVE ' 004'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5066
     C                     END
     C*
     C                     END
     C*
     C* IF AMOUNT FIELD HAS CHANGED
     C*
     C           *IN63     IFEQ '1'
     C           *IN60     OREQ '1'
     C*
     C* ACCESS CCY FILE FOR NO. OF DPS OF CURRENCY
     C*
     C                     CALL 'AOCURRR0'
     C                     PARM '       ' P@RTCD  7
     C                     PARM '*KEY'    P@OPTN  7
     C                     PARM KCCY      P@KEY2
     C***********          PARM           P@FMT2                                              CSD006
     C           P@FMT2    PARM P@FMT2    DSSDY                                               CSD006
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE AMONT     ZFIELD
     C/COPY WNCPYSRC,GL4443C043
     C                     Z-ADDA6NBDP    ZADEC
     C           13        SUB  A6NBDP    ZADIG
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     MOVE ' 006'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5067
     C                     ELSE
     C                     MOVE ZFIELD    AMTNUM 130
     C                     END
     C*
     C                     END
     C*
     C* IF + OR - ENTERD, BUT AMOUNT IS BLANK...INVALID
     C*
     C           PORM      IFEQ '+'
     C           PORM      OREQ '-'
     C*
     C           AMTNUM    IFEQ *ZEROS
     C                     MOVE ' 005'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     506667
     C                     END
     C*
     C                     END
     C*
     C* IF CHEQUE NUMBER <> BLANK
     C*
     C           CQNMR     IFEQ *BLANKS
     C                     Z-ADD0         CQKEY
     C                     ELSE
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CQNMR     ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD8         ZADIG
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    CQKEY   80
     C           *IN99     IFEQ '1'
     C                     MOVE ' 007'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5068
     C                     END
     C           ATYP      IFNE 'R'
     C                     MOVE ' 008'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5068
     C                     END
     C           AMTNUM    IFNE *ZEROS
     C                     MOVE ' 009'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5068
     C                     END
     C*
     C                     END
     C*
     C*
     C* IF A/C HAS CHANGED ...
     C*  or user requests refresh to obtain up-to-date details...         100293
     C*
     C           *IN60     IFEQ '1'
     C           *INKE     OREQ '1'                                       100293
     C*
     C* IF A/C VALID GET CLOSING BALANCE, ELSE SET ON *IN20 TO NOT
     C* DISPLAY ACCOUNT DETAILS
     C*
     C           *IN51     IFEQ '0'
     C                     EXSR ACDETS
     C                     SETON                     20
     C                     ELSE
     C                     SETOF                     20
     C                     END
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP19                                           S01408
     C*                                                                   S01408
     C*
     C                     WRITESTATIC1
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CCP8                                           S01408
     C*                                                                   S01408
     C                     WRITESTATIC2
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CCP9                                           S01408
     C*                                                                   S01408
     C   14                WRITECLEARBL
     C  N14                WRITENOSTBL
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP24                                           S01408
     C*                                                                   S01408
     C*
     C                     END
     C*
     C* WRITE SUBFILE OF MOVEMENTS FOR THIS ACCOUNT
     C*
     C/COPY WNCPYSRC,GL4443CP14                                           S01408
     C*                                                                   S01408
     C                     WRITESFLCTLR
     C*
     C/COPY WNCPYSRC,GL4443CP15                                           S01408
     C*                                                                   S01408
     C* IF NEW USER I/P IS VALID, STORE.
     C*
     C           *IN50     IFEQ '0'
     C*
     C                     EXSR STORE
     C                     EXSR SCRN1
     C*
     C                     END
     C*
     C*  WRITE SUBFILE HEADING
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP10                                           S01408
     C*                                                                   S01408
     C                     WRITESTATIC2
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP11                                           S01408
     C*
     C*  IF INPUT HAS NOT CHANGED ENSURE THAT THE SUBFILE IS
     C*     REDISPLAYED AT THE SAME POSTION
     C*
     C                     ELSE
     C*
     C                     Z-ADDCPFPOS    DSPREC
     C*
     C                     END
      *
      * If F6 then process as print and screen is valid
      *
     C           *IN06     IFEQ '1'
     C           *IN51     ANDEQ'0'
     C                     EXSR SRPRT
     C                     END
      *
     C/COPY WNCPYSRC,GLH00595
     C*
     C                     ENDSR                           ** ENTR **
     C*
     C*
      /TITLE         <<< SCRN1 SR. >>>
     C*****************************************************************
     C*
     C* SCRN1 -- REBUILD SUBFILE FROM THE FIRST RECORD
     C*
     C* 1. RESET RELATIVE RECORD NUMBERS
     C* 2. CLEAR THE SUBFILE
     C**3.*DETERMINE*IF*RSACMTL1*OR*RSACMTL2*IS*TO*BE*USED
     C* 3. DETERMINE IF RSACMTL1/FFACMV3  OR RSACMTL2 /FFACMV2 IS TO
     C*    BE USED.
     C*    NOTE - IF CGL017 IS SWITCHED ON RSACMTL5 REPLACES RSACMTL1     CGL017
     C* 4. LOAD FIRST PAGE OF SUBFILE RECORDS
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: SLCT13, SLCT22
     C*
     C*****************************************************************
     C*
     C           SCRN1     BEGSR                           ** SCRN1 **
     C*
     C* RESET SUBFILE AND FILE RECORD POINTER
     C*
     C                     Z-ADD1         RRN     40
     C                     SETOF                     048083
     C*
B1   C           CQKEY     IFEQ *ZEROS
     C*
     C*  IF A '-' WAS ENTERED WE DISPLAY ANY DR/CR <= THE AMOUNT
     C*  IF A '+' WAS ENTERED OR JUST AN AMOUNT WE DISPLAY ANY
     C*      DR/CR >= THE AMOUNT
     C*
B2   C           PORM      IFEQ '-'
     C                     Z-ADD0         AMTKY  130
     C                     ELSE
     C                     Z-ADDAMTNUM    AMTKY
E2   C                     END
     C*
     C                     Z-ADD0         DORK    10
     C*
B2   C           FFFL      IFEQ 'Y'
     C*
     C** If the futures and options module is on read a record from
     C** the F&O account movement file and a record from the account
     C** movement file for 'other' modules based on the selection
     C** details entered by the user. Then process the record with the
     C** lower value date, amount and dr/cr indicator.
     C*
     C                     MOVE '0'       *IN80
     C*
     C/COPY WNCPYSRC,GL4443C006
     C           KEYSL1    SETLLFFACMV3
     C           KEYEQ     READEFFACMV3                  84
     C*
B3   C           CGL017    IFEQ 'Y'                                       CGL017
      *                                                                   CGL017
      * If Value Date entered is greater than today need to ascertain     CGL017
      * the opening balance for the Value Date entered.                   CGL017
      * Otherwise if Blank or previous to today default to todays date.   CGL017
      * and opening balance is value off MEMOS or PRONO.                  CGL017
B4   C           VALDN     IFGT RNDT                                      CGL017
     C                     EXSR FUTOPB                                    CGL017
      *                                                                   CGL017
      * Output Opening record on Subfile.                                 CGL017
     C                     EXSR WRTSU2                                    CGL017
X4   C                     ELSE                                           CGL017
      *                                                                   CGL017
B5   C           *IN14     IFEQ *ON                                       CGL017
     C                     Z-ADDCLBL      PRCLB  150                      CGL017
X5   C                     ELSE                                           CGL017
     C                     Z-ADDLDBL      PRCLB  150                      CGL017
E5   C                     ENDIF                                          CGL017
      *                                                                   CGL017
      * Output Opening record on Subfile.                                 CGL017
     C                     EXSR WRTSU2                                    CGL017
E4   C                     ENDIF                                          CGL017
      *                                                                   CGL017
     C                     Z-ADD0         DORK    10                      CGL017
      *                                                                   CGL017
      * Could be backvalued postings entered today so need to pick them upCGL017
      * and keep running total of closing projected balance               CGL017
      * Setll on RSACMTL5 with blank date and read through until date on  CGL017
      * postin is equal to the rundate adjusting the running total of     CGL017
      * closing balance.                                                  CGL017
B4   C           VALDN     IFNE *ZEROS                                    CGL017
     C           VALDN     ANDLERNDT                                      CGL017
     C                     Z-ADDVALDN     WVALDN  50                      CGL017
     C                     Z-ADD0         VALDN                           CGL017
     C           KEYSL5    SETLLRSACMTL5                                  CGL017
     C           KEYEQ     READERSACMTL5                 80               CGL017
      *                                                                   CGL017
      * If CLEARPD has been read as opposed to RSACMTPD then move         CGL017
      * CLEARPD values to RSACMTPD values for condition satisfying.       CGL017
B5   C           *IN31     IFEQ *ON                                       CGL017
     C                     Z-ADDVALD      VUDTE                           CGL017
     C                     MOVE DRCR      DORCE                           CGL017
     C                     Z-ADDPSTA      MVAME                           CGL017
E5   C                     ENDIF                                          CGL017
      *                                                                   CGL017
B5   C           VUDTE     IFLT RNDT                                      CGL017
B6   C           *IN80     DOWNE*ON                                       CGL017
     C           VUDTE     ANDLTWVALDN                                    CGL017
B7   C           DORCE     IFEQ 0                                         CGL017
     C           PRCLB     ADD  MVAME     PRCLB                           CGL017
X7   C                     ELSE                                           CGL017
     C           PRCLB     SUB  MVAME     PRCLB                           CGL017
E7   C                     ENDIF                                          CGL017
     C           KEYEQ     READERSACMTL5                 80               CGL017
E6   C                     ENDDO                                          CGL017
E5   C                     ENDIF                                          CGL017
     C                     Z-ADDWVALDN    VALDN                           CGL017
E4   C                     ENDIF                                          CGL017
      *                                                                   CGL017
     C           KEYSL5    SETLLRSACMTL5                                  CGL017
X3   C                     ELSE                                           CGL017
      *                                                                   CGL017
     C           *IN14     IFEQ *ON                                       CRE009
     C                     Z-ADDCLBL      PRCLB  150                      CRE009
     C                     ELSE                                           CRE009
     C                     Z-ADDLDBL      PRCLB  150                      CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CRE009
      ** Display projected postings regardless of Value Date filtered                     AR1095995A
     C           *IN14     IFEQ '1'                                                       AR1095995A
     C           KEYSLA    SETLLRSACMTL1                                                  AR1095995A
     C                     ELSE                                                           AR1095995A
     C           KEYSL1    SETLLRSACMTL1
     C                     ENDIF                                                          AR1095995A
E3   C                     ENDIF                                          CGL017
     C/COPY WNCPYSRC,GL4443C007
     C                     EXSR RSACM2
     C                     EXSR SLCT13
     C*
X2   C                     ELSE
     C*
     C/COPY WNCPYSRC,GL4443C008
B3   C           CGL017    IFEQ 'Y'                                       CGL017
      *                                                                   CGL017
      * If Value Date entered is greater than today need to ascertain     CGL017
      * the opening balance for the Value Date entered.                   CGL017
      * Otherwise if Blank or previous to today default to todays date.   CGL017
B4   C           VALDN     IFGT RNDT                                      CGL017
     C                     EXSR FUTOPB                                    CGL017
      *                                                                   CGL017
      * Output Opening record on Subfile.                                 CGL017
     C                     EXSR WRTSU2                                    CGL017
X4   C                     ELSE                                           CGL017
      *                                                                   CGL017
B5   C           *IN14     IFEQ *ON                                       CGL017
     C                     Z-ADDCLBL      PRCLB  150                      CGL017
X5   C                     ELSE                                           CGL017
     C                     Z-ADDLDBL      PRCLB  150                      CGL017
E5   C                     ENDIF                                          CGL017
      *                                                                   CGL017
      * Output Opening record on Subfile.                                 CGL017
     C                     EXSR WRTSU2                                    CGL017
E4   C                     ENDIF                                          CGL017
      *                                                                   CGL017
     C                     Z-ADD0         DORK    10                      CGL017
      *                                                                   CGL017
      * Could be backvalued postings entered today so need to pick them upCGL017
      * and keep running total of closing projected balance               CGL017
      * Setll on RSACMTL5 with blank date and read through until date on  CGL017
      * postin is equal to the rundate adjusting the running total of     CGL017
      * closing balance.                                                  CGL017
B4   C           VALDN     IFNE *ZEROS                                    CGL017
     C           VALDN     ANDLERNDT                                      CGL017
     C                     Z-ADDVALDN     WVALDN  50                      CGL017
     C                     Z-ADD0         VALDN                           CGL017
     C           KEYSL5    SETLLRSACMTL5                                  CGL017
     C           KEYEQ     READERSACMTL5                 80               CGL017
      *                                                                   CGL017
      * If CLEARPD has been read as opposed to RSACMTPD then move         CGL017
      * CLEARPD values to RSACMTPD values for condition satisfying.       CGL017
B5   C           *IN31     IFEQ *ON                                       CGL017
     C                     Z-ADDVALD      VUDTE                           CGL017
     C                     MOVE DRCR      DORCE                           CGL017
     C                     Z-ADDPSTA      MVAME                           CGL017
E5   C                     ENDIF                                          CGL017
      *                                                                   CGL017
B5   C           VUDTE     IFLT RNDT                                      CGL017
B6   C           *IN80     DOWNE*ON                                       CGL017
     C           VUDTE     ANDLTWVALDN                                    CGL017
B7   C           DORCE     IFEQ 0                                         CGL017
     C           PRCLB     ADD  MVAME     PRCLB                           CGL017
X7   C                     ELSE                                           CGL017
     C           PRCLB     SUB  MVAME     PRCLB                           CGL017
E7   C                     ENDIF                                          CGL017
     C           KEYEQ     READERSACMTL5                 80               CGL017
E6   C                     ENDDO                                          CGL017
E5   C                     ENDIF                                          CGL017
     C                     Z-ADDWVALDN    VALDN                           CGL017
E4   C                     ENDIF                                          CGL017
      *                                                                   CGL017
     C           KEYSL5    SETLLRSACMTL5                                  CGL017
X3   C                     ELSE                                           CGL017
      *                                                                   CGL017
     C           *IN14     IFEQ *ON                                       CRE009
     C                     Z-ADDCLBL      PRCLB  150                      CRE009
     C                     ELSE                                           CRE009
     C                     Z-ADDLDBL      PRCLB  150                      CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CRE009
      ** Display projected postings regardless of Value Date filtered                     AR1095995B
     C           *IN14     IFEQ '1'                                                       AR1095995B
     C           KEYSLA    SETLLRSACMTL1                                                  AR1095995B
     C                     ELSE                                                           AR1095995B
     C           KEYSL1    SETLLRSACMTL1
     C                     ENDIF                                                          AR1095995B
E3   C                     ENDIF                                          CGL017
     C/COPY WNCPYSRC,GL4443C009
     C                     EXSR RSACMT
     C*
B3   C           *IN80     IFEQ '0'
      *                                                                                       238578
      ** Initialise with field values from RSACMTL5                                           238578
      *                                                                                       238578
     C           CGL017    IFEQ 'Y'                                                           238578
     C**********           Z-ADDCUSNE     CUSN                                        238578 CSD027A
     C                     MOVE CUSNE     CUSN                                               CSD027A
     C                     MOVE CCYDE     CCYD                                                238578
     C                     Z-ADDACDEE     ACDE                                                238578
     C                     Z-ADDASNCE     ASNC                                                238578
     C                     Z-ADDPTDTE     PTDT                                                238578
     C                     Z-ADDVUDTE     VUDT                                                238578
     C                     MOVE TRYPE     TRYP                                                238578
     C                     MOVE NRTCE     NRTC                                                238578
     C**********           MOVE NRTDE     NRTD                                       238578 BUG12795
     C**********           MOVELNRTDE     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDE     NRTD                                             BUG12795A
     C                     MOVE TNMRE     TNMR                                                238578
     C                     Z-ADDCQNRE     CQNR                                                238578
     C                     Z-ADDMVAME     MVAM                                                238578
     C                     Z-ADDDORCE     DORC                                                238578
      *                                                                                       238578
     C                     ELSE                                                               238578
      *                                                                                       238578
      ** CGL017 is OFF, use field values from RSACMTL1                                        238578
      *                                                                                       238578
     C**********           Z-ADDCUSNA     CUSN                                                CSD027
     C                     MOVE CUSNA     CUSN                                                CSD027
     C                     MOVE CCYDA     CCYD
     C                     Z-ADDACDEA     ACDE
     C                     Z-ADDASNCA     ASNC
     C                     Z-ADDPTDTA     PTDT
     C                     Z-ADDVUDTA     VUDT
     C                     MOVE TRYPA     TRYP
     C                     MOVE NRTCA     NRTC                            080050
     C************         Z-ADDNRTCA     NRTC                            080050
     C**********           MOVE NRTDA     NRTD                                              BUG12795
     C**********           MOVELNRTDA     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDA     NRTD                                    BUG12795 BUG12795A
     C                     MOVE TNMRA     TNMR    6
     C                     Z-ADDCQNRA     CQNR
     C                     Z-ADDMVAMA     MVAM
     C                     Z-ADDDORCA     DORC
     C                     ENDIF                                                              238578
     C*
     C** USE THE CORRECT REFERENCE
     C*
B4   C           *IN32     IFEQ '1'
     C           *IN34     OREQ '1'
     C                     MOVE *BLANKS   STNMR
B5   C           TRYP      IFEQ 'OP'
     C           FUND      ANDNE*BLANKS                                                       193984
     C           TRYP      OREQ 'RP'
     C           FUND      ANDNE*BLANKS                                   181780
     C           TRYP      OREQ 'IN'
     C           TRYP      OREQ 'CP'
     C           FUND      ANDNE*BLANKS                                   082738
     C           TRYP      OREQ 'CC'
     C           TRYP      OREQ 'NT'
     C           TRYP      OREQ 'RI'                                      CFT006
     C           TRYP      OREQ 'RO'                                      CFT006
     C           TRYP      OREQ 'BI'                                      CFT006
     C           TRYP      OREQ 'BO'                                      CFT006
     C/COPY WNCPYSRC,GL4443C026
     C**********           MOVE FUND      STNMR                                               CRE020
     C                     MOVELFUND      STNMR                                               CRE020
     C/COPY WNCPYSRC,GLH00675
      *
      ** Show Security Shortname when a 'PS'/'SE' Event if CGL045 is ON.  CGL045
     C                     ELSE                                           CGL045
     C           TRYP      IFEQ 'PS'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C           TRYP      OREQ 'SE'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C                     MOVELNRTD      STNMR                           CGL045
X5   C                     ELSE
     C                     MOVELTNMR      STNMR
      *                                                                   CDL008
      ** Narrative description must be shown if CLS transaction           CDL008
      *                                                                   CDL008
     C                     MOVELNRTD      WNRTD   7                       CDL008
B6   C           WNRTD     IFEQ 'CLS PAY'                                 CDL008
     C           WNRTD     OREQ 'CLS RCV'                                 CDL008
     C                     MOVELNRTD      STNMR                           CDL008
E6   C                     ENDIF                                          CDL008
      **********                                                                  BUG12795 BUG12795A
     C********** TRYP      IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE NRTD      IPNRTD                                  BUG12795 BUG12795A
     C********** IPNRDS    IFEQ 'VALUE   '                                        BUG12795 BUG12795A
     C**********           MOVE INTERB    STNMR                                   BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
E5   C                     END
     C                     END                                            CGL045
     C*                                                                   S01408
B5   C           TNMR      IFEQ '000000'                                                      178438
     C                     MOVELNRTD      STNMR                                               178438
E5   C                     END                                                                178438
     C*                                                                                       178438
     C/COPY WNCPYSRC,GL4443CIRE                                           S01408
     C*                                                                   S01408
E4   C                     END
E3   C                     END
     C*
E2   C                     END
     C*
     C                     EXSR BSFIL1
     C*
X1   C                     ELSE
     C*
     C                     MOVE *BLANK    VALDA
     C*
     C** If the futures and options module flag is 'Y' use the logical
     C** file which includes fo account movements.
     C*
B2   C           FFFL      IFEQ 'Y'
     C*
     C** If the futures and options module is on read a record from
     C** the F&O account movement file and a record from the account
     C** movement file for 'other' modules based on the selection
     C** details entered by the user. Then process the record with the
     C** lower cheque number.
     C*
     C                     MOVE '0'       *IN80
     C*
     C           KEYSL2    SETLLFFACMV2
     C           KEYEQ     READEFFACMV2                  84
     C*
     C           KEYSL2    SETLLRSACMTL2
     C                     EXSR RSACM2
     C*
     C                     EXSR SLCT22
     C*
X2   C                     ELSE
     C*
     C           KEYSL2    SETLLRSACMTL2
     C                     EXSR RSACMT
     C*
B3   C           *IN80     IFEQ '0'
     C**********           Z-ADDCUSNB     CUSN                                                CSD027
     C                     MOVE CUSNB     CUSN                                                CSD027
     C                     MOVE CCYDB     CCYD
     C                     Z-ADDACDEB     ACDE
     C                     Z-ADDASNCB     ASNC
     C                     Z-ADDPTDTB     PTDT
     C                     Z-ADDVUDTB     VUDT
     C                     MOVE TRYPB     TRYP
     C                     MOVE NRTCB     NRTC                            080050
     C************         Z-ADDNRTCB     NRTC                            080050
     C**********           MOVE NRTDB     NRTD                                              BUG12795
     C**********           MOVELNRTDB     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDB     NRTD                                             BUG12795A
     C                     MOVE TNMRB     TNMR
     C                     Z-ADDCQNRB     CQNR
     C                     Z-ADDMVAMB     MVAM
     C                     Z-ADDDORCB     DORC
     C*
     C** USE THE CORRECT REFERENCE
     C*
B4   C           *IN32     IFEQ '1'
     C           *IN34     OREQ '1'
     C                     MOVE *BLANKS   STNMR
B5   C           TRYP      IFEQ 'OP'
     C           FUND      ANDNE*BLANKS                                                       193984
     C           TRYP      OREQ 'RP'
     C           FUND      ANDNE*BLANKS                                   181780
     C           TRYP      OREQ 'IN'
     C           TRYP      OREQ 'CP'
     C           FUND      ANDNE*BLANKS                                   082738
     C           TRYP      OREQ 'CC'
     C           TRYP      OREQ 'NT'
     C           TRYP      OREQ 'RI'                                      CFT006
     C           TRYP      OREQ 'RO'                                      CFT006
     C           TRYP      OREQ 'BI'                                      CFT006
     C           TRYP      OREQ 'BO'                                      CFT006
     C/COPY WNCPYSRC,GL4443C027
     C**********           MOVE FUND      STNMR                                               CRE020
     C                     MOVELFUND      STNMR                                               CRE020
     C/COPY WNCPYSRC,GLH00676
X5   C                     ELSE
      *
      ** Show Security Shortname when a 'PS'/'SE' Event if CGL045 is ON.  CGL045
     C           TRYP      IFEQ 'PS'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C           TRYP      OREQ 'SE'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C                     MOVELNRTD      STNMR                           CGL045
     C                     ELSE                                           CGL045
     C                     MOVELTNMR      STNMR
      *                                                                   CDL008
      ** Narrative description must be shown if CLS transaction           CDL008
      *                                                                   CDL008
     C                     MOVELNRTD      WNRTD                           CDL008
B6   C           WNRTD     IFEQ 'CLS PAY'                                 CDL008
     C           WNRTD     OREQ 'CLS RCV'                                 CDL008
     C                     MOVELNRTD      STNMR                           CDL008
E6   C                     ENDIF                                          CDL008
      **********                                                                  BUG12795 BUG12795A
     C********** TRYP      IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE NRTD      IPNRTD                                  BUG12795 BUG12795A
     C********** IPNRDS    IFEQ 'VALUE   '                                        BUG12795 BUG12795A
     C**********           MOVE INTERB    STNMR                                   BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
E5   C                     END
     C                     ENDIF                                          CGL045
     C*                                                                   S01408
B5   C           TNMR      IFEQ '000000'                                                      178438
     C                     MOVELNRTD      STNMR                                               178438
E5   C                     END                                                                178438
     C*                                                                                       178438
     C/COPY WNCPYSRC,GL4443CIRE                                           S01408
     C*                                                                   S01408
E4   C                     END
E3   C                     END
     C*
E2   C                     END
     C*
     C                     EXSR BSFIL2
     C*
E1   C                     END
     C*
     C*  DISPLAY MESSAGE - IF NO RECORDS WERE WRITTEN TO THE SUBFILE
     C*
B1   C           *IN83     IFEQ '0'
     C***Remove*postings*from previous enquiry***                                             116710
     C                     SETON                     50
     C/COPY WNCPYSRC,GL4443C031
     C**********           WRITESFLCTLR                                                       116710
     C/COPY WNCPYSRC,GL4443C032
     C**********           SETOF                     50                                       116710
     C**********           MOVEL'GLM0012' ZAMSID                                              116710
     C**********           EXSR SRSMSG                                                        116710
     C                     MOVELEMSG,1    ERRDSP                                              116710
E1   C                     END
     C*
     C                     ENDSR                           ** SCRN1 **
     C*
      /TITLE         <<< FLDCHG SR. >>>
     C*****************************************************************
     C*
     C* FLDCHG --- SUBROUTINE TO SET FIELDS CHANGED? INDICATORS
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           FLDCHG    BEGSR                           ** FLDCHG **
     C*
     C           MBIN      IFEQ 'Y'
     C           MBACNT    COMP MBACSV               6060
     C                     ELSE
     C           ACNT      COMP ACSV                 6060
     C                     END
     C           VALDA     COMP PDSV                 6161
     C           PORM      COMP POSV                 6262
     C           AMONT     COMP AMSV                 6363
     C  N63      CQNMR     COMP CHSV                 6363
     C*
     C* IF THIS IS THE FIRST TIME INTO THE PROGRAM
     C*   OR INVALID INPUT WAS ENTERED PREVIOUSLY
     C*    THEN FORCE VALIDATION TO TAKE PLACE
     C*
     C           *IN01     IFEQ '0'
     C           *IN50     OREQ '1'
     C                     SETON                     016061
     C                     SETON                     6263
     C                     END
     C*
     C           *IN60     IFEQ '1'
     C           *IN61     OREQ '1'
     C           *IN62     OREQ '1'
     C           *IN63     OREQ '1'
     C                     SETON                     12
     C                     ELSE
     C                     SETOF                     12
     C                     END
     C*
     C                     ENDSR                           ** FLDCHG **
     C*
     C*
      /TITLE         <<< PRJBAL SR. >>>
     C*****************************************************************
     C*
     C* PRJBAL - SUBROUTINE FOR ACCESSING EITHER MEMOS OR PRONO
     C*
     C* 1. IF RETAIL ACCOUNT
     C*        THEN ACCESS MEMOS FILE FOR THE SHADOW BALANCE
     C* 2. IF NOSTRO ACCOUNT
     C*        THEN CALL ACCESS OBJECT AONOSTR0 TO GET NOSTRO DETAILS
     C*        THEN ACCESS PRONO FILE FOR THE PROJECTED BALANCES
     C*
     C*****************************************************************
     C*
     C           PRJBAL    BEGSR                           ** PRJBAL **
     C*
     C           *IN14     IFEQ '1'
     C                     EXSR PRJMEM
     C                     ELSE
     C                     EXSR PRJPRO
     C                     END
     C*
     C                     ENDSR                           ** PRJBAL **
     C*
      /TITLE         <<< PRJMEM SR. >>>
     C*****************************************************************
     C*
     C* PRJMEM - SUBROUTINE FOR ACCESSING MEMOS
     C*
     C*****************************************************************
     C*
     C           PRJMEM    BEGSR                           ** PRJMEM **
     C*
     C***********RRNM      CHAINMEMOS                99                   CCB002
      *                                                                   CCB002
      ** Call Access Object AOMEMSR0                                      CCB002
     C                     CALL 'AOMEMSR0'                                CCB002
     C                     PARM *BLANKS   W0RTCD  7        I:Return code  CCB002
     C                     PARM '*KEY   ' W0OPTN  7        O:Option       CCB002
     C                     PARM 0         W0RETL 100       O:Retail A/C NoCCB002
     C**********           PARM KCUS      W0CNUM  60       O:Customer No.              CCB002 CSD027
     C                     PARM KCUS      W0CNUM  6        O:Customer No.                     CSD027
     C                     PARM KCCY      W0CUCD  3        O:Currency     CCB002
     C**********           PARM KCOD      W0ACCD  40       O:Account Code              CCB002 CGL029
     C                     PARM KCOD      W0ACCD 100                                          CGL029
     C                     PARM KASE      W0ACSQ  20       O:Account Seq. CCB002
     C                     PARM KBRC      W0BRCA  3        O:Branch       CCB002
     C           DSMEMS    PARM DSMEMS    @DSFDY                          CCB002
     C*
     C************IN99     IFEQ '1'                                       CCB002
     C           W0RTCD    IFNE '       '                                 CCB002
     C                     Z-ADD1         DBASE                  ***************
     C***********          MOVE 'MEMOS'   DBFILE                 * DB ERROCCB002
     C***********          MOVELRRNM      DBKEY                  *********CCB002
     C                     MOVE 'AOMEMSU0'DBFILE                          CCB002
     C**********           Z-ADDW0CNUM    U0CNUM                                       CCB002 CSD027
     C                     MOVE W0CNUM    U0CNUM                                              CSD027
     C                     MOVE W0CUCD    U0CUCD                          CCB002
     C                     Z-ADDW0ACCD    U0ACCD                          CCB002
     C                     Z-ADDW0ACSQ    U0ACSQ                          CCB002
     C                     MOVE W0BRCA    U0BRCA                          CCB002
     C                     MOVELUMEMER    DBKEY                           CCB002
     C                     EXSR *PSSR
     C                     END
     C*
     C* If the ff module flag is 'Y'
     C* Check memosm1 for any changes to ledger/cleared balances
     C* add changes to the existing balances.
     C*
     C***********          OPEN MEMOSM1                           098612  137355
     C           FFFL      IFEQ 'Y'
     C                     OPEN MEMOSM1                                   137355
     C           KALL      SETLLMEMOSM1                47
     C           *IN47     DOWEQ'0'
     C           KALL      READEMEMOSM1                  47
     C           *IN47     IFEQ '0'
     C           RECI      ANDNE'*'
     C                     ADD  LDBLX     LDBLN
     C                     ADD  CLBLX     CLBLN
     C                     END
     C                     END
     C                     CLOSEMEMOSM1                                   098612
     C                     END
     C*
     C                     ENDSR                           ** PRJMEM **
     C*
      /TITLE         <<< PRJPRO SR. >>>
     C*****************************************************************
     C*
     C* PRJPRO - SUBROUTINE FOR ACCESSING PRONO
     C*
     C*****************************************************************
     C*
     C           PRJPRO    BEGSR                           ** PRJPRO **
     C*
     C** OBTAIN NOSTRO DETAILS IF ACCOUNT HAS CHANGED, I.E. NOT F5
     C*
     C                     CALL 'AONOSTR0'
     C                     PARM '       ' P@RTCD
     C                     PARM '*KEY'    P@OPTN
     C                     PARM KCUSA     P@CUST
     C                     PARM KCCY      P@KEY2
     C                     PARM KCODA     P@KEY3
     C                     PARM KASEA     P@KEY4
     C                     PARM           P@NOSN
     C                     PARM KBRC      @KEYF   3                    F  082466
     C************         PARM           @KEYF   3                    F  082466
     C                     PARM           @KEYG  10                    G
     C                     PARM           @KEYH   1                    H
     C***********          PARM           P@FMT3                                              CSD006
     C           P@FMT3    PARM P@FMT3    DSSDY                                               CSD006
     C*
     C           P@RTCD    IFNE *BLANK
     C           KCUSA     CAT  KCYC:0    WKEY1                                               235377
     C           KCODA     CAT  KASEA:0   WKEY2                                               235377
     C           WKEY1     CAT  WKEY2:0   KEYAC                                               235377
     C***********KCUSA     CAT  KCODA:0   WKEY                                         CGL029 235377
     C***********WKEY      CAT  KASEA:0   KEYAC                                        CGL029 235377
     C                     Z-ADD2         DBASE                  ***************
     C                     MOVE 'AONOSTR0'DBFILE                 * DB ERRPR 02 *
     C                     MOVELKEYAC     DBKEY                  ***************
     C                     EXSR *PSSR
     C                     END
     C*
     C* Obtain projected balances from PRONO
     C                     MOVE A7NONB    KNOST   20
     C           KEYPRO    CHAINPRONO                99
     C*
     C* If no record on PRONO, this is a newly opened nostro, so set
     C*  on *IN15 to output 'Unallocated Nostro' text and 'Not Available'
     C*  in place of Projected Closing Balance.
     C           *IN99     IFEQ '1'
     C*
     C                     SETON                     15
     C*
     C                     ELSE
     C* If the ff module flag is 'Y'
     C* Check pronom1 for any changes to the projected balance
     C* add changes to the existing balance.
     C                     SETOF                     15
     C*
     C           FFFL      IFEQ 'Y'
     C                     OPEN PRONOM1                                   098612
     C           KEYPRO    SETLLPRONOM1                47
     C           *IN47     DOWEQ'0'
     C           KEYPRO    READEPRONOM1                  47
     C           *IN47     IFEQ '0'
     C           RECI      ANDNE'*'
     C                     ADD  PNBL      PBAL,1
     C                     END
     C                     END
     C                     CLOSEPRONOM1                                   098612
     C                     END
     C*
     C                     END
     C/COPY WNCPYSRC,GL4443C048
     C*
     C                     ENDSR                           ** PRJPRO **
     C*
     C/TITLE         <<< RSACMT SR. >>>
     C*****************************************************************
     C*
     C* RSACMT --- SUBROUTINE TO Read Records on posting files
     C*
     C*
     C* CALLED FROM: BSFIL1, BSFIL2 and SCRN1
     C*
     C* CALLS:  NOTHING
     C*
     C*****************************************************************
     C*
     C           RSACMT    BEGSR                           ** RSACMT **
     C*
     C* If Account is a retail read both record formats else
     C* read only RSACMT formats.
     C*
     C* No cheque number selected
     C*
     C                     MOVEA'0000'    *IN,31
S1   C           CQKEY     IFEQ *ZEROS
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP25                                           S01408
     C*                                                                   S01408
S2   C           *IN14     IFEQ '1'
     C/COPY WNCPYSRC,GL4443C010
S3   C           CGL017    IFEQ 'Y'                                       CGL017
     C           CRE009    OREQ 'Y'                                       CRE009
      *                                                                   CGL017
      * Save Value Date of Posting, if it changes, output  closing        CGL017
      * projected balance record                                          CGL017
     C           CGL017    IFNE 'Y'                                       CRE009
     C                     Z-ADDVUDTA     WVUDT                           CRE009
     C                     ELSE                                           CRE009
     C                     Z-ADDVUDTE     WVUDT   50                      CGL017
     C                     ENDIF                                          CRE009
     C           CGL017    IFNE 'Y'                                       CRE009
     C           KEYEQ     READERSACMTL1                 80               CRE009
     C                     ELSE                                           CRE009
     C           KEYEQ     READERSACMTL5                 80               CGL017
     C                     ENDIF                                          CRE009
      *                                                                   CGL017
      ** Set corresponding record according to whether APOSTPD or         CRE009
      ** RSACMTPD has been read.                                          CRE009
      *                                                                   CRE009
     C           *IN31     IFEQ *ON                                       CRE009
      *                                                                   CRE009
     C           CGL017    IFNE 'Y'                                       CRE009
     C                     Z-ADDVALD      VUDTA                           CRE009
     C                     ELSE                                           CRE009
     C                     Z-ADDVALD      VUDTE                           CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CGL017
      * As the sub file page size is 12 if this no. of records have been  CGL017
      * written we do not want to write the Closing Projected Balance     CGL017
      * record until after the page has been displayed. CLOBAL            CGL017
      * indicates whether to write this record later.                     CGL017
     C                     MOVE 'N'       CLOBAL  1                       CGL017
S4   C           VUDTE     IFGT WVUDT                                     CGL017
      * Not if stored value is 0 as this means first time through file    CGL017
     C           WVUDT     ANDNE0                                         CGL017
      * Not if date read is too far in advance (ie greater than 4         CGL017
      * working days forward of rundate                                   CGL017
     C           PDAT,5    ANDGEVUDTE                                     CGL017
     C           CGL017    ANDEQ'Y'                                       CRE009
     C           CRE009    ANDNE'Y'                                       CRE009
      *                                                                   CRE009
     C           VUDTA     ORGT WVUDT                                     CRE009
     C           WVUDT     ANDNE0                                         CRE009
      * Not if date read is too far in advance for CRE009                 CRE009
     C           NXTD      ANDGEVUDTA                                     CRE009
     C           CRE009    ANDEQ'Y'                                       CRE009
     C           CGL017    ANDNE'Y'                                       CRE009
      *                                                                   CRE009
     C           VUDTE     ORGT WVUDT                                     CRE009
     C           WVUDT     ANDNE0                                         CRE009
      * Not if date read is too far in advance for CRE009                 CRE009
     C           NXTD      ANDGEVUDTE                                     CRE009
     C           CRE009    ANDEQ'Y'                                       CRE009
     C           CGL017    ANDEQ'Y'                                       CRE009
      *                                                                   CGL017
      * Don't want to ouput closing balances for dates before rundate     CGL017
      * would occur if backvalued postings entered today.                 CGL017
S5   C           VUDTE     IFGT RNDT                                      CGL017
     C           CGL017    ANDEQ'Y'                                       CRE009
     C           VUDTA     ORGT RNDT                                      CRE009
     C           CGL017    ANDNE'Y'                                       CRE009
      *                                                                   CGL017
      * If account is retail then only todays postings are displayed      CGL017
      * so do not output closing balance record.                          CGL017
      * Except if account is retail and CRE009 is ON                      CRE009
S6   C           *IN14     IFNE *ON                                       CGL017
     C           *IN14     OREQ *ON                                       CRE009
     C           CRE009    ANDEQ'Y'                                       CRE009
      *                                                                   CGL017
      * If sub file page full do not write Closing Balance record now     CGL017
      * but after page is displayed.                                      CGL017
     C           COUNT     IFLT 12                                        CGL017
     C                     EXSR WRTSU3                                    CGL017
     C                     ELSE                                           CGL017
     C                     MOVE 'Y'       CLOBAL                          CGL017
     C                     ENDIF                                          CGL017
     C*                                                                   CGL017
E6   C                     ENDIF                                          CGL017
E5   C                     ENDIF                                          CGL017
      *                                                                   CGL017
E4   C                     ENDIF                                          CGL017
      *                                                                   CGL017
X3   C                     ELSE                                           CGL017
      * CGL017 not On.                                                    CGL017
     C           KEYEQ     READERSACMTL1                 80
E3   C                     ENDIF                                          CGL017
     C/COPY WNCPYSRC,GL4443C011
X2   C                     ELSE
S3   C           *IN80     DOUEQ'1'
     C           *IN32     OREQ '1'
     C                     MOVEA'0000'    *IN,31
     C/COPY WNCPYSRC,GL4443C012
S4   C           CGL017    IFEQ 'Y'                                       CGL017
     C           CGL017    ORNE 'Y'                                       CRE009
      *                                                                   CGL017
      * Save Value Date of Posting, if it changes output                  CGL017
      * Closing projected balance record                                  CGL017
     C           CGL017    IFEQ 'Y'                                       CRE009
     C                     Z-ADDVUDTE     WVUDT   50                      CGL017
     C                     ELSE                                           CRE009
     C                     Z-ADDVUDTA     WVUDT   50                      CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CGL017
      * As the sub file page size is 12 if this no. of records have been  CGL017
      * written we do not want to write the Closing Projected Balance     CGL017
      * record until after the page has been displayed. CLOBAL            CGL017
      * indicates whether to write this record later.                     CGL017
     C                     MOVE 'N'       CLOBAL  1                       CGL017
     C           CGL017    IFEQ 'Y'                                       CRE009
     C           KEYEQ     READERSACMTL5                 80               CGL017
     C                     ELSE                                           CRE009
     C           KEYEQ     READERSACMTL1                 80               CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CGL017
S5   C           VUDTE     IFGT WVUDT                                     CGL017
      * Not if stored value is 0 as this means first time through file    CGL017
     C           WVUDT     ANDNE0                                         CGL017
      * Not if date read is too far in advance (ie greater than 4         CGL017
      * working days forward of rundate                                   CGL017
     C           PDAT,5    ANDGEVUDTE                                     CGL017
      * Don't want to ouput closing balances for dates before rundate     CGL017
      * would occur if backvalued postings entered today.                 CGL017
     C           VUDTE     ANDGTRNDT                                      CGL017
     C           CGL017    ANDEQ'Y'                                       CRE009
      *
     C           VUDTA     ORGT WVUDT                                     CRE009
     C           WVUDT     ANDNE0                                         CRE009
     C           PDAT,5    ANDGEVUDTA                                     CRE009
     C           VUDTA     ANDGTRNDT                                      CRE009
     C           CGL017    ANDNE'Y'                                       CRE009
      *                                                                   CRE009
      * If account is retail then only todays postings are displayed      CGL017
      * so do not output closing balance record.                          CGL017
S6   C********   *IN14     IFNE *ON                                       CRE009
      *                                                                   CGL017
      * If sub file page full do not write Closing Balance record now     CGL017
      * but after page is displayed.                                      CGL017
     C           COUNT     IFLT 12                                        CGL017
     C                     EXSR WRTSU3                                    CGL017
     C                     ELSE                                           CGL017
     C                     MOVE 'Y'       CLOBAL                          CGL017
     C                     ENDIF                                          CGL017
      *                                                                   CGL017
E6   C********             ENDIF                                          CRE009
      *                                                                   CGL017
E5   C                     ENDIF                                          CGL017
      *                                                                   CGL017
X4   C                     ELSE                                           CGL017
      * CGL017 not On.                                                    CGL017
     C           KEYEQ     READERSACMTL1                 80
E4   C                     ENDIF                                          CGL017
     C/COPY WNCPYSRC,GL4443C013
E3   C                     END
E2   C                     END
     C*
     C* Cheque number selected
     C*
X1   C                     ELSE
S2   C           *IN14     IFEQ '1'
     C           KEYEQ     READERSACMTL2                 80
     C                     ELSE
S3   C           *IN80     DOUEQ'1'
     C           *IN34     OREQ '1'
     C                     MOVEA'0000'    *IN,31
     C           KEYEQ     READERSACMTL2                 80
E3   C                     END
E2   C                     END
E1   C                     END
     C*
     C* If record read and APOSTPDF format translate information
     C*
     C           *IN80     IFEQ '0'
     C           *IN14     ANDEQ'1'
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP26                                           S01408
     C*                                                                   S01408
     C*
     C* Record from APOST1 read
     C*
     C           *IN31     IFEQ '1'
     C*
     C           CGL017    IFEQ 'Y'                                                          247691A
     C                     MOVEL'CR'      TRYPE                                              247691A
     C                     Z-ADDPSTD      PTDTE                                              247691A
     C                     Z-ADDVALD      VUDTE                                              247691A
     C                     Z-ADDPSTA      MVAME                                              247691A
     C                     MOVELDRCR      DORCE                                              247691A
     C                     Z-ADD#CHQN     CQNRE                                              247691A
     C                     MOVELPNAR      STNMR                                              247691A
     C*                                                                                      247691A
     C**********           Z-ADDCNUM      CUSNE                                              247691A
     C                     MOVELCNUM      CUSNE                                              247691A
     C                     MOVELCCY       CCYDE                                              247691A
     C                     Z-ADDACOD      ACDEE                                              247691A
     C                     Z-ADDACSQ      ASNCE                                              247691A
     C                     MOVE *BLANKS   NRTCE                                              247691A
     C                     MOVELPNAR      NRTDE                                              247691A
     C                     MOVEL*BLANKS   TNMRE                                              247691A
     C                     ELSE                                                              247691A
     C                     MOVEL'CR'      TRYPA
     C                     Z-ADDPSTD      PTDTA
     C                     Z-ADDVALD      VUDTA
     C                     Z-ADDPSTA      MVAMA
     C                     MOVELDRCR      DORCA
     C                     Z-ADD#CHQN     CQNRA
     C                     MOVELPNAR      STNMR
     C*
     C**********           Z-ADDCNUM      CUSNA                                               CSD027
     C                     MOVE CNUM      CUSNA                                               CSD027
     C                     MOVELCCY       CCYDA
     C                     Z-ADDACOD      ACDEA
     C                     Z-ADDACSQ      ASNCA
     C                     MOVE *BLANKS   NRTCA                           080050
     C************         Z-ADD0         NRTCA                           080050
     C                     MOVELPNAR      NRTDA
     C                     MOVEL*BLANKS   TNMRA
     C                     ENDIF                                                             247691A
     C*
     C                     END
     C*
     C* Record from APOST2 read
     C*
     C           *IN33     IFEQ '1'
     C*
     C                     MOVEL'CR'      TRYPB
     C                     Z-ADDPSTD      PTDTB
     C                     Z-ADDVALD      VUDTB
     C                     Z-ADDPSTA      MVAMB
     C                     MOVELDRCR      DORCB
     C                     Z-ADD#CHQN     CQNRB
     C                     MOVELPNAR      STNMR
     C*
     C**********           Z-ADDCNUM      CUSNB                                               CSD027
     C                     MOVE CNUM      CUSNB                                               CSD027
     C                     MOVELCCY       CCYDB
     C                     Z-ADDACOD      ACDEB
     C                     Z-ADDACSQ      ASNCB
     C                     MOVE *BLANKS   NRTCB                           080050
     C************         Z-ADD0         NRTCB                           080050
     C                     MOVELPNAR      NRTDB
     C                     MOVEL*BLANKS   TNMRB
     C*
     C                     END
     C                     END
     C*
     C                     ENDSR                           ** RSACMT **
     C*
     C/TITLE         <<< RSACM2 SR. >>>
     C*****************************************************************
     C*
     C* RSACM2 --- SUBROUTINE TO Read Records on posting files
     C*
     C*
     C* CALLED FROM: BSFIL1, BSFIL2 and SCRN1
     C*
     C* CALLS:  NOTHING
     C*
     C*****************************************************************
     C*
     C           RSACM2    BEGSR                           ** RSACMT **
     C*
     C* If Account is a retail read both record formats else
     C* read only RSACMT formats.
     C*
     C* No cheque number selected
     C*
     C                     MOVEA'0000'    *IN,31
S1   C           CQKEY     IFEQ *ZEROS
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP27                                           S01408
     C*                                                                   S01408
S2   C           *IN14     IFEQ '1'
     C/COPY WNCPYSRC,GL4443C014
S3   C           CGL017    IFEQ 'Y'                                       CGL017
     C           CRE009    OREQ 'Y'                                       CRE009
      *                                                                   CGL017
      * Save Value Date of Posting, if it changes output                  CGL017
      * Closing projected balance record                                  CGL017
     C           CGL017    IFNE 'Y'                                       CRE009
     C                     Z-ADDVUDTA     WVUDT   50                      CRE009
     C                     ELSE                                           CRE009
     C                     Z-ADDVUDTE     WVUDT   50                      CGL017
     C                     ENDIF                                          CRE009
     C           CGL017    IFNE 'Y'                                       CRE009
     C           KEYEQ     READERSACMTL1                 85               CRE009
     C                     ELSE                                           CRE009
     C           KEYEQ     READERSACMTL5                 85               CGL017
     C                     ENDIF                                          CRE009
      *                                                                   CGL017
      ** Set corresponding record according to whether APOSTPD or         CRE009
      ** RSACMTPD has been read.                                          CRE009
      *                                                                   CRE009
     C           *IN31     IFEQ *ON                                       CRE009
      *                                                                   CRE009
     C           CGL017    IFNE 'Y'                                       CRE009
     C                     Z-ADDVALD      VUDTA                           CRE009
     C                     ELSE                                           CRE009
     C                     Z-ADDVALD      VUDTE                           CRE009
     C                     ENDIF                                          CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CGL017
      * As the sub file page size is 12 if this no. of records have been  CGL017
      * written we do not want to write the Closing Projected Balance     CGL017
      * record until after the page has been displayed. CLOBAL            CGL017
      * indicates whether to write this record later.                     CGL017
     C                     MOVE 'N'       CLOBAL  1                       CGL017
S4   C           VUDTE     IFGT WVUDT                                     CGL017
      * Not if stored values is 0 as this means first time through file   CGL017
     C           WVUDT     ANDNE0                                         CGL017
      * Not if date read is too far in advance (ie greater than 4         CGL017
      * working days forward of rundate                                   CGL017
     C           PDAT,5    ANDGEVUDTE                                     CGL017
      * Don't want to ouput closing balances for dates before rundate     CGL017
      * would occur if backvalued postings entered today.                 CGL017
     C           VUDTE     ANDGTRNDT                                      CGL017
     C           CGL017    ANDEQ'Y'                                       CRE009
     C           CRE009    ANDNE'Y'                                       CRE009
      *                                                                   CRE009
     C           VUDTE     ORGT WVUDT                                     CRE009
     C           WVUDT     ANDNE0                                         CRE009
      * Not if date read is too far in advance for CRE009                 CRE009
     C           NXTD      ANDGEVUDTE                                     CRE009
     C           VUDTE     ANDGTRNDT                                      CRE009
     C           CRE009    ANDEQ'Y'                                       CRE009
     C           CGL017    ANDEQ'Y'                                       CRE009
     C           VUDTA     ORGT WVUDT                                     CRE009
     C           WVUDT     ANDNE0                                         CRE009
      * Not if date read is too far in advance for CRE009                 CRE009
     C           NXTD      ANDGEVUDTA                                     CRE009
     C           VUDTA     ANDGTRNDT                                      CRE009
     C           CRE009    ANDEQ'Y'                                       CRE009
     C           CGL017    ANDNE'Y'                                       CRE009
      *                                                                   CGL017
      * If account is retail then only todays postings are displayed      CGL017
      * so do not output closing balance record.                          CGL017
      * Except if account is retail and CRE009 is ON                      CRE009
S5   C           *IN14     IFNE *ON                                       CGL017
     C           *IN14     OREQ *ON                                       CRE009
     C           CRE009    ANDEQ'Y'                                       CRE009
      *                                                                   CGL017
      * If sub file page full do not write Closing Balance record now     CGL017
      * but after page is displayed.                                      CGL017
     C           COUNT     IFLT 12                                        CGL017
     C                     EXSR WRTSU3                                    CGL017
     C                     ELSE                                           CGL017
     C                     MOVE 'Y'       CLOBAL                          CGL017
     C                     ENDIF                                          CGL017
E5   C                     ENDIF                                          CGL017
      *                                                                   CGL017
E4   C                     ENDIF                                          CGL017
      *                                                                   CGL017
X3   C                     ELSE                                           CGL017
     C           KEYEQ     READERSACMTL1                 85
E3   C                     ENDIF                                          CGL017
     C/COPY WNCPYSRC,GL4443C015
X2   C                     ELSE
S3   C           *IN85     DOUEQ'1'
     C           *IN32     OREQ '1'
     C                     MOVEA'0000'    *IN,31
     C/COPY WNCPYSRC,GL4443C016
S4   C           CGL017    IFEQ 'Y'                                       CGL017
S4   C           CGL017    ORNE 'Y'                                       CRE009
      *                                                                   CGL017
      * Save Value Date of Posting, if it changes output                  CGL017
      * Closing projected balance record                                  CGL017
     C           CGL017    IFEQ 'Y'                                       CRE009
     C                     Z-ADDVUDTE     WVUDT   50                      CGL017
     C                     ELSE                                           CRE009
     C                     Z-ADDVUDTA     WVUDT   50                      CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CGL017
      * As the sub file page size is 12 if this no. of records have been  CGL017
      * written we do not want to write the Closing Projected Balance     CGL017
      * record until after the page has been displayed. CLOBAL            CGL017
      * indicates whether to write this record later.                     CGL017
     C                     MOVE 'N'       CLOBAL  1                       CGL017
     C           CGL017    IFEQ 'Y'                                       CRE009
     C           KEYEQ     READERSACMTL5                 85               CGL017
     C                     ELSE                                           CRE009
     C           KEYEQ     READERSACMTL1                 85               CRE009
     C                     ENDIF                                          CRE009
      *                                                                   CGL017
S5   C           VUDTE     IFGT WVUDT                                     CGL017
      * Not if stored values are 0 as this means first time through file  CGL017
     C           WVUDT     ANDNE0                                         CGL017
      * Not if date read is too far in advance (ie greater than 4         CGL017
      * working days forward of rundate                                   CGL017
     C           PDAT,5    ANDGEVUDTE                                     CGL017
      * Don't want to ouput closing balances for dates before rundate     CGL017
      * would occur if backvalued postings entered today.                 CGL017
     C           VUDTE     ANDGTRNDT                                      CGL017
     C           CGL017    ANDEQ'Y'                                       CRE009
      *                                                                   CRE009
S5   C           VUDTA     ORGT WVUDT                                     CRE009
     C           WVUDT     ANDNE0                                         CRE009
     C           PDAT,5    ANDGEVUDTA                                     CRE009
     C           VUDTA     ANDGTRNDT                                      CRE009
     C           CGL017    ANDNE'Y'                                       CRE009
      *                                                                   CGL017
      * If account is retail then only todays postings are displayed      CGL017
      * so do not output closing balance record.                          CGL017
S6   C********   *IN14     IFNE *ON                                       CGL017 CRE009
      *                                                                   CGL017
      * If sub file page full do not write Closing Balance record now     CGL017
      * but after page is displayed.                                      CGL017
     C           COUNT     IFLT 12                                        CGL017
     C                     EXSR WRTSU3                                    CGL017
     C                     ELSE                                           CGL017
     C                     MOVE 'Y'       CLOBAL                          CGL017
     C                     ENDIF                                          CGL017
      *                                                                   CGL017
E6   C*********            ENDIF                                          CGL017 CRE009
      *                                                                   CGL017
E5   C                     ENDIF                                          CGL017
      *                                                                   CGL017
X4   C                     ELSE                                           CGL017
     C           KEYEQ     READERSACMTL1                 85
E4   C                     ENDIF                                          CGL017
     C/COPY WNCPYSRC,GL4443C017
E3   C                     END
E2   C                     END
     C*
     C* Cheque number selected
     C*
X1   C                     ELSE
S2   C           *IN14     IFEQ '1'
     C           KEYEQ     READERSACMTL2                 85
X2   C                     ELSE
S3   C           *IN85     DOUEQ'1'
     C           *IN34     OREQ '1'
     C                     MOVEA'0000'    *IN,31
     C           KEYEQ     READERSACMTL2                 85
E3   C                     END
E2   C                     END
E1   C                     END
     C*
     C* If record read and APOSTPDF format translate information
     C*
S1   C           *IN85     IFEQ '0'
     C           *IN14     ANDEQ'1'
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP28                                           S01408
     C*                                                                   S01408
     C*
     C* Record from APOST1 read
     C*
S2   C           *IN31     IFEQ '1'
     C*
S3   C           CGL017    IFEQ 'Y'                                       CGL017
     C                     MOVEL'CR'      TRYPE                           CGL017
     C                     Z-ADDPSTD      PTDTE                           CGL017
     C                     Z-ADDVALD      VUDTE                           CGL017
     C                     Z-ADDPSTA      MVAME                           CGL017
     C                     MOVELDRCR      DORCE                           CGL017
     C                     Z-ADD#CHQN     CQNRE                           CGL017
     C                     MOVELPNAR      STNMR                           CGL017
     C*                                                                   CGL017
     C**********           Z-ADDCNUM      CUSNE                                        CGL017 CSD027
     C                     MOVE CNUM      CUSNE                                               CSD027
     C                     MOVELCCY       CCYDE                           CGL017
     C                     Z-ADDACOD      ACDEE                           CGL017
     C                     Z-ADDACSQ      ASNCE                           CGL017
     C                     MOVE *BLANKS   NRTCE                           CGL017
     C                     MOVELPNAR      NRTDE                           CGL017
     C                     MOVEL*BLANKS   TNMRE                           CGL017
      *                                                                   CGL017
X3   C                     ELSE                                           CGL017
     C                     MOVEL'CR'      TRYPA
     C                     Z-ADDPSTD      PTDTA
     C                     Z-ADDVALD      VUDTA
     C                     Z-ADDPSTA      MVAMA
     C                     MOVELDRCR      DORCA
     C                     Z-ADD#CHQN     CQNRA
     C                     MOVELPNAR      STNMR
     C*
     C**********           Z-ADDCNUM      CUSNA                                               CSD027
     C                     MOVE CNUM      CUSNA                                               CSD027
     C                     MOVELCCY       CCYDA
     C                     Z-ADDACOD      ACDEA
     C                     Z-ADDACSQ      ASNCA
     C                     MOVE *BLANKS   NRTCA
     C************         Z-ADD0         NRTCA
     C                     MOVELPNAR      NRTDA
     C                     MOVEL*BLANKS   TNMRA
     C*
E3   C                     ENDIF                                          CGL017
E2   C                     END
     C*
     C* Record from APOST2 read
     C*
S2   C           *IN33     IFEQ '1'
     C*
     C                     MOVEL'CR'      TRYPB
     C                     Z-ADDPSTD      PTDTB
     C                     Z-ADDVALD      VUDTB
     C                     Z-ADDPSTA      MVAMB
     C                     MOVELDRCR      DORCB
     C                     Z-ADD#CHQN     CQNRB
     C                     MOVELPNAR      STNMR
     C*
     C**********           Z-ADDCNUM      CUSNB                                               CSD027
     C                     MOVE CNUM      CUSNB                                               CSD027
     C                     MOVELCCY       CCYDB
     C                     Z-ADDACOD      ACDEB
     C                     Z-ADDACSQ      ASNCB
     C                     MOVE *BLANKS   NRTCB                           080050
     C************         Z-ADD0         NRTCB                           080050
     C                     MOVELPNAR      NRTDB
     C                     MOVEL*BLANKS   TNMRB
     C*
E2   C                     END
E1   C                     END
     C*
     C                     ENDSR                           ** RSACMT **
     C*
     C*
      /TITLE         <<< SLCT13 SR. >>>
     C*****************************************************************
      *
      * SLCT13 - SUBROUTINE FOR SELECTING BETWEEN RECORDS FROM
      *          RSACMTL1 AND FFACMV3 BASED ON THE RECORD WITH
      *          THE LOWER KEY
      * NOTE - IF CGL017 IS SWITCHED ON RSACMTL5 REPLACES RSACMTL1        CGL017
      *
      * CALLED FROM: SUBROUTINE SCRN1, BSFIL1
      *
      * CALLS: NOTHING
      *
     C*****************************************************************
      *
     C           SLCT13    BEGSR
      *
      ** If NOT end of file on RSACMTL1 and NOT end of file on FFACMV3
      ** NOTE - IF CGL017 IS SWITCHED ON RSACMTL5 REPLACES RSACMTL1       CGL017
      *
     C           *IN85     IFEQ '0'
     C           *IN84     ANDEQ'0'
      *
      ** If key fields value date, movement amount and Dr/Cr indicator
      ** on RSACMTL1 are less or equal to same key fields on FFACMV3
      ** NOTE - IF CGL017 IS SWITCHED ON RSACMTL5 REPLACES RSACMTL1       CGL017
      *
     C           RSKY1     IFLE FFKY3
      *
     C                     MOVE 'R'       FILE    1
      *
     C           CGL017    IFEQ 'Y'
     C**********           Z-ADDCUSNE     CUSN                                         CGL017 CSD027
     C                     MOVE CUSNE     CUSN                                                CSD027
     C                     MOVE CCYDE     CCYD                            CGL017
     C                     Z-ADDACDEE     ACDE                            CGL017
     C                     Z-ADDASNCE     ASNC                            CGL017
     C                     Z-ADDPTDTE     PTDT                            CGL017
     C                     Z-ADDVUDTE     VUDT                            CGL017
     C                     MOVE TRYPE     TRYP                            CGL017
     C                     MOVE NRTCE     NRTC                            CGL017
     C**********           MOVE NRTDE     NRTD                                       CGL017 BUG12795
     C**********           MOVELNRTDE     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDE     NRTD                                             BUG12795A
     C                     MOVE TNMRE     TNMR                            CGL017
     C                     Z-ADDCQNRE     CQNR                            CGL017
     C                     Z-ADDMVAME     MVAM                            CGL017
     C                     Z-ADDDORCE     DORC                            CGL017
      *                                                                   CGL017
     C                     ELSE                                           CGL017
      *                                                                   CGL017
     C**********           Z-ADDCUSNA     CUSN                                                CSD027
     C                     MOVE CUSNA     CUSN                                                CSD027
     C                     MOVE CCYDA     CCYD
     C                     Z-ADDACDEA     ACDE
     C                     Z-ADDASNCA     ASNC
     C                     Z-ADDPTDTA     PTDT
     C                     Z-ADDVUDTA     VUDT
     C                     MOVE TRYPA     TRYP
     C                     MOVE NRTCA     NRTC                            080050
     C************         Z-ADDNRTCA     NRTC                            080050
     C**********           MOVE NRTDA     NRTD                                              BUG12795
     C**********           MOVELNRTDA     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDA     NRTD                                             BUG12795A
     C                     MOVE TNMRA     TNMR
     C                     Z-ADDCQNRA     CQNR
     C                     Z-ADDMVAMA     MVAM
     C                     Z-ADDDORCA     DORC
      *                                                                   CGL017
     C                     ENDIF                                          CGL017
     C*
     C** USE THE CORRECT REFERENCE
     C*
     C           *IN32     IFEQ '1'
     C           *IN34     OREQ '1'
     C                     MOVE *BLANKS   STNMR
     C           TRYP      IFEQ 'OP'
     C           FUND      ANDNE*BLANKS                                                       193984
     C           TRYP      OREQ 'RP'
     C           FUND      ANDNE*BLANKS                                   181780
     C           TRYP      OREQ 'IN'
     C           TRYP      OREQ 'CP'
     C           FUND      ANDNE*BLANKS                                   082738
     C           TRYP      OREQ 'CC'
     C           TRYP      OREQ 'NT'
     C           TRYP      OREQ 'RI'                                      CFT006
     C           TRYP      OREQ 'RO'                                      CFT006
     C           TRYP      OREQ 'BI'                                      CFT006
     C           TRYP      OREQ 'BO'                                      CFT006
     C/COPY WNCPYSRC,GL4443C033
     C**********           MOVE FUND      STNMR                                               CRE020
     C                     MOVELFUND      STNMR                                               CRE020
     C/COPY WNCPYSRC,GLH00677
     C                     ELSE                                           CGL045
      *
      ** Show Security Shortname when a 'PS'/'SE' Event if CGL045 is ON.  CGL045
     C           TRYP      IFEQ 'PS'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C           TRYP      OREQ 'SE'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C                     MOVELNRTD      STNMR                           CGL045
     C                     ELSE
     C                     MOVELTNMR      STNMR
     C           TNMR      IFEQ '000000'                                                      178438
     C                     MOVELNRTD      STNMR                                               178438
     C                     END                                                                178438
      *                                                                   CDL008
      ** Narrative description must be shown if CLS transaction           CDL008
      *                                                                   CDL008
     C                     MOVELNRTD      WNRTD                           CDL008
     C           WNRTD     IFEQ 'CLS PAY'                                 CDL008
     C           WNRTD     OREQ 'CLS RCV'                                 CDL008
     C                     MOVELNRTD      STNMR                           CDL008
     C                     ENDIF                                          CDL008
      **********                                                                  BUG12795 BUG12795A
     C********** TRYP      IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE NRTD      IPNRTD                                  BUG12795 BUG12795A
     C********** IPNRDS    IFEQ 'VALUE   '                                        BUG12795 BUG12795A
     C**********           MOVE INTERB    STNMR                                   BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C                     END
     C                     ENDIF                                          CGL045
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CIRE                                           S01408
     C*                                                                   S01408
     C                     END
      *
     C                     ELSE
      *
     C                     MOVE 'F'       FILE
      *
     C**********           Z-ADDCUSND     CUSN                                                CSD027
     C                     MOVE CUSND     CUSN                                                CSD027
     C                     MOVE CCYDD     CCYD
     C                     Z-ADDACDED     ACDE
     C                     Z-ADDASNCD     ASNC
     C                     Z-ADDPTDTD     PTDT
     C                     Z-ADDVUDTD     VUDT
     C                     MOVE TRYPD     TRYP
     C                     MOVE NRTCD     NRTC                            080050
     C************         Z-ADDNRTCD     NRTC                            080050
     C**********           MOVE NRTDD     NRTD                                              BUG12795
     C**********           MOVELNRTDD     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDD     NRTD                                             BUG12795A
     C                     MOVE TNMRD     TNMR
     C                     Z-ADDCQNRD     CQNR
     C                     Z-ADDMVAMD     MVAM
     C                     Z-ADDDORCD     DORC
     C*
     C** USE THE CORRECT REFERENCE
     C*
     C                     MOVE *BLANKS   STNMR
     C           TRYP      IFEQ 'OP'
     C           FUND      ANDNE*BLANKS                                                       193984
     C           TRYP      OREQ 'RP'
     C           FUND      ANDNE*BLANKS                                   181780
     C           TRYP      OREQ 'IN'
     C           TRYP      OREQ 'CP'
     C           FUND      ANDNE*BLANKS                                   082738
     C           TRYP      OREQ 'CC'
     C           TRYP      OREQ 'NT'
     C           TRYP      OREQ 'RI'                                      CFT006
     C           TRYP      OREQ 'RO'                                      CFT006
     C           TRYP      OREQ 'BI'                                      CFT006
     C           TRYP      OREQ 'BO'                                      CFT006
     C/COPY WNCPYSRC,GL4443C034
     C**********           MOVE FUND      STNMR                                               CRE020
     C                     MOVELFUND      STNMR                                               CRE020
     C/COPY WNCPYSRC,GLH00678
      *
      ** Show Security Shortname when a 'PS'/'SE' Event if CGL045 is ON.  CGL045
     C                     ELSE                                           CGL045
     C           TRYP      IFEQ 'PS'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C           TRYP      OREQ 'SE'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C                     MOVELNRTD      STNMR                           CGL045
     C                     ELSE
     C                     MOVELTNMR      STNMR
     C           TNMR      IFEQ '000000'                                                      178438
     C                     MOVELNRTD      STNMR                                               178438
     C                     END                                                                178438
      *                                                                   CDL008
      ** Narrative description must be shown if CLS transaction           CDL008
      *                                                                   CDL008
     C                     MOVELNRTD      WNRTD                           CDL008
     C           WNRTD     IFEQ 'CLS PAY'                                 CDL008
     C           WNRTD     OREQ 'CLS RCV'                                 CDL008
     C                     MOVELNRTD      STNMR                           CDL008
     C                     ENDIF                                          CDL008
      **********                                                                  BUG12795 BUG12795A
     C********** TRYP      IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE NRTD      IPNRTD                                  BUG12795 BUG12795A
     C********** IPNRDS    IFEQ 'VALUE   '                                        BUG12795 BUG12795A
     C**********           MOVE INTERB    STNMR                                   BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C                     END
     C                     ENDIF                                          CGL045
      *
     C/COPY WNCPYSRC,GL4443CIRE                                           S01408
     C*                                                                   S01408
     C                     END
     C                     END
      *
      ** If NOT end of file on RSACMTL1 BUT end of file on FFACMV3
      ** NOTE - IF CGL017 IS SWITCHED ON RSACMTL5 REPLACES RSACMTL1       CGL017
      *
     C           *IN85     IFEQ '0'
     C           *IN84     ANDEQ'1'
      *
     C                     MOVE 'R'       FILE
      *
     C           CGL017    IFEQ 'Y'                                       CGL017
     C**********           Z-ADDCUSNE     CUSN                                         CGL017 CSD027
     C                     MOVE CUSNE     CUSN                                                CSD027
     C                     MOVE CCYDE     CCYD                            CGL017
     C                     Z-ADDACDEE     ACDE                            CGL017
     C                     Z-ADDASNCE     ASNC                            CGL017
     C                     Z-ADDPTDTE     PTDT                            CGL017
     C                     Z-ADDVUDTE     VUDT                            CGL017
     C                     MOVE TRYPE     TRYP                            CGL017
     C                     MOVE NRTCE     NRTC                            CGL017
     C**********           MOVE NRTDE     NRTD                                       CGL017 BUG12795
     C**********           MOVELNRTDE     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDE     NRTD                                             BUG12795A
     C                     MOVE TNMRE     TNMR                            CGL017
     C                     Z-ADDCQNRE     CQNR                            CGL017
     C                     Z-ADDMVAME     MVAM                            CGL017
     C                     Z-ADDDORCE     DORC                            CGL017
      *                                                                   CGL017
     C                     ELSE                                           CGL017
      *                                                                   CGL017
     C**********           Z-ADDCUSNA     CUSN                                                CSD027
     C                     MOVE CUSNA     CUSN                                                CSD027
     C                     MOVE CCYDA     CCYD
     C                     Z-ADDACDEA     ACDE
     C                     Z-ADDASNCA     ASNC
     C                     Z-ADDPTDTA     PTDT
     C                     Z-ADDVUDTA     VUDT
     C                     MOVE TRYPA     TRYP
     C                     MOVE NRTCA     NRTC                            080050
     C************         Z-ADDNRTCA     NRTC                            080050
     C**********           MOVE NRTDA     NRTD                                              BUG12795
     C**********           MOVELNRTDA     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDA     NRTD                                             BUG12795A
     C                     MOVE TNMRA     TNMR
     C                     Z-ADDCQNRA     CQNR
     C                     Z-ADDMVAMA     MVAM
     C                     Z-ADDDORCA     DORC
     C                     ENDIF                                          CGL017
     C*
     C** USE THE CORRECT REFERENCE
     C*
     C           *IN32     IFEQ '1'
     C           *IN34     OREQ '1'
     C                     MOVE *BLANKS   STNMR
     C           TRYP      IFEQ 'OP'
     C           FUND      ANDNE*BLANKS                                                       193984
     C           TRYP      OREQ 'RP'
     C           FUND      ANDNE*BLANKS                                   181780
     C           TRYP      OREQ 'IN'
     C           TRYP      OREQ 'CP'
     C           FUND      ANDNE*BLANKS                                   082738
     C           TRYP      OREQ 'CC'
     C           TRYP      OREQ 'NT'
     C           TRYP      OREQ 'RI'                                      CFT006
     C           TRYP      OREQ 'RO'                                      CFT006
     C           TRYP      OREQ 'BI'                                      CFT006
     C           TRYP      OREQ 'BO'                                      CFT006
     C/COPY WNCPYSRC,GL4443C035
     C**********           MOVE FUND      STNMR                                               CRE020
     C                     MOVELFUND      STNMR                                               CRE020
     C/COPY WNCPYSRC,GLH00679
      *
      ** Show Security Shortname when a 'PS'/'SE' Event if CGL045 is ON.  CGL045
     C                     ELSE                                           CGL045
     C           TRYP      IFEQ 'PS'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C           TRYP      OREQ 'SE'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C                     MOVELNRTD      STNMR                           CGL045
     C                     ELSE
     C                     MOVELTNMR      STNMR
     C           TNMR      IFEQ '000000'                                                      178438
     C                     MOVELNRTD      STNMR                                               178438
     C                     END                                                                178438
      *                                                                   CDL008
      ** Narrative description must be shown if CLS transaction           CDL008
      *                                                                   CDL008
     C                     MOVELNRTD      WNRTD                           CDL008
     C           WNRTD     IFEQ 'CLS PAY'                                 CDL008
     C           WNRTD     OREQ 'CLS RCV'                                 CDL008
     C                     MOVELNRTD      STNMR                           CDL008
     C                     ENDIF                                          CDL008
      **********                                                                  BUG12795 BUG12795A
     C********** TRYP      IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE NRTD      IPNRTD                                  BUG12795 BUG12795A
     C********** IPNRDS    IFEQ 'VALUE   '                                        BUG12795 BUG12795A
     C**********           MOVE INTERB    STNMR                                   BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C                     END
     C                     END                                            S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CIRE                                           S01408
     C*                                                                   S01408
     C                     END
      *
     C                     END
      *
      ** If end of file on RSACMTL1 and NOT end of file on FFACMV3
      ** NOTE - IF CGL017 IS SWITCHED ON RSACMTL5 REPLACES RSACMTL1       CGL017
      *
     C           *IN85     IFEQ '1'
     C           *IN84     ANDEQ'0'
      *
     C                     MOVE 'F'       FILE
      *
     C**********           Z-ADDCUSND     CUSN                                                CSD027
     C                     MOVE CUSND     CUSN                                                CSD027
     C                     MOVE CCYDD     CCYD
     C                     Z-ADDACDED     ACDE
     C                     Z-ADDASNCD     ASNC
     C                     Z-ADDPTDTD     PTDT
     C                     Z-ADDVUDTD     VUDT
     C                     MOVE TRYPD     TRYP
     C                     MOVE NRTCD     NRTC                            080050
     C************         Z-ADDNRTCD     NRTC                            080050
     C**********           MOVE NRTDD     NRTD                                              BUG12795
     C**********           MOVELNRTDD     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDD     NRTD                                             BUG12795A
     C                     MOVE TNMRD     TNMR
     C                     Z-ADDCQNRD     CQNR
     C                     Z-ADDMVAMD     MVAM
     C                     Z-ADDDORCD     DORC
     C*
     C** USE THE CORRECT REFERENCE
     C*
     C                     MOVE *BLANKS   STNMR
     C           TRYP      IFEQ 'OP'
     C           FUND      ANDNE*BLANKS                                                       193984
     C           TRYP      OREQ 'RP'
     C           FUND      ANDNE*BLANKS                                   181780
     C           TRYP      OREQ 'IN'
     C           TRYP      OREQ 'CP'
     C           FUND      ANDNE*BLANKS                                   082738
     C           TRYP      OREQ 'CC'
     C           TRYP      OREQ 'NT'
     C           TRYP      OREQ 'RI'                                      CFT006
     C           TRYP      OREQ 'RO'                                      CFT006
     C           TRYP      OREQ 'BI'                                      CFT006
     C           TRYP      OREQ 'BO'                                      CFT006
     C/COPY WNCPYSRC,GL4443C036
     C**********           MOVE FUND      STNMR                                               CRE020
     C                     MOVELFUND      STNMR                                               CRE020
     C/COPY WNCPYSRC,GLH00680
      *
      ** Show Security Shortname when a 'PS'/'SE' Event if CGL045 is ON.  CGL045
     C                     ELSE                                           CGL045
     C           TRYP      IFEQ 'PS'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C           TRYP      OREQ 'SE'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C                     MOVELNRTD      STNMR                           CGL045
     C                     ELSE
     C                     MOVELTNMR      STNMR
     C           TNMR      IFEQ '000000'                                                      178438
     C                     MOVELNRTD      STNMR                                               178438
     C                     END                                                                178438
      *                                                                   CDL008
      ** Narrative description must be shown if CLS transaction           CDL008
      *                                                                   CDL008
     C                     MOVELNRTD      WNRTD                           CDL008
     C           WNRTD     IFEQ 'CLS PAY'                                 CDL008
     C           WNRTD     OREQ 'CLS RCV'                                 CDL008
     C                     MOVELNRTD      STNMR                           CDL008
     C                     ENDIF                                          CDL008
      **********                                                                  BUG12795 BUG12795A
     C********** TRYP      IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE NRTD      IPNRTD                                  BUG12795 BUG12795A
     C********** IPNRDS    IFEQ 'VALUE   '                                        BUG12795 BUG12795A
     C**********           MOVE INTERB    STNMR                                   BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C                     END
     C                     ENDIF                                          CGL045
      *
     C/COPY WNCPYSRC,GL4443CIRE                                           S01408
     C*                                                                   S01408
     C                     END
      *
      ** If end of file on RSACMTL1 AND end of file on FFACMV3
      ** NOTE - IF CGL017 IS SWITCHED ON RSACMTL5 REPLACES RSACMTL1       CGL017
      *
     C           *IN85     IFEQ '1'
     C           *IN84     ANDEQ'1'
     C                     MOVE '1'       *IN80
     C                     END
      *
     C                     ENDSR
      *
      /TITLE         <<< SLCT22 SR. >>>
     C*****************************************************************
      *
      * SLCT22 - SUBROUTINE FOR SELECTING BETWEEN RECORDS FROM
      *          RSACMTL2 AND FFACMV2 BASED ON THE RECORD WITH
      *          THE LOWER KEY
      *
      * CALLED FROM: SUBROUTINE SCRN1, BSFIL2
      *
      * CALLS: NOTHING
      *
     C*****************************************************************
      *
     C           SLCT22    BEGSR
      *
      ** If NOT end of file on RSACMTL2 and NOT end of file on FFACMV2
      *
     C           *IN85     IFEQ '0'
     C           *IN84     ANDEQ'0'
      *
      ** If the cheque number on RSACMTL2 is less than or equal to
      ** the cheque number on  FFACMV2
      *
     C           RSKY2     IFLE FFKY2
      *
     C                     MOVE 'R'       FILE    1
      *
     C**********           Z-ADDCUSNB     CUSN                                                CSD027
     C                     MOVE CUSNB     CUSN                                                CSD027
     C                     MOVE CCYDB     CCYD
     C                     Z-ADDACDEB     ACDE
     C                     Z-ADDASNCB     ASNC
     C                     Z-ADDPTDTB     PTDT
     C                     Z-ADDVUDTB     VUDT
     C                     MOVE TRYPB     TRYP
     C                     MOVE NRTCB     NRTC                            080050
     C************         Z-ADDNRTCB     NRTC                            080050
     C**********           MOVE NRTDB     NRTD                                              BUG12795
     C**********           MOVELNRTDB     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDB     NRTD                                             BUG12795A
     C                     MOVE TNMRB     TNMR
     C                     Z-ADDCQNRB     CQNR
     C                     Z-ADDMVAMB     MVAM
     C                     Z-ADDDORCB     DORC
     C*
     C** USE THE CORRECT REFERENCE
     C*
     C           *IN32     IFEQ '1'
     C           *IN34     OREQ '1'
     C                     MOVE *BLANKS   STNMR
     C           TRYP      IFEQ 'OP'
     C           FUND      ANDNE*BLANKS                                                       193984
     C           TRYP      OREQ 'RP'
     C           FUND      ANDNE*BLANKS                                   181780
     C           TRYP      OREQ 'IN'
     C           TRYP      OREQ 'CP'
     C           FUND      ANDNE*BLANKS                                   082738
     C           TRYP      OREQ 'CC'
     C           TRYP      OREQ 'NT'
     C           TRYP      OREQ 'RI'                                      CFT006
     C           TRYP      OREQ 'RO'                                      CFT006
     C           TRYP      OREQ 'BI'                                      CFT006
     C           TRYP      OREQ 'BO'                                      CFT006
     C/COPY WNCPYSRC,GL4443C037
     C**********           MOVE FUND      STNMR                                               CRE020
     C                     MOVELFUND      STNMR                                               CRE020
     C/COPY WNCPYSRC,GLH00681
      *
      ** Show Security Shortname when a 'PS'/'SE' Event if CGL045 is ON.  CGL045
     C                     ELSE                                           CGL045
     C           TRYP      IFEQ 'PS'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C           TRYP      OREQ 'SE'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C                     MOVELNRTD      STNMR                           CGL045
     C                     ELSE
     C                     MOVELTNMR      STNMR
     C           TNMR      IFEQ '000000'                                                      178438
     C                     MOVELNRTD      STNMR                                               178438
     C                     END                                                                178438
      *                                                                   CDL008
      ** Narrative description must be shown if CLS transaction           CDL008
      *                                                                   CDL008
     C                     MOVELNRTD      WNRTD                           CDL008
     C           WNRTD     IFEQ 'CLS PAY'                                 CDL008
     C           WNRTD     OREQ 'CLS RCV'                                 CDL008
     C                     MOVELNRTD      STNMR                           CDL008
     C                     ENDIF                                          CDL008
      **********                                                                  BUG12795 BUG12795A
     C********** TRYP      IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE NRTD      IPNRTD                                  BUG12795 BUG12795A
     C********** IPNRDS    IFEQ 'VALUE   '                                        BUG12795 BUG12795A
     C**********           MOVE INTERB    STNMR                                   BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C                     END
     C                     ENDIF                                          CGL045
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CIRE                                           S01408
     C*                                                                   S01408
     C                     END
      *
     C                     ELSE
      *
     C                     MOVE 'F'       FILE
      *
     C**********           Z-ADDCUSNC     CUSN                                                CSD027
     C                     MOVE CUSNC     CUSN                                                CSD027
     C                     MOVE CCYDC     CCYD
     C                     Z-ADDACDEC     ACDE
     C                     Z-ADDASNCC     ASNC
     C                     Z-ADDPTDTC     PTDT
     C                     Z-ADDVUDTC     VUDT
     C                     MOVE TRYPC     TRYP
     C                     MOVE NRTCC     NRTC                            080050
     C************         Z-ADDNRTCC     NRTC                            080050
     C**********           MOVE NRTDC     NRTD                                              BUG12795
     C**********           MOVELNRTDC     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDC     NRTD                                             BUG12795A
     C                     MOVE TNMRC     TNMR
     C                     Z-ADDCQNRC     CQNR
     C                     Z-ADDMVAMC     MVAM
     C                     Z-ADDDORCC     DORC
     C*
     C** USE THE CORRECT REFERENCE
     C*
     C                     MOVE *BLANKS   STNMR
     C           TRYP      IFEQ 'OP'
     C           FUND      ANDNE*BLANKS                                                       193984
     C           TRYP      OREQ 'RP'
     C           FUND      ANDNE*BLANKS                                   181780
     C           TRYP      OREQ 'IN'
     C           TRYP      OREQ 'CP'
     C           FUND      ANDNE*BLANKS                                   082738
     C           TRYP      OREQ 'CC'
     C           TRYP      OREQ 'NT'
     C           TRYP      OREQ 'RI'                                      CFT006
     C           TRYP      OREQ 'RO'                                      CFT006
     C           TRYP      OREQ 'BI'                                      CFT006
     C           TRYP      OREQ 'BO'                                      CFT006
     C/COPY WNCPYSRC,GL4443C038
     C**********           MOVE FUND      STNMR                                               CRE020
     C                     MOVELFUND      STNMR                                               CRE020
     C/COPY WNCPYSRC,GLH00682
      *
      ** Show Security Shortname when a 'PS'/'SE' Event if CGL045 is ON.  CGL045
     C                     ELSE                                           CGL045
     C           TRYP      IFEQ 'PS'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C           TRYP      OREQ 'SE'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C                     MOVELNRTD      STNMR                           CGL045
     C                     ELSE
     C                     MOVELTNMR      STNMR
     C           TNMR      IFEQ '000000'                                                      178438
     C                     MOVELNRTD      STNMR                                               178438
     C                     END                                                                178438
      *                                                                   CDL008
      ** Narrative description must be shown if CLS transaction           CDL008
      *                                                                   CDL008
     C                     MOVELNRTD      WNRTD                           CDL008
     C           WNRTD     IFEQ 'CLS PAY'                                 CDL008
     C           WNRTD     OREQ 'CLS RCV'                                 CDL008
     C                     MOVELNRTD      STNMR                           CDL008
     C                     ENDIF                                          CDL008
      **********                                                                  BUG12795 BUG12795A
     C********** TRYP      IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE NRTD      IPNRTD                                  BUG12795 BUG12795A
     C********** IPNRDS    IFEQ 'VALUE   '                                        BUG12795 BUG12795A
     C**********           MOVE INTERB    STNMR                                   BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C                     END
     C                     ENDIF                                          CGL045
      *
     C/COPY WNCPYSRC,GL4443CIRE                                           S01408
     C*                                                                   S01408
     C                     END
     C                     END
      *
      ** If NOT end of file on RSACMTL2 BUT end of file on FFACMV2
      *
     C           *IN85     IFEQ '0'
     C           *IN84     ANDEQ'1'
      *
     C                     MOVE 'R'       FILE
      *
     C**********           Z-ADDCUSNB     CUSN                                                CSD027
     C                     MOVE CUSNB     CUSN                                                CSD027
     C                     MOVE CCYDB     CCYD
     C                     Z-ADDACDEB     ACDE
     C                     Z-ADDASNCB     ASNC
     C                     Z-ADDPTDTB     PTDT
     C                     Z-ADDVUDTB     VUDT
     C                     MOVE TRYPB     TRYP
     C                     MOVE NRTCB     NRTC                            080050
     C************         Z-ADDNRTCB     NRTC                            080050
     C**********           MOVE NRTDB     NRTD                                              BUG12795
     C**********           MOVELNRTDB     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDB     NRTD                                             BUG12795A
     C                     MOVE TNMRB     TNMR
     C                     Z-ADDCQNRB     CQNR
     C                     Z-ADDMVAMB     MVAM
     C                     Z-ADDDORCB     DORC
     C*
     C** USE THE CORRECT REFERENCE
     C*
     C           *IN32     IFEQ '1'
     C           *IN34     OREQ '1'
     C                     MOVE *BLANKS   STNMR
     C           TRYP      IFEQ 'OP'
     C           FUND      ANDNE*BLANKS                                                       193984
     C           TRYP      OREQ 'RP'
     C           FUND      ANDNE*BLANKS                                   181780
     C           TRYP      OREQ 'IN'
     C           TRYP      OREQ 'CP'
     C           FUND      ANDNE*BLANKS                                   082738
     C           TRYP      OREQ 'CC'
     C           TRYP      OREQ 'NT'
     C           TRYP      OREQ 'RI'                                      CFT006
     C           TRYP      OREQ 'RO'                                      CFT006
     C           TRYP      OREQ 'BI'                                      CFT006
     C           TRYP      OREQ 'BO'                                      CFT006
     C/COPY WNCPYSRC,GL4443C039
     C**********           MOVE FUND      STNMR                                               CRE020
     C                     MOVELFUND      STNMR                                               CRE020
     C/COPY WNCPYSRC,GLH00683
      *
      ** Show Security Shortname when a 'PS'/'SE' Event if CGL045 is ON.  CGL045
     C                     ELSE                                           CGL045
     C           TRYP      IFEQ 'PS'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C           TRYP      OREQ 'SE'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C                     MOVELNRTD      STNMR                           CGL045
     C                     ELSE
     C                     MOVELTNMR      STNMR
     C           TNMR      IFEQ '000000'                                                      178438
     C                     MOVELNRTD      STNMR                                               178438
     C                     END                                                                178438
      *                                                                   CDL008
      ** Narrative description must be shown if CLS transaction           CDL008
      *                                                                   CDL008
     C                     MOVELNRTD      WNRTD                           CDL008
     C           WNRTD     IFEQ 'CLS PAY'                                 CDL008
     C           WNRTD     OREQ 'CLS RCV'                                 CDL008
     C                     MOVELNRTD      STNMR                           CDL008
     C                     ENDIF                                          CDL008
      **********                                                                  BUG12795 BUG12795A
     C********** TRYP      IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE NRTD      IPNRTD                                  BUG12795 BUG12795A
     C********** IPNRDS    IFEQ 'VALUE   '                                        BUG12795 BUG12795A
     C**********           MOVE INTERB    STNMR                                   BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C                     END
     C                     ENDIF                                          CGL045
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CIRE                                           S01408
     C*                                                                   S01408
     C                     END
      *
     C                     END
      *
      ** If end of file on RSACMTL2 and NOT end of file on FFACMV2
      *
     C           *IN85     IFEQ '1'
     C           *IN84     ANDEQ'0'
      *
     C                     MOVE 'F'       FILE
      *
     C**********           Z-ADDCUSNC     CUSN                                                CSD027
     C                     MOVE CUSNC     CUSN                                                CSD027
     C                     MOVE CCYDC     CCYD
     C                     Z-ADDACDEC     ACDE
     C                     Z-ADDASNCC     ASNC
     C                     Z-ADDPTDTC     PTDT
     C                     Z-ADDVUDTC     VUDT
     C                     MOVE TRYPC     TRYP
     C                     MOVE NRTCC     NRTC                            080050
     C************         Z-ADDNRTCC     NRTC                            080050
     C**********           MOVE NRTDC     NRTD                                              BUG12795
     C**********           MOVELNRTDC     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDC     NRTD                                             BUG12795A
     C                     MOVE TNMRC     TNMR
     C                     Z-ADDCQNRC     CQNR
     C                     Z-ADDMVAMC     MVAM
     C                     Z-ADDDORCC     DORC
     C*
     C** USE THE CORRECT REFERENCE
     C*
     C                     MOVE *BLANKS   STNMR
     C           TRYP      IFEQ 'OP'
     C           FUND      ANDNE*BLANKS                                                       193984
     C           TRYP      OREQ 'RP'
     C           FUND      ANDNE*BLANKS                                   181780
     C           TRYP      OREQ 'IN'
     C           TRYP      OREQ 'CP'
     C           FUND      ANDNE*BLANKS                                   082738
     C           TRYP      OREQ 'CC'
     C           TRYP      OREQ 'NT'
     C           TRYP      OREQ 'RI'                                      CFT006
     C           TRYP      OREQ 'RO'                                      CFT006
     C           TRYP      OREQ 'BI'                                      CFT006
     C           TRYP      OREQ 'BO'                                      CFT006
     C/COPY WNCPYSRC,GL4443C040
     C**********           MOVE FUND      STNMR                                               CRE020
     C                     MOVELFUND      STNMR                                               CRE020
     C/COPY WNCPYSRC,GLH00684
      *
      ** Show Security Shortname when a 'PS'/'SE' Event if CGL045 is ON.  CGL045
     C                     ELSE                                           CGL045
     C           TRYP      IFEQ 'PS'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C           TRYP      OREQ 'SE'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C                     MOVELNRTD      STNMR                           CGL045
     C                     ELSE
     C                     MOVELTNMR      STNMR
     C           TNMR      IFEQ '000000'                                                      178438
     C                     MOVELNRTD      STNMR                                               178438
     C                     END                                                                178438
      *                                                                   CDL008
      ** Narrative description must be shown if CLS transaction           CDL008
      *                                                                   CDL008
     C                     MOVELNRTD      WNRTD                           CDL008
     C           WNRTD     IFEQ 'CLS PAY'                                 CDL008
     C           WNRTD     OREQ 'CLS RCV'                                 CDL008
     C                     MOVELNRTD      STNMR                           CDL008
     C                     ENDIF                                          CDL008
      **********                                                                  BUG12795 BUG12795A
     C********** TRYP      IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE NRTD      IPNRTD                                  BUG12795 BUG12795A
     C********** IPNRDS    IFEQ 'VALUE   '                                        BUG12795 BUG12795A
     C**********           MOVE INTERB    STNMR                                   BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C                     END
     C                     ENDIF                                          CGL045
      *
     C/COPY WNCPYSRC,GL4443CIRE                                           S01408
     C*                                                                   S01408
     C                     END
      *
      ** If end of file on RSACMTL2 AND end of file on FFACMV2
      *
     C           *IN85     IFEQ '1'
     C           *IN84     ANDEQ'1'
     C                     MOVE '1'       *IN80
     C                     END
      *
     C                     ENDSR
      *
      /TITLE         <<< BSFIL1 SR. >>>
     C*****************************************************************
     C*
     C**BSFIL1*---*BUILD*SUBFILE*WITH*RECORDS*FROM*RSACMTL1
     C* BSFIL1 --- BUILD SUBFILE WITH RECORDS FROM RSACMTL1/FFACMV3
     C* NOTE - IF CGL017 IS SWITCHED ON RSACMTL5 REPLACES RSACMTL1        CGL017
     C*
     C* 1. SETLL ACCORDING TO WHETHER + OR -, AND WHETHER START
     C*    FROM FIRST RECORD (IN20) REQUESTED OR NOT
     C* 2. BUILD SUBFILE PAGE
     C* 3. SET-UP OUTPUT SCREEN DETAILS
     C*
     C* CALLED FROM: ENTR, ROLP
     C*
     C**CALLS:*NOTHING**
     C* CALLS: SLCT13
     C*
     C*****************************************************************
     C*
     C           BSFIL1    BEGSR                           ** BSFIL1 **
     C*
     C*
     C                     Z-ADDRRN       DSPREC
      * If the first time through program and CGL017 is ON                CGL017
      * OR CRE009 is ON                                                   CRE009
      * then z-add 1 to COUNT as an opening balance rec                   CGL017
      * has been written. Otherwise z-add 0.                              CGL017
     C           CGL017    IFEQ 'Y'                                       CGL017
     C           FIRST     ANDEQ'Y'                                       CRE009
     C           CRE009    OREQ 'Y'                                       CRE009
     C           FIRST     ANDEQ'Y'                                       CGL017
     C                     Z-ADD1         COUNT                           CGL017
     C                     MOVE 'N'       FIRST                           CGL017
     C                     ELSE                                           CGL017
     C                     Z-ADD0         COUNT   30
     C                     ENDIF                                          CGL017
     C*
     C********** COUNT     DOWLT12                                                          MD025643
     C           COUNT     DOWLT11                                                          MD025643
     C           *IN80     ANDEQ'0'
     C                     SETOF                     81
     C*
     C           AMTNUM    IFGT 0
     C** Post amount less or equal to selected amount                     163504
     C           PORM      IFEQ '-'
     C           MVAM      IFLE AMTNUM
     C                     SETOF                     81
     C                     ELSE
     C                     SETON                     81
     C                     END
     C                     ELSE
     C** Post amount greater or equal to selected amount                  163504
     C           PORM      IFEQ '+'                                       163504
     C           MVAM      IFGE AMTNUM
     C                     SETOF                     81
     C                     ELSE
     C                     SETON                     81
     C                     END
     C** Post amount equal to selected amount                             163504
     C                     ELSE                                           163504
     C           MVAM      IFEQ AMTNUM                                    163504
     C                     SETOF                     81                   163504
     C                     ELSE                                           163504
     C                     SETON                     81                   163504
     C                     END                                            163504
     C                     END                                            163504
     C*
     C                     END
     C                     END
     C*
     C*  CHECK THAT THE POSTING AND VALUE DATES ARE OK BEFORE
     C*    WRITING A RECORD TO THE SUBFILE
     C*
     C                     EXSR DATEOK
      ** Display projected postings regardless of Value Date filtered                     AR1095995A
     C           *IN14     IFEQ '1'                                                       AR1095995A
     C           VALDN     ANDNE0                                                         AR1095995A
     C           VALDN     ANDGTVUDT                                                      AR1095995A
     C           PTDT      ANDNERNDT                                                      AR1095995A
     C                     SETON                     81                                   AR1095995A
     C                     ENDIF                                                          AR1095995A
      *                                                                                   AR1095995A
     C/COPY WNCPYSRC,GL4443C044
     C*
     C           *IN81     IFEQ '0'
     C                     EXSR WRTSUB
     C                     ADD  1         COUNT
     C                     END
     C*
     C           FFFL      IFEQ 'Y'
     C*
     C           *IN80     IFEQ '1'
     C                     Z-ADD3         DBASE            ***************
     C/COPY WNCPYSRC,GL4443C018
     C                     MOVE 'FFACMV3' DBFILE           * DB ERROR 03 *
     C/COPY WNCPYSRC,GL4443C019
     C                     MOVEL'EOF'     DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
      *
      ** Read a record from the the account movement file from which
      ** the last movement record processed came.
      ** Then process the record from either account movement file
      ** with the lower value date, amount and dr/cr indicator.
      *
     C           FILE      IFEQ 'R'
     C                     EXSR RSACM2
     C                     ELSE
     C/COPY WNCPYSRC,GL4443C020
     C           KEYEQ     READEFFACMV3                  84
     C/COPY WNCPYSRC,GL4443C021
     C                     END
     C                     EXSR SLCT13
      *
     C                     ELSE
     C                     EXSR RSACMT
      *
     C           *IN80     IFEQ '0'
      *                                                                                       238578
      ** Initialise with field values from RSACMTL5                                           238578
      *                                                                                       238578
     C           CGL017    IFEQ 'Y'                                                           238578
     C**********           Z-ADDCUSNE     CUSN                                        238578 CSD027A
     C                     MOVE CUSNE     CUSN                                               CSD027A
     C                     MOVE CCYDE     CCYD                                                238578
     C                     Z-ADDACDEE     ACDE                                                238578
     C                     Z-ADDASNCE     ASNC                                                238578
     C                     Z-ADDPTDTE     PTDT                                                238578
     C                     Z-ADDVUDTE     VUDT                                                238578
     C                     MOVE TRYPE     TRYP                                                238578
     C                     MOVE NRTCE     NRTC                                                238578
     C**********           MOVE NRTDE     NRTD                                       238578 BUG12795
     C**********           MOVELNRTDE     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDE     NRTD                                             BUG12795A
     C                     MOVE TNMRE     TNMR                                                238578
     C                     Z-ADDCQNRE     CQNR                                                238578
     C                     Z-ADDMVAME     MVAM                                                238578
     C                     Z-ADDDORCE     DORC                                                238578
      *                                                                                       238578
     C                     ELSE                                                               238578
      *                                                                                       238578
      ** CGL017 is OFF, use field values from RSACMTL1                                        238578
      *                                                                                       238578
     C**********           Z-ADDCUSNA     CUSN                                                CSD027
     C                     MOVE CUSNA     CUSN                                                CSD027
     C                     MOVE CCYDA     CCYD
     C                     Z-ADDACDEA     ACDE
     C                     Z-ADDASNCA     ASNC
     C                     Z-ADDPTDTA     PTDT
     C                     Z-ADDVUDTA     VUDT
     C                     MOVE TRYPA     TRYP
     C                     MOVE NRTCA     NRTC                            080050
     C************         Z-ADDNRTCA     NRTC                            080050
     C**********           MOVE NRTDA     NRTD                                              BUG12795
     C**********           MOVELNRTDA     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDA     NRTD                                             BUG12795A
     C                     MOVE TNMRA     TNMR
     C                     Z-ADDCQNRA     CQNR
     C                     Z-ADDMVAMA     MVAM
     C                     Z-ADDDORCA     DORC
     C                     ENDIF                                                              238578
     C*
     C** USE THE CORRECT REFERENCE
     C*
     C           *IN32     IFEQ '1'
     C           *IN34     OREQ '1'
     C                     MOVE *BLANKS   STNMR
     C           TRYP      IFEQ 'OP'
     C           FUND      ANDNE*BLANKS                                                       193984
     C           TRYP      OREQ 'RP'
     C           FUND      ANDNE*BLANKS                                   181780
     C           TRYP      OREQ 'IN'
     C           TRYP      OREQ 'CP'
     C           FUND      ANDNE*BLANKS                                   082738
     C           TRYP      OREQ 'CC'
     C           TRYP      OREQ 'NT'
     C           TRYP      OREQ 'RI'                                      CFT006
     C           TRYP      OREQ 'RO'                                      CFT006
     C           TRYP      OREQ 'BI'                                      CFT006
     C           TRYP      OREQ 'BO'                                      CFT006
     C/COPY WNCPYSRC,GL4443C028
     C**********           MOVE FUND      STNMR                                               CRE020
     C                     MOVELFUND      STNMR                                               CRE020
     C/COPY WNCPYSRC,GLH00685
      *
      ** Show Security Shortname when a 'PS'/'SE' Event if CGL045 is ON.  CGL045
     C                     ELSE                                           CGL045
     C           TRYP      IFEQ 'PS'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C           TRYP      OREQ 'SE'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C                     MOVELNRTD      STNMR                           CGL045
     C                     ELSE
     C                     MOVELTNMR      STNMR
     C           TNMR      IFEQ '000000'                                                      178438
     C                     MOVELNRTD      STNMR                                               178438
     C                     END                                                                178438
      *                                                                   CDL008
      ** Narrative description must be shown if CLS transaction           CDL008
      *                                                                   CDL008
     C                     MOVELNRTD      WNRTD                           CDL008
     C           WNRTD     IFEQ 'CLS PAY'                                 CDL008
     C           WNRTD     OREQ 'CLS RCV'                                 CDL008
     C                     MOVELNRTD      STNMR                           CDL008
     C                     ENDIF                                          CDL008
      **********                                                                  BUG12795 BUG12795A
     C********** TRYP      IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE NRTD      IPNRTD                                  BUG12795 BUG12795A
     C********** IPNRDS    IFEQ 'VALUE   '                                        BUG12795 BUG12795A
     C**********           MOVE INTERB    STNMR                                   BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C                     END
     C                     ENDIF                                          CGL045
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CIRE                                           S01408
     C*                                                                   S01408
     C                     END
     C                     END
      *
     C                     END
      *
     C                     END
      *
     C           *IN80     IFEQ '1'
     C                     SETON                     04
      *                                                                   CGL017
      * All records output to subfile so output final Projected Closing   CGL017
      * Balance record                                                    CGL017
     C********   CGL017    IFEQ 'Y'                                       CGL017 CRE009
     C                     EXSR WRTSU3                                    CGL017
     C********             ENDIF                                          CGL017 CRE009
     C                     END
     C*
     C                     ENDSR                           ** BSFIL1 **
     C*
      /TITLE         <<< BSFIL2 SR. >>>
     C*****************************************************************
     C*
     C* BSFIL2 --- BUILD SUBFILE WITH RECORDS FROM RSACMTL2/ FFACMV2
     C*
     C* 1. SETLL
     C* 2. BUILD SUBFILE PAGE
     C* 3. SET-UP OUTPUT SCREEN DETAILS
     C*
     C* CALLED FROM: ENTR, ROLP
     C*
     C* CALLS: SLCT22
     C*
     C*****************************************************************
     C*
     C           BSFIL2    BEGSR                           ** BSFIL2 **
     C*
     C                     Z-ADDRRN       DSPREC
      * If the first time through program and CGL017 is ON                CGL017
      * then z-add 1 to COUNT as an opening balance rec                   CGL017
      * has been written. Otherwise z-add 0.                              CGL017
     C           CGL017    IFEQ 'Y'                                       CGL017
     C           FIRST     ANDEQ'Y'                                       CGL017
     C           CRE009    OREQ 'Y'                                       CRE009
     C           FIRST     ANDEQ'Y'                                       CRE009
     C                     Z-ADD1         COUNT                           CGL017
     C                     MOVE 'N'       FIRST                           CGL017
     C                     ELSE                                           CGL017
     C                     Z-ADD0         COUNT   30
     C                     ENDIF                                          CGL017
     C*
     C********** COUNT     DOWLT12                                                          MD025643
     C           COUNT     DOWLT11                                                          MD025643
     C           *IN80     ANDEQ'0'
     C                     SETOF                     81
     C*
     C           CQNR      IFGE CQKEY
     C                     SETOF                     81
     C                     ELSE
     C                     SETON                     81
     C                     END
     C*
     C*  CHECK THAT THE POSTING AND VALUE DATES ARE OK BEFORE
     C*    WRITING A RECORD TO THE SUBFILE
     C*
     C                     EXSR DATEOK
     C/COPY WNCPYSRC,GL4443C045
     C*
     C           *IN81     IFEQ '0'
     C                     EXSR WRTSUB
     C                     ADD  1         COUNT
     C                     END
     C*
     C           FFFL      IFEQ 'Y'
     C*
     C           *IN80     IFEQ '1'
     C                     Z-ADD4         DBASE            ***************
     C                     MOVE 'FFACMV2' DBFILE           * DB ERROR 04 *
     C                     MOVEL'EOF'     DBKEY            ***************
     C                     EXSR *PSSR
     C                     END
      *
      ** Read a record from the the account movement file from which
      ** the last movement record processed came.
      ** Then process the record from either account movement file
      ** with the lower cheque number.
      *
     C           FILE      IFEQ 'R'
     C                     EXSR RSACM2
     C                     ELSE
     C           KEYEQ     READEFFACMV2                  84
     C                     END
     C                     EXSR SLCT22
      *
     C                     ELSE
     C                     EXSR RSACMT
      *
     C           *IN80     IFEQ '0'
      *                                                                                      247691A
     C           CGL017    IFNE 'Y'                                                          247691A
     C**********           Z-ADDCUSNB     CUSN                                                CSD027
     C                     MOVE CUSNB     CUSN                                                CSD027
     C                     MOVE CCYDB     CCYD
     C                     Z-ADDACDEB     ACDE
     C                     Z-ADDASNCB     ASNC
     C                     Z-ADDPTDTB     PTDT
     C                     Z-ADDVUDTB     VUDT
     C                     MOVE TRYPB     TRYP
     C                     MOVE NRTCB     NRTC                            080050
     C************         Z-ADDNRTCB     NRTC                            080050
     C**********           MOVE NRTDB     NRTD                                              BUG12795
     C**********           MOVELNRTDB     NRTD      P                             BUG12795 BUG12795A
     C                     MOVE NRTDB     NRTD                                             BUG12795A
     C                     MOVE TNMRB     TNMR
     C                     Z-ADDCQNRB     CQNR
     C                     Z-ADDMVAMB     MVAM
     C                     Z-ADDDORCB     DORC
     C                     ELSE                                                              247691A
     C                     MOVE CUSNE     CUSN                                               247691A
     C                     MOVE CCYDE     CCYD                                               247691A
     C                     Z-ADDACDEE     ACDE                                               247691A
     C                     Z-ADDASNCE     ASNC                                               247691A
     C                     Z-ADDPTDTE     PTDT                                               247691A
     C                     Z-ADDVUDTE     VUDT                                               247691A
     C                     MOVE TRYPE     TRYP                                               247691A
     C                     MOVE NRTCE     NRTC                                               247691A
     C                     MOVE NRTDE     NRTD                                               247691A
     C                     MOVE TNMRE     TNMR                                               247691A
     C                     Z-ADDCQNRE     CQNR                                               247691A
     C                     Z-ADDMVAME     MVAM                                               247691A
     C                     Z-ADDDORCE     DORC                                               247691A
     C                     END                                                               247691A
     C*
     C** USE THE CORRECT REFERENCE
     C*
     C           *IN32     IFEQ '1'
     C           *IN34     OREQ '1'
     C                     MOVE *BLANKS   STNMR
     C           TRYP      IFEQ 'OP'
     C           FUND      ANDNE*BLANKS                                                       193984
     C           TRYP      OREQ 'RP'
     C           FUND      ANDNE*BLANKS                                   181780
     C           TRYP      OREQ 'IN'
     C           TRYP      OREQ 'CP'
     C           FUND      ANDNE*BLANKS                                   082738
     C           TRYP      OREQ 'CC'
     C           TRYP      OREQ 'NT'
     C           TRYP      OREQ 'RI'                                      CFT006
     C           TRYP      OREQ 'RO'                                      CFT006
     C           TRYP      OREQ 'BI'                                      CFT006
     C           TRYP      OREQ 'BO'                                      CFT006
     C/COPY WNCPYSRC,GL4443C029
     C**********           MOVE FUND      STNMR                                               CRE020
     C                     MOVELFUND      STNMR                                               CRE020
     C/COPY WNCPYSRC,GLH00686
      *
      ** Show Security Shortname when a 'PS'/'SE' Event if CGL045 is ON.  CGL045
     C                     ELSE                                           CGL045
     C           TRYP      IFEQ 'PS'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C           TRYP      OREQ 'SE'                                      CGL045
     C           CGL045    ANDEQ'Y'                                       CGL045
     C                     MOVELNRTD      STNMR                           CGL045
     C                     ELSE
     C                     MOVELTNMR      STNMR
     C           TNMR      IFEQ '000000'                                                      178438
     C                     MOVELNRTD      STNMR                                               178438
     C                     END                                                                178438
      *                                                                   CDL008
      ** Narrative description must be shown if CLS transaction           CDL008
      *                                                                   CDL008
     C                     MOVELNRTD      WNRTD                           CDL008
     C           WNRTD     IFEQ 'CLS PAY'                                 CDL008
     C           WNRTD     OREQ 'CLS RCV'                                 CDL008
     C                     MOVELNRTD      STNMR                           CDL008
     C                     ENDIF                                          CDL008
      **********                                                                  BUG12795 BUG12795A
     C********** TRYP      IFEQ 'IP'                                              BUG12795 BUG12795A
     C**********           MOVE NRTD      IPNRTD                                  BUG12795 BUG12795A
     C********** IPNRDS    IFEQ 'VALUE   '                                        BUG12795 BUG12795A
     C**********           MOVE INTERB    STNMR                                   BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C**********           ENDIF                                                  BUG12795 BUG12795A
     C                     END
     C                     ENDIF                                          CGL045
     C*                                                                   S01408
     C* Note: Hook GL4443CCP1 appears elsewhere in this program!          S01408
     C/COPY WNCPYSRC,GL4443CCP1                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443C022                                           S01408
     C*                                                                   S01408
     C                     END
     C                     END
      *
     C                     END
      *
     C*
     C                     END
      *
     C           *IN80     IFEQ '1'
     C                     SETON                     04
     C                     END
     C*
     C                     ENDSR                           ** BSFIL2 **
     C*
      /TITLE         <<< DATEOK SR. >>>
     C*****************************************************************
     C*
     C* DATEOK --- CHECK THAT THE POSTING DATE AND VALUE DATES
     C*              SATISFY THE FOLLOWING RULES BEFORE WRITING
     C*              TO THE SUBFILE
     C*
     C*  1. RETAIL ACCOUNT
     C*      Value date  <= Run date
     C*      NOTE: If CRE009 is ON ->  Value date <= Date in REPMFWPD for ccy              CRE009
     C*  2. NOSTRO ACCOUNT
     C*      (POSTING DATE >= RUN DATE) AND (POSTING DATE <= 4TH N.W.D)
     C*  3. VALUE DATE <= POSTING DATE
     C*
     C* CALLED FROM: BSFIL1 BSFIL2
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           DATEOK    BEGSR                           ** DATEOK **
     C*
     C           *IN14     IFEQ '1'
      *
      ** If CRE009 is ON, display postings up to the value in REPMFWPD for the a/c ccy     CRE009
      *                                                                                    CRE009
     C********   VUDT      IFGT RNDT                                                       CRE009
     C           CRE009    IFEQ 'Y'                                                        CRE009
     C           VUDT      ANDGTNXTD                                                       CRE009
     C           CRE009    OREQ 'N'                                                        CRE009
     C           VUDT      ANDGTRNDT                                                       CRE009
     C                     SETON                     81
     C                     END
     C*
     C                     ELSE
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP29                                           S01408
     C*                                                                   S01408
     C*
     C***********PTDT      IFLT RNDT                                      177290
     C/COPY WNCPYSRC,GL4443C030
     C***********VUDT      ORGT PDAT,5                                    177290
     C           VUDT      IFGT PDAT,5                                    177290
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP30                                           S01408
     C*                                                                   S01408
     C                     SETON                     81
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR                           ** DATEOK **
     C*
      /TITLE         <<< STORE SR. >>>
     C*****************************************************************
     C*
     C* STORE --- STORE I/P FIELDS IN 'SAVE' FIELDS
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           STORE     BEGSR                           ** STORE **
     C*
     C           MBIN      IFEQ 'Y'
     C**********           MOVE MBACNT    MBACSV 22                                           CGL029
     C                     MOVE MBACNT    MBACSV 28                                           CGL029
     C                     ELSE
     C**********           MOVE ACNT      ACSV   19                                           CGL029
     C                     MOVE ACNT      ACSV   25                                           CGL029
     C                     END
     C*
     C                     MOVE VALDA     PDSV    6
     C                     MOVE PORM      POSV    1
     C                     MOVE AMONT     AMSV   14
     C                     MOVE CQNMR     CHSV    8
     C*
     C                     ENDSR                           ** STORE **
     C*
      /TITLE         <<< RSTOR SR. >>>
     C*****************************************************************
     C*
     C* RSTOR --- RESTORE I/P FIELDS FROM 'SAVE' FIELDS
     C*
     C           RSTOR     BEGSR                           ** RSTOR **
     C*
     C           MBIN      IFEQ 'Y'
     C**********           MOVE MBACSV    MBACNT 22                                           CGL029
     C                     MOVE MBACSV    MBACNT                                              CGL029
     C                     ELSE
     C                     MOVE ACSV      ACNT
     C                     END
     C*
     C                     MOVE PDSV      VALDA
     C                     MOVE POSV      PORM
     C                     MOVE AMSV      AMONT
     C                     MOVE CHSV      CQNMR
     C*
     C                     ENDSR                           ** RSTOR **
     C*
      /TITLE         <<< WRTSUB SR. >>>
     C*****************************************************************
     C*
     C* WRTSUB --- WRITE RECORD TO SUBFILE
     C*
     C* 1. FORMATS OUTPUT FIELDS VIA STANDARD SUBROUTINES
     C* 2. WRITES RECORD TO SUBFILE
     C*
     C* CALLED FROM: BSFIL1, BSFIL2
     C*
     C* CALLS: ZDATE2, ZFRPED (STANDARD S/RS)
     C*
     C*****************************************************************
     C*
     C           WRTSUB    BEGSR                           ** WRTSUB **
     C*                                                                   CGL017
      * If The sub file page has just been displayed and a                CGL017
      * Closing Balance record is needing written do it now.              CGL017
     C           CLOBAL    IFEQ 'Y'                                       CGL017
     C                     EXSR WRTSU3                                    CGL017
     C                     ENDIF                                          CGL017
      *                                                                   CGL017
     C                     Z-ADDVUDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    VALDZ
     C*
     C           DORC      IFEQ 1
     C           MVAM      MULT -1        MVAM
     C                     END
     C                     Z-ADDMVAM      ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    PSTAZ
     C*
     C                     MOVELCQNR      @CQNR   8
     C           @CQNR     IFNE '00000000'
     C                     MOVEL@CQNR     CHQN
     C                     ELSE
     C                     MOVE *BLANKS   CHQN
     C                     END
     C*
     C/COPY WNCPYSRC,GL4443C042
     C           *IN82     IFEQ '1'
     C                     MOVE *BLANKS   ABTCH2  2
     C                     MOVELSPOS      ABTCH
     C*
     C**   If posting is not batch posting, the first two characters
     C**    from the source of posting will be blank, otherwise
     C**      the first 3 characters are the batch number
     C*
     C           ABTCH2    IFEQ *BLANKS
     C                     MOVE *BLANKS   ABTCH   3
     C                     END
     C           TRYP      IFEQ 'RP'                                      120762
     C                     MOVELTNMR      STNMR                           120762
     C                     ENDIF                                          120762
      *                                                                                     MD025657
     C           TRYP      IFEQ 'ZT'                                                        MD025657
     C           CAP204    ANDEQ'Y'                                                         MD025657
     C                     MOVELOTR1      STNMR                                             MD025657
     C                     ENDIF                                                            MD025657
      *                                                                                     MD025657
     C                     MOVE SFLD31    SFLDS3
     C                     ELSE
     C********** TRYP      IFEQ 'ZT'                                                 CAP204 MD025657
     C********** CAP204    ANDEQ'Y'                                                  CAP204 MD025657
     C**********           MOVELOTR1      STNMR                                      CAP204 MD025657
     C**********           ENDIF                                                     CAP204 MD025657
     C           TRYP      IFEQ 'ZT'                                                        MD032180
     C           CAP204    ANDEQ'Y'                                                         MD032180
     C                     MOVELOTR1      STNMR                                             MD032180
     C                     ENDIF                                                            MD032180
     C                     MOVE VALDZ     VALDZ2
     C                     MOVE CHQN      CHQN2
     C                     MOVE TRYP      TRYP2
     C                     MOVE STNMR     STNMR2
     C                     MOVE PSTAZ     PSTAZ2
     C                     MOVE SFLD32    SFLDS3
     C                     END
     C*
     C* Note: Hook GL4443CCP1 appears elsewhere in this program!          S01408
     C/COPY WNCPYSRC,GL4443CCP1                                           S01408
     C*                                                                   S01408
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443C023                                           S01408
     C                     MOVELTNMR      UFBTNB                                            BUG26687
     C                     MOVE TNMR      UFBINB                                            BUG26687
     C                     Z-ADDPTDT      UFPTDT                                            BUG26687
     C                     MOVE TRYP      UFTRYP                                            BUG26687
     C           CGL013    IFEQ 'N'                                                         BUG26687
     C           CER030    ANDEQ'N'                                                         BUG26687
     C                     SETON                     88                                     BUG26687
     C                     ENDIF                                                            BUG26687
     C*                                                                   S01408
     C                     MOVELTNMR      KSPOS     P                                      AR792734A
     C           KEYL12    CHAINAPOST12              17                                    AR792734A
     C                     WRITESFLRCD
     C   17                MOVEL*BLANKS   SPOS                                              MD025643
      *                                                                   CGL017
      * Maintain Future Projected Balance by adding posting value         CGL017
      * of Sub-file records onto Opening Projected Balance.               CGL017
      * First reverse the coding from above (multiplying amount by -1)    CGL017
     C           DORC      IFEQ 1                                         CGL017
     C           MVAM      MULT -1        MVAM                            CGL017
     C                     END                                            CGL017
      *                                                                   CGL017
     C           DORC      IFEQ 0                                         CGL017
     C           PRCLB     ADD  MVAM      PRCLB                           CGL017
     C                     ELSE                                           CGL017
     C           PRCLB     SUB  MVAM      PRCLB                           CGL017
     C                     ENDIF                                          CGL017
     C*
     C/COPY WNCPYSRC,GL4443CCP2                                           S01408
     C*                                                                   S01408
     C                     ADD  1         RRN
     C                     SETON                     0283
     C*
     C                     ENDSR                           ** WRTSUB **
     C*
      /TITLE         <<< WRTSU2 SR. >>>                                   CGL017
     C*****************************************************************   CGL017
     C*                                                                   CGL017
     C* WRTSU2 --- WRITE OPENING RECORD TO SUBFILE                        CGL017
     C*                                                                   CGL017
     C* 1. FORMATS OUTPUT FIELDS VIA STANDARD SUBROUTINES                 CGL017
     C* 2. WRITES RECORD TO SUBFILE                                       CGL017
     C*                                                                   CGL017
     C* CALLED FROM: SCRN1                                                CGL017
     C*                                                                   CGL017
     C* CALLS: ZDATE2, ZFRPED (STANDARD S/RS)                             CGL017
     C*                                                                   CGL017
     C*****************************************************************   CGL017
     C*                                                                   CGL017
     C           WRTSU2    BEGSR                           ** WRTSU2 **   CGL017
     C*                                                                   CGL017
      * Only do this if Amount and Cheque no fields are blank             CGL017
     C           AMONT     IFEQ *BLANKS                                   CGL017
     C           CQNMR     ANDEQ*BLANKS                                   CGL017
      *                                                                   CGL017
     C           VALDN     IFLE RNDT                                      CGL017
     C                     Z-ADDRNDT      ZDAYNO                          CGL017
     C                     ELSE                                           CGL017
     C                     Z-ADDVALDN     ZDAYNO                          CGL017
     C                     ENDIF                                          CGL017
     C                     EXSR ZDATE2                                    CGL017
     C                     MOVE ZADATE    VALDZ                           CGL017
     C*                                                                   CGL017
     C                     Z-ADDPRCLB     ZFLD15                          CGL017
     C                     Z-ADDA6NBDP    ZDECS                           CGL017
     C                     MOVE 'A'       ZECODE                          CGL017
     C                     EXSR ZFRPED                                    CGL017
     C                     MOVE ZOUT22    PSTAZ                           CGL017
     C*                                                                   CGL017
     C* Text on Opening Balance depends upon whether retail/non-retail    CGL017
     C* A/C and whether entered value date is greater than rundate or     CGL017
     C* not.                                                              CGL017
      *                                                                   CGL017
     C                     MOVEL*BLANKS   PDESC                           CRE009
      *                                                                   CGL017
     C           *IN14     IFEQ *ON                                       CGL017
     C           VALDN     IFGT RNDT                                      CGL017
     C                     MOVEATXT,3     PDESC                           CGL017
     C                     ELSE                                           CGL017
     C                     MOVEATXT,2     PDESC                           CGL017
     C                     ENDIF                                          CGL017
     C                     ELSE                                           CGL017
     C           VALDN     IFGT RNDT                                      CGL017
     C                     MOVEATXT,5     PDESC                           CGL017
     C                     ELSE                                           CGL017
     C                     MOVEATXT,4     PDESC                           CGL017
     C                     ENDIF                                          CGL017
     C                     ENDIF                                          CGL017
      *                                                                   CGL017
     C                     MOVE SFLD31    SFLDS3                          CGL017
     C                     WRITESFLRCD                                    CGL017
     C                     MOVEL*BLANKS   PDESC                           CGL017
     C*                                                                   CGL017
     C                     ADD  1         RRN                             CGL017
     C                     MOVE 'Y'       FIRST   1                       CGL017
     C*                                                                   CGL017
     C                     ENDIF                                          CGL017
      *                                                                   CGL017
     C                     ENDSR                           ** WRTSU2 **   CGL017
     C*****************************************************************   CGL017
     C*                                                                   CGL017
     C* WRTSU3 --- WRITE CLOSING RECORD TO SUBFILE                        CGL017
     C*                                                                   CGL017
     C* 1. FORMATS OUTPUT FIELDS VIA STANDARD SUBROUTINES                 CGL017
     C* 2. WRITES RECORD TO SUBFILE                                       CGL017
     C*                                                                   CGL017
     C* CALLED FROM: SCRN1                                                CGL017
     C*                                                                   CGL017
     C* CALLS: ZDATE2, ZFRPED (STANDARD S/RS)                             CGL017
     C*                                                                   CGL017
     C*****************************************************************   CGL017
     C*                                                                   CGL017
     C           WRTSU3    BEGSR                           ** WRTSU3 **   CGL017
     C*                                                                   CGL017
      * Only do this if Amount and Cheque no fields are blank             CGL017
     C           AMONT     IFEQ *BLANKS                                   CGL017
     C           CQNMR     ANDEQ*BLANKS                                   CGL017
      *                                                                   CGL017
     C*                                                                   CGL017
      * No need to set up value date as VALDZ should contain same         CGL017
      * valus as previous subfile record.                                 CGL017
     C*                                                                   CGL017
     C                     Z-ADDPRCLB     ZFLD15                          CGL017
     C                     Z-ADDA6NBDP    ZDECS                           CGL017
     C                     MOVE 'A'       ZECODE                          CGL017
     C                     EXSR ZFRPED                                    CGL017
     C                     MOVE ZOUT22    PSTAZ                           CGL017
     C*                                                                   CGL017
     C* Text on Closing Balance depends upon whether retail/non-retail    CGL017
     C* A/C and whether entered value date is greater than rundate or     CGL017
     C* not.                                                              CGL017
      *                                                                   CGL017
      * If being called from SR/WRTSUB save TRYP and STNMR.               CGL017
     C           CLOBAL    IFEQ 'Y'                                       CGL017
     C                     MOVE TRYP      WTRYP   2                       CGL017
     C                     MOVE STNMR     WSTNMR 26                       CGL017
     C                     ENDIF                                          CGL017
      *                                                                   CGL017
     C                     MOVE *BLANKS   PDESC                           CRE009
     C                     MOVE *BLANKS   @DESC                           CRE009
      *                                                                   CGL017
     C           *IN14     IFEQ *ON                                       CGL017
     C                     MOVEATXT,6     PDESC                           CGL017
     C                     ELSE                                           CGL017
     C                     MOVEATXT,7     PDESC                           CGL017
     C                     ENDIF                                          CGL017
      *                                                                   CGL017
     C           CRE009    IFEQ 'Y'                                       CRE009
     C           *IN14     ANDEQ*ON                                       CRE009
     C                     MOVEATXT,8     LPDESC                          CRE009
     C                     MOVE VALDZ     RPDESC                          CRE009
     C                     MOVEL@DESC     PDESC                           CRE009
     C                     ENDIF                                          CRE009
      *                                                                                       252876
     C                     MOVEL*BLANKS   CHQN                                                252876
      *                                                                   CGL017
     C                     MOVE SFLD31    SFLDS3                          CGL017
     C                     MOVE '1'       *IN88                                             BUG26687
     C                     WRITESFLRCD                                    CGL017
     C                     MOVE '0'       *IN88                                             BUG26687
     C                     MOVEL*BLANKS   PDESC                           CGL017
      *                                                                   CGL017
      * If being called from SR/WRTSUB move back TRYP and STNMR.          CGL017
     C           CLOBAL    IFEQ 'Y'                                       CGL017
     C                     MOVE WTRYP     TRYP                            CGL017
     C                     MOVE WSTNMR    STNMR                           CGL017
     C                     ENDIF                                          CGL017
     C*                                                                   CGL017
     C                     ADD  1         RRN                             CGL017
     C                     ADD  1         COUNT                           CGL017
     C*                                                                   CGL017
     C                     ENDIF                                          CGL017
     C*                                                                   CGL017
     C                     ENDSR                           ** WRTSU3 **   CGL017
      /TITLE         <<< ACDETS SR. >>>
     C*****************************************************************
     C*
     C* ACDETS --- SET-UP STATIC DISPLAY DATA
     C*
     C* 1. FORMATS OUTPUT FIELDS VIA STANDARD SUBROUTINES
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: ZDATE2, ZFRPED
     C*
     C*****************************************************************
     C*
     C           ACDETS    BEGSR                           ** ACDETS **
      *                                                                   139853
      ** Initialise output fields.                                        139853
     C                     MOVE *BLANKS   OPNBAL                          139853
     C                     MOVE *BLANKS   CLSBAL                          139853
     C*                                                                   139853
     C*                                                                   117436
     C** Obtain Ledger Balance and Cleared Balance at start of the        117436
     C** day from Account Balances Today file (GLACBTPD)                  117436
     C*                                                                   117436
     C********** KGLAC     CHAINGLACBTL0             86                              117436 MD039988
     C           KGLAC     CHAINACCNTABF             86                                     MD039988
     C*                                                                   117436
     C** If record found, apply Cleared Balance at the start of the       117436
     C** day as the Opening Balance for a Retail Account and apply        117436
     C** Ledger Balance as the Opening Balance for a Nostro Account       117436
     C*                                                                   117436
     C           *IN86     IFEQ '0'                                       117436
     C*                                                                   117436
      *                                                                   139853
      ** *IN86 only affects Opening Balance, so process this first.       139853
      ** Move condition indicator.                                        139853
     C********** *IN14     IFEQ '1'                                       139853
     C*
     C                     Z-ADDCLBL      ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    OPNBAL 22
     C*
     C                     ELSE                                           139853
     C*                                                                   139853
     C** If no record found, assume Start of Day Balance was zero         139853
     C*                                                                   139853
     C           A6NBDP    IFEQ 0                                         139853
     C                     MOVE '0  '     OPNBAL                          139853
     C                     ENDIF                                          139853
     C*                                                                   139853
     C           A6NBDP    IFEQ 1                                         139853
     C                     MOVE '0.0  '   OPNBAL                          139853
     C                     ENDIF                                          139853
     C*                                                                   139853
     C           A6NBDP    IFEQ 2                                         139853
     C                     MOVE '0.00  '  OPNBAL                          139853
     C                     ENDIF                                          139853
     C*                                                                   139853
     C           A6NBDP    IFEQ 3                                         139853
     C                     MOVE '0.000  ' OPNBAL                          139853
     C                     ENDIF                                          139853
     C*                                                                   139853
     C                     ENDIF                                          139853
      *                                                                   139853
      ** Process Closing Balance.                                         139853
      *                                                                   139853
     C*                                                                   139853
     C           *IN14     IFEQ '1'                                       139853
      *                                                                   139853
     C                     Z-ADDCLBLN     ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    CLSBAL 22
     C*
     C                     ELSE
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP22                                           S01408
     C*                                                                   S01408
     C                     Z-ADDLDBL      ZFLD15
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4443CP23                                           S01408
     C*                                                                   S01408
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    OPNBAL 22
     C*
     C* If unallocated (newly opened) nostro, projected closing balance
     C*  is not available
     C           *IN15     IFEQ '1'
     C                     MOVE *BLANKS   CLSBAL
     C                     MOVELTXT,1     CLSBAL
     C                     MOVEA*ZEROS    PDAT,1                          165290
     C*
     C                     ELSE
     C/COPY WNCPYSRC,GL4443C049
     C** Look up the run date in the nostro balance posting date
     C** array to get the corresponding projected closing ledger
     C** balance of account movements as of run date.
     C*
     C                     Z-ADD1         E       10
     C           RUND      LOKUPPDAT,E                   70
     C                     Z-ADDPBAL,E    ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    CLSBAL 22
     C/COPY WNCPYSRC,GL4443C050
     C                     END
     C*
     C                     END
     C*
     C**********           ELSE                                    117436 139853
     C**********                                                   117436 139853
     C***If*no*record found, assume Start of Day Balance was zero  117436 139853
     C**********                                                   117436 139853
     C********** A6NBDP    IFEQ 0                                  117436 139853
     C**********           MOVE '0'       OPNBAL                   117436 139853
     C**********           ENDIF                                   117436 139853
     C**********                                                   117436 139853
     C********** A6NBDP    IFEQ 1                                  117436 139853
     C**********           MOVE '0.0'     OPNBAL                   117436 139853
     C**********           ENDIF                                   117436 139853
     C**********                                                   117436 139853
     C********** A6NBDP    IFEQ 2                                  117436 139853
     C**********           MOVE '0.00'    OPNBAL                   117436 139853
     C**********           ENDIF                                   117436 139853
     C**********                                                   117436 139853
     C********** A6NBDP    IFEQ 3                                  117436 139853
     C**********           MOVE '0.000'   OPNBAL                   117436 139853
     C**********           ENDIF                                   117436 139853
     C**********                                                   117436 139853
     C**********           ENDIF                                   117436 139853
     C*                                                            117436 139853
     C                     ENDSR                           ** ACDETS **
     C*
      /TITLE         <<< FUTOPB SR. >>>                                   CGL017
     C*****************************************************************   CGL017
     C*                                                                   CGL017
     C* FUTOPB --- CALCULATE THE FUTURE OPENING BALANCE IF VALUE DATE     CGL017
     C*            ENTERED IS GREATER THAN RUNDATE                        CGL017
     C*                                                                   CGL017
     C* CALLED FROM: SCRN1                                                CGL017
     C*                                                                   CGL017
     C* CALLS:                                                            CGL017
     C*                                                                   CGL017
     C*****************************************************************   CGL017
     C*                                                                   CGL017
     C           FUTOPB    BEGSR                           ** FUTOPB **   CGL017
      *                                                                   CGL017
      * If a Retail A/C start with Cleared Balance from MEMOS,            CGL017
      * otherwise start with Leger Balance from PRONO.                    CGL017
      * Then access RSACMTL1 and adjust the balance with all postings     CGL017
      * where value date is prior to the entered Value Date.              CGL017
      * This gives the opening projected balance for the Value Date       CGL017
      * entered.                                                          CGL017
     C           *IN14     IFEQ *ON                                       CGL017
     C***********          Z-ADDCLBLN     PRCLB  150                CGL017217484
     C                     Z-ADDCLBL      PRCLB  150                      217484
     C                     ELSE                                           CGL017
     C                     Z-ADDLDBL      PRCLB  150                      CGL017
     C                     ENDIF                                          CGL017
      *                                                                   CGL017
      * Save Value entered as Value Date then SETLL on RSACMTL1           CGL017
      *                                                                   CGL017
     C                     Z-ADDVALDN     WVALDN  50                      CGL017
     C                     Z-ADD0         VALDN                           CGL017
     C           KEYSL1    SETLLRSACMTL1                                  CGL017
      *                                                                   CGL017
      * Read posting records off RSACMTL1 until change of Account         CGL017
      * or there are no more postings with Value Date before entered      CGL017
      * Value Date.                                                       CGL017
     C                     SETOF                     3132                 CGL017
     C           KEYEQ     READERSACMTL1                 80               CGL017
     C           *IN80     DOWNE*ON                                       CGL017
     C           VUDTA     ANDLTWVALDN                                    CGL017
     C           *IN32     ANDEQ*ON                                                           218300
     C           *IN80     ORNE *ON                                                           218300
     C           VALD      ANDLTWVALDN                                                        218300
     C           *IN31     ANDEQ*ON                                                           218300
      *                                                                   CGL017
      * If a Debit posting, add to Projected Balance else subtract.       CGL017
      * If record read from CLEARPD *IN31 is ON else read from            CGL017
      * RSACMTPD.                                                         CGL017
     C           *IN32     IFEQ '1'                                       CGL017
     C*                                                                   CGL017
     C           DORCA     IFEQ 0                                         CGL017
     C           PRCLB     ADD  MVAMA     PRCLB                           CGL017
     C                     ELSE                                           CGL017
     C           PRCLB     SUB  MVAMA     PRCLB                           CGL017
     C                     ENDIF                                          CGL017
     C                     ELSE                                           CGL017
     C           DRCR      IFEQ 0                                         CGL017
     C           PRCLB     ADD  PSTA      PRCLB                           CGL017
     C                     ELSE                                           CGL017
     C           PRCLB     SUB  PSTA      PRCLB                           CGL017
     C                     ENDIF                                          CGL017
      *                                                                   CGL017
     C                     ENDIF                                          CGL017
      *                                                                   CGL017
     C                     SETOF                     3132                 CGL017
     C           KEYEQ     READERSACMTL1                 80               CGL017
     C                     ENDDO                                          CGL017
      *                                                                   CGL017
      * Move stored entered Value Date back to correct field.             CGL017
     C                     Z-ADDWVALDN    VALDN                           CGL017
     C                     ENDSR                           ** FUTOPB **   CGL017
      *                                                                                     BUG26687
      /TITLE         <<< RTVMSG SR. >>>                                                     BUG26687
     C*****************************************************************                     BUG26687
     C*                                                                                     BUG26687
     C* RTVMSG --- RETRIEVE TEXT FROM MESSAGE FILE                                          BUG26687
     C*                                                                                     BUG26687
     C* CALLED FROM:                                                                        BUG26687
     C*                                                                                     BUG26687
     C* CALLS:                                                                              BUG26687
     C*                                                                                     BUG26687
     C*****************************************************************                     BUG26687
     C*                                                                                     BUG26687
     C           RTVMSG    BEGSR                           ** RTVMSG **                     BUG26687
      *                                                                                     BUG26687
     C                     CALL 'SDRTVTXT'                                                  BUG26687
     C                     PARM           PMSGID  7                                         BUG26687
     C                     PARM XMSGFN    PMSGFN 10                                         BUG26687
     C                     PARM *BLANKS   PMSGDS 80                                         BUG26687
      *                                                                                     BUG26687
     C                     ENDSR                                                            BUG26687
      *                                                                   CGL017
      *TITLE****     <<< SRSMSG SR. >>>                                                       116710
      *****************************************************************
      *                                                               *
      ***SRSMSG*-*Routine to send messages to message subfile.        *                       116710
      *                                                               *
      *****************************************************************
      *
     C********** SRSMSG    BEGSR                                                              116710
      *                                                                                       116710
      ***Send*specified message from specified message file to program                        116710
      ***message queue; then clear message id and message file                                116710
     C**********           CALL 'ZA0340'                                                      116710
     C**********           PARM 'GLUSRMSG'ZAMSGF 10                                           116710
     C**********           PARM           ZAMSID 10                                           116710
      *
     C**********           CLEARZAMSID                                                        116710
      *
     C**********           ENDSR                                                              116710
     C*
      /TITLE         <<< ZALIGN SR. >>>
     C/COPY ZSRSRC,ZALIGNZ2
      /TITLE         <<< ZFRPED SR. >>>
     C/COPY ZSRSRC,ZFRPEDZ3
      /TITLE         <<< ZDATE1 SR. >>>
     C/COPY ZSRSRC,ZDATE1Z2
      /TITLE         <<< ZDATE2 SR. >>>
     C/COPY ZSRSRC,ZDATE2Z2
      /TITLE         <<< *PSSR SR. >>>
     C*****************************************************************
     C*
     C* *PSSR  --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS
     C*
     C* CALLED FROM: AFTER ABNORNAL OPERATION OCCURS
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           *PSSR     BEGSR                           ** *PSSR **
     C*
     C           DBASE     IFGT 0
     C                     MOVEL'GL4443'  DBPGM
     C                     SETON                     U7U8
     C                     END
     C*
     C                     DUMP
     C*
     C                     ENDSR'*CANCL'                   ** *PSSR **
     C********************************************************************
      /TITLE         <<< ARRAY DATA >>>
     C/COPY WNCPYSRC,GL4443C001
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**  TXT
   ** NOT AVAILABLE **
   Opening Cleared Balance                                                CGL017
   Opening Projected Cleared Balance                                      CGL017
   Opening Ledger Balance                                                 CGL017
   Opening Projected Ledger Balance                                       CGL017
   Closing Projected Cleared Balance                                      CGL017
   Closing Projected Ledger Balance                                       CGL017
   Cleared Balance at end of                                              CRE009
**  EMSG                                                                                      116710
No postings to display for this selection                                                     116710
NO DETAILS FOR THIS MOVEMENT                                                                BUG26687
     X/COPY WNCPYSRC,GLH00341
INVALID OPTION                                                                              BUG26687
NOT ALLOWED FOR THIS TRANSACTION                                                            BUG26782
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
