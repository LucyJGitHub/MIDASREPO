     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL Items in Clearing Enquiry')                   *
      *****************************************************************
      *                                                               *
      *  Midas GENERAL LEDGER MODULE                                  *
      *                                                               *
      *     GL4444 - Items in Clearing                                *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. EML102             Date 28Nov19               *
      *  Prev Amend No. CSD103             Date 10Aug20               *
      *                 MD051749           Date 24Sep18               *
      *                 MD046592           Date 24Sep18               *
      *                 MD046248           Date 27Oct17               *
      *                 CGL186             Date 06Oct17               *
      *                 CGL145B            Date 01Oct13               *
      *                 CRE075             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER030             Date 09Jul08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 239964             Date 07Jun06               *
      *                 240079             Date 03Jun06               *
      *                 239966             Date 05Jun06               *
      *                 BUG11679           Date 05Jul06               *
      *                 CRE024             Date 26Apr02               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG1094            Date 29Mar06               *
      *                 CGL037             Date 14Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CAAA03             Date 19Apr04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 202528             Date 06Feb02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CSD006             Date 11Oct00               *
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 163504             Date 21Oct99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 CGL007             Date 26Mar99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 107938  SL         Date 17Feb98               *
      *                 S01408             Date 07Oct96               *
      *                 S01408             DATE 21FEB96               *
      *                 S01408             DATE 25JUL95               *
      *                 080945             DATE 07MAR95               *
      *                 080050             DATE 02FEB95               *
      *                 S01408             DATE 16JAN95               *
      *                 S01472             DATE 12MAR94               *
      *                 045014            DATE  07DEC92               *
      *                 042779            DATE  07DEC92               *
      *                 047515            DATE  23NOV92               *
      *                 S10736            DATE  03SEP92               *
      *                 LN1295            DATE  07JUN91               *
      *                 LN1273            DATE  20MAY91               *
      *                 S01314            DATE  28MAR91               *
      *                 BHF677            DATE  28SEP90               *
      *                 E20463            DATE  08MAY89               *
      *                 LN0130            DATE  08MAY90               *
      *                 E19970            DATE  14FEB90               *
      *                 E19563            DATE  14FEB90               *
      *                 S01117            DATE  21/06/89              *
      *                 S01199            DATE  20/06/89              *
      *                 S01194            DATE  13/03/89              *
      *                 E17471            DATE  17/04/89              *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  EML102 - Upgrade of UNL007, EML004 to FB2.1 SP23.            *
      *           EML004 - Extended Narrative                         *
      *            Used GL4444CCPG GL4444CCP1 GL4444CCP7              *
      *                 EML102_009                                    *
      *           UNL007 - Extended Narratives                        *
      *            Used GL4444CCPG GL4444CCP5 GL4444CP10 GL4444IIPG   *
      *                 GL4444CCP1 GL4444CCP6 GL4444CP11              *
      *                 GL4444CCP2 GL4444CCP7 GL4444CP12              *
      *                 GL4444CCP3 GL4444CCP8 GL4444CP13              *
      *                 GL4444CCP4 GL4444CCP9 GL4444FFPG              *
      *           Added EML102_009                                    *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *           (Recompile)                                         *
      *  MD051749 - Amended MD046592 to correctly display Trans Type  *
      *  MD046592 - Narrative is being truncated. Restore the length  *
      *             of the Narrative back to 30 characters.           *
      *           - Applied for MD-51794                              *
      *  MD046248 - Finastra Rebranding                               *
      *  CGL186 - Customer Report Name on Enquiries                   *
      *         - Add Cust Report Name to Account Movements & OSIC.   *
      *  CGL145B - Subsidiaries Daily Sweeping Forecast               *
      *            Added hooks: CGL145_023, CGL145_024                *
      *  CRE075 - Effective Date for Retail Accounts (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER030 - Multicash German Feature (Recompile)                *
      *  239964 - Applied fix 236093.                                 *
      *  240079 - Applied fix 236093.                                 *
      *  239966 - Applied fix 236093.                                 *
      *  236093 - MidasPlus Webfacing screens hanging since webfacing *
      *           doesn't support TFRGRPJOB.                          *
      *  BUG11679 - Additional Conversion of Customer Number to Alpha *
      *  CRE024 - Country Level Switchable Feature :                  *
      *           Security Features for Restricted Accounts.          *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10942 - Narrative on shadow postings for customer         *
      *             exchanges of no use. Added Transaction Number on  *
      *             the display.                                      *
      *  CGL037 - Account Access Security                             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CAAA03 - Webfacing Changes (recompile)                       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  202528 - Allow the system to view closed accounts in the     *
      *           Account movement enquiries.                         *
      *  CSD006 - Use correct parameters for Access Objects           *
      *  163504 - If both date and amount selected, selection should  *
      *           point to those postings with that amount. This is   *
      *           only the case when sign is left blank.              *
      *  CGL007 - Account Postings Enquiry (Recompile)                *
      *  107938  -  Narrative truncated by batch nbr (cfr S01472)     *
      *             Display complete narrative if not a batch         *
      *  S01408  -  Addition of Core Hook GL4444FFP1                     *
      *             Addition of Core Hook GL4444CP22
      *             Addition of Core Hook GL4444CP21
      *             Addition of Core Hook GL4444CP20
      *             Addition of Core Hook GL4444CP19
      *             Addition of Core Hook GL4444CP18
      *  S01408  -  Core hook GL4444CP16 added.                       *
      *             Core hook GL4444CP17 added.                       *
      *  S01408  -  Core hook GL4444EEPG added.                       *
      *             Core hook GL4444EEP1 added.                       *
      *             Core hook GL4444IIP1 added.                       *
      *             Core hook GL4444CP14 added.                       *
      *             Core hook GL4444CP15 added.                       *
      *  080945  -  Define LDA fields correctly                       *
      *  080050  -  Narrative code on Shadow Postings file is now     *
      *             alphabetic - amended program (082742)             *
      *   S01408 - Addition of core hook GL4444FFPG.                  *
      *            Addition of core hook GL4444IIPG.                  *
      *            Addition of core hook GL4444CVK1.                  *
      *            Addition of core hook GL4444CVKS.                  *
      *            Addition of core hook GL4444CCPG.                  *
      *            Addition of core hook GL4444CCP1.                     *
      *            Addition of core hook GL4444CCP2.                     *
      *            Addition of core hook GL4444CCP3.                     *
      *            Addition of core hook GL4444CCP4.                     *
      *            Addition of core hook GL4444CCP5.                     *
      *            Addition of core hook GL4444CCP6.                     *
      *            Addition of core hook GL4444CCP7.                     *
      *            Addition of core hook GL4444CCP8.                     *
      *            Addition of core hook GL4444CCP9.                     *
      *            Addition of core hook GL4444CP10.                     *
      *            Addition of core hook GL4444CP11.                     *
      *            Addition of core hook GL4444CP12.                     *
      *            Addition of core hook GL4444CP13.                     *
      *   S01472  -  A/C movements enquiry to show batch number
      *   045014  -  Only show FT post if C#GLUI is 'I'mmediate          *
      *              Call FT0005 to get FT Control Data
      *   042779  -  Show all future dated FT transactions as these
      *              affect the General Ledger Balance immediately
      *   047515  -  PGM FALLS OVER ON ROLLUP BECAUSE DSPREC HAS BEEN    *
      *              SET TO RRN FOR NEXT SUBFILE PAGE, BUT SUBSEQUENT    *
      *              VALIDATION EXCLUDES FURTHER RECORDS FROM BEING      *
      *              WRITTEN TO SUBFILE                                  *
      *   S10736  -  RECOMPILE FOR MANAGEMENT ACCOUNTING                 *
      *   LN1295  -  WHEN NOSTRO CODE OR SHORTNAME ENTERED & VALIDATED   *
      *              REMAINING INPUT FIELDS SHOULD BE BLANKED OUT        *
      *              CORRECT CHANGES MADE TO LFs/RSACMTL1/2 DURING       *
      *              MULTIBRANCHING & PTF INCORPORATION                  *
      *   LN1273  -  IF MBIN = N, THE SINGLE BRANCH VALUE (DEFAULT       *
      *              BRANCH FROM ZMUSER) SHOULD BE USED IN CHAIN TO      *
      *              ACCOUNTS FILE                                       *
      *              BRANCH AUTHORITY ONLY CHECKED WHEN MBIN = Y.        *
      *   S01314 - CHGS MADE DURING PTF INCORPORATION                    *
      *   BHF677 - INCORRECT ZERO SUPPRESSION IN CHEQUE NUMBER           *BHF677
      *            FIELD OF SUBFILE RECORD                               *BHF677
      *   E20463 - NUMBER OF DECIMAL PLACES ON CURRENCY FIELD IS  *      *E20463
      *            NOT CHECKED WHEN ENQUIRY CHANGES.                     *E20463
      *   LN0130 - STANDARDISE PARAMETERS OF AOACCTV0                    *
      *   E19970 - THIS PROGRAM SHOULD ONLY ALLOW ENQUIRIES ON           *E19970
      *            RETAIL ACCOUNTS                                       *E19970
      *   E19563 - ALL REFERNCES TO COMMAND 12 CHANGED TO COMMAND 5      *E19563
      *            +  *INKL CHANGED TO *INKE                             *E19563
      *   S01117 - Release 10 (Multibranching)                           *
      *   S01199 - HELP FACILITY MODIFIED                                *
      *   S01194 - NEW STANDING DATA                                     *
      *   E17471 - NEED TO RECREATE DUE TO CHANGES TO APOSTL1 &
      *            RSACMTL1
      *                                                                  *
      *------------------------------------------------------------------*
      *
      *    I N D I C A T O R   U S A G E
      *
      *    01  First time indicator
      *    02  Display subfile
      *    03  Display subfile control record
      *    04  Enable SFLEND
      *
      *    10  Record identifying indicator for RSACMTPD
      *    11  Enter key pressed
      *    12  Input criteria has been changed
      *    14  ON = Account is retail
      *    15  Unallocated nostro
      *
      *    20  Invalid account entered
      *    21  Single Branch Environment                                  S01117
      *    25  Rollup key pressed
      *    27  Help key pressed
      *
     F/COPY WNCPYSRC,GL4444F002
      *    50  Input criteria is invalid
      *    51  Customer number is invalid
      *    52  User not Authorised to Branch                              S01117
      *
      *    60  Account number has changed
      *    61  Posting date has changed
      *    62  Plus/Minus indcator has changed
      *    63  Amount or cheque number has changed
      *    64  Invalid account         - display reverse image
      *    65  Invalid date            - display reverse image
      *    66  Invalid (+/-) indicator - display reverse image
      *    67  Invalid amount          - display reverse image
      *    68  Invalid cheque number   - display reverse image
      *
      *    80  No more postings for this account (APOSTL1/APOSTL2)
      *    81  'OFF' = posting record meets selection criteria
      *    82  S01472 is switched ON                                      S01472
      *    83  No records in the subfile for this account
      *
      *    9n  all 9? indicators used for standard subroutines
      *    98  Date format is 'M'
      *    99  also used as a general purpose indicator
      *
      *    KC  Command key  3 pressed
      *    KE  Command key  5 pressed                                     E19563
      *    KL  NO LONGER IN USE                                           E19563
      *    KM  Command key 13 pressed
      *    KN  Command key 14 pressed
      *    KP  Command key 15 pressed
      *
      *    LR  End of program
      *
     FGL4444DFCF  E                    WORKSTN      KINFDS DSPFDS
     F                                        RRN   KSFILE SFLRCD
      *                                                                   S01408
     F/COPY WNCPYSRC,GL4444FFPG                                           S01408
      *                                                                   S01408
     FPRONO   IF  E           K        DISK
     FRSACMTL1IF  E           K        DISK
     F            APOSTPDF                          KRENAMEAPOSTPD1
     F            RSACMTPO                          KRENAMERSACMTP1
     F*                                                                   S01408
     F/COPY WNCPYSRC,GL4444FFP1                                           S01408
     F*                                                                   S01408
     F************FFACMVDO                          KRENAMEFFACMVD1S01117 S01314
     F************FFACMVDF                          KRENAMEFFACMVD1S01314 LN1295
     FRSACMTL2IF  E           K        DISK
     F            APOSTPDF                          KRENAMEAPOSTPD2
     F            RSACMTPO                          KRENAMERSACMTP2
     F************FFACMVDO                          KRENAMEFFACMVD2S01117 S01314
     F************FFACMVDF                          KRENAMEFFACMVD2S01314 LN1295
      /TITLE         >>> TABLES/ARRAYS <<<
     F/COPY WNCPYSRC,GL4444F001
     E                    FCODE      10  1
     E                    FTEXT      10 30
     E                    ERCD       19  4               ERROR CODES
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E                    ZA1        16  1               ZALIGN INPUT
     E                    ZA2        16  1               ZALIGN OUTPUT
     E                    ZS1        15  1 0
     E                    ZS2        22  1
     E*                                                                   S01408
     E/COPY WNCPYSRC,GL4444EEPG                                           S01408
     E*                                                                   S01408
     E                    EMSG    1   2 76               ERROR MESSAGE
     E*                                                                   S01408
     E/COPY WNCPYSRC,GL4444EEP1                                           S01408
     E*                                                                   S01408
     E                    CPY@    1   1 80               COPYRIGHT STATEMENT
      /TITLE         >>> FILE SPECS <<<
     E/COPY WNCPYSRC,GL4444E001
     IRSACMTP1    10
     I              CUSN                            CNUM
     I              CCYD                            CCY
     I              ACDE                            ACOD
     I              ASNC                            ACSQ
     I              PTDT                            PSTD
     I              VUDT                            VALD
     I              CQNR                            CHQN
     I              MVAM                            PSTA
     I              DORC                            DRCR
     I/COPY WNCPYSRC,GL4444I003
     IRSACMTP2    10
     I              CUSN                            CNUM
     I              CCYD                            CCY
     I              ACDE                            ACOD
     I              ASNC                            ACSQ
     I              PTDT                            PSTD
     I              VUDT                            VALD
     I              CQNR                            CHQN
     I              MVAM                            PSTA
     I              DORC                            DRCR
      *
      /TITLE         >>> DATA AREAS <<<
      *************************************************
      **  D A T A   S T R U C T U R E    for   *LDA  **
      *************************************************
      *
     IDSLDA       DS
      *
      *  *LDA for transfering enquiry selection criteria
      *
     I**********                              2  49 LDADTA                S01117
     I**********                              2  52 LDADTA          S01117S01472
     I**********                              2  59 LDADTA                             S01472 CGL029
     I**********                              2  65 LDADTA                             CGL029 236093
     I                                        2  68 LDADTA                                    236093
     I                                        2  11 CNUMR
     I/COPY WNCPYSRC,GL4444I001
     I                                        2   4 KPRCCY
     I                                        5   60KPRNO
     I                                        5   6 KPRNOA
     I**********                              7  20 KPREST                                    CGL029
     I                                       12  14 CURRY
     I**********                             15  18 ACCOD                                     CGL029
     I**********                             19  20 ACSEQ                                     CGL029
     I**********                              2  20 ACNT                                      CGL029
     I**********                             21  23 BRNCH                              S01117 CGL029
     I**********                              2  23 MBACNT                             S01117 CGL029
     I***********                            21  26 VALDA                 S01117
     I**********                             24  29 VALDA                              S01117 CGL029
     I***********                            27  27 PORM                  S01117
     I**********                             30  30 PORM                               S01117 CGL029
     I***********                            28  41 AMONT                 S01117
     I**********                             31  44 AMONT                              S01117 CGL029
     I***********                            42  49 CQNMR                 S01117
     I**********                             45  52 CQNMR                              S01117 CGL029
     I**********                             53  59 SPOS                               S01472 CGL029
     I                                        7  26 KPREST                                    CGL029
     I                                       15  24 ACCOD                                     CGL029
     I                                       25  26 ACSEQ                                     CGL029
     I                                        2  26 ACNT                                      CGL029
     I                                       27  29 BRNCH                                     CGL029
     I                                        2  29 MBACNT                                    CGL029
     I                                       30  35 VALDA                                     CGL029
     I                                       36  36 PORM                                      CGL029
     I                                       37  50 AMONT                                     CGL029
     I                                       51  58 CQNMR                                     CGL029
     I                                       59  65 SPOS                                      CGL029
     I                                       66  68 FUNC                                      236093
     I/COPY WNCPYSRC,GL4444I004
      *
      *  *LDA for reporting error messages
      *
     I**********                            134 138 DBFILE                080945
     I**********                            139 167 DBKEY                 080945
     I**********                            168 175 DBPGM                 080945
     I**********                            176 1770DBASE                 080945
     I                                      134 141 DBFILE                080945
     I                                      142 170 DBKEY                 080945
     I                                      171 180 DBPGM                 080945
     I                                      181 1830DBASE                 080945
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I* External DTAARA for run-date
     I*
     IRUNDT       DS
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
     I*                                                                   S01117
     I* External DTAARA for ZMUSER                                        S01117
     I*                                                                   S01117
     IZMUSER      DS                                                      S01117
     I                                       11  13 BRC                   S01117
     I                                       17  17 BANK                  S01117
     I*
     IP@FMT1    E DSACCNTAB
     I              BRCA                            KBRC                  S01117
     I              CNUM                            KCUS
     I              CCY                             KCCY
     I              ACOD                            KCOD
     I              ACSQ                            KASE
     I                                        2   7 KCUSA
     I**********                              2  16 KEYAC                                     CGL029
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL4444IIP1                                           S01408
     I*                                                                   S01408
     I*
     IP@FMT2    E DSSDCURRPD
     IP@FMT3    E DSSDNARRPD
     IP@FMT4    E DSSDCUSTPD                                                                  CGL186
     I*
     I            DS
     I                                       49  560CQKEY
     I*
     IP@ALL       DS
     I                                        1   7 P@RTCD
     I                                        8  14 P@OPTN
     I                                       15  24 P@KEY1
     I                                       25  31 P@ANY
     I                                       32  34 P@KEY2
     I**********                             35  38 P@KEY3                                    CGL029
     I**********                             39  40 P@KEY4                                    CGL029
     I**********                             41  47 P@TYPE                                    CGL029
     I**********                             48  49 P@NOSN                                    CGL029
     I**********                             50  55 P@CUST                                    CGL029
     I**********                             56  58 P@KEY5                             S01117 CGL029
     I                                       35  44 P@KEY3                                    CGL029
     I                                       45  46 P@KEY4                                    CGL029
     I                                       47  53 P@TYPE                                    CGL029
     I                                       54  55 P@NOSN                                    CGL029
     I                                       56  61 P@CUST                                    CGL029
     I                                       62  64 P@KEY5                                    CGL029
     I*
      ** External DS for SAR Details                                                          CGL037
      *                                                                                       CGL037
     ISCSARD    E DSSCSARDPD                                                                  CGL037
     I              LCD                             SCLCD                                     CGL037
      *                                                                                       CGL037
      /COPY WNCPYSRC,EML102_009                                                               EML102
     I/COPY WNCPYSRC,GL4444I002
     ISFLDS4      DS                                                      S01472
     I                                        1   7 POSDZ                 S01472
     I                                        9  15 VALDZ                 S01472
     I                                       18  25 @CHQN                 S01472
     I********                               27  56 PNAR           S01472 107938
     I********                               27  56 PNARZ                            107938 MD046592
     I                                       27  56 PNAR                                    MD046592
     I********                               27  52 PNARZ          S01472 107938
     I********                               54  56 ABTCH          S01472 107938
     I********                               58  76 PSTAZ                            S01472 MD046592
     I                                       58  620TRAT                                    MD051749
     I                                       66  68 ABTCH                                   MD046592
     I                                       71  92 PSTAZ                                   MD051749
     I*                                                                   S01472
     I* Data structure for subfile record                                 S01472
     I            DS
     I                                        1  76 ERCD
     I                                        1  76 ERRDSP
     I*
     I*****************************************************************
     I*
     I            DS
     I                                        1  150ZWRK15
     I                                        1  150ZS1
     I            DS
     I                                        1  25 ZOUT25
     I                                        1  21 ZOUT0
     I                                        2  23 ZOUT1
     I                                        3  24 ZOUT2
     I                                        5  25 ZOUT3
     I*
     I*****************************************************************
     I*
     I*    PROGRAM DS TO GET WORK STN ID
     I*
     I           SDS
     I                                      244 246 WSID
     I*                                                                   S01408
     I/COPY WNCPYSRC,GL4444IIPG                                           S01408
     I*                                                                   S01408
     I*
     I*    DSPF DS  TO RETRIEVE CPF'S POSITION WITHIN THE SUBFILE
     I*
     IDSPFDS      DS
     I                                    B 378 3790CPFPOS
      *                                                                   045014
      *  Input parameters data structure from FT0005                      045014
      *                                                                   045014
     IC#CNTL      DS                            256                       045014
     I                                        1   1 C#PDTI                045014
     I                                        2   3 C#CCYI                045014
     I                                        4   4 C#GLUI                045014
     I                                        5   5 C#TPCI                045014
      *                                                                   045014
      *  Input parameters data structure for modules                      045014
      *                                                                   045014
     ISDMMOD    E DSSDMMODPD                                              045014
      *                                                                   045014
     IDSFDY     E DSDSFDY                                                 045014
      ** External DS for short Dummy data structure                       045014
     I*                                                                   LN0130
     IDSSDY     E DSDSSDY                                                 LN0130
      ** EXTERNAL DS FOR LONG DUMMY DATA STRUCTURE                        LN0130
     IDSLDY     E DSDSLDY                                                                     CGL186
      ** Long data structure for access programs                                              CGL186
     I*                                                                   LN0130
      /TITLE         >>> START OF MAIN PROCESSING <<<
     C*
     C*****************************************************************
     C                     MOVEACPY@      BIS@   80
     C*
     C           *NAMVAR   DEFN *LDA      DSLDA
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CP14                                           S01408
     C*                                                                   S01408
     C           KALL      KLIST
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C*
     C           KEYSL1    KLIST
     C                     KFLD           KBRC                            S01117
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C                     KFLD           VALDN
     C**********           KFLD           DORK                            E17471
     C                     KFLD           AMTKY
     C                     KFLD           DORK                            E17471
     C*
     C           KEYSL2    KLIST
     C                     KFLD           KBRC                            S01117
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C                     KFLD           CQKEY
     C*
     C           KEYEQ     KLIST
     C                     KFLD           KBRC                            S01117
     C                     KFLD           KCUS
     C                     KFLD           KCCY
     C                     KFLD           KCOD
     C                     KFLD           KASE
     C*
     C           KEYPRN    KLIST
     C                     KFLD           KPRCCY
     C                     KFLD           KPRNO
     C*                                                                   S01408
      ** Access SAR details file to determine if Account Access                               CGL037
      ** Security is switched on                                                              CGL037
      *                                                                                       CGL037
     C                     CALL 'AOSARDR0'                                                    CGL037
     C                     PARM *BLANKS   @RTCD   7                                           CGL037
     C                     PARM '*VERIFY' @OPTN   7                                           CGL037
     C                     PARM 'CGL037'  @SARD   6                                           CGL037
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL037
      *                                                                                       CGL037
     C           @RTCD     IFNE *BLANKS                                                       CGL037
     C           @RTCD     ANDNE'*NRF   '                                                     CGL037
     C                     EXSR *PSSR                                                         CGL037
     C                     MOVE '1'       *INLR                                               CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C           @RTCD     IFEQ *BLANK                                                        CGL037
     C                     MOVEL'Y'       CGL037  1                                           CGL037
     C                     ELSE                                                               CGL037
     C                     MOVEL'N'       CGL037                                              CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C/COPY OFCPYSRCZ,CGL145_023                                                             CGL145B
     C/COPY WNCPYSRC,GL4444CP18                                           S01408
     C*                                                                   S01408
     C*
      *** Check the switchable features file to see if S01472 is on.      S01472
     C*                                                                   S01472
     C                     SETOF                     82                   S01472
     C                     MOVE 'N'       S01472  1                       S01472
     C                     CALL 'AOSARDR0'                                S01472
     C                     PARM '       ' @RTCD   7                       S01472
     C                     PARM '*VERIFY' @OPTN   7                       S01472
     C                     PARM 'S01472 ' @SARD   6                       S01472
      *                                                                   S01472
     C           @RTCD     IFEQ *BLANKS                                   S01472
     C                     MOVE 'Y'       S01472                          S01472
     C                     SETON                     82                   S01472
     C                     END                                            S01472
      *                                                                   S01472
     C                     MOVE *BLANKS   SFLDS4                          S01472
      *                                                                   S01472
     C* MAIN PROCESSING --- FIRST CALL INITIAL SUBROUTINE
     C*
     C                     EXSR INIT
     C*
     C* DO WHILE NOT F3 --- ie. NOT EXIT
     C*
     C           *INKC     DOWEQ'0'
     C           EXTFLG    ANDEQ'N'                                                           236093
     C*
     C                     WRITEHEADING
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CCP3                                           S01408
     C*                                                                   S01408
     C                     EXFMTSFLCTLR
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CCP4                                           S01408
     C*                                                                   S01408
     C*
     C* SETOF INDICATOR FOR ACTION PERFORMED
     C*
     C                     SETOF                     11
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CP20                                           S01408
     C*                                                                   S01408
     C*
     C* SETON INDICATOR FOR NO POSTINGS TO DISPLAY
     C*
     C                     SETON                     83
     C*
     C           *IN25     IFEQ '1'
     C                     SETON                     11
     C                     EXSR ROLP
     C                     END
     C*
     C*******    *INKL     IFEQ '1'              *********                E19563
     C           *INKE     IFEQ '1'                                       E19563
     C                     SETON                     11
     C                     EXSR CMD5
     C                     END
     C*
     C********** *IN27     DOWEQ'1'                                       S01199
     C**********                                                          S01199
     C***IF*HELP KEY PRESSED BUT THERE ARE NO ERRORS TO DISPLAY           S01199
     C***THEN*DISPLAY USER INSTRUCTIONS                                   S01199
     C**********                                                          S01199
     C********** *IN50     IFEQ '0'                                       S01199
     C**********           MOVEA*BLANK    ERCD                            S01199
     C**********           MOVE ' 999'    ERCD,1                          S01199
     C**********           END                                            S01199
     C**********                                                          S01199
     C**********           MOVEAERCD      HERCD 160                       S01199
     C**********           CALL 'MHELP'                                   S01199
     C**********           PARM           HBPGM                           S01199
     C**********           PARM           HERCD                           S01199
     C**********           READ SFLCTLR                  99               S01199
     C**********           END                                            S01199
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CP21                                           S01408
     C*                                                                   S01408
      *                                                                                       236093
      ** If F03 - Exit                                                                        236093
      *                                                                                       236093
     C           *INKC     IFEQ '1'                                                           236093
     C                     MOVEL'F03'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     ENDIF                                                              236093
      *                                                                                       236093
      ** If F13 - Account & Statement Details                                                 236093
      *                                                                                       236093
     C           *INKM     IFEQ '1'                                                           236093
     C                     MOVEL'F13'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     MOVE 'Y'       EXTFLG                                              236093
     C                     ENDIF                                                              236093
      *                                                                                       236093
      ** If F14 - Account Movements                                                           236093
      *                                                                                       236093
     C           *INKN     IFEQ '1'                                                           236093
     C                     MOVEL'F14'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     MOVE 'Y'       EXTFLG                                              236093
     C                     ENDIF                                                              236093
      *                                                                                       236093
      ** If F15 - Projected Account Movements                                                 236093
      *                                                                                       236093
     C           *INKP     IFEQ '1'                                                           236093
     C                     MOVEL'F15'     FUNC                                                236093
     C                     OUT  DSLDA                                                         236093
     C                     MOVE 'Y'       EXTFLG                                              236093
     C                     ENDIF                                                              236093
     C/COPY OFCPYSRCZ,CGL145_024                                                             CGL145B
     C*
     C* TRANSFER CONTROL TO OTHER ENQUIRIES VIA GROUP JOB...
     C*
     C********** *INKM     IFEQ '1'                                                           236093
     C**********           OUT  DSLDA                                                         236093
     C**********           CALL 'GL4440'                                                      236093
     C**********           PARM 'GL4441'  PARAM  10                                           236093
     C**********           SETON                     11                                       236093
     C**********           EXSR LDA                                                           236093
     C* On return check if details have changed to blank
     C**********           EXSR FLDCHG                                                        236093
     C********** LDADTA    IFEQ *BLANKS                                                       236093
     C********** *IN12     ANDEQ'1'                                                           236093
     C**********           EXSR ENTR                                                          236093
     C**********           END                                                                236093
     C**********           END                                                                236093
     C*
     C********** *INKN     IFEQ '1'                                                           236093
     C**********           OUT  DSLDA                                                         236093
     C**********           CALL 'GL4440'                                                      236093
     C**********           PARM 'GL4442'  PARAM                                               236093
     C**********           SETON                     11                                       236093
     C**********           EXSR LDA                                                           236093
     C* On return check if details have changed to blank
     C**********           EXSR FLDCHG                                                        236093
     C********** LDADTA    IFEQ *BLANKS                                                       236093
     C********** *IN12     ANDEQ'1'                                                           236093
     C**********           EXSR ENTR                                                          236093
     C**********           END                                                                236093
     C**********           END                                                                236093
     C*
     C********** *INKP     IFEQ '1'                                                           236093
     C**********           OUT  DSLDA                                                         236093
     C**********           CALL 'GL4440'                                                      236093
     C**********           PARM 'GL4443'  PARAM                                               236093
     C**********           SETON                     11                                       236093
     C**********           EXSR LDA                                                           236093
     C* On return check if details have changed to blank
     C**********           EXSR FLDCHG                                                        236093
     C********** LDADTA    IFEQ *BLANKS                                                       236093
     C********** *IN12     ANDEQ'1'                                                           236093
     C**********           EXSR ENTR                                                          236093
     C**********           END                                                                236093
     C**********           END                                                                236093
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CCP7                                           S01408
     C*                                                                   S01408
     C*
     C           *IN11     IFEQ '0'
     C           EXTFLG    ANDEQ'N'                                                           236093
     C                     EXSR ENTR
     C                     END
     C*
     C                     END
     C*
     C* ...ELSE END PROGRAM (ie. Cmd/3)
     C*
     C                     SETON                     LR
     C*
      /TITLE         <<< INIT SR. >>>
     C*****************************************************************
     C*
     C* INIT --- SUBROUTINE TO PERFORM INITIAL PROCESSING
     C*
     C* 1. READS RUN-DATE AND FORMAT FROM DATA AREA
     C* 2. GETS DETAILS FROM *LDA, OR IF *LDA BLANK FROM SCREEN
     C*
     C* CALLED FROM MAIN POCESSING
     C*
     C* CALLS: LDA (S/R), RSCLDA (PROGRAM)
     C*
     C*****************************************************************
     C*
     C           INIT      BEGSR                           ** INIT **
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CCPG                                           S01408
     C*                                                                   S01408
     C*
     C           *NAMVAR   DEFN RUNDAT    RUNDT
     C                     IN   RUNDT
     C                     UNLCKRUNDT
     C                     Z-ADDRUND      RNDT    50
     C                     MOVE 'N'       EXTFLG  1                                           236093
     C*                                                                   S01117
     C           *NAMVAR   DEFN           ZMUSER                          S01117
     C                     IN   ZMUSER                                    S01117
     C                     UNLCKZMUSER                                    S01117
     C*                                                                   S01117
     C                     MOVE *BLANKS   ERCD                            S01117
     C                     Z-ADD1         I       20                      S01117
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       LN1273
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM           BRC                             S01117
     C                     PARM *ZERO     ERRCOD  10                      S01117
     C*                                                                   S01117
     C           ERRCOD    IFNE 0                                         S01117
     C                     SETON                     505264               S01117
     C                     MOVE ' 010'    ERCD,I                          S01117
     C                     ADD  1         I                               S01117
     C                     END                                            S01117
     C                     END                                            LN1273
     C*
     C           DATF      COMP 'M'                      98
     C           MBIN      COMP 'N'                      21               S01117
      *
      * Access SDMMODPD for modules                                       045014
      *                                                                   045014
     C                     CALL 'AOMMODR0'                                045014
     C                     PARM '*DBERR ' @RTCD   7                       045014
     C                     PARM '*FIRST ' @OPTN   7                       045014
     C           SDMMOD    PARM SDMMOD    DSFDY                           045014
      *                                                                   045014
      * Access FT Control data                                            045014
      *                                                                   045014
     C           BGFDTR    IFEQ 'Y'                                       045014
     C                     CALL 'FT0005'               9090               045014
     C           R#RTN     PARM *BLANKS   O#RTN   7                       045014
     C           C#CNTL    PARM           O#DTA 256                       045014
      *                                                                   045014
     C           *IN90     IFEQ '1'                                       045014
     C           R#RTN     ORNE *BLANKS                                   045014
     C                     MOVEL'GL4444'  DBPGM                           045014
     C                     MOVEL'*CALL   'DBFILE                          045014
     C                     MOVEL'FT0005'  DBKEY                           045014
     C                     Z-ADD1         DBASE                           045014
     C                     SETON                     U7U8LR               045014
     C                     DUMP                                           045014
     C                     RETRN                                          045014
     C                     MOVEL*BLANKS   R#RTN   7                       045014
     C                     END                                            045014
     C                     END                                            045014
      *                                                                   045014
      * Set up FT override for General Ledger Balances                    045014
      *                                                                   045014
     C           C#GLUI    IFEQ 'I'                                       045014
     C                     MOVEL'Y'       ##FTOV  1                       045014
     C                     ELSE                                           045014
     C                     MOVEL*BLANKS   ##FTOV                          045014
     C                     END                                            045014
      *                                                                   045014
     C*
     C**********           CALL 'GLC440A'                                                     236093
     C**********           PARM 'I'       @PARM   1                                           236093
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CP16                                           S01408
     C*                                                                   S01408
     C                     EXSR LDA
     C*
     C                     WRITEHEADING
     C*
     C                     SETON                     03
     C                     MOVEL'GL4444'  HBPGM   8
     C*
     C                     ENDSR                           ** INIT **
     C*
      /TITLE         <<< LDA SR. >>>
     C*****************************************************************
     C*
     C* LDA --- SUBROUTINE TO CHECK FOR LDA=BLANK
     C*
     C* CALLED FROM: MAIN PROCESSING, INIT
     C*
     C* CALLS: ENTR
     C*
     C*****************************************************************
     C*
     C           LDA       BEGSR                           ** LDA **
     C*
     C                     IN   DSLDA
     C/COPY WNCPYSRC,GL4444C012
     C           LDADTA    IFEQ *BLANKS
     C*
     C                     SETOF                     20
     C                     WRITESTATIC
     C*
     C                     ELSE
     C*
     C                     EXSR ENTR
     C*
     C                     END
     C*
     C                     ENDSR                           ** LDA **
     C*
      /TITLE         <<< ENTR SR. >>>
     C*****************************************************************
     C*
     C* ENTR --- SUBROUTINE CALLED ON ENTER BEING PRESSED
     C*
     C* 1. VALIDATES INPUT CRITERIA
     C* 2. FOR VALID INPUT, IF A/C CHANGED, GETS A/C AND CLIENT DETAILS
     C* 3. BUILDS AND DISPLAYS SUBFILE OF VALID RECORDS
     C*
     C* CALLED FROM: MAIN PROCESSING, LDA
     C*
     C* CALLS: FLDCHG, VALID, STORE, BSFIL1, BSFIL2 (S/R)
     C*        AOCUSTR0 (PROGRAM)
     C*
     C*****************************************************************
     C*
     C           ENTR      BEGSR                           ** ENTR **
     C*
     C* ONLY VALIDATE AND RE-OUTPUT IF USER I/P HAS CHANGED
     C*
     C                     EXSR FLDCHG
     C*
     C           *IN12     IFEQ '1'
     C*
     C*
     C* CLEAR ALL OLD RECORDS FROM THE SUBFILE
     C*
     C                     SETOF                     0203
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CCP8                                           S01408
     C*                                                                   S01408
     C                     WRITESFLCTLR
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CCP9                                           S01408
     C*                                                                   S01408
     C                     SETON                       03
     C*
     C                     EXSR VALID
     C*                                                                   LN1295
     C*                                                                   S01408
      * If no errors and feature not off, check user authority            CRE024
      * to account code                                                   CRE024
     C           CRE024    IFNE 'N'                                       CRE024
     C           *IN51     ANDEQ'0'                                       CRE024
     C                     CALL 'SF0930'                                  CRE024
     C                     PARM           CRE024  1                       CRE024
     C                     PARM *BLANKS   UMAUTH  1                       CRE024
     C                     PARM KCOD      UMACOD 100                      CRE024
     C**********           PARM KCUS      UMCNUM  60                                 CRE024 BUG11679
     C                     PARM KCUS      UMCNUM  6                                         BUG11679
     C                     PARM KCCY      UMCCY   3                       CRE024
     C                     PARM KASE      UMACSQ  20                      CRE024
     C                     PARM KBRC      UMBRCA  3                       CRE024
     C                     PARM 'GL4444'  UMPGM  10                       CRE024
     C                     PARM '*REPT'   UMOPTN  5                       CRE024
     C                     PARM *BLANKS   UMEMSG 50                       CRE024
      *                                                                   CRE024
      * If user not authorised, set on error indicators                   CRE024
     C           UMAUTH    IFEQ 'N'                                       CRE024
     C                     MOVEA'11'      *IN,50                          CRE024
     C                     MOVELUMEMSG    ERRDSP    P                     CRE024
     C                     END                                            CRE024
     C                     END                                            CRE024
     C/COPY WNCPYSRC,GL4444CP10                                           S01408
     C*                                                                   S01408
     C                     WRITESFLCTLR                                   LN1295
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CP11                                           S01408
     C*                                                                   S01408
     C*
     C* IF A/C HAS CHANGED ...
     C*
     C           *IN60     IFEQ '1'
     C*
     C* IF A/C IS FOR AN UNALLOCATED NOSTRO THEN DONT DISPLAY
     C*   ANY ACCOUNT DETAILS
     C*
     C           *IN15     IFEQ '1'                        ** B003
     C                     SETON                     51
     C                     MOVELEMSG,2    ANAM
     C                     END                             ** E003
     C*
     C* IF A/C VALID - SETUP ACCOUNT DETAILS
     C*
     C           *IN51     IFEQ '0'
     C*
     C                     EXSR ACDETS
     C*
     C                     SETON                     20
     C                     ELSE
     C                     SETOF                     20
     C                     END
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CP15                                           S01408
     C*                                                                   S01408
     C                     WRITESTATIC
     C*
     C*
     C                     END
     C*
     C* IF NEW USER I/P IS VALID, STORE.
     C*
     C           *IN50     IFEQ '0'
     C*
     C                     EXSR STORE
     C                     EXSR SCRN1
     C*
     C                     ELSE
     C*
     C*
     C*
     C                     END
     C*
     C* OUTPUT SUBFILE HEADING
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CCP5                                           S01408
     C*                                                                   S01408
     C                     WRITESTATIC1
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CCP6                                           S01408
     C*                                                                   S01408
     C*
     C*  IF INPUT HAS NOT CHANGED ENSURE THAT THE SUBFILE IS
     C*     REDISPLAYED AT THE SAME POSTION
     C*
     C                     ELSE
     C*
     C                     Z-ADDCPFPOS    DSPREC
     C*
     C                     END
     C*
     C                     ENDSR                           ** ENTR **
     C*
      /TITLE         <<< CMD5 SR. >>>
     C*****************************************************************
     C*
     C* CMD5 --- REFRESH SCREEN WITH CURRENT DETAILS
     C*
     C* 1. RESTORE OLD USER I/P FIELDS, IF ANY CHANGED
     C* 2. CLEAR AND RESET SUBFILE
     C* 3. RE-LOAD FROM FIRST OF SELECTED RECORDS
     C*
     C* CALLED FROM: MAIN PROCESSING
     C*
     C* CALLS: FLDCHG, RSTOR, BSFIL1, BSFIL2
     C*
     C*****************************************************************
     C*
     C           CMD5      BEGSR                           ** CMD5 **
     C*
     C* IN02 CONDITIONS CLEAR/RESET OF SUBFILE...
     C*
     C                     EXSR FLDCHG
     C*
     C           *IN12     IFEQ '1'
     C                     EXSR RSTOR
     C                     END
     C*
     C*
     C* CLEAR ALL OLD RECORDS FROM THE SUBFILE
     C*
     C                     SETOF                     0203
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CP12                                           S01408
     C*                                                                   S01408
     C                     WRITESFLCTLR
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CP13                                           S01408
     C*                                                                   S01408
     C                     SETON                       03
     C                     EXSR SCRN1
     C*
     C                     ENDSR                           ** CMD5 **
     C*
      /TITLE         <<< SCRN1 SR. >>>
     C*****************************************************************
     C*
     C* SCRN1 -- REBUILD SUBFILE FROM THE FIRST RECORD
     C*
     C* 1. RESET RELATIVE RECORD NUMBERS
     C* 2. CLEAR THE SUBFILE
     C* 3. DETERMINE IF RSACMTL1 OR RSACMTL2 IS TO BE USED
     C* 4. LOAD FIRST PAGE OF SUBFILE RECORDS
     C*
     C* CALLED FROM: ENTR, CMD5
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           SCRN1     BEGSR                           ** SCRN1 **
     C*
     C* RESET SUBFILE AND FILE RECORD POINTER
     C*
     C                     Z-ADD1         RRN     40
     C                     SETOF                     048083
     C                     SETOF                     10
     C*
     C           CQKEY     IFEQ *ZEROS
     C*
     C*  IF A '-' WAS ENTERED WE DISPLAY ANY DR/CR <= THE AMOUNT
     C*  IF A '+' WAS ENTERED OR JUST AN AMOUNT WE DISPLAY ANY
     C*      DR/CR >= THE AMOUNT
     C*
     C           PORM      IFEQ '-'
     C                     Z-ADD0         AMTKY  130
     C                     ELSE
     C                     Z-ADDAMTNUM    AMTKY
     C                     END
     C*
     C                     Z-ADD0         DORK    10
     C           KEYSL1    SETLLRSACMTL1
     C/COPY WNCPYSRC,GL4444C004
     C           KEYEQ     READERSACMTL1                 80
     C*
     C                     EXSR BSFIL1
     C*
     C                     ELSE
     C*
     C                     MOVE *BLANK    VALDA
     C*
     C           KEYSL2    SETLLRSACMTL2
     C/COPY WNCPYSRC,GL4444C005
     C           KEYEQ     READERSACMTL2                 80
     C*
     C                     EXSR BSFIL2
     C*
     C                     END
     C*
     C*  DISPLAY MESSAGE - IF NO RECORDS WERE WRITTEN TO THE SUBFILE
     C*
     C           *IN83     IFEQ '0'
     C                     MOVE EMSG,1    ERRDSP
     C/COPY WNCPYSRC,GL4444C013
     C                     SETON                     50
     C                     END
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CP22                                           S01408
     C*                                                                   S01408
     C                     ENDSR                           ** SCRN1 **
     C*
      /TITLE         <<< FLDCHG SR. >>>
     C*****************************************************************
     C*
     C* FLDCHG --- SUBROUTINE TO SET FIELDS CHANGED? INDICATORS
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           FLDCHG    BEGSR                           ** FLDCHG **
     C*
     C           MBIN      IFEQ 'Y'                                       S01117
     C           MBACNT    COMP MBACSV               6060                 S01117
     C                     ELSE                                           S01117
     C           ACNT      COMP ACSV                 6060
     C                     END                                            S01117
     C           VALDA     COMP PDSV                 6161
     C           PORM      COMP POSV                 6262
     C           AMONT     COMP AMSV                 6363
     C  N63      CQNMR     COMP CHSV                 6363
     C*
     C* IF THIS IS THE FIRST TIME INTO THE PROGRAM
     C*   OR INVALID INPUT WAS ENTERED PREVIOUSLY
     C*    THEN FORCE VALIDATION TO TAKE PLACE
     C*
     C           *IN01     IFEQ '0'
     C           *IN50     OREQ '1'
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CP19                                           S01408
     C*                                                                   S01408
     C                     SETON                     016061
     C                     SETON                     6263
     C                     END
     C*
     C/COPY WNCPYSRC,GL4444C014
     C           *IN60     IFEQ '1'
     C           *IN61     OREQ '1'
     C           *IN62     OREQ '1'
     C           *IN63     OREQ '1'
     C                     SETON                     12
     C                     ELSE
     C                     SETOF                     12
     C                     END
     C*
     C                     ENDSR                           ** FLDCHG **
     C*
      /TITLE         <<< VALID SR. >>>
     C*****************************************************************
     C*
     C* VALID --- SUBROUTINE TO PERFORM INITIAL PROCESSING
     C*
     C* 1. VALIDATES USER-I/P SEARCH CRITERIA, AND SETS APPROPRIATE
     C* ERROR INDICATORS FOR ANY INVALID FIELDS
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: ZDATE1, ZALIGN (STANDARD S/RS); AOACCTV0 (PROGRAM)
     C*        PRJBAL
     C*
     C*****************************************************************
     C*
     C           VALID     BEGSR                           ** VALID **
     C*
     C* CLEAR ERROR CODE ARRAY AND SETOF INVALID INDICATOR
     C*
     C                     MOVE *BLANKS   P@ALL
     C                     MOVE *BLANKS   ERCD
     C                     Z-ADD1         I       20
     C*
     C                     SETOF                     5051
     C                     SETOF                     646566
     C                     SETOF                     6768
     C*
     C* IF A/C FIELD HAS CHANGED...
     C*
     C           *IN60     IFEQ '1'
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CVKS                                           S01408
     C*                                                                   S01408
     C*
     C* ...VALIDATE A/C --- BLANK=>INVALID / P@RTCD<>BLANK=>NOT ON FILE
     C*
     C           CNUMR     IFEQ *BLANKS
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CVK1                                           S01408
     C*                                                                   S01408
     C                     SETON                     505164
     C                     MOVE ' 001'    ERCD,I
     C                     ADD  1         I
     C                     ELSE
     C*                                                                   LN1295
     C**  CHECK FOR BRANCH AUTHORITY NOW DONE AFTER ACCESS TO             LN1295
     C**  ACCOUNT TO PICK UP BRANCH FOR NOSTRO CODE/SHORTNAME             LN1295
     C*                                                                   LN1295
     C***********                                                   S01117LN1295
     C**CHECK*THAT*USER*IS*AUTHORISED*TO*BRANCH*****                S01117LN1295
     C***********                                                         LN1295
     C***********MBIN      IFEQ 'Y'                                 S01117LN1295
     C***********BRNCH     IFNE *BLANKS                             S01117LN1295
     C***********                                                   S01117LN1295
     C***********          CALL 'ZVBBU'                             S01117LN1295
     C***********          PARM           BRNCH                     S01117LN1295
     C***********          PARM *ZERO     ERRCOD  10                S01117LN1295
     C***********                                                   S01117LN1295
     C***********ERRCOD    IFNE 0                                   S01117LN1295
     C***********          SETON                     505264         S01117LN1295
     C***********          MOVE ' 010'    ERCD,I                    S01117LN1295
     C***********          ADD  1         I                         S01117LN1295
     C***********          END                                      S01117LN1295
     C***********          END                                      LN1273LN1295
     C***********          END                                      LN1273LN1295
     C*                                                             S01117LN1295
     C***********          ELSE                                     S01117LN1273
     C*                                                                   LN1273
     C           BRNCH     IFEQ *BLANKS                                   LN1273
     C*                                                                   S01117
     C* IF BRANCH IS LEFT BLANK AND FULL GENERAL LEDGER ACCOUNT IS USED   S01117
     C* OBTAIN DEFAULT BRANCH FROM ZMUSER                                 S01117
     C*                                                                   S01117
     C           CNUMR     IFNE *BLANKS                                   S01117
     C           CURRY     ANDNE*BLANKS                                   S01117
     C           ACCOD     ANDNE*BLANKS                                   S01117
     C           ACSEQ     ANDNE*BLANKS                                   S01117
     C                     MOVELBRC       BRNCH                           S01117
     C                     END                                            S01117
     C***********          END                                      S01117LN1273
     C***********          END                                      S01117LN1273
     C                     END                                            LN1273
     C*
     C* AOACCTV0 IS AN EXTERNAL PROGRAM WHICH ACCESSES A/C DETAILS
     C*
     C                     CALL 'AOACCTV0'
     C                     PARM           P@RTCD  7
     C                     PARM CNUMR     P@KEY1 10
     C                     PARM CURRY     P@KEY2  3
     C**********           PARM ACCOD     P@KEY3  4                                           CGL029
     C                     PARM ACCOD     P@KEY3 10                                           CGL029
     C                     PARM ACSEQ     P@KEY4  2
     C                     PARM BRNCH     P@KEY5  3                       S01117
     C                     PARM           P@TYPE  7
     C                     PARM           P@NOSN  2
     C*********************PARM           P@FMT1                          LN0130
     C           P@FMT1    PARM P@FMT1    DSSDY                           LN0130
     C*
     C* IF INVALID ACCOUNT CHECK TO SEE IF ITS AN UNALLOCATED ACCOUNT
     C*
     C                     SETOF                     15
     C           P@RTCD    IFNE *BLANKS                    ** B003
     C                     EXSR UNALOC
     C                     END                             ** E003
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CP17                                           S01408
     C*                                                                   S01408
     C*
     C           P@RTCD    IFNE *BLANKS
     C           P@RTCD    ANDNE'*ACST  '                                                     202528
     C                     SETON                     505164
     C                     MOVE ' 002'    ERCD,I
     C                     ADD  1         I
     C                     ELSE
      *                                                                                       CGL037
     C           CGL037    IFEQ 'Y'                                                           CGL037
      *                                                                                       CGL037
      ** If indicator U5 is OFF, Account Code must have Account                               CGL037
      ** Type  'R' and A/C Subtype not equal to ('V' or 'I')                                  CGL037
      *                                                                                       CGL037
     C                     SETOF                     14                                       CGL037
     C           *INU5     IFEQ '0'                        ** B004                            CGL037
     C           ATYP      IFEQ 'R'                        ** B005                            CGL037
     C                     SETON                     14                                       CGL037
     C           STYP      IFEQ 'V'                        ** B006                            CGL037
     C           STYP      OREQ 'I'                                                           CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE ' 013'    ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E006                            CGL037
     C                     ELSE                            ** X005                            CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE ' 013'    ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E005                            CGL037
     C                     ELSE                            ** X004                            CGL037
      *                                                                                       CGL037
      ** If indicator U5 is ON, then Account Type should not be                               CGL037
      ** 'R'. If it is 'R', Account Subtype must be 'V' or 'I'.                               CGL037
      *                                                                                       CGL037
     C           ATYP      IFEQ 'R'                        ** B005                            CGL037
     C                     SETON                     14                                       CGL037
     C           STYP      IFNE 'V'                        ** B006                            CGL037
     C           STYP      ANDNE'I'                                                           CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE ' 014'    ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                             ** E006                            CGL037
     C                     END                             ** E005                            CGL037
     C                     END                             ** E004                            CGL037
      *                                                                                       CGL037
     C                     ELSE                                                               CGL037
      *                                                                                       CGL037
     C           ATYP      IFEQ 'R'                                                           CGL037
     C                     SETON                     14                                       CGL037
     C                     ELSE                                                               CGL037
     C                     SETON                     505164                                   CGL037
     C                     MOVE '002'     ERCD,I                                              CGL037
     C                     ADD  1         I                                                   CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
     C                     END                                                                CGL037
      *                                                                                       CGL037
      ** Access Customer details if CGL186 is installed.                                      CGL186
      *                                                                                       CGL186
     C                     CALL 'AOCUSTR2'                                                    CGL186
     C                     PARM *BLANKS   P@RTCD  7                                           CGL186
     C                     PARM '*KEY'    P@OPTN  7                                           CGL186
     C                     PARM KCUSA     P@KEY1 10                                           CGL186
     C                     PARM           P@ANY   7                                           CGL186
     C           P@FMT4    PARM P@FMT4    DSLDY                                               CGL186
      *                                                                                       CGL186
     C/COPY WNCPYSRC,GL4444C021
     C***********ATYP      IFEQ 'R'                                       LN1295
     C*                                                                   S01117
     C*   CHECK TO SEE IF USER IS AUTHORISED TO BRANCH ASSOCIATED WITH    S01117
     C****REQUESTED*RETAIL*ACCOUNT*******                           S01117LN1295
     C*   REQUESTED ACCOUNT                                               LN1295
     C*                                                                   S01117
     C           MBIN      IFEQ 'Y'                                       LN1273
     C                     CALL 'ZVBBU'                                   S01117
     C                     PARM           KBRC                            S01117
     C***********          PARM *ZERO     ERRCOD                    S01117LN1295
     C                     PARM *ZERO     ERRCOD  10                      LN1295
     C*                                                                   S01117
     C           ERRCOD    IFNE 0                                         S01117
     C                     SETON                     505164               S01117
     C           ATYP      IFEQ 'R'                                       LN1295
     C                     MOVE '011'     ERCD,I                          S01117
     C                     ELSE                                           LN1295
     C                     MOVE '010'     ERCD,I                          LN1295
     C                     END                                            LN1295
     C                     ADD  1         I                               S01117
     C                     END                                            S01117
     C                     END                                            LN1273
     C*                                                                   LN1295
     C* CHECK TYPE OF INPUT FROM RETURNED VALUE, IF NOSTRO CODE OR        LN1295
     C* SHORTNAME OR RETAIL NO., BLANK OUT OTHER INPUT FIELDS             LN1295
     C*                                                                   LN1295
     C           P@TYPE    IFEQ '*NOSHNM'                                 LN1295
     C           P@TYPE    OREQ '*NOSTRO'                                 LN1295
     C           P@TYPE    OREQ '*RETAIL'                                 LN1295
     C                     MOVE *BLANKS   CURRY                           LN1295
     C                     MOVE *BLANKS   ACCOD                           LN1295
     C                     MOVE *BLANKS   ACSEQ                           LN1295
     C                     MOVE *BLANKS   BRNCH                           LN1295
     C                     END                                            LN1295
     C*                                                                   LN1295
     C*                                                                   S01117
     C           ATYP      IFEQ 'R'                                       LN1295
     C/COPY WNCPYSRC,GL4444C011
     C                     SETON                     14
     C                     ELSE
     C/COPY WNCPYSRC,GL4444C015
     C***********ATYP      IFEQ 'N'                                       E19970
     C**************       SETOF                     14                   E19970
     C**************       ELSE                                           E19970
     C                     SETON                     505164
     C                     MOVE '002'     ERCD,I
     C                     ADD  1         I
     C/COPY WNCPYSRC,GL4444C016
     C**************       END                                            E19970
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C* IF VALUE-DATE FIELD HAS CHANGED...
     C*
     C           *IN61     IFEQ '1'
     C*
     C* ...VALIDATE PDAT --- BLANK=>VALID / NON-BLANK: FORMAT?, <RUND?
     C*
     C           VALDA     IFNE *BLANKS
     C*
     C* VALIDATE FORMAT USING MIDAS STANDARD SUBROUTINE
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE VALDA     ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD6         ZADIG
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    ZDATE
     C           *IN99     IFEQ '1'
     C                     MOVE ' 003'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5065
     C                     ELSE
     C*
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    VALDN   50
     C           *IN99     IFEQ '1'
     C                     MOVE ' 003'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5065
     C*
     C                     END
     C                     END
     C*
     C                     ELSE
     C*
     C* IF VALUE DATE IS BLANKS THEN RESET TO ZERO
     C*
     C                     Z-ADD0         VALDN
     C*
     C                     END
     C*
     C                     END
     C*
     C* IF + OR - (PORM) FIELD HAS CHANGED
     C*
     C           *IN62     IFEQ '1'
     C*
     C           PORM      IFNE '+'
     C           PORM      ANDNE'-'
     C           PORM      ANDNE' '
     C                     MOVE ' 004'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5066
     C                     END
     C*
     C                     END
     C*
     C*
     C* IF AMOUNT FIELD HAS CHANGED
     C*
     C           *IN63     IFEQ '1'
     C           *IN60     OREQ '1'                                       E20463
     C*
     C* ACCESS CCY FILE FOR NO. OF DPS OF CURRENCY
     C*
     C                     CALL 'AOCURRR0'
     C                     PARM           P@RTCD  7
     C                     PARM '*KEY'    P@OPTN  7
     C                     PARM KCCY      P@KEY2
     C***********          PARM           P@FMT2                                              CSD006
     C           P@FMT2    PARM P@FMT2    DSSDY                                               CSD006
     C*
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE AMONT     ZFIELD
     C***********          Z-ADDA6DANB    ZADEC                           S01194
     C***********13        SUB  A6DANB    ZADIG                           S01194
     C/COPY WNCPYSRC,GL4444C017
     C                     Z-ADDA6NBDP    ZADEC                           S01194
     C           13        SUB  A6NBDP    ZADIG                           S01194
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '1'
     C                     MOVE ' 006'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5067
     C                     ELSE
     C                     MOVE ZFIELD    AMTNUM 130
     C                     END
     C*
     C                     END
     C*
     C* IF + OR - ENTERD, BUT AMOUNT IS BLANK...INVALID
     C*
     C           PORM      IFEQ '+'
     C           PORM      OREQ '-'
     C*
     C           AMTNUM    IFEQ *ZEROS
     C                     MOVE ' 005'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     506667
     C                     END
     C*
     C                     END
     C*
     C* IF CHEQUE NUMBER <> BLANK
     C*
     C           CQNMR     IFEQ *BLANKS
     C                     Z-ADD0         CQKEY
     C                     ELSE
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE CQNMR     ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD8         ZADIG
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    CQKEY   80
     C           *IN99     IFEQ '1'
     C                     MOVE ' 007'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5068
     C                     END
     C           ATYP      IFNE 'R'
     C/COPY WNCPYSRC,GL4444C018
     C                     MOVE ' 008'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5068
     C                     END
     C           AMTNUM    IFNE *ZEROS
     C                     MOVE ' 009'    ERCD,I
     C                     ADD  1         I
     C                     SETON                     5068
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR                           ** VALID **
      /TITLE         <<< UNALOC SR. >>>
     C*****************************************************************
     C*
     C* UNALOC --- SUBROUTINE TO CHECK IF UNALLOCATED NOSTRO ENTERED
     C*
     C*
     C* CALLED FROM: VALID
     C*
     C* CALLS:  NOTHING
     C*
     C*****************************************************************
     C*
     C           UNALOC    BEGSR                           ** UNALOC **
     C*
     C           KPRNOA    IFEQ '00'
     C           KPREST    ANDEQ*BLANK
     C           KEYPRN    CHAINPRONO                99
     C*
     C           *IN99     IFEQ '0'
     C                     SETON                     15
     C                     MOVE *BLANK    P@RTCD
     C                     MOVE 'N'       ATYP
     C**********           Z-ADD0         KCUS                                                CSD027
     C                     MOVE *BLANKS   KCUS                                                CSD027
     C                     Z-ADD0         KCOD
     C                     Z-ADD0         KASE
     C                     MOVE KPRCCY    KCCY
     C                     END
     C                     END
     C*
     C                     ENDSR                           ** UNALOC **
     C*
      /TITLE         <<< ROLP SR. >>>
     C*****************************************************************
     C*
     C* ROLP --- SUBROUTINE FOR ROLLUP
     C*
     C* 1. IF END OF SUBFILE GET MORE RECORDS AND SET-UP NEXT PAGE
     C* 2. IF NOT END OF SUBFILE, ROLL-UP WILL BE HANDLED BY CPF
     C*
     C* CALLED FROM: MAIN PROCESSING
     C*
     C* CALLS: FLDCHG, RSTOR, BSFIL1, BSFIL2
     C*
     C*****************************************************************
     C*
     C           ROLP      BEGSR                           ** ROLP **
     C*
     C                     EXSR FLDCHG
     C*
     C           *IN12     IFEQ '1'
     C                     EXSR RSTOR
     C                     END
     C*
     C************         Z-ADDRRN       DSPREC                          047515
     C*
     C           CQKEY     IFEQ *ZEROS
     C*
     C                     EXSR BSFIL1
     C*
     C                     ELSE
     C*
     C                     EXSR BSFIL2
     C*
     C                     END
      *                                                                   047515
      **  IF NO RECORDS SELECTED FOR DISPLAY ON NEW PAGE                  047515
      **  SET DSPREC TO RRN - 1                                           047515
      *                                                                   047515
     C           *IN81     IFEQ '1'                                       047515
     C           COUNT     ANDEQ0                                         047515
     C           RRN       SUB  1         DSPREC                          047515
     C                     END                                            047515
     C*
     C                     ENDSR                           ** ROLP **
     C*
      /TITLE         <<< BSFIL1 SR. >>>
     C*****************************************************************
     C*
     C* BSFIL1 --- BUILD SUBFILE WITH RECORDS FROM RSACMTL1
     C*
     C* 1. SETLL ACCORDING TO WHETHER + OR -, AND WHETHER START
     C*    FROM FIRST RECORD (IN20) REQUESTED OR NOT
     C* 2. BUILD SUBFILE PAGE
     C* 3. SET-UP OUTPUT SCREEN DETAILS
     C*
     C* CALLED FROM: ENTR, ROLP, CMD5
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           BSFIL1    BEGSR                           ** BSFIL1 **
     C*
     C*
     C                     Z-ADDRRN       DSPREC
     C                     Z-ADD0         COUNT   30
     C*
     C           COUNT     DOWLT12
     C           *IN80     ANDEQ'0'                                       047515
     C                     SETOF                     81
     C*
     C           *IN80     IFEQ '0'
     C           AMTNUM    IFGT 0
     C** Post amount less or equal to selected amount                     163504
     C           PORM      IFEQ '-'
     C           PSTA      IFLE AMTNUM
     C                     SETOF                     81
     C                     ELSE
     C                     SETON                     81
     C                     END
     C                     ELSE
     C** Post amount greater or equal to selected amount                  163504
     C           PORM      IFEQ '+'                                       163504
     C           PSTA      IFGE AMTNUM
     C                     SETOF                     81
     C                     ELSE
     C                     SETON                     81
     C                     END
     C** Post amount equal to selected amount                             163504
     C                     ELSE                                           163504
     C           PSTA      IFEQ AMTNUM                                    163504
     C                     SETOF                     81                   163504
     C                     ELSE                                           163504
     C                     SETON                     81                   163504
     C                     END                                            163504
     C                     END                                            163504
     C*
     C                     END
     C                     END
     C                     END
     C*
     C*  CHECK THAT THE POSTING AND VALUE DATES ARE OK BEFORE
     C*    WRITING A RECORD TO THE SUBFILE
     C*
     C                     EXSR DATEOK
     C*
     C           *IN80     IFEQ '0'
     C           *IN81     ANDEQ'0'
     C                     EXSR WRTSUB
     C                     ADD  1         COUNT
     C                     END
     C*
     C                     SETOF                     10
     C/COPY WNCPYSRC,GL4444C006
     C           KEYEQ     READERSACMTL1                 80
     C*
     C           *IN80     IFEQ '1'
     C                     SETON                     04
     C***********          Z-ADD13        COUNT                           047515
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR                           ** BSFIL1 **
     C*
      /TITLE         <<< BSFIL2 SR. >>>
     C*****************************************************************
     C*
     C* BSFIL2 --- BUILD SUBFILE WITH RECORDS FROM RSACMTL2
     C*
     C* 1. SETLL
     C* 2. BUILD SUBFILE PAGE
     C* 3. SET-UP OUTPUT SCREEN DETAILS
     C*
     C* CALLED FROM: ENTR, ROLP, CMD5
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           BSFIL2    BEGSR                           ** BSFIL2 **
     C*
     C*
     C                     Z-ADDRRN       DSPREC
     C                     Z-ADD0         COUNT   30
     C*
     C           COUNT     DOWLT12
     C           *IN80     ANDEQ'0'                                       047515
     C                     SETOF                     81
     C*
     C           *IN80     IFEQ '0'
     C           CHQN      IFGE CQKEY
     C                     SETOF                     81
     C                     ELSE
     C                     SETON                     81
     C                     END
     C                     END
     C*
     C*  CHECK THAT THE POSTING AND VALUE DATES ARE OK BEFORE
     C*    WRITING A RECORD TO THE SUBFILE
     C*
     C                     EXSR DATEOK
     C*
     C           *IN80     IFEQ '0'
     C           *IN81     ANDEQ'0'
     C                     EXSR WRTSUB
     C                     ADD  1         COUNT
     C                     END
     C*
     C                     SETOF                     10
     C/COPY WNCPYSRC,GL4444C007
     C           KEYEQ     READERSACMTL2                 80
     C*
     C           *IN80     IFEQ '1'
     C                     SETON                     04
     C***********          Z-ADD13        COUNT                           047515
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR                           ** BSFIL2 **
     C*
      /TITLE         <<< DATEOK SR. >>>
     C*****************************************************************
     C*
     C* DATEOK --- CHECK THAT THE POSTING DATE AND VALUE DATES
     C*              SATISFY THE FOLLOWING RULES BEFORE WRITING
     C*              TO THE SUBFILE
     C*
     C*  1. POSTING DATE <= RUN DATE
     C*  3. VALUE DATE > POSTING DATE
     C*  Or                                                               042779
     C*  4. Posting is for Funds Transfer                                 042779
     C*  5. Value date > Midas run date                                   042779
     C*                                                                   042779
     C*
     C* CALLED FROM: BSFIL1 BSFIL2
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           DATEOK    BEGSR                           ** DATEOK **
     C/COPY WNCPYSRC,GL4444C008
     C*
      *                                                                   042779
      *  If FUND is not blank and starts with a P then process            042779
      *  as if posting from Funds Transfer.                               042779
      *                                                                   042779
      *  Or if from CLEARPD then GETP should be G.                        042779
      *                                                                   042779
     C           *IN10     IFEQ '1'                                       042779
     C                     MOVELFUND      #C1     1                       042779
     C                     END                                            042779
     C           #C1       IFEQ 'P'                                       042779
     C           *IN10     ANDEQ'1'                                       042779
     C           ##FTOV    ANDEQ'Y'                                       045014
     C           GETP      OREQ 'G'                                       042779
     C           *IN10     ANDEQ'0'                                       042779
     C           ##FTOV    ANDEQ'Y'                                       045014
     C/COPY WNCPYSRC,GL4444C002
     C           VALD      IFLE RNDT                                      042779
     C/COPY WNCPYSRC,GL4444C003
     C                     SETON                     81                   042779
     C                     END                                            042779
     C                     ELSE                                           042779
     C           PSTD      IFGT RNDT
     C                     SETON                     81
     C                     END
     C*
     C           VALD      IFLE PSTD
     C                     SETON                     81
     C                     END
     C/COPY WNCPYSRC,GL4444C009
     C                     END                                            042779
     C/COPY WNCPYSRC,GL4444C010
     C*
     C                     ENDSR                           ** DATEOK **
     C*
      /TITLE         <<< STORE SR. >>>
     C*****************************************************************
     C*
     C* STORE --- STORE I/P FIELDS IN 'SAVE' FIELDS
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           STORE     BEGSR                           ** STORE **
     C*
     C           MBIN      IFEQ 'Y'                                       S01117
     C**********           MOVE MBACNT    MBACSV 22                                    S01117 CGL029
     C                     MOVE MBACNT    MBACSV 28                                           CGL029
     C                     ELSE                                           S01117
     C**********           MOVE ACNT      ACSV   19                                           CGL029
     C                     MOVE ACNT      ACSV   25                                           CGL029
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE VALDA     PDSV    6
     C                     MOVE PORM      POSV    1
     C                     MOVE AMONT     AMSV   14
     C                     MOVE CQNMR     CHSV    8
     C*
     C                     ENDSR                           ** STORE **
     C*
      /TITLE         <<< RSTOR SR. >>>
     C*****************************************************************
     C*
     C* RSTOR --- RESTORE I/P FIELDS FROM 'SAVE' FIELDS
     C*
     C           RSTOR     BEGSR                           ** RSTOR **
     C*
     C           MBIN      IFEQ 'Y'                                       S01117
     C**********           MOVE MBACSV    MBACNT 22                                    S01117 CGL029
     C                     MOVE MBACSV    MBACNT                                              CGL029
     C                     ELSE                                           S01117
     C                     MOVE ACSV      ACNT
     C                     END                                            S01117
     C*                                                                   S01117
     C                     MOVE PDSV      VALDA
     C                     MOVE POSV      PORM
     C                     MOVE AMSV      AMONT
     C                     MOVE CHSV      CQNMR
     C*
     C                     ENDSR                           ** RSTOR **
     C*
      /TITLE         <<< WRTSUB SR. >>>
     C*****************************************************************
     C*
     C* WRTSUB --- WRITE RECORD TO SUBFILE
     C*
     C* 1. FORMATS OUTPUT FIELDS VIA STANDARD SUBROUTINES
     C* 2. WRITES RECORD TO SUBFILE
     C*
     C* CALLED FROM: BSFIL1, BSFIL2
     C*
     C* CALLS: ZDATE2, ZFRPED (STANDARD S/RS)
     C*
     C*****************************************************************
     C*
     C           WRTSUB    BEGSR                           ** WRTSUB **
     C*
     C                     Z-ADDPSTD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    POSDZ
     C*
     C                     Z-ADDVALD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    VALDZ
     C*
     C           DRCR      IFEQ 1
     C           PSTA      MULT -1        PSTA
     C                     END
     C                     Z-ADDPSTA      ZFLD15
     C***********          Z-ADDA6DANB    ZDECS                           S01194
     C                     Z-ADDA6NBDP    ZDECS                           S01194
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    PSTAZ
      *                                                                   BHF677
      * Format Cheque Number for output where included                    BHF677
     C                     MOVELCHQN      @CHQN   8                       BHF677
     C           @CHQN     IFEQ '00000000'                                BHF677
     C                     MOVE *BLANKS   @CHQN                           BHF677
     C                     END                                            BHF677
     C*
     C*  WHEN A RECORD HAS BEEN READ FROM RSACMTPD PRINT THE NARRATIVE
     C*  DESCRIPTION, BUT IF BLANK THEN EXPAND FROM THE NARR. CODE.
     C*
     C           *IN10     IFEQ '1'
     C                     MOVE *BLANK    PNAR
     C                     MOVE TNMR      TRAT                                              MD051749
     C           NRTD      IFNE *BLANK
     C                     MOVE NRTD      PNAR
     C                     ELSE
     C********   NRTC      IFNE 0                                         080050
     C           NRTC      IFNE *BLANKS                                   080050
     C           NRTC      ANDNE*ZERO                                     080050
     C                     MOVE NRTC      WFLD2   2
     C                     CALL 'AONARRR0'
     C                     PARM           P@RTCD
     C                     PARM '*KEY'    P@OPTN
     C                     PARM WFLD2     P@KEY4
     C***********          PARM           P@FMT3                                              CSD006
     C           P@FMT3    PARM P@FMT3    DSFDY                                               CSD006
     C           P@RTCD    IFEQ *BLANK
     C***********          MOVE ALANTX    PNAR                            S01194
     C                     MOVE ALDON     PNAR                            S01194
     C                     ELSE                                           080050
     C                     MOVE NRTC      PNAR                            080050
     C                     END
      *                                                                   042779
      *  If still blank use transaction reference                         042779
      *                                                                   042779
     C                     ELSE                                           042779
     C                     MOVEL*BLANKS   PNAR                            042779
     C           FUND      IFEQ *BLANKS                                   042779
     C                     MOVELTNMR      PNAR                            042779
     C                     ELSE                                           042779
     C                     MOVELFUND      PNAR                            042779
     C                     END                                            042779
     C                     END
     C                     END
     C                     END
     C*
     C           *IN82     IFEQ '1'                                       S01472
     C                     MOVELSPOS      ABTCH2  2                       S01472
     C*                                                                   S01472
     C*  If the posting is not a batch posting, the first 2 characters    S01472
     C*     will be blank, so the batch number will be blank              S01472
     C*                                                                   S01472
     C           ABTCH2    IFEQ *BLANKS                                   S01472
     C******               MOVE *BLANKS   ABTCH   3                S01472 107938
     C**********           MOVELPNAR      PNARZ                                      107938 MD046592
     C                     MOVE *BLANKS   ABTCH                                             MD046592
     C                     ELSE                                           S01472
     C******               MOVELSPOS      ABTCH                    S01472 107938
     C                     MOVELSPOS      ABTCH   3                       107938
     C**********           MOVELPNAR      PNARZ2 26                                  107938 MD046592
     C**********           MOVE *BLANKS   PNARZ                                      107938 MD046592
     C**********           MOVE ABTCH     PNARZ                                      107938 MD046592
     C**********           MOVELPNARZ2    PNARZ                                      107938 MD046592
     C                     END                                            S01472
     C*                                                                   S01472
     C**********           ELSE                                                      107938 MD046592
     C**********           MOVELPNAR      PNARZ                                      107938 MD046592
     C                     END                                            S01472
     C*                                                                   S01472
     C********** TNMR      IFNE PNARZ                                              BUG10942 MD046592
     C**********           MOVE TNMR      PNARZ                                    BUG10942 MD046592
     C**********           ENDIF                                                   BUG10942 MD046592
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CCP1                                           S01408
     C*                                                                   S01408
     C                     WRITESFLRCD
     C*                                                                   S01408
     C/COPY WNCPYSRC,GL4444CCP2                                           S01408
     C*                                                                   S01408
     C*
     C                     ADD  1         RRN
     C                     SETON                     0283
     C*
     C                     ENDSR                           ** WRTSUB **
     C*
      /TITLE         <<< ACDETS SR. >>>
     C*****************************************************************
     C*
     C* ACDETS --- SET-UP STATIC DISPLAY DATA
     C*
     C* 1. FORMATS OUTPUT FIELDS VIA STANDARD SUBROUTINES
     C*
     C* CALLED FROM: ENTR
     C*
     C* CALLS: ZDATE2, ZFRPED
     C*
     C*****************************************************************
     C*
     C           ACDETS    BEGSR                           ** ACDETS **
     C*
     C                     Z-ADDCLBL      ZFLD15
     C***********          Z-ADDA6DANB    ZDECS                           S01194
     C                     Z-ADDA6NBDP    ZDECS                           S01194
     C                     MOVE 'A'       ZECODE
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    OPNBAL 22
     C*
     C                     ENDSR                           ** ACDETS **
     C*
      /TITLE         <<< ZDATE1 SR. >>>
     C********************************************************************
     C**
     C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
     C**              CONVERT TO A NUMBER OF DAYS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE1    BEGSR                           ***  ZDATE1 ***
     C**
     C**   CLEAR DAY NUMBER.
     C                     Z-ADD0         ZDAYNO  50
     C**
     C**   CALCULATION TO DEFINE INPUT DATE FIELD.
     C                     Z-ADDZDATE     ZDATE   60
     C**
     C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
     C                     MOVE ZDATE     ZYEAR   20
     C  N98                MOVELZDATE     ZDAY    20
     C   98                MOVELZDATE     ZMTH    20
     C                     MOVE ZDATE     ZWRK4   40
     C  N98                MOVELZWRK4     ZMTH
     C   98                MOVELZWRK4     ZDAY
     C**
     C**   ENSURE MONTH IS VALID.
     C           ZMTH      COMP 0                      9999
     C  N99      ZMTH      COMP 12                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR 30 DAY MONTHS.
     C           ZMTH      COMP 4                        90IF 90 ON, 30
     C  N90      ZMTH      COMP 6                        90DAY MONTH.
     C  N90      ZMTH      COMP 9                        90
     C  N90      ZMTH      COMP 11                       90
     C**
     C**   ENSURE DAY IS VALID.
     C           ZDAY      COMP 0                      9999
     C   90N99   ZDAY      COMP 30                   99
     C  N90N99   ZDAY      COMP 31                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   CHECK FOR LEAP YEAR AND FEBRUARY.
     C           ZYEAR     ADD  28        ZYEAR
     C           ZYEAR     DIV  4         ZLYR    20
     C                     MVR            ZLY     10     91LEAP YR, 91 ON
     C           ZMTH      COMP 2                    93  92FEB., 92 ON
     C**                                                   PAST FEB, 93 ON
     C**   IF FEBUARY FURTHER VALIDATE DAY.
     C  N91 92   ZDAY      COMP 28                   99
     C   91 92   ZDAY      COMP 29                   99
     C   99                GOTO ZDEND1                     BYPASS IF ERROR
     C**
     C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
     C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
     C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
     C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
     C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
     C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
     C**
     C           ZDEND1    ENDSR                           ***  ZDEND1 ***
     C**
     C**
     C********************************************************************
      /TITLE         <<< ZALIGN SR. >>>
     C********************************************************************
     C**
     C**   ZALIGN SR. TO VALIDATE AND RIGHT-ALIGN NUMERIC FIELDS.
     C**
     C           ZALIGN    BEGSR                           *** ZALIGN ***
     C**
     C                     SETOF                     929399
     C**
     C**   SAVE INPUT FIELD IN ARRAY, ZA1.
     C                     MOVEAZFIELD    ZA1
     C**
     C**   CALCULATION TO DEFINE NUMBER STRUCTURE CONTROL FIELDS.
     C                     Z-ADDZADIG     ZADIG   20
     C                     Z-ADDZADEC     ZADEC   10
     C**
     C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
     C                     MOVE ' '       ZA2
     C                     MOVEAZA2       ZFIELD 16
     C                     Z-ADD0         ZX      20
     C                     Z-ADD0         ZY      20
     C**
     C**   ENSURE REQUIRED STRUCTURE OF FIELD IS VALID.
     C           ZADIG     ADD  ZADEC     ZZ      20
     C           ZZ        COMP 15                   99
     C   99                GOTO ZAEND
     C**
     C**   LOOP TO FIND DECIMAL POINT, BLANKS AND CHARACTERS.
     C           ZATAG1    TAG                             ** ZATAG1 TAG *
     C           ZX        ADD  1         ZX
     C**
     C**   CHECK FOR DECIMAL POINT. ERROR IF SECOND DECIMAL POINT.
     C           ZA1,ZX    COMP '.'                      90
     C   90 93             SETON                     99
     C   99                GOTO ZAEND
     C**
     C**
     C**   CHECK FOR 'M' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'M'                      96
     C   96                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 9                    99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CHECK FOR 'T' CONSTANT. ERROR IF NOT LAST CHARACTER ENTERED
     C           ZA1,ZX    COMP 'T'                      97
     C   97                DO
     C           ZX        COMP 15                   99  99
     C   99                GOTO ZAEND
     C           ZX        ADD  1         ZX
     C           ZA1,ZX    COMP ' '                  9999
     C   99                GOTO ZAEND
     C           ZX        SUB  1         ZX
     C           ZX        COMP 12                   99
     C   99                GOTO ZAEND
     C                     END
     C**
     C**   CLEAR ALPHAMERIC CONSTANT FROM ZA1
     C   96
     COR 97                MOVE ' '       ZA1,ZX
     C**
     C**   CHECK FOR BLANKS. BYPASS FOR FIRST BLANK AFTER A DIGIT.
     C           ZA1,ZX    COMP ' '                      91
     C   91 92             GOTO ZATAG2
     C**
     C**   CHECK FOR NUMERIC, IF NOT '.' OR ' '.
     C  N90N91   ZA1,ZX    COMP '0'                    99
     C  N90N91N99ZA1,ZX    COMP '9'                  99
     C   99                GOTO ZAEND                      NOT NUMERIC
     C**
     C**   STORE DIGITS IN ARRAY AND HOW MANY.
     C**   ZY, TOTAL OF DIGITS IN THE INPUT FIELD.
     C**   ZZ, TOTAL OF DIGITS TO THE LEFT OF DECIMAL POINT.
     C  N90N91   ZY        ADD  1         ZY         92
     C  N90N91             MOVE ZA1,ZX    ZA2,ZY
     C   90                Z-ADDZY        ZZ         93  93
     C**
     C           ZX        COMP 16                     94  CHECK IF ALL
     C   94                GOTO ZATAG1
     C**
     C           ZATAG2    TAG                             ** ZATAG2 TAG *
     C**
     C**   IF 'M' SPECIFIED, MULTIPLY ZA1 BY 1 MILLION
     C   96      ZZ        ADD  6         ZZ
     C**
     C**   IF 'T' SPECIFIED, MULTIPLY ZA1 BY 1 THOUSAND
     C   97      ZZ        ADD  3         ZZ
     C**
     C**   FILL IN ZEROS IN ANY BLANKS LEFT OF DECIMAL POINT
     C   96 93
     COR 97 93   ZZ        DOWGTZY
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF CONSTANT SPECIFIED WITH NO DECIMAL POINT ZEROISE BLANKS
     C   96N93             DO   6
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C   97N93             DO   3
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C                     END
     C**
     C**   IF NO DECIMAL POINT FOUND, SET TOTAL FIELD ZZ.
     C  N93                Z-ADDZY        ZZ
     C**
     C**   CHECK FOR EMBEDDED BLANKS.
     C   91 92             MOVEAZA1,ZX    ZFIELD
     C   91 92   ZFIELD    COMP ' '                  9999
     C   99                GOTO ZAEND                      EMBEDDED BLANK
     C**
     C**   ENSURE THAT NUMBER OF DIGITS ENTERED EITHER SIDE
     C**   OF DECIMAL POINT ARE NOT MORE THAN ALLOWED.
     C           ZZ        COMP ZADIG                99
     C           ZY        SUB  ZZ        ZX
     C  N99      ZADEC     SUB  ZX        ZX           9995
     C   99                GOTO ZAEND
     C   95                GOTO ZATAG4                     NO TRAILING
     C**                                                   BLANKS.
     C**   FILL THE TRAILING BLANKS WITH ZEROS.
     C           ZY        ADD  ZX        ZZ
     C           ZATAG3    TAG                             ** ZATAG3 TAG *
     C           ZY        ADD  1         ZY
     C                     MOVE '0'       ZA2,ZY
     C           ZY        COMP ZZ                     94
     C   94                GOTO ZATAG3
     C**
     C**   RIGHT-ALIGN THE VALUE BY MOVING BACK TO ARRAY, ZA1.
     C           ZATAG4    TAG                             ** ZATAG4 TAG *
     C                     MOVE '0'       ZA1
     C                     Z-ADD16        ZX
     C           ZATAG5    TAG                             ** ZATAG5 TAG *
     C           ZY        COMP 0                        94
     C   94                GOTO ZATAG6
     C                     MOVE ZA2,ZY    ZA1,ZX
     C           ZY        SUB  1         ZY
     C           ZX        SUB  1         ZX
     C                     GOTO ZATAG5
     C           ZATAG6    TAG                             ** ZATAG6 TAG *
     C**
     C**   MOVE VALIDATED AND RIGHT-ALIGNED NUMBER BACK INTO ZFIELD.
     C                     MOVEAZA1       ZFIELD
     C**
     C                     SETOF                     9697
     C**
     C           ZAEND     ENDSR                           * ZAEND ENDSR *
     C**
     C**
     C********************************************************************
      /TITLE         <<< ZFRPED SR. >>>
     C********************************************************************
     C**                                                                 *
     C** ZFRPED subroutine to insert a decimal point and sign into a     *
     C** numeric field and to blank out leading zeros (optionaly         *
     C** inserting commas).                                              *
     C**     Input fields:   ZFLD15 15/0                                 *
     C**                     ZDECS  1/0                                  *
     C**                     ZECODE 1/  ('A','C','J','L' or blank)       *
     C**                                ( Default is 'J')                *
     C**     Arrays:         ZS1    15/1/0                               *
     C**                     ZS2    22/1/                                *
     C**                                                                 *
     C**     Output fields:  ZOUT22 22                                   *
     C**     Output fields:  ZOUT25 25  (ALIGNED BY DECIMAL POINT)       *
     C**          (The last 2 characters will be '  ','CR',or '- ')      *
     C**
     C           ZFRPED    BEGSR                           **  ZFRPED   *
     C*
     C* Define/Clear fields
     C*
     C                     Z-ADDZFLD15    ZFLD15 150
     C                     Z-ADDZDECS     ZDECS   10
     C                     MOVE ZECODE    ZECODE  1
     C                     MOVE *BLANKS   ZOUT22 22
     C                     MOVE *BLANKS   ZOUT25 25
     C           ZECODE    IFEQ *BLANKS
     C                     MOVE 'J'       ZECODE
     C                     END
     C*
     C*       SET UP WORK FIELDS
     C*
     C                     Z-ADD0         ZS1
     C                     MOVE ' '       ZS2
     C*
     C                     Z-ADD15        Z1      20
     C                     Z-ADD20        Z2      20
     C*
     C           15        SUB  ZDECS     ZINTS   20
     C*
     C* Check if numeric field is negative
     C*
     C           ZFLD15    IFLT *ZEROS
     C           ZECODE    IFEQ 'A'
     C           ZECODE    OREQ 'C'
     C                     MOVEA'CR'      ZS2,21
     C                     ELSE
     C                     MOVE '-'       ZS2,21
     C                     END
     C                     Z-SUBZFLD15    ZFLD15
     C                     END
     C*
     C                     Z-ADDZFLD15    ZWRK15
     C*
     C*       CHECK TO SEE IF THERE ARE ANY DECIMAL PLACES
     C*
     C           ZDECS     CABEQ0         ZS10
     C*
     C*       SET UP DECIMALS
     C*
     C                     Z-ADD*ZEROS    ZCNT    10
     C           ZCNT      DOUEQZDECS
     C                     MOVE ZS1,Z1    ZS2,Z2
     C                     SUB  1         Z2
     C                     ADD  1         ZCNT
     C                     SUB  1         Z1
     C                     END
     C*
     C*       PUT IN DECIMAL PLACE
     C*
     C                     MOVE '.'       ZS2,Z2
     C                     SUB  1         Z2
     C*
     C           ZS10      TAG                             ** ZS10 TAG **
     C*
     C*       SET UP INTEGERS
     C*
     C                     Z-ADD*ZEROS    CNT3    10
     C           Z1        DOUEQ*ZEROS
     C                     MOVE ZS1,Z1    ZS2,Z2
     C                     SUB  1         Z1
     C                     SUB  1         Z2
     C*
     C* If edit code is 'J', insert a ',' before each group of three
     C* digits - not if beginning of array reached.
     C*
     C           Z2        IFGT *ZEROS
     C           ZECODE    ANDEQ'J'
     C           Z2        ORGT *ZEROS
     C           ZECODE    ANDEQ'A'
     C                     ADD  1         CNT3
     C           CNT3      IFEQ 3
     C                     MOVE ','       ZS2,Z2
     C                     SUB  1         Z2
     C                     Z-ADD*ZEROS    CNT3
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*       PUT IN LEADING BLANKS
     C*
     C                     Z-ADD1         Z2
     C           ZS2,Z2    DOWEQ'0'
     C           ZS2,Z2    OREQ ' '
     C           ZS2,Z2    OREQ ','
     C                     MOVE ' '       ZS2,Z2
     C                     ADD  1         Z2
     C           Z2        CABEQ23        ZS20
     C                     END
     C*
     C*       IF NO INTEGERS PUT IN LEADING ZERO
     C*
     C           ZS20      TAG                             ** ZS20 TAG **
     C*
     C           Z2        IFEQ 23
     C                     SUB  2         Z2
     C                     MOVE '0'       ZS2,Z2
     C                     ELSE
     C*
     C           ZS2,Z2    IFEQ '.'
     C                     SUB  1         Z2
     C                     MOVE '0'       ZS2,Z2
     C                     END
     C                     END
     C*
     C*       SET UP OUTPUT FIELD
     C*
     C                     MOVEAZS2       ZOUT22
     C*
     C           ZDECS     IFEQ 0
     C                     MOVE ZOUT22    ZOUT0
     C                     ELSE
     C**
     C           ZDECS     IFEQ 1
     C                     MOVE ZOUT22    ZOUT1
     C                     ELSE
     C**
     C           ZDECS     IFEQ 2
     C                     MOVE ZOUT22    ZOUT2
     C                     ELSE
     C**
     C                     MOVE ZOUT22    ZOUT3
     C                     END
     C**
     C                     END
     C**
     C                     END
     C**
     C                     ENDSR
     C*
     C*
      /TITLE         <<< ZDATE2 SR. >>>
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR LEAP YEAR WORK FIELD.
     C                     MOVE 'N'       ZLEAP   1
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50
     C           ZDAYN1    IFLT 0
     C                     GOTO ZDEND2
     C                     END
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    IFGE ZYDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG1
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C           ZWRK2     IFNE 0
     C           ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C                     END
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C           ZWRK2     IFEQ 0
     C           ZDAYN1    IFEQ 59
     C                     MOVE 'Y'       ZLEAP
     C                     END
     C           ZDAYN1    IFGE 59
     C           ZDAYN1    SUB  1         ZDAYN1
     C                     END
     C                     END
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    IFGE ZMDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG2
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C           ZLEAP     IFEQ 'Y'
     C           ZDAY      ADD  1         ZDAY
     C                     END
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C                     MOVELZDAY      ZWRK5   5
     C           ZDAY      IFLT 10
     C                     MOVEL' '       ZWRK5
     C                     END
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C**
      /TITLE         <<< *PSSR SR. >>>
     C*****************************************************************
     C*
     C* *PSSR  --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS
     C*
     C* CALLED FROM: AFTER ABNORNAL OPERATION OCCURS
     C*
     C* CALLS: NOTHING
     C*
     C*****************************************************************
     C*
     C           *PSSR     BEGSR                           ** *PSSR **
     C*
     C           DBASE     IFGT 0
     C                     MOVEL'GL4444'  DBPGM
     C                     SETON                     U7U8
     C                     END
     C*
     C                     DUMP
     C*
     C                     ENDSR'*CANCL'                   ** *PSSR **
     C********************************************************************
      /TITLE         <<< ARRAY DATA >>>
     C/COPY WNCPYSRC,GL4444C001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   EMSG - ERROR MESSAGE
No Postings To Display For This Selection
UNALLOCATED NOSTRO
     X/COPY WNCPYSRC,GLH00342
**  CPY@
(c) Finastra International Limited 2001
