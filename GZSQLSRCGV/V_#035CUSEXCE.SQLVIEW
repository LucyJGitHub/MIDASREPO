/************************************************************************************/
/*                                                                                  */
/*       Midas - Global Processing Module                                           */
/*                                                                                  */
/*       V_#CUSEXCE - Global Customer Exchanges Detail                              */
/*                                                                                  */
/*       (c) Finastra International Limited 2003                                    */
/*                                                                                  */
/*       Last Amend No. MD046248           Date 27Oct17                        */
/*       Prev Amend No. MD035657           Date 13Nov15                        */
/*                      CRE041             Date 28Sep12                        */
/* Bank Fusion Midas 1.4 Base ------------------------------------------------------*/
/*                      CSC041             Date 26Nov09                             */
/* Midas Plus 1.4 Base 04 ----------------------------------------------------------*/
/*                      BG18886            Date 30May08                             */
/*                      BUG13326           Date 22Feb07                             */
/* Midas Plus 1.3 ---------------- Base --------------------------------------------*/
/*                      CSD031             Date 10Apr06                             */
/*                      CDL049             Date 07Jul06                             */
/*                      CSD027             Date 18Dec05                             */
/*                      BUG8517            Date 19Sep05                             */
/*                      BUG7764            Date 09Sep05                             */
/*                      BUG8246R           Date 26Aug05                             */
/*                      BUG8246            Date 24Aug05                             */
/*                      BUG4897            Date 01Jun05                             */
/*                      BUG3355            Date 22Jun04                             */
/*                      BUG2304            Date 30Apr04                             */
/*                      BUG1680 *CREATE    Date 30Mar04                             */
/*                                                                                  */
/*----------------------------------------------------------------------------------*/
/*                                                                                  */
/*       MD046248 - Finastra Rebranding                                        */
/*       MD035657 - Unauthorised transaction appear with a status of active in the  */
/*                  main list. Show status as complete instead.                     */
/*       CRE041 - Enhancements to Customer Exchanges                                */
/*       CSC041  - 4-Eyes Checking Gaps                                             */
/*       BG18886 - Amend non-standard codes.                                        */
/*       BUG13326 - Retail A/C nos - Charges Account Field has Strange Values       */
/*       CSD031 - Enhanced Centralised Static Data (Recompile)                      */
/*       CDL049 - Addition of a Reference Rate field                                */
/*       CSD027 - Conversion Of Customer Number to Alpha                            */
/*       BUG8517 - Listview fails with missing CRCY column.                         */
/*                 Moved CRCY and DRCY in next line as it doesn't appear to         */
/*                 be picked up and created during compilation.                     */
/*                 (Code changes were already covered by BUG8246)                   */
/*       BUG7764 - Fields not defined correctly - same fix as 8246 for MP1.2        */
/*       BUG8246R - CUSX: A Midas Plus error has occurred.                          */
/*       BUG8246 - CUSX: A Midas Plus error has occurred.                           */
/*       BUG4897 - Listview shows zero retail account numbers                       */
/*       BUG3355 - Standing Orders changes for MidasPlus.                           */
/*       BUG2304 - Various file layout changes. Recompile.                          */
/*       BUG1680 - Customer Exchanges has missing view V_CUSEXCE                    */
/*                                                                                  */
/************************************************************************************/
  CREATE VIEW                                                                        :
  **********/**********                                                              :
  AS                                                                                 :
  SELECT                                                                             :
***IPDN,**DRBR,**VALD,**DIGITS(DCUS)*AS*PADDCUS,*DCUS,*******************************:        CSD027
   IPDN,  DRBR,  VALD,         DCUS  AS PADDCUS, DCUS,                               :        CSD027
   DIGITS(DCOD) AS PADDCOD, DCOD,  DIGITS(DACS) AS PADDACS,                          :
***DACS,**DIGITS(DRAN)*AS*PADDRAN,*DRAN,**DRCY,**************************************:       BUG4897
***DACS,*CASE*WHEN*DRAN*=*0*THEN*''*ELSE*DIGITS(DRAN)*END*AS*PADDRAN,*DRAN,*DRCY,** BUG4897 BUG8246R
***DRNA,**DIGITS(CHQN)*AS*PADCHQN,*CHQN,**DIGITS(CCUS)*AS*PADCCUS,*******************:      BUG8246R
   DACS,  CASE WHEN DRAN = 0 THEN '' ELSE DIGITS(DRAN) END AS PADDRAN, DRAN,         :      BUG8246R
***DRCY,**DRNA,*DIGITS(CHQN)*AS*PADCHQN,*CHQN,*DIGITS(CCUS)*AS*PADCCUS,**************:BUG8246RCSD027
   DRCY,  DRNA, DIGITS(CHQN) AS PADCHQN, CHQN,        CCUS  AS PADCCUS,              :        CSD027
   CCUS,  DIGITS(CCOD) AS PADCCOD, CCOD,  DIGITS(CACS) AS PADCACS,                   :
***CACS,**DIGITS(CRAN)*AS*PADCRAN,*CRAN,**CRCY,*CRNA,********************************:       BUG4897
***CACS,*CASE*WHEN*CRAN*=*0*THEN*''*ELSE*DIGITS(CRAN)*END*AS*PADCRAN,*CRAN,*CRCY,*** BUG4897 BUG8246
***EXRT,**ORIN,**********************************************************************:       BUG4897
***CRNA,**EXRT,*ORIN,*************************************************************** BUG4897 BUG8246
   CACS,  CASE WHEN CRAN = 0 THEN '' ELSE DIGITS(CRAN) END AS PADCRAN, CRAN,         :       BUG8246
   CRCY,  CRNA, EXRT, ORIN,                                                          :       BUG8246
***MCBD,**DIGITS(HCUS)*AS*PADHCUS,***************************************************:        CSD027
   MCBD,         HCUS  AS PADHCUS,                                                   :        CSD027
   HCUS,  DIGITS(HACD) AS PADHACD, HACD,  DIGITS(HASQ) AS PADHASQ,                   :
***HASQ,**HSGN,**DIGITS(CHRN)*AS*PADCHRN,*CHRN,**************************************:        CSC041
***SWCR,**ZZ026,**CBRC,**PRFC,**BRCA,************************************************:        CSC041
   HASQ,  HSGN, CASE WHEN CHRN = 0 THEN '' ELSE DIGITS(CHRN) END AS PADCHRN,         :        CSC041
   CHRN, SWCR,  ZZ026,  CBRC,  PRFC,  BRCA,                                          :        CSC041
***CHTP,**TNLU,**FXMP,**ORAT,**FXIN,*************************************************:        CDL049
   CHTP,  TNLU,  FXMP,  ORAT,  FXIN, RRAT,                                           :        CDL049
***RECI,**DRBR**DIGITS(DCUS)**DRCY**DIGITS(DCOD)**DIGITS(DACS)*AS*DRAC,**************:        CSD027
***DIGITS(DCUS)**DRCY**DIGITS(DCOD)**DIGITS(DACS)*AS*DRACS,**************************:BUG3355 CSD027
***CBRC**DIGITS(CCUS)**CRCY**DIGITS(CCOD)**DIGITS(CACS)*AS*CRAC,*********************:        CSD027
***DIGITS(CCUS)**CRCY**DIGITS(CCOD)**DIGITS(CACS)*AS*CRACS,**************************:BUG3355 CSD027
***(CASE*WHEN*HSGN*=*'+'*THEN*DRBR*ELSE*CBRC*END)**DIGITS(HCUS)**********************:        CSD027
***RECI,  DRBR**       DCUS **DRCY**DIGITS(DCOD)**DIGITS(DACS) AS DRAC,              :CSD027 BG18886
**********DCUS **DRCY**DIGITS(DCOD)**DIGITS(DACS) AS DRACS,                          :CSD027 BG18886
***CBRC**       CCUS **CRCY**DIGITS(CCOD)**DIGITS(CACS) AS CRAC,                     :CSD027 BG18886
**********CCUS **CRCY**DIGITS(CCOD)**DIGITS(CACS) AS CRACS,                          :CSD027 BG18886
   RECI, DRBR CONCAT DCUS CONCAT DRCY CONCAT DIGITS(DCOD) CONCAT DIGITS(DACS)        :CSD027 BG18886
     AS DRAC,                                                                        :CSD027 BG18886
     DCUS CONCAT DRCY CONCAT DIGITS(DCOD) CONCAT DIGITS(DACS) AS DRACS,              :CSD027 BG18886
   CBRC CONCAT CCUS CONCAT CRCY CONCAT DIGITS(CCOD) CONCAT DIGITS(CACS) AS CRAC,     :CSD027 BG18886
          CCUS CONCAT CRCY CONCAT DIGITS(CCOD) CONCAT DIGITS(CACS) AS CRACS,         :CSD027 BG18886
   (CASE WHEN HCUS = '' THEN '' ELSE                                                 :      BUG13326
***(CASE WHEN HSGN = '+' THEN DRBR ELSE CBRC END)**       HCUS **********************:CSD027 BG18886
   (CASE WHEN HSGN = '+' THEN DRBR ELSE CBRC END) CONCAT  HCUS CONCAT                :CSD027 BG18886
***(CASE WHEN HSGN = '+' THEN DRCY ELSE CRCY END)**DIGITS(HACD)**********************:      BUG13326
***CASE WHEN HSGN = '+' THEN DRCY ELSE CRCY END **DIGITS(HACD)***********************:BG13326BG18886
   CASE WHEN HSGN = '+' THEN DRCY ELSE CRCY END CONCAT DIGITS(HACD) CONCAT           :BG13326BG18886
***DIGITS(HASQ) AS CHAC,*************************************************************:      BUG13326
   DIGITS(HASQ) END) AS CHAC,                                                        :      BUG13326
***DIGITS(HCUS)**(CASE*WHEN*HSGN*=*'+'*THEN*DRCY*ELSE*CRCY*END)**DIGITS(HACD)********:BUG3355 CSD027
**********HCUS **(CASE WHEN HSGN = '+' THEN DRCY ELSE CRCY END)**DIGITS(HACD)**      :CSD027 BG18886
          HCUS CONCAT (CASE WHEN HSGN = '+' THEN DRCY ELSE CRCY END) CONCAT          :CSD027 BG18886
           DIGITS(HACD) CONCAT                                                       :CSD027 BG18886
   DIGITS(HASQ) AS CHACS,                                                            :       BUG3355
***CASE*WHEN*RECI*=*'D'*THEN*'Y'*ELSE*'N'*END*AS*STATUS,*****************************:        CRE041
   CASE WHEN RECI = 'D' THEN 'Y'                                                     :        CRE041
        WHEN RECI = 'H' THEN 'H'                                                     :        CRE041
        WHEN RECI = 'Z' THEN 'C'                                                     :      MD035657
        WHEN RECI <> 'D' AND RECI <> 'H' AND RECI <> 'Z' THEN 'N' END AS STATUS,     :      MD035657
        IUSR, AUSR,                                                                  :      MD035657
********WHEN*RECI*<>*'D'*AND*RECI*<>*'H'*THEN*'N'*END*AS*STATUS,*IUSR,*AUSR,*********:CRE041MD035657
                                                                                     :
   DATE(DRVD+719892) AS FDRVD,                                                       :
   DATE(CRVD+719892) AS FCRVD,                                                       :
   LCD,                                                                              :
                                                                                     :
   DEC(DRAM*C1.SCALING,15,4) AS "SDRAM",                                             :
   DEC(DRAM*C1.SCALING*C1.RATE,15,4) AS "BSDRAM",                                    :
   DEC(CRAM*C2.SCALING,15,4) AS "SCRAM",                                             :
   DEC(CRAM*C2.SCALING*C2.RATE,15,4) AS "BSCRAM",                                    :
   DEC(BCEQ*C3.SCALING,15,4) AS "SBCEQ",                                             :
   DEC(BCEQ*C3.SCALING*C3.RATE,15,4) AS "BSBCEQ",                                    :
   CASE WHEN FXIN = 'D' THEN DEC(HAMT*C1.SCALING,15,4) ELSE                          :
   DEC(HAMT*C2.SCALING,15,4) END AS "SHAMT",                                         :
   CASE WHEN FXIN = 'D' THEN DEC(HAMT*C1.SCALING*C1.RATE,15,4) ELSE                  :
   DEC(HAMT*C2.SCALING*C2.RATE,15,4) END AS "BSHAMT",                                :
   CASE WHEN HSGN = '+' THEN DEC(MAMT*C1.SCALING,15,4) ELSE                          :
   DEC(MAMT*C2.SCALING,15,4) END AS "SMAMT",                                         :
   CASE WHEN HSGN = '+' THEN DEC(MAMT*C1.SCALING*C1.RATE,15,4) ELSE                  :
   DEC(MAMT*C2.SCALING*C2.RATE,15,4) END AS "BSMAMT",                                :
   DRCY AS DRCU, CRCY AS CRCU,                                                       :
   A8ZONE AS CUSTZONE                                                                :
   FROM GZCUSEXCE                                                                    :
   LEFT JOIN GZSDBRCHPD ON BRCA =  A8BRCD                                            :
   LEFT JOIN GZSDBANKPD ON BJZONE = A8ZONE                                           :
   LEFT JOIN V_GLOBRATE C1 ON C1.CCY=DRCY                                            :
   LEFT JOIN V_GLOBRATE C2 ON C2.CCY=CRCY                                            :
   LEFT JOIN V_GLOBRATE C3 ON C3.CCY=BJCYCD                                          :
/************************************************************************************/
 ;                                                                              :
  label on table     **********/**********                                      :
   is 'Midas GZ RE Customer Exchanges detail - GZCUSEXCE ';                     :
                                                                                :
