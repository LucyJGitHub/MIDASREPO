     H        1   D
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas HF HAF exit routines to call')
     F*****************************************************************
     F*                                                               *
     F*  Midas - History and Audit Facility Module
     F*                                                               *
     F*  HF0120 - HF Exit Routines to Call                            *
     F*                                                               *
     F*  Function:  This program allows the user to maintain the      *
     F*  (I/C INT)  exit routines to call for HAF.                    *
     F*                                                               *
     F*  Called By: HFC0120 - Exit Routines to Call                   *
     F*                                                               *
     F*  Calls: AOFILER0 - Check item or item/file in HFFILEPD.       *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*  LAST AMEND NO. 046074             DATE 21OCT92               *
     F*  PREV AMEND NO. S01379             DATE 22SEP92               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
     F*  046074 - Errors in command key and validation processing     *
     F*  S01379 - New program for HAF.                                *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*************************************************************************
     F*
     F**  FUNCTION OF INDICATORS
     F*
     F***01*********CMD*KEY*3*-*EXIT*PROGRAM                              046074
     F*  03         CMD KEY 3 - EXIT PROGRAM                              046074
     F*  05         CMD KEY 5 - REFRESH                                   046074
     F*  06         SFL CLEAR
     F*  07         SFL DISPLAY
     F*  07         SFL END
     F*  08-09      PROTECTED FIELDS
     F*  10         CMD KEY 10 - DELETE                                   046074
     F*  12         CMD KEY 12 - CANCEL                                   046074
     F*  15         FIRST SCREEN INDICATOR                                046074
     F*  20         ACTION = DELETE                                       046074
     F*  21         ACTION = ENQUIRE                                      046074
     F*  30         WRITE ERROR ON HFEXITPD                               046074
     F*  59         SFL END ON MESSAGE SUBFILE                            046074
     F***70-76-77-78***ERROR MESSAGES                                     046074
     F*  70         CHAIN FAIL ON HFEXITPD                                046074
     F*  72         SCREEN ERROR ON PROGRAM NAME                          046074
     F*  73         SCREEN ERROR ON ITEM                                  046074
     F*  74         SCREEN ERROR ON MODE                                  046074
     F*  76         READ INDICATOR FOR HFEXITPD                           046074
     F*  79         SCREEN ERROR ON FILE NAME                             046074
     F*  80         SCREEN ERROR ON ACTION                                046074
     F*  85         GENERAL ERROR INDICATOR                               046074
     F*
     F*  U7,U8    STANDARD-MIDAS ERROR                                    046074
     F*                                                                   046074
     F*****************************************************************   046074
      /SPACE 3                                                            046074
     F*****************************************************************   046074
     F*                                                                   046074
     F*  S U B R O U T I N E   I N D E X                                  046074
     F*                                                                   046074
     F*  PROCES  -  PROCESS FIRST SCREEN                                  046074
     F*  PRCES2  -  PROCESS SECOND SCREEN                                 046074
     F*  FILLSF  -  FILL SUBFILE                                          046074
     F*  INSERT  -  VALIDATE FILE AND ITEM FOR INSERT                     046074
     F*  SRITN   -  CHECK ITEM NAME                                       046074
     F*  SRFIL   -  CHECK FILE WITHIN ITEM                                046074
     F*  SRPGM   -  CHECK PROGRAM EXISTS                                  046074
     F*  SRPGMT  -  CHECK PROGRAM EXISTS                                  046074
     F*  INFSR   -  FILE ERROR HANDLING                                   046074
     F*  UPDOWS  -  UPDATE BY ANOTHER WORKSTATION                         046074
     F*  *PSSR   -  PROGRAM ERROR HANDLING                                046074
     F*                                                                   046074
     F*************************************************************************
     F/EJECT                                                              046074
     F*
     FHF0120DFCF  E                    WORKSTN
     F                                        RECNO KSFILE HF0120F3
     F** SCREEN FILE
     F*
     F*
     FHFEXITPDUF  E           K        DISK                      A
     F                                              KINFDS INFDS
     F                                              KINFSR INFSR
     F** EXIT ROUTINES TO CALL
     F*
     E*-----------------------------------------------------------------
     E**                  T A B L E S
     E*
     E                    CPY@    1   1 80
     E*
     E** Array containing Copyright statement
     E*
     E*-----------------------------------------------------------------
      *
     IINFDS       DS
     I                                     *STATUS  STATUS
     IFMT       E DSDSFDY
      * External Data structure to hold the outgoing record format of
     I*
     ILDA       E DSLDA                         256
      *
      ** Local data area for database error details
      *
     IRUNDAT    E DSRUNDAT
      *
      ** Data Area giving Installation Control Details
      *
     IPSDS       SDS
      *
      ** Program Status Data Structure - gives Job/Workstation name and
      ** User ID
      *
     I                                      244 253 JOB
     I                                      244 246 WSID
     I                                      254 263 USER
      *
     I*
     I*---------------------------------------------------------------
     C/EJECT
     C*************************************************************************
     C**        MAIN PROGRAM
     C*************************************************************************
     C*
     C           EXKEY     KLIST
     C                     KFLD           EXFILS
     C                     KFLD           EXMODS
     C                     KFLD           EXITES
     C*
     C** Set up copyright parameter
     C*
     C                     MOVEACPY@      BIS@   80
     C*
      *
      ** Read in Installation Data
      *
     C           *NAMVAR   DEFN           RUNDAT
     C           *NAMVAR   DEFN           LDA
     C                     IN   RUNDAT
     C                     MOVE AGMRDT    SRUNA            RUN DATE
     C                     MOVE USER      SUSER
     C                     MOVELWSID      SWSID
     C*
     C           AGDFF     IFEQ 'M'
     C                     SETON                     98
     C                     END
     C*
     C                     MOVE *BLANKS   WUMSID  7        Message Identif
     C                     MOVEL'HFMSGF'  WUMSGF 10        Message File Na
      *
     C                     MOVEL'HF0120'  SPGMQ  10
     C                     MOVEL*BLANKS   SSFKY   4
     C*
      **DISPLAY*SUBFILE                                                   046074
     C***********          MOVE *BLANKS   EXFILS                          046074
     C***********          MOVE *BLANKS   EXPGMS                          046074
     C***********          MOVE *BLANKS   EXMODS                          046074
     C***********          MOVE *BLANKS   EXITES                          046074
     C***********          MOVE *BLANKS   SITEM                           046074
     C***********          MOVE *BLANKS   ACT                             046074
     C***********          EXSR ENQ                                       046074
      *
      *   Do until F3 is pressed
     C************IN01     DOWEQ'0'                                       046074
     C           *IN03     DOWEQ'0'                                       046074
      *
     C************IN05     IFEQ '1'                                       046074
     C************IN12     OREQ '1'                                       046074
      *
     C                     MOVE *BLANKS   ACT                             046074
     C                     MOVE *BLANKS   EXFILS
     C                     MOVE *BLANKS   EXPGMS
     C                     MOVE *BLANKS   EXMODS
     C                     MOVE *BLANKS   EXITES
     C                     MOVE *BLANKS   SITEM
     C                     CALL 'SCC0250'                                 046074
      *
     C***********          END                                            046074
      *
     C                     EXSR PROCES
     C*                                                                   046074
     C           *IN03     IFEQ '0'                                       046074
     C           *IN05     ANDEQ'0'                                       046074
     C           *IN12     ANDEQ'0'                                       046074
     C                     WRITEHF0120F5                                  046074
     C                     EXSR PRCES2                                    046074
     C                     END                                            046074
     C                     END
      *
      *   Terminate normally
     C                     SETON                     LR
     C*
     C**************************************************************************
     C*
     C***Clear*Subfile*if*no*error*&*display*input*screen                 046074
     C*
     C           PROCES    BEGSR
     C*
     C************IN76     IFEQ '0'                                       046074
     C************IN77     ANDEQ'0'                                       046074
     C************IN78     ANDEQ'0'                                       046074
     C************IN73     ANDEQ'0'                                       046074
     C************IN74     ANDEQ'0'                                       046074
     C************IN79     ANDEQ'0'                                       046074
     C************IN80     ANDEQ'0'                                       046074
      *
      ****If*no*errors                                                    046074
     C***********          MOVE *BLANKS   EXFILS                          046074
     C***********          MOVE *BLANKS   EXPGMS                          046074
     C***********          MOVE *BLANKS   EXMODS                          046074
     C***********          MOVE *BLANKS   EXITES                          046074
     C***********          MOVE *BLANKS   SITEM                           046074
     C***********          MOVE *BLANKS   ACT                             046074
     C***********          WRITEHF0120C0                                  046074
     C***********          WRITEHF0120F5                                  046074
     C***********          CALL 'SCC0250'                                 046074
     C***********          END                                            046074
     C*
     C************IN76     IFEQ '1'                                       046074
      *
      ****Error                                                           046074
     C***********          WRITEHF0120F1                                  046074
     C***********          END                                            046074
     C*
     C***********          SETOF                     0809                 046074
     C                     SETOF                     080920               046074
     C                     SETOF                     21                   046074
     C*                                                                   046074
     C* FILL SUBFILE                                                      046074
     C                     EXSR FILLSF                                    046074
     C*                                                                   046074
     C                     SETON                     15                   046074
     C           *IN15     DOWEQ'1'                                       046074
     C*                                                                   046074
     C                     WRITEHF0120F5                                  046074
     C                     WRITEHF0120F2                                  046074
     C                     WRITEHF0120C0
     C                     EXFMTHF0120F4
     C                     CALL 'SCC0250'
     C                     SETOF                     727374               046074
     C                     SETOF                     798085               046074
     C*
     C* CHECK IF CMD3 SELECTED
     C*
     C************IN01     CABEQ'1'       END                             046074
     C           *IN03     CABEQ'1'       END                             046074
     C*
     C* CHECK IF CMD5 SELECTED
     C*
     C************IN05     CABEQ'1'       END                             046074
     C           *IN05     IFEQ '1'                                       046074
     C                     MOVE *BLANKS   ACT                             046074
     C                     MOVE *BLANKS   EXMODS                          046074
     C                     MOVE *BLANKS   SITEM                           046074
     C                     MOVE *BLANKS   EXFILS                          046074
     C                     SETOF                     05                   046074
     C                     GOTO PRCESA                                    046074
     C                     END                                            046074
     C*
     C* PROCESS SELECTED ACTION
     C*
     C***********          SETOF                     80                   046074
     C***********          SETOF                     7574                 046074
     C***********          SETOF                     767778               046074
     C                     MOVE *BLANKS   EXITES
     C                     MOVEL'J'       EXITES
     C                     MOVE SITEM     EXITES
     C           EXKEY     CHAINHFEXITPD             70
     C*
     C           ACT       IFNE 'A'
     C           ACT       ANDNE'D'
     C           ACT       ANDNE'E'
     C           ACT       ANDNE'I'
     C*
     C                     MOVEL'HAF0108' WUMSID           Message Identif
      * Retrieve MSGF message - Standard Functions  *
     C                     CALL 'SCC0240'                  Retrieve MSGF m
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na
     C                     SETON                     80
     C                     SETON                     85                   046074
     C*
     C                     END
     C*
     C***********ACT       IFEQ 'E'                                       046074
     C***********          EXSR ENQ                                       046074
     C***********          END                                            046074
     C*                                                                   046074
     C* VALIDATE MODE                                                     046074
     C*                                                                   046074
     C           EXMODS    IFNE 'IPCONL'                                  046074
     C           EXMODS    ANDNE'EODAUD'                                  046074
     C           EXMODS    ANDNE'IPCBAT'                                  046074
     C*                                                                   046074
     C                     MOVEL'HAF0102' WUMSID           Message Identif046074
      * Retrieve MSGF message - Standard Functions  *                     046074
     C                     CALL 'SCC0240'                  Retrieve MSGF m046074
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif046074
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na046074
     C*                                                                   046074
     C                     SETON                     7485                 046074
     C                     END                                            046074
     C*                                                                   046074
     C*  INSERT                                                           046074
     C           ACT       IFEQ 'I'                                       046074
     C                     EXSR INSERT                                    046074
     C                     END                                            046074
     C*
     C***DELETE                                                           046074
     C***********ACT       IFEQ 'D'                                       046074
     C************IN70     IFEQ '0'                                       046074
     C***********                                                         046074
     C************IN10     DOWEQ'0'                                       046074
      ***********                                                         046074
     C***********          SETON                     0820                 046074
     C***********          WRITEHF0120C0                                  046074
     C***********          WRITEHF0120F5                                  046074
     C***********          EXFMTHF0120F4                                  046074
     C***********          CALL 'SCC0250'                                 046074
     C***********          SETOF                     20                   046074
      ***********                                                         046074
      ****F3*,*F5*or*F12*requested*then*exit*loop                         046074
      ***********                                                         046074
     C************IN01     IFEQ '1'                                       046074
     C************IN05     OREQ '1'                                       046074
     C************IN12     OREQ '1'                                       046074
     C***********          GOTO END                                       046074
     C***********          END                                            046074
      ***********                                                         046074
      ****F10*requested*then*delete*record                                046074
      ***********                                                         046074
     C************IN10     IFEQ '1'                                       046074
     C***********          DELETHFEXITP0                                  046074
     C***********          ELSE                                           046074
     C***********          MOVEL'HAF0119' WUMSID           Message Identif046074
      **Retrieve*MSGF*message*-*Standard*Functions***                     046074
     C***********          CALL 'SCC0240'                  Retrieve MSGF m046074
     C***********WUMSID    PARM WUMSID    WQ0001  7        Message Identif046074
     C***********WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na046074
     C***********          END                                            046074
      ***********                                                         046074
     C***********          END                                            046074
      ***********                                                         046074
     C***********          ELSE                                           046074
     C***********                                                         046074
     C***********          MOVEL'HAF0105' WUMSID           Message Identif046074
      **Retrieve*MSGF*message*-*Standard*Functions***                     046074
     C***********          CALL 'SCC0240'                  Retrieve MSGF m046074
     C***********WUMSID    PARM WUMSID    WQ0001  7        Message Identif046074
     C***********WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na046074
     C***********                                                         046074
     C***********          SETON                     77                   046074
     C***********          END                                            046074
     C***********          END                                            046074
     C*
     C***AMEND                                                            046074
     C*  AMEND/DELETE/ENQUIRE                                             046074
     C           ACT       IFEQ 'A'
     C           ACT       OREQ 'D'                                       046074
     C           ACT       OREQ 'E'                                       046074
     C*                                                                   046074
     C           SITEM     IFEQ *BLANKS                                   046074
     C                     MOVEL'HAF0062' WUMSID           Message Identif046074
      * Retrieve MSGF message - Standard Functions  *                     046074
     C                     CALL 'SCC0240'                  Retrieve MSGF m046074
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif046074
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na046074
     C*                                                                   046074
     C                     SETON                     7385                 046074
     C                     END                                            046074
     C*                                                                   046074
     C           EXFILS    IFEQ *BLANKS                                   046074
     C                     MOVEL'HAF0112' WUMSID           Message Identif046074
      * Retrieve MSGF message - Standard Functions  *                     046074
     C                     CALL 'SCC0240'                  Retrieve MSGF m046074
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif046074
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na046074
     C*                                                                   046074
     C                     SETON                     7985                 046074
     C                     END                                            046074
     C*                                                                   046074
     C************IN70     IFEQ '0'                                       046074
     C***********          SETON                     08                   046074
     C***********          WRITEHF0120C0                                  046074
     C***********          WRITEHF0120F4                                  046074
     C***********          CALL 'SCC0250'                                 046074
     C***********          MOVE EXPGM     EXPGMS                          046074
     C***********          MOVE EXMOD     EXMODS                          046074
     C***********          MOVE *BLANKS   EXITEM 10                       046074
     C***********          MOVEL'J'       EXITEM                          046074
     C***********          MOVE SXITEM    EXITEM                          046074
     C***********          MOVE EXITEM    EXITES                          046074
     C***********          EXFMTHF0120F2                                  046074
     C***********                                                         046074
     C***********EXPGMS    DOWEQ*BLANKS                                   046074
      ***********                                                         046074
      ****F3*or*F12*requested*then*exit*loop                              046074
      ***********                                                         046074
     C************IN01     IFEQ '1'                                       046074
     C************IN12     OREQ '1'                                       046074
     C***********          GOTO END                                       046074
     C***********          END                                            046074
      ***********                                                         046074
     C***********          MOVEL'HAF0109' WUMSID           Message Identif046074
      **Retrieve*MSGF*message*-*Standard*Functions***                     046074
     C***********          CALL 'SCC0240'                  Retrieve MSGF m046074
     C***********WUMSID    PARM WUMSID    WQ0001  7        Message Identif046074
     C***********WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na046074
     C***********                                                         046074
     C***********          WRITEHF0120C0                                  046074
     C***********          EXFMTHF0120F2                                  046074
     C***********          CALL 'SCC0250'                                 046074
     C***********          END                                            046074
     C***********                                                         046074
     C***********          EXSR SRPGM                                     046074
      ***********                                                         046074
      ****F3*or*F12*requested*then*exit*loop                              046074
      ***********                                                         046074
     C************IN01     IFEQ '1'                                       046074
     C************IN12     OREQ '1'                                       046074
     C***********          GOTO END                                       046074
     C***********          END                                            046074
      ***********                                                         046074
     C***********          MOVE EXPGMS    EXPGM                           046074
     C***********          MOVE EXMODS    EXMOD                           046074
     C***********          MOVE *BLANKS   EXITES                          046074
     C***********          MOVEL'J'       EXITES                          046074
     C***********          MOVE SITEM     EXITES                          046074
     C***********          MOVE EXITES    EXITEM                          046074
     C***********          UPDATHFEXITP0                                  046074
     C***********          ELSE                                           046074
     C*
     C           *IN70     IFEQ '1'                                       046074
     C           SITEM     ANDNE*BLANKS                                   046074
     C           EXFILS    ANDNE*BLANKS                                   046074
     C                     MOVEL'HAF0105' WUMSID           Message Identif
      * Retrieve MSGF message - Standard Functions  *
     C                     CALL 'SCC0240'                  Retrieve MSGF m
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na
     C*
     C***********          SETON                     77                   046074
     C                     SETON                     85                   046074
     C                     SETON                     747379               046074
     C                     END
     C                     END
     C*                                                                   046074
     C*  IF NO ERRORS, EXIT THIS LOOP                                     046074
     C           *IN85     IFEQ '0'                                       046074
     C                     SETOF                     15                   046074
     C                     END                                            046074
     C*                                                                   046074
     C           PRCESA    TAG                                            046074
     C                     END                                            046074
     C*
     C***INPUT                                                            046074
     C***********ACT       IFEQ 'I'                                       046074
      ***********                                                         046074
     C***********EXMODS    IFNE 'IPCONL'                                  046074
     C***********EXMODS    ANDNE'EODAUD'                                  046074
     C***********EXMODS    ANDNE'IPCBAT'                                  046074
     C***********                                                         046074
     C***********          MOVEL'HAF0102' WUMSID           Message Identif046074
      **Retrieve*MSGF*message*-*Standard*Functions***                     046074
     C***********          CALL 'SCC0240'                  Retrieve MSGF m046074
     C***********WUMSID    PARM WUMSID    WQ0001  7        Message Identif046074
     C***********WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na046074
     C***********                                                         046074
     C***********          SETON                     74                   046074
     C***********          END                                            046074
      ***********                                                         046074
     C***********          MOVE *BLANKS   EXITES 10                       046074
     C***********          MOVEL'J'       EXITES                          046074
     C***********          MOVE SITEM     EXITES                          046074
     C***********          MOVELEXITES    #ITEM   1                       046074
      ***********                                                         046074
      ***********                                                         046074
     C************IN75     IFEQ '0'                                       046074
     C************IN74     ANDEQ'0'                                       046074
     C************IN70     ANDEQ'1'                                       046074
      ***********                                                         046074
      ****Validate*file*and*item                                          046074
      ***********                                                         046074
     C***********          EXSR INSERT                                    046074
      ***********                                                         046074
     C************IN73     IFEQ '0'                                       046074
     C************IN76     ANDEQ'0'                                       046074
     C************IN79     ANDEQ'0'                                       046074
      ***********                                                         046074
     C***********          SETON                     08                   046074
     C***********          WRITEHF0120F4                                  046074
     C***********          WRITEHF0120C0                                  046074
     C***********          EXFMTHF0120F2                                  046074
     C***********          CALL 'SCC0250'                                 046074
      ***********                                                         046074
      ****F3*,*F5*or*F12*requested*then*exit*loop                         046074
      ***********                                                         046074
     C************IN01     IFEQ '1'                                       046074
     C************IN12     OREQ '1'                                       046074
     C***********          GOTO END                                       046074
     C***********          END                                            046074
     C***********                                                         046074
     C***********          EXSR SRPGM                                     046074
      ***********                                                         046074
      ****F3*or*F12*requested*then*exit*loop                              046074
      ***********                                                         046074
     C************IN01     IFEQ '1'                                       046074
     C************IN12     OREQ '1'                                       046074
     C***********          GOTO END                                       046074
     C***********          END                                            046074
      ***********                                                         046074
     C***********          MOVE EXFILS    EXFIL                           046074
     C***********          MOVE EXPGMS    EXPGM                           046074
     C***********          MOVE EXMODS    EXMOD                           046074
     C***********          MOVE *BLANKS   EXITES                          046074
     C***********          MOVEL'J'       EXITES                          046074
     C***********          MOVE SITEM     EXITES                          046074
     C***********          MOVE EXITES    EXITEM                          046074
     C***********          WRITEHFEXITP0               30                 046074
     C***********                                                         046074
     C***If*error*occurred*on*write,*perform*check*for*update*by          046074
     C***other*w/s                                                        046074
     C***********                                                         046074
     C************IN30     IFEQ '1'                                       046074
     C***********          EXSR INFSR                                     046074
     C***********          END                                            046074
     C***********                                                         046074
     C***********          END                                            046074
     C***********                                                         046074
     C***********          ELSE                                           046074
      ***********                                                         046074
     C************IN75     IFEQ '0'                                       046074
     C************IN74     ANDEQ'0'                                       046074
     C************IN76     ANDEQ'0'                                       046074
     C************IN70     ANDEQ'0'                                       046074
      ***********                                                         046074
     C***********          MOVEL'HAF0106' WUMSID           Message Identif046074
      **Retrieve*MSGF*message*-*Standard*Functions***                     046074
     C***********          CALL 'SCC0240'                  Retrieve MSGF m046074
     C***********WUMSID    PARM WUMSID    WQ0001  7        Message Identif046074
     C***********WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na046074
     C***********                                                         046074
     C***********          SETON                     78                   046074
     C***********          END                                            046074
     C***********          END                                            046074
     C***********          END                                            046074
      ***********                                                         046074
     C************IN07     IFEQ '1'                                       046074
     C************IN73     ANDEQ'0'                                       046074
     C************IN74     ANDEQ'0'                                       046074
     C************IN75     ANDEQ'0'                                       046074
     C************IN76     ANDEQ'0'                                       046074
     C************IN77     ANDEQ'0'                                       046074
     C************IN78     ANDEQ'0'                                       046074
     C************IN79     ANDEQ'0'                                       046074
     C************IN80     ANDEQ'0'                                       046074
     C***********          MOVE *BLANKS   EXFILS                          046074
     C***********          MOVE *BLANKS   EXPGMS                          046074
     C***********          MOVE *BLANKS   EXMODS                          046074
     C***********          MOVE *BLANKS   EXITES                          046074
     C***********          MOVE *BLANKS   SITEM                           046074
     C***********          MOVE *BLANKS   ACT                             046074
     C***********          EXSR ENQ                                       046074
     C***********          END                                            046074
     C           END       ENDSR
     C********************************************************************046074
     C*                                                                   046074
     C*  PRCES2                                                           046074
     C*                                                                   046074
     C* PROCESS SECOND SCREEN                                           : 046074
     C*                                                                   046074
     C           PRCES2    BEGSR                                          046074
     C*                                                                   046074
     C                     SETOF                     728074               046074
     C                     SETOF                     7379                 046074
     C*                                                                   046074
     C           ACT       IFEQ 'I'                                       046074
     C                     MOVE *BLANKS   EXPGMS                          046074
     C                     ELSE                                           046074
     C                     MOVE EXPGM     EXPGMS                          046074
     C                     END                                            046074
     C*                                                                   046074
     C           ACT       IFEQ 'D'                                       046074
     C                     SETON                     0920                 046074
     C                     END                                            046074
     C*                                                                   046074
     C           ACT       IFEQ 'E'                                       046074
     C                     SETON                     0921                 046074
     C                     END                                            046074
     C*                                                                   046074
     C*  DISPLAY SECOND SCREEN                                            046074
     C                     SETON                     8508                 046074
     C           *IN85     DOWEQ'1'                                       046074
     C                     WRITEHF0120F4                                  046074
     C                     WRITEHF0120F5                                  046074
     C                     WRITEHF0120C0                                  046074
     C                     EXFMTHF0120F2                                  046074
     C                     CALL 'SCC0250'                                 046074
     C*                                                                   046074
     C           *IN03     CABEQ'1'       PRCE                            046074
     C           *IN12     CABEQ'1'       PRCE                            046074
     C*                                                                   046074
     C           *IN05     IFEQ '1'                                       046074
     C           ACT       IFEQ 'I'                                       046074
     C                     MOVE *BLANKS   EXPGMS                          046074
     C                     ELSE                                           046074
     C                     MOVE EXPGM     EXPGMS                          046074
     C                     END                                            046074
     C                     SETON                     85                   046074
     C                     SETOF                     72                   046074
     C                     GOTO PRCA                                      046074
     C                     END                                            046074
     C*                                                                   046074
     C                     SETOF                     85                   046074
     C*                                                                   046074
     C*  CHECK FOR ACTION DELETE                                          046074
     C           ACT       IFEQ 'D'                                       046074
     C           *IN10     IFEQ '1'                                       046074
     C                     DELETHFEXITP0                                  046074
     C                     ELSE                                           046074
     C                     MOVEL'HAF0119' WUMSID           Message Identif046074
      * Retrieve MSGF message - Standard Functions  *                     046074
     C                     CALL 'SCC0240'                  Retrieve MSGF m046074
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif046074
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na046074
     C                     SETON                     85                   046074
     C                     END                                            046074
     C                     END                                            046074
     C*                                                                   046074
     C*  VALIDATE PROGRAM NAME                                            046074
     C           ACT       IFNE 'E'                                       046074
     C           EXPGMS    IFEQ *BLANKS                                   046074
     C                     MOVEL'HAF0109' WUMSID           Message Identif046074
      * Retrieve MSGF message - Standard Functions  *                     046074
     C                     CALL 'SCC0240'                  Retrieve MSGF m046074
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif046074
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na046074
     C                     SETON                     8572                 046074
     C                     ELSE                                           046074
     C                     EXSR SRPGM                                     046074
     C                     END                                            046074
     C                     END                                            046074
     C           PRCA      TAG                                            046074
     C                     END                                            046074
     C*                                                                   046074
     C*  EVERYTHING VALID, UPDATE FILE                                    046074
     C           ACT       IFEQ 'A'                                       046074
     C                     MOVE EXPGMS    EXPGM                           046074
     C                     UPDATHFEXITP0                                  046074
     C                     END                                            046074
     C*                                                                   046074
     C           ACT       IFEQ 'I'                                       046074
     C                     MOVE EXFILS    EXFIL                           046074
     C                     MOVE EXPGMS    EXPGM                           046074
     C                     MOVE EXMODS    EXMOD                           046074
     C                     MOVE *BLANKS   EXITES 10                       046074
     C                     MOVEL'J'       EXITES                          046074
     C                     MOVE SITEM     EXITES                          046074
     C                     MOVE EXITES    EXITEM                          046074
     C*                                                                   046074
     C                     WRITEHFEXITP0               30                 046074
     C*                                                                   046074
     C*  If error occurred on write, perform check for update by          046074
     C*  other w/s                                                        046074
     C*                                                                   046074
     C           *IN30     IFEQ '1'                                       046074
     C                     EXSR INFSR                                     046074
     C                     END                                            046074
     C                     END                                            046074
     C*                                                                   046074
     C           PRCE      ENDSR                                          046074
     C********************************************************************046074
     C**************************************************************************
     C*
     C***ENQUIRY                                                          046074
     C*  FILL SUBFILE                                                     046074
     C*
     C**CLEAR,*FILL*AND*DISPLAY*SUBFILE*IF*ENQUIRY*AND*FILE*NAME*BLANKS : 046074
     C*********ENQUIRY*OF*THE*WHOLE*FILE                                  046074
     C* CLEAR, FILL AND DISPLAY SUBFILE                                 : 046074
     C*
     C***********ENQ       BEGSR                                          046074
     C           FILLSF    BEGSR                                          046074
     C*
     C***********EXFILS    IFEQ *BLANKS                                   046074
     C                     SETON                     06
     C                     WRITEHF0120C0
     C                     WRITEHF0120F4
     C                     CALL 'SCC0250'
     C                     SETOF                     0607
     C***********          SETOF                     60                   046074
     C                     Z-ADD1         RECNO   20
     C                     MOVE *LOVAL    KEYF   10
     C           KEYF      SETLLHFEXITPD
     C                     READ HFEXITPD                 76
     C*
     C           *IN76     IFEQ '1'
     C*
     C                     MOVEL'HAF0104' WUMSID           Message Identif
      * Retrieve MSGF message - Standard Functions  *
     C                     CALL 'SCC0240'                  Retrieve MSGF m
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na
     C***********          SETON                     60                   046074
     C*
     C                     END
     C*
     C           *IN76     IFEQ '0'
     C           *IN07     DOWEQ'0'
     C                     MOVE EXITEM    SXITEM
     C                     WRITEHF0120C0
     C                     WRITEHF0120F3
     C                     CALL 'SCC0250'
     C                     ADD  1         RECNO
     C                     READ HFEXITPD                 07
     C                     END
     C                     END
     C*
     C***********          ELSE                                           046074
     C***********                                                         046074
     C**ONE*FILE*NAME*SELECTED*FOR*ENQUIRY                                046074
     C***********                                                         046074
     C************IN70     IFEQ '0'                                       046074
     C***********          SETON                     0809                 046074
     C***********          WRITEHF0120C0                                  046074
     C***********          WRITEHF0120F4                                  046074
     C***********          CALL 'SCC0250'                                 046074
     C***********          MOVE EXPGM     EXPGMS                          046074
     C***********          MOVE EXMOD     EXMODS                          046074
     C***********          MOVE EXITEM    EXITES                          046074
     C***********          MOVE EXITEM    SITEM                           046074
     C***********          EXFMTHF0120F2                                  046074
     C***********          ELSE                                           046074
     C***********                                                         046074
     C***********          MOVEL'HAF0105' WUMSID           Message Identif046074
      **Retrieve*MSGF*message*-*Standard*Functions***                     046074
     C***********          CALL 'SCC0240'                  Retrieve MSGF m046074
     C***********WUMSID    PARM WUMSID    WQ0001  7        Message Identif046074
     C***********WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na046074
     C***********                                                         046074
     C***********          SETON                     77                   046074
     C***********          END                                            046074
     C***********          END                                            046074
     C*
     C                     ENDSR
     C**************************************************************************
     C/EJECT
     C*****************************************************************
     C*  Subroutine INSERT : Validate file and item for insert
     C*----------------------------------------------------------------
     C           INSERT    BEGSR                           * INSERT
     C*
     C*
     C*   Validate the HAF item name
     C                     MOVE *BLANKS   SFITEM 10
     C                     MOVEL'J'       SFITEM
     C                     MOVE SITEM     SFITEM
      *
     C                     EXSR SRITN
      *
      *   If item does not exist then error
     C           *IN73     IFEQ '1'
     C           SITEM     ANDNE*BLANKS
     C*
     C                     MOVEL'HAF0103' WUMSID           Message Identif
      * Retrieve MSGF message - Standard Functions  *
     C                     CALL 'SCC0240'                  Retrieve MSGF m
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na
     C*
     C                     ELSE
      *
     C           EXFILS    IFEQ *BLANKS
     C*
     C                     MOVEL'HAF0112' WUMSID           Message Identif
      * Retrieve MSGF message - Standard Functions  *
     C                     CALL 'SCC0240'                  Retrieve MSGF m
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na
     C*
     C***********          SETON                     76                   046074
     C                     SETON                     8579                 046074
     C                     ELSE
     C*
     C*   Check that the file refers to one in the item
     C*
     C                     EXSR SRFIL
      *
      *   If file is not within item
     C           *IN79     IFEQ '1'
     C*
     C                     MOVEL'HAF0071' WUMSID           Message Identif
      * Retrieve MSGF message - Standard Functions  *
     C                     CALL 'SCC0240'                  Retrieve MSGF m
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C*  CHECK THAT EXIT ROUTINE FOR THIS MODE/ITEM/FILE DOES NOT         046074
     C*  ALREADY EXIST                                                    046074
     C*                                                                   046074
     C           *IN85     IFEQ '0'                                       046074
     C                     MOVE *BLANKS   EXITES                          046074
     C                     MOVEL'J'       EXITES                          046074
     C                     MOVE SITEM     EXITES                          046074
     C           EXKEY     CHAINHFEXITP0             70                   046074
     C*                                                                   046074
     C           *IN70     IFEQ '0'                                       046074
     C                     MOVEL'HAF0106' WUMSID           Message Identif046074
      * Retrieve MSGF message - Standard Functions  *                     046074
     C                     CALL 'SCC0240'                  Retrieve MSGF m046074
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif046074
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na046074
     C                     SETON                     747379               046074
     C                     SETON                     85                   046074
     C                     END                                            046074
     C                     END                                            046074
     C*                                                                   046074
     C                     ENDSR
     C**************************************************************************
     C/EJECT
     C*****************************************************************
     C*  SUBROUTINE SRITN  : CHECK ITEM NAME
     C*----------------------------------------------------------------
     C           SRITN     BEGSR
      *
     C           SITEM     IFEQ *BLANKS
     C*
     C                     MOVEL'HAF0062' WUMSID           Message Identif
      * Retrieve MSGF message - Standard Functions  *
     C                     CALL 'SCC0240'                  Retrieve MSGF m
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na
     C*
     C                     SETON                     73
     C                     SETON                     85                   046074
     C                     ELSE
     C*
     C** READ FILE WITH ITEM NAME
     C                     MOVEL*BLANKS   KITEM  10
     C                     MOVEL'J'       KITEM
     C                     MOVE SFITEM    KITEM
     C                     MOVEL'*KEY'    OPTN    7
     C                     MOVEL*BLANKS   KFILE
     C                     MOVEL'1'       LOGIC   1
     C                     CALL 'AOFILER0'
     C                     PARM           RTCD    7
     C                     PARM           OPTN
     C                     PARM           LOGIC
     C                     PARM           KITEM
     C                     PARM           KFILE
     C                     PARM           FMT
      *
     C                     SETOF                     73
      *
     C           RTCD      IFEQ '*EMPTY'
     C                     SETON                     73
     C                     SETON                     85                   046074
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*  SUBROUTINE SRFIL  : CHECK FILE WITHIN ITEM
     C*----------------------------------------------------------------
     C           SRFIL     BEGSR
     C** READ FILE WITH ITEM NAME
     C                     MOVEL*BLANKS   KITEM
     C                     MOVEL'J'       KITEM
     C                     MOVE SFITEM    KITEM
     C                     MOVE EXFILS    KFILE  10
     C                     MOVEL'*KEY'    OPTN    7
     C                     MOVEL'5'       LOGIC
     C                     CALL 'AOFILER0'
     C                     PARM           RTCD    7
     C                     PARM           OPTN
     C                     PARM           LOGIC
     C                     PARM           KITEM
     C                     PARM           KFILE
     C                     PARM           FMT
      *
     C                     SETOF                     79
      *
     C           RTCD      IFEQ '*EMPTY'
     C                     SETON                     79
     C                     SETON                     85                   046074
     C                     END
     C*
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*  Subroutine SRPGM  : Check program exists
     C*----------------------------------------------------------------
     C           SRPGM     BEGSR                           * SRPGM
     C*
     C                     EXSR SRPGMT
      *
     C***********FOK       DOWEQ'N'                                       046074
     C           FOK       IFEQ 'N'                                       046074
     C*
     C                     MOVEL'HAF0109' WUMSID           Message Identif
      * Retrieve MSGF message - Standard Functions  *
     C                     CALL 'SCC0240'                  Retrieve MSGF m
     C           WUMSID    PARM WUMSID    WQ0001  7        Message Identif
     C           WUMSGF    PARM WUMSGF    WQ0002 10        Message File Na
     C*
     C                     SETON                     72
     C                     SETON                     85                   046074
     C*
     C***********          WRITEHF0120C0                                  046074
     C***********          EXFMTHF0120F2                                  046074
     C***********          CALL 'SCC0250'                                 046074
     C***********                                                         046074
     C***********          SETOF                     72                   046074
      ***********                                                         046074
      ****F3*or*F12*requested*then*exit*loop                              046074
      ***********                                                         046074
     C************IN01     IFEQ '1'                                       046074
     C************IN12     OREQ '1'                                       046074
     C***********          GOTO EXIT                                      046074
     C***********          END                                            046074
     C***********                                                         046074
     C************IN05     IFEQ '1'                                       046074
     C***********                                                         046074
     C***********          MOVE *BLANKS   EXPGMS                          046074
     C***********                                                         046074
     C***********          ELSE                                           046074
     C***********                                                         046074
     C***********          EXSR SRPGMT                                    046074
     C***********                                                         046074
     C***********          END                                            046074
     C*
     C                     END
     C*
     C           EXIT      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*  Subroutine SRPGMT : Check program exists
     C*----------------------------------------------------------------
     C           SRPGMT    BEGSR                           * SRPGMT
     C*
     C                     MOVELEXPGMS    FOBJ   10
     C                     MOVELEXPGMS    POBJ   10
     C                     MOVEL'*LIBL'   FLIB   10
     C                     MOVEL'*PGM'    FTYP   10
     C                     MOVEL'Y'       FOK     1
     C                     CALL 'HFC0113'
     C                     PARM           FOBJ
     C                     PARM           FLIB
     C                     PARM           FTYP
     C                     PARM           FOK
      *
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*  Subroutine INFSR  : File error handling.
     C*----------------------------------------------------------------
     C           INFSR     BEGSR                           * INFSR
      *
      ** Compare status field to 'duplicate key' code
      *
     C           STATUS    IFEQ 01021
      *
      ** Attempt to retrieve record which gave error
      *
     C           EXKEY     CHAINHFEXITPD             70
      *
      ** If chain suceeds Update by other W/s
      *
     C           *IN70     IFEQ '0'
     C                     EXSR UPDOWS
     C                     ELSE
      *
      ** Otherwise Std error routine
      *
     C                     EXSR *PSSR
     C                     END
      *
      ** Any other error Std error routine
      *
     C                     ELSE
     C                     EXSR *PSSR
     C                     END
      *
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*  Subroutine UPDOWS : Update by another Workstation
     C*----------------------------------------------------------------
     C           UPDOWS    BEGSR                           * UPDOWS
      *
      ** Remove previous chainges for this transaction
      *
     C                     ROLBK
      *
      ** Access record for display to user, from main transaction
      ** file of current input function
      *
     C           EXKEY     CHAINHFEXITPD             70
      *
      ** If no record found perform database error processing
      *
     C           *IN70     IFEQ '1'
     C           *LOCK     IN   LDA
      *
      ** Load standard fields
      *
     C                     MOVEL'HFEXITPD'DBFILE
     C                     MOVELEXFILS    DBKEY1 16
     C                     MOVE EXMODS    DBKEY1
     C                     MOVELDBKEY1    DBKEY2 26
     C                     MOVE EXITES    DBKEY2
     C                     MOVE DBKEY2    DBKEY
     C                     MOVE 'HF0120'  DBPGM
     C                     Z-ADD2         DBASE
     C                     OUT  LDA
      *
      ** Set error switches and exit program via error routine
      *
     C                     SETON                     U7U8
     C                     EXSR *PSSR
     C                     END
      *
      ** Display screen to user with 'update by other w/s' message
      *
     C                     MOVEL'HAF0111' WUMSID           Message Identif
      *
      * Retrieve MSGF message - Standard Functions  *
      *
     C                     CALL 'SCC0240'                  Retrieve MSGF m
     C           WUMSID    PARM WUMSID    WQ0001           Message Identif
     C           WUMSGF    PARM WUMSGF    WQ0002           Message File Na
     C*
     C                     WRITEHF0120C0
     C                     CALL 'SCC0250'
      *
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C*  Subroutine *PSSR  : Program error handling subroutine
     C*----------------------------------------------------------------
     C           *PSSR     BEGSR                             *PSSR
      *
      ** Prevents multiple dumps in the event of possible recursive
      ** calls
      *
     C           FLAG      IFEQ *BLANK
     C                     MOVE 'Y'       FLAG    1
     C                     DUMP
     C                     END
      *
      ** Call error processing
      *
     C                     CALL 'DBERRCTL'
      *
     C                     ENDSR
     C*****************************************************************
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
