     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas HF Update seq nos for backup/restore')
     F*****************************************************************
     F*                                                               *
     F*  Midas - HISTORY AND AUDIT FACILITY
     F*                                                               *
     F*  HF0340 - HAF Update Sequence Numbers for Backup/Restore      *
     F*                                                               *
     F*  Function : To set the sequence number and date on the        *
     F*  (I/C INT)  sequence per day backup/restore file              *
     F*                                                               *
     F*  Called By: HFC0340 - Copy save file data to tape             *
     F*                                                               *
     F*  Calls    :                                                   *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *  Prev Amend No. S01379             Date 16Sep92               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
     F*  S01379 - HISTORY AND AUDIT FACILITY                          *
     F*           NEW PROGRAM CREATED FOR SAR.                        *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      *
     FHFBSEQPDUF  E           K        DISK                      A
      ** Sequence per day backup/restore
      *
      /SPACE 3
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*  30       Chain unsuccesful HFBSEQPD                          *
     F*  U8       Database error                                      *
     F*                                                               *
     F*****************************************************************
      /SPACE 3
     E                    CPY@    1   1 80
      *
      ** Array containing Copyright statement
      *
      /SPACE 3
     ILDA       E DSLDA                         256
      *
      ** Local data area for database error details
      *
      /EJECT
      *
     C           *ENTRY    PLIST
     C                     PARM           DATT    6
      *
      ** Set up copyright statement
      *
     C                     MOVEACPY@      BIS@   80
      *
      ** Define local data area
      *
     C           *NAMVAR   DEFN           LDA
      *
      ** Update sequence numbers for backup/restore
      *
     C                     MOVEL'0'       HDR
     C           HDR       CHAINHFBSEQPD             30
      *
      ** Error if no HDR record
      *
     C           *IN30     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'HF0340'  DBPGM            ************
     C                     MOVE 'HFBSEQPD'DBFILE           * DBERR 001*
     C                     MOVELHDR       DBKEY            ************
     C                     Z-ADD1         DBASE
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
      *
      ** otherwise increment sequence number
      *
     C                     ADD  1         SEQN
     C                     UPDATHFBSEQP0
      *
      ** and write another record
      *
     C                     MOVELDATT      DAY
     C                     MOVEL' '       HDR
     C                     WRITEHFBSEQP0
     C                     END
      *
     C                     SETON                     LR
      *
     C/EJECT
      *****************************************************************
      *                                                               *
      * *PSSR  - PROGRAM EXCEPTION ERROR ROUTINE                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      * Called by:                                                    *
      *                                                               *
      * Calls:                                                        *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
     C           @RUN      IFEQ *BLANK
     C                     MOVEL'Y'       @RUN    1
     C                     DUMP
     C                     END
      *
     C                     SETON                     U8LR
     C                     RETRN
     C                     ENDSR
      *
      *****************************************************************
     C/EJECT
**  CPY@
(c) Finastra International Limited 2001
