     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LB Borrowing Power Weight Maintenance')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Lending Module                         *
     F*                                                               *
     F*  LB0215 - Borrowing Power Weight Maintenance                  *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *  Last Amend No. CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027A            Date 18May06               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 CLE025             Date 20Oct03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 080680             Date 11Jan95               *
      *                 S01498             Date 11Aug94               *
     F*                 066235             DATE 27JAN93               *
     F*                 R00300             DATE 17AUG90               *
     F*                 LB0009             DATE 28JUN90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CLE025 - Credit Lines (Recompile)                            *
     F*  080680 - Action code does not function for a combination     *
     F*           of Customer/Instrument and Customer/Security        *
     F*  S01498 - Portfolio Lending Upgrade to Release 10.            *
     F*  066235 - Recompile program due to changes in DSPF            *
     F*  R00300 - Message file changes                                *
     F*  LB0009 - CHANGE REVIEW SUBFILE TO INCLUDE MULTIPLE ENTRY     *
     F*           PROCESSING                                          *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     F********************************************************************
     F**
     F** FILE DEFINITIONS
     F** ----------------
     F*
     F***Bank*Details*File*-*Prefix*BJ************************************S01498
     F*SDBANKPDIF  E                    DISK         KINFSR *PSSR         S01498
     F*
     F** Client Master file - Prefix BB & CU   (Customer Number)
     F*SDLBCSL0IF  E           K        DISK         KINFSR *PSSR         S01498
     FLBLBCSJ0IF  E           K        DISK         KINFSR *PSSR          S01498
     F*
     F** Client Master File - Prefix BB & CU   (Shortname)
     F*SDLBCSL5IF  E           K        DISK         KINFSR *PSSR         S01498
     FLBLBCSJ5IF  E           K        DISK         KINFSR *PSSR          S01498
     F            SDLBCSJ0                          KRENAMESDLBCSJ5
     F*
     F** Borrowing Power File  - Prefix BP
     FLBBPWRLBUF  E           K        DISK         KINFDS INFDS A
     F                                              KINFSR *PSSR
     F            LBBPWRD0                          KRENAMELBBPWRDB
     F                                              KCOMIT
     F*
     F** Borrowing Power File - Prefix BP
     FLBBPWRLCIF  E           K        DISK         KINFSR *PSSR
     F            LBBPWRD0                          KRENAMELBBPWRDC
     F*
     F** Borrowing Power File - Prefix BP
     FLBBPWRLDIF  E           K        DISK         KINFSR *PSSR
     F            LBBPWRD0                          KRENAMELBBPWRDD
     F*
     F** Borrowing Power File - Prefix BP
     FLBBPWRLEIF  E           K        DISK         KINFSR *PSSR
     F            LBBPWRD0                          KRENAMELBBPWRDE
     F*
     F** Borrowing Power File - Prefix BP
     FLBBPWRLFIF  E           K        DISK         KINFSR *PSSR
     F            LBBPWRD0                          KRENAMELBBPWRDF
     F*
     F** Borrowing Power File - Prefix BP
     FLBBPWRLGIF  E           K        DISK         KINFSR *PSSR
     F            LBBPWRD0                          KRENAMELBBPWRDG
     F*
     F***Instrument*Types*File*-*Prefix*PD********************************S01498
     F*SDPLINL4IF  E           K        DISK         KINFSR *PSSR         S01498
     F*
     F** Securities File - No Prefix
     FSECTY   IF  E           K        DISK         KINFSR *PSSR
     F*
     F***Country*Codes*File*-*Prefix*A4***********************************S01498
     F*SDCTRYL0IF  E           K        DISK         KINFSR *PSSR         S01498
     F*
     F** Trailer file  Prefix TR
     FLBTRAIPDUF  E           K        DISK         KINFSR *PSSR
     F                                              KCOMIT
     F*
     F** Enquiry screens
     FLB0215DFCF  E                    WORKSTN      KINFDS L215DS
     F                                        RRN1  KSFILE LB0215S1
     F                                        RRN2  KSFILE LB0215S2
     F                                        RRN3  KSFILE LB0215S3
     F                                        RRN4  KSFILE LB0215S4
     F                                        RRN5  KSFILE LB0215S5
     F                                        RRN6  KSFILE LB0215S6
     F                                        RRN7  KSFILE LB0215S7
     F                                              KINFSR *PSSR
     F*
     F********************************************************************
     F/EJECT
     F*****************************************************************
     F** ID F  C  H  L    FUNCTION OF INDICATORS                      *
     F**                                                              *
     F**                                                              *
     F**      20          error on read of SDBANKPD                   *
     F**      21          error on CHAIN to LBBPWRLB                  *
     F**      22          error on LOKUP                              *
     F**      23          used on SETLL                               *
     F**      24          used on SETLL                               *
     F**      25          error on CHAIN to SDLBCSL0 and L5           *
     F**      26          READC                                       *
     F**      27          error on CHAIN to SDPLINL0                  *
     F**      28          error on WRITE to LBBPWRLB                  *
     F**      29          CHAIN fail LB0215Sn                         *
     F**                                                              *
     F**                                                              *
     F**                                                              *
     F**      subfile screen conditioning indicators                  *
     F**      30          SFLEND for message subfile                  *
     F**      31          SFLDSP (first subfile if two subfiles)      *
     F**      32          SFLNXTCHG on all subfiles                   *   LB0009
     F**      33          SFLDSP                                      *
     F**      34          SFLEND (first subfile on screen)            *
     F**      35          SFLDSPCTL                                   *
     F**      36          SFLCLR                                      *
     F**      38          ROLLDOWN                                    *
     F**      39          ROLLUP                                      *
     F**      40          SFLEND (if two subfiles on screen)          *
     F**                                                              *
     F**                                                              *
     F**      start screen conditioning indicators                    *
     F**      41          error action code field                     *
     F**      42          error customer field                        *
     F**      43          error instrument field                      *
     F**      44          error security field                        *
     F**      45          error country field                         *
     F**      46          error review from customer field            *
     F**      47          error review from instrument field          *
     F**      48          error review from security field            *
     F**      49          error review from country field             *
     F**                                                              *
     F**      50          CMD 10 enabled                              *
     F**      51          CMD 12 enabled                              *
     F**                                                              *
     F**                                                              *
     F**      maintenance screen conditioning indicators              *
     F**      60          display instrument                          *
     F**      61          display security                            *
     F**      62          display country                             *
     F**      63          protect input fields                        *
     F**      64          error weighting field                       *
     F**      65          error date field                            *
     F**      66          error frequency field                       *
     F**      67          error day number field                      *
     F**      68          display F10 on cmd key line                 *
     F**                                                              *
     F**                                                              *
     F**      70          error subfile selection                     *
     F**      71          'DELETED' displayed on maintenance screen   *
     F**      72          customer on review screen invalid           *
     F**      78          Multibranching indicator                    *   S01498
     F**                                                              *
     F**      80          Error exists on review screen subfile       *   LB0009
     F**      87          Seton to authorize redisplay display of     *   LB0009
     F**                  review screen when in maintenance screen    *   LB0009
     F**      88          Error exists on review subfile record       *   LB0009
     F**      89          On when processing selections from review   *   LB0009
     F**                  subfile                                     *   LB0009
     F**                                                              *
     F**      98          date format for ZDATE1                      *
     F**      99          error ZDATE1  ZALIGN                        *
     F**                                                              *
     F**                                                              *
     F*****************************************************************
     F/EJECT
     E*
     E** Array for COPYRIGHT
     E                    CPY@    1   1 80
     E*
     E** Array of ALPHANUMERICS
     E                    ALPNU  37  37  1
     E*
     E***Array*of*NUMBERS**********************************************                      CSD027A
     E**********          NUM    10  10  1                                                   CSD027A
     E*
     E** Message output if security name not found
     E                    MSG1    1   1 30
     E*
     E** Array for CUST NO / SHORTNAME FIELD
     E                    INP        10  1
     E*
     E** Array for CUST NO
     E                    RCS         6  1
     E*****************************************************************
     E/COPY ZSRSRC,ZDATE2Z1
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     E/COPY ZSRSRC,ZALIGNZ1
     E*****************************************************************
     E/EJECT
     I********************************************************************
     I*
     I** Data structure for compilation - Copyright Insertion
     ICPYR@$      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@$$
     I*
     I** Display file information data structure
     I* POST - position of cursor on screen; required when displaying
     I*        2 subfiles on the screen. Used to determine which Sfl to
     I*        rollup.
     I* SFLL - current rrn for subfiles displays
     I*
     IL215DS      DS
     I                                    B 370 3710POST
     I                                    B 378 3790SFLL
     I*
     I** Data structure to split customer no./shortname
     IWWCNDS      DS
     I                                        1  10 WWPNP8
     I                                        1  10 INP
     I                                        7  10 WWL4
     I*
     I** Data structure to split customer no
     IWWCSDS      DS
     I                                        1   6 WWRCUS
     I                                        1   6 RCS
     I*
     I** Data structure to change customer between alpha and numeric
     IWWCUS       DS
     I**********                              1   60WWWRKN                                   CSD027A
     I                                        1   6 WWWRKN                                   CSD027A
     I                                        1   6 WWWRKA
     I*
     I** Data structure to change percentage between numeric and alpha
     IWWPER       DS
     I                                        1   3 DDPERC
     I                                        1   30WWPERC
     I*
     I** Data structure to change day no between numeric and alpha
     IWWDAY       DS
     I                                        1   2 DDDAYN
     I                                        1   20WWDAYN
     I*
     I** Data structure to split date into day, month and year
     IWWDMY       DS
     I                                        1   7 WWDATE
     I                                        1   20BPDLUP
     I                                        3   5 BPMLUP
     I                                        6   70BPYLUP
     I*
     I** MIDAS Next available transaction number data area MNATN
     IDNATN       DS                              5
     I                                        1   50FNATN
     I*
     I** Program status Data structure
     IPSDS       SDS
     I                                      244 253 DDJOB
     I                                      254 263 USER
     I*
     I** DATA STRUCTURE TO PROVIDE TEXT ON COMIT ENTRY IN JOURNAL
     ICMTTXT      DS                             63
     I                                        1   50NATN
     I                                        6   7 MDID
     I                                        8  17 PGMN
     I                                       18  27 WSIDX
     I                                       28  330MTIME
     I                                       34  34 ACTCDX
     I                                       35  42 USIDX
     I                                       43  48 SCRN1
     I                                       49  51 SCRN2
     I                                       52  61 SCRN3
     I                                       62  63 SCRN4
     I*
     I** INFDS data structure
     IINFDS       DS
     I                                     *STATUS  STATUS
     I*
     I**  Local data area
     I*LDA*******UDS                            256                       S01498
     ILDA         DS                            256                       S01498
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*                                                                   S01498
     IRUNDAT    E DS                                                      S01498
     I** Rundate data area                                                S01498
     I*                                                                   S01498
     IZMUSER    E DS                                                      S01498
     I** Midas user data area                                             S01498
     I*                                                                   S01498
     ISDBANK    E DSSDBANKPD                                              S01498
     I** Bank details                                                     S01498
     I*                                                                   S01498
     ISDCTRY    E DSSDCTRYPD                                              S01498
     I** Country codes                                                    S01498
     I*                                                                   S01498
     ISDCUST    E DSSDCUSTPD                                              S01498
     I** Customer details                                                 S01498
     I*                                                                   S01498
     ISDPLIN    E DSSDPLINPD                                              S01498
     I** Instrument types                                                 S01498
     I*                                                                   S01498
     IDSFDY     E DSDSFDY                                                 S01498
     I** First DS for access programs                                     S01498
     I*                                                                   S01498
     IDSSDY     E DSDSSDY                                                 S01498
     I** Second DS for access programs, long data structure               S01498
     C/EJECT
     C*****************************************************************
     C*
     C** DEFINE KLISTS
     C*  =============
     C           KEYLB     KLIST
     C                     KFLD           WWCNUM
     C                     KFLD           DDINST
     C                     KFLD           DDSECS
     C                     KFLD           DDCTRY
     C*
     C           KEYLC     KLIST
     C                     KFLD           WWCNUM
     C                     KFLD           DDRINS
     C*
     C           KEYLD     KLIST
     C                     KFLD           WWCNUM
     C                     KFLD           DDRSEC
     C*
     C*
     C*
     C*
     C*
     C*
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  Main Line Processing                                        *
     C**                                                              *
     C*****************************************************************
     C*
     C** Initialisation Process
     C*
     C                     EXSR #A
     C*
     C** Loop until Exit Key pressed.
     C*
     C           *INKC     DOWEQ'0'
     C*
     C** Clear msg queue
     C*
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C* Screen to be displayed Initial, Review or Maintenance
     C           WWSCRN    CASEQ'I'       #B
     C           WWSCRN    CASEQ'R'       #C
     C           WWSCRN    CASEQ'M'       #D
     C                     END
     C*
     C*
     C                     END
     C*
     C** Termination Process
     C                     EXSR #ZJ
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**    INDEX TO SUBROUTINES                                      *
     C**   ----------------------                                     *
     C**                                                              *
     C**                                                              *
     C**   #B      - Screen 1 processing                              *
     C**   #BA     - Screen 1 validation                              *
     C**   #BAA    - Validate review combination entered              *
     C**   #BAB    - Validate combination entered under action code   *
     C**   #BB     - Validate selection against files                 *
     C**                                                              *
     C**   #C      - Review screen processing                         *
     C**   #CA     - Customer review                                  *
     C**   #CAA    - Validate selection from customer review          *
     C**   #CB     - Instrument review                                *
     C**   #CBA    - Validate selection from instrument review        *
     C**   #CC     - Security review                                  *
     C**   #CCA    - Validate selection from security review          *
     C**   #CD     - Country review                                   *
     C**   #CDA    - Validate selection from country review           *
     C**   #CE     - Customer/Instrument review                       *
     C**   #CEA    - Validate selection from cust/inst review         *
     C**   #CF     - Customer/Security review                         *
     C**   #CFA    - Validate selection from cust/sec review          *
     C**                                                              *
     C**                                                              *
     C**   #D      - Maintenance screen processing                    *
     C**   #DA     - Setup screen fields if called from initial screen*
     C**   #DB     - Setup screen fields if called from review screen *
     C**   #DC     - Initialise screen fields if insert screen        *
     C**   #DD     - Control processing of maint screen from initial  *
     C**   #DE     - Control processing of maint screen from review   *   LB0009
     C**   #DEA    - Chaining to the various subfiles                 *   LB0009
     C**   #DDA    - ENTER on maintenance screen                      *
     C**   #DDB    - Update of files on ENTER or CMD 10               *
     C**                                                              *
     C**                                                              *
     C**   #ZA     - Build half page customer/instrument subfile      *
     C**   #ZAA    - Build half page customer/security subfile        *
     C**   #ZB     - Build instrument subfile                         *
     C**   #ZC     - Build security subfile                           *
     C**   #ZD     - Build country subfile                            *
     C**   #ZE     - Build customer/instrument subfile                *
     C**   #ZF     - Build customer/security subfile                  *
     C**   #ZH     - Validate subfile selection                       *
     C**   #ZI     - Build new page of subfile                        *
     C**   #ZJ     - Termination subfile                              *
     C**   #ZK     - Customer validation                              *
     C**   #ZL     - Customer validation on review screen             *
     C**                                                              *
     C**                                                              *
     C**   #A      - Performs initial processing                      *
     C**                                                              *
     C**   ZASNMS  - Send message to programs message queue           *
     C**   ZDATE2  - Converts Day No. to Day                          *
     C**                                                              *
     C**   *PSSR   - Program error handling routine                   *
     C**                                                              *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #B  - Screen 1 processing                        *
     C**                                                              *
     C**  CALLS          - #BA                                        *
     C**                                                              *
     C**  CALLED BY      - Main Line Processing                       *
     C**                                                              *
     C*****************************************************************
     C           #B        BEGSR
     C*
     C*  Initialise screen fields
     C                     MOVE *BLANKS   DDACTN
     C                     MOVE *BLANKS   DDCSNO
     C                     MOVE *BLANKS   DDINST
     C                     MOVE *BLANKS   DDSECS
     C                     MOVE *BLANKS   DDCTRY
     C                     MOVE *BLANKS   DDRCST
     C                     MOVE *BLANKS   DDRINS
     C                     MOVE *BLANKS   DDRSEC
     C                     MOVE *BLANKS   DDRCTY
     C*
     C* Setof field error indicators
     C                     MOVEA'00000'   *IN,41           41-45 OFF
     C                     MOVEA'0000'    *IN,46           46-49 OFF
     C**********           Z-ADD0         WWCNUM                                             CSD027A
     C                     MOVE *BLANKS   WWCNUM                                             CSD027A
     C*
     C                     MOVE 'I'       WWPREV  1
     C*
     C* Output initial screen
     C                     WRITELB0215F1
     C                     WRITELB0215C8
     C                     EXFMTLB0215F2
     C*
     C* Dowhile not CMD 3 to exit and screen invalid
     C           *INKC     DOWEQ'0'
     C           WWSCRN    ANDEQ'I'
     C*
     C* Validate initial screen
     C                     EXSR #BA
     C*
     C* If screen is a valid format - validate selection against files
     C           DDACTN    IFNE *BLANKS
     C           WWEROR    ANDEQ'0'
     C                     EXSR #BB
     C                     END
     C*
     C* If error output initial screen with error messages
     C           WWEROR    IFEQ '1'
     C                     WRITELB0215C8
     C                     EXFMTLB0215F2
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #BA - Screen 1 Validation                        *
     C**                                                              *
     C**  CALLS          - None                                       *
     C**                                                              *
     C**  CALLED BY      - #B                                         *
     C**                                                              *
     C*****************************************************************
     C           #BA       BEGSR
     C*
     C* Setof all error indicators for screen
     C                     MOVEA'00000'   *IN,41           41 42 43 44 45
     C                     MOVEA'0000'    *IN,46           46 47 48 49
     C                     MOVE '0'       WWEROR  1
     C                     MOVE '00'      WWRTYP  2
     C                     MOVE '00'      WWMTYP  2
     C                     MOVE '00'      WWSAVE  2                       080680
     C*
     C* Clear message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C*................................................................
     C*
     C** If review details entered
     C*
     C           DDRCST    IFNE *BLANKS
     C           DDRINS    ORNE *BLANKS
     C           DDRSEC    ORNE *BLANKS
     C           DDRCTY    ORNE *BLANKS
     C*
     C** Other fields must be blank
     C           DDCSNO    IFNE *BLANKS
     C           DDINST    ORNE *BLANKS
     C           DDSECS    ORNE *BLANKS
     C           DDCTRY    ORNE *BLANKS
     C           DDACTN    ORNE *BLANKS
     C                     MOVEL'LBM0054' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C           DDRCST    IFNE *BLANKS
     C                     SETON                     46
     C                     END
     C           DDRINS    IFNE *BLANKS
     C                     SETON                     47
     C                     END
     C           DDRSEC    IFNE *BLANKS
     C                     SETON                     48
     C                     END
     C           DDRCTY    IFNE *BLANKS
     C                     SETON                     49
     C                     END
     C* Test for a valid combination of review details
     C                     ELSE
     C                     EXSR #BAA
     C                     END
     C                     END
     C*
     C*................................................................
     C*
     C* Validate action code
     C           DDACTN    IFNE 'I'
     C           DDACTN    ANDNE'A'
     C           DDACTN    ANDNE'D'
     C           DDACTN    ANDNE'E'
     C           DDACTN    ANDNE*BLANKS
     C                     MOVEL'LBM0039' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C                     SETON                     41
     C                     END
     C*
     C*................................................................
     C*
     C* If review details have not been entered, validate remaining
     C* combinations
     C*
     C*
     C           DDRCST    IFEQ *BLANKS
     C           DDRINS    ANDEQ*BLANKS
     C           DDRSEC    ANDEQ*BLANKS
     C           DDRCTY    ANDEQ*BLANKS
     C*
     C* If customer, instrument, security or country entered
     C* action code must also be entered
     C           DDCSNO    IFNE *BLANKS
     C           DDINST    ORNE *BLANKS
     C           DDSECS    ORNE *BLANKS
     C           DDCTRY    ORNE *BLANKS
     C           DDACTN    IFEQ *BLANKS
     C                     MOVEL'LBM0041' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C                     SETON                     41
     C                     END
     C*
     C* Instrument must exist on file SDPLINL0
     C           DDINST    IFNE *BLANKS
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM *BLANKS   @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM DDINST    @INNR   3                       S01498
     C           SDPLIN    PARM SDPLIN    DSFDY                           S01498
     C***********DDINST    CHAINSDPLINL4             27                   S01498
     C************IN27     IFEQ '1'                                       S01498
     C           @RTCD     IFEQ '*NOSEL '                                 S01498
     C                     MOVE *BLANKS   DDINST                          S01498
     C                     ELSE                                           S01498
     C           @RTCD     IFEQ *BLANKS                                   S01498
     C                     MOVE PDINNR    DDINST                          S01498
     C                     ELSE                                           S01498
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0018' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     43
     C                     END
     C                     END                                            S01498
     C                     END
     C*
     C* Security must exist on file SECTY
     C           DDSECS    IFNE *BLANKS
     C           DDSECS    CHAINSECTY                27
     C           *IN27     IFEQ '1'
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0019' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     44
     C                     END
     C                     END
     C*
     C* Country must exist on file SDCTRYL0
     C           DDCTRY    IFNE *BLANKS
     C                     CALL 'AOCTRYR0'                                S01498
     C                     PARM *BLANKS   @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM DDCTRY    @CNCD   2                       S01498
     C           SDCTRY    PARM SDCTRY    DSFDY                           S01498
     C***********DDCTRY    CHAINSDCTRYL0             27                   S01498
     C************IN27     IFEQ '1'                                       S01498
     C           @RTCD     IFEQ '*NOSEL '                                 S01498
     C                     MOVE *BLANKS   DDCTRY                          S01498
     C                     ELSE                                           S01498
     C           @RTCD     IFEQ *BLANKS                                   S01498
     C                     MOVE A4CNCD    DDCTRY                          S01498
     C                     ELSE                                           S01498
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0017' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     45
     C                     END
     C                     END                                            S01498
     C                     END
     C*
     C* Test if valid combination entered
     C                     EXSR #BAB
     C                     END
     C*
     C*  IF ALL FIELDS ARE BLANK MOVE *LOVAL INTO INSTRUMENT FIELD        LB0009
     C           DDCSNO    IFEQ *BLANKS
     C           DDINST    ANDEQ*BLANKS
     C           DDSECS    ANDEQ*BLANKS
     C           DDCTRY    ANDEQ*BLANKS
     C           DDACTN    IFEQ *BLANKS
     C***********          MOVEL'LBM0012' ZAMSID                          LB0009
     C***********          EXSR ZASNMS                                    LB0009
     C***********          MOVE '1'       WWEROR                          LB0009
     C                     MOVE *LOVAL    DDRINS                          LB0009
     C                     ELSE
     C*
     C* If action code entered - customer,instrument,security or
     C* country must be entered.
     C                     MOVEL'LBM0120' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C***********          SETON                     41
     C                     SETON                     4243
     C                     SETON                     4445
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*
     C           WWEROR    IFEQ '0'
     C           WWRTYP    ANDNE'00'
     C                     MOVE 'R'       WWSCRN
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #BAA   - Validate review combination entered     *
     C**                                                              *
     C**  CALLS             - none                                    *
     C**                                                              *
     C**  CALLED BY         - #BA                                     *
     C**                                                              *
     C*****************************************************************
     C           #BAA      BEGSR
     C*
     C*
     C*
     C* Customer entered
     C           DDRCST    IFNE *BLANKS
     C*
     C* Validate customer code
     C                     MOVELDDRCST    WWPNP8 10
     C                     MOVELDDRCST    WWRCUS
     C                     EXSR #ZL
     C           WWERR1    IFEQ '1'
     C                     SETON                     46
     C                     END
     C*
     C* customer entered with Country code - ERROR
     C           DDRCTY    IFNE *BLANKS
     C                     SETON                     4649
     C                     MOVEL'LBM0082' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C                     END
     C*
     C* Customer entered with Instrument and security - ERROR
     C           DDRINS    IFNE *BLANKS
     C           DDRSEC    ANDNE*BLANKS
     C                     SETON                     464748
     C                     MOVEL'LBM0083' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C                     END
     C*
     C* Customer entered with Instrument
     C           DDRINS    IFNE *BLANKS
     C           DDRSEC    ANDEQ*BLANKS
     C           DDRCTY    ANDEQ*BLANKS
     C                     MOVE 'CI'      WWRTYP
     C                     END
     C*
     C* Customer entered with security
     C           DDRSEC    IFNE *BLANKS
     C           DDRINS    ANDEQ*BLANKS
     C           DDRCTY    ANDEQ*BLANKS
     C                     MOVE 'CS'      WWRTYP
     C                     END
     C*
     C* Customer entered on its own
     C           DDRINS    IFEQ *BLANKS
     C           DDRSEC    ANDEQ*BLANKS
     C           DDRCTY    ANDEQ*BLANKS
     C                     MOVE 'CU'      WWRTYP
     C                     END
     C                     END
     C*
     C* Customer not entered
     C           DDRCST    IFEQ *BLANKS
     C*
     C* Country entered
     C           DDRCTY    IFNE *BLANKS
     C*
     C* Instrument and security must both be blank
     C           DDRINS    IFNE *BLANKS
     C           DDRSEC    ORNE *BLANKS
     C                     MOVEL'LBM0082' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C*
     C           DDRINS    IFNE *BLANKS
     C                     SETON                     4749
     C                     END
     C*
     C           DDRSEC    IFNE *BLANKS
     C                     SETON                     4849
     C                     END
     C*
     C* else country has been entered on its own
     C                     ELSE
     C                     MOVE 'CO'      WWRTYP
     C                     END
     C                     END
     C*
     C* Country not entered
     C           DDRCTY    IFEQ *BLANKS
     C*
     C* Instrument and security entered
     C           DDRINS    IFNE *BLANKS
     C           DDRSEC    ANDNE*BLANKS
     C                     SETON                     4748
     C                     MOVEL'LBM0083' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C                     END
     C*
     C* Instrument entered
     C           DDRINS    IFNE *BLANKS
     C           DDRSEC    ANDEQ*BLANKS
     C                     MOVE 'IN'      WWRTYP
     C                     END
     C*
     C* Security entered
     C           DDRINS    IFEQ *BLANKS
     C           DDRSEC    ANDNE*BLANKS
     C                     MOVE 'SE'      WWRTYP
     C                     END
     C*
     C                     END
     C*
     C                     END
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #BAB   - Validate combination entered under      *
     C**                      action code                             *
     C**                                                              *
     C**  CALLS             - none                                    *
     C**                                                              *
     C**  CALLED BY         - #BA                                     *
     C**                                                              *
     C*****************************************************************
     C           #BAB      BEGSR
     C*
     C           DDCSNO    IFEQ '?'                                       S01498
     C                     CALL 'AOCUSTR0'                                S01498
     C                     PARM *BLANKS   @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM DDCSNO    @KEY1  10                       S01498
     C                     PARM *BLANKS   @KYST   7                       S01498
     C           SDCUST    PARM SDCUST    DSSDY                           S01498
     C*                                                                   S01498
     C           @RTCD     IFEQ '*NOSEL '                                 S01498
     C                     MOVE *BLANKS   DDCSNO                          S01498
     C                     ELSE                                           S01498
     C                     MOVE *BLANKS   DDCSNO                          S01498
     C                     MOVELBBCUST    DDCSNO                          S01498
     C                     END                                            S01498
     C                     END                                            S01498
     C*
     C*
     C* Customer entered
     C           DDCSNO    IFNE *BLANKS
     C*
     C* Validate customer code
     C                     MOVE DDCSNO    WWPNP8
     C                     EXSR #ZK
     C           WWERR1    IFEQ '1'
     C                     SETON                     42
     C                     ELSE
     C*
     C* If record not found - ERROR
     C           WWPDI3    IFEQ '0'
     C                     MOVEL'LBM0074' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C                     SETON                     42
     C                     END
     C*                                                                   S01498
     C** Check if User is authorised to Action Code                       S01498
     C           *IN78     IFEQ '0'                                       S01498
     C*                                                                   S01498
     C** Single entity                                                    S01498
     C                     CALL 'ZVACTU'                                  S01498
     C                     PARM DDACTN    @ACT    1                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0302' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Multi-entity                                                     S01498
     C                     CALL 'ZVACTBU'                                 S01498
     C                     PARM DDACTN    @ACT    1                       S01498
     C                     PARM BBBRCD    @BCH    3                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0303' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C           @ERR      IFEQ 2                                         S01498
     C                     MOVEL'LBM0304' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C           @ERR      IFNE *ZERO                                     S01498
     C                     MOVE '1'       WWEROR                          S01498
     C                     MOVE '1'       *IN41                           S01498
     C                     MOVE '1'       *IN42                           S01498
     C                     END                                            S01498
     C*
     C                     END
     C*
     C* customer entered with Country code - ERROR
     C           DDCTRY    IFNE *BLANKS
     C                     SETON                     4245
     C                     MOVEL'LBM0082' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C                     END
     C*
     C* Customer entered with Instrument and security - ERROR
     C           DDINST    IFNE *BLANKS
     C           DDSECS    ANDNE*BLANKS
     C                     SETON                     424344
     C                     MOVEL'LBM0083' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C                     END
     C*
     C* Customer entered with Instrument
     C           DDINST    IFNE *BLANKS
     C           DDSECS    ANDEQ*BLANKS
     C           DDCTRY    ANDEQ*BLANKS
     C                     MOVE 'CI'      WWMTYP
     C                     END
     C*
     C* Customer entered with security
     C           DDSECS    IFNE *BLANKS
     C           DDINST    ANDEQ*BLANKS
     C           DDCTRY    ANDEQ*BLANKS
     C                     MOVE 'CS'      WWMTYP
     C                     END
     C*
     C* Customer entered on its own - ERROR
     C           DDINST    IFEQ *BLANKS
     C           DDSECS    ANDEQ*BLANKS
     C           DDCTRY    ANDEQ*BLANKS
     C                     MOVEL'LBM0089' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C***********          SETON                     42
     C                     SETON                     4344
     C                     END
     C                     END
     C*
     C* Customer not entered
     C           DDCSNO    IFEQ *BLANKS
     C*                                                                   S01498
     C** Check if User is authorised to Action Code                       S01498
     C           *IN78     IFEQ '0'                                       S01498
     C*                                                                   S01498
     C** Single entity                                                    S01498
     C                     CALL 'ZVACTU'                                  S01498
     C                     PARM DDACTN    @ACT    1                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0302' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Multi-entity                                                     S01498
     C                     CALL 'ZVACTBU'                                 S01498
     C                     PARM DDACTN    @ACT    1                       S01498
     C                     PARM DBRN      @BCH    3                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0303' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C           @ERR      IFEQ 2                                         S01498
     C                     MOVEL'LBM0304' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C           @ERR      IFNE *ZERO                                     S01498
     C                     MOVE '1'       WWEROR                          S01498
     C                     MOVE '1'       *IN41                           S01498
     C                     END                                            S01498
     C*
     C* Country entered
     C           DDCTRY    IFNE *BLANKS
     C*
     C* Instrument and security must both be blank
     C           DDINST    IFNE *BLANKS
     C           DDSECS    ORNE *BLANKS
     C                     MOVEL'LBM0082' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C*
     C           DDINST    IFNE *BLANKS
     C                     SETON                     4345
     C                     END
     C*
     C           DDSECS    IFNE *BLANKS
     C                     SETON                     4445
     C                     END
     C*
     C* else country has been entered on its own - ERROR
     C                     ELSE
     C                     MOVE 'CO'      WWMTYP
     C                     END
     C                     END
     C*
     C* Country not entered
     C           DDCTRY    IFEQ *BLANKS
     C*
     C* Instrument and security entered
     C           DDINST    IFNE *BLANKS
     C           DDSECS    ANDNE*BLANKS
     C                     SETON                     4344
     C                     MOVEL'LBM0083' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C                     END
     C*
     C* Instrument entered
     C           DDINST    IFNE *BLANKS
     C           DDSECS    ANDEQ*BLANKS
     C                     MOVE 'IN'      WWMTYP
     C                     END
     C*
     C* Security entered
     C           DDINST    IFEQ *BLANKS
     C           DDSECS    ANDNE*BLANKS
     C                     MOVE 'SE'      WWMTYP
     C                     END
     C*
     C                     END
     C                     END
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #BB - Validate entered fields against files      *
     C**                                                              *
     C**  CALLS          - #BBA                                       *
     C**                                                              *
     C**  CALLED BY      - #B                                         *
     C**                                                              *
     C*****************************************************************
     C           #BB       BEGSR
     C*
     C*
     C           WWEROR    IFEQ '0'                        *SA*
     C           KEYLB     CHAINLBBPWRLB             21
     C*
     C* Record found
     C           *IN21     IFEQ '0'                        *SB*
     C                     EXCPTOUTLB
     C*
     C* If record is of status deleted output 'D'
     C           BPRECI    IFEQ '*'
     C                     MOVE 'D'       DDSTUS
     C                     ELSE
     C                     MOVE *BLANKS   DDSTUS
     C                     END
     C*
     C* action is I A D or E and valid next screen is maintenance scn
     C           DDACTN    IFEQ 'I'                        *SC*
     C           BPRECI    ANDEQ'*'
     C           DDACTN    OREQ 'A'
     C           BPRECI    ANDEQ'D'
     C           DDACTN    OREQ 'D'
     C           BPRECI    ANDEQ'D'
     C           DDACTN    OREQ 'E'
     C                     MOVE 'M'       WWSCRN
     C                     Z-ADDBPTNLU    DDTNLU
     C                     ELSE                            *XC*
     C*
     C* If action is insert record must not already exist
     C           DDACTN    IFEQ 'I'                        *SD*
     C                     MOVEL'LBM0050' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C                     END                             *ED*
     C*
     C* If record is A or D record must exist
     C           DDACTN    IFEQ 'A'                        *SD*
     C           DDACTN    OREQ 'D'
     C                     MOVEL'LBM0123' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C                     END                             *ED*
     C*
     C                     END                             *EC*
     C*
     C* Record not found
     C                     ELSE                            *XB*
     C*
     C* If insert next screen is maintenance screen
     C           DDACTN    IFEQ 'I'                        *SC*
     C                     MOVE 'M'       WWSCRN
     C                     ELSE                            *XC*
     C*
     C           DDACTN    IFEQ 'A'                        *SD*
     C           DDACTN    OREQ 'D'
     C           DDACTN    OREQ 'E'
     C                     MOVEL'LBM0051' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWEROR
     C*
     C                     END                             *ED*
     C*
     C*
     C           DDCSNO    IFNE *BLANKS                    *SD*
     C                     SETON                     42
     C                     END                             *ED*
     C*
     C           DDINST    IFNE *BLANKS                    *SD*
     C                     SETON                     43
     C                     END                             *ED*
     C*
     C           DDSECS    IFNE *BLANKS                    *SD*
     C                     SETON                     44
     C                     END                             *ED*
     C*
     C           DDCTRY    IFNE *BLANKS                    *SD*
     C                     SETON                     45
     C                     END                             *ED*
     C*
     C                     END                             *EC*
     C                     END                             *EB*
     C                     END                             *EA*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #C  - Review screen processing                   *
     C**                                                              *
     C**  CALLS          - #CA #CB #CC #CD #CE #CF                    *
     C**                                                              *
     C**  CALLED BY      - Mainline processing                        *
     C**                                                              *
     C*****************************************************************
     C           #C        BEGSR
     C*
     C** Clear msg queue
     C*
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C* CMD 12 controling indicator
     C                     SETON                     51
     C                     MOVE 'R'       WWPREV
     C*
     C*
     C*
     C* The subfile built depends on the value in WWRTYP
     C* The posible values are CU - customer, IN - instrument
     C* SE - security, CO - country, CI - customer/instrument
     C* CS - customer/instrument
     C           WWRTYP    CASEQ'CU'      #CA
     C           WWRTYP    CASEQ'IN'      #CB
     C           WWRTYP    CASEQ'SE'      #CC
     C           WWRTYP    CASEQ'CO'      #CD
     C           WWRTYP    CASEQ'CI'      #CE
     C           WWRTYP    CASEQ'CS'      #CF
     C                     END
     C*
     C                     SETOF                     51
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #CA   - Customer has both instrument and security*
     C**                     records                                  *
     C**                                                              *
     C**  CALLS            - #ZA #CAA #ZI                             *
     C**                                                              *
     C**  CALLED BY        - #C                                       *
     C**                                                              *
     C*****************************************************************
     C           #CA       BEGSR
     C*
     C* Load page of subfile 1 and subfile 2
     C                     EXSR #ZA
     C*
     C* Output review screen for first time
     C*
     C                     WRITELB0215F1
     C                     WRITELB0215F3
     C           *IN31     IFEQ '0'
     C                     WRITELB0215F5
     C                     END
     C           *IN33     IFEQ '0'
     C                     WRITELB0215F6
     C                     END
     C                     WRITELB0215C7
     C                     WRITELB0215C8
     C                     EXFMTLB0215C6
     C*
     C* Dowhile not CMD 3, CMD 12 or another screen requested
     C*
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C           WWSCRN    ANDEQ'R'
     C*
     C* If enter pressed - validate
     C************IN38     IFEQ '0'                                       LB0009
     C************IN39     ANDEQ'0'                                       LB0009
     C                     EXSR #CAA
     C***********          END                                            LB0009
     C*
     C* If next screen is still review screen
     C           WWSCRN    IFEQ 'R'
     C*
     C* If roll build new page
     C           *IN80     IFEQ '0'                                       LB0009
     C           *IN38     IFEQ '1'
     C           *IN39     OREQ '1'
     C           WWROLL    OREQ '1'
     C                     EXSR #ZI
     C                     END
     C                     END                                            LB0009
     C*
     C*
     C                     WRITELB0215F1
     C                     WRITELB0215F3
     C           *IN31     IFEQ '0'
     C                     WRITELB0215F5
     C                     END
     C           *IN33     IFEQ '0'
     C                     WRITELB0215F6
     C                     END
     C                     WRITELB0215C7
     C                     WRITELB0215C8
     C                     EXFMTLB0215C6
     C*
     C                     END
     C                     END
     C*
     C           *INKL     IFEQ '1'
     C                     MOVE 'I'       WWSCRN
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #CAA  - Validate selection from review screen    *
     C**                                                              *
     C**  CALLS            - #ZH                                      *
     C**                                                              *
     C**  CALLED BY        - #CA                                      *
     C**                                                              *
     C*****************************************************************
     C           #CAA      BEGSR
     C*
     C* Clear message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C                     MOVE '0'       WWROLL  1
     C                     MOVE '0'       WWEROR
     C                     MOVE *BLANKS   WWSELT  1
     C*
     C* Enter on review screen
     C*
     C           WWPAG6    IFGE 1
     C                     READCLB0215S6                 26
     C                     END
     C*
     C* If changed record on first subfile process this subfile
     C           *IN26     IFEQ '0'
     C           WWPAG6    ANDGE1
     C***********                                                         LB0009
     C**Validate*subfile selection                                        LB0009
     C***********          EXSR #ZH                                       LB0009
     C***********                                                         LB0009
     C**Setup*next screen type and update subfile                         LB0009
     C************IN70     IFEQ '0'                                       LB0009
     C***********          MOVE 'M'       WWSCRN                          LB0009
     C***********          MOVE 'CI'      WWMTYP                          LB0009
     C***********          END                                            LB0009
     C***********          UPDATLB0215S6                                  LB0009
     C*                                                                   LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     80                   LB0009
     C                     SETOF                     555657               LB0009
     C*                                                                   LB0009
     C** WHILE changed record to process                                  LB0009
     C           *IN26     DOWEQ'0'                                       LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     88                   LB0009
     C*                                                                   LB0009
     C* Validate subfile selection                                        LB0009
     C                     EXSR #ZH                                       LB0009
     C*                                                                   LB0009
     C*  UPDAT with SFLNXTCHG so that record can be re-read in            LB0009
     C*  maintenance screen processing  (subroutine #DE)                  LB0009
     C           *IN88     IFEQ '1'                                       LB0009
     C                     SETON                     32                   LB0009
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Check if User is authorised to Action Code                       S01498
     C           *IN78     IFEQ '0'                                       S01498
     C*                                                                   S01498
     C** Single entity                                                    S01498
     C                     CALL 'ZVACTU'                                  S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0302' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Multi-entity                                                     S01498
     C                     CALL 'ZVACTBU'                                 S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM DDBRCH    @BCH    3                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0303' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C           @ERR      IFEQ 2                                         S01498
     C                     MOVEL'LBM0304' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C           @ERR      IFNE *ZERO                                     S01498
     C                     MOVE '1'       WWEROR                          S01498
     C                     MOVE '1'       *IN70                           S01498
     C                     MOVE '1'       *IN80                           S01498
     C                     MOVE '1'       *IN88                           S01498
     C                     MOVE '1'       *IN32                           S01498
     C                     END                                            S01498
     C                     END                                            LB0009
     C                     UPDATLB0215S6                                  LB0009
     C*                                                                   LB0009
     C                     READCLB0215S6                 26               LB0009
     C                     END                                            LB0009
     C                     SETOF                     32                   LB0009
     C*                                                                   LB0009
     C* Setup next screen type and update subfile                         LB0009
     C*                                                                   LB0009
     C           *IN80     IFEQ '0'                                       LB0009
     C                     MOVE 'M'       WWSCRN                          LB0009
     C                     MOVE 'CI'      WWMTYP                          LB0009
     C                     END                                            LB0009
     C*                                                                   LB0009
     C***********          Z-ADDRRN6      WWRRN6  20                      LB0009
     C                     Z-ADD1         RRN6                            LB0009
     C***********RRN6      DOWLEWWPAG6                                    LB0009
     C***********                                                         LB0009
     C**Don't*blank out current selection from subfile                    LB0009
     C***********WWRRN6    IFNE RRN6                                      LB0009
     C***********RRN6      CHAINLB0215S6             29                   LB0009
     C***********          MOVE *BLANKS   DDSELT                          LB0009
     C***********          SETOF                     70                   LB0009
     C***********          UPDATLB0215S6                                  LB0009
     C***********          END                                            LB0009
     C***********                                                         LB0009
     C***********          ADD  1         RRN6                            LB0009
     C***********          END                                            LB0009
     C***********          Z-ADD1         RRN6                            LB0009
     C***********                                                         LB0009
     C**blank*out*any*previous*selections*from*second*subfile*************080680
     C***********          Z-ADD1         RRN7                            080680
     C***********RRN7      DOWLEWWPAG7                                    080680
     C***********RRN7      CHAINLB0215S7             29                   080680
     C***********          MOVE *BLANKS   DDSELT                          080680
     C***********          SETOF                     70                   080680
     C***********          UPDATLB0215S7                                  080680
     C***********          ADD  1         RRN7                            080680
     C***********          END                                            080680
     C***********          Z-ADD1         RRN7                            080680
     C*
     C**reposition subfile at record to be updated                        LB0009
     C***********WWRRN6    CHAINLB0215S6             29                   LB0009
     C***********                                                         LB0009
     C***********          ELSE                                           080680
     C                     END                                            080680
     C*
     C* If no changed record on first subfile READC on second subfile
     C*
     C           WWPAG7    IFGE 1
     C                     READCLB0215S7                 26
     C                     END
     C*
     C           *IN26     IFEQ '0'
     C           WWPAG7    ANDGE1
     C***********                                                         LB0009
     C**Validate*subfile selection                                        LB0009
     C***********          EXSR #ZH                                       LB0009
     C***********                                                         LB0009
     C**Setup*next screen type and update subfile                         LB0009
     C************IN70     IFEQ '0'                                       LB0009
     C***********          MOVE 'M'       WWSCRN                          LB0009
     C***********          MOVE 'CS'      WWMTYP                          LB0009
     C***********          END                                            LB0009
     C***********          UPDATLB0215S7                                  LB0009
     C***********                                                         LB0009
     C*                                                                   LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     80                   LB0009
     C                     SETOF                     555657               LB0009
     C*                                                                   LB0009
     C** WHILE changed record to process                                  LB0009
     C           *IN26     DOWEQ'0'                                       LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     88                   LB0009
     C*                                                                   LB0009
     C* Validate subfile selection                                        LB0009
     C                     EXSR #ZH                                       LB0009
     C*                                                                   LB0009
     C*  UPDAT with SFLNXTCHG so that record can be re-read in            LB0009
     C*  maintenance screen processing  (subroutine #DE)                  LB0009
     C           *IN88     IFEQ '1'                                       LB0009
     C                     SETON                     32                   LB0009
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Check if User is authorised to Action Code                       S01498
     C           *IN78     IFEQ '0'                                       S01498
     C*                                                                   S01498
     C** Single entity                                                    S01498
     C                     CALL 'ZVACTU'                                  S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0302' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Multi-entity                                                     S01498
     C                     CALL 'ZVACTBU'                                 S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM DDBRCH    @BCH    3                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0303' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C           @ERR      IFEQ 2                                         S01498
     C                     MOVEL'LBM0304' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C           @ERR      IFNE *ZERO                                     S01498
     C                     MOVE '1'       WWEROR                          S01498
     C                     MOVE '1'       *IN70                           S01498
     C                     MOVE '1'       *IN80                           S01498
     C                     MOVE '1'       *IN88                           S01498
     C                     MOVE '1'       *IN32                           S01498
     C                     END                                            S01498
     C                     END                                            LB0009
     C                     UPDATLB0215S7                                  LB0009
     C*                                                                   LB0009
     C                     READCLB0215S7                 26               LB0009
     C                     END                                            LB0009
     C                     SETOF                     32                   LB0009
     C*                                                                   LB0009
     C* Setup next screen type and update subfile                         LB0009
     C*                                                                   LB0009
     C           *IN80     IFEQ '0'                                       LB0009
     C           WWMTYP    IFEQ 'CI'                                      080680
     C                     MOVE 'CS'      WWSAVE                          080680
     C                     ELSE                                           080680
     C                     MOVE 'M'       WWSCRN                          LB0009
     C                     MOVE 'CS'      WWMTYP                          LB0009
     C                     END                                            080680
     C                     END                                            LB0009
     C*                                                                   LB0009
     C***********          Z-ADDRRN7      WWRRN7  20                      LB0009
     C                     Z-ADD1         RRN7                            LB0009
     C*                                                                   LB0009
     C***********RRN7      DOWLEWWPAG7                                    LB0009
     C***********                                                         LB0009
     C**Don't*blank out current selection from subfile                    LB0009
     C***********WWRRN7    IFNE RRN7                                      LB0009
     C***********RRN7      CHAINLB0215S7             29                   LB0009
     C***********          MOVE *BLANKS   DDSELT                          LB0009
     C***********          SETOF                     70                   LB0009
     C***********          UPDATLB0215S7                                  LB0009
     C***********          END                                            LB0009
     C***********                                                         LB0009
     C***********          ADD  1         RRN7                            LB0009
     C***********          END                                            LB0009
     C***********          Z-ADD1         RRN7                            LB0009
     C**blank*out*any*previous*selections*from*first*subfile**************080680
     C***********          Z-ADD1         RRN6                            080680
     C***********RRN6      DOWLEWWPAG6                                    080680
     C***********RRN6      CHAINLB0215S6             29                   080680
     C***********          MOVE *BLANKS   DDSELT                          080680
     C***********          SETOF                     70                   080680
     C***********          UPDATLB0215S6                                  080680
     C***********          ADD  1         RRN6                            080680
     C***********          END                                            080680
     C***********          Z-ADD1         RRN6                            080680
     C***********                                                         LB0009
     C***********                                                         LB0009
     C**reposition subfile at record to be updated                        LB0009
     C***********WWRRN7    CHAINLB0215S7             29                   LB0009
     C***********                                                         LB0009
     C                     ELSE
     C*
     C* If READC fails then the review field at the top of the screen
     C* is used to build the next subfile page
     C                     MOVE '1'       WWROLL
     C                     END
     C***********          END                                            080680
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #CB   - Instrument subfile                       *
     C**                                                              *
     C**  CALLS            - #ZB #CBA #ZI                             *
     C**                                                              *
     C**  CALLED BY        - #C                                       *
     C**                                                              *
     C*****************************************************************
     C           #CB       BEGSR
     C*
     C* Load page of subfile
     C                     EXSR #ZB
     C*
     C* Output review screen for first time
     C*
     C                     WRITELB0215F1
     C                     WRITELB0215F3
     C*
     C* If subfile display is off blank out previous subfile
     C           *IN33     IFEQ '0'
     C                     WRITELB0215F5
     C                     END
     C                     WRITELB0215C8
     C                     EXFMTLB0215C1
     C*
     C* Dowhile not CMD 3, CMD 12 or another screen requested
     C*
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C           WWSCRN    ANDEQ'R'
     C*
     C* If enter pressed - validate
     C************IN38     IFEQ '0'                                       LB0009
     C************IN39     ANDEQ'0'                                       LB0009
     C                     EXSR #CBA
     C************         END                                            LB0009
     C*
     C* If next screen is still review screen
     C           WWSCRN    IFEQ 'R'
     C*
     C* If roll build new page
     C           *IN80     IFEQ '0'                                       LB0009
     C           *IN38     IFEQ '1'
     C           *IN39     OREQ '1'
     C           WWROLL    OREQ '1'
     C                     EXSR #ZI
     C                     END                                            LB0009
     C                     END
     C*
     C*
     C                     WRITELB0215F1
     C                     WRITELB0215F3
     C*
     C* If subfile display is off blank out previous subfile
     C           *IN33     IFEQ '0'
     C                     WRITELB0215F5
     C                     END
     C                     WRITELB0215C8
     C                     EXFMTLB0215C1
     C*
     C                     END
     C                     END
     C*
     C           *INKL     IFEQ '1'
     C                     MOVE 'I'       WWSCRN
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #CBA  - Validate selection from review screen    *
     C**                                                              *
     C**  CALLS            - #ZH                                      *
     C**                                                              *
     C**  CALLED BY        - #CB                                      *
     C**                                                              *
     C*****************************************************************
     C           #CBA      BEGSR
     C*
     C* Clear message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C                     MOVE '0'       WWROLL  1
     C                     MOVE '0'       WWEROR
     C                     MOVE *BLANKS   WWSELT  1
     C*
     C* Enter on review screen
     C*
     C           WWPAG1    IFGE 1
     C                     READCLB0215S1                 26
     C                     END
     C*
     C* If changed record on subfile
     C           *IN26     IFEQ '0'
     C           WWPAG1    ANDGE1
     C***********                                                         LB0009
     C**Validate*subfile selection                                        LB0009
     C***********          EXSR #ZH                                       LB0009
     C***********                                                         LB0009
     C**Setup*next screen type and update subfile                         LB0009
     C************IN70     IFEQ '0'                                       LB0009
     C***********          MOVE 'M'       WWSCRN                          LB0009
     C***********          MOVE 'IN'      WWMTYP                          LB0009
     C***********          END                                            LB0009
     C***********          UPDATLB0215S1                                  LB0009
     C***********                                                         LB0009
     C***********                                                         LB0009
     C*                                                                   LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     80                   LB0009
     C                     SETOF                     555657               LB0009
     C*                                                                   LB0009
     C** WHILE changed record to process                                  LB0009
     C           *IN26     DOWEQ'0'                                       LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     88                   LB0009
     C*                                                                   LB0009
     C* Validate subfile selection                                        LB0009
     C                     EXSR #ZH                                       LB0009
     C*                                                                   LB0009
     C*  UPDAT with SFLNXTCHG so that record can be re-read in            LB0009
     C*  maintenance screen processing  (subroutine #DE)                  LB0009
     C**         DDSELT    IFNE *BLANKS                                   LB0009
     C**                   UPDATLB0215S1                                  LB0009
     C**                   END                                            LB0009
     C           *IN88     IFEQ '1'                                       LB0009
     C                     SETON                     32                   LB0009
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Check if User is authorised to Action Code                       S01498
     C           *IN78     IFEQ '0'                                       S01498
     C*                                                                   S01498
     C** Single entity                                                    S01498
     C                     CALL 'ZVACTU'                                  S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0302' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Multi-entity                                                     S01498
     C                     CALL 'ZVACTBU'                                 S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM DBRN      @BCH    3                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0303' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C           @ERR      IFEQ 2                                         S01498
     C                     MOVEL'LBM0304' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C           @ERR      IFNE *ZERO                                     S01498
     C                     MOVE '1'       WWEROR                          S01498
     C                     MOVE '1'       *IN70                           S01498
     C                     MOVE '1'       *IN80                           S01498
     C                     MOVE '1'       *IN88                           S01498
     C                     MOVE '1'       *IN32                           S01498
     C                     END                                            S01498
     C                     END                                            LB0009
     C                     UPDATLB0215S1                                  LB0009
     C*                                                                   LB0009
     C                     READCLB0215S1                 26               LB0009
     C                     END                                            LB0009
     C                     SETOF                     32                   LB0009
     C*                                                                   LB0009
     C* Setup next screen type and update subfile                         LB0009
     C*                                                                   LB0009
     C           *IN80     IFEQ '0'                                       LB0009
     C                     MOVE 'M'       WWSCRN                          LB0009
     C                     MOVE 'IN'      WWMTYP                          LB0009
     C                     END                                            LB0009
     C*                                                                   LB0009
     C***********          UPDATLB0215S1                                  LB0009
     C*                                                                   LB0009
     C***********          Z-ADDRRN1      WWRRN1  20                      LB0009
     C                     Z-ADD1         RRN1                            LB0009
     C***********RRN1      DOWLEWWPAG1                                    LB0009
     C***********                                                         LB0009
     C* Don't blank out current selection from subfile                    LB0009
     C***********WWRRN1    IFNE RRN1                                      LB0009
     C***********RRN1      CHAINLB0215S1             29                   LB0009
     C***********          MOVE *BLANKS   DDSELT                          LB0009
     C***********          SETOF                     70                   LB0009
     C***********          UPDATLB0215S1                                  LB0009
     C***********          END                                            LB0009
     C***********                                                         LB0009
     C***********          ADD  1         RRN1                            LB0009
     C***********          END                                            LB0009
     C***********          Z-ADD1         RRN1                            LB0009
     C***********                                                         LB0009
     C**reposition subfile at record to be updated                        LB0009
     C***********WWRRN1    CHAINLB0215S1             29                   LB0009
     C***********                                                         LB0009
     C*
     C                     ELSE
     C*
     C* If READC fails then the review field at the top of the screen
     C* is used to build the next subfile page
     C                     MOVE '1'       WWROLL
     C                     END
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #CC   - Security subfile                         *
     C**                                                              *
     C**  CALLS            - #ZB #CCA #ZI                             *
     C**                                                              *
     C**  CALLED BY        - #C                                       *
     C**                                                              *
     C*****************************************************************
     C           #CC       BEGSR
     C*
     C* Load page of subfile
     C                     EXSR #ZC
     C*
     C* Output review screen for first time
     C*
     C                     WRITELB0215F1
     C                     WRITELB0215F3
     C*
     C* If subfile display is off blank out previous subfile
     C           *IN33     IFEQ '0'
     C                     WRITELB0215F5
     C                     END
     C                     WRITELB0215C8
     C                     EXFMTLB0215C2
     C*
     C* Dowhile not CMD 3, CMD 12 or another screen requested
     C*
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C           WWSCRN    ANDEQ'R'
     C*
     C* If enter pressed - validate
     C************IN38     IFEQ '0'                                       LB0009
     C************IN39     ANDEQ'0'                                       LB0009
     C                     EXSR #CCA
     C***********          END                                            LB0009
     C*
     C* If next screen is still review screen
     C           WWSCRN    IFEQ 'R'
     C*
     C* If roll build new page
     C           *IN80     IFEQ '0'                                       LB0009
     C           *IN38     IFEQ '1'
     C           *IN39     OREQ '1'
     C           WWROLL    OREQ '1'
     C                     EXSR #ZI
     C                     END
     C                     END                                            LB0009
     C*
     C*
     C                     WRITELB0215F1
     C                     WRITELB0215F3
     C*
     C* If subfile display is off blank out previous subfile
     C           *IN33     IFEQ '0'
     C                     WRITELB0215F5
     C                     END
     C                     WRITELB0215C8
     C                     EXFMTLB0215C2
     C*
     C                     END
     C                     END
     C*
     C           *INKL     IFEQ '1'
     C                     MOVE 'I'       WWSCRN
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #CCA  - Validate selection from review screen    *
     C**                                                              *
     C**  CALLS            - #ZH                                      *
     C**                                                              *
     C**  CALLED BY        - #CC                                      *
     C**                                                              *
     C*****************************************************************
     C           #CCA      BEGSR
     C*
     C* Clear message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C                     MOVE '0'       WWROLL  1
     C                     MOVE '0'       WWEROR
     C                     MOVE *BLANKS   WWSELT  1
     C*
     C* Enter on review screen
     C*
     C           WWPAG2    IFGE 1
     C                     READCLB0215S2                 26
     C                     END
     C*
     C* If changed record on subfile
     C           *IN26     IFEQ '0'
     C           WWPAG2    ANDGE1
     C***********                                                         LB0009
     C**Validate*subfile selection                                        LB0009
     C***********          EXSR #ZH                                       LB0009
     C***********                                                         LB0009
     C**Setup*next screen type and update subfile                         LB0009
     C*********** IN70     IFEQ '0'                                       LB0009
     C***********          MOVE 'M'       WWSCRN                          LB0009
     C***********          MOVE 'SE'      WWMTYP                          LB0009
     C***********          END                                            LB0009
     C***********          UPDATLB0215S2                                  LB0009
     C*                                                                   LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     80                   LB0009
     C                     SETOF                     555657               LB0009
     C*                                                                   LB0009
     C** WHILE changed record to process                                  LB0009
     C           *IN26     DOWEQ'0'                                       LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     88                   LB0009
     C*                                                                   LB0009
     C* Validate subfile selection                                        LB0009
     C                     EXSR #ZH                                       LB0009
     C*                                                                   LB0009
     C*  UPDAT with SFLNXTCHG so that record can be re-read in            LB0009
     C*  maintenance screen processing  (subroutine #DE)                  LB0009
     C           *IN88     IFEQ '1'                                       LB0009
     C                     SETON                     32                   LB0009
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Check if User is authorised to Action Code                       S01498
     C           *IN78     IFEQ '0'                                       S01498
     C*                                                                   S01498
     C** Single entity                                                    S01498
     C                     CALL 'ZVACTU'                                  S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0302' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Multi-entity                                                     S01498
     C                     CALL 'ZVACTBU'                                 S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM DBRN      @BCH    3                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0303' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C           @ERR      IFEQ 2                                         S01498
     C                     MOVEL'LBM0304' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C           @ERR      IFNE *ZERO                                     S01498
     C                     MOVE '1'       WWEROR                          S01498
     C                     MOVE '1'       *IN70                           S01498
     C                     MOVE '1'       *IN80                           S01498
     C                     MOVE '1'       *IN88                           S01498
     C                     MOVE '1'       *IN32                           S01498
     C                     END                                            S01498
     C                     END                                            LB0009
     C                     UPDATLB0215S2                                  LB0009
     C*                                                                   LB0009
     C                     READCLB0215S2                 26               LB0009
     C                     END                                            LB0009
     C                     SETOF                     32                   LB0009
     C*                                                                   LB0009
     C* Setup next screen type and update subfile                         LB0009
     C*                                                                   LB0009
     C           *IN80     IFEQ '0'                                       LB0009
     C                     MOVE 'M'       WWSCRN                          LB0009
     C                     MOVE 'SE'      WWMTYP                          LB0009
     C                     END                                            LB0009
     C*                                                                   LB0009
     C***********          Z-ADDRRN2      WWRRN2  20                      LB0009
     C                     Z-ADD1         RRN2                            LB0009
     C***********RRN2      DOWLEWWPAG2                                    LB0009
     C***********                                                         LB0009
     C**Don't*blank out current selection from subfile                    LB0009
     C***********WWRRN2    IFNE RRN2                                      LB0009
     C***********RRN2      CHAINLB0215S2             29                   LB0009
     C***********          MOVE *BLANKS   DDSELT                          LB0009
     C***********          SETOF                     70                   LB0009
     C***********          UPDATLB0215S2                                  LB0009
     C***********          END                                            LB0009
     C***********                                                         LB0009
     C***********          ADD  1         RRN2                            LB0009
     C***********          END                                            LB0009
     C***********          Z-ADD1         RRN2                            LB0009
     C***********                                                         LB0009
     C**reposition subfile at record to be updated                        LB0009
     C***********WWRRN2    CHAINLB0215S2             29                   LB0009
     C***********                                                         LB0009
     C                     ELSE
     C*
     C* If READC fails then the review field at the top of the screen
     C* is used to build the next subfile page
     C                     MOVE '1'       WWROLL
     C                     END
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #CD   - Country subfile                          *
     C**                                                              *
     C**  CALLS            - #ZD #CDA #ZI                             *
     C**                                                              *
     C**  CALLED BY        - #C                                       *
     C**                                                              *
     C*****************************************************************
     C           #CD       BEGSR
     C*
     C* Load page of subfile
     C                     EXSR #ZD
     C*
     C* Output review screen for first time
     C*
     C                     WRITELB0215F1
     C                     WRITELB0215F3
     C*
     C* If subfile display is off blank out previous subfile
     C           *IN33     IFEQ '0'
     C                     WRITELB0215F5
     C                     END
     C                     WRITELB0215C8
     C                     EXFMTLB0215C3
     C*
     C* Dowhile not CMD 3, CMD 12 or another screen requested
     C*
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C           WWSCRN    ANDEQ'R'
     C*
     C* If enter pressed - validate
     C************IN38     IFEQ '0'                                       LB0009
     C************IN39     ANDEQ'0'                                       LB0009
     C                     EXSR #CDA
     C***********          END                                            LB0009
     C*
     C* If next screen is still review screen
     C           WWSCRN    IFEQ 'R'
     C*
     C* If roll build new page
     C           *IN80     IFEQ '0'                                       LB0009
     C           *IN38     IFEQ '1'
     C           *IN39     OREQ '1'
     C           WWROLL    OREQ '1'
     C                     EXSR #ZI
     C                     END
     C                     END                                            LB0009
     C*
     C*
     C                     WRITELB0215F1
     C                     WRITELB0215F3
     C*
     C* If subfile display is off blank out previous subfile
     C           *IN33     IFEQ '0'
     C                     WRITELB0215F5
     C                     END
     C                     WRITELB0215C8
     C                     EXFMTLB0215C3
     C*
     C                     END
     C                     END
     C*
     C           *INKL     IFEQ '1'
     C                     MOVE 'I'       WWSCRN
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #CDA  - Validate selection from review screen    *
     C**                                                              *
     C**  CALLS            - #ZH                                      *
     C**                                                              *
     C**  CALLED BY        - #CD                                      *
     C**                                                              *
     C*****************************************************************
     C           #CDA      BEGSR
     C*
     C* Clear message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C                     MOVE '0'       WWROLL  1
     C                     MOVE '0'       WWEROR
     C                     MOVE *BLANKS   WWSELT  1
     C*
     C* Enter on review screen
     C*
     C           WWPAG3    IFGE 1
     C                     READCLB0215S3                 26
     C                     END
     C*
     C* If changed record on subfile
     C           *IN26     IFEQ '0'
     C           WWPAG3    ANDGE1
     C***********
     C**Validate*subfile selection                                        LB0009
     C***********          EXSR #ZH                                       LB0009
     C***********                                                         LB0009
     C**Setup*next screen type and update subfile                         LB0009
     C************IN70     IFEQ '0'                                       LB0009
     C***********          MOVE 'M'       WWSCRN                          LB0009
     C***********          MOVE 'CO'      WWMTYP                          LB0009
     C***********          END                                            LB0009
     C***********          UPDATLB0215S3                                  LB0009
     C***********                                                         LB0009
     C*                                                                   LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     80                   LB0009
     C                     SETOF                     555657               LB0009
     C*                                                                   LB0009
     C** WHILE changed record to process                                  LB0009
     C           *IN26     DOWEQ'0'                                       LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     88                   LB0009
     C*                                                                   LB0009
     C* Validate subfile selection                                        LB0009
     C                     EXSR #ZH                                       LB0009
     C*                                                                   LB0009
     C*  UPDAT with SFLNXTCHG so that record can be re-read in            LB0009
     C*  maintenance screen processing  (subroutine #DE)                  LB0009
     C           *IN88     IFEQ '1'                                       LB0009
     C                     SETON                     32                   LB0009
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Check if User is authorised to Action Code                       S01498
     C           *IN78     IFEQ '0'                                       S01498
     C*                                                                   S01498
     C** Single entity                                                    S01498
     C                     CALL 'ZVACTU'                                  S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0302' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Multi-entity                                                     S01498
     C                     CALL 'ZVACTBU'                                 S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM DBRN      @BCH    3                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0303' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C           @ERR      IFEQ 2                                         S01498
     C                     MOVEL'LBM0304' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C           @ERR      IFNE *ZERO                                     S01498
     C                     MOVE '1'       WWEROR                          S01498
     C                     MOVE '1'       *IN70                           S01498
     C                     MOVE '1'       *IN80                           S01498
     C                     MOVE '1'       *IN88                           S01498
     C                     MOVE '1'       *IN32                           S01498
     C                     END                                            S01498
     C                     END                                            LB0009
     C                     UPDATLB0215S3                                  LB0009
     C*                                                                   LB0009
     C                     READCLB0215S3                 26               LB0009
     C                     END                                            LB0009
     C                     SETOF                     32                   LB0009
     C*                                                                   LB0009
     C* Setup next screen type and update subfile                         LB0009
     C*                                                                   LB0009
     C           *IN80     IFEQ '0'                                       LB0009
     C                     MOVE 'M'       WWSCRN                          LB0009
     C                     MOVE 'CO'      WWMTYP                          LB0009
     C                     END                                            LB0009
     C*                                                                   LB0009
     C***********          Z-ADDRRN3      WWRRN3  20                      LB0009
     C                     Z-ADD1         RRN3                            LB0009
     C***********RRN3      DOWLEWWPAG3                                    LB0009
     C***********                                                         LB0009
     C**Don't*blank out current selection from subfile                    LB0009
     C***********WWRRN3    IFNE RRN3                                      LB0009
     C***********RRN3      CHAINLB0215S3             29                   LB0009
     C***********          MOVE *BLANKS   DDSELT                          LB0009
     C***********          SETOF                     70                   LB0009
     C***********          UPDATLB0215S3                                  LB0009
     C***********          END                                            LB0009
     C***********                                                         LB0009
     C***********          ADD  1         RRN3                            LB0009
     C***********          END                                            LB0009
     C***********          Z-ADD1         RRN3                            LB0009
     C***********                                                         LB0009
     C**reposition subfile at record to be updated                        LB0009
     C***********WWRRN3    CHAINLB0215S3             29                   LB0009
     C***********                                                         LB0009
     C                     ELSE
     C*
     C* If READC fails then the review field at the top of the screen
     C* is used to build the next subfile page
     C                     MOVE '1'       WWROLL
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #CE   - Customer/instrument subfile              *
     C**                                                              *
     C**  CALLS            - #ZB #CEA #ZI                             *
     C**                                                              *
     C**  CALLED BY        - #C                                       *
     C**                                                              *
     C*****************************************************************
     C           #CE       BEGSR
     C*
     C* Load page of subfile
     C                     EXSR #ZE
     C*
     C* Output review screen for first time
     C*
     C                     WRITELB0215F1
     C                     WRITELB0215F3
     C*
     C* If subfile display is off blank out previous subfile
     C           *IN33     IFEQ '0'
     C                     WRITELB0215F5
     C                     END
     C                     WRITELB0215C8
     C                     EXFMTLB0215C4
     C*
     C* Dowhile not CMD 3, CMD 12 or another screen requested
     C*
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C           WWSCRN    ANDEQ'R'
     C*
     C* If enter pressed - validate
     C************IN38     IFEQ '0'                                       LB0009
     C************IN39     ANDEQ'0'                                       LB0009
     C                     EXSR #CEA
     C************         END                                            LB0009
     C*
     C* If rollup validate customer entered
     C           *IN38     IFEQ '1'
     C                     MOVELDDRCST    WWRCUS
     C                     EXSR #ZL
     C*
     C* If error don't rollup
     C           WWERR1    IFEQ '1'
     C                     SETOF                     38
     C                     END
     C                     END
     C*
     C* If next screen is still review screen
     C           WWSCRN    IFEQ 'R'
     C*
     C* If roll build new page
     C           *IN80     IFEQ '0'                                       LB0009
     C           *IN38     IFEQ '1'
     C           *IN39     OREQ '1'
     C           WWROLL    OREQ '1'
     C                     EXSR #ZI
     C                     END
     C                     END                                            LB0009
     C*
     C*
     C                     WRITELB0215F1
     C                     WRITELB0215F3
     C*
     C* If subfile display is off blank out previous subfile
     C           *IN33     IFEQ '0'
     C                     WRITELB0215F5
     C                     END
     C                     WRITELB0215C8
     C                     EXFMTLB0215C4
     C*
     C                     END
     C                     END
     C*
     C           *INKL     IFEQ '1'
     C                     MOVE 'I'       WWSCRN
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #CEA  - Validate selection from review screen    *
     C**                                                              *
     C**  CALLS            - #ZH                                      *
     C**                                                              *
     C**  CALLED BY        - #CE                                      *
     C**                                                              *
     C*****************************************************************
     C           #CEA      BEGSR
     C*
     C* Clear message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C                     MOVE '0'       WWROLL  1
     C                     MOVE '0'       WWEROR
     C                     MOVE *BLANKS   WWSELT  1
     C*
     C* Enter on review screen
     C*
     C           WWPAG4    IFGE 1
     C                     READCLB0215S4                 26
     C                     END
     C*
     C* If changed record on subfile
     C           *IN26     IFEQ '0'
     C           WWPAG4    ANDGE1
     C***********                                                         LB0009
     C**Validate*subfile selection                                        LB0009
     C***********          EXSR #ZH                                       LB0009
     C***********                                                         LB0009
     C**Setup*next screen type and update subfile                         LB0009
     C************IN70     IFEQ '0'                                       LB0009
     C***********          MOVE 'M'       WWSCRN                          LB0009
     C***********          MOVE 'CI'      WWMTYP                          LB0009
     C***********          END                                            LB0009
     C***********          UPDATLB0215S4                                  LB0009
     C*                                                                   LB0009
     C*                                                                   LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     80                   LB0009
     C                     SETOF                     555657               LB0009
     C*                                                                   LB0009
     C** WHILE changed record to process                                  LB0009
     C           *IN26     DOWEQ'0'                                       LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     88                   LB0009
     C*                                                                   LB0009
     C* Validate subfile selection                                        LB0009
     C                     EXSR #ZH                                       LB0009
     C*                                                                   LB0009
     C*  UPDAT with SFLNXTCHG so that record can be re-read in            LB0009
     C*  maintenance screen processing  (subroutine #DE)                  LB0009
     C           *IN88     IFEQ '1'                                       LB0009
     C                     SETON                     32                   LB0009
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Check if User is authorised to Action Code                       S01498
     C           *IN78     IFEQ '0'                                       S01498
     C*                                                                   S01498
     C** Single entity                                                    S01498
     C                     CALL 'ZVACTU'                                  S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0302' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Multi-entity                                                     S01498
     C                     CALL 'ZVACTBU'                                 S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM DDBRCH    @BCH    3                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0303' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C           @ERR      IFEQ 2                                         S01498
     C                     MOVEL'LBM0304' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C           @ERR      IFNE *ZERO                                     S01498
     C                     MOVE '1'       WWEROR                          S01498
     C                     MOVE '1'       *IN70                           S01498
     C                     MOVE '1'       *IN80                           S01498
     C                     MOVE '1'       *IN88                           S01498
     C                     MOVE '1'       *IN32                           S01498
     C                     END                                            S01498
     C                     END                                            LB0009
     C                     UPDATLB0215S4                                  LB0009
     C*                                                                   LB0009
     C                     READCLB0215S4                 26               LB0009
     C                     END                                            LB0009
     C                     SETOF                     32                   LB0009
     C*                                                                   LB0009
     C* Setup next screen type and update subfile                         LB0009
     C*                                                                   LB0009
     C           *IN80     IFEQ '0'                                       LB0009
     C                     MOVE 'M'       WWSCRN                          LB0009
     C                     MOVE 'CI'      WWMTYP                          LB0009
     C                     END                                            LB0009
     C*                                                                   LB0009
     C***********          Z-ADDRRN4      WWRRN4  20                      LB0009
     C                     Z-ADD1         RRN4                            LB0009
     C***********RRN4      DOWLEWWPAG4                                    LB0009
     C***********                                                         LB0009
     C**Don't*blank out current selection from subfile                    LB0009
     C***********WWRRN4    IFNE RRN4                                      LB0009
     C***********RRN4      CHAINLB0215S4             29                   LB0009
     C***********          MOVE *BLANKS   DDSELT                          LB0009
     C***********          SETOF                     70                   LB0009
     C***********          UPDATLB0215S4                                  LB0009
     C***********          END                                            LB0009
     C***********                                                         LB0009
     C***********          ADD  1         RRN4                            LB0009
     C***********          END                                            LB0009
     C***********          Z-ADD1         RRN4                            LB0009
     C***********                                                         LB0009
     C**reposition subfile at record to be updated                        LB0009
     C***********WWRRN4    CHAINLB0215S4             29                   LB0009
     C***********                                                         LB0009
     C                     ELSE
     C*
     C* If READC fails then the review field at the top of the screen
     C* is used to build the next subfile page
     C*
     C* Validate customer number
     C                     MOVELDDRCST    WWRCUS
     C                     EXSR #ZL
     C           WWERR1    IFEQ '0'
     C                     MOVE '1'       WWROLL
     C                     END
     C*
     C                     END
     C*
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #CF   - Customer/security subfile                *
     C**                                                              *
     C**  CALLS            - #ZB #CFA #ZI                             *
     C**                                                              *
     C**  CALLED BY        - #C                                       *
     C**                                                              *
     C*****************************************************************
     C           #CF       BEGSR
     C*
     C* Load page of subfile
     C                     EXSR #ZF
     C*
     C* Output review screen for first time
     C*
     C                     WRITELB0215F1
     C                     WRITELB0215F3
     C*
     C* If subfile display is off blank out previous subfile
     C           *IN33     IFEQ '0'
     C                     WRITELB0215F5
     C                     END
     C                     WRITELB0215C8
     C                     EXFMTLB0215C5
     C*
     C* Dowhile not CMD 3, CMD 12 or another screen requested
     C*
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C           WWSCRN    ANDEQ'R'
     C*
     C* If enter pressed - validate
     C************IN38     IFEQ '0'                                       LB0009
     C************IN39     ANDEQ'0'                                       LB0009
     C                     EXSR #CFA
     C***********          END                                            LB0009
     C*
     C* If rollup validate customer entered
     C           *IN38     IFEQ '1'
     C                     MOVELDDRCST    WWRCUS
     C                     EXSR #ZL
     C*
     C* If error don't rollup
     C           WWERR1    IFEQ '1'
     C                     SETOF                     38
     C                     END
     C                     END
     C*
     C* If next screen is still review screen
     C           WWSCRN    IFEQ 'R'
     C*
     C* If roll build new page
     C           *IN80     IFEQ '0'                                       LB0009
     C           *IN38     IFEQ '1'
     C           *IN39     OREQ '1'
     C           WWROLL    OREQ '1'
     C                     EXSR #ZI
     C                     END
     C                     END                                            LB0009
     C*
     C*
     C                     WRITELB0215F1
     C                     WRITELB0215F3
     C*
     C* If subfile display is off blank out previous subfile
     C           *IN33     IFEQ '0'
     C                     WRITELB0215F5
     C                     END
     C                     WRITELB0215C8
     C                     EXFMTLB0215C5
     C*
     C                     END
     C                     END
     C*
     C           *INKL     IFEQ '1'
     C                     MOVE 'I'       WWSCRN
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #CFA  - Validate selection from review screen    *
     C**                                                              *
     C**  CALLS            - #ZH                                      *
     C**                                                              *
     C**  CALLED BY        - #CF                                      *
     C**                                                              *
     C*****************************************************************
     C           #CFA      BEGSR
     C*
     C* Clear message queue
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C                     MOVE '0'       WWROLL  1
     C                     MOVE '0'       WWEROR
     C                     MOVE *BLANKS   WWSELT  1
     C*
     C* Enter on review screen
     C*
     C           WWPAG5    IFGE 1
     C                     READCLB0215S5                 26
     C                     END
     C*
     C* If changed record on subfile
     C           *IN26     IFEQ '0'
     C           WWPAG5    ANDGE1
     C***********                                                         LB0009
     C**Validate*subfile selection                                        LB0009
     C***********          EXSR #ZH                                       LB0009
     C***********                                                         LB0009
     C**Setup*next screen type and update subfile                         LB0009
     C************IN70     IFEQ '0'                                       LB0009
     C***********          MOVE 'M'       WWSCRN                          LB0009
     C***********          MOVE 'CS'      WWMTYP                          LB0009
     C***********          END                                            LB0009
     C***********          UPDATLB0215S5                                  LB0009
     C***********                                                         LB0009
     C*                                                                   LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     80                   LB0009
     C                     SETOF                     555657               LB0009
     C*                                                                   LB0009
     C** WHILE changed record to process                                  LB0009
     C           *IN26     DOWEQ'0'                                       LB0009
     C                     SETOF                     32                   LB0009
     C                     SETOF                     88                   LB0009
     C*                                                                   LB0009
     C* Validate subfile selection                                        LB0009
     C                     EXSR #ZH                                       LB0009
     C*                                                                   LB0009
     C*  UPDAT with SFLNXTCHG so that record can be re-read in            LB0009
     C*  maintenance screen processing  (subroutine #DE)                  LB0009
     C           *IN88     IFEQ '1'                                       LB0009
     C                     SETON                     32                   LB0009
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Check if User is authorised to Action Code                       S01498
     C           *IN78     IFEQ '0'                                       S01498
     C*                                                                   S01498
     C** Single entity                                                    S01498
     C                     CALL 'ZVACTU'                                  S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0302' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     ELSE                                           S01498
     C*                                                                   S01498
     C** Multi-entity                                                     S01498
     C                     CALL 'ZVACTBU'                                 S01498
     C                     PARM DDSELT    @ACT    1                       S01498
     C                     PARM DDBRCH    @BCH    3                       S01498
     C                     PARM           @ERR    10                      S01498
     C*                                                                   S01498
     C*  If action invalid for user, send error message                   S01498
     C           @ERR      IFEQ 1                                         S01498
     C                     MOVEL'LBM0303' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C           @ERR      IFEQ 2                                         S01498
     C                     MOVEL'LBM0304' ZAMSID                          S01498
     C                     EXSR ZASNMS                                    S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C           @ERR      IFNE *ZERO                                     S01498
     C                     MOVE '1'       WWEROR                          S01498
     C                     MOVE '1'       *IN70                           S01498
     C                     MOVE '1'       *IN80                           S01498
     C                     MOVE '1'       *IN88                           S01498
     C                     MOVE '1'       *IN32                           S01498
     C                     END                                            S01498
     C                     END                                            LB0009
     C                     UPDATLB0215S5                                  LB0009
     C*                                                                   LB0009
     C                     READCLB0215S5                 26               LB0009
     C                     END                                            LB0009
     C                     SETOF                     32                   LB0009
     C*                                                                   LB0009
     C* Setup next screen type and update subfile                         LB0009
     C*                                                                   LB0009
     C           *IN80     IFEQ '0'                                       LB0009
     C                     MOVE 'M'       WWSCRN                          LB0009
     C                     MOVE 'CS'      WWMTYP                          LB0009
     C                     END                                            LB0009
     C*                                                                   LB0009
     C***********          Z-ADDRRN5      WWRRN5  20                      LB0009
     C                     Z-ADD1         RRN5                            LB0009
     C***********RRN5      DOWLEWWPAG5                                    LB0009
     C***********                                                         LB0009
     C**Don't*blank out current selection from subfile                    LB0009
     C***********WWRRN5    IFNE RRN5                                      LB0009
     C***********RRN5      CHAINLB0215S5             29                   LB0009
     C***********          MOVE *BLANKS   DDSELT                          LB0009
     C***********          SETOF                     70                   LB0009
     C***********          UPDATLB0215S5                                  LB0009
     C***********          END                                            LB0009
     C***********                                                         LB0009
     C***********          ADD  1         RRN5                            LB0009
     C***********          END                                            LB0009
     C***********          Z-ADD1         RRN5                            LB0009
     C***********                                                         LB0009
     C**reposition subfile at record to be updated                        LB0009
     C***********WWRRN5    CHAINLB0215S5             29                   LB0009
     C*
     C                     ELSE
     C*
     C* If READC fails then the review field at the top of the screen
     C* is used to build the next subfile page
     C*
     C* Validate customer number
     C                     MOVELDDRCST    WWRCUS
     C                     EXSR #ZL
     C           WWERR1    IFEQ '0'
     C                     MOVE '1'       WWROLL
     C                     END
     C*
     C                     END
     C*
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #D    - Maintenance screen processing            *
     C**                                                              *
     C**  CALLS            - #DA #DB #DC #DD #DE                      *   LB0009
     C**                                                              *
     C**  CALLED BY        - mainline                                 *
     C**                                                              *
     C*****************************************************************
     C           #D        BEGSR
     C*
     C** Clear msg queue
     C*
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C* Initialise field error indicators 64 65 66 67
     C                     MOVEA'0000'    *IN,64           64-67 OFF
     C* Initialise other screen fields indicators 60 61 62 63
     C                     MOVEA'0000'    *IN,60           60-63 OFF
     C                     MOVEA'01'      *IN,50           50 OFF 51 ON
     C                     MOVE '0'       WWEROR
     C           DDSTUS    IFEQ 'D'
     C                     SETON                         71
     C                     ELSE
     C                     SETOF                         71
     C                     END
     C*
     C*
     C* If called from initial screen setup screen fields
     C           WWPREV    IFEQ 'I'
     C                     EXSR #DA
     C***                  ELSE                                           LB0009
     C**else fields are taken from hidden fields in review subfile        LB0009
     C***                  EXSR #DB                                       LB0009
     C                     END
     C*
     C** If maintenance screen has been called via initial screen         LB0009
     C           WWPREV    IFEQ 'I'                                       LB0009
     C*                                                                   LB0009
     C* Initialise all fields if action is equal to I (insert)
     C                     EXSR #DC
     C*
     C* Control processing of maintenance screen
     C                     EXSR #DD
     C*                                                                   LB0009
     C                     ELSE                                           LB0009
     C*                                                                   LB0009
     C* Control processing of maintenance screen                          LB0009
     C                     EXSR #DE                                       LB0009
     C                     END                                            LB0009
     C*                                                                   LB0009
     C*
     C                     SETOF                     51
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #DA   - Setup screen fields if called from       *
     C**                     initial screen                           *
     C**                                                              *
     C**  CALLS            - #ZE                                      *
     C**                                                              *
     C**  CALLED BY        - #D                                       *
     C**                                                              *
     C*****************************************************************
     C           #DA       BEGSR
     C*
     C*
     C* If action is amend, delete or enquire
     C           DDACTN    IFEQ 'A'
     C           DDACTN    OREQ 'D'
     C           DDACTN    OREQ 'E'
     C*
     C* If instrument entered get instrument percentage
     C           DDINST    IFNE *BLANKS
     C                     MOVE BPINPC    DDPERC
     C                     END
     C*
     C* If security entered get security percentage
     C           DDSECS    IFNE *BLANKS
     C                     MOVE BPSEPC    DDPERC
     C                     END
     C*
     C* If country entered get country percentage
     C           DDCTRY    IFNE *BLANKS
     C                     MOVE BPCTPC    DDPERC
     C                     END
     C*
     C* Setup remaining fields
     C                     MOVE BPREVD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDATE
     C                     MOVE BPREVF    DDFREQ
     C                     MOVE BPREVN    DDDAYN
     C                     MOVE BPTNLU    DDTNLU
     C*
     C                     END
     C*
     C* If instrument display instrument delails
     C           DDINST    IFNE *BLANKS
     C                     MOVE *BLANKS   DDSECS
     C                     MOVE *BLANKS   DDCTRY
     C                     SETON                     60
     C*
     C* Get instrument name
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM *BLANKS   @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM DDINST    @INNR   3                       S01498
     C           SDPLIN    PARM SDPLIN    DSFDY                           S01498
     C***********DDINST    CHAINSDPLINL4             27                   S01498
     C************IN27     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C***********          MOVEL'SDPLINL4'DBFILE           ***************S01498
     C                     MOVE 'SDPLINPD'DBFILE                          S01498
     C                     MOVELDDINST    DBKEY            *             *
     C                     MOVE '002'     DBASE            * DBERROR 002 *
     C                     OUT  LDA                                       S01498
     C                     SETON                     U7U8LR*             *
     C                     EXSR #ZJ                        ***************
     C                     ELSE
     C                     MOVE PDISTN    DDINSN
     C                     END
     C                     END
     C*
     C* If security display security delails
     C           DDSECS    IFNE *BLANKS
     C                     MOVE *BLANKS   DDINST
     C                     MOVE *BLANKS   DDCTRY
     C                     SETON                     61
     C*
     C* Get security name
     C           DDSECS    CHAINSECTY                27
     C           *IN27     IFEQ '1'
     C                     MOVEAMSG1      DDSEC1
     C                     MOVE *BLANKS   DDSEC2
     C                     ELSE
     C                     MOVE SFN1      DDSEC1
     C                     MOVE SFN2      DDSEC2
     C                     END
     C                     END
     C*
     C* If country display country delails
     C           DDCTRY    IFNE *BLANKS
     C                     MOVE *BLANKS   DDINST
     C                     MOVE *BLANKS   DDSECS
     C                     SETON                     62
     C*
     C* Get country name
     C                     CALL 'AOCTRYR0'                                S01498
     C                     PARM *BLANKS   @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM DDCTRY    @CNCD   2                       S01498
     C           SDCTRY    PARM SDCTRY    DSFDY                           S01498
     C***********DDCTRY    CHAINSDCTRYL0             27                   S01498
     C************IN27     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C***********          MOVEL'SDCTRYL0'DBFILE           ***************S01498
     C                     MOVE 'SDCTRYPD'DBFILE                          S01498
     C                     MOVELDDCTRY    DBKEY            *             *
     C                     MOVE '003'     DBASE            * DBERROR 003 *
     C                     OUT  LDA                                       S01498
     C                     SETON                     U7U8LR*             *
     C                     EXSR #ZJ                        ***************
     C                     ELSE
     C                     MOVE A4CNNM    DDCTRN
     C                     END
     C                     END
     C*
     C*
     C* If customer not entered blank out customer details
     C           DDCSNO    IFEQ *BLANKS
     C                     MOVE *BLANKS   DDCNUM
     C                     MOVE *BLANKS   DDPNP8
     C                     MOVE *BLANKS   DDBRCH                          S01498
     C                     ELSE
     C                     MOVE WWCNUM    DDCNUM
     C                     MOVE WWPNP8    DDPNP8
     C                     MOVE WWBRCH    DDBRCH                          S01498
     C                     END
     C*
     C* Because numeric file values have been moved to alpha fields
     C* on the display, zero will come out as all zeros. This has to
     C* be manually suppressed in the code as follows.
     C           DDPERC    IFEQ '000'
     C                     MOVE *BLANKS   DDPERC
     C                     END
     C*
     C           DDDATE    IFEQ '000000'
     C                     MOVE *BLANKS   DDDATE
     C                     END
     C*
     C           DDDAYN    IFEQ '00'
     C                     MOVE *BLANKS   DDDAYN
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #DB   - Setup screen fields if called from       *
     C**                     review screen                            *
     C**                                                              *
     C**  CALLS            - none                                     *
     C**                                                              *
     C**  CALLED BY        - #D                                       *
     C**                                                              *
     C*****************************************************************
     C           #DB       BEGSR
     C*
     C                     MOVE WWSELT    DDACTN                          LB0009
     C*
     C* Initialise customer fields
     C           WWMTYP    IFNE 'CI'
     C           WWMTYP    ANDNE'CS'
     C                     MOVE *BLANKS   DDPNP8
     C                     MOVE *BLANKS   DDCNUM
     C                     MOVE *BLANKS   DDBRCH                          S01498
     C                     END
     C*
     C* instrument maintenance screen
     C           WWMTYP    IFEQ 'CI'
     C           WWMTYP    OREQ 'IN'
     C                     MOVE *BLANKS   DDCTRY
     C                     MOVE *BLANKS   DDSECS
     C                     SETON                     60
     C                     END
     C*
     C* security maintenance screen
     C           WWMTYP    IFEQ 'CS'
     C           WWMTYP    OREQ 'SE'
     C                     MOVE *BLANKS   DDCTRY
     C                     MOVE *BLANKS   DDINST
     C                     SETON                     61
     C                     END
     C*
     C* country maintenance screen
     C           WWMTYP    IFEQ 'CO'
     C                     MOVE *BLANKS   DDSECS
     C                     MOVE *BLANKS   DDINST
     C                     SETON                     62
     C                     END
     C*
     C* Because numeric file values have been moved to alpha fields
     C* on the display, zero will come out as all zeros. This has to
     C* be manually suppressed in the code as follows.
     C           DDPERC    IFEQ '000'
     C                     MOVE *BLANKS   DDPERC
     C                     END
     C*
     C           DDDATE    IFEQ '000000'
     C                     MOVE *BLANKS   DDDATE
     C                     END
     C*
     C           DDDAYN    IFEQ '00'
     C                     MOVE *BLANKS   DDDAYN
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #DC - If insert screen initialise all fields     *
     C**                                                              *
     C**  CALLS          - None                                       *
     C**                                                              *
     C**  CALLED BY      - #D                                         *
     C**                                                              *
     C*****************************************************************
     C           #DC       BEGSR
     C*
     C*
     C* If insert screen initialise all screen fields
     C           DDACTN    IFEQ 'I'
     C                     MOVE *BLANKS   DDPERC
     C                     MOVE *BLANKS   DDDATE
     C                     MOVE *BLANKS   DDFREQ
     C                     MOVE *BLANKS   DDDAYN
     C                     END
     C*
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #DD - Control processing of maintenance screen   *
     C**                                                              *
     C**  CALLS          - None                                       *
     C**                                                              *
     C**  CALLED BY      - #D                                         *
     C**                                                              *
     C*****************************************************************
     C           #DD       BEGSR
     C*
     C* If delete screen enable CMD 10
     C           DDACTN    IFEQ 'D'
     C                     SETON                     50
     C                     END
     C*
     C* If delete or enquiry protect fields
     C           DDACTN    IFEQ 'D'
     C           DDACTN    OREQ 'E'
     C                     SETON                     63
     C                     END
     C*
     C* Output screen first time through
     C                     WRITELB0215F1
     C                     WRITELB0215C8
     C                     EXFMTLB0215F4
     C*
SA   C           WWSCRN    DOWEQ'M'
     C           *INKC     ANDEQ'0'                        CMD 3
     C           *INKJ     ANDEQ'0'                        CMD 10
     C           *INKL     ANDEQ'0'                        CMD 12
     C*
     C* If not delete or enquiry validate screen  ENTER pressed
     C           DDACTN    IFNE 'D'
     C           DDACTN    ANDNE'E'
     C                     EXSR #DDA
     C                     END
     C*
     C* If enquiry go back to previous screen
     C           DDACTN    IFEQ 'E'
     C                     MOVE WWPREV    WWSCRN
     C                     END
     C*
     C           WWSCRN    IFEQ 'M'
     C                     WRITELB0215F1
     C                     WRITELB0215C8
     C                     EXFMTLB0215F4
     C                     END
     C*
EA   C                     END
     C*
     C*  UPDATE FILES ON ENTER OR CMD 10
     C           *INKC     IFNE '1'
     C           *INKL     ANDNE'1'
     C                     EXSR #DDB
     C                     END
     C*
     C*
     C* If cmd 12 next screen is initial screen
     C           *INKL     IFEQ '1'
     C                     MOVE 'I'       WWSCRN
     C                     ELSE
     C*
     C* Set review from fields so that original page of subfile is
     C* redisplayed
     C                     MOVE WWLCK1    DDRINS
     C                     MOVE WWLDK1    DDRSEC
     C                     MOVE WWLGK1    DDRCTY
     C                     MOVE WWCSK1    DDRCST
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************   LB0009
     C**                                                              *   LB0009
     C**  SUBROUTINE #DE - Control processing of maintenance screen   *   LB0009
     C**                   when called via review from subfile        *   LB0009
     C**                                                              *   LB0009
     C**  CALLS          - #DB #DC #DDA #DDE                          *   LB0009
     C**                                                              *   LB0009
     C**  CALLED BY      - #D                                         *   LB0009
     C**                                                              *   LB0009
     C*****************************************************************   LB0009
     C           #DE       BEGSR                                          LB0009
     C*                                                                   LB0009
     C                     Z-ADD1         RRN1                            LB0009
     C                     Z-ADD1         RRN2                            LB0009
     C                     Z-ADD1         RRN3                            LB0009
     C                     Z-ADD1         RRN4                            LB0009
     C                     Z-ADD1         RRN5                            LB0009
     C                     Z-ADD1         RRN6                            LB0009
     C                     Z-ADD1         RRN7                            LB0009
     C                     Z-ADD1         RRN#    30                      LB0009
     C*                                                                   LB0009
     C* Move appropiate Subfile page length to work field                 LB0009
     C*                                                                   LB0009
     C           WWRTYP    IFEQ 'CU'                                      LB0009
     C           WWMTYP    IFEQ 'CI'                                      080680
     C                     MOVE WWPAG6    WWPAG#  20                      LB0009
     C                     ELSE                                           080680
     C                     MOVE WWPAG7    WWPAG#  20                      080680
     C                     END                                            080680
     C                     ELSE                                           LB0009
     C           WWRTYP    IFEQ 'IN'                                      LB0009
     C                     MOVE WWPAG1    WWPAG#                          LB0009
     C                     ELSE                                           LB0009
     C           WWRTYP    IFEQ 'SE'                                      LB0009
     C                     MOVE WWPAG2    WWPAG#                          LB0009
     C                     ELSE                                           LB0009
     C           WWRTYP    IFEQ 'CO'                                      LB0009
     C                     MOVE WWPAG3    WWPAG#                          LB0009
     C                     ELSE                                           LB0009
     C           WWRTYP    IFEQ 'CI'                                      LB0009
     C                     MOVE WWPAG4    WWPAG#                          LB0009
     C                     ELSE                                           LB0009
     C           WWRTYP    IFEQ 'CS'                                      LB0009
     C                     MOVE WWPAG5    WWPAG#                          LB0009
     C                     END                                            LB0009
     C                     END                                            LB0009
     C                     END                                            LB0009
     C                     END                                            LB0009
     C                     END                                            LB0009
     C                     END                                            LB0009
     C*                                                                   LB0009
     C*                                                                   LB0009
     C                     SETON                     89                   LB0009
     C                     SETOF                     87                   LB0009
     C*                                                                   LB0009
B1   C           RRN#      DOWLEWWPAG#                                    LB0009
     C           WWSCRN    ANDEQ'M'                                       LB0009
     C           *INKC     ANDEQ'0'                                       LB0009
     C           *INKL     ANDEQ'0'                                       LB0009
     C*                                                                   LB0009
     C* CHAIN to Subfile                                                  LB0009
     C                     EXSR #DEA                                      LB0009
     C*                                                                   LB0009
B2   C***        DDSELT    IFEQ *BLANKS                                   LB0009
     C***                  ADD  1         RRN1                            LB0009
E2   C***                  END                                            LB0009
     C*                                                                   LB0009
B2   C***        RRN1      DOWLEWWPAG1                                    LB0009
     C***        DDSELT    ANDEQ*BLANKS                                   LB0009
     C***                  EXSR #DEA                                      LB0009
B3   C***        DDSELT    IFEQ *BLANKS                                   LB0009
     C***                  ADD  1         RRN1                            LB0009
E3   C***                  END                                            LB0009
E2   C***                  END                                            LB0009
     C*                                                                   LB0009
B2   C           DDSELT    IFNE *BLANKS                                   LB0009
     C*                                                                   LB0009
     C                     MOVE DDSELT    WWSELT                          LB0009
     C*                                                                   LB0009
     C* Fields are taken from hidden fields in review subfile             LB0009
     C                     EXSR #DB                                       LB0009
     C*                                                                   LB0009
     C* Initialise all fields if action is equal to I (insert)            LB0009
     C                     EXSR #DC                                       LB0009
     C*                                                                   LB0009
     C* If delete screen enable CMD 10                                    LB0009
B3   C           DDACTN    IFEQ 'D'                                       LB0009
     C                     SETON                     50                   LB0009
     C                     ELSE                                           LB0009
     C                     SETOF                     50                   LB0009
E3   C                     END                                            LB0009
     C*                                                                   LB0009
     C* If delete or enquiry protect fields                               LB0009
B3   C           DDACTN    IFEQ 'D'                                       LB0009
     C           DDACTN    OREQ 'E'                                       LB0009
     C                     SETON                     63                   LB0009
     C                     ELSE                                           LB0009
     C                     SETOF                     63                   LB0009
E3   C                     END                                            LB0009
     C*                                                                   LB0009
     C           DDSTUS    IFEQ 'D'
     C                     SETON                         71
     C                     ELSE
     C                     SETOF                         71
     C                     END
     C*
     C* Output screen first time through                                  LB0009
     C                     WRITELB0215F1                                  LB0009
     C                     WRITELB0215C8                                  LB0009
     C                     EXFMTLB0215F4                                  LB0009
     C*                                                                   LB0009
B3   C           WWSCRN    DOWEQ'M'                                       LB0009
     C           *INKC     ANDEQ'0'                        CMD 3          LB0009
     C           *INKJ     ANDEQ'0'                        CMD 10         LB0009
     C           *INKL     ANDEQ'0'                        CMD 12         LB0009
     C           *IN87     ANDEQ'0'                                       LB0009
     C*                                                                   LB0009
     C* If not delete or enquiry validate screen  ENTER pressed           LB0009
B4   C           DDACTN    IFNE 'D'                                       LB0009
     C           DDACTN    ANDNE'E'                                       LB0009
     C                     EXSR #DDA                                      LB0009
B5   C           WWEROR    IFEQ '1'                                       LB0009
     C                     SETOF                     87                   LB0009
X5   C                     ELSE                                           LB0009
     C                     SETON                     87                   LB0009
E5   C                     END                                            LB0009
E4   C                     END                                            LB0009
     C*                                                                   LB0009
     C* If enquiry go back to previous screen                             LB0009
B4   C           DDACTN    IFEQ 'E'                                       LB0009
     C****                 MOVE WWPREV    WWSCRN                          LB0009
     C                     SETON                     87                   LB0009
E4   C                     END                                            LB0009
     C*                                                                   LB0009
     C***        WWSCRN    IFEQ 'M'                                       LB0009
B4   C           *IN87     IFEQ '0'                                       LB0009
     C                     WRITELB0215F1                                  LB0009
     C                     WRITELB0215C8                                  LB0009
     C                     EXFMTLB0215F4                                  LB0009
E4   C                     END                                            LB0009
     C*                                                                   LB0009
E3   C                     END                                            LB0009
     C*                                                                   LB0009
     C*  UPDATE FILES ON ENTER OR CMD 10                                  LB0009
B3   C           *INKC     IFNE '1'                                       LB0009
     C           *INKL     ANDNE'1'                                       LB0009
     C                     EXSR #DDB                                      LB0009
E3   C                     END                                            LB0009
     C*                                                                   LB0009
E2   C                     END                                            LB0009
     C                     ADD  1         RRN#                            LB0009
     C*                                                                   LB0009
     C                     SETOF                     87                   LB0009
E1   C                     END                                            LB0009
     C*                                                                   LB0009
B1   C           RRN#      IFGT WWPAG#                                    LB0009
     C           *INKC     ANDEQ'0'                                       LB0009
     C           *INKL     ANDEQ'0'                                       LB0009
     C           WWSAVE    IFEQ 'CS'                                      080680
     C                     MOVE WWSAVE    WWMTYP                          080680
     C                     MOVE *BLANKS   WWSAVE                          080680
     C                     ELSE                                           080680
     C                     MOVE WWPREV    WWSCRN                          LB0009
     C                     END                                            080680
E1   C                     END                                            LB0009
     C*                                                                   LB0009
     C* If cmd 12 next screen is review screen                            LB0009
B1   C           *INKL     IFEQ '1'                                       LB0009
     C                     MOVE 'R'       WWSCRN                          LB0009
X1   C                     ELSE                                           LB0009
     C*                                                                   LB0009
     C* Set review from fields so that original page of subfile is        LB0009
     C* redisplayed                                                       LB0009
     C                     MOVE WWLCK1    DDRINS                          LB0009
     C                     MOVE WWLDK1    DDRSEC                          LB0009
     C                     MOVE WWLGK1    DDRCTY                          LB0009
     C                     MOVE WWCSK1    DDRCST                          LB0009
E1   C                     END                                            LB0009
     C*                                                                   LB0009
     C                     SETOF                     89                   LB0009
     C*                                                                   LB0009
     C                     ENDSR                                          LB0009
     C/EJECT                                                              LB0009
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #DDA- ENTER pressed on maintenance screen        *
     C**                                                              *
     C**  CALLS          - None                                       *
     C**                                                              *
     C**  CALLED BY      - #DD #DE                                    *   LB0009
     C**                                                              *
     C*****************************************************************
     C           #DDA      BEGSR
     C*
     C** Clear msg queue
     C*
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C* Initialise error indicators
     C                     MOVEA'000'     *IN,64            64 - 66 off
     C                     MOVE '0'       WWEROR
     C*
     C*
     C*................................................................
     C*
     C* Validate weighting
     C           DDPERC    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE DDPERC    ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD3         ZADIG
     C*
     C                     EXSR ZALIGN
     C           *IN99     IFEQ '0'
     C                     MOVE ZFIELD    DDPERC
     C                     END
     C*
     C* If field in error output message and highlight
     C*
     C           *IN99     IFEQ '1'
     C           WWPERC    ORGT 100
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0052' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     64
     C                     END
     C*
     C                     ELSE
     C                     MOVE '  0'     DDPERC
     C                     END
     C*
     C*................................................................
     C*
     C*  Validate review date
     C           DDDATE    IFNE *BLANKS
     C                     MOVE DDDATE    ZDATE
     C                     EXSR ZDATE1
     C*
     C* If date invalid format - ERROR
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0023' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     65
     C                     ELSE
     C*
     C* else if review date not later than current date - ERROR
     C           ZDAYNO    IFLE BJRDNB
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0030' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     65
     C                     END
     C                     END
     C*
     C                     ELSE
     C                     MOVE *BLANKS   ZDAYNO
     C                     END
     C*
     C*................................................................
     C*
     C* Validate review frequency
     C*
     C* Frequency must be M Q X or Y
     C           DDFREQ    IFNE 'M'
     C           DDFREQ    ANDNE'Q'
     C           DDFREQ    ANDNE'X'
     C           DDFREQ    ANDNE'Y'
     C***********DDFREQ    ANDNE*BLANKS
     C*
     C* Blank frequency only valid if review date entered
     C           DDFREQ    IFNE *BLANKS
     C           DDDATE    ORNE *BLANKS
     C           *IN65     ANDEQ'0'
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0036' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     66
     C                     END
     C                     END
     C*
     C* Frequency only valid if review date entered
     C           DDFREQ    IFNE *BLANKS
     C           DDDATE    ANDEQ*BLANKS
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0033' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     66
     C                     END
     C*
     C*................................................................
     C*
     C* Validate day number
     C*
     C* If day number entered must be in the range 1 - 31
     C           DDDAYN    IFNE *BLANKS
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE DDDAYN    ZFIELD
     C                     Z-ADD0         ZADEC
     C                     Z-ADD2         ZADIG
     C*
     C                     EXSR ZALIGN
     C                     MOVE ZFIELD    DDDAYN
     C*
     C* If field in error output message and highlight
     C           *IN99     IFEQ '1'
     C           WWDAYN    ORLT 1
     C           WWDAYN    ORGT 31
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0035' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     67
     C                     END
     C*
     C* Day number only valid if review date entered
     C           DDDATE    IFEQ *BLANKS
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0034' ZAMSID
     C                     EXSR ZASNMS
     C                     SETON                     67
     C                     END
     C*
     C* If day number not entered it defaults to day of review date
     C* if entered and valid
     C                     ELSE
     C           DDDATE    IFNE *BLANKS
     C           *IN65     ANDEQ'0'
     C           *IN66     ANDEQ'0'
     C                     MOVELDDDATE    DDDAYN
     C                     END
     C*
     C                     END
     C*
     C* If no errors go back to previous screen
     C           WWEROR    IFEQ '0'
     C           *IN89     ANDEQ'0'                                       LB0009
     C                     MOVE WWPREV    WWSCRN
     C                     END
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #DDB- UPDATE FILES ON ENTER OR CMD 10            *
     C**                                                              *
     C**  CALLS          - None                                       *
     C**                                                              *
     C**  CALLED BY      - #DD #DE                                    *   LB0009
     C**                                                              *
     C*****************************************************************
     C           #DDB      BEGSR
     C*
     C* Read trailer file for update
     C           'LBBPWRPD'CHAINLBTRAIPD             71
     C*
     C           *IN71     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C***********          MOVEL'LBTRAIPD'DBFILE           ***************S01498
     C                     MOVE 'LBTRAIPD'DBFILE                          S01498
     C                     MOVEL'LBBPWRPD'DBKEY            *             *
     C                     MOVE '004'     DBASE            * DBERROR 004 *
     C                     OUT  LDA                                       S01498
     C                     SETON                     U7U8LR*             *
     C                     EXSR #ZJ                        ***************
     C                     END
     C*
     C* **INSERTION**
     C           DDACTN    IFEQ 'I'                        *SA*
     C*
     C                     MOVE DDCNUM    WWWRKA
     C**********           Z-ADDWWWRKN    WWCNUM                                             CSD027A
     C                     MOVE WWWRKN    WWCNUM                                             CSD027A
     C*
     C* Check to see if record already exist
     C           KEYLB     CHAINLBBPWRLB             21
     C*
     C                     MOVE 'D'       BPRECI
     C                     MOVE DDCNUM    BPCNUM
     C                     MOVE DDINST    BPINST
     C                     MOVE DDSECS    BPSESN
     C                     MOVE DDCTRY    BPCTYI
     C                     MOVE ZDAYNO    BPREVD
     C                     MOVE DDFREQ    BPREVF
     C                     MOVE DDDAYN    BPREVN
     C                     Z-ADDBJRDNB    BPORED
     C*
     C* Update appropriate percentage field
     C           *IN60     IFEQ '1'                        *SB*
     C                     Z-ADDWWPERC    BPINPC
     C                     Z-ADD0         BPSEPC
     C                     Z-ADD0         BPCTPC
     C                     END                             *EB*
     C*
     C           *IN61     IFEQ '1'                        *SB*
     C                     Z-ADD0         BPINPC
     C                     Z-ADDWWPERC    BPSEPC
     C                     Z-ADD0         BPCTPC
     C                     END                             *EB*
     C*
     C           *IN62     IFEQ '1'                        *SB*
     C                     Z-ADD0         BPINPC
     C                     Z-ADD0         BPSEPC
     C                     Z-ADDWWPERC    BPCTPC
     C                     END                             *EB*
     C*
     C* If record already exists on file
     C           *IN21     IFEQ '0'                        *SB*
     C*
     C*
     C                     MOVE 'A'       TRCHTP
     C                     Z-ADDBJRDNB    TRLCD
     C*
     C* Check transaction number of last update
     C           BPTNLU    IFNE DDTNLU                     *SC*
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0057' ZAMSID
     C                     EXSR ZASNMS
     C                     EXCPTOUTLB
     C                     ELSE                            *XC*
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      BPTNLU
     C*
     C* If record deleted today
     C           BPCHTP    IFEQ 'D'
     C           BPLCD     ANDEQBJRDNB
     C                     ADD  1         TRLIVE
     C                     ADD  1         TRINS
     C                     SUB  1         TRDEL
     C*
     C                     ELSE
     C                     ADD  1         TRLIVE
     C                     ADD  1         TRINS
     C                     END
     C                     Z-ADDBJRDNB    BPLCD
     C                     MOVE 'I'       BPCHTP
     C*
     C* Get time, day, month and year of update
     C                     TIME           BPTLUP
     C                     MOVE BJMRDT    WWDATE
     C*
     C                     UPDATLBBPWRDB
     C                     END                             *EC*
     C*
     C* record does not exist
     C                     ELSE                            *XB*
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      BPTNLU
     C                     Z-ADDBJRDNB    BPLCD
     C                     MOVE 'I'       BPCHTP
     C*
     C* Get time, day, month and year of update
     C                     TIME           BPTLUP
     C                     MOVE BJMRDT    WWDATE
     C*
     C*
     C* Add new record
     C                     WRITELBBPWRDB               28
     C*
     C* If error on write
     C           *IN28     IFEQ '1'                        *SC*
     C*
     C* If record already exists output error message else dump
     C           STATUS    IFEQ 01021                      *SD*
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0057' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE                            *XD*
     C                     EXSR *PSSR
     C                     END                             *ED*
     C                     ELSE
     C*
     C* If write successful update trailer fields
     C                     ADD  1         TRINS
     C                     ADD  1         TRLIVE
     C                     MOVE 'A'       TRCHTP
     C                     Z-ADDBJRDNB    TRLCD
     C                     END                             *EC
     C*
     C                     END                             *EB*
     C                     END                             *EA*
     C*
     C*................................................................
     C* **AMENDMENT**
     C           DDACTN    IFEQ 'A'
     C*
     C                     MOVE DDCNUM    WWWRKA
     C**********           Z-ADDWWWRKN    WWCNUM                                             CSD027A
     C                     MOVE WWWRKN    WWCNUM                                             CSD027A
     C*
     C* Update existing record
     C           KEYLB     CHAINLBBPWRDB             21
     C           *IN21     IFEQ '0'
     C*
     C* If record has not been inserted today
     C           BPLCD     IFNE BJRDNB
     C           BPCHTP    ORNE 'I'
     C*
     C* Get time, day, month and year of update
     C                     TIME           BPTLUP
     C                     MOVE BJMRDT    WWDATE
     C*
     C                     MOVE 'A'       BPCHTP
     C                     Z-ADDBJRDNB    TRLCD
     C                     MOVE 'A'       TRCHTP
     C*
     C* If record has not been AMENDED today
     C           BPLCD     IFNE BJRDNB
     C           BPCHTP    ORNE 'A'
     C                     ADD  1         TRAMD
     C                     END
     C*
     C                     END
     C*
     C                     MOVE ZDAYNO    BPREVD
     C                     MOVE DDFREQ    BPREVF
     C                     MOVE DDDAYN    BPREVN
     C                     Z-ADDBJRDNB    BPLCD
     C*
     C* Update appropriate percentage field
     C           *IN60     IFEQ '1'
     C                     Z-ADDWWPERC    BPINPC
     C                     Z-ADD0         BPSEPC
     C                     Z-ADD0         BPCTPC
     C                     END
     C*
     C           *IN61     IFEQ '1'
     C                     Z-ADD0         BPINPC
     C                     Z-ADDWWPERC    BPSEPC
     C                     Z-ADD0         BPCTPC
     C                     END
     C*
     C           *IN62     IFEQ '1'
     C                     Z-ADD0         BPINPC
     C                     Z-ADD0         BPSEPC
     C                     Z-ADDWWPERC    BPCTPC
     C                     END
     C*
     C           BPTNLU    IFNE DDTNLU
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0057' ZAMSID
     C                     EXSR ZASNMS
     C                     EXCPTOUTLB
     C                     ELSE
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      BPTNLU
     C*
     C                     UPDATLBBPWRDB
     C                     END
     C*
     C                     ELSE
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0057' ZAMSID
     C                     EXSR ZASNMS
     C                     END
     C*
     C                     END
     C*
     C*................................................................
     C* **DELETION**
     C           DDACTN    IFEQ 'D'
     C*
     C                     MOVE DDCNUM    WWWRKA
     C**********           Z-ADDWWWRKN    WWCNUM                                             CSD027A
     C                     MOVE WWWRKN    WWCNUM                                             CSD027A
     C*
     C* Update existing record
     C           KEYLB     CHAINLBBPWRDB             21
     C           *IN21     IFEQ '0'
     C*
     C* If record has been inserted today
     C           BPLCD     IFEQ BJRDNB
     C           BPCHTP    ANDEQ'I'
     C                     ADD  1         TRDEL
     C                     SUB  1         TRINS
     C                     SUB  1         TRLIVE
     C                     ELSE
     C*
     C* If record has been amended today
     C           BPLCD     IFEQ BJRDNB
     C           BPCHTP    ANDEQ'A'
     C                     ADD  1         TRDEL
     C                     SUB  1         TRAMD
     C                     SUB  1         TRLIVE
     C                     ELSE
     C*
     C                     ADD  1         TRDEL
     C                     SUB  1         TRLIVE
     C                     END
     C                     END
     C                     Z-ADDBJRDNB    TRLCD
     C                     MOVE 'A'       TRCHTP
     C*
     C*
     C           BPTNLU    IFNE DDTNLU
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0057' ZAMSID
     C                     EXSR ZASNMS
     C                     EXCPTOUTLB
     C                     ELSE
     C                     Z-ADDBJRDNB    BPLCD
     C                     MOVE 'D'       BPCHTP
     C                     MOVE '*'       BPRECI
     C                     EXSR ZTNLU1
     C                     Z-ADDNATN      BPTNLU
     C*
     C* Get time, day, month and year of update
     C                     TIME           BPTLUP
     C                     MOVE BJMRDT    WWDATE
     C*
     C                     UPDATLBBPWRDB
     C                     END
     C*
     C                     ELSE
     C                     MOVE '1'       WWEROR
     C                     MOVEL'LBM0057' ZAMSID
     C                     EXSR ZASNMS
     C                     END
     C*
     C           *IN89     IFEQ '0'                                       LB0009
     C                     MOVE WWPREV    WWSCRN
     C                     END                                            LB0009
     C*
     C                     END
     C*
     C                     UPDATLBTRAID0
     C*
     C*................................................................
     C*
     C           WWEROR    IFEQ '0'
     C*
     C**   SET UP COMMITMENT TEXT
     C                     MOVEL'LB'      MDID
     C                     MOVEL'LB0215'  PGMN
     C                     MOVELDDJOB     WSIDX
     C                     MOVELUSER      USIDX
     C                     MOVE *BLANKS   ACTCDX
     C                     MOVE *BLANKS   SCRN1
     C                     MOVE *BLANKS   SCRN2
     C                     MOVE *BLANKS   SCRN3
     C                     MOVE *BLANKS   SCRN4
     C                     MOVE BPCNUM    SCRN1
     C                     MOVE BPINST    SCRN2
     C                     MOVE BPSESN    SCRN3
     C                     MOVE BPCTYI    SCRN4
     C                     TIME           MTIME
     C*
     C           CMTTXT    COMIT
     C                     ELSE
     C                     ROLBK
     C                     END
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************   LB0009
     C**                                                              *   LB0009
     C**  SUBROUTINE #DEA   - Chains to Various Subfiles              *   LB0009
     C**                                                              *   LB0009
     C**  CALLS             - none                                    *   LB0009
     C**                                                              *   LB0009
     C**  CALLED BY         - #DE                                     *   LB0009
     C**                                                              *   LB0009
     C*****************************************************************   LB0009
     C           #DEA      BEGSR                                          LB0009
     C*                                                                   LB0009
     C* Chain to appropiate Subfile                                       LB0009
     C*                                                                   LB0009
     C           WWRTYP    IFEQ 'CU'                                      LB0009
     C           WWMTYP    IFEQ 'CI'                                      080680
     C                     Z-ADDRRN#      RRN6                            LB0009
     C           RRN6      CHAINLB0215S6             26                   LB0009
     C                     ELSE                                           080680
     C                     Z-ADDRRN#      RRN7                            080680
     C           RRN7      CHAINLB0215S7             26                   080680
     C                     END                                            080680
     C                     ELSE                                           LB0009
     C           WWRTYP    IFEQ 'IN'                                      LB0009
     C                     Z-ADDRRN#      RRN1                            LB0009
     C           RRN1      CHAINLB0215S1             26                   LB0009
     C                     ELSE                                           LB0009
     C           WWRTYP    IFEQ 'SE'                                      LB0009
     C                     Z-ADDRRN#      RRN2                            LB0009
     C           RRN2      CHAINLB0215S2             26                   LB0009
     C                     ELSE                                           LB0009
     C           WWRTYP    IFEQ 'CO'                                      LB0009
     C                     Z-ADDRRN#      RRN3                            LB0009
     C           RRN3      CHAINLB0215S3             26                   LB0009
     C                     ELSE                                           LB0009
     C           WWRTYP    IFEQ 'CI'                                      LB0009
     C                     Z-ADDRRN#      RRN4                            LB0009
     C           RRN4      CHAINLB0215S4             26                   LB0009
     C                     ELSE                                           LB0009
     C           WWRTYP    IFEQ 'CS'                                      LB0009
     C                     Z-ADDRRN#      RRN5                            LB0009
     C           RRN5      CHAINLB0215S5             26                   LB0009
     C                     END                                            LB0009
     C                     END                                            LB0009
     C                     END                                            LB0009
     C                     END                                            LB0009
     C                     END                                            LB0009
     C                     END                                            LB0009
     C*                                                                   LB0009
     C                     ENDSR                                          LB0009
     C/EJECT                                                              LB0009
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #ZA    - Build instrument subfile page           *
     C**                                                              *
     C**  CALLS             - none                                    *
     C**                                                              *
     C**  CALLED BY         - #CA                                     *
     C**                                                              *
     C*****************************************************************
     C           #ZA       BEGSR
     C*
     C* setof SFLDSP SFLEND
     C                     SETOF                     313435
     C                     Z-ADD*ZEROS    WWPAG6  20
     C*
     C* Clear instrument subfile
     C                     SETON                     36
     C                     WRITELB0215C6
     C                     SETOF                     36
     C                     Z-ADD*ZEROS    RRN6
     C*
     C                     MOVELDDRCST    WWCNUM
     C*
     C* Read file, load subfile, increase rrn
     C*
     C           KEYLC     SETLLLBBPWRLC
     C           WWCNUM    READELBBPWRLC                 26
     C*
     C* Store key of first record on subfile page
     C                     MOVELBPINST    WWLCK1  3
     C                     MOVELBPCNUM    WWCSK1
     C*
     C                     SETON                     35
     C                     MOVE *BLANKS   DDSELT
     C*
     C*
     C           *IN26     DOWEQ'0'
     C           WWPAG6    ANDLT6
     C*
     C* Get instrument name
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM *BLANKS   @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM BPINST    @INNR   3                       S01498
     C           SDPLIN    PARM SDPLIN    DSFDY                           S01498
     C***********BPINST    CHAINSDPLINL4             27                   S01498
     C************IN27     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C***********          MOVEL'SDPLINL4'DBFILE           ***************S01498
     C                     MOVE 'SDPLINPD'DBFILE                          S01498
     C                     MOVELBPINST    DBKEY            *             *
     C                     MOVE '005'     DBASE            * DBERROR 005 *
     C                     OUT  LDA                                       S01498
     C                     SETON                     U7U8LR*             *
     C                     EXSR #ZJ                        ***************
     C                     ELSE
     C                     MOVE PDISTN    DDINSN
     C                     END
     C*
     C* If record is of status deleted output 'D'
     C           BPRECI    IFEQ '*'
     C                     MOVE 'D'       DDSTUS
     C                     ELSE
     C                     MOVE *BLANKS   DDSTUS
     C                     END
     C*
     C                     MOVE BPINST    DDINST
     C                     Z-ADDBPINPC    WWPERC
     C                     Z-ADDBPREVD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDATE
     C                     MOVE BPREVF    DDFREQ
     C                     MOVE BPREVN    DDDAYN
     C                     MOVE BPTNLU    DDTNLU
     C                     MOVE WWCNUM    DDCNUM
     C                     MOVE WWPNP8    DDPNP8
     C                     MOVE WWBRCH    DDBRCH                          S01498
     C*
     C                     ADD  1         RRN6
     C                     WRITELB0215S6
     C                     SETON                     31
     C                     ADD  1         WWPAG6
     C*
     C* Read next instrument for entered customer
     C           WWCNUM    READELBBPWRLC                 26
     C*
     C                     END
     C*
     C* If end of subfile
     C           *IN26     IFEQ '1'
     C                     SETON                     34    SFLEND
     C                     MOVE *BLANKS   DDRINS
     C*
     C* else set review details at top of screen to next record on subfile
     C                     ELSE
     C                     MOVE BPINST    DDRINS
     C                     END
     C*
     C                     Z-ADD1         RRN6
     C*
     C                     EXSR #ZAA
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #ZAA   - Build security subfile page             *
     C**                                                              *
     C**  CALLS             - none                                    *
     C**                                                              *
     C**  CALLED BY         - #ZA                                     *
     C**                                                              *
     C*****************************************************************
     C           #ZAA      BEGSR
     C* setof SFLDSP SFLEND
     C                     SETOF                     334235
     C                     Z-ADD*ZEROS    WWPAG7  20
     C*
     C* Clear instrument subfile
     C                     SETON                     36
     C                     WRITELB0215C7
     C                     SETOF                     36
     C                     Z-ADD*ZEROS    RRN7
     C*
     C* Read file, load subfile, increase rrn
     C*
     C           KEYLD     SETLLLBBPWRLD
     C           WWCNUM    READELBBPWRLD                 26
     C*
     C* Store key of first record on subfile page
     C                     MOVELBPSESN    WWLDK1 10
     C                     MOVELBPCNUM    WWCSK1
     C*
     C                     SETON                     35
     C                     MOVE *BLANKS   DDSELT
     C*
     C           *IN26     DOWEQ'0'
     C           WWPAG7    ANDLT6
     C*
     C* Get security name
     C           BPSESN    CHAINSECTY                27
     C           *IN27     IFEQ '1'
     C                     MOVEAMSG1,1    DDSEC1
     C                     ELSE
     C                     MOVE SFN1      DDSEC1
     C                     END
     C*
     C* If record is of status deleted output 'D'
     C           BPRECI    IFEQ '*'
     C                     MOVE 'D'       DDSTUS
     C                     ELSE
     C                     MOVE *BLANKS   DDSTUS
     C                     END
     C*
     C                     MOVE BPSESN    DDSECS
     C                     Z-ADDBPSEPC    WWPERC
     C                     Z-ADDBPREVD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDATE
     C                     MOVE BPREVF    DDFREQ
     C                     MOVE BPREVN    DDDAYN
     C                     MOVE BPTNLU    DDTNLU
     C                     MOVE WWCNUM    DDCNUM
     C                     MOVE WWPNP8    WWPNP8
     C                     MOVE WWBRCH    DDBRCH                          S01498
     C*
     C                     ADD  1         RRN7
     C                     WRITELB0215S7
     C                     SETON                     33
     C                     ADD  1         WWPAG7
     C*
     C* Read next instrument for entered customer
     C           WWCNUM    READELBBPWRLD                 26
     C*
     C                     END
     C*
     C* If end of subfile
     C           *IN26     IFEQ '1'
     C                     SETON                     42    SFLEND
     C                     MOVE *BLANKS   DDRSEC
     C*
     C* else set review details at top of screen to next record on subfile
     C                     ELSE
     C                     MOVE BPSESN    DDRSEC
     C                     END
     C*
     C                     Z-ADD1         RRN7
     C*
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #ZB   - Build instrument subfile page            *
     C**                                                              *
     C**  CALLS            - none                                     *
     C**                                                              *
     C**  CALLED BY        - #CB                                      *
     C**                                                              *
     C*****************************************************************
     C           #ZB       BEGSR
     C*
     C* setof SFLDSP SFLEND
     C                     SETOF                     333435
     C                     Z-ADD*ZEROS    WWPAG1  20
     C*
     C* Clear instrument subfile
     C                     SETON                     36
     C                     WRITELB0215C1
     C                     SETOF                     36
     C                     Z-ADD*ZEROS    RRN1
     C*
     C* Read file, load subfile, increase rrn
     C*
     C           DDRINS    SETLLLBBPWRLE
     C                     READ LBBPWRLE                 26
     C*
     C* Store key of first record on subfile page
     C                     MOVE DDRINS    WWLCK1
     C*
     C                     SETON                     35
     C                     MOVE *BLANKS   DDSELT
     C*
     C*
     C           *IN26     DOWEQ'0'
     C           WWPAG1    ANDLT13
     C*
     C* Get instrument name
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM *BLANKS   @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM BPINST    @INNR   3                       S01498
     C           SDPLIN    PARM SDPLIN    DSFDY                           S01498
     C***********BPINST    CHAINSDPLINL4             27                   S01498
     C************IN27     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C***********          MOVEL'SDPLINL4'DBFILE           ***************S01498
     C                     MOVE 'SDPLINPD'DBFILE                          S01498
     C                     MOVELBPINST    DBKEY            *             *
     C                     MOVE '006'     DBASE            * DBERROR 006 *
     C                     OUT  LDA                                       S01498
     C                     SETON                     U7U8LR*             *
     C                     EXSR #ZJ                        ***************
     C                     ELSE
     C                     MOVE PDISTN    DDINSN
     C                     END
     C*
     C* If record is of status deleted output 'D'
     C           BPRECI    IFEQ '*'
     C                     MOVE 'D'       DDSTUS
     C                     ELSE
     C                     MOVE *BLANKS   DDSTUS
     C                     END
     C*
     C                     MOVE BPINST    DDINST
     C                     Z-ADDBPINPC    WWPERC
     C                     Z-ADDBPREVD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDATE
     C                     MOVE BPREVF    DDFREQ
     C                     MOVE BPREVN    DDDAYN
     C                     MOVE BPTNLU    DDTNLU
     C                     MOVE WWCNUM    DDCNUM
     C                     MOVE WWPNP8    DDPNP8
     C*
     C                     ADD  1         RRN1
     C                     WRITELB0215S1
     C                     SETON                     33
     C                     ADD  1         WWPAG1
     C*
     C* Read next instrument
     C                     READ LBBPWRLE                 26
     C*
     C                     END
     C*
     C* If end of subfile
     C           *IN26     IFEQ '1'
     C                     SETON                     34    SFLEND
     C                     MOVE *BLANKS   DDRINS
     C*
     C* else set review details at top of screen to next record on subfile
     C                     ELSE
     C                     MOVE BPINST    DDRINS
     C                     END
     C*
     C                     Z-ADD1         RRN1
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #ZC   - Build security   subfile page            *
     C**                                                              *
     C**  CALLS            - none                                     *
     C**                                                              *
     C**  CALLED BY        - #CC                                      *
     C**                                                              *
     C*****************************************************************
     C           #ZC       BEGSR
     C*
     C* setof SFLDSP SFLEND
     C                     SETOF                     333435
     C                     Z-ADD*ZEROS    WWPAG2  20
     C*
     C* Clear instrument subfile
     C                     SETON                     36
     C                     WRITELB0215C2
     C                     SETOF                     36
     C                     Z-ADD*ZEROS    RRN2
     C*
     C* Read file, load subfile, increase rrn
     C*
     C           DDRSEC    SETLLLBBPWRLF
     C                     READ LBBPWRLF                 26
     C*
     C* Store key of first record on subfile page
     C                     MOVE DDRSEC    WWLDK1
     C*
     C                     SETON                     35
     C                     MOVE *BLANKS   DDSELT
     C*
     C*
     C           *IN26     DOWEQ'0'
     C           WWPAG2    ANDLT13
     C*
     C* Get security name
     C           BPSESN    CHAINSECTY                27
     C           *IN27     IFEQ '1'
     C                     MOVEAMSG1,1    DDSEC1
     C                     ELSE
     C                     MOVE SFN1      DDSEC1
     C                     END
     C*
     C* If record is of status deleted output 'D'
     C           BPRECI    IFEQ '*'
     C                     MOVE 'D'       DDSTUS
     C                     ELSE
     C                     MOVE *BLANKS   DDSTUS
     C                     END
     C*
     C                     MOVE BPSESN    DDSECS
     C                     Z-ADDBPSEPC    WWPERC
     C                     Z-ADDBPREVD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDATE
     C                     MOVE BPREVF    DDFREQ
     C                     MOVE BPREVN    DDDAYN
     C                     MOVE BPTNLU    DDTNLU
     C                     MOVE *BLANKS   DDCNUM
     C                     MOVE *BLANKS   DDPNP8
     C*
     C                     ADD  1         RRN2
     C                     WRITELB0215S2
     C                     SETON                     33
     C                     ADD  1         WWPAG2
     C*
     C* Read next instrument
     C                     READ LBBPWRLF                 26
     C*
     C                     END
     C*
     C* If end of subfile
     C           *IN26     IFEQ '1'
     C                     SETON                     34    SFLEND
     C                     MOVE *BLANKS   DDRSEC
     C*
     C* else set review details at top of screen to next record on subfile
     C                     ELSE
     C                     MOVE BPSESN    DDRSEC
     C                     END
     C*
     C                     Z-ADD1         RRN2
     C*
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #ZD   - Build country    subfile page            *
     C**                                                              *
     C**  CALLS            - none                                     *
     C**                                                              *
     C**  CALLED BY        - #CD                                      *
     C**                                                              *
     C*****************************************************************
     C           #ZD       BEGSR
     C*
     C* setof SFLDSP SFLEND
     C                     SETOF                     333435
     C                     Z-ADD*ZEROS    WWPAG3  20
     C*
     C* Clear instrument subfile
     C                     SETON                     36
     C                     WRITELB0215C3
     C                     SETOF                     36
     C                     Z-ADD*ZEROS    RRN3
     C*
     C* Read file, load subfile, increase rrn
     C*
     C           DDRCTY    SETLLLBBPWRLG
     C                     READ LBBPWRLG                 26
     C*
     C* Store key of first record on subfile page
     C                     MOVE DDRCTY    WWLGK1  2
     C*
     C                     SETON                     35
     C                     MOVE *BLANKS   DDSELT
     C*
     C*
     C           *IN26     DOWEQ'0'
     C           WWPAG3    ANDLT13
     C*
     C* Get country name
     C                     CALL 'AOCTRYR0'                                S01498
     C                     PARM *BLANKS   @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM BPCTYI    @CNCD   2                       S01498
     C           SDCTRY    PARM SDCTRY    DSFDY                           S01498
     C***********BPCTYI    CHAINSDCTRYL0             27                   S01498
     C************IN27     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C***********          MOVEL'SDCTRYL0'DBFILE           ***************S01498
     C                     MOVE 'SDCTRYPD'DBFILE                          S01498
     C                     MOVELBPCTYI    DBKEY            *             *
     C                     MOVE '008'     DBASE            * DBERROR 008 *
     C                     OUT  LDA                                       S01498
     C                     SETON                     U7U8LR*             *
     C                     EXSR #ZJ                        ***************
     C                     ELSE
     C                     MOVE A4CNNM    DDCTRN
     C                     END
     C*
     C* If record is of status deleted output 'D'
     C           BPRECI    IFEQ '*'
     C                     MOVE 'D'       DDSTUS
     C                     ELSE
     C                     MOVE *BLANKS   DDSTUS
     C                     END
     C*
     C                     MOVE BPCTYI    DDCTRY
     C                     Z-ADDBPCTPC    WWPERC
     C                     Z-ADDBPREVD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDATE
     C                     MOVE BPREVF    DDFREQ
     C                     MOVE BPREVN    DDDAYN
     C                     MOVE BPTNLU    DDTNLU
     C                     MOVE *BLANKS   DDCNUM
     C                     MOVE *BLANKS   DDPNP8
     C*
     C                     ADD  1         RRN3
     C                     WRITELB0215S3
     C                     SETON                     33
     C                     ADD  1         WWPAG3
     C*
     C* Read next instrument
     C                     READ LBBPWRLG                 26
     C*
     C                     END
     C*
     C* If end of subfile
     C           *IN26     IFEQ '1'
     C                     SETON                     34    SFLEND
     C                     MOVE *BLANKS   DDRCTY
     C*
     C* else set review details at top of screen to next record on subfile
     C                     ELSE
     C                     MOVE BPCTYI    DDRCTY
     C                     END
     C*
     C                     Z-ADD1         RRN3
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #ZE   - Build customer/instrument subfile page   *
     C**                                                              *
     C**  CALLS            - none                                     *
     C**                                                              *
     C**  CALLED BY        - #CE                                      *
     C**                                                              *
     C*****************************************************************
     C           #ZE       BEGSR
     C*
     C* setof SFLDSP SFLEND
     C                     SETOF                     333435
     C                     Z-ADD*ZEROS    WWPAG4  20
     C**********           Z-ADD*ZEROS    WWWRKN                                             CSD027A
     C                     MOVE *BLANKS   WWWRKN                                             CSD027A
     C*
     C* If rolldown clear customer field used to chain to file
     C           *IN39     IFEQ '1'
     C**********           Z-ADD0         WWCNUM                                             CSD027A
     C                     MOVE *BLANKS   WWCNUM                                             CSD027A
     C*
     C                     END
     C*
     C* Clear instrument subfile
     C                     SETON                     36
     C                     WRITELB0215C4
     C                     SETOF                     36
     C                     Z-ADD*ZEROS    RRN4
     C*
     C* Read file, load subfile, increase rrn
     C*
     C           KEYLC     SETLLLBBPWRLC
     C                     READ LBBPWRLC                 26
     C*
     C* Store key of first record on subfile page
     C                     MOVE BPINST    WWLCK1
     C                     MOVELBPCNUM    WWCSK1  6
     C*
     C                     SETON                     35
     C                     MOVE *BLANKS   DDSELT
     C*
     C*
     C           *IN26     DOWEQ'0'
     C           WWPAG4    ANDLT13
     C*
     C* Get instrument name
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM *BLANKS   @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM BPINST    @INNR   3                       S01498
     C           SDPLIN    PARM SDPLIN    DSFDY                           S01498
     C***********BPINST    CHAINSDPLINL4             27                   S01498
     C************IN27     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C***********          MOVEL'SDPLINL4'DBFILE           ***************S01498
     C                     MOVE 'SDPLINPD'DBFILE                          S01498
     C                     MOVELBPINST    DBKEY            *             *
     C                     MOVE '007'     DBASE            * DBERROR 007 *
     C                     OUT  LDA                                       S01498
     C                     SETON                     U7U8LR*             *
     C                     EXSR #ZJ                        ***************
     C                     ELSE
     C                     MOVE PDISTN    DDINSN
     C                     END
     C*
     C*
     C*
     C* If record is of status deleted output 'D'
     C           BPRECI    IFEQ '*'
     C                     MOVE 'D'       DDSTUS
     C                     ELSE
     C                     MOVE *BLANKS   DDSTUS
     C                     END
     C*
     C                     MOVE BPINST    DDINST
     C                     Z-ADDBPINPC    WWPERC
     C                     Z-ADDBPREVD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDATE
     C                     MOVE BPREVF    DDFREQ
     C                     MOVE BPREVN    DDDAYN
     C                     MOVE BPTNLU    DDTNLU
     C*
     C* On change of customer get new details
     C           BPCNUM    IFNE WWWRKN
     C                     MOVE BPCNUM    DDCNUM
     C*
     C* Get customer shortname
     C**********           Z-ADDBPCNUM    WWWRKN                                             CSD027A
     C                     MOVE BPCNUM    WWWRKN                                             CSD027A
     C***********WWWRKA    CHAINSDLBCSL0             25                   S01498
     C           WWWRKA    CHAINLBLBCSJ0             25                   S01498
     C           *IN25     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C***********          MOVEL'SDLBCSL0'DBFILE           ***************S01498
     C                     MOVE 'LBLBCSJ0'DBFILE                          S01498
     C                     MOVELWWWRKA    DBKEY            *             *
     C                     MOVE '009'     DBASE            * DBERROR 009 *
     C                     OUT  LDA                                       S01498
     C                     SETON                     U7U8LR*             *
     C                     EXSR #ZJ                        ***************
     C*
     C                     ELSE
     C                     MOVE BBCSSN    DDPNP8
     C                     MOVE BBBRCD    DDBRCH                          S01498
     C                     END
     C                     END
     C*
     C                     ADD  1         RRN4
     C                     WRITELB0215S4
     C                     SETON                     33
     C                     ADD  1         WWPAG4
     C*
     C* Read next instrument
     C                     READ LBBPWRLC                 26
     C*
     C                     END
     C*
     C* If end of subfile
     C           *IN26     IFEQ '1'
     C                     SETON                     34    SFLEND
     C                     MOVE *BLANKS   DDRINS
     C                     MOVE *BLANKS   DDRCST
     C*
     C* else set review details at top of screen to next record on subfile
     C                     ELSE
     C                     MOVE BPINST    DDRINS
     C                     MOVE *BLANKS   DDRCST
     C                     MOVELBPCNUM    DDRCST
     C                     END
     C*
     C                     Z-ADD1         RRN4
     C*
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #ZF   - Build customer/security subfile page     *
     C**                                                              *
     C**  CALLS            - none                                     *
     C**                                                              *
     C**  CALLED BY        - #CF                                      *
     C**                                                              *
     C*****************************************************************
     C           #ZF       BEGSR
     C*
     C* setof SFLDSP SFLEND
     C                     SETOF                     333435
     C                     Z-ADD*ZEROS    WWPAG5  20
     C**********           Z-ADD*ZEROS    WWWRKN                                             CSD027A
     C                     MOVE *BLANKS   WWWRKN                                             CSD027A
     C*
     C* If rolldown clear customer field used to chain to file
     C           *IN39     IFEQ '1'
     C**********           Z-ADD0         WWCNUM                                             CSD027A
     C                     MOVE *BLANKS   WWCNUM                                             CSD027A
     C*
     C                     END
     C*
     C* Clear subfile
     C                     SETON                     36
     C                     WRITELB0215C5
     C                     SETOF                     36
     C                     Z-ADD*ZEROS    RRN5
     C*
     C* Read file, load subfile, increase rrn
     C*
     C           KEYLD     SETLLLBBPWRLD
     C                     READ LBBPWRLD                 26
     C*
     C* Store key of first record on subfile page
     C                     MOVE BPSESN    WWLDK1
     C                     MOVELBPCNUM    WWCSK1
     C*
     C                     SETON                     35
     C                     MOVE *BLANKS   DDSELT
     C*
     C*
     C           *IN26     DOWEQ'0'
     C           WWPAG5    ANDLT13
     C*
     C* Get security name
     C           BPSESN    CHAINSECTY                27
     C           *IN27     IFEQ '1'
     C                     MOVEAMSG1,1    DDSEC1
     C                     ELSE
     C                     MOVE SFN1      DDSEC1
     C                     END
     C*
     C*
     C* If record is of status deleted output 'D'
     C           BPRECI    IFEQ '*'
     C                     MOVE 'D'       DDSTUS
     C                     ELSE
     C                     MOVE *BLANKS   DDSTUS
     C                     END
     C*
     C                     MOVE BPSESN    DDSECS
     C                     Z-ADDBPSEPC    WWPERC
     C                     Z-ADDBPREVD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     DDDATE
     C                     MOVE BPREVF    DDFREQ
     C                     MOVE BPREVN    DDDAYN
     C                     MOVE BPTNLU    DDTNLU
     C*
     C* On change of customer get new details
     C           BPCNUM    IFNE WWWRKN
     C                     MOVE BPCNUM    DDCNUM
     C*
     C* Get customer shortname
     C**********           Z-ADDBPCNUM    WWWRKN                                             CSD027A
     C                     MOVE BPCNUM    WWWRKN                                             CSD027A
     C***********WWWRKA    CHAINSDLBCSL0             25                   S01498
     C           WWWRKA    CHAINLBLBCSJ0             25                   S01498
     C           *IN25     IFEQ '1'
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C***********          MOVEL'SDLBCSL0'DBFILE           ***************S01498
     C                     MOVE 'LBLBCSJ0'DBFILE                          S01498
     C                     MOVELWWWRKA    DBKEY            *             *
     C                     MOVE '010'     DBASE            * DBERROR 010 *
     C                     OUT  LDA                                       S01498
     C                     SETON                     U7U8LR*             *
     C                     EXSR #ZJ                        ***************
     C*
     C                     ELSE
     C                     MOVE BBCSSN    DDPNP8
     C                     MOVE BBBRCD    DDBRCH                          S01498
     C                     END
     C                     END
     C*
     C*
     C                     ADD  1         RRN5
     C                     WRITELB0215S5
     C                     SETON                     33
     C                     ADD  1         WWPAG5
     C*
     C* Read next SECURITY
     C                     READ LBBPWRLD                 26
     C*
     C                     END
     C*
     C* If end of subfile
     C           *IN26     IFEQ '1'
     C                     SETON                     34    SFLEND
     C                     MOVE *BLANKS   DDRSEC
     C                     MOVE *BLANKS   DDRCST
     C*
     C* else set review details at top of screen to next record on subfile
     C                     ELSE
     C                     MOVE BPSESN    DDRSEC
     C                     MOVE *BLANKS   DDRCST
     C                     MOVELBPCNUM    DDRCST
     C                     END
     C*
     C                     Z-ADD1         RRN5
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #ZH   - Validate subfile selection from review   *
     C**                     screen                                   *
     C**                                                              *
     C**  CALLS            - none                                     *
     C**                                                              *
     C**  CALLED BY        - #CAA #CBA #CCA #CDA #CEA #CFA            *
     C**                                                              *
     C*****************************************************************
     C           #ZH       BEGSR
     C*
     C                     SETOF                     70
     C*
     C* Select I and record already exists (ie status not D)
     C           DDSELT    IFEQ 'I'
     C           DDSTUS    ANDNE'D'
     C           *IN55     IFEQ '0'                                       LB0009
     C                     MOVEL'LBM0050' ZAMSID
     C                     EXSR ZASNMS
     C                     END                                            LB0009
     C                     MOVE '1'       WWEROR
     C                     SETON                       5570               LB0009
     C                     END
     C*
     C* Select A and record deleted
     C           DDSELT    IFEQ 'A'
     C           DDSTUS    ANDEQ'D'
     C           *IN56     IFEQ '0'                                       LB0009
     C                     MOVEL'LBM0051' ZAMSID
     C                     EXSR ZASNMS
     C                     END                                            LB0009
     C                     MOVE '1'       WWEROR
     C                     SETON                       5670               LB0009
     C                     END
     C*
     C* Select D and record does not exist(ie status D)
     C           DDSELT    IFEQ 'D'
     C           DDSTUS    ANDEQ'D'
     C           *IN56     IFEQ '0'                                       LB0009
     C                     MOVEL'LBM0051' ZAMSID
     C                     EXSR ZASNMS
     C                     END                                            LB0009
     C                     MOVE '1'       WWEROR
     C                     SETON                       5670               LB0009
     C                     END
     C*
     C* Selection not equal to I A D or E
     C           DDSELT    IFNE 'I'
     C           DDSELT    ANDNE'A'
     C           DDSELT    ANDNE'D'
     C           DDSELT    ANDNE'E'
     C           DDSELT    ANDNE*BLANKS
     C           *IN57     IFEQ '0'                                       LB0009
     C                     MOVEL'LBM0039' ZAMSID
     C                     EXSR ZASNMS
     C                     END                                            LB0009
     C                     MOVE '1'       WWEROR
     C                     SETON                       5770               LB0009
     C                     END
     C*
     C** If error on this field seton 'at least one error on subfile'     LB0009
     C*  indicator                                                        LB0009
     C           *IN70     IFEQ '1'                                       LB0009
     C                     SETON                       8880               LB0009
     C                     END                                            LB0009
     C*                                                                   LB0009
     C                     MOVE DDSELT    WWSELT
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #ZI   - Build new page of subfile                *
     C**                                                              *
     C**  CALLS            - none                                     *
     C**                                                              *
     C**  CALLED BY        - #CA #CB #CC #CD #CE #CF                  *
     C**                                                              *
     C*****************************************************************
     C           #ZI       BEGSR
     C*
     C*
     C* If rolldown
     C           *IN39     IFEQ '1'
     C*
     C* Set all review fields to blanks
     C*  IF NOT DOUBLE SUBFILE DISPLAYED BLANK OUT CUSTOMER REVIEW FIELD
     C           WWRTYP    IFNE 'CU'
     C                     MOVE *BLANKS   DDRCST
     C                     END
     C                     MOVE *BLANKS   DDRINS
     C                     MOVE *BLANKS   DDRSEC
     C                     MOVE *BLANKS   DDRCTY
     C                     END
     C*
     C           WWRTYP    CASEQ'CU'      #ZA
     C           WWRTYP    CASEQ'IN'      #ZB
     C           WWRTYP    CASEQ'SE'      #ZC
     C           WWRTYP    CASEQ'CO'      #ZD
     C           WWRTYP    CASEQ'CI'      #ZE
     C           WWRTYP    CASEQ'CS'      #ZF
     C                     END
     C*
     C*
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #ZK - Customer Validation                        *
     C**                                                              *
     C**  CALLS          -                                            *
     C**                                                              *
     C**  CALLED BY      - #BAA #BAB                                  *
     C**                                                              *
     C*****************************************************************
     C           #ZK       BEGSR
     C*
     C** Valid Customer No. entered indicator
     C*
     C                     MOVE '0'       WWERR1  1
     C                     MOVE '0'       WWVALD  1
     C                     MOVE '0'       WWPDI3  1
     C**********           Z-ADD0         WWCNUM  60                                         CSD027A
     C                     MOVE *BLANKS   WWCNUM  6                                          CSD027A
     C*
     C** Check if first char alphanumeric or blank
     C*
     C                     MOVELWWPNP8    WWALF1  1
     C           WWALF1    LOKUPALPNU                    22
     C           *IN22     IFNE '1'                        *SA*
     C                     MOVE '1'       WWERR1
     C                     MOVEL'LBM0007' ZAMSID
     C                     EXSR ZASNMS
     C                     END                             *EA*
     C*
     C           WWERR1    IFEQ '0'                        *SA*
     C*
     C***Check*if*first*char*numeric***********************************                      CSD027A
     C**********                                                                             CSD027A
     C********** WWALF1    LOKUPNUM                      22                                  CSD027A
     C********** *IN22     IFNE '1'                        *SB*                              CSD027A
     C*
     C** Non-numeric check if valid shortname
     C*
     C***********WWPNP8    SETLLSDLBCSL5                                  S01498
     C***********          READ SDLBCSL5                 25               S01498
     C           WWPNP8    SETLLLBLBCSJ5                                  S01498
     C                     READ LBLBCSJ5                 25               S01498
     C*
     C* If review from customer keep reading file until not a parent
     C           DDCSNO    IFEQ *BLANKS
     C           BBPAIN    DOWEQ'P'
     C           *IN25     ANDEQ'0'
     C***********          READ SDLBCSL5                 25               S01498
     C                     READ LBLBCSJ5                 25               S01498
     C                     END
     C                     END
     C*
     C           *IN25     IFEQ '1'                        *SC*
     C                     MOVE '1'       WWERR1
     C*
     C* If review customer message is 'past end of file'
     C* otherwise message is 'customer not found'
     C           DDCSNO    IFEQ *BLANKS
     C                     MOVEL'LBM0059' ZAMSID
     C                     ELSE
     C                     MOVEL'LBM0007' ZAMSID
     C                     END
     C                     EXSR ZASNMS
     C                     ELSE                            *XC*
     C*
     C* Not end of file
     C*
     C* If parent output error message
     C           BBPAIN    IFEQ 'P'
     C                     MOVEL'LBM0021' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWERR1
     C                     END
     C*
     C*
     C* Customer exists on file
     C           BBCSSN    IFEQ WWPNP8                     *SD*
     C                     MOVE '1'       WWPDI3
     C                     ELSE                            *XD*
     C*
     C* Customer does not exist - store next customer shortname
     C                     MOVE BBCSSN    WWPNP8
     C                     END                             *ED*
     C*
     C                     MOVE '1'       WWVALD
     C                     MOVE BBCUST    WWWRKA
     C**********           Z-ADDWWWRKN    WWCNUM                                             CSD027A
     C                     MOVE WWWRKN    WWCNUM                                             CSD027A
     C                     MOVE BBBRCD    WWBRCH  3                       S01498
     C                     END                             *EC*
     C**********           ELSE                            *XB*                              CSD027A
     C*****************************************************************                      CSD027A
     C***Numeric*-*check*if*valid*customer*number**********************                      CSD027A
     C***First*check*if*6*digits***************************************                      CSD027A
     C**********           Z-ADD0         W       20                                         CSD027A
     C********** W         DOUEQ6                          *SC*                              CSD027A
     C********** WWERR1    OREQ '1'                                                          CSD027A
     C**********           ADD  1         W                                                  CSD027A
     C********** INP,W     LOKUPNUM                      22                                  CSD027A
     C********** *IN22     IFNE '1'                        *SD*                              CSD027A
     C**********           MOVE '1'       WWERR1                                             CSD027A
     C**********           MOVEL'LBM0007' ZAMSID                                             CSD027A
     C**********           EXSR ZASNMS                                                       CSD027A
     C**********           END                             *ED*                              CSD027A
     C**********           END                             *EC*                              CSD027A
     C**********                                                                             CSD027A
     C********** WWERR1    IFEQ '0'                        *SC*                              CSD027A
     C*****************************************************************                      CSD027A
     C***6*Digits*-*Now*check*rest*is*blankS***************************                      CSD027A
     C*****************************************************************                      CSD027A
     C********** WWL4      IFNE *BLANKS                    *SD*                              CSD027A
     C**********           MOVE '1'       WWERR1                                             CSD027A
     C**********           MOVEL'LBM0007' ZAMSID                                             CSD027A
     C**********           EXSR ZASNMS                                                       CSD027A
     C**********           END                             *ED*                              CSD027A
     C**********                                                                             CSD027A
     C***Valid*6*Digit*number******************************************                      CSD027A
     C*
     C           WWERR1    IFEQ '0'                        *SD*
     C                     MOVELWWPNP8    WWCUS1  6
     C***********WWCUS1    SETLLSDLBCSL0                                  S01498
     C***********          READ SDLBCSL0                 25               S01498
     C           WWCUS1    SETLLLBLBCSJ0                                  S01498
     C                     READ LBLBCSJ0                 25               S01498
     C*
     C* If review from customer keep reading file until not a parent
     C           DDCSNO    IFEQ *BLANKS
     C           BBPAIN    IFEQ 'P'
     C           *IN25     ANDEQ'0'
     C***********          READ SDLBCSL0                 25               S01498
     C                     READ LBLBCSJ0                 25               S01498
     C                     END
     C                     END
     C*
     C           *IN25     IFEQ '1'                        *SE*
     C                     MOVE '1'       WWERR1
     C*
     C* If review customer message is 'past end of file'
     C* otherwise message is 'customer not found'
     C           DDCSNO    IFEQ *BLANKS
     C                     MOVEL'LBM0059' ZAMSID
     C                     ELSE
     C                     MOVEL'LBM0007' ZAMSID
     C                     END
     C                     EXSR ZASNMS
     C                     ELSE                            *XE*
     C*
     C* Not end of file
     C*
     C* If parent output error message
     C           BBPAIN    IFEQ 'P'
     C                     MOVEL'LBM0021' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       WWERR1
     C                     END
     C*
     C* Customer exists on file
     C           BBCUST    IFEQ WWCUS1                     *SF*
     C                     MOVE '1'       WWPDI3
     C                     ELSE                            *XF*
     C*
     C* Customer does not exist - store next customer shortname
     C                     MOVE BBCUST    WWCUS1
     C                     END                             *EF*
     C*
     C                     MOVE '1'       WWVALD
     C                     MOVE BBCSSN    WWPNP8
     C                     MOVE WWCUS1    WWCNUM
     C                     MOVE BBBRCD    WWBRCH  3                       S01498
     C                     END                             *EE*
     C                     END                             *ED*
     C**********           END                             *EC*                              CSD027A
     C**********           END                             *EB*                              CSD027A
     C                     END                             *EA*
     C*
     C*
     C           WWERR1    IFEQ '1'
     C                     MOVE '1'       WWEROR
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #ZL - Customer Validation from review screen     *
     C**                                                              *
     C**  CALLS          -                                            *
     C**                                                              *
     C**  CALLED BY      - #CEA #CFA                                  *
     C**                                                              *
     C*****************************************************************
     C           #ZL       BEGSR
     C*
     C** Valid Customer No. entered indicator
     C*
     C                     MOVE '0'       WWERR1  1
     C**********           Z-ADD0         WWCNUM  60                                         CSD027A
     C                     MOVE *BLANKS   WWCNUM  6                                          CSD027A
     C*
     C*  Check if valid customer number
     C***First*check*if*6*digits***************************************                      CSD027A
     C********** WWRCUS    IFNE *BLANKS                                                      CSD027A
     C**********           Z-ADD0         W       20                                         CSD027A
     C********** W         DOUEQ6                          *SC*                              CSD027A
     C********** WWERR1    OREQ '1'                                                          CSD027A
     C**********           ADD  1         W                                                  CSD027A
     C********** RCS,W     LOKUPNUM                      22                                  CSD027A
     C********** *IN22     IFNE '1'                        *SD*                              CSD027A
     C**********           MOVE '1'       WWERR1                                             CSD027A
     C**********           MOVEL'LBM0007' ZAMSID                                             CSD027A
     C**********           EXSR ZASNMS                                                       CSD027A
     C**********           END                             *ED*                              CSD027A
     C**********           END                             *EC*                              CSD027A
     C**********           END                                                               CSD027A
     C*
     C** Valid 6 Digit number  OR BLANK
     C*
     C********** WWERR1    IFEQ '0'                        *SD*                              CSD027A
     C***********WWRCUS    SETLLSDLBCSL0                                  S01498
     C***********          READ SDLBCSL0                 25               S01498
     C           WWRCUS    IFNE *BLANKS                    *SD*                              CSD027A
     C           WWRCUS    SETLLLBLBCSJ0                                  S01498
     C                     READ LBLBCSJ0                 25               S01498
     C*
     C* Keep reading file until not a parent
     C           BBPAIN    DOWEQ'P'
     C           *IN25     ANDEQ'0'
     C***********          READ SDLBCSL0                 25               S01498
     C                     READ LBLBCSJ0                 25               S01498
     C                     END
     C*
     C           *IN25     IFEQ '1'                        *SE*
     C                     MOVE DDRCST    WWCNUM
     C                     MOVE *BLANKS   DDRCST
     C*
     C                     ELSE                            *XE*
     C*
     C* Not end of file
     C                     MOVE BBCUST    WWCUS1
     C                     MOVE BBCSSN    WWPNP8
     C                     MOVE WWCUS1    WWCNUM
     C                     MOVE BBBRCD    WWBRCH  3                       S01498
     C                     END                             *EE*
     C                     END                             *ED*
     C*
     C*
     C           WWERR1    IFEQ '1'
     C                     MOVE '1'       WWEROR
     C*
     C                     ELSE
     C           DDRCST    IFNE *BLANKS
     C                     MOVE *BLANKS   DDRCST
     C                     MOVELBBCUST    DDRCST
     C                     END
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #A  - Initial processing                         *
     C**                                                              *
     C**  CALLS          - None                                       *
     C**                                                              *
     C**  CALLED BY      - Mainline processing                        *
     C**                                                              *
     C*****************************************************************
     C           #A        BEGSR
     C*                                                                   S01498
     C***  Copyright Statement                                            S01498
     C                     MOVEACPY@      ACT@   80                       S01498
     C*
     C** Define LDA for use in program
     C** -----------------------------
     C************NAMVAR   DEFN LDA       LDA                             S01498
     C           *NAMVAR   DEFN           LDA                             S01498
     C*
     C** Initialise DB error fields and store program name
     C*
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBPGM
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     MOVEL'LB0215'  DBPGM
     C                     MOVE *BLANKS   DBFILE                          S01498
     C                     OUT  LDA                                       S01498
     C*
     C** Initialize MESSAGE FILE NAME
     C                     MOVE *BLANKS   ZAMSGF
     C*********************MOVEL'LXGBMSGF'ZAMSGF                          R00300
     C                     MOVEL'LBUSRMSG'ZAMSGF                          R00300
     C*
     C** Read Bank Details File
     C***********1         SETLLSDBANKPD                                  S01498
     C***********          READ SDBANKPD                 20               S01498
     C                     CALL 'AOBANKR0'                                S01498
     C                     PARM '*DBERR ' @RTCD   7                       S01498
     C                     PARM '*FIRST ' @OPTN   7                       S01498
     C           SDBANK    PARM SDBANK    DSSDY                           S01498
     C*
     C************IN20     IFEQ '1'                                       S01498
     C***********BJTYLC    OREQ 'D'                                       S01498
     C***********          MOVE *BLANKS   DBFILE                          S01498
     C***********          MOVEL'SDBANKPD'DBFILE           ***************S01498
     C***********          MOVE *BLANKS   DBKEY            *             *S01498
     C***********          MOVE '001'     DBASE            * DBERROR 001 *S01498
     C***********          SETON                     U7U8LR*             *S01498
     C***********          RETRN                           ***************S01498
     C***********          ELSE                                           S01498
     C*
     C** Check Date format indicator for ZDATE2
     C           BJDFIN    IFEQ 'M'
     C                     SETON                     98
     C                     ELSE
     C           BJDFIN    IFEQ 'D'
     C                     SETOF                     98
     C                     END
     C                     END
     C***********          END                                            S01498
     C*
     C** Initialise SUBFILE Message Queue
     C*
     C                     MOVE *BLANKS   DDPGMQ
     C                     MOVEL'*'       DDPGMQ
     C*
     C** Initialise and clear the program message queue
     C                     MOVE *BLANKS   WWTPGQ
     C                     MOVEL'*'       WWTPGQ
     C                     MOVE *BLANKS   WWPGQR
     C                     MOVEL'*PRV'    WWPGQR
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ
     C                     PARM           WWPGQR
     C*
     C** Set Message Subfile Indicator
     C*
     C                     SETON                     30
     C*
     C** Set Sfl Page Sizes
     C*
     C                     Z-ADD13        WWSFLP  30
     C                     Z-ADD6         WWSFLS  30
     C*
     C* Set first screen to initial
     C*
     C                     MOVE 'I'       WWSCRN  1
     C*                                                                   S01498
     C** Read data area RUNDAT to test for multibranching                 S01498
     C           *NAMVAR   DEFN           RUNDAT                          S01498
     C                     IN   RUNDAT                                    S01498
     C           AGMBIN    IFEQ 'Y'                                       S01498
     C                     MOVE '1'       *IN78                           S01498
     C                     ELSE                                           S01498
     C                     MOVE '0'       *IN78                           S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C** Read data area ZMUSER to get default branch                      S01498
     C           *NAMVAR   DEFN           ZMUSER                          S01498
     C                     IN   ZMUSER                                    S01498
     C*                                                                   S01498
     C                     ENDSR
     C*
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**  SUBROUTINE #ZJ - Termination Processing                     *
     C**                                                              *
     C**  CALLS          - None                                       *
     C**                                                              *
     C**  CALLED BY      - Mainline Processing                        *
     C**                                                              *
     C*****************************************************************
     C           #ZJ       BEGSR
     C                     MOVE '1'       *INLR
     C                     RETRN
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** ZASNMS    - Send message to program's message queue             *
     C**                                                                 *
     C** CALLS     - Y2SNMGC                                             *
     C**                                                                 *
     C** CALLED BY - #B #CB #CC #CD #CE #CBA #ZB                         *
     C**                                                                 *
     C********************************************************************
     C           ZASNMS    BEGSR                           ** ZASNMS    **
     C*
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10
     C                     PARM           ZAPGRL  5
     C                     PARM           ZAMSID  7
     C                     PARM           ZAMSGF 10
     C                     PARM           ZAMSDA132
     C                     PARM           ZAMSTP  7
     C*
     C                     ENDSR
     C/EJECT
     C*****************************************************************
     C/COPY ZSRSRC,ZDATE2Z2
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C/COPY ZSRSRC,ZDATE1Z2
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C/COPY ZSRSRC,ZALIGNZ2
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   *ZTNLU1   - To lock the transaction number data area,      *
     C**               access the next available transaction number,  *
     C**               then update and release the data area          *
     C**                                                              *
     C*****************************************************************
     C*
     C*
     C           ZTNLU1    BEGSR
     C*
     C           *NAMVAR   DEFN MNATN     DNATN
     C           *LOCK     IN   DNATN
     C                     Z-ADDFNATN     NATN    50
     C                     ADD  1         FNATN
     C                     OUT  DNATN
     C*
     C                     ENDSR
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   *PSSR     - PROGRAM ERROR HANDLING ROUTINE                 *
     C**                                                              *
     C*****************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C                     DUMP
     C*
     C                     ENDSR
     C/EJECT
     O* Excpt line to release LBBPWRLB when read
     OLBBPWRDBE                OUTLB
     O/EJECT
**   CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ALPNU - ARRAY OF ALPHANUMERICS A-Z, BLANK, 0-9
A BCDEFGHIJKLMNOPQRSTUVWXYZ0123456789
**   MSG1 - SECURITY NOT FOUND ON SECTY
***   SECURITY NOT FOUND   ***
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
