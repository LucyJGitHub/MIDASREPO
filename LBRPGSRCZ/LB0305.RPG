     H        1                                                           S01498
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LB Portfolio Lending Enquiry')                   *
     H***********                                                         S01498
     F*****************************************************************
     F*                                                               *
     F*  Midas  Portfolio Lending Module                              *
     F*                                                               *
     F*  LB0305 - Portfolio Lending Enquiry                           *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CDL096             Date 22Sep14               *
      *  Prev Amend No. CDL094             Date 11Jun14               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CDL049             Date 07Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 18May06               *
      *                 CLE042             Date 06Sep05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 TDA035             Date 02Apr04               *
      *                 222727             Date 05Nov03               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CGL008             Date 03Mar99               *
      *                 CPM005             Date 14Oct96               *
     F*                 092960             Date 18Sep95               *
     F*                 092955             DATE 13SEP95               *
     F*                 092512             DATE 31AUG95               *
     F*                 086664             DATE 20MAR95               *
     F*                 086663             DATE 20MAR95               *
     F*                 085817             DATE 13MAR95               *
     F*                 081239             DATE 02FEB95               *
     F*                 083547             DATE 20FEB95               *
     F*                 S01498             DATE 11AUG94               *
     F*                 063335             DATE 16NOV93               *
     F*                 051775             DATE 08MAR93               *
     F*                 051587             DATE 03MAR93               *
     F*                 049421             DATE 18JAN93               *
     F*                 S01313             DATE 27AUG92               *
     F*                 001315             DATE 26SEP91               *
     F*                 B7953              DATE 09JUN91               *
     F*                 B7862              DATE 28MAY91               *
     F*                 B7844              DATE 24MAY91               *
     F*                 R01168             DATE 26APR91               *
     F*                 SA9101             DATE 10APR91               *
     F*                 B05654             DATE 11MAR91               *
     F*                 R5649              DATE 11MAR91               *
     F*                 R0170              DATE 15FEB91               *
     F*                 R0152              DATE 14FEB91               *
     F*                 R0148              DATE 13FEB91               *
     F*                 R0121              DATE 08FEB91               *
     F*                 R0119              DATE 08FEB91               *
     F*                 R0030              DATE 24JAN91               *
     F*                 R1036              DATE 14DEC90               *
     F*                 R01118             DATE 04DEC90               *
     F*                 R0675              DATE 26NOV90               *
     F*                 SA9018             DATE 26NOV90               *
     F*                 R0598              DATE 29OCT90               *
     F*                 LB2000             DATE 23OCT90               *
     F*                 R00300             DATE 20AUG90               *
     F*                 R00266             DATE 06AUG90               *
     F*                 LB0004             DATE 20JUN90               *
     F*                 LB0002             DATE 18JUN90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A- Conversion of cust. no. to alpha (post 103 build)   *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in MMDELDPP.*
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  CGL008 - Security on Journal Entry. Recompile.               *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*  092960 - PM link doesn't work if selected from LB overview - *
     F*           fix is to call PMC1003 tyo retrieve LDA details.    *
     F*         - Unlock LDA before calling PM link program.          *
     F*  092955 - Complete 086663 to output birth date as 7A          *
     F*  092512 - Correctly access PM programs when called from       *
     F*           other LB programs                                   *
     F*  086664 - Format branch code for call of PM0630               *
     F*  086663 - Correct formatting of date of birth                 *
     F*  085817 - Recompile due to changes in PMLDAPD                 *
     F*  081239 - R10 Private Banking Rework.                         *
     F*  083547 - Correcting Account Officer name on MUSERDD          *
     F*  S01498 - Portfolio Lending Upgrade to Release 10             *
     F*  063335 - TROUBLES IN TRANSFER OF GROUP JOBS, PRODUCES DB ERR *
     F*  051775 - UPDATE LDA IF DB ERROR IN CALLED PGM                *
     F*  051587 - If WWTOTL is lower than 100, W2170 becomes '0'      *
     F*           (divide by zero problem)                            *
     F*  049421 - HEADER BOX STANDARDISATION                          *
     F*  S01313 - PORTFOLIO PERFORMANCE                               *
     F*  001315 - Check excessive percentages                         *
     F*  B07953 - SAR9109 SHOULD SHOW TRANSACTIONS VALUE DATE         *
     F*           TODAY AS FORWARD                                    *
     F*  B7862  - SAR9109 SHOULD USE EEMARG INSTEAD OF EEEXPS TO      *
     F*           CALCULATE CUSTOMER MARGIN.                          *
     F*  B7844  - EXPOSURE PERCENTAGE CALCULATION AMENDMENT           *
     F*  R01168 - ENABLE NEW EXPOSURE ENQUIRY (LB0322) AND            *
     F*           COLLATERAL ENQUIRY (LB0323) PROGRAMS                *
     F*  SA9101 - Forward transactions enquiry                        *
     F*  B05654 - The sign "+" overrite the last number in the subfile*
     F*  R5649  - CORRECT TOTAL EQUITY                                *
     F*  R0170  - To display exposure on first screen                 *
     F*  R0152  - To compare DBASE to zero and to blank to            *
     F*           detect database error                               *
     F*  R0148  - To display blank instead of 0 when no limit         *
     F*  R0121  - Dbase error occured because invalid data in         *
     F*           Dbase field (Value greater than 0) even if          *
     F*           no error occured.                                   *
     F*         - Misfunction of Command key 23 when pressed          *
     F*           from LB0310.                                        *
     F*  R0119  - Call CL Program before calling Customer             *
     F*           Documentation.                                      *
     F*  R0030  - When this Pgm is called by "PM" and call the        *
     F*           the "PM" again by F23, this produce an error.       *
     F*  R1036  - DISPLAY TOTAL EQUITY INSTEAD OF CUST. EQUITY        *
     F*  R01118 - Portfolio details called from Portfolio Management  *
     F*  R0675  - DBASE ERROR WHEN CALLED FROM LB0310                 *
     F*  SA9018 - PORTFOLIO LENDING LIMITS                            *
     F*  LB2000 - PRECIOUS METALS                                     *
     F*  R00300 - Message file changes                                *
     F*  R0598  - THE PORTFOLIO LENDING ENQUIRY MUST SHOWED ONLY      *
     F*           THE CUSTOMER PORTFOLIO.                             *
     F*  R00266 - IF NO RECORDS TO DISPLAY WITH                       *
     F*           EXPOSURE/COLLATERAL <> ZERO SETOF SFLDSP IND.       *
     F*         - CORRECT UNDEFINED FIELDS ON PMLDAPP.                *
     F*  LB0004 - DISPLAY NET UNREALISED P/L                          *
     F*  LB0002 - TOTAL COLLATERAL =                                  *
     F*            OWN COLLATERAL + USE OF PLEDGES RECEIVED           *
     F*                                                               *
     F*****************************************************************
     F** C R E A T I O N     P A R A M E T E R S                      *
     F**                                                              *
     F**                                                              *
     F**                                                              *
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     F**
     F** FILE DEFINITIONS
     F** ----------------
     F*
     F** Workstation File
     FLB0305DFCF  E                    WORKSTN      KINFSR *PSSR
     F                                        SFLRR2KSFILE LB0305S2
     F                                              KINFDS WSDS
     F*
     F***Bank*Details*File.*Prefix*-*BJ********************************   S01498
     F***SDBANKPDIF**E                    DISK         KINFSR *PSSR       S01498
     F*
     F***portfolio*lending**Installation*Control*Data.*Prefix*-*LB*****   S01498
     F***SDLOMBPDIF**E                    DISK         KINFSR *PSSR       S01498
     F*
     F***Modules*Installed*.*Prefix*-*BG*******************************   S01498
     F*DMMODPDIF  E           K        DISK         KINFSR *PSSR          R0675
     F***SDMMODPDIF**E                    DISK         KINFSR *PSSR R0675 S01498
     F*
     F***Currency*Codes.*Prefix*-*A6***********************************   S01498
     F***SDCURRL1IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F** Client Master File (Customer Number). Prefix - BB & CU
     F***SDLBCSL0IF**E           K        DISK         KINFSR *PSSR       S01498
     FLBLBCSJ0IF  E           K        DISK         KINFSR *PSSR          S01498
     F*
     F** Client Master File (Customer Shortname). Prefix - BB & CU
     F***SDLBCSL5IF**E           K        DISK         KINFSR *PSSR       S01498
     FLBLBCSJ5IF  E           K        DISK         KINFSR *PSSR          S01498
     F            SDLBCSJ0                          KRENAMESDLBCSJS
     F*
     F***portfolio*lending*groups.*Prefix*-*GP*************************   S01498
     F***LBGROUL1IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F** Portfolio lending Extract Summary. Prefix - ES
     FLBEXTSL1IF  E           K        DISK         KINFSR *PSSR
     F*
     F** Portfolio lending Extract Details (Cust/Group...). Prefix - EE
     FLBEXTRL4IF  E           K        DISK         KINFSR *PSSR
     F*
     F** Portfolio lending Extract Details (Parent/Instr.). Prefix - EE
     FLBEXTRL7IF  E           K        DISK         KINFSR *PSSR
     F            LBEXTRD0                          KRENAMELBEXTRD7
     F*
     F** Portfolio Lending Extract Details (Cust/Instr). Prefix - EE      R1036
     F*BEXTRL2IF  E           K        DISK         KINFSR *PSSR          R1036
     F**          LBEXTRD0                          KRENAMELBEXTRD2       R1036
     F*
     F***Midas*User*Definition.*Prefix*-*NONE**************************   S01498
     F***MUSER***IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F***Account*Officers.*Prefix*-*AZ*********************************   S01498
     F***SDACOFL1IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F***Country*Details.*Prefix*-*A4**********************************   S01498
     F***SDCTRYL1IF  E           K        DISK         KINFSR *PSSR       S01498
     F*
     F***Portfolio*Management*Customer*Details.*Prefix*-*QB************   S01498
     F***SDPLCSL0IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F***Portfolio*Management*I.C.D.*Prefix*-*P9***********************   S01498
     F*DPORTPDIF  E           K        DISK         KINFSR *PSSR          R0675
     F***SDPORTPDIF**E                    DISK         KINFSR *PSSR R0675 S01498
     F*
     F** Customer loans - Loans without Guaranties                        SA9101
     F***CLOANCL2IF**E           K        DISK         KINFSR *PSSRSA9101 S01498
     FLBLOANL2IF  E           K        DISK         KINFSR *PSSR          S01498
     F*                                                                   SA9101
     F** Customer loans - Guaranties                                      SA9101
     F***CLOANCL3IF**E           K        DISK         KINFSR *PSSRSA9101 S01498
     FLBLOANL3IF  E           K        DISK         KINFSR *PSSR          S01498
     F            CLOANCLF                          KRENAMECLOANCL1       SA9101
     F*                                                                   SA9101
     F***Fiduciary*deposits****************************************SA9101 S01498
     F***FIDEPOLAIF**E           K        DISK         KINFSR *PSSRSA9101 S01498
     F************FIDEPOD0                          KRENAMEFIDEPODASA9101 S01498
     F*                                                                   SA9101
     F** Loans/Deposits/CD Issued                                         SA9101
     F***MMDELDL2IF**E           K        DISK         KINFSR *PSSRSA9101 S01498
     FLBDELDL2IF  E           K        DISK         KINFSR *PSSR          S01498
     F            MMDELDP0                          KRENAMEMMDELDD1       SA9101
     F*                                                                   SA9101
     F********************************************************************
     F/EJECT
     F********************************************************************
     F**                                                                 *
     F** ID F  C  H  L    FUNCTION OF INDICATORS                         *
     F**                  ----------------------                         *
     F**      26          SFLEND    ------) Message Subfile              *
     F**      27          ROLLUP                                         *
     F**                                                                 *
     F**      28          SFLDSP    ------)                              *
     F**      29          SFLDSPCTL       )                              *
     F**      30          SFLCLR          ) Input Screen 2 Subfile       *
     F**      31          SFLEND          )                              *
     F**      32          SFLNXTCHG ------)                              *
     F**                                                                 *
     F**      33          Selected customer exists                       *
     F**      34          First character of customer number/shortname   *
     F**                  is (1) Alphanumeric (2) Numeric                *
     F**      37          Do not display LBFXUP and LBFXUL groups        *
     F**      40          Invalid customer number/shortname on screen 1  *
     F**      50          Portfolio Management installed                 *
     F********52**********EOF*etc.*for*SDPLCSL0************************  *S01498
     F********57**********EOF*etc.*for*SDCTRYL1************************  *S01498
     F**      58          EOF etc. for LBEXTRL2                          *
     F********59**********EOF*etc.*for*MUSER***************************  *S01498
     F********60**********EOF*etc.*for*SDACOFL1************************  *S01498
     F**      75          EOF etc. for LBEXTRL-                          *
     F********76**********EOF*etc.*for*LBGROUL1************************  *S01498
     F**      77          EOF etc. for SDLBCSL-                          *
     F**      79          Read fail on SD-- file                         *
     F**      81          Subfile selection field error on screen 2      *
     F**      82          On if borrowing power is cash instruments only *
     F**      83          Borrowing power enquiry selection field error  *
     F**      84          No data found for customer                     *
     F**                                                                 *
     F********************************************************************
     F/EJECT
     E********************************************************************
     E*
     E** Array for copyright - MUST BE FIRST
     E                    CPY@    1   1 80
     E*
     E** Array used in currency amount conversion
     E** SCONV S/R array for powers of 10
     E                    POWER   1   7  7 3
     E*
     E** Array of alphanumerics
     E                    ALPNU  37  37  1
     E*
     E***Array*of*numbers**********************************************                      CSD027A
     E**********          NUM    10  10  1                                                   CSD027A
     E*
     E** Array to split customer field into individual characters
     E                    CUS        10  1
     E*
     E***Array*of*COMMANDS*********************************************   S01498
     E********************ARR     1   2 80                                S01498
     E*
     E**   Arrays for ZDATE2
     E/COPY ZSRSRC,ZDATE2Z1
     E*
     E** Arrays used in conversion of decimal amounts to character
     E/COPY ZSRSRC,ZSEDITZ1
     E*
     E**  ARRAY FOR SR. ZA0710 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIODSA9101
     E                    @YD     4   4  5 0A                             SA9101
     E*                                                                   SA9101
     E**  ARRAY FOR SR. ZA0710 - CUMULATIVE DAYS IN YEAR PER MONTH        SA9101
     E                    @MD    13  13  5 0A                             SA9101
     E*                                                                   SA9101
     E********************************************************************
     E/EJECT
     I********************************************************************
     I**  DATA STRUCTURE FOR SR. ZA0710 - FIELD IS @@Z71Y                 SA9101
     I            DS                                                      SA9101
     I                                        1   40@@Z71Y                SA9101
     I                                        1   10@@SSY1                SA9101
     I                                        2   20@@SSY2                SA9101
     I                                        3   30@@SSY3                SA9101
     I                                        4   40@@SSY4                SA9101
     I**  DATA STRUCTURE FOR SR. ZA0710 - FIELD IS @@VDT                  SA9101
     I            DS                                                      SA9101
     I                                        1   80@@VDT                 SA9101
     I                                        1   40@@YR                  SA9101
     I                                        5   60@@Z71M                SA9101
     I                                        7   80@@Z71D                SA9101
     ICPYR@#      DS
     I*
     I** DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     I**      MUST BE FIRST
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I** Display file information data structure
     IWSDS        DS
     I                                    B 378 3790WSDSRN
     I*
     I** Program status data structure
     IPSDS       SDS
     I**************************************244 253 DDWSID                S01498
     I**************************************254 263 DDUSER                S01498
     I                                      244 253 SWSID                 S01498
     I                                      254 263 SUSER                 S01498
     I*
     I** Local data area data structure
     I***WWLDA******UDS***********************     256                    S01498
     ILDA         DS                            256                       S01498
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I**************************************181 1830DBASE                 R0121
     I                                      181 183 DBASE                 R0121
     I*
     I*****DATA*STRUCTURE*TO*DEFINE*THE*GROUP*DATA*AREA****************   S01498
     I***WWPARM    E DSPMGDA
     I***WWPGDA****E*DSPMGRDAPP***************                            S01498
     I*
     I*****DATA*STRUCTURE*TO*DEFINE*THE*LOCAL*DATA*AREA*FOR*GROUP*JOBS*   S01498
     I***WWPLDA****E*DSPMLDAPP****************                            S01498
     I*                                                                   S01498
     I** Data structure to define DTAARA/*LDA                             S01498
     IWWPLDA    E DSPMLDAPD                                               S01498
     I*
     I** Data Structure to split customer number/shortname field
     I            DS
     I                                        1  10 DD1CNS
     I                                        1  10 CUS
     I                                        1   1 WWCCH1
     I                                        7  10 WWC710
     I*
     I** Data structure to convert decimal field to alpha
     I/COPY ZSRSRC,ZSEDITZ2
     I*
     I** Data Structure to split the 51 character field on an input screen
     I*  input to three parts each of 17 characters
     IDD2OUT      DS
     I***                                     1  17 DD2FD1                R0170
     I**********                             18  34 DD2FD2
     I***                                    18  34 DD2FD2         SA9018 R0170
     I***                                    35  51 DD2FD3                R0170
     I                                        1  16 DD2FD1                R0170
     I                                       17  32 DD2FD2                R0170
     I*                                      33  48 DD2FD3           R0170B05654
     I                                       33  47 DD2FD3                B05654
     I*
     I** DATA STRUCTURE FOR DATE OF BIRTH (READ FROM SDPLCSL0)
     I            DS
     I                                        1   60WWDAT1
     I                                        1   20WWDAY1
     I                                        3   40WWMON1
     I                                        5   60WWYER1
     I**
     I** DATA STRUCTURE FOR DATE OF BIRTH (CONVERTED AS PARAMETER)
     I**
     I            DS
     I                                        1   7 WWDAT2
     I                                        1   20WWDAY2
     I                                        3   5 WWMON2
     I                                        6   70WWYER2
     I*
     I*                                                                   S01498
     ISDBANK    E DSSDBANKPD                                              S01498
     I**  Data structure for bank details                                 S01498
     I*                                                                   S01498
     ISDLOMB    E DSSDLOMBPD                                              S01498
     I**  Data structure for Portfolio Lending ICD                        S01498
     I*                                                                   S01498
     ISDCURR    E DSSDCURRPD                                              S01498
     I**  Data structure for currency details                             S01498
     I*                                                                   S01498
     ISDACOF    E DSSDACOFPD                                              S01498
     I**  Data structure for account officer details                      S01498
     I*                                                                   S01498
     ISDMMOD    E DSSDMMODPD                                              S01498
     I**  Data structure for Midas modules details                        S01498
     I*                                                                   S01498
     ISDPLCS    E DSSDPLCSPD                                              S01498
     I**  Data structure for Portfolio Management customer details        S01498
     I*                                                                   S01498
     ISDPORT    E DSSDPORTPD                                              S01498
     I**  Data structure for Portfolio Management ICD                     S01498
     I*                                                                   S01498
     ISDCTRY    E DSSDCTRYPD                                              S01498
     I**  Data structure for country code details                         S01498
     I*                                                                   S01498
     ISDGROU    E DSLBGROUPD                                              S01498
     I**  Data structure for lending group details                        S01498
     I*                                                                   S01498
     ISDUSER    E DSMUSERDD                                               S01498
     I***********   ACOF                            MUACOF          S01498083547
     I              ACFA                            MUACOF                083547
     I*                                                                   CPM005
     ISDPATT    E DSSDPATTPD                                              CPM005
     I* External DS for Power of Attorney details                         CPM005
     I**                                                                  CPM005
     ISDJUSR    E DSSDJUSRPD                                              CPM005
     I* External DS Joint Account details                                 CPM005
     I*                                                                   CPM005
     ISDCCRD    E DSSDCCRDPD                                              CPM005
     I* External DS for Customer Credit Card details                      CPM005
     I**                                                                  CPM005
     ISDRELC    E DSSDRELCPD                                              CPM005
     I* External DS Related Customers details                             CPM005
     I**                                                                  CPM005
     I**  Data structure for user details                                 S01498
     I*                                                                   S01498
     IDSFDY     E DSDSFDY                                                 S01498
     I**  Short data structure for access objects                         S01498
     I*                                                                   S01498
     IDSSDY     E DSDSSDY                                                 S01498
     I**  Long data structure for access programs                         S01498
     I*                                                                   S01498
     I********************************************************************
     I/EJECT
     C********************************************************************
     C*
     C** PARAMETER LIST DECLARATIONS
     C** ---------------------------
     C** WWMUFG - called from menu flag - 0 = called from menu
     C**                                - 1 = called by LB0315
     C** WWEQCN - enquiry customer number, if called by LB0315
     C** WWRTCD - return code - '03' if F3 was pressed on screen 2
     C**                      - '12' if F12 was pressed on screen 2
     C** WWUPRF - user profile - passed in by calling CL or program
     C*
     C           *ENTRY    PLIST
     C                     PARM           WWMUFG  1
     C**********           PARM           WWEQCN  60                                         CSD027A
     C                     PARM           WWEQCN  6                                          CSD027A
     C                     PARM           WWRTCD  20
     C                     PARM           WWUPRF 10
     C                     PARM           WWCALL  1                       R01118
     C*                                                                   S01498
     C**  Copyright statement                                             S01498
     C*                                                                   S01498
     C                     MOVEACPY@      ACT@   80                       S01498
     C*
     C************NAMVAR   DEFN LDA       WWLDA                           S01498
     C           *NAMVAR   DEFN           LDA                             S01498
     C*
     C**   KEY LIST FOR FILE CHAINING
     C*
     C**   CUSTOMER NUMBER KEY LIST 1
     C           WWCKY1    KLIST
     C                     KFLD           WWCNUM
     C                     KFLD           LBFXMA
     C*
     C           WWCKY2    KLIST                                          SA9101
     C                     KFLD           WWCNUM                          SA9101
     C**                   KFLD           BJRDNB                    SA9101B07953
     C                     KFLD           PREVD                           B07953
     C*
     C           WWCKY3    KLIST                                          SA9101
     C                     KFLD           WWCNUM                          SA9101
     C                     KFLD           @@YR                            SA9101
     C                     KFLD           @@Z71M                          SA9101
     C                     KFLD           @@Z71D                          SA9101
     C*                                                                   SA9101
     C********************************************************************
     C*
     C**             START MAINLINE
     C**             --------------
     C** Initialisation
     C                     EXSR #A
     C*
     C** Main processing
     C                     EXSR #B
     C*
     C** End program
     C                     EXSR #ZG
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**                    INDEX TO SUBROUTINES                         *
     C**                    --------------------                         *
     C**  1.ZSEDIT - Convert value to display format                     *
     C** 1a.ZDATE2 - Convert dates from MIDAS day number to date format  *
     C**  2.#ZL750 - Convert from Portfolio curency to display in 000's  *
     C**  3.#ZC750 - Convert from customer curency to display in 000's   *
     C**  4.SCONV  - Convert an amount from one currency to another      *
     C**  5.#A     - Initialisation                                      *
     C**  6.#B     - Main processing                                     *
     C**  7.#BA    - selects a valid customer                            *
     C**  8.#BAA   - Validate input screen 1                             *
     C**  9.ZASNMS - Sends a message to a program's message queue        *
     C** 10.#BB    - Calculates the totals for screen 2                  *
     C** 11.#BC    - Calculates the next page of records for the subfile *
     C** 12.#BCA   - Reads all extract records for all instr in group    *
     C** 13.#ZE    - Reads the group file for the group name for display *
     C***14.#BD****- Process a CMD/9 for Available/Limits change         *
     C** 15.#BE    - Process a CMD/11 to change currency                 *
     C** 16.#BF    - Process a CMD/15 to call LB0310                     *
     C** 17.#BG    - Process a CMD/24 to call PM Documentation Program   *
     C** 18.#BH    - Process an ENTER from input screen 2                *
     C** 19.#BI    - Process a CMD/23 to call PM Enquiries Program       *
     C** 19.#BIA   - Load group data area                                *
     C** 20.#ZB    - Read currency file & set up work fields             *
     C** 21.#ZA    - Database error handling routine                     *
     C** 22.#ZD    - Calc Available and convert to cust currency         *
     C** 23.#ZC    - Move subfile hidden fields to display field         *
     C** 24.#ZG    - Termination Processing                              *
     C** 25.*PSSR  - Program error handling routine                      *
     C** 26.#BJ    - Forward Transactions research                       *SA9101
     C**                                                                 *
     C********************************************************************
     C/EJECT
     C*
     C** Subroutine to convert a decimal amount to character
     C/COPY ZSRSRC,ZSEDITZ3
     C/EJECT
     C/COPY ZSRSRC,ZDATE2Z2
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZL750      - to convert an amount from 15,0 format in Portfolio*
     C**               base currency to 000's and then convert to screen *
     C**               format for display, by calling ZSEDIT.            *
     C**                                                                 *
     C** CALLS       - ZSEDIT                                            *
     C**                                                                 *
     C** CALLED BY   - #BB #BC #ZD                                       *
     C**                                                                 *
     C********************************************************************
     C           #ZL750    BEGSR
     C*
     C           WWDILB    IFNE 0
     C           ZFLD15    DIV  WWDILB    ZFLD15    H
     C                     END
     C           ZFLD15    DIV  1000      ZFLD15    H
     C                     EXSR ZSEDIT
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZC750      - to convert an amount from 15,0 format in Customer *
     C**               currency to 000's and then convert to screen      *
     C**               format for display, by calling ZSEDIT.            *
     C**                                                                 *
     C** CALLS       - ZSEDIT                                            *
     C**                                                                 *
     C** CALLED BY   - #BB #ZD                                           *
     C**                                                                 *
     C********************************************************************
     C           #ZC750    BEGSR
     C*
     C           WWDICU    IFNE 0
     C           ZFLD15    DIV  WWDICU    ZFLD15    H
     C                     END
     C           ZFLD15    DIV  1000      ZFLD15    H
     C                     EXSR ZSEDIT
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**  SCONV - Converts an amount from one currency to another.       *
     C**                                                                 *
     C**  Input Fields - WWAMTI 15/0 amount in input currency            *
     C**                 WWSRI  13/8 spot rate for input currency        *
     C**                 WWSRO  13/8 spot rate for output currency       *
     C**                 WWDPI  1/0  no. of decimals for input currency  *
     C**                 WWDPO  1/0  no. of decimals for output currency *
     C**                 WWMDI  1    mult/div indicator for input curr.  *
     C**                 WWMDO  1    mult/div indicator for output curr. *
     C**                                                                 *
     C**  Arrays       - POWER  powers of 10                             *
     C**                                                                 *
     C**  Output Fields- WWAMTO 15/0 output amount converted to new curr *
     C**                                                                 *
     C**  CALLS    - NONE                                                *
     C**                                                                 *
     C********************************************************************
     C           SCONV     BEGSR                           **  SCONV    **
     C*
     C** DEFINE ALL FIELDS
     C                     Z-ADDWWAMTI    WWAMTI 150
     C                     Z-ADD0         WWAMTO 150
     C           *LIKE     DEFN A6SPRT    WWSRI
     C           *LIKE     DEFN A6SPRT    WWSRO
     C           *LIKE     DEFN A6NBDP    WWDPI
     C           *LIKE     DEFN A6NBDP    WWDPO
     C           *LIKE     DEFN A6MDIN    WWMDI
     C           *LIKE     DEFN A6MDIN    WWMDO
     C*
     C           WWDPO     SUB  WWDPI     Z       10
     C           Z         ADD  4         Z
     C*
     C           WWMDI     IFNE WWMDO
     C*
     C** MULT/DIV INDICATORS DIFFERENT
     C           WWSRI     MULT WWSRO     WWRATE 159H
     C                     ELSE
     C*
     C** MULT/DIV INDICATORS THE SAME
     C           WWSRO     IFEQ 0
     C                     GOTO SC0
     C                     END
     C           WWSRI     DIV  WWSRO     WWRATE    H
     C                     END
     C*
     C           WWMDI     IFEQ 'D'
     C           WWRATE    IFEQ 0
     C                     GOTO SC0
     C                     END
     C           POWER,Z   DIV  WWRATE    WWRATE    H
     C                     ELSE
     C           POWER,Z   MULT WWRATE    WWRATE    H
     C                     END
     C*
     C           WWAMTI    MULT WWRATE    WWAMTO    H
     C*
     C           SC0       ENDSR                           **  SC0      **
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #A          - This subroutine performs the initial processing   *
     C**                                                                 *
     C** CALLS       - #ZA #ZB                                           *
     C**                                                                 *
     C** CALLED BY   - MAINLINE                                          *
     C**                                                                 *
     C********************************************************************
     C*
     C           #A        BEGSR
     C                     MOVE *BLANKS   WWPROG  6                       081239
     C*
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'LB0305'  DBPGM
     C*********************Z-ADD0         DBASE                           R0121
     C                     MOVE *BLANKS   DBASE                           R0121
     C                     OUT  LDA                                       S01498
     C/COPY WNCPYSRC,LB0305C001
     C*
     C***Read*the*record*on*the*bank*0etails*file**********************   S01498
     C*
     C***********1         SETLLSDBANKPD                                  S01498
     C***********          READ SDBANKPD                 79               S01498
     C*
     C************IN79     IFEQ '1'                                       S01498
     C***********BJTYLC    OREQ 'D'                        ***************S01498
     C*                                                                   S01498
     C** Get bank details using access object                             S01498
     C*                                                                   S01498
     C                     CALL 'AOBANKR0'                                S01498
     C                     PARM *BLANKS   P@RTCD  7                       S01498
     C                     PARM '*FIRST ' P@OPTN  7                       S01498
     C           SDBANK    PARM SDBANK    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDBANKPD'DBFILE           * DBERROR 001 *S01498
     C                     MOVE 'SDBANKPD'DBFILE           * DBERROR 001 *S01498
     C*********************Z-ADD1         DBASE            ***************R0121
     C                     MOVE '001'     DBASE            ***************R0121
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     END
     C*                                                                   S01498
     C**  Rundate in DDMMMYY format                                       S01498
     C*                                                                   S01498
     C                     MOVE BJMRDT    SRUNA                           S01498
     C*
     C** Set up indicator 98 for ZDATE S/R's as per BJFKST
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     ELSE
     C                     MOVE '0'       *IN98
     C                     END
     C*                                                                   B07953
     C** Set date for Forward Transactions search to run date less 1      B07953
     C           BJRDNB    SUB  1         PREVD   50                      B07953
     C*
     C***Read*the*Portfolio*lending*installation*control*data*file*****   S01498
     C*
     C***********1         SETLLSDLOMBPD                                  S01498
     C***********          READ SDLOMBPD                 79               S01498
     C*
     C************IN79     IFEQ '1'                                       S01498
     C***********LBRECI    OREQ '*'                                       S01498
     C***********LBCHTP    OREQ 'D'                        ***************S01498
     C*                                                                   S01498
     C** Get Portfolio Lending details using access object                S01498
     C*                                                                   S01498
     C                     CALL 'AOLOMBR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*FIRST ' P@OPTN                          S01498
     C           SDLOMB    PARM SDLOMB    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDLOMBPD'DBFILE           * DBERROR 002 *S01498
     C                     MOVE 'SDLOMBPD'DBFILE           * DBERROR 002 *S01498
     C*********************Z-ADD2         DBASE            ***************R0121
     C                     MOVE '002'     DBASE            ***************R0121
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     END
     C*
     C***Read*the*MODULES*INSTALLED*file*******************************   S01498
     C*
     C***********1         SETLLSDMMODPD                            R0675 S01498
     C***********          READ SDMMODPD                 79               S01498
     C*
     C************IN79     IFEQ '1'                                       S01498
     C***********BGTYLC    OREQ 'D'                        ***************S01498
     C*                                                                   S01498
     C** Get Midas Modules details using access object                    S01498
     C*                                                                   S01498
     C                     CALL 'AOMMODR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*FIRST ' P@OPTN                          S01498
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDMMODPD'DBFILE           * DBERROR 007 *S01498
     C                     MOVE 'SDMMODPD'DBFILE           * DBERROR 007 *S01498
     C*********************Z-ADD7         DBASE            ***************R0121
     C                     MOVE '007'     DBASE            ***************R0121
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     END
     C*
     C** check if Portfolio Management module is installed and set
     C** indicator 50 accordingly
     C           BGPFMG    IFEQ 'Y'
     C*                                                                   R01118
     C** CMD23 and CMD24 not allowed if program was called from           R01118
     C** Portfolio Management                                             R01118
     C           WWMUFG    ANDNE'2'                                       R01118
     C                     MOVE '1'       *IN50
     C*
     C***Read*the*record*on*Portfolio*Management*ICD*-*if*PM*installed*   S01498
     C***********1         SETLLSDPORTPD                            R0675 S01498
     C***********          READ SDPORTPD                 79               S01498
     C*
     C************IN79     IFEQ '1'                                       S01498
     C********   ??????    OREQ 'D'
     C*********************Z-ADD8         DBASE            ***************R0121
     C*                                                                   S01498
     C** Get Portfolio Management ICD details using access object         S01498
     C*                                                                   S01498
     C                     CALL 'AOPORTR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*FIRST ' P@OPTN                          S01498
     C           SDPORT    PARM SDPORT    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '008'     DBASE            ***************R0121
     C***********          MOVEL'SDPORTPD'DBFILE           * DBERROR 008 *S01498
     C                     MOVE 'SDPORTPD'DBFILE           * DBERROR 008 *S01498
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     MOVEL'LB0305'  DBPGM
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     END
     C*
     C                     ELSE
     C                     MOVE '0'       *IN50
     C                     END
     C*
     C** Find the number of decimal places for the Portfolio lend. base currency
     C*
     C***********          MOVE LBCCY     WWCCY   3                       S01498
     C                     MOVE LBCYCD    WWCCY   3                       S01498
     C                     EXSR #ZB
     C                     Z-ADDA6NBDP    WWLBDP  10
     C                     MOVE WWDICU    WWDILB  40
     C                     Z-ADDA6SPRT    WWSRI
     C                     Z-ADDA6NBDP    WWDPI
     C                     MOVE A6MDIN    WWMDI
     C*
     C** Initialise and clear the program message queue
     C*
     C                     MOVE *BLANKS   DDPGMQ
     C                     MOVEL'*'       DDPGMQ
     C*
     C** CLEAR SCREEN MESSAGE QUEUE
     C                     MOVE *BLANKS   WWTPGQ
     C                     MOVEL'*'       WWTPGQ
     C                     MOVE *BLANKS   WWPGQR
     C                     MOVEL'*PRV'    WWPGQR
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C**   Fill in fields for subroutine ZASNMS                           R00300
     C*
     C                     MOVE '1'       *IN26
     C                     MOVEL*BLANK    ZAPGM  10        Message queue  R00300
     C*********************MOVEL'LXGBMSGF'ZAMSGF                          R00300
     C                     MOVEL'LBUSRMSG'ZAMSGF                          R00300
     C                     MOVEL*BLANK    ZAPGRL  5        Rel queue      R00300
     C                     MOVEL*BLANK    ZAMSID  7        Message Id.    R00300
     C                     MOVEL*BLANK    ZAMSDA132        Message data.  R00300
     C                     MOVEL*BLANK    ZAMSTP  7        Message type.  R00300
     C*
     C           *LIKE     DEFN BBPAIN    WWPAIN
     C           *LIKE     DEFN EELCGR    WWLCGR
     C*
     C                     Z-ADD0         LSTRR2  40
     C                     MOVE *BLANKS   DD1CNS
     C                     MOVE '1'       WWCP1
     C                     MOVE '1'       WWBPE1  1
     C                     MOVE '1'       WWLAP1  1
     C                     MOVE '1'       WWPME1  1
     C                     MOVE 'N'       WWVLD1  1
     C                     MOVE 'Y'       WWVLD2  1
     C                     MOVE '0'       *IN33
     C                     MOVE '1'       *IN28
     C                     MOVE '1'       *IN29
     C                     MOVE 'N'       WWPMDC  1
     C*
     C** Set currency flag 'LB'
     C                     MOVE 'LB'      WWCUFG  2
     C***********          MOVE LBCCY     DD2CCY                          S01498
     C                     MOVE LBCYCD    DD2CCY                          S01498
     C*
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD0         ZDECS
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #B          - This subroutine performs the main processing      *
     C**                                                                 *
     C***CALLS*********#BA #BB #BC #BD #BE #BF #BG #BH #BI               *SA9101
     C** CALLS       - #BA #BB #BC #BD #BE #BF #BG #BH #BI #BJ           *SA9101
     C**                                                                 *
     C** CALLED BY   - MAINLINE                                          *
     C**                                                                 *
     C********************************************************************
     C           #B        BEGSR
     C*
     C** Process until a termination request F3 pressed
     C           *INKC     DOWEQ'0'
     C*
     C** if called from menu.....
     C           WWMUFG    IFEQ '0'
     C*                                                                   081239
     C                     CALL 'PMC1003'                                 081239
     C                     PARM           WWPLDA                          081239
     C                     MOVE 'LB0305'  QMCPGM                          081239
     C                     CALL 'PMC1001'                                 081239
     C                     PARM           WWPLDA                          081239
     C                     MOVE QMCPGM    WWPROG                          081239
     C*
     C** Process screen 1 until a termination request or valid screen
     C           *INKC     DOWEQ'0'
     C           WWVLD1    ANDEQ'N'
     C*
     C                     WRITELB0305F1
     C           *IN40     IFEQ '1'
     C                     WRITELB0305C1
     C                     END
     C                     READ LB0305F1                 79
     C*
     C           *INKC     IFEQ '0'
     C*
     C** Validate screen 1
     C                     EXSR #BA
     C                     END
     C*
     C                     END
     C*
     C                     MOVE 'N'       WWVLD1
     C                     MOVE *BLANKS   DD1CNS
     C                     MOVE ' '       DDBPSL
     C                     MOVE '0'       *IN83
     C*
     C** else called by another program
     C                     ELSE
     C                     CALL 'PMC1003'                                 092960
     C                     PARM           WWPLDA                          092960
     C                     MOVE QMCPGM    WWPROG                          092960
     C*
     C                     MOVE 'LB0305'  WWPROG                          092512
     C                     MOVE WWEQCN    WWCNSN
     C***********WWCNSN    CHAINSDLBCSL0             79                   S01498
     C           WWCNSN    CHAINLBLBCSJ0             79                   S01498
     C           *IN79     IFEQ '1'
     C                     Z-ADD0         WWRTCD
     C                     EXSR #ZG
     C                     END
     C*
     C                     END
     C*
     C** Valid customer number now process screen 2
     C           *INKC     IFEQ '0'
     C*
     C** Calculate totals for screen 2
     C                     EXSR #BB
     C*
     C** Calculate subfile values for screen 2
     C                     EXSR #BC
     C*
     C** Research Forward Transactions for this customer                  SA9101
     C                     MOVE '0'       *IN41                           SA9101
     C                     EXSR #BJ                                       SA9101
     C*                                                                   SA9101
     C                     END
     C*
     C** Process screen 2 until a termination request
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C*
     C** Display and validate screen 2
     C*
     C                     WRITELB0305F2
     C*                                                                   R00266
     C** If no records to display - setof SFLDSP , disable CMD keys       R00266
     C**    and display message 'No data to display'                      R00266
     C*                                                                   R00266
     C           SFLRR2    IFEQ *ZEROS                                    R00266
     C           *IN28     ANDEQ'1'                                       R00266
     C*                                                                   R00266
     C                     MOVE '0'       *IN28                           R00266
     C                     MOVE '1'       *IN84                           R00266
     C                     MOVE 'N'       WWVLD2                          R00266
     C                     MOVEL'LBM0049' ZAMSID                          R00266
     C                     EXSR ZASNMS                                    R00266
     C*                                                                   R00266
     C                     END                                            R00266
     C*                                                                   R00266
     C           WWVLD2    IFEQ 'N'
     C                     WRITELB0305C1
     C                     END
     C                     WRITELB0305C2
     C                     READ LB0305C2                 79
     C*
     C** Save the screen subfile relative record number
     C           WSDSRN    IFEQ 0
     C                     Z-ADDSFLRR2    WWSTRN  40
     C                     ELSE
     C                     Z-ADDWSDSRN    WWSTRN
     C                     END
      *                                                                   R0030
     C***KX******          DO                                       R0030 S01498
     C***********          CALL 'LBC0305A'                          R0030 S01498
     C***********          PARM           GRPJOB 10                 R0030 S01498
     C***********GRPJOB    IFNE '*NONE'                             R0030 S01498
     C***********          MOVE '0'       *INKX                     R0030 S01498
     C***********          MOVE '1'       *INKL                     R0030 S01498
     C***********          END                                      R0030 S01498
     C***********          END                                      R0030 S01498
     C*
     C           *INKC     IFEQ '0'                        f3
     C           *INKL     ANDEQ'0'                        f12
     C************INKI     CASEQ'1'       #BD              f9
     C   41      *INKF     CASEQ'1'       #BK              f6             SA9101
     C           *INKK     CASEQ'1'       #BE              f11
     C           *INKP     CASEQ'1'       #BF              f15
     C           *INKX     CASEQ'1'       #BI              f23
     C           *INKY     CASEQ'1'       #BG              f24
     C           *IN27     CASEQ'1'       #BC              roll-up
     C                     CAS            #BH              enter
     C                     END
     C                     END
     C*
     C                     END
     C*
     C           WWMUFG    IFEQ '1'
     C*
     C           *INKC     IFEQ '1'
     C                     Z-ADD3         WWRTCD
     C           WWPROG    IFNE *BLANKS                                   081239
     C                     MOVE *BLANKS   QMCPGM                          081239
     C                     CALL 'PMC1001'                                 081239
     C                     PARM           WWPLDA                          081239
     C                     END                                            081239
     C                     ELSE
     C           *INKL     IFEQ '1'
     C                     Z-ADD12        WWRTCD
     C                     GOTO #B0
     C                     END
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C           #B0       ENDSR                           **  #B0      **
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BA         - Performs screen 1 validation and selection of a   *
     C**               valid customer number                             *
     C**                                                                 *
     C** CALLS       - #BAA #ZA                                          *
     C**               LB0315                                            *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BA       BEGSR
     C*
     C           DD1CNS    IFEQ *BLANKS
     C                     MOVE '0'       *IN33
     C                     ELSE
     C                     EXSR #BAA
     C                     END
     C*
     C           *IN40     IFEQ '1'
     C                     GOTO #BA0
     C                     END
     C*
     C           *IN33     IFEQ '0'
     C*
     C** Customer does not exist but is valid
     C                     MOVE DD1CNS    WWCP2
     C                     Z-ADD0         WWCP3
     C**********           Z-ADD0         WWCP4                                              CSD027A
     C                     MOVE *BLANKS   WWCP4                                              CSD027A
     C***********          UNLCKWWLDA                                     S01498
     C                     UNLCKLDA                                       S01498
     C                     CALL 'LB0315'
     C                     PARM           WWCP1   1
     C                     PARM           WWCP2  10
     C                     PARM           WWCP3   20
     C**********           PARM           WWCP4   60                                         CSD027A
     C                     PARM           WWCP4   6                                          CSD027A
     C*
     C************LOCK     IN   WWLDA                                     S01498
     C           *LOCK     IN   LDA                                       S01498
     C*
     C** If database error in called program
     C***********DBASE     IFGT 0                                         R0121
     C           DBASE     IFNE *BLANKS                                   R0121
     C           DBASE     ANDNE'000'                                     R0152
     C                     EXSR #ZA
     C                     END
     C*
     C** If F3 was pressed in called program
     C           WWCP3     IFEQ 3
     C                     Z-ADD3         WWRTCD
     C                     EXSR #ZG
     C                     END
     C*
     C** If F12 was pressed in called program
     C           WWCP3     IFEQ 12
     C                     MOVE 'N'       WWVLD1
     C                     MOVE *BLANKS   DD1CNS
     C                     GOTO #BA0
     C                     END
     C*
     C********** WWCP4     IFEQ 0                                                            CSD027A
     C           WWCP4     IFEQ *BLANKS                                                      CSD027A
     C                     MOVE 'N'       WWVLD1
     C                     ELSE
     C                     MOVE WWCP4     WWCNSN
     C***********WWCNSN    CHAINSDLBCSL0             79                   S01498
     C           WWCNSN    CHAINLBLBCSJ0             79                   S01498
     C           *IN79     IFEQ '1'
     C                     MOVE 'N'       WWVLD1
     C                     ELSE
     C                     MOVE 'Y'       WWVLD1
     C                     END
     C                     END
     C*
     C                     END
     C*
     C           WWVLD1    IFEQ 'N'
     C                     MOVE '1'       *IN40
     C*
     C** Invalid customer, load message to message subfile
     C                     MOVEL'LBM0007' ZAMSID
     C                     EXSR ZASNMS
     C                     END
     C*
     C           #BA0      ENDSR                           **  #BA0     **
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BAA        - This subroutine validates input screen 1          *
     C**                                                                 *
     C** CALLS       - NONE                                              *
     C**                                                                 *
     C** CALLED BY   - #BA                                               *
     C**                                                                 *
     C********************************************************************
     C           #BAA      BEGSR
     C*
     C                     MOVE 'N'       WWVLD1
     C*
     C** CLEAR SCREEN MESSAGE QUEUE
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ
     C                     PARM           WWPGQR
     C*
     C** Validate the customer number or shortname
     C*
     C** The first character must be alphanumeric or blank
     C*
     C           WWCCH1    LOKUPALPNU                    34
     C           *IN34     IFEQ '0'
     C                     MOVE '1'       *IN40
     C                     GOTO #BAA9
     C                     END
     C*
     C***If*the*first*char.*is*non-numeric,*check*for*a*valid*shortname
     C**********                                                                             CSD027A
     C********** WWCCH1    LOKUPNUM                      34                                  CSD027A
     C**********                                                                             CSD027A
     C********** *IN34     IFEQ '0'                                                          CSD027A
     C**********                                                                             CSD027A
     C***********DD1CNS    SETLLSDLBCSL5             40  33               S01498
     C********** DD1CNS    SETLLLBLBCSJ5             40  33               S01498             CSD027A
     C********** *IN40     IFEQ '1'                                       R0598
     C********** *IN33     IFEQ '0'                                       R0598              CSD027A
     C**********           GOTO #BAA9                                                        CSD027A
     C**********           END                                                               CSD027A
     C********** *IN33     IFEQ '1'                                                          CSD027A
     C***********          READ SDLBCSL5                 77               S01498
     C**********           READ LBLBCSJ5                 77               S01498             CSD027A
     C********** *IN77     IFEQ '1'                                                          CSD027A
     C**********           MOVE '1'       *IN40                                              CSD027A
     C**********           GOTO #BAA9                                                        CSD027A
     C**********           END                                                               CSD027A
     C**********           END                                                               CSD027A
     C**********                                                                             CSD027A
     C**********           ELSE                                                              CSD027A
     C**********                                                                             CSD027A
     C***The*first*character*is*numeric*so*check*that*the*next*5*chars.                      CSD027A
     C***are*also*numeric*and*the*last*4*are*blank.*If*still*valid*then                      CSD027A
     C***check*that*the*customer*number*exists*************************                      CSD027A
     C**********                                                                             CSD027A
     C**********           Z-ADD1         WWFLD1  20                                         CSD027A
     C********** WWFLD1    DOWLT6                                                            CSD027A
     C**********           ADD  1         WWFLD1                                             CSD027A
     C********** CUS,WWFLD1LOKUPNUM                      34                                  CSD027A
     C********** *IN34     IFEQ '0'                                                          CSD027A
     C**********           MOVE '1'       *IN40                                              CSD027A
     C**********           GOTO #BAA9                                                        CSD027A
     C**********           END                                                               CSD027A
     C**********           END                                                               CSD027A
     C*
      * Check as a shortname                                                                 CSD027A
     C           DD1CNS    CHAINLBLBCSJ5             77                                      CSD027A
      * If shortname was not found                                                           CSD027A
     C           *IN77     IFEQ *ON                                                          CSD027A
      *                                                                                      CSD027A
     C           WWC710    IFNE *BLANKS
     C                     MOVE '1'       *IN40
     C                     GOTO #BAA9
     C                     END
     C*
     C                     MOVELDD1CNS    WWCNSN  6
     C***********WWCNSN    SETLLSDLBCSL0             40  33               S01498
     C           WWCNSN    SETLLLBLBCSJ0             40  33               S01498
     C********** *IN40     IFEQ '1'                                       R0598
     C           *IN33     IFEQ '0'                                       R0598
     C                     GOTO #BAA9
     C                     END
     C           *IN33     IFEQ '1'
     C***********          READ SDLBCSL0                 77               S01498
     C                     READ LBLBCSJ0                 77               S01498
     C           *IN77     IFEQ '1'
     C                     MOVE '1'       *IN40
     C                     GOTO #BAA9
     C                     END
     C                     END
     C*
     C                     END
     C*
     C** Validation successful
     C*
     C           *IN33     IFEQ '1'
     C                     MOVE 'Y'       WWVLD1
     C                     END
     C*
     C** Invalid customer found, load message to message subfile
     C           #BAA9     TAG                             **  #BAA9    **
     C           *IN40     IFEQ '1'
     C                     MOVEL'LBM0007' ZAMSID
     C                     EXSR ZASNMS
     C                     END
     C*
     C           #BAA0     ENDSR                           **  #BAA0    **
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** ZASNMS    - Send message to program's message queue             *
     C**                                                                 *
     C** CALLED BY -                                                     *
     C**                                                                 *
     C** CALLS     - Y2SNMGC                                             *
     C**                                                                 *
     C********************************************************************
     C           ZASNMS    BEGSR                           ** ZASNMS    **
     C*
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10
     C                     PARM           ZAPGRL  5
     C                     PARM           ZAMSID  7
     C                     PARM           ZAMSGF 10
     C                     PARM           ZAMSDA132
     C                     PARM           ZAMSTP  7
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BB         - Calculates the totals for screen 2                *
     C**                                                                 *
     C** CALLS       - #ZB #BBA #ZF #ZL750 SCONV  #ZC750 #ZA #ZE         *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BB       BEGSR
     C*
     C** Clear the input screen 2 subfile
     C*
     C                     MOVE '1'       *IN30
     C                     MOVE *BLANKS   DD1CNS
     C                     WRITELB0305F1
     C                     WRITELB0305C2
     C                     MOVE '0'       *IN30
     C                     Z-ADD0         LSTRR2
     C                     MOVE '0'       *IN31
     C                     MOVE '1'       *IN28
     C                     MOVE 'Y'       WWVLD2
     C*
     C** Reset currency flag 'LB'
     C                     MOVE 'LB'      WWCUFG  2
     C***********          MOVE LBCCY     DD2CCY                          S01498
     C                     MOVE LBCYCD    DD2CCY                          S01498
     C                     MOVE '1'       *IN82
     C*
     C** Find the number of decimal places etc. for the Customer currency
     C*
     C                     MOVE CUCCY     WWCCY   3
     C                     EXSR #ZB
     C                     Z-ADDA6NBDP    WWCUDP  10
     C                     Z-ADDA6SPRT    WWSRO
     C                     Z-ADDA6NBDP    WWDPO
     C                     MOVE A6MDIN    WWMDO
     C*
     C** Move cust fields into display fields and save parent flag
     C                     MOVE BBCUST    DDCUST
     C                     MOVE BBCRNM    DDCRNM
     C                     MOVE BBCRTN    DDCRTN
     C                     MOVE BBPAIN    WWPAIN
     C**********           MOVE BBCUST    WWCNUM  60                                         CSD027A
     C                     MOVE BBCUST    WWCNUM  6                                          CSD027A
     C*
     C** Read totals from Portfolio lending Extract Summary file
     C           WWCNUM    CHAINLBEXTSL1             78
     C           *IN78     IFEQ '1'
     C                     Z-ADD0         WWTOTE
     C                     Z-ADD0         WWTOTL
     C                     Z-ADD0         WWTOTC
     C                     Z-ADD0         WWTOTB
     C                     Z-ADD0         WWTOTA
     C                     Z-ADD0         WWTOTQ
     C                     MOVE '0'       *IN82
     C                     ELSE
     C*
     C                     Z-ADDESCMTL    WWTOTC 150
     C           ESOWEX    ADD  ESTPIU    WWTOTE 150
     C*******    ESOWCO    ADD  ESTPRD    WWTOTL 150                      LB0002
     C           ESOWCO    ADD  ESTPRV    WWTOTL 150                      LB0002
     C*
     C** Only include pledges received in borrowing power under
     C** certain circumstances
     C                     Z-ADDESLPWR    WWTOTB 150
     C           CUINBP    IFEQ 'Y'
     C*******              ADD  ESTPRD    WWTOTB                          LB0003
     C                     ADD  ESTPRV    WWTOTB                          LB0003
     C                     END
     C*
     C** Calculate AVAILABLE as lesser of (tot borr pwr - tot exposure)
     C**                              and (tot commit't - tot exposure)
     C           WWTOTB    SUB  WWTOTE    WWTMP1 150
     C           WWTOTC    SUB  WWTOTE    WWTMP2 150
     C           WWTMP1    IFLT WWTMP2
     C                     Z-ADDWWTMP1    WWTOTA 150
     C                     ELSE
     C                     Z-ADDWWTMP2    WWTOTA
     C                     END
     C*
     C** Calculate CUSTOMER EQUITY (own collateral - tot exposure + tot margin)
     C***        WWCKY1    CHAINLBEXTRL2             58                   R1036
     C***                                                                 R1036
     C***        *IN58     IFEQ '1'                                       R1036
     C***                  Z-ADD0         WWMARG 150                      R1036
     C***                  ELSE                                           R1036
     C***                  Z-ADDEEEXPS    WWMARG                          R1036
     C***                  END                                            R1036
     C***                                                                 R1036
     C***        ESOWCO    SUB  WWTOTE    WWTOTQ 150                      R1036
     C***                  ADD  WWMARG    WWTOTQ                          R1036
     C*                                                                   R1036
     C***Calculate TOTAL EQUITY (own collateral - tot exposure)      R1036R5649
     C**         ESOWCO    SUB  WWTOTE    WWTOTQ 150                 R1036R5649
     C** Calculate TOTAL EQUITY (TOT collateral - tot exposure)      R1036R5649
     C           WWTOTL    SUB  WWTOTE    WWTOTQ 150                 R1036R5649
     C*
     C** If cash instrument only flag is not 'Y' set IN82 off
     C           ESCIFL    IFNE 'Y'
     C                     MOVE '0'       *IN82
     C                     END
     C*
     C                     END
     C*
     C** Now convert to display format in Portfolio lending base currency
     C*
     C                     Z-ADDWWTOTE    ZFLD15
     C                     EXSR #ZL750
     C                     MOVE ZOUT21    WWTOLE 16
     C                     MOVE ZOUT21    DDTOTE
     C*
     C                     Z-ADDWWTOTL    ZFLD15
     C                     EXSR #ZL750
     C                     MOVE ZOUT21    WWTOLL 16
     C                     MOVE ZOUT21    DDTOTL
     C*
     C                     Z-ADDWWTOTC    ZFLD15
     C                     EXSR #ZL750
     C                     MOVE ZOUT21    WWTOLC 16
     C                     MOVE ZOUT21    DDTOTC
     C*
     C                     Z-ADDWWTOTA    ZFLD15
     C                     EXSR #ZL750
     C                     MOVE ZOUT21    WWTOLA 16
     C                     MOVE ZOUT21    DDTOTA
     C*
     C                     Z-ADDWWTOTB    ZFLD15
     C                     EXSR #ZL750
     C                     MOVE ZOUT21    WWTOLB 16
     C                     MOVE ZOUT21    DDTOTB
     C*
     C                     Z-ADDWWTOTQ    ZFLD15
     C                     EXSR #ZL750
     C                     MOVE ZOUT21    WWTOLQ 16
     C                     MOVE ZOUT21    DDTOTQ
     C*
     C** now convert to customer currency if different
     C***********LBCCY     IFEQ CUCCY                                     S01498
     C           LBCYCD    IFEQ CUCCY                                     S01498
     C*
     C                     MOVE WWTOLE    WWTOCE 16
     C                     MOVE WWTOLL    WWTOCL 16
     C                     MOVE WWTOLC    WWTOCC 16
     C                     MOVE WWTOLA    WWTOCA 16
     C                     MOVE WWTOLB    WWTOCB 16
     C                     MOVE WWTOLQ    WWTOCQ 16
     C*
     C                     ELSE
     C*
     C** convert to customer currency and display format
     C                     Z-ADDWWTOTE    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    ZFLD15
     C                     EXSR #ZC750
     C                     MOVE ZOUT21    WWTOCE
     C*
     C                     Z-ADDWWTOTL    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    ZFLD15
     C                     EXSR #ZC750
     C                     MOVE ZOUT21    WWTOCL
     C*
     C                     Z-ADDWWTOTC    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    ZFLD15
     C                     EXSR #ZC750
     C                     MOVE ZOUT21    WWTOCC
     C*
     C                     Z-ADDWWTOTA    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    ZFLD15
     C                     EXSR #ZC750
     C                     MOVE ZOUT21    WWTOCA
     C*
     C                     Z-ADDWWTOTB    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    ZFLD15
     C                     EXSR #ZC750
     C                     MOVE ZOUT21    WWTOCB
     C*
     C                     Z-ADDWWTOTQ    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    ZFLD15
     C                     EXSR #ZC750
     C                     MOVE ZOUT21    WWTOCQ
     C*
     C                     END
     C*
     C** Calculate percentages :
     C*
     C** If Total Collateral is non-zero
     C           WWTOTL    IFNE 0
     C*
     C**                        Total Exposure
     C** Exposure percentage =  ---------------    *  100
     C**                        Total Collateral
     C*
     C***********WWTOTE    MULT 100       WW170  170                      B7844
     C***********WW170     DIV  WWTOTL    WWTOPE  30H                     B7844
     C***********          Z-ADDWWTOPE    DDTOPE                          B7844
     C           WWTOTE    DIV  100       WW170  170H                     B7844
     C           WWTOTL    DIV  100       W2170  170H                     B7844
     C           WW170     MULT 100       WW170                           B7844
     C*                                                                   051587
     C           W2170     IFNE 0                                         051587
     C           WW170     DIV  W2170     DDTOPE    H                     B7844
     C                     ELSE                                           051587
     C                     Z-ADD0         DDTOPE                          051587
     C                     END                                            051587
     C           WW170     DIV  WWTOTL    ZZTOPE 150H                     001315
     C*
     C**                          Total Commitment
     C** Commitment percentage =  ----------------   *  100
     C**                          Total Collateral
     C*
     C           WWTOTC    MULT 100       WW170
     C           WW170     DIV  WWTOTL    WWTOPC  30H
     C           WW170     DIV  WWTOTL    ZZTOPC 150H                     001315
     C                     Z-ADDWWTOPC    DDTOPC
     C*
     C**                               Total Borrowing Power
     C** Borrowing Power percentage =  ---------------------    *  100
     C**                                  Total Collateral
     C*
     C           WWTOTB    MULT 100       WW170  170
     C           WW170     DIV  WWTOTL    WWTOPB  30H
     C           WW170     DIV  WWTOTL    ZZTOPB 150H                     001315
     C                     Z-ADDWWTOPB    DDTOPB
     C*
     C*                                                                   001315
     C** check excessive percentages                                      001315
     C           ZZTOPE    IFGT 999                                       001315
     C                     Z-ADD999       DDTOPE                          001315
     C                     END                                            001315
     C           ZZTOPC    IFGT 999                                       001315
     C                     Z-ADD999       DDTOPC                          001315
     C                     END                                            001315
     C           ZZTOPB    IFGT 999                                       001315
     C                     Z-ADD999       DDTOPB                          001315
     C                     END                                            001315
     C** else collateral is zero
     C                     ELSE
     C*
     C                     Z-ADD0         DDTOPE
     C                     Z-ADD0         DDTOPC
     C                     Z-ADD0         DDTOPB
     C*
     C                     END
     C*
     C** SETLL on LBEXTRL4 or L7 and read first record
     C           WWPAIN    IFEQ 'P'
     C                     MOVE BBCUST    WWPNUM  6
     C           WWPNUM    SETLLLBEXTRL7                 75
     C                     ELSE
     C           WWCNUM    SETLLLBEXTRL4                 75
     C                     END
     C           *IN75     IFEQ '0'
     C*
     C** No data found for this customer
     C** check totals from extract summary file are zero, else dberror
     C           WWTOTE    IFNE 0
     C           WWTOTL    ORNE 0
     C           WWTOTC    ORNE 0
     C           WWTOTB    ORNE 0
     C                     MOVEL'LB0305'  DBPGM
     C           WWPAIN    IFEQ 'P'
     C           *LOCK     IN   LDA                                       S01498
     C*********************Z-ADD6         DBASE            ***************R0121
     C                     MOVE '006'     DBASE            ***************R0121
     C***********          MOVEL'LBEXTRL7'DBFILE           * DBERROR 006 *S01498
     C                     MOVE 'LBEXTRL7'DBFILE           * DBERROR 006 *S01498
     C                     MOVELWWPNUM    DBKEY            ***************
     C                     OUT  LDA                                       S01498
     C                     ELSE
     C           *LOCK     IN   LDA                                       S01498
     C*********************Z-ADD4         DBASE            ***************R0121
     C                     MOVE '004'     DBASE            ***************R0121
     C***********          MOVEL'LBEXTRL4'DBFILE           * DBERROR 004 *S01498
     C                     MOVE 'LBEXTRL4'DBFILE           * DBERROR 004 *S01498
     C                     MOVELWWCNUM    DBKEY            ***************
     C                     OUT  LDA                                       S01498
     C                     END
     C                     EXSR #ZA
     C                     END
     C*
     C                     MOVE 'N'       WWVLD2
     C                     MOVEL'LBM0049' ZAMSID
     C                     EXSR ZASNMS
     C*
     C** clear SFLDSP indicator so that subfile is not displayed
     C                     MOVE '0'       *IN28
     C*
     C** Remove input field and disable all F keys except F3 and F12
     C                     MOVE '1'       *IN84
     C*
     C                     ELSE
     C*
     C                     MOVE '1'       *IN28
     C                     MOVE '0'       *IN84
     C           WWPAIN    IFEQ 'P'
     C           WWPNUM    READELBEXTRL7                 31
     C                     ELSE
     C           WWCNUM    READELBEXTRL4                 31
     C                     END
     C                     MOVE EELCGR    WWLCGR
     C                     EXSR #ZE
     C*
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BC         - Calculates the next page of records for the       *
     C**               subfile                                           *
     C**                                                                 *
     C** CALLS       - #BCA #ZL750 #ZD #ZC #ZE                           *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BC       BEGSR
     C*
     C** Load a page of subfile records
     C                     Z-ADDLSTRR2    SFLRR2
     C                     Z-ADD0         WWSFCT  40
     C*
     C           *IN31     DOWEQ'0'
     C           WWSFCT    ANDLT10
     C*
     C** Read all extract records for all instruments in this group
     C                     EXSR #BCA
     C/COPY WNCPYSRC,LB0305C002
     C*                                                                   LB0004
     C           WWEXPS    IFNE 0                                         LB0004
     C           WWLIMT    ORNE 0                                         SA9018
     C           WWCOLL    ORNE 0                                         LB0004
     C*
     C** Set up Portfolio lending Exposure
     C                     Z-ADDWWEXPS    ZFLD15
     C                     EXSR #ZL750
     C                     MOVE ZOUT21    DD2LBE
     C*                                                                   R0170
     C** Set up FX & pM Exposure                                          R0170
     C           WWEXPO    IFNE *ZERO                                     R0170
     C                     Z-ADDWWEXPO    ZFLD15                          R0170
     C                     EXSR #ZL750                                    R0170
     C                     MOVE ZOUT21    DD2LBZ                          R0170
     C                     ELSE                                           R0170
     C                     MOVE *BLANK    DD2LBZ                          R0170
     C                     END                                            R0170
     C*
     C** Set up Portfolio lending Limit
     C           WWLIMT    IFNE *ZERO                                     R0148
     C                     Z-ADDWWLIMT    ZFLD15
     C                     EXSR #ZL750
     C                     MOVE ZOUT21    DD2LBL
     C                     ELSE                                           R0148
     C                     MOVE *BLANKS   DD2LBL                          R0148
     C                     END                                            R0148
     C*
     C** Set up Portfolio lending Collateral
     C                     Z-ADDWWCOLL    ZFLD15
     C                     EXSR #ZL750
     C                     MOVE ZOUT21    DD2LBC
     C*
     C** Set up Portfolio lending Available and convert to cust currency
     C                     EXSR #ZD
     C*
     C** move hidden fields to display field
     C                     EXSR #ZC
     C*
     C                     ADD  1         WWSFCT
     C                     ADD  1         SFLRR2
     C*
     C                     WRITELB0305S2
     C*                                                                   LB0004
     C                     END                                            LB0004
     C/COPY WNCPYSRC,LB0305C003
     C*
     C** read details of the next group from LBGROUPD
     C** (credit group key was set up in #BCA)
     C           *IN31     IFEQ '0'
     C                     EXSR #ZE
     C                     END
     C*
     C**         end of DOW
     C                     END
     C*
     C                     Z-ADDSFLRR2    LSTRR2
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BCA        - Read all extract records for all instruments      *
     C**               in this group                                     *
     C**                                                                 *
     C** CALLS       - NONE                                              *
     C**                                                                 *
     C** CALLED BY   - #BC                                               *
     C**                                                                 *
     C********************************************************************
     C           #BCA      BEGSR
     C*
     C                     Z-ADD0         WWEXPS 150
     C******************** Z-ADDEELIMT    WWLIMT 150                      LB0004
     C                     Z-ADD0         WWLIMT 150                      LB0004
     C                     Z-ADD0         WWCOLL 150
     C                     Z-ADD0         WWEXPO 150                      R0170
     C*
     C           EELCGR    DOWEQWWLCGR
     C           *IN31     ANDEQ'0'
     C*                                                                   LB0004
     C** omit records with Instrument type in LBFXUP and LBFXUL           LB0004
     C** of SDLOMBPD                                                      LB0004
     C/COPY WNCPYSRC,LB0305C004
     C           EEINST    IFNE LBFXUP                                    LB0004
     C           EEINST    ANDNELBFXUL                                    LB0004
     C           EEINST    ANDNELBPMUP                                    LB2000
     C           EEINST    ANDNELBPMUL                                    LB2000
     C           EEINST    ANDNE'@OF'                                     SA9018
     C           EEINST    ANDNE'@OP'                                     SA9018
     C*
     C** accumulate totals
     C           EEINST    IFEQ LBFXMA                                    B7862
     C           EEINST    OREQ LBPMMA                                    B7862
     C           WWEXPS    ADD  EEMARG    WWEXPS                          B7862
     C                     ELSE                                           B7862
     C           WWEXPS    ADD  EEEXPS    WWEXPS
     C                     END                                            B7862
     C           WWLIMT    ADD  EELIMT    WWLIMT
     C           WWCOLL    ADD  EECOLL    WWCOLL
     C*                                                                   LB0004
     C           EEINST    IFEQ LBFXMA                                    R0170
     C           EEINST    OREQ LBPMMA                                    R0170
     C                     ADD  EEEXPO    WWEXPO                          R0170
     C                     END                                            R0170
     C*                                                                   R0170
     C                     END                                            LB0004
     C*
     C           WWPAIN    IFEQ 'P'
     C           WWPNUM    READELBEXTRL7                 31
     C                     ELSE
     C           WWCNUM    READELBEXTRL4                 31
     C                     END
     C/COPY WNCPYSRC,LB0305C005
     C*
     C                     END
     C*
     C** set up key to credit group file LBGROUL1 for #ZE
     C                     MOVE EELCGR    WWLCGR
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZE       - Read the LBGROUL1 file to get the group name for    *
     C**             display                                             *
     C**                                                                 *
     C** CALLS     - #ZA                                                 *
     C**                                                                 *
     C** CALLED BY - #BB #BC                                             *
     C**                                                                 *
     C********************************************************************
     C           #ZE       BEGSR                           **  #ZE      **
     C*
     C***********WWLCGR    CHAINLBGROUL1             76                   S01498
     C************IN76     IFEQ '1'                                       S01498
     C*                                                                   S01498
     C** Get group name using access object                               S01498
     C*                                                                   S01498
     C                     CALL 'AOGROUR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM WWLCGR    P@LCGR  3                       S01498
     C           SDGROU    PARM SDGROU    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if error occurred                                          S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVEL'LB0305'  DBPGM            ***************
     C***********          MOVEL'LBGROUL1'DBFILE           * DBERROR 005 *S01498
     C                     MOVE 'LBGROUPD'DBFILE           * DBERROR 005 *S01498
     C*********************Z-ADD5         DBASE            ***************R0121
     C                     MOVE '005'     DBASE            ***************R0121
     C                     MOVELWWLCGR    DBKEY
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     END
     C*********************MOVE GPLCGN    DD2CGP                          R0170
     C                     MOVE *BLANKS   DD2CGP                          R0170
     C                     MOVELGPLCGN    DD2CGP                          R0170
     C                     MOVE WWLCGR    DDLCGR
     C*
     C           #ZE0      ENDSR                           **  #ZE0     **
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BE         - Processes a CMD/11 for change in display currency *
     C**                                                                 *
     C** CALLS       - #ZC                                               *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BE       BEGSR
     C*
     C           WWCUFG    IFEQ 'LB'
     C                     MOVE 'CU'      WWCUFG
     C                     MOVE CUCCY     DD2CCY
     C                     ELSE
     C                     MOVE 'LB'      WWCUFG
     C***********          MOVE LBCCY     DD2CCY                          S01498
     C                     MOVE LBCYCD    DD2CCY                          S01498
     C                     END
     C*
     C                     MOVE '0'       *IN81
     C*
     C                     DO   LSTRR2    WWSFCT
     C*
     C           WWSFCT    CHAINLB0305S2             79
     C*
     C                     EXSR #ZC
     C*
     C                     UPDATLB0305S2
     C*
     C**         End of DO
     C                     END
     C*
     C                     Z-ADDWWSTRN    SFLRR2
     C*
     C** clear program message queue & borrowing power input field
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ
     C                     PARM           WWPGQR
     C                     MOVE 'Y'       WWVLD2
     C                     MOVE ' '       DDBPSL
     C                     MOVE '0'       *IN83
     C*
     C** now change currency of totals
     C           WWCUFG    IFEQ 'LB'
     C*
     C                     MOVE WWTOLE    DDTOTE
     C                     MOVE WWTOLL    DDTOTL
     C                     MOVE WWTOLC    DDTOTC
     C                     MOVE WWTOLA    DDTOTA
     C                     MOVE WWTOLB    DDTOTB
     C                     MOVE WWTOLQ    DDTOTQ
     C*
     C                     ELSE
     C*
     C                     MOVE WWTOCE    DDTOTE
     C                     MOVE WWTOCL    DDTOTL
     C                     MOVE WWTOCC    DDTOTC
     C                     MOVE WWTOCA    DDTOTA
     C                     MOVE WWTOCB    DDTOTB
     C                     MOVE WWTOCQ    DDTOTQ
     C*
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BF         - Processes CMD/15 to call LB0310,                  *
     C**               Portfolio lending Analysis                        *
     C**                                                                 *
     C** CALLS       - #ZA                                               *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BF       BEGSR
     C*
     C           WWRTCD    IFNE 15                         -B1
     C*
     C** If program is called from Portfolio Management                   R01118
     C           WWMUFG    IFEQ '2'                                       R01118
     C                     MOVE WWMUFG    WWLAP1                          R01118
     C                     END                                            R01118
     C*                                                                   R01118
     C                     MOVE *BLANK    WWCHCK  1                       R0121
     C**********           MOVE DDCUST    WWLAP2  60                                         CSD027A
     C                     MOVE DDCUST    WWLAP2  6                                          CSD027A
     C                     Z-ADD25        WWLAP3  20
     C***********          UNLCKWWLDA                                     S01498
     C                     UNLCKLDA                                       S01498
     C                     CALL 'LB0310'
     C                     PARM           WWLAP1
     C                     PARM           WWLAP2
     C                     PARM           WWLAP3
     C                     PARM           WWUPRF
     C                     PARM           WWCHCK                          R0121
     C***********                                                    R0121081239
     C***IF*PORTFOLIO GROUP JOB REQUESTED                            R0121081239
     C***********                                                    R0121081239
     C***********WWCHCK    IFEQ 'Y'                                  R0121081239
     C**                                                                  081239
     C** IF PORTFOLIO PROGRAM CALLED                                      081239
     C**                                                                  081239
     C                     CALL 'PMC1003'                                 081239
     C                     PARM           WWPLDA                          081239
     C           QMENQT    IFEQ 'C'                                       081239
     C                     MOVE '1'       *INKL                           081239
     C                     END                                            081239
     C           WWPROG    IFEQ *BLANKS                                   081239
     C           QMENQT    ANDEQ'R'                                       081239
     C** RESET FIELD                                                      081239
     C                     MOVE *BLANK    QMENQT                          081239
     C                     CALL 'PMC1001'                                 081239
     C                     PARM           WWPLDA                          081239
     C                     MOVE '1'       *INLR                           R0121
     C                     RETRN                                          R0121
     C                     END                                            R0121
     C*
     C************LOCK     IN   WWLDA                                     S01498
     C           *LOCK     IN   LDA                                       S01498
     C*
     C** If database error in called program
     C***********DBASE     IFGT 0                          -B2            R0121
     C           DBASE     IFNE *BLANKS                    -B2            R0121
     C           DBASE     ANDNE'000'                                     R0152
     C                     EXSR #ZA
     C                     END                             -E2
     C*
     C** If F3 was pressed in called program
     C           WWLAP3    IFEQ 3                          -B2
     C                     Z-ADD3         WWRTCD
     C                     EXSR #ZG
     C                     END                             -E2
     C*
     C                     ELSE                            -X1
     C                     MOVE '1'       *INLR
     C                     RETRN
     C                     END                             -E1
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BG         - Processes CMD/24 to call Portfolio Management     *
     C**               Documentation Program                             *
     C**                                                                 *
     C** CALLS       - #ZA 'PM0160'                                      *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BG       BEGSR
     C*
     C************LOCK     IN   WWLDA                              051775 S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '   '     DBASE                           051775
     C***********          OUT  WWLDA                              051775 S01498
     C                     OUT  LDA                                       S01498
     C                     MOVE 'E'       WWPMD1  1
     C                     MOVE '0'       WWPMD2  1
     C                     MOVE DDCUST    WWPMD3  6
     C                     MOVE 'I'       WWPMD4  1
     C***********          UNLCKWWLDA                                     S01498
     C                     UNLCKLDA                                       S01498
     C*********************CALL 'PM0160'                                  R0119
     C                     CALL 'PMC0160'                                 R0119
     C                     PARM           WWPMD1
     C                     PARM           WWPMD2
     C                     PARM           WWPMD3
     C                     PARM           WWPMD4
     C*
     C************LOCK     IN   WWLDA                                     S01498
     C           *LOCK     IN   LDA                                       S01498
     C*
     C** If database error in called program
     C***********DBASE     IFGT 0                                         R0121
     C           DBASE     IFNE *BLANKS                                   R0121
     C           DBASE     ANDNE'000'                                     R0152
     C                     EXSR #ZA
     C                     END
     C*
     C** Set PM Documentation program called flag to Y
     C                     MOVE 'Y'       WWPMDC
     C*
     C** If F3 was pressed in called program
     C           WWPMD2    IFEQ '1'
     C                     Z-ADD3         WWRTCD
     C                     EXSR #ZG
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BH         - Processes 'ENTER' on screen 2                     *
     C**                                                                 *
     C** CALLS       - #ZA                                               *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BH       BEGSR
     C*
     C** Validate input fields on screen 2
     C                     MOVE 'Y'       WWVLD2
     C*
     C** CLEAR SCREEN MESSAGE QUEUE
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ
     C                     PARM           WWPGQR
     C                     MOVE '0'       *IN81
     C                     MOVE '0'       *IN83
     C                     MOVE '0'       *IN85                           R01168
     C                     MOVE '0'       *IN86                           R01168
     C*                                                                   R01168
     C** Check exposure enquiry selection field is                        R01168
     C** either blank or 'X'.                                             R01168
     C           DDEXSL    IFNE ' '                                       R01168
     C           DDEXSL    ANDNE'X'                                       R01168
     C                     MOVE '1'       *IN85                           R01168
     C                     MOVE 'N'       WWVLD2                          R01168
     C*                                                                   R01168
     C** Invalid selection, load message to message subfile               R01168
     C                     MOVEL'LBM0008' ZAMSID                          R01168
     C                     EXSR ZASNMS                                    R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C** Check Collateral Enquiry selection feld is                       R01168
     C** either blank or 'X'.                                             R01168
     C           DDCLSL    IFNE ' '                                       R01168
     C           DDCLSL    ANDNE'X'                                       R01168
     C                     MOVE '1'       *IN86                           R01168
     C                     MOVE 'N'       WWVLD2                          R01168
     C*                                                                   R01168
     C** Invalid selection, load message to message subfile               R01168
     C                     MOVEL'LBM0008' ZAMSID                          R01168
     C                     EXSR ZASNMS                                    R01168
     C                     END                                            R01168
     C*
     C** Check borrowing power enquiry selection field is
     C** either blank or 'X'.
     C           DDBPSL    IFNE ' '
     C           DDBPSL    ANDNE'X'
     C                     MOVE '1'       *IN83
     C                     MOVE 'N'       WWVLD2
     C*
     C** Invalid selection, load message to message subfile
     C                     MOVEL'LBM0008' ZAMSID
     C                     EXSR ZASNMS
     C*********************GOTO #BH0                                      R01168
     C                     END
     C*                                                                   R01168
     C           WWVLD2    IFEQ 'N'                                       R01168
     C                     GOTO #BH0                                      R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C** Call LB0320, Exposure Enquiry, if selected.                      R01168
     C           DDEXSL    IFEQ 'X'                                       R01168
     C                     MOVE '1'       WWEXE1  1                       R01168
     C**********           MOVE DDCUST    WWEXE2  60                                  R01168 CSD027A
     C                     MOVE DDCUST    WWEXE2  6                                          CSD027A
     C                     MOVE *BLANKS   WWEXE3  2                       R01168
     C***********          UNLCKWWLDA                              R01168 S01498
     C                     UNLCKLDA                                       S01498
     C                     CALL 'LB0322'                                  R01168
     C                     PARM           WWEXE1                          R01168
     C                     PARM           WWEXE2                          R01168
     C                     PARM           WWEXE3                          R01168
     C*                                                                   R01168
     C************LOCK     IN   WWLDA                              R01168 S01498
     C           *LOCK     IN   LDA                                       S01498
     C*                                                                   R01168
     C** If database error in called program                              R01168
     C***********DBASE     IFGT 0                                  R01168 R0121
     C           DBASE     IFNE *BLANKS                                   R0121
     C           DBASE     ANDNE'000'                                     R0152
     C                     EXSR #ZA                                       R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C** If F3 was pressed in called program                              R01168
     C           WWEXE3    IFEQ '03'                                      R01168
     C                     Z-ADD3         WWRTCD                          R01168
     C                     EXSR #ZG                                       R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C                     MOVE ' '       DDEXSL                          R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C*                                                                   R01168
     C** Call LB0320, Collateral enquiry, if selected.                    R01168
     C           DDCLSL    IFEQ 'X'                                       R01168
     C                     MOVE '1'       WWCLE1  1                       R01168
     C**********           MOVE DDCUST    WWCLE2  60                                  R01168 CSD027A
     C                     MOVE DDCUST    WWCLE2  6                                          CSD027A
     C                     MOVE *BLANKS   WWCLE3  2                       R01168
     C***********          UNLCKWWLDA                              R01168 S01498
     C                     UNLCKLDA                                       S01498
     C                     CALL 'LB0323'                                  R01168
     C                     PARM           WWCLE1                          R01168
     C                     PARM           WWCLE2                          R01168
     C                     PARM           WWCLE3                          R01168
     C*                                                                   R01168
     C************LOCK     IN   WWLDA                              R01168 S01498
     C           *LOCK     IN   LDA                                       S01498
     C*                                                                   R01168
     C** If database error in called program                              R01168
     C***********DBASE     IFGT 0                                  R01168 R0121
     C           DBASE     IFNE *BLANKS                                   R0121
     C           DBASE     ANDNE'000'                                     R0152
     C                     EXSR #ZA                                       R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C** If F3 was pressed in called program                              R01168
     C           WWCLE3    IFEQ '03'                                      R01168
     C                     Z-ADD3         WWRTCD                          R01168
     C                     EXSR #ZG                                       R01168
     C                     END                                            R01168
     C*                                                                   081239
     C** IF PORTFOLIO PROGRAM CALLED                                      081239
     C*                                                                   081239
     C                     CALL 'PMC1003'                                 081239
     C                     PARM           WWPLDA                          081239
     C           WWPROG    IFEQ *BLANKS                                   081239
     C           QMENQT    ANDEQ'R'                                       081239
     C*                                                                   081239
     C** RESET FIELD                                                      081239
     C*                                                                   081239
     C                     MOVE *BLANK    QMENQT                          081239
     C                     CALL 'PMC1001'                                 081239
     C                     PARM           WWPLDA                          081239
     C                     MOVE '1'       *INLR                           081239
     C                     RETRN                                          081239
     C                     END                                            081239
     C*                                                                   R01168
     C                     MOVE ' '       DDCLSL                          R01168
     C                     END                                            R01168
     C*
     C** Call LB0320, Borrowing Power Enquiry, if selected.
     C           DDBPSL    IFEQ 'X'
     C                     MOVE *BLANK    WWCHCK                          R0121
     C**********           MOVE DDCUST    WWBPE2  60                                         CSD027A
     C                     MOVE DDCUST    WWBPE2  6                                          CSD027A
     C                     MOVE *BLANKS   WWBPE3  2
     C                     MOVE WWUPRF    WWBPE4 10
     C***********          UNLCKWWLDA                                     S01498
     C                     UNLCKLDA                                       S01498
     C                     CALL 'LB0320'
     C                     PARM           WWBPE1
     C                     PARM           WWBPE2
     C                     PARM           WWBPE3
     C                     PARM           WWBPE4
     C                     PARM           WWCHCK                          R0121
     C***********                                                    R0121081239
     C***IF*PORTFOLIO GROUP JOB REQUESTED                            R0121081239
     C***********                                                    R0121081239
     C***********WWCHCK    IFEQ 'Y'                                  R0121081239
     C**                                                                  081239
     C** IF PORTFOLIO PROGRAM CALLED                                      081239
     C**                                                                  081239
     C                     CALL 'PMC1003'                                 081239
     C                     PARM           WWPLDA                          081239
     C           WWPROG    IFEQ *BLANKS                                   081239
     C           QMENQT    ANDEQ'R'                                       081239
     C** RESET FIELD                                                      081239
     C                     MOVE *BLANK    QMENQT                          081239
     C                     CALL 'PMC1001'                                 081239
     C                     PARM           WWPLDA                          081239
     C                     MOVE '1'       *INLR                           R0121
     C                     RETRN                                          R0121
     C                     END                                            R0121
     C*
     C************LOCK     IN   WWLDA                                     S01498
     C           *LOCK     IN   LDA                                       S01498
     C*
     C** If database error in called program
     C***********DBASE     IFGT 0                                         R0121
     C           DBASE     IFNE *BLANKS                                   R0121
     C           DBASE     ANDNE'000'                                     R0152
     C                     EXSR #ZA
     C                     END
     C*
     C** If F3 was pressed in called program
     C           WWBPE3    IFEQ '03'
     C                     Z-ADD3         WWRTCD
     C                     EXSR #ZG
     C                     END
     C*
     C                     MOVE ' '       DDBPSL
     C                     END
     C*
     C           #BH0      ENDSR                           **  #BH0     **
     C*
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BI         - Processes CMD/23 to call Portfolio Management     *
     C**               Enquiries Program - Extensive Security Checks     *
     C**                                                                 *
     C** CALLS       - #ZA                                               *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BI       BEGSR
     C           WWPROG    IFNE *BLANKS                                   081239
     C*
     C** clear program message queue & borrowing power input field
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ
     C                     PARM           WWPGQR
     C                     MOVE 'Y'       WWVLD2
     C                     MOVE ' '       DDBPSL
     C                     MOVE '0'       *IN83
     C*
     C** Test for Authority to view enquiries.
     C** Is customer a Portfolio Management Customer, otherwise error.
     C***********BBCUST    CHAINSDPLCSL0             52                   S01498
     C*
     C                     CALL 'AOPLCSR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BBCUST    P@CUST 10                       S01498
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01498
     C*                                                                   S01498
     C** If record not found - return error.
     C************IN52     IFEQ '1'                                       S01498
     C***********QBRECI    ORNE 'D'                                       S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C********** QBPCUS    ORNE 'Y'                                       S01498
     C                     MOVEL'LBM0068' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'N'       WWVLD2
     C                     GOTO #BI0
     C                     END
     C*
     C** If High Level Security required, continue security checking.
     C***********P9HLVS    IFEQ 'Y'                                       S01498
     C           FCHLVS    IFEQ 'Y'                                       S01498
     C*
     C***********WWUPRF    CHAINMUSER                59                   S01498
     C************IN59     IFEQ '1'                                       S01498
     C***********CHTP      OREQ 'D'                                       S01498
     C***********RECI      ORNE 'D'                                       S01498
     C*                                                                   S01498
     C** Get user details using access object                             S01498
     C*                                                                   S01498
     C                     CALL 'AOUSERR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM WWUPRF    P@UPRF 10                       S01498
     C           SDUSER    PARM SDUSER    DSSDY                           S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBKEY
     C                     MOVELWWUPRF    DBKEY            ***************
     C***********          MOVEL'MUSER   'DBFILE           * DBERROR 009 *S01498
     C                     MOVE 'MUSERDD 'DBFILE           * DBERROR 009 *S01498
     C*********************Z-ADD9         DBASE            ***************R0121
     C                     MOVE '009'     DBASE            ***************R0121
     C                     MOVEL'LB0305'  DBPGM
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     END
     C*
     C** If user has an account officer check if the a/c officer is
     C** authorised to view customer portfolio details.
     C***********ACOC      IFNE *BLANKS                                   S01498
     C           MUACOF    IFNE *BLANKS                                   S01498
     C*
     C***********ACOC      IFNE '*A'                                      S01498
     C***********ACOC      ANDNEBBACOC                                    S01498
     C***********MUACOF    IFNE '*A'                                S01498083547
     C           MUACOF    IFNE 'ALL'                                     083547
     C           MUACOF    ANDNEBBACOC                                    S01498
     C*
     C** Account Officer not authorised to view portfolio details
     C                     MOVEL'LBM0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'N'       WWVLD2
     C                     GOTO #BI0
     C                     END
     C*
     C                     ELSE
     C*
     C***********BBACOC    CHAINSDACOFL1             60                   S01498
     C************IN60     IFEQ '1'                                       S01498
     C***********AZTYLC    OREQ 'D'                        ***************S01498
     C*                                                                   S01498
     C** Get account officer details using access object                  S01498
     C*                                                                   S01498
     C                     CALL 'AOACOFR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BBACOC    P@ACOC  2                       S01498
     C           SDACOF    PARM SDACOF    DSFDY                           S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDACOFL1'DBFILE           * DBERROR 010 *S01498
     C                     MOVE 'SDACOFPD'DBFILE           * DBERROR 010 *S01498
     C*********************Z-ADD10        DBASE            ***************R0121
     C                     MOVE '010'     DBASE            ***************R0121
     C                     MOVE *BLANKS   DBKEY
     C                     MOVELBBACOC    DBKEY
     C                     MOVEL'LB0305'  DBPGM
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     END
     C*
     C***********AZDPCD    IFNE DEPC                                      S01498
     C           AZDPCD    IFNE DPPT                                      S01498
     C                     MOVEL'LBM0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'N'       WWVLD2
     C                     GOTO #BI0
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C** The user is authorised to Portfolio Management Enquiries.
     C***Change*current*job*to*become*a*Group*Job*called*CUSTOMER******   S01498
     C***********          MOVE ARR,1     CMD    80                       S01498
     C***********          Z-ADD80        LEN    155                      S01498
     C***********          CALL 'QCMDEXC'                                 S01498
     C***********          PARM           CMD                             S01498
     C***********          PARM           LEN                             S01498
     C*
     C***Set*up*Group*Data*Area****************************************   S01498
     C*                                                                   S01498
     C** Set up DTAARA/*LDA                                               S01498
     C*                                                                   S01498
     C                     EXSR #BIA
     C*
     C***Write*to*Group*Data*Area**************************************   S01498
     C***********          CALL 'PMC1000'
     C***********          PARM           WWPARM
     C                     MOVELBBBRCD    QMBRCA                          086664
     C                     MOVELBBCRTN    QMCRTN                          CPM005
     C                     MOVE QBSECO    QMSCCD                          CPM005
     C                     MOVE QBINSU    QMS9VR                          CPM005
     C                     MOVE QBCYSU    QMS0VR                          CPM005
     C**                                                                  CPM005
     C                     MOVE QMCNUM    KCUST   6                       CPM005
     C**                                                                  CPM005
     C** ACCESS JOINT ACCOUNT USERS FILE                                  CPM005
     C**                                                                  CPM005
     C                     CALL 'AOJUSRR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY   ' P@OPTN                          CPM005
     C                     PARM KCUST     P@CUST                          CPM005
     C                     PARM *BLANKS   P@USID 20                       CPM005
     C           SDJUSR    PARM SDJUSR    DSFDY                           CPM005
     C**                                                                  CPM005
     C           P@RTCD    IFEQ *BLANKS                                   CPM005
     C                     MOVE 'Y'       QMJAID                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE 'N'       QMJAID                          CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C** ACCESS POWER OF ATTORNEY FILE                                    CPM005
     C**                                                                  CPM005
     C                     CALL 'AOPATTR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY   ' P@OPTN                          CPM005
     C                     PARM KCUST     P@CUST                          CPM005
     C                     PARM *BLANKS   P@USID                          CPM005
     C           SDPATT    PARM SDPATT    DSFDY                           CPM005
     C**                                                                  CPM005
     C           P@RTCD    IFEQ *BLANKS                                   CPM005
     C                     MOVE 'Y'       QMPAID                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE 'N'       QMPAID                          CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C** ACCESS CUSTOMER CREDIT CARD FILE                                 CPM005
     C**                                                                  CPM005
     C                     CALL 'AOCCRDR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY   ' P@OPTN                          CPM005
     C                     PARM KCUST     P@CUST                          CPM005
     C                     PARM *BLANKS   P@USID                          CPM005
     C           SDCCRD    PARM SDCCRD    DSFDY                           CPM005
     C**                                                                  CPM005
     C           P@RTCD    IFEQ *BLANKS                                   CPM005
     C                     MOVE 'Y'       QMCCID                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE 'N'       QMCCID                          CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C** ACCESS RELATED CUSTOMER NUMBERS FILE                             CPM005
     C**                                                                  CPM005
     C                     CALL 'AORELCR0'                                CPM005
     C                     PARM *BLANKS   P@RTCD                          CPM005
     C                     PARM '*KEY   ' P@OPTN                          CPM005
     C                     PARM *BLANKS   P@USID                          CPM005
     C                     PARM KCUST     P@CUST                          CPM005
     C           SDRELC    PARM SDRELC    DSFDY                           CPM005
     C**                                                                  CPM005
     C           P@RTCD    IFEQ *BLANKS                                   CPM005
     C                     MOVE 'Y'       QMREID                          CPM005
     C                     ELSE                                           CPM005
     C                     MOVE 'N'       QMREID                          CPM005
     C                     END                                            CPM005
     C**                                                                  CPM005
     C                     MOVE *BLANKS   QMACHD                          CPM005
     C                     MOVE *BLANKS   QMPATT                          CPM005
     C                     MOVE *BLANKS   QMSIGN                          CPM005
     C                     MOVE *BLANKS   QMCVER                          CPM005
     C                     MOVE *BLANKS   QMWRIT                          CPM005
     C                     MOVE *BLANKS   QMDOCU                          CPM005
     C*
     C**   Write to Local Data Area
     C                     CALL 'PMC1001'
     C                     PARM           WWPLDA
     C*
     C*****Write*to*Group*Data*Area************************************   S01498
     C***********          CALL 'PMC1002'                                 S01498
     C***********          PARM           WWPGDA                          S01498
     C*
     C** Access Portfolio Management Enquiries
     C***********          CALL 'PMC0621'                                 S01498
     C                     UNLCKLDA                                       092960
     C                     CALL 'PM0630'                                  S01498
     C                     PARM           WWUPRF                          S01498
     C*
     C***Access*Group*Data*Area****************************************   S01498
     C*
     C*****Retrieve*contents*of*Group*Data*Area*to*check*for*DBERROR***   S01498
     C*****(Nothing*required*from*WWPLDA)******************************   S01498
     C***********          CALL 'PMC1004'                                 S01498
     C***********          PARM           WWPGDA                          S01498
     C*                                                                   S01498
     C** Retrieve contents of DTAARA/*LDA                                 S01498
     C*                                                                   S01498
     C                     CALL 'PMC1003'                                 S01498
     C                     PARM           WWPLDA                          S01498
     C*
     C***********          MOVE ARR,2     CMD                             S01498
     C*
     C***If*database*error*condition*exists*load*required*error********   S01498
     C***Information*from**GDA*to*the*LDA******************************   S01498
     C*                                                                   S01498
     C** If database error exists, load information from *LDA             S01498
     C*                                                                   S01498
     C           QMDBER    IFEQ 'Y'
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVELQMPGM     DBPGM            ***************
     C***********          MOVELQMFILE    DBFILE           * DBERROR xxx *S01498
     C                     MOVE QMFILE    DBFILE           * DBERROR xxx *S01498
     C*********************Z-ADDQMERRN    DBASE            ***************R0121
     C                     MOVE QMERRN    DBASE            ***************R0121
     C                     MOVE QMKEY     DBKEY
     C*
     C***Change*current*job*to*become*a*NON-Group*Job******************   S01498
     C***********          CALL 'QCMDEXC'                                 S01498
     C***********          PARM           CMD                             S01498
     C***********          PARM           LEN                             S01498
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C*
     C                     ELSE
     C*                                                                   081239
     C** If customer selection requested                                  081239
     C*                                                                   081239
     C           QMENQT    IFEQ 'C'                                       081239
     C                     MOVE '1'       *INKL                           081239
     C                     END                                            081239
     C*
     C** If enquiries terminating flag in *GDA = 'Y' then end pgm
     C           QMENQT    IFEQ 'Y'
     C                     Z-ADD3         WWRTCD
     C*
     C***Change*current*job*to*become*a*NON-Group*Job******************   S01498
     C***********          CALL 'QCMDEXC'                                 S01498
     C***********          PARM           CMD                             S01498
     C***********          PARM           LEN                             S01498
     C                     EXSR #ZG
     C                     END
     C*
     C                     END
     C                     ELSE                                           081239
     C                     MOVE '1'       *INLR                           081239
     C                     RETRN                                          081239
     C                     END                                            081239
     C*
     C***Change*current*job*to*become*a*NON-Group*Job******************   S01498
     C***********          CALL 'QCMDEXC'                                 S01498
     C***********          PARM           CMD                             S01498
     C***********          PARM           LEN                             S01498
     C*
     C           #BI0      ENDSR
     C/EJECT                                                              SA9101
     C********************************************************************SA9101
     C**                                                                 *SA9101
     C** #BJ         - Research Forward Transactions                     *SA9101
     C**                                                                 *SA9101
     C**                                                                 *SA9101
     C** CALLS       -                                                   *SA9101
     C**                                                                 *SA9101
     C** CALLED BY   - #B                                                *SA9101
     C**                                                                 *SA9101
     C********************************************************************SA9101
     C           #BJ       BEGSR                                          SA9101
     C*                                                                   SA9101
     C                     MOVE '0'       *IN43                           SA9101
     C***********WWCKY2    SETGTCLOANCL2                           SA9101 S01498
     C***********WWCNUM    READECLOANCL2                 43        SA9101 S01498
     C           WWCKY2    SETGTLBLOANL2                                  S01498
     C           WWCNUM    READELBLOANL2                 43               S01498
     C*                                                                   SA9101
     C           *IN43     IFEQ '0'                                       SA9101
     C                     MOVE '1'       *IN41                           SA9101
     C                     ELSE                                           SA9101
     C                     MOVE '0'       *IN43                           SA9101
     C***********WWCKY2    SETGTCLOANCL3                           SA9101 S01498
     C***********WWCNUM    READECLOANCL3                 43        SA9101 S01498
     C           WWCKY2    SETGTLBLOANL3                                  S01498
     C           WWCNUM    READELBLOANL3                 43               S01498
     C*                                                                   SA9101
     C           *IN43     IFEQ '0'                                       SA9101
     C                     MOVE '1'       *IN41                           SA9101
     C                     ELSE                                           SA9101
     C***********          MOVE '0'       *IN43                    SA9101 S01498
     C***********WWCKY2    SETGTFIDEPOLA                           SA9101 S01498
     C***********WWCNUM    READEFIDEPOLA                 43        SA9101 S01498
     C*                                                                   SA9101
     C************IN43     IFEQ '0'                                SA9101 S01498
     C***********          MOVE '1'       *IN41                    SA9101 S01498
     C***********          ELSE                                    SA9101 S01498
     C                     MOVE '0'       *IN43                           SA9101
     C                     Z-ADDBJRDNB    @@DAYN  50                      SA9101
     C                     EXSR ZA0710                                    SA9101
     C***********WWCKY3    SETGTMMDELDL2                           SA9101 S01498
     C***********WWCNUM    READEMMDELDL2                 43        SA9101 S01498
     C           WWCKY3    SETGTLBDELDL2                                  S01498
     C           WWCNUM    READELBDELDL2                 43               S01498
     C*                                                                   SA9101
     C           *IN43     IFEQ '0'                                       SA9101
     C                     MOVE '1'       *IN41                           SA9101
     C                     END                                            SA9101
     C*                                                                   SA9101
     C***********          END                                     SA9101 S01498
     C                     END                                            SA9101
     C                     END                                            SA9101
     C*                                                                   SA9101
     C                     ENDSR                                          SA9101
     C/EJECT                                                              SA9101
     C********************************************************************SA9101
     C**                                                                 *SA9101
     C** #BK         - Display Forward Transactions                      *SA9101
     C**               Call PGM/LB5300                                   *SA9101
     C**                                                                 *SA9101
     C** CALLS       -                                                   *SA9101
     C**                                                                 *SA9101
     C** CALLED BY   - #B                                                *SA9101
     C**                                                                 *SA9101
     C********************************************************************SA9101
     C           #BK       BEGSR                                          SA9101
     C*                                                                   SA9101
     C***********          UNLCKWWLDA                              SA9101 S01498
     C                     UNLCKLDA                                       S01498
     C                     CALL 'LB5300'                                  SA9101
     C                     PARM           BBCUST                          SA9101
     C                     PARM           BBCRNM                          SA9101
     C                     PARM           BBCRTN                          SA9101
     C*                                                                   SA9101
     C************LOCK     IN   WWLDA                              SA9101 S01498
     C           *LOCK     IN   LDA                                       S01498
     C*                                                                   S01498
     C** If database error occured in called program                      S01498
     C*                                                                   S01498
     C           DBASE     IFNE *BLANKS                                   S01498
     C           DBASE     ANDNE'000'                                     S01498
     C                     EXSR #ZA                                       S01498
     C                     END                                            S01498
     C*                                                                   SA9101
     C                     ENDSR                                          SA9101
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BIA        - This subroutine loads the Group Data Area         *
     C**                                                                 *
     C** CALLS       - *NONE                                             *
     C**                                                                 *
     C** CALLED BY   - #BI                                               *
     C**                                                                 *
     C********************************************************************
     C           #BIA      BEGSR
     C                     MOVE ' '       QMRECI
     C                     MOVE BJMRDT    QMRUNA
     C                     Z-ADDBJRDNB    QMRDNB
     C                     MOVE 'T'       QMTVPS
     C                     MOVE BBCUST    QMCNUM
     C                     MOVE BBCRNM    QMCRNM
     C                     MOVE BJCYCD    QMCYCD                          R00266
     C                     MOVE QBCSBY    QMCSBY
     C                     Z-ADDQBBYDP    QMBYDP
     C***********BBCNCZ    CHAINSDCTRYL1             57                   S01498
     C*                                                                   S01498
     C** Get country code details using access object                     S01498
     C*                                                                   S01498
     C                     CALL 'AOCTRYR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BBCNCZ    P@CNCZ  2                       S01498
     C           SDCTRY    PARM SDCTRY    DSFDY                           S01498
     C*                                                                   S01498
     C************IN57     IFEQ '0'                                       S01498
     C***********A4TYLC    ANDNE'D'                                       S01498
     C           P@RTCD    IFEQ *BLANKS                                   S01498
     C                     MOVE A4CNNM    QMNCTX
     C                     ELSE
     C                     MOVE *BLANKS   QMNCTX
     C                     END
     C***********BBCOLC    CHAINSDCTRYL1             57                   S01498
     C*                                                                   S01498
     C** Get country code details using access object                     S01498
     C*                                                                   S01498
     C                     CALL 'AOCTRYR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BBCOLC    P@CNCZ  2                       S01498
     C           SDCTRY    PARM SDCTRY    DSFDY                           S01498
     C*                                                                   S01498
     C************IN57     IFEQ '0'                                       S01498
     C***********A4TYLC    ANDNE'D'                                       S01498
     C***********          MOVE A4CNNM    QMWADT                          R00266
     C           P@RTCD    IFEQ *BLANKS                                   S01498
     C                     MOVE A4CNNM    QMDCTX                          R00266
     C                     ELSE
     C***********          MOVE *BLANKS   QMWADT                          R00266
     C                     MOVE *BLANKS   QMDCTX                          R00266
     C                     END
     C                     MOVE QBLANG    QMLANG
     C*
     C** DATE OF BIRTH
     C***********          Z-ADDQBBDAT    WWDAT1                          086663
     C***********                                                         086663
     C***********WWMON1    IFGT 0                                         086663
     C***********                                                         086663
     C***********          Z-ADDWWMON1    X       20                      086663
     C***********          Z-ADDWWDAY1    WWDAY2                          086663
     C***********          Z-ADDWWYER1    WWYER2                          086663
     C***********          MOVELZMNM,X    WWMON2                          086663
     C***********                                                         086663
     C***********          MOVE WWDAT2    QMBDA1                          086663
     C***********          ELSE                                           086663
     C***********          MOVE *BLANKS   QMBDA1                          086663
     C***********          END                                            086663
     C*                                                                   086663
     C** CASE: DB1.Date of Birth (Portfolio) is Zero                      086663
     C*                                                                   086663
     C           QBBDAT    IFEQ *ZERO                                     086663
     C                     MOVEL*BLANKS   QMBDA1                          086663
     C                     ELSE                                           086663
     C*                                                                   086663
     C** CASE: Check File Date - Rundate  *                               086663
     C*                                                                   086663
     C                     Z-ADDQBBDAT    ZDAYNO  50                      086663
     C                     EXSR ZDATE2                                    086663
     C***********          MOVELZDATE     QMBDA1                    086663092955
     C                     MOVELZADATE    QMBDA1                          092955
     C                     END                             *FI            086663
     C*
     C                     MOVE BBACOC    QMACOC
     C***********BBACOC    CHAINSDACOFL1             60                   S01498
     C************IN60     IFEQ '0'                                       S01498
     C***********AZTYLC    ANDNE'D'                                       S01498
     C*                                                                   S01498
     C** Get account officer details using access object                  S01498
     C*                                                                   S01498
     C                     CALL 'AOACOFR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BBACOC    P@ACOC                          S01498
     C           SDACOF    PARM SDACOF    DSFDY                           S01498
     C*                                                                   S01498
     C           P@RTCD    IFEQ *BLANKS                                   S01498
     C                     MOVE AZACON    QMACON
     C                     ELSE
     C                     MOVE *BLANKS   QMACON
     C                     END
     C*
     C**   Date account officer assumed
     C****                 Z-ADDQBDASS    ZDAYNO                          S01313
     C****                 EXSR ZDATE2                                    S01313
     C****                 MOVE ZADATE    QMDTA1                          S01313
     C*
     C                     MOVE QBSAFI    QMSAFI
     C                     MOVE QBDCMS    QMDCMS
     C****                 MOVE QBFPVC    QMFPVC                          S01313
     C                     MOVE *BLANKS   QMPTF1
     C                     MOVE *BLANKS   QMPTF2
     C                     MOVE *BLANKS   QMPTFN
     C                     MOVE *BLANKS   QMTPMV
     C                     MOVE *BLANKS   QMVPMV
     C***********          MOVE *BLANKS   QMPTA1                          R00266
     C                     MOVE *BLANKS   QMPTAI                          R00266
     C                     MOVE *BLANKS   QMPVAI                          R00266
     C                     MOVE *BLANKS   QMPTCY
     C                     Z-ADD*ZEROS    QMPCDP
     C                     MOVE *BLANKS   QMPTFT
     C                     MOVE *BLANKS   QMDPO1
     C                     MOVE *BLANKS   QMPPDG
     C                     MOVE *BLANKS   QMDSPG
     C                     MOVE *BLANKS   QMNDSP
     C                     MOVE *BLANKS   QMDSPT
     C                     Z-ADD*ZEROS    QMDSPS
     C                     MOVE *BLANKS   QMDGMV
     C                     MOVE *BLANKS   QMDGAI
     C                     MOVE *BLANKS   QMINNR
     C                     MOVE *BLANKS   QMISTN
     C                     Z-ADD*ZEROS    QMITDS
     C                     MOVE *BLANKS   QMTIMV
     C                     MOVE *BLANKS   QMVIMV
     C                     MOVE *BLANKS   QMITAI
     C                     MOVE *BLANKS   QMIVAI                          R00266
     C                     MOVE *BLANKS   QMMODI
     C                     MOVE *BLANKS   QMSESN
     C**********           Z-ADD*ZEROS    QMTRNB                                              CLE148
     C                     MOVEL*BLANKS   QMTRNB                                              CLE148
     C***********          MOVE 'N'       QMENQT                          R00266
     C***********          MOVE 'N'       QMDBER                          R00266
     C                     MOVE *BLANKS   QMENQT                          R00266
     C                     MOVE *BLANKS   QMDBER                          R00266
     C                     MOVE 'N'       QMATTN
     C                     MOVE *BLANKS   QMPGM
     C                     MOVE *BLANKS   QMFILE
     C                     MOVE *BLANKS   QMKEY
     C                     Z-ADD*ZEROS    QMERRN
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZB       - Read Currency file and set up work field WWDICU     *
     C**                                                                 *
     C** CALLS     - #ZA                                                 *
     C**                                                                 *
     C** CALLED BY - #A #BB                                              *
     C**                                                                 *
     C********************************************************************
     C           #ZB       BEGSR                           **  #ZB      **
     C*
     C***********WWCCY     CHAINSDCURRL1             79                   S01498
     C*
     C************IN79     IFEQ '1'                                       S01498
     C***********A6TYLC    OREQ 'D'                        ***************S01498
     C*                                                                   S01498
     C** Get currency details using access object                         S01498
     C*                                                                   S01498
     C                     CALL 'AOCURRR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM WWCCY     P@CCY   3                       S01498
     C           SDCURR    PARM SDCURR    DSSDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDCURRL1'DBFILE           * DBERROR 003 *S01498
     C                     MOVE 'SDCURRPD'DBFILE           * DBERROR 003 *S01498
     C*********************Z-ADD3         DBASE            ***************R0121
     C                     MOVE '003'     DBASE            ***************R0121
     C                     MOVEL'LB0305'  DBPGM
     C                     MOVELWWCCY     DBKEY
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     ELSE
     C                     Z-ADD0         WWDICU  40
     C           A6NBDP    IFEQ 1
     C                     Z-ADD10        WWDICU
     C                     END
     C           A6NBDP    IFEQ 2
     C                     Z-ADD100       WWDICU
     C                     END
     C           A6NBDP    IFEQ 3
     C                     Z-ADD1000      WWDICU
     C                     END
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZA      - Database error handling routine.                     *
     C**                                                                 *
     C** CALLS     - #ZG                                                 *
     C**                                                                 *
     C** CALLED BY - #A #BA #BB #BBA #ZF #ZE #BF #BG #BH #ZB             *
     C**                                                                 *
     C********************************************************************
     C           #ZA       BEGSR                           **  #ZA      **
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     EXSR #ZG
     C*
     C           #ZA0      ENDSR                           **  #ZA0     **
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZD      - Calculate Portfolio Available and convert to customer*
     C**            currency for subfile hidden fields.                  *
     C**                                                                 *
     C** CALLS     - #ZL750 SCONV  #ZC750                                *
     C**                                                                 *
     C** CALLED BY - #BC                                                 *
     C**                                                                 *
     C********************************************************************
     C           #ZD       BEGSR                           **  #ZD      **
     C*
     C** Set up Portfolio Available
     C           WWLIMT    SUB  WWEXPS    WWAVAL 150
     C                     Z-ADDWWAVAL    ZFLD15
     C                     EXSR #ZL750
     C                     MOVE ZOUT21    DD2LBA
     C*
     C** If the customer currency differs from the Portfolio lending
     C** base currency then convert
     C***********CUCCY     IFEQ LBCCY                                     S01498
     C           CUCCY     IFEQ LBCYCD                                    S01498
     C*
     C                     MOVE DD2LBE    DD2CUE
     C                     MOVE DD2LBA    DD2CUA
     C                     MOVE DD2LBL    DD2CUL
     C                     MOVE DD2LBC    DD2CUC
     C                     MOVE DD2LBZ    DD2CUZ                          R0170
     C*
     C                     ELSE
     C*
     C                     Z-ADDWWEXPS    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    ZFLD15
     C                     EXSR #ZC750
     C                     MOVE ZOUT21    DD2CUE
     C*
     C                     Z-ADDWWCOLL    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    ZFLD15
     C                     EXSR #ZC750
     C                     MOVE ZOUT21    DD2CUC
     C*                                                                   R0170
     C           WWEXPO    IFNE *ZERO                                     R0170
     C                     Z-ADDWWEXPO    WWAMTI                          R0170
     C                     EXSR SCONV                                     R0170
     C                     Z-ADDWWAMTO    ZFLD15                          R0170
     C                     EXSR #ZC750                                    R0170
     C                     MOVE ZOUT21    DD2CUZ                          R0170
     C                     ELSE                                           R0170
     C                     MOVE *BLANKS   DD2CUZ                          R0170
     C                     END                                            R0170
     C*
     C           WWLIMT    IFNE *ZERO                                     R0148
     C                     Z-ADDWWLIMT    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    ZFLD15
     C                     EXSR #ZC750
     C                     MOVE ZOUT21    DD2CUL
     C                     ELSE                                           R0148
     C                     MOVE *BLANKS   DD2CUL                          R0148
     C                     END                                            R0148
     C*
     C                     Z-ADDWWAVAL    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    ZFLD15
     C                     EXSR #ZC750
     C                     MOVE ZOUT21    DD2CUA
     C*
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZC         - Move the appropriate values from the hidden       *
     C**               fields to the display field for the subfile       *
     C**               record according to the avail and currency flags. *
     C**                                                                 *
     C** CALLS       - NONE                                              *
     C**                                                                 *
     C** CALLED BY   - #BC #BE                                           *
     C**                                                                 *
     C********************************************************************
     C           #ZC       BEGSR
     C*
     C                     MOVE *BLANKS   DD2OUT
     C                     MOVE *BLANKS   DD2FD4
     C*
     C           WWCUFG    IFEQ 'LB'
     C                     MOVE DD2LBL    DD2FD2                          SA9018
     C                     MOVE DD2LBE    DD2FD1
     C                     MOVE DD2LBC    DD2FD3
     C*                                                                   R0170
     C           DD2LBZ    IFNE *BLANK                                    R0170
     C                     MOVE DD2LBZ    DD2FD4 15                       R0170
     C                     MOVE DD2FD4    DD2CGP                          R0170
     C                     END                                            R0170
     C*
     C                     ELSE
     C*
     C                     MOVE DD2CUL    DD2FD2                          SA9018
     C                     MOVE DD2CUE    DD2FD1
     C                     MOVE DD2CUC    DD2FD3
     C*                                                                   R0170
     C           DD2CUZ    IFNE *BLANK                                    R0170
     C                     MOVE DD2CUZ    DD2FD4                          R0170
     C                     MOVE DD2FD4    DD2CGP                          R0170
     C                     END                                            R0170
     C*                                                                   R0170
     C                     END
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZG         - Termination Processing                            *
     C**                                                                 *
     C** CALLS       - NONE                                              *
     C**                                                                 *
     C** CALLED BY   - Mainline                                          *
     C**                                                                 *
     C********************************************************************
     C           #ZG       BEGSR
     C*
     C** If PM0160 was called during this run of program, then call again
     C** (Portfolio Management Documentation Program)
     C*
     C           WWPMDC    IFEQ 'Y'
     C*
     C***Save*WWLDA*fields*to*restore*DBERROR*after*this*call**********   S01498
     C** Save LDA fields to restore DBERROR after this call               S01498
     C                     MOVE DBFILE    WWDBF2  8
     C                     MOVE DBKEY     WWDBK2 29
     C                     MOVE DBPGM     WWDBP2 10
     C*********************Z-ADDDBASE     WWDBS2  30                      R0121
     C                     MOVE DBASE     WWDBS2  30                      R0121
     C*
     C                     MOVE 'E'       WWPMD1
     C                     MOVE '9'       WWPMD2
     C                     MOVE *BLANKS   WWPMD3
     C                     MOVE 'I'       WWPMD4
     C***********          UNLCKWWLDA                                     S01498
     C                     UNLCKLDA                                       S01498
     C*********************CALL 'PM0160'                                  R0119
     C                     CALL 'PMC0160'                                 R0119
     C                     PARM           WWPMD1
     C                     PARM           WWPMD2
     C                     PARM           WWPMD3
     C                     PARM           WWPMD4
     C*
     C************LOCK     IN   WWLDA                                     S01498
     C           *LOCK     IN   LDA                                       S01498
     C*
     C** If a database error was NOT already detected then check for one
     C** in PM0160 now...
     C           WWDBS2    IFEQ 0
     C*
     C** If database error in PM0160
     C***********DBASE     IFGT 0                                         R0121
     C           DBASE     IFNE *BLANKS                                   R0121
     C           DBASE     ANDNE'000'                                     R0152
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     END
     C*
     C                     ELSE
     C*
     C** Else restore previous DBERROR
     C                     MOVE WWDBF2    DBFILE
     C                     MOVE WWDBK2    DBKEY
     C                     MOVE WWDBP2    DBPGM
     C*********************Z-ADDWWDBS2    DBASE                           R0121
     C                     MOVE WWDBS2    DBASE                           R0121
     C                     END
     C*
     C                     END
     C*                                                                   R01118
     C** IF CALLED FROM PM ENQUIRIES SET ON INDICATOR FOR F3 TO           R01118
     C** TERMINATE ENQUIRIES                                              R01118
     C           WWCALL    IFEQ 'Y'                                       R01118
     C           WWRTCD    ANDNE12                                        R01118
     C*********************MOVEL'Y'       QMDBER                    R01118063335
     C                     MOVEL'Y'       QMENQT                          R01118
     C                     MOVE DBFILE    QMFILE                          R01118
     C                     MOVE DBPGM     QMPGM                           R01118
     C                     MOVE DBKEY     QMKEY                           R01118
     C*********************Z-ADDDBASE     QMERRN                          R01118
     C                     MOVE DBASE     QMERRN                          R01118
     C**                                                                  R01118
     C***UPDATE*GDA************************************************R01118 S01498
     C***********                                                  R01118 S01498
     C***********          CALL 'PMC1002'                          R01118 S01498
     C***********          PARM           WWPGDA                   R01118 S01498
     C*                                                                   S01498
     C** Update DTAARA/*LDA                                               S01498
     C*                                                                   S01498
     C                     CALL 'PMC1001'                                 S01498
     C                     PARM           WWPLDA                          S01498
     C**                                                                  R01118
     C***CALL*PMC1020*TO*TERMINATE*GROUP*JOB***********************R01118 S01498
     C**                                                                  R01118
     C**                                                                  R01118
     C***********          CALL 'PMC1020'                          R01118 S01498
     C**                                                                  R01118
     C                     END                                            R01118
     C*
     C** Now terminate program
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
      /EJECT                                                              SA9101
     F*****************************************************************   SA9101
     F*                                                               *   SA9101
     F*       SUBROUTINE ZA0710 EXPECTS FIELD '@@DAYN' TO BE          *   SA9101
     F*       PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS   *   SA9101
     F*       THAN 1 IT RETURNS 1 IN FIELD '@@RTN'.THE MAIN PROGRAM   *   SA9101
     F*       SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY.   *   SA9101
     F*       IF '@@RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD       *   SA9101
     F*       '@@VDT'  IN 'YYYYMMDD' FORMAT.                          *   SA9101
     F*                                                               *   SA9101
     F* NOTE: FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS              *   SA9101
     F*                                                               *   SA9101
     F*       1) @@DAYN   LENGTH 5,0.                                 *   SA9101
     F*                                                               *   SA9101
     F*       FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:     *   SA9101
     F*                                                               *   SA9101
     F*       1) @@VDT    LENGTH 8,0 DEFINED BY A DS.                 *   SA9101
     F*       2) @@RTN    LENGTH 1,0.                                 *   SA9101
     F*       3) @@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD         *   SA9101
     F*       4) @@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD         *   SA9101
     F*       5) @@Z71Y   LENGTH 4,0 DEFINED BY A DS.                 *   SA9101
     F*       6) @@RDAY   LENGTH 5,0.                                 *   SA9101
     F*       7) @@LEAP   LENGTH 1,0.                                 *   SA9101
     F*                                                               *   SA9101
     F*       INDICATORS USED ARE:                                    *   SA9101
     F*                                                               *   SA9101
     F*       1) 80       CHECK FOR LOW AND EQUAL ON ARRAY @YD        *   SA9101
     F*       2) 81       CHECK FOR LOW ON ARRAY @MD.                 *   SA9101
     F*                                                               *   SA9101
     F* INPUT FIELD:       @@DAYN                                     *   SA9101
     F*                                                               *   SA9101
     F* OUTPUT FIELD:      @@VDT                                      *   SA9101
     F*                                                               *   SA9101
     F* WORK FIELDS:       @@RTN                                      *   SA9101
     F*                    @@Z71Y                                     *   SA9101
     F*                    @@RDAY                                     *   SA9101
     F*                    @@LEAP                                     *   SA9101
     F*                    @@I                                        *   SA9101
     F*                    @@J                                        *   SA9101
     F*                                                               *   SA9101
     F* ARRAYS USED:       @YD COMPILE TIME ARRAY.                    *   SA9101
     F*                    @MD COMPILE TIME ARRAY.                    *   SA9101
     F*                                                               *   SA9101
     F*****************************************************************   SA9101
     C*                                                                   SA9101
     C           ZA0710    BEGSR                                          SA9101
     C*                                                                   SA9101
     C                     SETOF                     8081                 SA9101
     C                     Z-ADD0         @@RTN   10                      SA9101
     C                     Z-ADD0         @@VDT                           SA9101
     C                     Z-ADD1         @@I     20                      SA9101
     C                     Z-ADD1         @@J     20                      SA9101
     C                     Z-ADD1         @@LEAP  10                      SA9101
     C*                                                                   SA9101
     C           @@DAYN    IFLT 1                                         SA9101
     C                     Z-ADD1         @@RTN                           SA9101
     C                     GOTO ZA0719                                    SA9101
     C                     END                                            SA9101
     C*                                                                   SA9101
     C* DIVISION TO DETERMINE WETHER LEAP YEAR.                           SA9101
     C*                                                                   SA9101
     C           @@DAYN    DIV  1461      @@Z71Y                          SA9101
     C                     MVR            @@RDAY  50                      SA9101
     C*                                                                   SA9101
     C* CALCULATING YEAR.                                                 SA9101
     C*                                                                   SA9101
     C           @@Z71Y    MULT 4         @@Z71Y                          SA9101
     C                     ADD  1972      @@Z71Y                          SA9101
     C*                                                                   SA9101
     C* CHECKING IF YEAR IS GREATER THAN OR EQUAL TO 2100                 SA9101
     C*                                                                   SA9101
     C           @@Z71Y    IFGE 2100                                      SA9101
     C                     ADD  @@SSY2    @@RDAY                          SA9101
     C                     END                                            SA9101
     C*                                                                   SA9101
     C* LOKUP ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE        SA9101
     C* HAVE PASSED.                                                      SA9101
     C*                                                                   SA9101
     C           @@RDAY    LOKUP@YD,@@I                8080               SA9101
     C*                                                                   SA9101
     C* IF YEAR IS A LEAP YEAR SSLEAP IS SET TO ZERO.                     SA9101
     C*                                                                   SA9101
     C           *IN80     IFEQ '0'                                       SA9101
     C                     Z-ADD0         @@LEAP                          SA9101
     C                     END                                            SA9101
     C*                                                                   SA9101
     C* ADD INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.       SA9101
     C*                                                                   SA9101
     C           @@LEAP    IFEQ 1                                         SA9101
     C           @@RDAY    SUB  @YD,@@I   @@RDAY                          SA9101
     C                     ADD  @@I       @@Z71Y                          SA9101
     C                     END                                            SA9101
     C*                                                                   SA9101
     C* PROCESSING FOR A LEAP YEAR.                                       SA9101
     C*                                                                   SA9101
     C           @@LEAP    IFEQ 0                                         SA9101
     C*                                                                   SA9101
     C* IF '@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.                   SA9101
     C*                                                                   SA9101
     C           @@RDAY    IFEQ 60                                        SA9101
     C                     Z-ADD29        @@Z71D                          SA9101
     C                     Z-ADD2         @@Z71M                          SA9101
     C                     GOTO ZA0711                                    SA9101
     C                     END                                            SA9101
     C*                                                                   SA9101
     C* IF '@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN    SA9101
     C* PROCEED AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP     SA9101
     C* YEAR. NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.          SA9101
     C*                                                                   SA9101
     C           @@RDAY    IFGT 60                                        SA9101
     C           @@RDAY    SUB  1         @@RDAY                          SA9101
     C                     END                                            SA9101
     C*                                                                   SA9101
     C                     END                                            SA9101
     C*                                                                   SA9101
     C* IF DAY '@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS      SA9101
     C* IN 4 YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR      SA9101
     C* GROUP.                                                            SA9101
     C*                                                                   SA9101
     C           @@RDAY    IFEQ 0                                         SA9101
     C                     Z-ADD31        @@Z71D                          SA9101
     C                     Z-ADD12        @@Z71M                          SA9101
     C                     SUB  1         @@Z71Y                          SA9101
     C                     GOTO ZA0711                                    SA9101
     C                     END                                            SA9101
     C*                                                                   SA9101
     C* LOOK UP ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'         SA9101
     C* OCCURS IN                                                         SA9101
     C*                                                                   SA9101
     C           @@RDAY    LOKUP@MD,@@J                81                 SA9101
     C                     Z-ADD@@J       @@Z71M                          SA9101
     C           @@RDAY    SUB  @MD,@@J   @@Z71D                          SA9101
     C*                                                                   SA9101
     C* DS @@VDT  IS RETURNED IN YYYYMMDD FORMAT                          SA9101
     C*                                                                   SA9101
     C           ZA0711    TAG                                            SA9101
     C*                                                                   SA9101
     C                     MOVE @@Z71Y    @@YR                            SA9101
     C*                                                                   SA9101
     C           ZA0719    ENDSR                                          SA9101
     C*****************************************************************   SA9101
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** *PSSR       - This subroutine processes a program file error    *
     C**                                                                 *
     C** CALLS       - *NONE                                             *
     C**                                                                 *
     C** CALLED BY   - *NONE                                             *
     C**                                                                 *
     C********************************************************************
     C           *PSSR     BEGSR
     C*
     C                     DUMP
     C*
     C                     ENDSR
     C/EJECT
      *                                                                   S01498
      ** Array ARR physically removed from compile-time array             S01498
      *                                                                   S01498
** CPY@
(c) Misys International Banking Systems Ltd. 2001
** Array of powers of 10 for currency conversion S/R SCONV
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** ALPHU - Array of alphanumerics A-Z, BLANK & 0-9
ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZA0710 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZA0710 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
