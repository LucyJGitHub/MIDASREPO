     H        1                                                           S01498
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LB Portfolio Lending Analysis')                  *
     H***********                                                         S01498
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Lending Module                             *
     F*                                                               *
     F*  LB0310 - Portfolio Lending Analysis                          *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *  Prev Amend No. CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 TDA035             Date 02Apr04               *
      *                 CAAA03             Date 25Mar04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CGL008             Date 03Mar99               *
      *                 072467             Date 14Oct96               *
     F*                 CPM005             Date 14Oct96               *
     F*                 092955             DATE 13SEP95               *
     F*                 087631             DATE 05SEP95               *
     F*                 086664             DATE 20MAR95               *
     F*                 086663             DATE 20MAR95               *
     F*                 085817             DATE 13MAR95               *
     F*                 081239             DATE 02FEB95               *
     F*                 083547             DATE 20FEB95               *
     F*                 S01498             DATE 11AUG94               *
     F*                 066235             DATE 27JAN93               *
     F*                 049421             DATE 19JAN93               *
     F*                 S01313             DATE 27AUG92               *
     F*                 38049              DATE 18DEC91               *
     F*                 33503              DATE 18DEC91               *
     F*                 B10575             DATE 23OCT91               *
     F*                 B10530             DATE 21OCT91               *
     F*                 B10527             DATE 21OCT91               *
     F*                 B10526             DATE 21OCT91               *
     F*                 B8149              DATE 26SEP91               *
     F*                 B7838              DATE 26SEP91               *
     F*                 B7825              DATE 26SEP91               *
     F*                 B9492              DATE 24SEP91               *
     F*                 B9415              DATE 24SEP91               *
     F*                 SA9109             DATE 05AUG91               *
     F*                 R5735              DATE 25MAR91               *
     F*                 R5702              DATE 19MAR91               *
     F*                 R5649              DATE 11MAR91               *
     F*                 R5545              DATE 21FEB91               *
     F*                 R5514              DATE 21FEB91               *
     F*                 R5504              DATE 20FEB91               *
     F*                 R0191              DATE 19FEB91               *
     F*                 R0170              DATE 15FEB91               *
     F*                 R0169              DATE 14FEB91               *
     F*                 R0121              DATE 08FEB91               *
     F*                 R0119              DATE 08FEB91               *
     F*                 R0064              DATE 30JAN91               *
     F*                 R01293             DATE 02JAN90               *
     F*                 R01118             DATE 04DEC90               *
     F*                 SA9018             DATE 03DEC90               *
     F*                 REMOVE R0675       DATE 28NOV90               *
     F*                 R0729              DATE 15NOV90               *
     F*                 R00300             DATE 06NOV90               *
     F*                 R0675              DATE 31OCT90               *
     F*                 R0673              DATE 31OCT90               *
     F*                 R0598              DATE 29OCT90               *
     F*                 R0594              DATE 29OCT90               *
     F*                 R00300             DATE 20AUG90               *
     F*                 R00266             DATE 07AUG90               *
     F*                 LB0007             DATE 28JUN90               *
     F*                 LB0002             DATE 19JUN90               *
     F*                 LB0001             DATE 05JUN90               *
     F*                 LB0000             DATE 29MAY90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CLE148 - Alpha Loan Reference                                *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CAAA03 - Webfacing Changes                                   *
      *         - F12 key functioning correctly                       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGL008 - Security on Journal Entry. Recompile.               *
     F*  072467 - ARRAY INDEX ERROR                                   *
     F*  CPM005 - Private Banking Phase 2                             *
     F*           Focus Group Changes upgraded to DBA                 *
     F*           Recompiled due to changes in PMLDAPD                *
     F*  092955 - Complete 086663 to output birth date as 7A          *
     F*  087631 - Should only use Precious Metal limits if S01433,    *
     F*           Extended Dealing Limits switchable feature is on.   *
     F*  086664 - Format branch code for call of PM0630               *
     F*  086663 - Correct formatting of date of birth                 *
     F*  085817 - Recompile due to changes in PMLDAPD                 *
     F*  081239 - R10 Private Banking Rework.                         *
     F*  083547 - Correcting Account Officer name on MUSERDD          *
     F*  S01498 - Portfolio Lending Upgrade to Release 10             *
     F*  066235 - Recompile program due to changes in DSPF            *
     F*  049421 - HEADER BOX STANDARDISATION                          *
     F*  S01313 - PORTFOLIO PERFORMANCE CHANGES                       *
     F*  38049  - WRONG POSITION USED                                 *
     F*  33503  - PORTFOLIO LENDING EXTENDED MARGIN IS SWITCHABLE NOW *
     F*  B10575 - INVALID CALC. AVAIL. FOREX (SEE FS 3146/0.7PAGE 41) *
     F*  B10530 - FX MARGIN PERCENTAGE NOT DISPLAYED                  *
     F*  B10527 - LIMIT/EXPOSURE INCORRECTLY CONVERTED                *
     F*  B10526 - INVALID CONVERSION FOR DEALING LIMITS               *
     F*  B8149  - MARGIN PERCENTAGE WAS NOT DISPLAYED IF A            *
     F*           SHORTNAME WAS ENTERED                               *
     F*  B7838  - DON'T DISPLAY AVAILABLE FX IF NO LIMIT              *
     F*  B7825  - UPDATE B5940 FIX                                    *
     F*  B9492  - INDEX ERROR ON POWER TABLE IF NUMBER OF             *
     F*           DECIMAL PLACES IS 0                                 *
     F*  B9415  - DB ERROR AFTER CALL OF DOCUMENTATION SCREEN         *
     F*  SA9109 - MARGIN PERCENTAGE BY CUSTOMER                       *
     F*           ( INCLUDING FIXES B5940 AND B7825 - LEUMI )         *
     F*  R5735  - AVAIL FX / PM TO ZERO CANNOT BE MORE THAN           *
     F*           LIMIT LESS EXPOSURE                                 *
     F*  R5702  - SET AVAIL FX / PM TO ZERO IF NO LIMIT ENTERED       *
     F*           AND LIMITS ARE USED                                 *
     F*  R5649  - EXCLUDE MARGIN FROM CUSTOMER EQUITY CALCS.          *
     F*  R5545  - AVAILABLE BORROWING WRONGLY CALCULATED              *
     F*  R5514  - LB0305 CALLED WITH A MISSING PARAMETER              *
     F*  R5504  - FX & PM AVAILABLE INVALID                           *
     F*  R0191  - AVAILABLE METAL FIGURE INCORRECT                    *
     F*  R0170  - To display FX and pM exposures                      *
     F*  R0169  - Display limits instead of lines                     *
     F*  R0121  - Dbase error occured because invalid data in         *
     F*           Dbase field (Value greater than 0) even if          *
     F*           no error occured.                                   *
     F*           DBASE Changed from numeric to alpha to avoid        *
     F*           insertion of blanks that caused the error.          *
     F*           -  Misfunction of Command key 23 when pressed       *
     F*              from LB0310.                                     *
     F*  R0119  - Call CL Program before calling Customer             *
     F*           Documentation.                                      *
     F*  R0064  - Lines displayed in LB analysis for FX & PM are      *
     F*           incorrect.                                          *
     F*  R01293 - The name of the input field for last change type    *
     F*           was not correct                                     *
     F*  R01118 - PORTFOLIO details called from Portfolio Management  *
     F*  SA9018 - PORTFOLIO LENDING LIMITS                            *
     F*  R0729  - DISPLAY PRECIOUS METALS NEW VALUES                  *
     F*  R00300 - Message file changes                                *
     F*  R0675  - WHEN YOU PRESS ENTER LE PGM TRY TO COME BACK TO     *
     F*           PORTFOLIO ENQUIRY.                                  *
     F*  R0673  - FOR RECEIVER OF PLEDGE, MARK THE AVAILABLE BORROWING*
     F*           WITH AN "*" TO SHOW THAT HE CAN BORROW MORE TO BE   *
     F*           DONE.                                               *
     F*           -FOR GIVES OF PLEDGE MARK THE PLEDGE EXPOSURE WITH  *
     F*            AN "*" IF HE HAS GIVEN PLEDGES WHICH HAVE NOT GET  *
     F*            BEEN USED.                                         *
     F*  R0598  - THE PORTFOLIO LENDING ENQUIRY MUST SHOWED ONLY      *
     F*           THE CUSTOMER PORTFOLIO.                             *
     F*  R0594  - RECOMPILE FOR PROBLEM WITH EXTERNAL DESCRIPTION     *
     F*           OF DATA AREA "*LDA".                                *
     F*  R00266 - SETUP CORRECT FIELDS ON DATA AREA PMLDAPP.          *
     F*  LB0007 - INCLUDE CALCULATION OF FOREX LINE FROM MARGIN       *
     F*  LB0002 - TOTAL BORROWING POWER =                             *
     F*           LENDING POWER + USE OF PLEDGES RECEIVED             *
     F*  LB0001 - CALL PORTFOLIO ENQUIRY                              *
     F*  LB0000 - AVAILABLE BORROWING/LENDING LESS THAN ZERO          *
     F*  LB0000 - LBEXTSPD IS EMPTY                                   *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     F**
     F**      FILE DEFINITIONS
     F**     ------------------
     F*                                                                   SA9109
     F*****CLIENT*EXTENSION*FILE*********PREFIX*-*LB************   SA9109 S01498
     F***SDLBCSX0IF**E           K        DISK         KINFSR *PSSRSA9109 S01498
     F*
     F**   CLIENT MASTER LOGICAL VIEW 0. PREFIX - BB & CU
     F***SDLBCSL0IF**E           K        DISK         KINFSR *PSSR       S01498
     FLBLBCSJ0IF  E           K        DISK         KINFSR *PSSR          S01498
     F*
     F**   CLIENT MASTER LOGICAL VIEW 5. PREFIX - BB & CU
     F***SDLBCSL5IF**E           K        DISK         KINFSR *PSSR       S01498
     FLBLBCSJ5IF  E           K        DISK         KINFSR *PSSR          S01498
     F            SDLBCSJ0                          KRENAMESDLBCSR1
     F*
     F***Modules*Installed*.*Prefix*-*BG*******************************   S01498
     F*SDMMODPDIF  E           K        DISK         KINFSR *PSSR         R01118
     F***SDMMODPDIF**E                    DISK         KINFSR *PSSRR01118 S01498
     F*
     F*****ACCOUNT*OFFICERS*FILE.*PREFIX*-*AZ**************************   S01498
     F***SDACOFL1IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F***Country*Details.*Prefix*-*A4**********************************   S01498
     F***SDCTRYL1IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F***Midas*User*Definition.*Prefix*-*NONE**************************   S01498
     F***MUSER***IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F*****PORTFOLIO*LENDING*INSTALLATION*CONTROL*DATA.*PREFIX*-*LB****   S01498
     F***SDLOMBPDIF**E                    DISK         KINFSR *PSSR       S01498
     F*                                                                   SA9018
     F*****PORTFOLIO*LENDING*ICD*EXTENDED*FILE.*PREFIX*-*LB******* SA9018 S01498
     F***SDLOMBX0IF**E                    DISK         KINFSR *PSSRSA9018 S01498
     F************SDLOMBD0                          KRENAMELOMBX0  SA9018 S01498
     F*                                                                   B10526
     F*****DEALING*I.C.D.*PREFIX*-*BN******************************B10526 S01498
     F***SDDEALPDIF**E                    DISK         KINFSR *PSSRB10526 S01498
     F*
     F*****CURRENCY*CODES.*PREFIX*-*A6*********************************   S01498
     F***SDCURRL1IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F**   COMMITMENT LINE AUTHORISATION. PREFIX - CA
     FLBCOMAL2IF  E           K        DISK         KINFSR *PSSR
     F*
     F**   PORTFOLIO LENDING EXTRACT SUMMARY. PREFIX - ES
     FLBEXTSL1IF  E           K        DISK         KINFSR *PSSR
     F*
     F**   PORTFOLIO LENDING EXTRACT DETAILS. PREFIX - EE
     FLBEXTRL2IF  E           K        DISK         KINFSR *PSSR
     F*
     F*****BANK*DETAILS.*PREFIX*-*BJ***********************************   S01498
     F***SDBANKPDIF**E                    DISK         KINFSR *PSSR       S01498
     F*
     F**   SCREEN FORMAT
     FLB0310DFCF  E                    WORKSTN      KINFSR *PSSR
     F*
     F***Portfolio*Management*Customer*Details.*Prefix*-*QB************   S01498
     F***SDPLCSL0IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F***Portfolio*Management*I.C.D.*Prefix*-*P9***********************   S01498
     F***SDPORTPDIF**E                    DISK         KINFSR *PSSR       S01498
     F*                                                                   R0064
     F***Customer*limit*details************************************R0064  S01498
     F***LIMITJB0IF**E           K        DISK         KINFSR *PSSRR0064  S01498
     F*
     F*
     F********************************************************************
     F/EJECT
     F********************************************************************
     F**                                                                 *
     F** ID F  C  H  L    FUNCTION OF INDICATORS                         *
     F**                 ------------------------                        *
     F** 26 - END OF MESSAGE SUBFILE                                     *
     F**    40 - PORTFOLIO MANAGEMENT INSTALLED                          *
     F*     41 - ENHANCED DEALING LIMITS SWITCHABLE FEATURE ON           *087631
     F******44*-*FILE*INDICATOR*ON*MUSER*******************************  *S01498
     F******45*-*FILE*INDICATOR*ON*SDCTRYL1****************************  *S01498
     F******46*-*FILE*INDICATOR*ON*SDMMODPD****************************  *S01498
     F******47*-*FILE*INDICATOR*ON*SDPLCSL0****************************  *S01498
     F******48*-*FILE*INDICATOR*ON*SDPORTPD****************************  *S01498
     F**    49 - LOOK-UP INDICATOR                                       *
     F******50*-*FILE*INDICATOR*ON*SDBANKPD****************************  *S01498
     F******51*}*FILE*INDICATOR*ON*SDLBCSL0****************************  *S01498
     F**    51 } FILE INDICATOR ON LBLBCSJ0                              *S01498
     F**    52 }                                                         *
     F******53*-*FILE*INDICATOR*ON*SDLBCSL5****************************  *S01498
     F**    53 - FILE INDICATOR ON LBLBCSJ5                              *S01498
     F******54*-*FILE*INDICATOR*ON*SDACOFL1****************************  *S01498
     F******55*-*FILE*INDICATOR*ON*SDLOMBPD****************************  *S01498
     F******55*-*FILE*INDICATOR*ON*SDLOMBX0************************SA9018 S01498
     F**    56 - FILE INDICATOR ON LBCOMAL2                              *
     F**    57 - FILE INDICATOR ON LBEXTSL1                              *
     F**    58 - FILE INDICATOR ON LBEXTRL2                              *
     F**    59 - READ INDICATOR ON LB0310F1                              *
     F**       60 - SECOND SCREEN DISPLAYED                              *
     F**       61 - AVAILABLE BORROWING INCREASE BY RECEIVE OF PLEDGE    *R0673
     F**       62 - IF HE HAS GIVEN PLEDGES WHICH HAVE NOT GET BEEN USED *R0673
     F**       65 - 'NOTES' & 'NEXT REVIEW DATE' DISPLAY CONTROL         *
     F**          70 - ERROR INDICATOR                                   *
     F**          71 - 'INVALID' INDICATOR                               *
     F**             90 - USED IN DISPLAY FILE SO THAT ROLLUP/DOWN       *
     F**                  INDICATORS SET THEMSELVES OFF IF NOT USED      *
     F**             98 - DATE FORMAT INDICATOR                          *
     F***************99*-*FILE*ERROR*INDICATOR*************************  *S01498
     F********************************************************************
     F/EJECT
     E********************************************************************
     E*
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*
     E** ARRAY USED IN DATE CONVERSION
     E/COPY ZSRSRC,ZDATE2Z1
     E*
     E** Array of powers of 10 for S/R SCONV
     E                    POWER   1   7  7 3
     E*
     E** ARRAY OF ALPHANUMERICS
     E                    ALPNU  37  37  1
     E*
     E** ARRAY OF NUMBERS
     E**********          NUM    10  10  1                                                    CSD027
     E*
     E** ARRAY TO SPLIT CUSTOMER FIELD INTO INDIVIDUAL CHARACTERS
     E                    CUS        10  1
     E*
     E***Array*of*COMMANDS*********************************************   S01498
     E********************ARR     1   2 80                                S01498
     E*
     E** ARRAYS USED IN CONVERSION OF DECIMAL AMOUNTS TO CHARACTER
     E/COPY ZSRSRC,ZSEDITZ1
     E********************************************************************
     E/EJECT
     I********************************************************************
     I*
     I** DATA STRUCTURE FOR COMPILATION - COPYRIGHT INSERTION
     ICPYR@$      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@$$
     I*
     I** PROGRAM STATUS DATA STRUCTURE
     IPSDS       SDS
     I**************************************244 253 DDWID                 S01498
     I**************************************254 263 USER                  S01498
     I                                      244 253 SWSID                 S01498
     I                                      254 263 SUSER                 S01498
     I*
     I***DTAR*******UDS***********************     256                    S01498
     I*
     I**  LOCAL DATA AREA FOR DATA BASE ERRORS
     ILDA         DS                            256                       S01498
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I**************************************181 1830DBASE                 R0121
     I                                      181 183 DBASE                 R0121
      **Data*area*LZSTAT***************************************    33503  S01498
     I***LZSTAT******DS***********************     256             33503  S01498
     I***************************************15  15 LBIC           33503  38049
     I***************************************21  21 LBIC           38049  S01498
     I*
     I****DATA*STRUCTURE*USED*TO*DEFINE*THE*GROUP*DATA*AREA************   S01498
     I***WWPARM    E DSPMGDA
     I***WWPGDA****E*DSPMGRDAPP***************                            S01498
     I*
     I*****DATA*STRUCTURE*TO*DEFINE*THE*LOCAL*DATA*AREA*FOR*GROUP*JOBS*   S01498
     I***WWPLDA****E*DSPMLDAPP****************                            S01498
     I*                                                                   S01498
     I** Data structure to define DTAARA/*LDA                             S01498
     IWWPLDA    E DSPMLDAPD                                               S01498
     I*
     I**  DATA STRUCTURE TO SPLIT CUS NO./SHORT NAME FIELD
     I            DS
     I                                        1  10 WWSCNS
     I                                        1  10 CUS
     I                                        1   1 WWCHR1
     I                                        7  10 WWEND4
     I*
     I** DATA STRUCTURE FOR DATE OF BIRTH (READ FROM SDPLCSL0)
     I            DS
     I                                        1   60WWDAT1
     I                                        1   20WWDAY1
     I                                        3   40WWMON1
     I                                        5   60WWYER1
     I**
     I** DATA STRUCTURE FOR DATE OF BIRTH (CONVERTED AS PARAMETER)
     I**
     I            DS
     I                                        1   7 WWDAT2
     I                                        1   20WWDAY2
     I                                        3   5 WWMON2
     I                                        6   70WWYER2
     I*
     I**
     I/COPY ZSRSRC,ZSEDITZ2
     I*                                                                   S01498
     ISDBANK    E DSSDBANKPD                                              S01498
     I**  Data structure for bank details                                 S01498
     I*                                                                   S01498
     ISDLOMB    E DSSDLOMBPD                                              S01498
     I**  Data structure for Portfolio Lending ICD                        S01498
     I*                                                                   S01498
     ISDCURR    E DSSDCURRPD                                              S01498
     I**  Data structure for currency details                             S01498
     I*                                                                   S01498
     ISDACOF    E DSSDACOFPD                                              S01498
     I**  Data structure for account officer details                      S01498
     I*                                                                   S01498
     ISDMMOD    E DSSDMMODPD                                              S01498
     I**  Data structure for Midas modules details                        S01498
     I*                                                                   S01498
     ISDPLCS    E DSSDPLCSPD                                              S01498
     I**  Data structure for Portfolio Management customer details        S01498
     I*                                                                   S01498
     ISDPORT    E DSSDPORTPD                                              S01498
     I**  Data structure for Portfolio Management ICD                     S01498
     I*                                                                   S01498
     ISDCTRY    E DSSDCTRYPD                                              S01498
     I**  Data structure for country code details                         S01498
     I*                                                                   S01498
     ISDUSER    E DSMUSERDD                                               S01498
     I**  Data structure for user details                                 S01498
     I*                                                                   S01498
     ISDDEAL    E DSSDDEALPD                                              S01498
     I**  Data structure for Dealing ICD                                  S01498
     I*                                                                   S01498
     ISDLBCS    E DSSDLBCSPD                                              S01498
     I**  Data structure for Portfolio Lending Customer Details           S01498
     I*                                                                   S01498
     ISDCLLM    E DSSDCLLMPD                                              S01498
     I**  Data structure for Customer Limits                              S01498
     I*                                                                   S01498
     ISCSARD    E DSSCSARDPD                                              087631
     I              LCD                             SCLCD                 087631
     I**  Data structure for SWITCHABLE FEATURES FILE                     087631
     I*                                                                   087631
     IDSFDY     E DSDSFDY                                                 S01498
     I**  Short data structure for access objects                         S01498
     I*                                                                   S01498
     IDSSDY     E DSDSSDY                                                 S01498
     I**  Long data structure for access programs                         S01498
     I*
     I********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C           *ENTRY    PLIST
     C                     PARM           WWMNUF  1
     C**********           PARM           WWCUSR  60                                          CSD027
     C                     PARM           WWCUSR  6                                           CSD027
     C                     PARM           WWFNCT  20
     C                     PARM           WWUSRP 10
     C                     PARM           WWCHCK  1                       R0121
     C*                                                                   S01498
     C**  Copyright statement                                             S01498
     C*                                                                   S01498
     C                     MOVEACPY@      ACT@   80                       S01498
     C*
     C************NAMVAR   DEFN LDA       DTAR                            S01498
     C           *NAMVAR   DEFN           LDA                             S01498
     C************NAMVAR   DEFN           LZSTAT                   33503  S01498
     C***********          IN   LZSTAT                             33503  S01498
     C*
     C**   KEY LISTS FOR FILE CHAINING
     C*
     C**   CUSTOMER NUMBER KEY LIST 1
     C           WWCKY1    KLIST
     C                     KFLD           WWCUST
     C                     KFLD           LBFXUP
     C*
     C**   CUSTOMER NUMBER KEY LIST 2
     C           WWCKY2    KLIST
     C                     KFLD           WWCUST
     C                     KFLD           LBFXUL
     C*
     C**   CUSTOMER NUMBER KEY LIST 3
     C           WWCKY3    KLIST
     C                     KFLD           WWCUST
     C                     KFLD           LBFXMA
     C*                                                                   R0729
     C**   CUSTOMER NUMBER KEY LIST 4                                     R0729
     C           WWCKY4    KLIST                                          R0729
     C                     KFLD           WWCUST                          R0729
     C                     KFLD           LBPMUP                          R0729
     C*                                                                   R0729
     C**   CUSTOMER NUMBER KEY LIST 5                                     R0729
     C           WWCKY5    KLIST                                          R0729
     C                     KFLD           WWCUST                          R0729
     C                     KFLD           LBPMUL                          R0729
     C*                                                                   R0729
     C**   CUSTOMER NUMBER KEY LIST 6                                     R0729
     C           WWCKY6    KLIST                                          R0729
     C                     KFLD           WWCUST                          R0729
     C                     KFLD           LBPMMA                          R0729
     C*                                                                   SA9018
     C**   CUSTOMER NUMBER KEY LIST 7                                     SA9018
     C           WWCKY7    KLIST                                          SA9018
     C                     KFLD           WWCUST                          SA9018
     C                     KFLD           @OINST  3                       SA9018
     C*
     C**   LBCOMAL2 KEY LIST
     C           WWCOMA    KLIST
     C                     KFLD           WWCUST
     C                     KFLD           BJRDNB
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C**              START MAINLINE
     C**             ----------------
     C*
     C**   INITIALISATION
     C                     EXSR #A
     C*
     C**   MAIN PROCESSING
     C           *INKC     DOWEQ'0'
     C*
     C                     MOVEL*BLANKS   DD1CSN
     C                     EXSR #B
     C                     MOVE '1'       *IN71
     C*
     C                     END
     C*
     C**   TERMINATE PROGRAM
     C                     EXSR #ZAA
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**          INDEX TO SUBROUTINES                                   *
     C**         ----------------------                                  *
     C**                                                                 *
     C**   1.  #B     - MAIN PROCESSING                                  *
     C**   2.  #BA    - VALIDATION OF CUSTOMER NUMBER/SHORT NAME         *
     C**   3.  #A     - INITIALISATION                                   *
     C**   4.  #BB    - CUSTOMER NUMBER PROCESSING                       *
     C**   5.  #BBA   - PARENT & ORPHAN/CHILD PROCESSING                 *
     C**   6.  #BBB   - MAIN CURRENCY CONVERSION                         *
     C**   7.  #BC    - CMD11 PROCESSING                                 *
     C**   8.  #BD    - CMD12 PROCESSING                                 *
     C**   9.  #BBBA  - CURRENCY CONVERSION PROCESSING                   *
     C**  10.  #BE    - CMD23 PROCESSING                                 *
     C**  11.  #BEA   - LOAD GROUP DATS AREA                             *
     C**  12.  #BF    - CMD24 PROCESSING                                 *
     C**  20.  #BG    - PORTFOLIO LENDING ENQUIRY PROCESSING             *
     C**  13.  #ZA    - DATABASE ERROR PROCESSING                        *
     C**  14.  #ZAA   - TERMINATION PROCESSING                           *
     C**  15.  ZASNMS - CLEAR MESSAGE SUBFILE                            *
     C**  16.  #PSSR  - ERROR HANDLING SUBROUTINE                        *
     C**  17.  ZSEDIT - DECIMAL TO CHARACTER CONVERSION                  *
     C**  18.  SCONV  - CONVERT CURRENCY                                 *
     C**  19.  ZDATE2 - CONVERT A 5-FIGURE DAY NUMBER INTO DATE FORMAT   *
     C**                                                                 *
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #B        - MAIN PROCESSING                                     *
     C**                                                                 *
     C** CALLS     - #BA, #BB, #BC, #BD, #BE, #BF, #BG, #ZA              *
     C**                                                                 *
     C** CALLED BY - MAINLINE                                            *
     C**                                                                 *
     C********************************************************************
     C           #B        BEGSR
     C*
     C           WWMNUF    IFEQ '0'
     C*
     C** WHILE NOT END REQUESTED AND INVALID DATA
     C           *INKC     DOWEQ'0'
     C           *IN71     ANDEQ'1'
     C*
     C**  DISPLAY SELECTION SCREEN
     C                     WRITELB0310F1
     C*
     C**  IF ERROR, WRITE MESSAGE SUBFILE
     C           *IN70     IFEQ '1'
     C                     WRITELB0310C3
     C                     END
     C*
     C**  READ SELECTION SCREEN
     C                     READ LB0310F1                 59
     C*
     C** IF NOT END REQUESTED
     C** PROCESS HELP OR ENTER AS NECESSARY
     C           *INKC     IFEQ '0'
     C*
     C                     EXSR #BA
     C                     END
     C*
     C**   IF VALID DATA GET DETAILS AS NECESSARY
     C           *IN71     IFEQ '0'
     C*
     C                     Z-ADD0         WWFNC1  20
     C*
     C           *IN52     IFEQ '0'
     C           DD1CSN    OREQ *BLANKS
     C*
     C***********          UNLCKDTAR                                      S01498
     C                     UNLCKLDA                                       S01498
     C*
     C                     CALL 'LB0315'
     C                     PARM           WWFLAG
     C                     PARM           DD1CSN
     C                     PARM           WWFNC1
     C                     PARM           WWCNUM
     C*
     C************LOCK     IN   DTAR                                      S01498
     C           *LOCK     IN   LDA                                       S01498
     C*
     C***********DBASE     IFGT 0                                         R0121
     C           DBASE     IFNE *BLANKS                                   R0121
     C           DBASE     ANDNE'000'                                     B9415
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ELSE
     C                     MOVEL'LB0310'  DBPGM
     C                     END
     C*
     C           WWFNC1    IFEQ 3
     C                     MOVE '1'       *INKC
     C                     ELSE
     C*
     C           WWFNC1    IFEQ 12
     C********** WWCNUM    OREQ *ZERO                                                         CSD027
     C           WWCNUM    OREQ *BLANKS                                                       CSD027
     C*
     C                     MOVE '1'       *IN71
     C                     MOVE *BLANKS   DD1CSN                          LB0000
     C                     ELSE
     C                     MOVELWWCNUM    WWSCNS
     C                     MOVELWWCNUM    WWCNSN
     C**********           Z-ADD*ZERO     WWCNUM                                              CSD027
     C                     MOVE *BLANKS   WWCNUM                                              CSD027
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C********** WWCHR1    LOKUPNUM                      49                                   CSD027
     C********** *IN49     IFEQ '1'                                                           CSD027
     C***********WWCNSN    CHAINSDLBCSL0             51                   S01498
     C           WWCNSN    CHAINLBLBCSJ0             51                   S01498
     C*                                                                   B7825
     C           *IN51     IFEQ '0'                                       B7825
     C***********BBCUST    CHAINSDLBCSX0             27            B7825  S01498
     C*                                                                   B7825
     C** Get Portfolio Lending customer details using access object       S01498
     C*                                                                   S01498
     C                     CALL 'AOLBCSR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BBCUST    P@CSTM 10                       S01498
     C           SDLBCS    PARM SDLBCS    DSFDY                           S01498
     C*                                                                   S01498
     C************IN27     IFEQ '1'                                B7825  S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBKEY                           S01498
     C                     MOVELBBCUST    DBKEY            ***************S01498
     C                     MOVE 'SDLBCSPD'DBFILE           * DBERROR 013 *S01498
     C                     MOVE '013'     DBASE            ***************S01498
     C                     OUT  LDA                                       S01498
     C                     Z-ADD0         WWFNCT                          B7825
     C                     EXSR #ZA                                       B7825
     C                     END                                            B7825
     C                     END                                            B7825
     C*                                                                   B7825
     C                     ELSE
     C***********WWSCNS    CHAINSDLBCSL5             53                   S01498
     C           WWSCNS    CHAINLBLBCSJ5             53                   S01498
     C*                                                                   B8149
     C           *IN53     IFEQ '0'                                       B8149
     C***********BBCUST    CHAINSDLBCSX0             27            B8149  S01498
     C*                                                                   B8149
     C** Get Portfolio Lending customer details using access object       S01498
     C*                                                                   S01498
     C                     CALL 'AOLBCSR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BBCUST    P@CSTM                          S01498
     C           SDLBCS    PARM SDLBCS    DSFDY                           S01498
     C*                                                                   S01498
     C************IN27     IFEQ '1'                                B8149  S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBKEY                           S01498
     C                     MOVELBBCUST    DBKEY            ***************S01498
     C                     MOVE 'SDLBCSPD'DBFILE           * DBERROR 013 *S01498
     C                     MOVE '013'     DBASE            ***************S01498
     C                     OUT  LDA                                       S01498
     C                     Z-ADD0         WWFNCT                          B8149
     C                     EXSR #ZA                                       B8149
     C                     END                                            B8149
     C                     END                                            B8149
     C*                                                                   B8149
     C                     END
     C*
     C************         ELSE                                                               CSD027
     C***********                                                                             CSD027
     C***********          MOVE WWCUSR    WWCSTR  6                                           CSD027
     C***********WWCSTR    CHAINSDLBCSL0             51                   S01498              CSD027
     C***********WWCSTR    CHAINLBLBCSJ0             51                   S01498              CSD027
     C***********                                                                             CSD027
     C************IN51     IFEQ '1'                                                           CSD027
     C***********          Z-ADD0         WWFNCT                                              CSD027
     C***********          EXSR #ZA                                                           CSD027
     C***********          END                                                                CSD027
     C***********                                                                             CSD027
     C***********          END                                            SA9109              CSD027
     C***********                                                         SA9109              CSD027
     C***********WWCSTR    CHAINSDLBCSX0             51            SA9109 S01498              CSD027
     C***********                                                         SA9109              CSD027
     C***Get*Portfolio Lending customer details using access object       S01498              CSD027
     C***********                                                         S01498              CSD027
     C***********          CALL 'AOLBCSR0'                                S01498              CSD027
     C***********          PARM *BLANKS   P@RTCD                          S01498              CSD027
     C***********          PARM '*KEY   ' P@OPTN                          S01498              CSD027
     C***********          PARM WWCSTR    P@CSTM                          S01498              CSD027
     C***********SDLBCS    PARM SDLBCS    DSFDY                           S01498              CSD027
     C***********                                                         S01498              CSD027
     C************IN51     IFEQ '1'                                       SA9109              CSD027
     C***********P@RTCD    IFNE *BLANKS                                   S01498              CSD027
     C************LOCK     IN   LDA                                       S01498              CSD027
     C***********          MOVE *BLANKS   DBKEY                           S01498              CSD027
     C***********          MOVELWWCSTR    DBKEY            ***************S01498              CSD027
     C***********          MOVE 'SDLBCSPD'DBFILE           * DBERROR 013 *S01498              CSD027
     C***********          MOVE '013'     DBASE            ***************S01498              CSD027
     C***********          OUT  LDA                                       S01498              CSD027
     C***********          Z-ADD0         WWFNCT                          SA9109              CSD027
     C***********          EXSR #ZA                                       SA9109              CSD027
     C***********          END                                            SA9109              CSD027
     C**********           END                                                         SA9109 CSD027
     C*
     C           *INKC     IFEQ '0'
     C                     EXSR #BB
     C*
     C                     MOVE '0 '      DD2LSM
     C                     MOVE '0 '      DD2PRM
     C                     MOVE '0 '      DD2NFM
     C                     MOVE '0 '      DD2MTM
     C*****                MOVE '0 '      DD2AFX                          SA9018
     C*****                MOVE '0 '      DD2AFM                          SA9018
     C*****                MOVE '0 '      DD2FXL                          LB0007
     C*****                MOVE '0 '      DD2FML                          LB0007
     C*
     C                     MOVELWWLCML    DD2CML
     C                     MOVELWWLTEX    DD2TEX
     C                     MOVELWWLTCL    DD2TCL
     C                     MOVELWWLOEX    DD2OEX
     C                     MOVELWWLOCL    DD2OCL
     C                     MOVELWWLPEX    DD2PEX
     C                     MOVELWWLPRC    DD2PRC
     C                     MOVELWWLUPR    DD2UPR
     C                     MOVELWWLABR    DD2ABR
     C                     MOVELWWLBPW    DD2BPW
     C                     MOVELWWLALN    DD2ALN
     C                     MOVELWWLLPW    DD2LPW
     C                     MOVELWWLLOS    DD2LOS
     C                     MOVELWWLTOT    DD2TOT
     C                     MOVELWWLPRF    DD2PRF
     C                     MOVELWWRCSP    DD2CST
     C                     MOVELWWLNFX    DD2NFX
     C*******              MOVELWWLOLN    DD2OLN
     C                     MOVELWWLMTK    DD2MTK
     C                     MOVELWWLFXL    DD2FXL                          LB0007
     C                     MOVELWWLADR    DD2ADR
     C                     MOVELWWLACR    DD2ACR
     C                     MOVELWWLLSM    DD2LSM                          R0729
     C                     MOVELWWLPRM    DD2PRM                          R0729
     C                     MOVELWWLNFM    DD2NFM                          R0729
     C                     MOVELWWLMTM    DD2MTM                          R0729
     C                     MOVELWWLFML    DD2FML                          R0729
     C                     MOVELWWLAFX    DD2AFX                          SA9018
     C                     MOVELWWLAPM    DD2AFM                          SA9018
     C                     MOVELWWLEXF    DD2EXF                          R0170
     C                     MOVELWWLEXM    DD2EXM                          R0170
     C*
     C                     END
     C*
     C                     MOVE '1'       *IN71
     C                     MOVE '2'       WWFMT
     C                     MOVE '1'       *IN60                                               CAAA03
     C*
     C**   DISPLAY SECOND SCREEN AND CATER WITH COMMAND KEYS HIT
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C           *IN71     ANDEQ'1'
     C           *INKL     OREQ '1'                                                           CAAA03
     C           *IN60     ANDEQ'1'                                                           CAAA03
     C           *INKK     OREQ '1'                                                           CAAA03
     C           *IN70     ANDEQ'0'                                                           CAAA03
     C*
     C                     MOVE '1'       *INKL                                               CAAA03
     C**********           MOVE '1'       *IN60                                               CAAA03
     C*
     C           *IN70     IFEQ '1'
     C                     WRITELB0310C3
     C                     END
     C*
     C           WWFMT     IFEQ '3'
     C                     EXFMTLB0310F3
     C                     ELSE
     C                     EXFMTLB0310F2
     C                     END
     C*
     C* IF ROLLUP
     C           *IN80     IFEQ '1'
     C                     MOVE '3'       WWFMT   1
     C                     END
     C*
     C* IF ROLLDOWN
     C           *IN81     IFEQ '1'
     C                     MOVE '2'       WWFMT
     C                     END
     C*
     C*
     C**   IF NOT END REQUESTED, THEN IF CMD11 : CHANGE CURRENCY
     C**                              IF CMD12 : RETURN TO SCREEN 1
     C           *INKC     IFEQ '0'
     C*
     C           *IN80     IFEQ '0'
     C           *IN81     ANDEQ'0'
     C*
     C           *INKK     CASEQ'1'       #BC
     C           *INKL     CASEQ'1'       #BD
     C           *INKX     CASEQ'1'       #BE
     C           *INKY     CASEQ'1'       #BF
     C                     CAS            #BG                             LB0001
     C                     END
     C*
     C                     END
     C*
     C                     ELSE
     C*
     C           WWMNUF    IFEQ '1'
     C           WWMNUF    OREQ '2'                                       R01118
     C                     Z-ADD3         WWFNCT
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BA       - THIS SUBROUTINE PERFORMS VALIDATION OF CUSTOMER     *
     C**             NUMBER/SHORT NAME                                   *
     C**                                                                 *
     C** CALLS     - ZASNMS                                              *
     C**                                                                 *
     C** CALLED BY - #B                                                  *
     C**                                                                 *
     C********************************************************************
     C           #BA       BEGSR
     C*
     C** CLEAR SCREEN MESSAGE QUEUE
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C                     MOVELDD1CSN    WWSCNS
     C*
     C** CLEAR SCREEN ERROR INDICATORS
     C                     MOVEA'00'      *IN,70
     C*
     C**   VALIDATE CUSTOMER NUMBER OR SHORTNAME
     C**   THE FIRST CHARACTER MUST BE ALPHANUMERIC OR BLANK
     C           WWCHR1    LOKUPALPNU                    49
     C           *IN49     IFEQ '0'
     C                     SETON                     71
     C           *IN71     CABEQ'1'       #BAERR
     C                     END
     C***********                                                                             CSD027
     C*****IF*THE FIRST CHARACTER IS NON-NUMERIC THEN CHECK FOR A VALID                       CSD027
     C*****SHORTNAME                                                                          CSD027
     C***********WWCHR1    LOKUPNUM                      49                                   CSD027
     C***********                                                                             CSD027
     C************IN49     IFEQ '0'                                                           CSD027
     C***********DD1CSN    IFNE *BLANKS                                   S01498              CSD027
     C***********                                                                             CSD027
     C***********WWSCNS    SETLLSDLBCSL5             71  52               S01498              CSD027
     C***********WWSCNS    SETLLLBLBCSJ5             71  52               S01498              CSD027
     C**N52******          SETON                     71                   R0598               CSD027
     C************IN71     CABEQ'1'       #BAERR                                              CSD027
     C***********          END                                            S01498              CSD027
     C***********                                                                             CSD027
     C***********          ELSE                                                               CSD027
     C***********                                                                             CSD027
     C*****IF*THE FIRST CHARACTER IS NUMERIC, THE NEXT 5 CHARACTERS MUST                      CSD027
     C*****BE*NUMERIC AND THE END4 MUST BE BLANK. IF STILL VALID, CHECK                       CSD027
     C*****IF*THE CUSTOMER NUMBER EXISTS                                                      CSD027
     C***********          Z-ADD1         WWFLD1  20                                          CSD027
     C***********WWFLD1    DOWLT6                                                             CSD027
     C***********          ADD  1         WWFLD1                                              CSD027
     C***********CUS,WWFLD1LOKUPNUM                      49                                   CSD027
     C************IN49     IFEQ '0'                                                           CSD027
     C***********          SETON                     71                                       CSD027
     C************IN71     CABEQ'1'       #BAERR                                              CSD027
     C***********          END                                                                CSD027
     C***********          END                                                                CSD027
     C*
      * Check as a shortname                                                                  CSD027
     C           WWSCNS    CHAINLBLBCSJ5             77                                       CSD027
      * If shortname was not found                                                            CSD027
     C           *IN77     IFEQ *ON                                                           CSD027
      *                                                                                       CSD027
     C           WWEND4    IFNE *BLANKS
     C                     SETON                     71
     C           *IN71     CABEQ'1'       #BAERR
     C                     END
     C*
     C                     MOVELWWSCNS    WWCNSN  6
     C***********WWCNSN    SETLLSDLBCSL0             71  52               S01498
     C           WWCNSN    SETLLLBLBCSJ0             71  52               S01498
     C  N52                SETON                     71                   R0598
     C           *IN71     CABEQ'1'       #BAERR
     C*
     C                     END
     C*
     C**   VALIDATION SUCCESFUL
     C                     MOVE 'Y'       WWVALD  1
     C           WWVALD    CABEQ'Y'       #BAEND
     C*
     C** INVALID CUSTOMER FOUND, LOAD ERROR MESSAGE
     C           #BAERR    TAG
     C                     MOVE '1'       *IN70
     C                     MOVE 'N'       WWVALD
     C*
     C** ADD AN ERROR MESSAGE TO PROGRAM'S MESSAGE QUEUE
     C******************** MOVEL'LBM0059'*ZAMSID                          LB0001
     C                     MOVEL'LBM0007' ZAMSID                          LB0001
     C                     EXSR ZASNMS
     C*
     C           #BAEND    ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #A         - THIS SUBROUTINE PERFORMS INITIALISATION            *
     C**                                                                 *
     C**  CALLS     - #ZA                                                *
     C**                                                                 *
     C**  CALLED BY - MAINLINE                                           *
     C**                                                                 *
     C********************************************************************
     C           #A        BEGSR
     C**                                                                  081239
     C                     CALL 'PMC1003'                                 081239
     C                     PARM           WWPLDA                          081239
     C                     MOVE QMCPGM    WWPROG  6                       081239
     C*
     C**   INITIALISE DB ERROR FIELDS ETC, AND STORE PROGRAM NAME FOR
     C**   DB ERROR FIELD.
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE *BLANKS   DBASE                           R0121
     C                     MOVEL'LB0310'  DBPGM
     C                     OUT  LDA                                       S01498
     C*
     C** Set up the message subfile name
     C*
     C**   Fill in fields for subroutine ZASNMS                           R00300
     C                     MOVEL*BLANK    ZAPGM  10        Message queue  R00300
     C                     MOVE *BLANKS   ZAMSGF                          R00300
     C*********************MOVEL'LXGBMSGF'ZAMSGF                          R00300
     C                     MOVEL'LBUSRMSG'ZAMSGF 10        Message file   R00300
     C                     MOVEL*BLANK    ZAPGRL  5        Rel queue      R00300
     C                     MOVEL*BLANK    ZAMSID  7        Message Id.    R00300
     C                     MOVEL*BLANK    ZAMSDA132        Message data.  R00300
     C                     MOVEL*BLANK    ZAMSTP  7        Message type.  R00300
     C                     MOVE '1'       *IN26
     C*
     C**   SET DATE INDICATOR AS NECESSARY
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     ELSE
     C                     MOVE '0'       *IN98
     C                     END
     C                     MOVE '1'       WWFLAG  1
     C**********           Z-ADD*ZERO     WWCNUM  60                                          CSD027
     C                     MOVE *BLANKS   WWCNUM  6                                           CSD027
     C*
     C*****ACCESS*ICD*RECORD*1*****************************************   S01498
     C***********1         SETLLSDBANKPD                                  S01498
     C***********          READ SDBANKPD                 50               S01498
     C*
     C*****IF*ICD*1*NOT*FOUND*THEN*DB*ERROR****************************   S01498
     C************IN50     IFEQ '1'                                       S01498
     C***********BJTYLC    OREQ 'D'                                       S01498
     C*
     C** Get bank details using access object                             S01498
     C*                                                                   S01498
     C                     CALL 'AOBANKR0'                                S01498
     C                     PARM *BLANKS   P@RTCD  7                       S01498
     C                     PARM '*FIRST ' P@OPTN  7                       S01498
     C           SDBANK    PARM SDBANK    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '001'     DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDBANKPD'DBFILE           ** DBERROR 001 S01498
     C                     MOVE 'SDBANKPD'DBFILE           ** DBERROR 001 S01498
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     END
     C*                                                                   S01498
     C**  Rundate in DDMMMYY format                                       S01498
     C*                                                                   S01498
     C                     MOVE BJMRDT    SRUNA                           S01498
     C*                                                                   R5504
     C*****ACCESS*SDCURRL1*RECORD********************************  R5504  S01498
     C***********BJCYCD    CHAINSDCURRL1             99            R5504  S01498
     C*                                                                   R5504
     C*****IF*NOT*FOUND*THEN*DB*ERROR***************************** R5504  S01498
     C************IN99     IFEQ '1'                                R5504  S01498
     C***********A6TYLC    OREQ 'D'                                R5504  S01498
     C*                                                                   R5504
     C** Get currency details using access object                         S01498
     C*                                                                   S01498
     C                     CALL 'AOCURRR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BJCYCD    P@CCY   3                       S01498
     C           SDCURR    PARM SDCURR    DSSDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '010'     DBASE                           R5504
     C                     MOVE *BLANKS   DBFILE           ***************R5504
     C***********          MOVEL'SDCURRL1'DBFILE           ** DBER R5504  S01498
     C                     MOVE 'SDCURRPD'DBFILE           ** DBERROR 010 S01498
     C                     MOVELBJCYCD    DBKEY            ***************R5504
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA                                       R5504
     C                     ELSE                                           R5504
     C*                                                                   R5504
     C                     Z-ADDA6NBDP    WWBCDP  10                      R5504
     C                     END                                            R5504
     C*
     C*****ACCESS*SDLOMBPD*RECORD**************************************   S01498
     C***********1         SETLLSDLOMBPD                                  S01498
     C***********          READ SDLOMBPD                 55               S01498
     C*
     C*****IF*NOT*FOUND*THEN*DB*ERROR**********************************   S01498
     C************IN55     IFEQ '1'                                       S01498
     C***********LBRECI    OREQ '*'                                       S01498
     C*
     C** Get Portfolio Lending details using access object                S01498
     C*                                                                   S01498
     C                     CALL 'AOLOMBR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*FIRST ' P@OPTN                          S01498
     C           SDLOMB    PARM SDLOMB    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '002'     DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDLOMBPD'DBFILE           ** DBERROR 002 S01498
     C                     MOVE 'SDLOMBPD'DBFILE           ** DBERROR 002 S01498
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C*                                                                   SA9018
     C*****IF*RECORD*FOUND*ACCESS*PORTFOLIO*LENDING*ICD*EXTENDED*FISA9018 S01498
X1   C***********          ELSE                                    SA9018 S01498
     C***********                                                  SA9018 S01498
     C***********LBIC      IFEQ 'Y'                                33503  S01498
     C***********1         SETLLSDLOMBX0                           SA9018 S01498
     C***********          READ SDLOMBX0                 55        SA9018 S01498
     C***********                                                  SA9018 S01498
     C*****IF*RECORD*NOT*FOUND*THEN*DB*ERROR********************   SA9018 S01498
     C***********                                                  SA9018 S01498
     C************IN55     IFEQ '1'                        ********SA9018 S01498
     C***********          MOVE '002'     DBASE            *      *SA9018 S01498
     C***********          MOVEL'SDLOMBX0'DBFILE    * DBERROR 002 *SA9018 S01498
     C***********          MOVE *BLANKS   DBKEY            *      *SA9018 S01498
     C***********          EXSR #ZA                        ********SA9018 S01498
     C***********          END                                     SA9018 S01498
     C***********          END                                     33503  S01498
     C***********                                                  SA9018 S01498
     C                     END
     C*
     C***********          MOVELLBCCY     DD2CCY                          S01498
     C                     MOVELLBCYCD    DD2CCY                          S01498
     C*                                                                   087631
     C**  Access SAR details file to see if EXTENDED DEALING LIMITS       087631
     C**  is installed.                                                   087631
     C*                                                                   087631
     C                     CALL 'AOSARDR0'                                087631
     C                     PARM *BLANKS   P@RTCD                          087631
     C                     PARM '*VERIFY' P@OPTN                          087631
     C                     PARM 'S01433'  P@SARD  6                       087631
     C           SCSARD    PARM SCSARD    DSFDY                           087631
      *                                                                   087631
     C           P@RTCD    IFEQ *BLANK                                    087631
     C                     MOVE 'Y'       S01433  1                       087631
     C                     SETON                     41                   087631
     C                     END                                            087631
     C/COPY WNCPYSRC,LB0310C001
     C*                                                                   SA9018
     C**   CALCULATE FOREX MARGIN PERCENTAGE RECIPROCITY                  SA9018
     C           LBFXCP    IFEQ 0                                         SA9018
     C**                   Z-ADD0         WWFXCC  20                SA9018R0191
     C                     Z-ADD0         WWFXCC  52                      R0191
     C                     ELSE                                           SA9018
     C           100       DIV  LBFXCP    WWFXCC                          SA9018
     C                     END                                            SA9018
     C*                                                                   SA9018
     C**   CALCULATE PRECIOUS METALS MARGIN PERCENTAGE RECIPROCITY        SA9018
     C           LBPMCP    IFEQ 0                                         SA9018
     C           S01433    ORNE 'Y'                                       087631
     C**                   Z-ADD0         WWPMCC  20                SA9018R0191
     C                     Z-ADD0         WWPMCC  52                      R0191
     C                     ELSE                                           SA9018
     C           100       DIV  LBPMCP    WWPMCC                          SA9018
     C                     END                                            SA9018
     C*
     C*****ACCESS*SDCURRL1*RECORD**************************************   S01498
     C***********LBCCY     CHAINSDCURRL1             99                   S01498
     C*
     C*****IF*NOT*FOUND*THEN*DB*ERROR**********************************   S01498
     C************IN99     IFEQ '1'                                       S01498
     C***********A6TYLC    OREQ 'D'                                       S01498
     C*
     C** Get currency details using access object                         S01498
     C*                                                                   S01498
     C                     CALL 'AOCURRR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM LBCYCD    P@CCY   3                       S01498
     C           SDCURR    PARM SDCURR    DSSDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '003'     DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDCURRL1'DBFILE           ** DBERROR 003 S01498
     C                     MOVE 'SDCURRPD'DBFILE           ** DBERROR 003 S01498
     C***********          MOVELLBCCY     DBKEY            ***************S01498
     C                     MOVELLBCYCD    DBKEY            ***************S01498
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     ELSE
     C*
     C                     Z-ADD0         WWDILB  40
     C           A6NBDP    IFEQ 1
     C                     Z-ADD10        WWDILB
     C                     END
     C           A6NBDP    IFEQ 2
     C                     Z-ADD100       WWDILB
     C                     END
     C           A6NBDP    IFEQ 3
     C                     Z-ADD1000      WWDILB
     C                     END
     C                     END
     C*
     C                     Z-ADDA6SPRT    WWSRI
     C                     Z-ADDA6NBDP    WWDPI
     C                     MOVE A6MDIN    WWMDI
     C*
     C**   SET CURRENCY FLAG
     C                     MOVE 'LB'      WWCUFG  2
     C*
     C                     Z-ADD16        @@CRET  20
     C                     Z-ADD0         @@CDP   10
     C*
     C*****ACCESS*SDMMODPD*RECORD**************************************   S01498
     C***********1         SETLLSDMMODPD                           R01118 S01498
     C***********          READ SDMMODPD                 46               S01498
     C*
     C*****IF*NOT*FOUND*THEN*DB*ERROR**********************************   S01498
     C************IN46     IFEQ '1'                                       S01498
     C***********BGTYLC    OREQ 'D'                                       S01498
     C*
     C*                                                                   S01498
     C** Get Midas Modules details using access object                    S01498
     C*                                                                   S01498
     C                     CALL 'AOMMODR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*FIRST ' P@OPTN                          S01498
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '004'     DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDMMODPD'DBFILE           ** DBERROR 004 S01498
     C                     MOVE 'SDMMODPD'DBFILE           ** DBERROR 004 S01498
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     ELSE
     C*
     C           BGPFMG    IFEQ 'Y'
     C*                                                                   R01118
     C** CMD23 and CMD24 not allowed if program was called from           R01118
     C** Portfolio Management                                             R01118
     C           WWMNUF    ANDNE'2'                                       R01118
     C*
     C                     MOVE '1'       *IN40
     C                     ELSE
     C*
     C                     MOVE '0'       *IN40
     C                     END
     C*
     C                     END
     C*                                                                   B10526
     C**   ACCESS SDDEALPD RECORD                                         B10526
     C***********1         SETLLSDDEALPD                           B10526 S01498
     C***********          READ SDDEALPD                 46        B10526 S01498
     C*                                                                   S01498
     C**********           CALL 'AODEALR0'                                S01498              CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7                       S01498
     C                     PARM '*FIRST  '@OPTN   7                       S01498
     C********** SDDEAL    PARM SDDEAL    DSFDY                           S01498              CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C*                                                                   B10526
     C**   IF NOT FOUND THEN DB ERROR                                     B10526
B1   C************IN46     IFEQ '1'                                B10526 S01498
     C***********BGTYLC    OREQ 'D'                                B10526 S01498
     C*                                                                   B10526
     C           @RTCD     IFNE *BLANK                                    S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '011'     DBASE                           B10526
     C                     MOVE *BLANKS   DBFILE           ***************B10526
     C***********          MOVEL'SDDEALPD'DBFILE           ** DBER B10526 S01498
     C                     MOVE 'SDDEALPD'DBFILE           ** DBERROR 011 S01498
     C                     MOVE *BLANKS   DBKEY            ***************B10526
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA                                       B10526
X1   C                     ELSE                                           B10526
     C*                                                                   B10526
     C*****ACCESS*SDCURRL1*RECORD********************************* B10526 S01498
     C***********BNCYCD    CHAINSDCURRL1             99            B10526 S01498
     C*                                                                   B10526
     C*****IF*NOT*FOUND*THEN*DB*ERROR***************************** B10526 S01498
B2   C************IN99     IFEQ '1'                                B10526 S01498
     C***********A6TYLC    OREQ 'D'                                B10526 S01498
     C*                                                                   B10526
     C** Get currency details using access object                         S01498
     C*                                                                   S01498
     C                     CALL 'AOCURRR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BNCYCD    P@CCY   3                       S01498
     C           SDCURR    PARM SDCURR    DSSDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '012'     DBASE                           B10526
     C                     MOVE *BLANKS   DBFILE           ***************B10526
     C***********          MOVEL'SDCURRL1'DBFILE           ** DBER B10526 S01498
     C                     MOVE 'SDCURRPD'DBFILE           ** DBERROR 012 S01498
     C                     MOVELBNCYCD    DBKEY            ***************B10526
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA                                       B10526
X2   C                     ELSE                                           B10526
     C*                                                                   B10526
     C                     Z-ADDA6SPRT    WWSRL  138                      B10526
     C                     Z-ADDA6NBDP    WWDPL   10                      B10526
     C                     MOVE A6MDIN    WWMDL   1                       B10526
     C*                                                                   B10526
E2   C                     END                                            B10526
E1   C                     END                                            B10526
     C*
     C** CLEAR SCREEN MESSAGE QUEUE
     C                     MOVE *BLANKS   WWTPGQ
     C                     MOVEL'*'       WWTPGQ
     C                     MOVE *BLANKS   WWPGQR
     C                     MOVEL'*PRV'    WWPGQR
     C                     MOVE '1'       *IN71
     C*
     C** INITIALISE SCREEN MESSAGE QUEUE
     C                     MOVE *BLANKS   DDPGMQ                          S01498
     C                     MOVEL'*'       DDPGMQ
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD0         ZDECS
     C                     MOVE 'N'       WWPMDC  1
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BB       - THIS SUBROUTINE CUSTOMER NUMBER PROCESSING          *
     C**                                                                 *
     C** CALLS     - #ZA, #BBA, #BBB                                     *
     C**                                                                 *
     C** CALLED BY - #B                                                  *
     C**                                                                 *
     C********************************************************************
     C           #BB       BEGSR
     C*
     C*****ACCESS*SDCURRL1*RECORD**************************************   S01498
     C***********CUCCY     CHAINSDCURRL1             99                   S01498
     C*
     C*****IF*NOT*FOUND*THEN*DB*ERROR**********************************   S01498
     C************IN99     IFEQ '1'                                       S01498
     C***********A6TYLC    OREQ 'D'                                       S01498
     C*
     C** Get currency details using access object                         S01498
     C*                                                                   S01498
     C                     CALL 'AOCURRR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM CUCCY     P@CCY   3                       S01498
     C           SDCURR    PARM SDCURR    DSSDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '005'     DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDCURRL1'DBFILE           ** DBERROR 005 S01498
     C                     MOVE 'SDCURRPD'DBFILE           ** DBERROR 005 S01498
     C                     MOVELCUCCY     DBKEY            *****************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     ELSE
     C*
     C                     Z-ADD0         WWDICU  40
     C           A6NBDP    IFEQ 1
     C                     Z-ADD10        WWDICU
     C                     END
     C           A6NBDP    IFEQ 2
     C                     Z-ADD100       WWDICU
     C                     END
     C           A6NBDP    IFEQ 3
     C                     Z-ADD1000      WWDICU
     C                     END
     C                     END
     C*
     C                     MOVELBBCUST    DD2CUS
     C                     MOVELBBCRNM    DD2RPN
     C                     MOVELBBCRTN    DD2RPT
     C                     MOVELCUINBP    WWINBP  1
     C*
     C**   PERFORM PARENT AND ORPHAN/CHILD PROCESSING.
     C                     EXSR #BBA
     C*
     C**   CONVERT CURRENCY AS NECESSARY
     C                     EXSR #BBB
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BBA      - THIS SUBROUTINE PERFORMS ORPHAN/CHILD PROCESSING    *
     C**                                                                 *
     C** CALLS     - #ZA, ZDATE2                                         *
     C**                                                                 *
     C** CALLED BY - #BB                                                 *
     C**                                                                 *
     C********************************************************************
     C           #BBA      BEGSR
     C*
     C**********           MOVELBBCUST    WWCUST  60                                          CSD027
     C                     MOVELBBCUST    WWCUST  6                                           CSD027
     C*
     C           WWCKY1    CHAINLBEXTRL2             58
     C*
     C           *IN58     IFEQ '1'
     C                     Z-ADD*ZERO     WWPROF 150
     C                     ELSE
     C*******              Z-ADDEEEXPS    WWPROF                          LB0000
     C                     Z-ADDEECOLL    WWPROF                          LB0000
     C/COPY WNCPYSRC,LB0310C002
     C                     END
     C*
     C           WWCKY2    CHAINLBEXTRL2             58
     C*
     C           *IN58     IFEQ '1'
     C                     Z-ADD*ZERO     WWLOSS 150
     C                     ELSE
     C                     Z-ADDEEEXPS    WWLOSS
     C                     END
     C*
     C           WWCKY3    CHAINLBEXTRL2             58
     C*
     C           *IN58     IFEQ '1'
     C                     Z-ADD*ZERO     WWMARG 150
     C                     Z-ADD*ZERO     WWEXPF 150                      R0170
     C                     ELSE
      *----- SA9109 ------------------------------------------------------------
     C*********************Z-ADDEEEXPS    WWMARG                          SA9109
     C           EEMGPC    IFNE *ZEROS                                    SA9109
     C                     Z-ADDEEMARG    WWMARG                          SA9109
     C                     ELSE                                           SA9109
     C                     Z-ADDEEEXPS    WWMARG                          SA9109
     C                     END                                            SA9109
      *----- SA9109 ------------------------------------------------------------
     C                     Z-ADDEEEXPO    WWEXPF                          R0170
     C                     END
     C*                                                                   R0729
     C           S01433    IFEQ 'Y'                                       087631
     C           WWCKY4    CHAINLBEXTRL2             58                   R0729
     C*                                                                   R0729
     C           *IN58     IFEQ '1'                                       R0729
     C                     Z-ADD*ZERO     WWPRPM 150                      R0729
     C                     ELSE                                           R0729
     C                     Z-ADDEECOLL    WWPRPM                          R0729
     C/COPY WNCPYSRC,LB0310C003
     C                     END                                            R0729
     C*                                                                   R0729
     C           WWCKY5    CHAINLBEXTRL2             58                   R0729
     C*                                                                   R0729
     C           *IN58     IFEQ '1'                                       R0729
     C                     Z-ADD*ZERO     WWLSPM 150                      R0729
     C                     ELSE                                           R0729
     C                     Z-ADDEEEXPS    WWLSPM                          R0729
     C                     END                                            R0729
     C*                                                                   087631
     C                     ELSE                                           087631
     C                     Z-ADD*ZERO     WWPRPM                          087631
     C                     Z-ADD*ZERO     WWLSPM                          087631
     C                     END                                            087631
     C*                                                                   R0729
     C***********          Z-ADDLBFORX    DD2FPX  30               B10530 S01498
     C***********          Z-ADDLBFORP    DD2MPX  30               SA9109 S01498
     C                     Z-ADDCUFORX    DD2FPX  30                      S01498
     C           S01433    IFEQ 'Y'                                       087631
     C                     Z-ADDCUFORP    DD2MPX  30                      S01498
     C           WWCKY6    CHAINLBEXTRL2             58                   R0729
     C*                                                                   R0729
     C           *IN58     IFEQ '1'                                       R0729
     C                     Z-ADD*ZERO     WWMAPM 150                      R0729
     C                     Z-ADD*ZERO     WWEXPM 150                      R0170
     C                     ELSE                                           R0729
      *-------- SA9109 ---------------------------------------------------------
     C*********************Z-ADDEEEXPS    WWMAPM                    R0279 SA9109
     C           EEMGPC    IFNE *ZEROS                                    SA9109
     C                     Z-ADDEEMARG    WWMAPM                          SA9109
     C                     ELSE                                           SA9109
     C                     Z-ADDEEEXPS    WWMAPM                          SA9109
     C                     END                                            SA9109
      *-------- SA9109 ---------------------------------------------------------
     C                     Z-ADDEEEXPO    WWEXPM                          R0170
     C                     END                                            R0729
     C*                                                                   087631
     C                     ELSE                                           087631
     C                     Z-ADD*ZERO     DD2MPX                          087631
     C                     Z-ADD*ZERO     WWMAPM                          087631
     C                     Z-ADD*ZERO     WWEXPM                          087631
     C                     END                                            087631
     C*                                                                   SA9018
     C                     MOVEL'@OF'     @OINST                          SA9018
     C           WWCKY7    CHAINLBEXTRL2             58                   SA9018
     C           *IN58     IFEQ '1'                                       SA9018
     C                     Z-ADD*ZERO     WWOOFX 150                      SA9018
     C                     ELSE                                           SA9018
     C                     Z-ADDEEEXPS    WWOOFX                          SA9018
     C           LBFXCP    IFEQ *ZEROS                                    SA9018
     C                     Z-ADD0         WWOOFX                          SA9018
     C                     ELSE                                           SA9018
     C                     MULT 100       WWOOFX                          SA9018
     C                     DIV  LBFXCP    WWOOFX                          SA9018
     C                     END                                            SA9018
     C                     END                                            SA9018
     C*                                                                   SA9018
     C           S01433    IFEQ 'Y'                                       087631
     C                     MOVEL'@OP'     @OINST                          SA9018
     C           WWCKY7    CHAINLBEXTRL2             58                   SA9018
     C           *IN58     IFEQ '1'                                       SA9018
     C                     Z-ADD*ZERO     WWOOPM 150                      SA9018
     C                     ELSE                                           SA9018
     C                     Z-ADDEEEXPS    WWOOPM                          SA9018
     C           LBPMCP    IFEQ *ZEROS                                    SA9018
     C                     Z-ADD0         WWOOPM                          SA9018
     C                     ELSE                                           SA9018
     C                     MULT 100       WWOOPM                          SA9018
     C                     DIV  LBPMCP    WWOOPM                          SA9018
     C                     END                                            SA9018
     C                     END                                            SA9018
     C*                                                                   087631
     C                     ELSE                                           087631
     C                     Z-ADD*ZERO     WWOOPM                          087631
     C                     END                                            087631
     C*                                                                   SA9018
     C*
     C           WWCUST    CHAINLBEXTSL1             57
     C*
     C           *IN57     IFEQ '1'
     C*
     C*******              MOVE '006'     DBASE                        LB0000
     C*******              MOVE *BLANKS   DBFILE           *****************
     C*******              MOVEL'LBEXTSL1'DBFILE           ** DBERROR 006 **
     C*******              MOVELBBAENB    DBKEY            *****************
     C*******              EXSR #ZA                                    LB0000
     C*
     C                     ELSE
     C                     Z-ADDESLPWR    WWLPWR 150
     C                     Z-ADDESTPRD    WWTPRD 150
     C                     Z-ADDESOWEX    WWOWEX 150
     C                     Z-ADDESTPIU    WWTPIU 150
     C                     Z-ADDESTPRV    WWTPRV 150
     C                     Z-ADDESTACD    WWTACD 150
     C                     Z-ADDESTACC    WWTACC 150
     C                     Z-ADDESOWCO    WWOWCO 150
     C                     Z-ADDESCMTL    WWCMTL 150
     C                     END
     C*
     C**   IF PROCESSING IS FOR ORPHAN/CHILD THEN ALLOW NOTES & NEXT
     C**   REVIEW DATE LITERALS TO BE DISPLAYED
     C           BBPAIN    IFNE 'P'
     C*
     C                     MOVE '1'       *IN65
     C*
     C**   FIND ACTIVE COMMITMENT RECORD
     C                     MOVE 'N'       WWCMFN  1
     C           WWCOMA    SETLLLBCOMAL2             56
     C*
     C           *IN56     IFEQ '0'
     C           WWCUST    READELBCOMAL2                 56
     C*
     C           *IN56     DOWEQ'0'
     C           WWCMFN    ANDEQ'N'
     C*
     C           CASTTD    IFLE BJRDNB
     C           CAEXPD    ANDGEBJRDNB
     C                     MOVE 'Y'       WWCMFN
     C                     ELSE
     C           WWCUST    READELBCOMAL2                 56
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C**   IF ACTIVE RECORD FOUND SET UP OUTPUT FIELDS
     C           WWCMFN    IFEQ 'Y'
     C                     Z-ADDCAREVD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    DD2NRD
     C                     Z-ADDCAEXPD    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    DD2EXD
     C****                 MOVELCANOT1    DD2NT1
     C****                 MOVELCANOT2    DD2NT2
     C****                 MOVELCANOT3    DD2NT3
     C****                 MOVELCANOT4    DD2NT4
     C                     ELSE
     C                     MOVEL*BLANKS   DD2NRD
     C                     MOVEL*BLANKS   DD2EXD
     C****                 MOVEL*BLANKS   DD2NT1
     C****                 MOVEL*BLANKS   DD2NT2
     C****                 MOVEL*BLANKS   DD2NT3
     C****                 MOVEL*BLANKS   DD2NT4
     C                     END
     C*
     C                     END
     C*
     C**   TOTAL EXPOSURE = OWN EXPOSURE + PLEDGES EXPOSURE.
     C           WWOWEX    ADD  WWTPIU    WWTEXP 150
     C*
     C**   BORROWING POWER = LENDING POWER
     C*******           OR = LENDING POWER + USE OF PLEDGES RECEIVED IF   LB0002
     C**                OR = LENDING POWER + PLEDGES RECEIVED IF          LB0002
     C**                     'PLEDGES RECEIVED INCREASES BORROWING
     C**                     POWER' IS 'Y' FOR THE CUSTOMER (IN
     C**                     PORTFOLIO LENDING CUSTOMER FILE).
     C           WWINBP    IFEQ 'Y'
     C*******    WWLPWR    ADD  WWTPRD    WWBPWR 150                      LB0002
     C           WWLPWR    ADD  WWTPRV    WWBPWR 150                      LB0002
     C                     ELSE
     C                     Z-ADDWWLPWR    WWBPWR
     C                     END
     C*
     C**   AVAILABLE BORROWING =
     C**   LESSER OF: COMMITMENT LINE - OWN EXPOSURE - PLEDGES EXPOSURE
     C**          OR: BORROWING POWER - OWN EXPOSURE - PLEDGES EXPOSURE
     C**           (OR ONE OF THESE IF BOTH THE SAME)
     C           WWCMTL    SUB  WWOWEX    WWTMP1 150
     C           WWTMP1    SUB  WWTPIU    WWTMP1
     C*
     C           WWTMP1    IFLT 0                                         LB0000
     C                     Z-ADD0         WWTMP1                          LB0000
     C                     END                                            LB0000
     C*
     C           WWBPWR    SUB  WWOWEX    WWTMP2 150
     C           WWTMP2    SUB  WWTPIU    WWTMP2
     C*
     C           WWTMP2    IFLT 0                                         LB0000
     C                     Z-ADD0         WWTMP2                          LB0000
     C                     END                                            LB0000
     C*
     C*
     C           WWTMP1    IFEQ WWTMP2
     C                     Z-ADDWWTMP1    WWABRW 150
     C                     ELSE
     C*
     C           WWTMP1    IFGT WWTMP2
     C                     Z-ADDWWTMP2    WWABRW
     C                     ELSE
     C*
     C                     Z-ADDWWTMP1    WWABRW
     C                     END
     C*
     C                     END
     C*
     C**   AVAILABLE LENDING =
     C**     LENDING POWER - TOTAL EXPOSURE
     C********IF*(LBPLEC*=*B)***OR*(LBPLEC*=*C*AND*CUPLEC*=*B)*********   S01498
     C**      IF (LBPLDC = B)   OR (LBPLDC = C AND CUPLEC = B)            S01498
     C**     LENDING POWER + PLEDGES RECEIVED - TOTAL EXPOSURE
     C********IF*(LBPLEC*= T)***OR*(LBPLEC*=*C*AND*CUPLEC*=*T)*********   S01498
     C**      IF (LBPLDC = T)   OR (LBPLDC = C AND CUPLEC = T)            S01498
     C*
     C                     Z-ADD0         WWALND 150
     C*
     C***********LBPLEC    IFEQ 'B'                                       S01498
     C***********LBPLEC    OREQ 'C'                                       S01498
     C           LBPLDC    IFEQ 'B'                                       S01498
     C           LBPLDC    OREQ 'C'                                       S01498
     C           CUPLEC    ANDEQ'B'
     C           ESLPWR    SUB  WWTEXP    WWALND
     C                     END
     C*
     C           WWALND    IFLT 0                                         LB0000
     C                     Z-ADD0         WWALND                          LB0000
     C                     END                                            LB0000
     C*
     C***********LBPLEC    IFEQ 'T'                                       S01498
     C***********LBPLEC    OREQ 'C'                                       S01498
     C           LBPLDC    IFEQ 'T'                                       S01498
     C           LBPLDC    OREQ 'C'                                       S01498
     C           CUPLEC    ANDEQ'T'
     C           ESLPWR    ADD  ESTPRD    WWALND
     C           WWALND    SUB  WWTEXP    WWALND
     C                     END
     C*
     C           WWALND    IFLT 0                                         LB0000
     C                     Z-ADD0         WWALND                          LB0000
     C                     END                                            LB0000
     C*
     C**   IF AVAILABLE BORROWING < = ZERO
     C**      SET AVAILABLE LENDING TO ZERO
     C**   ELSE
     C**      IF AVAILABLE LENDING > AVAILABLE BORROWING
     C**         SET AVAILABLE LENDING = AVAILABLE BORROWING
     C*
     C           WWABRW    IFLE *ZEROS
     C                     Z-ADD*ZEROS    WWALND
     C                     ELSE
     C           WWALND    IFGT WWABRW
     C                     Z-ADDWWABRW    WWALND
     C                     END
     C                     END
     C*
     C*****TOTAL COLLATERAL = OWN COLLATERAL + PLEDGES RECEIVED
     C**   TOTAL COLLATERAL = OWN COLLATERAL + USE OF PLEDGES RECEIVED
     C***********WWOWCO    ADD  WWTPRD    WWTCLL 150
     C           WWOWCO    ADD  WWTPRV    WWTCLL 150
     C*
     C**   NET FOREIGN EXCHANGE = ?
     C**    IF TOTAL PROFIT IS GREATER THAN TOTAL LOSS =
     C**   TOTAL PROFIT - TOTAL LOSS
     C**    IF TOTAL LOSS IS GREATER THAN TOTAL PROFIT =
     C**   TOTAL LOSS - TOTAL PROFIT
     C**    IF TOTAL LOSS IS EQUAL TO TOTAL PROFIT = ZERO
     C           WWLOSS    IFEQ WWPROF
     C                     Z-ADD0         WWNFEX 150
     C                     ELSE
     C*
     C*******    WWLOSS    IFGT WWPROF                                    LB0000
     C*******    WWLOSS    SUB  WWPROF    WWNFEX                          LB0000
     C*******              ELSE                                           LB0000
     C*
     C*******    WWPROF    SUB  WWLOSS    WWNFEX                          LB0000
     C*******              END                                            LB0000
     C*
     C           WWPROF    SUB  WWLOSS    WWNFEX                          LB0000
     C*                                                                   LB0000
     C*                                                                   LB0000
     C                     END
     C*                                                                   R0729
     C**   NET PRECIOUS METALS = ?                                        R0729
     C**    IF TOTAL PROFIT IS GREATER THAN TOTAL LOSS =                  R0729
     C**   TOTAL PROFIT - TOTAL LOSS                                      R0729
     C**    IF TOTAL LOSS IS GREATER THAN TOTAL PROFIT =                  R0729
     C**   TOTAL LOSS - TOTAL PROFIT                                      R0729
     C**    IF TOTAL LOSS IS EQUAL TO TOTAL PROFIT = ZERO                 R0729
     C           WWPRPM    IFEQ WWLSPM                                    R0729
     C                     Z-ADD0         WWNPMM 150                      R0729
     C                     ELSE                                           R0729
     C*                                                                   R0729
     C           WWPRPM    SUB  WWLSPM    WWNPMM                          R0729
     C                     END                                            R0729
     C*
     C*****EQUITY TOTAL = OWN COLLATERAL + PLEDGES RECEIVED - OWN         LB0002
     C**   EQUITY TOTAL = OWN COLLATERAL + USE OF PLEDGES RECEIVED - OWN  LB0002
     C**                  EXPOSURE - PLEDGES EXPOSURE
     C*******    WWOWCO    ADD  WWTPRD    WWETOT 150                      LB0002
     C           WWOWCO    ADD  WWTPRV    WWETOT 150                      LB0002
     C           WWETOT    SUB  WWOWEX    WWETOT
     C           WWETOT    SUB  WWTPIU    WWETOT
     C*
     C**   CUSTOMER EQUITY = OWN COLLATERAL - OWN EXPOSURE - PLEDGES      LB0001
     C**                     EXPOSURE + MARGIN TAKEN                      LB0001
     C**   CUSTOMER EQUITY = OWN COLLATERAL - OWN EXPOSURE                R5649
     C**                     (DO NOT INCLUDE MARGIN IN EXPOSURE)          R5649
     C           WWOWCO    SUB  WWOWEX    WWCSTE 150
     C**         WWCSTE    SUB  WWTPIU    WWCSTE                          R5649
     C           WWCSTE    ADD  WWMARG    WWCSTE                          LB0001
     C**                              + PRECIOUS METALS MARGIN TAKEN      R0729
     C                     ADD  WWMAPM    WWCSTE                          R0729
     C*
     C*****OFFSET LENDING = ?
     C******IF PLEDGES RECEIVED IS LESS THAN OWN EXPOSURE =
     C*******  OWN COLLATERAL + PLEDGES RECEIVED - OWN EXPOSURE -
     C*******  PLEDGES EXPOSURE
     C******IF PLEDGES RECEIVED IS NOT LESS THAN OWN EXPOSURE =
     C*******  OWN COLLATERAL - PLEDGES EXPOSURE
     C*******    WWTPRD    IFLT WWOWEX
     C*******              Z-ADDWWETOT    WWOLND 150
     C*******              ELSE
     C*******    WWOWCO    SUB  WWTPIU    WWOLND
     C*******              END
     C*                                                                   SA9018
     C**   FOREX LINE   = MARGIN TAKEN  *  100                            SA9018
     C*                   ------------                                    SA9018
     C*                    MARGIN %                                       SA9018
     C*                                                                   SA9018
     C**                   Z-ADD*ZEROS    WWFXLI 180                SA9018R0064
     C**         LBFXCP    IFNE *ZEROS                              SA9018R0064
     C**         WWMARG    MULT 100       WWFXLI                    SA9018R0064
     C**         WWFXLI    DIV  LBFXCP    WWFXLI                    SA9018R0064
     C**                   END                                      SA9018R0064
     C*                                                                   SA9018
     C**   PRECIOUS METALS LINE   = MARGIN TAKEN  *  100                  SA9018
     C*                             ------------                          SA9018
     C*                               MARGIN %                            SA9018
     C*                                                                   SA9018
     C**                   Z-ADD*ZEROS    WWPMLI 180                SA9018R0064
     C**         LBPMCP    IFNE *ZEROS                              SA9018R0064
     C**         WWMAPM    MULT 100       WWPMLI                    SA9018R0064
     C**         WWPMLI    DIV  LBPMCP    WWPMLI                    SA9018R0064
     C**                   END                                      SA9018R0064
      **   AVAILABLE FOREX LINE & PRECIOUS METAL LINE.                    R0064
     C                     Z-ADD0         WW1XLI                          B10527
     C                     MOVE *BLANKS   WCUST   6                       S01498
     C                     MOVELWWCUST    WCUST                           S01498
     C***********WWCUST    CHAINLIMITJBF             10            R0064  S01498
     C**N10******RECI      IFEQ 'D'                                R0064  S01498
     C***                  Z-ADDFLMM      WWFXLI 180                R0064 R0169
     C***********          Z-ADDFAMM      WWFXLI 180         R0064 R0169  S01498
     C***********          Z-ADDLIPSAM    WWPMLI 180               R0064  S01498
     C*                                                                   S01498
     C** Access by branch limit for the branch that customer is in, if    S01498
     C** no limit exist by branch then no limit will be applied           S01498
     C*                                                                   S01498
     C                     CALL 'AOCLLMR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM WCUST     P@KEY1  6                       S01498
     C                     PARM 'B'       P@KEY2  1                       S01498
     C                     PARM BBBRCD    P@KEY3  3                       S01498
     C           SDCLLM    PARM SDCLLM    DSFDY                           S01498
     C*                                                                   S01498
     C           P@RTCD    IFEQ *BLANKS                                   S01498
     C           S01433    IFEQ 'Y'                                       087631
     C                     Z-ADDDZFXFA    WWFXLI 180                      S01498
     C                     Z-ADDDZPFAM    WWPMLI 180                      S01498
     C                     ELSE                                           087631
     C                     Z-ADDDZFLAM    WWFXLI                          087631
     C                     Z-ADD*ZERO     WWPMLI                          087631
     C                     END                                            087631
     C***********          END                                     R0064  S01498
     C***10******          DO                                      R0064  S01498
     C                     ELSE                                           S01498
     C                     Z-ADD0         WWFXLI 180                      R0064
     C                     Z-ADD0         WWPMLI 180                      R0064
     C           LBLIFX    IFNE '   '                                     R5702
     C           LBLIPM    ORNE '   '                                     R5702
     C                     Z-ADD0         WWAAFX 150                      R5702
     C                     Z-ADD0         WWAAPM 150                      R5702
     C                     GOTO NOLIM                                     R5702
     C                     END                                            R5702
     C                     END                                            R0064
     C*                                                                   SA9018
     C**   AVAILABLE FOREX AND AVAILABLE PRECIOUS METALS                  SA9018
     C                     Z-ADD0         WWAAFX 150                      SA9018
     C                     Z-ADD0         WWAAPM 150                      SA9018
     C*                                                                   SA9018
     C           WWFXLI    MULT 1000      WW1XLI 180                      R5504
     C***********8*********SUB  WWBCDP    A       10                 R5504B9492
     C           7         SUB  WWBCDP    A       10                      B9492
     C                     MULT POWER,A   WW1XLI                          R5504
     C*                                                                   R5504
     C** CONVERT FX LIMIT FROM DEALING CCY INTO PORTFOLIO LENDING CCY     B10526
     C** I = DEALING CURRENCY; O = PORTFOLIO LENDING CURRENCY             B10526
     C                     Z-ADDWWSRI     WWSRO                           B10526
     C                     Z-ADDWWDPI     WWDPO                           B10526
     C                     MOVE WWMDI     WWMDO                           B10526
     C                     Z-ADDWWSRL     WWSRI                           B10526
     C                     Z-ADDWWDPL     WWDPI                           B10526
     C                     MOVE WWMDL     WWMDI                           B10526
     C*                                                                   B10526
     C                     Z-ADDWWFXLI    WWAMTI                          B10526
     C                     EXSR SCONV                                     B10526
     C                     Z-ADDWWAMTO    WW1XLI                          B10526
     C*                                                                   B10526
     C** DEALING LIMIT IN THOUSANDS                                       B10526
     C                     MULT 1000      WW1XLI                          B10526
     C***********8         SUB  WWDPL     A       10               B10526 072467
     C           7         SUB  WWDPL     A       10                      072467
     C                     MULT POWER,A   WW1XLI                          B10526
     C*                                                                   B10526
     C** CONVERT PRECIOUS METAL LIMIT                                     B10526
     C                     Z-ADDWWPMLI    WWAMTI                          B10526
     C                     EXSR SCONV                                     B10526
     C                     Z-ADDWWAMTO    WW1MLI                          B10526
     C*                                                                   B10526
     C** REPLACE INPUT AND OUTPUT CCY'S FOR FURTHER PROCESSING            B10526
     C** I = PORTFOLIO LENDIN CURRENCY; O = CURRENT CUSTOMER OWN CURRENCY B10526
     C                     Z-ADDWWSRO     WWSRI                           B10526
     C                     Z-ADDWWDPO     WWDPI                           B10526
     C                     MOVE WWMDO     WWMDI                           B10526
     C*                                                                   B10526
     C***********WWPMLI    MULT 1000      WW1MLI 180                 R5504087631
     C                     MULT 1000      WW1MLI 180                      087631
     C                     MULT POWER,A   WW1MLI                          R5504
     C*                                                                   R5504
     C** AVAILABLE FOREX = AVAILABLE BORROWING / MARGIN PERCENTAGE        B10575
B1   C           LBMGLE    IFEQ 'E'                                       SA9018
     C***********LBIC      ANDEQ'Y'                                33503  S01498
     C***        *IN10     IFEQ '0'                                  R5504B10575
     C***        WWEXPF    IFGT WW1XLI                               R5504B10575
     C***                  Z-ADD*ZERO     WWAAFX                     R5504B10575
     C***                  ELSE                                      R5504B10575
     C***        WWABRW    MULT WWFXCC    WWAAFX              SA9018 R5504B10575
     C**         WWAAFX    IFGT WW1XLI                                R5504R5735
     C**         WW1XLI    SUB  WWEXPF    WWAAFX                      R5504R5735
     C**                   END                                        R5504R5735
     C*                                                              R5735B10575
     C***        WW1XLI    SUB  WWEXPF    WWAAF1 150                 R5735B10575
     C***        WWAAFX    IFGT WWAAF1                               R5735B10575
     C***                  Z-ADDWWAAF1    WWAAFX                     R5735B10575
     C***                  END                                       R5735B10575
     C***                  END                                       R5504B10575
     C***        WWEXPM    IFGT WW1MLI                               R5504B10575
     C***                  Z-ADD*ZERO     WWAAPM                     R5504B10575
     C***                  ELSE                                      R5504B10575
     C***        WWABRW    MULT WWPMCC    WWAAPM              SA9018 R5504B10575
     C**         WWAAPM    IFGT WW1MLI                                R5504R5735
     C**         WW1MLI    SUB  WWEXPM    WWAAPM                      R5504R5735
     C**                   END                                        R5504R5735
     C*                                                              R5735B10575
     C***        WW1MLI    SUB  WWEXPM    WWAAF1                     R5735B10575
     C***        WWAAPM    IFGT WWAAF1                               R5735B10575
     C***                  Z-ADDWWAAF1    WWAAPM                     R5735B10575
     C***                  END                                       R5735B10575
     C***                  END                                       R5504B10575
     C***                  ELSE                                      R5504B10575
     C***        WWABRW    MULT WWFXCC    WWAAFX                    SA9018B10575
     C***        WWABRW    MULT WWPMCC    WWAAPM                    SA9018B10575
     C***                  END                                       R5504B10575
     C*                                                                   B10575
     C** AVAILABLE FOREX                                                  B10575
B2   C           WWFXCC    IFNE 0                                         B10575
     C           WWABRW    DIV  WWFXCC    WWAAFX    H                     B10575
     C                     ELSE                                           B10575
     C                     Z-ADD0         WWAAFX                          B10575
E2   C                     END                                            B10575
     C*                                                                   B10575
     C** AVAILABLE PRECIOUS METALS                                        B10575
B2   C           WWPMCC    IFNE 0                                         B10575
     C           WWABRW    DIV  WWPMCC    WWAAPM    H                     B10575
     C                     ELSE                                           B10575
     C                     Z-ADD0         WWAAPM                          B10575
E2   C                     END                                            B10575
     C*                                                                   B10575
E1   C                     END                                            R5504
     C*                                                                   R5504
     C*********************ELSE                                    SA9018 R5504
     C*                                                                   SA9018
     C           LBMGLE    IFEQ 'L'                                       SA9018
     C***********LBIC      ANDEQ'Y'                                33503  S01498
     C           WW1XLI    SUB  WWOOFX    WWAAFX                          SA9018
     C           WW1MLI    SUB  WWOOPM    WWAAPM                          SA9018
     C                     END                                            SA9018
     C*                                                                   SA9018
     C*********************END                                     SA9018 R5504
     C*
     C           WWAAFX    IFLT *ZERO                                     R5504
     C                     Z-ADD*ZERO     WWAAFX                          R5504
     C                     END                                            R5504
     C*                                                                   R5504
     C           WWAAPM    IFLT *ZERO                                     R5504
     C                     Z-ADD*ZERO     WWAAPM                          R5504
     C                     END                                            R5504
     C*                                                                   R5504
     C           NOLIM     TAG                                            R5702
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BBB      - THIS SUBROUTINE DEALS WITH CURRENCY CONVERSION      *
     C**                                                                 *
     C** CALLS     - #BBBA, SCONV                                        *
     C**                                                                 *
     C** CALLED BY - #BB                                                 *
     C**                                                                 *
     C********************************************************************
     C           #BBB      BEGSR
     C*
     C**   CALCULATE PORTFOLIO LENDING AND CUSTOMER CURRENCY
     C                     Z-ADDWWDILB    WWDVFD  40
     C*
     C**   COMMITMENT LINE
     C                     Z-ADDWWCMTL    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLCML 16
     C*
     C**   TOTAL EXPOSURE
     C                     Z-ADDWWTEXP    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLTEX 16
     C*
     C**   TOTAL COLLATERAL
     C                     Z-ADDWWTCLL    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLTCL 16
     C*
     C**   OWN EXPOSURE
     C                     Z-ADDWWOWEX    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLOEX 16
     C*
     C**   OWN COLLATERAL
     C                     Z-ADDWWOWCO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLOCL 16
     C*
     C**   PLEDGE EXPOSURE
     C                     Z-ADDWWTPIU    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLPEX 16
     C*
     C           ESTPID    IFNE 0                                         R0673
     C           ESTPIU    ANDNEESTPID                                    R0673
     C                     SETON                     62                   R0673
     C                     ELSE                                           R0673
     C                     SETOF                     62                   R0673
     C                     END                                            R0673
      *                                                                   R0673
     C**   PLEDGES RECEIVED
     C*****************    Z-ADDWWTPRD    WWFLD2                          R0673
     C                     Z-ADDWWTPRD    WWFLD2     61                   R0673
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLPRC 16
     C*
     C**   USE OF PLEDGES RECEIVED
     C                     Z-ADDWWTPRV    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLUPR 16
     C*
     C**   AVAILABLE BORROWING
      *                                                                   R0673
     C** 61                ADD  WWTPRD    WWABRW                    R0673 R5545
     C** 61                SUB  WWTPRV    WWABRW                    R0673 R5545
      *                                                                   R0673
     C                     Z-ADDWWABRW    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLABR 16
     C*
     C**   BORROWING POWER
     C                     Z-ADDWWBPWR    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLBPW 16
     C*
     C**   AVAILABLE LENDING
     C                     Z-ADDWWALND    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLALN 16
     C*
     C**   LENDING POWER
     C                     Z-ADDWWLPWR    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLLPW 16
     C*
     C**   OPEN FOREIGN EXCHANGE LOSS
     C                     Z-ADDWWLOSS    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLLOS 16
     C*
     C**   EQUITY TOTAL
     C                     Z-ADDWWETOT    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLTOT 16
     C*
     C**   OPEN FOREIGN EXCHANGE PROFIT
     C                     Z-ADDWWPROF    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLPRF 16
     C*
     C**   CUSTOMER EQUITY
     C                     Z-ADDWWCSTE    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWRCSP 16
     C*
     C**   NET FOREIGN EXCHANGE
     C                     Z-ADDWWNFEX    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLNFX 16
     C*
     C*****OFFSET LENDING
     C*******              Z-ADDWWOLND    WWFLD2
     C*******
     C*******              EXSR #BBBA
     C*******
     C*******              MOVE ZOUT21    WWLOLN 16
     C*******
     C**   MARGIN TAKEN
     C                     Z-ADDWWMARG    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLMTK 16
     C*
     C***  FOREX LINE   = MARGIN TAKEN  *  100                     LB0007 SA9018
     C***                 ------------                             LB0007 SA9018
     C***                  MARGIN %                                LB0007 SA9018
     C***                                                          LB0007 SA9018
     C***                  Z-ADD*ZEROS    WWWRKN 180               LB0007 SA9018
     C***        LBFXCP    IFNE *ZEROS                             LB0007 SA9018
     C***        WWMARG    MULT 100       WWWRKN                   LB0007 SA9018
     C***        WWWRKN    DIV  LBFXCP    WWWRKN                   LB0007 SA9018
     C***                  END                                     LB0007 SA9018
     C*                                                            LB0007 SA9018
     C***  FOREX LINE                                              LB0007 SA9018
     C**                   Z-ADDWWFXLI    WWFLD2                   LB0007 R0048
     C*                                                                   LB0007
     C**                   EXSR #BBBA                              LB0007 R0048
     C*                                                                   LB0007
     C**                   MOVE ZOUT21    WWLFXL 16                LB0007 R0048
      *                                                                   R0048
     C                     Z-ADDWWFXLI    ZFLD15                          R0048
     C                     EXSR ZSEDIT                                    R0048
     C                     MOVE ZOUT21    WWLFXL 16                       R0048
     C*                                                                   LB0007
     C**   ACCRUED INTEREST DR
     C           WWTACD    IFLT 0                                         LB0000
     C                     Z-SUBWWTACD    WWFLD2                          LB0000
     C                     ELSE                                           LB0000
     C                     Z-ADDWWTACD    WWFLD2
     C                     END                                            LB0000
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLADR 16
     C*
     C**   ACCRUED INTEREST CR
     C           WWTACC    IFLT 0                                         LB0000
     C                     Z-SUBWWTACC    WWFLD2                          LB0000
     C                     ELSE                                           LB0000
     C                     Z-ADDWWTACC    WWFLD2
     C                     END                                            LB0000
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWLACR 16
     C*                                                                   R0729
     C**   OPEN PRECIOUS METALS LOSS                                      R0729
     C                     Z-ADDWWLSPM    WWFLD2                          R0729
     C                     EXSR #BBBA                                     R0729
     C                     MOVE ZOUT21    WWLLSM 16                       R0729
     C*                                                                   R0729
     C**   OPEN PRECIOUS METALS PROFIT                                    R0729
     C                     Z-ADDWWPRPM    WWFLD2                          R0729
     C                     EXSR #BBBA                                     R0729
     C                     MOVE ZOUT21    WWLPRM 16                       R0729
     C*                                                                   R0729
     C**   NET PRECIOUS METALS                                            R0729
     C                     Z-ADDWWNPMM    WWFLD2                          R0729
     C                     EXSR #BBBA                                     R0729
     C                     MOVE ZOUT21    WWLNFM 16                       R0729
     C*                                                                   R0729
     C**   MARGIN TAKEN                                                   R0729
     C                     Z-ADDWWMAPM    WWFLD2                          R0729
     C                     EXSR #BBBA                                     R0729
     C                     MOVE ZOUT21    WWLMTM 16                       R0729
     C*                                                                   R0170
     C**   FX EXPOSURE                                                    R0170
     C                     Z-ADDWWEXPF    WWFLD2                          R0170
     C                     EXSR #BBBA                                     R0170
     C                     MOVE ZOUT21    WWLEXF 16                       R0170
     C*                                                                   R0170
     C**   pM EXPOSURE                                                    R0170
     C                     Z-ADDWWEXPM    WWFLD2                          R0170
     C                     EXSR #BBBA                                     R0170
     C                     MOVE ZOUT21    WWLEXM 16                       R0170
     C*                                                                   R0729
     C***  PRECIOUS METALS LINE   = MARGIN TAKEN  *  100            R0729 SA9018
     C***                           ------------                    R0729 SA9018
     C***                             MARGIN %                      R0729 SA9018
     C***                                                           R0729 SA9018
     C***                  Z-ADD*ZEROS    WWWRKN                    R0729 SA9018
     C***        LBPMCP    IFNE *ZEROS                              R0729 SA9018
     C***        WWMAPM    MULT 100       WWWRKN                    R0729 SA9018
     C***        WWWRKN    DIV  LBPMCP    WWWRKN                    R0729 SA9018
     C***                  END                                      R0729 SA9018
     C*                                                                   SA9018
     C***  PRECIOUS METALS LINE                                           SA9018
     C**                   Z-ADDWWPMLI    WWFLD2                    R0729 R0064
     C**                   EXSR #BBBA                               R0729 R0064
     C**                   MOVE ZOUT21    WWLFML 16                 R0729 R0064
     C                     Z-ADDWWPMLI    ZFLD15                          R0064
     C                     EXSR ZSEDIT                                    R0064
     C                     MOVE ZOUT21    WWLFML 16                       R0064
     C*                                                                   SA9018
     C**   AVAILABLE FOREX                                                SA9018
     C***********FAMM      IFNE *ZEROS                             B7838  S01498
     C           DZFXFA    IFNE *ZEROS                                    S01498
     C           S01433    ANDEQ'Y'                                       087631
     C           DZFLAM    ORNE *ZEROS                                    087631
     C           S01433    ANDNE'Y'                                       087631
     C                     Z-ADDWWAAFX    WWFLD2                          SA9018
     C                     ELSE                                           B7838
     C                     Z-ADD*ZEROS    WWFLD2                          B7838
     C                     END                                            B7838
     C                     EXSR #BBBA                                     SA9018
     C                     MOVE ZOUT21    WWLAFX 16                       SA9018
     C*                                                                   SA9018
     C**   AVAILABLE PRECIOUS METALS                                      SA9018
     C***********LIPSAM    IFNE *ZEROS                             B7838  S01498
     C           DZPFAM    IFNE *ZEROS                                    S01498
     C           S01433    ANDEQ'Y'                                       087631
     C                     Z-ADDWWAAPM    WWFLD2                          SA9018
     C                     ELSE                                           B7838
     C                     Z-ADD*ZEROS    WWFLD2                          B7838
     C                     END                                            B7838
     C                     EXSR #BBBA                                     SA9018
     C                     MOVE ZOUT21    WWLAPM 16                       SA9018
     C*                                                                   SA9018
     C*
     C**   IF PORTFOLIO LENDING CURRENCY IS EQUAL TO CUSTOMER CURRENCY, THERE IS
     C**   NO NEED TO 'CALCULATE' CUSTOMER CURRENCY, SIMPLY USE
     C**   PORTFOLIO LENDING CURRENCY VALUES
     C***********LBCCY     IFEQ CUCCY                                     S01498
     C           LBCYCD    IFEQ CUCCY                                     S01498
     C*
     C                     MOVELWWLCML    WWCCML 16
     C                     MOVELWWLTEX    WWCTEX 16
     C                     MOVELWWLTCL    WWCTCL 16
     C                     MOVELWWLOEX    WWCOEX 16
     C                     MOVELWWLOCL    WWCOCL 16
     C                     MOVELWWLPEX    WWCPEX 16
     C                     MOVELWWLPRC    WWCPRC 16
     C                     MOVELWWLUPR    WWCUPR 16
     C                     MOVELWWLABR    WWCABR 16
     C                     MOVELWWLBPW    WWCBPW 16
     C                     MOVELWWLALN    WWCALN 16
     C                     MOVELWWLLPW    WWCLPW 16
     C                     MOVELWWLLOS    WWCLOS 16
     C                     MOVELWWLTOT    WWCTOT 16
     C                     MOVELWWLPRF    WWCPRF 16
     C                     MOVELWWRCSP    WWAMAL 16
     C                     MOVELWWLNFX    WWCNFX 16
     C*******              MOVELWWLOLN    WWCOLN 16
     C                     MOVELWWLMTK    WWCMTK 16
     C                     MOVELWWLFXL    WWCFXL 16                       LB0007
     C                     MOVELWWLADR    WWCADR 16
     C                     MOVELWWLACR    WWCACR 16                       R0729
     C                     MOVELWWLLSM    WWCLSM 16
     C                     MOVELWWLPRM    WWCPRM 16
     C                     MOVELWWLNFM    WWCNFM 16
     C                     MOVELWWLMTM    WWCMTM 16
     C                     MOVELWWLFML    WWCFML 16
     C                     MOVELWWLAFX    WWCAFX 16                       SA9018
     C                     MOVELWWLAPM    WWCAPM 16                       SA9018
     C                     MOVELWWLEXF    WWCEXF 16                       R0170
     C                     MOVELWWLEXM    WWCEXM 16                       R0170
     C*
     C                     ELSE
     C*
     C                     Z-ADDA6SPRT    WWSRO
     C                     Z-ADDA6NBDP    WWDPO
     C                     MOVE A6MDIN    WWMDO
     C*
     C                     Z-ADDWWDICU    WWDVFD
     C*
     C**   COMMITMENT LINE
     C                     Z-ADDWWCMTL    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCCML
     C*
     C**   TOTAL EXPOSURE
     C                     Z-ADDWWTEXP    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCTEX
     C*
     C**   TOTAL COLLATERAL
     C                     Z-ADDWWTCLL    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCTCL
     C*
     C**   OWN EXPOSURE
     C                     Z-ADDWWOWEX    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCOEX
     C*
     C**   OWN COLLATERAL
     C                     Z-ADDWWOWCO    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCOCL
     C*
     C**   PLEDGE EXPOSURE
     C                     Z-ADDWWTPIU    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCPEX
     C*
     C**   PLEDGES RECEIVED
     C******************   Z-ADDWWTPRD    WWAMTI                          R0673
     C                     Z-ADDWWTPRD    WWAMTI     61                   R0673
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCPRC
     C*
     C**   USE OF PLEDGES RECEIVED
     C                     Z-ADDWWTPRV    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCUPR
     C*
     C**   AVAILABLE BORROWING
      *                                                                   R0673
     C                     ADD  WWTPRD    WWABRW                          R0673
     C                     SUB  WWTPRV    WWABRW                          R0673
      *                                                                   R0673
     C                     Z-ADDWWABRW    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCABR
     C*
     C**   BORROWING POWER
     C                     Z-ADDWWBPWR    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCBPW
     C*
     C**   AVAILABLE LENDING
     C                     Z-ADDWWALND    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCALN
     C*
     C**   LENDING POWER
     C                     Z-ADDWWLPWR    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCLPW
     C*
     C**   OPEN FOREIGN EXCHANGE LOSS
     C                     Z-ADDWWLOSS    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCLOS
     C*
     C**   EQUITY TOTAL
     C                     Z-ADDWWETOT    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCTOT
     C*
     C**   OPEN FOREIGN EXCHANGE PROFIT
     C                     Z-ADDWWPROF    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCPRF
     C*
     C**   CUSTOMER EQUITY
     C                     Z-ADDWWCSTE    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWAMAL
     C*
     C**   NET FOREIGN EXCHANGE
     C                     Z-ADDWWNFEX    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCNFX
     C*
     C*****OFFSET LENDING
     C*******              Z-ADDWWOLND    WWAMTI
     C*******              EXSR SCONV
     C*******              Z-ADDWWAMTO    WWFLD2
     C*******
     C*******              EXSR #BBBA
     C*******
     C*******              MOVE ZOUT21    WWCOLN
     C*
     C**   MARGIN TAKEN
     C                     Z-ADDWWMARG    WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCMTK
     C*
     C***  FOREX LINE   = MARGIN TAKEN  *  100                      LB0007B10527
     C***                 ------------                              LB0007B10527
     C***                  MARGIN %                                 LB0007B10527
     C***                                                           LB0007B10527
     C                     Z-ADD*ZEROS    WWWRKN 180                      LB0007
     C***        LBFXCP    IFNE *ZEROS                              LB0007B10527
     C***        WWAMTO    MULT 100       WWWRKN                    LB0007B10527
     C***        WWWRKN    DIV  LBFXCP    WWWRKN                    LB0007B10527
     C***                  END                                      LB0007B10527
     C***                  Z-ADDWWWRKN    WWFLD2                    LB0007B10527
     C***                                                           LB0007B10527
     C***                  EXSR #BBBA                               LB0007B10527
     C***                                                           LB0007B10527
     C***                  MOVE ZOUT21    WWCFXL                    LB0007B10527
     C*                                                                   B10527
     C**   FOREX LINE FROM LIMIT FILE                                     B10527
     C                     Z-ADDWW1XLI    WWAMTI                          B10527
     C                     EXSR SCONV                                     B10527
     C                     Z-ADDWWAMTO    WWFLD2                          B10527
     C                     EXSR #BBBA                                     B10527
     C                     MOVE ZOUT21    WWCFXL                          B10527
     C*                                                                   B10527
     C**   EXPOSURE                                                       B10527
     C                     Z-ADDWWEXPF    WWAMTI                          B10527
     C                     EXSR SCONV                                     B10527
     C                     Z-ADDWWAMTO    WWFLD2                          B10527
     C                     EXSR #BBBA                                     B10527
     C                     MOVE ZOUT21    WWCEXF                          B10527
     C***                                                                 B10527
     C**   ACCRUED INTEREST DR
     C           WWTACD    IFLT 0                                         LB0000
     C                     Z-SUBWWTACD    WWAMTI                          LB0000
     C                     ELSE                                           LB0000
     C                     Z-ADDWWTACD    WWAMTI
     C                     END                                            LB0000
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCADR
     C*
     C**   ACCRUED INTEREST CR
     C           WWTACC    IFLT 0                                         LB0000
     C                     Z-SUBWWTACC    WWAMTI                          LB0000
     C                     ELSE                                           LB0000
     C                     Z-ADDWWTACC    WWAMTI
     C                     END                                            LB0000
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWFLD2
     C*
     C                     EXSR #BBBA
     C*
     C                     MOVE ZOUT21    WWCACR
     C*                                                                   R0729
     C**   OPEN PRECIOUS METALS LOSS                                      R0729
     C                     Z-ADDWWLSPM    WWAMTI                          R0729
     C                     EXSR SCONV                                     R0729
     C                     Z-ADDWWAMTO    WWFLD2                          R0729
     C                     EXSR #BBBA                                     R0729
     C                     MOVE ZOUT21    WWCLSM                          R0729
     C*                                                                   R0729
     C**   OPEN PRECIOUS METALS PROFIT                                    R0729
     C                     Z-ADDWWPRPM    WWAMTI                          R0729
     C                     EXSR SCONV                                     R0729
     C                     Z-ADDWWAMTO    WWFLD2                          R0729
     C                     EXSR #BBBA                                     R0729
     C                     MOVE ZOUT21    WWCPRM                          R0729
     C*                                                                   R0729
     C**   NET PRECIOUS METALS                                            R0729
     C                     Z-ADDWWNPMM    WWAMTI                          R0729
     C                     EXSR SCONV                                     R0729
     C                     Z-ADDWWAMTO    WWFLD2                          R0729
     C                     EXSR #BBBA                                     R0729
     C                     MOVE ZOUT21    WWCNFM                          R0729
     C*                                                                   R0729
     C**   MARGIN TAKEN                                                   R0729
     C                     Z-ADDWWMAPM    WWAMTI                          R0729
     C                     EXSR SCONV                                     R0729
     C                     Z-ADDWWAMTO    WWFLD2                          R0729
     C                     EXSR #BBBA                                     R0729
     C                     MOVE ZOUT21    WWCMTM                          R0729
     C*                                                                   R0729
     C**   PRECIOUS METALS LINE                                           R0729
     C                     Z-ADD*ZEROS    WWWRKN                          R0729
     C           LBPMCP    IFNE *ZEROS                                    R0729
     C           S01433    ANDEQ'Y'                                       087631
     C           WWAMTO    MULT 100       WWWRKN                          R0729
     C           WWWRKN    DIV  LBPMCP    WWWRKN                          R0729
     C                     ELSE                                           087631
     C                     Z-ADD*ZEROS    WWWRKN                          087631
     C                     END                                            R0729
     C                     Z-ADDWWWRKN    WWFLD2                          R0729
     C                     EXSR #BBBA                                     R0729
     C                     MOVE ZOUT21    WWCFML                          R0729
     C*                                                                   SA9018
     C**   AVAILABLE FOREX                                                SA9018
     C***********FAMM      IFNE *ZEROS                             B7838  S01498
     C           DZFXFA    IFNE *ZEROS                                    S01498
     C           S01433    ANDEQ'Y'                                       087631
     C           DZFLAM    ORNE *ZEROS                                    087631
     C           S01433    ANDNE'Y'                                       087631
     C                     Z-ADDWWAAFX    WWAMTI                          SA9018
     C                     ELSE                                           B7838
     C                     Z-ADD*ZEROS    WWAMTI                          B7838
     C                     END                                            B7838
     C                     EXSR SCONV                                     SA9018
     C                     Z-ADDWWAMTO    WWFLD2                          SA9018
     C                     EXSR #BBBA                                     SA9018
     C                     MOVE ZOUT21    WWCAFX                          SA9018
     C*                                                                   SA9018
     C**   AVAILABLE PRECIOUS METALS                                      SA9018
     C***********LIPSAM    IFNE *ZEROS                             B7838  S01498
     C           DZPFAM    IFNE *ZEROS                                    S01498
     C           S01433    ANDEQ'Y'                                       087631
     C                     Z-ADDWWAAPM    WWAMTI                          SA9018
     C                     ELSE                                           B7838
     C                     Z-ADD*ZEROS    WWAMTI                          B7838
     C                     END                                            B7838
     C                     EXSR SCONV                                     SA9018
     C                     Z-ADDWWAMTO    WWFLD2                          SA9018
     C                     EXSR #BBBA                                     SA9018
     C                     MOVE ZOUT21    WWCAPM                          SA9018
     C*
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BC       - THIS SUBROUTINE PERFORMS CMD11 PROCESSING           *
     C**                                                                 *
     C** CALLS     - NONE                                                *
     C**                                                                 *
     C** CALLED BY - #B                                                  *
     C**                                                                 *
     C********************************************************************
     C           #BC       BEGSR
     C*
     C**   IF CUSTOMER CURRENCY DISPLAY NECESSARY FIELDS
     C**   ELSE DISPLAY PORTFOLIO LENDING CURRENCY FIELDS
     C           WWCUFG    IFEQ 'CU'
     C*
     C***********          MOVELLBCCY     DD2CCY                          S01498
     C                     MOVELLBCYCD    DD2CCY                          S01498
     C*
     C                     MOVELWWLCML    DD2CML
     C                     MOVELWWLTEX    DD2TEX
     C                     MOVELWWLTCL    DD2TCL
     C                     MOVELWWLOEX    DD2OEX
     C                     MOVELWWLOCL    DD2OCL
     C                     MOVELWWLPEX    DD2PEX
     C                     MOVELWWLPRC    DD2PRC
     C                     MOVELWWLUPR    DD2UPR
     C                     MOVELWWLABR    DD2ABR
     C                     MOVELWWLBPW    DD2BPW
     C                     MOVELWWLALN    DD2ALN
     C                     MOVELWWLLPW    DD2LPW
     C                     MOVELWWLLOS    DD2LOS
     C                     MOVELWWLTOT    DD2TOT
     C                     MOVELWWLPRF    DD2PRF
     C                     MOVELWWRCSP    DD2CST
     C                     MOVELWWLNFX    DD2NFX
     C*******              MOVELWWLOLN    DD2OLN
     C                     MOVELWWLMTK    DD2MTK
     C                     MOVELWWLFXL    DD2FXL                          LB0007
     C                     MOVELWWLADR    DD2ADR
     C                     MOVELWWLACR    DD2ACR
     C                     MOVELWWLLSM    DD2LSM                          R0729
     C                     MOVELWWLPRM    DD2PRM                          R0729
     C                     MOVELWWLNFM    DD2NFM                          R0729
     C                     MOVELWWLMTM    DD2MTM                          R0729
     C                     MOVELWWLFML    DD2FML                          R0729
     C                     MOVELWWLAFX    DD2AFX                          SA9018
     C                     MOVELWWLAPM    DD2AFM                          SA9018
     C                     MOVELWWLEXF    DD2EXF                          R0170
     C                     MOVELWWLEXM    DD2EXM                          R0170
     C*
     C                     MOVEL'LB'      WWCUFG
     C*
     C                     ELSE
     C*
     C                     MOVELCUCCY     DD2CCY
     C*
     C                     MOVELWWCCML    DD2CML
     C                     MOVELWWCTEX    DD2TEX
     C                     MOVELWWCTCL    DD2TCL
     C                     MOVELWWCOEX    DD2OEX
     C                     MOVELWWCOCL    DD2OCL
     C                     MOVELWWCPEX    DD2PEX
     C                     MOVELWWCPRC    DD2PRC
     C                     MOVELWWCUPR    DD2UPR
     C                     MOVELWWCABR    DD2ABR
     C                     MOVELWWCBPW    DD2BPW
     C                     MOVELWWCALN    DD2ALN
     C                     MOVELWWCLPW    DD2LPW
     C                     MOVELWWCLOS    DD2LOS
     C                     MOVELWWCTOT    DD2TOT
     C                     MOVELWWCPRF    DD2PRF
     C                     MOVELWWAMAL    DD2CST
     C                     MOVELWWCNFX    DD2NFX
     C*******              MOVELWWCOLN    DD2OLN
     C                     MOVELWWCMTK    DD2MTK
     C                     MOVELWWCFXL    DD2FXL                          LB0007
     C                     MOVELWWCADR    DD2ADR
     C                     MOVELWWCACR    DD2ACR
     C                     MOVELWWCLSM    DD2LSM                          R0729
     C                     MOVELWWCPRM    DD2PRM                          R0729
     C                     MOVELWWCNFM    DD2NFM                          R0729
     C                     MOVELWWCMTM    DD2MTM                          R0729
     C                     MOVELWWCFML    DD2FML                          R0729
     C                     MOVELWWCAFX    DD2AFX                          SA9018
     C                     MOVELWWCAPM    DD2AFM                          SA9018
     C                     MOVELWWCEXF    DD2EXF                          R0170
     C                     MOVELWWCEXM    DD2EXM                          R0170
     C*
     C                     MOVEL'CU'      WWCUFG
     C*
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BD       - THIS SUBROUTINE PERFORMS CMD12 PROCESSING           *
     C**                                                                 *
     C** CALLS     - NONE                                                *
     C**                                                                 *
     C** CALLED BY - #B                                                  *
     C**                                                                 *
     C********************************************************************
     C           #BD       BEGSR
     C*
     C           WWMNUF    IFEQ '1'
     C           WWMNUF    OREQ '2'                                       R01118
     C*
     C                     Z-ADD12        WWFNCT
     C                     MOVE '1'       *INKC
     C                     ELSE
     C*
     C**   SET OFF SCREEN 2 & 'NOTES/NEXT DATE' DISPLAY INDICATORS
     C**   INITIALISE TOTAL FIELDS, AND CURRENCY FLAG TO 'LB'
     C                     MOVE '0'       *IN60
     C                     MOVE '0'       *IN65
     C*
     C                     MOVEL*BLANKS   WWSCNS
     C*
     C                     MOVEL*BLANKS   WWCMTL
     C                     MOVEL*BLANKS   WWTEXP
     C                     MOVEL*BLANKS   WWTCLL
     C                     MOVEL*BLANKS   WWOWEX
     C                     MOVEL*BLANKS   WWOWCO
     C                     MOVEL*BLANKS   WWTPIU
     C                     MOVEL*BLANKS   WWTPRD
     C                     MOVEL*BLANKS   WWTPRV
     C                     MOVEL*BLANKS   WWABRW
     C                     MOVEL*BLANKS   WWBPWR
     C                     MOVEL*BLANKS   WWALND
     C                     MOVEL*BLANKS   WWLPWR
     C                     MOVEL*BLANKS   WWLOSS
     C                     MOVEL*BLANKS   WWETOT
     C                     MOVEL*BLANKS   WWPROF
     C                     MOVEL*BLANKS   WWCSTE
     C                     MOVEL*BLANKS   WWNFEX
     C*******              MOVEL*BLANKS   WWOLND
     C                     MOVEL*BLANKS   WWMARG
     C                     MOVEL*BLANKS   WWTACD
     C                     MOVEL*BLANKS   WWTACC
     C                     MOVEL*BLANKS   WWLSPM                          R0729
     C                     MOVEL*BLANKS   WWPRPM                          R0729
     C                     MOVEL*BLANKS   WWNPMM                          R0729
     C                     MOVEL*BLANKS   WWMAPM                          R0729
     C                     MOVEL*BLANKS   WWAAFX                          SA9018
     C                     MOVEL*BLANKS   WWAAPM                          SA9018
     C                     MOVEL*BLANKS   WWEXPF                          R0170
     C                     MOVEL*BLANKS   WWEXPM                          R0170
     C*
     C                     MOVEL'LB'      WWCUFG
     C***********          MOVELLBCCY     DD2CCY                          S01498
     C                     MOVELLBCYCD    DD2CCY                          S01498
     C*
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BBBA     - CURRENCY CONVERSION PROCESSING                      *
     C**                                                                 *
     C** CALLS     - ZSEDIT                                              *
     C**                                                                 *
     C** CALLED BY - #BBA, #BBA                                          *
     C**                                                                 *
     C********************************************************************
     C           #BBBA     BEGSR
     C*
     C                     DIV  1000      WWFLD2 150H
     C*
     C           WWDVFD    IFNE 0
     C                     DIV  WWDVFD    WWFLD2    H
     C                     END
     C*
     C                     Z-ADDWWFLD2    ZFLD15
     C*
     C                     EXSR ZSEDIT
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BE       - THIS SUBROUTINE PROCESSES CMD/23 TO CALL            *
     C**             PM ENQUIRIES PROGRAM - EXTENSIVE SECURITY CHECKS    *
     C**                                                                 *
     C** CALLS     - #BEA, #ZA, ZASNMS                                   *
     C**                                                                 *
     C** CALLED BY - #B                                                  *
     C**                                                                 *
     C********************************************************************
     C           #BE       BEGSR
     C           WWPROG    IFNE 'PM0630'                                  081239
     C*
     C** clear program message queue & borrowing power input field
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ
     C                     PARM           WWPGQR
     C                     MOVEA'00'      *IN,70
     C***CHECK*IF*GROUP*JOB*ACTIVE*OR*NOT************************* R0121  S01498
     C***********          CALL 'LBC0305A'                         R0121  S01498
     C***********          PARM           GRPJOB 10                R0121  S01498
     C***********GRPJOB    IFNE '*NONE'                            R0121  S01498
     C***********          MOVE '0'       *INKX                    R0121  S01498
     C***********          MOVE '1'       *INKC                    R0121  S01498
     C***********          MOVE 'Y'       WWCHCK                   R0121  S01498
     C***********          ELSE                                    R0121  S01498
     C*
     C** Test for Authority to view enquiries.
     C** Is customer a Portfolio Management Customer, otherwise error.
     C***********BBCUST    CHAINSDPLCSL0             47                   S01498
     C*
     C                     CALL 'AOPLCSR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BBCUST    P@CUST 10                       S01498
     C           SDPLCS    PARM SDPLCS    DSFDY                           S01498
     C*                                                                   S01498
     C** If record not found - return error.
     C************IN47     IFEQ '1'                                       S01498
     C***********QBRECI    ORNE 'D'                                       S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C********** QBPCUS    ORNE 'Y'                                       S01498
     C                     MOVEL'LBM0068' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEA'11'      *IN,70
     C                     GOTO #BE0
     C                     END
     C*
     C***********1         CHAINSDPORTPD             48                   S01498
     C*
     C**IF*NOT*FOUND*OR*LAST*CHANGE*TYPE*=*'D'**THEN*DB*ERROR**********   S01498
     C************IN48     IFEQ '1'                                       S01498
     C***********P9ADST    OREQ 'D'                                R01293 S01498
     C*
     C** Get Portfolio Management ICD details using access object         S01498
     C*                                                                   S01498
     C                     CALL 'AOPORTR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*FIRST ' P@OPTN                          S01498
     C           SDPORT    PARM SDPORT    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '009'     DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDPORTPD'DBFILE           ** DBERROR 009 S01498
     C                     MOVE 'SDPORTPD'DBFILE           ** DBERROR 009 S01498
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     MOVEL'LB0310'  DBPGM
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     END
     C*
     C** If High Level Security required, continue security checking.
     C***********P9HLVS    IFEQ 'Y'                                       S01498
     C           FCHLVS    IFEQ 'Y'                                       S01498
     C*
     C***********WWUSRP    CHAINMUSER                44                   S01498
     C************IN44     IFEQ '1'                                       S01498
     C***********CHTP      OREQ 'D'                                       S01498
     C***********RECI      ORNE 'D'                                       S01498
     C*
     C** Get user details using access object                             S01498
     C*                                                                   S01498
     C                     CALL 'AOUSERR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM WWUSRP    P@UPRF 10                       S01498
     C           SDUSER    PARM SDUSER    DSSDY                           S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '007'     DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'MUSER   'DBFILE           ** DBERROR 007 S01498
     C                     MOVE 'MUSERDD 'DBFILE           ** DBERROR 007 S01498
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     MOVELWWUSRP    DBKEY
     C                     MOVEL'LB0310'  DBPGM
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     END
     C*
     C** If user has an account officer check if the a/c officer is
     C** authorised to view customer portfolio details.
     C***********ACOC      IFNE *BLANKS                                   S01498
     C***********ACOF      IFNE *BLANKS                             S01498083547
     C           ACFA      IFNE *BLANKS                                   083547
     C*
     C***********ACOC      IFNE '*A'                                      S01498
     C***********ACOC      ANDNEBBACOC                                    S01498
     C***********ACOF      IFNE '*A'                                S01498083547
     C***********ACOF      ANDNEBBACOC                              S01498083547
     C           ACFA      IFNE 'ALL'                                     083547
     C           ACFA      ANDNEBBACOC                                    083547
     C*
     C** Account Officer not authorised to view portfolio details
     C                     MOVEL'LBM0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEA'11'      *IN,70
     C                     GOTO #BE0
     C                     END
     C*
     C                     ELSE
     C*
     C***********BBACOC    CHAINSDACOFL1             54                   S01498
     C************IN54     IFEQ '1'                                       S01498
     C***********AZTYLC    OREQ 'D'                                    ***S01498
     C*
     C*                                                                   S01498
     C** Get account officer details using access object                  S01498
     C*                                                                   S01498
     C                     CALL 'AOACOFR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BBACOC    P@ACOC  2                       S01498
     C           SDACOF    PARM SDACOF    DSFDY                           S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE '008'     DBASE
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDACOFL1'DBFILE           ** DBERROR 008 S01498
     C                     MOVE 'SDACOFPD'DBFILE           ** DBERROR 008 S01498
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     MOVELBBACOC    DBKEY
     C                     MOVEL'LB0310'  DBPGM
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C                     END
     C*
     C***********AZDPCD    IFNE DEPC                                      S01498
     C           AZDPCD    IFNE DPPT                                      S01498
     C                     MOVEL'LBM0069' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVEA'11'      *IN,70
     C                     GOTO #BE0
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C** The user is authorised to Portfolio Management Enquiries.
     C***Change*current*job*to*become*a*Group*Job*called*CUSTOMER******   S01498
     C***********          MOVELARR,1     CMD    80                       S01498
     C***********          Z-ADD80        LEN    155                      S01498
     C***********          CALL 'QCMDEXC'                                 S01498
     C***********          PARM           CMD                             S01498
     C***********          PARM           LEN                             S01498
     C*
     C***Set*up*Group*Data*Area****************************************   S01498
     C*                                                                   S01498
     C** Set up DTAARA/*LDA                                               S01498
     C*                                                                   S01498
     C                     EXSR #BEA
     C*
     C***Write*to*Group*Data*Area**************************************   S01498
     C***********          CALL 'PMC1000'
     C***********          PARM           WWPARM
     C                     MOVELBBBRCD    QMBRCA                          086664
     C*
     C**   Write to Local Data Area
     C                     CALL 'PMC1001'
     C                     PARM           WWPLDA
     C*
     C*****Write*to*Group*Data*Area************************************   S01498
     C***********          CALL 'PMC1002'                                 S01498
     C***********          PARM           WWPGDA                          S01498
     C*
     C** Access Portfolio Management Enquiries
     C***********          CALL 'PMC0621'                          R0121  S01498
     C                     CALL 'PM0630'                                  S01498
     C                     PARM           WWUSRP                          S01498
     C*
     C***Access*Group*Data*Area****************************************   S01498
     C*
     C*****Retrieve*contents*of*Group*Data*Area*to*check*for*DBERROR***   S01498
     C*****(Nothing*required*from*WWPLDA)******************************   S01498
     C***********          CALL 'PMC1004'                                 S01498
     C***********          PARM           WWPGDA                          S01498
     C*
     C***********          MOVE ARR,2     CMD                             S01498
     C*                                                                   S01498
     C** Retrieve contents of DTAARA/*LDA                                 S01498
     C*                                                                   S01498
     C                     CALL 'PMC1003'                                 S01498
     C                     PARM           WWPLDA                          S01498
     C*
     C***If*database*error*condition*exists*load*required*error********   S01498
     C***Information*from**GDA*to*the*LDA******************************   S01498
     C*                                                                   S01498
     C** If database error exists, load information from *LDA             S01498
     C*                                                                   S01498
     C           QMDBER    IFEQ 'Y'
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVELQMPGM     DBPGM            *****************
     C***********          MOVELQMFILE    DBFILE           ** DBERROR xxx S01498
     C                     MOVE QMFILE    DBFILE           ** DBERROR xxx S01498
     C                     MOVE QMERRN    DBASE            ***************R0121
     C                     MOVE QMKEY     DBKEY
     C*
     C***Change*current*job*to*become*a*NON-Group*Job******************   S01498
     C***********          CALL 'QCMDEXC'                                 S01498
     C***********          PARM           CMD                             S01498
     C***********          PARM           LEN                             S01498
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
     C*
     C                     ELSE
     C*                                                                   081239
     C** If customer selection requested                                  081239
     C*                                                                   081239
     C********** QMENQT    IFEQ 'C'                                                    081239 CAAA03
     C           QMENQT    IFEQ 'P'                                                           CAAA03
     C                     MOVE '1'       *INKL                           081239
     C                     MOVE '1'       *IN60                                               CAAA03
     C                     MOVE '2'       WWFMT                                               CAAA03
     C                     END                                            081239
     C*
     C** If enquiries terminating flag in *GDA = 'Y' then end pgm
     C           QMENQT    IFEQ 'Y'
     C                     Z-ADD3         WWFNCT
     C*
     C***Change*current*job*to*become*a*NON-Group*Job******************   S01498
     C***********          CALL 'QCMDEXC'                                 S01498
     C***********          PARM           CMD                             S01498
     C***********          PARM           LEN                             S01498
     C                     EXSR #ZAA
     C                     END
     C*
     C                     END
     C*
     C***Change*current*job*to*become*a*NON-Group*Job******************   S01498
     C***********          CALL 'QCMDEXC'                                 S01498
     C***********          PARM           CMD                             S01498
     C***********          PARM           LEN                             S01498
     C**                                                                  R0121
     C***********          END                                     R0121  S01498
     C                     ELSE                                           081239
     C                     CALL 'PMC1003'                                 081239
     C                     PARM           WWPLDA                          081239
     C                     MOVEL'R'       QMENQT                          081239
     C                     CALL 'PMC1001'                                 081239
     C                     PARM           WWPLDA                          081239
     C                     MOVE '1'       *INLR                           081239
     C                     RETRN                                          081239
     C                     END                                            081239
     C*
     C           #BE0      ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BEA      - THIS SUBROUTINE LOADS THE GROUP DATA AREA           *
     C**                                                                 *
     C** CALLS     - NONE                                                *
     C**                                                                 *
     C** CALLED BY - #BE                                                 *
     C**                                                                 *
     C********************************************************************
     C           #BEA      BEGSR
     C                     MOVE ' '       QMRECI
     C                     MOVE BJMRDT    QMRUNA
     C                     Z-ADDBJRDNB    QMRDNB
     C                     MOVE BJCYCD    QMCYCD                          R00266
     C                     MOVE 'T'       QMTVPS
     C                     MOVE BBCUST    QMCNUM
     C                     MOVE BBCRNM    QMCRNM
     C                     MOVE QBCSBY    QMCSBY
     C                     Z-ADDQBBYDP    QMBYDP
     C***********BBCNCZ    CHAINSDCTRYL1             45                   S01498
     C*                                                                   S01498
     C** Get country code details using access object                     S01498
     C*                                                                   S01498
     C                     CALL 'AOCTRYR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BBCNCZ    P@CNCZ  2                       S01498
     C           SDCTRY    PARM SDCTRY    DSFDY                           S01498
     C*                                                                   S01498
     C************IN45     IFEQ '0'                                       S01498
     C***********A4TYLC    ANDNE'D'                                       S01498
     C           P@RTCD    IFEQ *BLANKS                                   S01498
     C                     MOVE A4CNNM    QMNCTX
     C                     ELSE
     C                     MOVE *BLANKS   QMNCTX
     C                     END
     C***********BBCOLC    CHAINSDCTRYL1             45                   S01498
     C*                                                                   S01498
     C** Get country code details using access object                     S01498
     C*                                                                   S01498
     C                     CALL 'AOCTRYR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BBCOLC    P@CNCZ  2                       S01498
     C           SDCTRY    PARM SDCTRY    DSFDY                           S01498
     C*                                                                   S01498
     C************IN45     IFEQ '0'                                       S01498
     C***********A4TYLC    ANDNE'D'                                       S01498
     C***********          MOVE A4CNNM    QMWADT                          R00266
     C           P@RTCD    IFEQ *BLANKS                                   S01498
     C                     MOVE A4CNNM    QMDCTX                          R00266
     C                     ELSE
     C***********          MOVE *BLANKS   QMWADT                          R00266
     C                     MOVE *BLANKS   QMDCTX                          R00266
     C                     END
     C                     MOVE QBLANG    QMLANG
     C*
     C** DATE OF BIRTH
     C***********          Z-ADDQBBDAT    WWDAT1                          086663
     C***********                                                         086663
     C***********WWMON1    IFGT 0                                         086663
     C***********                                                         086663
     C***********          Z-ADDWWMON1    X       20                      086663
     C***********          Z-ADDWWDAY1    WWDAY2                          086663
     C***********          Z-ADDWWYER1    WWYER2                          086663
     C***********          MOVELZMNM,X    WWMON2                          086663
     C***********                                                         086663
     C***********          MOVE WWDAT2    QMBDA1                          086663
     C***********          ELSE                                           086663
     C***********          MOVE *BLANKS   QMBDA1                          086663
     C***********          END                                            086663
     C*                                                                   086663
     C** CASE: DB1.Date of Birth (Portfolio) is Zero                      086663
     C*                                                                   086663
     C           QBBDAT    IFEQ *ZERO                                     086663
     C                     MOVEL*BLANKS   QMBDA1                          086663
     C                     ELSE                                           086663
     C*                                                                   086663
     C** CASE: Check File Date - Rundate  *                               086663
     C*                                                                   086663
     C                     Z-ADDQBBDAT    ZDAYNO  50                      086663
     C                     EXSR ZDATE2                                    086663
     C***********          MOVELZDATE     QMBDA1                    086663092955
     C                     MOVELZADATE    QMBDA1                          092955
     C                     END                                            086663
     C*
     C                     MOVE BBACOC    QMACOC
     C***********BBACOC    CHAINSDACOFL1             54                   S01498
     C************IN54     IFEQ '0'                                       S01498
     C***********AZTYLC    ANDNE'D'                                       S01498
     C*                                                                   S01498
     C** Get account officer details using access object                  S01498
     C*                                                                   S01498
     C                     CALL 'AOACOFR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM BBACOC    P@ACOC                          S01498
     C           SDACOF    PARM SDACOF    DSFDY                           S01498
     C*                                                                   S01498
     C           P@RTCD    IFEQ *BLANKS                                   S01498
     C                     MOVE AZACON    QMACON
     C                     ELSE
     C                     MOVE *BLANKS   QMACON
     C                     END
     C*
     C**   Date account officer assumed
     C****                 Z-ADDQBDASS    ZDAYNO                          S01313
     C****                 EXSR ZDATE2                                    S01313
     C****                 MOVE ZADATE    QMDTA1                          S01313
     C*
     C                     MOVE QBSAFI    QMSAFI
     C                     MOVE QBDCMS    QMDCMS
     C****                 MOVE QBFPVC    QMFPVC                          S01313
     C                     MOVE *BLANKS   QMPTF1
     C                     MOVE *BLANKS   QMPTF2
     C                     MOVE *BLANKS   QMPTFN
     C                     MOVE *BLANKS   QMTPMV
     C                     MOVE *BLANKS   QMVPMV
     C***********          MOVE *BLANKS   QMPTA1                          R00266
     C                     MOVE *BLANKS   QMPTAI                          R00266
     C                     MOVE *BLANKS   QMPVAI                          R00266
     C                     MOVE *BLANKS   QMPTCY
     C                     Z-ADD*ZEROS    QMPCDP
     C                     MOVE *BLANKS   QMPTFT
     C                     MOVE *BLANKS   QMDPO1
     C                     MOVE *BLANKS   QMPPDG
     C                     MOVE *BLANKS   QMDSPG
     C                     MOVE *BLANKS   QMNDSP
     C                     MOVE *BLANKS   QMDSPT
     C                     Z-ADD*ZEROS    QMDSPS
     C                     MOVE *BLANKS   QMDGMV
     C                     MOVE *BLANKS   QMDGAI
     C                     MOVE *BLANKS   QMINNR
     C                     MOVE *BLANKS   QMISTN
     C                     Z-ADD*ZEROS    QMITDS
     C                     MOVE *BLANKS   QMTIMV
     C                     MOVE *BLANKS   QMVIMV
     C                     MOVE *BLANKS   QMITAI
     C                     MOVE *BLANKS   QMIVAI                          R00266
     C                     MOVE *BLANKS   QMMODI
     C                     MOVE *BLANKS   QMSESN
     C**********           Z-ADD*ZEROS    QMTRNB                                              CLE148
     C                     MOVEL*BLANKS   QMTRNB                                              CLE148
     C***********          MOVE 'N'       QMENQT                          R00266
     C***********          MOVE 'N'       QMDBER                          R00266
     C                     MOVE *BLANKS   QMENQT                          R00266
     C                     MOVE *BLANKS   QMDBER                          R00266
     C                     MOVE 'N'       QMATTN
     C                     MOVE *BLANKS   QMPGM
     C                     MOVE *BLANKS   QMFILE
     C                     MOVE *BLANKS   QMKEY
     C                     Z-ADD*ZEROS    QMERRN
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BF       - THIS SUBROUTINE PROCESSES CMD/24 TO CALL PM0160     *
     C**                                                                 *
     C** CALLS     - #ZA, #ZAA                                           *
     C**                                                                 *
     C** CALLED BY - #B                                                  *
     C**                                                                 *
     C********************************************************************
     C           #BF       BEGSR
     C*
     C                     MOVE 'E'       WWPMD1  1
     C                     MOVE '0'       WWPMD2  1
     C                     MOVE DD2CUS    WWPMD3  6
     C                     MOVE 'I'       WWPMD4  1
     C***********          UNLCKDTAR                                      S01498
     C                     UNLCKLDA                                       S01498
     C*********************CALL 'PM0160'                                  R0119
     C                     CALL 'PMC0160'                                 R0119
     C                     PARM           WWPMD1
     C                     PARM           WWPMD2
     C                     PARM           WWPMD3
     C                     PARM           WWPMD4
     C*
     C************LOCK     IN   DTAR                                      S01498
     C           *LOCK     IN   LDA                                       S01498
     C*
     C** If database error in called program
     C***********DBASE     IFGT 0                                         R0121
     C           DBASE     IFNE *BLANKS                                   R0121
     C           DBASE     ANDNE'000'                                     B9415
     C                     EXSR #ZA
     C                     END
     C*
     C** Set PM Documentation program called flag to Y
     C                     MOVE 'Y'       WWPMDC
     C*
     C** If F3 was pressed in called program
     C           WWPMD2    IFEQ '1'
     C                     Z-ADD3         WWFNCT
     C                     EXSR #ZAA
     C                     END
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************LB0001
     C**                                                                 *LB0001
     C** #BG       - THIS SUBROUTINE CALLS PORTFOLIO LENDING ENQUIRY     *LB0001
     C**                                                                 *LB0001
     C** CALLS     - #ZA, #ZAA                                           *LB0001
     C**                                                                 *LB0001
     C** CALLED BY - #B                                                  *LB0001
     C**                                                                 *LB0001
     C********************************************************************LB0001
     C           #BG       BEGSR                                          LB0001
     C*                                                                   LB0001
     C           WWFNCT    IFNE 25                         -B1            LB0001
     C*                                                                   LB0001
     C                     MOVE '1'       WWPRM1  1                       LB0001
     C**********           MOVELDD1CSN    WWPRM2  60                                   LB0001 CSD027
     C                     MOVELDD1CSN    WWPRM2  6                                           CSD027
     C                     Z-ADD15        WWPRM3  20                      LB0001
     C*                                                                   LB0001
     C***********          UNLCKDTAR                               LB0001 S01498
     C                     UNLCKLDA                                LB0001 S01498
     C*                                                                   LB0001
     C                     CALL 'LB0305'                                  LB0001
     C                     PARM           WWPRM1                          LB0001
     C                     PARM           WWPRM2                          LB0001
     C                     PARM           WWPRM3                          LB0001
     C                     PARM           WWUSRP                          LB0001
     C                     PARM 'Y'       WWCALL  1                       R5514
     C*                                                                   LB0001
     C************LOCK     IN   DTAR                               LB0001 S01498
     C           *LOCK     IN   LDA                                LB0001 S01498
     C*                                                                   LB0001
     C***********DBASE     IFGT 0                          -B2            LB0001
     C           DBASE     IFNE *BLANKS                    -B2            LB0001
     C           DBASE     ANDNE'000'                                     B9415
     C                     EXSR #ZA                                       LB0001
     C                     END                             -E2            LB0001
     C*                                                                   LB0001
     C           WWPRM3    IFEQ 3                          -B2            LB0001
     C                     Z-ADD3         WWFNCT                          LB0001
     C                     EXSR #ZAA                                      LB0001
     C                     END                             -E2            LB0001
     C                     ELSE                            -X1            LB0001
     C                     MOVE '1'       *INLR                           LB0001
     C                     RETRN                                          LB0001
     C                     END                             -E1            LB0001
     C*                                                                   LB0001
     C                     ENDSR                                          LB0001
     C********************************************************************LB0001
     C/EJECT                                                              LB0001
     C********************************************************************
     C**                                                                 *
     C** #ZA       - THIS SUBROUTINE PERFORMS DATABASE ERROR PROCESSING  *
     C**                                                                 *
     C** CALLS     - #ZAA                                                *
     C**                                                                 *
     C** CALLED BY - #A, #B, #BB, #BE, #BF, #BG, #BBA                    *
     C**                                                                 *
     C********************************************************************
     C           #ZA       BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     EXSR #ZAA
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZAA      - THIS SUBROUTINE DOES TERMINATION PROCESSING         *
     C**                                                                 *
     C** CALLS     - NONE                                                *
     C**                                                                 *
     C** CALLED BY - MAINLINE, #BG, #ZA                                   *
     C**                                                                 *
     C********************************************************************
     C           #ZAA      BEGSR
     C*
     C** If PM0160 was called during this run of program, then call again
     C** (Portfolio Management Documentation Program)
     C*
     C           WWPMDC    IFEQ 'Y'
     C*
     C** Save WWLDA fields to restore DBERROR after this call
     C                     MOVE DBFILE    WWDBF2  8
     C                     MOVE DBKEY     WWDBK2 29
     C                     MOVE DBPGM     WWDBP2 10
     C*********************Z-ADDDBASE     WWDBS2  30                      R0121
     C                     MOVE DBASE     WWDBS2  30                      R0121
     C*
     C                     MOVE 'E'       WWPMD1
     C                     MOVE '9'       WWPMD2
     C                     MOVE *BLANKS   WWPMD3
     C                     MOVE 'I'       WWPMD4
     C***********          UNLCKDTAR                                      S01498
     C                     UNLCKLDA                                       S01498
     C*********************CALL 'PM0160'                                  R0119
     C                     CALL 'PMC0160'                                 R0119
     C                     PARM           WWPMD1
     C                     PARM           WWPMD2
     C                     PARM           WWPMD3
     C                     PARM           WWPMD4
     C*
     C************LOCK     IN   DTAR                                      S01498
     C           *LOCK     IN   LDA                                       S01498
     C*
     C** If a database error was NOT already detected then check for one
     C** in PM0160 now...
     C           WWDBS2    IFEQ 0
     C*
     C** If database error in PM0160
     C***********DBASE     IFGT 0                                         R0121
     C           DBASE     IFNE *BLANKS                                   R0121
     C           DBASE     ANDNE'000'                                     B9415
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     END
     C*
     C                     ELSE
     C*
     C** Else restore previous DBERROR
     C                     MOVE WWDBF2    DBFILE
     C                     MOVE WWDBK2    DBKEY
     C                     MOVE WWDBP2    DBPGM
     C*********************Z-ADDWWDBS2    DBASE                           R0121
     C                     MOVE WWDBS2    DBASE                           R0121
     C                     END
     C*
     C                     END
     C*
     C** Now terminate program
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** ZASNMS    - Send message to program's message queue             *
     C**                                                                 *
     C** CALLED BY -                                                     *
     C**                                                                 *
     C** CALLS     - Y2SNMGC                                             *
     C**                                                                 *
     C********************************************************************
     C           ZASNMS    BEGSR                           ** ZASNMS    **
     C*
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10
     C                     PARM           ZAPGRL  5
     C                     PARM           ZAMSID  7
     C                     PARM           ZAMSGF 10
     C                     PARM           ZAMSDA132
     C                     PARM           ZAMSTP  7
     C*
     C                     ENDSR
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** *PSSR     - PROGRAM ERROR HANDLING ROUTINE                      *
     C**                                                                 *
     C** CALLS     - NONE                                                *
     C**                                                                 *
     C** CALLED BY - NONE                                                *
     C**                                                                 *
     C********************************************************************
     C           *PSSR     BEGSR
     C*
     C                     DUMP
     C*
     C                     ENDSR
     C*
     C** Subroutine to convert a decimal amount to character
     C/COPY ZSRSRC,ZSEDITZ3
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** SCONV       - Convert an amount from one currency to another
     C**                                                                 *
     C** CALLS       - *NONE                                             *
     C**                                                                 *
     C** CALLED BY   - #ZC                                               *
     C**                                                                 *
     C**  Input Fields - WWAMTI 15/0 amount in input currency            *
     C**                 WWSRI  13/8 spot rate for input currency        *
     C**                 WWSRO  13/8 spot rate for output currency       *
     C**                 WWDPI  1/0  no. of decimals for input currency  *
     C**                 WWDPO  1/0  no. of decimals for output currency *
     C**                 WWMDI  1    mult/div indicator for input curr.  *
     C**                 WWMDO  1    mult/div indicator for output curr. *
     C**                                                                 *
     C**  Arrays       - POWER  powers of 10                             *
     C**                                                                 *
     C**  Output Fields- WWAMTO 15/0 output amount converted to new curr *
     C**                                                                 *
     C********************************************************************
     C           SCONV     BEGSR                           **  SCONV    **
     C*
     C** DEFINE ALL FIELDS
     C                     Z-ADDWWAMTI    WWAMTI 150
     C                     Z-ADD0         WWAMTO 150
     C           *LIKE     DEFN A6SPRT    WWSRI
     C           *LIKE     DEFN A6SPRT    WWSRO
     C           *LIKE     DEFN A6NBDP    WWDPI
     C           *LIKE     DEFN A6NBDP    WWDPO
     C           *LIKE     DEFN A6MDIN    WWMDI
     C           *LIKE     DEFN A6MDIN    WWMDO
     C*
     C           WWDPO     SUB  WWDPI     Z       10
     C           Z         ADD  4         Z
     C*
     C           WWMDI     IFNE WWMDO
     C*
     C** MULT/DIV INDICATORS DIFFERENT
     C           WWSRI     MULT WWSRO     WWRATE 159H
     C                     ELSE
     C*
     C** MULT/DIV INDICATORS THE SAME
     C           WWSRO     IFEQ 0
     C                     GOTO SC0
     C                     END
     C           WWSRI     DIV  WWSRO     WWRATE    H
     C                     END
     C*
     C           WWMDI     IFEQ 'D'
     C           WWRATE    IFEQ 0
     C                     GOTO SC0
     C                     END
     C           POWER,Z   DIV  WWRATE    WWRATE    H
     C                     ELSE
     C           POWER,Z   MULT WWRATE    WWRATE    H
     C                     END
     C*
     C           WWAMTI    MULT WWRATE    WWAMTO    H
     C*
     C           SC0       ENDSR                           **  SC0      **
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C** SUBROUTINE TO CONVERT A DATE FROM DAY NO. TO DDMMMYY FORMAT
     C/COPY ZSRSRC,ZDATE2Z2
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
      *                                                                   S01498
      ** Array ARR physically removed from compile-time array             S01498
      *                                                                   S01498
     ** NUM   - Array of numbers      Removed                                                 CSD027
     ** 0123456789                                                                            CSD027
** CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** POWER - Array of powers of 10 for currency conversion S/R SCONV
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** ALPHU - Array of alphanumerics A-Z, BLANK & 0-9
ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789
