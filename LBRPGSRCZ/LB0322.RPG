     H***********                                                         S01498
     H        1                                                           S01498
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LB Portfolio Lending Exposure Enquiry')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Lending Module                         *
     F*                                                               *
     F*  LB0322 - Portfolio Lending Exposure Enquiry                  *
     F*                                                               *
     F*  Called By: LB0305 -  LB Portfolio Lending Enquiry            *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *  Last Amend No. CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 03Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 S01498             Date 11Aug94               *
     F*                 063335             Date 16Nov93               *
     F*                 38835              DATE 27APR92               *
     F*                 049421             DATE 18JAN93               *
     F*                 S01313             DATE 27AUG92               *
     F*                 38049              DATE 02APR92               *
     F*                 35938              DATE 14FEB92               *
     F*                 33503              DATE 24DEC91               *
     F*                 B10521             DATE 19OCT91               *
     F*                 B7883              DATE 30MAY91               *
     F*                 B7881              DATE 30MAY91               *
     F*                 B7875              DATE 29MAY91               *
     F*                 B7804              DATE 21MAY91               *
     F*                 B7801              DATE 21MAY91               *
     F*                 B5997              DATE 21MAY91               *
     F*                 B5929              DATE 02MAY91               *
     F*                 B5923              DATE 02MAY91               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  S01498 - Portfolio Lending Upgrade to Release 10.            *
     F*  063335 - TROUBLES IN TRANSFER OF GROUP JOBS; CMD 23 REMOVED  *
     F*  38835  - IMPROVE NARRATIVE FOR SECURITIES                    *
     F*  049421 - HEADER BOX STANDARDISATION                          *
     F*  S01313 - CHANGES FOR PORTFOLIO PERFORMANCE                   *
     F*  38049  - WRONG POSITION USED                                 *
     F*  35938  - DATABASE ERROR WHEN CALLED FROM LB0305              *
     F*  33503  - PORTFOLIO LENDING EXTENDED MARGIN IS SWITCHABLE NOW *
     F*  B10521 - B7893/WRONG REFERENCE                               *
     F*  B7883  - CUSTOMER WRONG ON A/C NUMBER FOR PARENT             *
     F*  B7881  - LAST RECORD OF THE PAGE LOST                        *
     F*  B7875  - LOAN NOMINAL AMOUNT TRONCATED                       *
     F*  B7804  - TO DISPLAY LOAN AMOUNT IN ORIGINAL CURRENCY         *
     F*  B7801  - FOR LOANS & GUARANTEES, USE INSTRUMENT CODE         *
     F*  B5997  - DON'T DISPLAY ACCOUNT CURRENCY IN FRONT OF          *
     F*           THE BALANCE AS IT IS THE INSTRUMENT CURRENCY        *
     F*  B5929  - ENHACEMENTS                                         *
     F*  B5923  - SELECTION AND SET UP OF FIELDS INCORRECT            *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     F**
     F** FILE DEFINITIONS
     F** ----------------
     F*
     F**
     FLB0322DFCF  E                    WORKSTN      KINFSR *PSSR
     F                                        SFLRR2KSFILE LB0322S2
     F                                              KINFDS $1DS
     F*
     F***Modules*Present*File.**********************Prefix*-*BG********   S01498
     F*SDMMODPDIF  E           K        DISK         KINFSR *PSSR         35938
     F***SDMMODPDIF**E                    DISK         KINFSR *PSSR 35938 S01498
     F*
     F***Bank*Details*File.*************************Prefix*-*BJ********   S01498
     F***SDBANKPDIF**E                    DISK         KINFSR *PSSR       S01498
     F*
     F***Portfolio*Lending*Installation*Control*Data.**Prefix*-*LB*****   S01498
     F***SDLOMBPDIF**E                    DISK         KINFSR *PSSR       S01498
     F*                                                                   B5929
     F***Portfolio*Lending*I.C.D.*Extension*File.******Prefix*-*LB  B5929 S01498
     F***SDLOMBX0IF**E                    DISK         KINFSR *PSSR B5929 S01498
     F************SDLOMBD0                          KRENAMESDLOMBF0 B5929 S01498
     F*
     F***Portfolio*Management*I.C.D.****************Prefix*-*P9********   S01498
     F***SDPORTPDIF**E                    DISK         KINFSR *PSSR       S01498
     F*
     F***Currency*Codes.****************************Prefix*-*A6********   S01498
     F***SDCURRL1IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F** Client Master File (Customer Number).      Prefix - BB & CU
     F***SDLBCSL0IF**E           K        DISK         KINFSR *PSSR       S01498
     FLBLBCSJ0IF  E           K        DISK         KINFSR *PSSR          S01498
     F*
     F** Client Master File (Customer Shortname).   Prefix - BB & CU
     F***SDLBCSL5IF**E           K        DISK         KINFSR *PSSR       S01498
     FLBLBCSJ5IF  E           K        DISK         KINFSR *PSSR          S01498
     F            SDLBCSJ0                          KRENAMESDLBCSJR
     F*
     F** Exposure/Collateral Extract File.          Prefix - EX
     F** KEYED : EXCNUM,EXLCGR
     FLBEXCOL0IF  E           K        DISK         KINFSR *PSSR
     F*
     F** Exposure/Collateral Extract File.          Prefix - EX
     F** KEYED : EXPCNB,EXLCGR
     FLBEXCOL1IF  E           K        DISK         KINFSR *PSSR
     F*
     F** Exposure/Collateral Extract File.          Prefix - EX
     F** KEYED : EXCNUM EXLCGS EXLCGR EXINST EXCCY
     FLBEXCOL2IF  E           K        DISK         KINFSR *PSSR
     F*
     F** Exposure/Collateral Extract File.          Prefix - EX
     F** KEYED : EXPCNB EXLCGS EXLCGR EXINST EXCCY
     FLBEXCOL3IF  E           K        DISK         KINFSR *PSSR
     F*
     F***Portfolio*Management*Customer*Details.*****Prefix*-*BB*&*QB***   S01498
     F***SDPLCSL0IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F***Midas*User*Definition.*********************Prefix*-*NONE******   S01498
     F***MUSER***IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F***Account*Officers*Details.******************Prefix*-*AZ********   S01498
     F***SDACOFL1IF**E           K        DISK         KINFSR *PSSR       S01498
     F*                                                                   B5923
     F** Securities details.                        Prefix -              B5923
     FSECTY   IF  E           K        DISK         KINFSR *PSSR          B5923
     F*
     F***Country*Details.***************************Prefix*-*A4********   S01498
     F***SDCTRYL1IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F***Instrument*Definitions.********************Prefix*-*PD********   S01498
     F***SDPLINL4IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F***Portfolio*Lending Groups.(KEYED*ON*GROUP)*****Prefix*-*GP*****   S01498
     F***LBGROUL1IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F********************************************************************
     F/EJECT
     F********************************************************************
     F**                                                                 *
     F** ID F  C  H  L    FUNCTION OF INDICATORS                         *
     F**                  ----------------------                         *
     F**      25          HELP                                           *
     F**      26          SFLEND    ------) Message Subfile              *
     F**      27          ROLLUP                                         *
     F**                                                                 *
     F**      28          SFLDSP    ------)                              *
     F**      29          SFLDSPCTL       )                              *
     F**      30          SFLCLR          ) Input Screen 2 Subfile       *
     F**      31          SFLEND          )                              *
     F**      32          SFLNXTCHG ------)                              *
     F**                                                                 *
     F**      33          Invalid customer number/shortname on screen 1  *
     F**      34          First character of customer number/shortname   *
     F**                  is (1) Alphanumeric (2) Numeric                *
     F**      35          Customer number/shortname found                *
     F**      36          Customer number available                      *
     F**      37          Customer shortname available                   *
     F********38**********Chain fail on SDLBCSL0***********************  *S01498
     F********39**********Chain fail on SDLBCSL5***********************  *S01498
     F**      38          Chain fail on LBLBCSJ0                         *S01498
     F**      39          Chain fail on LBLBCSJ5                         *S01498
     F********40**********Chain*fail*on*LBGROUL1***********************  *S01498
     F**      41          Portfolio Management installed                 *
     F**      42          No details for customer                        *
     F**      43          Record found on SETLL                          *
     F********44**********Chain*fail*on*SDPLINL4***********************  *S01498
     F**      45          Enable CMD11,CMD/12 & CMD13                    *
     F**      46          RECORD FOUND ON SETLL ON LBEXCOL2              *
     F**      47          Invalid Group Code on screen 2                 *
     F********48**********EOF*on*SDLBCSL0*for*customer*no.*************  *S01498
     F**      48          EOF on LBLBCSJ0 for customer no.               *S01498
     F**      49          Enable CMD23,CMD24                             *
     F**      50          PM0160 called during execution of program      *
     F**      51          END OF LBEXCOL3                                *
     F********52**********Chain*fail*on*SDPLCSL0***********************  *S01498
     F**      53          BEYOND EOF ON LBEXCOL0/1                       *
     F**      54          RECORD FOUND ON SETLL ON LBEXCOL0/1            *
     F**      55          RECORD FOUND ON LBEXCOL0/1                     *
     F**      56          RECORD FOUND ON SETLL ON LBEXCOL3              *
     F********57**********Chain*fail*on*SDCTRYL1***********************  *S01498
     F**      58          Chain fail on SECTY                            *B5923
     F********59**********Chain*fail*on*MUSER**************************  *S01498
     F********60**********Chain*fail*on*SDACOFL1***********************  *S01498
     F**      61          END OF LBEXCOL2                                *
     F**      63          HIGHLIGHT GROUP NARRITIVE ON SUBFILE           *
     F********70**********EOF*ON*READ*OF*FILE*SDBANKPD*****************  *S01498
     F********71**********EOF*ON*READ*OF*FILE*SDLOMBPD*****************  *S01498
     F********72**********EOF*ON*READ*OF*FILE*SDMMODPD*****************  *S01498
     F********73**********EOF*ON*READ*OF*FILE*SDPORTPD*****************  *S01498
     F********74**********CHAIN*ON*FILE*SDCURRL1***********************  *S01498
     F********75**********EOF*ON*READ*OF*FILE*SDLOMBX0**************B5929 S01498
     F**                                                                 *
     F********************************************************************
     F/EJECT
     E********************************************************************
     E*
     E**   Array for COPYRIGHT
     E                    CPY@    1   1 80
     E*
     E** SCONV S/R array for powers of 10
     E                    POWER   1   7  7 3
     E*
     E** Array of alphanumerics
     E                    ALPNU  37  37  1
     E*
     E** Array of numbers
     E**********          NUM    10  10  1                                                    CSD027
     E*
     E** Array to split customer field into individual characters
     E                    CUS        10  1
     E*
     E***Array*of*commands*********************************************   S01498
     E********************ARR     1   2 80                                S01498
     E*
     E**   Arrays for ZDATE2
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E*
     E** Arrays used in conversion of decimal amounts to character
     E                    ZS1        15  1 0
     E                    ZS2        21  1
     E*
     E********************************************************************
     E/EJECT
     I********************************************************************
     I*
     I**   DATA STRUCTURE FOR COMPILATION - Copyright Insertion
     ICPYR@$      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@$$
     I*
     I*****DATA*STRUCTURE*TO*DEFINE*THE*GROUP*DATA*AREA****************   S01498
     I***WWPGDA****E*DSPMGRDAPP***************                            S01498
     I*
     I*****DATA*STRUCTURE*TO*DEFINE*THE*LOCAL*DATA*AREA*FOR*GROUP*JOBS*   S01498
     I***WWPLDA****E*DSPMLDAPP****************                            S01498
     I*
     I** Display file information data structure
     I$1DS        DS
     I                                    B 378 3790$1DSRN
     I*
     I** Program status data structure
     IPSDS       SDS
     I**************************************244 253 DDWSID                S01498
     I**************************************254 263 WWUPFL                S01498
     I                                      244 253 SWSID                 S01498
     I                                      254 263 SUSER                 S01498
     I*
     I** Local data area
     I***DTAR*******UDS***********************     256                    S01498
     ILDA         DS                            256                       S01498
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      **Data*area*LZSTAT********************************************33503 S01498
     I***LZSTAT******DS***********************     256              33503 S01498
     I***************************************15  15 LBIC          33503   38049
     I***************************************21  21 LBIC            38049 S01498
     I*
     I** Data Structure to split customer number/shortname field
     IWW1CNS      DS
     I                                        1  10 DD1CNS
     I                                        1  10 CUS
     I                                        1   6 DD1CNO
     I                                        1   1 WWCCH1
     I                                        7  10 WWC710
     I*
     I** DATA STRUCTURE TO RENAME CUSTOMER NUMBER FIELD
     IWW1CNM      DS
     I**********                              1   60WWCNMB                                    CSD027
     I                                        1   6 WWCNMB                                    CSD027
     I                                        1   6 WWCNMC
     I*
     I***DATA*STRUCTURE*FOR*DATE*OF*BIRTH*(READ*FROM*SDPLCSL0)*********   S01498
     I************DS**************************                            S01498
     I****************************************1   60WWDAT1                S01498
     I****************************************1   20WWDAY1                S01498
     I****************************************3   40WWMON1                S01498
     I****************************************5   60WWYER1                S01498
     I*
     I***DATA*STRUCTURE*FOR*DATE*OF*BIRTH*(CONVERTED*AS*PARAMETER)*****   S01498
     I************DS**************************                            S01498
     I****************************************1   7 WWDAT2                S01498
     I****************************************1   20WWDAY2                S01498
     I****************************************3   5 WWMON2                S01498
     I****************************************6   70WWYER2                S01498
     I*
     I** Data structure to convert @@IAMT decimal field to alpha
     I            DS
     I                                        1  150WORK15
     I                                        1  150ZS1
     I*                                                                   B5923
     I** Data structure to display account number                         B5923
     I            DS                                                      B5923
     I**********                              1  18 ACCNDS                              B5923 CGL029
     I                                        1  24 ACCNDS                                    CGL029
     I                                        1   6 CNUMDS                B5923
     I                                        7   7 TIR1DS                B5923
     I                                        8  10 CCYCDS                B5923
     I                                       11  11 TIR2DS                B5923
     I**********                             12  15 ACODDS                              B5923 CGL029
     I**********                             16  16 TIR3DS                              B5923 CGL029
     I**********                             17  18 ACSQDS                              B5923 CGL029
     I                                       12  21 ACODDS                                    CGL029
     I                                       22  22 TIR3DS                                    CGL029
     I                                       23  24 ACSQDS                                    CGL029
     I*                                                                   B5929
     I** Data structure to redefine the instrument (CAS & SEC)            B5929
     I            DS                                                      B5929
     I                                        1  21 DDINSE                B5929
     I                                        1   3 INSTDS                B5929
     I*************************               5   7 NARRDS          B5929 B5997
     I                                        5  14 SESNDS                B5929
     I************************                9  21 AMNTDS          B5929 B7875
     I                                        5  21 AMNTDS                B7875
     I*
     I** DATA STRUCTURE TO SPLIT REFERENCE FIELD EXREF
     IWWXREF      DS
     I**********                              1  16 EXREF                                     CGL029
     I                                        1  22 EXREF                                     CGL029
     I                                        1   6 WR0106
     I**********                              1   4 WR0104                                    CGL029
     I**********                              5   6 WR0506                                    CGL029
     I                                        1  10 WR0104                                    CGL029
     I                                       11  12 WR0506                                    CGL029
     I                                        7  16 WR0716
     I                                        7  12 WR0712
     I                                        1  13 WR0113
     I                                        7   7 WR0707
     I                                        8  10 WR0810
     I                                       11  13 WR1113
     I                                       14  16 WR1416
     I                                        1  10 WR0110
     I*
     I** DATA STRUCTURE TO FORMAT SCREEN 2 REFERENCE FIELDS
     IWWRFS2      DS
     I                                        1  28 WWALL
     I                                        1   5 WW0105
     I                                        1  17 WW0817
     I                                       11  14 WW1114
     I                                       16  18 WW1618
     I                                       20  21 WW2021
     I                                       15  20 WW1520
     I                                       15  17 WW1517
     I                                       19  25 WW1925
     I                                       22  28 WW2228
     I                                        6  11 WW0611
     I                                        7  13 WW0713
     I                                       13  16 WW1316
     I                                       18  23 WW1823
     I                                        6  12 WW0612
     I                                       14  18 WW1418
     I                                       20  26 WW2026
     I                                       07  23 WW0723
     I                                       13  20 WW1320
     I                                        1   9 WW0109
     I                                       11  16 WW1116
     I                                       19  22 WW1922
     I                                       24  24 WW2424
     I                                       10  12 WW1012
     I                                       14  16 WW1416
     I                                       24  26 WW2426
     I                                       11  20 WW1120
     I                                        1   7 WW0107
     I                                        9  14 WW0914
     I*
     ISDBANK    E DSSDBANKPD                                              S01498
     I**  Data structure for bank details                                 S01498
     I*                                                                   S01498
     ISDLOMB    E DSSDLOMBPD                                              S01498
     I**  Data structure for Portfolio Lending ICD                        S01498
     I*                                                                   S01498
     ISDCURR    E DSSDCURRPD                                              S01498
     I**  Data structure for currency details                             S01498
     I*                                                                   S01498
     ISDMMOD    E DSSDMMODPD                                              S01498
     I**  Data structure for Midas modules details                        S01498
     I*                                                                   S01498
     ISDPORT    E DSSDPORTPD                                              S01498
     I**  Data structure for Portfolio Management ICD                     S01498
     I*                                                                   S01498
     ISDGROU    E DSLBGROUPD                                              S01498
     I**  Data structure for lending group details                        S01498
     I*                                                                   S01498
     ISDPLIN    E DSSDPLINPD                                              S01498
     I**  Data structure for instrument type details                      S01498
     I*                                                                   S01498
     IDSFDY     E DSDSFDY                                                 S01498
     I**  Short data structure for access objects                         S01498
     I*                                                                   S01498
     IDSSDY     E DSDSSDY                                                 S01498
     I**  Long data structure for access programs                         S01498
     I*                                                                   S01498
     I********************************************************************
     I/EJECT
     C********************************************************************
     C*
     C** PARAMETER LIST DECLARATIONS
     C** ---------------------------
     C** WWCALL - '0' = Called from menu
     C**          '1' = Called from LB0305 (Portfolio Enquiry)
     C** WWCNUM - Customer number (If called from another program)
     C** WWFCTN - 03 = Function Key 3 returned
     C**          12 = Function Key 12 returned
     C*
     C           *ENTRY    PLIST
     C                     PARM           WWCALL  1
     C**********           PARM           WWCNUM  60                                          CSD027
     C                     PARM           WWCNUM  6                                           CSD027
     C                     PARM           WWFCTN  2
     C*
     C********************************************************************
     C/EJECT
     C************NAMVAR   DEFN           LZSTAT                    33503 S01498
     C***********          IN   LZSTAT                              33503 S01498
     C*
     C**             START MAINLINE
     C**             --------------
     C*                                                                   S01498
     C**  Copyright statement                                             S01498
     C*                                                                   S01498
     C                     MOVEACPY@      ACT@   80                       S01498
     C** INITIALISATION
     C                     EXSR #A
     C*
     C** MAIN PROCESSING
     C           *IN48     IFEQ '0'
     C                     EXSR #B
     C                     END
     C*
     C** CALL PM0160 , IF NECESSARY
     C                     EXSR #ZE
     C*
     C** END PROGRAM
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**                    INDEX TO SUBROTUINES                         *
     C**                    --------------------                         *
     C**    #A     - Initialisation                                      *
     C**    #AA    - Validate customer no. if called from another pgm.   *
     C**    #B     - Main processing                                     *
     C**    #BA    - Validate input screen 1                             *
     C**    #BB    - Process CMD/11 to change currency                   *
     C**    #BC    - Process CMD/12 for previous screen                  *
     C******#BD****-*Process*CMD/23*for*Portfolio*Management*Enquiries*  *S01498
     C******#BDA***-*Load*the*Group*Data*Area**************************  *S01498
     C**    #BE    - Process CMD/24 for Documentation                    *
     C**    #BF    - Process an ENTER from input screen 2                *
     C**    #BG    - Process roll-up                                     *
     C**    #BH    - Process CMD/13 OTHER DETAILS                        *
     C**    #ZA    - Load a page of records to the subfile of screen 2   *
     C**             (Children or Orphans)                               *
     C**    #ZB    - Load a page of records to the subfile of screen 2   *
     C**             (Parents)                                           *
     C**    #ZC    - Set up output fields for subfile                    *
     C**    #ZD    - Retrieve currency details for customer currency     *
     C**    #ZE    - Call 'PM0160'                                       *
     C**    ZSEDIT - Convert a decimal amount to character               *
     C**    ZDATE2 - Convert dates from MIDAS day number to date format  *
     C**    SCONV  - Convert an amount from one currency to another      *
     C**    ZASNMS - Send message to program's message queue             *
     C**    *PSSR  - Program error handling routine                      *
     C**                                                                 *
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #A          - INITIAL PROCESSING                                *
     C**                                                                 *
     C** CALLS       - #AA                                               *
     C**                                                                 *
     C** CALLED BY   - MAINLINE                                          *
     C**                                                                 *
     C********************************************************************
     C*
     C           #A        BEGSR
     C*
     C** Define LDA for use in program
     C** -----------------------------
     C************NAMVAR   DEFN LDA       DTAR                            S01498
     C           *NAMVAR   DEFN           LDA                             S01498
     C*
     C** Define KEY LISTS
     C** ----------------
     C           KLIST1    KLIST
     C                     KFLD           WWCNMB
     C                     KFLD           DD2LCG
     C*
     C           KLIST2    KLIST
     C                     KFLD           WWCNMC
     C                     KFLD           DD2LCG
     C*
     C           KLIST3    KLIST
     C                     KFLD           WWCNMB
     C                     KFLD           EXLCGS
     C                     KFLD           EXLCGR
     C*
     C           KLIST4    KLIST
     C                     KFLD           WWCNMC
     C                     KFLD           EXLCGS
     C                     KFLD           EXLCGR
     C*
     C                     MOVE '0'       *IN41
     C/COPY WNCPYSRC,LB0322C001
     C*
     C** Initialize Database Error Fields
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LB0322'  DBPGM
     C                     Z-ADD0         DBASE
     C                     OUT  LDA                                       S01498
     C*
     C** Initialize WORK Fields
     C                     MOVE 'E'       WWACTN  1
     C                     MOVE 'I'       WWFNMO  1
     C           *LIKE     DEFN EXLCGR    WWLCGR
     C           *LIKE     DEFN EXAMNT    WWAMNT
     C*                                                                   B5923
     C                     MOVE '-'       TIR1DS                          B5923
     C                     MOVE '-'       TIR2DS                          B5923
     C                     MOVE '-'       TIR3DS                          B5923
     C*
     C** Initialize MESSAGE FILE NAME
     C**   Fill in fields for subroutine ZASNMS
     C                     MOVEL*BLANK    ZAPGM  10        Message queue
     C                     MOVE *BLANKS   ZAMSGF
     C                     MOVEL'LBUSRMSG'ZAMSGF 10        Message file
     C                     MOVEL*BLANK    ZAPGRL  5        Rel queue
     C                     MOVEL*BLANK    ZAMSID  7        Message Id.
     C                     MOVEL*BLANK    ZAMSDA132        Message data.
     C                     MOVEL*BLANK    ZAMSTP  7        Message type.
     C*
     C***READ*PF/SDBANKPD*TO*RETRIEVE*MIDAS*RUN*DATE*BJMRDT************   S01498
     C***********1         SETLLSDBANKPD                                  S01498
     C***********          READ SDBANKPD                 70               S01498
     C*
     C************IN70     IFEQ '1'                                       S01498
     C***********BJTYLC    OREQ 'D'                                       S01498
     C*                                                                   S01498
     C** Get bank details using access object                             S01498
     C*                                                                   S01498
     C                     CALL 'AOBANKR0'                                S01498
     C                     PARM *BLANKS   P@RTCD  7                       S01498
     C                     PARM '*FIRST ' P@OPTN  7                       S01498
     C           SDBANK    PARM SDBANK    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDBANKPD'DBFILE           ** DBERROR 001 S01498
     C                     MOVE 'SDBANKPD'DBFILE           ** DBERROR 001 S01498
     C                     Z-ADD1         DBASE            *****************
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZE
     C                     RETRN
     C                     END
     C*                                                                   S01498
     C**  Rundate in DDMMMYY format                                       S01498
     C*                                                                   S01498
     C                     MOVE BJMRDT    SRUNA                           S01498
     C*
     C** Set up indicator 98 for ZDATE S/R's as per BJFKST
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C*
     C                     ELSE
     C*
     C                     MOVE '0'       *IN98
     C                     END
     C*
     C***READ*PF/SDLOMBPD*TO*RETRIEVE*PORTFOLIO*LENDING*CURRENCY*LBCCY*   S01498
     C***********1         SETLLSDLOMBPD                                  S01498
     C***********          READ SDLOMBPD                 71               S01498
     C*
     C************IN71     IFEQ '1'                                       S01498
     C***********LBCHTP    OREQ 'D'                                       S01498
     C*                                                                   S01498
     C** Get Portfolio Lending details using access object                S01498
     C*                                                                   S01498
     C                     CALL 'AOLOMBR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*FIRST ' P@OPTN                          S01498
     C           SDLOMB    PARM SDLOMB    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDLOMBPD'DBFILE           ** DBERROR 002 S01498
     C                     MOVE 'SDLOMBPD'DBFILE           ** DBERROR 002 S01498
     C                     Z-ADD2         DBASE            *****************
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZE
     C                     RETRN
     C                     END
     C*                                                                   B5929
     C***READ*PF/SDLOMBX0*TO*RETRIEVE*EXPOSURE*CALCULATION*BASIS*   B5929 S01498
     C***********LBIC      IFEQ 'Y'                                 33503 S01498
     C***********1         SETLLSDLOMBX0                            B5929 S01498
     C***********          READ SDLOMBX0                 75         B5929 S01498
     C***********                                                   B5929 S01498
     C************IN75     IFEQ '1'                                 B5929 S01498
     C***********          MOVE *BLANKS   DBFILE     ***************B5929 S01498
     C***********          MOVEL'SDLOMBX0'DBFILE     ** DBERROR 012 B5929 S01498
     C***********          Z-ADD12        DBASE      ***************B5929 S01498
     C***********          MOVE '1'       *INU7                     B5929 S01498
     C***********          MOVE '1'       *INU8                     B5929 S01498
     C***********          MOVE '1'       *INLR                     B5929 S01498
     C***********          EXSR #ZE                                 B5929 S01498
     C***********          RETRN                                    B5929 S01498
     C***********          END                                      B5929 S01498
     C***********          END                                      33503 S01498
     C*
     C** READ PF/SDMMODPD TO DETERMINE IF PORTFOLIO MANAGEMENT IS
     C** INSTALLED. (INSTALLED IF BGPFMG EQUALS 'Y')
     C***********1         SETLLSDMMODPD                            35938 S01498
     C***********          READ SDMMODPD                 72               S01498
     C*
     C************IN72     IFEQ '1'                                       S01498
     C***********BGTYLC    OREQ 'D'                                       S01498
     C*                                                                   S01498
     C** Get Midas Modules details using access object                    S01498
     C*                                                                   S01498
     C                     CALL 'AOMMODR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*FIRST ' P@OPTN                          S01498
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE           *****************
     C***********          MOVEL'SDMMODPD'DBFILE           ** DBERROR 003 S01498
     C                     MOVE 'SDMMODPD'DBFILE           ** DBERROR 003 S01498
     C                     MOVE *BLANKS   DBKEY            *****************
     C                     Z-ADD3         DBASE
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZE
     C                     RETRN
     C                     END
     C*
     C** SET ON INDICATOR IF PORTFOLIO MANAGEMENT IS INSTALLED
     C           BGPFMG    IFEQ 'Y'
     C                     MOVE '1'       *IN41
     C                     END
     C*
     C** IF PORTFOLIO MANAGEMENT IS INSTALLED
     C           BGPFMG    IFEQ 'Y'
     C*
     C***READ*PF/SDPORTPD*TO*RETRIEVE*HIGH*LEVEL*SECURITY*FLAG*P9HLVS**   S01498
     C***********1         SETLLSDPORTPD                                  S01498
     C***********          READ SDPORTPD                 73               S01498
     C*
     C************IN73     IFEQ '1'                                       S01498
     C***********P9ADST    OREQ 'D'                                       S01498
     C*                                                                   S01498
     C** Get Portfolio Management ICD details using access object         S01498
     C*                                                                   S01498
     C                     CALL 'AOPORTR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*FIRST ' P@OPTN                          S01498
     C           SDPORT    PARM SDPORT    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDPORTPD'DBFILE           ***************S01498
     C                     MOVE 'SDPORTPD'DBFILE           ***************S01498
     C                     MOVE *BLANKS   DBKEY            ** DBERROR 004 **
     C                     Z-ADD4         DBASE            *****************
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZE
     C                     RETRN
     C                     END
     C*
     C                     END
     C*
     C***USING*PORTFOLIO*LENDING*CURRENCY*LBCCY************************   S01498
     C***ACCESS*LF/SDCURRL1*TO*RETRIEVE*AND*STORE*IN*WORK*FIELDS*******   S01498
     C** Using Portfolio Lending Currency  LBCYCD, use access object      S01498
     C** to retrieve and store in work fields                             S01498
     C** DECIMAL POSITIONS A6NBDP, SPOT RATE A6SPRT AND
     C** MULTIPLY/DIVIDE INDICATOR A6MDIN
     C***********LBCCY     CHAINSDCURRL1             74                   S01498
     C*
     C************IN74     IFEQ '1'                                       S01498
     C***********A6TYLC    OREQ 'D'                        ***************S01498
     C*                                                                   S01498
     C** Get currency details using access object                         S01498
     C*                                                                   S01498
     C                     CALL 'AOCURRR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM LBCYCD    P@CCY   3                       S01498
     C           SDCURR    PARM SDCURR    DSSDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDCURRL1'DBFILE           ** DBERROR 005 S01498
     C                     MOVE 'SDCURRPD'DBFILE           ** DBERROR 005 S01498
     C                     MOVE *BLANKS   DBKEY            *****************
     C***********          MOVELLBCCY     DBKEY                           S01498
     C                     MOVELLBCYCD    DBKEY                           S01498
     C                     Z-ADD5         DBASE
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZE
     C                     RETRN
     C*
     C                     ELSE
     C*
     C** MOVE REQUIRED VALUES TO WORK FIELDS
     C                     Z-ADDA6NBDP    WWLBDP  10
     C                     Z-ADD0         WWDILB  40
     C*
     C           A6NBDP    IFEQ 1
     C                     Z-ADD10        WWDILB
     C                     END
     C*
     C           A6NBDP    IFEQ 2
     C                     Z-ADD100       WWDILB
     C                     END
     C*
     C           A6NBDP    IFEQ 3
     C                     Z-ADD1000      WWDILB
     C                     END
     C                     END
     C*
     C                     Z-ADDA6SPRT    WWSRI
     C                     Z-ADDA6NBDP    WWDPI
     C                     MOVE A6MDIN    WWMDI
     C*
     C** Initialise the SUBFILE message queue
     C                     MOVE *BLANKS   DDPGMQ
     C                     MOVEL'*'       DDPGMQ
     C*
     C** Initialise and clear the program message queue
     C                     MOVE *BLANKS   WWTPGQ
     C                     MOVEL'*'       WWTPGQ
     C                     MOVE *BLANKS   WWPGQR
     C                     MOVEL'*PRV'    WWPGQR
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ
     C                     PARM           WWPGQR
     C                     MOVE '1'       *IN26
     C*
     C** Clear the input screen 2 subfile
     C                     MOVE '1'       *IN30
     C                     WRITELB0322C2
     C                     MOVE '0'       *IN30
     C*
     C** Initialise work fields and indicators
     C                     Z-ADD0         LSTRR2  40
     C                     MOVE *BLANKS   DD1CNS
     C                     MOVE 'N'       WWVLD1  1
     C                     MOVE 'Y'       WWVLD2  1
     C                     MOVE '0'       *IN33
     C                     MOVE '0'       *IN36
     C                     MOVE '0'       *IN37
     C                     MOVE '0'       *IN45
     C                     MOVE '0'       *IN49
     C                     MOVE '1'       *IN28
     C                     MOVE '1'       *IN29
     C*
     C** ZEROISE EXPOSURE AMOUNT WORK FIELD
     C                     Z-ADD0         WWAMNT
     C*
     C** Set currency flag to 'LB' and output currency to Porfolio Lending Ccy
     C                     MOVE 'LB'      WWCUFG  2
     C***********          MOVE LBCCY     DDCCY                           S01498
     C                     MOVE LBCYCD    DDCCY                           S01498
     C*
     C** SET REFERENCE FLAG TO 'RA'
     C                     MOVE 'RA'      WWRFFG  2
     C*
     C** INITIALISE ZSEDIT PARAMETERS
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD0         ZDECS
     C*
     C** VALIDATE CUSTOMER NO. IF PROGRAM CALLED FROM ANOTHER PROGRAM
     C           WWCALL    IFEQ '1'
     C                     EXSR #AA
     C                     END
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #AA         - THIS SUBROUTINE VALIDATES CUSTOMER NUMBER IF      *
     C**               PROGRAM IS CALLED FROM ANOTHER PROGRAM            *
     C**                                                                 *
     C** CALLS       - #ZD                                               *
     C**                                                                 *
     C** CALLED BY   - #A                                                *
     C**                                                                 *
     C********************************************************************
     C           #AA       BEGSR
     C*
     C                     MOVE WWCNUM    WWCNSN
     C***********WWCNSN    SETLLSDLBCSL0             33  35               S01498
     C           WWCNSN    SETLLLBLBCSJ0             33  35               S01498
     C           *IN35     IFEQ '1'
     C***********          READ SDLBCSL0                 38               S01498
     C                     READ LBLBCSJ0                 38               S01498
     C                     MOVE WWCNUM    WWCNMB
     C                     END
     C           *IN33     CABEQ'1'       #AA0
     C*
     C                     EXSR #ZD
     C                     GOTO #AA1
     C*
     C           #AA0      TAG
     C**********           Z-ADD0         WWCNUM                                              CSD027
     C                     MOVE *BLANKS   WWCNUM                                              CSD027
     C                     MOVE '1'       *IN48
     C           #AA1      ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #B          - MAIN PROCESSING                                   *
     C**                                                                 *
     C***CALLS*******-*#BA*#BB*#BC*#BD*#BE*#BF*#ZA*#ZB*LB0340*#ZD*#ZE*#BG*S01498
     C** CALLS       - #BA #BB #BC #BE #BF #ZA #ZB LB0340 #ZD #ZE #BG    *S01498
     C**             - #BH                                               *
     C**                                                                 *
     C** CALLED BY   - MAINLINE                                          *
     C**                                                                 *
     C********************************************************************
     C           #B        BEGSR
     C*
     C** Process until a termination request
     C           *INKC     DOWEQ'0'
     C           *INKL     ANDEQ'0'
     C*
     C** If the program was called from another program then skip the
     C** screen 1 processing and process screen 2 immediately
     C           WWCALL    IFEQ '0'
     C*
     C** Process screen 1 until a termination request or valid screen
     C           *INKC     DOWEQ'0'
     C           WWVLD1    ANDEQ'N'
     C*
     C** Write Screen 1
     C                     WRITELB0322F1
     C*
     C** If error on screen 1 write error message subfile
     C           *IN33     IFEQ '1'
     C                     WRITELB0322C3
     C                     END
     C*
     C** Read Screen 1
     C                     READ LB0322F1                 99
     C*
     C** Process if CMD/3 not pressed
     C           *INKC     IFEQ '0'
     C                     EXSR #BA                        Enter
     C*
     C** If valid input on screen 1 , but customer not found or was
     C** input as blanks then CALL customer enquiry program.
     C           *IN33     IFEQ '0'
     C           *IN35     IFEQ '0'
     C           DD1CNS    OREQ *BLANKS
     C                     MOVE '1'       WWPRM1  1
     C                     MOVE DD1CNS    WWPRM2 10
     C**********           Z-ADD*ZEROS    WWPRM3  60                                          CSD027
     C                     MOVE *BLANKS   WWPRM3  6                                           CSD027
     C                     MOVE *BLANKS   WWPRM4  2
     C***********          UNLCKDTAR                                      S01498
     C                     UNLCKLDA                                       S01498
     C                     CALL 'LB0340'
     C                     PARM           WWPRM1
     C                     PARM           WWPRM2
     C                     PARM           WWPRM3
     C                     PARM           WWPRM4
     C************LOCK     IN   DTAR                                      S01498
     C           *LOCK     IN   LDA                                       S01498
     C*
     C** If errors in called program , return to point of call
     C           DBASE     IFGT 0
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ELSE
     C*
     C                     MOVEL'LB0322'  DBPGM
     C                     END
     C           WWPRM4    IFEQ '03'
     C                     MOVE '1'       *INKC
     C                     GOTO #B0
     C*
     C                     ELSE
     C*
     C********** WWPRM3    IFNE *ZEROS                                                        CSD027
     C           WWPRM3    IFNE *BLANKS                                                       CSD027
     C           WWPRM4    ANDNE'12'
     C                     MOVE *BLANKS   DD1CNS
     C                     MOVELWWPRM3    DD1CNS
     C                     MOVE '1'       *IN36
     C                     MOVE '0'       *IN37
     C*
     C                     ELSE
     C*
     C                     MOVE *BLANKS   DD1CNS
     C                     GOTO #B0
     C                     END
     C                     END
     C                     END
     C*
     C                     MOVE '0'       *IN38
     C                     MOVE '0'       *IN39
     C*
     C** If customer number available retrieve customer details ----
     C           *IN36     IFEQ '1'
     C***********DD1CNO    CHAINSDLBCSL0             38                   S01498
     C           DD1CNO    CHAINLBLBCSJ0             38                   S01498
     C*
     C                     ELSE
     C*
     C** Else , use customer shortname.
     C           *IN37     IFEQ '1'
     C***********DD1CNS    CHAINSDLBCSL5             39                   S01498
     C           DD1CNS    CHAINLBLBCSJ5             39                   S01498
     C                     END
     C                     END
     C*
     C** If record not found or is deleted return error.
     C           *IN38     IFEQ '1'
     C           *IN39     OREQ '1'
     C           BBTYLC    OREQ 'D'
     C                     MOVEL'LBM0007' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       *IN33
     C                     GOTO #B0
     C                     END
     C*
     C** Validation successful
     C                     MOVE 'Y'       WWVLD1
     C*
     C** Save number of requested customer
     C                     MOVE BBCUST    WWCNMC
     C*
     C** Retrieve currency details for customer currency
     C                     EXSR #ZD
     C*
     C** Clear the input screen 2 subfile
     C                     MOVE '1'       *IN30
     C                     MOVELWWPRM3    DD1CNS
     C                     WRITELB0322F1
     C                     WRITELB0322C2
     C                     MOVE '0'       *IN30
     C*
     C** Initialize display field
     C                     MOVE *BLANKS   DD1CNS
     C*
     C           #B0       TAG
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C** Enable CMD/11 CMD/12 CMD/13 CMD/23 AND CMD24 (ONLY IF PM INSTALLED)
     C                     MOVE '1'       *IN45
     C           *IN41     IFEQ '1'
     C                     MOVE '1'       *IN49
     C                     END
     C*
     C** Initialize display fields
     C                     Z-ADD0         LSTRR2
     C                     MOVE *BLANKS   DD2LCG
     C                     MOVE 'LB'      WWCUFG
     C***********          MOVE LBCCY     DDCCY                           S01498
     C                     MOVE LBCYCD    DDCCY                           S01498
     C*
     C** Initialize work field for group code and previous screen request.
     C** Load the first page of records to the subfile if CMD/3 not taken
     C           *INKC     IFEQ '0'
     C                     MOVE *BLANKS   WWLCGR
     C                     MOVE '0'       *IN47
     C                     MOVE 'N'       WWPRSI  1
     C           BBPAIN    IFEQ 'P'
     C           WWCNMC    SETLLLBEXCOL3
     C                     READ LBEXCOL3                 51
     C                     EXSR #ZB
     C*
     C                     ELSE
     C           WWCNMB    SETLLLBEXCOL2
     C                     READ LBEXCOL2                 61
     C                     EXSR #ZA
     C                     END
     C                     END
     C*
     C** Process screen 2 until a termination request
     C           *INKC     DOWEQ'0'
     C           WWPRSI    ANDEQ'N'
     C*
     C** Write screen 2 headings
     C                     WRITELB0322H2
     C*
     C** If there are details for customer write subfile control -------
     C           *IN42     IFEQ '0'
     C                     MOVE '1'       *IN28
     C*
     C                     ELSE
     C*
     C                     MOVE '0'       *IN28
     C                     END
     C                     WRITELB0322C2
     C*
     C** otherwise , write NO DETAILS message
     C           *IN42     IFEQ '1'
     C                     MOVEL'LBM0049' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'N'       WWVLD2
     C                     MOVE '0'       *IN49
     C                     END
     C*
     C** Write error message subfile if screen 2 is not valid
     C           WWVLD2    IFEQ 'N'
     C                     WRITELB0322C3
     C                     END
     C*
     C** Read screen 2
     C                     READ LB0322C2                 99
     C*
     C** Store relative record number of subfile
     C           $1DSRN    IFEQ 0
     C                     Z-ADDSFLRR2    WWSTRN  40
     C*
     C                     ELSE
     C*
     C                     Z-ADD$1DSRN    WWSTRN
     C                     END
     C*
     C           *INKC     IFEQ '0'
     C*
     C           *IN27     CASEQ'1'       #BG              Rollup
     C           *INKK     CASEQ'1'       #BB              CMD/11
     C           *INKL     CASEQ'1'       #BC              CMD/12
     C           *INKM     CASEQ'1'       #BH              CMD/13
     C************INKX     CASEQ'1'       #BD              CMD/23         063335
     C           *INKY     CASEQ'1'       #BE              CMD/24
     C                     CAS            #BF              Enter
     C                     END
     C*
     C                     ELSE
     C*
     C           WWCALL    IFEQ '1'
     C                     MOVE '03'      WWFCTN
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BA         - THIS SUBROUTINE VALIDATES INPUT SCREEN 1          *
     C**                                                                 *
     C** CALLS       - Y2CLMSC ZASNMS                                    *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BA       BEGSR
     C*
     C** Disable CMD/11 CMD/12 CMD/23 CMD/24 on screen 1; Screen 1 is not
     C** valid;
     C** Clear message queue.
     C                     MOVE '0'       *IN45
     C                     MOVE '0'       *IN49
     C                     MOVE 'N'       WWVLD1
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ
     C                     PARM           WWPGQR
     C*
     C** Validate the customer number or shortname
     C*
     C** The first character must be alphanumeric or blank
     C           WWCCH1    LOKUPALPNU                    34
     C           *IN34     IFEQ '0'
     C                     MOVE '1'       *IN33
     C           *IN33     CABEQ'1'       #BA0
     C                     END
     C**********                                                                              CSD027
     C***If*the*first character is non-numeric then check for a valid shortname               CSD027
     C********** WWCCH1    LOKUPNUM                      34                                   CSD027
     C**********                                                                              CSD027
     C********** *IN34     IFEQ '0'                                                           CSD027
     C**********                                                                              CSD027
     C***********DD1CNS    SETLLSDLBCSL5             33  35               S01498              CSD027
     C********** DD1CNS    SETLLLBLBCSJ5             33  35               S01498              CSD027
     C********** *IN35     IFEQ '1'                                                           CSD027
     C**********           MOVE '0'       *IN36                                               CSD027
     C**********           MOVE '1'       *IN37                                               CSD027
     C**********           END                                                                CSD027
     C********** *IN33     CABEQ'1'       #BA0                                                CSD027
     C**********                                                                              CSD027
     C**********           ELSE                                                               CSD027
     C**********                                                                              CSD027
     C***The*first character is numeric so check that the next 5 characters                   CSD027
     C***are*also numeric and the last 4 are blank. If still valid then                       CSD027
     C***check*that the customer number exists                                                CSD027
     C**********           Z-ADD1         WWFLD1  20                                          CSD027
     C********** WWFLD1    DOWLT6                                                             CSD027
     C**********           ADD  1         WWFLD1                                              CSD027
     C********** CUS,WWFLD1LOKUPNUM                      34                                   CSD027
     C********** *IN34     IFEQ '0'                                                           CSD027
     C**********           MOVE '1'       *IN33                                               CSD027
     C********** *IN33     CABEQ'1'       #BA0                                                CSD027
     C**********           END                                                                CSD027
     C**********           END                                                                CSD027
     C*
      * Check as a shortname                                                                  CSD027
     C           DD1CNS    CHAINLBLBCSJ5             77                                       CSD027
      * If shortname was not found                                                            CSD027
     C           *IN77     IFEQ *ON                                                           CSD027
      *                                                                                       CSD027
     C           WWC710    IFNE *BLANKS
     C                     MOVE '1'       *IN33
     C           *IN33     CABEQ'1'       #BA0
     C                     END
     C*
     C                     MOVELDD1CNS    WWCNSN  6
     C***********WWCNSN    SETLLSDLBCSL0             33  35               S01498
     C           WWCNSN    SETLLLBLBCSJ0             33  35               S01498
     C           *IN35     IFEQ '1'
     C                     MOVE '1'       *IN36
     C                     MOVE '0'       *IN37
     C                     END
     C           *IN33     CABEQ'1'       #BA0
     C*
     C                     END
     C*
     C                     GOTO #BA1
     C*
     C** Invalid customer found, load message to message subfile
     C           #BA0      TAG
     C                     MOVEL'LBM0007' ZAMSID
     C                     EXSR ZASNMS
     C           #BA1      ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BB         - THIS SUBROUTINE PROCESSES A CMD/11 TO CHANGE CCY  *
     C**                                                                 *
     C** CALLS       - Y2CLMSC                                           *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BB       BEGSR
     C*
     C** Initialize group code; Clear message code; Screen 2 is valid
     C                     MOVE *BLANKS   DD2LCG
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ
     C                     PARM           WWPGQR
     C                     MOVE 'Y'       WWVLD2
     C                     MOVE '0'       *IN47
     C*
     C** If the figures are in Portfolio currency then display them in the
     C** customer currency and vice-versa
     C                     DO   LSTRR2    WWSFCT
     C*
     C           WWSFCT    CHAINLB0322S2             99
     C*
     C           DDCRGP    IFEQ *BLANKS
     C*
     C           WWCUFG    IFEQ 'LB'
     C                     MOVE DD2EXC    DDEXPO
     C                     MOVE CUCCY     DDCCY
     C*
     C                     ELSE
     C*
     C                     MOVE DD2EXL    DDEXPO
     C***********          MOVE LBCCY     DDCCY                           S01498
     C                     MOVE LBCYCD    DDCCY                           S01498
     C                     END
     C*
     C                     UPDATLB0322S2
     C*
     C                     END
     C*
     C                     END
     C*
     C           WWCUFG    IFEQ 'LB'
     C                     MOVE 'CU'      WWCUFG
     C*
     C                     ELSE
     C*
     C                     MOVE 'LB'      WWCUFG
     C                     END
     C*
     C                     Z-ADDWWSTRN    SFLRR2
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BC         - THIS SUBROUTINE PROCESSES A CMD/12 FOR PREVIOUS   *
     C**               SCREEN                                            *
     C**                                                                 *
     C** CALLS       - *NONE                                             *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BC       BEGSR
     C*
     C** Reset CMD/12; Disable CMD/11 CMD/24; Screen 1 & 2 are no
     C** longer valid; Initialize input capable fields.
     C           WWCALL    IFEQ '0'
     C                     MOVE '0'       *INKL
     C                     MOVE '0'       *IN45
     C                     MOVE '0'       *IN49
     C                     MOVE 'N'       WWVLD1
     C                     MOVE 'N'       WWVLD2
     C                     MOVE *BLANKS   DD2LCG
     C                     MOVE *BLANKS   DD1CNS
     C*
     C                     ELSE
     C*
     C                     MOVE '12'      WWFCTN
     C                     END
     C*
     C** Previous screen is requested
     C                     MOVE 'Y'       WWPRSI
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*****************************************************************  *S01498
     C***#BD*********-*THIS*SUBROUTINE*PROCESSES*A*CMD/23*FOR*PORTFOLIO  *S01498
     C*****************MANAGEMENT*ENQUIRIES*-*EXTENSIVE*SECURITY*CHECKS  *S01498
     C*****************************************************************  *S01498
     C***CALLS*******-*ZASNMS*QCMDEXC*PMC1000*PMC0321*PMC1010*#ZE*#BDA*  *S01498
     C*****************************************************************  *S01498
     C***CALLED*BY***-*#B**********************************************  *S01498
     C*****************************************************************  *S01498
     C********************************************************************
     C***********#BD       BEGSR                                          S01498
     C***********                                                         S01498
     C****CLEAR*MESSAGE*QUEUE******************************************   S01498
     C***********          CALL 'Y2CLMSC'                                 S01498
     C***********          PARM           WWTPGQ                          S01498
     C***********          PARM           WWPGQR                          S01498
     C***********                                                         S01498
     C***Test*for*Authority*to*view*enquiries.*************************   S01498
     C***Is*customer*a*Portfolio*Management*Customer,otherwise*error.**   S01498
     C***********WWCNMC    CHAINSDPLCSL0             52                   S01498
     C***********                                                         S01498
     C***If*record*not*found*or*is*deleted*return*error.***************   S01498
     C************IN52     IFEQ '1'                                       S01498
     C***********QBRECI    ORNE 'D'                                       S01498
     C***********QBCHTP    OREQ 'D'                                       S01498
     C***********QBPCUS    ORNE 'Y'                                       S01498
     C***********          MOVEL'LBM0068' ZAMSID                          S01498
     C***********          EXSR ZASNMS                                    S01498
     C***********          MOVE 'N'       WWVLD2                          S01498
     C***********          GOTO #BD0                                      S01498
     C***********          END                                            S01498
     C***********                                                         S01498
     C***For*High*Level*Security*continue*security*checking.***********   S01498
     C***********P9HLVS    IFEQ 'Y'                                       S01498
     C***********                                                         S01498
     C***********WWUPFL    CHAINMUSER                59                   S01498
     C***********                                                         S01498
     C************IN59     IFEQ '1'                                       S01498
     C***********RECI      ORNE 'D'                                       S01498
     C***********CHTP      OREQ 'D'                        ***************S01498
     C***********          MOVEL'MUSER   'DBFILE           ** DBERROR 006 S01498
     C***********          Z-ADD6         DBASE            ***************S01498
     C***********          MOVE *BLANKS   DBKEY                           S01498
     C***********          MOVELWWUPFL    DBKEY                           S01498
     C***********          MOVE '1'       *INU7                           S01498
     C***********          MOVE '1'       *INU8                           S01498
     C***********          MOVE '1'       *INLR                           S01498
     C***********          EXSR #ZE                                       S01498
     C***********          RETRN                                          S01498
     C***********          END                                            S01498
     C***********                                                         S01498
     C***If*user*has*an*account*officer*check*if*the*a/c*officer*is****   S01498
     C***authorised*to*view*customer*portfolio*details.****************   S01498
     C***********ACOC      IFNE *BLANKS                                   S01498
     C***********ACOC      IFNE '*A'                                      S01498
     C***********ACOC      ANDNEBBACOC                                    S01498
     C***********          MOVEL'LBM0069' ZAMSID                          S01498
     C***********          EXSR ZASNMS                                    S01498
     C***********          MOVE 'N'       WWVLD2                          S01498
     C***********          GOTO #BD0                                      S01498
     C***********          END                                            S01498
     C***********                                                         S01498
     C***********          ELSE                                           S01498
     C***********                                                         S01498
     C***********BBACOC    CHAINSDACOFL1             60                   S01498
     C************IN60     IFEQ '1'                                       S01498
     C***********AZTYLC    OREQ 'D'                        ***************S01498
     C***********          MOVEL'SDACOFL1'DBFILE           ** DBERROR 007 S01498
     C***********          Z-ADD7         DBASE            ***************S01498
     C***********          MOVE *BLANKS   DBKEY                           S01498
     C***********          MOVELBBACOC    DBKEY                           S01498
     C***********          MOVE '1'       *INU7                           S01498
     C***********          MOVE '1'       *INU8                           S01498
     C***********          MOVE '1'       *INLR                           S01498
     C***********          EXSR #ZE                                       S01498
     C***********          RETRN                                          S01498
     C***********          END                                            S01498
     C***********AZDPCD    IFNE DEPC                                      S01498
     C***********          MOVEL'LBM0069' ZAMSID                          S01498
     C***********          EXSR ZASNMS                                    S01498
     C***********          MOVE 'N'       WWVLD2                          S01498
     C***********          GOTO #BD0                                      S01498
     C***********          END                                            S01498
     C***********          END                                            S01498
     C***********          END                                            S01498
     C***********                                                         S01498
     C***The*user*is*authorised*to*Portfolio*Management*Enquiries.*****   S01498
     C***Change*current*job*to*become*a*Group*Job*called*CUSTOMER******   S01498
     C***********          MOVE ARR,1     CMD    80                       S01498
     C***********          Z-ADD80        LEN    155                      S01498
     C***********          CALL 'QCMDEXC'                                 S01498
     C***********          PARM           CMD                             S01498
     C***********          PARM           LEN                             S01498
     C***********                                                         S01498
     C***Set*up*Group*Data*Area****************************************   S01498
     C***********          EXSR #BDA                                      S01498
     C***********                                                         S01498
     C***Write*to*Group*Data*Area**************************************   S01498
     C***********                                                         S01498
     C*****Write*to*Local*Data*Area************************************   S01498
     C***********          CALL 'PMC1001'                                 S01498
     C***********          PARM           WWPLDA                          S01498
     C***********                                                         S01498
     C*****Write*to*Group*Data*Area************************************   S01498
     C***********          CALL 'PMC1002'                                 S01498
     C***********          PARM           WWPGDA                          S01498
     C***********                                                         S01498
     C***Access*Portfolio*Management*Enquiries*************************   S01498
     C***********          CALL 'PMC0621'                                 S01498
     C***********          PARM           WWUPFL                          S01498
     C***********                                                         S01498
     C***Access*Group*Data*Area****************************************   S01498
     C*****Retrieve*contents*of*Group*Data*Area*to*check*for*DBERROR***   S01498
     C*****(Nothing*required*from*WWPLDA)******************************   S01498
     C***********          CALL 'PMC1004'                                 S01498
     C***********          PARM           WWPGDA                          S01498
     C***********                                                         S01498
     C***If*database*error*condition*exists*load*required*error********   S01498
     C***Information*from**GDA*to*the*LDA******************************   S01498
     C***********QMDBER    IFEQ 'Y'                                       S01498
     C***********          MOVELQMPGM     DBPGM            ***************S01498
     C***********          MOVELQMFILE    DBFILE           ** DBERROR xxx S01498
     C***********          Z-ADDQMERRN    DBASE            ***************S01498
     C***********          MOVE QMKEY     DBKEY                           S01498
     C***********          MOVE '1'       *INU7                           S01498
     C***********          MOVE '1'       *INU8                           S01498
     C***********          MOVE '1'       *INLR                           S01498
     C***********                                                         S01498
     C***Change*current*job*to*become*a*NON-Group*Job******************   S01498
     C***********          MOVE ARR,2     CMD                             S01498
     C***********          CALL 'QCMDEXC'                                 S01498
     C***********          PARM           CMD                             S01498
     C***********          PARM           LEN                             S01498
     C***********          EXSR #ZE                                       S01498
     C***********          RETRN                                          S01498
     C***********                                                         S01498
     C***********          ELSE                                           S01498
     C***********                                                         S01498
     C***********QMENQT    IFEQ 'Y'                                       S01498
     C***********          MOVE '03'      WWFCTN                          S01498
     C***********          MOVE '1'       *INKC                           S01498
     C***********                                                         S01498
     C***Change*current*job*to*become*a*NON-Group*Job******************   S01498
     C***********          MOVE ARR,2     CMD                             S01498
     C***********          CALL 'QCMDEXC'                                 S01498
     C***********          PARM           CMD                             S01498
     C***********          PARM           LEN                             S01498
     C***********          GOTO #BD0                                      S01498
     C***********          END                                            S01498
     C***********          END                                            S01498
     C***********                                                         S01498
     C***Change*current*job*to*become*a*NON-Group*Job******************   S01498
     C***********          MOVE ARR,2     CMD                             S01498
     C***********          CALL 'QCMDEXC'                                 S01498
     C***********          PARM           CMD                             S01498
     C***********          PARM           LEN                             S01498
     C***********                                                         S01498
     C***********          Z-ADDWWSTRN    SFLRR2                          S01498
     C***********#BD0      ENDSR                                          S01498
     C***********                                                         S01498
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*****************************************************************  *S01498
     C***#BDA********-*THIS*SUBROUTINE*LOADS*THE*GROUP*DATA*AREA*******  *S01498
     C*****************************************************************  *S01498
     C***CALLS*******-**NONE*******************************************  *S01498
     C*****************************************************************  *S01498
     C***CALLED*BY***-*#BD*********************************************  *S01498
     C*****************************************************************  *S01498
     C********************************************************************
     C***********#BDA      BEGSR                                          S01498
     C***********          MOVE ' '       QMRECI                          S01498
     C***********          MOVE BJMRDT    QMRUNA                          S01498
     C***********          Z-ADDBJRDNB    QMRDNB                          S01498
     C***********          MOVE BJCYCD    QMCYCD                          S01498
     C***********          MOVE 'T'       QMTVPS                          S01498
     C***********          MOVE BBCUST    QMCNUM                          S01498
     C***********          MOVE BBCRNM    QMCRNM                          S01498
     C***********          MOVE QBCSBY    QMCSBY                          S01498
     C***********          Z-ADDQBBYDP    QMBYDP                          S01498
     C***********BBCNCZ    CHAINSDCTRYL1             57                   S01498
     C************IN57     IFEQ '0'                                       S01498
     C***********A4TYLC    ANDNE'D'                                       S01498
     C***********          MOVE A4CNNM    QMNCTX                          S01498
     C***********                                                         S01498
     C***********          ELSE                                           S01498
     C***********                                                         S01498
     C***********          MOVE *BLANKS   QMNCTX                          S01498
     C***********          END                                            S01498
     C***********BBCOLC    CHAINSDCTRYL1             57                   S01498
     C************IN57     IFEQ '0'                                       S01498
     C***********A4TYLC    ANDNE'D'                                       S01498
     C***********          MOVE A4CNNM    QMDCTX                          S01498
     C***********                                                         S01498
     C***********          ELSE                                           S01498
     C***********                                                         S01498
     C***********          MOVE *BLANKS   QMDCTX                          S01498
     C***********          END                                            S01498
     C***********          MOVE QBLANG    QMLANG                          S01498
     C***********                                                         S01498
     C***DATE*OF*BIRTH*************************************************   S01498
     C***********          Z-ADDQBBDAT    WWDAT1                          S01498
     C***********                                                         S01498
     C***********WWMON1    IFGT 0                                         S01498
     C***********                                                         S01498
     C***********          Z-ADDWWMON1    X       20                      S01498
     C***********          Z-ADDWWDAY1    WWDAY2                          S01498
     C***********          Z-ADDWWYER1    WWYER2                          S01498
     C***********          MOVELZMNM,X    WWMON2                          S01498
     C***********                                                         S01498
     C***********          MOVE WWDAT2    QMBDA1                          S01498
     C***********                                                         S01498
     C***********          ELSE                                           S01498
     C***********                                                         S01498
     C***********          MOVE *BLANKS   QMBDA1                          S01498
     C***********          END                                            S01498
     C***********                                                         S01498
     C***********          MOVE BBACOC    QMACOC                          S01498
     C***********BBACOC    CHAINSDACOFL1             60                   S01498
     C************IN60     IFEQ '0'                                       S01498
     C***********AZTYLC    ANDNE'D'                                       S01498
     C***********          MOVE AZACON    QMACON                          S01498
     C***********                                                         S01498
     C***********          ELSE                                           S01498
     C***********                                                         S01498
     C***********          MOVE *BLANKS   QMACON                          S01498
     C***********          END                                            S01498
     C***********                                                         S01498
     C*****Date*account*officer*assumed********************************   S01498
     C****                 Z-ADDQBDASS    ZDAYNO                          S01313
     C****                 EXSR ZDATE2                                    S01313
     C****                 MOVE ZADATE    QMDTA1                          S01313
     C***********                                                         S01498
     C***********          MOVE QBSAFI    QMSAFI                          S01498
     C***********          MOVE QBDCMS    QMDCMS                          S01498
     C****                 MOVE QBFPVC    QMFPVC                          S01313
     C***********          MOVE *BLANKS   QMPTF1                          S01498
     C***********          MOVE *BLANKS   QMPTFN                          S01498
     C***********          MOVE *BLANKS   QMTPMV                          S01498
     C***********          MOVE *BLANKS   QMVPMV                          S01498
     C***********          MOVE *BLANKS   QMPTAI                          S01498
     C***********          MOVE *BLANKS   QMPVAI                          S01498
     C***********          MOVE *BLANKS   QMPTCY                          S01498
     C***********          Z-ADD*ZEROS    QMPCDP                          S01498
     C***********          MOVE *BLANKS   QMPTFT                          S01498
     C***********          MOVE *BLANKS   QMDPO1                          S01498
     C***********          MOVE *BLANKS   QMPPDG                          S01498
     C***********          MOVE *BLANKS   QMDSPG                          S01498
     C***********          MOVE *BLANKS   QMNDSP                          S01498
     C***********          MOVE *BLANKS   QMDSPT                          S01498
     C***********          Z-ADD*ZEROS    QMDSPS                          S01498
     C***********          MOVE *BLANKS   QMDGMV                          S01498
     C***********          MOVE *BLANKS   QMDGAI                          S01498
     C***********          MOVE *BLANKS   QMINNR                          S01498
     C***********          MOVE *BLANKS   QMISTN                          S01498
     C***********          Z-ADD*ZEROS    QMITDS                          S01498
     C***********          MOVE *BLANKS   QMTIMV                          S01498
     C***********          MOVE *BLANKS   QMVIMV                          S01498
     C***********          MOVE *BLANKS   QMITAI                          S01498
     C***********          MOVE *BLANKS   QMIVAI                          S01498
     C***********          MOVE *BLANKS   QMMODI                          S01498
     C***********          MOVE *BLANKS   QMSESN                          S01498
     C***********          Z-ADD*ZEROS    QMTRNB                          S01498
     C***********          MOVE *BLANKS   QMENQT                          S01498
     C***********          MOVE *BLANKS   QMDBER                          S01498
     C***********          MOVE 'N'       QMATTN                          S01498
     C***********          MOVE *BLANKS   QMPGM                           S01498
     C***********          MOVE *BLANKS   QMFILE                          S01498
     C***********          MOVE *BLANKS   QMKEY                           S01498
     C***********          Z-ADD*ZEROS    QMERRN                          S01498
     C***********          ENDSR                                          S01498
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BE         - THIS SUBROUTINE PROCESSES A CMD/24 FOR PORTFOLIO  *
     C**               MANAGEMENT DOCUMENTATION                          *
     C**                                                                 *
     C** CALLS       - #ZE PM0160 Y2CLMSC                                *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BE       BEGSR
     C*
     C**  CLEAR MESSAGE QUEUE
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ
     C                     PARM           WWPGQR
     C*
     C                     MOVE '1'       *IN50
     C                     MOVE '0'       WWRTCD
     C                     MOVE WWCNMC    WWPNP8
     C***********          UNLCKDTAR                                      S01498
     C                     UNLCKLDA                                       S01498
     C                     CALL 'PM0160'
     C                     PARM           WWACTN
     C                     PARM           WWRTCD
     C                     PARM           WWPNP8
     C                     PARM           WWFNMO
     C*
     C** If errors in called program , return to point of call
     C************LOCK     IN   DTAR                                      S01498
     C           *LOCK     IN   LDA                                       S01498
     C           DBASE     IFGT 0
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     EXSR #ZE
     C                     RETRN
     C*
     C                     ELSE
     C*
     C                     MOVEL'LB0322'  DBPGM
     C                     END
     C           WWRTCD    IFEQ '1'
     C                     MOVE '03'      WWFCTN
     C                     MOVE '1'       *INKC
     C*
     C                     ELSE
     C*
     C                     Z-ADDWWSTRN    SFLRR2
     C                     END
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BF         - THIS SUBROUTINE PROCESSES AN ENTER FROM INPUT     *
     C**               SCREEN 2                                          *
     C**                                                                 *
     C** CALLS       - Y2CLMSC #ZA #ZB                                   *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BF       BEGSR
     C*
     C** Initialize group code error indicator (*IN47); Screen 2 is
     C** valid unless error occurs; Update subfile relative record
     C** number;
     C                     MOVE '0'       *IN47
     C                     MOVE 'Y'       WWVLD2
     C                     Z-ADDWWSTRN    SFLRR2
     C*
     C** Clear message subfile.
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C** If group code entered , access file for sequence number
     C           DD2LCG    IFNE *BLANKS
     C           BBPAIN    IFNE 'P'
     C           KLIST1    SETLLLBEXCOL0             53  54
     C           *IN53     IFEQ '0'
     C                     READ LBEXCOL0                 55
     C                     END
     C           WWCNMB    IFNE EXCNUM
     C           *IN53     OREQ '1'
     C                     READPLBEXCOL0                 55
     C                     END
     C*
     C                     ELSE
     C*
     C           KLIST2    SETLLLBEXCOL1             53  54
     C           *IN53     IFEQ '0'
     C                     READ LBEXCOL1                 55
     C                     END
     C           WWCNMC    IFNE EXPCNB
     C           *IN53     OREQ '1'
     C                     READPLBEXCOL1                 55
     C                     END
     C                     END
     C*
     C           BBPAIN    IFNE 'P'
     C           KLIST3    SETLLLBEXCOL2                 46
     C*
     C                     ELSE
     C*
     C           KLIST4    SETLLLBEXCOL3                 56
     C                     END
     C*
     C** Clear the input screen 2 subfile
     C                     MOVE '1'       *IN30
     C                     WRITELB0322C2
     C                     MOVE '0'       *IN30
     C*
     C** Initialize fields
     C                     Z-ADD0         LSTRR2
     C                     MOVE '0'       *IN47
     C                     MOVE *BLANKS   DD1CNS
     C                     MOVE *BLANKS   DD2LCG
     C                     MOVE *BLANKS   WWLCGR
     C                     MOVE 'LB'      WWCUFG
     C***********          MOVE LBCCY     DDCCY                           S01498
     C                     MOVE LBCYCD    DDCCY                           S01498
     C*
     C** Load subfile
     C           BBPAIN    IFNE 'P'
     C                     READ LBEXCOL2                 61
     C                     EXSR #ZA
     C*
     C                     ELSE
     C*
     C                     READ LBEXCOL3                 51
     C                     EXSR #ZB
     C                     END
     C*
     C                     END
     C           #BF0      ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BG         - THIS SUBROUTINE PROCESSES ROLL-UP FOR CUSTOMERS   *
     C**               OR PARENTS                                        *
     C**                                                                 *
     C** CALLS       - #ZA #ZB                                           *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BG       BEGSR
     C*
     C** Decide whether ROLL-UP is required for a customer or parent
     C           BBPAIN    IFEQ 'P'
     C                     EXSR #ZB
     C*
     C                     ELSE
     C*
     C                     EXSR #ZA
     C                     END
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BH         - THIS SUBROUTINE PROCESSES A CMD/13 OTHER DETAILS  *
     C**                                                                 *
     C** CALLS       - Y2CLMSC                                           *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BH       BEGSR
     C*
     C** Initialize group code; Clear message code; Screen 2 is valid
     C                     MOVE *BLANKS   DD2LCG
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ
     C                     PARM           WWPGQR
     C                     MOVE 'Y'       WWVLD2
     C                     MOVE '0'       *IN47
     C*
     C** IF THE REFERENCE DETAILS ARE IN NON DATE FORMAT DISPLAY THEM
     C** IN DATE FORMAT AND VICE-VERSA
     C                     DO   LSTRR2    WWSFCT
     C*
     C           WWSFCT    CHAINLB0322S2             99
     C*
     C           DDCRGP    IFEQ *BLANKS
     C*
     C           WWRFFG    IFEQ 'RA'
     C*
     C                     MOVE DD2RFB    DDREFE
     C*
     C                     ELSE
     C*
     C                     MOVE DD2RFA    DDREFE
     C*
     C                     END
     C*
     C                     UPDATLB0322S2
     C*
     C                     END
     C*
     C                     END
     C*
     C           WWRFFG    IFEQ 'RA'
     C                     MOVE 'RB'      WWRFFG
     C*
     C                     ELSE
     C*
     C                     MOVE 'RA'      WWRFFG
     C                     END
     C*
     C                     Z-ADDWWSTRN    SFLRR2
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZA         - THIS SUBROUTINE LOADS A PAGE OF RECORDS TO THE    *
     C**               SUBFILE OF INPUT SCREEN 2 USING CUSTOMER DETAILS  *
     C**                                                                 *
     C** CALLS       - #ZC                                               *
     C**                                                                 *
     C** CALLED BY   - #B #BF #BG                                        *
     C**                                                                 *
     C********************************************************************
     C           #ZA       BEGSR
     C*
     C** Load a page of subfile records
     C                     Z-ADDLSTRR2    SFLRR2
     C                     Z-ADD0         WWSFCT  40
     C*
     C** Set on no details found indicator
     C                     MOVE '1'       *IN42
     C*
     C           *IN61     DOWEQ'0'
     C           WWSFCT    ANDLT13
     C           EXCNUM    ANDEQWWCNMB
     C*                                                                   B5923
     C** Don't process unrealized profit or loss                          B5923
     C/COPY WNCPYSRC,LB0322C002
     C           EXINST    IFNE LBFXUP                                    B5923
     C           EXINST    ANDNELBFXUL                                    B5923
     C           EXINST    ANDNELBPMUP                                    B5923
     C           EXINST    ANDNELBPMUL                                    B5923
     C           EXAMNT    ANDNE*ZEROS                                    B5929
     C*
     C** Set up output fields using customer details
     C                     EXSR #ZC
     C*
     C           WWSFCT    IFLT 13
     C                     ADD  1         WWSFCT
     C                     ADD  1         SFLRR2
     C                     WRITELB0322S2
     C                     READ LBEXCOL2                 61               B7881
     C*                                                                   B5923
     C                     END                                            B5923
     C*                                                                   B5923
     C***********          READ LBEXCOL2                 61               B5923
     C                     END
     C/COPY WNCPYSRC,LB0322C003
     C*********************READ LBEXCOL2                 61         B5923 B7881
     C*
     C                     END
     C*
     C** Set on subfile end indicator on change of customer or End of File
     C           EXCNUM    IFNE WWCNMB
     C           *IN61     OREQ '1'
     C                     MOVE '1'       *IN31
     C*
     C                     ELSE
     C*
     C                     MOVE '0'       *IN31
     C                     END
     C*
     C                     Z-ADDSFLRR2    LSTRR2
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZB         - THIS SUBROUTINE LOADS A PAGE OF RECORDS TO THE    *
     C**               SUBFILE OF INPUT SCREEN 2 USING PARENT DETAILS    *
     C**                                                                 *
     C** CALLS       - #ZC                                               *
     C**                                                                 *
     C** CALLED BY   - #B #BF #BG                                        *
     C**                                                                 *
     C********************************************************************
     C           #ZB       BEGSR
     C*
     C** Load a page of subfile records
     C                     Z-ADDLSTRR2    SFLRR2
     C                     Z-ADD0         WWSFCT  40
     C*
     C** Set on no details found indicator
     C                     MOVE '1'       *IN42
     C*
     C           *IN51     DOWEQ'0'
     C           WWSFCT    ANDLT13
     C           EXPCNB    ANDEQWWCNMC
     C*                                                                   B5923
     C** Don't process unrealized profit or loss                          B5923
     C/COPY WNCPYSRC,LB0322C004
     C           EXINST    IFNE LBFXUP                                    B5923
     C           EXINST    ANDNELBFXUL                                    B5923
     C           EXINST    ANDNELBPMUP                                    B5923
     C           EXINST    ANDNELBPMUL                                    B5923
     C           EXAMNT    ANDNE*ZEROS                                    B5929
     C*
     C** Set up output fields using parent details
     C                     EXSR #ZC
     C*
     C           WWSFCT    IFLT 13
     C                     ADD  1         WWSFCT
     C                     ADD  1         SFLRR2
     C                     WRITELB0322S2
     C                     READ LBEXCOL3                 51               B7881
     C*                                                                   B5923
     C                     END                                            B5923
     C*                                                                   B5923
     C***********          READ LBEXCOL3                 51               B5923
     C                     END
     C/COPY WNCPYSRC,LB0322C005
     C*********************READ LBEXCOL3                 51         B5923 B7881
     C*
     C                     END
     C*
     C** Set on subfile end indicator on change of customer or End of File
     C           EXPCNB    IFNE WWCNMC
     C           *IN51     OREQ '1'
     C                     MOVE '1'       *IN31
     C*
     C                     ELSE
     C*
     C                     MOVE '0'       *IN31
     C                     END
     C*
     C                     Z-ADDSFLRR2    LSTRR2
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZC         - THIS SUBROUTINE SETS UP OUTPUT FIELDS FOR THE     *
     C**               SUBFILE OF INPUT SCREEN 2                         *
     C**                                                                 *
     C** CALLS       - #ZE ZSEDIT SCONV                                  *
     C**                                                                 *
     C** CALLED BY   - #ZA #ZB                                           *
     C**                                                                 *
     C********************************************************************
     C           #ZC       BEGSR
     C*
     C** Write record to subfile for each new group code
     C           EXLCGR    IFNE WWLCGR
     C***********EXLCGR    CHAINLBGROUL1             40                   S01498
     C************IN40     IFEQ '1'                                       S01498
     C***********GPRECI    OREQ '*'                                       S01498
     C*                                                                   S01498
     C** Get group name using access object                               S01498
     C*                                                                   S01498
     C                     CALL 'AOGROUR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM EXLCGR    P@LCGR  3                       S01498
     C           SDGROU    PARM SDGROU    DSFDY                           S01498
     C*                                                                   S01498
     C** Check if error occurred                                          S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBKEY
     C***********          MOVEL'LBGROUL1'DBFILE           ***************S01498
     C                     MOVE 'LBGROUPD'DBFILE           ***************S01498
     C                     MOVELEXLCGR    DBKEY            ** DBERROR 008 **
     C                     Z-ADD8         DBASE            *****************
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZE
     C                     RETRN
     C                     END
     C*
     C                     MOVE '1'       *IN63
     C                     MOVE EXLCGR    DDCRGP
     C                     MOVE *BLANKS   DDINSE
     C                     MOVELGPLCGN    DDINSE
     C                     MOVE *BLANKS   DDINCY
     C                     MOVE *BLANKS   DDEXPO
     C                     MOVE *BLANKS   DDREFE
     C                     MOVE EXLCGR    WWLCGR
     C                     ADD  1         WWSFCT
     C                     ADD  1         SFLRR2
     C                     WRITELB0322S2
     C                     MOVE '0'       *IN63
     C                     END
     C*
     C** Set off no details found indicator
     C                     MOVE '0'       *IN42
     C*
     C                     MOVE *BLANKS   DDCRGP
     C*
     C** Access Instrument file to obtain Instrument Type Narrative
     C***********EXINST    CHAINSDPLINL4             44                   S01498
     C************IN44     IFEQ '1'                                       S01498
     C***********PDRECI    OREQ '*'                                       S01498
     C*                                                                   S01498
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM EXINST    P@INST  3                       S01498
     C           SDPLIN    PARM SDPLIN    DSFDY                           S01498
     C*                                                                   S01498
     C**  Check if error occurred                                         S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBKEY
     C***********          MOVEL'SDPLINL4'DBFILE           ***************S01498
     C                     MOVE 'SDPLINPD'DBFILE           ***************S01498
     C                     MOVELEXINST    DBKEY            * DBERROR 009 *
     C                     Z-ADD9         DBASE            ***************
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZE
     C                     RETRN
     C*
     C                     ELSE
     C*
     C                     MOVE *BLANKS   DDINSE
     C                     MOVE PDISTN    DDINSE
     C                     END
     C*
     C** FORMAT INSTRUMENT CURRENCY
     C                     MOVE EXCCY     DDINCY
     C*
     C** CALCULATE THE EXPOSURE AMOUNT IN PORTFOLIO CURRENCY
     C                     Z-ADDEXAMNT    WWAMNT
     C           WWDILB    IFNE 0
     C           WWAMNT    DIV  WWDILB    WWAMNT    H
     C                     END
     C***********WWAMNT    DIV  1000      WWAMNT    H                     B5929
     C                     Z-ADDWWAMNT    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DD2EXL
     C*
     C** IF CUSTOMER CURRENCY DIFFERS FROM THE PORTFOLIO CURRENCY THEN
     C** CALCULATE THE EXPOSURE AMOUNT IN CUSTOMER CURRENCY
     C***********CUCCY     IFEQ LBCCY                                     S01498
     C           CUCCY     IFEQ LBCYCD                                    S01498
     C*
     C                     MOVE DD2EXL    DD2EXC
     C*
     C                     ELSE
     C*
     C** CALCULATE THE EXPOSURE AMOUNT IN CUSTOMER CURRENCY
     C                     Z-ADDEXAMNT    WWAMTI
     C                     EXSR SCONV
     C           WWDICU    IFNE 0
     C           WWAMTO    DIV  WWDICU    WWAMTO    H
     C                     END
     C***********WWAMTO    DIV  1000      WWAMTO    H                     B5929
     C                     Z-ADDWWAMTO    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    DD2EXC
     C*
     C                     END
     C*
     C** FORMAT REFERENCE DETAILS
     C*
     C** IF REGENERATION ENTRY EXREGE IS '10'
     C           EXREGE    IFEQ '10'
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFA
     C***********          MOVEL'deal'    WW0105
     C                     MOVEL'Deal'    WW0105
     C                     MOVE WR0106    WW0611
     C                     MOVE WWALL     DD2RFA
     C*
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFB
     C***********          MOVE 'start'   WW0105
     C                     MOVE 'Start'   WW0105
     C                     Z-ADDEXDDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WW0713
     C                     MOVE 'end'     WW1517
     C                     Z-ADDEXVDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WW1925
     C                     MOVE WWALL     DD2RFB
     C                     END
     C*
     C** IF REGENERATION ENTRY EXREGE IS '15'
     C           EXREGE    IFEQ '15'
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFA
     C***********          MOVEL'deal'    WW0105
     C                     MOVEL'Deal'    WW0105
     C                     MOVE WR0106    WW0611
     C*
     C           WR0712    IFEQ *BLANKS
     C                     MOVE *BLANKS   WW1316
     C                     MOVE *BLANKS   WW1823
     C*
     C                     ELSE
     C*
     C                     MOVE 'with'    WW1316
     C                     MOVE WR0712    WW1823
     C                     END
     C*
     C                     MOVE WWALL     DD2RFA
     C*
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFB
     C***********          MOVEL'deal'    WW0105
     C                     MOVEL'Deal'    WW0105
     C                     Z-ADDEXDDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WW0612
     C                     MOVE 'value'   WW1418
     C                     Z-ADDEXVDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WW2026
     C                     MOVE WWALL     DD2RFB
     C                     END
     C*
     C** IF REGENERATION ENTRY EXREGE IS '20' AND EXINST IS NOT
     C** LBFXMA AND NOT LBPMMA
     C           EXREGE    IFEQ '20'
     C           EXINST    ANDNELBFXMA
     C           EXINST    ANDNELBPMMA
     C*                                                                   B10521
     C           EXINST    IFEQ LBFXMC                                    B10521
     C                     MOVEL*BLANKS   DD2RFA                          B10521
     C                     MOVEL*BLANKS   DD2RFB                          B10521
     C                     ELSE                                           B10521
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFA
     C***********          MOVEL'deal'    WW0105
     C                     MOVEL'Deal'    WW0105
     C                     MOVE WR0106    WW0611
     C                     MOVE WWALL     DD2RFA
     C*
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFB
     C***********          MOVEL'deal'    WW0105
     C                     MOVEL'Deal'    WW0105
     C                     Z-ADDEXDDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WW0612
     C                     MOVE 'value'   WW1418
     C                     Z-ADDEXVDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WW2026
     C                     MOVE WWALL     DD2RFB
     C                     END                                            B10521
     C                     END
     C*
     C** IF REGENERATION ENTRY EXREGE IS '20' AND EXINST IS
     C** LBFXMA OR LBPMMA
     C           EXREGE    IFEQ '20'
     C           EXINST    IFEQ LBFXMA
     C           EXINST    OREQ LBPMMA
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFA
     C***********          MOVE 'limit'   WW0105
     C           LBMGLE    IFEQ 'L'                                       B5929
     C***********LBIC      ANDEQ'Y'                                 33503 S01498
     C                     MOVE 'Limit'   WW0105
     C                     ELSE                                           B5929
     C                     MOVE 'Expos'   WW0105                          B5929
     C                     END                                            B5929
     C                     MOVE WR0113    ZFLD15
     C                     MOVE 'J'       ZECODE
     C                     Z-ADD2         ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    WW0723
     C                     MOVE WWALL     DD2RFA
     C                     Z-ADD0         ZDECS
     C*
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFB
     C                     MOVE DD2RFA    DD2RFB
     C                     END
     C                     END
     C*
     C** IF REGENERATION ENTRY EXREGE IS '30'
     C           EXREGE    IFEQ '30'
     C           EXREGE    OREQ '31'                                      B5929
     C                     MOVE *BLANKS   DDINSE                          B7801
     C                     MOVELEXINST    DDINSE                          B7801
     C                     MOVE EXADAM    AMNTDS                          B7804
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFA
     C***********          MOVEL'loan'    WW0105
     C           EXREGE    IFEQ '30'                                      B5929
     C                     MOVEL'Loan'    WW0105
     C                     ELSE                                           B5929
     C                     MOVEL'Gtee'    WW0105                          B5929
     C                     END                                            B5929
     C                     MOVE WR0106    WW0611
     C                     MOVE 'maturity'WW1320
     C                     Z-ADDEXMDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WW2228
     C                     MOVE WWALL     DD2RFA
     C*
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFB
     C***********          MOVE 'value'   WW0105
     C                     MOVE 'Value'   WW0105
     C                     Z-ADDEXVDAT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WW0713
     C           EXRLDT    IFNE *ZEROS                                    B5929
     C                     MOVE 'rollvr'  WW1520
     C                     Z-ADDEXRLDT    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    WW2228
     C                     END                                            B5929
     C                     MOVE WWALL     DD2RFB
     C                     END
     C*
     C** IF REGENERATION ENTRY EXREGE IS '35' OR '80'
     C           EXREGE    IFEQ '35'
     C           EXREGE    OREQ '80'
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFA
     C***********          MOVEL'issued'  WW0109
     C                     MOVEL'Issued'  WW0109
     C                     MOVE ' to'     WW0109
     C                     MOVE WR0106    WW1116
     C                     MOVE 'type'    WW1922
     C                     MOVE WR0707    WW2424
     C                     MOVE WWALL     DD2RFA
     C*
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFB
     C***********          MOVEL'sequence'WW0109
     C                     MOVEL'Sequence'WW0109
     C                     MOVE WR0810    WW1012
     C                     MOVE WR1113    WW1416
     C                     MOVE 'code'    WW1922
     C                     MOVE WR1416    WW2426
     C                     MOVE WWALL     DD2RFB
     C                     END
     C*
     C** IF REGENERATION ENTRY EXREGE IS '40'
     C           EXREGE    IFEQ '40'
     C                     MOVE *BLANKS   DDINSE                          B5929
     C                     MOVE EXINST    INSTDS                          B5929
     C***********          MOVE EXCCY     NARRDS                    B5929 B5997
     C                     MOVE EXADAM    AMNTDS                          B5929
     C*                                                                   B5929
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFA
     C***********          MOVEL'acc. '   WW0109
     C***********          MOVE 'code'    WW0109
     C***********          MOVE WR0104    WW1114
     C***********          MOVE 'seq'     WW1618
     C***********          MOVE WR0506    WW2021
     C***********          MOVE WWALL     DD2RFA
     C*                                                                   B5923
     C***********          MOVE BBCUST    CNUMDS                    B5923 B7883
     C                     MOVE EXCNUM    CNUMDS                          B7883
     C                     MOVE EXCCY     CCYCDS                          B5923
     C                     MOVE WR0104    ACODDS                          B5923
     C                     MOVE WR0506    ACSQDS                          B5923
     C                     MOVELACCNDS    DD2RFA                          B5923
     C*
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFB
     C***********          MOVE 'retail ' WW0107
     C***********          MOVE WR0716    WW0817
     C***********          MOVE WWALL     DD2RFB
     C                     MOVE DD2RFA    DD2RFB                          B5923
     C                     END
     C*
     C** IF REGENERATION ENTRY EXREGE IS '50'
     C           EXREGE    IFEQ '50'
     C                     MOVE *BLANKS   DDINSE                          B5929
     C                     MOVE EXINST    INSTDS                          B5929
     C                     MOVE WR0110    SESNDS                          B5929
     C*                                                                   B5929
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFA
     C***********          MOVEL'short'   WW0109                          B5923
     C***********          MOVE 'name'    WW0109                          B5923
     C***********          MOVELWR0110    WW1120                          B5923
     C***********          MOVE WWALL     DD2RFA                          B5923
     C           WR0110    CHAINSECTY                58                   B5923
     C           *IN58     IFEQ '1'                                       B5923
     C           RECI      OREQ '*'                                       B5923
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBKEY                           B5923
     C***********          MOVEL'SECTY   'DBFILE              ******B5923 S01498
     C                     MOVE 'SECTY   'DBFILE           *********B5923 S01498
     C                     MOVELWR0110    DBKEY            * DBERROR 011 *B5923
     C                     Z-ADD11        DBASE            ***************B5923
     C                     MOVE '1'       *INU7                           B5923
     C                     MOVE '1'       *INU8                           B5923
     C                     MOVE '1'       *INLR                           B5923
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZE                                       B5923
     C                     RETRN                                          B5923
     C*                                                                   B5923
     C                     ELSE                                           B5923
     C                     MOVELSRPN      DD2RFA                          B5923
     C                     END                                            B5923
     C*
     C                     MOVE *BLANKS   WWALL
     C                     MOVE *BLANKS   DD2RFB
     C**  PUT NOMINAL INTO SECOND NARRATIVE FIELD                         38835
     C**                   MOVE DD2RFA    DD2RFB                          38835
     C                     MOVE EXADAM    WWALL                           38835
     C                     MOVEL'Nominal' WWALL                           38835
     C                     MOVE WWALL     DD2RFB                          38835
     C                     END
     C*
     C** MOVE HIDDEN FIELDS TO EXPOSURE AMOUNT FIELD AND
     C** FORMAT CORRECT CURRENCY FOR SUBFILE HEADING
     C           WWCUFG    IFEQ 'LB'
     C                     MOVE DD2EXL    DDEXPO
     C***********          MOVE LBCCY     DDCCY                           S01498
     C                     MOVE LBCYCD    DDCCY                           S01498
     C*
     C                     ELSE
     C*
     C                     MOVE DD2EXC    DDEXPO
     C                     MOVE CUCCY     DDCCY
     C                     END
     C*
     C** MOVE HIDDEN FIELDS TO REFERENCE OUTPUT FIELD
     C           WWRFFG    IFEQ 'RA'
     C                     MOVE DD2RFA    DDREFE
     C*
     C                     ELSE
     C*
     C                     MOVE DD2RFB    DDREFE
     C                     END
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZD         - THIS SUBROUTINE RETRIEVES CURRENCY DETAILS FOR    *
     C**               CUSTOMER CURRENCY                                 *
     C**                                                                 *
     C** CALLS       - #ZE                                               *
     C**                                                                 *
     C** CALLED BY   - #AA #B                                            *
     C**                                                                 *
     C********************************************************************
     C           #ZD       BEGSR
     C*
     C***********CUCCY     CHAINSDCURRL1             74                   S01498
     C*
     C************IN74     IFEQ '1'                                       S01498
     C***********A6TYLC    OREQ 'D'                                       S01498
     C*                                                                   S01498
     C** Get currency details using access object                         S01498
     C*                                                                   S01498
     C                     CALL 'AOCURRR0'                                S01498
     C                     PARM *BLANKS   P@RTCD                          S01498
     C                     PARM '*KEY   ' P@OPTN                          S01498
     C                     PARM CUCCY     P@CCY   3                       S01498
     C           SDCURR    PARM SDCURR    DSSDY                           S01498
     C*                                                                   S01498
     C** Check if an error occurred                                       S01498
     C*                                                                   S01498
     C           P@RTCD    IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBKEY            *****************
     C***********          MOVEL'SDCURRL1'DBFILE           ** DBERROR 010 S01498
     C                     MOVE 'SDCURRPD'DBFILE           ** DBERROR 010 S01498
     C                     MOVELCUCCY     DBKEY            *****************
     C                     Z-ADD10        DBASE
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZE
     C                     RETRN
     C*
     C                     ELSE
     C*
     C                     Z-ADD0         WWDICU  40
     C           A6NBDP    IFEQ 1
     C                     Z-ADD10        WWDICU
     C                     END
     C           A6NBDP    IFEQ 2
     C                     Z-ADD100       WWDICU
     C                     END
     C           A6NBDP    IFEQ 3
     C                     Z-ADD1000      WWDICU
     C                     END
     C*
     C                     Z-ADDA6SPRT    WWSRO
     C                     Z-ADDA6NBDP    WWDPO
     C                     MOVE A6MDIN    WWMDO
     C                     END
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZE         - This subroutine calls 'PM0160'                    *
     C**                                                                 *
     C** CALLS       - PM0160                                            *
     C**                                                                 *
     C***CALLED*BY***-*MAINLINE,#BD,#BE,#ZC,#ZD************************  *S01498
     C** CALLED BY   - MAINLINE,#BE,#ZC,#ZD                              *S01498
     C**                                                                 *
     C********************************************************************
     C*
     C           #ZE       BEGSR
     C           *IN50     IFEQ '1'
     C*
     C** Save WWLDA fields to restore DBERROR after this call
     C                     MOVE DBFILE    WWDBF2  8
     C                     MOVE DBKEY     WWDBK2 29
     C                     MOVE DBPGM     WWDBP2 10
     C                     Z-ADDDBASE     WWDBS2  30
     C*
     C** Call 'PM0160' if already called once during execution of program
     C                     MOVE '9'       WWRTCD  1
     C                     MOVE *BLANKS   WWPNP8  6
     C***********          UNLCKDTAR                                      S01498
     C                     UNLCKLDA                                       S01498
     C                     CALL 'PM0160'
     C                     PARM           WWACTN
     C                     PARM           WWRTCD
     C                     PARM           WWPNP8
     C                     PARM           WWFNMO
     C*
     C************LOCK     IN   DTAR                                      S01498
     C           *LOCK     IN   LDA                                       S01498
     C*
     C** If a database error was NOT already detected then check for one
     C** in PM0160 now...
     C           WWDBS2    IFEQ 0
     C*
     C** If database error in PM0160
     C           DBASE     IFGT 0
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     END
     C*
     C                     ELSE
     C*
     C** Else restore previous DBERROR
     C                     MOVE WWDBF2    DBFILE
     C                     MOVE WWDBK2    DBKEY
     C                     MOVE WWDBP2    DBPGM
     C                     Z-ADDWWDBS2    DBASE
     C                     END
     C*
     C                     END
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** ZSEDIT      - Convert a decimal amount to character             *
     C**                                                                 *
     C** CALLS       - *NONE                                             *
     C**                                                                 *
     C** CALLED BY   - #ZC                                               *
     C**                                                                 *
     C/COPY ZSRSRC,ZSEDITZ3                                              *
     C/EJECT
     C/COPY ZSRSRC,ZDATE2Z2
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** SCONV       - Convert an amount from one currency to another
     C**                                                                 *
     C** CALLS       - *NONE                                             *
     C**                                                                 *
     C** CALLED BY   - #ZC                                               *
     C**                                                                 *
     C**  Input Fields - WWAMTI 15/0 amount in input currency            *
     C**                 WWSRI  13/8 spot rate for input currency        *
     C**                 WWSRO  13/8 spot rate for output currency       *
     C**                 WWDPI  1/0  no. of decimals for input currency  *
     C**                 WWDPO  1/0  no. of decimals for output currency *
     C**                 WWMDI  1    mult/div indicator for input curr.  *
     C**                 WWMDO  1    mult/div indicator for output curr. *
     C**                                                                 *
     C**  Arrays       - POWER  powers of 10                             *
     C**                                                                 *
     C**  Output Fields- WWAMTO 15/0 output amount converted to new curr *
     C**                                                                 *
     C********************************************************************
     C           SCONV     BEGSR                           **  SCONV    **
     C*
     C** DEFINE ALL FIELDS
     C                     Z-ADDWWAMTI    WWAMTI 150
     C                     Z-ADD0         WWAMTO 150
     C           *LIKE     DEFN A6SPRT    WWSRI
     C           *LIKE     DEFN A6SPRT    WWSRO
     C           *LIKE     DEFN A6NBDP    WWDPI
     C           *LIKE     DEFN A6NBDP    WWDPO
     C           *LIKE     DEFN A6MDIN    WWMDI
     C           *LIKE     DEFN A6MDIN    WWMDO
     C*
     C           WWDPO     SUB  WWDPI     Z       10
     C           Z         ADD  4         Z
     C*
     C           WWMDI     IFNE WWMDO
     C*
     C** MULT/DIV INDICATORS DIFFERENT
     C           WWSRI     MULT WWSRO     WWRATE 159H
     C                     ELSE
     C*
     C** MULT/DIV INDICATORS THE SAME
     C           WWSRO     IFEQ 0
     C                     GOTO SC0
     C                     END
     C           WWSRI     DIV  WWSRO     WWRATE    H
     C                     END
     C*
     C           WWMDI     IFEQ 'D'
     C           WWRATE    IFEQ 0
     C                     GOTO SC0
     C                     END
     C           POWER,Z   DIV  WWRATE    WWRATE    H
     C                     ELSE
     C           POWER,Z   MULT WWRATE    WWRATE    H
     C                     END
     C*
     C           WWAMTI    MULT WWRATE    WWAMTO    H
     C*
     C           SC0       ENDSR                           **  SC0      **
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** ZASNMS    - Send message to program's message queue             *
     C**                                                                 *
     C** CALLS     - Y2SNMGC                                             *
     C**                                                                 *
     C***CALLED*BY*-*#BA*#BD*#B****************************************  *S01498
     C** CALLED BY - #BA #B                                              *S01498
     C**                                                                 *
     C********************************************************************
     C           ZASNMS    BEGSR                           ** ZASNMS    **
     C*
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10
     C                     PARM           ZAPGRL  5
     C                     PARM           ZAMSID  7
     C                     PARM           ZAMSGF 10
     C                     PARM           ZAMSDA132
     C                     PARM           ZAMSTP  7
     C                     ENDSR
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** *PSSR       - This subroutine processes a program file error    *
     C**                                                                 *
     C** CALLS       - *NONE                                             *
     C**                                                                 *
     C** CALLED BY   - *NONE                                             *
     C**                                                                 *
     C********************************************************************
     C           *PSSR     BEGSR
     C*
     C                     DUMP
     C*
     C                     ENDSR
     C/EJECT
      *                                                                   S01498
      ** Array ARR physically removed from compile-time array             S01498
      *                                                                   S01498
      ** NUM   - Array of numbers         REMOVED BY CSD027                                   CSD027
     ** 0123456789                                                                            CSD027
**   CPY@
(c) Misys International Banking Systems Ltd. 2001
** Array of powers of 10 for currency conversion S/R SCONV
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** ALPHU - Array of alphanumerics A-Z, BLANK & 0-9
ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
