     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LB Pledges Agreement Selection program.')
     F********************************************************************
     F*                                                               *
     F*  Midas - Portfolio Lending Module                         *
     F*                                                               *
     F*  LB0531 - Guarantees/Pledges Signed/Unsigned Prompt           *
     F*                                                               *
     F*  Function:  This program is used with RCF to prompt for       *
     F*  (COB)      a from and to date for extracting Signed          *
     F*             Guarantees and Pledges.                           *
     F*                                                               *
     F*  Called By: RCF                                               *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*  LAST AMEND NO. S01498             DATE 20JUL94               *
     F*  PREV AMEND NO. R00300             DATE 21AUG90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *  *
     F*  S01498 - Portfolio Lending Upgrade to Rel 10.                *
     F*  R00300 - Message file changes                               *
     F*                                                               *
     F*****************************************************************
     F**                                                              *
     F** C R E A T I O N     P A R A M E T E R S                      *
     F**                                                              *
     F**                                                              *
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     F**
     F**      FILE DEFINITIONS
     F**      ----------------
     F*
     F**   SCREEN FORMAT
     FLB0531DFCF  E                    WORKSTN      KINFSR *PSSR
     F*
     F*****BANK*DETAILS*FILE*-*PREFIX*BJ*******************************   S01498
     F***SDBANKPDIF**E                    DISK         KINFSR *PSSR       S01498
     F*
     F*****DATABASE*JOB*FILE*-*INPUT*SPOOL*FILE*FOR*REPORT*************   S01498
     F***STRDBJWKO***F      96            DISK         KINFSR *PSSR A     S01498
     F*
     F*****************************************************************
     F/EJECT
     F*****************************************************************
     F**                                                              *
     F** ID F  C  H  L    FUNCTION OF INDICATORS                      *
     F**                  ----------------------                      *
     F**       20         ACCESS TO BANK DETAILS FILE - SDBANKPD      *
     F**       40         SCREEN VALIDATION FAILED                    *
     F**       41         VALID VALUE NOT YET ENTERED                 *
     F**       42         VALID RECORD SELECTED                       *
     F**       50         READ INDICATOR ON LB0531DF                  *
     F**       51         (RI PC) ON FROM-DATE                        *
     F**       52         (RI PC) ON TO-DATE                          *
     F**       60         SFLEND                                      *
     F**       99         INVALID DATE ON ZDATE1                      *
     F**                                                              *
     F*****************************************************************
     E/EJECT
     E*****************************************************************
     E*
     E** ARRAY FOR COPYRIGHT
     E                    CPY@    1   1 80
     E*****************************************************************
     E/EJECT
     E*****************************************************************
     E/COPY ZSRSRC,ZDATE1Z1
     E*****************************************************************
     I/EJECT
     I*****************************************************************
     I*
     ISDBANK    E DSSDBANKPD                                              S01498
      **  Data structure for bank file                                    S01498
      *                                                                   S01498
     IDSFDY     E DSDSFDY                                                 S01498
      **  Short data structure for access programs                        S01498
      *                                                                   S01498
     I** DATA STRUCTURE FOR COMPILATION - COPYRIGHT INSERTION
     ICPYR@$      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@$$
     I*
     I**   PROGRAM STATUS DATA STRUCTURE
     IPSDS       SDS
     I***********                           244 253 DDWSID                S01498
     I***********                           254 263 USER                  S01498
     I                                      244 253 SWSID                 S01498
     I                                      254 263 SUSER                 S01498
      *                                                                   S01498
      **   Store date values for RCF parameter.                           S01498
     I            DS                                                      S01498
     I                                        1 100 @RPRM                 S01498
     I                                        1   50WWFDN                 S01498
     I                                        6  100WWTDN                 S01498
     I*
     I**   LOCAL DATA AREA
     I***WWLDA******UDS                            256                    S01498
     ILDA         DS                            256                       S01498
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I*
     I*****************************************************************
     C/EJECT
     C********************************************************************
     C*
     C**   PARAMETER LIST DECLARATIONS
     C*
     C           *ENTRY    PLIST
     C***********          PARM           WWRTCD  1                       S01498
     C                     PARM           @SEQ    5                       S01498
     C                     PARM           @LVL    1                       S01498
     C                     PARM           @RENT   1                       S01498
     C                     PARM           @RPARM100                       S01498
     C                     PARM           RACT    1                       S01498
     C                     PARM           RCMD    1                       S01498
     C*
     C********************************************************************
     C/EJECT
     C*****************************************************************
     C*
     C**            START MAINLINE
     C**           ----------------
     C*
     C*
     C**   INITIAL PROCESSING
     C*
     C                     EXSR #A
     C*
     C**   MAIN PROCESSING
     C*
     C                     EXSR #B
     C*
     C**   END PROGRAM
     C*
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**        INDEX TO SUBROUTINES                                  *
     C**       ----------------------                                 *
     C**                                                              *
     C**   #ZDATE1  - CONVERT DATE TO MIDAS DAY NUMBER                *
     C**                                                              *
     C**   #A      - INITIAL PROCESSING                               *
     C**   #B      - MAIN PROCESSING                                  *
     C**   #BA     - SCREEN VALIDATION                                *
     C**                                                              *
     C**   *PSSR   - PROGRAM ERROR HANDLING ROUTINE                   *
     C**                                                              *
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C/COPY ZSRSRC,ZDATE1Z2
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #A        - INITIAL PROCESSING                             *
     C**                                                              *
     C**   CALLED BY - MAINLINE                                       *
     C**                                                              *
     C**   CALLS     - NONE                                           *
     C**                                                              *
     C*****************************************************************
     C*
     C           #A        BEGSR
     C*
     C************NAMVAR   DEFN LDA       WWLDA
      *                                                                   S01498
      ** Define LDA                                                       S01498
     C           *NAMVAR   DEFN           LDA                             S01498
     C           *LOCK     IN   LDA                                       S01498
     C*
     C                     MOVE '1'       *IN51
     C                     MOVEL'LB0531'  DBPGM
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     OUT  LDA                                       S01498
     C*                                                                   R00300
     C**   Fill in fields for subroutine ZASNMS                           R00300
     C                     MOVEL*BLANK    ZAPGM  10        Message queue  R00300
     C                     MOVE *BLANKS   ZAMSGF                          R00300
     C*********************MOVEL'LXGBMSGF'ZAMSGF                          R00300
     C                     MOVEL'LBUSRMSG'ZAMSGF 10        Message file   R00300
     C                     MOVEL*BLANK    ZAPGRL  5        Rel queue      R00300
     C                     MOVEL*BLANK    ZAMSID  7        Message Id.    R00300
     C                     MOVEL*BLANK    ZAMSDA132        Message data.  R00300
     C                     MOVEL*BLANK    ZAMSTP  7        Message type.  R00300
     C*
     C**   ACCESS SDBANKPD TP GET RUN DATE
     C*
     C***********1         SETLLSDBANKPD                                  S01498
     C***********          READ SDBANKPD                 20               S01498
     C*                                                                   S01498
B1   C************IN20     IFEQ '1'                                       S01498
     C***********BJTYLC    OREQ 'D'                                       S01498
      *                                                                   S01498
      **  Access SDBANKPD for report title                                S01498
      *                                                                   S01498
     C                     CALL 'AOBANKR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*FIRST ' @OPTN   7                       S01498
     C           SDBANK    PARM SDBANK    DSFDY                           S01498
      *                                                                   S01498
      ** Error                                                            S01498
     C           @RTCD     IFNE *BLANKS                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     Z-ADD1         DBASE            ****************
     C                     MOVE *BLANKS   DBFILE           *              *
     C***********          MOVEL'SDBANKPD'DBFILE           * DBERROR  001 S01498
     C                     MOVE 'SDBANKPD'DBFILE           *              S01498
     C                     MOVE *BLANKS   DBKEY            *              *
     C                     MOVE '1'       *INU7            ****************
     C                     OUT  LDA                                       S01498
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
E1   C                     END
     C*                                                                   S01498
     C**  Rundate in DDMMMYY format                                       S01498
     C*                                                                   S01498
     C                     MOVE BJMRDT    SRUNA                           S01498
     C*
     C**   SET UP DATE FORMAT INDICATOR
     C*
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     ELSE
     C                     MOVE '0'       *IN98
     C                     END
     C*
     C**   INITIALISE INDICATORS
     C*
     C                     MOVEA'010'     *IN,40           OFF 40,42 ON 41
     C                     MOVEA'00'      *IN,51           ON 51-52
     C                     MOVE '1'       *IN60
     C                     MOVE '0'       *IN99
     C*
     C**   CLEAR SCREEN FIELD
     C*
     C                     MOVE *BLANKS   DDFDAT
     C                     MOVE *BLANKS   DDTDAT
     C*
     C**   INITIALISE VARIABLES
     C*
     C                     Z-ADD*ZEROS    WWFDN   50
     C                     Z-ADD*ZEROS    WWTDN   50
     C*
     C**   INITIALISE MESSAGE HANDLING INDICATORS
     C*
     C                     MOVE *BLANKS   WWTPGQ
     C                     MOVEL'*'       WWTPGQ
     C                     MOVE *BLANKS   WWPGQR
     C                     MOVEL'*PRV'    WWPGQR
     C*
     C**   INITIALISE SCREEN MESSAGE QUEUE
     C*
     C                     MOVEL'*'       DDPGMQ
     C*
     C           #A0       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #B        - MAIN PROCESSING                                *
     C**                                                              *
     C**   CALLS     - #BA                                            *
     C**                                                              *
     C**   CALLED BY - MAIN CONTROL                                   *
     C**                                                              *
     C*****************************************************************
     C           #B        BEGSR
     C*
     C**   DOWHILE NOT CMD-3 AND SCREEN NOT VALID
     C*
B1   C           *INKC     DOWEQ'0'
     C           *IN41     ANDEQ'1'
     C*
     C**   DISPLAY SELECTION SCREEN
     C*
     C                     WRITELB0531F1
     C*
     C**   IF ERROR - WRITE MESSAGE SUBFILE
     C*
B2   C           *IN40     IFEQ '1'
     C                     WRITELB0531C2
E2   C                     END
     C*
     C**   READ SELECTION SCREEN
     C*
     C                     READ LB0531F1                 50
     C*
     C**   IF NOT CMD-3
     C*
B2   C           *INKC     IFEQ '0'
     C*
     C**   PERFORM VALIDATION
     C*
     C                     EXSR #BA
     C*
     C**   IF VALID
     C*
B3   C           *IN40     IFEQ '0'
     C*
     C*****CALL*PROGRAM*'LB0365'***************************************
     C*
     C***********          EXCPTFIRST
     C***********
     C***********          EXCPTDETL
     C***********
     C***********          EXCPTENDJOB
     C*
     C                     MOVE @RPRM     @RPARM                          S01498
     C                     MOVEA'01'      *IN,41           OFF 41 ON 42
     C*
E3   C                     END
     C*
E2   C                     END
     C*
E1   C                     END
     C*
     C**   SET UP RETURN CODE - SET TO ZERO IF NO RECORDS SELECTED
     C*
      **  If F3 was pressed send termination code of 'E' back to RCF      S01498
      *                                                                   S01498
     C           *INKC     IFEQ '1'                                       S01498
     C                     MOVE 'E'       RCMD                            S01498
     C                     END                                            S01498
      *                                                                   S01498
B1   C           *IN42     IFEQ '0'
     C*
     C***********          MOVE '0'       WWRTCD                          S01498
     C                     MOVE *BLANKS   @RPARM                          S01498
     C*
X1   C                     ELSE
     C*
     C           *INKC     IFEQ '0'                                       S01498
     C                     MOVE @RPRM     @RPARM                          S01498
     C                     END                                            S01498
      *                                                                   S01498
     C***********          MOVE '1'       WWRTCD                          S01498
     C*
E1   C                     END
     C*
     C           #B0       ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   #BA       - SCREEN VALIDATION                              *
     C**                                                              *
     C**   CALLED BY - #B                                             *
     C**                                                              *
     C**   CALLS     - NONE                                           *
     C**                                                              *
     C*****************************************************************
     C*
     C           #BA       BEGSR
     C*
     C**   CLEAR SCREEN MESSAGE QUEUE
     C*
     C                     MOVE *BLANKS   WWTPGQ
     C                     MOVEL'*'       WWTPGQ
     C                     MOVE *BLANKS   WWPGQR
     C                     MOVEL'*PRV'    WWPGQR
     C*
     C                     CALL 'Y2CLMSC'
     C                     PARM           WWTPGQ 10
     C                     PARM           WWPGQR  5
     C*
     C**   SET OFF INDICATORS
     C*
     C                     MOVE '0'       *IN40
     C                     MOVEA'00'      *IN,51           OFF 51-52
     C*
     C**   INITIALISE WORK FIELDS
     C*
     C                     Z-ADD*ZEROS    WWFDN
     C                     Z-ADD99999     WWTDN
     C*
     C**   VALIDATE FROM-DATE - IF ENTERED
     C*
B1   C           DDFDAT    IFNE *BLANKS
     C           DDFDAT    ANDNE'000000'
     C*
     C**   CHECK FROM-DATE IS NUMERIC
     C*
     C                     MOVE DDFDAT    WWNUM7  70
     C                     MOVE WWNUM7    WWALF6  6
     C*
B2   C           DDFDAT    IFEQ WWALF6
     C*
     C**   CONVERT FROM-DATE FROM INPUT FORMAT TO MIDAS DAY NUMBER
     C*
     C                     MOVE DDFDAT    ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WWFDN
     C*
X2   C                     ELSE
     C*
     C                     MOVE '1'       *IN99
     C*
E2   C                     END
     C*
     C**   IF NOT VALID FROM-DATE
     C*
B2   C           *IN99     IFEQ '1'
     C*
     C                     MOVE '1'       *IN40
     C                     MOVE '1'       *IN51
     C*
E2   C                     END
     C*
E1   C                     END
     C*
     C**   VALIDATE TO-DATE - IF ENTERED
     C*
B1   C           DDTDAT    IFNE *BLANKS
     C           DDTDAT    ANDNE'999999'
     C*
     C**   CHECK TO-DATE IS NUMERIC
     C*
     C                     MOVE DDTDAT    WWNUM7  70
     C                     MOVE WWNUM7    WWALF6  6
     C*
B2   C           DDTDAT    IFEQ WWALF6
     C*
     C**   CONVERT TO-DATE FROM INPUT FORMAT TO MIDAS DAY NUMBER
     C*
     C                     MOVE DDTDAT    ZDATE
     C                     EXSR ZDATE1
     C                     Z-ADDZDAYNO    WWTDN
     C*
X2   C                     ELSE
     C*
     C                     MOVE '1'       *IN99
     C*
E2   C                     END
     C*
     C**   IF NOT VALID TO-DATE
     C*
B2   C           *IN99     IFEQ '1'
     C*
     C                     MOVE '1'       *IN40
     C                     MOVE '1'       *IN52
     C*
E2   C                     END
     C*
E1   C                     END
     C*
     C**   IF NO ERRORS YET
     C*
B1   C           *IN40     IFEQ '0'
     C*
     C**   IF FROM-DATE OR TO-DATE ENTERED
     C*
B2   C           WWFDN     IFNE *ZEROS
     C           WWTDN     ORNE 99999
     C*
     C*****IF FROM-DATE NOT ENTERED
     C***********
B3   C***********WWFDN     IFEQ *ZEROS
     C***********
     C*****TO-DATE MUST BE <= RUN-DATE
     C***********
B4   C***********WWTDN     IFGT BJAKTX
     C***********
     C***********          MOVE '1'       *IN40
     C***********          MOVE '1'       *IN52
     C***********
E4   C***********          END
     C***********
E3   C***********          END
     C***********
     C**   IF TO-DATE NOT ENTERED
     C***********
B3   C***********WWTDN     IFEQ 99999
     C***********
     C**   FROM-DATE MUST BE <= RUN-DATE
     C***********
B4   C***********WWFDN     IFGT BJAKTX
     C***********
     C***********          MOVE '1'       *IN40
     C***********          MOVE '1'       *IN51
     C***********
E4   C***********          END
     C***********
E3   C***********          END
     C*
     C**   IF BOTH DATES ENTERED
     C*
B3   C           WWFDN     IFNE *ZEROS
     C           WWTDN     ANDNE99999
     C*
     C**   FROM-DATE MUST BE <= TO-DATE
     C*
B4   C***********WWFDN     IFGT BJAKTX
     C           WWFDN     IFGT WWTDN
     C*
     C                     MOVE '1'       *IN40
     C                     MOVEA'11'      *IN,51           *IN51 *IN52
     C*
E4   C                     END
     C*
     C**   TO-DATE MUST BE <= RUN-DATE AND >= FROM-DATE
     C***********
B4   C***********WWTDN     IFGT BJAKTX
     C***********WWTDN     ORLT WWFDN
     C***********
     C***********          MOVE '1'       *IN40
     C***********          MOVE '1'       *IN52
     C***********
E4   C***********          END
     C*
E3   C                     END
     C*
E2   C                     END
     C*
E1   C                     END
     C*
     C**   IF ERROR - LOAD MESSAGE TO MESSAGE SUBFILE
     C*
B1   C           *IN40     IFEQ '1'
     C*
     C                     MOVEL'LBM0023' ZAMSID
     C                     EXSR ZASNMS
     C*
E1   C                     END
     C*
     C           #BA0      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   ZASNMS    - SEND MESSAGE TO PROGRAM'S MESSAGE QUEUE        *
     C**                                                              *
     C**   CALLED BY - MAINLINE                                       *
     C**                                                              *
     C**   CALLS     - Y2SNMGC                                        *
     C**                                                              *
     C*****************************************************************
     C*
     C           ZASNMS    BEGSR
     C*
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10
     C                     PARM           ZAPGRL  5
     C                     PARM           ZAMSID  7
     C                     PARM           ZAMSGF 10
     C                     PARM           ZAMSDA132
     C                     PARM           ZAMSTP  7
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C**                                                              *
     C**   *PSSR     - PROGRAM ERROR HANDLING ROUTINE                 *
     C**                                                              *
     C**   CALLS     -                                                *
     C**                                                              *
     C**   CALLED BY -                                                *
     C**                                                              *
     C*****************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C                     DUMP
     C*
     C                     ENDSR
     C*****************************************************************
     C/EJECT
     O********************************************************************
     O***STRDBJWKEADD***********  FIRST                                   S01498
     O***********                        24 '//BCHJOB LB0530J JOBD(MB'    S01498
     O***********                        29 'ATCH)'                       S01498
     O********EADD             FIRST                                      S01498
     O***********                        11 'CALL LB0530'                 S01498
     O********EADD             FIRST                                      S01498
     O***********                         6 '//DATA'                      S01498
     O***********                                                         S01498
     O********EADD             DETL                                       S01498
     O***********              WWFDN      5                               S01498
     O***********              WWTDN     10                               S01498
     O***********                                                         S01498
     O********EADD             ENDJOB                                     S01498
     O***********                        11 '//ENDBCHJOB'                 S01498
     O/EJECT
** CPY@
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
