     H        1                                                           S01498
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LB Retail regeneration')
     H***********                                                         S01498
     F*****************************************************************
     F*                                                               *
     F*  Midas - Portfolio Lending Module                         *
     F*                                                               *
     F*  LB0640 - Retail Regeneration                                 *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *  Last Amend No. BUG27532           Date 26Apr10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CDL049             Date 07Jul06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3584            Date 28Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 BUG2304            Date 30Apr04               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CSD005             Date 01Mar99               *
      *                 CTI002             Date 23Sep98               *
     F*                 096089             DATE 23NOV95               *
     F*                 S01498             DATE 11SEP94               *
     F*                 067396             DATE 25FEB94               *
     F*                 35459              DATE 12FEB92               *
     F*                 B8146              DATE 26SEP91               *
     F*                 B8075              DATE 26SEP91               *
     F*                 B7994              DATE 26SEP91               *
     F*                 B4642              DATE 24SEP91               *
     F*                 B7952              DATE 08JUN91               *
     F*                 B5929              DATE 02MAY91               *
     F*                 R5801              DATE 29APR91               *
     F*                 R5749              DATE 29APR91               *
     F*                 R5521              DATE 29APR91               *
     F*                 R0149              DATE 29APR91               *
     F*                 R01168             DATE 24JAN91               *
     F*                 R1052              DATE 17DEC90               *
     F*                 R1051              DATE 14DEC90               *
     F*                 R0576              DATE 19OCT90               *
     F*                 B4814              DATE 24AUG90               *
     F*                 R00403             DATE 15AUG90               *
     F*                 LB0000             DATE 19MAY90               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  BUG27532 - Several fields are blank in the confirmation page *
      *             (Recompile)                                       *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3584 - Increase the size of the file control fields.      *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  BUG2304 - Various file layout changes. Recompile.            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CSD005 - Standing Data Account Narrative.  Add new field     *
      *           to SDACODPD.  Recompilation of programs.            *
      *  CTI002 - Recompiled : File SDACODPD changed                  *
     F*  096089 - Incorrect INNR used in #BAB when rupture            *
     F*  S01498 - Portfolio Lending Upgrade to Release 10             *
     F*  067396 - NORE USE ALSO NUBER OF DELETIONS                    *
     F*  35459  - RECOMPILE OVER CHANGED PRINTER FILE (LB0640P0)      *
     F*  B8146  - NO CORRESPONDING BETWEEN INSTRUMENT NARRATIVE &     *
     F*           & ACCOUNT CODE IN FILE "LBEXTRPD".                  *
     F*  B8075  - A/C ACCESS AT A WRONG TIME                          *
     F*  B7994  - OUTPUT RECORD IF ACCOUNT HAS LIMIT EVEN IF          *
     F*           THE BALANCE IS ZERO                                 *
     F*  B4642  - NORE IS REPLACED BY NHAU FOR HELDIHC CONTROL        *
     F*  B7952  - ADD DECIMAL PLACES TO LINE BEFORE OUTPUT            *
     F*  B5929  - ENHANCEMENTS - TO OUTPUT LDBL EDITED                *
     F*  R5801  - TO REMOVE CHECK ON CUSEX TRAILER                    *
     F*  R5749  - DO NOT REPORT IF BALANCE IS ZERO                    *
     F*  R5521  - REMOVE INTEREST CALCULATION (NOW IN LB0690)         *
     F*  R0149  - OUTPUT LIMIT IN THIS PROCESSING TO AVOID ERROR      *
     F*           IN LB0700 (OVERDRAFT LIMIT USED DISREGARDING THE    *
     F*           CURRENCY)                                           *
     F*  R01168 - WRITE TO NEW EXTRACT FILE, LBEXCOPD                 *
     F*  R1052  - AMEND INTERETS ACCRUALS CALCULATIONS                *
     F*  R1051  - INCORRECT TOTALS BY INSTRUMENTS.                    *
     F*  R0576  - TOTAL BORROWING POWER IS WRONG.                     *
     F*  B4814  - ONLY COUNT LIVE RECORDS                             *
     F*  R00403 - CORRECT FIX LB0000 (RIGHT IDEA, WRONG ZONE)         *
     F*  LB0000 - NAUP = NUMBER OF OPEN ACCOUNTS AFTER UPDATE         *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     F********************************************************************
     F**
     F** FILE DEFINITIONS
     F** ================
     F*
     F***Bank*Details*File.*Prefix*-*BJ********************************   S01498
     F***SDBANKPDIF**E                    DISK         KINFSR *PSSR       S01498
     F*
     F***portfolio*lending*Installation*Control*Data.*Prefix*-*LB******   S01498
     F***SDLOMBPDIF**E                    DISK         KINFSR *PSSR       S01498
     F*
     F** Account Trailer.
     F*CCNTAC IF  E                    DISK         KINFSR *PSSR          B4814
     F*
     F** Held Items Trailer.
     FHELDIHC IF  E                    DISK         KINFSR *PSSR
     F*
     F** Customer Exchanges Trailer.
     FCUSEXZ1 IF  E                    DISK         KINFSR *PSSR
     F*
     F** Retail Regeneration details report
     F***LB0640P0O***E             24     PRINTER      KINFSR *PSSR       S01498
     F**********************************************KINFDS $2DS           S01498
     FLB0640P1O   E             24     PRINTER      KINFSR *PSSR      UC  S01498
     F                                              KINFDS SPOOL1         S01498
     F*
     F** Retail Missing Instrument Report.
     F***LB0640P1O***E             25     PRINTER      KINFSR *PSSR       S01498
     F**********************************************KINFDS $1DS           S01498
     FLB0640P2O   E             25     PRINTER      KINFSR *PSSR      UC  S01498
     F                                              KINFDS SPOOL2         S01498
     F*
     F** Retail Regeneration Audit List Run Controls.
     FLB0640AUO   E             26     PRINTER      KINFSR *PSSR
     F                                              KINFDS SPOOLU         S01498
     F*
     F***Account*Codes.*Prefix*-*A5*(By*Account*Code)******************   S01498
     F***SDACODL0IF**E           K        DISK         KINFSR *PSSR       S01498
     F****                                                                R5521
     F***Retail*Accrued*Interest*to*Date.*(By Customer No/Account Code/   R5521
     F****                                    Account Sequence/Currency CoR5521
     F**REACRDL1IF  E           K        DISK         KINFSR *PSSR        R5521
     F*
     F** portfolio lending Extract. Prefix - EE
     FLBEXTRPDO   E                    DISK         KINFSR *PSSR
     F*
     F** portfolio lending Extract. Prefix - EE
     FLBEXTRL2UF  E           K        DISK         KINFSR *PSSR
     F            LBEXTRD0                          KRENAMELBEXTRDX
     F*
     F** Borrowing Power. Prefix - BP (By Customer No/Instrument Type Narrative)
     FLBBPWRL1IF  E           K        DISK         KINFSR *PSSR
     F*
     F** Borrowing Power. Prefix - BP (By Instrument Type Narrative)
     FLBBPWRL3IF  E           K        DISK         KINFSR *PSSR
     F            LBBPWRD0                          KRENAMELBBPWRDX
     F*
     F***Instrument*Types.*Prefix*-*PD*(By*Instrument*Type)************   S01498
     F***SDPLINL4IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F***portfolio*lending*Groups.*Prefix*-*GP*(By*portfolio*lending*Grou S01498
     F***LBGROUL1IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F** Client Master. Prefix - BB & CU (By Customer Number)
     F***SDLBCSL0IF**E           K        DISK         KINFSR *PSSR       S01498
     FLBLBCSJ0IF  E           K        DISK         KINFSR *PSSR          S01498
     F*
     F***Currency*Codes.*Prefix*-*A6***********************************   S01498
     F***SDCURRL1IF**E           K        DISK         KINFSR *PSSR       S01498
     F*
     F** Account Details. (By Customer No/Account Code/
     F*                       Account Sequence/Currency Code)
     F***ACCNABL1IF**E           K        DISK         KINFSR *PSSR       S01498
     FLBACCNL1IF  E           K        DISK         KINFSR *PSSR          S01498
     F*
     F** Held Items. (By Customer No/Currency Code)
     FHELDITL1IF  E           K        DISK         KINFSR *PSSR
     F*
     F** Customer Exchanges Details. (Debits)
     FCUSEXEL1IF  E           K        DISK         KINFSR *PSSR
     F*
     F** Customer Exchanges Details. (Credits)
     FCUSEXEL2IF  E           K        DISK         KINFSR *PSSR
     F            CUSEXCEF                          KRENAMECUSEXCEX
     F*
     F**   Exposure/Collateral Extract file    - Prefix EX                R01168
     FLBEXCOPDO   E                    DISK         KINFSR *PSSR          R01168
     F*                                                                   R01168
     F/COPY WNCPYSRC,LB0640F002
     F********************************************************************
     F/EJECT
     F********************************************************************
     F**                                                                 *
     F** ID F  C  H  L    FUNCTION OF INDICATORS                         *
     F**                  ======================                         *
     F**   24             Overflow on printer file LB0640P0              *
     F**   25             Overflow on printer file LB0640P1              *
     F**   26             Overflow on printer file LB0640AU              *
     F**                                                                 *
     F**      27          Held Items predefined instrument missing       *
     F**      28          Customer Exchange predefined instrument missing*
     F**                                                                 *
     F**                  ACCOUNTS PROCESSING INDICATOR USAGE            *
     F**                  ===================================            *
     F********29**********READ*on*ACCNABL1*****************************   S01498
     F**      29          Read on LBACCNL1                            *   S01498
     F**      30          Client master & Account codes files accessed   *
     F**                  for this Customer number/Account code/Account  *
     F**                  sequence/Currency                              *
     F********31**********CHAIN*on*SDLBCSL0****************************   S01498
     F**      31          Chain on LBLBCSJ0                           *   S01498
     F**      32          Retail regeneration missing instrument found   *
     F**                  for this Customer number/Account code/Account  *
     F**                  sequence/Currency                              *
     F**      33          At least 1 retail regeneration missing instrum *
     F**                  found overall                                  *
     F**      34          Write a record to the Portfolio extract file   *
     F********35**********CHAIN on SDACODL0****************************   S01498
     F********36**********CHAIN on REACRDL1                              *
     F**      37          CHAIN on LBBPWRL1/3                            *
     F**      58          CHAIN on LBEXTRL2
     F**                                                                 *
     F**                  HELD ITEMS PROCESSING INDICATOR USAGE          *
     F**                  =====================================          *
     F**      38          READ on HELDITL1                               *
     F**      39          Client master file accessed for this Customer  *
     F**                  number/Currency                                *
     F********40**********CHAIN*on*SDLBCSL0****************************   S01498
     F**      40          Chain on LBLBCSJ0                           *   S01498
     F**      41          Write a record to the Portfolio extract file   *
     F**      42          CHAIN on LBBPWRL1/3                            *
     F**                                                                 *
     F**                  CUSTOMER EXCHANGE PROCESSING INDICATOR USAGE DB*
     F**                  ===============================================*
     F**      43          READ on CUSEXEL1                               *
     F**      44          Client master file accessed for this Customer  *
     F**                  number/Currency                                *
     F********45**********CHAIN*on*SDLBCSL0****************************   S01498
     F**      45          Chain on LBLBCSJ0                           *   S01498
     F**      46          Write a record to the Portfolio extract file   *
     F**      47          CHAIN on LBEXTRL2                              *
     F**                                                                 *
     F**                  CUSTOMER EXCHANGE PROCESSING INDICATOR USAGE CR*
     F**                  ===============================================*
     F**                                                                 *
     F**      48          READ on CUSEXEL2                               *
     F**      49          Client master file accessed for this Customer  *
     F**                  number/Currency                                *
     F********50**********CHAIN*on*SDLBCSL0****************************   S01498
     F**      50          Chain on LBLBCSJ0                           *   S01498
     F**      51          Write a record to the Portfolio extract file     *
     F**      52          CHAIN on LBBPWRL1/3                            *
     F**      53          CHAIN on LBEXTRL2                              *
     F**                                                                 *
     F**      54          CHAIN on ACCNTAC/HELDIHC/CUSEXZ1               *
     F**      55          Difference in number of ACCNTAC records        *
     F**      56          Difference in number of HELDIHC records        *
     F**      57          Difference in number of CUSEXZ1 records        *
     F**                                                                 *
     F**      60          Necessary SPACEB after TOTALS 1 output         *
     F**      61          Necessary SPACEB after TOTALS 2 output         *
     F**      62          Necessary SPACEB after TOTALS 3 output         *
     F**                                                                 *
     F**      99          File error indicator                           *
     F**                                                                 *
     F********************************************************************
     F/EJECT
     E********************************************************************
     E*
     E** Array for copyright
     E                    CPY@    1   1 80
     E** Array of powers of 10 for S/R SCONV
     E                    POWER   1   7  7 3
     E*
     E/COPY ZSRSRC,ZSEDITZ1
     E*
     E********************************************************************
     E/EJECT
     I********************************************************************
     I*
     I***Rename*the*Account*Code*and*Sequence*on*ACCNABL1**************   S01498
     I** Rename the Account Code and Sequence on LBACCNL1.                S01498
     IACCNTABF
     I              ACOD                            ACACOD
     I              ACSQ                            ACACSQ
     I*
     I** Rename the number of records field onHELDIHC
     IHELDIHCF
     I              NORE                            HDNORE
     I*
     I** Data structure to hold copyright statement
     ICPYR@$      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@$$
     I*
     I/COPY ZSRSRC,ZSEDITZ2
     I*
     I** Data Structure to split date into day month year
     I            DS
     I****************************************1   7 BJMRDT                S01498
     I                                        1   7 WWMRDT                S01498
     I                                        1   20WWDAY
     I                                        3   5 WWMNTH
     I                                        6   70WWYEAR
     I*                                                                   R01168
     I** Data Structure to split Reference into code/seq/num              R01168
     I            DS                                                      R01168
     I**********                              1  16 EXREF                              R01168 CGL029
     I**********                              1   40WWCOD                              R01168 CGL029
     I**********                              5   60WWSEQ                              R01168 CGL029
     I**********                              7  160WWNO                               R01168 CGL029
     I                                        1  22 EXREF                                     CGL029
     I                                        1  100WWCOD                                     CGL029
     I                                       11  120WWSEQ                                     CGL029
     I                                       13  220WWNO                                      CGL029
     I*
     I** Program status data structure
     IPSDS       SDS
     I                                      244 253 JOB
     I                                      254 263 USER
     I*
     I***Printer*file*information*data*structure*LB0640P1**************   S01498
     I** Printer file information data structure LB0640P2                 S01498
     I***$1DS********DS                                                   S01498
     ISPOOL2      DS                                                      S01498
     I                                       83  92 SFILE2                S01498
     I                                    B 123 1240SFNUM2                S01498
     I                                    B 367 3680WWCULN
     I*
     I***Printer*file*information*data*structure*LB0640P0**************   S01498
     I** Printer file information data structure LB0640P1                 S01498
     I***$2DS********DS                                                   S01498
     ISPOOL1      DS                                                      S01498
     I                                       83  92 SFILE1                S01498
     I                                    B 123 1240SFNUM1                S01498
     I************************************B 367 3680LINE2                 S01498
     I                                    B 367 3680LINE1                 S01498
     I*                                                                   S01498
     ISPOOLU      DS                                                      S01498
     I                                       83  92 SFILEU                S01498
     I                                    B 123 1240SFNUMU                S01498
     I*
     I** Data area
     I***DTAR*******UDS                            256                    S01498
     ILDA         DS                            256                       S01498
     I                                      132 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I** Local Data Area                                                  S01498
     I*
     IRUNDAT    E DS                                                      S01498
     I** Standard data area layout for system flags and run date          S01498
     I*                                                                   S01498
     I@BANK     E DSSDBANKPD                                              S01498
     I** Dummy record format for access to Bank Details                   S01498
     I*                                                                   S01498
     I@CURR     E DSSDCURRPD                                              S01498
     I** Dummy record format for access to Currency Details               S01498
     I*                                                                   S01498
     I@PLIN     E DSSDPLINPD                                              S01498
     I** Dummy record format for access to Instrument Types               S01498
     I*                                                                   S01498
     I@LOMB     E DSSDLOMBPD                                              S01498
     I** Dummy record format for access to Portfolio Lending ICD          S01498
     I*                                                                   S01498
     I@GROU     E DSLBGROUPD                                              S01498
     I** Dummy record format for access to Portfolio Lending Groups       S01498
     I*                                                                   S01498
     I@ACOD     E DSSDACODPD                                              S01498
     I** Dummy record format for access to Account Codes                  S01498
     I*                                                                   S01498
     IDSFDY     E DSDSFDY                                                 S01498
     I** First DS for access programs, short data structure               S01498
     I*                                                                   S01498
     IDSSDY     E DSDSSDY                                                 S01498
     I** Second DS for access programs, long data structure               S01498
     I*                                                                   S01498
     I********************************************************************
     I/EJECT
     C********************************************************************
     C*
     C** Define KLISTS
     C***                                                                 R5521
     C***KLIST for file REACRDL1                                          R5521
     C***                                                                 R5521
     C***        KEYFD1    KLIST                                          R5521
     C***                  KFLD           WWCNUM                          R5521
     C***                  KFLD           ACACOD                          R5521
     C***                  KFLD           ACACSQ                          R5521
     C***                  KFLD           WWCCY                           R5521
     C*
     C** KLIST for file LBBPWRL1 (Accounts)
     C*
     C           KEYFD2    KLIST
     C                     KFLD           WWCNUM
     C***********          KFLD           A5INNR                          096089
     C                     KFLD           WWINNR                          096089
     C*
     C** KLIST for file LBBPWRL1 (Held Items)
     C*
     C           KEYFD3    KLIST
     C                     KFLD           WWCNUM
     C***********          KFLD           LBHELD                          S01498
     C                     KFLD           LBHLDI                          S01498
     C*
     C** KLIST for file LBEXTRL2 (Debits)
     C*
     C           KEYFD4    KLIST
     C                     KFLD           WWDCUS
     C                     KFLD           LBCUSI
     C                     KFLD           WWDRCY
     C*
     C** KLIST for file LBBPWRL1 (Credits)
     C*
     C           KEYFD5    KLIST
     C                     KFLD           WWCCUS
     C                     KFLD           LBCUSI
     C*
     C** KLIST for file LBEXTRL2 (Credits)
     C*
     C           KEYFD6    KLIST
     C                     KFLD           WWCCUS
     C                     KFLD           LBCUSI
     C                     KFLD           WWCRCY
     C*
     C** KLIST for file LBEXTRL2 (Accounts)
     C*
     C           KEYFD7    KLIST
     C                     KFLD           WWCNUM
     C***                  KFLD           WWINNR                          R1051
     C***********          KFLD           A5INNR                     R1051096089
     C                     KFLD           WWINNR                          096089
     C                     KFLD           WWCCY
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C*
     C**             START MAINLINE
     C**             ¯¯¯¯¯¯¯¯¯¯¯¯¯¯
     C** Initialisation
     C*
     C                     EXSR #A
     C*
     C** Main processing
     C*
     C                     EXSR #B
     C*
     C** Termination processing
     C*
     C                     EXSR #C
     C*
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C**                    INDEX TO SUBROTUINES                         *
     C**                    ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯                         *
     C**  1.#A     - Initialisation                                      *
     C**  2.#B     - Main processing                                     *
     C**  3.#C     - Termination processing                              *
     C**                                                                 *
     C**  4.#BA    - Accounts processing                                 *
     C**  5.#BB    - Held items processing                               *
     C**  6.#BC    - Customer exchanges processing                       *
     C**                                                                 *
     C**  7 #BAA   - Accumulate exposure/collateral/interest (ACCOUNTS)  *
     C**  8.#BAB   - Write a record to the Portfolio extract (ACCOUNTS)  *
     C**  9 #BBA   - Accumulate exposure (HELD ITEMS)                    *
     C** 10.#BBB   - Write a record to the Portfolio extract (HELD ITEMS)*
     C** 11.#BCA   - Process customer exchanges CUSEXEL1 (Debits)        *
     C** 12.#BCB   - Process customer exchanges CUSEXEL2 (Credits)       *
     C**                                                                 *
     C** 13.#BCAA  - Accumulate exposure for customer exchanges          *
     C** 14.#BCAB  - Write/Update record to the Portfolio extract(Debits)*
     C** 15.#BCBA  - Accumulate collateral for customer exchanges        *
     C** 14.#BCBB  - Write/Update record to the Portfolio extract(Credits)
     C**                                                                 *
     C** 21.P01    - Write records to new extract file                   *
     C** 15.#YA    - Write a detail line to regeneration details report  *
     C** 16.#YB    - Write a total line to regeneration details report   *
     C**                                                                 *
     C** 17.#ZA    - Database error handling routine                     *
     C**                                                                 *
     C** 18.ZSEDIT - Edit an amount for output to a report               *
     C** 19.SCONV  - Convert an amount from one currency to another      *
     C**                                                                 *
     C** 20 *PSSR  - Program file error handling routine                 *
     C**                                                                 *
     C********************************************************************
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #B          - This subroutine performs the mainline processing  *
     C**                                                                 *
     C** CALLS       - #BA #BB #BC                                       *
     C**                                                                 *
     C** CALLED BY   - MAINLINE                                          *
     C**                                                                 *
     C********************************************************************
     C           #B        BEGSR
     C*
     C** Mainline processing for Accounts
     C*
     C                     EXSR #BA
     C*
     C** Mainline processing for Held Items
     C*
     C                     EXSR #BB
     C*
     C** Mainline processing for Customer Exchanges
     C*
     C                     EXSR #BC
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BA         - This subroutine performs the Accounts processing  *
     C**                                                                 *
     C** CALLS       - #BAA #BAB #ZA                                     *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BA       BEGSR
     C*
     C** Write regeneration details 'ACCOUNTS' header
     C*
     C***********          WRITEHEADER00                                  S01498
     C***********          WRITEHEADER01                                  S01498
     C                     MOVE '0'       *IN81                           S01498
     C                     MOVE 'N'       WWDTRW  1
     C*
     C** Read through the whole Account master file in Customer number/
     C** Account code/Account sequence/Currency sequence
     C*
     C************LOVAL    SETLLACCNABL1                                  S01498
     C***********          READ ACCNABL1                 29               S01498
     C           *LOVAL    SETLLLBACCNL1                                  S01498
     C                     READ LBACCNL1                 29               S01498
     C*
     C** Process while more records on file
     C*
B1   C           *IN29     DOWEQ'0'
     C*                                                                   B8075
     C** Retrieve the instrument type                                     B8075
     C*                                                                   B8075
     C                     MOVE ACACOD    WWCODE                          B8075
     C***********WWCODE    CHAINSDACODL0             23            B8075  S01498
     C*                                                                   S01498
     C                     CALL 'AOACODR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C**********           PARM WWCODE    @ACCD   4                                    S01498 CGL029
     C                     PARM WWCODE    @ACCD  10                                           CGL029
     C********** @ACOD     PARM @ACOD     DSFDY                                        S01498 CGL029
     C           @ACOD     PARM @ACOD     DSSDY                                               CGL029
     C*                                                                   B8075
     C************IN23     IFEQ '1'                                B8075  S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     Z-ADD25        DBASE            ***************B8075
     C***********          MOVEL'SDACODL0'DBFILE           * DBERR B8075  S01498
     C                     MOVE 'SDACODPD'DBFILE           * DBERROR 254 *S01498
     C                     MOVE *BLANKS   DBKEY            ***************B8075
     C                     MOVELACACOD    DBKEY                           B8075
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA                                       B8075
     C                     END                                            B8075
     C*
     C                     SETOF                     303234
     C*
     C** Save the default Portfolio extract key :- Customer number/Instrument
     C**                                         type/Currency
     C*
     C**********           Z-ADDCNUM      WWCNUM                                              CSD027
     C                     MOVE CNUM      WWCNUM                                              CSD027
     C                     MOVE A5INNR    WWINNR
     C                     MOVE CCY       WWCCY
     C*
     C** Retrieve currency details for customer currency
     C*
     C***********CCY       CHAINSDCURRL1             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOCURRR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM CCY       @CYCD   3                       S01498
     C           @CURR     PARM @CURR     DSSDY                           S01498
     C*
B2   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           A6TYLC    OREQ 'D'                        *****************
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDCURRL1'DBFILE           ** DBERROR 004 S01498
     C                     MOVE 'SDCURRPD'DBFILE           ** DBERROR 004 S01498
     C                     MOVELCCY       DBKEY            *****************
     C                     Z-ADD4         DBASE
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
X2   C                     ELSE
     C                     Z-ADDA6SPRT    WWSRI
     C                     Z-ADDA6NBDP    WWDPI
     C                     MOVE A6MDIN    WWMDI
E2   C                     END
     C*
     C                     Z-ADD0         WWEXPO
     C                     Z-ADD0         WWLIMT                          R0149
     C                     Z-ADD0         WWCOLL
     C*********************Z-ADD0         WWDBAC                          R5521
     C*********************Z-ADD0         WWCRAC                          R5521
     C***                  Z-ADD0         WWBPWR                          B4814
     C*
     C** Process until change of default Portfolio extract key
     C*
B2   C           *IN29     DOWEQ'0'
     C           CNUM      ANDEQWWCNUM
     C           A5INNR    ANDEQWWINNR
     C           CCY       ANDEQWWCCY
     C*
     C** Increment the account master file record counter
     C*
B3   C           RECI      IFEQ 'D'                                       B4814
     C                     ADD  1         RRPNRA
E4   C                     END                                            B4814
     C*
     C** Process only active retail records with account type of 'R'
     C*
B3   C           RECI      IFEQ 'D'
     C           ATYP      ANDEQ'R'
     C***********ODSC******ANDNE'N'                                       B7994
     C           LDBL      ANDNE0                                         R5749
     C           RECI      OREQ 'D'                                       B7994
     C           ATYP      ANDEQ'R'                                       B7994
     C           ODLN      ANDNE0                                         B7994
     C*
     C/COPY WNCPYSRC,LB0640C004
     C** Access the Client master & Account codes file once only for this
     C** Customer number/Currency
     C*
B4   C           *IN30     IFEQ '0'
     C                     SETON                     30
     C                     MOVE CNUM      WWPNP8  6
     C***********WWPNP8    CHAINSDLBCSL0             31                   S01498
     C           WWPNP8    CHAINLBLBCSJ0             31                   S01498
E4   C                     END
     C*
     C** Retrieve the instrument type
     C*
     C**********           MOVE ACACOD    WWCODE  4                                           CGL029
     C                     MOVE ACACOD    WWCODE 10                                           CGL029
     C***********WWCODE    CHAINSDACODL0             35                   S01498
     C*                                                                   S01498
     C                     CALL 'AOACODR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C**********           PARM WWCODE    @ACCD   4                                    S01498 CGL029
     C                     PARM WWCODE    @ACCD                                               CGL029
     C********** @ACOD     PARM @ACOD     DSFDY                                        S01498 CGL029
     C           @ACOD     PARM @ACOD     DSSDY                                               CGL029
     C*
     C** If the account code has changed then retrieve the instrument type
     C*
B4   C           *IN31     IFEQ '0'
     C*
B5   C************IN35     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           A5INNR    OREQ *BLANKS
     C*                                                                   S01498
     C**  Open LB0640P2.                                                  S01498
     C*                                                                   S01498
     C           *IN72     IFEQ '0'                                       S01498
     C                     OPEN LB0640P2                                  S01498
     C                     EXSR RCFP2                                     S01498
     C                     WRITEP1HEADR1                                  S01498
     C                     WRITEP1HEADR2                                  S01498
     C                     SETON                     72                   S01498
     C                     END                                            S01498
     C*
B6   C           WWCULN    IFGT 55
     C                     WRITEP1HEADR1
     C                     WRITEP1HEADR2
E6   C                     END
     C*
     C                     WRITEP1DETALA
     C                     SETON                     3233
     C*
E5   C                     END
     C*
E4   C                     END
     C*
     C** Convert and accumulate Exposure/Collateral/Interest for this
     C** Customer number/Instrument type/Currency if the record is selected
     C*
B4   C           *IN31     IFEQ '0'
     C           *IN32     ANDEQ'0'
     C                     EXSR #BAA
     C                     SETON                     34
     C*
     C** Write a detail line to the regeneration report
     C*
     C                     MOVEL'AC'      WWDTYP
     C                     EXSR #YA
     C*
E4   C                     END
     C*
     C/COPY WNCPYSRC,LB0640C005
E3   C                     END
     C*
     C** Read the next record
     C*
     C***********          READ ACCNABL1                 29               S01498
     C                     READ LBACCNL1                 29               S01498
     C*                                                                   B8075
     C** Retrieve the instrument type                                     B8075
     C*                                                                   B8075
     C                     MOVE ACACOD    WWCODE                          B8075
     C***********WWCODE    CHAINSDACODL0             23            B8075  S01498
     C*                                                                   S01498
     C                     CALL 'AOACODR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C**********           PARM WWCODE    @ACCD   4                                    S01498 CGL029
     C                     PARM WWCODE    @ACCD                                               CGL029
     C********** @ACOD     PARM @ACOD     DSFDY                                        S01498 CGL029
     C           @ACOD     PARM @ACOD     DSSDY                                               CGL029
     C*                                                                   B8075
     C************IN23     IFEQ '1'                                B8075  S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     Z-ADD25        DBASE            ***************B8075
     C***********          MOVEL'SDACODL0'DBFILE           * DBERR B8075  S01498
     C                     MOVE 'SDACODPD'DBFILE           * DBERROR 254 *S01498
     C                     MOVE *BLANKS   DBKEY            ***************B8075
     C                     MOVELACACOD    DBKEY                           B8075
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA                                       B8075
     C                     END                                            B8075
     C*
E2   C                     END
     C*
     C** Write a record to the Portfolio extract file if required
     C*
B2   C           *IN34     IFEQ '1'
     C                     EXSR #BAB
     C*
E2   C                     END
     C*
     C** Write a total line to the regeneration report if necessary
     C*
B2   C           WWDTRW    IFNE 'N'
B3   C           CNUM      IFNE WWCNUM
     C           *IN29     OREQ '1'
     C                     EXSR #YB
E3   C                     END
E2   C                     END
     C*
E1   C                     END
     C*
     C***IF*no*Account*details*write*null*report*line*ELSE*initialise**   S01498
     C***no*details*flag***********************************************   S01498
     C*
B1   C***********WWDETR    IFEQ 'N'                                       S01498
     C***********          WRITENULL0                                     S01498
X1   C***********          ELSE                                           S01498
     C***********          MOVE 'N'       WWDETR                          S01498
E1   C***********          END                                            S01498
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BAA        - This subroutine converts and accumalates the      *
     C**               Exposure/Collateral/Interest for this Customer    *
     C**               number/Instrument type/Currency (ACCOUNTS)        *
     C**                                                                 *
     C** CALLS       - SCONV                                             *
     C**                                                                 *
     C** CALLED BY   - #BA                                               *
     C**                                                                 *
     C********************************************************************
     C           #BAA      BEGSR
     C*
     C** Accumulate the Exposure/Collateral in Portfolio currency
     C*
     C                     Z-ADDCLBL      WWAMTI
     C                     EXSR SCONV
     C                     Z-ADDWWAMTO    WWCLBL
     C*
B1   C           WWCLBL    IFLT 0
     C                     SUB  WWCLBL    WWCOLL
     C                     SUB  WWCLBL    WWCOLT
     C                     Z-SUBWWCLBL    WWCOLR
X1   C                     ELSE
     C                     ADD  WWCLBL    WWEXPO
     C                     ADD  WWCLBL    WWEXPT
     C                     Z-ADDWWCLBL    WWEXPS
     C                     END
     C*                                                                   R0149
     C** Accumulate the overdraft limits in Portfolio currency            R0149
     C*  Must add in decimal places                                       B7952
     C           4         ADD  WWDPI     Z                               B7952
     C           POWER,Z   MULT ODLN      WWAMTI    H                     B7952
     C**                   Z-ADDODLN      WWAMTI                    R0149 B7952
     C                     EXSR SCONV                                     R0149
     C                     ADD  WWAMTO    WWLIMT                          R0149
     C***                                                                 R5521
     C***Accumulate Interest CR & DR                                      R5521
     C***                                                                 R5521
     C***        KEYFD1    CHAINREACRDL1             36                   R5521
     C***                                                                 R5521
B1   C***        *IN36     IFEQ '0'                                       R5521
     C***        RECI      ANDNE'*'                                       R5521
     C***                  ADD  DAIC1     WWDBAC                          R5521
     C***                  ADD  MADI      WWDBAC                          R5521
     C***                  ADD  GADI      WWDBAC                          R5521
     C***                  SUB  DIIE      WWDBAC                    R1052 R5521
     C***                                                           R1052 R5521
     C***                  ADD  CAIC1     WWCRAC                          R5521
     C***                  ADD  MACI      WWCRAC                          R5521
     C***                  ADD  GACI      WWCRAC                          R5521
     C***                  SUB  CIIE      WWDBAC                    R1052 R5521
E1   C***                  END                                            R5521
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BAB        - This subroutine writes a record to the Portfolio  *
     C**               extract file (ACCOUNTS)                           *
     C**                                                                 *
     C** CALLS       - #ZA                                               *
     C**                                                                 *
     C** CALLED BY   - #BA                                               *
     C**                                                                 *
     C********************************************************************
     C           #BAB      BEGSR
     C*
     C                     Z-ADD0         EECLPC
     C                     Z-ADD0         EEINPC
     C                     Z-ADD0         WWPERC
     C*
     C** Determine borrowing power percentage
     C*
     C***********A5INNR    CHAINLBBPWRL3             37                   096089
     C           WWINNR    CHAINLBBPWRL3             37                   096089
     C*
B1   C           *IN37     IFEQ '0'
     C           BPINPC    ANDGT0
     C                     Z-ADDBPINPC    EEINPC
     C                     Z-ADDBPINPC    WWPERC
E1   C                     END
     C*
     C           KEYFD2    CHAINLBBPWRL1             37
     C*
B1   C           *IN37     IFEQ '0'
     C           BPINPC    ANDGT0
     C                     Z-ADDBPINPC    EECLPC
     C                     Z-ADD0         EEINPC
     C                     Z-ADDBPINPC    WWPERC
E1   C                     END
     C*
B1   C           WWPERC    IFEQ 0
     C                     Z-ADD100       WWPERC
E1   C                     END
     C*
     C** Check if Customer No/Instrument/Currency already exists
     C*
     C           KEYFD7    CHAINLBEXTRL2             58
B1   C           *IN58     IFEQ '0'
     C*                                                                   R0576
     C** Sub Borrowing Power from file                                    R0576
     C*                                                                   R0576
     C           WWBPWR    SUB  EEBPWR    WWBPWR                          R0576
     C*
     C** Add calculated collateral to current collateral
     C*
     C           WWCOLL    ADD  EECOLL    WWCOLL
     C*
     C** Borrowing Power = Collateral * Borrowing Power %
     C*
     C           WWPERC    DIV  100       WWINPC  32
     C           WWCOLL    MULT WWINPC    EEBPWR
      *                                                                   R0576
     C***        EEBPWR    IFNE 0                                         R0576
     C***                  Z-ADDEEBPWR    WWBPWR                          B4814
     C***                  END                                            R0576
     C                     ADD  EEBPWR    WWBPWR                          R0576
     C*
     C** Update the Portfolio Extract File
     C*
     C                     Z-ADDWWCOLL    EECOLL
     C                     Z-ADDBJDNWD    EELCD
     C                     TIME           EETLUP
     C                     Z-ADDWWDAY     EEDLUP
     C                     MOVE WWMNTH    EEMLUP
     C                     Z-ADDWWYEAR    EEYLUP
     C                     ADD  WWEXPO    EEEXPS
     C                     ADD  WWLIMT    EELIMT                          R0149
     C*********************ADD  WWDBAC    EEACCD                          R5521
     C*********************ADD  WWCRAC    EEACCC                          R5521
     C                     Z-ADD*ZERO     EEACCD                          R5521
     C                     Z-ADD*ZERO     EEACCC                          R5521
     C                     UPDATLBEXTRDX
     C*
X1   C                     ELSE
     C*
     C** Borrowing Power = Collateral * Borrowing Power %
     C*
     C           WWPERC    DIV  100       WWINPC  32
     C           WWCOLL    MULT WWINPC    EEBPWR
      *
     C                     ADD  EEBPWR    WWBPWR                          B4814
     C*
     C** Retrieve the Portfolio credit group code
     C*
     C***********A5INNR    CHAINSDPLINL4             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C***********          PARM A5INNR    @INNR   3                 S01498096089
     C                     PARM WWINNR    @INNR   3                       096089
     C           @PLIN     PARM @PLIN     DSSDY                           S01498
     C*
B2   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDPLINL4'DBFILE           ***************S01498
     C                     MOVE 'SDPLINPD'DBFILE           ***************S01498
     C***********          MOVELA5INNR    DBKEY            * DBERROR 005 *096089
     C                     MOVELWWINNR    DBKEY            * DBERROR 005 *096089
     C                     Z-ADD5         DBASE            ***************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
E2   C                     END
     C*
     C** Retrieve the Portfolio Lending group and the portfolio lending Sequence
     C*
     C***********PDLOMG    CHAINLBGROUL1             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOGROUR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM PDLOMG    @LCGR   3                       S01498
     C           @GROU     PARM @GROU     DSSDY                           S01498
     C*
B2   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'LBGROUL1'DBFILE           ***************S01498
     C                     MOVE 'LBGROUPD'DBFILE           ***************S01498
     C                     MOVELPDLOMG    DBKEY            ** DBERROR 006 **
     C                     Z-ADD6         DBASE            *****************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
E2   C                     END
     C*
     C                     MOVE 'D'       EERECI
     C**********           Z-ADDWWCNUM    EECNUM                                              CSD027
     C                     MOVE WWCNUM    EECNUM                                              CSD027
     C*********************MOVE A5INNR    EEINST                          B8146
     C                     MOVE WWINNR    EEINST                          B8146
     C                     MOVE WWCCY     EECCY
     C                     Z-ADDWWEXPO    EEEXPS
     C*********************Z-ADD0         EELIMT                          R0149
     C                     Z-ADDWWLIMT    EELIMT                          R0149
     C                     Z-ADDWWCOLL    EECOLL
     C*********************Z-ADDWWDBAC    EEACCD                          R5521
     C*********************Z-ADDWWCRAC    EEACCC                          R5521
     C                     Z-ADD*ZERO     EEACCD                          R5521
     C                     Z-ADD*ZERO     EEACCC                          R5521
     C                     MOVE *BLANKS   EESESN
     C                     Z-ADD0         EESEPC
     C                     Z-ADD0         EECTPC
     C                     MOVE GPLCGR    EELCGR
     C                     Z-ADDGPLCGS    EELCGS
     C                     MOVE BBPCNB    EEPCNB
     C                     MOVE PDCSHI    EECIFL
     C                     Z-ADDBJDNWD    EEORED
     C                     Z-ADDBJDNWD    EELCD
     C                     TIME           EETLUP
     C                     Z-ADDWWDAY     EEDLUP
     C                     MOVE WWMNTH    EEMLUP
     C                     Z-ADDWWYEAR    EEYLUP
     C*
     C** Write a record to the Portfolio extract file
     C*
     C                     WRITELBEXTRD0
     C*
     C** Maintain count of records added to LBEXTRPD
     C*
     C                     ADD  1         RRPNRL
     C*
E1   C                     END
     C*
     C** Initialise credit and debit accrued fields
     C*
     C*********************Z-ADD0         WWDBAC                          R5521
     C*********************Z-ADD0         WWCRAC                          R5521
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BB         - This subroutine performs the Held Items processing*
     C**                                                                 *
     C** CALLS       - #BBA #BBB #ZA                                     *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BB       BEGSR
     C*
     C** Write regeneration details 'HELD ITEMS' header
     C*
     C***********          WRITEHEADER00                                  S01498
     C***********          WRITEHEADER02                                  S01498
     C                     MOVE '0'       *IN82                           S01498
     C                     MOVE 'N'       WWDTRW
     C*
     C** Read through the whole Held Items master file in Customer number/
     C** Currency sequence
     C*
     C           *LOVAL    SETLLHELDITL1
     C                     READ HELDITL1                 38
     C*
     C** Process while more records on file
     C*
B1   C           *IN38     DOWEQ'0'
     C*
     C** Save the default Portfol. extract key : Customer number/Instrument type
     C**                                         /Currency
     C***(N.B.*Held*items*use*a*predefined*instrument*LBHELD*on*SDLOMBPD) S01498
     C** (N.B. Held items use a predefined instrument LBHLDI on SDLOMBPD) S01498
     C*
     C*
     C**********           Z-ADDCNUM      WWCNUM                                              CSD027
     C                     MOVE CNUM      WWCNUM                                              CSD027
     C                     MOVE CCY       WWCCY
     C*
     C** Retrieve currency details for customer currency
     C*
     C***********CCY       CHAINSDCURRL1             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOCURRR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM CCY       @CYCD   3                       S01498
     C           @CURR     PARM @CURR     DSSDY                           S01498
     C*
B2   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           A6TYLC    OREQ 'D'                        *****************
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDCURRL1'DBFILE           ** DBERROR 007 S01498
     C                     MOVE 'SDCURRPD'DBFILE           ** DBERROR 007 S01498
     C                     MOVELCCY       DBKEY            *****************
     C                     Z-ADD7         DBASE
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
X2   C                     ELSE
     C                     Z-ADDA6SPRT    WWSRI
     C                     Z-ADDA6NBDP    WWDPI
     C                     MOVE A6MDIN    WWMDI
E2   C                     END
     C*
     C                     SETOF                     3941
     C                     Z-ADD0         WWEXPO
     C*
     C** Process until change of default Portfolio extract key
     C*
B2   C           *IN38     DOWEQ'0'
     C           CNUM      ANDEQWWCNUM
     C           CCY       ANDEQWWCCY
     C*
     C** Increment the held items master file record counter
     C*
     C                     ADD  1         RRPNRH
     C*
     C** Process only active records with 'Event Control' date < Held Item
     C** expiry date
     C*
B3   C           RECI      IFEQ 'D'
     C           BJDNWD    ANDLTHEXP
     C*
     C** Access the Client master file once only for this Customer number/
     C** Currency
     C*
B4   C           *IN39     IFEQ '0'
     C*
     C                     SETON                     39
     C                     MOVE CNUM      WWPNP8
     C***********WWPNP8    CHAINSDLBCSL0             40                   S01498
     C           WWPNP8    CHAINLBLBCSJ0             40                   S01498
     C*
B5   C           *IN40     IFEQ '0'
     C                     SETON                     41
E5   C                     END
     C*
E4   C                     END
     C*
     C** Convert and accumulate the held amount into the Exposure total
     C*
B4   C           *IN40     IFEQ '0'
     C                     EXSR #BBA
     C*
     C** Write a detail line to the regeneration report
     C*
     C                     MOVEL'HD'      WWDTYP
     C                     EXSR #YA
     C*
E4   C                     END
     C*
E3   C                     END
     C*
     C** Read the next record
     C*
     C                     READ HELDITL1                 38
     C*
E2   C                     END
     C*
     C** Write a record to the Portfolio extract file if required
     C*
B2   C           *IN41     IFEQ '1'
     C                     EXSR #BBB
E2   C                     END
     C*
     C** Write a total line to the regeneration report if necessary
     C*
B2   C           WWDTRW    IFNE 'N'
B3   C           CNUM      IFNE WWCNUM
     C           *IN38     OREQ '1'
     C                     EXSR #YB
E3   C                     END
E2   C                     END
     C*
E1   C                     END
     C*
     C***IF*no*Held*Item*detls*write*null*report*line*ELSE*initialise**   S01498
     C***no*details*flag***********************************************   S01498
     C*
B1   C***********WWDETR    IFEQ 'N'                                       S01498
     C***********          WRITENULL0                                     S01498
X1   C***********          ELSE                                           S01498
     C***********          MOVE 'N'       WWDETR                          S01498
E1   C***********          END                                            S01498
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BBA        - This subroutine converts and accumulates the      *
     C**               Exposure for this Customer number/Instrument type *
     C**               /Currency (HELD ITEMS)                            *
     C**                                                                 *
     C** CALLS       - SCONV                                             *
     C**                                                                 *
     C** CALLED BY   - #BB                                               *
     C**                                                                 *
     C********************************************************************
     C           #BBA      BEGSR
     C*
     C** Convert and accumulate the held amount in Portfolio currency into
     C** the exposure total
     C*
     C                     Z-ADDHLDA      WWAMTI
     C                     EXSR SCONV
     C                     ADD  WWAMTO    WWEXPO
     C                     ADD  WWAMTO    WWEXPT
     C                     Z-ADDWWAMTO    WWEXPS
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BBB        - This subroutine writes a record to the Portfolio  *
     C**               extract file (HELD ITEMS)                         *
     C**                                                                 *
     C** CALLS       - #ZA                                               *
     C**                                                                 *
     C** CALLED BY   - #BB                                               *
     C**                                                                 *
     C********************************************************************
     C           #BBB      BEGSR
     C*
     C                     Z-ADD0         EECLPC
     C                     Z-ADD0         EEINPC
     C*
     C** Determine instrument and client percentage
     C*
     C***********LBHELD    CHAINLBBPWRL3             42                   S01498
     C           LBHLDI    CHAINLBBPWRL3             42                   S01498
     C*
B1   C           *IN42     IFEQ '0'
     C           BPINPC    ANDGT0
     C                     Z-ADDBPINPC    EEINPC
E1   C                     END
     C*
     C           KEYFD3    CHAINLBBPWRL1             42
     C*
B1   C           *IN42     IFEQ '0'
     C           BPINPC    ANDGT0
     C                     Z-ADDBPINPC    EECLPC
     C                     Z-ADD0         EEINPC
E1   C                     END
     C*
     C** Retrieve the portfolio lending group code
     C*
     C***********LBHELD    CHAINSDPLINL4             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM LBHLDI    @INNR   3                       S01498
     C           @PLIN     PARM @PLIN     DSSDY                           S01498
     C*
B1   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDPLINL4'DBFILE           ***************S01498
     C***********          MOVELLBHELD    DBKEY            * DBERROR 008 *S01498
     C                     MOVE 'SDPLINPD'DBFILE           ***************S01498
     C                     MOVELLBHLDI    DBKEY            * DBERROR 008 *S01498
     C                     Z-ADD8         DBASE            ***************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
E1   C                     END
     C*
     C** Retrieve the portfolio lending group and the portfolio lending Sequence
     C*
     C***********PDLOMG    CHAINLBGROUL1             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOGROUR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM PDLOMG    @LCGR   3                       S01498
     C           @GROU     PARM @GROU     DSSDY                           S01498
     C*
B1   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'LBGROUL1'DBFILE           ***************S01498
     C                     MOVE 'LBGROUPD'DBFILE           ***************S01498
     C                     MOVELPDLOMG    DBKEY            ** DBERROR 009 **
     C                     Z-ADD9         DBASE            *****************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
E1   C                     END
     C*
     C                     MOVE 'D'       EERECI
     C**********           Z-ADDWWCNUM    EECNUM                                              CSD027
     C                     MOVE WWCNUM    EECNUM                                              CSD027
     C***********          MOVE LBHELD    EEINST                          S01498
     C                     MOVE LBHLDI    EEINST                          S01498
     C                     MOVE WWCCY     EECCY
     C                     Z-ADDWWEXPO    EEEXPS
     C                     Z-ADD0         EELIMT
     C                     Z-ADD0         EECOLL
     C                     Z-ADD0         EEACCD
     C                     Z-ADD0         EEACCC
     C                     MOVE *BLANKS   EESESN
     C                     Z-ADD0         EESEPC
     C                     Z-ADD0         EECTPC
     C                     MOVE GPLCGR    EELCGR
     C                     Z-ADDGPLCGS    EELCGS
     C                     Z-ADD0         EEBPWR
     C                     MOVE BBPCNB    EEPCNB
     C                     MOVE PDCSHI    EECIFL
     C                     Z-ADDBJDNWD    EEORED
     C                     Z-ADDBJDNWD    EELCD
     C                     TIME           EETLUP
     C                     Z-ADDWWDAY     EEDLUP
     C                     MOVE WWMNTH    EEMLUP
     C                     Z-ADDWWYEAR    EEYLUP
     C*
     C** Write a record to the Portfolio extract file
     C*
     C                     WRITELBEXTRD0
     C*
     C** Maintain count of records added to LBEXTRPD
     C*
     C                     ADD  1         RRPNRL
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BC         - This subroutine performs the customer exchanges   *
     C**               processing                                        *
     C**                                                                 *
     C** CALLS       - #BCA #BCB                                         *
     C**                                                                 *
     C** CALLED BY   - #B                                                *
     C**                                                                 *
     C********************************************************************
     C           #BC       BEGSR
     C*
     C** Write regeneration details 'CUSTOMER EXCHANGES' header
     C*
     C***********          WRITEHEADER00                                  S01498
     C***********          WRITEHEADER03                                  S01498
     C                     MOVE '0'       *IN83                           S01498
     C                     MOVE 'N'       WWDTRW
     C*
     C** Process the customer exchanges (CUSEXEL1) in Debit customer number/
     C** Currency/Debit retail account number sequence
     C*
     C                     EXSR #BCA
     C*
     C** Process the customer exchanges (CUSEXEL2) in Credit customer number/
     C** Currency/Credit retail account number sequence
     C*
     C                     EXSR #BCB
     C*
     C***IF*no*Customer*Exchange*details*write*null*report*line********   S01498
     C*
B1   C***********WWDETR    IFEQ 'N'                                       S01498
     C***********          WRITENULL0                                     S01498
E1   C***********          END                                            S01498
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BCA        - This subroutine processes customer exchanges      *
     C**               CUSEXEL1 (Debits)                                 *
     C**                                                                 *
     C** CALLS       - #BCAA #BCAB #ZA                                   *
     C**                                                                 *
     C** CALLED BY   - #BC                                               *
     C**                                                                 *
     C********************************************************************
     C           #BCA      BEGSR
     C*
     C** Read through the whole Customer exchanges master file CUSEXEL1 in
     C** Debit customer number/Currency/Debit retail account number sequence
     C*
     C           *LOVAL    SETLLCUSEXEL1
     C                     READ CUSEXEL1                 43
     C*
     C** Process while more records on file
     C*
B1   C           *IN43     DOWEQ'0'
     C*
     C** Save the default Portfol. extract key : Customer number/Instrument type
     C**                                         /Currency
     C** (N.B. Held items use a predefined instrument LBCUSI on SDLOMBPD)
     C*
     C**********           Z-ADDDCUS      WWDCUS                                              CSD027
     C                     MOVE DCUS      WWDCUS                                              CSD027
     C                     MOVE DRCY      WWDRCY
     C*
     C** Retrieve currency details for debit customer currency
     C*
     C***********DRCY      CHAINSDCURRL1             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOCURRR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM DRCY      @CYCD   3                       S01498
     C           @CURR     PARM @CURR     DSSDY                           S01498
     C*
B2   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           A6TYLC    OREQ 'D'                        *****************
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDCURRL1'DBFILE           ** DBERROR 010 S01498
     C                     MOVE 'SDCURRPD'DBFILE           ** DBERROR 010 S01498
     C                     MOVELDRCY      DBKEY            *****************
     C                     Z-ADD10        DBASE
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
X2   C                     ELSE
     C                     Z-ADDA6SPRT    WWSRI
     C                     Z-ADDA6NBDP    WWDPI
     C                     MOVE A6MDIN    WWMDI
E2   C                     END
     C*
     C                     SETOF                     4446
     C                     Z-ADD0         WWEXPO
     C*
     C** Process until change of default Portfolio extract key
     C*
B2   C           *IN43     DOWEQ'0'
     C           DCUS      ANDEQWWDCUS
     C           DRCY      ANDEQWWDRCY
     C*
     C** Increment the customer exchanges master file record counter
     C*
     C**********           ADD  1         RRPNRC                          R5801
     C*
     C** Process only active records
     C*
B3   C           RECI      IFEQ 'D'
     C*
     C** Access the Client master file once only for this Customer number/
     C** Instrument Type/Currency
     C*
B4   C           *IN44     IFEQ '0'
     C                     SETON                     44
     C                     MOVE DCUS      WWPNP8
     C***********WWPNP8    CHAINSDLBCSL0             45                   S01498
     C           WWPNP8    CHAINLBLBCSJ0             45                   S01498
B5   C           *IN45     IFEQ '0'
     C                     SETON                     46
E5   C                     END
E4   C                     END
     C*
     C** Convert and accumulate debit amount into exposure total for
     C** the debit customer
     C*
B4   C           *IN45     IFEQ '0'
     C                     EXSR #BCAA
     C*
     C** Write a detail line to the regeneration report
     C*
     C                     MOVEL'DR'      WWDTYP
     C                     EXSR #YA
     C*
E4   C                     END
     C*
E3   C                     END
     C*
     C** Read the next record
     C*
     C                     READ CUSEXEL1                 43
     C*
E2   C                     END
     C*
     C** Write a record to the Portfolio extract file if required
     C*
B2   C           *IN46     IFEQ '1'
     C                     EXSR #BCAB
E2   C                     END
     C*
     C** Write a total line to the regeneration report if necessary
     C*
B2   C           WWDTRW    IFNE 'N'
B3   C           DCUS      IFNE WWDCUS
     C           *IN43     OREQ '1'
     C                     EXSR #YB
E3   C                     END
E2   C                     END
     C*
E1   C                     END
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BCAA       - This subroutine converts and accumulates the debit*
     C**               amount into the exposure total for this debit     *
     C**               customer (Debits)                                 *
     C**                                                                 *
     C** CALLS       - SCONV                                             *
     C**                                                                 *
     C** CALLED BY   - #BCA                                              *
     C**                                                                 *
     C********************************************************************
     C           #BCAA     BEGSR
     C*
     C** Convert and accumulate the debit amount in Portfolio currency
     C** into the exposure total
     C*
     C                     Z-ADDDRAM      WWAMTI
     C                     EXSR SCONV
     C                     ADD  WWAMTO    WWEXPO
     C                     ADD  WWAMTO    WWEXPT
     C                     Z-ADDWWAMTO    WWEXPS
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BCAB       - This subroutine writes/updates a record to the    *
     C**               Portfolio extract file (Debits)                   *
     C**                                                                 *
     C** CALLS       - #ZA                                               *
     C**                                                                 *
     C** CALLED BY   - #BCA                                              *
     C**                                                                 *
     C********************************************************************
     C           #BCAB     BEGSR
     C*
     C** If there already is an extract record update it else write a
     C** new record
     C*
     C           KEYFD4    CHAINLBEXTRL2             47
     C*
B1   C           *IN47     IFEQ '0'
     C*
     C                     Z-ADDWWEXPO    EEEXPS
     C                     Z-ADDBJDNWD    EELCD
     C                     TIME           EETLUP
     C                     Z-ADDWWDAY     EEDLUP
     C                     MOVE WWMNTH    EEMLUP
     C                     Z-ADDWWYEAR    EEYLUP
     C                     UPDATLBEXTRDX
     C*
X1   C                     ELSE
     C*
     C** Retrieve the portfolio lending group code
     C*
     C***********LBCUSI    CHAINSDPLINL4             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM LBCUSI    @INNR   3                       S01498
     C           @PLIN     PARM @PLIN     DSSDY                           S01498
     C*
B2   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDPLINL4'DBFILE           ***************S01498
     C                     MOVE 'SDPLINPD'DBFILE           ***************S01498
     C                     MOVELLBCUSI    DBKEY            * DBERROR 011 *
     C                     Z-ADD11        DBASE            ***************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
E2   C                     END
     C*
     C** Retrieve the portfolio lending group and the portfolio lending Sequence
     C*
     C***********PDLOMG    CHAINLBGROUL1             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOGROUR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM PDLOMG    @LCGR   3                       S01498
     C           @GROU     PARM @GROU     DSSDY                           S01498
     C*
B2   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'LBGROUL1'DBFILE           ***************S01498
     C                     MOVE 'LBGROUPD'DBFILE           ***************S01498
     C                     MOVELPDLOMG    DBKEY            ** DBERROR 012 **
     C                     Z-ADD12        DBASE            *****************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
E2   C                     END
     C*
     C                     MOVE 'D'       EERECI
     C**********           Z-ADDWWDCUS    EECNUM                                              CSD027
     C                     MOVE WWDCUS    EECNUM                                              CSD027
     C                     MOVE LBCUSI    EEINST
     C                     MOVE WWDRCY    EECCY
     C                     Z-ADDWWEXPO    EEEXPS
     C                     Z-ADD0         EELIMT
     C                     Z-ADD0         EECOLL
     C                     Z-ADD0         EEACCD
     C                     Z-ADD0         EEACCC
     C                     MOVE *BLANKS   EESESN
     C                     Z-ADD0         EECLPC
     C                     Z-ADD0         EESEPC
     C                     Z-ADD0         EEINPC
     C                     Z-ADD0         EECTPC
     C                     MOVE GPLCGR    EELCGR
     C                     Z-ADDGPLCGS    EELCGS
     C                     Z-ADD0         EEBPWR
     C                     MOVE BBPCNB    EEPCNB
     C                     MOVE PDCSHI    EECIFL
     C                     Z-ADDBJDNWD    EEORED
     C                     Z-ADDBJDNWD    EELCD
     C                     TIME           EETLUP
     C                     Z-ADDWWDAY     EEDLUP
     C                     MOVE WWMNTH    EEMLUP
     C                     Z-ADDWWYEAR    EEYLUP
     C*
     C** Write a record to the Portfolio extract file
     C*
     C                     WRITELBEXTRD0
     C*
     C** Maintain count of records added to LBEXTRPD
     C*
     C                     ADD  1         RRPNRL
     C*
E1   C                     END
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BCB        - This subroutine processes customer exchanges      *
     C**               CUSEXEL2 (Credits)                                *
     C**                                                                 *
     C** CALLS       - #BCBA #BCBB #ZA                                   *
     C**                                                                 *
     C** CALLED BY   - #BC                                               *
     C**                                                                 *
     C********************************************************************
     C           #BCB      BEGSR
     C*
     C** Read through the whole Customer exchanges master file CUSEXEL2 in
     C** Credit customer number/Currency/Credit retail account number sequence
     C*
     C           *LOVAL    SETLLCUSEXEL2
     C                     READ CUSEXEL2                 48
     C*
     C** Process while more records on file
     C*
B1   C           *IN48     DOWEQ'0'
     C*
     C** Save the default Portfol. extract key : Customer number/Instrument type
     C**                                         /Currency
     C** (N.B. Held items use a predefined instrument LBCUSI on SDLOMBPD)
     C*
     C**********           Z-ADDCCUS      WWCCUS                                              CSD027
     C                     MOVE CCUS      WWCCUS                                              CSD027
     C                     MOVE CRCY      WWCRCY
     C*
     C** Retrieve currency details for credit customer currency
     C*
     C***********CRCY      CHAINSDCURRL1             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOCURRR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM CRCY      @CYCD   3                       S01498
     C           @CURR     PARM @CURR     DSSDY                           S01498
     C*
B2   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           A6TYLC    OREQ 'D'                        *****************
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDCURRL1'DBFILE           ** DBERROR 013 S01498
     C                     MOVE 'SDCURRPD'DBFILE           ** DBERROR 013 S01498
     C                     MOVELCRCY      DBKEY            *****************
     C                     Z-ADD13        DBASE
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
X2   C                     ELSE
     C                     Z-ADDA6SPRT    WWSRI
     C                     Z-ADDA6NBDP    WWDPI
     C                     MOVE A6MDIN    WWMDI
E2   C                     END
     C*
     C                     SETOF                     4951
     C                     Z-ADD0         WWCOLL
     C*
     C** Process until change of default Portfolio extract key
     C*
B2   C           *IN48     DOWEQ'0'
     C           CCUS      ANDEQWWCCUS
     C           CRCY      ANDEQWWCRCY
     C*
     C** Increment the customer exchanges master file record counter
     C*
     C********             ADD  1         RRPNRC                          R5801
     C*
     C** Process only active records
     C*
B3   C           RECI      IFEQ 'D'
     C*
     C** Access the Client master file once only for this Customer number/
     C** Instrument Type/Currency
     C*
B4   C           *IN49     IFEQ '0'
     C                     SETON                     49
     C                     MOVE CCUS      WWPNP8
     C***********WWPNP8    CHAINSDLBCSL0             50                   S01498
     C           WWPNP8    CHAINLBLBCSJ0             50                   S01498
B5   C           *IN50     IFEQ '0'
     C                     SETON                     51
E5   C                     END
E4   C                     END
     C*
     C** Convert and accumulate the credit amount into collateral total
     C** the credit customer
     C*
B4   C           *IN50     IFEQ '0'
     C                     EXSR #BCBA
     C*
     C** Write a detail line to the regeneration report
     C*
     C*********************MOVEL'AC'      WWDTYP                          R01168
     C                     MOVEL'CR'      WWDTYP                          R01168
     C                     EXSR #YA
     C*
E4   C                     END
     C*
E3   C                     END
     C*
     C** Read the next record
     C*
     C                     READ CUSEXEL2                 48
     C*
E2   C                     END
     C*
     C** Write a record to the Portfolio extract file if required
     C*
B2   C           *IN51     IFEQ '1'
     C                     EXSR #BCBB
E2   C                     END
     C*
     C** Write a total line to the regeneration report if necessary
     C*
B2   C           WWDTRW    IFNE 'N'
B3   C           CCUS      IFNE WWCCUS
     C           *IN48     OREQ '1'
     C                     EXSR #YB
E3   C                     END
E2   C                     END
     C*
E1   C                     END
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BCBA       - This subroutine converts and accumulates the      *
     C**               credit amount into the collateral total for this  *
     C**               credit customer (Credits)                         *
     C**                                                                 *
     C** CALLS       - SCONV                                             *
     C**                                                                 *
     C** CALLED BY   - #BCB                                              *
     C**                                                                 *
     C********************************************************************
     C           #BCBA     BEGSR
     C*
     C** Convert and accumulate the credit amount in Portfolio currency into
     C** the collateral total
     C*
     C                     Z-ADDCRAM      WWAMTI
     C                     EXSR SCONV
     C                     ADD  WWAMTO    WWCOLL
     C                     ADD  WWAMTO    WWCOLT
     C                     Z-ADDWWAMTO    WWCOLR
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #BCBB       - This subroutine writes/updates a record to the    *
     C**               Portfolio extract file (Credits)                  *
     C**                                                                 *
     C** CALLS       - #ZA                                               *
     C**                                                                 *
     C** CALLED BY   - #BCB                                              *
     C**                                                                 *
     C********************************************************************
     C           #BCBB     BEGSR
     C*
     C                     Z-ADD0         EECLPC
     C                     Z-ADD0         EEINPC
     C                     Z-ADD0         WWPERC
     C*
     C** Determine borrowing power percentage
     C*
     C           LBCUSI    CHAINLBBPWRL3             52
     C*
B1   C           *IN52     IFEQ '0'
     C           BPINPC    ANDGT0
     C                     Z-ADDBPINPC    EEINPC
     C                     Z-ADDBPINPC    WWPERC
E1   C                     END
     C*
     C           KEYFD5    CHAINLBBPWRL1             52
     C*
B1   C           *IN52     IFEQ '0'
     C           BPINPC    ANDGT0
     C                     Z-ADDBPINPC    EECLPC
     C                     Z-ADD0         EEINPC
     C                     Z-ADDBPINPC    WWPERC
E1   C                     END
     C*
B1   C           WWPERC    IFEQ 0
     C                     Z-ADD100       WWPERC
     C                     END
     C*
     C** If there already is an extract record update it else write a
     C** new record
     C*
     C           KEYFD6    CHAINLBEXTRL2             53
     C*
B1   C           *IN53     IFEQ '0'
     C*
     C                     ADD  WWCOLL    EECOLL
     C*
     C** Borrowing Power = Collateral * Borrowing Power %
     C*
     C           WWPERC    DIV  100       WWINPC
     C           EECOLL    MULT WWINPC    EEBPWR
     C*
     C                     Z-ADDBJDNWD    EELCD
     C                     TIME           EETLUP
     C                     Z-ADDWWDAY     EEDLUP
     C                     MOVE WWMNTH    EEMLUP
     C                     Z-ADDWWYEAR    EEYLUP
     C                     UPDATLBEXTRDX
     C*
X1   C                     ELSE
     C*
     C** Borrowing Power = Collateral * Borrowing Power %
     C*
     C           WWPERC    DIV  100       WWINPC
     C           WWCOLL    MULT WWINPC    EEBPWR
     C*
     C** Retrieve the portfolio lending group code
     C*
     C***********LBCUSI    CHAINSDPLINL4             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM LBCUSI    @INNR   3                       S01498
     C           @PLIN     PARM @PLIN     DSSDY                           S01498
     C*
B2   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDPLINL4'DBFILE           ***************S01498
     C                     MOVE 'SDPLINPD'DBFILE           ***************S01498
     C                     MOVELLBCUSI    DBKEY            * DBERROR 014 *
     C                     Z-ADD14        DBASE            ***************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
E2   C                     END
     C*
     C** Retrieve the portfolio lending group and the portfolio lending Sequence
     C*
     C***********PDLOMG    CHAINLBGROUL1             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOGROUR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM PDLOMG    @LCGR   3                       S01498
     C           @GROU     PARM @GROU     DSSDY                           S01498
     C*
B2   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'LBGROUL1'DBFILE           ***************S01498
     C                     MOVE 'LBGROUPD'DBFILE           ***************S01498
     C                     MOVELPDLOMG    DBKEY            ** DBERROR 015 **
     C                     Z-ADD15        DBASE            *****************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
E2   C                     END
     C*
     C                     MOVE 'D'       EERECI
     C**********           Z-ADDWWCCUS    EECNUM                                              CSD027
     C                     MOVE WWCCUS    EECNUM                                              CSD027
     C                     MOVE LBCUSI    EEINST
     C                     MOVE WWCRCY    EECCY
     C                     Z-ADD0         EEEXPS
     C                     Z-ADD0         EELIMT
     C                     Z-ADDWWCOLL    EECOLL
     C                     Z-ADD0         EEACCD
     C                     Z-ADD0         EEACCC
     C                     MOVE *BLANKS   EESESN
     C                     Z-ADD0         EESEPC
     C                     Z-ADD0         EECTPC
     C                     MOVE GPLCGR    EELCGR
     C                     Z-ADDGPLCGS    EELCGS
     C                     MOVE BBPCNB    EEPCNB
     C                     MOVE PDCSHI    EECIFL
     C                     Z-ADDBJDNWD    EEORED
     C                     Z-ADDBJDNWD    EELCD
     C                     TIME           EETLUP
     C                     Z-ADDWWDAY     EEDLUP
     C                     MOVE WWMNTH    EEMLUP
     C                     Z-ADDWWYEAR    EEYLUP
     C*
     C** Write a record to the Portfolio extract file
     C*
     C                     WRITELBEXTRD0
     C*
     C** Maintain count of records added to LBEXTRPD
     C*
     C                     ADD  1         RRPNRL
     C*
E1   C                     END
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #C          - This subroutine performs termination processing   *
     C**                                                                 *
     C** CALLS       - *NONE                                             *
     C**                                                                 *
     C** CALLED BY   - MAINLINE                                          *
     C**                                                                 *
     C********************************************************************
     C           #C        BEGSR
     C*
     C** If necessary write header on regeneration details report
     C** Write End of regeneration details report
     C*
     C           *IN71     IFEQ '1'                                       S01498
B1   C***********LINE2     IFGT 56                                        S01498
     C           LINE1     IFGT 56                                        S01498
     C                     WRITEHEADER00
E1   C                     END
     C*
     C                     WRITEFOOTING0
     C                     CLOSELB0640P1                                  S01498
     C                     END                                            S01498
     C*
B1   C************IN33     IFEQ '0'                                       S01498
     C***********          WRITEP1NODETL                                  S01498
E1   C***********          END                                            S01498
     C*
     C           *IN72     IFEQ '1'                                       S01498
     C                     WRITEP1TRAILR
     C                     CLOSELB0640P2                                  S01498
     C                     END                                            S01498
     C*
     C** Read the Accounts trailer file
     C*
     C**                   READ ACCNTAC                  54               B4814
     C*
B1   C**         *IN54     IFEQ '1'                                       B4814
     C**         RECI      OREQ '*'                        ***************B4814
     C**                   MOVEL'ACCNTAC 'DBFILE           ** DBERROR 016 B4814
     C**                   Z-ADD16        DBASE            ***************B4814
     C**                   EXSR #ZA                                       B4814
X1   C**                   ELSE                                           B4814
     C*******              Z-ADDNORE      RRFNRA                       LB0000
     C*******              Z-ADDNOOA      RRFNRA                       LB0000
     C***********NORE******SUB  2         RRFNRA                       R00403
     C**                   Z-ADDNAUP      RRFNRA  50                   R00B4814
B2   C**         RRFNRA    IFNE RRPNRA                                 LB0B4814
     C**                   SETON                     55U8                 B4814
E2   C**                   END                                            B4814
E1   C**                   END                                            B4814
     C*
     C** Read the Held Items trailer file
     C*
     C                     READ HELDIHC                  54
     C*
B1   C           *IN54     IFEQ '1'
     C           RECI      OREQ '*'                        *****************
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'HELDIHC 'DBFILE           ** DBERROR 017 S01498
     C                     MOVE 'HELDIHC 'DBFILE           ** DBERROR 017 S01498
     C                     Z-ADD17        DBASE            *****************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
X1   C                     ELSE
     C*********************Z-ADDHDNORE    RRFNRH                          B4642
     C***********HDNORE****IFNE RRPNRH                                    B4642
     C*********************Z-ADDNHAU      RRFNRH                   B4642  067396
     C***********NHAU      IFNE RRPNRH                             B4642  067396
     C********** NHID      ADD  NHAU      TOTAU   30                                  067396 BUG3584
     C           NHID      ADD  NHAU      TOTAU   80                                         BUG3584
     C                     Z-ADDTOTAU     RRFNRH                          067396
     C           TOTAU     IFNE RRPNRH                                    067396
     C                     SETON                     56U8
E2   C                     END
E1   C                     END
     C*
     C** Read the Customer Exchanges trailer file
     C*
     C                     READ CUSEXZ1                  54
     C*
B1   C           *IN54     IFEQ '1'
     C           RECI      OREQ '*'                        *****************
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'CUSEXZ1 'DBFILE           ** DBERROR 018 S01498
     C                     MOVE 'CUSEXZ1 'DBFILE           ** DBERROR 018 S01498
     C                     Z-ADD18        DBASE            *****************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
X1   C                     ELSE
     C                     SUB  2         NORE                         LB0000
     C****                 Z-ADDNORE      RRFNRC                          R5801
B2   C****       NORE      IFNE RRPNRC                                    R5801
     C****                 SETON                     57U8                 R5801
E2   C****                 END                                            R5801
E1   C                     END
     C*
     C** Print the Retail Regeneration Run Controls
     C*
     C                     WRITEAUHEADER
     C                     WRITEAUDETAIL
     C***********          WRITEAUTRAILR                                  S01498
     C*                                                                   S01498
     C** If no details to report, then output 'No details' to audit.      S01498
     C*                                                                   S01498
     C           WWDETR    IFEQ 'N'                                       S01498
     C           *IN33     ANDEQ'0'                                       S01498
     C                     WRITENODTLS                                    S01498
     C                     END                                            S01498
     C*
     C/COPY WNCPYSRC,LB0640C006
     C                     SETON                     LR
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #A          - This subroutine performs the initial processing   *
     C**                                                                 *
     C** CALLS       - #ZA                                               *
     C**                                                                 *
     C** CALLED BY   - MAINLINE                                          *
     C**                                                                 *
     C********************************************************************
     C*
     C           #A        BEGSR
     C*                                                                   S01498
     C**  Copyright statement                                             S01498
     C*                                                                   S01498
     C                     MOVEACPY@      ACT@   80                       S01498
     C*                                                                   S01498
     C**  Read in DTAARA/RUNDAT to get multibranching indicator           S01498
     C*                                                                   S01498
     C           *NAMVAR   DEFN           RUNDAT                          S01498
     C                     IN   RUNDAT                                    S01498
     C           AGMBIN    IFEQ 'Y'                                       S01498
     C                     MOVE '1'       *IN70                           S01498
     C                     END                                            S01498
     C*
     C           *NAMVAR   DEFN           LDA                             S01498
     C*                                                                   S01498
     C           *LOCK     IN   LDA                                       S01498
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'LB0640'  DBPGM
     C                     Z-ADD0         DBASE
     C                     OUT  LDA                                       S01498
     C*
     C/COPY WNCPYSRC,LB0640C007
     C** Read the record on the bank details file
     C*
     C***********1         SETLLSDBANKPD                                  S01498
     C***********          READ SDBANKPD                 99               S01498
     C*                                                                   S01498
     C                     CALL 'AOBANKR0'                                S01498
     C                     PARM '*MSG    '@RTCD   7                       S01498
     C                     PARM '*FIRST  '@OPTN   7                       S01498
     C           @BANK     PARM @BANK     DSFDY                           S01498
     C*
B1   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           BJTYLC    OREQ 'D'                        *****************
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDBANKPD'DBFILE           ** DBERROR 001 S01498
     C                     MOVE 'SDBANKPD'DBFILE           ** DBERROR 001 S01498
     C                     Z-ADD1         DBASE            *****************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
X1   C                     ELSE
     C*                                                                   S01498
     C                     MOVE BJMRDT    WWMRDT                          S01498
     C*                                                                   S01498
     C                     SUB  1         BJDNWD
E1   C                     END
     C*
     C** Read the record on the portfolio lending installation control data file
     C*
     C***********1         SETLLSDLOMBPD                                  S01498
     C***********          READ SDLOMBPD                 99               S01498
     C*                                                                   S01498
     C                     CALL 'AOLOMBR0'                                S01498
     C                     PARM '*MSG    '@RTCD   7                       S01498
     C                     PARM '*FIRST  '@OPTN   7                       S01498
     C           @LOMB     PARM @LOMB     DSFDY                           S01498
     C*
B1   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           LBRECI    OREQ '*'                        *****************
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDLOMBPD'DBFILE           ** DBERROR 002 S01498
     C                     MOVE 'SDLOMBPD'DBFILE           ** DBERROR 002 S01498
     C                     Z-ADD2         DBASE            *****************
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
E1   C                     END
     C*
     C***********          WRITEP1HEADR1                                  S01498
     C***********          WRITEP1HEADR2                                  S01498
     C*
     C** Write an error message to the Retail Missing Instrument Report
     C** if a blank predefined instrument is found and terminate the program
     C*
B1   C***********LBHELD    IFEQ *BLANKS                                   S01498
     C           LBHLDI    IFEQ *BLANKS                                   S01498
     C           LBCUSI    OREQ *BLANKS
     C*
B2   C***********LBHELD    IFEQ *BLANKS                                   S01498
     C           LBHLDI    IFEQ *BLANKS                                   S01498
     C                     SETON                     27
E2   C                     END
     C*
B2   C           LBCUSI    IFEQ *BLANKS
     C                     SETON                     28
E2   C                     END
     C*
     C***********          WRITEP1DETALM                                  S01498
     C***********          WRITEP1TRAILR                                  S01498
     C                     WRITEAUHEADER                                  S01498
     C                     WRITEMISSING                                   S01498
     C                     SETON                     LR
     C                     RETRN
     C*
E1   C                     END
     C*
     C** Find the number of decimal places for the Portfolio base currency
     C*
     C***********LBCCY     CHAINSDCURRL1             99                   S01498
     C*                                                                   S01498
     C                     CALL 'AOCURRR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM LBCYCD    @CYCD   3                       S01498
     C           @CURR     PARM @CURR     DSSDY                           S01498
     C*
B1   C************IN99     IFEQ '1'                                       S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           A6TYLC    OREQ 'D'                        *****************
     C           *LOCK     IN   LDA                                       S01498
     C***********          MOVEL'SDCURRL1'DBFILE           ** DBERROR 003 S01498
     C***********          MOVELLBCCY     DBKEY            ***************S01498
     C                     MOVE 'SDCURRPD'DBFILE           ** DBERROR 003 S01498
     C                     MOVELLBCYCD    DBKEY            ***************S01498
     C                     Z-ADD3         DBASE
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA
X1   C                     ELSE
     C                     Z-ADDA6SPRT    WWSRO
     C                     Z-ADDA6NBDP    WWDPO
     C                     MOVE A6MDIN    WWMDO
E1   C                     END
     C*
     C** Define work field to contain detail type on regeneration rept
     C** Value 'AC' - Accounts
     C** Value 'HD' - Held Amounts
     C** Value 'DR' - Debit Amounts
     C** Value 'CR' - Credit Amounts
     C*
     C                     MOVE *BLANKS   WWDTYP  2
     C*
     C                     MOVE 'J'       ZECODE
     C*
     C** Define work fields
     C*
     C           *LIKE     DEFN CNUM      WWCNUM
     C           *LIKE     DEFN A5INNR    WWINNR
     C           *LIKE     DEFN CCY       WWCCY
     C           *LIKE     DEFN EEEXPS    WWEXPO
     C           *LIKE     DEFN EECOLL    WWCOLL
     C           *LIKE     DEFN EEEXPS    WWEXPS
     C           *LIKE     DEFN EELIMT    WWLIMT                          R0149
     C           *LIKE     DEFN EECOLL    WWEXPT
     C           *LIKE     DEFN EEEXPS    WWCOLR
     C           *LIKE     DEFN EECOLL    WWCOLT
     C********** *LIKE     DEFN EEACCD    WWDBAC                          R5521
     C********** *LIKE     DEFN EEACCC    WWCRAC                          R5521
     C           *LIKE     DEFN EEBPWR    WWBPWR
     C           *LIKE     DEFN CLBL      WWCLBL
     C           *LIKE     DEFN EECLPC    WWPERC
     C           *LIKE     DEFN DCUS      WWDCUS
     C           *LIKE     DEFN DRCY      WWDRCY
     C           *LIKE     DEFN CCUS      WWCCUS
     C           *LIKE     DEFN CRCY      WWCRCY
     C*
     C** Initialise the file record counters
     C*
     C                     Z-ADD0         RRPNRA
     C                     Z-ADD0         RRPNRH
     C*****                Z-ADD0         RRPNRC                          R5801
     C                     Z-ADD0         RREXCO                          R01168
     C                     Z-ADD0         WWBPWR                          B4814
     C*
     C** Initialise details flag
     C*
     C                     MOVE 'N'       WWDETR  1
     C*
     C                     EXSR RCFAU                                     S01498
     C*                                                                   S01498
     C                     ENDSR
     C/EJECT                                                              R01168
     C*****************************************************************   R01168
     C**                                                              *   R01168
     C**   P01       - This subroutine writes records to new          *   R01168
     C**               extract file LBEXCOPD.                         *   R01168
     C**                                                              *   R01168
     C**   CALLS     - #ZA                                            *   R01168
     C**                                                              *   R01168
     C**   CALLED BY - #YA                                            *   R01168
     C**                                                              *   R01168
     C*****************************************************************   R01168
     C*                                                                   R01168
     C           P01       BEGSR                                          R01168
     C*                                                                   R01168
     C** IF Detail Type = 'AC'                                            R01168
     C*                                                                   R01168
     C           WWDTYP    IFEQ 'AC'                                      R01168
     C*                                                                   R01168
     C***Access*SDPLINL4*with*key*A5INNR************************** R01168 S01498
     C** Access SDPLINPD.                                                 S01498
     C*                                                                   R01168
     C***********A5INNR    CHAINSDPLINL4             69            R01168 S01498
     C*                                                                   S01498
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM A5INNR    @INNR   3                       S01498
     C           @PLIN     PARM @PLIN     DSSDY                           S01498
     C*                                                                   R01168
     C************IN69     IFEQ '1'                                R01168 S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           PDRECI    ORNE 'D'                                       R01168
     C           *LOCK     IN   LDA                                       S01498
     C                     Z-ADD19        DBASE            ***************R01168
     C***********          MOVEL'SDPLINL4'DBFILE           * DBERR R01168 S01498
     C                     MOVE 'SDPLINPD'DBFILE           * DBERROR 019 *S01498
     C                     MOVE *BLANKS   DBKEY            ***************R01168
     C                     MOVELA5INNR    DBKEY                           R01168
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA                                       R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C***Access*LBGROUL1*with*key*PDLOMG************************** R01168 S01498
     C** Access LBGROUPD.                                                 S01498
     C*                                                                   R01168
     C***********PDLOMG    CHAINLBGROUL1             69            R01168 S01498
     C*                                                                   S01498
     C                     CALL 'AOGROUR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM PDLOMG    @LCGR   3                       S01498
     C           @GROU     PARM @GROU     DSSDY                           S01498
     C*                                                                   R01168
     C************IN69     IFEQ '1'                                R01168 S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           GPRECI    ORNE 'D'                                       R01168
     C           *LOCK     IN   LDA                                       S01498
     C                     Z-ADD20        DBASE             **************R01168
     C***********          MOVEL'LBGROUL1'DBFILE            * DBER R01168 S01498
     C                     MOVE 'LBGROUPD'DBFILE            * DBERROR 20 *S01498
     C                     MOVE *BLANKS   DBKEY             **************R01168
     C                     MOVELPDLOMG    DBKEY                           R01168
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA                                       R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C** Set exposure/collateral flags and totals                         R01168
     C*                                                                   R01168
     C           WWCOLR    IFNE 0                                         R01168
     C                     MOVE 'C'       EXEXCO                          R01168
     C                     Z-ADDWWCOLR    EXAMNT                          R01168
     C                     ELSE                                           R01168
     C                     MOVE 'E'       EXEXCO                          R01168
     C                     Z-ADDWWEXPS    EXAMNT                          R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C** Set up remaining fields and write record to LBEXCOPD             R01168
     C*                                                                   R01168
     C                     MOVE 'D'       EXRECI                          R01168
     C                     Z-ADDWWDAY     EXDLUP                          R01168
     C                     MOVE WWMNTH    EXMLUP                          R01168
     C                     Z-ADDWWYEAR    EXYLUP                          R01168
     C                     TIME           EXTLUP                          R01168
     C                     Z-ADDBJRDNB    EXORED                          R01168
     C**********           Z-ADDCNUM      EXCNUM                                       R01168 CSD027
     C                     MOVE CNUM      EXCNUM                                              CSD027
     C                     MOVELBBPCNB    EXPCNB                          R01168
     C                     MOVE '40'      EXREGE                          R01168
     C                     MOVELPDLOMG    EXLCGR                          R01168
     C                     Z-ADDGPLCGS    EXLCGS                          R01168
     C                     MOVELA5INNR    EXINST                          R01168
     C                     MOVELCCY       EXCCY                           R01168
     C                     Z-ADDACACOD    WWCOD                           R01168
     C                     Z-ADDACACSQ    WWSEQ                           R01168
     C                     Z-ADDACNO      WWNO                            R01168
     C                     Z-ADD0         EXDDAT                          R01168
     C                     Z-ADD0         EXVDAT                          R01168
     C                     Z-ADD0         EXMDAT                          R01168
     C                     Z-ADD0         EXRLDT                          R01168
     C                     MOVE R0BALN    EXADAM                          B5929
     C                     WRITELBEXCOPF                                  R01168
     C*                                                                   R01168
     C**  Add one to count of records written to LBEXCOPD                 R01168
     C*                                                                   R01168
     C                     ADD  1         RREXCO                          R01168
     C*                                                                   R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C** IF Detail Type = 'HD'                                            R01168
     C*                                                                   R01168
     C           WWDTYP    IFEQ 'HD'                                      R01168
     C*                                                                   R01168
     C***Access*SDPLINL4*with*key*LBHELD************************** R01168 S01498
     C** Access SDPLINPD.                                                 S01498
     C*                                                                   R01168
     C***********LBHELD    CHAINSDPLINL4             69            R01168 S01498
     C*                                                                   S01498
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM LBHLDI    @INNR   3                       S01498
     C           @PLIN     PARM @PLIN     DSSDY                           S01498
     C*                                                                   R01168
     C************IN69     IFEQ '1'                                R01168 S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           PDRECI    ORNE 'D'                                       R01168
     C           *LOCK     IN   LDA                                       S01498
     C                     Z-ADD21        DBASE            ***************R01168
     C***********          MOVEL'SDPLINL4'DBFILE           * DBERR R01168 S01498
     C                     MOVE 'SDPLINPD'DBFILE           * DBERROR 021 *S01498
     C                     MOVE *BLANKS   DBKEY            ***************R01168
     C***********          MOVELLBHELD    DBKEY                    R01168 S01498
     C                     MOVELLBHLDI    DBKEY                           S01498
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA                                       R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C***Access*LBGROUL1*with*key*PDLOMG************************** R01168 S01498
     C** Access LBGROUPD.                                                 S01498
     C*                                                                   R01168
     C***********PDLOMG    CHAINLBGROUL1             69            R01168 S01498
     C*                                                                   S01498
     C                     CALL 'AOGROUR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM PDLOMG    @LCGR   3                       S01498
     C           @GROU     PARM @GROU     DSSDY                           S01498
     C*                                                                   R01168
     C************IN69     IFEQ '1'                                R01168 S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           GPRECI    ORNE 'D'                                       R01168
     C           *LOCK     IN   LDA                                       S01498
     C                     Z-ADD22        DBASE            ***************R01168
     C***********          MOVEL'LBGROUL1'DBFILE           * DBERR R01168 S01498
     C                     MOVE 'LBGROUPD'DBFILE           * DBERROR 022 *S01498
     C                     MOVE *BLANKS   DBKEY            ***************R01168
     C                     MOVELPDLOMG    DBKEY                           R01168
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA                                       R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C** Set up fields and write record to LBEXCOPD                       R01168
     C*                                                                   R01168
     C                     MOVE 'D'       EXRECI                          R01168
     C                     Z-ADDWWDAY     EXDLUP                          R01168
     C                     MOVE WWMNTH    EXMLUP                          R01168
     C                     Z-ADDWWYEAR    EXYLUP                          R01168
     C                     TIME           EXTLUP                          R01168
     C                     Z-ADDBJRDNB    EXORED                          R01168
     C**********           Z-ADDCNUM      EXCNUM                                       R01168 CSD027
     C                     MOVE CNUM      EXCNUM                                              CSD027
     C                     MOVELBBPCNB    EXPCNB                          R01168
     C                     MOVE '40'      EXREGE                          R01168
     C                     MOVELPDLOMG    EXLCGR                          R01168
     C                     Z-ADDGPLCGS    EXLCGS                          R01168
     C***********          MOVELLBHELD    EXINST                   R01168 S01498
     C                     MOVELLBHLDI    EXINST                          S01498
     C                     MOVELCCY       EXCCY                           R01168
     C                     MOVE 'E'       EXEXCO                          R01168
     C                     Z-ADDWWEXPS    EXAMNT                          R01168
     C                     Z-ADDACOD      WWCOD                           R01168
     C                     Z-ADDACSQ      WWSEQ                           R01168
     C                     Z-ADDACNO      WWNO                            R01168
     C                     Z-ADD0         EXDDAT                          R01168
     C                     Z-ADD0         EXVDAT                          R01168
     C                     Z-ADD0         EXMDAT                          R01168
     C                     Z-ADD0         EXRLDT                          R01168
     C                     WRITELBEXCOPF                                  R01168
     C*                                                                   R01168
     C**  Add one to count of records written to LBEXCOPD                 R01168
     C*                                                                   R01168
     C                     ADD  1         RREXCO                          R01168
     C*                                                                   R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C** IF Detail Type = 'DR' or 'CR'                                    R01168
     C*                                                                   R01168
     C           WWDTYP    IFEQ 'DR'                                      R01168
     C           WWDTYP    OREQ 'CR'                                      R01168
     C*                                                                   R01168
     C***Access*SDPLINL4*with*key*LBCUSI************************** R01168 S01498
     C** Access SDPLINPD.                                                 S01498
     C*                                                                   R01168
     C***********LBCUSI    CHAINSDPLINL4             69            R01168 S01498
     C*                                                                   S01498
     C                     CALL 'AOPLINR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM LBCUSI    @INNR   3                       S01498
     C           @PLIN     PARM @PLIN     DSSDY                           S01498
     C*                                                                   R01168
     C************IN69     IFEQ '1'                                R01168 S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           PDRECI    ORNE 'D'                                       R01168
     C           *LOCK     IN   LDA                                       S01498
     C                     Z-ADD23        DBASE            ***************R01168
     C***********          MOVEL'SDPLINL4'DBFILE           * DBERR R01168 S01498
     C                     MOVE 'SDPLINPD'DBFILE           * DBERROR 023 *S01498
     C                     MOVE *BLANKS   DBKEY            ***************R01168
     C                     MOVELLBCUSI    DBKEY                           R01168
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA                                       R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C***Access*LBGROUL1*with*key*PDLOMG************************** R01168 S01498
     C** Access LBGROUPD.                                                 S01498
     C*                                                                   R01168
     C***********PDLOMG    CHAINLBGROUL1             69            R01168 S01498
     C*                                                                   S01498
     C                     CALL 'AOGROUR0'                                S01498
     C                     PARM '*MSG   ' @RTCD   7                       S01498
     C                     PARM '*KEY   ' @OPTN   7                       S01498
     C                     PARM PDLOMG    @LCGR   3                       S01498
     C           @GROU     PARM @GROU     DSSDY                           S01498
     C*                                                                   R01168
     C************IN69     IFEQ '1'                                R01168 S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           GPRECI    ORNE 'D'                                       R01168
     C           *LOCK     IN   LDA                                       S01498
     C                     Z-ADD24        DBASE            ***************R01168
     C***********          MOVEL'LBGROUL1'DBFILE           * DBERR R01168 S01498
     C                     MOVE 'LBGROUPD'DBFILE           * DBERROR 024 *S01498
     C                     MOVE *BLANKS   DBKEY            ***************R01168
     C                     MOVELPDLOMG    DBKEY                           R01168
     C                     OUT  LDA                                       S01498
     C                     EXSR #ZA                                       R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C** IF Detail Type = 'DR'                                            R01168
     C*                                                                   R01168
     C           WWDTYP    IFEQ 'DR'                                      R01168
     C*                                                                   R01168
     C** Set up fields and write record to LBEXCOPD                       R01168
     C*                                                                   R01168
     C                     MOVE 'D'       EXRECI                          R01168
     C                     Z-ADDWWDAY     EXDLUP                          R01168
     C                     MOVE WWMNTH    EXMLUP                          R01168
     C                     Z-ADDWWYEAR    EXYLUP                          R01168
     C                     TIME           EXTLUP                          R01168
     C                     Z-ADDBJRDNB    EXORED                          R01168
     C**********           Z-ADDDCUS      EXCNUM                                       R01168 CSD027
     C                     MOVE DCUS      EXCNUM                                              CSD027
     C                     MOVELBBPCNB    EXPCNB                          R01168
     C                     MOVE '40'      EXREGE                          R01168
     C                     MOVELPDLOMG    EXLCGR                          R01168
     C                     Z-ADDGPLCGS    EXLCGS                          R01168
     C                     MOVELLBCUSI    EXINST                          R01168
     C                     MOVELDRCY      EXCCY                           R01168
     C                     MOVE 'E'       EXEXCO                          R01168
     C                     Z-ADDWWEXPS    EXAMNT                          R01168
     C                     Z-ADDDCOD      WWCOD                           R01168
     C                     Z-ADDDACS      WWSEQ                           R01168
     C                     Z-ADDDRAN      WWNO                            R01168
     C                     Z-ADD0         EXDDAT                          R01168
     C                     Z-ADD0         EXVDAT                          R01168
     C                     Z-ADD0         EXMDAT                          R01168
     C                     Z-ADD0         EXRLDT                          R01168
     C                     WRITELBEXCOPF                                  R01168
     C*                                                                   R01168
     C**  Add one to count of records written to LBEXCOPD                 R01168
     C*                                                                   R01168
     C                     ADD  1         RREXCO                          R01168
     C*                                                                   R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C** IF Detail Type = 'CR'                                            R01168
     C*                                                                   R01168
     C           WWDTYP    IFEQ 'CR'                                      R01168
     C*                                                                   R01168
     C** Set up fields and write record to LBEXCOPD                       R01168
     C*                                                                   R01168
     C                     MOVE 'D'       EXRECI                          R01168
     C                     Z-ADDWWDAY     EXDLUP                          R01168
     C                     MOVE WWMNTH    EXMLUP                          R01168
     C                     Z-ADDWWYEAR    EXYLUP                          R01168
     C                     TIME           EXTLUP                          R01168
     C                     Z-ADDBJRDNB    EXORED                          R01168
     C**********           Z-ADDCCUS      EXCNUM                                       R01168 CSD027
     C                     MOVE CCUS      EXCNUM                                              CSD027
     C                     MOVELBBPCNB    EXPCNB                          R01168
     C                     MOVE '40'      EXREGE                          R01168
     C                     MOVELPDLOMG    EXLCGR                          R01168
     C                     Z-ADDGPLCGS    EXLCGS                          R01168
     C                     MOVELLBCUSI    EXINST                          R01168
     C                     MOVELCRCY      EXCCY                           R01168
     C                     MOVE 'C'       EXEXCO                          R01168
     C                     Z-ADDWWCOLR    EXAMNT                          R01168
     C                     Z-ADDCCOD      WWCOD                           R01168
     C                     Z-ADDCACS      WWSEQ                           R01168
     C                     Z-ADDCRAN      WWNO                            R01168
     C                     Z-ADD0         EXDDAT                          R01168
     C                     Z-ADD0         EXVDAT                          R01168
     C                     Z-ADD0         EXMDAT                          R01168
     C                     Z-ADD0         EXRLDT                          R01168
     C                     WRITELBEXCOPF                                  R01168
     C*                                                                   R01168
     C**  Add one to count of records written to LBEXCOPD                 R01168
     C*                                                                   R01168
     C                     ADD  1         RREXCO                          R01168
     C*                                                                   R01168
     C                     END                                            R01168
     C*                                                                   R01168
     C                     ENDSR                                          R01168
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #YA         - This subroutine processes a detail on regen.      *
     C**               report                                            *
     C**                                                                 *
     C** CALLS       - P01                                               *R01168
     C**                                                                 *
     C** CALLED BY   - #BA #BB #BC                                       *
     C**                                                                 *
     C********************************************************************
     C           #YA       BEGSR
     C*                                                                   S01498
     C**  Open LB0640P1.                                                  S01498
     C*                                                                   S01498
     C           *IN71     IFEQ '0'                                       S01498
     C                     OPEN LB0640P1                                  S01498
     C                     EXSR RCFP1                                     S01498
     C                     SETON                     71                   S01498
     C                     END                                            S01498
     C*
     C** If necessary write the correct header for the next page
     C*
     C***********LINE2     IFGT 55                                        S01498
     C           LINE1     IFGT 55                                        S01498
     C           *IN81     OREQ '0'                                       S01498
     C           WWDTYP    ANDEQ'AC'                                      S01498
     C           *IN82     OREQ '0'                                       S01498
     C           WWDTYP    ANDEQ'HD'                                      S01498
     C           *IN83     OREQ '0'                                       S01498
     C           WWDTYP    ANDEQ'DR'                                      S01498
     C           *IN83     OREQ '0'                                       S01498
     C           WWDTYP    ANDEQ'CR'                                      S01498
     C*
     C                     WRITEHEADER00
     C*
     C           WWDTYP    IFEQ 'AC'
     C                     WRITEHEADER01
     C                     MOVE '1'       *IN81                           S01498
     C                     ELSE
     C*
     C           WWDTYP    IFEQ 'HD'
     C                     WRITEHEADER02
     C                     MOVE '1'       *IN82                           S01498
     C                     ELSE
     C*
     C           WWDTYP    IFEQ 'DR'
     C           WWDTYP    OREQ 'CR'
     C                     WRITEHEADER03
     C                     MOVE '1'       *IN83                           S01498
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C** IF    Detail type is 'AC', write an Account detail
     C** ELSE IF Detail type is 'HD', write a Held Item detail
     C** ELSE IF Detail type is 'DR', write a Debit detail
     C** ELSE IF Detail type is 'CR', write a Credit detail
     C*
     C           WWDTYP    IFEQ 'AC'
     C*
     C                     MOVE CNUM      R0CNM1
     C                     MOVE ACACOD    R0ACOD
     C                     MOVE ACACSQ    R0SEQN
     C                     MOVE CCY       R0CCY1
     C                     MOVE A5INNR    R0INS1
     C*
     C                     Z-SUBCLBL      WWSTOR 150
     C                     Z-ADDWWSTOR    ZFLD15
     C                     Z-ADDWWDPI     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0BALN
     C*
     C                     Z-ADDWWEXPS    ZFLD15
     C                     Z-ADDWWDPO     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0EXP1
     C*
     C                     Z-ADDWWCOLR    ZFLD15
     C                     Z-ADDWWDPO     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0COL1
     C*
     C                     EXSR P01                                       R01168
     C*                                                                   R01168
     C                     WRITEDETAIL01
     C*
     C                     ELSE
     C*
     C           WWDTYP    IFEQ 'HD'
     C*
     C                     MOVE CNUM      R0CNM2
     C                     MOVE CCY       R0CCY2
     C***********          MOVE LBHELD    R0INS2                          S01498
     C                     MOVE LBHLDI    R0INS2                          S01498
     C*
     C                     Z-SUBHLDA      WWSTOR
     C                     Z-ADDWWSTOR    ZFLD15
     C                     Z-ADDWWDPI     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0HLDA
     C*
     C                     Z-ADDWWEXPS    ZFLD15
     C                     Z-ADDWWDPO     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0EXP2
     C*
     C                     EXSR P01                                       R01168
     C*                                                                   R01168
     C                     WRITEDETAIL02
     C*
     C                     ELSE
     C*
     C           WWDTYP    IFEQ 'DR'
     C*
     C                     MOVE DCUS      R0CNM3
     C                     MOVE DRCY      R0CCY3
     C                     MOVE LBCUSI    R0INS3
     C*
     C                     Z-SUBDRAM      WWSTOR
     C                     Z-ADDWWSTOR    ZFLD15
     C                     Z-ADDWWDPI     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0DEBA
     C                     MOVE *BLANKS   R0CRDA
     C*
     C                     Z-ADDWWEXPS    ZFLD15
     C                     Z-ADDWWDPO     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0EXP3
     C                     MOVE *BLANKS   R0COL3
     C*
     C                     EXSR P01                                       R01168
     C*                                                                   R01168
     C                     WRITEDETAIL03
     C*
     C                     ELSE
     C*
     C           WWDTYP    IFEQ 'CR'
     C*
     C                     MOVE CCUS      R0CNM3
     C                     MOVE CRCY      R0CCY3
     C                     MOVE LBCUSI    R0INS3
     C*
     C                     Z-SUBCRAM      WWSTOR
     C                     Z-ADDWWSTOR    ZFLD15
     C                     Z-ADDWWDPI     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0CRDA
     C                     MOVE *BLANKS   R0DEBA
     C*
     C                     Z-ADDWWCOLR    ZFLD15
     C                     Z-ADDWWDPO     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0COL3
     C                     MOVE *BLANKS   R0EXP3
     C*
     C                     EXSR P01                                       R01168
     C*                                                                   R01168
     C                     WRITEDETAIL03
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     Z-ADD0         WWEXPS
     C                     Z-ADD0         WWCOLR
     C                     MOVE 'Y'       WWDETR
     C                     MOVE 'Y'       WWDTRW
     C                     MOVEA'000'     *IN,60
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #YB         - This subroutine processes a total on regen.       *
     C**               report                                            *
     C**                                                                 *
     C** CALLS       - *NONE                                             *
     C**                                                                 *
     C** CALLED BY   - #BA #BB #BC                                       *
     C**                                                                 *
     C********************************************************************
     C           #YB       BEGSR
     C*
     C** If necessary write the correct header for the next page
     C*
     C***********LINE2     IFGT 55                                        S01498
     C           LINE1     IFGT 55                                        S01498
     C*
     C                     WRITEHEADER00
     C*
     C           WWDTYP    IFEQ 'AC'
     C                     WRITEHEADER01
     C                     ELSE
     C*
     C           WWDTYP    IFEQ 'HD'
     C                     WRITEHEADER02
     C                     ELSE
     C*
     C           WWDTYP    IFEQ 'DR'
     C           WWDTYP    OREQ 'CR'
     C                     WRITEHEADER03
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C** IF    Detail type is 'AC', write an Account total
     C** ELSE IF Detail type is 'HD', write a Held Item total
     C** ELSE IF Detail type is 'DR' or 'CR' write a Debit/Credit total
     C*
     C           WWDTYP    IFEQ 'AC'
     C*
     C                     Z-ADDWWEXPT    ZFLD15
     C                     Z-ADDWWDPO     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0EXT1
     C*
     C                     Z-ADDWWCOLT    ZFLD15
     C                     Z-ADDWWDPO     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0CLT1
     C*
     C***Calculate*borrowing*power                                        B4814
     C*
     C***        WWCOLT    MULT WWINPC    WWBPWR                          B4814
     C*
     C                     Z-ADDWWBPWR    ZFLD15
     C                     Z-ADDWWDPO     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0BPT1
     C*
     C                     WRITETOTAL01
     C                     MOVE '1'       *IN60
     C*
     C                     ELSE
     C*
     C           WWDTYP    IFEQ 'HD'
     C*
     C                     Z-ADDWWEXPT    ZFLD15
     C                     Z-ADDWWDPO     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0EXT2
     C*
     C                     WRITETOTAL02
     C                     MOVE '1'       *IN61
     C*
     C                     ELSE
     C*
     C           WWDTYP    IFEQ 'DR'
     C           WWDTYP    OREQ 'CR'
     C*
     C           WWDTYP    IFEQ 'DR'
     C*
     C                     Z-ADDWWEXPT    ZFLD15
     C                     Z-ADDWWDPO     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0EXT3
     C                     MOVE *BLANKS   R0COL3
     C                     MOVE *BLANKS   R0BPT3
     C*
     C                     ELSE
     C*
     C** Calculate borrowing power
     C*
     C           WWCOLT    MULT WWINPC    WWBPWR
     C*
     C                     MOVE *BLANKS   R0EXP3
     C*
     C                     Z-ADDWWCOLT    ZFLD15
     C                     Z-ADDWWDPO     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0COL3
     C*
     C                     Z-ADDWWBPWR    ZFLD15
     C                     Z-ADDWWDPO     ZDECS
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    R0BPT3
     C*
     C                     END
     C*
     C                     WRITETOTAL03
     C                     MOVE '1'       *IN62
     C*
     C                     END
     C*
     C                     END
     C*
     C                     END
     C*
     C                     Z-ADD0         WWEXPT
     C                     Z-ADD0         WWCOLT
     C                     Z-ADD0         WWBPWR
     C                     MOVE 'N'       WWDTRW
     C*
     C                     ENDSR
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** #ZA         - This subroutine processes database errors         *
     C**                                                                 *
     C** CALLS       - *NONE                                             *
     C**                                                                 *
     C** CALLED BY   - #A #C #BA #BAB #BB #BBB #BCA #BCAB #BCB #BCBB     *
     C**                                                                 *
     C********************************************************************
     C           #ZA       BEGSR
     C*
     C                     WRITEAUHEADER
     C                     WRITEAUDBERRO
     C***********          WRITEAUTRAILR                                  S01498
     C*                                                                   S01498
     C           *IN71     IFEQ '1'                                       S01498
     C                     WRITEDBERROR1                                  S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C           *IN72     IFEQ '1'                                       S01498
     C                     WRITEDBERROR2                                  S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     SETON                     U7U8LR
     C                     DUMP                                           S01498
     C                     RETRN
     C*
     C                     ENDSR
     C/EJECT
     C*
     C/COPY ZSRSRC,ZSEDITZ3
     C/EJECT
     C********************************************************************
     C**                                                                 *
     C** SCONV       - Convert an amount from one currency to another
     C**                                                                 *
     C** CALLS       - *NONE                                             *
     C**                                                                 *
     C** CALLED BY   - #BAA #BBA #BCAA #BCBA                             *
     C**                                                                 *
     C**  Input Fields - WWAMTI 15/0 amount in input currency            *
     C**                 WWSRI  13/8 spot rate for input currency        *
     C**                 WWSRO  13/8 spot rate for output currency       *
     C**                 WWDPI  1/0  no. of decimals for input currency  *
     C**                 WWDPO  1/0  no. of decimals for output currency *
     C**                 WWMDI  1    mult/div indicator for input curr.  *
     C**                 WWMDO  1    mult/div indicator for output curr. *
     C**                                                                 *
     C**  Arrays       - POWER  powers of 10                             *
     C**                                                                 *
     C**  Output Fields- WWAMTO 15/0 output amount converted to new curr *
     C**                                                                 *
     C********************************************************************
     C           SCONV     BEGSR                           **  SCONV    **
     C*
     C** DEFINE ALL FIELDS
     C                     Z-ADDWWAMTI    WWAMTI 150
     C                     Z-ADD0         WWAMTO 150
     C           *LIKE     DEFN A6SPRT    WWSRI
     C           *LIKE     DEFN A6SPRT    WWSRO
     C           *LIKE     DEFN A6NBDP    WWDPI
     C           *LIKE     DEFN A6NBDP    WWDPO
     C           *LIKE     DEFN A6MDIN    WWMDI
     C           *LIKE     DEFN A6MDIN    WWMDO
     C*
     C           WWDPO     SUB  WWDPI     Z       10
     C           Z         ADD  4         Z
     C*
     C           WWMDI     IFNE WWMDO
     C*
     C** MULT/DIV INDICATORS DIFFERENT
     C           WWSRI     MULT WWSRO     WWRATE 159H
     C                     ELSE
     C*
     C** MULT/DIV INDICATORS THE SAME
     C           WWSRO     IFEQ 0
     C                     GOTO SC0
     C                     END
     C           WWSRI     DIV  WWSRO     WWRATE    H
     C                     END
     C*
     C           WWMDI     IFEQ 'D'
     C           WWRATE    IFEQ 0
     C                     GOTO SC0
     C                     END
     C           POWER,Z   DIV  WWRATE    WWRATE    H
     C                     ELSE
     C           POWER,Z   MULT WWRATE    WWRATE    H
     C                     END
     C*
     C           WWAMTI    MULT WWRATE    WWAMTO    H
     C*
     C           SC0       ENDSR                           **  SC0      **
     C/EJECT
     C*****************************************************************   S01498
     C*                                                                   S01498
     C*  RCFP1 -- Subroutine to register P1 report via RCF                S01498
     C*                                                                   S01498
     C*****************************************************************   S01498
     C*                                                                   S01498
     C           RCFP1     BEGSR                            ** RCFP1 **   S01498
     C*                                                                   S01498
     C**  Ensure report spool file is recorded by RCF.                    S01498
     C*                                                                   S01498
     C                     Z-ADDSFNUM1    ZSNUM   60                      S01498
     C                     CALL 'ZSFILE'                                  S01498
     C                     PARM           SEQ     5                       S01498
     C                     PARM *BLANKS   @PARM   3                       S01498
     C                     PARM           SFILE1                          S01498
     C                     PARM           ZSNUM                           S01498
     C                     PARM           ZSERR   1                       S01498
     C*                                                                   S01498
     C**  Error during ZSFILE processing, return to calling program.      S01498
     C*                                                                   S01498
     C           ZSERR     IFEQ 'Y'                                       S01498
     C                     SETON                     U7U8LR               S01498
     C                     RETRN                                          S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     ENDSR                                          S01498
     C*                                                                   S01498
     C*****************************************************************   S01498
     C/EJECT                                                              S01498
     C*****************************************************************   S01498
     C*                                                                   S01498
     C*  RCFP2 -- Subroutine to register P2 report via RCF                S01498
     C*                                                                   S01498
     C*****************************************************************   S01498
     C*                                                                   S01498
     C           RCFP2     BEGSR                            ** RCFP2 **   S01498
     C*                                                                   S01498
     C**  Ensure report spool file is recorded by RCF.                    S01498
     C*                                                                   S01498
     C                     Z-ADDSFNUM2    ZSNUM                           S01498
     C                     CALL 'ZSFILE'                                  S01498
     C                     PARM           SEQ                             S01498
     C                     PARM *BLANKS   @PARM                           S01498
     C                     PARM           SFILE2                          S01498
     C                     PARM           ZSNUM                           S01498
     C                     PARM           ZSERR                           S01498
     C*                                                                   S01498
     C**  Error during ZSFILE processing, return to calling program.      S01498
     C*                                                                   S01498
     C           ZSERR     IFEQ 'Y'                                       S01498
     C                     SETON                     U7U8LR               S01498
     C                     RETRN                                          S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     ENDSR                                          S01498
     C*                                                                   S01498
     C*****************************************************************   S01498
     C/EJECT                                                              S01498
     C*****************************************************************   S01498
     C*                                                                   S01498
     C*  RCFAU -- Subroutine to register AU report via RCF                S01498
     C*                                                                   S01498
     C*****************************************************************   S01498
     C*                                                                   S01498
     C           RCFAU     BEGSR                            ** RCFAU **   S01498
     C*                                                                   S01498
     C**   Ensure audit spool file is recorded by RCF.                    S01498
     C*                                                                   S01498
     C                     Z-ADDSFNUMU    ZSNUMU  60                      S01498
     C                     CALL 'ZSFILE'                                  S01498
     C                     PARM           SEQ                             S01498
     C                     PARM *BLANKS   @PARM                           S01498
     C                     PARM           SFILEU                          S01498
     C                     PARM           ZSNUMU                          S01498
     C                     PARM           ZSERR                           S01498
     C*                                                                   S01498
     C**  Error during ZSFILE processing, return to calling program.      S01498
     C*                                                                   S01498
     C           ZSERR     IFEQ 'Y'                                       S01498
     C                     SETON                     U7U8LR               S01498
     C                     RETRN                                          S01498
     C                     END                                            S01498
     C*                                                                   S01498
     C                     ENDSR                                          S01498
     C*                                                                   S01498
     C*****************************************************************   S01498
     C/EJECT                                                              S01498
     C********************************************************************
     C**                                                                 *
     C** *PSSR       - This subroutine processes a program file error    *
     C**                                                                 *
     C** CALLS       - *NONE                                             *
     C**                                                                 *
     C** CALLED BY   - *NONE                                             *
     C**                                                                 *
     C********************************************************************
     C           *PSSR     BEGSR
     C*
     C                     DUMP
     C*
     C                     ENDSR
     C/EJECT
** CPY@ - Array for copyright statement
(c) Misys International Banking Systems Ltd. 2001
** POWER - Array of powers of 10 for currency conversion S/R SCONV
0000001
0000010
0000100
0001000
0010000
0100000
1000000
