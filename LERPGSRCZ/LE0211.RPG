     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Facility activity enquiry')                   *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE0211 - Facility Activity Enquiry                           *
      *                                                               *
      *  Function:  This will be a new enquiry to show a breakdown of *
      *  (IC)       the facility history by date.  It will record the *
      *             effects of facility amendments and show changes   *
      *             arising from manual facility utilisations.  It    *
      *             will provide similar functionality for facilities *
      *             that the loans activity enquiry provides for      *
      *             loans.                                            *
      *                                                               *
      *  Called By: LEC0306F - Facility Activity Enquiry              *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD047993           Date 23Sep17               *
      *  Prev Amend No. MD035545           Date 11Sep15               *
      *                 CGL184             Date 07Dec16               *
      *                 CLE154             Date 07Aug12               *
      *                 240697             Date 06Mar15               *
      *                 AR936915           Date 07Oct14               *
      *                 MD029661           Date 12Aug14               *
      *                 AR830785           Date 07May13               *
      *                 AR996895           Date 25Nov12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR787620           Date 10Jun11               *
      *                 CLE064             Date 06Dec10               *
      *                 AR674759           Date 05Jan10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG21833B          Date 11Feb09               *
      *                 BUG22349A          Date 06Feb09               *
      *                 BUG22375           Date 03Feb09               *
      *                 BUG22349           Date 28Jan09               *
      *                 BUG22126           Date 23Jan09               *
      *                 BUG21833A          Date 19Jan09               *
      *                 BUG21833           Date 08Jan09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 253715 (BUG17593)  Date 15Apr08               *
      *                 253809 (BUG17940)  Date 09Apr08               *
      *                 248167             Date 30May07               *
      *                 244511             Date 29May07               *
      *                 247937             Date 22May07               *
      *                 246141             Date 26Mar07               *
      *                 246233             Date 07Mar07               *
      *                 251034             Date 19Oct07               *
      *                 249836             Date 30Aug07               *
      *                 164847             Date 30Nov06               *
      *                 BUG13187           Date 05Feb07               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 241821             Date 22Aug06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG7847            Date 30Sep05               *
      *                 CLE042             Date 06Sep05               *
      *                 BUG8221            Date 22Aug05               *
      *                 CLE106             Date 17Mar05               *
      *                 BUG8261            Date 01Sep05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG4333            Date 27Sep04               *
      *                 CGL029             Date 01Sep03               *
      *                 CLE031             Date 25Mar03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 214897             Date 20Feb03               *
      *                 214838             Date 12Feb03               *
      *                 201127             Date 20Jan03               *
      *                 207963             Date 08Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 205543             Date 12Jun02               *
      *                 206328             Date 06Jun02               *
      *                 206187             Date 31May02               *
      *                 204479             Date 26Apr02               *
      *                 195865             Date 26Apr02               *
      *                 204441             Date 25Apr02               *
      *                 204433             Date 25Apr02               *
      *                 204383             Date 25Apr02               *
      *                 204669             Date 24Apr02               *
      *                 204795             Date 24Apr02               *
      *                 201909             Date 24Apr02               *
      *                 204304             Date 24Apr02               *
      *                 204026             Date 24Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CLE023             Date 19Nov01               *
      *                 194912             Date 19Nov01               *
      *                 199655             Date 03Jan02               *
      *                 189570             Date 18Oct01               *
      *                 190370             Date 16Oct01               *
      *                 189567             Date 16Oct01               *
      *                 189343             Date 11Sep01               *
      *                 192576             Date 03Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CLE014             Date 20Mar01               *
      *                 190634             Date 17Apr01               *
      *                 190124             Date 17Apr01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 189587             Date 27Feb01               *
      *                 188968             Date 22Jan01               *
      *                 187261             Date 16Jan01               *
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSD007             Date 28Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 176776             Date 18Apr00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 163331             Date 02Jul99               *
      *                 CLE009             Date 11May99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 162967             Date 25Jun99               *
      *                 161412             Date 02Jun99               *
      *                 157545             Date 23Mar99               *
      *                 147999             Date 10Mar99               *
      *                 157544 (BT0677)    Date 19Mar99               *
      *                 155749             Date 01Mar99               *
      *                 157214 (BT0525)    Date 16Mar99               *
      *                 157191 (BT0524)    Date 16Mar99               *
      *                 156226             Date 09Mar99               *
      *                 154245             Date 25Feb99               *
      *                 155459             Date 16Feb99               *
      *                 154114             Date 28Jan99               *
      *                 148725             Date 08Jan99               *
      *                 147488             Date 08Dec98               *
      *                 128980             Date 02Dec98               *
      *                 148722             Date 27Nov98               *
      *                 144088             Date 13Nov98               *
      *                 145826             Date 04Nov98               *
      *                 146108             Date 30Oct98               *
      *                 128979             Date 27Aug98               *
      *                 136624             Date 14Aug98               *
      *                 134808             Date 14Jul98               *
      *                 136628 (BT0835)    Date 10Jun98               *
      *                 127723             Date 26Nov97               *
      *                 127658             Date 25Nov97               *
      *                 CLE005 *Create     Date 22May97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  CLE154 - Loan Repayment Schedule Enhancement (Recompile)     *
      *  240697 - Recompiled due to changed LF/LEFCAML8.              *
      *  AR936915 - Syndicated facility filtered by From Date always  *
      *             shows Facility Start event in Facility Activity   *
      *             Enquiry. Prevent FS from being displayed when     *
      *             queried by date. Also, add parameter in LE0213 &  *
      *             LE0214 to pass new filename of LEFCENPD/LEFATRPD. *
      *             Correct placement of X/COPY WNCPYSRC,LEH00080 in  *
      *             order to compile. (Child: AR936917)               *
      *           - Applied for MD030660                              *
      *  MD029661 - Check SYIN as NE 'Y' intead of EQ 'N' since SYIN  *
      *             is blank if CLE006 is off.                        *
      *  AR830785 - Looping on insert of accrued interest adjustment  *
      *             Extended core fix 263533. (Child: AR830786)       *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,LEH00081                                 *
      *             WNCPYSRC,LEH00055                                 *
      *             WNCPYSRC,LEH00056                                 *
      *             WNCPYSRC,LEH00082                                 *
      *             WNCPYSRC,LEH00057                                 *
      *             WNCPYSRC,LEH00058                                 *
      *             WNCPYSRC,LEH00059                                 *
      *             WNCPYSRC,LEH00080                                 *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  AR674759 - Erroneous data in the Facility Activity Enquiry   *
      *             for the Prime Facility (Child: AR674760)          *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  BUG21833B - Errors in Facility Activity Enquiry (Reopened)   *
      *  BUG22349A - Original problem related to BUG21833             *
      *              Reverse BUG22349 and fix BUG21833 to             *
      *              correct the display of codes.                    *
      *  BUG22375  - Default Blank branch selection to 'ALL' to       *
      *              display all transactions related to a facility,  *
      *              including transactions booked to a different     *
      *              branch                                           *
      *  BUG22349  - Display code 'H' for records from FACHISA        *
      *  BUG22126  - Include Aggregate Facilities on Facility         *
      *              Activity Enquiry                                 *
      *  BUG21833A - Errors in Facility Activity Enquiry (Reopened)   *
      *  BUG21833 - Errors in Facility Activity Enquiry               *
      *  253715 - Transactions were not completely displayed upon     *
      *           initial enquiry on Facility Activity Enquiry.       *
      *           (BUG17593)                                          *
      *  253809 - Convert repayment amount to facility currency for   *
      *           loans where loan currency is not the same as the    *
      *           facility currency. (BUG17940)                       *
      *  248167 - FI narrative is missing on facility activity enquiry*
      *  244511 - Display correct narrative for past due, interest    *
      *           capitalisation, and charges.                        *
      *  247937 - Incorrect Facility Activity Enquiry for a multi-    *
      *           branch facility.                                    *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  246233 - Primary facility history is not consistent in       *
      *           display.  Included FIs of the participants on       *
      *           display.                                            *
      *  251034 - Narratives show "RC-Revolving Credit Change to X  Y"*
      *           and "TC-Facility Type Change to X  Y".              *
      *           The "X" should be replaced by "Y" or "N".           *
      *  249836 - Set principal amount properly for repayment type 1  *
      *           loans to properly project next repayment dates.     *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG13187 - Move correct currency to display correct maturity *
      *           - amount                                            *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  241821 - Change narrative of 'Loan for Fund Participant'     *
      *           to 'Loan for Participant'                           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG7847 - Discrepancy between the projected repayment in     *
      *            Facility activity equiry and the Loan Activity     *
      *            enquiry                                            *
      *  CLE042 - Extended Loan Sub Type                              *
      *  BUG8221- Narrative shows "RC-Revolving Credit Change toN".   *
      *           There's no space between to and N.                  *
      *  CLE106 - Nyndication Manager                                 *
      *  BUG8261 - Events without narrative but have a corresponding  *
      *            amount.                                            *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG4333- DBASE error 008 when enquiring a CA facility.       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CLE031 - Lending Enhancements.                               *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enahancements to CAS001, CAS002 and CAS004          *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  214897 - Amounts were wrongly converted. Only convert using  *
      *           UXRT rate from MFU file if action is an MFU.        *
      *  214838 - Change text on loan maturity where frequency        *
      *           repayments have been taken into account.            *
      *           Addition to 207963.                                 *
      *  201127 - Recompiled over changes to LE0211DF - show 'Start   *
      *           Date' rather than 'Date Approved'.                  *
      *  207963 - Include all of the repayment frequency in the       *
      *           projection of loan's maturity.                      *
      *           For loan amendments, if rept = '1' and RPSC, show   *
      *           the correct repayment amount (TAMT).                *
      *  205543 - Recompiled due to changed LF/LEFCAML8.              *
      *  206328 - Amounts are incorrect if loan currency has different*
      *           number of decimal places from Credit Agreement.     *
      *  206187 - Database error 008 when paging down, because CCY of *
      *           ST record (from FACHISA of Credit Agreement) was    *
      *           overwritten by loan ccy when SRFRMT executed twice. *
      *  204479 - Future-valued loans entered on prior to rundate are *
      *           not included in the enquiry.                        *
      *  195865 - Use Facility history's revolving credit indicator   *
      *           when processing 'RC' events from FACHISA.           *
      *  204441 - Projected maturity event being displayed after loan *
      *           has been reversed                                   *
      *  204433 - MFU entered and reversed on same date still shown   *
      *           on enquiry                                          *
      *  204383 - Proj freqency repayments not on enquiry.            *
      *  204669 - Display Past Due repayments of principal if code 'A'*
      *           or code 'P' is used to select records. Do not show  *
      *           maturity if it has gone past due.                   *
      *  204795 - Future valued repayment has been displayed prior to *
      *           the loans maturity date.  Recompiled due to change  *
      *           in LF/LEFCAML8.                                     *
      *  201909 - Do not report reversed Manual Utilisations or Loans.*
      *           If loan was reversed today, do not display any of   *
      *           its records from the facility history file.         *
      *  204304 - Reversed loan which started prior to today is still *
      *           shown on the enquiry.                               *
      *  204026 - Reversed Manual Utilisation should no longer be     *
      *           shown in the enquiry.                               *
      *  CLE023 - Lending Facility History Improvements.              *
      *  194912 - Change multi-ccy action from 'ST' to 'MC'           *
      *  199655 - Half adjust when converting to Credit Agreement ccy *
      *  189570 - Show all amounts in facility currency.              *
      *         - Prevent DB Error and correct amount calculations    *
      *           for Credit Agreements and MFUs.                     *
      *  190370 - Credit Agreement rate not taken into account. Use   *
      *           CAXR if TRCA is equal to 'CA'.                      *
      *  189567 - When displaying details of Loan Start/Repayments    *
      *           ensure the Facility exchange rate entered on the   *
      *           Loan (if entered) is used rather than the spot     *
      *           rate.                                              *
      *  189343 - Show future loan maturity and MFU expiry date.      *
      *  192576 - Future dated loan amendments appear with SCODE ='B' *
      *           when backvalued records enquired on. Addition to    *
      *           188968.                                             *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *           Applied part of fix of 189343                       *
      *  190634 - Loan Amend currency being overwritten by currency   *
      *           in PF/LEFCAMPD. Also M/C rollovered repayment       *
      *           amount being converted back to loan currency.       *
      *  190124 - Do not report reversed Manual Utilisations or Loans *
      *  189587 - Check for SYIN NE 'Y' because it is blank on        *
      *           FCLTYFM when CLE006 is OFF. Amendment to 162967.   *
      *  188968 - Ensure Value Date is shown correctly.               *
      *  187261 - Do not display fields linked to Syndications unless *
      *           CLE006 is switched on.                              *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  CSD007 - Customer Closing                                    *
      *  176776 - Recompile to incorporate changes to display file.   *
      *  163331 - Future dated utilisation start not showing if       *
      *           entered on the previous day.                        *
      *  CLE009 - LE I/C Swift Message Generation for Fees (Recompile)*
      *  162967 - Part solds are shown on screen for non syndicated   *
      *           facility when code is 'A'                           *
      *  161412 - 'A' code should be defaulted on screen the first    *
      *           time user enters the enquiry screen.                *
      *  157545 - Manual interest payment is shown on facility        *
      *           activity enquiry.                                   *
      *  147999 - Incorrect calculation of amounts to facility ccy    *
      *  157544 - Narrative not set up for Principal Transfers        *
      *  155749 - The utilisations and the remaining availability     *
      *           of the facility does not reconcile.                 *
      *  157214 - (BT0525) Manual facility utilization missing        *
      *  157191 - (BT0524)Future-dated loan amendment activity missing*
      *  156226 - 'ALL' for branch field should also be accepted.     *
      *  154245 - Revolving Credit changes to facility not working    *
      *           properly.  Recompiled.                              *
      *  155459 - Incorrect calculation of amounts when facility ccy  *
      *           is not equal to the action/loan ccy.                *
      *  154114 - Fee activity should show input immediately.         *
      *           Recompiled due to change in LEFCAML8.               *
      *  148725 - Spread rate change amendment for loan shows blank   *
      *           enquiry.  Recompiled due to change in LEFCAML8.     *
      *  147488 - Difficulty in distinguishing a prime and a          *
      *           participant facility on Facility Activity Enquiry   *
      *  128980 - Tranche does not show historic details of           *
      *           participant transactions                            *
      *  148722 - Manual utilisation records read from LEMNFUPD       *
      *           not picking up correct narrative.                   *
      *  144088 - No parts sold loan is shown when funding part       *
      *           facility is being accessed. Also, internal facility *
      *           shows no details of the internal parts purchased.   *
      *  145826 - Midas availability and exposure is wrong on         *
      *           Credit agreements.                                  *
      *  146108 - Amend fix no 136624 so that loan number is          *
      *           correct for chain to CLOAN.                         *
      *  128979 - Loan in Swiss Francs is shown as a US Dollar        *
      *           utilisation                                         *
      *  136624 - Change Narrative of 'ST' depending on the value of  *
      *           LPFI field.                                         *
      *  134808 - History of Facility Manual Utilization shows same   *
      *           narrative for all utilizations.                     *
      *  136628 - Narrative not set up for Manual Repayments          *
      *  127723 - Missing facility type change, closure and expiry    *
      *  127658 - Misleading/Incorrect narrative to display           *
      *  CLE005 - Customer Lending Enhancements - Others (T3)         *
      *                                                               *
      *****************************************************************
      /EJECT
     FFCLTY   IF  E           K        DISK
     FLEFCAML8IF  E           K        DISK         KINFDS FSDS
     FLEFCAMLAIF  E           K        DISK                               CLE014
     F            LOAMSDKF                          KRENAMELOAMSDLA       CLE014
     FLEMNFUL7IF  E           K        DISK                                                   189343
     F            LEMNFUPF                          KRENAMELEMNUPLJ                           189343
     FLEFCENL0IF  E           K        DISK                           UC  128980
     FLEFATRL0IF  E           K        DISK                           UC                      189343
     FLEFCLTL4IF  E           K        DISK                               147488
     F            FCLTYFMF                          KRENAMELEFCLT4        147488
     FCLOAN   IF  E           K        DISK                               136624
     F            CLOANHHF                          KIGNORE               136624
     F            CLOANCKF                          KIGNORE               136624
     F            CLOANCLF                          KRENAMECLONF          136624
     F            CLOANZ1F                          KIGNORE               136624
     FMLOAN   IF  E           K        DISK                               136624
     F            CLOANHHF                          KIGNORE               136624
     F            CLOANZ1F                          KIGNORE               136624
     F            CLOANCKF                          KIGNORE               136624
     F            CLOANCLF                          KRENAMEMCLONCLF       136624
     FHISLAML0IF  E           K        DISK                               CLE014
     F            LOAMSDKF                          KRENAMELOAMS211       CLE014
     FLEMNFUL0IF  E           K        DISK                                                   189570
     F            LEMNFUPF                          KRENAMELEMNFULF                           189570
     FLE0211DFCF  E                    WORKSTN
     F                                        SRRN  KSFILE LE0211S0
     F/COPY WNCPYSRC,LEH00081
      /SPACE 3
      *****************************************************************
      *                                                               *
      *    F U N C T I O N   O F   I N D I C A T O R S                *
      *                                                               *
      *   03  - End of file LF/LEMNFUL0                               *                       204026
      *   06  - End of file LF/LEFCAMLA                               *   CLE014
      *   07  - Utilisation record from LEFCENL0                      *                       189343
      *   08  - RE record from history, skip INT computation          *   CLE014
      *   09  - Record not found in LEMNFUL7                          *                       189343
      *    20           Valid Facility                                *
      *****21**         Credit Agreement                              *                     BUG22126
      *    22           Rollup is pressed                             *
      *    23           Display Subfile Control                       *
      *    24           Display Subfile Record                        *
      *    25           Subfile End                                   *
      *                                                               *
      *    26           Error on Branch                               *
      *    27           Error on Customer                             *
      *    28           Error on Facility                             *
      *    29           Error on From Date                            *
      *    30           Error on Code                                 *
      *    31           Credit Agreement                              *                     BUG22126
      *    40           Reversed loan                                 *                       201909
      *    50           Record in CLOANCL                             *                     BUG21833
      *    51           Aggregate Facility                            *                     BUG22126
      *                                                               *
      *    80           End-Of-File                                   *
      *                                                               *
      *****************************************************************
      /EJECT
     E                    CPY@    1   1 80
      ** Array containing Copyright statement
      *
     E**********          PSDU      150  6 0             Past Due maturity             204669 CLE148
     E                    PSDU      150  6                                                    CLE148
     E                    POWR    1   7  7 3             Powers of Ten    128979
     E***********         ATP@    1  16 33                                127723
     E***********         ATP@    1  19 33                         127723 157544
     E***********         ATP@    1  19 36                         157544 136628
     E***********         ATP@    1  22 36                         136628 134808
     E***********         ATP@    1  24 36                         134808 136624
     E***********         ATP@    1  25 36                         136624 146108
     E**********          ATP@    1  26 36                                             146108 189343
     E**********          ATP@    1  28 36                                             189343 194912
     E**********          ATP@    1  29 36                                             194912 CLE023
     E**********          ATP@    1  30 36                                             CLE023 CLE031
     E**********          ATP@    1  31 36                                             CLE031 204669
     E**********          ATP@    1  32 36                                             204669 CLE028
     E**********          ATP@    1  34 36                                            CLE028 BUG8261
     E**********          ATP@    1  49 41                                            BUG8261 CLE106
     E**********          ATP@    1  50 41                                             CLE106 246233
     E/COPY WNCPYSRC,LEH00055
     E**********          ATP@    1  55 41                                             246233 CLE148
     E                    ATP@    1  56 41                                                    CLE148
     E/COPY WNCPYSRC,LEH00056
      ** Array containing Narrative
      *
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZFRPEDZ1
     E/COPY ZSRSRC,ZDATE9Z1                                               CLE014
     E/COPY ZSRSRC,ZFREQBZ1                                                                   207963
     E/COPY ZSRSRC,ZHOLE                                                                      207963
      /SPACE 3
     ILEMNFUPF                                                            190124
     I              RECI                            RECIBG                190124
     ILEMNFUPE                                                                                204433
     I              RECI                            RECIED                                    204433
     ICLOANCL1                                                            190124
     I              RECI                            RECIC1                190124
     ICLOANCL2                                                            190124
     I              RECI                            RECIC2                190124
     ICLOANCL3                                                                                204441
     I              RECI                            RECIC3                                    204441
     ICLOANCL5                                                                                204441
     I              RECI                            RECIC5                                    204441
     ILOAMSDKF                                                            188968
     I              VDAT                            VALDT                 188968
     IHISTSHMF                                                            CLE014
      ** Rename history header fields                                     CLE014
      *                                                                   CLE014
     I              BRCA                            BRCAHL                CLE014
     I              CNUM                            CNUMHL                CLE014
     I              LNRF                            LNRFHL                CLE014
     I              VDAT                            VDATHL                CLE014
     I              AMTP                            AMTPHL                CLE014
     I              PRAM                            PRAMHL                CLE014
     I              BRTT                            BRTTHL                CLE014
     I              BRTE                            BRTEHL                CLE014
     I              RTSP                            RTSPHL                CLE014
     I              SPIN                            SPINHL                CLE014
     I              REPT                            REPTHL                CLE014
     I              INTC                            INTCHL                CLE014
     I              SUTP                            SUTPHL                CLE014
     I              LCD                             LCDHL                 CLE014
     I              CPAM                            CPAMHL                CLE014
     I              AITC                            AITCHL                CLE014
     I              INTR                            INTRHL                CLE014
     I              AIAP                            AIAPHL                CLE014
     I              IPRD                            IPRDHL                CLE014
     I              WTIN                            WTINHL                CLE014
     I              TOTI                            TOTIHL                CLE014
     I              CALC                            CALCHL                CLE014
     I              CLAS                            CLASHL                                    CLE042
      *                                                                   CLE014
     IHISTSHPF                                                            CLE014
      ** Rename history amount fields                                     CLE014
      *                                                                   CLE014
     I              BRCA                            BRCAHL                CLE014
     I              CNUM                            CNUMHL                CLE014
     I              LNRF                            LNRFHL                CLE014
     I              VDAT                            VDATHL                CLE014
     I              AMTP                            AMTPHL                CLE014
     I              PRAM                            PRAMHL                CLE014
     I              INTA                            INTAHL                CLE014
     I              WTXA                            WTXAHL                CLE014
     I              FEAM                            FEAMHL                CLE014
     I              WOIN                            WOINHL                CLE014
     I              SUTP                            SUTPHL                CLE014
     I              LCD                             LCDHL                 CLE014
     I              CPAM                            CPAMHL                CLE014
     I              AITC                            AITCHL                CLE014
     I              INTR                            INTRHL                CLE014
     I              AIAP                            AIAPHL                CLE014
     I              IPRD                            IPRDHL                CLE014
     I              MNSG                            MNSGHL                CLE014
     I              GASS                            GASSHL                CLE014
     I              ROLN                            ROLNHL                CLE014
     I              CLAS                            CLASHL                                    CLE042
      *                                                                   CLE014
     IHISTSHQF                                                            CLE014
      ** Rename history rate fields                                       CLE014
      *                                                                   CLE014
     I              BRCA                            BRCAHL                CLE014
     I              CNUM                            CNUMHL                CLE014
     I              LNRF                            LNRFHL                CLE014
     I              VDAT                            VDATHL                CLE014
     I              CCY                             CCYHL                 CLE014
     I              AMTP                            AMTPHL                CLE014
     I              BRTT                            BRTTHL                CLE014
     I              BRTE                            BRTEHL                CLE014
     I              RTSP                            RTSPHL                CLE014
     I              SPIN                            SPINHL                CLE014
     I              STAI                            STAIHL                CLE014
     I              IRCF                            IRCFHL                CLE014
     I              LCD                             LCDHL                 CLE014
     I              CPAM                            CPAMHL                CLE014
     I              AITC                            AITCHL                CLE014
     I              INTR                            INTRHL                CLE014
     I              AIAP                            AIAPHL                CLE014
     I              IPRD                            IPRDHL                CLE014
     I              MNSG                            MNSGHL                CLE014
     I              RLCY                            RLCYHL                CLE014
     I              CALC                            CALCHL                CLE014
      *                                                                   CLE014
     ILOAMS211                                                            CLE014
      ** Rename fields of LOAMSDK from LF/HISLAML0                        CLE014
      *                                                                   CLE014
     I              BRCA                            BRCAHL                CLE014
     I              CNUM                            CNUMHL                CLE014
     I              LNRF                            LNRFHL                CLE014
     I              VDAT                            VDATHL                CLE014
     I              AMTP                            AMTPHL                CLE014
     I              BRTT                            BRTTHL                CLE014
     I              RTSP                            RTSPHL                CLE014
     I              CCY                             CCYHL                 CLE014
     I              PRAM                            PRAMHL                CLE014
     I              INTA                            INTAHL                CLE014
     I              TAMT                            TAMTHL                CLE014
     I              STAI                            STAIHL                CLE014
     I              LCD                             LCDHL                 CLE014
     I              CHTP                            CHTPHL                CLE014
     I              REPT                            REPTHL                CLE014
     I              GASS                            GASSHL                CLE014
      *                                                                   CLE014
     ILOAMSDLA                                                            CLE014
      ** Rename Loan Amendments file from LF/LEFCAMLA                     CLE014
      *                                                                   CLE014
     I              BRCA                            BRCALA                CLE014
     I              FCUS                            FCUSLA                CLE014
     I              FTYP                            FTYPLA                CLE014
     I              FSEQ                            FSEQLA                CLE014
     I              LNRF                            LNRFLA                CLE014
     I              VDAT                            VDATLA                CLE014
     I              AMTP                            AMTPLA                CLE014
     I              CCY                             CCYLA                 CLE014
      *                                                                                       189343
     ILEMNUPLJ                                                                                189343
      ** Rename LEMNUPLJ fields from LF/LEMNFUL7                                              189343
      *                                                                                       189343
     I              RECI                            RECILJ                                    189343
     I              BRCA                            BRCALJ                                    189343
     I              CNUM                            CNUMLJ                                    189343
     I              FACT                            FACTLJ                                    189343
     I              FCNO                            FCNOLJ                                    189343
     I              SQNO                            SQNOLJ                                    189343
     I              STDT                            STDTLJ                                    189343
     I              EXDT                            EXDTLJ                                    189343
      *
     ILEMNFULF                                                                                204026
     I              RECI                            RECI11                                    204026
     I              BRCA                            BRCA11                                    204026
     I              CNUM                            CNUM11                                    204026
     I              FACT                            FACT11                                    204026
     I              FCNO                            FCNO11                                    204026
     I              SQNO                            SQNO11                                    204026
     I              STDT                            STDT11                                    204026
     I              UCCY                            UCCY11                                    204026
     I              UAMT                            UAMT11                                    204026
     I              UNAR                            UNAR11                                    204026
     I              USTS                            USTS11                                    204026
     I              ORED                            ORED11                                    204026
     I              CHTP                            CHTP11                                    204026
     I              PUAM                            PUAM11                                    204026
     I/COPY WNCPYSRC,LEH00082
      *                                                                                       189343
      ** Rename field in LEFCLTL4                                                           AR674759
      *                                                                                     AR674759
     ILEFCLT4                                                                               AR674759
     I              FAMT                            FAMTL4                                  AR674759
      *                                                                                     AR674759
     ILDA       E DSLDA                         256
      ** Local data area for database error details
      ** *LOCK IN LDA immediately before and OUT LDA immediately
      ** after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
      *
     IRUNDAT    E DSRUNDAT
      ** Data Area giving Installation Control Details
      *
     IPSDS       SDS
      ** Program Status Data Structure
      *
     I                                     *PROGRAM SPGM
     I                                      244 253 WSID
     I                                      254 263 USER
      *
     IFSDS        DS
      ** File Status Data Structure
      *
     I                                     *RECORD  FREC
      *                                                                   156226
     IZMUSER      DS                             17                       156226
      ** Data area of menu user                                           156226
      *                                                                   156226
     I                                       11  13 DFTBRA                156226
     I                                       17  17 BNKAUT                156226
      *                                                                   CLE014
     I              '(Weekly)'            C         WWEEK                 CLE014
     I              '(Fortnightly)'       C         WFNIGT                CLE014
     I              '(Monthly)'           C         WMNTH                 CLE014
     I              '(Two-monthly)'       C         W2MNTH                CLE014
     I              '(Quarterly)'         C         WQUAR                 CLE014
     I              '(Six-monthly)'       C         W6MNTH                CLE014
     I              '(Yearly)'            C         WYEAR                 CLE014
     I**********    '(ex-freq repay)'     C         WEXREP                             CLE014 214838
     I              '(inc freq repay)'    C         WEXREP                                    214838
      *
     ILEFRBS      DS                       9999                           CLE014
     I**********                              1   60WRLNRF                             CLE014 CLE148
     I                                        1   6 WRLNRF                                    CLE148
     I                                    P   7  130WRRAMT                CLE014
      *                                                                   CLE014
     ISDBANK    E DSSDBANKPD
      ** Data Structure for Bank Details
      *
     ISDBRCH    E DSSDBRCHPD
      ** Data Structure for Branch Details
      *
     ISDCUST    E DSSDCUSTPD
     I              QQDFAC                          DFAC01                                    CGL029
      ** Data Structure for Customer Details
      *
     ISDCURR    E DSSDCURRPD
      ** Data Structure for Currency Details
      *
     ISCSARD    E DSSCSARDPD                                              CSD007
      ** SAR file details accessed via access program AOSARDR0            CSD007
     I              LCD                             LCDX                  187261
      *                                                                   CSD007
     IDSFDY     E DSDSFDY
      ** Short data structure for Access Objects
      *
     IDSSDY     E DSDSSDY
      ** Long data structure for Access Objects
      *
     IDSLDY     E DSDSLDY                                                 CSD007
      ** Third DS for access programs, very long data structure           CSD007
      *                                                                   CSD007
     ISDGELR    E DSSDGELRPD                                                                  207963
      **  External DS for general ledger details                                              207963
     I/COPY WNCPYSRC,LEH00918
      *                                                                                       207963
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I/COPY ZSRSRC,ZFRPEDZ2
     I/COPY ZSRSRC,ZINTDYZ1                                               CLE014
     I/COPY ZSRSRC,ZDATE9Z2                                               CLE014
     I/COPY ZSRSRC,ZDAT10Z1                                               CLE014
     I/COPY ZSRSRC,ZHOLI                                                                      207963
      /EJECT
      *****************************************************************
      *                                                               *
      *                   Index to subroutines                        *
      *                                                               *
      *  Main Processing                                              *
      *  SRINIT  -  Initial Processing                                *
      *  SRVALD  -  Validate Subfile Control                          *
      *  SRSPRC  -  Subfile Processing                                *
      *  SRSFIL  -  Fill Subfile Page                                 *
      *  SRFRMT  -  Format Subfile record                             *
      *  SRCLRS  -  Clears the subfile message queue                  *
      *  *PSSR   -  Error handling subroutine                         *
      *                                                               *
      *  ZASNMS  -  Sends messages to the program's message queue     *
      *  ZDATE1  -  Validate & cvt date to a day nbr                  *
      *  ZDATE2  -  Convert day number to a date                      *
      *  ZFRPED  -  Edit Amount                                       *
      *                                                               *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  Main Processing                                              *
      *                                                               *
      *****************************************************************
      *
      ** Initial processing
      *
     C                     EXSR SRINIT
      *
      ** Write Heading
      *
     C                     WRITELE0211F0
      *
      ** Clear the subfile
      *
     C                     MOVEA'00'      *IN,23
     C                     WRITELE0211C0
      *
     C                     MOVEA'100101'  *IN,20
     C                     MOVE '0'       *IN31                           127658
     C                     EXFMTLE0211C0
      *
      ** Do while not F3
      *
     C           *INKC     DOWEQ*OFF
      *
      ** Write Heading
      *
     C                     WRITELE0211F0
      *
      ** Clear the subfile
      *
     C                     MOVEA'00'      *IN,23
     C                     WRITELE0211C0
      *
      ** Reset error indicators
      *
     C                     MOVEL*BLANKS   WLE213  1                       128980
     C                     MOVEL*BLANKS   WLE214  1                                         BUG22126
     C                     Z-ADD*ZERO     SRRN    40
     C                     Z-ADD0         X       30                                          204669
     C                     Z-ADD0         Y       30                                          204669
     C                     MOVEA'00'      *IN,20
     C                     MOVEA'10'      *IN,23
     C***********          MOVEA'00000'   *IN,26                          127658
     C                     MOVEA'000000'  *IN,26                          127658
     C                     MOVE '0'       *IN41                                               189570
     C                     MOVE *OFF      *IN51                                             BUG22126
     C                     EXSR SRCLRS
     C                     MOVE 'N'       FSTRT   1                                         BUG21833
      *
      ** Validate subfile control record
      *
     C                     EXSR SRVALD
     C/COPY WNCPYSRC,LEH00919
      *
      ** If error/s exist
      *
     C           *IN20     IFEQ *ON
      *
      ** Display error message
      *
     C                     WRITELE0211C1
     C                     EXFMTLE0211C0
     C                     ELSE
      *
      ** Perform subfile processing
      *
     C                     EXSR SRSPRC
      *                                                                   128980
     C           WLE213    IFEQ 'Y'                                       128980
     C           WLE214    OREQ 'Y'                                                         BUG22126
     C                     CLOSELEFCENL0                                  128980
     C                     CLOSELEFATRL0                                                      189343
     C                     ENDIF                                          128980
      *                                                                   128980
     C                     ENDIF
      *
     C                     ENDDO
      *
      ** End program
      *
     C                     MOVE *ON       *INLR
     C                     RETRN
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRINIT  -  Initial Processing                                *
      *                                                               *
      *  Called by: Main processing                                   *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRINIT    BEGSR
      *                                                                                     AR936915
     C           *ENTRY    PLIST                                                            AR936915
     C                     PARM           NEWPF1 10                                         AR936915
     C                     PARM           NEWPF2 10                                         AR936915
      *
      ** Set up copyright array
      *
     C                     MOVEACPY@      CPY2@  80
      *
      ** Key fields for FCLTY
      *
     C           FCLKY     KLIST
     C**********           KFLD           WCNUM   60                                          CSD027
     C                     KFLD           WCNUM   6                                           CSD027
     C                     KFLD           WFACT   30
     C                     KFLD           WFCNO   20
     C                     KFLD           WRCDT   1
      *
      ** Key fields for LEFCAML8
      *
     C           CAMKY     KLIST
     C***********          KFLD           WBRCA   3                       156226
     C**********           KFLD           WCNUM   60                                          CSD027
     C                     KFLD           WCNUM   6                                           CSD027
     C                     KFLD           WFCTY   50
      *                                                                   147488
      ** Key fields for LEFCLTL4                                          147488
      *                                                                   147488
     C           WPTKY     KLIST                                          147488
     C                     KFLD           WCNUM                           147488
     C                     KFLD           WFACT                           147488
     C                     KFLD           WFCNO                           147488
      *                                                                   CLE014
      ** Key list for HISLAML0                                            CLE014
      *                                                                   CLE014
     C           KEYH      KLIST                                          CLE014
     C                     KFLD           BRCA                            CLE014
     C                     KFLD           CNUM                            CLE014
     C                     KFLD           LNRF                            CLE014
      *                                                                                       204026
     C           WLEM11    KLIST                                                              204026
     C                     KFLD           WBRCA                                               204026
     C                     KFLD           WCNUM                                               204026
     C                     KFLD           WFACT                                               204026
     C                     KFLD           WFCNO                                               204026
     C                     KFLD           WSQNO                                               204026
      *                                                                                       189343
      ** Key list for LEFATRL0                                                                189343
      *                                                                                       189343
     C           WLEF      KLIST                                                              189343
     C                     KFLD           TRCNUM                                              189343
     C                     KFLD           TRFACT                                              189343
     C                     KFLD           TRFCNO                                              189343
     C                     KFLD           TRSTDT                                              189343
     C                     KFLD           TRTSEQ                                              189343
      *                                                                                       189343
      ** Key list for LF/LEMNFUL7                                                             189343
      *                                                                                       189343
     C           WLEMN     KLIST                                                              189343
     C                     KFLD           WBRCA                                               189343
     C                     KFLD           WCNUM                                               189343
     C                     KFLD           WFACT                                               189343
     C                     KFLD           WFCNO                                               189343
     C                     KFLD           PDATE                                               189343
     C                     KFLD           PSEQ                                                189343
      *
      ** Read in Installation Data
      ** &ZMUSER                                                          156226
      *
     C           *NAMVAR   DEFN           RUNDAT
     C           *NAMVAR   DEFN           LDA
     C           *NAMVAR   DEFN           ZMUSER                          156226
     C                     IN   RUNDAT
     C                     IN   ZMUSER                                    156226
      *
      ** Set Date Format Indicator *IN98  on if date format is MMDDYY
      *
     C           AGDFF     IFEQ 'M'
     C                     MOVE *ON       *IN98
     C                     END
      *
      ** Access and update LDA
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0211'  DBPGM
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZERO     DBASE
     C                     OUT  LDA
      *
      ** Access Bank details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*FIRST'  POPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
      ** Data base error in file SDBANKPD
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD01        DBASE            *************
     C                     MOVEL'SDBANKPD'DBFILE           * DB ERR 01 *
     C                     MOVEL'*FIRST'  DBKEY            *************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                                       207963
     C           BJDFIN    IFEQ 'M'                                                           207963
     C                     MOVEL'1'       *IN98                                               207963
     C                     ENDIF                                                              207963
      *                                                                   CSD007
      ** Access SAR details file to check if 'Customer closing' is        CSD007
      ** installed.                                                       CSD007
      *                                                                   CSD007
     C                     CALL 'AOSARDR0'                                CSD007
     C                     PARM *BLANKS   PRTCD                           CSD007
     C                     PARM '*VERIFY' POPTN                           CSD007
     C                     PARM 'CSD007'  PSARD   6                       CSD007
     C           SCSARD    PARM SCSARD    DSFDY                           CSD007
      *                                                                   CSD007
     C           PRTCD     IFNE *BLANKS                                   CSD007
     C           PRTCD     ANDNE'*NRF   '                                 CSD007
     C                     MOVEL'SCSARDPD'DBFILE                          CSD007
     C                     MOVEL'CSD007'  DBKEY                           CSD007
     C                     Z-ADD11        DBASE                           CSD007
     C                     EXSR *PSSR                                     CSD007
     C                     ENDIF                                          CSD007
      *                                                                   CSD007
     C           PRTCD     IFEQ *BLANKS                                   CSD007
     C                     MOVE 'Y'       CSD007  1                       CSD007
     C                     ELSE                                           CSD007
     C                     MOVE 'N'       CSD007                          CSD007
     C                     ENDIF                                          CSD007
      *                                                                   187261
      ** Determine if Customer Lending Enhancements - Syndications        187261
      ** feature is installed - CLE006                                    187261
      *                                                                   187261
     C                     CALL 'AOSARDR0'                                187261
     C                     PARM *BLANKS   PRTCD                           187261
     C                     PARM '*KEY   ' POPTN                           187261
     C                     PARM 'CLE006'  PSARD   6                       187261
     C           SCSARD    PARM SCSARD    DSFDY                           187261
     C           PRTCD     IFEQ *BLANKS                                   187261
     C                     MOVE 'Y'       CLE006  1                       187261
     C                     MOVE *ON       *IN14                           187261
     C                     ELSE                                           187261
     C                     MOVE 'N'       CLE006                          187261
     C                     MOVE *OFF      *IN14                           187261
     C           PRTCD     IFNE '*NRF    '                                187261
     C           *LOCK     IN   LDA                                       187261
     C                     MOVEL'SCSARDPD'DBFILE           ************   187261
     C                     Z-ADD14        DBASE            * DBERR 14 *   187261
     C                     MOVEL'CLE006'  DBKEY            ************   187261
     C                     OUT  LDA                                       187261
     C                     EXSR *PSSR                                     187261
     C                     ENDIF                                          187261
     C                     ENDIF                                          187261
      *                                                                   CLE014
      ** Determine if CLE014 is installed                                 CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM '       ' PRTCD                           CLE014
     C                     PARM '*VERIFY' POPTN                           CLE014
     C                     PARM 'CLE014'  PSARD                           CLE014
     C           SCSARD    PARM SCSARD    DSSDY                           CLE014
      *                                                                   CLE014
      ** Handle Database Error                                            CLE014
      *                                                                   CLE014
     C           PRTCD     IFNE *BLANKS                                   CLE014
     C           PRTCD     ANDNE'*NRF   '                                 CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVE 'SCSARDPD'DBFILE                          CLE014
     C                     MOVELPSARD     DBKEY                           CLE014
     C                     Z-ADD12        DBASE                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** CLE014 is installed                                              CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       CLE028
      ** Check whether SAR CLE028 is installed or not                                         CLE028
      *                                                                                       CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM *BLANK    PRTCD                                               CLE028
     C                     PARM '*VERIFY' POPTN                                               CLE028
     C                     PARM 'CLE028'  PSARD                                               CLE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE028
      *                                                                                       CLE028
     C           PRTCD     IFEQ *BLANK                                                        CLE028
     C                     MOVE 'Y'       CLE028  1                                           CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE 'N'       CLE028                                              CLE028
     C           PRTCD     IFNE '*NRF   '                                                     CLE028
     C           *LOCK     IN   LDA                                                           CLE028
     C                     MOVEL'LE0212  'DBPGM     P                                         CLE028
     C                     MOVEL'SCSARDPD'DBFILE    P                                         CLE028
     C                     MOVEL'CLE028'  DBKEY     P                                         CLE028
     C                     Z-ADD15        DBASE                                               CLE028
     C                     OUT  LDA                                                           CLE028
     C                     EXSR *PSSR                                                         CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *****************************************************************            MD035545 MD047993
      ***Access*general*ledger*details.********************************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*MSG   ' @RTCD   7                                MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN   7                                MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
      ** Retrieve system value setting.                                                     MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   @RTCD                                             MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'.                            MD035545
      *                                                                                     MD035545
     C           @RTCD     IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
     C/COPY WNCPYSRC,LEH00057
      *
      ** Initialise Header format
      *
     C                     MOVELUSER      SUSER
     C                     MOVELBJMRDT    SRUNA
     C                     MOVELWSID      SWSID
      *
     C                     MOVEL'LERMSGF 'ZAMSGF
     C                     MOVELSPGM      ZAPGMQ
      *                                                                   161412
     C                     MOVE 'A'       SSCODE                          161412
      *
     C                     MOVE *BLANKS   WPBRCA  3                                          BUG7847
     C                     MOVE *BLANKS   WPCUST 10                                          BUG7847
     C                     MOVE *BLANKS   WPFACT  3                                          BUG7847
     C                     MOVE *BLANKS   WPFCNO  2                                          BUG7847
     C                     MOVE *BLANKS   WPVLDT  6                                          BUG7847
     C                     MOVE *BLANKS   WPCODE  1                                          BUG7847
     C                     MOVE *BLANKS   WPNRPD  1                                          BUG7847
     C                     Z-ADD*ZERO     WREPT   10                                         BUG7847
     C                     Z-ADD*ZERO     WDAYNO  50                                         BUG7847
     C                     MOVE 'N'       WCHGIN  1                                          BUG7847
     C                     MOVE 'N'       WEXTLP  1                                          BUG7847
      *                                                                                      BUG7847
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRVALD  -  Validate Subfile Control                          *
      *                                                               *
      *  Called by: Main processing                                   *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRVALD    BEGSR
      *                                                                                       189570
     C                     MOVEL*BLANKS   TRCAX                                               189570
      *
      ** Validate Branch
      *
     C           SSBRCA    IFNE *BLANKS
     C           SSBRCA    ANDNE'ALL'                                     156226
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*KEY    'POPTN   7
     C                     PARM SSBRCA    PBRCD   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *
     C           PRTCD     IFNE *BLANK
     C                     MOVE *ON       *IN26
     C                     MOVEL'LEF0258' ZAMSID
     C                     EXSR ZASNMS
      *
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SSBRCA
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVE *BLANKS   SSBRCA
     C                     MOVELA8BRCD    SSBRCA
     C                     ENDIF
      *
     C                     ELSE                                                             BUG22375
     C           SSBRCA    IFEQ *BLANKS                                                     BUG22375
     C                     MOVEL'ALL'     SSBRCA                                            BUG22375
     C                     ENDIF                                                            BUG22375
     C                     ENDIF
      *
      ** Validate Customer number/shortname
      *
     C***********          CALL 'AOCUSTR0'                                CSD007
     C                     CALL 'AOCUSTR2'                                CSD007
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*KEY    'POPTN   7
     C                     PARM SSCUST    PKEY1  10
     C                     PARM           PKYST   7
     C***********SDCUST    PARM SDCUST    DSSDY                           CSD007
     C           SDCUST    PARM SDCUST    DSLDY                           CSD007
      *
     C           PRTCD     IFNE *BLANK
     C           CSD007    ANDNE'Y'                                       CSD007
      *                                                                   CSD007
     C           PRTCD     ORNE *BLANKS                                   CSD007
     C           PRTCD     ANDEQ'*NRF   '                                 CSD007
     C           BBDTDL    ANDNE*ZEROS                                    CSD007
     C           CSD007    ANDEQ'Y'                                       CSD007
      *                                                                   CSD007
     C           PRTCD     ORNE *BLANKS                                   CSD007
     C           PRTCD     ANDNE'*NRF   '                                 CSD007
     C           CSD007    ANDEQ'Y'                                       CSD007
      *                                                                   CSD007
     C                     MOVE *ON       *IN27
     C                     MOVEL'LEF0251' ZAMSID
     C                     EXSR ZASNMS
      *
     C           PRTCD     IFEQ '*NOSEL  '
     C                     MOVE *BLANKS   SSCUST
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVE *BLANKS   SSCUST
     C                     MOVELBBCUST    SSCUST
     C                     ENDIF
      *
      ** If Customer is valid, validate facility
      *
     C           *IN27     IFEQ *OFF
     C                     MOVELSSCUST    WCNUM
     C                     MOVE SSFACT    WFACT
     C                     MOVE SSFCNO    WFCNO
     C                     MOVEL'A'       WRCDT
     C           FCLKY     CHAINFCLTY                80
      *
     C           *IN80     IFEQ *ON
     C                     MOVEA'11'      *IN,27
     C                     MOVEL'LEF0006' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     MOVE FCCY      WFCCY   3                       128979
     C                     MOVELSSFACT    WFCTY
     C                     MOVE SSFCNO    WFCTY
     C                     MOVEL'B'       WRCDT
     C           FCLKY     CHAINFCLTY                80
      *                                                                   145826
     C           PRTR      IFEQ 'P'                                       145826
     C           TRCA      ANDEQ'CA'                                      145826
     C           PRTR      OREQ 'I'                                       145826
     C           TRCA      ANDEQ'CA'                                      145826
     C           PRTR      OREQ 'R'                                                           CLE106
     C           TRCA      ANDEQ'CA'                                                          CLE106
     C           PRTR      OREQ 'S'                                                           CLE106
     C           TRCA      ANDEQ'CA'                                                          CLE106
     C                     MOVEA'11'      *IN,27                          145826
     C                     MOVEL'LEF0296' ZAMSID                          145826
     C                     EXSR ZASNMS                                    145826
     C                     ENDIF                                          145826
      *                                                                   145826
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** If Facility is still valid, validate facility-branch
      *
     C           *IN20     IFEQ *OFF
      *
     C           SSBRCA    IFNE *BLANKS
     C           SSBRCA    ANDNE'ALL'                                     156226
      *
     C           SSBRCA    IFNE BRCA
     C***********          MOVE *ON       *IN26                           156226
     C***********          MOVEL'LEF0252' ZAMSID                          156226
     C***********          EXSR ZASNMS                                    156226
     C                     MOVELSSBRCA    WBRCA                           156226
     C                     ELSE
     C                     MOVELBRCA      WBRCA
     C                     ENDIF
      *
     C                     ELSE
      *                                                                                     BUG22375
      ** Defualt blank Branch to 'ALL'                                                      BUG22375
      *                                                                                     BUG22375
     C           SSBRCA    IFEQ *BLANKS                                                     BUG22375
     C                     MOVEL'ALL'     SSBRCA                                            BUG22375
     C                     ENDIF                                                            BUG22375
      *                                                                                     BUG22375
     C***********          MOVELBRCA      SSBRCA                          156226
     C***********          MOVELBRCA      WBRCA                           156226
      *                                                                   156226
      ** If 'ALL' move branch screen field to work field else, move de-   156226
      ** fault branch of user                                             156226
      *                                                                   156226
     C           SSBRCA    IFEQ 'ALL'                                     156226
     C                     MOVELSSBRCA    WBRCA   3                       156226
     C                     ELSE                                           156226
     C                     MOVELDFTBRA    SSBRCA                          156226
     C                     MOVELDFTBRA    WBRCA                           156226
     C                     ENDIF                                          156226
     C                     ENDIF
      *
     C                     ELSE
      *
     C           *IN26     IFEQ *OFF
     C                     MOVE *BLANKS   SSBRCA
     C                     MOVE *BLANKS   WBRCA
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** If still valid, validate authority
      *
     C           *IN20     IFEQ *OFF
      *
     C           AGMBIN    IFEQ 'Y'
      *                                                                   156226
      ** Check user's access to facility branch                           156226
      *                                                                   156226
     C                     CALL 'ZVBBU'                                   156226
     C                     PARM BRCA      ZBR                             156226
     C                     PARM           ERR                             156226
      *                                                                   156226
     C           ERR       IFNE *ZERO                                     156226
     C           ERR       IFEQ 1                                         156226
     C                     MOVEL'LEF0298' ZAMSID                          156226
     C                     EXSR ZASNMS                                    156226
     C                     ENDIF                                          156226
     C           ERR       IFEQ 2                                         156226
     C                     MOVEL'LEF0299' ZAMSID                          156226
     C                     EXSR ZASNMS                                    156226
     C                     ENDIF                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
      ** If no bank authorisation, display error message.                 156226
      *                                                                   156226
     C           *IN20     IFEQ *OFF                                      156226
     C           WBRCA     IFEQ 'ALL'                                     156226
     C           BNKAUT    ANDNE'Y'                                       156226
     C                     MOVEL'LEF0297' ZAMSID                          156226
     C                     EXSR ZASNMS                                    156226
     C                     ENDIF                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
      ** Check user's access to selected branch                           156226
      *                                                                   156226
     C           *IN20     IFEQ *OFF                                      156226
     C           WBRCA     IFNE 'ALL'                                     156226
     C                     CALL 'ZVBBU'                                   156226
     C                     PARM WBRCA     ZBR                             156226
     C                     PARM           ERR                             156226
      *                                                                   156226
     C           ERR       IFNE *ZERO                                     156226
     C           ERR       IFEQ 1                                         156226
     C                     MOVEL'LEF0298' ZAMSID                          156226
     C                     EXSR ZASNMS                                    156226
     C                     ENDIF                                          156226
     C           ERR       IFEQ 2                                         156226
     C                     MOVEL'LEF0300' ZAMSID                          156226
     C                     EXSR ZASNMS                                    156226
     C                     ENDIF                                          156226
     C                     MOVE *ON       *IN26                           156226
     C                     ENDIF                                          156226
     C                     ENDIF                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C           *IN20     IFEQ *OFF                                      156226
     C           WBRCA     IFNE 'ALL'                                     156226
     C                     CALL 'ZVACTBU'
     C                     PARM 'E'       ZACTN   1
     C                     PARM WBRCA     ZBR     3
     C                     PARM *ZERO     ERR     10
      *
     C           ERR       IFNE *ZERO
     C                     MOVEL'LEF0254' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
     C                     ENDIF                                          156226
     C                     ENDIF                                          156226
      *
     C                     ELSE
     C                     CALL 'ZVACTU'
     C                     PARM 'E'       ZACTN   1
     C                     PARM *ZERO     ERR     10
      *
     C           ERR       IFNE *ZERO
     C                     MOVEL'LEF0253' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Validate date field
      *
     C           SSVLDT    IFNE *BLANKS
     C                     MOVE SSVLDT    ZDATE
     C                     EXSR ZDATE1
      *
     C           *IN99     IFEQ *ON
     C                     MOVE *ON       *IN29
     C                     MOVEL'LEF0255' ZAMSID
     C                     EXSR ZASNMS
     C                     ELSE
     C                     Z-ADDZDAYNO    WVLDT   50
     C                     MOVELSSVLDT    WVLDTA  6
     C                     ENDIF
      *
     C                     ELSE
      *
     C           SSCODE    IFEQ 'F'
     C                     Z-ADDAGRDNB    WVLDT
     C                     Z-ADDAGRDNB    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     WVLDTA
     C                     MOVE ZDATE     SSVLDT
     C                     ELSE
     C                     Z-ADD*ZERO     WVLDT
     C                     MOVE *BLANKS   WVLDTA
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Validate code field
      *
     C           SSCODE    IFNE 'H'
     C           SSCODE    ANDNE'B'
     C           SSCODE    ANDNE'F'
     C           SSCODE    ANDNE'A'                                       147488
     C           SSCODE    ANDNE'P'                                                           204669
     C           SSCODE    ANDNE*BLANKS
     C                     MOVE *ON       *IN30
     C***********          MOVEL'LEF0256' ZAMSID                          147488
     C                     MOVEL'LEF0250' ZAMSID                          147488
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C           SSCODE    IFEQ 'H'
     C           SSCODE    OREQ 'B'
     C           SSCODE    OREQ 'P'                                                           204669
      *
     C           WVLDT     IFGE AGRDNB
     C                     MOVE *ON       *IN29
     C                     MOVE *ON       *IN30
     C                     MOVEL'LEF0257' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           SSCODE    IFEQ 'F'
     C           WVLDT     ANDLTAGRDNB
     C                     MOVE *ON       *IN29
     C                     MOVE *ON       *IN30
     C                     MOVEL'LEF0257' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     MOVELSSCODE    WCODE   1
      *
     C                     ENDSR
      *
     C/COPY WNCPYSRC,LEH00920
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRSPRC  -  Subfile Processing                                *
      *                                                               *
      *  Called by: Main processing                                   *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRSPRC    BEGSR
      *
      ** Format Customer number/shortname
      *
     C                     MOVE BBCUST    SCNUM
     C                     MOVE BBCSSN    SCUST
      *
      ** Format Status
      *
     C                     MOVE *BLANKS   SASTS
      *
     C           RECI      IFEQ 'D'
     C                     MOVEL'LIVE'    SASTS
     C                     ENDIF
      *
     C           RECI      IFEQ 'E'
     C                     MOVEL'EXPIRED' SASTS
     C                     ENDIF
      *
     C           RECI      IFEQ 'C'
     C                     MOVEL'CLOSED'  SASTS
     C                     ENDIF
      *
      ** Format Type
      *
     C                     MOVE *BLANKS   SFCTI
      *
     C           FCTI      IFEQ 'C'
     C                     MOVEL'COMMITTE'SFCTI
     C                     MOVE 'D'       SFCTI
     C                     ENDIF
      *
     C           FCTI      IFEQ 'G'
     C                     MOVEL'GUIDANCE'SFCTI
     C                     ENDIF
      *
     C           FCTI      IFEQ 'F'
     C                     MOVEL'CONFIRME'SFCTI
     C                     MOVE 'D'       SFCTI
     C                     ENDIF
      *
      ** Format Date Approved and Expiry Date
      *
     C                     Z-ADDDTAP      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    SDTAP
      *
     C                     Z-ADDDTEX      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVELZADATE    SDTEX
      *
      ** Format Facility amount
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*KEY    'POPRN   7
     C                     PARM FCCY      PK101   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
      ** Data base error in file SDCURRPD
      *
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD02        DBASE            *************
     C                     MOVEL'SDCURRPD'DBFILE           * DB ERR 02 *
     C                     MOVELFCCY      DBKEY            *************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     Z-ADDFAMT      ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT22    SFAMT
      *
      ** Format Facility
      *
     C                     MOVEL'/'       SFCNO   3
     C                     MOVE FCNO      SFCNO
     C                     MOVELFACT      SFCTY
     C                     MOVE SFCNO     SFCTY
      *
      ** Format Other fields
      *
     C                     MOVELFCCY      SFCCY
     C                     MOVELBRCA      SBRCA
      *
     C                     MOVELOVPC      SOVPCI  3
     C                     MOVE '.'       SOVPCI
     C                     MOVE OVPC      SOVPC
     C                     MOVELSOVPCI    SOVPC
      *
     C                     MOVEL'NO '     SRVCR
     C           RVCR      IFEQ 'Y'
     C                     MOVEL'YES'     SRVCR
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00058
      *
     C                     MOVEL'NO '     SMCSI
     C           MCSI      IFEQ 'Y'
     C                     MOVEL'YES'     SMCSI
     C                     ENDIF
      *
     C                     MOVEL'NO '     SMBFC
     C           MBFC      IFEQ 'Y'
     C                     MOVEL'YES'     SMBFC
     C                     ENDIF
      *
     C                     MOVEL'NO '     SMCCY
     C           MCCY      IFEQ 'Y'
     C                     MOVEL'YES'     SMCCY
     C                     ENDIF
      *
     C                     MOVEL'NO '     SSYIN
     C           SYIN      IFEQ 'Y'
     C                     MOVEL'YES'     SSYIN
     C                     ENDIF
      *
      ** Format Credit Agreement
      *
     C***********TRCA      IFEQ 'CA'                                      127658
     C           TRCA      IFEQ 'TR'                                      127658
     C                     MOVE *ON       *IN21
      *
      ** Retrieve Customer Shortname
      *
     C                     MOVE CANM      SCANM
     C***********          CALL 'AOCUSTR0'                                CSD007
     C                     CALL 'AOCUSTR2'                                CSD007
     C                     PARM *BLANKS   PRTCD   7
     C                     PARM '*KEY    'POPTN   7
     C                     PARM SCANM     PKEY1  10
     C                     PARM           PKYST   7
     C***********SDCUST    PARM SDCUST    DSSDY                           CSD007
     C           SDCUST    PARM SDCUST    DSLDY                           CSD007
      *
      ** Data base error in file SDCUSTPD
      *
     C           PRTCD     IFNE *BLANKS
     C           CSD007    ANDNE'Y'                                       CSD007
      *                                                                   CSD007
     C           PRTCD     ORNE *BLANKS                                   CSD007
     C           PRTCD     ANDEQ'*NRF   '                                 CSD007
     C           BBDTDL    ANDNE*ZEROS                                    CSD007
     C           CSD007    ANDEQ'Y'                                       CSD007
      *                                                                   CSD007
     C           PRTCD     ORNE *BLANKS                                   CSD007
     C           PRTCD     ANDNE'*NRF   '                                 CSD007
     C           CSD007    ANDEQ'Y'                                       CSD007
      *                                                                   CSD007
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD03        DBASE            *************
     C                     MOVEL'SDCUSTPD'DBFILE           * DB ERR 03 *
     C                     MOVELCANM      DBKEY            *************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVELBBCSSN    SCACS
      *
     C                     MOVEL'/'       SCAFC3  3
     C                     MOVE CAFN      SCAFC3  3
     C                     MOVE SCAFC3    SCAFC
     C                     MOVELCAFT      SCAFC
      *
     C                     ENDIF
      *                                                                   127658
     C           TRCA      IFEQ 'CA'                                      127658
     C                     MOVE *ON       *IN31                           127658
      *                                                                   CLE014
      ** Revolving credit indicator is 'T', set revolving credit narra    CLE014
      ** tive to 'TR'                                                     CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           RVCR      ANDEQ'T'                                       CLE014
     C                     MOVEL'TR '     SRVCR                           CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          127658
      *                                                                   147488
     C                     MOVEL*BLANKS   WCALL                           147488
      *                                                                   147488
      ** Prime Facilities                                                 147488
      *                                                                   147488
     C           TRCA      IFNE 'CA'                                      147488
     C           PRTR      ANDNE'P'                                       147488
     C           PRTR      ANDNE'I'                                       147488
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           WPTKY     CHAINLEFCLTL4             05                   147488
     C           *IN05     IFEQ '0'                                       147488
     C                     MOVEL'Y'       WCALL   1                       147488
     C                     ENDIF                                          147488
     C                     ENDIF                                          147488
      *                                                                   128980
      ** Calls LE0213 when Credit Agreement or a Participant Facility     128980
      *                                                                   128980
     C           TRCA      IFEQ 'CA'                                      128980
     C           PRTR      OREQ 'P'                                       128980
     C           PRTR      OREQ 'I'                                       128980
     C           PRTR      OREQ 'R'                                                           CLE106
     C           PRTR      OREQ 'S'                                                           CLE106
     C           WCALL     OREQ 'Y'                                       147488
     C                     MOVEL'Y'       WLE213                          128980
     C                     CALL 'LE0213'                                  128980
     C                     PARM WBRCA     PBRCA   3                       128980
     C**********           PARM WCNUM     PCNUM   60                                   128980 CSD027
     C                     PARM WCNUM     PCNUM   6                                           CSD027
     C                     PARM WFACT     PFACT   30                      128980
     C                     PARM WFCNO     PFCNO   20                      128980
     C                     PARM WFCCY     PCCY    3                       128980
     C                     PARM WVLDT     PVLDT   50                      128980
     C                     PARM WCODE     PCODE   1                       128980
     C                     PARM NEWPF1    PNWPF1 10                                         AR936915
     C                     PARM NEWPF2    PNWPF2 10                                         AR936915
     C                     OPEN LEFCENL0                                  128980
     C           *LOVAL    SETLLLEFCENL0                                  128980
     C                     OPEN LEFATRL0                                                      189343
     C           *LOVAL    SETLLLEFATRL0                                                      189343
     C                     Z-ADD0         WSRRN                           128980
     C                     MOVE '0'       *IN15                                               189343
     C                     MOVE '0'       *IN16                                               189343
     C                     ENDIF                                          128980
      *
      ** Calls LE0214 when facility is aggregate                                            BUG22126
      *                                                                                     BUG22126
     C           TRCA      IFEQ 'AG'                                                        BUG22126
     C                     MOVE *ON       *IN51                                             BUG22126
     C                     MOVE 'Y'       WLE214                                            BUG22126
     C                     CALL 'LE0214'                                                    BUG22126
     C                     PARM WBRCA     PBRCA                                             BUG22126
     C                     PARM WCNUM     PCNUM                                             BUG22126
     C                     PARM WFACT     PFACT                                             BUG22126
     C                     PARM WFCNO     PFCNO                                             BUG22126
     C                     PARM WFCCY     PCCY                                              BUG22126
     C                     PARM WVLDT     PVLDT                                             BUG22126
     C                     PARM WCODE     PCODE                                             BUG22126
     C                     PARM NEWPF1    PNWPF1                                            AR936915
     C                     PARM NEWPF2    PNWPF2                                            AR936915
     C                     OPEN LEFCENL0                                                    BUG22126
     C           *LOVAL    SETLLLEFCENL0                                                    BUG22126
     C                     OPEN LEFATRL0                                                    BUG22126
     C           *LOVAL    SETLLLEFATRL0                                                    BUG22126
     C                     Z-ADD0         WSRRN                                             BUG22126
     C                     MOVE '0'       *IN15                                             BUG22126
     C                     MOVE '0'       *IN16                                             BUG22126
     C                     ENDIF                                                            BUG22126
      *                                                                                     BUG22126
     C           WLE213    IFEQ *BLANKS                                   128980
     C           WLE214    ANDEQ*BLANKS                                                     BUG22126
     C           CAMKY     SETLLLEFCAML8
     C                     ENDIF                                          128980
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     Z-ADD*ZERO     C       40                      CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     EXSR SRSFIL
     C                     Z-ADD1         SSREC
      *
      ** Write Facility details
      *
     C                     WRITELE0211F1
     C                     WRITELE0211C1
     C                     EXFMTLE0211C0
      *
      ** Rollup key is pressed
      *
     C           *IN22     DOWEQ*ON
     C                     EXSR SRSFIL
     C           WPNRPD    IFEQ 'N'                                                          BUG7847
     C           WPNRPD    OREQ 'Y'                                                           253715
     C           FREC      ANDNE'CLOANCL5'                                                    253715
     C                     WRITELE0211C1
     C                     EXFMTLE0211C0
     C                     ENDIF                                                             BUG7847
     C                     ENDDO
      *
      ** F5=Refresh key is pressed
      *
     C           *INKE     IFEQ *ON
     C                     MOVELWBRCA     SSBRCA
     C                     MOVELWCNUM     SSCUST
     C                     MOVELWFACT     SSFACT
     C                     MOVELWFCNO     SSFCNO
     C                     MOVELWVLDTA    SSVLDT
     C                     MOVELWCODE     SSCODE
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRSFIL  -  Fill Subfile Page                                 *
      *                                                               *
      *  Called by: SRSPRC                                            *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRSFIL    BEGSR
      *                                                                                      BUG7847
     C                     MOVE 'N'       WPNRPD                                             BUG7847
      *
      ** Read Facility Activity file
      *
     C           WSRRN     IFNE 11
     C           WLE213    IFEQ *BLANKS                                   128980
     C           WLE214    ANDEQ*BLANKS                                                     BUG22126
     C***********CAMKY     READELEFCAML8                 25               156226
     C                     EXSR SRSELT                                    156226
     C                     ELSE                                           128980
     C                     READ LEFCENL0                 25               128980
     C                     MOVE ATYP      TYPE2   2                                        BUG21833B
     C           FSTRT     IFEQ 'N'                                                        BUG21833B
     C           ATYP      ANDNE'FS'                                                       BUG21833B
     C           DTAP      ANDGEWVLDT                                                       AR936915
     C                     MOVE 'FS'      ATYP                                             BUG21833B
     C                     Z-ADDFAMT      AMNT                                             BUG21833B
     C                     Z-ADDDTAP      ADAT                                             BUG21833B
     C           DTAP      IFGE BJRDNB                                                     BUG21833B
     C                     MOVEL'F'       CODE                                             BUG21833B
     C                     ELSE                                                            BUG21833B
     C                     MOVEL'B'       CODE                                             BUG21833B
     C                     ENDIF                                                           BUG21833B
     C                     ENDIF                                                           BUG21833B
     C                     ENDIF                                          128980
     C                     ENDIF
      *
     C                     Z-ADD*ZERO     WSRRN   40
      *
      ** Rollup is pressed
      *
     C           *IN22     IFEQ *ON
     C           *IN25     ANDEQ*OFF
     C                     ADD  10        SSREC
     C                     ENDIF
      *
      ** Do While not EOF and not End-Of-Page
      *
     C           *IN25     DOWEQ*OFF
     C           WSRRN     ANDLE10
      *
     C                     MOVE '0'       *IN40                                               201909
     C           WLE213    IFEQ *BLANKS                                   128980
     C           WLE214    ANDEQ*BLANKS                                                     BUG22126
      *                                                                   162967
     C                     MOVEL'Y'       WWRIT   1                       162967
     C                     MOVEL'N'       PASTDU                                              204669
      *                                                                   162967
      ** Part sold transactions should be only shown when code is A for   162967
      ** non syndicated facilities                                        162967
      *                                                                   162967
     C********** SYIN      IFEQ 'N'                                162967 189587
     C           SYIN      IFNE 'Y'                                       189587
     C           FREC      IFEQ 'CLOANCL1'                                162967
     C           FREC      OREQ 'LOAMSDKF'                                162967
     C           FREC      OREQ 'FACHISAF'                                162967
     C********** FALOAN    ANDNE0                                                      162967 CLE148
     C           FALOAN    ANDNE*BLANKS                                                       CLE148
     C           FREC      IFEQ 'FACHISAF'                                162967
     C**********           Z-ADDFALOAN    WLNRF   60                                   162967 CLE148
     C                     MOVELFALOAN    WLNRF   6                                           CLE148
     C                     ELSE                                           162967
     C**********           Z-ADDLNRF      WLNRF                                        162967 CLE148
     C                     MOVELLNRF      WLNRF                                               CLE148
     C                     ENDIF                                          162967
     C           WLNRF     CHAINCLOAN                32                   162967
      *                                                                   162967
     C           *IN32     IFEQ '1'                                       162967
     C           WLNRF     CHAINMLOAN                32                   162967
     C                     ENDIF                                          162967
     C           PTYP      IFEQ 66                                        162967
     C           PTYP      OREQ 67                                        162967
     C           PTYP      OREQ 69                                        162967
     C           PTYP      OREQ 72                                        162967
     C                     MOVE 'N'       WWRIT                           162967
     C                     ENDIF                                          162967
      * If Past Due at Maturity, add LNRF to 'PSDU' array:                                    204669
     C           FREC      IFEQ 'LOAMSDKF'                                                    204669
     C           VALDT     ANDEQMDAT                                                          204669
     C           AMTP      ANDEQ'PD'                                                          204669
     C           X         IFLE 150                                                           204669
     C           X         ADD  1         X                                                   204669
     C**********           Z-ADDLNRF      PSDU,X                                       204669 CLE148
     C                     MOVELLNRF      PSDU,X                                              CLE148
     C                     END                                                                204669
     C                     ENDIF                                                              204669
      *                                                                                       204304
      ** If loan record has been reversed, do not show FACHISA records                        201909
      *                                                                                       201909
     C           FREC      IFEQ 'FACHISAF'                                                    201909
     C********** FALOAN    ANDNE0                                                      201909 CLE148
     C           FALOAN    ANDNE*BLANKS                                                       CLE148
     C           RECI      ANDEQ'R'                                                           201909
     C                     MOVE '1'       *IN40                                               201909
     C                     ENDIF                                                              201909
      *
      * If loan record on FACHISA is reversed, do not show on enquiry                         204304
      *                                                                                       204304
     C           FREC      IFEQ 'FACHISAF'                                                    204304
     C********** FALOAN    ANDNE0                                                      204304 CLE148
     C           FALOAN    ANDNE*BLANKS                                                       CLE148
     C           FAREVI    ANDEQ'R'                                                           204304
     C                     MOVE '1'       *IN40                                               204304
     C                     ENDIF                                                              204304
     C                     ENDIF                                          162967
     C                     ENDIF                                          162967
      *                                                                                       204026
     C           FAACTN    IFEQ 'US'                                                          204026
     C           FAACTN    OREQ 'UI'                                                          204026
     C           FAACTN    OREQ 'UD'                                                          204026
     C           FAREVI    IFEQ ' '                                                           204026
     C           FREC      ANDEQ'FACHISAF'                                                    204026
     C                     MOVE BRCA      WBRCA                                               204026
     C**********           Z-ADDFACNUM    WCNUM                                        204026 CSD027
     C                     MOVE FACNUM    WCNUM                                               CSD027
     C                     Z-ADDFACT      WFACT                                               204026
     C                     Z-ADDFCNO      WFCNO                                               204026
     C                     Z-ADDFASQNO    WSQNO   30                                          204026
     C           WLEM11    CHAINLEMNFULF             03                                       204026
     C           *IN03     IFEQ '0'                                                           204026
     C           RECI11    ANDEQ'R'                                                           204026
     C                     MOVE '1'       *IN40                                               204026
     C                     ENDIF                                                              204026
     C                     ENDIF                                                              204026
     C                     ENDIF                                                              204026
      *                                                                   162967
     C           SSCODE    IFEQ 'H'
     C           FREC      ANDEQ'FACHISAF'
     C           WWRIT     ANDEQ'Y'                                       162967
     C           SSCODE    OREQ 'B'
     C           VLDT      ANDLTAGRDNB
     C           FREC      ANDEQ'LEFCAMPF'
     C           SSCODE    OREQ 'B'                                       157191
     C********** VDAT      ANDLTAGRDNB                             157191 192576
      *                                                                                       189343
      ** LOAMSDK's VDAT from LEFCAML8 was renamed to VALDT in I specs,                        189343
      ** thus, VALDT should be used in the program not VDAT                                   189343
      *                                                                                       189343
     C           VALDT     ANDLTAGRDNB                                    192576
     C           FREC      ANDEQ'LOAMSDKF'                                157191
     C           WWRIT     ANDEQ'Y'                                       162967
     C           ORED      ANDEQAGRDNB                                                        204669
     C           SSCODE    OREQ 'P'                                                           204669
     C           FREC      ANDEQ'LOAMSDKF'                                                    204669
     C           AMTP      ANDEQ'PD'                                                          204669
     C           WWRIT     ANDEQ'Y'                                                           204669
     C           SSCODE    OREQ 'B'                                       157191
     C           VDAT      ANDLTAGRDNB                                    157191
     C           ORED      ANDEQAGRDNB                                    157191
     C***********FREC      ANDEQ'CLOANCLF'                         157191 144088
     C           FREC      ANDEQ'CLOANCL1'                                144088
     C           RECIC1    ANDNE'R'                                       190124
     C           WWRIT     ANDEQ'Y'                                       162967
     C           SSCODE    OREQ 'B'                                       144088
     C           VDAT      ANDLTAGRDNB                                    144088
     C           ORED      ANDEQAGRDNB                                    144088
     C           FREC      ANDEQ'CLOANCL2'                                144088
     C           RECIC2    ANDNE'R'                                       190124
     C           SSCODE    OREQ 'B'                                       157214
     C           STDT      ANDLTAGRDNB                                    157214
     C           ORED      ANDEQAGRDNB                                    157214
     C           FREC      ANDEQ'LEMNFUPF'                                157214
     C           RECIBG    ANDNE'R'                                       190124
     C           SSCODE    OREQ 'F'
     C           VLDT      ANDGEAGRDNB
     C           FREC      ANDEQ'LEFCAMPF'
     C           SSCODE    OREQ 'F'                                       157191
     C********** VDAT      ANDGEAGRDNB                             157191 192576
     C           VALDT     ANDGEAGRDNB                                    192576
     C           FREC      ANDEQ'LOAMSDKF'                                157191
     C           WWRIT     ANDEQ'Y'                                       162967
     C           SSCODE    OREQ 'F'                                       157191
     C           VDAT      ANDGEAGRDNB                                    157191
     C********** ORED      ANDEQAGRDNB                                    157191              204479
     C***********FREC      ANDEQ'CLOANCLF'                         157191 144088
     C           FREC      ANDEQ'CLOANCL1'                                144088
     C           RECIC1    ANDNE'R'                                       190124
     C           WWRIT     ANDEQ'Y'                                       162967
     C           SSCODE    OREQ 'F'                                       144088
     C           VDAT      ANDGEAGRDNB                                    144088
     C********** ORED      ANDEQAGRDNB                                    144088              204479
     C           FREC      ANDEQ'CLOANCL2'                                144088
     C           RECIC2    ANDNE'R'                                       190124
     C           CLE014    OREQ 'Y'                                       CLE014
     C           SSCODE    ANDEQ'B'                                       CLE014
     C           NRPD      ANDLTAGRDNB                                    CLE014
     C********** ORED      ANDEQAGRDNB                                    CLE014              204383
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C           WWRIT     ANDEQ'Y'                                       CLE014
     C           CLE014    OREQ 'Y'                                       CLE014
     C           SSCODE    ANDEQ'F'                                       CLE014
     C           NRPD      ANDGEAGRDNB                                    CLE014
     C********** ORED      ANDEQAGRDNB                                    CLE014              204383
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C           WWRIT     ANDEQ'Y'                                       CLE014
     C           SSCODE    OREQ 'F'                                       157214
     C           STDT      ANDGEAGRDNB                                    157214
     C***********ORED      ANDEQAGRDNB                             157214 163331
     C           ORED      ANDLEAGRDNB                                    163331
     C           FREC      ANDEQ'LEMNFUPF'                                157214
     C           RECIBG    ANDNE'R'                                       190124
     C           SSCODE    OREQ 'F'                                                           204669
     C           MDAT      ANDGEAGRDNB                                                        204669
     C           FREC      ANDEQ'CLOANCL3'                                                    204669
     C           RECIC3    ANDNE'R'                                                           204669
     C           SSCODE    OREQ 'A'                                       147488
     C           SSCODE    OREQ *BLANKS
     C           WWRIT     ANDEQ'Y'                                       162967
      *
     C                     MOVE 'Y'       WPRIN   1                       157545
     C           AMTP      IFEQ 'MR'                                      157545
     C           PRAM      ANDEQ0                                         157545
     C                     MOVE 'N'       WPRIN                           157545
     C                     ENDIF                                          157545
      *                                                                                       204669
     C           AMTP      IFEQ 'PD'                                                          204669
     C           PRAM      ANDEQ0                                                             204669
     C                     MOVE 'N'       WPRIN                                               204669
     C                     ENDIF                                                              204669
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C                     EXSR SRRAMT                                    CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       204669
      * If Maturity, check whether this loan has gone Past Due                                204669
     C           FREC      IFEQ 'CLOANCL3'                                                    204669
     C                     Z-ADD1         Y       30                                          204669
     C           LNRF      LOKUPPSDU,Y                   13                                   204669
     C           *IN13     IFEQ '1'                                                           204669
     C                     MOVE 'Y'       PASTDU  1                                           204669
     C                     ENDIF                                                              204669
      *                                                                                       204669
     C                     ENDIF                                                              204669
      *                                                                   157545
     C           VLDT      IFGE WVLDT
     C           FREC      ANDEQ'LEFCAMPF'
     C           FADATE    ORGE WVLDT
     C           FREC      ANDEQ'FACHISAF'
     C           *IN40     ANDNE'1'                                                           201909
     C********** VDAT      ORGE WVLDT                              157191 192576
     C           VALDT     ORGE WVLDT                                     192576
     C           FREC      ANDEQ'LOAMSDKF'                                157191
     C           WPRIN     ANDEQ'Y'                                       157545
     C           VDAT      ORGE WVLDT                                     157191
     C           ORED      ANDEQAGRDNB                                    157191
     C***********FREC      ANDEQ'CLOANCLF'                         157191 144088
     C           FREC      ANDEQ'CLOANCL1'                                144088
     C           RECIC1    ANDNE'R'                                       190124
      *                                                                                       204479
     C           VDAT      ORGE AGRDNB                                                        204479
     C           VDAT      ANDGEWVLDT                                                         204479
     C           ORED      ANDNEAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL1'                                                    204479
     C           RECIC1    ANDNE'R'                                                           204479
      *                                                                                       204479
     C           VDAT      ORGE AGRDNB                                                        204479
     C           VDAT      ANDGEWVLDT                                                         204479
     C           ORED      ANDNEAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL2'                                                    204479
     C           RECIC2    ANDNE'R'                                                           204479
      *                                                                                       204479
     C           VDAT      ORGE WVLDT                                     144088
     C           ORED      ANDEQAGRDNB                                    144088
     C           FREC      ANDEQ'CLOANCL2'                                144088
     C           RECIC2    ANDNE'R'                                       190124
     C           MDAT      ORGE WVLDT                                     CLE014
     C           FREC      ANDEQ'CLOANCL3'                                CLE014
     C           PASTDU    ANDNE'Y'                                                           204669
     C           RECIC3    ANDNE'R'                                                           204441
     C           CLE014    OREQ 'Y'                                       CLE014
     C           NRPD      ANDGEWVLDT                                     CLE014
     C********** ORED      ANDEQAGRDNB                                    CLE014              204383
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C           WRAMT     ANDGT*ZERO                                     CLE014
     C           RECIC5    ANDNE'R'                                                           204441
     C           STDT      ORGE WVLDT                                     157214
     C           ORED      ANDEQAGRDNB                                    157214
     C           FREC      ANDEQ'LEMNFUPF'                                157214
     C           RECIBG    ANDNE'R'                                       190124
     C           STDT      ORGE WVLDT                                     163331
     C           STDT      ANDGEAGRDNB                                    163331
     C           ORED      ANDLTAGRDNB                                    163331
     C           FREC      ANDEQ'LEMNFUPF'                                163331
     C           RECIBG    ANDNE'R'                                       190124
     C           EXDT      ORGE WVLDT                                                         189343
     C           FREC      ANDEQ'LEMNFUPE'                                                    189343
     C           RECIED    ANDNE'R'                                                           204433
     C                     EXSR SRFRMT
      *                                                                                      BUG7847
     C           FREC      IFNE 'CLOANCL5'                                                   BUG7847
      *                                                                                      BUG7847
     C                     MOVE *ON       *IN24
     C                     ADD  1         WSRRN
      *
      ** Lookup if WSRRN = 11
      *
     C           WSRRN     IFNE 11
     C                     ADD  1         SRRN
     C                     WRITELE0211S0
      *                                                                                     BUG21833
     C           FSTRT     IFEQ 'N'                                                         BUG21833
     C           PRECRD    ANDNE'FACHISAF'                                                 BUG21833A
     C           FREC      ANDEQ'FACHISAF'                                                 BUG21833A
     C**********           MOVE 'Y'       FSTRT                                   BUG21833 BUG21833A
     C           CAMKY     SETLLLEFCAML8                                                    BUG21833
     C                     ENDIF                                                            BUG21833
     C           FSTRT     IFEQ 'N'                                                        BUG21833B
     C           TRCA      ANDEQ'CA'                                                       BUG21833B
     C           TYPE2     ANDNE'FS'                                                       BUG21833B
     C           *LOVAL    SETLLLEFCENL0                                                   BUG21833B
     C                     ENDIF                                                           BUG21833B
     C                     MOVE 'Y'       FSTRT                                            BUG21833A
     C                     ENDIF
      *                                                                                      BUG7847
     C                     ENDIF                                                             BUG7847
      *
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                   128980
     C                     ELSE                                           128980
     C                     EXSR SRFRMT                                    128980
      *                                                                                      BUG7847
     C           FREC      IFNE 'CLOANCL5'                                                   BUG7847
      *                                                                                      BUG7847
     C                     MOVE *ON       *IN24                           128980
     C                     ADD  1         WSRRN                           128980
      *                                                                   128980
      ** Lookup if WSRRN = 11                                             128980
      *                                                                   128980
     C           WSRRN     IFNE 11                                        128980
     C                     ADD  1         SRRN                            128980
     C                     WRITELE0211S0                                  128980
      *                                                                                     BUG21833
     C           FSTRT     IFEQ 'N'                                                         BUG21833
     C           PRECRD    ANDNE'FACHISAF'                                                 BUG21833A
     C           FREC      ANDEQ'FACHISAF'                                                 BUG21833A
     C**********           MOVE 'Y'       FSTRT                                   BUG21833 BUG21833A
     C           CAMKY     SETLLLEFCAML8                                                    BUG21833
     C                     ENDIF                                                            BUG21833
     C           FSTRT     IFEQ 'N'                                                        BUG21833B
     C           TRCA      ANDEQ'CA'                                                       BUG21833B
     C           TYPE2     ANDNE'FS'                                                       BUG21833B
     C           *LOVAL    SETLLLEFCENL0                                                   BUG21833B
     C                     ENDIF                                                           BUG21833B
     C                     MOVE 'Y'       FSTRT                                            BUG21833A
     C                     ENDIF                                          128980
      *                                                                                      BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDIF                                          128980
      *
      ** Read Facility Activity file
      *
     C           WSRRN     IFNE 11
     C           WLE213    IFEQ *BLANKS                                   128980
     C           WLE214    ANDEQ*BLANKS                                                     BUG22126
     C***********CAMKY     READELEFCAML8                 25               156226
     C                     EXSR SRSELT                                    156226
     C                     ELSE                                           128980
     C                     READ LEFCENL0                 25               128980
     C                     ENDIF                                          128980
     C                     ENDIF
      *
     C                     ENDDO
      *
     C           SRRN      IFEQ *ZERO
     C                     MOVEL'LEF0230' ZAMSID
     C                     EXSR ZASNMS
     C                     ENDIF
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************   156226
      *                                                               *   156226
      *  SRSELT  -  Selects records to be displayed in the subfile.   *   156226
      *             All branches or for a specific branch only.       *   156226
      *                                                               *   156226
      *  Called by: SRSFIL Subroutine                                 *   156226
      *                                                               *   156226
      *  Calls    : None                                              *   156226
      *                                                               *   156226
      *****************************************************************   156226
      *                                                                   156226
     C           SRSELT    BEGSR                                          156226
      *                                                                   156226
     C**********           Z-ADD0         LNRF                                         189570 CLE148
     C                     MOVEL*BLANKS   LNRF                                                CLE148
     C           CAMKY     READELEFCAML8                 25               156226
      *                                                                                     BUG21833
     C                     MOVE FREC      PRECRD  8                                        BUG21833A
     C                     MOVE ' '       FKSTRT  1                                        BUG22349A
     C           FSTRT     IFEQ 'N'                                                         BUG21833
     C           FREC      ANDNE'FACHISAF'                                                  BUG21833
     C           DTAP      ANDGEWVLDT                                                       AR936915
     C                     MOVE 'FACHISAF'FREC                                              BUG21833
     C                     MOVE 'FS'      FAACTN                                            BUG21833
     C                     Z-ADDFAMT      FAAAMT                                            BUG21833
     C                     Z-ADDDTAP      FADATE                                            BUG21833
     C                     MOVE 'Y'       FKSTRT                                           BUG22349A
     C                     ENDIF                                                            BUG21833
      *                                                                                       247937
     C                     MOVE BRCA      W#BRCA  3                                           247937
     C                     MOVE BRCA      P#BRCA  3                                           247937
      *                                                                                       247937
      ** If the record is coming from FACHISA and facility is                                 247937
      ** multi-branch, check for the branch of the loan.                                      247937
      *                                                                                       247937
     C           FREC      IFEQ 'FACHISAF'                                                    247937
     C           MBFC      ANDEQ'Y'                                                           247937
     C********** FALOAN    ANDNE*ZEROS                                                 247937 CLE148
     C           FALOAN    ANDNE*BLANKS                                                       CLE148
      *                                                                                       247937
     C           FALOAN    CHAINCLOAN                97                                       247937
     C           *IN97     IFEQ '1'                                                           247937
     C           FALOAN    CHAINMLOAN                97                                       247937
     C                     ENDIF                                                              247937
      *                                                                                       247937
     C                     MOVE BRCA      W#BRCA                                              247937
      *                                                                                       247937
     C                     ENDIF                                                              247937
      *                                                                                       247937
     C                     MOVE P#BRCA    BRCA                                                247937
     C/COPY WNCPYSRC,LE0211C001
      *                                                                   156226
     C           WBRCA     IFNE 'ALL'                                     156226
     C********** WBRCA     DOWNEBRCA                                                   156226 247937
     C           WBRCA     DOWNEW#BRCA                                                        247937
     C           *IN25     ANDEQ*OFF                                      156226
     C           CAMKY     READELEFCAML8                 25               156226
      *                                                                                       247937
      ** If the record is coming from FACHISA and facility is                                 247937
      ** multi-branch, check for the branch of the loan.                                      247937
      *                                                                                       247937
     C                     MOVE BRCA      P#BRCA                                              247937
     C                     MOVE BRCA      W#BRCA                                              247937
      *                                                                                       247937
     C           FREC      IFEQ 'FACHISAF'                                                    247937
     C           MBFC      ANDEQ'Y'                                                           247937
     C********** FALOAN    ANDNE*ZEROS                                                 247937 CLE148
     C           FALOAN    ANDNE*BLANKS                                                       CLE148
      *                                                                                       247937
     C           FALOAN    CHAINCLOAN                97                                       247937
     C           *IN97     IFEQ '1'                                                           247937
     C           FALOAN    CHAINMLOAN                97                                       247937
     C                     ENDIF                                                              247937
      *                                                                                       247937
     C                     MOVE BRCA      W#BRCA                                              247937
      *                                                                                       247937
     C                     ENDIF                                                              247937
      *                                                                                       247937
     C                     MOVE P#BRCA    BRCA                                                247937
     C/COPY WNCPYSRC,LE0211C002
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C                     ENDSR                                          156226
      *                                                                   156226
      *****************************************************************
      *                                                               *
      *  SRFRMT  -  Format Subfile record                             *
      *                                                               *
      *  Called by: SRSPRC                                            *
      ***Calls****: None                                              *   CLE014
      *  Calls:                                                       *   CLE014
      *  SRRAMT   - Calculates interest                               *   CLE014
      *                                                               *
      *****************************************************************
      *
     C           SRFRMT    BEGSR
      *                                                                   128980
     C                     MOVE '0'       *IN07                                               189343
     C                     SELEC                                          128980
     C           WLE213    WHEQ *BLANKS                                   128980
     C           WLE214    ANDEQ*BLANKS                                                     BUG22126
      *
      ** Format Date
      *
     C           FREC      IFEQ 'FACHISAF'
     C                     Z-ADDFADATE    ZDAYNO
     C                     ELSE
     C***********FREC      IFEQ 'LOAMSDKF'                         157191 188968
     C***********FREC      OREQ 'CLOANCLF'                         157191 144088
     C***********FREC      OREQ 'CLOANCL1'                         144088 188968
     C           FREC      IFEQ 'CLOANCL1'                                188968
     C           FREC      OREQ 'CLOANCL2'                                144088
     C                     Z-ADDVDAT      ZDAYNO                          157191
     C                     ELSE                                           157191
     C           FREC      IFEQ 'CLOANCL3'                                CLE014
     C                     Z-ADDMDAT      ZDAYNO                          CLE014
     C                     ELSE                                           CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C                     Z-ADDNRPD      ZDAYNO                          CLE014
     C                     ELSE                                           CLE014
     C           FREC      IFEQ 'LEMNFUPF'                                157214
     C                     Z-ADDSTDT      ZDAYNO                          157214
     C                     ELSE                                           157214
     C           FREC      IFEQ 'LEMNFUPE'                                                    189343
     C                     Z-ADDEXDT      ZDAYNO                                              189343
     C                     ELSE                                                               189343
     C           FREC      IFEQ 'LOAMSDKF'                                188968
     C                     Z-ADDVALDT     ZDAYNO                          188968
     C                     ELSE                                           188968
     C                     Z-ADDVLDT      ZDAYNO
     C                     ENDIF                                          188968
     C                     ENDIF
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                                              189343
     C                     ENDIF                                          157214
     C                     ENDIF                                          157191
      *
     C                     EXSR ZDATE2
     C                     MOVELZADATE    SVLDT
      *
      ** Format Amount and Currency
      *
     C           FREC      IFEQ 'FACHISAF'
     C***********          MOVELFCCY      SACCY                                               189570
     C                     MOVELFCCY      SACCY   3                                           189570
     C                     Z-ADDFAAAMT    ZFLD15
     C                     ELSE
     C           FREC      IFEQ 'LOAMSDKF'                                157191
     C                     MOVELCCY       SACCY                           157191
     C                     Z-ADDTAMT      ZFLD15                          157191
      *                                                                                       207963
     C           REPT      IFEQ 1                                                             207963
     C           AMTP      ANDEQ'RE'                                                          207963
     C                     Z-ADDPRAM      ZFLD15                                              207963
     C                     ENDIF                                                              207963
      *                                                                   157545
     C           AMTP      IFEQ 'MR'                                      157545
     C                     Z-ADDPRAM      ZFLD15                          157545
     C                     ENDIF                                          157545
      *                                                                   157545
     C           AMTP      IFEQ 'PD'                                                          204669
     C                     Z-ADDPRAM      ZFLD15                                              204669
     C                     ENDIF                                                              204669
      *                                                                                       204669
     C                     ELSE                                           157191
     C***********FREC      IFEQ 'CLOANCLF'                         157191 144088
     C           FREC      IFEQ 'CLOANCL1'                                144088
     C           FREC      OREQ 'CLOANCL2'                                144088
     C           FREC      OREQ 'CLOANCL3'                                CLE014
     C           FREC      OREQ 'CLOANCL5'                                                   BUG7847
     C                     MOVELCCY       SACCY                           157191
      *                                                                                       CLE028
      ** If CLE028 is present                                                                 CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C                     ADD  FLTI      CPAM                                                CLE028
     C                     ENDIF                                                              CLE028
     C           ADCF      IFEQ 'Y'                                                           CLE028
     C                     ADD  CHGA      CPAM                                                CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     Z-ADDCPAM      ZFLD15                          157191
      *                                                                   CLE014
     C           FREC      IFEQ 'CLOANCL3'                                CLE014
     C           FREC      OREQ 'CLOANCL5'                                                   BUG7847
     C                     MOVE SPIN      WCUSI   1                       CLE014
      *                                                                   CLE014
     C**********           Z-ADDLNRF      WALOAN  60                                   CLE014 CLE148
     C                     MOVELLNRF      WALOAN  6                                           CLE148
     C                     Z-ADDCPAM      MAMNT  130                      CLE014
     C                     Z-ADDIACD      WLICD   50                      CLE014
     C                     Z-ADDINTR      WCURT                           CLE014
     C                     Z-ADDBRTE      WCUBR                           CLE014
     C                     Z-ADDRTSP      WCUSP                           CLE014
     C                     Z-ADDIACD      WLASD                           CLE014
     C                     MOVE ICBS      WICBS                           CLE014
     C                     MOVE *BLANK    WSTAC   1                       CLE014
      *                                                                   CLE014
      ** Read LEFCAMLA to get all loan amendments which concerns          CLE014
      ** principal for repayment types 1 and 2                            CLE014
      *                                                                   CLE014
     C                     MOVE '0'       *IN06                           CLE014
      *                                                                   CLE014
     C           NRPD      IFNE 0                                                             207963
     C                     Z-ADDNRPD      ZDAYNO                                              207963
     C                     Z-ADDRDYN      ZMDAY                                               207963
     C                     MOVELSACCY     ZCCY                                                207963
     C                     MOVELRFRQ      ZFREQ                                               207963
     C                     ENDIF                                                              207963
      *                                                                   CLE014
      ** Save REPT since value might change after reading LEFCAMLA                           BUG7847
      *                                                                                      BUG7847
     C                     Z-ADDREPT      WREPT                                              BUG7847
      *                                                                                      BUG7847
     C           REPT      IFLE 2                                         CLE014
      *                                                                   CLE014
     C           WALOAN    SETLLCLONF                                                       BUG21833
     C           WALOAN    READECLONF                    50                                 BUG21833
      *                                                                                     BUG21833
      ** If interest capitalization indicator is equal to Y                                 BUG21833
      ** compute for the interest                                                           BUG21833
      *                                                                                     BUG21833
     C           INTC      IFEQ 'Y'                                                         BUG21833
     C                     Z-ADDCPAM      WCUPR                                             BUG21833
      *                                                                                     BUG21833
      ** Initialise variables                                                               BUG21833
      *                                                                                     BUG21833
     C                     Z-ADD0         WLASD   50                                        BUG21833
     C                     Z-ADD*ZEROS    WCALC                                             BUG21833
     C                     Z-ADD*ZEROS    WIPAID                                            BUG21833
     C                     ENDIF                                                            BUG21833
      *                                                                                     BUG21833
     C           WALOAN    SETLLLEFCAMLA                                  CLE014
     C                     READ LEFCAMLA                 06               CLE014
     C           *IN06     DOWEQ'0'                                       CLE014
     C           WALOAN    ANDEQLNRFLA                                    CLE014
      *                                                                   CLE014
     C           VDATLA    IFLE ZDAYNO                                                        207963
     C           ZDAYNO    ORLT NRPD                                                        AR830785
      *                                                                                       207963
     C           INTC      IFEQ 'Y'                                                         BUG21833
      *                                                                                     BUG21833
     C           AMTPLA    IFNE 'ST'                                                        BUG21833
     C           WLASD     ANDEQ0                                                           BUG21833
     C                     Z-ADDVDAT      WLASD                                             BUG21833
     C                     ENDIF                                                            BUG21833
      *                                                                                     BUG21833
     C           WLASD     IFNE VDATLA                                                      BUG21833
     C           WLASD     ANDNE*ZEROS                                                      BUG21833
     C           WSTAC     ANDEQ*BLANK                                                      BUG21833
     C                     Z-ADDVDATLA    ZIEND                                             BUG21833
     C                     EXSR SRINCL                                                      BUG21833
     C                     ADD  ZINTR     WCALC  152                                        BUG21833
     C                     ENDIF                                                            BUG21833
     C                     ENDIF                                                            BUG21833
      *                                                                                     BUG21833
     C           AMTPLA    IFEQ 'MR'                                      CLE014
     C           AMTPLA    OREQ 'RE'                                      CLE014
     C           AMTPLA    OREQ 'PF'                                      CLE014
      *                                                                                     BUG21833
     C           INTC      IFEQ 'Y'                                                         BUG21833
     C           WCALC     SUB  WIPAID    WOUTIN 152                                        BUG21833
     C           WOUTIN    IFLE TAMT                                                        BUG21833
     C                     ADD  WOUTIN    WCUPR                                             BUG21833
     C                     Z-ADDWOUTIN    INTAHL                                            BUG21833
      *                                                                                     BUG21833
     C           WOUTIN    IFLT 0                                                           BUG21833
     C                     Z-ADDTAMT      PRAM                                              BUG21833
     C                     Z-ADD0         INTAHL                                            BUG21833
     C                     ENDIF                                                            BUG21833
      *                                                                                     BUG21833
     C                     ELSE                                                             BUG21833
     C                     Z-ADD*ZEROS    PRAM                                              BUG21833
     C                     Z-ADDTAMTHL    INTAHL                                            BUG21833
     C                     ENDIF                                                            BUG21833
     C                     SUB  TAMT      WCUPR                                             BUG21833
     C                     ADD  INTAHL    WIPAID                                            BUG21833
     C                     Z-ADDWCUPR     MAMNT                                             BUG21833
     C                     ELSE                                                             BUG21833
      *                                                                   CLE014
      ** Subtract movement amount from current principal to project       CLE014
      ** maturity amount.                                                 CLE014
      *                                                                   CLE014
     C           MAMNT     SUB  PRAM      MAMNT                           CLE014
     C                     ENDIF                                                            BUG21833
     C                     ELSE                                           CLE014
      *                                                                   CLE014
      ** Amendment type is PI or PT                                       CLE014
      *                                                                   CLE014
     C           AMTPLA    IFEQ 'PI'                                      CLE014
     C           AMTPLA    OREQ 'PT'                                      CLE014
     C                     ADD  PRAM      MAMNT                           CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     READ LEFCAMLA                 06               CLE014
      *                                                                                       207963
     C                     ELSE                                                               207963
     C           MAMNT     IFGT 0                                                             207963
     C                     SUB  RAMT      MAMNT                                               207963
     C           MAMNT     IFLT 0                                                             207963
     C                     Z-ADD0         MAMNT                                               207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
     C           RFRQ      IFNE ' '                                                           207963
     C                     EXSR ZFREQB                                                        207963
     C                     ELSE                                                               207963
     C                     Z-ADDMDAT      ZDAYNO                                              207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
     C                     ENDDO                                          CLE014
      *                                                                                       207963
      ***Continue*the*computation*of*principal*at*maturity.************               207963 BUG7847
      *                                                                                       207963
     C********** ZDAYNO    DOWLTMDAT                                                  207963 BUG7847
     C********** MAMNT     ANDGT0                                                     207963 BUG7847
      *                                                                                       207963
     C**********           SUB  RAMT      MAMNT                                       207963 BUG7847
     C********** RFRQ      IFNE ' '                                                   207963 BUG7847
     C**********           EXSR ZFREQB                                                207963 BUG7847
     C**********           ELSE                                                       207963 BUG7847
     C**********           Z-ADDMDAT      ZDAYNO                                      207963 BUG7847
     C**********           ENDIF                                                      207963 BUG7847
      *                                                                                       207963
     C********** MAMNT     IFLT 0                                                     207963 BUG7847
     C**********           Z-ADD0         MAMNT                                       207963 BUG7847
     C**********           ENDIF                                                      207963 BUG7847
     C**********           ENDDO                                                      207963 BUG7847
      *                                                                   CLE014
     C                     ELSE                                           CLE014
      *                                                                   CLE014
      ** if repayment type 3                                              CLE014
      *                                                                   CLE014
     C           WALOAN    SETLLCLONF                                                       BUG21833
     C           WALOAN    READECLONF                    50                                 BUG21833
      *                                                                                     BUG21833
     C                     Z-ADDCPAM      WCUPR                           CLE014
      *                                                                   CLE014
      ** Initialise variables                                             CLE014
      *                                                                   CLE014
     C                     MOVE '0'       *IN37                           CLE014
     C                     Z-ADD0         WLASD   50                      CLE014
     C                     Z-ADD*ZEROS    WCALC                           CLE014
     C                     Z-ADD*ZEROS    WIPAID                          CLE014
      *                                                                   CLE014
     C                     MOVE ZDAYNO    TDAYNO                                            AR830785
     C           KEYH      SETLLHISLAML0                                  CLE014
     C********** *IN37     DOWEQ'0'                                                    CLE014 207963
     C           KEYH      READEHISLAML0                 37               CLE014
      *                                                                   CLE014
      ** If no history or no amendments against the loan                  CLE014
      *                                                                   CLE014
     C           *IN37     IFEQ '1'                                       CLE014
     C                     Z-ADDCPAM      ZFLD15                          CLE014
     C                     Z-ADDVDAT      WLASD                                               207963
     C                     ELSE                                           CLE014
      *                                                                                       207963
     C           *IN37     DOWEQ'0'                                                           207963
      *                                                                                       189343
      ** If loan has not start yet and there is an RE, initialise WLASD                       189343
      ** so that interest will be computed.                                                   189343
      *                                                                                       189343
     C********** AMTPHL    IFEQ 'RE'                                                   189343 207963
     C           AMTPHL    IFNE 'ST'                                                          207963
     C           WLASD     ANDEQ0                                                             189343
     C**********           Z-ADD1         WLASD                                        189343 207963
     C                     Z-ADDVDAT      WLASD                                               207963
     C                     ENDIF                                                              189343
      *                                                                   CLE014
      ** Accumulate interest on change of date                            CLE014
      *                                                                   CLE014
     C           VDATHL    IFLE ZDAYNO                                                        207963
     C           ZDAYNO    ORLT TDAYNO                                                      AR830785
      *                                                                                       207963
     C           WLASD     IFNE VDATHL                                    CLE014
     C           WLASD     ANDNE*ZEROS                                    CLE014
     C           WSTAC     ANDEQ*BLANK                                    CLE014
     C                     Z-ADDVDATHL    ZIEND                           CLE014
     C                     EXSR SRINCL                                    CLE014
     C                     ADD  ZINTR     WCALC  152                      CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           AMTPHL    IFEQ 'ST'                                      CLE014
     C           AMTPHL    OREQ 'RO'                                      CLE014
     C           AMTPHL    OREQ 'MC'                                      CLE014
     C                     MOVE CALCHL    WICBS   10                      CLE014
     C                     MOVE SPINHL    WCUSI                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     SELEC                                          CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'ST'                                      CLE014
     C           AMTPHL    OREQ 'MC'                                      CLE014
      *                                                                   CLE014
     C           AMTPHL    IFEQ 'ST'                                      CLE014
     C                     Z-ADDPRAMHL    WCUPR                           CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADDCPAMHL    WCUPR                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     Z-ADDBRTEHL    WCUBR  117                      CLE014
     C                     Z-ADDRTSPHL    WCUSP  117                      CLE014
     C                     Z-ADDINTRHL    WCURT  117                      CLE014
     C                     Z-ADDVDATHL    WLICD                           CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'IN'                                      CLE014
      *                                                                   CLE014
      ** WIPAID is interest paid for the loan                             CLE014
      *                                                                   CLE014
     C                     ADD  INTAHL    WIPAID 152                      CLE014
     C           INTCHL    IFEQ 'Y'                                       CLE014
     C                     ADD  INTAHL    WCUPR  130                      CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'RO'                                      CLE014
      *                                                                   CLE014
     C           PRINRO    IFNE *ZEROS                                    CLE014
     C                     Z-ADDPRINRO    WCUPR                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     Z-ADDBRTEHL    WCUBR                           CLE014
     C                     Z-ADDRTSPHL    WCUSP                           CLE014
     C                     Z-ADDINTRHL    WCURT                           CLE014
     C                     Z-ADDVDATHL    WLICD   50                      CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'PT'                                      CLE014
     C           AMTPHL    OREQ 'PI'                                      CLE014
     C                     ADD  PRAMHL    WCUPR                           CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'PF'                                      CLE014
     C                     SUB  PRAMHL    WCUPR                           CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'MR'                                      CLE014
     C           AMTPHL    OREQ 'RE'                                      CLE014
     C           AMTPHL    OREQ 'MA'                                      CLE014
      *                                                                   CLE014
      ** If RE is from LOAMSDK, compute for the outstanding interest to   CLE014
      ** date to determine what portion of the repayment amount will go   CLE014
      ** to the principal.                                                CLE014
      *                                                                   CLE014
     C           AMTPHL    IFEQ 'RE'                                      CLE014
     C                     MOVE '0'       *IN08                           CLE014
      *                                                                   CLE014
      ** If RE is from history, skip computation of outstanding INT       CLE014
      *                                                                   CLE014
     C           VDATHL    IFLT AGRDNB                                    CLE014
     C           LCDHL     ANDLTAGRDNB                                    CLE014
     C                     MOVE '1'       *IN08                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** If RE is from LOAMSDK                                            CLE014
      *                                                                   CLE014
     C           *IN08     IFEQ '0'                                       CLE014
     C           WCALC     SUB  WIPAID    WOUTIN 152                      CLE014
      *                                                                   CLE014
      ** Compute for the interest to be paid                              CLE014
      *                                                                   CLE014
     C           WOUTIN    IFLE TAMTHL                                    CLE014
     C           INTC      IFEQ 'Y'                                                         BUG21833
     C                     ADD  WOUTIN    WCUPR                                             BUG21833
     C                     ELSE                                                             BUG21833
     C           TAMTHL    SUB  WOUTIN    PRAMHL 130                      CLE014
     C                     ENDIF                                                            BUG21833
     C                     Z-ADDWOUTIN    INTAHL                          CLE014
      *                                                                   CLE014
      ** If over paid                                                     CLE014
      *                                                                   CLE014
     C           WOUTIN    IFLT 0                                         CLE014
     C                     Z-ADDTAMTHL    PRAMHL                          CLE014
     C                     Z-ADD0         INTAHL                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADD*ZEROS    PRAMHL                          CLE014
     C                     Z-ADDTAMTHL    INTAHL                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ADD  INTAHL    WIPAID                          CLE014
     C           INTC      IFEQ 'Y'                                                         BUG21833
     C                     SUB  TAMTHL    WCUPR                                             BUG21833
     C                     ELSE                                                             BUG21833
     C                     SUB  PRAMHL    WCUPR                           CLE014
     C                     ENDIF                                                            BUG21833
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'BR'                                      CLE014
     C           AMTPHL    OREQ 'BC'                                      CLE014
     C                     Z-ADDBRTEHL    WCUBR                           CLE014
     C                     EXSR SRNEWI                                    CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'SC'                                      CLE014
     C                     Z-ADDRTSPHL    WCUSP                           CLE014
     C                     EXSR SRNEWI                                    CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'MI'                                      CLE014
     C                     ADD  INTAHL    WCALC  152                      CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'SA'                                      CLE014
     C           STAIHL    IFEQ *BLANK                                    CLE014
     C                     Z-ADDVDATHL    WLICD                           CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'Y'       WSTAC                           CLE014
     C                     ENDIF                                          CLE014
     C                     ENDSL                                          CLE014
      *                                                                                       207963
     C                     Z-ADDVDATHL    WLASD                                               207964
      *                                                                                       207963
     C           KEYH      READEHISLAML0                 37                                   207963
      *                                                                                       207963
     C                     ELSE                                                               207963
      *                                                                                       207963
     C           WALOAN    SETLLCLONF                                                       BUG21833
     C           WALOAN    READECLONF                    50                                 BUG21833
      *                                                                                     BUG21833
     C           WLASD     IFNE ZDAYNO                                                        207963
     C           WLASD     ANDNE*ZEROS                                                        207963
     C           WSTAC     ANDEQ*BLANK                                                        207963
     C           ZDAYNO    ANDLTMDAT                                                          207963
     C                     Z-ADDZDAYNO    ZIEND                                               207963
     C                     EXSR SRINCL                                                        207963
     C                     ADD  ZINTR     WCALC                                               207963
     C                     Z-ADDZDAYNO    WLASD                                               207963
     C           RFRQ      IFNE ' '                                                           207963
     C                     EXSR ZFREQB                                                        207963
     C                     ELSE                                                               207963
     C                     Z-ADDMDAT      ZDAYNO                                              207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C           WCALC     SUB  WIPAID    WOUTIN                                              207963
      *                                                                                       207963
      ** Compute for the interest to be paid                                                  207963
      *                                                                                       207963
     C           WOUTIN    IFLE RAMT                                                          207963
     C           INTC      IFEQ 'Y'                                                         BUG21833
     C                     ADD  WOUTIN    WCUPR                                             BUG21833
     C                     ELSE                                                             BUG21833
     C           RAMT      SUB  WOUTIN    WPRAM  130                                          207963
     C                     ENDIF                                                            BUG21833
     C                     Z-ADDWOUTIN    WINTA  130                                          207963
      *                                                                                       207963
      ** If over paid                                                                         207963
      *                                                                                       207963
     C           WOUTIN    IFLT 0                                                             207963
     C                     Z-ADDRAMT      WPRAM                                               207963
     C                     Z-ADD0         WINTA                                               207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ELSE                                                               207963
     C                     Z-ADD*ZEROS    WPRAM                                               207963
     C                     Z-ADDRAMT      WINTA                                               207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ADD  WINTA     WIPAID                                              207963
     C           WCUPR     IFGT 0                                                             207963
     C           INTC      IFEQ 'Y'                                                         BUG21833
     C                     SUB  RAMT      WCUPR                                             BUG21833
     C                     ELSE                                                             BUG21833
     C                     SUB  WPRAM     WCUPR                                               207963
     C                     ENDIF                                                            BUG21833
     C           WCUPR     IFLT 0                                                             207963
     C                     Z-ADD0         WCUPR                                               207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ENDIF                                                              207963
     C                     ENDDO                                                              207963
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C**********           Z-ADDVDATHL    WLASD                                        CLE014 207963
      **********                                                                       CLE014 207963
     C**********           ENDDO                                                       CLE014 207963
      *                                                                   CLE014
     C                     Z-ADDWCUPR     MAMNT                           CLE014
      *                                                                                       207963
      ** Continue the computation of principal at maturity.                                   207963
      *                                                                                       207963
     C********** ZDAYNO    DOWLTMDAT                                                  207963 BUG7847
     C********** MAMNT     ANDGT0                                                     207963 BUG7847
      *                                                                                       207963
     C********** WLASD     IFNE ZDAYNO                                                207963 BUG7847
     C********** WLASD     ANDNE*ZEROS                                                207963 BUG7847
     C********** WSTAC     ANDEQ*BLANK                                                207963 BUG7847
     C**********           Z-ADDZDAYNO    ZIEND                                       207963 BUG7847
     C**********           EXSR SRINCL                                                207963 BUG7847
     C**********           ADD  ZINTR     WCALC                                       207963 BUG7847
     C**********           Z-ADDZDAYNO    WLASD                                       207963 BUG7847
     C********** RFRQ      IFNE ' '                                                   207963 BUG7847
     C**********           EXSR ZFREQB                                                207963 BUG7847
     C**********           ELSE                                                       207963 BUG7847
     C**********           Z-ADDMDAT      ZDAYNO                                      207963 BUG7847
     C**********           ENDIF                                                      207963 BUG7847
     C**********           ENDIF                                                      207963 BUG7847
      *                                                                                       207963
     C********** WCALC     SUB  WIPAID    WOUTIN                                      207963 BUG7847
      *                                                                                       207963
      ***Compute*for*the*interest*to*be*paid***************************               207963 BUG7847
      *                                                                                       207963
     C********** WOUTIN    IFLE RAMT                                                  207963 BUG7847
     C********** RAMT      SUB  WOUTIN    WPRAM  130                                  207963 BUG7847
     C**********           Z-ADDWOUTIN    WINTA  130                                  207963 BUG7847
      *                                                                                       207963
      ***If*over*paid**************************************************               207963 BUG7847
      *                                                                                       207963
     C********** WOUTIN    IFLT 0                                                     207963 BUG7847
     C**********           Z-ADDRAMT      WPRAM                                       207963 BUG7847
     C**********           Z-ADD0         WINTA                                       207963 BUG7847
     C**********           ENDIF                                                      207963 BUG7847
      *                                                                                       207963
     C**********           ELSE                                                       207963 BUG7847
     C**********           Z-ADD*ZEROS    WPRAM                                       207963 BUG7847
     C**********           Z-ADDRAMT      WINTA                                       207963 BUG7847
     C**********           ENDIF                                                      207963 BUG7847
      *                                                                                       207963
     C**********           ADD  WINTA     WIPAID                                      207963 BUG7847
     C********** WCUPR     IFGT 0                                                     207963 BUG7847
     C**********           SUB  WPRAM     WCUPR                                       207963 BUG7847
     C********** WCUPR     IFLT 0                                                     207963 BUG7847
     C**********           Z-ADD0         WCUPR                                       207963 BUG7847
     C**********           ENDIF                                                      207963 BUG7847
     C**********           ENDIF                                                      207963 BUG7847
      *                                                                                       207963
     C**********           ENDDO                                                      207963 BUG7847
      *                                                                                       207963
     C**********           Z-ADDWCUPR     MAMNT                                       207963 BUG7847
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** Check if there are existing frequency based repayments against   CLE014
      ** the loan.                                                        CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     Z-ADD1         Z       40                      CLE014
     C           LNRF      DOUEQWRLNRF                                    CLE014
     C********** WRLNRF    OREQ *ZERO                                                  CLE014 CLE148
     C           WRLNRF    OREQ *BLANKS                                                       CLE148
     C           Z         OCUR LEFRBS                                    CLE014
     C           LEFRBS    IFEQ *BLANK                                    CLE014
     C**********           Z-ADD*ZERO     WRLNRF                                       CLE014 CLE148
     C                     MOVEL*BLANKS   WRLNRF                                              CLE148
     C                     Z-ADD*ZERO     WRRAMT                          CLE014
     C                     ENDIF                                          CLE014
     C                     ADD  1         Z                               CLE014
     C                     ENDDO                                          CLE014
      *                                                                   CLE014
      ** If a repayment is found, subtract repayment amount to maturi     CLE014
      ** ty amount.                                                       CLE014
      *                                                                   CLE014
     C           LNRF      IFEQ WRLNRF                                    CLE014
     C**********           SUB  WRRAMT    MAMNT                                        CLE014 207963
     C                     MOVE 'Y'       WREPAY                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     Z-ADDMAMNT     ZFLD15                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ELSE                                           157191
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C                     ADD  1         C                               CLE014
     C           C         OCUR LEFRBS                                    CLE014
     C**********           Z-ADDLNRF      WRLNRF                                       CLE014 CLE148
     C                     MOVELLNRF      WRLNRF                                              CLE148
     C                     Z-ADDWRAMT     WRRAMT                          CLE014
     C                     MOVELCCY       SACCY                           CLE014
     C                     Z-ADDWRAMT     ZFLD15                          CLE014
     C                     ELSE                                           CLE014
     C           FREC      IFEQ 'LEMNFUPF'                                157214
     C           FREC      OREQ 'LEMNFUPE'                                                    189343
     C                     MOVELUCCY      SACCY                           157214
     C                     Z-ADDUAMT      ZFLD15                          157214
     C**********           Z-ADDCNUM      FCUS3                                        189570 CSD027
     C                     MOVE CNUM      FCUS3                                               CSD027
     C                     Z-ADDFACT      FTYP3                                               189570
     C                     Z-ADDFCNO      FSEQ3                                               189570
     C                     ELSE                                           157214
     C                     MOVELACCY      SACCY
     C                     Z-ADDAAMT      ZFLD15
     C                     ENDIF
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          157214
     C                     ENDIF                                          157191
     C                     ENDIF                                          157191
      *
     C***********          CALL 'AOCURRR0'                                128979
     C***********          PARM *BLANKS   PRTCD   7                       128979
     C***********          PARM '*KEY    'POPRN   7                       128979
     C***********          PARM SACCY     PK101   3                       128979
     C***********SDCURR    PARM SDCURR    DSSDY                           128979
      ***********                                                         128979
      ***Data*base error in file SDCURRPD                                 128979
      ***********                                                         128979
     C***********PRTCD     IFNE *BLANKS                                   128979
     C************LOCK     IN   LDA                                       128979
     C***********          SETON                       U7U8               128979
     C***********          Z-ADD04        DBASE            *************  128979
     C***********          MOVEL'SDCURRPD'DBFILE           * DB ERR 04 *  128979
     C***********          MOVELFCCY      DBKEY            *************  128979
     C***********          OUT  LDA                                       128979
     C***********          EXSR *PSSR                                     128979
     C***********          ENDIF                                          128979
      *
     C                     EXSR SRCVAM                                    128979
      *                                                                   128979
     C                     Z-ADDA6NBDP    ZDECS
     C                     EXSR ZFRPED
     C                     MOVE ZOUT25    SAAMT
      *
      ** Format Code
      *
     C           SSCODE    IFEQ *BLANKS
     C           SSCODE    OREQ 'A'                                       147488
      *
     C           FREC      IFEQ 'FACHISAF'
     C           FKSTRT    IFEQ 'Y'                                                        BUG22349A
     C           DTAP      IFLT BJRDNB                                                     BUG22349A
     C                     MOVEL'B'       SCODE                                            BUG22349A
     C                     ELSE                                                            BUG22349A
     C           DTAP      IFGE BJRDNB                                                     BUG22349A
     C                     MOVEL'F'       SCODE                                            BUG22349A
     C                     ENDIF                                                           BUG22349A
     C                     ENDIF                                                           BUG22349A
     C                     ELSE                                                            BUG22349A
     C********** DTAP      IFLT BJRDNB                                             BUG21833 BUG22349
     C**********           MOVEL'B'       SCODE                                    BUG21833 BUG22349
     C**********           ELSE                                                    BUG21833 BUG22349
     C********** DTAP      IFGE BJRDNB                                             BUG21833 BUG22349
     C**********           MOVEL'F'       SCODE                                    BUG21833 BUG22349
     C**********           ENDIF                                                   BUG21833 BUG22349
     C**********           ENDIF                                                   BUG21833 BUG22349
     C                     MOVEL'H'       SCODE
     C                     ENDIF                                                           BUG22349A
     C                     ENDIF
      *
     C           FREC      IFEQ 'LEFCAMPF'
      *
     C           VLDT      IFLT AGRDNB
     C                     MOVEL'B'       SCODE
     C                     ELSE
     C                     MOVEL'F'       SCODE
     C                     ENDIF
     C                     ENDIF
      *
     C           FREC      IFEQ 'LOAMSDKF'                                157191
     C***********VDAT      IFLT AGRDNB                             155749 188968
     C           VALDT     IFLT AGRDNB                                    188968
      *                                                                                       204669
      ** Check for Past Due loan amendments:                                                  204669
     C           AMTP      IFEQ 'PD'                                                          204669
     C                     MOVEL'P'       SCODE                                               204669
     C                     ELSE                                                               204669
     C                     MOVEL'B'       SCODE                           155749
     C                     ENDIF                                                              204669
      *                                                                                       204669
     C                     ELSE                                           155749
     C                     MOVEL'F'       SCODE                           157191
     C                     ENDIF                                          155749
     C                     MOVELCCYLA     SACCY                           190634
     C                     ENDIF                                          157191
      *
     C***********FREC      IFEQ 'CLOANCLF'                         157191 144088
     C           FREC      IFEQ 'CLOANCL1'                                144088
     C           FREC      OREQ 'CLOANCL2'                                144088
      *                                                                   157191
     C           VDAT      IFLT AGRDNB                                    157191
     C                     MOVEL'B'       SCODE                           157191
     C                     ELSE                                           157191
     C                     MOVEL'F'       SCODE                           157191
     C                     ENDIF                                          157191
     C                     ENDIF                                          157191
      *                                                                   CLE014
      ** If maturity date                                                 CLE014
      *                                                                   CLE014
     C           FREC      IFEQ 'CLOANCL3'                                CLE014
     C           MDAT      IFLT AGRDNB                                    CLE014
     C                     MOVEL'B'       SCODE                           CLE014
     C                     ELSE                                           CLE014
     C                     MOVEL'F'       SCODE                           CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C           NRPD      IFLT AGRDNB                                    CLE014
     C                     MOVEL'B'       SCODE                           CLE014
     C                     ELSE                                           CLE014
     C                     MOVEL'F'       SCODE                           CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *
     C           FREC      IFEQ 'LEMNFUPF'                                157214
      *                                                                   157214
     C           STDT      IFLT AGRDNB                                    157214
     C                     MOVEL'B'       SCODE                           157214
     C                     ELSE                                           157214
     C                     MOVEL'F'       SCODE                           157214
     C                     ENDIF                                          157214
     C                     ENDIF                                          157214
      *
     C           FREC      IFEQ 'LEMNFUPE'                                                    189343
      *                                                                                       189343
     C           EXDT      IFLT AGRDNB                                                        189343
     C                     MOVEL'B'       SCODE                                               189343
     C                     ELSE                                                               189343
     C                     MOVEL'F'       SCODE                                               189343
     C                     ENDIF                                                              189343
     C                     ENDIF                                                              189343
      *
     C                     ELSE
     C                     MOVELSSCODE    SCODE
     C                     ENDIF
      *
      ** Format Narrative
      *
     C           FREC      IFEQ 'FACHISAF'
     C                     MOVELFAACTN    WFATP   2
     C                     ELSE
     C           FREC      IFEQ 'LOAMSDKF'                                157191
     C                     MOVELAMTP      WFATP                           157191
     C                     ELSE                                           157191
     C***********FREC      IFEQ 'CLOANCLF'                         157191 144088
     C           FREC      IFEQ 'CLOANCL1'                                144088
     C           FREC      OREQ 'CLOANCL2'                                144088
     C                     MOVEL'ST'      WFATP                           157191
     C                     ELSE                                           157191
     C           FREC      IFEQ 'CLOANCL3'                                CLE014
     C                     MOVEL'MT'      WFATP                           CLE014
     C                     ELSE                                           CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C                     MOVE 'RE'      WFATP                           CLE014
     C                     ELSE                                           CLE014
     C           FREC      IFEQ 'LEMNFUPF'                                157214
     C***********          MOVE *BLANKS   WFATP                    157214 148722
     C                     MOVE 'US'      WFATP                           148722
     C                     Z-ADDSQNO      WSEQ    20                      CLE014
     C                     ELSE                                           157191
     C           FREC      IFEQ 'LEMNFUPE'                                                    189343
     C                     Z-ADDSQNO      WSEQ                                                189343
     C                     MOVE 'UE'      WFATP                                               189343
     C                     ELSE                                                               189343
     C                     MOVELFATP      WFATP
     C                     ENDIF                                          157214
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                                              189343
     C                     ENDIF                                          157191
     C                     ENDIF                                          157191
     C                     ENDIF
      *
     C           FREC      IFNE 'LEMNFUPF'                                157214
      *
     C                     MOVE *BLANKS   SFATP
     C                     MOVEL'-'       WLOAN7  7
     C           FREC      IFEQ 'FACHISAF'                                157191
     C                     MOVE FALOAN    WLOAN7
     C                     ELSE                                           157191
     C                     MOVE LNRF      WLOAN7                          157191
     C                     END                                            157191
     C                     MOVELWFATP     WLOAN   9
     C                     MOVE WLOAN7    WLOAN   9
     C                     MOVE WLOAN7    W#LOAN  6                       146108
      *
     C                     END                                            157214
      *                                                                   134808
     C                     MOVEL'-'       WUTIL4  4                       134808
     C           FREC      IFEQ 'LEMNFUPF'                                148722
     C                     MOVE SQNO      WUTIL4                          148722
     C                     ELSE                                           148722
     C           FREC      IFEQ 'LEMNFUPE'                                                    189343
     C                     MOVE SQNO      WUTIL4                                              189343
     C                     ELSE                                                               189343
     C                     MOVE FASQNO    WUTIL4                          134808
     C                     ENDIF                                                              189343
     C                     ENDIF                                          148722
     C                     MOVELWFATP     WUTIL   6                       134808
     C                     MOVE WUTIL4    WUTIL                           134808
      *                                                                                      BUG8261
     C           FREC      IFEQ 'FACHISAF'                                                   BUG8261
     C                     MOVEL'-'       RETL11 11                                          BUG8261
     C                     MOVE FAACNO    RETL11                                             BUG8261
     C                     MOVE RETL11    RETL   13                                          BUG8261
     C                     MOVELWFATP     RETL                                               BUG8261
     C                     MOVEL'-'       WDEAL7  7                                          BUG8261
     C                     MOVE FADEAL    WDEAL7                                             BUG8261
     C                     MOVE WDEAL7    WDEAL   9                                          BUG8261
     C                     MOVELWFATP     WDEAL                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                   128980
     C                     OTHER                                          128980
      *                                                                   128980
     C                     Z-ADDADAT      ZDAYNO                          128980
     C                     EXSR ZDATE2                                    128980
     C                     MOVELZADATE    SVLDT                           128980
      *                                                                   128980
     C                     MOVELCCY       SACCY                           128980
     C                     Z-ADDAMNT      ZFLD15                          128980
     C**********           Z-ADDCNUM      FCUS3   60                                   189570 CSD027
     C                     MOVE CNUM      FCUS3   6                                           CSD027
     C                     Z-ADDFACT      FTYP3   30                                          189570
     C                     Z-ADDFCNO      FSEQ3   20                                          189570
      *                                                                   190634
     C***********ATYP      IFNE 'RE'                                                   190634 189570
     C                     EXSR SRCVAM                                    128980
     C***********          END                                                         190634 189570
      *                                                                   190634
     C                     Z-ADDA6NBDP    ZDECS                           128980
     C                     EXSR ZFRPED                                    128980
     C                     MOVE ZOUT25    SAAMT                           128980
      *                                                                   128980
     C                     MOVE *BLANKS   SFATP                           128980
     C                     MOVELATYP      WFATP                           128980
     C                     MOVELCODE      SCODE                           128980
     C                     MOVEL'-'       WLOAN7                          128980
     C                     MOVE LNRF      WLOAN7                          128980
     C                     MOVELWFATP     WLOAN                           128980
     C                     MOVE WLOAN7    WLOAN                           128980
     C                     MOVE WLOAN7    W#LOAN                          128980
     C***********          MOVEL'-'       WUTIL4                   128980 162967
     C                     MOVE USEQ      WUTIL4                          128980
     C                     MOVE '1'       *IN07                                               189343
     C                     MOVEL'-'       WUTIL4                          162967
     C                     MOVELWFATP     WUTIL                           128980
     C                     MOVE WUTIL4    WUTIL                           128980
     C                     MOVEL'-'       WCUST7  7                                           246233
     C                     MOVE CNUM      WCUST7                                              246233
     C                     MOVE WCUST7    WCUST   9                                           246233
     C                     MOVELWFATP     WCUST                                               246233
     C                     ENDSL                                          128980
      *
     C           WFATP     IFEQ 'FI'
      *                                                                                       246233
     C           CNUM      IFEQ *ZEROS                                                        246233
     C********** SYIN      OREQ 'N'                                                  248167 MD029661
     C           SYIN      ORNE 'Y'                                                         MD029661
     C                     MOVEAATP@,1    SFATP
     C                     ELSE                                                               246233
      *                                                                                       246233
      ** check participant type                                                               246233
      *                                                                                       246233
     C                     MOVELCNUM      WCNUM                                               246233
     C                     MOVE FACT      WFACT                                               246233
     C                     MOVE FCNO      WFCNO                                               246233
     C                     MOVEL'A'       WRCDT                                               246233
     C           FCLKY     CHAINFCLTY                80                                       246233
      *                                                                                       246233
     C                     SELEC                                                              246233
     C           PRTR      WHEQ 'A'                                                           246233
     C                     MOVEAATP@,51   SFATP                                               246233
     C           PRTR      WHEQ 'I'                                                           246233
     C                     MOVEAATP@,52   SFATP                                               246233
     C           PRTR      WHEQ 'P'                                                           246233
     C                     MOVEAATP@,53   SFATP                                               246233
     C           PRTR      WHEQ 'R'                                                           246233
     C                     MOVEAATP@,54   SFATP                                               246233
     C           PRTR      WHEQ 'S'                                                           246233
     C                     MOVEAATP@,55   SFATP                                               246233
     C                     ENDSL                                                              246233
     C*                    MOVE CNUM      SFATP                                               246233
     C                     MOVELWCUST     SFATP                                               246233
     C                     ENDIF                                                              246233
      *                                                                                       246233
     C                     ENDIF
      *
     C           WFATP     IFEQ 'FD'
     C                     MOVEAATP@,2    SFATP
     C                     ENDIF
      *
     C           WFATP     IFEQ 'FR'
     C                     MOVEAATP@,3    SFATP
     C                     ENDIF
      *
     C           WFATP     IFEQ 'RC'
     C**********           MOVEAATP@,4    SFATP                                               251034
     C                     MOVEAATP@,4    WFTP30 30                                           251034
     C           FREC      IFEQ 'FACHISAF'                                                    195865
     C                     MOVELFARCIN    WRVCR                                               195865
     C                     ELSE                                                               195865
     C**********           MOVELRVCR      WRVCR   3                       CLE014
     C**********           MOVELRVCR      WRVCR   4                                    CLE014 214838
     C**********           MOVELRVCR      WRVCR   5                                    214838 CLE031
     C***********          MOVELRVCR      WRVCR   6                                   CLE031 BUG8221
     C                     MOVELRVCR      WRVCR   5                                          BUG8221
     C                     ENDIF                                                              195865
     C**********           MOVE WRVCR     SFATP                                               251034
     C           WFTP30    CAT  WRVCR     SFATP     P                                         251034
     C                     MOVE *BLANKS   SACCY
     C                     MOVE *BLANKS   SAAMT
     C                     ENDIF
      *
     C           WFATP     IFEQ 'US'
     C           FREC      IFEQ 'FACHISAF'                                                    189343
     C                     Z-ADDFADATE    PDATE   50                                          189343
     C                     Z-ADDFASQNO    PSEQ    30                                          189343
      *                                                                                       189343
     C           WLEMN     SETLLLEMNFUL7                                                      189343
     C           WLEMN     READELEMNFUL7                 09                                   189343
     C           *IN09     IFEQ '0'                                                           189343
     C                     Z-ADDEXDTLJ    EXDT                                                189343
     C                     ELSE                                                               189343
     C                     Z-ADD1         EXDT                                                189343
     C                     ENDIF                                                              189343
     C                     ENDIF                                                              189343
      *                                                                                       189343
      ** if *IN07 is switced on and Credit agreement                                          189343
      *                                                                                       189343
     C           *IN07     IFEQ '1'                                                           189343
     C           TRCA      ANDEQ'CA'                                                          189343
     C           CODE      ANDEQ'H'                                                           189343
      *                                                                                       189343
     C           *IN15     IFEQ '0'                                                           189343
     C           *LOVAL    SETLLLEFATRL0                                                      189343
     C                     ELSE                                                               189343
     C           WLEF      SETGTLEFATRL0                                                      189343
     C                     ENDIF                                                              189343
      *                                                                                       189343
     C           WLE213    IFEQ 'Y'                                                           189343
     C           WLE214    OREQ 'Y'                                                         BUG22126
     C           WSRRN     ANDGT0                                                             189343
     C                     READ LEFATRL0                 16                                   189343
     C                     ENDIF                                                              189343
     C           *IN16     IFEQ '0'                                                           189343
     C                     Z-ADDTREXDT    EDAT                                                189343
     C                     ENDIF                                                              189343
     C                     MOVE '1'       *IN15                                               189343
     C                     ENDIF                                                              189343
      *                                                                                       189343
     C           *IN07     IFEQ '0'                                                           189343
     C           EXDT      ANDEQ*ZEROS                                                        189343
      *                                                                                       189343
     C           *IN07     OREQ '1'                                                           189343
     C           EDAT      ANDEQ*ZEROS                                                        189343
     C                     MOVEAATP@,28   SFATP                                               189343
     C                     ELSE                                                               189343
     C                     MOVEAATP@,5    SFATP
     C                     ENDIF                                                              189343
     C                     MOVELWUTIL     SFATP                           134808
     C                     ENDIF
      *
     C           WFATP     IFEQ 'UI'
     C                     MOVEAATP@,6    SFATP
     C                     MOVELWUTIL     SFATP                           134808
     C                     ENDIF
      *
     C           WFATP     IFEQ 'UD'
     C                     MOVEAATP@,7    SFATP
     C                     MOVELWUTIL     SFATP                           134808
     C                     ENDIF
      *
     C           WFATP     IFEQ 'UE'
     C                     MOVEAATP@,8    SFATP
     C                     MOVELWUTIL     SFATP                           134808
     C                     ENDIF
      *
     C           WFATP     IFEQ 'ST'
     C***********          Z-ADDFALOAN    LNRF                     136624 146108
     C                     MOVE W#LOAN    LNRF                            146108
     C                     MOVE CCY       WCCY    3        Save CCY                           206187
     C           LNRF      CHAINCLOAN                89                   136624
      *                                                                   136624
     C           *IN89     IFEQ '1'                                       136624
     C           LNRF      CHAINMLOAN                89                   136624
     C                     ENDIF                                          136624
     C                     MOVE WCCY      CCY                                                 206187
     C           *IN89     IFEQ '1'                                       136624
     C                     MOVE PRTR      LPFI                            136624
     C                     ENDIF                                          136624
     C           LPFI      IFEQ *BLANK                                    136624
      *                                                                                       189343
      ** If maturity date is blank, narrative should be at call                               189343
      *                                                                                       189343
     C           MDAT      IFEQ 0                                                             189343
     C                     MOVEAATP@,27   SFATP                                               189343
     C                     ELSE                                                               189343
     C                     MOVEAATP@,9    SFATP
     C                     ENDIF                                                              189343
     C********** SYIN      IFEQ 'N'                                162967 189587
     C           SYIN      IFNE 'Y'                                       189587
     C           PTYP      IFEQ 66                                        162967
     C           PTYP      OREQ 67                                        162967
     C           PTYP      OREQ 69                                        162967
     C           PTYP      OREQ 72                                        162967
     C                     MOVEAATP@,21   SFATP                           162967
     C                     ENDIF                                          162967
     C                     ENDIF                                          162967
      *                                                                   162967
     C                     ENDIF                                          136624
     C           LPFI      IFEQ 'I'                                       136624
     C                     MOVEAATP@,20   SFATP                           136624
     C                     ENDIF                                          136624
     C           LPFI      IFEQ 'P'                                       136624
     C                     MOVEAATP@,21   SFATP                           136624
     C                     ENDIF                                          136624
     C           LPFI      IFEQ 'R'                                       146108
     C                     MOVEAATP@,26   SFATP                           146108
     C                     ENDIF                                          146108
     C           LPFI      IFEQ 'A'                                       136624
     C                     MOVEAATP@,22   SFATP                           136624
     C                     ENDIF                                          136624
     C           LPFI      IFEQ 'S'                                                           CLE106
     C                     MOVEAATP@,35   SFATP                                               CLE106
     C                     ENDIF                                                              CLE106
     C                     MOVELWLOAN     SFATP
     C                     ENDIF
      *
     C           WFATP     IFEQ 'PF'                                      157544
     C                     MOVEAATP@,23   SFATP                           157544
     C                     MOVELWLOAN     SFATP                           157544
     C                     ENDIF                                          157544
      *
      *
     C           WFATP     IFEQ 'PT'                                      157544
     C                     MOVEAATP@,24   SFATP                           157544
     C                     MOVELWLOAN     SFATP                           157544
     C                     ENDIF                                          157544
      *
     C           WFATP     IFEQ 'IC'
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C**********           MOVEAATP@,32   SFATP                                        CLE028 244511
     C                     MOVEAATP@,34   SFATP                                               244511
     C                     ELSE                                                               CLE028
     C                     MOVEAATP@,10   SFATP
     C                     ENDIF                                                              CLE028
     C                     MOVELWLOAN     SFATP
     C                     ENDIF
      *                                                                                       CLE028
     C           WFATP     IFEQ 'CH'                                                          CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C**********           MOVEAATP@,31   SFATP                                        CLE028 244511
     C                     MOVEAATP@,33   SFATP                                               244511
     C                     MOVELWLOAN     SFATP                                               CLE028
     C                     ENDIF                                                              CLE028
      *
     C           WFATP     IFEQ 'PI'
     C                     MOVEAATP@,11   SFATP
     C                     MOVELWLOAN     SFATP
     C                     ENDIF
      *                                                                                       204669
     C           WFATP     IFEQ 'PD'                                                          204669
     C**********           MOVEAATP@,31   SFATP                                        204669 244511
     C                     MOVEAATP@,32   SFATP                                               244511
     C                     MOVELWLOAN     SFATP                                               204669
     C                     ENDIF                                                              204669
      *
     C           WFATP     IFEQ 'WO'
     C                     MOVEAATP@,12   SFATP
     C                     MOVELWLOAN     SFATP
     C                     ENDIF
      *                                                                   136628
     C           WFATP     IFEQ 'MR'                                      136628
     C                     MOVEAATP@,25   SFATP                           136628
     C                     MOVELWLOAN     SFATP                           136628
     C                     ENDIF                                          136628
      *                                                                   136628
      *
     C           WFATP     IFEQ 'RE'
     C                     MOVEAATP@,13   SFATP
     C                     MOVELWLOAN     SFATP
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     MOVE *BLANK    WFREQ   1                       CLE014
     C           WLE213    IFEQ *BLANK                                    CLE014
     C           WLE214    ANDEQ*BLANK                                                      BUG22126
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C                     MOVE RFRQ      WFREQ                           CLE014
     C                     ENDIF                                          CLE014
     C           WLE213    IFEQ 'Y'                                       CLE014
     C           FREQ      ANDNE*BLANK                                    CLE014
     C           WLE214    OREQ 'Y'                                                         BUG22126
     C           FREQ      ANDNE*BLANK                                                      BUG22126
     C                     MOVE FREQ      WFREQ                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           WFREQ     IFNE *BLANK                                    CLE014
     C                     SELEC                                          CLE014
     C           WFREQ     WHEQ 'W'                                       CLE014
     C           SFATP     CAT  WWEEK:1   SFATP                           CLE014
     C           WFREQ     WHEQ 'F'                                       CLE014
     C           SFATP     CAT  WFNIGT:1  SFATP                           CLE014
     C           WFREQ     WHEQ 'M'                                       CLE014
     C           SFATP     CAT  WMNTH:1   SFATP                           CLE014
     C           WFREQ     WHEQ 'T'                                       CLE014
     C           SFATP     CAT  W2MNTH:1  SFATP                           CLE014
     C           WFREQ     WHEQ 'Q'                                       CLE014
     C           SFATP     CAT  WQUAR:1   SFATP                           CLE014
     C           WFREQ     WHEQ 'X'                                       CLE014
     C           SFATP     CAT  W6MNTH:1  SFATP                           CLE014
     C           WFREQ     WHEQ 'Y'                                       CLE014
     C           SFATP     CAT  WYEAR:1   SFATP                           CLE014
     C                     ENDSL                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDIF
      *
     C           WFATP     IFEQ 'MT'
     C                     MOVEAATP@,14   SFATP
     C                     MOVELWLOAN     SFATP
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           WREPAY    IFEQ 'Y'                                       CLE014
     C           EXFR      OREQ 'Y'                                       CLE014
     C           WLE213    ANDEQ'Y'                                       CLE014
     C           EXFR      OREQ 'Y'                                                         BUG22126
     C           WLE214    ANDEQ'Y'                                                         BUG22126
     C           SFATP     CAT  WEXREP:1  SFATP                           CLE014
     C                     MOVE *BLANK    WREPAY  1                       CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF
      *
     C           WFATP     IFEQ 'RV'
     C                     MOVEAATP@,15   SFATP
     C                     MOVELWLOAN     SFATP
     C                     ENDIF
      *
     C           WFATP     IFEQ 'FS'
     C                     MOVEAATP@,16   SFATP
     C                     ENDIF
      *                                                                   127723
     C           WFATP     IFEQ 'TC'                                      127723
     C**********           MOVEAATP@,17   SFATP                                        127723 251034
     C                     MOVEAATP@,17   WFTP27 27                                           251034
     C**********           MOVE *BLANKS   WWRK6   6                                    127723 214838
     C**********           MOVELFCTI      WWRK6                                        127723 214838
     C**********           MOVE WWRK6     SFATP                                        127723 214838
     C**********           MOVE *BLANKS   WWRK8   8                                    214838 CLE031
     C**********           MOVE *BLANKS   WWRK8   9                                    214838 251034
     C**********           MOVELFCTI      WWRK8                                        214838 251034
     C**********           MOVE WWRK8     SFATP                                        214838 251034
     C           WFTP27    CAT  FCTI      SFATP     P                                         251034
     C                     MOVE *BLANKS   SACCY                           127723
     C                     MOVE *BLANKS   SAAMT                           127723
     C                     ENDIF                                          127723
     C/COPY WNCPYSRC,LEH00059
      *                                                                   127723
     C           WFATP     IFEQ 'FE'                                      127723
     C                     MOVEAATP@,18   SFATP                           127723
     C                     MOVE *BLANKS   SACCY                           127723
     C                     MOVE *BLANKS   SAAMT                           127723
     C                     ENDIF                                          127723
      *                                                                   127723
     C           WFATP     IFEQ 'FC'                                      127723
     C                     MOVEAATP@,19   SFATP                           127723
     C                     MOVE *BLANKS   SACCY                           127723
     C                     MOVE *BLANKS   SAAMT                           127723
     C                     ENDIF                                          127723
      *                                                                                       194912
     C           WFATP     IFEQ 'MC'                                                          194912
     C                     MOVEAATP@,29   SFATP                                               194912
     C                     MOVELWLOAN     SFATP                                               194912
     C                     ENDIF                                                              194912
      *                                                                                       CLE023
     C           WFATP     IFEQ 'RO'                                                          CLE023
     C                     MOVEAATP@,30   SFATP                                               CLE023
     C                     MOVELWLOAN     SFATP                                               CLE023
     C                     ENDIF                                                              CLE023
      *
     C           WFATP     IFEQ 'S1'                                                         BUG8261
     C                     MOVEAATP@,35   SFATP                                              BUG8261
     C                     MOVELWDEAL     SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'I1'                                                         BUG8261
     C                     MOVEAATP@,36   SFATP                                              BUG8261
     C                     MOVELWDEAL     SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'C1'                                                         BUG8261
     C                     MOVEAATP@,37   SFATP                                              BUG8261
     C                     MOVELWDEAL     SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'M1'                                                         BUG8261
     C                     MOVEAATP@,38   SFATP                                              BUG8261
     C                     MOVELWDEAL     SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'D1'                                                         BUG8261
     C                     MOVEAATP@,39   SFATP                                              BUG8261
     C                     MOVELWDEAL     SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'FX'                                                         BUG8261
     C                     MOVEAATP@,40   SFATP                                              BUG8261
     C                     MOVELWDEAL     SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'F0'                                                         BUG8261
     C                     MOVEAATP@,41   SFATP                                              BUG8261
     C                     MOVELWDEAL     SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'FW'                                                         BUG8261
     C                     MOVEAATP@,42   SFATP                                              BUG8261
     C                     MOVELWDEAL     SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'FV'                                                         BUG8261
     C                     MOVEAATP@,43   SFATP                                              BUG8261
     C                     MOVELWDEAL     SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'IR'                                                         BUG8261
     C                     MOVEAATP@,44   SFATP                                              BUG8261
     C                     MOVELWDEAL     SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'IS'                                                         BUG8261
     C                     MOVEAATP@,45   SFATP                                              BUG8261
     C                     MOVELWDEAL     SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'FM'                                                         BUG8261
     C                     MOVEAATP@,46   SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'AS'                                                         BUG8261
     C                     MOVEAATP@,47   SFATP                                              BUG8261
     C                     MOVELRETL      SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'AC'                                                         BUG8261
     C                     MOVEAATP@,48   SFATP                                              BUG8261
     C                     MOVELRETL      SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
     C           WFATP     IFEQ 'AR'                                                         BUG8261
     C                     MOVEAATP@,49   SFATP                                              BUG8261
     C                     MOVELRETL      SFATP                                              BUG8261
     C                     ENDIF                                                             BUG8261
      *                                                                                      BUG8261
      ** Check if screen inputs have been changed                                            BUG7847
      *                                                                                      BUG7847
     C                     EXSR SRCHK                                                        BUG7847
      *                                                                                      BUG7847
     C           FREC      IFEQ 'CLOANCL3'                                                   BUG7847
     C           FREC      OREQ 'CLOANCL5'                                                   BUG7847
     C                     EXSR SRPNRD                                                       BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDSR
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      * SRINCL  -  Interest calculation                               *   CLE014
      * Called by: SRFRMT                                             *   CLE014
      *                                                               *   CLE014
      * Calls    : GLINTC                                             *   CLE014
      *****************************************************************   CLE014
     C           SRINCL    BEGSR                                          CLE014
      *                                                                   CLE014
      ** Do not compute for interest if not greater than 0                CLE014
      *                                                                   CLE014
     C           WCURT     IFLE *ZEROS                                    CLE014
     C           CPAM      OREQ *ZEROS                                    CLE014
     C                     Z-ADD*ZEROS    ZINTR                           CLE014
     C                     ELSE                                           CLE014
      *                                                                   CLE014
     C                     Z-ADDWLICD     ZIBEG                           CLE014
     C                     MOVE WICBS     ZICALC                          CLE014
     C                     Z-ADDWCUPR     ZIAMT                           CLE014
     C                     Z-ADDWCURT     ZIRATE                          CLE014
      *                                                                                       CLE028
      ** Instead of executing SR/GLINTC, process RULE78 if CLE028 is on,                      CLE028
      ** and processing type (PTYP) is 80                                                     CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     Z-ADDVDAT      W78VDT                                              CLE028
     C                     Z-ADDMDAT      W78MDT                                              CLE028
     C                     Z-ADDFLTI      W78FLT                                              CLE028
     C                     MOVE RFRQ      W78RPF                                              CLE028
     C                     Z-ADDFRPD      W78FRD                                              CLE028
     C                     Z-ADDRDYN      W78RPM                                              CLE028
     C                     MOVE CCY       W78CCY                                              CLE028
     C                     MOVE *BLANKS   W78LCN                                              CLE028
     C                     Z-ADDZIBEG     W78BEG                                              CLE028
     C                     Z-ADDZIEND     W78END                                              CLE028
     C                     MOVE 'A'       W78ROA                                              CLE028
     C                     EXSR RULE78                                                        CLE028
     C                     Z-ADDW78INT    ZINTR                                               CLE028
     C                     Z-ADDW78NPY    WNPY    50                                          CLE028
      *                                                                                       CLE028
     C                     ELSE                                                               CLE028
     C/COPY WNCPYSRC,LEH01298
     C                     EXSR GLINTC                                    CLE014
     C                     ENDIF                                                              CLE028
      *                                                                   CLE014
      ** Round down interest if required                                  CLE014
      *                                                                   CLE014
     C           RDFC      IFEQ 'Y'                                       CLE014
     C           PTYP      ANDNE80                                                            CLE028
     C                     Z-ADDZINTR     RDWORK 130                      CLE014
     C                     Z-ADDRDWORK    ZINTR                           CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADDZINTR     RUWORK 130H                     CLE014
     C                     Z-ADDRUWORK    ZINTR                           CLE014
     C                     ENDIF                                          CLE014
     C                     Z-ADDZIEND     WLICD                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDSR                                          CLE014
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      * SRNEWI  -  Compute for new interest rate                      *   CLE014
      * Called by: SRFRMT                                             *   CLE014
      *                                                               *   CLE014
      * Calls    : None                                               *   CLE014
      *****************************************************************   CLE014
     C           SRNEWI    BEGSR                                          CLE014
      *                                                                   CLE014
      ** Reflect spread to effective interest                             CLE014
      *                                                                   CLE014
     C                     SELEC                                          CLE014
     C           WCUSI     WHEQ 'A'                                       CLE014
     C           WCUBR     ADD  WCUSP     WCURT                           CLE014
     C           WCUSI     WHEQ 'S'                                       CLE014
     C           WCUBR     SUB  WCUSP     WCURT                           CLE014
     C           WCUSI     WHEQ 'P'                                       CLE014
     C           WCUSP     DIV  100       WWORK  119                      CLE014
     C           WCUBR     MULT WWORK     WCURT                           CLE014
     C                     ENDSL                                          CLE014
      *                                                                   CLE014
     C                     ENDSR                                          CLE014
      /EJECT                                                              CLE014
      *                                                                   CLE014
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      *                                                               *   CLE014
      *  SRRAMT  -  Set Repayment Amount                              *   CLE014
      *                                                               *   CLE014
      *  Called by: SRFRMT                                            *   CLE014
      *  Calls:                                                       *   CLE014
      *  GLINTC - Calculates interest                                 *   CLE014
      *                                                               *   CLE014
      *****************************************************************   CLE014
      *                                                                   CLE014
     C           SRRAMT    BEGSR                                          CLE014
      *                                                                   CLE014
      ** Initialise repayment amount workfield                            CLE014
      *                                                                   CLE014
     C                     Z-ADD*ZERO     WRAMT  150                      CLE014
     C                     SELEC                                          CLE014
      *                                                                   CLE014
      ** Repayment type 1 or 2                                            CLE014
      *                                                                   CLE014
     C           REPT      WHEQ 1                                         CLE014
     C           REPT      OREQ 2                                         CLE014
     C                     Z-ADDRAMT      WRAMT                           CLE014
      *                                                                   CLE014
      ** Repayment type 3                                                 CLE014
      *                                                                   CLE014
     C           REPT      WHEQ 3                                         CLE014
      *                                                                   CLE014
      ** Compute for interest                                             CLE014
      *                                                                   CLE014
     C                     Z-ADDSLID      ZIBEG                           CLE014
     C                     Z-ADDNRPD      ZIEND                           CLE014
     C                     Z-ADDICBS      ZICALC                          CLE014
     C                     Z-ADDCPAM      ZIAMT                           CLE014
     C                     Z-ADDINTR      ZIRATE                          CLE014
      *                                                                                       CLE028
      ** Instead of executing SR/GLINTC, process RULE78 if CLE028 is on,                      CLE028
      ** and processing type (PTYP) is 80                                                     CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     Z-ADDVDAT      W78VDT                                              CLE028
     C                     Z-ADDMDAT      W78MDT                                              CLE028
     C                     Z-ADDFLTI      W78FLT                                              CLE028
     C                     MOVE RFRQ      W78RPF                                              CLE028
     C                     Z-ADDFRPD      W78FRD                                              CLE028
     C                     Z-ADDRDYN      W78RPM                                              CLE028
     C                     MOVE CCY       W78CCY                                              CLE028
     C                     MOVE *BLANKS   W78LCN                                              CLE028
     C                     Z-ADDZIBEG     W78BEG                                              CLE028
     C                     Z-ADDZIEND     W78END                                              CLE028
     C                     MOVE 'R'       W78ROA                                              CLE028
     C                     EXSR RULE78                                                        CLE028
     C                     Z-ADDW78INT    ZINTR                                               CLE028
     C                     Z-ADDW78NPY    WNPY    50                                          CLE028
      *                                                                                       CLE028
     C                     ELSE                                                               CLE028
     C/COPY WNCPYSRC,LEH01299
     C                     EXSR GLINTC                                    CLE014
     C                     ENDIF                                                              CLE028
      *                                                                   CLE014
      ** Round down interest if required                                  CLE014
      *                                                                   CLE014
     C           RDFC      IFEQ 'Y'                                       CLE014
     C           PTYP      ANDNE80                                                            CLE028
     C                     Z-ADDZINTR     WRDOWN 130                      CLE014
     C                     Z-ADDWRDOWN    ZINTR                           CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADDZINTR     WRUP   130H                     CLE014
     C                     Z-ADDWRUP      ZINTR                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           RAMT      SUB  ZINTR     WRAMT                           CLE014
      *                                                                                       CLE028
      ** For flat rate personal loans, if add on charges is 'Y'                               CLE028
      ** subtract charge amount per payment to RAMT                                           CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADCF      ANDEQ'Y'                                                           CLE028
     C           CHGA      DIV  WNPY      WCHGA  130                                          CLE028
     C           WRAMT     SUB  WCHGA     WRAMT                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                   CLE014
     C                     ENDSL                                          CLE014
      *                                                                   CLE014
     C                     ENDSR                                          CLE014
      *                                                                   CLE014
      *****************************************************************   CLE014
      *
      /EJECT                                                              128979
      *****************************************************************   128979
      *                                                               *   128979
      *  SRCVAM  -  Convert Amount                                    *   128979
      *                                                               *   128979
      *  Called by: SRFRMT                                            *   128979
      *  Calls    : SRCURR                                            *   128979
      *                                                               *   128979
      *****************************************************************   128979
      *                                                                   128979
     C           SRCVAM    BEGSR                                          128979
      *                                                                   128979
     C                     MOVE '0'       *IN40                                               189570
     C           SACCY     IFNE WFCCY                                     128979
      *                                                                   128979
     C                     MOVE SACCY     WCCY    3                       128979
     C                     Z-ADD004       WBASE   30                      128979
     C                     MOVELSACCY     WBKEY   7                       128979
     C                     EXSR SRCURR                                    128979
      *                                                                   128979
     C***********          MOVE A6NBDP    FCDP    10               128979 155749
     C***********          MOVE A6SPRT    ZRATE1 138               128979 155749
     C***********          MOVE A6MDIN    ZMDI1   1                128979 155749
     C                     MOVE A6NBDP    WCDP2   10                      155749
     C                     MOVE A6SPRT    WRATE2 138                      155749
     C                     MOVE A6MDIN    WMDI2   1                       155749
      *                                                                   128979
     C                     MOVE WFCCY     WCCY                            128979
     C                     Z-ADD005       WBASE                           128979
     C                     MOVELWFCCY     WBKEY                           128979
     C                     EXSR SRCURR                                    128979
      *                                                                   128979
     C***********          MOVE A6SPRT    ZRATE2 138               128979 155749
     C***********          MOVE A6MDIN    ZMDI2   1                128979 155749
     C***********          EXSR ZXRATE                             128979 155749
      *                                                                   155749
     C***********          SELEC                                                       147999 189570
     C***********WFCCY     WHNE BJCYCD                                                 147999 189570
     C           WFCCY     IFNE BJCYCD                                                        189570
     C           A6MDIN    IFEQ 'M'                                       155749
     C***********A6SPRT    ANDNE1                                  155749 147999
     C***********A6MDIN    OREQ 'D'                                155749 147999
     C***********A6SPRT    ANDNE1                                  155749 147999
     C                     MOVE 'D'       WFMIN   1                       155749
     C                     ELSE                                           155749
     C                     MOVE 'M'       WFMIN                           155749
     C                     ENDIF                                          155749
      *                                                                   155749
     C           A6MDIN    IFEQ 'M'                                       155749
     C           WMDI2     ANDEQ'M'                                       155749
     C***********A6SPRT    ANDNE1                                  155749 147999
     C           A6MDIN    OREQ 'D'                                       155749
     C           WMDI2     ANDEQ'D'                                       155749
     C***********A6SPRT    ANDNE1                                  155749 147999
     C           A6SPRT    DIV  WRATE2    WRATEX 138H                     155749
     C                     ELSE                                           155749
     C           A6SPRT    MULT WRATE2    WRATEX    H                     155749
     C                     ENDIF                                          155749
     C                     MOVE 'Y'       WFLAG                           147999
     C                     ENDIF                                                              189570
      *                                                                   155749
     C***********          OTHER                                                       147999 189570
     C           WFCCY     IFEQ BJCYCD                                                        189570
     C                     Z-ADDWRATE2    WRATEX                          147999
     C                     Z-ADD1         WEXRT                                               189570
     C***********A6SPRT    IFEQ 1                                  155749 147999
     C***********WMDI2     ANDEQ'M'                                155749 147999
     C           WMDI2     IFEQ 'M'                                       147999
     C                     MOVE 'N'       WFLAG   1                       155749
     C                     MOVE 'M'       WFMIN                           147999
     C                     ELSE                                           155749
     C                     MOVE 'Y'       WFLAG                           155749
     C                     MOVE 'D'       WFMIN                           155749
     C                     ENDIF                                          155749
     C***********          ENDSL                                                       147999 189570
     C                     ENDIF                                                              189570
      *                                                                   128979
     C***********FCDP      SUB  A6NBDP    DP      10               128979 155459
     C***********A6NBDP    SUB  FCDP      DP      10               155459 155749
     C           A6NBDP    SUB  WCDP2     DP      10                      155749
     C                     ADD  4         DP                              128979
      *                                                                   155749
     C           WFLAG     IFEQ 'Y'                                       155749
     C           WFMIN     IFEQ 'D'                                       155749
     C           WRATEX    DIV  POWR,DP   WEXRT  159H                     155749
     C           1         DIV  WEXRT     WEXRT                           155749
     C                     ELSE                                           155749
     C           WRATEX    MULT POWR,DP   WEXRT     H                     155749
     C                     ENDIF                                          155749
     C                     ELSE                                           155749
     C           WRATEX    MULT POWR,DP   WEXRT     H                     155749
     C                     ENDIF                                          155749
      *                                                                   155749
     C***********ZMDIX     IFEQ 'D'                                128979 155749
     C***********ZRATEX    DIV  POWR,DP   WEXRT  159H              128979 155749
     C***********1         DIV  WEXRT     WEXRT                    128979 155749
     C***********          ELSE                                    128979 155749
     C***********ZRATEX    MULT POWR,DP   WEXRT     H              128979 155749
     C***********          ENDIF                                   128979 155749
     C***********          MULT WEXRT     ZFLD15                   128979 155459
     C**********           Z-ADDLNRF      WLNRF                                        189567 CLE148
     C                     MOVELLNRF      WLNRF                                               CLE148
     C           WLNRF     CHAINCLOAN                32                                       189567
      *                                                                                       189567
     C           *IN32     IFEQ '1'                                                           189567
     C           WLNRF     CHAINMLOAN                32                                       189567
     C                     ENDIF                                                              189567
      * What is number of decimal places in Facility currency?                                206328
     C                     MOVE FCCY      WCCY                                                206328
     C                     Z-ADD006       WBASE                                               206328
     C                     MOVELFCCY      WBKEY                                               206328
     C                     EXSR SRCURR                                                        206328
     C                     MOVE A6NBDP    WCDP3   10                                          206328
     C           A6NBDP    SUB  WCDP2     DP      10                                          206328
     C                     ADD  4         DP                                                  206328
      *                                                                                       206328
     C           *IN32     IFEQ '0'                                                           189570
     C           FCXR      IFEQ *ZEROS                                                        189567
     C           FCXR      OREQ 1                                                             189567
     C************IN32     OREQ '1'                                                    189567 189570
     C           TRCA      IFNE 'CA'                                                          189570
     C           TRCAX     ANDNE'CA'                                                          189570
     C                     MULT WEXRT     ZFLD15    H                     155459
     C                     ELSE                                                               189570
     C                     MOVE '1'       *IN40                                               189570
     C                     ENDIF                                                              189570
     C                     ELSE                                                               189567
     C           FMDI      IFEQ 'D'                                                           189567
     C           FCXR      DIV  POWR,DP   WFCXRT 159H                                         189567
     C           1         DIV  WFCXRT    WFCXRT                                              189567
     C                     ELSE                                                               189567
     C           FCXR      MULT POWR,DP   WFCXRT    H                                         189567
     C                     ENDIF                                                              189567
     C                     MULT WFCXRT    ZFLD15    H                                         189567
     C                     ENDIF                                                              189567
     C                     ENDIF                                                              189570
      **If*action*being*processed*is*an*MFU,*convert*using*rate:********              214897 BUG4333
     C********** FREC      IFEQ 'LEMNFUPF'                                            214897 BUG4333
     C********** FREC      OREQ 'LEMNFUPE'                                            214897 BUG4333
      *                                                                                       190370
     C**********           Z-ADDFCUS3     FCUS                                         189570 CSD027
     C                     MOVE FCUS3     FCUS                                                CSD027
     C                     Z-ADDFTYP3     FTYP                                                189570
     C                     Z-ADDFSEQ3     FSEQ                                                189570
     C           WLE213    IFNE *BLANKS                                                       189570
     C           WLE214    ANDNE*BLANKS                                                     BUG22126
     C                     Z-ADDUSEQ      SQNO                                                189570
     C                     ENDIF                                                              189570
      *                                                                                       190370
      * If action being processed is an MFU, convert using rate:                             BUG4333
     C           FREC      IFEQ 'LEMNFUPF'                                                   BUG4333
     C           FREC      OREQ 'LEMNFUPE'                                                   BUG4333
     C           MFUKY     KLIST                                                              190370
     C                     KFLD           BRCA                                                190370
     C                     KFLD           FCUS                                                190370
     C                     KFLD           FTYP                                                190370
     C                     KFLD           FSEQ                                                190370
     C                     KFLD           SQNO                                                190370
      *                                                                                       190370
     C           MFUKY     CHAINLEMNFUL0             33                                       189570
     C           *IN33     IFEQ '0'                                                           189570
     C           UXRT      IFEQ *ZEROS                                                        189570
     C           TRCA      IFNE 'CA'                                                          189570
     C           TRCAX     ANDNE'CA'                                                          189570
     C                     MULT WEXRT     ZFLD15    H                                         189570
     C                     ELSE                                                               189570
     C                     MOVE '1'       *IN40                                               189570
     C                     ENDIF                                                              189570
     C                     ELSE                                                               189570
     C           UXID      IFEQ 'D'                                                           189570
     C           UXRT      DIV  POWR,DP   WFCXRT    H                                         189570
     C           1         DIV  WFCXRT    WFCXRT                                              189570
     C                     ELSE                                                               189570
     C           UXRT      MULT POWR,DP   WFCXRT    H                                         189570
     C                     ENDIF                                                              189570
     C                     MULT WFCXRT    ZFLD15    H                                         189570
     C                     ENDIF                                                              189570
     C                     ENDIF                                                              189570
     C                     ENDIF                                                              214897
      *                                                                                       190370
     C           *IN32     IFEQ '1'                                                           189570
     C           *IN33     ANDEQ'1'                                                           189570
     C                     MULT WEXRT     ZFLD15    H                                         189570
     C                     ENDIF                                                              189570
      *                                                                                       190370
      ** If Credit Agreement use Tranche CA rate                                              190370
      *                                                                                       190370
     C           TRCA      IFEQ 'CA'                                                          190370
     C           TRCAX     OREQ 'CA'                                                          190370
      *                                                                                       190370
     C           FKEY2     KLIST                                                              190370
     C                     KFLD           FCUS                                                190370
     C                     KFLD           FTYP                                                190370
     C                     KFLD           FSEQ                                                190370
     C                     KFLD           WRCTP   1                                           190370
      *                                                                                       190370
     C           *IN41     IFEQ '0'                                                           190370
     C                     MOVE TRCA      TRCAX   2                                           190370
     C                     MOVE '1'       *IN41                                               190370
     C                     ENDIF                                                              190370
      *                                                                                       190370
     C                     MOVEL'A'       WRCTP                                               190370
     C                     MOVELFTYP      WCAFT   50                                          190370
     C                     MOVE FSEQ      WCAFT                                               190370
      *                                                                                       190370
     C           FKEY2     CHAINFCLTYFMF             55                                       190370
      *                                                                                       190370
     C           *IN55     IFEQ '1'                                                           190370
     C           *LOCK     IN   LDA                                                           190370
     C                     SETON                     U7U8                                     190370
     C                     MOVE *BLANKS   DBKEY                                               190370
     C                     MOVEL'FCLTY   'DBFILE           ***************                    190370
     C                     MOVEL'008'     DBASE            * DBERROR 008 *                    190370
     C                     MOVELFCUS      DBKEY            ***************                    190370
     C                     MOVE WCAFT     DBKEY                                               190370
     C                     MOVEL'LE0211'  DBPGM                                               190370
     C                     OUT  LDA                                                           190370
     C                     EXSR *PSSR                                                         190370
     C                     ENDIF                                                              190370
      *                                                                                       190370
     C                     Z-ADDCAXR      WCAXR  138                                          190370
     C                     MOVELCMDI      WCMDI   1                                           190370
      *                                                                                       206328
      * What is number of decimal places in Credit Agreeemnt Ccy?                             206328
     C                     MOVE CACY      WCCY                                                206328
     C                     Z-ADD007       WBASE                                               206328
     C                     MOVELCACY      WBKEY                                               206328
     C                     EXSR SRCURR                                                        206328
     C           A6NBDP    SUB  WCDP3     DP      10                                          206328
     C                     ADD  4         DP                                                  206328
      *                                                                                       193070
     C           WCAXR     IFNE 0                                                             190370
     C           WFCCY     ANDNEFCCY                                                          190370
     C           WFCCY     ANDNESACCY                                                         190370
     C           FCCY      ANDNESACCY                                                         190370
     C********** LNRF      IFNE 0                                                      190370 CLE148
     C           LNRF      IFNE *BLANKS                                                       CLE148
     C           FCXR      ANDNE0                                                             190370
     C           FCXR      ANDNE1                                                             190370
     C           USEQ      ORNE 0                                                             190370
     C           UXRT      ANDNE0                                                             190370
     C           WCMDI     IFEQ 'D'                                                           190370
     C           WCAXR     DIV  POWR,DP   CAXRT  159H                                         190370
     C           1         DIV  CAXRT     CAXRT     H                                         199655
     C                     ELSE                                                               190370
     C           WCAXR     MULT POWR,DP   CAXRT     H                                         190370
     C                     END                                                                190370
     C                     MULT CAXRT     ZFLD15    H                                         190370
     C                     END                                                                190370
     C                     END                                                                190370
      *                                                                                       193070
     C           WFCCY     IFNE FCCY                                                          190370
     C           *IN40     ANDEQ'1'                                                           190370
     C           WCAXR     IFNE 0                                                             190370
     C           WCMDI     IFEQ 'D'                                                           190370
     C           WCAXR     DIV  POWR,DP   CAXRT  159H                                         190370
     C           1         DIV  CAXRT     CAXRT                                               190370
     C                     ELSE                                                               190370
     C           WCAXR     MULT POWR,DP   CAXRT     H                                         190370
     C                     END                                                                190370
     C                     MULT CAXRT     ZFLD15    H                                         190370
     C                     ELSE                                                               190370
     C                     MULT WEXRT     ZFLD15    H                                         189570
     C                     ENDIF                                                              190370
     C                     ENDIF                                                              190370
      *                                                                                       193070
     C                     END                                                                190370
      *                                                                                       193070
     C                     MOVE WFCCY     SACCY                           128979
     C                     ENDIF                                          128979
      *                                                                   128979
     C                     ENDSR                                          128979
      *                                                                   128979
      /EJECT                                                              128979
      *****************************************************************   128979
      *                                                               *   128979
      *  SRCURR    : Access Currency Details                          *   128979
      *                                                               *   128979
      *  Called By : SRCVAM                                           *   128979
      *  Calls     : None                                             *   128979
      *                                                               *   128979
      *****************************************************************   128979
      *                                                                   128979
     C           SRCURR    BEGSR                                          128979
      *                                                                   128979
     C                     CALL 'AOCURRR0'                                128979
     C                     PARM '*MSG   ' @RTCD   7                       128979
     C                     PARM '*KEY   ' @OPTN   7                       128979
     C                     PARM WCCY      @AJCD   3                       128979
     C           SDCURR    PARM SDCURR    DSSDY                           128979
      *                                                                   128979
      **  Handle Database Error.                                          128979
      *                                                                   128979
     C           @RTCD     IFNE *BLANKS                                   128979
     C                     MOVEL'SDCURRPD'DBFILE           ***************128979
     C                     Z-ADDWBASE     DBASE            * DBERROR XXX *128979
     C                     MOVELWBKEY     DBKEY            ***************128979
     C                     EXSR *PSSR                                     128979
     C                     ENDIF                                          128979
      *                                                                   128979
     C                     ENDSR                                          128979
      *                                                                   128979
      /EJECT
      *****************************************************************
      *                                                               *
      *  *PSSR   -  Program exception error routine                   *
      *             Called automatically if a program error occurs,   *
      *             or directly by the program code using EXSR.       *
      *             This subroutine DUMPs the program just once.      *
      *                                                               *
      *  Called by: (**calling routines**)                            *
      *  Calls: None                                                  *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR SR **
      *
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     CALL 'DBERRCTL'
     C                     END
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  ZASNMS  -  Sends messages to the program's message queue     *
      *                                                               *
      *  Called by:                                                   *
      *  Calls    :                                                   *
      *  Y2SNMGC -  Send a message                                    *
      *                                                               *
      *****************************************************************
      *
     C           ZASNMS    BEGSR
      *
     C                     MOVE *ON       *IN20
      *
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGMQ 10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRCLRS  -  Clears the subfile message queue                  *
      *                                                               *
      *  Called by:                                                   *
      *  Calls    :                                                   *
      *  Y2CLMSC -  Clear specified program message queue             *
      *                                                               *
      *****************************************************************
      *
     C           SRCLRS    BEGSR
      *
     C                     CALL 'Y2CLMSC'
     C                     PARM SPGM      ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      *
     C                     ENDSR
      *****************************************************************                      BUG7847
      *                                                               *                      BUG7847
      *  SRCHK - Check if screen inputs have been changed             *                      BUG7847
      *                                                               *                      BUG7847
      *  Called by: SRFRMT                                            *                      BUG7847
      *                                                               *                      BUG7847
      *  Calls    : None                                              *                      BUG7847
      *                                                               *                      BUG7847
      *****************************************************************                      BUG7847
      *                                                                                      BUG7847
     C           SRCHK     BEGSR                                                             BUG7847
      *                                                                                      BUG7847
     C                     MOVE 'N'       WCHGIN                                             BUG7847
      *                                                                                      BUG7847
     C           WPBRCA    IFNE SSBRCA                                                       BUG7847
     C           WPCUST    ORNE SSCUST                                                       BUG7847
     C           WPFACT    ORNE SSFACT                                                       BUG7847
     C           WPFCNO    ORNE SSFCNO                                                       BUG7847
     C           WPVLDT    ORNE SSVLDT                                                       BUG7847
     C           WPCODE    ORNE SSCODE                                                       BUG7847
     C                     Z-ADD*ZERO     WDAYNO                                             BUG7847
     C                     MOVE 'Y'       WCHGIN                                             BUG7847
     C                     MOVE SSBRCA    WPBRCA                                             BUG7847
     C                     MOVE SSCUST    WPCUST                                             BUG7847
     C                     MOVE SSFACT    WPFACT                                             BUG7847
     C                     MOVE SSFCNO    WPFCNO                                             BUG7847
     C                     MOVE SSVLDT    WPVLDT                                             BUG7847
     C                     MOVE SSCODE    WPCODE                                             BUG7847
     C                     Z-ADD1         SSREC                                              BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDSR                                                             BUG7847
      *                                                                                      BUG7847
      *****************************************************************                      BUG7847
      *                                                               *                      BUG7847
      *  SRPNRD - Project the Next Repayment Date routine             *                      BUG7847
      *                                                               *                      BUG7847
      *  Called by: SRFRMT                                            *                      BUG7847
      *                                                               *                      BUG7847
      *  Calls    : None                                              *                      BUG7847
      *                                                               *                      BUG7847
      *****************************************************************                      BUG7847
      *                                                                                      BUG7847
     C           SRPNRD    BEGSR                                                             BUG7847
      *                                                                                      BUG7847
      ** For repayment types 1 and 3                                                         BUG7847
      *                                                                                      BUG7847
     C           WREPT     IFEQ 1                                                            BUG7847
     C           WREPT     OREQ 3                                                            BUG7847
     C                     EXSR SRPR13                                                       BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
      ** For repayment type 2                                                                BUG7847
      *                                                                                      BUG7847
     C           WREPT     IFEQ 2                                                            BUG7847
     C                     EXSR SRPR2                                                        BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     Z-ADD*ZERO     WDAYNO                                             BUG7847
      *                                                                                      BUG7847
      ** Save existing frequency based repayments                                            BUG7847
      *                                                                                      BUG7847
     C           CLE014    IFEQ 'Y'                                                          BUG7847
     C           FREC      ANDEQ'CLOANCL5'                                                   BUG7847
     C                     ADD  1         C                                                  BUG7847
     C           C         OCUR LEFRBS                                                       BUG7847
     C**********           Z-ADDLNRF      WRLNRF                                      BUG7847 CLE148
     C                     MOVELLNRF      WRLNRF                                              CLE148
     C                     Z-ADDWRAMT     WRRAMT                                             BUG7847
     C                     MOVELCCY       SACCY                                              BUG7847
     C                     Z-ADDWRAMT     ZFLD15                                             BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
      ** Display Maturity                                                                    BUG7847
      *                                                                                      BUG7847
     C           FREC      IFEQ 'CLOANCL3'                                                   BUG7847
      *                                                                                      BUG7847
     C                     Z-ADDMDAT      ZDAYNO                                             BUG7847
     C                     EXSR ZDATE2                                                       BUG7847
     C                     MOVELZADATE    SVLDT                                              BUG7847
      *                                                                                      BUG7847
     C                     Z-ADDMAMNT     ZFLD15                                             BUG7847
     C                     MOVELCCY       SACCY                                             BUG13187
     C                     EXSR SRCVAM                                                       BUG7847
      *                                                                                      BUG7847
     C                     Z-ADDA6NBDP    ZDECS                                              BUG7847
     C                     EXSR ZFRPED                                                       BUG7847
     C                     MOVE ZOUT25    SAAMT                                              BUG7847
      *                                                                                      BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
      ** Exit loop upon return to sub routine SRSFIL                                         BUG7847
      *                                                                                      BUG7847
     C           *INKC     IFEQ *ON                                                          BUG7847
     C           *INKE     OREQ *ON                                                          BUG7847
     C                     Z-ADD9999      WSRRN                                              BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDSR                                                             BUG7847
      *                                                                                      BUG7847
      *****************************************************************                      BUG7847
      *                                                               *                      BUG7847
      *  SRPR2 - Project the Next Repayment Date routine              *                      BUG7847
      *             for repayment type 2                              *                      BUG7847
      *                                                               *                      BUG7847
      *  Called by: SRPNRD - Project the Next Repayment Date          *                      BUG7847
      *                                                               *                      BUG7847
      *  Calls    : ZDATE2, ZFREQB, SRDISP                            *                      BUG7847
      *                                                               *                      BUG7847
      *****************************************************************                      BUG7847
      *                                                                                      BUG7847
     C           SRPR2     BEGSR                                                             BUG7847
      *                                                                                      BUG7847
     C                     MOVE 'N'       WEXTLP                                             BUG7847
      *                                                                                      BUG7847
      ** Continue the computation of principal at maturity                                   BUG7847
      **    and display the projected next repayment date                                    BUG7847
      **    while F3=Exit or F5=Refresh is not pressed                                       BUG7847
      **    or exit loop (WEXTLP) = 'N' (becomes 'Y' when                                    BUG7847
      **    screen inputs are changed (WCHGIN = 'Y')                                         BUG7847
      *                                                                                      BUG7847
      ** For repayment type 2, repayment is wholly for principal                             BUG7847
      *                                                                                      BUG7847
     C                     MOVE ZDAYNO    TDAYNO  50                                        AR830785
     C           ZDAYNO    DOWLTMDAT                                                         BUG7847
     C           ZDAYNO    ANDGETDAYNO                                                      AR830785
     C           MAMNT     ANDGT0                                                            BUG7847
     C           *INKC     ANDEQ*OFF                                                         BUG7847
     C           *INKE     ANDEQ*OFF                                                         BUG7847
     C           WEXTLP    ANDEQ'N'                                                          BUG7847
      *                                                                                      BUG7847
     C                     SUB  RAMT      MAMNT                                              BUG7847
     C           MAMNT     IFLE RAMT                                                         BUG7847
     C                     Z-ADDMAMNT     WPRAM                                              BUG7847
     C                     ELSE                                                              BUG7847
     C                     Z-ADDRAMT      WPRAM                                              BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     Z-ADDZDAYNO    WLASD                                              BUG7847
      *                                                                                      BUG7847
      ** Format Due Date                                                                     BUG7847
      *                                                                                      BUG7847
     C                     EXSR ZDATE2                                                       BUG7847
     C                     MOVELZADATE    SVLDT                                              BUG7847
      *                                                                                      BUG7847
     C           RFRQ      IFNE ' '                                                          BUG7847
     C                     EXSR ZFREQB                                                       BUG7847
     C                     ELSE                                                              BUG7847
     C                     Z-ADDMDAT      ZDAYNO                                             BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C           MAMNT     IFLT 0                                                            BUG7847
     C                     Z-ADD0         MAMNT                                              BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     EXSR SRDISP                                                       BUG7847
      *                                                                                      BUG7847
     C                     MOVE 'Y'       WPNRPD                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDDO                                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDSR                                                             BUG7847
      *                                                                                      BUG7847
      *****************************************************************                      BUG7847
      *                                                               *                      BUG7847
      *  SRPR13 - Project the Next Repayment Date routine             *                      BUG7847
      *           for repayment types 1 and 3                         *                      BUG7847
      *                                                               *                      BUG7847
      *  Called by: SRPNRD - Project the Next Repayment Date          *                      BUG7847
      *                                                               *                      BUG7847
      *  Calls    : SRINCL, ZDATE2, ZFREQB, SRDISP                    *                      BUG7847
      *                                                               *                      BUG7847
      *****************************************************************                      BUG7847
      *                                                                                      BUG7847
     C           SRPR13    BEGSR                                                             BUG7847
      *                                                                                      BUG7847
     C                     MOVE 'N'       WEXTLP                                             BUG7847
      *                                                                                      BUG7847
      ** Continue the computation of principal at maturity                                   BUG7847
      **    and display the projected next repayment date                                    BUG7847
      **    while F3=Exit or F5=Refresh is not pressed                                       BUG7847
      **    or exit loop (WEXTLP) = 'N' (becomes 'Y' when                                    BUG7847
      **    screen inputs are changed (WCHGIN = 'Y')                                         BUG7847
      *                                                                                      BUG7847
     C           WREPT     IFEQ 1                                                             249836
     C                     Z-ADDMAMNT     WCUPR                                               249836
     C                     ENDIF                                                              249836
      *                                                                                       249836
     C                     MOVE ZDAYNO    TDAYNO                                            AR830785
     C           ZDAYNO    DOWLTMDAT                                                         BUG7847
     C           ZDAYNO    ANDGETDAYNO                                                      AR830785
     C           MAMNT     ANDGT0                                                            BUG7847
     C           *INKC     ANDEQ*OFF                                                         BUG7847
     C           *INKE     ANDEQ*OFF                                                         BUG7847
     C           WEXTLP    ANDEQ'N'                                                          BUG7847
      *                                                                                      BUG7847
     C           WLASD     IFNE ZDAYNO                                                       BUG7847
     C           WLASD     ANDNE*ZEROS                                                       BUG7847
     C           WSTAC     ANDEQ*BLANK                                                       BUG7847
     C                     Z-ADDZDAYNO    ZIEND                                              BUG7847
     C                     EXSR SRINCL                                                       BUG7847
     C                     ADD  ZINTR     WCALC                                              BUG7847
     C                     Z-ADDZDAYNO    WLASD                                              BUG7847
      *                                                                                      BUG7847
      ** Format Due Date                                                                     BUG7847
      *                                                                                      BUG7847
     C                     EXSR ZDATE2                                                       BUG7847
     C                     MOVELZADATE    SVLDT                                              BUG7847
      *                                                                                      BUG7847
     C           RFRQ      IFNE ' '                                                          BUG7847
     C                     EXSR ZFREQB                                                       BUG7847
     C                     ELSE                                                              BUG7847
     C                     Z-ADDMDAT      ZDAYNO                                             BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
      ** For repayment types 1 and 3, compute for separate principal                         BUG7847
      ** and interest repayments for the repayment made                                      BUG7847
      *                                                                                      BUG7847
     C           WREPT     IFEQ 1                                                            BUG7847
     C                     Z-ADDRAMT      WPRAM                                              BUG7847
     C                     Z-ADDZINTR     WINTA                                              BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C           WREPT     IFEQ 3                                                            BUG7847
      *                                                                                      BUG7847
     C           WCALC     SUB  WIPAID    WOUTIN                                             BUG7847
      *                                                                                      BUG7847
      ** Compute for the interest to be paid                                                 BUG7847
      *                                                                                      BUG7847
     C           WOUTIN    IFLE RAMT                                                         BUG7847
      *                                                                                      BUG7847
     C           WOUTIN    IFGE 0                                                            BUG7847
     C           RAMT      SUB  WOUTIN    WPRAM                                              BUG7847
     C                     ELSE                                                              BUG7847
     C                     Z-ADDRAMT      WPRAM                                              BUG7847
     C                     ENDIF                                                             BUG7847
     C                     Z-ADDWOUTIN    WINTA                                              BUG7847
      *                                                                                      BUG7847
     C                     ELSE                                                              BUG7847
     C                     Z-ADD*ZEROS    WPRAM                                              BUG7847
     C                     Z-ADDRAMT      WINTA                                              BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C           WCUPR     IFLT WPRAM                                                        BUG7847
     C                     Z-ADDWCUPR     WPRAM                                              BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     ADD  WINTA     WIPAID                                             BUG7847
     C           WCUPR     IFGT 0                                                            BUG7847
     C                     SUB  WPRAM     WCUPR                                              BUG7847
      *                                                                                      BUG7847
     C           WCUPR     IFLT 0                                                            BUG7847
     C                     Z-ADD0         WCUPR                                              BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     EXSR SRDISP                                                       BUG7847
      *                                                                                      BUG7847
     C                     MOVE 'Y'       WPNRPD                                             BUG7847
      *                                                                                      BUG7847
     C                     Z-ADDWCUPR     MAMNT                                              BUG7847
      *                                                                                      BUG7847
     C                     ENDDO                                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDSR                                                             BUG7847
      *                                                                                      BUG7847
      *****************************************************************                      BUG7847
      *                                                               *                      BUG7847
      *  SRDISP - Display the Projected Next Repayment Date           *                      BUG7847
      *                                                               *                      BUG7847
      *  Called by: SRPR2  - Project the Next Repayment Date routine  *                      BUG7847
      *             for repayment type 2                              *                      BUG7847
      *                                                               *                      BUG7847
      *             SRPR13 - Project the Next Repayment Date routine  *                      BUG7847
      *             for repayment types 1 and 3                       *                      BUG7847
      *                                                               *                      BUG7847
      *  Calls    : SRCVAM, ZFRPED, SRCHK                             *                      BUG7847
      *                                                               *                      BUG7847
      *****************************************************************                      BUG7847
      *                                                                                      BUG7847
     C           SRDISP    BEGSR                                                             BUG7847
      *                                                                                      BUG7847
     C           FREC      IFEQ 'CLOANCL5'                                                   BUG7847
     C           WPRAM     ANDGT*ZERO                                                        BUG7847
     C           WLASD     ANDGTWDAYNO                                                       BUG7847
     C                     MOVELCCY       SACCY                                               253809
     C                     Z-ADDWPRAM     ZFLD15                                             BUG7847
     C                     EXSR SRCVAM                                                       BUG7847
      *                                                                                      BUG7847
      ** Format Amount                                                                       BUG7847
      *                                                                                      BUG7847
     C                     Z-ADDA6NBDP    ZDECS                                              BUG7847
     C                     EXSR ZFRPED                                                       BUG7847
     C                     MOVE ZOUT25    SAAMT                                              BUG7847
      *                                                                                      BUG7847
     C                     MOVE *ON       *IN24                                              BUG7847
     C                     ADD  1         WSRRN                                              BUG7847
      *                                                                                      BUG7847
      ** Lookup if WSRRN = 11                                                                BUG7847
      *                                                                                      BUG7847
     C           WSRRN     IFLE 10                                                           BUG7847
     C                     ADD  1         SRRN                                               BUG7847
     C                     WRITELE0211S0                                                     BUG7847
     C                     Z-ADDWLASD     WDAYNO                                             BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
      ** Display the next projected repayment date                                           BUG7847
      *                                                                                      BUG7847
     C           WSRRN     IFGE 10                                                           BUG7847
     C                     WRITELE0211F1                                                     BUG7847
     C                     WRITELE0211C1                                                     BUG7847
     C                     EXFMTLE0211C0                                                     BUG7847
     C                     ADD  10        SSREC                                              BUG7847
     C                     Z-ADD*ZERO     WSRRN                                              BUG7847
     C                     EXSR SRCHK                                                        BUG7847
      *                                                                                      BUG7847
     C           WCHGIN    IFEQ 'Y'                                                          BUG7847
     C                     MOVE 'Y'       WEXTLP                                             BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDIF                                                             BUG7847
      *                                                                                      BUG7847
     C                     ENDSR                                                             BUG7847
      *                                                                                      BUG7847
      ********************************************************************
     C/COPY ZSRSRC,ZDATE1Z2
     C/COPY ZSRSRC,ZDATE2Z2
     C/COPY ZSRSRC,ZFRPEDZ3
     C/COPY ZSRSRC,GLINTCZ1                                               CLE014
     C/COPY ZSRSRC,ZINTDYZ2                                               CLE014
     C/COPY ZSRSRC,ZDATE9Z3                                               CLE014
     C/COPY ZSRSRC,ZDAT10Z2                                               CLE014
     C***/COPY*ZSRSRC,ZXRATEZ1                                     128979 155749
     C/COPY ZSRSRC,ZFREQBZ2                                                                   207963
     C/COPY ZSRSRC,ZACCH                                                                      207963
     C/COPY ZSRSRC,ZCHKH                                                                      207963
     C/COPY ZSRSRC,RULE78Z1                                                                   CLE028
      *                                                                   134808
      ** Change the utilization narrative to include the utilization      134808
      ** sequence number.                                                 134808
      *                                                                   134808
      ** Changed the narrative in ATP@,21 to say 'Fund' Participant                           CLE106
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**  POWR   **      POWERS OF TEN                                          128979
0000001                                                                   128979
0000010                                                                   128979
0000100                                                                   128979
0001000                                                                   128979
0010000                                                                   128979
0100000                                                                   128979
1000000                                                                   128979
**  ATP@
FI-Facility Amount Increase
FD-Facility Amount Decrease
FR-Facility Reactivation
RC-Revolving Credit Change to X
US-999 Manual Utilisation Start
UI-999 Utilisation Inc due to amend
UD-999 Utilisation Dec due to amend
UE-999 Manual Utilisation End
ST-999999 Start of Loan
IC-999999 Interest Capitalisation
PI-999999 Principal Increase
WO-999999 Write-off
RE-999999 Repayment
MT-999999 Maturity
RV-999999 Reversal
FS-Facility Start
TC-Facility Type Change to X                                              127723
FE-Facility Expiry                                                        127723
FC-Facility Closure                                                       127723
ST-999999 Loan for Int Participant                                        136624
ST-999999 Loan for Participant                                            136624 CLE106       241821
ST-999999 Loan for Agent                                                  136624
PF-999999 Principal Transfer from
PT-999999 Principal Transfer to
MR-999999 Repayment
ST-999999 Loan for Risk Participant                                       146108
ST-999999 Start of loan (at call)                                                             189343
US-999 Manual Util. Start-at call                                                             189343
MC-999999 Multi-ccy Redraw                                                                    194912
RO-999999 Rollover Fclty Exch Rate                                                            CLE023
RO-999999 Roll Fac Rate Chg Repay                                                             CLE031
PD-999999 Past Due Principal                                                                  204669
CH-999999 Charges added on                                                                    CLE028
IC-999999 Interest added on                                                                   CLE028
S1-999999 MM Loan Start                                                                      BUG8261
I1-999999 MM Loan Principal Increase                                                         BUG8261
C1-999999 MM Loan Interest Capitalisation                                                    BUG8261
M1-999999 MM Loan Maturity                                                                   BUG8261
D1-999999 MM Loan Prinicipal Decrease                                                        BUG8261
FX-999999 FX Mark-to-market revaluation                                                      BUG8261
F0-999999 FX Expiry                                                                          BUG8261
FW-999999 FRA Mark-to-market revaluation                                                     BUG8261
FV-999999 FRA Expiry                                                                         BUG8261
IR-999999 IRS Mark-to-market revaluation                                                     BUG8261
IS-999999 IRS Expiry                                                                         BUG8261
FM-FX Margin                                                                                 BUG8261
AS-9999999999 Account Start                                                                  BUG8261
AC-9999999999 Account Movement                                                               BUG8261
AR-9999999999 Account Spot Revaluation                                                       BUG8261
ST-999999 Loan for Sub Participant                                                            CLE106
FI-999999 Fclty Inc for Agent Part                                                            246233
FI-999999 Fclty Inc for Internal Part                                                         246233
FI-999999 Fclty Inc for Funding Part                                                          246233
FI-999999 Fclty Inc for Risk Part                                                             246233
FI-999999 Fclty Inc for Sub-Part Part                                                         246233
     X/COPY WNCPYSRC,LEH00080                                                               AR936915
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN    CLE014
00366007310109601461                                                      CLE014
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR       CLE014
00000000310005900090001200015100181002120024300273003040033400365         CLE014
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH                                                     207963
312831303130313130313031                                                                      207963
