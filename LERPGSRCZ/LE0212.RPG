     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Loan activity enq (w/ repay freq and bal)')   *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE0212 - Loan Activity Enquiry w/ repay freq and cur balance *
      *                                                               *
      *  Function:  This is a new program for loan activity enquiry   *
      *             and is similar in function to LE0210.  The addi-  *
      *             tional functions are (1) balance as of date line  *
      *             is now being shown on a change of date where there*
      *             is also a change of principal, (2) date input is  *
      *             available if different from due date, and         *
      *             (3) forward repayments until next rollover date   *
      *             or maturity date.  This program is called instead *
      *             of LE0210 if CEU004 is installed.                 *
      *                                                               *
      *  Called By: LEC0306 - Loan Activity Enquiry                   *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. MD039651           Date 11Aug16               *
      *  Prev Amend No. 252942             Date 17Dec15               *
      *                 MD039619           Date 05Aug16               *
      *                 MD039618           Date 29Jul16               *
      *                 CLE154             Date 09Aug12               *
      *                 MD039391A          Date 21Jul16               *
      *                 MD039391           Date 05Jul16               *
      *                 MD020807A          Date 05Jul16               *
      *                 MD039187           Date 03Jun16               *
      *                 MD038831           Date 19May16               *
      *                 CLE141A            Date 28Apr16               *
      *                 CLE141             Date 08Feb16               *
      *                 MD031378           Date 23Jun15               *
      *                 AR1071639          Date 12Mar15               *
      *                 AR1049090          Date 25Feb15               *
      *                 MD031977           Date 22Jan15               *
      *                 MD031067           Date 19Nov14               *
      *                 231400             Date 31Oct14               *
      *                 MD028338           Date 25Nov14               *
      *                 253760             Date 19Aug14               *
      *                 MD023475           Date 06May14               *
      *                 MD025520           Date 02Apr14               *
      *                 MD021007           Date 25Jun13               *
      *                 AR954985           Date 06Jun13               *
      *                 AR948604           Date 06Jun13               *
      *                 AR860576           Date 06Jun13               *
      *                 MD020852           Date 14Jun13               *
      *                 AR830785           Date 07May13               *
      *                 AR811339A          Date 11Aug11               *
      *                 AR1054816          Date 24Apr13               *
      *                 MD019846           Date 11Apr13               *
      *                 260891             Date 07Feb13               *
      *                 AR742875           Date 07Feb13               *
      *                 AR1076951          Date 19Jan13               *
      *                 AR1068354          Date 21Dec12               *
      *                 AR996895           Date 25Nov12               *
      *                 AR982563           Date 09Nov12               *
      *                 AR720887           Date 09Nov12               *
      *                 AR753186           Date 10Oct12               *
      *                 AR816406           Date 14Oct12               *
      *                 AR401496           Date 30Sep12               *
      *                 AR728070           Date 01Aug12               *
      *                 AR400094A          Date 01Aug12               *
      *                 AR400094           Date 01Aug12               *
      *                 AR317473           Date 01Aug12               *
      *                 263918             Date 01Aug12               *
      *                 263418A            Date 01Aug12               *
      *                 263411             Date 01Aug12               *
      *                 263418             Date 01Aug12               *
      *                 263417             Date 01Aug12               *
      *                 263412             Date 01Aug12               *
      *                 263361             Date 01Aug12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR634884           Date 27Jul12               *
      *                 AR317587           Date 19Aug11               *
      *                 AR826143           Date 07Sep11               *
      *                 AR835977           Date 29Sep11               *
      *                 AR747510           Date 30May11               *
      *                 CLE064             Date 06Dec10               *
      *                 251331             Date 22Nov07               *
      *                 AR583389           Date 09Aug10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 BUG23177           Date 11Mar09               *
      *                 BUG22332A          Date 09Feb09               *
      *                 BUG22581           Date 03Feb09               *
      *                 BUG22381           Date 29Jan09               *
      *                 BUG22332           Date 29Jan09               *
      *                 BUG22066           Date 14Jan09               *
      *                 BUG21868           Date 05Jan09               *
      *                 BUG21922           Date 07Jan09               *
      *                 260221             Date 21May09               *
      *                 260274             Date 15May09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 257301             Date 22Oct08               *
      *                 255285             Date 16Jul08               *
      *                 249398             Date 04Aug07               *
      *                 249397             Date 04Aug07               *
      *                 249160             Date 04Aug07               *
      *                 248506             Date 28Jun07               *
      *                 242909             Date 23Jul07               *
      *                 247978             Date 23May07               *
      *                 247791             Date 21May07               *
      *                 247071             Date 17Apr07               *
      *                 246141             Date 29Mar07               *
      *                 249835B            Date 02Oct07               *
      *                 249972             Date 04Sep07               *
      *                 249835A            Date 04Sep07               *
      *                 249835             Date 23Aug07               *
      *                 245109             Date 19Jan07               *
      *                 245082             Date 30Jan07               *
      *                 245073             Date 19Jan07               *
      *                 244453             Date 08Jan06               *
      *                 164847             Date 30Nov06               *
      *                 244097             Date 30Nov06               *
      *                 243394             Date 27Nov06               *
      *                 243078             Date 17Oct06               *
      *                 242852             Date 03Nov06               *
      *                 239062             Date 31Oct06               *
      *                 BUG13282           Date 19Feb07               *
      *                 BUG13074           Date 29Jan07               *
      *                 BUG12990           Date 05Jan07               *
      *                 BUG13017           Date 05Jan07               *
      *                 BUG12851           Date 22Dec06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 BUG12918           Date 18Dec06               *
      *                 BUG12917           Date 18Dec06               *
      *                 BUG12787           Date 04Dec06               *
      *                 238722             Date 26Sep06               *
      *                 242286             Date 26Sep06               *
      *                 224758             Date 18Sep06               *
      *                 241579             Date 09Aug06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 240696             Date 04Jul06               *
      *                 238739             Date 03May06               *
      *                 235907             Date 06Jun06               *
      *                 224740             Date 06Jun06               *
      *                 225849             Date 06Jun06               *
      *                 CLE042             Date 06Sep05               *
      *                 BUG9240            Date 16Nov05               *
      *                 BUG9052            Date 24Oct05               *
      *                 CLE106             Date 01Aug04               *
      *                 CLE038             Date 04Jun04               *
      *                 218984R            Date 05Nov03               *
      *                 222380             Date 22Oct03               *
      *                 CLE036             Date 15Oct03               *
      *                 CSW037A            Date 02May05               *
      *                 CIR013             Date 25Apr05               *
      *                 225344             Date 01Mar04               *
      *                 224764             Date 03Feb04               *
      *                 224646             Date 28Jan04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG4318            Date 30Sep04               *
      *                 BUG3832            Date 28Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 221558             Date 29Sep03               *
      *                 219717             Date 11Sep03               *
      *                 219500             Date 11Jul03               *
      *                 218984             Date 24Jun03               *
      *                 CLE031             Date 17Mar03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 212308             Date 26Feb03               *
      *                 202726             Date 25Nov02               *
      *                 201343             Date 23Oct02               *
      *                 190005             Date 23Oct02               *
      *                 209517             Date 11Oct02               *
      *                 209383             Date 11Oct02               *
      *                 209381             Date 11Oct02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 210367             Date 16Oct02               *
      *                 210268             Date 11Oct02               *
      *                 206256             Date 29Aug02               *
      *                 207629             Date 16Aug02               *
      *                 207961             Date 15Aug02               *
      *                 205705             Date 11Jun02               *
      *                 204656             Date 25Apr02               *
      *                 204544             Date 25Apr02               *
      *                 204127             Date 24Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 165648             Date 11Feb02               *
      *                 200089             Date 11Jan02               *
      *                 188806             Date 19Sep01               *
      *                 193701             Date 12Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 194375             Date 23Jul01               *
      *                 186180             Date 19Jul01               *
      *                 190638             Date 19Jun01               *
      *                 CDE002             Date 04Apr00               *
      *                 193339             Date 12Jun01               *
      *                 189899             Date 05Jun01               *
      *                 CLE014             Date 20Mar01               *
      *                 189089             Date 05Jun01               *
      *                 186708             Date 31May01               *
      *                 186995             Date 29May01               *
      *                 190760             Date 21May01               *
      *                 188382             Date 22Apr01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 187890             Date 06Mar01               *
      *                 184903             Date 25Feb01               *
      *                 184897             Date 14Feb01               *
      *                 CLE011             Date 07Nov00               *
      *                 180161             Date 27Jan01               *
      *                 187261             Date 16Jan01               *
      *                 187274             Date 15Jan01               *
      *                 157669             Date 07Dec00               *
      *                 184959             Date 21Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 181312             Date 10Nov00               *
      *                 CSD007             Date 28Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 172540             Date 31Jan00               *
      *                 169694             Date 15Nov99               *
      *                 169700             Date 05Nov99               *
      *                 169696             Date 02Nov99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 154011             Date 22Jul99               *
      *                 163328             Date 30Jun99               *
      *                 158633             Date 20May99               *
      *                 161092             Date 19May99               *
      *                 159255             Date 10May99               *
      *                 157556             Date 28Apr99               *
      *                 159779             Date 27Apr99               *
      *                 157635             Date 26Apr99               *
      *                 158861             Date 14Apr99               *
      *                 156049             Date 01Mar99               *
      *                 154221             Date 01Mar99               *
      *                 154799             Date 24Feb99               *
      *                 151295             Date 18Feb99               *
      *                 153370             Date 22Jan99               *
      *                 153347             Date 19Jan99               *
      *                 150965             Date 08Jan99               *
      *                 152154             Date 07Jan99               *
      *                 147511             Date 10Dec98               *
      *                 139311             Date 23Nov98               *
      *                 146311             Date 10Nov98               *
      *                 144089             Date 22Oct98               *
      *                 145370             Date 20Oct98               *
      *                 132288             Date 25Sep98               *
      *                 133915             Date 07Jul98               *
      *                 132287             Date 30Mar98               *
      *                 144916             Date 19Oct98               *
      *                 143510             Date 29Sep98               *
      *                 126017             Date 14Nov97               *
      *                 128954 *Create     Date 17Feb98               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD039651 - Loan Activity Enquiry not reflecting updated Base *
      *             Rate when value date is backvalued. Use the new   *
      *             rate if it is >= historic rate & <= refixing date.*
      *  252942 - Loan activity shows incorrect projected interest    *
      *           amount if a zero principal amount occurred sometime *
      *           in the past. Move the position of ENDIF such that   *
      *           WLICD is updated even if WCURT or WCUPR = zero.     *
      *         - Applied for MD035938                                *
      *  MD039619 - Loan Activity Enquiry not reflecting updated Base *
      *             Rate. Do not check historic base rates if rate    *
      *             fixing days field is equal to zero and rollover   *
      *             date is not less than value date of new rate.     *
      *  MD039618 - Negative Base Rates shown incorrectly. Patterned  *
      *             after fix AR1071639 to display '-' if negative.   *
      *  CLE154 - Loan Repayment Schedule Enhancement                 *
      *  MD039391A - When 'LoanRolloverMaturity' is 'M', LOAC will    *
      *              display events up to rollover date and events    *
      *              with definite dates as defined in loan.          *
      *  MD039391 - Also applied same fix when 'LoanRolloverMaturity' *
      *             is 'M'.                                           *
      *  MD020807A - Ensure 'Balance as of' line is written at the    *
      *              end if 'LoanRolloverMaturity' is 'R'.            *
      *           - Applied for MD-39391.                             *
      *  MD039187 - System does not adjust Next Repayment Date based  *
      *             on PTDI if original NPD falls on holiday. Include *
      *             settlement check on computing next payment date.  *
      *  MD038831 - Incorrect interest payment computation when       *
      *            the repayment date is adjusted to the next working *
      *            date when holiday                                  *
      *  CLE141A - CLE141 Change Control 1                            *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           for LE Transactions                                 *
      *  MD031378 - LE unexpected daily 'Rollover Rate' events        *
      *             generated for a fixed rate loan with daily        *
      *             RO freq even no new RO rates were input for the   *
      *             dates. Do not display RO when FX change only = Y. *
      *  AR1071639 - Enable system to accept negative spread rate.    *
      *             Amended the program to show the correct amounts in*
      *             the enquiry. Pattern after AR847588.              *
      *             (Child: AR1071642). Applied for MD033488.         *
      *  AR1049090 - Forward repayment events not shown. Enhanced     *
      *              BUG21922 as per AR813950                         *
      *            - Applied for MD031379                             *
      *  MD031977 - Make sure that MR will be shown for newly inserted*
      *             PDCL.                                             *
      *  MD031067 - LOAC shows wrong interest due amount in case of   *
      *             interim rollovers. Adding of computed interest    *
      *             should not be dependent on CAS005.                *
      *  231400 - Wrong In date for manual repayment in LOAC.         *
      *  MD028338 - Interest calculation has rounding difference for  *
      *             Rollover of Facility Exchange Rate only. Add new  *
      *             field to flag rollover as 'FX Rate Change Only'.  *
      *             If this is Y, skip interest calculation.          *
      *  253760 - Set WCODT to 99999 if *IN34 and *IN37 is ON to      *
      *           ensure that system won't hang.                      *
      *  MD023475 - Wrong calculation of next repayment date.         *
      *  MD025520 - Unexpected update of base rate for a loan even    *
      *             "Base Rate Change Ind."=N and Base Rate Code not  *
      *             entered in Rollover Details                       *
      *  MD021007 - Interest outstanding amount is incorrect in loan  *
      *             activity enquiry                                  *
      *  AR954985 - When originating loan is enquired via LOAC, no    *
      *             PDCL for interest is shown. Reverse part of       *
      *             AR948604 to ensure that during enquiry of non-    *
      *             PDCL loan, value from YPOREP/YPOREI will be used  *
      *             when comparing value of WORIGP against DSOLAM.    *
      *             (Child: AR954986)                                 *
      *  AR948604 - Move value of YPDINT or YPCPAM to WORIGP in order *
      *             to correctly display PI records of a PDCL loan in *
      *             case the transferred amount from original loan is *
      *             just a part of the full payment amount.           *
      *             (Child: AR948605)                                 *
      *  AR860576 - LOAC does not show Principal Repayment. Add       *
      *             condition in SR/SRLOAM such that when 'Balance as *
      *             of line' written on the previous page and interest*
      *             payment exist, loan events will be shown.         *
      *           - LOAC shows an extra line with rollover details    *
      *             and no Value Date when viewed from the start of   *
      *             loan. Amend program such that when rollover       *
      *             details have been displayed and Rollover Date is  *
      *             equal to 0, SRRDAT subroutine will not be         *
      *             processed again. (Child: AR860577)                *
      *  MD020852 - System generated a negative interest outstanding  *
      *             after COB for PDCL loans                          *
      *  AR830785 - Looping on insert of accrued interest adjustment  *
      *             Enhanced core fix 263533. (Child: AR830786)       *
      *  AR811339A - Wrong outstanding  interest. Apply fix AR732752  *
      *  AR732752 - Incorrect outstanding interest for old BV loans   *
      *             with interest payment frequency and input on      *
      *             rundate. Amended program to consider only those   *
      *             newly entered BV loans. (Child: AR732753)         *
      *  AR1054816 - CLE134: Incorrect event narrative and Balance on *
      *              LOAC. Save and restore value of AMTPH when rep-  *
      *              lace before and after execution of XEPPD1.       *
      *              (Child: AR1054817)                               *
      *  MD019846 - Incorrect projected interest displayed on LOAC.   *
      *  260891 - Wrong projection in LOAC. Add LCD as a key.         *
      *           Recompiled due to changes in LF/HISTR.              *
      *  AR742875 - LOAC showing incorrect information. Move *BLANKS  *
      *             to ZFIELD after the value has been passed to      *
      *             SAMNT to ensure that all rate information is      *
      *             correctly display.                                *
      *           - Applied for AR920505. (Child: AR920506)           *
      *  AR1076951 - System returns to Enquiry Screen after selecting *
      *              F21 - Past Due Loans                             *
      *  AR1068354 - No interest was computed when Base Rate only was *
      *              inputted                                         *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  AR982563 - Transfer to PDCL is not shown on loan activity.   *
      *             Amended program to ensure that past due event     *
      *             details are retrieved even if AUTOCL is not equal *
      *             to 'C'. (Child: AR982564)                         *
      *  AR720887 - Loan activity displays duplicate PD interest at   *
      *             top of subfile page. Do not display extra PD event*
      *             if last event from previous page is MR. Also, set *
      *             additional criteria for DSPPDA by comparing LCD   *
      *             if same record in LEPDUEPD. (Child: AR721271)     *
      *  AR753186 - Predicted Maturity interest amount was wrong by   *
      *             a rounding error of 0.01. Applied fix 230596:     *
      *             (Child: AR753187)                                 *
      *           - Interest payment incorrectly projected due        *
      *             to double rounding of interests for periods       *
      *             with LS inserted in between. Skip SRINCL when     *
      *             AMTPH = LS or MI.                                 *
      *  AR816406 - Matured Loans Enquiry ends in Database error.     *
      *             Ensured that Past Due Enquiry will only be        *
      *             display and be accessible if loan number entered  *
      *             is valid. (Child: AR816407)                       *
      *  AR401496 - Wrong interest amount calculated on the first     *
      *             future interest payment if the previous event is  *
      *             a repayment of principal. Reverse BUG13282        *
      *  AR728070 - Past Due Interest Transfer event is not being     *
      *             shown for loan with repayment type 3. Include     *
      *             processing of retrieving PDCL details for the     *
      *             interest part of the repayment. (Child: AR728071) *
      *  AR400094A- Wrong narrative for original loan                 *
      *             (Child: AR400186)                                 *
      *             CLE134 events require extra conditions to forward *
      *  AR400094 - Wrong narrative for original loan                 *
      *             (Child: AR400186)                                 *
      *  AR317473 - Wrong projected movements (in addition to Defect  *
      *             2018) (Child: AR317474)                           *
      *  263918 - Reopened to include PDCL Interest Transfer narrative*
      *  263418A- Add "PD - FEE &1" Narrative (23Jan10)               *
      *  263411 - PDCL details not shown for Maturity event.          *
      *  263418 - Wrong narrative when PDCL interest is generated     *
      *           for facilities.                                     *
      *  263417 - Wrong narrative when PDCL interest is enquired      *
      *  263412 - Wrong details displayed when MR is created in I/C   *
      *           by PDCL generation function.                        *
      *  263361 - Wrong details displayed in the loan activity enq    *
      *           when a PI is input for a PDCL and loan is enquired  *
      *           on the same day of PI input.                        *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR634884 - Incorrect projected interest due to wrong spread  *
      *             indicator used. Fix initialised correct WCUSI on  *
      *             ST, MC, and RO event.                             *
      *  AR317587 - Matured Loan can't be recovered using maturity    *
      *             date as the value date of the manual repayment.   *
      *             Amended program to allow value date of MR greater *
      *             than Maturity date for past due loans.            *
      *             (Child: AR810533)                                 *
      *  AR826143 - Interest payment is omitted when loan event is    *
      *             equal to interest payment date (Child:AR826144)   *
      *  AR835977 - Use original entry date as In date(Child:AR836855)*
      *  AR747510 - Pass correct interest date for payment due day    *
      *             indicator = A (Child: AR747511)                   *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  251331 - Remove core fix 139311 to ensure correct principal  *
      *           is projected for reactivated loan.                  *
      *  AR583389 - Incorrect outstanding interest for a backvalued   *
      *             loan with interest payment frequency and interest *
      *             capitalised. Amended program to consider interest *
      *             capitalised in the calculation of outstanding     *
      *             interest upon loan input.                         *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER016A  -  German Interest Calculation: Upgarde of FGE059   *
      *              to Midas Plus (Recompile)                        *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23177 -  Loan Activity /Loan Details Enquiry is showing   *
      *              incorrect details for Interest Rate. Applied     *
      *              Gems fix 255285                                  *
      *  255285    - Spread Rate change not applied due to Analytical *
      *              Accounting switched off (BGN0ST = 'N')           *
      *  BUG22332A - Maturity Interest for Repayment type 3 are not   *
      *              handled correctly                                *
      *  BUG22581 - Loan Activity Enquiry showing wrong balance       *
      *             amount                                            *
      *  BUG22381 - Loan Activity Enquiry not showing the activity    *
      *             related to start of loan and start base rate etc. *
      *  BUG22332 - Rollover interest details are not handled         *
      *             correctly when calculation basis changes at       *
      *             rollover                                          *
      *  BUG22066 - Add only interest for repayment schedule when     *
      *             autosettle = Y                                    *
      *  BUG21868 - Include maturity interest in computing            *
      *             for maturity principal                            *
      *  BUG21922 - Check system value 'LoanRolloverMaturity', if     *
      *             'R' display until Rollover. If 'M' display until  *
      *             Maturity                                          *
      *  260221 - Incorrect interest repayment. Process next interest *
      *           payment after considering manual repayments in the  *
      *           total interest paid.                                *
      *  260274 - LOAC missing projections after rollover.            *
      *         - Reversed fix 249835A and re-instated codes reversed *
      *           by fix 249835 (fix 246037), this stops projections  *
      *           on LOAC.                                            *
      *  257301 - Amend program such that correct Value Date would be *
      *           used for repayment on a Past Due event. Reverse     *
      *           fix 249397 and 242852.                              *
      *  255285 - Spread rate change not applied due to Analytical    *
      *           Accounting switched off. (BGN0ST = 'N')             *
      *  249398 - Manual repayment of interest displayed twice at     *
      *           start of next page.                                 *
      *  249397 - Display Expected Date as Due Date if it is not      *
      *           equal to Value Date but processing will still       *
      *           be based on Value Date.                             *
      *  249160 - Backvalued interest payment date causing incorrect  *
      *           dates to be displayed for manual repayment.         *
      *  248506 - Process Spread Changes only when interest spread    *
      *           rate is amended.                                    *
      *  242909 - Do not consider auto settlement indicator for       *
      *           future principal repayment.                         *
      *  247978 - For STOP/START ACCRUAL Narratives, incorrect ba-    *
      *           lances are shown instead of the interest rate as of *
      *           the loan amendment event.                           *
      *  247791 - Incorrect balance on the Loan Activity enquiry when *
      *           page down is used.                                  *
      *  247071 - Loans Enquiry does not show that a manual repay or  *
      *           a principal increase is due to an assignment        *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  249835B - Correct computation of NIDT for loans to consider  *
      *            PTDI and PDDI indicators.                          *
      *  249972 - Remove unnecessary BUG13074/BUG9240 codings to      *
      *           ensure future interest payments will be projected.  *
      *  249835A - Future repayment should only be projected on or    *
      *           next rollover date and maturity date.               *
      *  249835 - Applied fix 246037.                                 *
      *  246037 - Events after rollover date should not be displayed. *
      *  245109 - Rollover don't always show calc basis.              *
      *  245082 - Loans with first and last day accrual should be     *
      *           treated as first day accruals until maturity        *
      *           date.  Then add one day on the maturity date.       *
      *           Patterned after fix 235784 from Release 4.          *
      *  245073 - Include calc basis on narrative for all rollovers.  *
      *  244453 - Incorrect base rate used to calculate interest      *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  244097 - Re-instate value of SCDIN from WCDIN when SRLOAN    *
      *           is called again.                                    *
      *  243394 - Add new system value "AddPastDueIntrInLOAC" to      *
      *           add Past Due Interest into calculated Maturity      *
      *           Interest if set to 'Y'. If 'N' then Past Due Int    *
      *           will NOT be included in the calculated interest     *
      *           at maturity.                                        *
      *  243078 - Apply 240236.                                       *
      *  240236 - Load repayment frequency on next page when current  *
      *           page is already full. Put up looping counter to     *
      *           avoid hanging indefinitely.                         *
      *  242852 - 'Due date' shows Value Date instead of the Expected *
      *           Value Date when MR is attached to a Past Due.       *
      *           Also set 'In Date' as Original Entry Date if ORED   *
      *           is different from Expected Value Date.              *
      *  239062 - Incorrect future-valued interest is being displayed *
      *           in LOAC.                                            *
      *  BUG13282 - Correct difference between fields WINPD and WCALC.*
      *             Make WINPD = WCALC only on first pass.            *
      *  BUG13074 - Incorrect output: Dates not in sequence,          *
      *             future-valued appears before history, etc.        *
      *           - Caused by BUG12851                                *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  BUG13017 - Margin should not have been considered during     *
      *             calculation of interest                           *
      *  BUG12851 - Voided BUG12787 - It solved the looping but       *
      *             shows only the first projected date.              *
      *           - Reduce interest rate by margin when CAS005 is on. *
      *           - Do projection until maturity date even if rollover*
      *             date is defined.                                  *
      *  BUG12918 - Changed in display file (Recompile)               *
      *  BUG12917 - Descrepancy in Data between loan detail enquiry   *
      *              and loan activity enquiry.                       *
      *  BUG12787 - Looping activity encountered when WFRPR = 'Y'     *
      *             and WFRIN = 'Y'                                   *
      *  238722 - Convert future loan events (MR, RE, PT, PF and PI)  *
      *           when value date is greater than multi-ccy rollover, *
      *           same with frequency principal and/or interest       *
      *           payments.                                           *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  224758 - Wrong projected interest due to the incorrect inte- *
      *           rest calculation basis being used for calculation.  *
      *  241579 - LOAC - Loan A initially shows no interest then      *
      *           after displaying Loan B the interest repayment for  *
      *           Loan A is now displayed but using incorrect         *
      *           calculation basis (uses Calc Basis of Loan B).      *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  240696 - Start date event is missing for future valued loan. *
      *           Fix is to enable system to project future valued    *
      *           start date of loan to be consistent with all other  *
      *           events up to maturity. Applied fix 225092.          *
      *           THIS IS ANNOTATED AS BUG9052.                       *
      *  238739 - No amount should be displayed for stop/start        *
      *           accruals as this just simply an indicator for       *
      *           the loan.                                           *
      *  235907 - Use the rollover fix rate if defined for the loan.  *
      *  224740 - Some CLOANCL file fields are also used as program   *
      *           variables (eg NRPD). As a result, when a user       *
      *           rolls up, the processing reinitialises some program *
      *           fields on the basis of file fields but these no     *
      *           longer contain the values when read from CLOAN.     *
      *           Solution is that on rollup CLOANCL should be        *
      *           accessed and SRLOAN executed again.                 *
      *  225849 - Incorrect projection of interest. Interest past     *
      *           due should not be deducted from calculated maturity *
      *           interest when loan is autosettled on rundate.       *
      *           Applied fix 223981.                                 *
      *  CLE042 - Extended Loan Sub Type                              *
      *  BUG9240 - LOAC- missing spread on rollover (Apply fix 235078)*
      *  BUG9052- Start date event is missing for future valued loan. *
      *           Fix is to enable system to project future valued    *
      *           start date of loan to be consistent with all other  *
      *           events up to maturity. Applied fix 225092.          *
      *         - Apply fix to loans that undergone COB but doesn't   *
      *           display Start date event.                           *
      *  CLE106 - Syndications Manager                                *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  218984R- (Reopen) Rollover revaluation amount should be      *
      *           calculated after a repayment defined on the loan.   *
      *           when there is a loan amendment before and after it. *
      *  222380 - Ensure both rollover - increase/repayment and       *
      *           rollover - principal lines are written on page up   *
      *  CLE036 - LE Enh for Nordea Phase 1 Pty 2- Specific Base Rate *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  225344 - Missing interest frequency payments                 *
      *  224764 - Incorrect repayment amounts displayed when          *
      *           a future date is entered in the date activity       *
      *           from field.                                         *
      *  224646 - LOAC should also display interest payments          *
      *           even after future dated rollover events             *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG4318- Interest payment is not shown on 2nd page of the    *
      *           screen                                              *
      *  BUG3832 - Loan activity enquiry looping                      *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  221558 - Loop when showing rollover details. Linked to       *
      *           CLE031.                                             *
      *  219717 - Ensure correct amount is used when working out the  *
      *           repayment on a multicurrency rollover.              *
      *         - Check Settlement Allocations before accessing Nostro*
      *           file to find location.                              *
      *  219500 - Rollover revaluation amount should be calculated    *
      *           after a repayment defined on the loan.              *
      *  218984 - Future dated repayments which are non auto settle   *
      *           should not affect the balance.                      *
      *         - Show Principal Increase or Repayment amounts for    *
      *           rollovers which input a 'New Principal' amount.     *
      *           Show Rollover after the other actions for that day, *
      *           so revaluation amount is calculated after other     *
      *           repayments or principal increases.                  *
      *  CLE031 - Lending Enhancements.                               *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enahancements to CAS001, CAS002 and CAS004          *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  212308 - When Interest payment date is defaulted to next     *
      *           working day and then amended overriding the warning *
      *           message that the Next Interest Payment Date is a    *
      *           holiday, interest dates are correctly changed but   *
      *           the interest amount was not adjusted.               *
      *  202726 - Display maturity with code 'B' if maturity date was *
      *           changed to a value less than the system's run date. *
      *  201343 - Correct Matured Loans heading. Recompile (LE0212DF) *
      *  190005 - Display screen heading for Matured Loans Enquiry.   *
      *  209517 - Calculate correct interest at maturity for loans    *
      *           with stop/start accruals events.                    *
      *           Applied part of fix 203115.                         *
      *  209383 - Incorrect 'Balance as of' date.  Ensure that for    *
      *           final balance, correct date is used for loans       *
      *           with frequency repayments.                          *
      *         - Duplicate 'REPAYMENT - PRINCIPAL' lines. Do not     *
      *           modify next payment dates from file.  The final     *
      *           'Balance as of..' line is being displayed twice as  *
      *           a result of fix 193701.  Added a condition to make  *
      *           sure that this is only printed once. Applied 205786.*
      *  209381 - Incorrect future negative repayments when REPT = 3  *
      *  210367 - Repayment of interest details already in history is *
      *           missing on loan activity for repayment type 3       *
      *  210268 - Future valued repayment schedules not shown for     *
      *           call loans.                                         *
      *  206256 - Wrong projected interest when there is a change in  *
      *           the interest calculation basis.                     *
      *  207629 - For parts purchased loan, both original borrower    *
      *           and 'purchased from' customer should be shown.      *
      *  207961 - Fix is to initialise WRDLS if RLDT is 0, & not      *
      *           process MDAT or RLDT if CODE is 'B' and not         *
      *           backvalued.                                         *
      *  205705 - Incorrect 'Manual Repayment - Interest' action was  *
      *           shown after a Past Due record. Amended fix 184897.  *
      *  204656 - Show maturity action, even if the loan does not yet *
      *           have any history or loan amendments.                *
      *  204544 - Do not overwrite Due date with In date if the date  *
      *           has come from CLOANCL. Only use Original Entry Date *
      *           for 'In date' of LOAMSDK record if it was backdated *
      *           Blank out 'In' date if it is the same as 'Due' date.*
      *  204127 - When there is an outstanding manual adjustment,     *
      *           this should appear on the Loan Activity Enquiry.    *
      *  165648 - 154221 not being fixed completely. A bogus date     *
      *           appears on the first line in the 'In date'.         *
      *  200089 - Loan Activity Enquiry screen hangs/freezes when     *
      *           scroll down is pressed.  Correct initialisation of  *
      *           WSAME in SRPROC.                                    *
      *  188806 - Interest at maturity is incorrect (negative) if loan*
      *           principal is now zero. Also, LOAC fails for certain *
      *           loans because VSLN exceeds 25 (MCCY rollover).      *
      *         - For loan with scheduled principal repayments, the   *
      *           Loan Activity Enquiry should stop predicting        *
      *           future repayments when principal amount reaches     *
      *           zero. Also, prevent incorrect calculation of        *
      *           maturity interest by using correct field for the    *
      *           total interest paid (WINPD).                        *
      *  193701 - Future valued multi-currency rollover incorrectly   *
      *           displayed in LOAC.                                  *
      *  194375 - Wrong "Balance as of" date on the first record after*
      *           rollup.  Save value date after writing the previous *
      *           record in subroutine SRDETL.                        *
      *  186180 - For 'MA' history records, add maturity interest     *
      *           amount to the current principal if interest is      *
      *           capitalised.                                        *
      *  190638 - Future valued Repayment Schedule still shown for    *
      *           early matured loans.                                *
      *  CDE002 - Revenue Analysis                                    *
      *  193339 - Array index error encountered in SUBR/ZFRQB3 due to *
      *           fix 184959.  Codings added by 184959 should only    *
      *           be applicable when WOVFL is equal to 'Y'.           *
      *  189899 - Do not display maturity lines if loan has not       *
      *           matured (no MA on HISTS) and MDAT is less than RUND.*
      *  CLE014 - Customer Driven Lending Enhancements                *
      *  189089 - Due Date sometimes incorrect for future payment.    *
      *  186708 - Looping on Loan Activity enquiry rollup when WFRPR  *
      *           and WFRIN were blanks, and the last activity shown  *
      *           was for a rollover with spread rate amendment.      *
      *  186995 - LOAC shows incorrect calculation basis for          *
      *           backvalued rollover.                                *
      *  190760 - Incorrect repayment due date (12OCT45) is shown in  *
      *           LOAC. Same process is applied when PTDI is equal to *
      *           blank or equal to 'M' when computing for the next   *
      *           repayment date.                                     *
      *  188382 - Problem when the New Spread indicator(for Rollover) *
      *           is not yet setup for the loan enquired, the         *
      *           narrative shown is incorrect. Use SPIN if NSIN is   *
      *           blank.                                              *
      *         - Prevent replacement of BRTT (Base rate type) when   *
      *           reading from non-CLOANCL records.                   *
      *         - Correct narrative for Base rate code changes (BC).  *
      *  187890 - System is looping due to VSLN greater than 20.      *
      *  184903 - Future valued or backvalued rollover not displayed  *
      *           as a loan activity.                                 *
      *  184897 - Manual repayment for interest not displayed due to  *
      *           screen overflow. Check if interest should be        *
      *           displayed on the next screen.                      *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  180161 - If interest payment frequency is 'R' and CLE005 is  *
      *           on, next interest payment must be based on rollover *
      *           setup.  Pass rollover setup before executing SR/    *
      *           ZFRQB3, as 'R' in SR/ZFRQB3 means monthly interest  *
      *           6 days before monthend.                             *
      *  187261 - Do not display fields linked to Syndications unless *
      *           CLE006 is switched on.                              *
      *  187274 - Do not display fields linked to Loan Manager unless *
      *           CLE010 is switched on.                              *
      *  157669 - Rename new Cost of Funds fields in HISTS*           *
      *  184959 - RE event entered via RPSC maintenance menu is not   *
      *           shown on screen when value date coincides with the  *
      *           value date of a fequency repayment.                 *
      *  181312 - Future interest payments were negative or zero. If  *
      *           CLE003 is off, dont use the new INTR field from the *
      *           loan history - calculate using spread & baserate.   *
      *  CSD007 - Customer Closing                                    *
      *  CIR004 - Dealing Calculation Method Change.                  *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
      *  172540 - Recompile (error in LE0212DF due to fix 169700)     *
      *  169694 - Discrepancy between Maturity interest and Out St    *
      *           interest due to half adjust field definition.       *
      *  169700 - Recompiled due to changes in LE0212DF               *
      *  169696 - Recompiled due to changes in LE0212DF               *
      *  154011 - When enquiring on a loan with settlement currency   *
      *           EUR, Nostro for wrong currency is being looked for:-*
      *           Eliminated moving loan currency into settlement ccy.*
      *           DBERR 04 was reporting SDCUSTPD instead of SDNOSTPD.*
      *           Function description of program also changed, and   *
      *           'LE0212' moved to DBPGM.                            *
      *  163328 - Multi-ccy rollover narrative has wrong spacing on   *
      *           the 'TO' currency.                                  *
      *  158633 - Past dues look as though they have been paid as     *
      *           they show an in date. This is the date the          *
      *           transaction causing the past due was entered and is *
      *           not relevant for a past due item.                   *
      *  161092 - Due date / in date incorrectly overwritten          *
      *  159255 - Show the original borrower name on the loan         *
      *           activity enquiry & on the loan history cards        *
      *  157556 - Narrative should show repayment for interest if     *
      *           not yet past due for repayment type 1.              *
      *  159779 - Correct amount of interest & principal when Rept 3  *
      *           and taken 'N'ext.                                   *
      *  157635 - Loan repayment schedule changed currency            *
      *  158861 - Recompiled due to changes in LE0212DF               *
      *  156049 - Different interest due amount being shown if date   *
      *           from being entered.                                 *
      *  154221 - Calculations added for payment due/taken indicators *
      *           for repayment types 1 and 3. Also correct error     *
      *           which occurs when rollup has caused INVALID COMMAND *
      *           KEY to be shown and new loan is entered.            *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  151295 - Problems authorising repayment schedules            *
      *           Recompiled due to changes in ZCHKH                  *
      *  153370 - Incorrect calculation of maturity interest.         *
      *  153347 - Amount from previous record is shown on Loan        *
      *           Sub-Type change records on subfile.                 *
      *  150965 - Loan activity not showing interest to maturity for  *
      *           loans with Payment Taken Day = 'P' (previous).      *
      *  152154 - Loan sub-type change narrative displays 'from'      *
      *            sub-type and 'to' sub-type the same.  This being   *
      *            the 'to' sub-type.                                 *
      *  147511 - Future dated interest payment is different from     *
      *           interest event reported in GL0550 due to change     *
      *           in interest calculation basis.                      *
      *  139311 - If a loan was re-activated with a negative past     *
      *           due, the running balance should be updated.         *
      *  146311 - Invalid Interest amounts when Amount is zero.       *
     F*  144089 - Add processing for modified payment due day         *
     F*           indicator.                                          *
     F*  145370 - Should not show 'AU' next to amount field.          *
      *  132288 - Fix to prevent looping.                             *
      *  133915 - Loan Activity Enquiry should also show the          *
      *           Maturity Event                                      *
      *  132287 - Session device error when rollup is requested       *
      *         - Infinite loop occurs after numerous page down       *
      *  144916 - Uses old ccy base rate in calculating outstanding   *
      *           interest after multi-ccy rollover                   *
      *  143510 - Shows extra one day in interest amount computation. *
      *           Applied fix 065277 to ignore First Day Accrual ind. *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
      *  128954 - Running total should show on a change of date and   *
      *           only on a change of principal.  Also, include       *
      *           date action was input if different from due date,   *
      *           and any forward repayments until rollover date or   *
      *           maturity date                                       *
      *                                                               *
      *****************************************************************
     FLE0212DFCF  E                    WORKSTN
     F                                              KSLN   VSLN
     FHISTR   IF  E           K        DISK
     FLOAMS   IF  E           K        DISK
     F            LOAMSDHF                          KIGNORE
     F            LOAMSZ1F                          KIGNORE
     FCLOAN   IF  E           K        DISK
     F            CLOANHHF                          KIGNORE
     F            CLOANZ1F                          KIGNORE
      *
     FLEPDUEL4IF  E           K        DISK                                                   CLE134
     FLEPDUEL7IF  E           K        DISK                                                   CLE134
     F            LEPDUED0                          KRENAMELEPDUED7                           CLE134
     FLEPDUEL6IF  E           K        DISK                                                   CLE134
     F            LEPDUED0                          KRENAMELEPDUED6                           CLE134
     FLEPDUFLAIF  E           K        DISK                                                   263418
     F            LEPDUFD0                          KRENAMELEPDUFDA                           263418
     FLEPDUFL6IF  E           K        DISK                                                   263418
     F            LEPDUFD0                          KRENAMELEPDUFD6                           263418
      *
     F/COPY WNCPYSRC,LE0212F001
      /EJECT
      *****************************************************************
      *                                                               *
      *    F U N C T I O N   O F   I N D I C A T O R S                *
      *                                                               *
      *    08           Rollup                                        *
      *    09           Rolldown                                      *
      *    12           Single-branch system                          *
      *    15           Linked enquiry                                *
      *    16           Customer Loan                                 *
      *    17           Participation Purchased                       *
      *    18           Participation Sold                            *
      *    19           Guarantee Issued                              *
      *    20           Future valued multi-currency rollover exists  *                       193701
      *    21           Work Indicator                                *   133915
      *    22           Work Indicator                                *   133915
      *    23           Work Indicator                                *   133915
      *    24           Work Indicator                                *   133915
      *    27           Loan has started                              *
      *    29           Reverse image loan reference for deleted loan *
      *    30           First screen for loan                         *
      *    31           Complete displayed                            *
      *    34           No more LOAMS record                          *
      *    37           No more HISTR record                          *
      *    38           Chain failed                                  *
      *    41           Invalid loan                                  *
      *    42           Invalid date                                  *
      *    43           Invalid code                                  *
      *    44           Output error message line                     *
      *    45           Feature CLE134                                *                       CLE134
      *    57           Output original borrower details for parts    *
      *                 purchased with recourse                       *
      *    68           Output running balance (off - action line)    *
      *    69           First time display for a direct enquiry       *
      *                                                               *
      *    77           Matured Loans Enquiry                         *                       190005
      *    80-99        Standard subroutine indicators                *
      *    U1           Matured Loans Enquiry                         *                       190005
      *    U7-U8        DB error indicators                           *
      *    KA           F1 is pressed                                 *
      *    KC           F3 is pressed                                 *
      *    KL           F12 is pressed                                *
      *****************************************************************
      /EJECT
     E                    CPY@    1   1 80
      ** Copyright statement
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZDATE9Z1
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZFREQBZ1
     E/COPY ZSRSRC,ZEDITZ1
     E/COPY ZSRSRC,ZSEDITZ1
     E/COPY ZSRSRC,ZPOWERZ1                                                                   193701
      /EJECT
     IHISTSHMF
      ** Rename history header fields
     I              BRCA                            BRCAH
     I              CNUM                            CNUMH
     I              LNRF                            LNRFH
     I              VDAT                            VDATH
     I              AMTP                            AMTPH
     I              PRAM                            PRAMH
     I              BRTT                            BRTTH                 188382
     I              BRTE                            BRTEH
     I              RTSP                            RTSPH
     I              SPIN                            SPINH
     I              REPT                            REPTH
     I              INTC                            INTCH
     I              SUTP                            SUTPH
     I              LCD                             LCDH
     I              CPAM                            CPAMH
     I              AITC                            AITCH
     I              INTR                            INTRH
     I              AIAP                            AIAPH
     I              IPRD                            IPRDH
     I              WTIN                            WTINH
     I              TOTI                            TOTIH
     I              CALC                            CALCH                 147511
     I              ACDA                            ACDAH                 157669
     I              COFR                            COFRH                 157669
     I              ACAP                            ACAPH                 157669
     I              COFD                            COFDH                 157669
     I              CLAS                            CLASH                                     CLE042
     I              LASN                            LASNH                                     CLE134
      *
     IHISTSHPF
      ** Rename history amount fields
     I              BRCA                            BRCAH
     I              CNUM                            CNUMH
     I              LNRF                            LNRFH
     I              VDAT                            VDATH
     I              AMTP                            AMTPH
     I              PRAM                            PRAMH
     I              INTA                            INTAH
     I              WTXA                            WTXAH
     I              FEAM                            FEAMH
     I              WOIN                            WOINH
     I**********    EXVD                            EXVDH                              242852 257301
     I              SUTP                            SUTPH
     I              LCD                             LCDH
     I              CPAM                            CPAMH
     I              AITC                            AITCH
     I              INTR                            INTRH
     I              AIAP                            AIAPH
     I              IPRD                            IPRDH
     I              MNSG                            MNSGH
     I              GASS                            GASSH
     I              ROLN                            ROLNH
     I              ACDA                            ACDAH                 157669
     I              COFR                            COFRH                 157669
     I              ACAP                            ACAPH                 157669
     I              COFD                            COFDH                 157669
     I              CHDU                            CHDUH                                     CLE028
     I              CLAS                            CLASH                                     CLE042
     I              LASN                            LASNH                                     CLE134
      *
     IHISTSHQF
      ** Rename history rate fields
     I              BRCA                            BRCAH
     I              CNUM                            CNUMH
     I              LNRF                            LNRFH
     I              VDAT                            VDATH
     I              CCY                             CCYH
     I              AMTP                            AMTPH
     I              BRTT                            BRTTH                 188382
     I              BRTE                            BRTEH
     I              RTSP                            RTSPH
     I              SPIN                            SPINH
     I              STAI                            STAIH
     I              IRCF                            IRCFH
     I              LCD                             LCDH
     I              CPAM                            CPAMH
     I              AITC                            AITCH
     I              INTR                            INTRH
     I              AIAP                            AIAPH
     I              IPRD                            IPRDH
     I              MNSG                            MNSGH
     I              RLCY                            RLCYH
     I              CALC                            CALCH                 147511
     I              ACDA                            ACDAH                 157669
     I              COFR                            COFRH                 157669
     I              ACAP                            ACAPH                 157669
     I              COFD                            COFDH                 157669
     I              LASN                            LASNH                                     CLE134
      *                                                                                     MD028338
      ** Reuse filler ZZ001 to serve as FX Rate Change Only Indicator                       MD028338
      *                                                                                     MD028338
     I              ZZ001                           FRCOH                                   MD028338
      *
     ILOAMSDKF
      ** Rename loan amendment fields
     I              LNRF                            LNRFL
     I              CNUM                            CNUML
     I              VDAT                            VDATL
     I              AMTP                            AMTPL
     I              BRTT                            BRTTL                 188382
     I              RTSP                            RTSPL
     I              CCY                             CCYL                  157635
     I              PRAM                            PRAML
     I              INTA                            INTAL
     I              WTXA                            WTXAL
     I              FEAM                            FEAML
     I              TAMT                            TAMTL
     I              BRCA                            BRCAL
     I              REPT                            REPTL
     I              STAI                            STAIL
     I              SETP                            SETPL
     I              BRTE                            BRTEL
     I              SPIN                            SPINL
     I              INTC                            INTCL
     I              ORED                            OREDL
     I              IRCF                            IRCFL
     I              LCD                             LCDL
     I              ROLN                            ROLNL
     I              PDDI                            PDDIL                 154221
     I              PTDI                            PTDIL                 154221
     I              AUTO                            AUTOL                                     218984
     I**********    XAVD                            XAVDL                              242852 257301
     I              GASS                            GASSL                                     247071
     I              LASN                            LASNL                                     CLE134
      *
     ICLOANCLF                                                            157635
      *                                                                   157635
      ** Rename CLOANCL fields                                            157635
      *                                                                   157635
     I              CCY                             CCYCL                 157635
     I              SCCY                            SCCYCL                CLE031
     I              PSCY                            PSCYCL                CLE031
     I              STAL                            STALCL                                    219717
     I              AUTO                            AUTOCL                                    218984
     I/COPY WNCPYSRC,LEH01377
      *                                                                   157635
     ICLOANCKF                                                            184903
      *                                                                   184903
      ** Rename CLOANCK fields similar to CLOANCL                         184903
      *                                                                   184903
     I              RCDT                            RCDTK                 184903
     I              MRIN                            MRINK                 184903
     I              ZZ004                           FRCOK                                   MD031067
     I/COPY WNCPYSRC,LEH00928
      *                                                                   184903
     ILEPDUFDA                                                                                263418
      *                                                                                       263418
      ** Rename LEPDUFDA fields that are too long.                                            263418
      *                                                                                       263418
     I              YTKPACL                         YTPACL                                    263418
     I              YTKPABR                         YTPABR                                    263418
     I              YTKPAAC                         YTPAAC                                    263418
     I              YTKPASE                         YTPASE                                    263418
     I              YTKPACY                         YTPACY                                    263418
     ILEPDUFD6                                                                                263418
      *                                                                                       263418
      ** Rename LEPDUFD6 fields that are too long.                                            263418
      *                                                                                       263418
     I              YTKPACL                         YTPACL                                    263418
     I              YTKPABR                         YTPABR                                    263418
     I              YTKPAAC                         YTPAAC                                    263418
     I              YTKPASE                         YTPASE                                    263418
     I              YTKPACY                         YTPACY                                    263418
     ILEPDUED0                                                                                CLE134
      *                                                                                       CLE134
      ** Rename LEPDUED0 fields that are too long.                                            CLE134
      *                                                                                       CLE134
     I              YTKPACL                         YTPACL                                    CLE134
     I              YTKPABR                         YTPABR                                    CLE134
     I              YTKPAAC                         YTPAAC                                    CLE134
     I              YTKPASE                         YTPASE                                    CLE134
     I              YTKPACY                         YTPACY                                    CLE134
     I              YTKIACL                         YTIACL                                    CLE134
     I              YTKIABR                         YTIABR                                    CLE134
     I              YTKIAAC                         YTIAAC                                    CLE134
     I              YTKIASE                         YTIASE                                    CLE134
     I              YTKIACY                         YTIACY                                    CLE134
     ILEPDUED7                                                                                CLE134
      *                                                                                       CLE134
      ** Rename LEPDUED0 fields that are too long.                                            CLE134
      *                                                                                       CLE134
     I              YTKPACL                         YTPACL                                    CLE134
     I              YTKPABR                         YTPABR                                    CLE134
     I              YTKPAAC                         YTPAAC                                    CLE134
     I              YTKPASE                         YTPASE                                    CLE134
     I              YTKPACY                         YTPACY                                    CLE134
     I              YTKIACL                         YTIACL                                    CLE134
     I              YTKIABR                         YTIABR                                    CLE134
     I              YTKIAAC                         YTIAAC                                    CLE134
     I              YTKIASE                         YTIASE                                    CLE134
     I              YTKIACY                         YTIACY                                    CLE134
     ILEPDUED6                                                                                CLE134
      *                                                                                       CLE134
      ** Rename LEPDUED0 fields that are too long.                                            CLE134
      *                                                                                       CLE134
     I              YTKPACL                         YTPACL                                    CLE134
     I              YTKPABR                         YTPABR                                    CLE134
     I              YTKPAAC                         YTPAAC                                    CLE134
     I              YTKPASE                         YTPASE                                    CLE134
     I              YTKPACY                         YTPACY                                    CLE134
     I              YTKIACL                         YTIACL                                    CLE134
     I              YTKIABR                         YTIABR                                    CLE134
     I              YTKIAAC                         YTIAAC                                    CLE134
     I              YTKIASE                         YTIASE                                    CLE134
     I              YTKIACY                         YTIACY                                    CLE134
     I            DS
      ** Redefine PRINRO from HISTSHQ as char
     I                                        1  130PRINRO
     I                                        1  13 PRINX
      *
     I            DS
      ** Get additional day indicator for matured records
     I                                    P   1   70ORTI
     I                                        1   7 WORTI
     I                                        6   6 MADDI
      *                                                                                       CLE141
      ** Business Day Convention Fields                                                       CLE141
      *                                                                                       CLE141
     ICCYPI       DS                                                                          CLE141
     I                                        1   3 C1PI                                      CLE141
     I                                        4   6 C2PI                                      CLE141
     I                                        7   9 C3PI                                      CLE141
     I                                       10  12 C4PI                                      CLE141
     I                                       13  15 C5PI                                      CLE141
     I                                       16  18 C6PI                                      CLE141
     I                                       19  21 C7PI                                      CLE141
     I                                       22  24 C8PI                                      CLE141
     I                                       25  27 C9PI                                      CLE141
     I                                       28  30 C0PI                                      CLE141
     ILOCPI       DS                                                                          CLE141
     I                                        1   3 L1PI                                      CLE141
     I                                        4   6 L2PI                                      CLE141
     I                                        7   9 L3PI                                      CLE141
     I                                       10  12 L4PI                                      CLE141
     I                                       13  15 L5PI                                      CLE141
     I                                       16  18 L6PI                                      CLE141
     I                                       19  21 L7PI                                      CLE141
     I                                       22  24 L8PI                                      CLE141
     I                                       25  27 L9PI                                      CLE141
     I                                       28  30 L0PI                                      CLE141
      *                                                                                       CLE141
     I/COPY WNCPYSRC,LEH01088
      *
     ISDBSRT    E DSSDBSRTPD                                              184903
      ** Base rate codes                                                  184903
      *                                                                   184903
     ISDBSHS    E DSSDBSHSPD                                                                  239062
      ** Base rate codes history                                                              239062
      *                                                                                       239062
     ISDBANK    E DSSDBANKPD
      ** Bank details
      *
     ISDMMOD    E DSSDMMODPD
      ** Module Details
      *
     ISDCURR    E DSSDCURRPD
      ** Currency details
      *
     ISDCUST    E DSSDCUSTPD
      ** Customer details
      *
     ISDGELR    E DSSDGELRPD
      ** General ledger details
     I*
     ISCSARD    E DSSCSARDPD
      ** SAR details
      *
     ISDNOST    E DSSDNOSTPD
      ** Nostro Details
     I              QQACCD                          QQACD1                                    CGL029
      *
     IDSFDY     E DSDSFDY
      ** First DS for access programs, short data structure
      *
     IDSSDY     E DSDSSDY
      ** Second DS for access programs, long data structure
      *
     IDSLDY     E DSDSLDY                                                 CSD007
      ** Third DS for access programs, very long data structure           CSD007
      *                                                                   CSD007
     ILESTAL    E DSLESTALPD                                                                  219717
      **  EXTERNAL DS FOR SETTLEMENT ALLOCATION DETAILS                                       219717
     I              LNRF                            STLNRF                                    219717
     I              VDAT                            STVDAT                                    219717
     I              LASQ                            STLASQ                                    219717
     I              RSTM                            STRSTM                                    219717
     I              PSTM                            STPSTM                                    219717
     I              CCY                             STCCY                                     CLE038
     I              CNUM                            STCNUM                                    CLE038
     ILDA        UDS                            256
      ** Local database data area
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
     I                                      251 2560ZFSIZE
      *
     IPSDS       SDS
      ** Program status data structure
     I                                      244 246 WSID
     I/COPY WNCPYSRC,LEH00921
      *
     IRUNDT       DS
      ** Data area rundat
     I                                        1   7 RUNA
     I                                    P   8  100RUND
     I                                       11  11 SSF
     I                                       12  12 DATF
     I                                       13  13 MBIN
      *
     IEMSDS     E DSEMDTA
      ** Linked enquiry data area
     I                                      141 146 LOANNO
     I/COPY WNCPYSRC,LEH00929
      *                                                                                       243394
      ** Datastructure to hold input parameter for AOSVALR0.                                  243394
     I            DS                                                                          243394
     I                                        1  20 WPARM                                     243394
     I                                        1   5 WPARM1                                    243394
     I                                        6  10 WPARM2                                    243394
     I                                       11  15 WPARM3                                    243394
     I                                       16  20 WPARM4                                    243394
      *                                                                                       243394
      ** Data Structure for Past Due parameter                                                263418
      *                                                                                       263418
     ID@FEE       DS                              8                                           263418
     I                                        1   5 P@FEFA                                    263418
     I                                        6   6 P@COS                                     263418
     I                                        7   8 P@FECD                                    263418
      *                                                                                       CLE134
      ** Data Structure for Past Due parameter                                                CLE134
      *                                                                                       CLE134
     ID@PDUE      DS                             32                                           CLE134
     I                                        1   4 P@PDTP                                    CLE134
     I                                        5  10 P@LNRF                                    CLE134
     I                                       31  32 P@LTYP                                    CLE134
      *                                                                                       CLE134
      ** Data Structure of Work Variables.                                                    CLE134
      *                                                                                       CLE134
     I            DS                                                                          CLE134
     I                                        1   2 DSLTYP                                    CLE134
     I                                        1   1 DSLTY1                                    CLE134
      *                                                                                       CLE134
     I                                        3   3 DSPPDA                                    CLE134
     I                                        4   4 DSPDCT                                    CLE134
     I**********                              5  140DSOLAM                           CLE134 AR317473
     I                                    P   5  140DSOLAM                                  AR317473
     I                                       15  170DSLASN                                    CLE134
      *                                                                                       CLE134
     I/COPY ZSRSRC,ZINTDYZ1
     I/COPY ZSRSRC,ZDATE9Z2
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     I/COPY ZSRSRC,ZHOLI
     I/COPY ZSRSRC,ZSEDITZ2
     I/COPY WNCPYSRC,LE0212I001
      /EJECT
      *****************************************************************
      *                   Index to subroutines                        *
      *  Main routine                                                 *
      *  SRPROC  -  Process each loan request                         *
      *  SRINVR  -  Initialise variables                              *
      *  SRHIST  -  Process history record                            *
      *  SROUTH  -  Format history record for display                 *
      *  SRDISH  -  Display history record                            *
      *  SRLOAM  -  Process loan amendment record                     *
      *  SROUTL  -  Format loan amendment for display                 *
      *  SRDISL  -  Display loan amendment                            *
      *  SRNEWI  -  Compute for new interest rate                     *
      *  SRRPAY  -  Process each forward repayment                    *
      *  SRINCL  -  Interest calculation                              *
      *  SRDISI  -  Display interest repayment                        *
      *  SRDISR  -  Display principal/interest repayment              *
      *  SRDETL  -  Write detail line                                 *
      *  SRVALD  -  Validate screen input                             *
      *  SRTEXT  -  Set up text from message file                     *
      *  SRLOAN  -  Set up loan header details                        *
      *  SRORIG  -  Extract original borrower details                 *
      *  SRCMDV  -  Process command keys                              *
      *  SRINIT  -  Initial processing                                *
      *  *PSSR   -  Error handling subroutine                         *
      *  SRRETR  -  End linked enquiry                                *
      *  SRSTLN  -  Process record read from customer loans file      *                      BUG9052
      *  SROUTS  -  Format start record for display                   *                      BUG9052
      *  SRDISS  -  Displays Start record                             *                      BUG9052
      *                                                               *
      *  ZALIGN  -  Validate/right align numeric fields               *
      *  ZDATE1  -  Validate and convert date to day number           *
      *  ZDATE2  -  Convert day number to date                        *
      *  ZEDIT   -  Insert decimal point to numeric                   *
      *  ZSEDIT  -  Insert decimal point and sign to numeric          *
      *  GLINTC  -  Calculate interest between two dates              *
      *  ZSAVE   -  Save indicators 90-97                             *
      *  ZRSTOR  -  Restore indicators 90-97                          *
      *  ZFLAC   -  Calculate end date depending on ADDI              *
      *  ZINTDY  -  Calculate number of interest days                 *
      *  ZDATE9  -  Convert day number to YYYYMMDD format             *
      *  ZACCH   -  Access holiday record for currency                *
      *  ZCHKH   -  Check if holiday for currency and location        *
      *  ZFREQB  -  Calculate next payment date                       *
      *  ZFWDT   -  Find nth working day from a given date            *
      *****************************************************************
      *
      ** Perform initial processing
      *
     C                     EXSR SRINIT
      *
     C           WEXIT     DOUEQ'Y'
     C                     EXFMTLE0212F3
     C           *IN09     IFEQ *ON                                       154221
     C           *IN30     ANDNE*ON                                       154221
     C                     MOVE *BLANK    WSAME                           154221
     C                     CLEARWIPAID                                    154221
     C                     CLEARWCALC                                     154221
     C                     CLEARWRPDNO                                    154221
     C                     CLEARWOVFL                                     165648
     C                     CLEARFCALI                                     165648
     C                     CLEARFCALR                                     165648
     C                     ENDIF                                          154221
      **********                                                                      224646 BUG9240
      ***If*rolldown is pressed, putback original rollover date                       224646 BUG9240
      **********                                                                      224646 BUG9240
     C********** *IN09     IFEQ *ON                                                   224646 BUG9240
     C********** CAS005    ANDEQ'Y'                                                   224646 BUG9240
     C**********           Z-ADDWWRLDT    RLDT                                        224646 BUG9240
     C**********           ENDIF                                                      224646 BUG9240
      *
      ** Process command keys
      *
     C                     MOVE '0'       *IN44
     C           *IN08     IFEQ '1'
     C           *IN31     ANDEQ'1'
     C           *IN09     OREQ '1'
     C           *IN30     ANDEQ'1'
     C                     MOVEL'LEE0007' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SEMSG
     C                     MOVE '1'       *IN44
     C                     ITER
     C                     ENDIF
     C                     EXSR SRCMDV
      *                                                                                       CLE134
      ** Re-display if returning from F21                                                     CLE134
      *                                                                                       CLE134
     C           *INKV     IFEQ *ON                                                           CLE134
     C           SEMSG     IFNE *BLANK                                                      AR816406
     C                     MOVE '1'       *IN44                                             AR816406
     C                     ENDIF                                                            AR816406
     C                     ITER                                                               CLE134
     C                     ENDIF                                                              CLE134
     C/COPY WNCPYSRC,LEH01378
      *
      ** Validate screen input if rolldown/rollup not pressed
      *
     C           *IN08     IFEQ '0'
     C           *IN09     ANDEQ'0'
     C                     Z-ADD0         WCALC                           154221
     C                     Z-ADD0         WIPAID                          154221
     C                     EXSR SRVALD
     C/COPY WNCPYSRC,LEH00922
     C                     ENDIF
      *
      ** If input fields are valid, set up header loan details
      ** and action records
      *
     C           *INU1     IFEQ *ON                                                           190005
     C                     MOVE '1'       *IN69                                               190005
     C           *IN41     IFEQ '0'                                                         AR816406
     C                     MOVE '1'       *IN70                                             AR816406
     C                     ENDIF                                                            AR816406
     C                     END                                                                190005
     C           *IN44     IFEQ '0'
     C           *IN08     IFEQ '0'
     C           *IN09     ANDEQ'0'
     C                     EXSR SRLOAN
     C                     ENDIF
     C                     EXSR SRPROC
      *
     C                     ELSE
     C                     WRITELE0212F0
     C                     ENDIF
      *
     C                     ENDDO
      /EJECT
      *****************************************************************
      * SRPROC  -  Process each enquire request                       *
      * Called by: Main routine                                       *
      * Calls    : SRINVR - Initialise variables                      *
      *            SRHIST - Process history record                    *
      *            SRLOAM - Process loan amendment record             *
      *            SRRPAY - Process repayment frequencies             *
      *            SRTEXT - Set up text from message file             *
      *****************************************************************
     C           SRPROC    BEGSR
      *
      ** For rollup, just initialise variable for do
      *
     C***********          MOVE *BLANK    WSAME                     132288154221
     C                     MOVE *BLANK    SEMSG
     C                     MOVE *BLANK    SCMSG
     C                     Z-ADD11        VSLN
     C           *IN08     IFEQ '1'
     C                     MOVE '0'       *IN30
     C                     MOVE *BLANK    WFULL
     C                     ELSE
      *
      ** Determine the first records for the loan for first time
      ** display or during a rolldown
      ** If no history record, get current values from loan
      *                                                                                       224740
      ** First reaccess loan details and reinitialise Loan fields                             224740
     C                     MOVE 'A'       KRCDT                                               224740
     C           KEYL      CHAINCLOAN                38                                       224740
     C                     MOVE 'B'       KRCDT                                               224740
     C           KEYL      CHAINCLOAN                38                                       224740
     C           WCDIN     IFNE *BLANKS                                                       244097
     C                     MOVE WCDIN     SCDIN                                               244097
     C                     ENDIF                                                              244097
     C                     EXSR SRLOAN                                                        224740
      *
     C                     EXSR SRINVR
     C           KEYH      SETLLHISTR
     C           KEYH      READEHISTR                    37
     C           *IN37     IFEQ '1'
     C                     Z-ADD99999     VDATH
     C                     Z-ADDCPAM      WSVBL
     C                     Z-ADDCPAM      WCUPR
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C                     ADD  FLTI      WSVBL                                               CLE028
     C                     ADD  FLTI      WCUPR                                               CLE028
     C                     ENDIF                                                              CLE028
     C           ADCF      IFEQ 'Y'                                                           CLE028
     C                     ADD  CHGA      WSVBL                                               CLE028
     C                     ADD  CHGA      WCUPR                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     Z-ADDINTR      WCURT
     C                     Z-ADDBRTE      WCUBR
     C                     Z-ADDRTSP      WCUSP
     C                     Z-ADDIACD      WLICD
     C                     Z-ADDIACD      WLASD
     C                     Z-ADDVDAT      VDATS   50                                         BUG9052
     C                     Z-ADDORED      OREDS   50                                         BUG9052
     C                     MOVE *BLANK    WINIT
     C                     ENDIF
      *                                                                                       260221
     C                     MOVE '0'       *IN35                                               260221
     C                     MOVE '0'       *IN36                                               260221
     C           LNRF      SETLLLOAMS                                                         260221
     C           LNRF      READELOAMS                    34                                   260221
     C           *IN34     DOWEQ'0'                                                           260221
     C           AMTPL     IFEQ 'MR'                                                          260221
     C           INTAL     ANDNE0                                                             260221
     C           RLDT      ANDEQVDATL                                                         260221
     C           NIDT      ANDEQVDATL                                                         260221
     C                     MOVE '1'       *IN35                                               260221
     C                     ENDIF                                                              260221
     C           AMTPL     IFEQ 'MR'                                                          260221
     C           PRAML     ANDNE0                                                             260221
     C           RLDT      ANDEQVDATL                                                         260221
     C           NIDT      ANDEQVDATL                                                         260221
     C                     MOVE '1'       *IN36                                               260221
     C                     ENDIF                                                              260221
     C           LNRF      READELOAMS                    34                                   260221
     C                     ENDDO                                                              260221
      *
     C           LNRF      SETLLLOAMS
     C           *IN34     DOUEQ'1'
     C           RECI      OREQ 'D'
     C           LNRF      READELOAMS                    34
     C                     ENDDO
     C           *IN34     IFEQ '1'
     C                     Z-ADD99999     VDATL
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00852
      *
      ***If*no*history*or*loan*amendment*record,*no*action*should****                         204656
      ***be*displayed,*even*for*forward*repayments*******************                         204656
      *
     C                     MOVE '1'       *IN69
     C                     MOVE '1'       *IN70                                             AR816406
      *                                                                                      BUG9052
      ** Start record/details of loan should be displayed even if there                      BUG9052
      ** is no 'ST' record found in PF/HISTSHM                                               BUG9052
      *                                                                                      BUG9052
     C           *IN37     IFEQ '1'                                                          BUG9052
     C                     EXSR SRSTLN                                                       BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
      ** For sold loans, show activity related to start of loan                             BUG22381
      ** start base rate, etc.                                                              BUG22381
      *                                                                                     BUG22381
     C           *IN37     IFEQ '0'                                                         BUG22381
     C           PSAM      ANDNE0                                                           BUG22381
     C           NOPS      ANDNE0                                                           BUG22381
     C           AIPD      ANDEQ0                                                           BUG22381
     C           MDAT      ANDEQ0                                                           BUG22381
     C                     Z-ADDCPAM      WCUPR                                             BUG22581
     C                     Z-ADDVDAT      VDATS   50                                        BUG22381
     C                     Z-ADDORED      OREDS   50                                        BUG22381
     C                     EXSR SRSTLN                                                      BUG22381
     C                     ENDIF                                                            BUG22381
      *                                                                                     BUG22381
      ** No history or loan amendment record found                                           BUG9052
      *                                                                                      BUG9052
     C                     MOVE *BLANK    WFULL   1                                           204656
     C                     CLEAR@NHIST                                                        204656
     C           *IN37     IFEQ '1'
     C           *IN34     ANDEQ'1'
     C/COPY WNCPYSRC,LEH00853
     C**********           MOVE 'Y'       WFULL                                               204656
     C**********           MOVE '1'       *IN31                                               204656
      *                                                                   154221
     C           SNIDT     IFNE *BLANK                                    154221
     C           SNRPD     ORNE *BLANK                                    154221
     C           MDAT      ORNE *ZEROS                                                       BUG9052
     C                     Z-ADD99999     WCODT                           154221
     C                     CLEARWFULL                                     154221
     C                     MOVE *OFF      *IN31                           154221
     C                     MOVE 'Y'       @NHIST  1                       154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C**********           ELSE                                                               204656
     C**********           MOVE *BLANK    WFULL   1                                           204656
     C**********           CLEAR@NHIST                                    154221              204656
     C                     ENDIF
     C                     ENDIF
      *
     C                     Z-ADD0         WLOOP   20                                        BUG13074
      *
      ** Build the action records
      ** Skip if only final balance is yet to be displayed
      ** Processing whichever is earlier between history and loan
      ** amendment records
      *
     C           WFULL     DOWEQ*BLANK
      *                                                                                       200089
     C           *IN08     IFEQ '1'                                                           200089
     C           WSAME     ANDEQ'Y'                                                           200089
     C********** WOVFL     ANDEQ'Y'                                                    200089 CLE028
     C           FCALI     ANDNE' '                                                          BUG9240
     C           FCALR     ANDNE' '                                                          BUG9240
     C********** *IN08     OREQ '1'                                                  BUG13074 249972
     C********** WSAME     ANDEQ'Y'                                                  BUG13074 249972
     C********** FCALI     ANDEQ' '                                                  BUG13074 249972
     C********** FCALR     ANDEQ' '                                                  BUG13074 249972
     C                     MOVE *BLANKS   WSAME                                               200089
     C                     END                                                                200089
      *
     C           WFINL     IFEQ *BLANKS
     C           *IN34     IFEQ '0'
     C           *IN37     OREQ '0'
     C/COPY WNCPYSRC,LEH00854
     C                     SELEC
     C           VDATH     WHLE VDATL
     C/COPY WNCPYSRC,LEH00855
     C********** RLDT      IFLE VDATH                                                  184903 218984
      * If Rollover date is earlier, process RO first:                                        218984
     C           RLDT      IFLT VDATH                                                         218984
     C           RLDT      ANDNE*ZEROS                                    184903
     C           WRLDS     ANDEQ'1'                                       184903
     C           NRPD      IFLE RLDT                                                         218984R
     C           WFRPR     ANDEQ'Y'                                                          218984R
     C           NIDT      ORLE RLDT                                                         218984R
     C           WFRIN     ANDEQ'Y'                                                          218984R
     C                     Z-ADDRLDT      WCODT                                              218984R
     C                     EXSR SRRPAY                                                       218984R
     C                     ENDIF                                                             218984R
     C           RLDT      IFLT NRPD                                                          219500
     C           RLDT      ANDLTNIDT                                                          219500
     C           RLDT      ANDNE*ZEROS                                                      AR860576
     C           WFRPR     ORNE 'Y'                                                           219500
     C           WFRIN     ANDNE'Y'                                                           219500
     C                     EXSR SRRDAT                                    184903
     C                     ENDIF                                                              219500
     C                     EXSR SRHIST                                                        218984
     C                     ELSE                                                               218984
      * Else, Process history:                                                                218984
     C                     EXSR SRHIST                                                        218984
      * If RO earlier than history & Loan Amendments, process next:                           218984
     C           RLDT      IFLT VDATH                                                         218984
     C           RLDT      ANDLTVDATL                                                         218984
     C           RLDT      ANDNE*ZEROS                                                        218984
     C           WRLDS     ANDEQ'1'                                                           218984
     C           NRPD      IFLE RLDT                                                          219500
     C           WFRPR     ANDEQ'Y'                                                           219500
     C           NIDT      ORLE RLDT                                                          219500
     C           WFRIN     ANDEQ'Y'                                                           219500
     C           VSLN      IFLT 20                                                          BUG13074
     C                     Z-ADDRLDT      WCODT                                              218984R
     C                     EXSR SRRPAY                                                        219500
     C                     ENDIF                                                            BUG13074
     C                     ENDIF                                                              219500
     C           RLDT      IFLE NRPD                                                          219500
     C           RLDT      ANDLENIDT                                                          219500
     C           RLDT      ANDNE*ZEROS                                                      AR860576
     C           VSLN      ANDLT20                                                           BUG4318
     C                     EXSR SRRDAT                                                        218984
     C                     ENDIF                                                              219500
     C                     ENDIF                                                              218984
     C                     ENDIF                                          184903
     C**********           EXSR SRHIST                                                        218984
     C           VDATL     WHLE VDATH
     C/COPY WNCPYSRC,LEH00856
      * If Rollover date is earlier, process first:                                           218984
     C           RLDT      IFLT VDATL                                                         218984
     C           RLDT      ANDNE*ZEROS                                                        218984
     C           WRLDS     ANDEQ'1'                                                           218984
     C           NRPD      IFLE RLDT                                                          219500
     C           WFRPR     ANDEQ'Y'                                                           219500
     C           NIDT      ORLE RLDT                                                          219500
     C           WFRIN     ANDEQ'Y'                                                           219500
     C                     Z-ADDRLDT      WCODT                                              218984R
     C                     EXSR SRRPAY                                                        219500
     C                     ENDIF                                                              219500
     C           RLDT      IFLE NRPD                                                          219500
     C           RLDT      ANDLENIDT                                                          219500
     C           RLDT      ANDNE*ZEROS                                                      AR860576
     C           WFRPR     ORNE 'Y'                                                           219500
     C           WFRIN     ANDNE'Y'                                                           219500
     C                     EXSR SRRDAT                                                        218984
     C                     ENDIF                                                              219500
     C                     EXSR SRLOAM                                                        218984
     C                     ELSE                                                               218984
      * Else, Process Loan Amendment:                                                         218984
     C                     EXSR SRLOAM                                                        218984
     C********** RLDT      IFLE VDATL                                                  184903 218984
      * If Rollover date is earlier than next Amendment, or all other                         218984
      * actions have been processed, output RO now:                                           218984
     C           RLDT      IFLT VDATL                                                         218984
     C           RLDT      ANDLTVDATH                                                        BUG9240
     C           RLDT      ANDNE*ZEROS                                    184903
     C           WRLDS     ANDEQ'1'                                       184903
     C           WFINL     ORNE *BLANKS                                                       218984
     C           RLDT      ANDNE*ZEROS                                                        218984
     C           WRLDS     ANDEQ'1'                                                           218984
     C           NRPD      IFLE RLDT                                                         218984R
     C           WFRPR     ANDEQ'Y'                                                          218984R
     C           NIDT      ORLE RLDT                                                         218984R
     C           WFRIN     ANDEQ'Y'                                                          218984R
     C           VSLN      IFLT 20                                                          BUG13074
     C                     Z-ADDRLDT      WCODT                                              218984R
     C                     EXSR SRRPAY                                                       218984R
     C                     ENDIF                                                            BUG13074
     C                     ENDIF                                                             218984R
     C           RLDT      IFLT NRPD                                                          219500
     C           RLDT      ANDLTNIDT                                                          219500
     C           RLDT      ANDNE*ZEROS                                                      AR860576
     C           WFRPR     ORNE 'Y'                                                           219500
     C           WFRIN     ANDNE'Y'                                                           219500
     C           VSLN      IFLT 20                                                          BUG13074
     C                     EXSR SRRDAT                                    184903
     C                     ENDIF                                                            BUG13074
     C                     ENDIF                                                              219500
     C                     ENDIF                                          184903
     C                     ENDIF                                                              218984
     C**********           EXSR SRLOAM                                                        218984
     C/COPY WNCPYSRC,LEH00857
     C                     ENDSL
      *
      ** Process frequency repayments only
      *
     C                     ELSE
      *                                                                                    AR1049090
     C           WRKFLD    IFEQ 'M'                                                        AR1049090
     C                     Z-ADD99999     WCODT                                            AR1049090
     C                     ENDIF                                                           AR1049090
      *                                                                                      BUG9240
     C           WSAME     IFEQ *BLANK                                                       BUG9240
     C                     MOVE *BLANK    WOVFL                                              BUG9240
     C                     ENDIF                                                             BUG9240
      *                                                                                      BUG9240
     C           RLDT      IFNE *ZEROS                                                       BUG9240
     C           RLDT      ANDLTNIDT                                                         BUG9240
     C           RLDT      ANDLTNRPD                                                         BUG9240
     C           WRLDS     ANDEQ'1'                                                          BUG9240
     C                     EXSR SRRDAT                                                       BUG9240
     C                     ENDIF                                                             BUG9240
      *                                                                                      BUG9240
     C           WFRPR     IFEQ 'Y'
     C           WFRIN     OREQ 'Y'
     C********** PASS1     IFEQ 'N'                                                BUG13282 AR401496
     C********** WCALC     IFNE WINPD                                              BUG13282 AR401496
     C**********           Z-ADDWCALC     WINPD                                    BUG13282 AR826143
     C**********           MOVEL'Y'       PASS1                                    BUG13282 AR401496
     C**********           ENDIF                                                   BUG13282 AR401496
     C**********           ENDIF                                                   BUG13282 AR401496
     C                     EXSR SRRPAY
     C********** *IN34     IFEQ *ON                                                BUG12787 BUG12851
     C********** *IN37     ANDEQ*ON                                                BUG12787 BUG12851
     C********** WFRPR     ANDEQ'Y'                                                BUG12787 BUG12851
     C********** WFRIN     ANDEQ'Y'                                                BUG12787 BUG12851
     C**********           MOVEL*ON       *IN31                                    BUG12787 BUG12851
     C**********           MOVEL'Y'       WFINL                                    BUG12787 BUG12851
     C**********           MOVELSINDT     SDUDT                                    BUG12787 BUG12851
     C**********           MOVEL'Y'       WSKIP   1                                BUG12787 BUG12851
     C**********           EXSR SRDETL                                             BUG12787 BUG12851
     C**********           MOVEL*BLANKS   WSKIP                                    BUG12787 BUG12851
     C**********           ENDIF                                                   BUG12787 BUG12851
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ** Write final balance if all the actions are exhausted
      *
     C           *IN37     IFEQ '1'
     C           *IN34     ANDEQ'1'
     C/COPY WNCPYSRC,LEH00858
     C           WFRPR     ANDEQ*BLANK
     C           WFRIN     ANDEQ*BLANK
     C********** VSLN      IFEQ 20                                                            188806
     C           VSLN      IFGE 20                                                            188806
     C                     MOVE 'Y'       WFINL
     C                     ELSE
     C           *IN21     IFEQ '0'                                       133915
      *                                                                   184903
      ** Display Rollover Details if Rollover Date = previous Due Date    184903
      *                                                                   184903
     C           RLDT      IFNE *ZEROS                                    184903
     C                     Z-ADDRLDT      ZDAYNO                          184903
     C                     EXSR ZDATE2                                    184903
     C                     MOVE ZADATE    WRLDT                           184903
     C                     MOVE WRLDT     SBLDT                                               193701
     C                     ENDIF                                          184903
      *                                                                   184903
     C           WRLDT     IFEQ WSVDT                                     184903
     C           WRLDS     ANDEQ'1'                                       184903
     C                     EXSR SRRDAT                                    184903
     C                     ENDIF                                          184903
     C           WRLDT     IFNE WSVDT                                     184903
     C           VSLN      ANDLT20                                        187890
     C           WCUPR     ORNE WSVBL                                     184903
     C           VSLN      ANDLT20                                        187890
     C           RLDT      IFNE *ZEROS                                                        209383
     C                     Z-ADDWLTDT     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SBLDT
     C                     ELSE                                                               209383
     C                     MOVE SDUDT     SBLDT                                               209383
     C                     ENDIF                                                              209383
      *                                                                                       193701
      ** Display the final balance in new currency                                            193701
      *                                                                                       193701
     C           WRLDS     IFEQ '1'                                                           193701
     C           RLDT      ANDEQWLTDT                                                         193701
     C           *IN20     ANDEQ'1'                                                           193701
     C           WRLDS     OREQ '0'                                                           193701
     C           VSLN      ANDGE20                                                            193701
     C           *IN20     ANDEQ'1'                                                           193701
      *                                                                                       193701
     C           WEUIN     IFEQ 'Y'                                                           193701
     C                     Z-ADDPOUTA     ZFLD15                                              193701
     C                     ELSE                                                               193701
     C                     Z-ADDZAMTCO    ZFLD15                                              193701
     C                     ENDIF                                                              193701
      *                                                                                       193701
     C                     ELSE                                                               193701
     C                     Z-ADDWCUPR     ZFLD15
     C                     ENDIF                                                              193701
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SCUBL
     C                     Z-ADDWCUPR     WSVBL                           184903
     C                     MOVE '1'       *IN68
     C                     ADD  1         VSLN
     C                     WRITELE0212F2
     C                     MOVE '0'       *IN68
     C***********          MOVE '1'       *IN31                           133915
     C                     MOVE '1'       *IN21                           133915
     C**********           ENDIF                                                       184903 193701
      *                                                                                       204656
     C                     ELSE                                                               204656
     C           WCUPR     IFEQ WSVBL                                                         204656
     C                     Z-ADDWCUPR     ZFLD15                                              204656
     C                     EXSR ZSEDIT                                                        204656
     C                     MOVE ZOUT21    SCUBL                                               204656
     C                     ENDIF                                                              204656
      *                                                                                       204656
     C                     ENDIF                                                              193701
     C                     ENDIF                                          133915
     C                     ENDIF
     C           RLDT      IFNE *ZEROS                                    184903
     C           WRLDS     IFEQ '1'                                       184903
     C                     EXSR SRRDAT                                    184903
     C**********           MOVE '0'       *IN68                                        184903 193701
     C           WCNT      IFEQ 0                                         184903
      *                                                                                       209383
     C           *IN21     IFNE '1'                                                           209383
     C           *IN20     IFEQ '1'                                                           193701
      *                                                                                       193701
     C           WEUIN     IFEQ 'Y'                                                           193701
     C                     Z-ADDPOUTA     ZFLD15                                              193701
     C                     ELSE                                                               193701
     C                     Z-ADDZAMTCO    ZFLD15                                              193701
     C                     ENDIF                                                              193701
      *                                                                                       193701
     C                     ELSE                                                               193701
     C                     Z-ADDWCUPR     ZFLD15                                              193701
     C                     ENDIF                                                              193701
     C                     EXSR ZSEDIT                                                        193701
     C                     MOVE ZOUT21    SCUBL                                               193701
     C                     Z-ADDWCUPR     WSVBL                                               193701
     C                     MOVE '1'       *IN68                                               193701
     C                     ADD  1         VSLN                                                193701
     C                     WRITELE0212F2                                                      193701
     C                     MOVE '0'       *IN68                                               193701
      *                                                                                       209383
     C                     ENDIF                                                              209383
     C                     MOVE '1'       *IN31                           184903
      ******************************************************************              BUG9240 246037
      ***If*CAS005*is*installed*and*NIDT*or*NRPD*or*MDAT*is*not*zero****              BUG9240 246037
      ***and*is*greater*than*the*rollover*date,*do*not*write****COMPLETE***'          BUG9240 246037
      ***narrative*yet**************************************************              BUG9240 246037
      ******************************************************************              BUG9240 246037
     C********** CAS005    IFEQ 'Y'                                                   BUG9240 246037
     C********** WWRLDT    ANDGT ZERO                                                 BUG9240 246037
     C********** NIDT      IFGT  ZERO                                                 BUG9240 246037
     C********** NIDT      ANDGTWWRLDT                                                BUG9240 246037
     C********** NRPD      ORGT *ZERO                                                 BUG9240 246037
     C********** NRPD      ANDGTWWRLDT                                                BUG9240 246037
     C********** MDAT      ORGT *ZERO                                                 BUG9240 246037
     C********** MDAT      ANDGTWWRLDT                                                BUG9240 246037
     C**********           MOVE *OFF      *IN31                                       BUG9240 246037
     C**********           ENDIF                                                      BUG9240 246037
     C**********           ENDIF                                                      BUG9240 246037
      *                                                                                     BUG21922
      ** If SystemValue 'LoanRolloverMaturity' = 'M', display until                         BUG21922
      ** Maturity. If 'R', display until Rollover                                           BUG21922
      *                                                                                     BUG21922
     C           WRKFLD    IFEQ 'M'                                                         BUG21922
      *                                                                                     BUG21922
      ** If CAS005 is installed and NIDT or NRPD or MDAT is not zero                        BUG21922
      ** and is greater than the rollover date, do not write COMPLETE                       BUG21922
      ** narrative yet.                                                                     BUG21922
      *                                                                                     BUG21922
     C           CAS005    IFEQ 'Y'                                                           260274
     C           WWRLDT    ANDGT*ZERO                                                         260274
     C           WENDT     ANDNE99999                                                      MD039391A
     C           NIDT      IFGT *ZERO                                                         260274
     C           NIDT      ANDGTWWRLDT                                                        260274
     C           NRPD      ORGT *ZERO                                                         260274
     C           NRPD      ANDGTWWRLDT                                                        260274
     C           MDAT      ORGT *ZERO                                                         260274
     C           MDAT      ANDGTWWRLDT                                                        260274
     C                     MOVE *OFF      *IN31                                               260274
     C                     ENDIF                                                              260274
     C                     ENDIF                                                              260274
     C*                                                                                     BUG21922
     C                     ENDIF                                                            BUG21922
     C                     ENDIF                                          184903
     C                     ELSE                                           184903
     C           WCNT      IFEQ 0                                         184903
     C********** VSLN      ANDLE20                                                     193701 209383
     C           VSLN      ANDLT20                                                            209383
      *                                                                                       209383
     C           *IN21     IFNE '1'                                                           209383
     C           *IN20     IFEQ '1'                                                           193701
      *                                                                                       193701
     C           WEUIN     IFEQ 'Y'                                                           193701
     C                     Z-ADDPOUTA     ZFLD15                                              193701
     C                     ELSE                                                               193701
     C                     Z-ADDZAMTCO    ZFLD15                                              193701
     C                     ENDIF                                                              193701
      *                                                                                       193701
     C                     ELSE                                                               193701
     C                     Z-ADDWCUPR     ZFLD15                                              193701
     C                     ENDIF                                                              193701
     C                     EXSR ZSEDIT                                                        193701
     C                     MOVE ZOUT21    SCUBL                                               193701
     C                     Z-ADDWCUPR     WSVBL                                               193701
     C                     MOVE '1'       *IN68                                               193701
     C                     ADD  1         VSLN                                                193701
     C                     WRITELE0212F2                                                      193701
     C                     MOVE '0'       *IN68                                               193701
      *                                                                                       209383
     C                     ENDIF                                                              209383
     C                     MOVE '1'       *IN31                           184903
      ******************************************************************              BUG9240 246037
      ***If*CAS005*is*installed*and*NIDT*or*NRPD*or*MDAT*is*not*zero****              BUG9240 246037
      ***and*is*greater*than*the*rollover*date,*do*not*write****COMPLETE **'          BUG9240 246037
      ***narrative*yet**************************************************              BUG9240 246037
      ******************************************************************              BUG9240 246037
     C********** CAS005    IFEQ 'Y'                                                   BUG9240 246037
     C********** WWRLDT    ANDGT*ZERO                                                 BUG9240 246037
     C********** NIDT      IFGT *ZERO                                                 BUG9240 246037
     C********** NIDT      ANDGTWWRLDT                                                BUG9240 246037
     C********** NRPD      ORGT *ZERO                                                 BUG9240 246037
     C********** NRPD      ANDGTWWRLDT                                                BUG9240 246037
     C********** MDAT      ORGT *ZERO                                                 BUG9240 246037
     C********** MDAT      ANDGTWWRLDT                                                BUG9240 246037
     C**********           MOVE *OFF      *IN31                                       BUG9240 246037
     C**********           ENDIF                                                      BUG9240 246037
     C**********           ENDIF                                                      BUG9240 246037
      *                                                                                     BUG21922
      ** If SystemValue 'LoanRolloverMaturity' = 'M', display until                         BUG21922
      ** Maturity. If 'R', display until Rollover                                           BUG21922
      *                                                                                     BUG21922
     C           WRKFLD    IFEQ 'M'                                                         BUG21922
      *                                                                                     BUG21922
      ** If CAS005 is installed and NIDT or NRPD or MDAT is not zero                        BUG21922
      ** and is greater than the rollover date, do not write '* COMPLETE *'                 BUG21922
      ** narrative yet.                                                                     BUG21922
      *                                                                                     BUG21922
     C           CAS005    IFEQ 'Y'                                                           260274
     C           WWRLDT    ANDGT*ZERO                                                         260274
     C           WENDT     ANDNE99999                                                      MD039391A
     C           NIDT      IFGT *ZERO                                                         260274
     C           NIDT      ANDGTWWRLDT                                                        260274
     C           NRPD      ORGT *ZERO                                                         260274
     C           NRPD      ANDGTWWRLDT                                                        260274
     C           MDAT      ORGT *ZERO                                                         260274
     C           MDAT      ANDGTWWRLDT                                                        260274
     C                     MOVE *OFF      *IN31                                               260274
     C                     ENDIF                                                              260274
     C                     ENDIF                                                              260274
      *                                                                                     BUG21922
     C                     ENDIF                                                            BUG21922
     C                     ENDIF                                          184903
     C                     ENDIF                                          184903
     C                     ENDIF                                          184903
     C/COPY WNCPYSRC,LEH00859
     C           RLDT      IFEQ *ZEROS                                    133915
     C           MDAT      ANDNE*ZEROS                                    133915
     C           RECI      ANDNE'M'                                       133915
     C           MDAT      ANDGERUND                                      189899
     C           RLDT      OREQ *ZEROS                                                        202726
     C           MDAT      ANDNE*ZEROS                                                        202726
     C/COPY WNCPYSRC,LEH00860
     C           RECI      ANDNE'M'                                                           202726
     C           MDAT      ANDLTRUND                                                          202726
     C           LCD       ANDEQRUND                                                          202726
     C                     EXSR SRMDAT                                    133915
     C                     MOVE '0'       *IN68                           133915
     C                     ELSE                                           133915
     C           RLDT      IFEQ *ZEROS                                    184903
     C                     MOVE '1'       *IN31                           133915
     C                     ENDIF                                          184903
     C                     ENDIF                                          133915
     C                     ENDIF
      *                                                                                       253760
     C           *IN34     IFEQ '1'                                                           253760
     C           *IN37     ANDEQ'1'                                                           253760
     C                     Z-ADD99999     WCODT                                               253760
     C                     ENDIF                                                              253760
      *
      ** Exit loop if no action record left to display or page is full
      *
     C           *IN31     IFEQ '1'
     C********** VSLN      OREQ 20                                                            188806
     C           VSLN      ORGE 20                                                            188806
     C           WFINL     OREQ 'Y'
     C           *IN08     OREQ '1'                                                           200089
     C           WSAME     ANDEQ'Y'                                                           200089
     C           WOVFL     ANDEQ'Y'                                                           200089
     C                     MOVE 'Y'       WFULL
     C                     ENDIF
     C           VDATH     IFEQ 99999                                                       BUG13074
     C           VDATL     ANDEQ99999                                                       BUG13074
     C                     ADD  1         WLOOP                                             BUG13074
     C           WLOOP     IFEQ 99                                                          BUG13074
     C                     MOVE 'Y'       WFULL                                             BUG13074
     C                     ENDIF                                                            BUG13074
     C                     ENDIF                                                            BUG13074
     C                     ENDDO
      *
      ** Write 'COMPLETE' if end of action
      *
     C           *IN31     IFEQ '1'
     C                     MOVE '0'       *IN21                           133915
     C                     MOVE '0'       *IN22                           133915
     C                     MOVE '0'       *IN23                           133915
     C                     MOVE '0'       *IN24                           133915
     C                     Z-ADD0         WIPAID                          133915
     C                     Z-ADD0         WCALC                           133915
     C**********           MOVE '0'       *IN24                                        133915 193701
     C                     MOVEL'LEE0008' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SEMSG
     C                     ENDIF
      *
      ** Write if rollup and/or rolldown keys are available
      *
     C           *IN69     IFEQ '1'
     C           *IN31     IFEQ '0'
     C                     MOVEL'LEE0010' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SCMSG
     C                     ENDIF
     C                     ENDIF
     C           *IN08     IFEQ '1'
     C           *IN31     IFEQ '1'
     C                     MOVEL'LEE0011' ZAMSID
     C                     ELSE
     C                     MOVEL'LEE0009' ZAMSID
     C                     ENDIF
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SCMSG
     C                     ENDIF
      *
     C                     ENDSR
     C/COPY WNCPYSRC,LEH00923
      /EJECT
      *****************************************************************
      * SRINVR  -  Initialise variables on display of first screen    *
      * Called by: SRPROC - Process enquiry request                   *
      * Calls    : None                                               *
      *****************************************************************
     C           SRINVR    BEGSR
      *
      ** Initialise work fields
      *
     C                     MOVE *OFF      *IN21                           154221
     C                     MOVE *OFF      *IN22                           154221
     C                     MOVE *OFF      *IN23                           159779
     C                     MOVE *OFF      *IN24                           159779
     C                     MOVE '1'       *IN30
     C           CAS005    IFEQ 'Y'                                                          BUG9240
     C           WWRLDT    ANDNE*ZERO                                                        BUG9240
     C                     Z-ADDWWRLDT    RLDT                                               BUG9240
     C                     ENDIF                                                             BUG9240
     C           RLDT      IFEQ 0                                                             207961
     C                     MOVE '0'       WRLDS   1                                           207961
     C                     ELSE                                                               207961
     C                     MOVE '1'       WRLDS   1                       184903
     C                     ENDIF                                                              207961
     C                     MOVE '0'       WROLL   1                       184903
     C                     MOVE '0'       *IN31
     C                     MOVE 'Y'       WFREC   1
     C                     MOVE 'Y'       WINIT   1
     C                     Z-ADD*ZEROS    WLASD   50
     C                     Z-ADD*ZEROS    WSVBL  130
     C                     Z-ADD*ZEROS    WCURT  117
     C                     Z-ADD*ZEROS    WCUPR  130
     C                     Z-ADD*ZEROS    WNCUPR 130                                          219717
     C                     Z-ADD*ZEROS    WAMCV  130                                          193701
     C                     Z-ADD*ZEROS    WINCA  130
     C                     Z-ADD*ZEROS    WINPD  130
     C                     Z-ADD*ZEROS    IPDUE  130                                          225849
     C                     Z-ADD*ZEROS    WINTA                           159779
     C                     Z-ADD*ZEROS    WPRAM                           159779
     C                     Z-ADD*ZEROS    WZIEND                          159779
     C                     Z-ADD*ZEROS    F#DATE  50                                          247791
     C                     MOVE *BLANK    WRLDT   7                       184903
     C                     MOVE *BLANK    WFINL   1
     C                     MOVE *BLANK    WSVDT   7
     C                     MOVE *BLANK    WSAME   1
     C                     MOVE *BLANK    PSAME   1                                         BUG13074
     C                     MOVE *BLANK    WSUBR   1
     C                     MOVE *BLANK    WOVFL   1
     C                     MOVE *BLANK    WDTL1   1
     C                     MOVE *BLANK    WDTL2   1
     C                     MOVE *BLANK    WDTL3   1
     C                     MOVE *BLANK    WDTL4   1
     C                     MOVE *BLANK    WDTL5   1
     C                     MOVE *BLANK    WDTL6   1                                           193701
     C                     MOVE *BLANK    WDTL7   1                                           193701
     C                     MOVE *BLANK    WDTL8   1                                           193701
     C                     MOVE *BLANK    WDTL9   1                                           218984
     C                     Z-ADD0         WCNT    10                      184903
     C                     Z-ADD0         W#NEXT                          154221
     C                     Z-ADD0         WNEXTO                                             249835B
     C                     Z-ADD0         W#NEXR                          154221
     C                     Z-ADD0         WSTPA                                               209517
     C                     MOVE *BLANKS   WSTAC                                               209517
      *
      ** Initialise fields for frequency repayments
      *
     C                     MOVE 'Y'       WRPPR   1
     C                     MOVE 'Y'       WRPIN   1
     C                     MOVE 'Y'       WPRWR   1        Previous repay date written       BUG9240
     C                     MOVE *BLANKS   WFRPR
     C                     MOVE *BLANKS   WFRIN
     C                     MOVE *BLANKS   WRPR1
     C                     MOVE *BLANKS   WRIN1
     C           WENDT     IFGT *ZEROS
     C           WNRPD     IFNE *ZEROS
     C/COPY WNCPYSRC,LEH00930
     C           WNRPD     ANDLEWENDT
     C/COPY WNCPYSRC,LEH00931
     C           PTYP      ANDNE80                                                            CLE028
     C           WNRPD     ORNE *ZEROS                                                        CLE028
     C           WNRPD     ANDLTWENDT                                                         CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     MOVE 'Y'       WFRPR
     C                     MOVE 'Y'       WRPR1
     C                     Z-ADDWNRPD     NRPD
     C                     Z-ADDWNRPD     WENDR                           154221
      *                                                                   154221
      ***If*due*'Next',*determine*whether*day*before*repayment*date***    154221              209383
      ***was*a*holiday*or*not.***                                         154221              209383
      *                                                                   154221
     C                     Z-ADDWNRPD     W#NEXR                          154221
      *                                                                   154221
     C********** PDDI      IFEQ 'N'                                       154221              209383
     C********** WNRPD     SUB  1         WNRPD1  50                      154221              209383
     C**********           Z-ADDWNRPD1    ZDAYNO                          154221              209383
     C***********          MOVE CCY       ZCCY                     154221 157635
     C**********           MOVE CCYCL     ZCCY                            157635              209383
     C**********           MOVE WNLOC     ZLOC                            154221              209383
     C**********           Z-ADD*ZEROS    ZNRDYS                          154221              209383
     C**********           EXSR ZBKDT                                     154221              209383
     C********** ZDYNBR    IFNE WNRPD1                                    154221              209383
     C**********           Z-ADDZDYNBR    W#NEXR                          154221              209383
     C**********           ENDIF                                          154221              209383
     C**********           ENDIF                                          154221              209383
      *                                                                   154221              209383
      *                                                                   154221
     C                     ENDIF
     C           WNIDT     IFNE *ZEROS
     C/COPY WNCPYSRC,LEH00932
     C           WNIDT     ANDLEWENDT
     C/COPY WNCPYSRC,LEH00933
     C                     MOVE 'Y'       WFRIN
     C                     MOVE 'Y'       WRIN1
     C                     Z-ADDWNIDT     NIDT
     C                     Z-ADDWNIDT     WENDI
      *                                                                   154221
      ***If*due*'Next',*determine*whether*day*before*interest*date*was*** 154221              209383
      ***a*holiday*or*not.***                                             154221              209383
      *                                                                   154221
     C                     Z-ADDWNIDT     W#NEXT                          150965
      *                                                                   154221
     C********** PDDI      IFEQ 'N'                                       154221              209383
     C********** WNIDT     SUB  1         WNIDT1  50                      154221              209383
     C**********           Z-ADDWNIDT1    ZDAYNO                          154221              209383
     C***********          MOVE CCY       ZCCY                     154221 157635
     C**********           MOVE CCYCL     ZCCY                            157635              209383
     C**********           MOVE WNLOC     ZLOC                            154221              209383
     C**********           Z-ADD*ZEROS    ZNRDYS                          154221              209383
     C**********           EXSR ZBKDT                                     154221              209383
     C********** ZDYNBR    IFNE WNIDT1                                    154221              209383
     C**********           Z-ADDZDYNBR    W#NEXT                          154221              209383
     C**********           ENDIF                                          154221              209383
     C**********           ENDIF                                          154221              209383
      *                                                                   154221              209383
     C                     ENDIF
     C                     ENDIF
      ***Initialize*PASS1*flag*to*'N'.*********************************            BUG13282 AR401496
     C**********           MOVEL'N'       PASS1   1                                BUG13282 AR401496
      *
     C                     ENDSR
      /EJECT
      *****************************************************************                      BUG9052
      *                                                               *                      BUG9052
      *  SRSTLN - Process record read from customer loans file        *                      BUG9052
      *                                                               *                      BUG9052
      *  Called by: SRPROC - Process enquiry request                  *                      BUG9052
      *  Calls    : SROUTS - Format start record for display          *                      BUG9052
      *                                                               *                      BUG9052
      *****************************************************************                      BUG9052
     C           SRSTLN    BEGSR                                                             BUG9052
      *                                                                                      BUG9052
     C                     Z-ADDICBS      WICBS                                              BUG9052
      *                                                                                       241579
      ** Initially set work calculation basis as loan's original calc basis.                  241579
      ** Value here may change later depending on the availability of LOAM                    241579
      ** or HIST record for that loan.                                                        241579
     C                     Z-ADDICBS      OICBS                                               241579
      *                                                                                       241579
     C                     Z-ADDVDATS     WLTDT                                              BUG9052
      *                                                                                      BUG9052
     C           PTYP      IFEQ 63                                                           BUG9052
     C           PTYP      OREQ 65                                                           BUG9052
     C           PTYP      OREQ 67                                                           BUG9052
     C                     Z-ADD0         WCURT                                              BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
      ** Prepare to display action if selected                                               BUG9052
      *                                                                                      BUG9052
     C           VDATS     IFGE WDTIN                                                        BUG9052
     C           WCDIN     IFEQ *BLANK                                                       BUG9052
     C           WCDIN     OREQ 'B'                                                          BUG9052
     C           VDATS     ANDLTRUND                                                         BUG9052
     C           WCDIN     OREQ 'F'                                                          BUG9052
     C           VDATS     ANDGERUND                                                         BUG9052
      *                                                                                      BUG9052
     C                     EXSR SROUTS                                                       BUG9052
      *                                                                                      BUG9052
     C                     ENDIF                                                             BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
     C                     ENDSR                                                             BUG9052
      /EJECT                                                                                 BUG9052
      *****************************************************************                      BUG9052
      *                                                               *                      BUG9052
      *  SROUTS - Format start record for display                     *                      BUG9052
      *                                                               *                      BUG9052
      *  Called by: SRSTLN - Process records read from PF/CLOANCL     *                      BUG9052
      *  Calls    : SRTEXT - Set up text from message file            *                      BUG9052
      *             SRDISS - Display start record                     *                      BUG9052
      *                                                               *                      BUG9052
      *****************************************************************                      BUG9052
     C           SROUTS    BEGSR                                                             BUG9052
      *                                                                                      BUG9052
     C           CLE134    IFEQ 'Y'                                                           263418
     C                     MOVELLTYP      DSLTYP                                              263418
     C                     MOVE *BLANKS   DSPPDA                                              263418
     C                     ENDIF                                                              263418
      *                                                                                       263418
     C           CLE134    IFEQ 'Y'                                                           263418
     C           DSLTY1    IFEQ 'X'                                                           263418
     C           DSLTY1    OREQ 'Y'                                                           263418
     C           DSLTY1    OREQ 'Z'                                                           263418
     C                     MOVE LNRF      KYPLON                                              263418
     C                     MOVE VDAT      KYPDVD                                              263418
     C                     Z-ADDCPAM      DSOLAM                                              263418
     C           DSLTY1    IFEQ 'X'                                                           263418
     C           DSLTY1    OREQ 'Z'                                                           263418
     C                     MOVE 'P'       DSPDCT                                              263418
     C                     ELSE                                                               263418
     C                     MOVE 'I'       DSPDCT                                              263418
     C                     ENDIF                                                              263418
     C                     CLEARDSLASN                                                        263418
     C                     MOVE 'ST'      AMTPH                                               263418
     C                     EXSR XEPPD1                                                        263418
     C                     ENDIF                                                              263418
     C                     ENDIF                                                              263418
      *                                                                                       263418
     C           TOTI      IFEQ *ZEROS                                                       BUG9052
     C                     MOVEL'LEE0040' ZAMSID                                             BUG9052
     C                     ELSE                                                              BUG9052
     C                     MOVEL'LEE0048' ZAMSID                                             BUG9052
     C                     ENDIF                                                             BUG9052
     C                     EXSR SRTEXT                                                       BUG9052
     C                     MOVELZAMSTX    SNARR                                              BUG9052
     C                     Z-ADDCPAM      ZFLD15                                             BUG9052
     C                     EXSR ZSEDIT                                                       BUG9052
     C                     MOVE ZOUT21    SAMNT                                              BUG9052
     C                     EXSR SRDISS                                                       BUG9052
      *                                                                                      BUG9052
      ** ... discount                                                                        BUG9052
      *                                                                                      BUG9052
     C           TOTI      IFGT *ZEROS                                                       BUG9052
     C           VSLN      ANDLT20                                                           BUG9052
     C                     MOVEL'LEE0050' ZAMSID                                             BUG9052
     C                     EXSR SRTEXT                                                       BUG9052
     C                     MOVELZAMSTX    SNARR                                              BUG9052
     C                     Z-ADDTOTI      ZFLD15                                             BUG9052
     C                     EXSR ZSEDIT                                                       BUG9052
     C                     MOVE ZOUT21    SAMNT                                              BUG9052
     C                     EXSR SRDISS                                                       BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
      ** ... premium                                                                         BUG9052
      *                                                                                      BUG9052
     C           TOTI      IFLT *ZEROS                                                       BUG9052
     C           VSLN      ANDLT20                                                           BUG9052
     C                     MOVEL'LEE0049' ZAMSID                                             BUG9052
     C                     EXSR SRTEXT                                                       BUG9052
     C                     MOVELZAMSTX    SNARR                                              BUG9052
     C                     Z-SUBTOTI      ZFLD15                                             BUG9052
     C                     EXSR ZSEDIT                                                       BUG9052
     C                     MOVE ZOUT21    SAMNT                                              BUG9052
     C                     EXSR SRDISS                                                       BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
      ** ... base rate                                                                       BUG9052
      *                                                                                      BUG9052
     C           BRTE      IFGT *ZEROS                                                       BUG9052
     C           VSLN      ANDLT20                                                           BUG9052
     C                     MOVEL'LEE0041' ZAMSID                                             BUG9052
     C                     EXSR SRTEXT                                                       BUG9052
     C                     MOVELZAMSTX    SNARR                                              BUG9052
     C                     MOVE BRTE      ZFIELD                                             BUG9052
     C                     Z-ADD7         ZADEC                                              BUG9052
     C                     EXSR ZEDIT                                                        BUG9052
     C                     MOVE ZFIELD    SAMNT                                              BUG9052
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISS                                                       BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                       263418
     C           CLE134    IFEQ 'Y'                                                           263418
     C           DSPPDA    ANDEQ'Y'                                                           263418
     C           YPCPAM    IFNE 0                                                             263418
     C           DSLTY1    IFNE 'Z'                                                          263418A
     C                     MOVEL'LEE5401' ZAMSID                                              263418
     C                     ELSE                                                              263418A
     C                     MOVEL'LEE5413' ZAMSID                                             263418A
     C                     ENDIF                                                             263418A
     C                     ELSE                                                               263418
     C                     MOVEL'LEE5411' ZAMSID                                              263418
     C                     ENDIF                                                              263418
     C           YPORG     IFNE *BLANKS                                                       263418
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPORG     ZAMSDA                                              263418
     C                     ELSE                                                               263418
     C           DSLTY1    IFEQ 'Z'                                                           263418
     C                     CLEARZAMSDA                                                        263418
     C**********           MOVEL'LEE5412' ZAMSID                                      263418 263418A
     C                     MOVEL'LEE5413' ZAMSID                                             263418A
     C                     CLEARD@FEE                                                         263418
     C                     MOVELYEFACL    P@FEFA                                              263418
     C                     MOVE '-'       P@COS                                               263418
     C                     MOVELYESEQ     P@FECD                                              263418
     C                     MOVELD@FEE     ZAMSDA                                              263418
     C                     ENDIF                                                              263418
     C                     ENDIF                                                              263418
     C                     EXSR SRTEXT                                                        263418
     C                     MOVELZAMSTX    SNARR                                               263418
      *                                                                                       263418
     C                     Z-ADDCPAM      ZFLD15                                              263418
     C                     EXSR ZSEDIT                                                        263418
     C                     MOVE ZOUT21    SAMNT                                               263418
     C**********           MOVE 'Y'       WDTL1                                      263418 MD031977
     C                     EXSR SRDISS                                                        263418
     C                     ENDIF                                                              263418
      *                                                                                      BUG9052
      ** ... rate                                                                            BUG9052
      *                                                                                      BUG9052
     C           RTSP      IFGT *ZEROS                                                       BUG9052
     C           BRTE      ANDEQ*ZEROS                                                       BUG9052
     C           VSLN      ANDLT20                                                           BUG9052
     C                     MOVEL'LEE0042' ZAMSID                                             BUG9052
     C                     EXSR SRTEXT                                                       BUG9052
     C                     MOVELZAMSTX    SNARR                                              BUG9052
     C                     MOVE RTSP      ZFIELD                                             BUG9052
     C                     Z-ADD7         ZADEC                                              BUG9052
     C                     EXSR ZEDIT                                                        BUG9052
     C                     MOVE ZFIELD    SAMNT                                              BUG9052
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISS                                                       BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
      ** ... spread rate                                                                     BUG9052
      *                                                                                      BUG9052
     C           RTSP      IFGT *ZEROS                                                       BUG9052
     C           BRTE      ANDGT*ZEROS                                                       BUG9052
     C           VSLN      ANDLT20                                                           BUG9052
     C                     SELEC                                                             BUG9052
     C           SPIN      WHEQ 'A'                                                          BUG9052
     C                     MOVEL'LEE0043' ZAMSID                                             BUG9052
     C           SPIN      WHEQ 'S'                                                          BUG9052
     C                     MOVEL'LEE0044' ZAMSID                                             BUG9052
     C           SPIN      WHEQ 'P'                                                          BUG9052
     C                     MOVEL'LEE0045' ZAMSID                                             BUG9052
     C                     ENDSL                                                             BUG9052
     C                     EXSR SRTEXT                                                       BUG9052
     C                     MOVELZAMSTX    SNARR                                              BUG9052
     C                     MOVE RTSP      ZFIELD                                             BUG9052
     C                     Z-ADD7         ZADEC                                              BUG9052
     C                     EXSR ZEDIT                                                        BUG9052
     C                     MOVE ZFIELD    SAMNT                                              BUG9052
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISS                                                       BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
     C                     ENDSR                                                             BUG9052
      /EJECT                                                                                 BUG9052
      *****************************************************************                      BUG9052
      *                                                               *                      BUG9052
      *  SRDISS - Displays Start record                               *                      BUG9052
      *                                                               *                      BUG9052
      *  Called by: SROUTS   Formats history record                   *                      BUG9052
      *  Calls    : SRDETL - Write detail line                        *                      BUG9052
      *                                                               *                      BUG9052
      *****************************************************************                      BUG9052
     C           SRDISS    BEGSR                                                             BUG9052
      *                                                                                      BUG9052
      ** Convert date                                                                        BUG9052
      *                                                                                      BUG9052
     C           WOVFL     IFEQ *BLANK                                                       BUG9052
     C                     Z-ADDVDATS     ZDAYNO                                             BUG9052
     C                     EXSR ZDATE2                                                       BUG9052
     C                     MOVE ZADATE    SDUDT                                              BUG9052
      *                                                                                      BUG9052
      ** Determine date of input                                                             BUG9052
      *                                                                                      BUG9052
     C           VDATS     IFEQ OREDS                                                        BUG9052
     C                     MOVE *BLANKS   SINDT                                              BUG9052
     C                     ELSE                                                              BUG9052
     C                     Z-ADDOREDS     ZDAYNO                                             BUG9052
     C                     EXSR ZDATE2                                                       BUG9052
     C                     MOVE ZADATE    SINDT                                              BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
      ** Determine code                                                                      BUG9052
      *                                                                                      BUG9052
     C                     MOVE *BLANKS   SSMSG                                              BUG9052
     C                     MOVE *BLANKS   SSGAS                                              BUG9052
     C           GASS      IFEQ 'Y'                                                          BUG9052
     C                     MOVE 'AS'      SSGAS                                              BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
     C           VDATS     IFLT RUND                                                         BUG9052
     C                     MOVE 'B'       SCODE                                              BUG9052
     C                     ELSE                                                              BUG9052
     C                     MOVE 'F'       SCODE                                              BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
      ** Write detail line                                                                   BUG9052
      *                                                                                      BUG9052
     C                     EXSR SRDETL                                                       BUG9052
      *                                                                                      BUG9052
     C                     ENDSR                                                             BUG9052
      /EJECT                                                                                 BUG9052
      *****************************************************************
      * SRHIST  -  Process record read from history file              *
      * Called by: SRPROC - Process enquiry request                   *
      * Calls    : SRDISH - Display history record                    *
      *            SRRPAY - Process each forward repayment            *
      *            SRINCL - Interest calculation                      *
      *            SROUTH - Format history record for display         *
      *            SRNEWI - Compute for new interest rate             *
      *****************************************************************
     C           SRHIST    BEGSR
      *                                                                   147511
     C           AMTPH     IFEQ 'ST'                                      147511
     C                     MOVE CALCH     WICBS                                               206256
     C                     MOVE CALCH     OICBS                                               206256
     C                     MOVE SPINH     WCUSI                                             AR634884
     C                     ENDIF                                                              206256
      *                                                                                       206256
     C********** AMTPH     OREQ 'RO'                                      147511              206256
     C           AMTPH     IFEQ 'RO'                                                          206256
     C           AMTPH     OREQ 'MC'                                      147511
     C                     MOVE WICBS     OICBS   10                                          206256
     C                     MOVE CALCH     WICBS   10                      147511
     C                     MOVE SPINH     WCUSI                                             AR634884
     C                     ENDIF                                          147511
      *
      ** If detail previously printed is current balance, no need to
      ** re-format data
      *
     C           WOVFL     IFEQ 'Y'
      *                                                                   184897
      ** Check if manual repayment for interest should be                 184897
      ** displayed on the next screen.                                    184897
      *                                                                   184897
     C           AMTPH     IFEQ 'MR'                                      184897
     C           AMTPH     OREQ 'MA'                                      184897
     C           INTAH     IFNE *ZEROS                                    184897
     C           PRAMH     ANDNE*ZEROS                                    184897
     C           WDTL2     ANDEQ*BLANK                                    184897
     C                     EXSR SRDISH                                    184897
      *                                                                                       263918
     C           CLE134    IFEQ 'Y'                                                           263918
     C           DSLTY1    IFNE 'X'                                                           263918
     C           DSLTY1    ANDNE'Y'                                                           263918
     C           DSLTY1    ANDNE'Z'                                                           263918
     C                     MOVE LNRFH     KYPORG                                              263918
     C                     MOVE VDATH     KYPDVD                                              263918
     C                     Z-ADDINTAH     DSOLAM                                              263918
     C                     MOVE 'I'       DSPDCT                                              263918
     C                     MOVE LASNH     DSLASN                                              263918
     C                     Z-ADDLCDH      KYLCD                                             AR720887
     C                     EXSR XEPPD1                                                        263918
     C                     ENDIF                                                              263918
     C                     ENDIF                                                              263918
      *                                                                                       263918
     C           AMTPH     IFEQ 'MR'                                      184897
      *                                                                                       247071
     C           GASSH     IFEQ 'A'                                                           247071
     C                     MOVEL'LEE0318' ZAMSID                                              247071
     C                     ELSE                                                               247071
     C                     MOVEL'LEE0025' ZAMSID                          184897
     C                     ENDIF                                                              247071
      *                                                                                       247071
     C                     ENDIF                                          184897
     C           AMTPH     IFEQ 'MA'                                      184897
     C           SCAPI     IFEQ 'YES'                                     184897
     C                     MOVEL'LEE0046' ZAMSID                          184897
     C                     ELSE                                           184897
     C                     MOVEL'LEE0019' ZAMSID                          184897
     C                     ENDIF                                          184897
     C                     ENDIF                                          184897
     C                     EXSR SRTEXT                                    184897
     C                     MOVELZAMSTX    SNARR                           184897
     C                     Z-ADDINTAH     ZFLD15                          184897
      *                                                                                       263918
     C           CLE134    IFEQ 'Y'                                                           263918
     C           DSPPDA    ANDEQ'Y'                                                           263918
     C           INTAH     SUB  YPDINT    ZFLD15                                              263918
     C                     ENDIF                                                              263918
      *                                                                                       263918
     C                     EXSR ZSEDIT                                    184897
     C                     MOVE ZOUT21    SAMNT                           184897
     C                     MOVE 'Y'       WDTL2                           184897
     C**********           ENDIF                                                     184897 AR720887
      *                                                                                       263918
      ** ... Past Due Interest Transfer to PDCL.                                              263918
      *                                                                                       263918
     C           CLE134    IFEQ 'Y'                                                           263918
     C           DSPPDA    ANDEQ'Y'                                                           263918
     C                     EXSR SRDISH                                                        263918
      *                                                                                       263918
     C           WOVFL     IFEQ 'Y'                                                         AR400094
     C                     MOVEL'LEE5410' WAMSID                                            AR400094
     C                     MOVELYPLON     WAMSDA                                            AR400094
     C                     Z-ADDYPDINT    WFLD15                                            AR400094
     C                     MOVE 'Y'       WWSCND                                            AR400094
     C                     MOVE 'Y'       WWDTL1                                            AR400094
      *                                                                                     AR400094
     C                     ELSE                                                             AR400094
      *                                                                                     AR400094
     C                     MOVEL'LEE5410' ZAMSID                                              263918
     C                     CLEARZAMSDA                                                        263918
     C                     MOVELYPLON     ZAMSDA                                              263918
     C                     EXSR SRTEXT                                                        263918
     C                     MOVELZAMSTX    SNARR                                               263918
      *                                                                                       263918
     C                     Z-ADDYPDINT    ZFLD15                                              263918
     C                     EXSR ZSEDIT                                                        263918
     C                     MOVE ZOUT21    SAMNT                                               263918
     C                     MOVE 'Y'       WDTL1                                               263918
      *                                                                                     AR400094
     C                     ENDIF                                                            AR400094
      *                                                                                     AR400094
     C                     ENDIF                                                              263918
     C                     ENDIF                                                            AR720887
     C                     ENDIF                                          184897
      *                                                                                       210367
      ** If Repayment record, and principal and interest details need                         210367
      ** to be displayed on the screen, format interest information                           210367
      ** after Repayment of principal has been displayed                                      210367
      *                                                                                       210367
     C           AMTPH     IFEQ 'RE'                                                          210367
     C           INTAH     ANDNE*ZEROS                                                        210367
     C           PRAMH     ANDNE*ZEROS                                                        210367
     C           WDTL2     ANDEQ*BLANK                                                        210367
     C           VSLN      ANDLT20                                                            210367
     C                     EXSR SRDISH                                                        210367
      *                                                                                     AR728070
     C           CLE134    IFEQ 'Y'                                                         AR728070
     C           DSLTY1    IFNE 'X'                                                         AR728070
     C           DSLTY1    ANDNE'Y'                                                         AR728070
     C           DSLTY1    ANDNE'Z'                                                         AR728070
     C                     MOVE LNRFH     KYPORG                                            AR728070
     C                     MOVE VDATH     KYPDVD                                            AR728070
     C                     Z-ADDINTAH     DSOLAM                                            AR728070
     C                     MOVE 'I'       DSPDCT                                            AR728070
     C                     MOVE LASNH     DSLASN                                            AR728070
     C                     Z-ADDLCDH      KYLCD                                             AR728070
     C                     EXSR XEPPD1                                                      AR728070
     C                     ENDIF                                                            AR728070
     C                     ENDIF                                                            AR728070
      *                                                                                     AR728070
     C                     MOVEL'LEE0029' ZAMSID                                              210367
     C                     EXSR SRTEXT                                                        210367
     C                     MOVELZAMSTX    SNARR                                               210367
     C                     Z-ADDINTAH     ZFLD15                                              210367
      *                                                                                     AR728070
     C           CLE134    IFEQ 'Y'                                                         AR728070
     C           DSPPDA    ANDEQ'Y'                                                         AR728070
     C           INTAH     SUB  YPDINT    ZFLD15                                            AR728070
     C                     ENDIF                                                            AR728070
      *                                                                                     AR728070
     C                     EXSR ZSEDIT                                                        210367
     C                     MOVE ZOUT21    SAMNT                                               210367
     C                     MOVE 'Y'       WDTL2                                               210367
      *                                                                                     AR728070
      ** ... Past Due Interest Transfer to PDCL.                                            AR728070
      *                                                                                     AR728070
     C           CLE134    IFEQ 'Y'                                                         AR728070
     C           DSPPDA    ANDEQ'Y'                                                         AR728070
     C                     EXSR SRDISH                                                      AR728070
      *                                                                                     AR728070
     C           WOVFL     IFEQ 'Y'                                                         AR728070
     C                     MOVEL'LEE5410' WAMSID                                            AR728070
     C                     MOVELYPLON     WAMSDA                                            AR728070
     C                     Z-ADDYPDINT    WFLD15                                            AR728070
     C                     MOVE 'Y'       WWSCND                                            AR728070
     C                     MOVE 'Y'       WWDTL1                                            AR728070
      *                                                                                     AR728070
     C                     ELSE                                                             AR728070
      *                                                                                     AR728070
     C                     MOVEL'LEE5410' ZAMSID                                            AR728070
     C                     CLEARZAMSDA                                                      AR728070
     C                     MOVELYPLON     ZAMSDA                                            AR728070
     C                     EXSR SRTEXT                                                      AR728070
     C                     MOVELZAMSTX    SNARR                                             AR728070
      *                                                                                     AR728070
     C                     Z-ADDYPDINT    ZFLD15                                            AR728070
     C                     EXSR ZSEDIT                                                      AR728070
     C                     MOVE ZOUT21    SAMNT                                             AR728070
     C                     MOVE 'Y'       WDTL1                                             AR728070
      *                                                                                     AR728070
     C                     ENDIF                                                            AR728070
      *                                                                                     AR728070
     C                     ENDIF                                                            AR728070
     C                     ENDIF                                                              210367
      *                                                                                       210367
     C                     EXSR SRDISH
     C                     ELSE
      *
      ** Process frequency repayments
      *
     C           WFRPR     IFEQ 'Y'
     C           WFRIN     OREQ 'Y'
     C                     Z-ADDVDATH     WCODT   50
     C           WREPT     DOUEQ*BLANK                                    132287
     C                     EXSR SRRPAY
     C                     ENDDO                                          132287
     C                     ENDIF
      *                                                                                     MD028338
     C                     MOVE 'N'       WFXCHG  1                                         MD028338
     C           AMTPH     IFEQ 'RO'                                                        MD028338
     C           FRCOH     ANDEQ'Y'                                                         MD028338
     C                     MOVE 'Y'       WFXCHG                                            MD028338
     C                     ENDIF                                                            MD028338
      *
      ** Accumulate interest on change of date
      *
     C***********WSAME     IFEQ *BLANK                             132287 154221
     C           WLASD     IFNE VDATH
     C           WLASD     ANDNE*ZEROS
     C           WSTAC     ANDEQ*BLANK
     C           AMTPH     ANDNE'MI'                                                        AR753186
     C           AMTPH     ANDNE'LS'                                                        AR753186
     C           WFXCHG    ANDNE'Y'                                                         MD028338
      *                                                                                     AR317587
      ** Use MDAT as End Date for interest calculation if VDATL is greater                  AR317587
      ** than MDAT.                                                                         AR317587
      *                                                                                     AR317587
     C                     Z-ADDVDATH     ZIEND                                             MD020852
     C           VDATH     IFGT MDAT                                                        AR317587
     C********** AMTPH     ANDEQ'MR'                                               AR317587 MD020852
     C           MDAT      ANDGT*ZEROS                                                      MD020852
     C                     Z-ADDMDAT      ZIEND                                             AR317587
     C**********           ELSE                                                    AR317587 MD020852
     C**********           Z-ADDVDATH     ZIEND                                             MD020852
     C                     ENDIF                                                            AR317587
      *                                                                                     AR317587
     C                     Z-ADDVDATH     W78BEG                                              CLE028
      *                                                                                     AR317587
     C                     Z-ADDVDATH     W78END                                            MD020852
     C           VDATH     IFGT MDAT                                                        AR317587
     C********** AMTPH     ANDEQ'MR'                                               AR317587 MD020852
     C           MDAT      ANDGT*ZEROS                                                      MD020852
     C                     Z-ADDMDAT      W78END                                            AR317587
     C**********           ELSE                                                    AR317587 MD020852
     C**********           Z-ADDVDATH     W78END                                     CLE028 MD020852
     C                     ENDIF                                                            AR317587
      *                                                                                     AR317587
     C                     MOVE 'A'       W78ROA                                              CLE028
     C                     EXSR SRINCL
     C                     ADD  ZINTR     WCALC  152                      133915
     C           RDFC      IFEQ 'Y'                                       147511
     C                     ADD  ZINTR     WINCA
     C                     ELSE                                           147511
     C                     ADD  ZINTR     WINCA     H                     147511
     C                     ENDIF                                          147511
     C                     ENDIF
      *                                                                                       224758
     C           AMTPH     IFEQ 'RO'                                                          224758
     C           VDATH     ANDLT99999                                                         224758
     C                     MOVE WICBS     OICBS                                               224758
     C                     ENDIF                                                              224758
      *
      ** Prepare to display action if selected
      *
     C           VDATH     IFGE WDTIN
     C           WCDIN     IFEQ *BLANK
     C           WCDIN     OREQ 'H'
     C                     EXSR SROUTH
     C                     ENDIF
     C                     ENDIF
     C***********          ENDIF                                   132287 154221
     C                     ENDIF
      *
      ** Maintain current principal, rate and interest paid
      *
     C           WSAME     IFEQ *BLANK
     C                     SELEC
     C           AMTPH     WHEQ 'ST'
     C           AMTPH     OREQ 'MC'
     C           AMTPH     IFEQ 'ST'                                      144916
     C                     Z-ADDPRAMH     WSVBL
     C                     Z-ADDPRAMH     WCUPR
     C                     ELSE                                           144916
     C                     Z-ADDCPAMH     WSVBL                           144916
     C                     Z-ADDCPAMH     WCUPR                           144916
     C                     ENDIF                                          144916
     C/COPY WNCPYSRC,LEH00934
     C                     Z-ADDBRTEH     WCUBR
     C                     Z-ADDRTSPH     WCUSP
      * If CLE003 off, get interest rate using base rate & spread rate.   181312
     C           CLE003    IFEQ 'Y'                                       181312
     C                     Z-ADDINTRH     WCURT
     C                     ELSE                                           181312
     C                     EXSR SRNEWI                                    181312
     C                     ENDIF                                          181312
     C                     Z-ADDVDATH     WLICD
      *
     C           AMTPH     WHEQ 'IN'
     C                     ADD  INTAH     WINPD
     C                     ADD  INTAH     WIPAID                          133915
     C           SCAPI     IFEQ 'YES'
     C                     ADD  INTAH     WCUPR
     C/COPY WNCPYSRC,LEH00935
     C                     ENDIF
      *                                                                                       CLE028
      ** Add interest amount to current principal if interest added-on                        CLE028
      ** for flat rate personal loans                                                         CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADIF      ANDEQ'Y'                                                           CLE028
     C                     ADD  PRAMH     WSVBL                                               CLE028
     C                     ADD  PRAMH     WCUPR                                               CLE028
     C/COPY WNCPYSRC,LEH00936
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Add charge amount to current principal if charges added-on                           CLE028
      ** for flat rate personal loans                                                         CLE028
      *                                                                                       CLE028
     C           AMTPH     WHEQ 'CH'                                                          CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADCF      ANDEQ'Y'                                                           CLE028
     C                     ADD  CHDUH     WSVBL                                               CLE028
     C                     ADD  CHDUH     WCUPR                                               CLE028
     C/COPY WNCPYSRC,LEH00937
      *
     C           AMTPH     WHEQ 'RO'
     C           PRINRO    IFNE *ZEROS
     C                     Z-ADDPRINRO    WCUPR
     C                     Z-ADDPRINRO    WSVBL
     C/COPY WNCPYSRC,LEH00938
     C                     ENDIF
     C                     Z-ADDBRTEH     WCUBR
     C                     Z-ADDRTSPH     WCUSP
      * If CLE003 off, get interest rate using base rate & spread rate.   181312
     C           CLE003    IFEQ 'Y'                                       181312
     C                     Z-ADDINTRH     WCURT
     C                     ELSE                                           181312
     C                     EXSR SRNEWI                                    181312
     C                     ENDIF                                          181312
     C           WFXCHG    IFNE 'Y'                                                         MD028338
     C                     Z-ADDVDATH     WLICD
     C                     ENDIF                                                            MD028338
      *
     C           AMTPH     WHEQ 'PT'
     C           AMTPH     OREQ 'PI'
     C                     ADD  PRAMH     WCUPR
     C/COPY WNCPYSRC,LEH00939
      *
     C           AMTPH     WHEQ 'PF'
     C                     SUB  PRAMH     WCUPR
     C/COPY WNCPYSRC,LEH00940
      *
     C           AMTPH     WHEQ 'MR'
     C           AMTPH     OREQ 'RE'
     C           AMTPH     OREQ 'MA'
     C                     ADD  INTAH     WINPD
     C                     ADD  INTAH     WIPAID                          133915
      ** For 'MA' records, add the INTAH to WCUPR if interest is                              186180
      ** capitalised                                                                          186180
     C           AMTPH     IFEQ 'MA'                                                          186180
     C           SCAPI     ANDEQ'YES'                                                         186180
     C                     ADD  INTAH     WCUPR                                               186180
     C/COPY WNCPYSRC,LEH00941
     C                     ENDIF                                                              186180
     C                     SUB  PRAMH     WCUPR
     C/COPY WNCPYSRC,LE0212C009
      *
     C           AMTPH     WHEQ 'BR'
     C           AMTPH     OREQ 'BC'
     C                     Z-ADDBRTEH     WCUBR
     C                     EXSR SRNEWI
      *
     C           AMTPH     WHEQ 'SC'
      * Only process Spread Changes that amended the interest spread rate                     248506
     C           IRCFH     IFEQ 'Y'                                                           248506
     C           IRCFH     ORNE 'Y'                                                           255285
     C           BGN0ST    ANDNE'Y'                                                           255285
     C                     Z-ADDRTSPH     WCUSP
     C                     EXSR SRNEWI
     C                     ENDIF                                                              248506
      *
     C           AMTPH     WHEQ 'MI'
     C                     ADD  INTAH     WINCA
     C                     ADD  INTAH     WCALC                           133915
      *
     C           AMTPH     WHEQ 'SA'
     C           WSTAC     IFEQ *BLANK
     C                     Z-ADDVDATH     WLICD
     C                     ENDIF
     C                     ENDSL
      *
     C           WINIT     IFEQ 'Y'
     C                     Z-ADDWCUPR     WSVBL
     C                     MOVE *BLANK    WINIT
     C                     ENDIF
     C                     MOVE SUTPH     WHSUTP  2
     C                     MOVE CLASH     WHCLAS  4                                           CLE042
     C                     Z-ADDVDATH     WLTDT   50
     C           AMTPH     IFNE 'MI'                                                        AR753186
     C           AMTPH     ANDNE'LS'                                                        AR753186
     C           WFXCHG    ANDNE'Y'                                                         MD028338
     C                     Z-ADDVDATH     WLASD
     C                     ENDIF                                                            AR753186
      *
      ** Read next history record
      *
     C           *IN37     IFEQ '0'
     C           KEYH      READEHISTR                    37
     C           *IN37     IFEQ '1'
     C                     Z-ADD99999     VDATH
     C                     Z-ADD99999     WCODT
     C                     MOVE WICBS     OICBS                                               206256
     C                     ENDIF
     C                     MOVE *BLANK    WOVFL
     C                     MOVE *BLANK    WDTL1
     C                     MOVE *BLANK    WDTL2
     C                     MOVE *BLANK    WDTL3
     C                     MOVE *BLANK    WDTL4
     C                     MOVE *BLANK    WDTL5
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SROUTH  -  Format history record for display                  *
      * Called by: SRHIST - Process history record                    *
      * Calls    : SRTEXT - Set up text from message file             *
      *            SRDISH - Display history record                    *
      *****************************************************************
     C           SROUTH    BEGSR
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C                     MOVELLTYP      DSLTYP                                              CLE134
     C                     MOVE *BLANKS   DSPPDA                                              CLE134
     C                     ENDIF                                                              CLE134
      *
      ** Principal transfer from
      *
     C                     SELEC
     C           AMTPH     WHEQ 'PF'
     C                     MOVEL'LEE0055' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     MOVELROLNH     #ROLN  16
     C                     MOVE #ROLN     SNARR
     C                     Z-ADDPRAMH     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     EXSR SRDISH
      *
      ** Principal transfer to
      *
     C           AMTPH     WHEQ 'PT'
     C                     MOVEL'LEE0056' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     MOVELROLNH     #ROLN
     C                     MOVE #ROLN     SNARR
     C                     Z-ADDPRAMH     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     EXSR SRDISH
      *
      ** Multi-ccy rollover
      *
     C           AMTPH     WHEQ 'MC'
     C           WDTL1     IFEQ *BLANK                                                        188806
     C                     MOVEL'LEE0057' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     MOVELCCYH      #CCY    6
     C                     MOVE 'TO'      #CCY
     C***********          MOVELRLCYH     #RLCY   5                       163328
     C                     MOVELRLCYH     WRLCY   4                       163328
     C                     MOVE WRLCY     #RLCY   5                       163328
     C                     MOVEL#CCY      #LCY   11
     C                     MOVE #RLCY     #LCY
     C                     MOVE #LCY      SNARR
     C                     Z-ADDCPAMH     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL1                                               188806
     C                     EXSR SRDISH
     C                     ENDIF                                                              188806
      *                                                                   144916
      ** Multi-ccy rollover - rate                                        144916
      *                                                                   144916
     C********** BRTEH     IFGT *ZEROS                                              144916 AR1071639
     C********** RTSPH     ORGT *ZEROS                                              144916 AR1071639
      *                                                                                    AR1071639
      ** Consider negative rate.                                                           AR1071639
      *                                                                                    AR1071639
     C           BRTEH     IFNE *ZEROS                                                     AR1071639
     C           RTSPH     ORNE *ZEROS                                                     AR1071639
     C                     Z-ADD7         ZADEC                           144916
     C********** BRTEH     IFGT *ZEROS                                              144916 AR1071639
      *                                                                                    AR1071639
      ** Consider a negative base rate.                                                    AR1071639
      *                                                                                    AR1071639
     C           BRTEH     IFNE *ZEROS                                                     AR1071639
     C           WDTL2     ANDEQ*BLANK                                                        188806
     C           VSLN      ANDLT20                                                            188806
     C                     MOVEL'LEE0058' ZAMSID                          144916
      *                                                                                    AR1071639
     C           BRTEH     IFLT 0                                                          AR1071639
     C                     MOVE 'Y'       WSUB                                             AR1071639
     C                     Z-SUBBRTEH     BRTEH                                            AR1071639
     C                     ENDIF                                                           AR1071639
      *                                                                                    AR1071639
     C                     MOVE BRTEH     ZFIELD                          144916
     C                     EXSR SRTEXT                                    144916
     C                     MOVELZAMSTX    SNARR                           144916
     C                     EXSR ZEDIT                                     144916
      *                                                                                    AR1071639
     C           WSUB      IFEQ 'Y'                                                        AR1071639
     C                     MOVE *BLANKS   WSUB                                             AR1071639
     C                     MOVE ZFIELD    WFLD1                                            AR1071639
     C           WFLD1     CAT  '-'       WFLD2                                            AR1071639
     C                     MOVE WFLD2     SAMNT                                            AR1071639
     C                     Z-SUBBRTEH     BRTEH                                            AR1071639
     C                     ELSE                                                            AR1071639
     C                     MOVE ZFIELD    SAMNT                           144916
     C                     ENDIF                                                           AR1071639
      *                                                                                    AR1071639
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     MOVE 'Y'       WDTL2                                               188806
     C                     EXSR SRDISH                                    144916
     C                     ENDIF                                          144916
      *                                                                   144916
     C********** RTSPH     IFGT *ZEROS                                              144916 AR1071639
      *                                                                                    AR1071639
      ** Consider a negative rate.                                                         AR1071639
      *                                                                                    AR1071639
     C           RTSPH     IFNE *ZEROS                                                     AR1071639
     C           WDTL3     ANDEQ*BLANK                                                        188806
     C           VSLN      ANDLT20                                                            188806
      *                                                                                    AR1071639
     C           RTSPH     IFLT 0                                                          AR1071639
     C                     MOVE 'Y'       WSUB                                             AR1071639
     C                     Z-SUBRTSPH     RTSPH                                            AR1071639
     C                     ENDIF                                                           AR1071639
      *                                                                                    AR1071639
     C                     MOVE RTSPH     ZFIELD                          144916
     C                     SELEC                                          144916
     C           BRTEH     WHEQ *ZEROS                                    144916
     C                     MOVEL'LEE0059' ZAMSID                          144916
     C********** BRTEH     WHGT *ZEROS                                              144916 AR1071639
     C           BRTEH     WHNE *ZEROS                                                     AR1071639
     C           SPINH     ANDEQ'A'                                       144916
     C                     MOVEL'LEE0060' ZAMSID                          144916
     C********** BRTEH     WHGT *ZEROS                                              144916 AR1071639
     C           BRTEH     WHNE *ZEROS                                                     AR1071639
     C           SPINH     ANDEQ'S'                                       144916
     C                     MOVEL'LEE0061' ZAMSID                          144916
     C********** BRTEH     WHGT *ZEROS                                              144916 AR1071639
     C           BRTEH     WHNE *ZEROS                                                     AR1071639
     C           SPINH     ANDEQ'P'                                       144916
     C                     MOVEL'LEE0062' ZAMSID                          144916
     C                     ENDSL                                          144916
     C                     EXSR SRTEXT                                    144916
     C                     MOVELZAMSTX    SNARR                           144916
     C                     EXSR ZEDIT                                     144916
      *                                                                                    AR1071639
     C           WSUB      IFEQ 'Y'                                                        AR1071639
     C                     MOVE *BLANKS   WSUB                                             AR1071639
     C                     MOVE ZFIELD    WFLD1                                            AR1071639
     C           WFLD1     CAT  '-'       WFLD2                                            AR1071639
     C                     MOVE WFLD2     SAMNT                                            AR1071639
     C                     Z-SUBRTSPH     RTSPH                                            AR1071639
     C                     ELSE                                                            AR1071639
     C                     MOVE ZFIELD    SAMNT                           144916
     C                     ENDIF                                                           AR1071639
      *                                                                                    AR1071639
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     MOVE 'Y'       WDTL3                                               188806
     C                     EXSR SRDISH                                    144916
     C                     ENDIF                                          144916
     C                     ENDIF                                          144916
      *
      ** Principal increase
      *
     C           AMTPH     WHEQ 'PI'
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSLTY1    IFEQ 'X'                                                           CLE134
     C           DSLTY1    OREQ 'Y'                                                           263418
     C           DSLTY1    OREQ 'Z'                                                           263418
     C                     MOVE LNRFH     KYPLON                                              CLE134
     C                     MOVE VDATH     KYPDVD                                              CLE134
     C                     Z-ADDPRAMH     DSOLAM                                              CLE134
     C********** DSLTY1    IFEQ 'Y'                                                    CLE134 263418
     C           DSLTY1    IFEQ 'X'                                                           263418
     C           DSLTY1    OREQ 'Z'                                                           263418
     C                     MOVE 'P'       DSPDCT                                              CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE 'I'       DSPDCT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     MOVE LASNH     DSLASN                                              CLE134
     C                     Z-ADDLCDH      KYLCD                                             AR720887
     C                     EXSR XEPPD1                                                        CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       247071
      ** ... Past Due Principal Transfer from PDCL.                                           CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C           PRAMH     IFNE 0                                                             CLE134
     C           YPDCT     IFNE 'I'                                                           263417
     C           DSLTY1    OREQ 'Z'                                                           263418
     C                     MOVEL'LEE5401' ZAMSID                                              CLE134
     C                     ELSE                                                               263417
     C                     MOVEL'LEE5411' ZAMSID                                              263417
     C                     ENDIF                                                              263417
     C           YPORG     IFNE *BLANKS                                                       263418
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPORG     ZAMSDA                                              CLE134
     C                     ELSE                                                               263418
     C           DSLTY1    IFEQ 'Z'                                                           263418
     C                     CLEARZAMSDA                                                        263418
     C                     CLEARD@FEE                                                         263418
     C**********           MOVEL'LEE5412' ZAMSID                                      263418 263418A
     C                     MOVEL'LEE5413' ZAMSID                                             263418A
     C                     MOVELYEFACL    P@FEFA                                              263418
     C                     MOVE '-'       P@COS                                               263418
     C                     MOVELYESEQ     P@FECD                                              263418
     C                     MOVELD@FEE     ZAMSDA                                              263418
     C                     ENDIF                                                              263418
     C                     ENDIF                                                              263418
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDPRAMH     ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISH                                                        CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           INTAH     IFNE 0                                                             CLE134
      *                                                                                     AR400094
     C           WOVFL     IFEQ 'Y'                                                         AR400094
     C                     MOVEL'LEE5411' WAMSID                                            AR400094
     C                     MOVELYPORG     WAMSDA                                            AR400094
     C                     Z-ADDINTAH     WFLD15                                            AR400094
     C                     MOVE 'Y'       WWSCND                                            AR400094
     C                     MOVE 'Y'       WWDTL1                                            AR400094
      *                                                                                     AR400094
     C                     ELSE                                                             AR400094
      *                                                                                     AR400094
     C                     MOVEL'LEE5411' ZAMSID                                              CLE134
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPORG     ZAMSDA                                              CLE134
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDINTAH     ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISH                                                        CLE134
      *                                                                                     AR400094
     C                     ENDIF                                                            AR400094
      *                                                                                     AR400094
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
     C           GASSH     IFEQ 'A'                                                           247071
     C                     MOVEL'LEE0319' ZAMSID                                              247071
     C                     ELSE                                                               247071
     C                     MOVEL'LEE0027' ZAMSID
     C                     ENDIF                                                              247071
      *                                                                                       247071
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDPRAMH     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     EXSR SRDISH
     C                     ENDIF                                                              CLE134
      *
      ** Manual Repayment - principal
      *
     C           AMTPH     WHEQ 'MR'
     C           PRAMH     IFNE *ZEROS
     C           WDTL1     ANDEQ*BLANK
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSLTY1    IFNE 'X'                                                           CLE134
     C           DSLTY1    ANDNE'Y'                                                           CLE134
     C           DSLTY1    ANDNE'Z'                                                           CLE134
     C                     MOVE LNRFH     KYPORG                                              CLE134
     C                     MOVE VDATH     KYPDVD                                              CLE134
     C                     Z-ADDPRAMH     DSOLAM                                              CLE134
     C                     MOVE 'P'       DSPDCT                                              CLE134
     C                     MOVE LASNH     DSLASN                                              CLE134
     C                     Z-ADDLCDH      KYLCD                                             AR720887
     C**********           EXSR XEPPD2                                                 CLE134 263411
     C                     EXSR XEPPD1                                                        263411
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       247071
     C           GASSH     IFEQ 'A'                                                           247071
     C                     MOVEL'LEE0315' ZAMSID                                              247071
     C                     ELSE                                                               247071
     C                     MOVEL'LEE0022' ZAMSID
     C                     ENDIF                                                              247071
      *                                                                                       247071
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C           PRAMH     SUB  YPCPAM    ZFLD15                                              CLE134
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
     C                     Z-ADDPRAMH     ZFLD15
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL1
     C                     EXSR SRDISH
      *                                                                                       CLE134
      ** ... Past Due Principal Transfer to PDCL.                                             CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
      *                                                                                     AR400094
     C           WOVFL     IFEQ 'Y'                                                         AR400094
     C                     MOVEL'LEE5400' WAMSID  7                                         AR400094
     C                     MOVELYPLON     WAMSDA132                                         AR400094
     C                     Z-ADDYPCPAM    WFLD15 150                                        AR400094
     C                     MOVE 'Y'       WWSCND  1                                         AR400094
     C                     MOVE 'Y'       WWDTL1  1                                         AR400094
      *                                                                                     AR400094
     C                     ELSE                                                             AR400094
      *                                                                                     AR400094
     C                     MOVEL'LEE5400' ZAMSID                                              CLE134
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPLON     ZAMSDA                                              CLE134
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDYPCPAM    ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISH                                                        CLE134
      *                                                                                     AR400094
     C                     ENDIF                                                            AR400094
      *                                                                                     AR400094
     C                     ENDIF                                                              CLE134
     C                     ENDIF
      *
      ** ... interest
      *
     C           INTAH     IFNE *ZEROS
     C           WDTL2     ANDEQ*BLANK
     C           VSLN      ANDLT20
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSLTY1    IFNE 'X'                                                           CLE134
     C           DSLTY1    ANDNE'Y'                                                           CLE134
     C           DSLTY1    ANDNE'Z'                                                           CLE134
     C                     MOVE LNRFH     KYPORG                                              CLE134
     C                     MOVE VDATH     KYPDVD                                              CLE134
     C                     Z-ADDINTAH     DSOLAM                                              CLE134
     C                     MOVE 'I'       DSPDCT                                              CLE134
     C                     MOVE LASNH     DSLASN                                              CLE134
     C                     Z-ADDLCDH      KYLCD                                             AR720887
     C**********           EXSR XEPPD2                                                 CLE134 263411
     C                     EXSR XEPPD1                                                        263411
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       247071
     C           GASSH     IFEQ 'A'                                                           247071
     C                     MOVEL'LEE0318' ZAMSID                                              247071
     C                     ELSE                                                               247071
     C                     MOVEL'LEE0025' ZAMSID
     C                     ENDIF                                                              247071
      *                                                                                       247071
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C           INTAH     SUB  YPDINT    ZFLD15                                              CLE134
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
     C                     Z-ADDINTAH     ZFLD15
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL2
     C                     EXSR SRDISH
      *                                                                                       CLE134
      ** ... Past Due Interest Transfer to PDCL.                                              CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C                     MOVEL'LEE5410' ZAMSID                                              CLE134
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPLON     ZAMSDA                                              CLE134
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDYPDINT    ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISH                                                        CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF
      *
      ** ... withholding tax
      *
     C           WTXAH     IFNE *ZEROS
     C           WDTL3     ANDEQ*BLANK
     C           VSLN      ANDLT20
     C           WTIN      IFNE 'G'
     C           WTIN      ANDNE'N'
      *                                                                                       247071
     C           GASSH     IFEQ 'A'                                                           247071
     C                     MOVEL'LEE0316' ZAMSID                                              247071
     C                     ELSE                                                               247071
     C                     MOVEL'LEE0023' ZAMSID
     C                     ENDIF                                                              247071
      *                                                                                       247071
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDWTXAH     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL3
     C                     EXSR SRDISH
     C                     ENDIF
     C                     ENDIF
      *
      ** ... fee amount
      *
     C           FEAMH     IFNE *ZEROS
     C           WDTL4     ANDEQ*BLANK
     C           VSLN      ANDLT20
      *                                                                                       247071
     C           GASSH     IFEQ 'A'                                                           247071
     C                     MOVEL'LEE0317' ZAMSID                                              247071
     C                     ELSE                                                               247071
     C                     MOVEL'LEE0024' ZAMSID
     C                     ENDIF                                                              247071
      *                                                                                       247071
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDFEAMH     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL4
     C                     EXSR SRDISH
     C                     ENDIF
      *
      ** Interest payment/capitalised
      *
     C           AMTPH     WHEQ 'IN'
     C           CLE028    IFEQ 'N'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           ADIF      ANDNE'Y'                                                           CLE028
     C           WDTL1     IFEQ *BLANKS
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSLTY1    IFNE 'X'                                                           CLE134
     C           DSLTY1    ANDNE'Y'                                                           CLE134
     C           DSLTY1    ANDNE'Z'                                                           CLE134
     C                     MOVE LNRFH     KYPORG                                              CLE134
     C                     MOVE VDATH     KYPDVD                                              CLE134
     C                     Z-ADDINTAH     DSOLAM                                              CLE134
     C                     MOVE 'I'       DSPDCT                                              CLE134
     C                     MOVE LASNH     DSLASN                                              CLE134
     C                     Z-ADDLCDH      KYLCD                                             AR720887
     C**********           EXSR XEPPD2                                                 CLE134 263411
     C                     EXSR XEPPD1                                                        263411
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           SCAPI     IFEQ 'YES'
     C                     MOVEL'LEE0017' ZAMSID
     C                     ELSE
     C                     MOVEL'LEE0016' ZAMSID
     C                     ENDIF
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C           INTAH     SUB  YPDINT    ZFLD15                                              CLE134
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
     C                     Z-ADDINTAH     ZFLD15
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL1
     C                     EXSR SRDISH
     C                     ENDIF
      *                                                                                       CLE134
      ** ... Past Due Interest Transfer to PDCL.                                              CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C                     MOVEL'LEE5410' ZAMSID                                              CLE134
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPLON     ZAMSDA                                              CLE134
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDYPDINT    ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISH                                                        CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE028
      *
      ** ... withholding tax
     C           WTXAH     IFNE *ZEROS
     C           WDTL2     ANDEQ*BLANKS
     C           WTIN      IFEQ 'R'
     C                     MOVEL'LEE0051' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDWTXAH     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL2
     C                     EXSR SRDISH
     C                     ENDIF
     C                     ENDIF
      *
      ** Repayments - principal
      *
     C           AMTPH     WHEQ 'RE'
     C           PRAMH     IFNE *ZEROS
     C           WDTL1     ANDEQ*BLANK
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSLTY1    IFNE 'X'                                                           CLE134
     C           DSLTY1    ANDNE'Y'                                                           CLE134
     C           DSLTY1    ANDNE'Z'                                                           CLE134
     C                     MOVE LNRFH     KYPORG                                              CLE134
     C                     MOVE VDATH     KYPDVD                                              CLE134
     C                     Z-ADDPRAMH     DSOLAM                                              CLE134
     C                     MOVE 'P'       DSPDCT                                              CLE134
     C                     MOVE LASNH     DSLASN                                              CLE134
     C                     Z-ADDLCDH      KYLCD                                             AR720887
     C**********           EXSR XEPPD2                                                 CLE134 263411
     C                     EXSR XEPPD1                                                        263411
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVEL'LEE0028' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C           PRAMH     SUB  YPCPAM    ZFLD15                                              CLE134
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
     C                     Z-ADDPRAMH     ZFLD15
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL1
     C                     EXSR SRDISH
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADIF      ANDEQ'Y'                                                           CLE028
     C                     Z-ADD*ZEROS    INTAH                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE134
      ** ... Past Due Principal Transfer to PDCL.                                             CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C                     MOVEL'LEE5400' ZAMSID                                              CLE134
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPLON     ZAMSDA                                              CLE134
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDYPCPAM    ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISH                                                        CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF
      *
      ** ... interest
      *
     C           INTAH     IFNE *ZEROS
     C           WDTL2     ANDEQ*BLANK
     C           VSLN      ANDLT20
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSLTY1    IFNE 'X'                                                           CLE134
     C           DSLTY1    ANDNE'Y'                                                           CLE134
     C           DSLTY1    ANDNE'Z'                                                           CLE134
     C                     MOVE LNRFH     KYPORG                                              CLE134
     C                     MOVE VDATH     KYPDVD                                              CLE134
     C                     Z-ADDINTAH     DSOLAM                                              CLE134
     C                     MOVE 'I'       DSPDCT                                              CLE134
     C                     MOVE LASNH     DSLASN                                              CLE134
     C                     Z-ADDLCDH      KYLCD                                             AR720887
     C**********           EXSR XEPPD2                                                 CLE134 263411
     C                     EXSR XEPPD1                                                        263411
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     MOVEL'LEE0029' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C           INTAH     SUB  YPDINT    ZFLD15                                              CLE134
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
     C***********REPT      IFEQ 3                                  154221 159779
     C                     Z-ADDINTAH     ZFLD15
     C***********          Z-ADDINTAH     WIPAID                   154221 159779
     C***********WCALC     SUB  WIPAID    WCALC                    154221 159779
     C***********          ELSE                                    154221 159779
     C***********WCALC     SUB  WIPAID    WCALC                    154221 159779
     C***********          Z-ADDWCALC     ZFLD15                   154221 159779
     C***********          ENDIF                                   154221 159779
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL2
     C                     EXSR SRDISH
      ***********                                                  154221 159779
     C***********REPT      IFNE 3                                  154221 159779
     C***********          Z-ADDWCALC     WIPAID                   154221 159779
     C***********          ENDIF                                   154221 159779
      ***********                                                  154221 159779
      *                                                                                       CLE134
      ** ... Past Due Interest Transfer to PDCL.                                              CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C                     MOVEL'LEE5410' ZAMSID                                              CLE134
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPLON     ZAMSDA                                              CLE134
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDYPDINT    ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISH                                                        CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF
      *
      ** ... withholding tax
      *
     C           WTXAH     IFNE *ZEROS
     C           WDTL3     ANDEQ*BLANK
     C           VSLN      ANDLT20
     C                     MOVEL'LEE0030' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDWTXAH     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL3
     C                     EXSR SRDISH
     C                     ENDIF
      *
      ** Loan sub-type change
      *
     C           AMTPH     WHEQ 'LS'
     C                     MOVEL'LEE0052' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C*********************MOVE '   TO   'NAREND  8                                           CLE042
     C*********************MOVELWHSUTP    NAREND                                              CLE042
     C*********************MOVE SUTPH     NAREND                                              CLE042
     C                     MOVE 'TO'      TONAR   9                                           CLE042
     C                     MOVELTONAR     NAREND 16                                           CLE042
     C                     MOVELWHSUTP    WKSTCL  6                                           CLE042
     C                     MOVE WHCLAS    WKSTCL                                              CLE042
     C                     MOVELWKSTCL    NAREND                                              CLE042
     C                     MOVELSUTPH     WKSTCL                                              CLE042
     C                     MOVE CLASH     WKSTCL                                              CLE042
     C                     MOVE WKSTCL    NAREND                                              CLE042
     C                     MOVE NAREND    SNARR
     C                     MOVE *BLANKS   SAMNT                           153347
     C                     EXSR SRDISH
      *
      ** Maturity
      *
     C           AMTPH     WHEQ 'MA'
     C           WDTL1     IFEQ *BLANK
      *                                                                                       263411
     C           CLE134    IFEQ 'Y'                                                           263411
     C           DSLTY1    IFNE 'X'                                                           263411
     C           DSLTY1    ANDNE'Y'                                                           263411
     C           DSLTY1    ANDNE'Z'                                                           263411
     C                     MOVE LNRFH     KYPORG                                              263411
     C                     MOVE VDATH     KYPDVD                                              263411
     C                     Z-ADDPRAMH     DSOLAM                                              263411
     C                     MOVE 'P'       DSPDCT                                              263411
     C                     MOVE LASNH     DSLASN                                              263411
     C                     Z-ADDLCDH      KYLCD                                             AR720887
     C                     EXSR XEPPD1                                                        263411
     C                     ENDIF                                                              263411
     C                     ENDIF                                                              263411
      *                                                                                       263411
     C           TOTI      IFGT *ZEROS
     C                     MOVEL'LEE0047' ZAMSID
     C                     ELSE                                                               CLE028
     C           FLTI      IFGT *ZEROS                                                        CLE028
     C           ADIF      ANDEQ'Y'                                                           CLE028
     C                     MOVEL'LEE0310' ZAMSID                                              CLE028
     C                     ELSE
     C                     MOVEL'LEE0018' ZAMSID
     C                     ENDIF
     C                     ENDIF                                                              CLE028
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                       263411
     C           CLE134    IFEQ 'Y'                                                           263411
     C           DSPPDA    ANDEQ'Y'                                                           263411
     C           PRAMH     SUB  YPCPAM    ZFLD15                                              263411
      *                                                                                       263411
     C                     ELSE                                                               263411
     C                     Z-ADDPRAMH     ZFLD15
     C                     ENDIF                                                              263411
      *                                                                                       263411
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL1
     C                     EXSR SRDISH
      *                                                                                       263411
      ** ... Past Due Principal Transfer to PDCL.                                             263411
      *                                                                                       263411
     C           CLE134    IFEQ 'Y'                                                           263411
     C           DSPPDA    ANDEQ'Y'                                                           263411
     C                     MOVEL'LEE5400' ZAMSID                                              263411
     C                     MOVELYPLON     ZAMSDA                                              263411
     C                     EXSR SRTEXT                                                        263411
     C                     MOVELZAMSTX    SNARR                                               263411
      *                                                                                       263411
     C                     Z-ADDYPCPAM    ZFLD15                                              263411
     C                     EXSR ZSEDIT                                                        263411
     C                     MOVE ZOUT21    SAMNT                                               263411
     C                     MOVE 'Y'       WDTL1                                               263411
     C                     EXSR SRDISH                                                        263411
     C                     ENDIF                                                              263411
     C                     ENDIF
      *
      ** ... interest/interest capitalised
      *
     C           INTAH     IFNE *ZEROS
     C           WDTL2     ANDEQ*BLANK
     C           VSLN      ANDLT20
      *                                                                                       263411
     C           CLE134    IFEQ 'Y'                                                           263411
     C           DSLTY1    IFNE 'X'                                                           263411
     C           DSLTY1    ANDNE'Y'                                                           263411
     C           DSLTY1    ANDNE'Z'                                                           263411
     C                     MOVE LNRFH     KYPORG                                              263411
     C                     MOVE VDATH     KYPDVD                                              263411
     C                     Z-ADDINTAH     DSOLAM                                              263411
     C                     MOVE 'I'       DSPDCT                                              263411
     C                     MOVE LASNH     DSLASN                                              263411
     C                     Z-ADDLCDH      KYLCD                                             AR720887
     C                     EXSR XEPPD1                                                        263411
     C                     ENDIF                                                              263411
     C                     ENDIF                                                              263411
      *                                                                                       263411
     C           SCAPI     IFEQ 'YES'
     C                     MOVEL'LEE0046' ZAMSID
     C                     ELSE
     C                     MOVEL'LEE0019' ZAMSID
     C                     ENDIF
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                       263411
     C           CLE134    IFEQ 'Y'                                                           263411
     C           DSPPDA    ANDEQ'Y'                                                           263411
     C           INTAH     SUB  YPDINT    ZFLD15                                              263411
      *                                                                                       263411
     C                     ELSE                                                               263411
     C                     Z-ADDINTAH     ZFLD15
     C                     ENDIF                                                              263411
      *                                                                                       263411
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL2
     C                     EXSR SRDISH
      *                                                                                       263411
      ** ... Past Due Interest Transfer to PDCL.                                              263411
      *                                                                                       263411
     C           CLE134    IFEQ 'Y'                                                           263411
     C           DSPPDA    ANDEQ'Y'                                                           263411
     C                     MOVEL'LEE5410' ZAMSID                                              263411
     C                     MOVELYPLON     ZAMSDA                                              263411
     C                     EXSR SRTEXT                                                        263411
     C                     MOVELZAMSTX    SNARR                                               263411
      *                                                                                       263411
     C                     Z-ADDYPDINT    ZFLD15                                              263411
     C                     EXSR ZSEDIT                                                        263411
     C                     MOVE ZOUT21    SAMNT                                               263411
     C                     MOVE 'Y'       WDTL1                                               263411
     C                     EXSR SRDISH                                                        263411
     C                     ENDIF                                                              263411
     C                     ENDIF
      *
      ** ... withholding tax
      *
     C           WTXAH     IFNE *ZEROS
     C           WDTL2     ANDEQ*BLANK
     C           VSLN      ANDLT20
     C                     MOVEL'LEE0020' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDWTXAH     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL2
     C                     EXSR SRDISH
     C                     ENDIF
      *
      ** Manual interest adjustment
      ** If Analytical Accounting is present - only display 'MI'
      ** amendments when interest adjustment amount is not Zero
      *
     C           AMTPH     WHEQ 'MI'
     C           BGN0ST    IFNE 'Y'
     C           BGN0ST    OREQ 'Y'
     C           INTAH     ANDNE*ZERO
     C                     MOVEL'LEE0021' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDINTAH     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     EXSR SRDISH
     C                     ENDIF
      *
      ** Start/stop accruals
      *
     C           AMTPH     WHEQ 'SA'
     C           STAIH     IFEQ 'Y'
     C                     MOVEL'LEE0037' ZAMSID
     C                     MOVE 'Y'       WSTAC
     C                     Z-ADDVDATH     WSTPA   50                                          209517
     C                     ELSE
     C                     MOVEL'LEE0038' ZAMSID
     C                     MOVE *BLANK    WSTAC
     C                     ENDIF
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     MOVE *BLANKS   SAMNT                                               238739
     C                     MOVE INTRH     ZFIELD                                              247978
     C                     Z-ADD7         ZADEC                                               247978
     C                     EXSR ZEDIT                                                         247978
     C                     MOVE ZFIELD    SAMNT                                               247978
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISH
      *
      ** Spread/rate change
      ** If Analytical Accounting is present - only display 'SC'
      ** amendments when change to the interest rate/spread (flag = Y)
      ** or if Revenue Analysis is installed - only display 'SC'          CDE002
      ** amendments when change to the interest rate/spread (flag = Y)    CDE002
      *
     C           AMTPH     WHEQ 'SC'
     C           BGN0ST    IFNE 'Y'
     C           CDE002    ANDNE'Y'                                       CDE002
     C           BGN0ST    OREQ 'Y'
     C           IRCFH     ANDEQ'Y'
     C           CDE002    OREQ 'Y'                                       CDE002
     C           IRCFH     ANDEQ'Y'                                       CDE002
     C                     MOVEL'LEE0039' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                    AR1071639
      ** Diplay properly if less than zero.                                                AR1071639
      *                                                                                    AR1071639
     C           RTSPH     IFLT 0                                                          AR1071639
     C                     MOVE 'Y'       WSUB    1                                        AR1071639
     C                     Z-SUBRTSPH     RTSPH                                            AR1071639
     C                     ENDIF                                                           AR1071639
      *                                                                                    AR1071639
     C                     MOVE RTSPH     ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
      *                                                                                    AR1071639
     C           WSUB      IFEQ 'Y'                                                        AR1071639
     C                     MOVE *BLANKS   WSUB                                             AR1071639
     C                     MOVE ZFIELD    WFLD1  19                                        AR1071639
     C           WFLD1     CAT  '-'       WFLD2  20                                        AR1071639
     C                     MOVE WFLD2     SAMNT                                            AR1071639
     C                     Z-SUBRTSPH     RTSPH                                            AR1071639
     C                     ELSE                                                            AR1071639
     C                     MOVE ZFIELD    SAMNT
     C                     ENDIF                                                           AR1071639
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISH
     C                     ENDIF
      *
      ** Base rate change
      *
     C           AMTPH     WHEQ 'BR'
     C                     MOVEL'LEE0015' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                     MD039618
     C           BRTEH     IFLT 0                                                           MD039618
     C                     MOVE 'Y'       WSUB                                              MD039618
     C                     Z-SUBBRTEH     BRTEH                                             MD039618
     C                     ENDIF                                                            MD039618
      *                                                                                     MD039618
     C                     MOVE BRTEH     ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
      *                                                                                     MD039618
     C           WSUB      IFEQ 'Y'                                                         MD039618
     C                     MOVE *BLANKS   WSUB                                              MD039618
     C                     MOVE ZFIELD    WFLD1                                             MD039618
     C           WFLD1     CAT  '-'       WFLD2                                             MD039618
     C                     MOVE WFLD2     SAMNT                                             MD039618
     C                     Z-SUBBRTEH     BRTEH                                             MD039618
     C                     ELSE                                                             MD039618
     C                     MOVE ZFIELD    SAMNT
     C                     ENDIF                                                            MD039618
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISH
      *
      ** Base rate code change
      ** For CLE036, Base Rate Code Change Message ID should also be displayed if             CLE036
      ** amendment type is Base Rate Code and Base Rate Code is not Zero and                  CLE036
      ** Base Rate Change Message ID if amendment type is Base Rate Code and                  CLE036
      ** Base Rate Code is Zero                                                               CLE036
      *
     C           AMTPH     WHEQ 'BC'
      *                                                                                       CLE036
     C           CLE036    IFEQ 'N'                                                           CLE036
     C           BRTTH     ORNE *ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     MOVEL'LEE0014' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C*********************MOVE '   TO   'NAREND  8                                    188382 CLE042
     C*********************MOVE BRTTH     NAREND                                       188382 CLE042
     C*********************MOVE NAREND    SNARR                                        188382 CLE042
     C                     MOVE '   TO   'NAREXT  8                                           CLE042
     C                     MOVE BRTTH     NAREXT                                              CLE042
     C                     MOVE NAREXT    SNARR                                               CLE042
      *                                                                                       CLE036
     C                     ELSE                                                               CLE036
      *                                                                                       CLE036
     C                     MOVEL'LEE0015' ZAMSID                                              CLE036
     C                     EXSR SRTEXT                                                        CLE036
     C                     MOVELZAMSTX    SNARR                                               CLE036
      *                                                                                       CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     MOVE BRTEH     ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SAMNT
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISH
      *
      ** Rollover - base rate
      *
     C           AMTPH     WHEQ 'RO'
      *
      ** Consider a negative base rate.                                                    AR1071639
      *                                                                                    AR1071639
     C********** BRTEH     IFGT *ZEROS                                                     AR1071639
     C           BRTEH     IFNE *ZEROS                                                     AR1071639
     C           WDTL1     ANDEQ*BLANK
     C           WFXCHG    ANDNE'Y'                                                         MD031378
     C                     MOVEL'LEE0032' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                    AR1071639
      ** Display it properly if negative.                                                  AR1071639
      *                                                                                    AR1071639
     C           BRTEH     IFLT 0                                                          AR1071639
     C                     MOVE 'Y'       WSUB                                             AR1071639
     C                     Z-SUBBRTEH     BRTEH                                            AR1071639
     C                     ENDIF                                                           AR1071639
      *                                                                                    AR1071639
     C           RTSPH     IFGT *ZEROS                                                        245109
     C                     MOVE 'CALC  '  SNARR                                               245073
     C                     MOVE CALCH     SNARR                                               245073
     C                     ENDIF                                                              245109
     C                     MOVE BRTEH     ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
      *                                                                                    AR1071639
     C           WSUB      IFEQ 'Y'                                                        AR1071639
     C                     MOVE *BLANKS   WSUB                                             AR1071639
     C                     MOVE ZFIELD    WFLD1                                            AR1071639
     C           WFLD1     CAT  '-'       WFLD2                                            AR1071639
     C                     MOVE WFLD2     SAMNT                                            AR1071639
     C                     Z-SUBBRTEH     BRTEH                                            AR1071639
     C                     ELSE                                                            AR1071639
     C                     MOVE ZFIELD    SAMNT
     C                     ENDIF                                                           AR1071639
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     MOVE 'Y'       WDTL1
     C                     EXSR SRDISH
     C                     ENDIF
      *
      ** ... rate
      *
     C********** RTSPH     IFGT *ZEROS                                                     AR1071639
      *                                                                                    AR1071639
      ** Consider a negative rate.                                                         AR1071639
      *                                                                                    AR1071639
     C           RTSPH     IFNE *ZEROS                                                     AR1071639
     C           BRTEH     ANDEQ*ZEROS
     C           WDTL2     ANDEQ*BLANK
     C           VSLN      ANDLT20
     C           WFXCHG    ANDNE'Y'                                                         MD031378
     C                     MOVEL'LEE0033' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     MOVE 'CALC  '  SNARR                           186995
     C                     MOVE CALCH     SNARR                           186995
      *                                                                                    AR1071639
      ** Display it properly.                                                              AR1071639
      *                                                                                    AR1071639
     C           RTSPH     IFLT 0                                                          AR1071639
     C                     MOVE 'Y'       WSUB                                             AR1071639
     C                     Z-SUBRTSPH     RTSPH                                            AR1071639
     C                     ENDIF                                                           AR1071639
      *                                                                                    AR1071639
     C                     MOVE RTSPH     ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
      *                                                                                    AR1071639
     C           WSUB      IFEQ 'Y'                                                        AR1071639
     C                     MOVE *BLANKS   WSUB                                             AR1071639
     C                     MOVE ZFIELD    WFLD1                                            AR1071639
     C           WFLD1     CAT  '-'       WFLD2                                            AR1071639
     C                     MOVE WFLD2     SAMNT                                            AR1071639
     C                     Z-SUBRTSPH     RTSPH                                            AR1071639
     C                     ELSE                                                            AR1071639
     C                     MOVE ZFIELD    SAMNT
     C                     ENDIF                                                           AR1071639
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     MOVE 'Y'       WDTL2
     C                     EXSR SRDISH
     C                     ENDIF
      *
      ** ... principal and discount
      *
     C           PRINX     IFNE *BLANK
     C           PRINRO    ANDNE*ZEROS
     C           VSLN      ANDLT20
      *                                                                                       218984
      ** If the principal rolled over is different from the current principal,                218984
      ** put out a line to show the Increase or Repayment amount.                             218984
      *                                                                                       218984
     C           WDTL9     IFEQ *BLANK                                                        218984
     C           PRINRO    IFNE WCUPR                                                         219500
     C           WCUPR     SUB  PRINRO    RODIFF 130                                          219500
     C           RODIFF    IFLT 0                                                             218984
     C                     MOVEL'LEE0313' ZAMSID                                              218984
     C                     Z-SUBRODIFF    RODIFF                                              218984
     C                     ELSE                                                               218984
     C                     MOVEL'LEE0314' ZAMSID                                              218984
     C                     ENDIF                                                              218984
     C                     EXSR SRTEXT                                                        218984
     C                     MOVELZAMSTX    SNARR                                               218984
     C                     Z-ADDRODIFF    ZFLD15                                              218984
     C                     EXSR ZSEDIT                                                        218984
     C                     MOVE ZOUT21    SAMNT                                               218984
     C                     MOVE 'Y'       WDTL9                                               218984
     C                     EXSR SRDISH                                                        218984
     C                     ENDIF                                                              218984
     C                     ENDIF                                                              218984
      *                                                                                       218984
     C           WDTL3     IFEQ *BLANK
     C                     MOVEL'LEE0053' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDPRINRO    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL3
     C                     EXSR SRDISH
     C                     ENDIF
      *
     C           DISCRO    IFNE 0                                                             CLE031
     C           WDTL4     IFEQ *BLANK
     C                     MOVEL'LEE0054' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDDISCRO    ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL4
     C                     EXSR SRDISH
     C                     ENDIF
     C                     ENDIF                                                              CLE031
     C                     ENDIF
      *
      ** ... spread rate
      *
     C********** RTSPH     IFGT *ZEROS                                                     AR1071639
     C********** BRTEH     ANDGT*ZEROS                                                     AR1071639
      *                                                                                    AR1071639
      ** Consider a negative rate.                                                         AR1071639
      *                                                                                    AR1071639
     C           RTSPH     IFNE *ZEROS                                                     AR1071639
     C           BRTEH     ANDNE*ZEROS                                                     AR1071639
     C           WDTL5     ANDEQ*BLANK
     C           VSLN      ANDLT20
     C           WFXCHG    ANDNE'Y'                                                         MD031378
     C                     SELEC
     C           SPINH     WHEQ 'A'
     C                     MOVEL'LEE0034' ZAMSID
     C           SPINH     WHEQ 'S'
     C                     MOVEL'LEE0035' ZAMSID
     C           SPINH     WHEQ 'P'
     C                     MOVEL'LEE0036' ZAMSID
     C                     ENDSL
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                    AR1071639
      ** Display it properly.                                                              AR1071639
      *                                                                                    AR1071639
     C           RTSPH     IFLT 0                                                          AR1071639
     C                     MOVE 'Y'       WSUB                                             AR1071639
     C                     Z-SUBRTSPH     RTSPH                                            AR1071639
     C                     ENDIF                                                           AR1071639
      *                                                                                    AR1071639
     C                     MOVE RTSPH     ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
      *                                                                                    AR1071639
     C           WSUB      IFEQ 'Y'                                                        AR1071639
     C                     MOVE *BLANKS   WSUB                                             AR1071639
     C                     MOVE ZFIELD    WFLD1                                            AR1071639
     C           WFLD1     CAT  '-'       WFLD2                                            AR1071639
     C                     MOVE WFLD2     SAMNT                                            AR1071639
     C                     Z-SUBRTSPH     RTSPH                                            AR1071639
     C                     ELSE                                                            AR1071639
     C                     MOVE ZFIELD    SAMNT
     C                     ENDIF                                                           AR1071639
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     MOVE 'Y'       WDTL5
     C                     EXSR SRDISH
     C                     ENDIF
      *
      ** Start action
      *
     C           AMTPH     WHEQ 'ST'
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSLTY1    IFEQ 'X'                                                           CLE134
     C           DSLTY1    OREQ 'Y'                                                           CLE134
     C           DSLTY1    OREQ 'Z'                                                           263418
     C                     MOVE LNRFH     KYPLON                                              CLE134
     C                     MOVE VDATH     KYPDVD                                              CLE134
     C                     Z-ADDPRAMH     DSOLAM                                              CLE134
     C           DSLTY1    IFEQ 'X'                                                           CLE134
     C           DSLTY1    OREQ 'Z'                                                           263418
     C                     MOVE 'P'       DSPDCT                                              CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE 'I'       DSPDCT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     MOVE LASNH     DSLASN                                              CLE134
     C                     EXSR XEPPD1                                                        CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           TOTI      IFEQ *ZEROS
     C                     MOVEL'LEE0040' ZAMSID
     C                     ELSE
     C                     MOVEL'LEE0048' ZAMSID
     C                     ENDIF
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDPRAMH     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     EXSR SRDISH
      *                                                                                       CLE134
      ** ... Past Due Principal Transfer from PDCL.                                           CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C           PRAMH     IFNE 0                                                             CLE134
     C           YPDCT     IFNE 'I'                                                           263417
     C           DSLTY1    OREQ 'Z'                                                           263418
     C                     MOVEL'LEE5401' ZAMSID                                              CLE134
     C                     ELSE                                                               263417
     C                     MOVEL'LEE5411' ZAMSID                                              263417
     C                     ENDIF                                                              263417
     C           YPORG     IFNE *BLANKS                                                       263418
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPORG     ZAMSDA                                              CLE134
     C                     ELSE                                                               263418
     C           DSLTY1    IFEQ 'Z'                                                           263418
     C                     CLEARZAMSDA                                                        263418
     C**********           MOVEL'LEE5412' ZAMSID                                      263418 263418A
     C                     MOVEL'LEE5413' ZAMSID                                             263418A
     C                     CLEARD@FEE                                                         263418
     C                     MOVELYEFACL    P@FEFA                                              263418
     C                     MOVE '-'       P@COS                                               263418
     C                     MOVELYESEQ     P@FECD                                              263418
     C                     MOVELD@FEE     ZAMSDA                                              263418
     C                     ENDIF                                                              263418
     C                     ENDIF                                                              263418
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDPRAMH     ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISH                                                        CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
      *
      ** ... discount
      *
     C           TOTI      IFGT *ZEROS
     C           VSLN      ANDLT20
     C                     MOVEL'LEE0050' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDTOTI      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     EXSR SRDISH
     C                     ENDIF
      *                                                                                       CLE028
      ** ... flat rate interest                                                               CLE028
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE134
     C           FLTI      IFGT *ZEROS                                                        CLE028
     C           VSLN      ANDLT20                                                            CLE028
     C           ADIF      ANDEQ'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C                     MOVEL'LEE0311' ZAMSID                                              CLE028
     C                     EXSR SRTEXT                                                        CLE028
     C                     MOVELZAMSTX    SNARR                                               CLE028
     C                     Z-ADDFLTI      ZFLD15                                              CLE028
     C                     EXSR ZSEDIT                                                        CLE028
     C                     MOVE *BLANKS   SAMNT                                               CLE028
     C                     MOVE ZOUT21    SAMNT                                               CLE028
     C                     EXSR SRDISH                                                        CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** ... charge due                                                                       CLE028
      *                                                                                       CLE028
     C           CHGA      IFGT *ZEROS                                                        CLE028
     C           VSLN      ANDLT20                                                            CLE028
     C           ADCF      ANDEQ'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C                     MOVEL'LEE0312' ZAMSID                                              CLE028
     C                     EXSR SRTEXT                                                        CLE028
     C                     MOVELZAMSTX    SNARR                                               CLE028
     C                     Z-ADDCHGA      ZFLD15                                              CLE028
     C                     EXSR ZSEDIT                                                        CLE028
     C                     MOVE ZOUT21    SAMNT                                               CLE028
     C                     EXSR SRDISH                                                        CLE028
     C                     ENDIF                                                              CLE028
      *
      ** ... premium
      *
     C           TOTI      IFLT *ZEROS
     C           VSLN      ANDLT20
     C           PTYP      ANDNE80                                                            CLE028
     C           ADIF      ANDNE'Y'                                                           CLE028
     C                     MOVEL'LEE0049' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-SUBTOTI      ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     EXSR SRDISH
     C                     ENDIF
      *
      ** ... base rate
      *
     C********** BRTEH     IFGT *ZEROS                                                     AR1071639
      *                                                                                    AR1071639
      ** Consider a negative base rate.                                                    AR1071639
      *                                                                                    AR1071639
     C           BRTEH     IFNE *ZEROS                                                     AR1071639
     C           VSLN      ANDLT20
     C                     MOVEL'LEE0041' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                    AR1071639
      ** Display it properly if negative.                                                  AR1071639
      *                                                                                    AR1071639
     C           BRTEH     IFLT 0                                                          AR1071639
     C                     MOVE 'Y'       WSUB                                             AR1071639
     C                     Z-SUBBRTEH     BRTEH                                            AR1071639
     C                     ENDIF                                                           AR1071639
      *                                                                                    AR1071639
     C                     MOVE BRTEH     ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
      *                                                                                    AR1071639
     C           WSUB      IFEQ 'Y'                                                        AR1071639
     C                     MOVE *BLANKS   WSUB                                             AR1071639
     C                     MOVE ZFIELD    WFLD1                                            AR1071639
     C           WFLD1     CAT  '-'       WFLD2                                            AR1071639
     C                     MOVE WFLD2     SAMNT                                            AR1071639
     C                     Z-SUBBRTEH     BRTEH                                            AR1071639
     C                     ELSE                                                            AR1071639
     C                     MOVE ZFIELD    SAMNT
     C                     ENDIF                                                           AR1071639
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISH
     C                     ENDIF
      *
      ** ... rate
      *
     C********** RTSPH     IFGT *ZEROS                                                     AR1071639
      *                                                                                    AR1071639
      ** Consider a negative rate.                                                         AR1071639
      *                                                                                    AR1071639
     C           RTSPH     IFNE *ZEROS                                                     AR1071639
     C           BRTEH     ANDEQ*ZEROS
     C           VSLN      ANDLT20
     C                     MOVEL'LEE0042' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                    AR1071639
      ** Display it properly.                                                              AR1071639
      *                                                                                    AR1071639
     C           RTSPH     IFLT 0                                                          AR1071639
     C                     MOVE 'Y'       WSUB                                             AR1071639
     C                     Z-SUBRTSPH     RTSPH                                            AR1071639
     C                     ENDIF                                                           AR1071639
      *                                                                                    AR1071639
     C                     MOVE RTSPH     ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
      *                                                                                    AR1071639
     C           WSUB      IFEQ 'Y'                                                        AR1071639
     C                     MOVE *BLANKS   WSUB                                             AR1071639
     C                     MOVE ZFIELD    WFLD1                                            AR1071639
     C           WFLD1     CAT  '-'       WFLD2                                            AR1071639
     C                     MOVE WFLD2     SAMNT                                            AR1071639
     C                     Z-SUBRTSPH     RTSPH                                            AR1071639
     C                     ELSE                                                            AR1071639
     C                     MOVE ZFIELD    SAMNT
     C                     ENDIF                                                           AR1071639
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISH
     C                     ENDIF
      *
      ** ... spread rate
      *
     C********** RTSPH     IFGT *ZEROS                                                     AR1071639
     C********** BRTEH     ANDGT*ZEROS                                                     AR1071639
      *                                                                                    AR1071639
      ** Consider a negative rate.                                                         AR1071639
      *                                                                                    AR1071639
     C           RTSPH     IFNE *ZEROS                                                     AR1071639
     C           BRTEH     ANDNE*ZEROS                                                     AR1071639
     C           VSLN      ANDLT20
     C                     SELEC
     C           SPINH     WHEQ 'A'
     C                     MOVEL'LEE0043' ZAMSID
     C           SPINH     WHEQ 'S'
     C                     MOVEL'LEE0044' ZAMSID
     C           SPINH     WHEQ 'P'
     C                     MOVEL'LEE0045' ZAMSID
     C                     ENDSL
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                    AR1071639
      ** Display it properly.                                                              AR1071639
      *                                                                                    AR1071639
     C           RTSPH     IFLT 0                                                          AR1071639
     C                     MOVE 'Y'       WSUB                                             AR1071639
     C                     Z-SUBRTSPH     RTSPH                                            AR1071639
     C                     ENDIF                                                           AR1071639
      *                                                                                    AR1071639
     C                     MOVE RTSPH     ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
      *                                                                                    AR1071639
     C           WSUB      IFEQ 'Y'                                                        AR1071639
     C                     MOVE *BLANKS   WSUB                                             AR1071639
     C                     MOVE ZFIELD    WFLD1                                            AR1071639
     C           WFLD1     CAT  '-'       WFLD2                                            AR1071639
     C                     MOVE WFLD2     SAMNT                                            AR1071639
     C                     Z-SUBRTSPH     RTSPH                                            AR1071639
     C                     ELSE                                                            AR1071639
     C                     MOVE ZFIELD    SAMNT
     C                     ENDIF                                                           AR1071639
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISH
     C                     ENDIF
      *
     C                     ENDSL
      *
     C                     ENDSR
     C/EJECT                                                                                  CLE134
     C           XEPPD1    BEGSR                                                              CLE134
      *                                                                                       CLE134
      **XEPPD1:*Evaluate*Whether*Past*Due*Amount*Should*be*Printed.****                CLE134 263411
      ** XEPPD1: Evaluate Whether Past Due Amount Should be Displayed.                        263411
      *                                                                                       CLE134
      ** Set Display Past Due Amount (DSPPDA) to 'Y' if PDCL Event                            CLE134
      ** Found                                                                                CLE134
      *                                                                                       CLE134
      ** Initialisation.                                                                      CLE134
      *                                                                                       CLE134
     C                     MOVEA*IN       #IN    99                                           CLE134
     C                     MOVE *BLANKS   DSPPDA                                              CLE134
      *                                                                                       CLE134
      ** Retrieve Past Due Event Details.                                                     CLE134
      *                                                                                       CLE134
     C********** AUTOCL    IFEQ 'C'                                                  CLE134 AR982563
     C                     MOVE 'D'       KYRECI                                              CLE134
     C                     MOVE 'T'       KYPDCT                                              CLE134
      *                                                                                       263411
     C           DSLTY1    IFNE 'X'                                                           CLE134
     C           DSLTY1    ANDNE'Y'                                                           CLE134
     C           DSLTY1    ANDNE'Z'                                                           CLE134
     C           KPDUE7    CHAINLEPDUEL7             20                                       CLE134
      *                                                                                       263411
     C                     ELSE                                                               CLE134
     C           DSLTY1    IFNE 'Z'                                                           263418
     C           KPDUE6    CHAINLEPDUEL6             20                                       CLE134
      *                                                                                       263411
     C                     ELSE                                                               263418
     C           KPDUEA    CHAINLEPDUFLA             20                                       263418
     C                     ENDIF                                                              263418
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           *IN20     IFEQ *ON                                                           CLE134
     C                     MOVE DSPDCT    KYPDCT                                              CLE134
      *                                                                                       263411
     C           DSLTY1    IFNE 'X'                                                           CLE134
     C           DSLTY1    ANDNE'Y'                                                           CLE134
     C           DSLTY1    ANDNE'Z'                                                           CLE134
     C           KPDUE7    CHAINLEPDUEL7             20                                       CLE134
      *                                                                                       263411
     C                     ELSE                                                               CLE134
     C           KPDUE6    CHAINLEPDUEL6             20                                       CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** If loan is a PDCL                                                                    CLE134
      *                                                                                       CLE134
     C           *IN20     IFEQ *OFF                                                          CLE134
     C           DSLTY1    IFEQ 'X'                                                           CLE134
     C           DSLTY1    OREQ 'Y'                                                           CLE134
     C           DSLTY1    OREQ 'Z'                                                           CLE134
      *                                                                                       CLE134
     C           AMTPH     IFEQ 'ST'                                                          CLE134
     C                     MOVE 'Y'       DSPPDA                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           AMTPH     IFNE 'ST'                                                          CLE134
     C                     MOVE YBRCA     KYBRCA                                              CLE134
     C                     MOVE YPLON     KYPLON                                              CLE134
     C                     MOVE YPDCT     KYPDCT                                              CLE134
      *                                                                                       263411
     C           DSLTY1    IFEQ 'Y'                                                           263418
     C           DSLTY1    OREQ 'X'                                                           263418
     C           KPDU4A    SETLLLEPDUEL4                                                      CLE134
     C           KPDU4A    READELEPDUEL4                 22                                   CLE134
      *                                                                                       263411
     C                     ELSE                                                               263418
     C           KPDU6A    SETLLLEPDUFL6                                                      263418
     C           KPDU6A    READELEPDUFL6                 22                                   263418
     C                     ENDIF                                                              263418
      *                                                                                       263411
     C********** YPOREP    IFNE 0                                                     CLE134 263411A
     C           DSPDCT    IFEQ 'P'                                                          263411A
     C**********           Z-ADDYPOREP    WORIGP 150                                 CLE134 AR948604
     C                     Z-ADDYPCPAM    WORIGP 150                                        AR948604
      *                                                                                       263411
     C                     ELSE                                                               CLE134
     C**********           Z-ADDYPOREI    WORIGP 150                                 CLE134 AR948604
     C                     Z-ADDYPDINT    WORIGP 150                                        AR948604
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           *IN22     DOWEQ*OFF                                                          CLE134
     C           WORIGP    ANDNEDSOLAM                                                        CLE134
     C           DSLTY1    IFEQ 'Y'                                                           263418
     C           DSLTY1    OREQ 'X'                                                           263418
     C           KPDU4A    READELEPDUEL4                 22                                   CLE134
      *                                                                                       263411
     C                     ELSE                                                               263418
     C           KPDU6A    READELEPDUFL6                 22                                   263418
     C                     ENDIF                                                              263418
      *                                                                                       263411
     C********** YPOREP    IFNE 0                                                     CLE134 263411A
     C           DSPDCT    IFEQ 'P'                                                          263411A
     C**********           Z-ADDYPOREP    WORIGP                                     CLE134 AR948604
     C                     Z-ADDYPCPAM    WORIGP                                            AR948604
      *                                                                                       263411
     C                     ELSE                                                               CLE134
     C**********           Z-ADDYPOREI    WORIGP                                     CLE134 AR948604
     C                     Z-ADDYPDINT    WORIGP                                            AR948604
     C                     ENDIF                                                              CLE134
     C                     ENDDO                                                              CLE134
      *                                                                                       CLE134
     C           *IN22     IFEQ *OFF                                                          CLE134
     C                     MOVE 'Y'       DSPPDA                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** If loan is not a PDCL                                                                CLE134
      *                                                                                       CLE134
     C           *IN20     IFEQ *OFF                                                          CLE134
     C           DSLTY1    ANDNE'X'                                                           CLE134
     C           DSLTY1    ANDNE'Y'                                                           CLE134
     C           DSLTY1    ANDNE'Z'                                                           CLE134
      *                                                                                       CLE134
     C                     MOVE YBRCA     KYBRCA                                              CLE134
     C                     MOVE YPLON     KYPLON                                              CLE134
     C                     MOVE YPDCT     KYPDCT                                              CLE134
     C                     MOVE DSLASN    KYPOSQ                                              CLE134
     C           KPDUE4    SETLLLEPDUEL4                                                      CLE134
     C           KPDUE4    READELEPDUEL4                 22                                   CLE134
      *                                                                                       263411
     C********** YPOREP    IFNE 0                                                     CLE134 263411A
     C           DSPDCT    IFEQ 'P'                                                          263411A
     C**********           Z-ADDYPOREP    WORIGP 150                                 CLE134 AR948604
     C**********           Z-ADDYPCPAM    WORIGP                                   AR948604 AR954985
     C                     Z-ADDYPOREP    WORIGP 150                                        AR954985
      *                                                                                       263411
     C                     ELSE                                                               CLE134
     C**********           Z-ADDYPOREI    WORIGP 150                                 CLE134 AR948604
     C**********           Z-ADDYPDINT    WORIGP                                   AR948604 AR954985
     C                     Z-ADDYPOREI    WORIGP                                            AR954985
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           *IN22     DOWEQ*OFF                                                          CLE134
     C           WORIGP    ANDNEDSOLAM                                                        CLE134
      *                                                                                       CLE134
     C           KPDUE4    READELEPDUEL4                 22                                   CLE134
      *                                                                                       263411
     C********** YPOREP    IFNE 0                                                     CLE134 263411A
     C           DSPDCT    IFEQ 'P'                                                          263411A
     C**********           Z-ADDYPOREP    WORIGP                                     CLE134 AR948604
     C**********           Z-ADDYPCPAM    WORIGP                                   AR948604 AR954985
     C                     Z-ADDYPOREP    WORIGP                                            AR954985
      *                                                                                       263411
     C                     ELSE                                                               CLE134
     C**********           Z-ADDYPOREI    WORIGP                                     CLE134 AR948604
     C**********           Z-ADDYPDINT    WORIGP                                   AR948604 AR954985
     C                     Z-ADDYPOREI    WORIGP                                            AR954985
     C                     ENDIF                                                              CLE134
     C                     ENDDO                                                              CLE134
      *                                                                                     AR720887
     C           AMTPH     IFNE 'ST'                                                        AR720887
     C           *IN22     IFEQ '0'                                                         AR720887
     C           YLCD      ANDNEKYLCD                                                       AR720887
     C                     MOVE '1'       *IN22                                             AR720887
     C                     ENDIF                                                            AR720887
     C                     ENDIF                                                            AR720887
      *                                                                                       CLE134
     C           *IN22     IFEQ *OFF                                                          CLE134
     C                     MOVE 'Y'       DSPPDA                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C**********           ENDIF                                                     CLE134 AR982563
      *                                                                                       CLE134
      ** Restore Values.                                                                      CLE134
      *                                                                                       CLE134
     C                     MOVEA#IN       *IN                                                 CLE134
     C                     ENDSR                                                              CLE134
     C/EJECT                                                                                  CLE134
     C********** XEPPD2    BEGSR                                                       CLE134 263411
      *                                                                                CLE134 263411
      ** XEPPD2: Evaluate Whether Past Due Amount Should be Displayed.                 CLE134 263411
      *                                                                                CLE134 263411
      ** Set Display Past Due Amount (DSPPDA) to 'Y' if PDCL Event                     CLE134 263411
      ** Found.                                                                        CLE134 263411
      *                                                                                CLE134 263411
      ** Initialisation.                                                               CLE134 263411
      *                                                                                CLE134 263411
     C**********           MOVEA*IN       #IN    99                                    CLE134 263411
     C**********           MOVE *BLANKS   DSPPDA                                       CLE134 263411
      *                                                                                CLE134 263411
      ** Retrieve Past Due Event Details.                                              CLE134 263411
      *                                                                                CLE134 263411
     C********** AUTOCL    IFEQ 'C'                                                    CLE134 263411
     C**********           MOVE 'D'       KYRECI                                       CLE134 263411
     C**********           MOVE 'T'       KYPDCT                                       CLE134 263411
     C********** DSLTY1    IFNE 'X'                                                    CLE134 263411
     C********** DSLTY1    ANDNE'Y'                                                    CLE134 263411
     C********** DSLTY1    ANDNE'Z'                                                    CLE134 263411
     C********** KPDUE7    CHAINLEPDUEL7             20                                CLE134 263411
     C**********           ELSE                                                        CLE134 263411
     C********** KPDUE6    CHAINLEPDUEL6             20                                CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
      *                                                                                CLE134 263411
     C********** *IN20     IFEQ *ON                                                    CLE134 263411
     C**********           MOVE DSPDCT    KYPDCT                                       CLE134 263411
     C********** DSLTY1    IFNE 'X'                                                    CLE134 263411
     C********** DSLTY1    ANDNE'Y'                                                    CLE134 263411
     C********** DSLTY1    ANDNE'Z'                                                    CLE134 263411
     C********** KPDUE7    CHAINLEPDUEL7             20                                CLE134 263411
     C**********           ELSE                                                        CLE134 263411
     C********** KPDUE6    CHAINLEPDUEL6             20                                CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
      *                                                                                CLE134 263411
      ** If loan is a PDCL                                                             CLE134 263411
      *                                                                                CLE134 263411
     C********** *IN20     IFEQ *OFF                                                   CLE134 263411
     C********** DSLTY1    IFEQ 'X'                                                    CLE134 263411
     C********** DSLTY1    OREQ 'Y'                                                    CLE134 263411
     C********** DSLTY1    OREQ 'Z'                                                    CLE134 263411
      *                                                                                CLE134 263411
     C********** AMTPH     IFEQ 'ST'                                                   CLE134 263411
     C**********           MOVE 'Y'       DSPPDA                                       CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
      *                                                                                CLE134 263411
     C********** AMTPH     IFNE 'ST'                                                   CLE134 263411
     C**********           MOVE YBRCA     KYBRCA                                       CLE134 263411
     C**********           MOVE YPLON     KYPLON                                       CLE134 263411
     C**********           MOVE YPDCT     KYPDCT                                       CLE134 263411
     C********** KPDU4A    SETLLLEPDUEL4                                               CLE134 263411
     C********** KPDU4A    READELEPDUEL4                 22                            CLE134 263411
     C********** YPOREP    IFNE 0                                                      CLE134 263411
     C**********           Z-ADDYPOREP    WORIGP 150                                   CLE134 263411
     C**********           ELSE                                                        CLE134 263411
     C**********           Z-ADDYPOREI    WORIGP 150                                   CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
      *                                                                                CLE134 263411
     C********** *IN22     DOWEQ*OFF                                                   CLE134 263411
     C********** WORIGP    ANDNEDSOLAM                                                 CLE134 263411
     C********** KPDU4A    READELEPDUEL4                 22                            CLE134 263411
     C********** YPOREP    IFNE 0                                                      CLE134 263411
     C**********           Z-ADDYPOREP    WORIGP                                       CLE134 263411
     C**********           ELSE                                                        CLE134 263411
     C**********           Z-ADDYPOREI    WORIGP                                       CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
     C**********           ENDDO                                                       CLE134 263411
      *                                                                                CLE134 263411
     C********** *IN22     IFEQ *OFF                                                   CLE134 263411
     C**********           MOVE 'Y'       DSPPDA                                       CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
      *                                                                                CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
      *                                                                                CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
      *                                                                                CLE134 263411
      ** If loan is not a PDCL                                                         CLE134 263411
      *                                                                                CLE134 263411
     C********** *IN20     IFEQ *OFF                                                   CLE134 263411
     C********** DSLTY1    ANDNE'X'                                                    CLE134 263411
     C********** DSLTY1    ANDNE'Y'                                                    CLE134 263411
     C********** DSLTY1    ANDNE'Z'                                                    CLE134 263411
     C**********           MOVE YBRCA     KYBRCA                                       CLE134 263411
     C**********           MOVE YPLON     KYPLON                                       CLE134 263411
     C**********           MOVE YPDCT     KYPDCT                                       CLE134 263411
     C**********           MOVE DSLASN    KYPOSQ                                       CLE134 263411
     C********** KPDUE4    SETLLLEPDUEL4                                               CLE134 263411
     C********** KPDUE4    READELEPDUEL4                 22                            CLE134 263411
     C********** YPOREP    IFNE 0                                                      CLE134 263411
     C**********           Z-ADDYPOREP    WORIGP                                       CLE134 263411
     C**********           ELSE                                                        CLE134 263411
     C**********           Z-ADDYPOREI    WORIGP                                       CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
      *                                                                                CLE134 263411
     C********** *IN22     DOWEQ*OFF                                                   CLE134 263411
     C********** WORIGP    ANDNEDSOLAM                                                 CLE134 263411
     C********** KPDUE4    READELEPDUEL4                 22                            CLE134 263411
     C********** YPOREP    IFNE 0                                                      CLE134 263411
     C**********           Z-ADDYPOREP    WORIGP                                       CLE134 263411
     C**********           ELSE                                                        CLE134 263411
     C**********           Z-ADDYPOREI    WORIGP                                       CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
     C**********           ENDDO                                                       CLE134 263411
      *                                                                                CLE134 263411
     C********** *IN22     IFEQ *OFF                                                   CLE134 263411
     C**********           MOVE 'Y'       DSPPDA                                       CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
      *                                                                                CLE134 263411
     C**********           ENDIF                                                       CLE134 263411
      *                                                                                CLE134 263411
      ** Restore Values.                                                               CLE134 263411
      *                                                                                CLE134 263411
     C**********           MOVEA#IN       *IN                                          CLE134 263411
     C**********           ENDSR                                                       CLE134 263411
      /EJECT
      *****************************************************************
      * SRDISH  -  Displays history record                            *
      * Called by: SROUTH - Formats history record                    *
      * Calls    : SRDETL - Write detail line                         *
      *****************************************************************
     C           SRDISH    BEGSR
      *
      ** Convert date
      *
     C           WOVFL     IFEQ *BLANK
      **********                                                                       249397 257301
      ***Display*Expected*Date*as*Due*Date.***                                         249397 257301
      **********                                                                       249397 257301
     C********** AMTPH     IFEQ 'MR'                                                   242852 257301
     C********** EXVDH     ANDNE0                                                      242852 257301
     C**********           MOVE '1'       *IN76                                        249397 257301
      **********                                                                       249397 257301
      ***Format*and*save*Expected*Date*for*display*later.***                           249397 257301
      **********                                                                       249397 257301
     C**********           MOVE EXVDH     ZDAYNO                                       242852 257301
     C**********           EXSR ZDATE2                                                 249397 257301
     C**********           MOVE ZADATE    WSDUD1  7                                    249397 257301
     C**********           ENDIF                                                       249397 257301
      **********                                                                       249397 257301
     C**********           ELSE                                                        242852 249397
     C                     Z-ADDVDATH     ZDAYNO
     C**********           ENDIF                                                       242852 249397
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SDUDT
      *
      ** Determine date of input
      *
     C           VDATH     IFEQ LCDH
     C********** EXVDH     ANDEQ0                                                      242852 257301
     C                     MOVE *BLANKS   SINDT
     C                     ELSE
     C                     Z-ADDLCDH      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SINDT
     C                     ENDIF
     C/COPY WNCPYSRC,LE0212C003
      *                                                                   154221
      *
      ** Determine code
      *
     C                     MOVE *BLANKS   SSMSG
     C                     MOVE *BLANKS   SSGAS
     C********** MNSGH     IFEQ 'S'                                       145370
     C**********           MOVE 'AU'      SSMSG                           145370
     C**********           ENDIF                                          145370
     C********** GASSH     IFEQ 'Y'                                                           CLE106
     C           GASSH     IFEQ 'A'                                                           CLE106
     C                     MOVE 'AS'      SSGAS
     C                     ENDIF
     C                     MOVE 'H'       SCODE
     C                     ENDIF
      *
      ** Write detail line
      *
      ** When displaying historical records FCALI should be blank                             231400
      ** since interest payment is not process at this point.                                 231400
      *                                                                                       231400
     C                     CLEARFCALI                                                         231400
     C                     EXSR SRDETL
      *
      ** Determine if there are still details for the same record if
      ** last line printed for the page so that processing won't
      ** continue on to read the next history record
      *
     C********** VSLN      IFEQ 20                                                            188806
     C           VSLN      IFGE 20                                                            188806
     C                     SELEC
     C           AMTPH     WHEQ 'MR'
     C           WDTL2     IFEQ *BLANK
     C           INTAH     ANDGT*ZERO
     C           WDTL3     OREQ *BLANK
     C           WTXAH     ANDGT*ZERO
     C           CLE134    OREQ 'Y'                                                        AR400094A
     C           WDTL2     ANDEQ*BLANK                                                     AR400094A
     C           INTAH     ANDEQ*ZERO                                                      AR400094A
     C           WOVFL     ANDEQ'Y'                                                        AR400094A
     C           CLE134    OREQ 'Y'                                                        AR400094A
     C           WDTL3     ANDEQ*BLANK                                                     AR400094A
     C           WTXAH     ANDEQ*ZERO                                                      AR400094A
     C           WOVFL     ANDEQ'Y'                                                        AR400094A
     C                     MOVE 'Y'       WSAME
     C                     ENDIF
      *                                                                                       188806
      * Multi-currency rollovers can display three lines on screen.                           188806
     C           AMTPH     WHEQ 'MC'                                                          188806
     C           WDTL2     IFEQ *BLANK                                                        188806
     C********** BRTEH     ANDGT*ZERO                                               188806 AR1071639
     C           BRTEH     ANDNE*ZERO                                                      AR1071639
     C           WDTL3     OREQ *BLANK                                                        188806
     C********** RTSPH     ANDGT*ZERO                                               188806 AR1071639
     C           RTSPH     ANDNE*ZERO                                                      AR1071639
     C                     MOVE 'Y'       WSAME                                               188806
     C                     ENDIF                                                              188806
      *
     C           AMTPH     WHEQ 'IN'
     C           WDTL2     IFEQ *BLANK
     C           WTXAH     ANDGT*ZERO
     C           CLE134    OREQ 'Y'                                                        AR400094A
     C           WDTL2     ANDEQ*BLANKS                                                    AR400094A
     C           WTXAH     ANDEQ*ZERO                                                      AR400094A
     C           WOVFL     ANDEQ'Y'                                                        AR400094A
     C                     MOVE 'Y'       WSAME
     C                     ENDIF
      *
     C           AMTPH     WHEQ 'RE'
     C           AMTPH     OREQ 'MA'
     C           WDTL2     IFEQ *BLANK
     C           INTAH     ANDGT*ZERO
     C           CLE134    OREQ 'Y'                                                        AR400094A
     C           WDTL2     ANDEQ*BLANK                                                     AR400094A
     C           INTAH     ANDEQ*ZERO                                                      AR400094A
     C           WOVFL     ANDEQ'Y'                                                        AR400094A
     C                     MOVE 'Y'       WSAME
     C                     ENDIF
      *
     C           AMTPH     WHEQ 'RO'
     C           WDTL2     IFEQ *BLANK
     C********** RTSPH     ANDGT*ZEROS                                                     AR1071639
     C           RTSPH     ANDNE*ZEROS                                                     AR1071639
     C***********BRTEH     ANDEQ*ZEROS                                    154221
     C********** BRTEH     ANDNE*ZEROS                                                 154221 186708
     C           BRTEH     ANDEQ*ZEROS                                                        186708
     C           WDTL3     OREQ *BLANK
     C           PRINX     ANDNE*BLANK
     C           PRINRO    ANDNE*ZEROS
     C           WDTL4     OREQ *BLANK
     C           PRINX     ANDNE*BLANK
     C           PRINRO    ANDNE*ZEROS
     C           WDTL5     OREQ *BLANK                                                       BUG9240
     C           RTSPH     ANDGT*ZEROS                                                       BUG9240
     C           BRTEH     ANDGT*ZEROS                                                       BUG9240
     C           DISCRO    ANDNE0                                         221558
     C                     MOVE 'Y'       WSAME
     C                     ENDIF
     C                     ENDSL
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLOAM  -  Process record read from loan amendments file      *
      * Called by: SRPROC - Process enquiry request                   *
      * Calls    : SRDISL - Display loan amendment                    *
      *            SRRPAY - Process each forward repayment            *
      *            SRINCL - Interest calculation                      *
      *            SROUTL - Format loan amendment for display         *
      *            SRNEWI - Compute for new interest rate             *
      *****************************************************************
     C           SRLOAM    BEGSR
      *                                                                                       238722
      ** Convert loan events from LOAMSDK when value date is greater than                     238722
      ** multi-ccy rollover date to its equivalent amount on new ccy                          238722
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     EXSR CONCCY                                                        238722
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C           AMTPL     IFNE 'RE'                                                          190638
     C           AMTPL     OREQ 'RE'                                                          190638
     C           VDATL     ANDLEMDAT                                                          190638
     C********** VDATL     ANDLERLDT                                                  249835A 260274
     C********** AMTPL     OREQ 'RE'                                                  249835A 260274
     C********** VDATL     ANDLEMDAT                                                  249835A 260274
     C********** RLDT      ANDEQ0                                                     249835A 260274
     C           AMTPL     OREQ 'RE'                                                          210268
     C           MDAT      ANDEQ0                                                             210268
      *                                                                   154221
     C           WSAME     IFEQ 'Y'                                       154221
     C           INTAL     ANDNE*ZEROS                                    154221
     C           WDTL2     ANDEQ*BLANK                                    154221
     C                     CLEARWSAME                                     154221
     C                     ENDIF                                          154221
      *
      ** If detail previously printed is current balance, no need to
      ** re-format data
      *
     C**********           Z-ADDICBS      WICBS                           147511              206256
     C           NCAS      IFNE *ZERO                                                       BUG22332
     C           VDATL     ANDGEWWRLDT                                                      BUG22332
     C                     Z-ADDNCAS      OICBS                                             BUG22332
     C                     ELSE                                                             BUG22332
     C                     Z-ADDICBS      OICBS                                               206256
     C                     ENDIF                                                            BUG22332
      *                                                                   193339
     C           WOVFL     IFEQ 'Y'                                       193339
      *                                                                   184959
      ** Convert due date to Midas day number                             184959
      *                                                                   184959
     C                     MOVE SDUDT     DSDAT1  5                       184959
     C                     MOVELDSDAT1    DCMNTH  3                       184959
     C                     SELEC                                          184959
     C           DCMNTH    WHEQ 'JAN'                                     184959
     C                     Z-ADD01        DNMNTH  20                      184959
     C           DCMNTH    WHEQ 'FEB'                                     184959
     C                     Z-ADD02        DNMNTH                          184959
     C           DCMNTH    WHEQ 'MAR'                                     184959
     C                     Z-ADD03        DNMNTH                          184959
     C           DCMNTH    WHEQ 'APR'                                     184959
     C                     Z-ADD04        DNMNTH                          184959
     C           DCMNTH    WHEQ 'MAY'                                     184959
     C                     Z-ADD05        DNMNTH                          184959
     C           DCMNTH    WHEQ 'JUN'                                     184959
     C                     Z-ADD06        DNMNTH                          184959
     C           DCMNTH    WHEQ 'JUL'                                     184959
     C                     Z-ADD07        DNMNTH                          184959
     C           DCMNTH    WHEQ 'AUG'                                     184959
     C                     Z-ADD08        DNMNTH                          184959
     C           DCMNTH    WHEQ 'SEP'                                     184959
     C                     Z-ADD09        DNMNTH                          184959
     C           DCMNTH    WHEQ 'OCT'                                     184959
     C                     Z-ADD10        DNMNTH                          184959
     C           DCMNTH    WHEQ 'NOV'                                     184959
     C                     Z-ADD11        DNMNTH                          184959
     C           DCMNTH    WHEQ 'DEC'                                     184959
     C                     Z-ADD12        DNMNTH                          184959
     C                     ENDSL                                          184959
      *                                                                   184959
     C                     MOVE SDUDT     DSYEAR  2                       184959
     C                     MOVELSDUDT     DSNDAY  2                       184959
     C                     MOVE DSYEAR    WDAT3   4                       184959
     C                     MOVELDNMNTH    WDAT3                           184959
     C                     MOVE WDAT3     WCDATE  6                       184959
     C                     MOVELDSNDAY    WCDATE                          184959
      *                                                                   184959
     C                     Z-ADDZDAYNO    WDAT1   50                      184959
     C                     MOVE WCDATE    ZDATE                           184959
     C                     EXSR ZDATE1                                    184959
     C                     Z-ADDZDAYNO    WNDATE  50                      184959
     C                     Z-ADDWDAT1     ZDAYNO                          184959
      *                                                                   184959
     C                     ENDIF                                          193339
      *                                                                   193339
     C           WOVFL     IFEQ 'Y'
     C           WSAME     ANDEQ' '                                       184959
     C           WOVFL     OREQ 'Y'                                       184959
     C           WSAME     ANDEQ'Y'                                       184959
     C           VDATL     ANDEQWNDATE                                    184959
     C           WFRIN     ANDNE'Y'                                                         AR860576
      *                                                                   184897
      ** Check if manual repayment for interest should be                 184897
      ** displayed on the next screen.                                    184897
      *                                                                   184897
     C           WSAME     IFEQ ' '                                       184897
     C           INTAL     ANDNE*ZEROS                                    184897
     C           PRAML     ANDNE*ZEROS                                                        249398
     C           WDTL2     ANDEQ*BLANK                                    184897
     C           AMTPL     ANDEQ'MR'                                                          205705
     C                     EXSR SRDISL                                    184897
      *                                                                                       263412
     C           CLE134    IFEQ 'Y'                                                           263412
     C           DSLTY1    IFNE 'X'                                                           263412
     C           DSLTY1    ANDNE'Y'                                                           263412
     C           DSLTY1    ANDNE'Z'                                                           263412
     C                     MOVE LNRFL     KYPORG                                              263412
     C                     MOVE VDATL     KYPDVD                                              263412
     C                     Z-ADDINTAL     DSOLAM                                              263412
     C                     MOVE 'I'       DSPDCT                                              263412
     C                     MOVE LASNL     DSLASN                                              263412
     C                     Z-ADDLCDL      KYLCD                                             AR720887
     C**********           EXSR XEPPD2                                                 263412 263411
     C                     EXSR XEPPD1                                                        263411
     C                     ENDIF                                                              263412
     C                     ENDIF                                                              263412
      *                                                                                       247071
     C           GASSL     IFEQ 'A'                                                           247071
     C                     MOVEL'LEE0318' ZAMSID                                              247071
     C                     ELSE                                                               247071
     C                     MOVEL'LEE0025' ZAMSID                          184897
     C                     ENDIF                                                              247071
      *                                                                                       247071
     C                     EXSR SRTEXT                                    184897
     C                     MOVELZAMSTX    SNARR                           184897
     C                     Z-ADDINTAL     ZFLD15                          184897
     C           CLE134    IFEQ 'Y'                                                           263412
     C           DSPPDA    ANDEQ'Y'                                                           263412
     C           INTAL     SUB  YPDINT    ZFLD15                                              263412
     C                     ENDIF                                                              263412
      *                                                                                       263412
     C                     EXSR ZSEDIT                                    184897
     C                     MOVE ZOUT21    SAMNT                           184897
     C                     MOVE 'Y'       WDTL2                           184897
     C                     ENDIF                                          184897
     C                     EXSR SRDISL
      *                                                                                       263412
      ** ... Past Due Interest Transfer to PDCL.                                              263412
      *                                                                                       263412
     C           CLE134    IFEQ 'Y'                                                           263412
     C           DSPPDA    ANDEQ'Y'                                                           263412
     C                     MOVEL'LEE5410' ZAMSID                                              263412
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPLON     ZAMSDA                                              263412
     C                     EXSR SRTEXT                                                        263412
     C                     MOVELZAMSTX    SNARR                                               263412
      *                                                                                       263412
     C                     Z-ADDYPDINT    ZFLD15                                              263412
     C                     EXSR ZSEDIT                                                        263412
     C                     MOVE ZOUT21    SAMNT                                               263412
     C                     MOVE 'Y'       WDTL1                                               263412
     C                     EXSR SRDISL                                                        263412
     C                     ENDIF                                                              263412
     C                     ELSE
      *
      ** Process frequency repayments
      *
     C           WFRPR     IFEQ 'Y'
     C           WFRIN     OREQ 'Y'
     C                     Z-ADDVDATL     WCODT
     C           WREPT     DOUEQ*BLANK                                    132287
     C                     EXSR SRRPAY
     C                     ENDDO                                          132287
     C                     ENDIF
      *
      ** Accumulate interest on change of date
      *
     C           WSAME     IFEQ *BLANK                                    132287
     C           WLASD     IFNE VDATL
     C           WLASD     ANDNE*ZEROS
     C           WSTAC     ANDEQ*BLANK
     C           AMTPL     ANDNE'LS'                                                        AR753186
      *                                                                                     AR317587
      ** Use MDAT as End Date for interest calculation if VDATL is greater                  AR317587
      ** than MDAT.                                                                         AR317587
      *                                                                                     AR317587
     C                     Z-ADDVDATL     ZIEND                                             MD020852
     C           VDATL     IFGT MDAT                                                        AR317587
     C********** AMTPL     ANDEQ'MR'                                               AR317587 MD020852
     C           MDAT      ANDGT*ZEROS                                                      MD020852
     C                     Z-ADDMDAT      ZIEND                                             AR317587
     C**********           ELSE                                                    AR317587 MD020852
     C**********           Z-ADDVDATL     ZIEND                                             MD020852
     C                     ENDIF                                                            AR317587
      *                                                                                     AR317587
     C                     Z-ADDVDATL     W78BEG                                              CLE028
      *                                                                                     AR317587
     C                     Z-ADDVDATL     W78END                                            MD020852
     C           VDATL     IFGT MDAT                                                        AR317587
     C********** AMTPL     ANDEQ'MR'                                               AR317587 MD020852
     C           MDAT      ANDGT*ZEROS                                                      MD020852
     C                     Z-ADDMDAT      W78END                                            AR317587
     C**********           ELSE                                                    AR317587 MD020852
     C**********           Z-ADDVDATL     W78END                                     CLE028 MD020852
     C                     ENDIF                                                            AR317587
      *                                                                                     AR317587
     C                     MOVE 'A'       W78ROA                                              CLE028
     C                     EXSR SRINCL
     C           RDFC      IFEQ 'Y'                                       147511
     C                     ADD  ZINTR     WINCA
     C                     ELSE                                           147511
     C                     ADD  ZINTR     WINCA     H                     147511
     C                     ENDIF                                          147511
     C                     ADD  ZINTR     WCALC                           133915
     C                     ENDIF
      *
      ** Prepare to display action if selected
      *
     C           VDATL     IFGE WDTIN
     C           WCDIN     IFEQ *BLANK
     C           WCDIN     OREQ 'P'
     C           AMTPL     ANDEQ'PD'
     C           WCDIN     OREQ 'B'
     C           VDATL     ANDLTRUND
     C           AMTPL     ANDNE'PD'
     C           WCDIN     OREQ 'F'
     C           VDATL     ANDGERUND
     C                     EXSR SROUTL
     C                     ENDIF
     C                     ENDIF
      *                                                                                     BUG21868
     C           VDATL     IFEQ MDAT                                                        BUG21868
     C           ZINTR     ANDGT*ZERO                                                       BUG21868
     C           SCAPI     ANDEQ'YES'                                                       BUG21868
     C           WINCA     SUB  WINPD     WINTR                                             BUG21868
     C                     ADD  WINTR     WINPD                                             BUG21868
     C                     ADD  WINTR     WCUPR                                             BUG21868
     C/COPY WNCPYSRC,LEH00942
     C                     ENDIF                                                            BUG21868
      *                                                                                     BUG21868
     C                     ENDIF                                          132287
     C                     ENDIF
      *
      ** Maintain current principal, rate and interest paid
      *
     C           WSAME     IFEQ *BLANK
     C                     SELEC
     C           AMTPL     WHEQ 'PT'
     C           AMTPL     OREQ 'PI'
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     ADD  ZAMTCO    WCUPR                                               238722
     C/COPY WNCPYSRC,LEH00943
     C                     ELSE                                                               238722
     C                     ADD  PRAML     WCUPR
     C/COPY WNCPYSRC,LEH00944
     C                     ENDIF                                                              238722
      *
     C           AMTPL     WHEQ 'PF'
     C***********AMTPL     OREQ 'RE'                                      157635
     C***********REPTL     ANDEQ2                                         157635
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     SUB  ZAMTCO    WCUPR                                               238722
     C/COPY WNCPYSRC,LEH00945
     C                     ELSE                                                               238722
     C                     SUB  PRAML     WCUPR
     C/COPY WNCPYSRC,LEH00946
     C                     ENDIF                                                              238722
      *
     C           AMTPL     WHEQ 'RE'                                      157635
     C           REPTL     ANDEQ2                                         157635
     C           CLE154    ANDEQ'N'                                                           CLE154
     C           AMTPL     OREQ 'RE'                                                          CLE154
     C           REPTL     ANDEQ2                                                             CLE154
     C           CLE154    ANDEQ'Y'                                                           CLE154
     C           PRAML     ANDNE0                                                             CLE154
      *                                                                                       238722
     C                     MOVE '0'       *IN10                                               238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     Z-ADDZAMTCO    WPRAML                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDPRAML     WPRAML                          157635
     C                     ENDIF                                                              238722
      *                                                                                       238722
      ** the following converts repayments in facility ccy to loan ccy                        238722
      *                                                                                       238722
     C           CCYCL     IFNE FCCY                                      157635
     C           CCYL      ANDEQFCCY                                      157635
     C           FMDI      IFEQ 'M'                                       157635
     C           PRAML     DIV  FCXR      WPRAML 130                      157635
     C                     ELSE                                           157635
     C           PRAML     MULT FCXR      WPRAML                          157635
     C                     ENDIF                                          157635
      *                                                                                       238722
      ** now convert the repayment to new loan ccy                                            238722
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           VDATL     ANDGTWWRLDT                                                        238722
      *                                                                                       238722
     C                     MOVE '1'       *IN10                                               238722
     C                     EXSR CONCCY                                                        238722
     C                     ENDIF                                                              238722
     C                     ENDIF                                          157635
      *                                                                   157635
     C********** AUTOL     IFEQ 'Y'                                                    218984 242909
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C           *IN10     OREQ '1'                                                           238722
     C                     SUB  ZAMTCO    WCUPR                                               238722
     C/COPY WNCPYSRC,LEH00947
     C                     ELSE                                                               238722
     C                     SUB  WPRAML    WCUPR                           157635
     C/COPY WNCPYSRC,LEH00948
     C                     ENDIF                                                              238722
     C**********           ENDIF                                                       218984 242909
      *                                                                   157635
     C           AMTPL     WHEQ 'MR'
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     ADD  WINTAL    WINPD                                               238722
     C                     ADD  WINTAL    WIPAID                                              238722
     C                     SUB  ZAMTCO    WCUPR                                               238722
     C/COPY WNCPYSRC,LEH00949
     C                     ELSE                                                               238722
     C                     ADD  INTAL     WINPD
     C                     ADD  INTAL     WIPAID 152                      133915
     C                     SUB  PRAML     WCUPR
     C/COPY WNCPYSRC,LEH00950
     C                     ENDIF                                                              238722
      *
      ** For repayment types 1 and 3, compute for the separate
      ** principal and interest repayments from the repayment made
      *
     C           AMTPL     WHEQ 'RE'
      *                                                                   157635
     C                     MOVE '0'       *IN10                                               238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     Z-ADDZAMTCO    WTAMTL                                              238722
     C                     Z-ADDZAMTCO    WPRAML                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDTAMTL     WTAMTL                          157635
     C                     Z-ADDPRAML     WPRAML                          157635
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C           CCYCL     IFNE FCCY                                      157635
     C           CCYL      ANDEQFCCY                                      157635
     C           FMDI      IFEQ 'M'                                       157635
     C           TAMTL     DIV  FCXR      WTAMTL 130H                     157635
     C           PRAML     DIV  FCXR      WPRAML                          157635
     C                     ELSE                                           157635
     C           TAMTL     MULT FCXR      WTAMTL                          157635
     C           PRAML     MULT FCXR      WPRAML                          157635
     C                     ENDIF                                          157635
      *                                                                                       238722
      ** now convert the repayment to new loan ccy                                            238722
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           VDATL     ANDGTWWRLDT                                                        238722
      *                                                                                       238722
     C                     MOVE '1'       *IN10                                               238722
     C                     EXSR CONCCY                                                        238722
     C                     ENDIF                                                              238722
     C                     ENDIF                                          157635
      *                                                                   157635
     C           REPTL     IFEQ 3
     C***********ZINTR     IFLE TAMTL                                     157635
     C***********TAMTL     SUB  ZINTR     WPRAM  130H                     157635
     C           ZINTR     IFLE WTAMTL                                    157635
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C           *IN10     OREQ '1'                                                           238722
     C           ZAMTCO    SUB  ZINTR     WPRAM                                               238722
     C                     ELSE                                                               238722
     C           WTAMTL    SUB  ZINTR     WPRAM  130H                     157635
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     Z-ADDZINTR     WINTA  130
     C                     ELSE
     C                     Z-ADD*ZEROS    WPRAM
     C***********          Z-ADDTAMTL     WINTA                           157635
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C           *IN10     OREQ '1'                                                           238722
     C                     Z-ADDZAMTCO    WINTA                                               238722
     C                     ELSE                                                               238722
     C                     Z-ADDWTAMTL    WINTA                           157635
     C                     ENDIF                                                              238722
     C                     ENDIF
      *                                                                                       CLE028
      ** If Add on interest is 'Y', total amount is equal to principal                        CLE028
      ** amount only                                                                          CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADIF      ANDEQ'Y'                                                           CLE028
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C           *IN10     OREQ '1'                                                           238722
     C                     Z-ADDZAMTCO    WPRAM                                               238722
     C                     ELSE                                                               238722
     C                     Z-ADDWTAMTL    WPRAM                                               CLE028
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     Z-ADD*ZEROS    WINTA                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     ELSE
     C***********          Z-ADDPRAML     WPRAM                           157635
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C           *IN10     OREQ '1'                                                           238722
     C                     Z-ADDZAMTCO    WPRAM                                               238722
     C                     ELSE                                                               238722
     C                     Z-ADDWPRAML    WPRAM                           157635
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     Z-ADDZINTR     WINTA
     C                     ENDIF
     C********** AUTOL     IFEQ 'Y'                                                    218984 242909
     C********** AUTOL     IFEQ 'Y'                                                BUG22066 BUG22332
     C                     SUB  WPRAM     WCUPR
     C/COPY WNCPYSRC,LEH00951
     C           AUTOL     IFEQ 'Y'                                                         BUG22332
     C           AUTOL     OREQ 'C'                                                           CLE134
     C           REPTL     OREQ 3                                                          BUG22332A
     C           AUTOL     ANDEQ'N'                                                        BUG22332A
     C                     ADD  WINTA     WINPD
     C                     ADD  WINTA     WIPAID                          133915
     C                     ENDIF                                                            BUG22066
     C**********           ENDIF                                                       218984 242909
      *
     C           AMTPL     WHEQ 'BC'
     C                     Z-ADDBRTEL     WCUBR
      * Get the Base Rate History (override the previous one)                                 239062
     C           CLE011    IFEQ 'Y'                                                           239062
     C                     MOVE CCY       ZCCY                                                239062
     C                     MOVE BRTT      WBRTT                                               239062
     C                     EXSR SRBRFZ                                                        239062
     C                     ENDIF                                                              239062
      *                                                                                       239062
     C                     EXSR SRNEWI
      *
     C           AMTPL     WHEQ 'SC'
      * Only process Spread Changes that amended the interest spread rate                     248506
     C           IRCFL     IFEQ 'Y'                                                           248506
     C           IRCFL     ORNE 'Y'                                                           255285
     C           BGN0ST    ANDNE'Y'                                                           255285
     C                     Z-ADDRTSPL     WCUSP
     C                     EXSR SRNEWI
     C                     ENDIF                                                              248506
      *
     C           AMTPL     WHEQ 'SA'
     C           WSTAC     IFEQ *BLANK
     C                     Z-ADDVDATL     WLICD
     C                     ENDIF
      *
     C           AMTPL     WHEQ 'PD'
     C           INTAL     IFNE *ZEROS
     C                     ADD  INTAL     WINPD
     C                     ADD  INTAL     WIPAID                          133915
      *                                                                                       243394
      ** If systemvalue 'AddPastDueIntrInLOAC' = 'Y', add Past Due Interest                   243394
      ** into the calculated Maturity Interest.                                               243394
     C           ADDPDI    IFEQ 'Y'                                                           243394
     C                     ADD  INTAL     IPDUE                                               225849
     C                     ENDIF                                                              243394
     C                     ENDIF
      *                                                                   139311
      ***Add*past*due*amount*to*running*balance.**********************                 139311 251331
     C********** CLE014    IFEQ 'N'                                                    CLE014 251331
     C********** RATF      IFEQ 'Y'                                                    139311 251331
     C**********           ADD  PRAML     WCUPR                                        139311 251331
     C**********           ENDIF                                                       139311 251331
     C**********           ENDIF                                                       CLE014 251331
      *                                                                   139311
     C                     ENDSL
      *
     C           WINIT     IFEQ 'Y'
     C                     Z-ADDWCUPR     WSVBL
     C                     MOVE *BLANK    WINIT
     C                     ENDIF
     C                     MOVE SUTP      WLSUTP  2
     C                     MOVE CLAS      WLCLAS  4                                           CLE042
     C                     Z-ADDVDATL     WLTDT
     C           AMTPL     IFNE 'LS'                                                        AR753186
     C                     Z-ADDVDATL     WLASD
     C                     ENDIF                                                            AR753186
      *
      ** Read next live loan amendment record
      *
     C           *IN34     IFEQ '0'
     C           *IN34     DOUEQ'1'
     C           RECI      OREQ 'D'
     C           LNRF      READELOAMS                    34
     C                     ENDDO
     C           *IN34     IFEQ '1'
     C                     Z-ADD99999     VDATL
     C                     Z-ADD99999     WCODT
     C                     MOVE '0'       *IN35                                               260221
     C                     MOVE '0'       *IN36                                               260221
     C                     ENDIF
     C                     MOVE *BLANK    WOVFL
     C                     MOVE *BLANK    WDTL1
     C                     MOVE *BLANK    WDTL2
     C                     MOVE *BLANK    WDTL3
     C                     MOVE *BLANK    WDTL4
     C                     MOVE *BLANK    WDTL5
     C                     ENDIF
     C                     ENDIF
     C                     ELSE                                                               190638
     C           *IN34     DOUEQ'1'                                                           190638
     C           RECI      OREQ 'D'                                                           190638
     C           LNRF      READELOAMS                    34                                   190638
     C                     ENDDO                                                              190638
     C           *IN34     IFEQ '1'                                                           190638
     C                     Z-ADD99999     VDATL                                               190638
     C                     Z-ADD99999     WCODT                                               190638
     C                     MOVE '0'       *IN35                                               260221
     C                     MOVE '0'       *IN36                                               260221
     C                     ENDIF                                                              190638
     C                     END                                                                190638
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SROUTL  -  Format loan amendment for display                  *
      * Called by: SRLOAM - Process loan amendment record             *
      * Calls    : SRTEXT - Set up text from message file             *
      *            SRDISL - Display loan amendment record             *
      *****************************************************************
     C           SROUTL    BEGSR
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C                     MOVELLTYP      DSLTYP                                              CLE134
     C                     MOVE *BLANKS   DSPPDA                                              CLE134
     C                     ENDIF                                                              CLE134
      *
      ** Principal transfer from
      *
     C                     SELEC
     C           AMTPL     WHEQ 'PF'
     C                     MOVEL'LEE0055' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     MOVELROLNL     #ROLN
     C                     MOVE #ROLN     SNARR
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     Z-ADDZAMTCO    ZFLD15                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDPRAML     ZFLD15
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     EXSR SRDISL
      *
      ** Principal transfer to
      *
     C           AMTPL     WHEQ 'PT'
     C                     MOVEL'LEE0056' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     MOVELROLNL     #ROLN
     C                     MOVE #ROLN     SNARR
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     Z-ADDZAMTCO    ZFLD15                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDPRAML     ZFLD15
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     EXSR SRDISL
      *
      ** Base rate code change
      *
     C           AMTPL     WHEQ 'BC'
     C           CLE036    IFEQ 'N'                                                           CLE036
     C           BRTTL     ORNE *ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     MOVEL'LEE0014' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C*********************MOVE '   TO   'NAREND  8                                    188382 CLE042
     C*********************MOVE BRTTL     NAREND                                       188382 CLE042
     C*********************MOVE NAREND    SNARR                                        188382 CLE042
     C                     MOVE '   TO   'NAREXT  8                                           CLE042
     C                     MOVE BRTTL     NAREXT                                              CLE042
     C                     MOVE NAREXT    SNARR                                               CLE042
      *                                                                                       CLE036
      ** If Base Rate Code is Zeros, Narrative becomes that of Base Rate                      CLE036
      ** Change, as replacement                                                               CLE036
      *                                                                                       CLE036
     C                     ELSE                                                               CLE036
      *                                                                                       CLE036
     C                     MOVEL'LEE0015' ZAMSID                                              CLE036
     C                     EXSR SRTEXT                                                        CLE036
     C                     MOVELZAMSTX    SNARR                                               CLE036
      *                                                                                       CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     MOVE BRTEL     ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
     C                     MOVE ZFIELD    SAMNT
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISL
      *
      ** Manual Repayment - principal
      *
     C           AMTPL     WHEQ 'MR'
     C           PRAML     IFNE *ZEROS
     C           WDTL1     ANDEQ*BLANK
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C********** DSLTY1    IFNE 'X'                                                  CLE134 MD031977
     C********** DSLTY1    ANDNE'Y'                                                  CLE134 MD031977
     C********** DSLTY1    ANDNE'Z'                                                  CLE134 MD031977
     C                     MOVE LNRFL     KYPORG                                              CLE134
     C                     MOVE VDATL     KYPDVD                                              CLE134
     C                     Z-ADDPRAML     DSOLAM                                              CLE134
     C                     MOVE 'P'       DSPDCT                                              CLE134
     C                     MOVE LASNL     DSLASN                                              CLE134
     C                     Z-ADDLCDL      KYLCD                                             AR720887
     C**********           EXSR XEPPD2                                                 CLE134 263411
     C           DSLTY1    IFNE 'X'                                                         MD031977
     C           DSLTY1    ANDNE'Y'                                                         MD031977
     C           DSLTY1    ANDNE'Z'                                                         MD031977
     C                     EXSR XEPPD1                                                        263411
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       247071
     C           GASSL     IFEQ 'A'                                                           247071
     C                     MOVEL'LEE0315' ZAMSID                                              247071
     C                     ELSE                                                               247071
     C                     MOVEL'LEE0022' ZAMSID
     C                     ENDIF                                                              247071
      *                                                                                       247071
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     Z-ADDZAMTCO    ZFLD15                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDPRAML     ZFLD15
     C                     ENDIF                                                              238722
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C           PRAML     SUB  YPCPAM    ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       238722
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL1
     C                     EXSR SRDISL
     C                     ENDIF
      *                                                                                       CLE134
      ** ... Past Due Principal Transfer to PDCL.                                             CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C                     MOVEL'LEE5400' ZAMSID                                              CLE134
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPLON     ZAMSDA                                              CLE134
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDYPCPAM    ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISL                                                        CLE134
     C                     ENDIF                                                              CLE134
      *
      ** ... interest
      *
     C           INTAL     IFNE *ZEROS
     C           WDTL2     ANDEQ*BLANK
     C           VSLN      ANDLT20
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSLTY1    IFNE 'X'                                                           CLE134
     C           DSLTY1    ANDNE'Y'                                                           CLE134
     C           DSLTY1    ANDNE'Z'                                                           CLE134
     C                     MOVE LNRFL     KYPORG                                              CLE134
     C                     MOVE VDATL     KYPDVD                                              CLE134
     C                     Z-ADDINTAL     DSOLAM                                              CLE134
     C                     MOVE 'I'       DSPDCT                                              CLE134
     C                     MOVE LASNL     DSLASN                                              CLE134
     C                     Z-ADDLCDL      KYLCD                                             AR720887
     C**********           EXSR XEPPD2                                                 CLE134 263411
     C                     EXSR XEPPD1                                                        263411
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       247071
     C           GASSL     IFEQ 'A'                                                           247071
     C                     MOVEL'LEE0318' ZAMSID                                              247071
     C                     ELSE                                                               247071
     C                     MOVEL'LEE0025' ZAMSID
     C                     ENDIF                                                              247071
      *                                                                                       247071
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     Z-ADDWINTAL    ZFLD15                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDINTAL     ZFLD15
     C                     ENDIF                                                              238722
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C           INTAL     SUB  YPDINT    ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       238722
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL2
     C                     EXSR SRDISL
      *                                                                                       CLE134
      ** ... Past Due Interest Transfer to PDCL.                                              CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C                     MOVEL'LEE5410' ZAMSID                                              CLE134
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPLON     ZAMSDA                                              CLE134
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDYPDINT    ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISL                                                        CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF
      *
      ** ... withholding tax
      *
     C           WTXAL     IFNE *ZEROS
     C           WDTL3     ANDEQ*BLANK
     C           VSLN      ANDLT20
      *                                                                                       247071
     C           GASSL     IFEQ 'A'                                                           247071
     C                     MOVEL'LEE0316' ZAMSID                                              247071
     C                     ELSE                                                               247071
     C                     MOVEL'LEE0023' ZAMSID
     C                     ENDIF                                                              247071
      *                                                                                       247071
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     Z-ADDWWTXAL    ZFLD15                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDWTXAL     ZFLD15
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL3
     C                     EXSR SRDISL
     C                     ENDIF
      *
      ** ... fee amount
      *
     C           FEAML     IFNE *ZEROS
     C           WDTL4     ANDEQ*BLANK
     C           VSLN      ANDLT20
      *                                                                                       247071
     C           GASSL     IFEQ 'A'                                                           247071
     C                     MOVEL'LEE0317' ZAMSID                                              247071
     C                     ELSE                                                               247071
     C                     MOVEL'LEE0024' ZAMSID
     C                     ENDIF                                                              247071
      *                                                                                       247071
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     Z-ADDWFEAML    ZFLD15                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDFEAML     ZFLD15
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL4
     C                     EXSR SRDISL
     C                     ENDIF
      *
      ** Past Due
      *
     C           AMTPL     WHEQ 'PD'
     C/COPY WNCPYSRC,LEH01300
     C                     MOVEL'LEE0026' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDTAMTL     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     EXSR SRDISL
     C/COPY WNCPYSRC,LEH01301
      *
      ** Principal increase
      *
     C           AMTPL     WHEQ 'PI'
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSLTY1    IFEQ 'X'                                                           CLE134
     C           DSLTY1    OREQ 'Z'                                                           263418
     C                     MOVE AMTPH     W#AMTP  2                                        AR1054816
     C                     MOVE AMTPL     AMTPH                                               263361
     C                     MOVE LNRFL     KYPLON                                              CLE134
     C                     MOVE VDATL     KYPDVD                                              CLE134
     C                     Z-ADDPRAML     DSOLAM                                              CLE134
     C                     MOVE 'P'       DSPDCT                                              CLE134
     C                     MOVE LASNL     DSLASN                                              CLE134
     C                     Z-ADDLCDL      KYLCD                                             AR720887
     C                     EXSR XEPPD1                                                        CLE134
     C                     MOVE W#AMTP    AMTPH                                            AR1054816
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           DSLTY1    IFEQ 'Y'                                                           CLE134
     C                     MOVE AMTPH     W#AMTP                                           AR1054816
     C                     MOVE AMTPL     AMTPH                                               263361
     C                     MOVE LNRFL     KYPLON                                              CLE134
     C                     MOVE VDATL     KYPDVD                                              CLE134
     C                     Z-ADDINTAL     DSOLAM                                              CLE134
     C                     MOVE 'I'       DSPDCT                                              CLE134
     C                     MOVE LASNL     DSLASN                                              CLE134
     C                     Z-ADDLCDL      KYLCD                                             AR720887
     C                     EXSR XEPPD1                                                        CLE134
     C                     MOVE W#AMTP    AMTPH                                            AR1054816
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       247071
      ** ... Past Due Principal Transfer from PDCL.                                           CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C           YPCPAM    IFNE 0                                                             CLE134
     C                     MOVEL'LEE5401' ZAMSID                                              CLE134
     C           YPORG     IFNE *BLANKS                                                       263418
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPORG     ZAMSDA                                              CLE134
     C                     ELSE                                                               263418
     C           DSLTY1    IFEQ 'Z'                                                           263418
     C                     CLEARZAMSDA                                                        263418
     C                     CLEARD@FEE                                                         263418
     C                     MOVELYEFACL    P@FEFA                                              263418
     C                     MOVE '-'       P@COS                                               263418
     C                     MOVELYESEQ     P@FECD                                              263418
     C                     MOVELD@FEE     ZAMSDA                                              263418
     C**********           MOVEL'LEE5412' ZAMSID                                      263418 263418A
     C                     MOVEL'LEE5413' ZAMSID                                             263418A
     C                     ENDIF                                                              263418
     C                     ENDIF                                                              263418
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDYPCPAM    ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISL                                                        CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           YPDINT    IFNE 0                                                             CLE134
     C                     MOVEL'LEE5411' ZAMSID                                              CLE134
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPORG     ZAMSDA                                              CLE134
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDYPDINT    ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISL                                                        CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
     C           GASSL     IFEQ 'A'                                                           247071
     C                     MOVEL'LEE0319' ZAMSID                                              247071
     C                     ELSE                                                               247071
     C                     MOVEL'LEE0027' ZAMSID
     C                     ENDIF                                                              247071
      *                                                                                       247071
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C                     Z-ADDZAMTCO    ZFLD15                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDPRAML     ZFLD15
     C                     ENDIF                                                              238722
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     EXSR SRDISL
     C                     ENDIF                                                              CLE134
      *
      ** Repayments - principal
      *
     C           AMTPL     WHEQ 'RE'
     C           REPTL     IFLT 3
      *                                                                   157556
     C           PRAML     IFEQ 0                                         157556
     C                     MOVEL'LEE0029' ZAMSID                          157556
     C                     Z-ADDINTAL     ZFLD15                          157556
     C                     ELSE                                           157556
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSLTY1    IFNE 'X'                                                           CLE134
     C           DSLTY1    ANDNE'Y'                                                           CLE134
     C           DSLTY1    ANDNE'Z'                                                           CLE134
     C                     MOVE LNRFL     KYPORG                                              CLE134
     C                     MOVE VDATL     KYPDVD                                              CLE134
     C                     Z-ADDPRAML     DSOLAM                                              CLE134
     C                     MOVE 'P'       DSPDCT                                              CLE134
     C                     MOVE LASNL     DSLASN                                              CLE134
     C                     Z-ADDLCDL      KYLCD                                             AR720887
     C**********           EXSR XEPPD2                                                 CLE134 263411
     C                     EXSR XEPPD1                                                        263411
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C********** AUTOL     IFEQ 'Y'                                                    218984 242909
     C                     MOVEL'LEE0028' ZAMSID
     C**********           ELSE                                                        218984 242909
     C**********           MOVEL'LEE0063' ZAMSID                                       218984 242909
     C**********           ENDIF                                                       218984 242909
      *                                                                                       238722
      ** Use the converted amount                                                             238722
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C           *IN10     OREQ '1'                                                           238722
     C                     Z-ADDZAMTCO    ZFLD15                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDPRAML     ZFLD15
     C                     ENDIF                                                              238722
     C                     ENDIF                                          157556
      *                                                                   157556
     C                     ELSE
     C                     MOVEL'LEE0031' ZAMSID
      *                                                                                       238722
     C           NCCY      IFNE *BLANKS                                                       238722
     C           CCYCL     ANDEQCCYL                                                          238722
     C           VDATL     ANDGTWWRLDT                                                        238722
     C           *IN10     OREQ '1'                                                           238722
     C                     Z-ADDZAMTCO    ZFLD15                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDTAMTL     ZFLD15
     C                     ENDIF                                                              238722
     C                     ENDIF
      *                                                                   157635
      ** Convert amount only when value date is not greater than rollover                     238722
      ** because if it is future amendment, it has already been converted                     238722
      *                                                                                       238722
     C           VDATL     IFLE WWRLDT                                                        238722
     C           CCYCL     IFNE FCCY                                      157635
     C           CCYL      ANDEQFCCY                                      157635
     C           FMDI      IFEQ 'M'                                       157635
     C                     DIV  FCXR      ZFLD15                          157635
     C                     ELSE                                           157635
     C                     MULT FCXR      ZFLD15                          157635
     C                     ENDIF                                          157635
     C                     ENDIF                                          157635
     C                     ENDIF                                                              238722
      *                                                                   157635
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C           PRAML     SUB  YPCPAM    ZFLD15                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     EXSR SRDISL
      *
      ** ... Past Due Principal Transfer to PDCL.                                             CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           DSPPDA    ANDEQ'Y'                                                           CLE134
     C                     MOVEL'LEE5400' ZAMSID                                              CLE134
     C                     CLEARZAMSDA                                                        263418
     C                     MOVELYPLON     ZAMSDA                                              CLE134
     C                     EXSR SRTEXT                                                        CLE134
     C                     MOVELZAMSTX    SNARR                                               CLE134
      *                                                                                       CLE134
     C                     Z-ADDYPCPAM    ZFLD15                                              CLE134
     C                     EXSR ZSEDIT                                                        CLE134
     C                     MOVE ZOUT21    SAMNT                                               CLE134
     C                     MOVE 'Y'       WDTL1                                               CLE134
     C                     EXSR SRDISL                                                        CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Start/stop accruals
      *
     C           AMTPL     WHEQ 'SA'
     C           STAIL     IFEQ 'Y'
     C                     MOVEL'LEE0037' ZAMSID
     C                     MOVE 'Y'       WSTAC
     C                     Z-ADDVDATL     WSTPA                                               209517
     C                     ELSE
     C                     MOVEL'LEE0038' ZAMSID
     C                     MOVE *BLANK    WSTAC
     C                     ENDIF
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     MOVE *BLANKS   SAMNT                                               238739
     C                     MOVE INTR      ZFIELD                                              247978
     C                     Z-ADD7         ZADEC                                               247978
     C                     EXSR ZEDIT                                                         247978
     C                     MOVE ZFIELD    SAMNT                                               247978
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISL
      *
      ** Spread/rate change
      ** If Analytical Accounting is present - only display 'SC'
      ** amendments when change to the interest rate/spread (flag = Y)
      ** or if Revenue Analysis is installed - only display 'SC'          CDE002
      ** amendments when change to the interest rate/spread (flag = Y)    CDE002
      *
     C           AMTPL     WHEQ 'SC'
     C           BGN0ST    IFNE 'Y'
     C           CDE002    ANDNE'Y'                                       CDE002
     C           BGN0ST    OREQ 'Y'
     C           IRCFL     ANDEQ'Y'
     C           CDE002    OREQ 'Y'                                       CDE002
     C           IRCFL     ANDEQ'Y'                                       CDE002
     C                     MOVEL'LEE0039' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                                    AR1071639
      ** Display it properly if negative.                                                  AR1071639
      *                                                                                    AR1071639
     C           RTSPL     IFLT 0                                                          AR1071639
     C                     MOVE 'Y'       WSUB    1                                        AR1071639
     C                     Z-SUBRTSPL     RTSPL                                            AR1071639
     C                     ENDIF                                                           AR1071639
      *                                                                                    AR1071639
     C                     MOVE RTSPL     ZFIELD
     C                     Z-ADD7         ZADEC
     C                     EXSR ZEDIT
      *                                                                                    AR1071639
     C           WSUB      IFEQ 'Y'                                                        AR1071639
     C                     MOVE *BLANKS   WSUB                                             AR1071639
     C                     MOVE ZFIELD    WFLD1  19                                        AR1071639
     C           WFLD1     CAT  '-'       WFLD2  20                                        AR1071639
     C                     MOVE WFLD2     SAMNT                                            AR1071639
     C                     Z-SUBRTSPL     RTSPL                                            AR1071639
     C                     ELSE                                                            AR1071639
     C                     MOVE ZFIELD    SAMNT
     C                     ENDIF                                                           AR1071639
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C                     EXSR SRDISL
     C                     ENDIF
      *
      ** Loan sub-type change
      *
     C           AMTPL     WHEQ 'LS'
     C                     MOVEL'LEE0052' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C*********************MOVE '   TO   'NAREND                                              CLE042
     C*********************MOVELWHSUTP    NAREND                                              CLE042
     C*********************MOVE SUTP      NAREND                                              CLE042
     C                     MOVE 'TO'      TONAR   9                                           CLE042
     C                     MOVELTONAR     NAREND 16                                           CLE042
     C                     MOVELWHSUTP    WKSTCL  6                                           CLE042
     C                     MOVE WHCLAS    WKSTCL                                              CLE042
     C                     MOVELWKSTCL    NAREND                                              CLE042
     C                     MOVELSUTP      WKSTCL                                              CLE042
     C                     MOVE CLAS      WKSTCL                                              CLE042
     C                     MOVE WKSTCL    NAREND                                              CLE042
     C                     MOVE NAREND    SNARR
     C                     MOVE *BLANKS   SAMNT                           153347
     C                     EXSR SRDISL
      *
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDISL  -  Displays loan amendment record                     *
      * Called by: SROUTL - Formats loan amendment record             *
      * Calls    : SRDETL - Write detail line                         *
      *****************************************************************
     C           SRDISL    BEGSR
      *
      ** Convert date
      *
     C           WOVFL     IFEQ *BLANK
      *                                                                   154221
     C                     CLEARFCALI                                     154221
     C                     CLEARFCALR                                     154221
      *                                                                   154221
      ***For*Manual*Repayments,*display*expected/scheduled*value*date*as*'Due*Date'**  242852 257301
      ***on*the*enquiry*screen.******************************************************  242852 257301
      **********                                                                       242852 257301
     C********** AMTPL     IFEQ 'MR'                                                   242852 257301
     C********** XAVDL     ANDNE0                                                      242852 257301
     C**********           MOVE '1'       *IN76                                        249397 257301
      **********                                                                       249397 257301
      ***Format*and*save*Expected*Date*for*display*later.***                           249397 257301
      **********                                                                       249397 257301
     C**********           MOVE XAVDL     ZDAYNO                                       242852 257301
     C**********           EXSR ZDATE2                                                 249397 257301
     C**********           MOVE ZADATE    WSDUD1                                       249397 257301
     C**********           ENDIF                                                       249397 257301
      **********                                                                       249397 257301
     C**********           ELSE                                                        242852 249397
     C                     Z-ADDVDATL     ZDAYNO
     C**********           ENDIF                                                       242852 249397
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SDUDT
      *
      ***Determine*date*of*input****************************                                  204544
      * If record on LOAMSDK was backvalued, use Original Entry Date                          204544
      *
     C********** VDATL     IFEQ OREDL                                                         204544
      **********                                                                       242852 257301
     C********** AMTPL     IFNE 'MR'                                                   242852 257301
     C********** VDATL     IFGE OREDL                                                204544 AR835977
     C           VDATL     IFEQ OREDL                                                       AR835977
     C           AMTPL     OREQ 'RE'                                                        AR835977
     C                     MOVE *BLANKS   SINDT
     C                     ELSE
     C                     Z-ADDOREDL     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SINDT
     C                     ENDIF
      **********                                                                       242852 257301
      ***For*Manual*Repayments,*if*Expected*Value*Date*is*not*equal*to**********       242852 257301
      ***Original*Entry*Date,*use*ORED*as*'In*Date'.*Otherise,*leave*as*blank.**       242852 257301
      **********                                                                       242852 257301
     C**********           ELSE                                                        242852 257301
      **********                                                                       242852 257301
     C********** XAVDL     IFEQ OREDL                                                  242852 257301
     C**********           MOVE *BLANKS   SINDT                                        242852 257301
     C**********           ELSE                                                        242852 257301
     C**********           Z-ADDOREDL     ZDAYNO                                       242852 257301
     C**********           EXSR ZDATE2                                                 242852 257301
     C**********           MOVE ZADATE    SINDT                                        242852 257301
     C**********           ENDIF                                                       242852 257301
      **********                                                                       242852 257301
     C**********           ENDIF                                                       242852 257301
      *                                                                   154221
      *
      ** Determine code
      *
     C                     MOVE *BLANKS   SSMSG
     C                     MOVE *BLANKS   SSGAS
     C                     SELEC
     C           AMTPL     WHEQ 'PD'
     C                     MOVE 'P'       SCODE
     C           VDATL     WHLT RUND
     C                     MOVE 'B'       SCODE
     C                     OTHER
     C                     MOVE 'F'       SCODE
     C                     ENDSL
     C                     ENDIF
      *
      ** Write detail line
      *
     C                     EXSR SRDETL
      *
      ** Determine if there are still details for the same record
      ** Only true for a 'MR' record
      *
     C********** VSLN      IFEQ 20                                                            188806
     C           VSLN      IFGE 20                                                            188806
     C           AMTPL     ANDEQ'MR'
     C           WDTL2     IFEQ *BLANK
     C           INTAL     ANDGT*ZERO
     C           WDTL3     OREQ *BLANK
     C           WTXAL     ANDGT*ZERO
     C                     MOVE 'Y'       WSAME
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRNEWI  -  Compute for new interest rate                      *
      * Called by: SRHIST - Process history record                    *
      *            SRLOAM - Process loan amendment record             *
      * Calls    : None                                               *
      *****************************************************************
     C           SRNEWI    BEGSR
      *
      ** Reflect spread to effective interest
      *
     C                     SELEC
     C           WCUSI     WHEQ 'A'
     C           WCUBR     ADD  WCUSP     WCURT
     C           WCUSI     WHEQ 'S'
     C           WCUBR     SUB  WCUSP     WCURT
     C           WCUSI     WHEQ 'P'
     C           WCUSP     DIV  100       WWORK  119
     C           WCUBR     MULT WWORK     WCURT
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRRPAY  -  Process each forward repayment                     *
      * Called by: SRHIST - Process history record                    *
      *            SRLOAM - Process loan amendment record             *
      * Calls    : SRDISI - Display interest repayment                *
      *            SRDISR - Display principal repayment               *
      *            SRINCL - Interest calculation                      *
      *****************************************************************
     C           SRRPAY    BEGSR
      *
     C/COPY WNCPYSRC,LE0212C001
      *                                                                   154221
      * If last line was end of page check to see if interest payment     154221
      * has still to be displayed. (For no history displays only.)        154221
      *                                                                   154221
     C           @NHIST    IFEQ 'Y'                                       154221
     C           @INPAY    ANDEQ'Y'                                       154221
     C           WSAME     ANDEQ'Y'                                       154221
     C**********           EXSR SRDISR                                    154221            BUG13074
     C                     EXSR SRDISI                                                      BUG13074
     C                     CLEAR@INPAY                                    154221
     C                     ENDIF                                          154221
      *                                                                   154221
      * If last line was end of page check to see if repayment of         154221
      * principal has still to be displayed.                              154221
      *                                                                   154221
     C           WSAME     IFEQ 'Y'                                       154221
      *                                                                   154221
     C           WPRAM     IFNE *ZEROS                                    154221
     C           WDTL1     ANDEQ*BLANK                                    154221
     C           NRPD      ANDLT99999                                                        BUG9240
     C           WPRWR     ANDEQ'Y'                                                          BUG9240
     C********** AUTOCL    IFEQ 'Y'                                                    218984 242909
     C                     MOVEL'LEE0028' ZAMSID                          154221
     C**********           ELSE                                                        218984 242909
     C**********           MOVEL'LEE0063' ZAMSID                                       218984 242909
     C**********           ENDIF                                                       218984 242909
     C                     EXSR SRTEXT                                    154221
     C                     MOVELZAMSTX    SNARR                           154221
     C                     Z-ADDWPRAM     ZFLD15                          154221
     C                     EXSR ZSEDIT                                    154221
     C                     MOVE ZOUT21    SAMNT                           154221
     C                     MOVE 'Y'       WDTL1                           154221
     C                     MOVE 'Y'       FCALR   1                       154221
     C                     EXSR SRDISR                                    154221
     C                     MOVE ' '       FCALR                           154221
     C                     ENDIF                                          154221
      * If last line was end of page check to see if repayment of         154221
      * interest has still to be displayed                                154221
      *                                                                   154221
      *                                                                   154221
     C           WINTA     IFNE *ZEROS                                    154221
     C           WDTL2     ANDEQ*BLANK                                    154221
     C           VSLN      ANDLT20                                        154221
     C********** NIDT      ANDLT99999                                                 BUG9240 249972
     C           WPRWR     ANDEQ'Y'                                                          BUG9240
     C                     MOVEL'LEE0029' ZAMSID                          154221
     C                     EXSR SRTEXT                                    154221
     C                     MOVELZAMSTX    SNARR                           154221
      *                                                                   159779
      ** For repayment type 3, check how much of the current interest     159779
      ** is to be paid from the repayment amount on the loan.             159779
      *                                                                   159779
     C           REPT      IFEQ 3                                         154221
     C           WCALC     SUB  WIPAID    WCURRI 150                      159779
      *                                                                   159779
     C           NCCY      IFNE *BLANK                                                        238722
     C           ZIEND     ANDGTWWRLDT                                                        238722
     C           WCURRI    IFLE NLRA                                                          238722
     C                     Z-ADDWCURRI    ZFLD15                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDNLRA      ZFLD15                                              238722
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     ELSE                                                               238722
     C           WCURRI    IFLE RAMT                                      159779
     C***********          Z-ADDWINTA     ZFLD15                   154221 159779
     C                     Z-ADDWCURRI    ZFLD15                          159779
     C                     ELSE                                           159779
     C                     Z-ADDRAMT      ZFLD15                          159779
     C                     ENDIF                                          159779
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C***********          Z-ADDWINTA     WIPAID                   154221 159779
      *                                                                                       CLE028
      ** If flat rate personal loan and add on interest is 'Y',                               CLE028
      ** total repayment amount is for principal only                                         CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADIF      ANDEQ'Y'                                                           CLE028
     C                     Z-ADDRAMT      ZFLD15                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                   154221
      ** Subtract interest only if not subtracted for this date already   154221
      *                                                                   154221
     C           ZIEND     IFNE WZIEND                                    154221
     C                     ADD  ZFLD15    WIPAID                          159779
     C***********WCALC     SUB  WIPAID    WCALC                    154221 159779
     C                     Z-ADDZIEND     WZIEND                          154221
     C                     ENDIF                                          154221
     C                     ELSE                                           154221
     C***********WCALC     SUB  WIPAID    WCALC                    154221 159779
     C           WCALC     SUB  WIPAID    ZFLD15                          159779
     C***********          Z-ADDWCALC     ZFLD15                   154221 159779
     C                     ENDIF                                          154221
     C                     EXSR ZSEDIT                                    154221
     C                     MOVE ZOUT21    SAMNT                           154221
     C           WDTL1     IFNE 'Y'                                       154221
     C                     MOVE 'Y'       WDTL1                           154221
     C                     MOVE 'Y'       WDTL2                           154221
     C                     MOVE 'Y'       FCALR                           154221
     C                     EXSR SRDISR                                    154221
     C                     MOVE ' '       FCALR                           154221
     C                     ELSE                                           154221
     C                     MOVE 'Y'       WDTL2                           154221
     C                     MOVE 'Y'       FCALR                           154221
     C                     EXSR SRDISR                                    154221
     C                     MOVE ' '       FCALR                           154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C           REPT      IFNE 3                                         154221
     C                     Z-ADDWCALC     WIPAID                          154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C                     MOVE *BLANK    WSAME                           154221
     C                     ENDIF                                          154221
      *                                                                   154221
      ***Use*External*Settlement*Indicator*set*to*Y*when************                  CLE141 CLE141A
      ***settlement*01,*07*or*08************************************                  CLE141 CLE141A
      **************************************************************                  CLE141 CLE141A
     C********** CLE141    IFEQ 'Y'                                                   CLE141 CLE141A
     C**********           MOVEL'N'       ESETIN  1                                   CLE141 CLE141A
     C********** MDST      IFEQ 01                                                    CLE141 CLE141A
     C********** MDST      OREQ 07                                                    CLE141 CLE141A
     C********** MDST      OREQ 08                                                    CLE141 CLE141A
     C**********           MOVEL'Y'       ESETIN                                      CLE141 CLE141A
     C**********           ENDIF                                                      CLE141 CLE141A
     C**********           ENDIF                                                      CLE141 CLE141A
      *
      ** Calculate for next interest date until rollover date or
      ** maturity date, if previous interest date processed
      *
     C                     MOVE *BLANK    WSAME                           132287
     C                     MOVE *BLANK    WREPT   1                       132287
     C           PSAME     IFNE 'Y'                                                         BUG13074
     C           WRPIN     IFEQ 'Y'
     C           VSLN      ANDLT20                                                           BUG4318
     C           WRIN1     IFEQ *BLANK
     C           WPRWR     ANDEQ'Y'                        if prev repay date written        BUG9240
     C***********          Z-ADDNIDT      ZDAYNO                          150965
     C           CLE005    IFEQ 'Y'                                       154221
     C                     Z-ADDW#NEXT    ZDAYNO                          150965
     C           WNEXTO    IFNE 0                                                            249835B
     C                     Z-ADDWNEXTO    ZDAYNO                                             249835B
     C                     ENDIF                                                             249835B
     C                     ELSE                                           154221
     C                     Z-ADDNIDT      ZDAYNO                          154221
     C                     ENDIF                                          154221
     C                     MOVE IPFR      ZFREQ
     C                     Z-ADDIFDY      ZMDAY
     C***********          MOVE CCY       ZCCY                            157635
      *                                                                                     MD023475
      ** Use loan currency for maturity settlement 01, 07 and 08.                           MD023475
      *                                                                                     MD023475
     C**********           MOVEL'N'       ESETIN  1                                   CLE141 CLE141A
     C           MDST      IFEQ 01                                                          MD023475
     C           MDST      OREQ 07                                                          MD023475
     C           MDST      OREQ 08                                                          MD023475
     C                     MOVE CCYCL     ZCCY                            157635
     C                     MOVE WNLOC     ZLOC
     C********** CLE141    IFEQ 'Y'                                                   CLE141 CLE141A
     C**********           MOVEL'Y'       ESETIN                                      CLE141 CLE141A
     C**********           ENDIF                                                      CLE141 CLE141A
     C                     ELSE                                                             MD023475
      *                                                                                     MD023475
      ** For all other settlement types, use Local Currency & Location                      MD023475
      *                                                                                     MD023475
     C                     MOVE BJLCCY    ZCCY                                              MD023475
     C                     MOVE BJSLCD    ZLOC                                              MD023475
     C                     ENDIF                                                            MD023475
      *
      ** If CLE005 is installed, take into consideration payment due
      ** date, thus allowing end date to fall on a holiday
      *
     C           CLE005    IFEQ 'Y'
      *                                                                   154221
      ** If rolldown restore original maturity date                       154221
      *                                                                   154221
     C           *IN09     IFEQ *ON                                       154221
     C                     Z-ADDWMYEAR    ZYEAR                           154221
     C                     Z-ADDWMMTH     ZMTH                            154221
     C                     Z-ADDWMDAY     ZDAY                            154221
     C                     ENDIF                                          154221
      *                                                                   180161
      ** If interest payment frequency is 'R', means 'at rollover' -      180161
      ** actual interest frequency and interest payment date will be      180161
      ** the same as rollover setup.                                      180161
      *                                                                   180161
     C           IPFR      IFEQ 'R'                                       180161
     C                     MOVE RLFQ      ZFREQ                           180161
     C                     Z-ADDRLDY      ZMDAY                           180161
     C                     ENDIF                                          180161
     C                     MOVE ZDAYNO    TDAYNO  50                                        AR830785
     C                     EXSR ZFRQB3
     C           ZDAYNO    IFLT TDAYNO                                                      AR830785
     C                     ADD  36525     ZDAYNO                                            AR830785
     C                     ENDIF                                                            AR830785
     C           WDTIN     IFNE 0                                         156049
     C                     Z-ADDWKYEAR    ZYEAR                           156049
     C                     ENDIF                                          156049
     C                     Z-ADDZDAYNO    W#NEXT  50                      150965
     C                     Z-ADDZDAYNO    WNEXTO  50                                         249835B
     C                     Z-ADDZDAYNO    WINDNO                          154221
     C                     Z-ADD*ZEROS    ZNRDYS
      *                                                                                       CLE141
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** ESETIN    ANDEQ'Y'                                                   CLE141 CLE141A
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM PDDI      PPAYC   1                                           CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT   50                                          CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     SELEC
     C           PDDI      WHEQ 'P'
     C                     EXSR ZBKDT
     C           PDDI      WHEQ 'N'
     C           PDDI      OREQ *BLANK
     C                     EXSR ZFWDT
     C           PDDI      WHEQ 'A'
     C                     Z-ADDZDAYNO    ZDYNBR
     C           PDDI      WHEQ 'M'                                       144089
     C                     EXSR ZDATE2                                    144089
     C           *IN98     IFEQ *OFF                                      144089
     C                     MOVE ZDATE     MMYY    40P                     144089
     C                     MOVELMMYY      MMNLCD  20P                     144089
     C                     ELSE                                           144089
     C                     MOVELZDATE     MMNLCD    P                     144089
     C                     ENDIF                                          144089
     C                     Z-ADDZDAYNO    @DAYNO  50                      144089
     C                     EXSR ZFWDT                                     144089
     C                     Z-ADDZDYNBR    ZDAYNO                          144089
     C                     EXSR ZDATE2                                    144089
     C           *IN98     IFEQ *OFF                                      144089
     C                     MOVE ZDATE     MMYY      P                     144089
     C                     MOVELMMYY      MMNWKD  20P                     144089
     C                     ELSE                                           144089
     C                     MOVELZDATE     MMNWKD    P                     144089
     C                     ENDIF                                          144089
     C           MMNLCD    IFNE MMNWKD                                    144089
     C                     Z-ADD@DAYNO    ZDAYNO                          144089
     C                     EXSR ZBKDT                                     144089
      *                                                                                      BUG9052
      ** If the next interest payment date falls on last interest                            BUG9052
      ** date computed by the system, change the next interest payment                       BUG9052
      ** date to next working day even if it is not on the same month.                       BUG9052
      *                                                                                      BUG9052
     C           ZDYNBR    IFEQ WLICD                                                        BUG9052
     C                     EXSR ZFWDT                                                        BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
     C                     ENDIF                                          144089
     C                     ENDSL
     C                     ENDIF                                                              CLE141
     C                     Z-ADDZDYNBR    WENDI
      *
      ** Also, when interest is not capitalised, compute for the date
      ** when payment is to be taken if due date, falls on a holiday
      *
     C           SCAPI     IFEQ ' NO'
     C                     Z-ADDZDYNBR    ZDAYNO
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** ESETIN    ANDEQ'Y'                                                   CLE141 CLE141A
     C           PTDI      IFEQ *BLANK                                                        CLE141
     C                     MOVEL'M'       PPAYC                                               CLE141
     C                     ELSE                                                               CLE141
     C                     MOVELPTDI      PPAYC                                               CLE141
     C                     ENDIF                                                              CLE141
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM           PPAYC                                               CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT                                               CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     SELEC
     C           PTDI      WHEQ 'P'
     C                     EXSR ZBKDT
     C           PTDI      WHEQ 'N'
     C                     EXSR ZFWDT
     C           PTDI      WHEQ 'M'                                       154221
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY    40P                     154221
     C                     MOVELMMYY      MMNLCD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNLCD    P                     154221
     C                     ENDIF                                          154221
     C                     Z-ADDZDAYNO    @DAYNO  50                      154221
     C                     EXSR ZFWDT                                     154221
     C                     Z-ADDZDYNBR    ZDAYNO                          154221
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY      P                     154221
     C                     MOVELMMYY      MMNWKD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNWKD    P                     154221
     C                     ENDIF                                          154221
     C           MMNLCD    IFNE MMNWKD                                    154221
     C                     Z-ADD@DAYNO    ZDAYNO                          154221
     C                     EXSR ZBKDT                                     154221
      *                                                                                      BUG9052
      ** If the next interest payment date falls on last interest                            BUG9052
      ** date computed by the system, change the next interest payment                       BUG9052
      ** date to next working day even if it is not on the same month.                       BUG9052
      *                                                                                      BUG9052
     C           ZDYNBR    IFEQ WLICD                                                        BUG9052
     C                     EXSR ZFWDT                                                        BUG9052
     C                     ENDIF                                                             BUG9052
      *                                                                                      BUG9052
     C                     ENDIF                                          154221
     C                     ENDSL
      *                                                                                       CLE141
     C                     ENDIF                                                              CLE141
      *                                                                   150965
     C                     Z-ADDZDYNBR    WENDI                           150965
      *                                                                   150965
      *                                                                                      BUG9052
      ** Save Next Interest Payment date                                                     BUG9052
      *                                                                                      BUG9052
     C**********           Z-ADDZDYNBR    W#NEXT                                    BUG9052 AR747510
     C                     ENDIF
      *
      ** CLE005 is not installed, next interest date calculated
      ** should fall on a working day
      *
     C                     ELSE
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** ESETIN    ANDEQ'Y'                                                   CLE141 CLE141A
     C                     EXSR ZFRQB3                                                        CLE141
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM           PPAYC                                               CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT                                               CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     EXSR ZFREQB
     C                     Z-ADD*ZEROS    ZNRDYS
     C                     EXSR ZFWDT
     C                     ENDIF                                                              CLE141
     C                     Z-ADDZDYNBR    WENDI   50
     C                     ENDIF
      *
      ** If computed date later than rollover/maturity, do not process
      *
     C           ZDYNBR    IFGT WENDT
     C           ZDYNBR    ORLT VDATS                                                       AR830785
     C/COPY WNCPYSRC,LEH00861
     C           ZFREQ     OREQ *BLANKS                                   154221
      *                                                                                      BUG9052
      ** If computed date equal to maturity date, do not process                             BUG9052
      *                                                                                      BUG9052
     C           ZDYNBR    ORGE WENDT                                                        BUG9052
     C           ZDYNBR    ANDGEMDAT                                                         BUG9052
     C           MDAT      ANDNE0                                                            BUG9052
      *                                                                                      BUG9052
     C           WENDT     OREQ 99999                                                      MD039391A
   	 C           ZDYNBR    ANDGTRLDT                                                       MD039391A
     C                     MOVE *BLANK    WFRIN
     C                     Z-ADD99999     NIDT
     C                     ELSE
     C                     Z-ADDZDYNBR    NIDT
     C/COPY WNCPYSRC,LEH00862
     C                     ENDIF
     C                     ENDIF
     C                     MOVE *BLANK    WRIN1
      *                                                                   154221
     C                     ELSE                                           154221
      *                                                                   154221
     C           NIDT      IFNE ONIDT                                     154221
      *                                                                   154221
     C                     Z-ADDNIDT      ZDYNBR                          154221
     C           SCAPI     IFEQ ' NO'                                     154221
     C                     Z-ADDZDYNBR    ZDAYNO                          154221
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** ESETIN    ANDEQ'Y'                                                   CLE141 CLE141A
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM PTDI      PPAYC                                               CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT                                               CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     SELEC                                          154221
     C           PTDI      WHEQ 'P'                                       154221
     C                     EXSR ZBKDT                                     154221
     C           PTDI      WHEQ 'N'                                       154221
     C                     EXSR ZFWDT                                     154221
     C                     ENDSL                                          154221
     C                     ENDIF                                                              CLE141
      *                                                                   154221
     C                     Z-ADDZDYNBR    NIDT                            154221
      *                                                                   154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C                     ENDIF
     C                     ENDIF                                                            BUG13074
      *
      ** Calculate for next repayment date until rollover date or
      ** maturity date, if previous repayment date processed
      *
     C                     MOVE *BLANK    WSAME                           154221
     C                     MOVE *BLANK    WREPT   1                       154221
     C           WRPPR     IFEQ 'Y'
     C           WRPR1     IFEQ *BLANK
     C           WPRWR     ANDEQ'Y'                        if prev repay date written        BUG9240
     C           CLE005    IFEQ 'Y'                                       154221
     C           W#NEXR    IFEQ 0                                                            BUG3832
     C                     Z-ADDWNRPD     W#NEXR                                             BUG3832
     C                     ENDIF                                                             BUG3832
     C                     Z-ADDW#NEXR    ZDAYNO                          154221
     C                     ELSE                                           154221
     C                     Z-ADDNRPD      ZDAYNO
     C                     ENDIF                                          154221
     C                     MOVE RFRQ      ZFREQ
     C                     Z-ADDRDYN      ZMDAY
     C***********          MOVE CCY       ZCCY                            157635
      *                                                                                     MD023475
      ** Use loan currency for maturity settlement 01, 07 and 08.                           MD023475
      *                                                                                     MD023475
     C           MDST      IFEQ 01                                                          MD023475
     C           MDST      OREQ 07                                                          MD023475
     C           MDST      OREQ 08                                                          MD023475
     C                     MOVE CCYCL     ZCCY                            157635
     C                     MOVE WNLOC     ZLOC
     C                     ELSE                                                             MD023475
      *                                                                                     MD023475
      ** for all other settlement types, use Local Currency & Location                      MD023475
      *                                                                                     MD023475
     C                     MOVE BJLCCY    ZCCY                                              MD023475
     C                     MOVE BJSLCD    ZLOC                                              MD023475
     C                     ENDIF                                                            MD023475
      *                                                                   154221
      ** If CLE005 is installed, take into consideration payment due      154221
      ** date, thus allowing end date to fall on a holiday                154221
      *                                                                   154221
     C           CLE005    IFEQ 'Y'                                       154221
     C***********          EXSR ZFREQB                                    154221
     C                     MOVE ZDAYNO    TDAYNO                                            AR830785
     C                     EXSR ZFRQB3                                    154221
     C           ZDAYNO    IFLT TDAYNO                                                      AR830785
     C                     ADD  36525     ZDAYNO                                            AR830785
     C                     ENDIF                                                            AR830785
     C                     Z-ADDZDAYNO    W#NEXR  50                      154221
     C                     Z-ADDZDAYNO    WRPDNO                          154221
     C                     Z-ADD*ZEROS    ZNRDYS
      *                                                                                       CLE141
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** ESETIN    ANDEQ'Y'                                                   CLE141 CLE141A
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM PDDI      PPAYC   1                                           CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT   50                                          CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     SELEC                                          154221
     C           PDDI      WHEQ 'P'                                       154221
     C                     EXSR ZBKDT                                     154221
     C           PDDI      WHEQ 'N'                                       154221
     C           PDDI      OREQ *BLANK                                    154221
     C                     EXSR ZFWDT                                     154221
     C           PDDI      WHEQ 'A'                                       154221
     C                     Z-ADDZDAYNO    ZDYNBR                          154221
     C           PDDI      WHEQ 'M'                                       154221
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY    40P                     154221
     C                     MOVELMMYY      MMNLCD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNLCD    P                     154221
     C                     ENDIF                                          154221
     C                     Z-ADDZDAYNO    @DAYNO  50                      154221
     C                     EXSR ZFWDT                                     154221
     C                     Z-ADDZDYNBR    ZDAYNO                          154221
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY      P                     154221
     C                     MOVELMMYY      MMNWKD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNWKD    P                     154221
     C                     ENDIF                                          154221
     C           MMNLCD    IFNE MMNWKD                                    154221
     C                     Z-ADD@DAYNO    ZDAYNO                          154221
     C                     EXSR ZBKDT                                     154221
     C                     ENDIF                                          154221
     C                     ENDSL                                          154221
      *
     C                     ENDIF                                                              CLE141
     C                     Z-ADDZDYNBR    WENDR                           154221
      *                                                                   154221
      ** Also, when interest is not capitalised, compute for the date     154221
      ** when payment is to be taken if due date, falls on a holiday      154221
      *                                                                   154221
     C           SCAPI     IFEQ ' NO'                                     154221
     C                     Z-ADDZDYNBR    ZDAYNO                          154221
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** ESETIN    ANDEQ'Y'                                                   CLE141 CLE141A
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM PTDI      PPAYC   1                                           CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT   50                                          CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     SELEC                                          154221
     C           PTDI      WHEQ 'P'                                       154221
     C                     EXSR ZBKDT                                     154221
     C           PTDI      WHEQ 'N'                                       154221
     C                     EXSR ZFWDT                                     154221
     C           PTDI      WHEQ 'M'                                       154221
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY    40P                     154221
     C                     MOVELMMYY      MMNLCD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNLCD    P                     154221
     C                     ENDIF                                          154221
     C                     Z-ADDZDAYNO    @DAYNO  50                      154221
     C                     EXSR ZFWDT                                     154221
     C                     Z-ADDZDYNBR    ZDAYNO                          154221
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY      P                     154221
     C                     MOVELMMYY      MMNWKD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNWKD    P                     154221
     C                     ENDIF                                          154221
     C           MMNLCD    IFNE MMNWKD                                    154221
     C                     Z-ADD@DAYNO    ZDAYNO                          154221
     C                     EXSR ZBKDT                                     154221
     C                     ENDIF                                          154221
     C                     ENDSL                                          154221
     C                     ENDIF                                                              CLE141
     C                     Z-ADDZDYNBR    WENDR                           154221
      *                                                                   154221
      *                                                                   154221
     C                     ENDIF                                          154221
      *                                                                   154221
      ** CLE005 is not installed, next interest date calculated           154221
      ** should fall on a working day                                     154221
      *                                                                   154221
     C                     ELSE                                           154221
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** ESETIN    ANDEQ'Y'                                                   CLE141 CLE141A
     C                     EXSR ZFRQB3                                                        CLE141
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM *BLANKS   PPAYC                                               CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT                                               CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     EXSR ZFREQB                                    154221
     C                     Z-ADD*ZEROS    ZNRDYS                          154221
     C                     EXSR ZFWDT
     C                     ENDIF                                                              CLE141
     C                     Z-ADDZDYNBR    WENDR   50                      154221
     C                     ENDIF                                          154221
     C/COPY WNCPYSRC,LEH00898
      *                                                                   154221
      ** If computed date later than rollover/maturity, do not process    154221
      *                                                                   154221
     C           ZDYNBR    IFGT WENDT
     C           ZDYNBR    ORLT VDATS                                                       AR830785
     C/COPY WNCPYSRC,LEH00863
     C           ZDYNBR    ORGE WENDT                                                         CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ZFREQ     OREQ *BLANKS                                   132287
     C           WENDT     OREQ 99999                                                      MD039391A
   	 C           ZDYNBR    ANDGTRLDT                                                       MD039391A
     C                     MOVE *BLANK    WFRPR
     C                     Z-ADD99999     NRPD
     C                     ELSE
     C                     Z-ADDZDYNBR    NRPD
     C                     MOVE *BLANK    WSUBR
     C/COPY WNCPYSRC,LEH00864
     C                     ENDIF
     C                     ENDIF
     C                     MOVE *BLANK    WRPR1
     C                     MOVE *BLANK    WDTL1
     C                     MOVE *BLANK    WDTL2
      *                                                                   154221
     C                     ELSE                                           154221
      *                                                                   154221
     C           NRPD      IFNE ONRPD                                     154221
      *                                                                   154221
     C                     Z-ADDNRPD      ZDYNBR                          154221
     C           SCAPI     IFEQ ' NO'                                     154221
     C                     Z-ADDZDYNBR    ZDAYNO                          154221
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** ESETIN    ANDEQ'Y'                                                   CLE141 CLE141A
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM PTDI      PPAYC                                               CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT                                               CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     SELEC                                          154221
     C           PTDI      WHEQ 'P'                                       154221
     C                     EXSR ZBKDT                                     154221
     C           PTDI      WHEQ 'N'                                       154221
     C                     EXSR ZFWDT                                     154221
     C                     ENDSL                                          154221
     C                     ENDIF                                                              CLE141
      *                                                                   154221
     C                     Z-ADDZDYNBR    NRPD                            154221
      *                                                                   154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C                     ENDIF
      *                                                                                       224646
      ** Display rollover details if there are any if the rollover                            224646
      ** date is less than the repayment date                                                 224646
      *                                                                                       224646
     C           CAS005    IFEQ 'Y'                                                           224646
     C           WRLDS     ANDEQ'1'                                                          BUG9240
     C           RLDT      IFLT NRPD                                                          224646
     C           RLDT      ANDLTNIDT                                                          224646
     C           RLDT      ANDNE0                                                             224646
     C           RLDT      ANDLTVDATL                                                        BUG9240
     C           RLDT      ANDLTVDATH                                                        BUG9240
     C                     EXSR SRRDAT                                                        224646
      **********                                                                      224646 BUG9240
      ***Calculate for the new interest rate to be used in the future interest        224646 BUG9240
      ***calculation                                                                  224646 BUG9240
      **********                                                                      224646 BUG9240
     C**********           MOVE NSIN      WCUSI                                       224646 BUG9240
     C**********           Z-ADDWWBRTE    WCUBR                                       224646 BUG9240
     C**********           Z-ADDNRTS      WCUSP                                       224646 BUG9240
     C********** NCAS      IFGT 0                                                     224646 BUG9240
     C**********           Z-ADDNCAS      OICBS                                       224646 BUG9240
     C**********           ENDIF                                                      224646 BUG9240
     C**********           EXSR SRNEWI                                                224646 BUG9240
     C**********           Z-ADDRLDT      WLICD                                       224646 BUG9240
     C**********           Z-ADDRLDT      WWRLDT  50                                  224646 BUG9240
      **********                                                                      224646 BUG9240
      ***Do*not*set rollover date to zero when WSAME is 'Y' to allow                  224646 BUG9240
      ***the*rollover details to be displayed to the next subfile page                224646 BUG9240
      ***if*the*current subfile page is already full.                                 224646 BUG9240
      **********                                                                      224646 BUG9240
     C********** WSAME     IFEQ 'Y'                                                   224646 BUG9240
     C**********           MOVE '0'       WROLL                                       224646 BUG9240
     C**********           ELSE                                                       224646 BUG9240
     C**********           Z-ADD0         RLDT                                        224646 BUG9240
     C**********           ENDIF                                                      224646 BUG9240
     C                     ENDIF                                                              224646
     C                     ENDIF                                                              224646
      *
      ** Process next interest date if valid and earlier than
      ** history, loan amendment and principal repayment record
      * or equal to rollover date.                                                            219500
      *
     C           PSAME     IFNE 'Y'                                                         BUG13074
     C                     MOVE *BLANK    WRPIN
     C                     ELSE                                                             BUG13074
     C                     MOVE *BLANK    PSAME                                             BUG13074
     C                     ENDIF                                                            BUG13074
     C           NIDT      IFLT WCODT
     C           WFRIN     ANDEQ'Y'
     C           NIDT      ANDLENRPD
     C           NRPD      ANDNE*ZEROS
     C           VSLN      ANDLT20                                                           BUG4318
     C           NIDT      OREQ WCODT                                                         219500
     C           NIDT      ANDEQRLDT                                                          219500
     C           WRLDS     ANDEQ'1'                                                           219500
     C           WFRIN     ANDEQ'Y'                                                           219500
     C           NIDT      ANDLENRPD                                                          219500
     C           NRPD      ANDNE*ZEROS                                                        219500
     C           VSLN      ANDLT20                                                           BUG4318
     C           *IN35     ANDEQ'0'                                                           260221
     C/COPY WNCPYSRC,LEH00865
     C********** *IN34     OREQ *ON                                                BUG12851 BUG13074
     C********** *IN37     ANDEQ*ON                                                BUG12851 BUG13074
     C********** VSLN      ANDLT20                                                 BUG12851 BUG13074
     C********** WFRIN     ANDEQ'Y'                                                BUG12851 BUG13074
     C********** NIDT      ANDLENRPD                                               BUG12851 BUG13074
     C********** NIDT      ANDLEMDAT                                               BUG12851 BUG13074
     C********** MDAT      ANDNE*ZERO                                              BUG12851 BUG13074
     C********** NIDT      OREQ 99999                                              BUG12851 BUG13074
     C           WOVFL     IFEQ *BLANK
     C                     Z-ADDNIDT      WLTDT
     C                     MOVE 'Y'       WRPIN
     C                     MOVE 'Y'       FCALI   1                       154221
     C                     Z-ADD*ZEROS    WINTR  130
      *
      ** Calculate interest until this period, yet to be paid
      *
     C           NIDT      IFNE WLASD
     C           WLASD     ANDNE*ZEROS
     C           WSTAC     ANDEQ*BLANK
      *                                                                   154221
     C                     Z-ADDWENDI     ZDAYNO                          154221
     C           SCAPI     IFEQ ' NO'                                     154221
      *                                                                   154221
     C***********          MOVE CCY       ZCCY                     154221 157635
      *                                                                                     MD039187
      ** Use loan currency for maturity settlement 01, 07 and 08.                           MD039187
      *                                                                                     MD039187
     C           MDST      IFEQ 01                                                          MD039187
     C           MDST      OREQ 07                                                          MD039187
     C           MDST      OREQ 08                                                          MD039187
     C                     MOVE CCYCL     ZCCY                            157635
     C                     MOVE WNLOC     ZLOC                            154221
     C                     ELSE                                                             MD039187
      *                                                                                     MD039187
      ** For all other settlement types, use Local Currency & Location                      MD039187
      *                                                                                     MD039187
     C                     MOVE BJLCCY    ZCCY                                              MD039187
     C                     MOVE BJSLCD    ZLOC                                              MD039187
     C                     ENDIF                                                            MD039187
      *                                                                                     MD039187
     C                     Z-ADD*ZEROS    ZNRDYS                          154221
      *                                                                   154221
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** ESETIN    ANDEQ'Y'                                                   CLE141 CLE141A
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM PTDI      PPAYC                                               CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT                                               CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     SELEC                                          154221
     C           PTDI      WHEQ 'P'                                       154221
     C                     EXSR ZBKDT                                     154221
     C           PTDI      WHEQ 'N'                                       154221
     C                     EXSR ZFWDT                                     154221
     C           PTDI      WHEQ 'M'                                       154221
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY    40P                     154221
     C                     MOVELMMYY      MMNLCD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNLCD    P                     154221
     C                     ENDIF                                          154221
     C                     Z-ADDZDAYNO    @DAYNO  50                      154221
     C                     EXSR ZFWDT                                     154221
     C                     Z-ADDZDYNBR    ZDAYNO                          154221
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY      P                     154221
     C                     MOVELMMYY      MMNWKD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNWKD    P                     154221
     C                     ENDIF                                          154221
     C           MMNLCD    IFNE MMNWKD                                    154221
     C                     Z-ADD@DAYNO    ZDAYNO                          154221
     C                     EXSR ZBKDT                                     154221
     C                     ENDIF                                          154221
     C                     ENDSL                                          154221
     C                     ENDIF                                                              CLE141
     C                     Z-ADDZDYNBR    WENDI                           154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C           PDDI      IFNE 'A'                                       154221
      *                                                                                       212308
      ** Consider manually inserted dates                                                     212308
      *                                                                                       212308
     C           PDDI      IFEQ 'M'                                                           212308
     C           WNIDT     ANDEQW#NEXT                                                        212308
     C                     Z-ADDW#NEXT    ZIEND                                               212308
     C                     ELSE                                                               212308
     C                     Z-ADDWENDI     ZIEND
     C                     ENDIF                                                              212308
     C                     ELSE                                           154221
     C                     Z-ADDW#NEXT    ZIEND                           154221
     C                     ENDIF                                          154221
     C                     Z-ADDZIEND     W78BEG                                              CLE028
     C                     Z-ADDZIEND     W78END                                              CLE028
     C                     MOVE 'R'       W78ROA                                              CLE028
     C                     EXSR SRINCL
     C/COPY WNCPYSRC,LE0212C012
     C           RDFC      IFEQ 'Y'                                       147511
     C                     ADD  ZINTR     WINCA
     C                     ELSE                                           147511
     C                     ADD  ZINTR     WINCA     H                     147511
     C                     ENDIF                                          147511
     C                     ADD  ZINTR     WCALC                           133915
     C***********          ADD  ZINTR     WIPAID                   133915 159779
     C                     ENDIF
     C           WINCA     SUB  WINPD     WINTR
     C                     ADD  WINTR     WINPD
     C                     ENDIF
      *                                                                   132287
      ** If computed interest is less than zero, do not process           132287
      *                                                                   132287
     C********** WINTR     IFLE *ZEROS                                                 132287 225344
     C********** CPAM      OREQ *ZEROS                                                 146311 225344
     C           CPAM      IFEQ *ZEROS                                                        225344
     C                     MOVE *BLANKS   WFRIN                           132287
     C                     MOVE *BLANKS   WRPIN                           132287
     C                     Z-ADD99999     NIDT                            132287
     C                     Z-ADD*ZEROS    WINTR                           146311
     C                     ELSE                                                               224646
      **********                                                                      224646 BUG9240
      ***If*there is still frequency scheduled repayments, set WRPIN                  224646 BUG9240
      ***to*'Y'*to allow for the future scheduled repayments to be displayed          224646 BUG9240
      ***eventhough a rollover is entered earlier.                                    224646 BUG9240
      **********                                                                      224646 BUG9240
     C********** CAS005    IFEQ 'Y'                                                   224646 BUG9240
     C**********           MOVE 'Y'       WRPIN                                       224646 BUG9240
     C**********           ENDIF                                                      224646 BUG9240
     C                     ENDIF                                          132287
      *
      ** Prepare to display action if selected and interest GT zero
      ** Then maintain current principal for capitalised interest
      *
     C           NIDT      IFGE WDTIN
     C           WINTR     ANDGT*ZEROS
     C           VSLN      ANDLT20                                                           BUG4318
     C           WCDIN     IFEQ *BLANK
     C           WCDIN     OREQ 'B'
     C           NIDT      ANDLTRUND
     C           WCDIN     OREQ 'F'
     C           NIDT      ANDGERUND
     C                     EXSR SRDISI
      *                                                                                      BUG9052
     C           REPT      IFEQ 2                                                            BUG9052
     C                     ADD  WINTR     WIPAID                                             BUG9052
     C                     ELSE                                                              BUG9052
     C                     ADD  ZINTR     WIPAID                          159779
     C                     ENDIF                                                             BUG9052
     C                     ENDIF
     C                     ENDIF
     C           SCAPI     IFEQ 'YES'
      *                                                                                       247791
     C           NIDT      IFEQ F#DATE                                                        247791
     C           *IN08     ANDEQ'1'                                                           247791
     C                     Z-ADDWCUPR     WCUPR                                               247791
     C                     ELSE                                                               247791
     C                     ADD  WINTR     WCUPR
     C/COPY WNCPYSRC,LEH00953
     C                     MOVE NIDT      F#DATE                                              247791
     C                     ENDIF                                                              247791
      *                                                                                       247791
     C                     ENDIF
      *
     C                     MOVE *BLANKS   FCALI                                               249160
     C                     ENDIF
      *
      ** Process next repayment date if valid and earlier than
      ** history, loan amendment and interest payment record
      ** and rollover date.                                                                   219500
      *
     C                     MOVE *BLANK    WRPPR
     C           NRPD      IFLT WCODT
     C           WFRPR     ANDEQ'Y'
     C           NRPD      ANDLENIDT
     C           NIDT      ANDNE*ZEROS
     C           VSLN      ANDLT20
     C           NRPD      OREQ WCODT                                                         219500
     C           NRPD      ANDEQRLDT                                                          219500
     C           WRLDS     ANDEQ'1'                                                           219500
     C           WFRPR     ANDEQ'Y'                                                           219500
     C           NRPD      ANDLENIDT                                                          219500
     C           NIDT      ANDNE*ZEROS                                                        219500
     C           VSLN      ANDLT20                                                            219500
     C           *IN36     ANDEQ'0'                                                           260221
     C/COPY WNCPYSRC,LEH00866
     C********** *IN34     OREQ *ON                                                BUG12851 BUG13074
     C********** *IN37     ANDEQ*ON                                                BUG12851 BUG13074
     C********** VSLN      ANDLT20                                                 BUG12851 BUG13074
     C********** WFRPR     ANDEQ'Y'                                                BUG12851 BUG13074
     C********** NRPD      ANDLENIDT                                               BUG12851 BUG13074
     C********** NIDT      ANDLEMDAT                                               BUG12851 BUG13074
     C********** MDAT      ANDNE*ZERO                                              BUG12851 BUG13074
     C********** NIDT      OREQ 99999                                              BUG12851 BUG13074
      *
     C           WOVFL     IFEQ *BLANK
     C                     MOVE 'Y'       WRPPR
     C                     Z-ADDNRPD      WLTDT
     C                     Z-ADD*ZEROS    WPRAM
     C                     Z-ADD*ZEROS    WINTA
      *
      ** Continue accruing interest
      *
     C           NRPD      IFNE WLASD
     C           WLASD     ANDNE*ZEROS
     C           WSTAC     ANDEQ*BLANK
      *                                                                   154221
     C                     Z-ADDWENDR     ZDAYNO                          154221
     C           SCAPI     IFEQ ' NO'                                     154221
      *                                                                   154221
     C***********          MOVE CCY       ZCCY                     154221 157635
      *                                                                                     MD039187
      ** Use loan currency for maturity settlement 01, 07 and 08.                           MD039187
      *                                                                                     MD039187
     C           MDST      IFEQ 01                                                          MD039187
     C           MDST      OREQ 07                                                          MD039187
     C           MDST      OREQ 08                                                          MD039187
     C                     MOVE CCYCL     ZCCY                            157635
     C                     MOVE WNLOC     ZLOC                            154221
      *                                                                                     MD039187
      ** For all other settlement types, use Local Currency & Location                      MD039187
      *                                                                                     MD039187
     C                     MOVE BJLCCY    ZCCY                                              MD039187
     C                     MOVE BJSLCD    ZLOC                                              MD039187
     C                     ENDIF                                                            MD039187
      *                                                                                     MD039187
     C                     Z-ADD*ZEROS    ZNRDYS                          154221
      *                                                                   154221
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** ESETIN    ANDEQ'Y'                                                   CLE141 CLE141A
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM PTDI      PPAYC                                               CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT                                               CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     SELEC                                          154221
     C           PTDI      WHEQ 'P'                                       154221
     C                     EXSR ZBKDT                                     154221
     C           PTDI      WHEQ 'N'                                       154221
     C                     EXSR ZFWDT                                     154221
     C           PTDI      WHEQ 'M'                                       154221
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY    40P                     154221
     C                     MOVELMMYY      MMNLCD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNLCD    P                     154221
     C                     ENDIF                                          154221
     C                     Z-ADDZDAYNO    @DAYNO  50                      154221
     C                     EXSR ZFWDT                                     154221
     C                     Z-ADDZDYNBR    ZDAYNO                          154221
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY      P                     154221
     C                     MOVELMMYY      MMNWKD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNWKD    P                     154221
     C                     ENDIF                                          154221
     C           MMNLCD    IFNE MMNWKD                                    154221
     C                     Z-ADD@DAYNO    ZDAYNO                          154221
     C                     EXSR ZBKDT                                     154221
     C                     ENDIF                                          154221
     C                     ENDSL                                          154221
     C                     ENDIF                                                              CLE141
     C                     Z-ADDZDYNBR    WENDR                           154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C           PDDI      IFNE 'A'                                       154221
     C***********          Z-ADDNRPD      ZIEND                           154221
     C**********           Z-ADDWENDR     ZIEND                                        154221 190760
     C**********           Z-ADDNRPD      ZIEND                                      190760 MD038831
     C                     Z-ADDWENDR     ZIEND                                             MD038831
     C                     ELSE                                           154221
     C                     Z-ADDW#NEXR    ZIEND                           154221
     C                     ENDIF                                          154221
     C                     Z-ADDZIEND     W78BEG                                              CLE028
     C                     Z-ADDZIEND     W78END                                              CLE028
     C                     MOVE 'R'       W78ROA                                              CLE028
     C                     EXSR SRINCL
     C           RDFC      IFEQ 'Y'                                       147511
     C                     ADD  ZINTR     WINCA
     C                     ELSE                                           147511
     C                     ADD  ZINTR     WINCA     H                     147511
     C                     ENDIF                                          147511
     C                     ADD  ZINTR     WCALC                           133915
     C***********          ADD  ZINTR     WIPAID                   133915 159779
     C                     ENDIF
      *
      ** For repayment type 2, repayment is wholly for principal
      *
     C                     SELEC
     C           REPT      WHEQ 2
      *                                                                                       238722
      ** Repayment date greater than rollover date and new currency not                       238722
      ** equal to blank                                                                       238722
      *                                                                                       238722
     C           NCCY      IFNE *BLANK                                                        238722
     C           ZIEND     ANDGTWWRLDT                                                        238722
     C           WCUPR     IFLE NLRA                                                          238722
     C                     Z-ADDWCUPR     WPRAM                                               238722
     C                     ELSE                                                               238722
     C                     Z-ADDNLRA      WPRAM                                               238722
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     ELSE                                                               238722
     C           WCUPR     IFLE RAMT                                                          188806
     C                     Z-ADDWCUPR     WPRAM                                               188806
     C                     ELSE                                                               188806
     C                     Z-ADDRAMT      WPRAM
     C                     ENDIF                                                              188806
     C                     ENDIF                                                              238722
      *
      ** For repayment types 1 and 3, compute for separate principal
      ** and interest repayments for the repayment made
      *
     C           REPT      WHEQ 1
     C           REPT      OREQ 3
     C           REPT      IFEQ 3
     C           WCALC     SUB  WIPAID    WCURRI                          159779
      *                                                                   159779
     C***********ZINTR     IFLE RAMT                                      159779
     C***********RAMT      SUB  ZINTR     WPRAM     H                     159779
     C***********          Z-ADDZINTR     WINTA                           159779
     C***********          ADD  ZINTR     WIPAID                   133915 159779
      *                                                                                       238722
     C           NCCY      IFNE *BLANK                                                        238722
     C           ZIEND     ANDGTWWRLDT                                                        238722
      *                                                                                       238722
     C           WCURRI    IFLE NLRA                                                          238722
     C           WCURRI    IFGE 0                                                             238722
     C           NLRA      SUB  WCURRI    WPRAM     H                                         238722
     C                     ELSE                                                               238722
     C                     Z-ADDNLRA      WPRAM                                               238722
     C                     ENDIF                                                              238722
     C                     Z-ADDWCURRI    WINTA                                               238722
     C                     ELSE                                                               238722
     C                     Z-ADD*ZEROS    WPRAM                                               238722
     C                     Z-ADDNLRA      WINTA                                               238722
     C                     ENDIF                                                              238722
     C                     ELSE                                                               238722
      *                                                                                       238722
     C           WCURRI    IFLE RAMT                                      159779
     C           WCURRI    IFGE 0                                                             209381
     C           RAMT      SUB  WCURRI    WPRAM     H                     159779
     C                     ELSE                                                               209381
     C                     Z-ADDRAMT      WPRAM                                               209381
     C                     ENDIF                                                              209381
     C                     Z-ADDWCURRI    WINTA                           159779
     C                     ELSE
     C                     Z-ADD*ZEROS    WPRAM
     C                     Z-ADDRAMT      WINTA
     C***********RAMT      IFEQ 0                                  154221 159779
     C***********          ADD  ZINTR     WCALC                    154221 159779
     C***********          ELSE                                    154221 159779
     C***********          ADD  ZINTR     WIPAID                   133915 159779
     C***********          ENDIF                                   154221 159779
     C                     ENDIF
     C                     ENDIF                                                              238722
      *                                                                                       209381
     C           WCUPR     IFLT WPRAM                                                         209381
     C                     Z-ADDWCUPR     WPRAM                                               209381
     C                     ENDIF                                                              209381
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADIF      IFEQ 'Y'                                                           CLE028
     C                     Z-ADDRAMT      WPRAM                                               CLE028
     C                     Z-ADD*ZEROS    WINTA                                               CLE028
     C                     ELSE                                                               CLE028
     C           RAMT      SUB  ZINTR     WPRAM     H                                         CLE028
     C                     Z-ADDZINTR     WINTA                                               CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
     C                     ELSE
      *                                                                                       238722
      ** Repayment type 1, allocate repayment amount to principal and then                    238722
      ** pay interest                                                                         238722
      *                                                                                       238722
     C           NCCY      IFNE *BLANK                                                        238722
     C           ZIEND     ANDGTWWRLDT                                                        238722
     C                     Z-ADDNLRA      WPRAM                                               238722
     C                     ELSE                                                               238722
     C                     Z-ADDRAMT      WPRAM
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     Z-ADDZINTR     WINTA
     C***********          ADD  ZINTR     WIPAID                    133915154221
     C***********          ADD  ZINTR     WCALC                    154221 159779
     C                     ENDIF
     C                     ENDSL
     C                     ENDIF
      *
      ** Prepare to display action if selected
      *
     C********** NRPD      IFGE WDTIN                                                         224764
     C           WCDIN     IFEQ *BLANK
     C           WCDIN     OREQ 'B'
     C           NRPD      ANDLTRUND
     C           WCDIN     OREQ 'F'
     C           NRPD      ANDGERUND
      *
      *** ... repayment of principal
      *
     C           WPRAM     IFNE *ZEROS
     C           WDTL1     ANDEQ*BLANK
     C********** AUTOCL    IFEQ 'Y'                                                    218984 242909
     C                     MOVEL'LEE0028' ZAMSID
     C**********           ELSE                                                        218984 242909
     C**********           MOVEL'LEE0063' ZAMSID                                       218984 242909
     C**********           ENDIF                                                       218984 242909
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDWPRAM     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL1
     C                     MOVE 'Y'       FCALR                           154221
      *                                                                                       224764
      ** Only display a forward repayment if the date of activity entered                     224764
      ** is less than the next repayment date                                                 224764
      *                                                                                       224764
     C           NRPD      IFGE WDTIN                                                         224764
     C                     EXSR SRDISR
     C                     ENDIF                                                              224764
     C                     MOVE ' '       FCALR                           154221
     C                     ENDIF
      *
      ** ... repayment of interest
      *
     C           WINTA     IFNE *ZEROS
     C           WDTL2     ANDEQ*BLANK
     C           VSLN      ANDLT20
     C                     MOVEL'LEE0029' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
      *                                                                   159779
      ** For repayment type 3, check how much of the current interest     159779
      ** is to be paid from the repayment amount on the loan.             159779
      *                                                                   159779
     C           REPT      IFEQ 3                                         154221
     C           WCALC     SUB  WIPAID    WCURRI                          159779
      *                                                                   159779
     C           NCCY      IFNE *BLANK                                                        238722
     C           ZIEND     ANDGTWWRLDT                                                        238722
     C           WCURRI    IFLE NLRA                                                          238722
     C                     Z-ADDWINTA     ZFLD15                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDNLRA      ZFLD15                                              238722
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     ELSE                                                               238722
     C           WCURRI    IFLE RAMT                                      159779
     C***********          Z-ADDWINTA     ZFLD15                          159779
     C                     Z-ADDWCURRI    ZFLD15                          159779
     C                     ELSE                                           159779
     C                     Z-ADDRAMT      ZFLD15                          159779
     C                     ENDIF                                          159779
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADIF      ANDNE'Y'                                                           CLE028
     C                     Z-ADDWINTA     ZFLD15                                              CLE028
     C                     ENDIF                                                              CLE028
     C***********          Z-ADDWINTA     WIPAID                   154221 159779
      *                                                                   154221
      ** Subtract interest only if not subtracted for this date already   154221
      *                                                                   154221
     C           ZIEND     IFNE WZIEND                                    154221
     C                     ADD  ZFLD15    WIPAID                          159779
     C***********WCALC     SUB  WIPAID    WCALC                    154221 159779
     C                     Z-ADDZIEND     WZIEND                          154221
     C                     ENDIF                                          154221
     C                     ELSE                                           154221
     C***********WCALC     SUB  WIPAID    WCALC                    154221 159779
     C           WCALC     SUB  WIPAID    ZFLD15                          159779
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     Z-ADDWINTA     ZFLD15                                              CLE028
     C                     ENDIF                                                              CLE028
     C***********          Z-ADDWCALC     ZFLD15                   154221 159779
     C                     ENDIF                                          154221
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
     C                     MOVE 'Y'       WDTL2
     C                     MOVE 'Y'       FCALR                           154221
      *                                                                                       224764
      ** Only display a forward repayment if the date of activity entered                     224764
      ** is less than the next repayment date                                                 224764
      *                                                                                       224764
     C           NRPD      IFGE WDTIN                                                         224764
     C                     EXSR SRDISR
     C                     ENDIF                                                              224764
     C                     MOVE ' '       FCALR                           154221
      *                                                                   154221
     C           REPT      IFNE 3                                         154221
     C                     Z-ADDWCALC     WIPAID                          154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C                     ENDIF
     C                     ENDIF
     C***********          ELSE                                    154221 159779
     C***********REPT      IFEQ 3                                  154221 159779
     C***********RAMT      ANDNE0                                  154221 159779
     C***********          Z-ADDWINTA     WIPAID                   154221 159779
     C***********WCALC     SUB  WIPAID    WCALC                    154221 159779
     C***********          ENDIF                                   154221 159779
     C**********           ENDIF                                                              224764
      *
      ** ... maintain current principal
      *
     C           WSUBR     IFEQ *BLANK
     C           *IN20     IFEQ '1'                                                           193701
     C           RLDT      ANDEQWENDR                                                         193701
     C                     Z-ADDWCUPR     WAMCV  130                                          193701
     C                     ENDIF                                                              193701
     C********** AUTOCL    IFEQ 'Y'                                                    218984 242909
     C                     SUB  WPRAM     WCUPR
     C/COPY WNCPYSRC,LEH00954
     C                     ADD  WINTA     WINPD
     C**********           Z-ADD0         WPRAM                                      BUG13074 249972
     C**********           ENDIF                                                       218984 242909
     C                     MOVE 'Y'       WSUBR
     C                     ENDIF
     C                     ENDIF
      *                                                                   132287
      ** Repeat process if any is still earlier than hist/loam date       132287
      *                                                                   132287
     C           VSLN      IFLT 20                                        132287
     C           NIDT      IFLT WCODT                                     132287
     C           WFRIN     ANDEQ'Y'                                       132287
     C           NRPD      ORLT WCODT                                     132287
     C           WFRPR     ANDEQ'Y'                                       132287
     C                     MOVE 'Y'       WREPT                           132287
     C                     ENDIF                                          132287
     C                     ENDIF                                          132287
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINCL  -  Interest calculation                               *
      * Called by: SRLOAN - Set up loan header details                *
      *            SRHIST - Process history records                   *
      *            SRLOAM - Process loan amendment records            *
      *            SRRPAY - Process frequency repayments              *
      * Calls    : None                                               *
      *****************************************************************
     C           SRINCL    BEGSR
      *
      ***Do*not*compute*for*interest*if*not*greater*than*0************                     AR1071639
      ****************************************************************                     AR1071639
      ** Use base rate if interest rate is zero                                            AR1068354
     C           WCURT     IFEQ *ZEROS                                                     AR1068354
     C           WCUBR     ANDNE*ZEROS                                                     AR1068354
     C**********           Z-ADDWCUBR     WCURT                                   AR1068354 MD019846
     C                     EXSR SRNEWI                                                      MD019846
     C                     ENDIF                                                           AR1068354
     C********** WCURT     IFLE *ZEROS                                                     AR1071639
     C********** CPAM      OREQ *ZEROS                             146311 188806
     C********** WCUPR     OREQ *ZEROS                                              188806 AR1071639
      *                                                                                    AR1071639
      ** Do not compute for interest is zero.                                              AR1071639
      *                                                                                    AR1071639
     C           WCURT     IFEQ *ZEROS                                                     AR1071639
     C           WCUPR     OREQ *ZEROS                                                     AR1071639
     C                     Z-ADD*ZEROS    ZINTR
     C***********          Z-ADD*ZEROS    WCALC                    146311 159779
     C***********          Z-ADD*ZEROS    WIPAID                   146311 159779
     C                     ELSE
      *
     C                     Z-ADDWLICD     ZIBEG
      *                                                                   154221
     C           PDDI      IFEQ 'A'                                       154221
     C           ZIBEG     ANDGTZIEND                                     154221
     C                     Z-ADDZIBEG     ZIEND                           154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C***********          MOVE ICBS      ZICALC                          147511
     C**********           MOVE WICBS     ZICALC                          147511              206256
     C                     MOVE OICBS     ZICALC                                              206256
     C                     Z-ADDWCUPR     ZIAMT
     C/COPY WNCPYSRC,LE0212C010
     C                     Z-ADDWCURT     ZIRATE
     C********** CAS005    IFEQ 'Y'                                                BUG12851 BUG13017
     C**********           SUB  MARG      ZIRATE                                   BUG12851 BUG13017
     C**********           ENDIF                                                   BUG12851 BUG13017
      *                                                                                       CLE028
      ** Instead of executing SR/GLINTC, process RULE78 if CLE028 is on,                      CLE028
      ** and processing type (PTYP) is 80                                                     CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     Z-ADDVDAT      W78VDT                                              CLE028
     C                     Z-ADDMDAT      W78MDT                                              CLE028
     C                     Z-ADDFLTI      W78FLT                                              CLE028
     C                     MOVE RFRQ      W78RPF                                              CLE028
     C                     Z-ADDFRPD      W78FRD                                              CLE028
     C                     Z-ADDRDYN      W78RPM                                              CLE028
     C                     MOVE CCYCL     W78CCY                                              CLE028
     C                     MOVE *BLANKS   W78LCN                                              CLE028
      *                                                                                       CLE028
     C                     EXSR RULE78                                                        CLE028
     C                     Z-ADDW78INT    ZINTR                                               CLE028
      *                                                                                       CLE028
     C                     ELSE                                                               CLE028
      *                                                                                       CLE028
     C/COPY WNCPYSRC,LE0212C006
     C                     EXSR GLINTC
     C/COPY WNCPYSRC,LEH01364
      *                                                                                       CLE028
     C                     ENDIF                                                              CLE028
      *
      ** Round down interest if required
      *
     C           RDFC      IFEQ 'Y'
     C                     Z-ADDZINTR     RDWORK 130
     C                     Z-ADDRDWORK    ZINTR
     C                     ELSE                                           169694
     C                     Z-ADDZINTR     RUWORK 130H                     169694
     C                     Z-ADDRUWORK    ZINTR                           169694
     C                     ENDIF
     C                     ENDIF                                                              252942
     C                     Z-ADDZIEND     WLICD
     C/COPY WNCPYSRC,LE0212C008
     C**********           ENDIF                                                              252942
     C/COPY WNCPYSRC,LE0212C007
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDISI  -  Display interest repayment                         *
      * Called by: SRRPAY - Process each forward repayment            *
      * Calls    : SRTEXT - Set up text from message file             *
      *            SRDETL - Write detail line                         *
      *****************************************************************
     C           SRDISI    BEGSR
      *
      ** Convert date
      *
     C                     Z-ADDNIDT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SDUDT
      *
      ** Determine date of input
      *
     C           NIDT      IFEQ LCD
     C                     MOVE *BLANKS   SINDT
     C                     ELSE
     C                     Z-ADDLCD       ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SINDT
     C                     ENDIF
      *                                                                   154221
     C           PDDI      IFNE 'A'                                       154221
     C                     MOVE *BLANKS   SINDT                           154221
     C                     ENDIF                                          154221
      *
      ** Determine narrative and amount
      *
     C           SCAPI     IFEQ 'YES'
     C                     MOVEL'LEE0017' ZAMSID
     C                     ELSE
     C                     MOVEL'LEE0016' ZAMSID
     C                     ENDIF
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SNARR
     C                     Z-ADDWINTR     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SAMNT
      *
      ** Determine code
      *
     C           NIDT      IFLT RUND
     C                     MOVE 'B'       SCODE
     C                     ELSE
     C                     MOVE 'F'       SCODE
     C                     ENDIF
      *
      ** Write detail line
      ** Prepare to write same record for rollup if the current balance
      ** is shown instead of the interest record
      *
     C                     EXSR SRDETL
     C           WOVFL     IFEQ 'Y'
     C                     MOVE 'Y'       WSAME
     C           @NHIST    IFNE 'Y'                                       154221
     C**********           MOVE *BLANK    WRPIN                                             BUG13074
     C                     MOVE 'Y'       PSAME                                             BUG13074
     C                     ELSE                                           154221
     C                     MOVE 'Y'       @INPAY  1                       154221
     C                     ENDIF                                          154221
     C                     ENDIF
     C********** VSLN      IFEQ 20                                 132287 188806
     C           VSLN      IFGE 20                                        188806
     C                     MOVE 'Y'       WSAME                           132287
     C                     ENDIF                                          132287
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDISR  -  Display a forward repayment                        *
      * Called by: SRRPAY - Process each forward repayment            *
      * Calls    : SRDETL - Write detail line                         *
      *****************************************************************
     C           SRDISR    BEGSR
      *
      ** Convert date
      *
     C                     Z-ADDNRPD      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SDUDT
     C                     MOVE ZADATE    WINDTR                          154221
      *
      ** Determine date of input
      *
     C           NRPD      IFEQ LCD
     C                     MOVE *BLANKS   SINDT
     C                     ELSE
     C                     Z-ADDLCD       ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SINDT
     C                     ENDIF
      *                                                                   154221
     C           PDDI      IFNE 'A'                                       154221
     C                     MOVE *BLANKS   SINDT                           154221
     C                     ENDIF                                          154221
      *
      ** Determine code
      *
     C           NRPD      IFLT RUND
     C                     MOVE 'B'       SCODE
     C                     ELSE
     C                     MOVE 'F'       SCODE
     C                     ENDIF
      *
      ** Write detail line
      *
     C                     EXSR SRDETL
      *
      ** Determine if interest action is yet to be output on next page
      *
     C********** VSLN      IFEQ 20                                                            188806
     C           VSLN      IFGE 20                                                            188806
     C                     MOVE 'Y'       WSAME                           132287
     C           WDTL2     IFEQ *BLANK
     C           WINTA     ANDNE*ZEROS
     C                     MOVE 'Y'       WSAME
     C                     MOVE *BLANK    WRPPR
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRDETL  -  Write subfile detail lines                         *
      * Called by: SRDISH - Displays history record                   *
      *            SRDISL - Displays loan amendment record            *
      *            SRDISR - Displays principal repayment record       *
      *            SRDISI - Displays interest repayment record        *
      * Calls    : None                                               *
      *****************************************************************
     C           SRDETL    BEGSR
      *
      ** If last line written is for current balance, do not repeat
      *
     C           WOVFL     IFEQ 'Y'
     C                     MOVE *BLANK    WOVFL
     C                     MOVE *BLANK    WSAME
     C                     ELSE
      *
      ** Write "balance as of" line on change of date and principal
      *
     C           WSVDT     IFNE SDUDT
     C           WSVBL     ANDNEWCUPR
     C           WFREC     ANDEQ*BLANK
     C           WPRWR     ANDEQ'Y'                                                           249972
     C                     MOVE WSVDT     SBLDT
     C                     Z-ADDWCUPR     ZFLD15
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SCUBL
     C                     MOVE '1'       *IN68
     C                     ADD  1         VSLN
     C                     WRITELE0212F2
     C                     MOVE '0'       *IN68
     C                     Z-ADDWCUPR     WSVBL
      *
     C********** VSLN      IFEQ 20                                                            188806
     C           VSLN      IFGE 20                                                            188806
     C                     MOVE 'Y'       WOVFL
     C                     MOVE 'Y'       WSAME
     C                     SELEC
     C           WDTL5     WHEQ 'Y'
     C                     MOVE *BLANK    WDTL5
     C           WDTL4     WHEQ 'Y'
     C                     MOVE *BLANK    WDTL4
     C           WDTL3     WHEQ 'Y'
     C                     MOVE *BLANK    WDTL3
     C           WDTL2     WHEQ 'Y'
     C                     MOVE *BLANK    WDTL2
     C           WDTL1     WHEQ 'Y'
     C                     MOVE *BLANK    WDTL1
     C                     ENDSL
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      *                                                                                      BUG9240
      ** Previous repay date indicator set to blank.                                         BUG9240
      *                                                                                      BUG9240
     C                     MOVE *BLANK    WPRWR                                              BUG9240
      *
      ** Write detail line
      *
     C********** WSKIP     IFEQ 'Y'                                                BUG12787 BUG12851
     C**********           MOVEL'Y'       WOVFL                                    BUG12787 BUG12851
     C**********           ENDIF                                                   BUG12787 BUG12851
      *                                                                   186995
      ** WOVFL should be initialised to 'Y'when VSLN is 20 to avoid       186995
      ** session device error.                                            186995
      *                                                                   186995
     C           VSLN      IFEQ 20                                        186995
     C                     MOVE 'Y'       WOVFL                           186995
     C                     ENDIF                                          186995
      *                                                                   186995
     C           WOVFL     IFEQ *BLANK
     C                     ADD  1         VSLN
      *                                                                   154221
     C                     SELEC                                          154221
     C           ZAMSID    WHEQ 'LEE0028'                                 154221
     C           ZAMSID    OREQ 'LEE0063'                                                     218984
     C                     CLEARFCALI                                     154221
     C           ZAMSID    WHEQ 'LEE0016'                                 154221
     C                     CLEARFCALR                                     154221
     C                     ENDSL                                          154221
      *                                                                   154221
      *                                                                   154221
      ** Forward repayment - principal                                    154221
      *                                                                   154221
     C           FCALR     IFEQ 'Y'                                       154221
     C           NRPD      IFNE ONRPD                                     154221
     C                     MOVE SDUDT     WRDUDT                          154221
     C                     MOVE SINDT     WRINDT                          154221
     C           PDDI      IFEQ 'A'                                       189089
     C                     Z-ADDWRPDNO    ZDAYNO                          154221
     C                     ELSE                                           189089
     C                     Z-ADDWENDR     ZDAYNO                          189089
     C                     ENDIF                                          189089
     C                     EXSR ZDATE2                                    154221
     C                     MOVE ZADATE    SDUDT                           154221
     C                     MOVE WINDTR    SINDT                           154221
     C                     CLEARFCALR                                     154221
      *                                                                   154221
      ** Forward repayment - principal (next from header)                 154221
      *                                                                   154221
     C                     ELSE                                           154221
     C                     Z-ADDONRPD     ZDAYNO                          154221
     C           SCAPI     IFEQ ' NO'                                     154221
      *                                                                   154221
     C***********          MOVE CCY       ZCCY                     154221 157635
      *                                                                                     MD039187
      ** Use loan currency for maturity settlement 01, 07 and 08.                           MD039187
      *                                                                                     MD039187
     C           MDST      IFEQ 01                                                          MD039187
     C           MDST      OREQ 07                                                          MD039187
     C           MDST      OREQ 08                                                          MD039187
     C                     MOVE CCYCL     ZCCY                            157635
     C                     MOVE WNLOC     ZLOC                            154221
     C                     ELSE                                                             MD039187
      *                                                                                     MD039187
      ** For all other settlement types, use Local Currency & Location                      MD039187
      *                                                                                     MD039187
     C                     MOVE BJLCCY    ZCCY                                              MD039187
     C                     MOVE BJSLCD    ZLOC                                              MD039187
     C                     ENDIF                                                            MD039187
      *                                                                                     MD039187
     C                     Z-ADD*ZEROS    ZNRDYS                          154221
      *                                                                   154221
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** MDST      ANDEQ01                                                    CLE141 CLE141A
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** MDST      ANDEQ07                                                    CLE141 CLE141A
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** MDST      ANDEQ08                                                    CLE141 CLE141A
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM PTDI      PPAYC   1                                           CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT   50                                          CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     SELEC                                          154221
     C           PTDI      WHEQ 'P'                                       154221
     C                     EXSR ZBKDT                                     154221
     C           PTDI      WHEQ 'N'                                       154221
     C                     EXSR ZFWDT                                     154221
     C           PTDI      WHEQ 'M'                                       154221
     C           PTDI      OREQ ' '                                                           190760
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY    40P                     154221
     C                     MOVELMMYY      MMNLCD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNLCD    P                     154221
     C                     ENDIF                                          154221
     C                     Z-ADDZDAYNO    @DAYNO  50                      154221
     C                     EXSR ZFWDT                                     154221
     C                     Z-ADDZDYNBR    ZDAYNO                          154221
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY      P                     154221
     C                     MOVELMMYY      MMNWKD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNWKD    P                     154221
     C                     ENDIF                                          154221
     C           MMNLCD    IFNE MMNWKD                                    154221
     C                     Z-ADD@DAYNO    ZDAYNO                          154221
     C                     EXSR ZBKDT                                     154221
     C                     ENDIF                                          154221
     C                     ENDSL                                          154221
     C                     ENDIF                                                              CLE141
     C                     Z-ADDZDYNBR    ZDAYNO                          154221
     C                     EXSR ZDATE2                                    154221
     C                     MOVE ZADATE    SINDT                           154221
     C                     ENDIF                                          154221
     C                     ENDIF                                          154221
     C                     ENDIF                                          154221
      *                                                                   154221
      ** Forward interest payment                                         154221
      *                                                                   154221
     C           FCALI     IFEQ 'Y'                                       154221
     C           NIDT      IFNE ONIDT                                     154221
     C                     MOVE SDUDT     WIDUDT                          154221
     C                     MOVE SINDT     WIINDT                          154221
     C           PDDI      IFEQ 'A'                                       189089
     C                     Z-ADDWINDNO    ZDAYNO                          154221
     C                     ELSE                                           189089
     C                     Z-ADDWENDI     ZDAYNO                          189089
     C                     ENDIF                                          189089
     C                     EXSR ZDATE2                                    154221
     C                     MOVE ZADATE    SDUDT                           154221
      *                                                                   154221
     C********** NIDT      IFNE 99999                                              BUG12851 BUG13074
     C                     Z-ADDNIDT      ZDAYNO                          154221
     C                     EXSR ZDATE2                                    154221
     C                     MOVE ZADATE    SINDT                           154221
     C**********           ENDIF                                                   BUG12851 BUG13074
      *                                                                   154221
     C                     CLEARFCALI                                     154221
      *                                                                   154221
      ** Forward interest payment (next from header)                      154221
      *                                                                   154221
     C                     ELSE                                           154221
     C                     Z-ADDONIDT     ZDAYNO                          154221
     C           SCAPI     IFEQ ' NO'                                     154221
      *                                                                   154221
     C***********          MOVE CCY       ZCCY                     154221 157635
      *                                                                                     MD039187
      ** Use loan currency for maturity settlement 01, 07 and 08.                           MD039187
      *                                                                                     MD039187
     C           MDST      IFEQ 01                                                          MD039187
     C           MDST      OREQ 07                                                          MD039187
     C           MDST      OREQ 08                                                          MD039187
     C                     MOVE CCYCL     ZCCY                            157635
     C                     MOVE WNLOC     ZLOC                            154221
      *                                                                                     MD039187
      ** For all other settlement types, use Local Currency & Location                      MD039187
      *                                                                                     MD039187
     C                     MOVE BJLCCY    ZCCY                                              MD039187
     C                     MOVE BJSLCD    ZLOC                                              MD039187
     C                     ENDIF                                                            MD039187
      *                                                                                     MD039187
     C                     Z-ADD*ZEROS    ZNRDYS                          154221
      *                                                                   154221
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** MDST      ANDEQ01                                                    CLE141 CLE141A
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** MDST      ANDEQ07                                                    CLE141 CLE141A
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** MDST      ANDEQ08                                                    CLE141 CLE141A
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM PTDI      PPAYC   1                                           CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT   50                                          CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     SELEC                                          154221
     C           PTDI      WHEQ 'P'                                       154221
     C                     EXSR ZBKDT                                     154221
     C           PTDI      WHEQ 'N'                                       154221
     C                     EXSR ZFWDT                                     154221
     C           PTDI      WHEQ 'M'                                       154221
     C           PTDI      OREQ ' '                                                           190760
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY    40P                     154221
     C                     MOVELMMYY      MMNLCD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNLCD    P                     154221
     C                     ENDIF                                          154221
     C                     Z-ADDZDAYNO    @DAYNO  50                      154221
     C                     EXSR ZFWDT                                     154221
     C                     Z-ADDZDYNBR    ZDAYNO                          154221
     C                     EXSR ZDATE2                                    154221
     C           *IN98     IFEQ *OFF                                      154221
     C                     MOVE ZDATE     MMYY      P                     154221
     C                     MOVELMMYY      MMNWKD  20P                     154221
     C                     ELSE                                           154221
     C                     MOVELZDATE     MMNWKD    P                     154221
     C                     ENDIF                                          154221
     C           MMNLCD    IFNE MMNWKD                                    154221
     C                     Z-ADD@DAYNO    ZDAYNO                          154221
     C                     EXSR ZBKDT                                     154221
     C                     ENDIF                                          154221
     C                     ENDSL                                          154221
     C                     ENDIF                                                              CLE141
     C                     Z-ADDZDYNBR    ZDAYNO                          154221
     C                     EXSR ZDATE2                                    154221
     C                     MOVE ZADATE    SINDT                           154221
     C                     ENDIF                                          154221
     C                     ENDIF                                          154221
     C                     ENDIF                                          154221
      *                                                                   154221
      ** Do not overwrite due date if the date has come from CLOANCL                          204544
      *                                                                                       204544
     C           FCALI     IFEQ 'Y'                                       161092
     C           @DAYNO    ANDNEONIDT                                                         204544
     C           FCALR     OREQ 'Y'                                       161092
     C           @DAYNO    ANDNEONRPD                                                         204544
     C           PDDI      IFNE 'A'                                       154221
     C           SCODE     ANDEQ'F'                                       154221
     C           SINDT     ANDNE*BLANKS                                   154221
     C                     MOVE SINDT     SDUDT                           154221
     C                     MOVE *BLANKS   SINDT                           154221
     C                     ENDIF                                          154221
     C                     ENDIF                                          161092
      *                                                                   154221
      ***For*'MR',*save*current*Due*Date*(which is the Value Date)***                  249397 257301
      ***and*display*Expected*Date*as*Due*Date.**********************                  249397 257301
      **********                                                                       249397 257301
     C********** *IN76     IFEQ *ON                                                    249397 257301
     C**********           MOVE SDUDT     WSDUD2  7                                    249397 257301
     C**********           MOVE WSDUD1    SDUDT                                        249397 257301
     C**********           ENDIF                                                       249397 257301
      **********                                                                       249397 257301
     C           SCODE     IFEQ 'B'                                                           204544
     C                     MOVE RUNA      SINDT                                               204544
     C                     ENDIF                                                              204544
      *                                                                                       204544
     C           SCODE     IFEQ 'F'                                       154221
     C           SDUDT     ANDEQSINDT                                     154221
     C                     CLEARSINDT                                     154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C           SCODE     IFEQ 'P'                                       158633
     C                     CLEARSINDT                                     158633
     C                     ENDIF                                          158633
      *                                                                   158633
     C                     WRITELE0212F2
      **********                                                                       249397 257301
      ***If*Expected*Date*was*displayed*as*Due*Date,*reset **                          249397 257301
      ***Due*Date*to*Value*Date.*****************************                          249397 257301
      **********                                                                       249397 257301
     C********** *IN76     IFEQ *ON                                                    249397 257301
     C**********           MOVE WSDUD2    SDUDT                                        249397 257301
     C**********           MOVE '0'       *IN76                                        249397 257301
     C**********           MOVE *BLANKS   WSDUD1                                       249397 257301
     C**********           MOVE *BLANKS   WSDUD2                                       249397 257301
     C**********           ENDIF                                                       249397 257301
      **********                                                                       249397 257301
     C                     MOVE 'Y'       WPRWR                                              BUG9240
     C                     MOVE SDUDT     WSVDT                           194375
      *                                                                   154221
      ** clear work fields for due date and in date                       154221
      *                                                                   154221
     C           PDDI      IFEQ 'A'                                       154221
     C           FCALR     ANDEQ'Y'                                       154221
     C           WRDUDT    IFNE *BLANKS                                   154221
     C                     MOVE WRDUDT    SDUDT                           154221
     C                     ENDIF                                          154221
     C           WRINDT    IFNE *BLANKS                                   154221
     C                     MOVE WRINDT    SINDT                           154221
     C                     ENDIF                                          154221
     C                     CLEARWRDUDT                                    154221
     C                     CLEARWRINDT                                    154221
     C                     CLEARWINDTR                                    154221
     C                     ENDIF                                          154221
      *                                                                   154221
      ** clear work fields for due date and in date                       154221
      *                                                                   154221
     C           PDDI      IFEQ 'A'                                       154221
     C           FCALI     ANDEQ'Y'                                       154221
     C           WIDUDT    IFNE *BLANKS                                   154221
     C                     MOVE WIDUDT    SDUDT                           154221
     C                     ENDIF                                          154221
     C           WIINDT    IFNE *BLANKS                                   154221
     C                     MOVE WIINDT    SINDT                           154221
     C                     ENDIF                                          154221
     C                     CLEARWIDUDT                                    154221
     C                     CLEARWIINDT                                    154221
     C                     CLEARWINDTI                                    154221
     C                     ENDIF                                          154221
      *                                                                   154221
     C**********           MOVE SDUDT     WSVDT                           194375
     C                     MOVE *BLANK    WFREC
     C                     MOVE *BLANK    WSAME
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRVALD  -  Validate screen input                              *
      * Called by: Main routine                                       *
      * Calls    : SRTEXT - Sets up text from message file            *
      *****************************************************************
     C           SRVALD    BEGSR
      *
      ** Initialise error indicators
      *
     C                     MOVE '0'       *IN29
     C                     MOVE '0'       *IN69
     C                     MOVE '0'       *IN70                                             AR816406
     C                     MOVEA'0000'    *IN,41
     C                     MOVEA'0000'    *IN,16
     C                     MOVE *BLANKS   SCMSG
     C                     MOVE *BLANKS   SEMSG
      *
      ** Right-align loan number
      *
     C**********           MOVE *BLANKS   ZFIELD                                              CLE148
     C**********           MOVE SLNIN     ZFIELD                                              CLE148
     C**********           Z-ADD0         ZADEC                                               CLE148
     C**********           Z-ADD6         ZADIG                                               CLE148
     C**********           EXSR ZALIGN                                                        CLE148
     C********** *IN99     IFEQ '1'                                                           CLE148
     C**********           MOVE '1'       *IN41                                               CLE148
     C**********           MOVE '1'       *IN44                                               CLE148
     C**********           MOVEL'LEE0003' ZAMSID                                              CLE148
     C**********           EXSR SRTEXT                                                        CLE148
     C**********           MOVELZAMSTX    SEMSG                                               CLE148
     C**********           GOTO ENDVL                                                         CLE148
     C**********           ENDIF                                                              CLE148
     C**********           MOVE ZFIELD    SLNIN                                               CLE148
      *
      ** Loan reference must exist in CLOAN
      *
     C                     MOVE 'A'       KRCDT
     C                     MOVE SLNIN     KLNRF
     C           KEYL      CHAINCLOAN                38
     C                     MOVE 'B'       KRCDT                           184903
     C           KEYL      CHAINCLOAN                38                   184903
     C           *IN38     IFEQ '1'
     C                     MOVE '1'       *IN41
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEE0003' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SEMSG
     C                     GOTO ENDVL
     C                     ENDIF
     C                     MOVE SUTP      WHSUTP                          152154
     C                     MOVE CLAS      WHCLAS                                              CLE042
      *                                                                                    AR1049090
     C           CAS5      IFEQ 'N'                                                        AR1049090
     C           RLDT      ANDGT0                                                          AR1049090
     C                     MOVE 'Y'       CAS005                                           AR1049090
     C                     ENDIF                                                           AR1049090
      *                                                                   154221
      ** Clear forward calc indicators                                    154221
      *                                                                   154221
     C                     CLEARFCALI                                     154221
     C                     CLEARFCALR                                     154221
     C                     CLEARFCALR                                     154221
     C                     CLEARWRPDNO                                    154221
      *                                                                   154221
      *
      ** Reverse image of a deleted loan
      *
     C           RECI      IFEQ 'R'
     C                     MOVE '1'       *IN29
     C                     ENDIF
      *
      ** If multibranching, check user's access to booking branch
      *
     C           MBIN      IFEQ 'Y'
     C                     CALL 'ZVBBU'
     C                     PARM BRCA      @ZBR    3
     C                     PARM           @ERR    10
     C           @ERR      IFNE 0
     C                     MOVE '1'       *IN41
     C           @ERR      IFEQ 1
     C                     MOVEL'LEE0012' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SEMSG
     C                     ENDIF
     C           @ERR      IFEQ 2
     C                     MOVEL'LEE0013' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SEMSG
     C                     ENDIF
     C                     GOTO ENDVL
     C                     ENDIF
     C                     ENDIF
      *
      ** Date if entered, must be valid
      *
     C           SDTIN     IFEQ *BLANK
     C                     MOVE 'START  ' SACST
     C                     Z-ADD*ZEROS    WDTIN   50
     C                     Z-ADD*ZEROS    ZDAYNO
     C                     ELSE
      *
     C                     MOVELSDTIN     WK70    70
     C                     MOVELWK70      WK6     6
     C           SDTIN     IFNE WK6
     C                     MOVE '1'       *IN42
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEE0004' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SEMSG
     C                     GOTO ENDVL
     C                     ENDIF
      *
     C                     MOVE SDTIN     ZDATE
     C                     MOVE SDTIN     WKYEAR                          156049
     C                     EXSR ZDATE1
     C           *IN99     IFEQ '1'
     C                     MOVE '1'       *IN42
     C                     MOVE '1'       *IN44
     C                     MOVEL'LEE0004' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SEMSG
     C                     GOTO ENDVL
     C                     ENDIF
      *
     C                     Z-ADDZDAYNO    WDTIN
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SACST
     C                     ENDIF
      *
      ** Code if entered, must be H,B,F,P
      *
     C           SCDIN     IFNE *BLANK
     C           SCDIN     ANDNE'H'
     C           SCDIN     ANDNE'P'
     C           SCDIN     ANDNE'F'
     C           SCDIN     ANDNE'B'
     C                     MOVEA'11'      *IN,43
     C                     MOVEL'LEE0005' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SEMSG
     C                     GOTO ENDVL
     C                     ENDIF
      *
      ** Validate date/code combination
      *
     C           SDTIN     IFNE *BLANKS
     C           SCDIN     IFEQ 'H'
     C           SCDIN     OREQ 'P'
     C           SCDIN     OREQ 'B'
     C           ZDAYNO    IFGE RUND
     C                     MOVEA'111'     *IN,42
     C                     MOVEL'LEE0006' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SEMSG
     C                     GOTO ENDVL
     C                     ENDIF
     C                     ENDIF
      *
     C           SCDIN     IFEQ 'F'
     C           ZDAYNO    ANDLTRUND
     C                     MOVEA'111'     *IN,42
     C                     MOVEL'LEE0006' ZAMSID
     C                     EXSR SRTEXT
     C                     MOVELZAMSTX    SEMSG
     C                     GOTO ENDVL
     C                     ENDIF
     C                     ENDIF
      *
     C           ENDVL     ENDSR
      /EJECT
      *****************************************************************
      * SRTEXT  -  Set up text from message file                      *
      * Called by: SRVALD - Validate input fields                     *
      * Calls    : None                                               *
      *****************************************************************
     C           SRTEXT    BEGSR
      *
     C                     CALL 'Y2RVMGC'
     C                     PARM *BLANKS   @RTCD
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTX132        Messge text
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRLOAN  -  Set up loan header details                         *
      * Called by: Main routine                                       *
      *            SRINIT - Initial processing                        *
      * Calls    : SRINCL - Interest calculation                      *
      *            SRORIG - Extracts original borrower details        *
      *****************************************************************
     C           SRLOAN    BEGSR
     C/COPY WNCPYSRC,LEH01379
      *
     C                     MOVE *BLANK    WSUBT   1
     C                     MOVE SLNIN     WLNIN   6
     C/COPY WNCPYSRC,LEH00952
      *
      ** Convert dates
      *
     C                     Z-ADDNRPD      ZDAYNO
     C                     Z-ADDNRPD      ONRPD                           154221
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SNRPD
      *
     C                     Z-ADDNIDT      ZDAYNO
     C                     Z-ADDNIDT      ONIDT                           154221
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SNIDT
      *
     C                     Z-ADDRLDT      ZDAYNO
     C                     Z-ADDRLDT      WWRLDT  50                                         BUG9240
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SNROD
      *                                                                                     MD031067
      ** Check if rollover on next rollover date is real a rollover.                        MD031067
      *                                                                                     MD031067
     C                     MOVE 'N'       WFXCOF  1                                         MD031067
     C           RLDT      IFNE 0                                                           MD031067
     C           FRCOK     ANDEQ'Y'                                                         MD031067
     C                     MOVE 'Y'       WFXCOF                                            MD031067
     C                     ENDIF                                                            MD031067
      *
     C           MDAT      IFEQ *ZEROS
     C                     MOVE 'AT CALL' SMDAT
     C                     ELSE
     C                     Z-ADDMDAT      ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    SMDAT
     C                     Z-ADDZYEAR     WMYEAR                          154221
     C                     Z-ADDZMTH      WMMTH                           154221
     C                     Z-ADDZDAY      WMDAY                           154221
     C                     ENDIF
      *
      ** Calculate interest to todays date, except when stop accruals
      ** indicator is on, or loan has not yet started
      *
     C                     MOVE *BLANK    WSTAC   1
     C                     TESTB'3'       LONI           27
     C           *IN27     IFEQ '1'
     C                     MOVE 'Y'       WSTAC
     C                     ENDIF
     C           WSTAC     IFEQ *BLANK
     C           VDAT      ANDLERUND
      *
      ** If loan has gone past due, add PDIN, AIAP and AIMN to get
      ** INOUT amount.  Skip calculation of interest from IACD to MDAT
      *
     C           RECI      IFEQ 'D'
     C           MDAT      ANDLTIACD
     C           MDAT      ANDNE*ZEROS
     C           AIAP      ADD  AIMN      INOUT
     C           PDIN      ADD  INOUT     INOUT
     C                     MOVE 'Y'       WSUBT
     C                     ENDIF
      *
      ** Calculate interest when outstanding principal not negative
      *
     C                     Z-ADDIACD      WLICD   50
     C                     Z-ADD0         ZINTR
     C           CPAM      IFGE *ZEROS
     C           MDAT      IFEQ *ZEROS
     C           MDAT      ORNE *ZEROS
     C           RUND      ANDLTMDAT
     C                     MOVE RUND      ZIEND
     C                     ELSE
     C                     MOVE MDAT      ZIEND
     C                     ENDIF
     C                     Z-ADDZIEND     W78END                                              CLE028
      *
      ** Adjust end date according to 'additional day indicator'
      *
     C                     Z-ADDMDAT      ZMDAT
     C***********          EXSR ZFLDC                                     143510
     C**********           Z-ADDVDAT      ZVDAT                                               245082
     C                     Z-ADDMDAT      ZMDAT                                               245082
     C                     EXSR ZFLAC
     C                     Z-ADDCPAM      WCUPR
     C                     Z-ADDINTR      WCURT
     C/COPY WNCPYSRC,LE0212C011
     C**********           Z-ADDICBS      WICBS                           147511              206256
     C                     Z-ADDICBS      OICBS                                               206256
     C                     Z-ADDVDAT      W78BEG                                              CLE028
     C                     MOVE 'A'       W78ROA                                              CLE028
     C                     EXSR SRINCL
     C                     Z-ADDZINTR     INOUT     H                                         CLE028
     C                     ENDIF
      *
      ** Calculate interest outstanding
      *
     C           CLE028    IFEQ 'N'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDNE80                                                            CLE028
     C           ZINTR     ADD  AITC      INOUT  130H
     C                     ADD  AIAP      INOUT
     C                     ADD  AIMN      INOUT
     C                     MOVE 'Y'       WSUBT
     C                     ENDIF                                                              CLE028
     C                     ENDIF
      *
     C           CLE028    IFEQ 'N'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDNE80                                                            CLE028
     C           WSUBT     IFEQ *BLANK
     C           AITC      ADD  AIAP      INOUT
     C                     ADD  AIMN      INOUT
     C                     ENDIF
     C                     ENDIF                                                              CLE028
      *
     C                     SUB  IWOD      INOUT
     C           CLE028    IFEQ 'N'                                                           CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDNE80                                                            CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADIF      ANDNE'Y'                                                           CLE028
     C                     SUB  IPRD      INOUT
     C                     ENDIF                                                              CLE028
      *                                                                                     AR583389
      ** For BV loan with capitalized interest and frequency, calculate                     AR583389
      ** the correct interest outstanding                                                   AR583389
      *                                                                                     AR583389
     C********** VDAT      IFLT RUND                                               AR583389 AR732752
     C           VDAT      IFLT ORED                                                        AR732752
     C           ORED      ANDEQRUND                                                        AR732752
     C           IPFR      ANDNE' '                                                         AR583389
     C           WSTAC     ANDEQ' '                                                         AR583389
     C                     Z-ADDVDAT      FRMDAT  50                                        AR583389
     C                     Z-ADDCPAM      FRMPR  130                                        AR583389
     C                     Z-ADDNIDT      TODAT   50                                        AR583389
     C           TODAT     IFGT RUND                                                        MD021007
     C                     Z-ADDZIEND     TODAT                                             MD021007
     C                     ENDIF                                                            MD021007
      *                                                                                     MD021007
     C                     Z-ADD0         INTRO  130                                        AR583389
     C                     MOVE *BLANK    OFLG    1                                         AR583389
      *                                                                                     AR583389
     C********** TODAT     DOWLEMDAT                                               AR583389 MD021007
     C           TODAT     DOWLEZIEND                                                       MD021007
     C                     Z-ADDFRMDAT    ZIBEG                                             AR583389
     C                     Z-ADDTODAT     ZIEND                                             AR583389
     C                     Z-ADDFRMPR     ZIAMT                                             AR583389
     C/COPY WNCPYSRC,LEH01302
     C                     EXSR GLINTC                                                      AR583389
     C/COPY WNCPYSRC,LEH01365
     C                     ADD  ZINTR     INTRO     H                                       AR583389
     C           INTC      IFEQ 'Y'                                                         AR583389
     C                     ADD  ZINTR     FRMPR     H                                       AR583389
     C                     ENDIF                                                            AR583389
      *                                                                                     AR583389
     C           OFLG      IFNE '1'                                                         AR583389
     C                     EXSR SRNXT                                                       AR583389
     C                     Z-ADDTODAT     FRMDAT                                            AR583389
     C           WENDI     IFGT MDAT                                                        AR583389
     C                     Z-ADDMDAT      TODAT                                             AR583389
     C                     MOVE '1'       OFLG                                              AR583389
     C                     ELSE                                                             AR583389
     C                     Z-ADDWENDI     TODAT                                             AR583389
     C                     ENDIF                                                            AR583389
      *                                                                                     AR583389
     C                     ELSE                                                             AR583389
     C                     LEAVE                                                            AR583389
     C                     ENDIF                                                            AR583389
      *                                                                                     AR583389
     C                     ENDDO                                                            AR583389
     C           RDFC      IFEQ 'Y'                                                         AR583389
     C                     Z-ADDINTRO     INOUT     H                                       AR583389
     C                     ELSE                                                             AR583389
     C                     Z-ADDINTRO     INOUT                                             AR583389
     C                     ENDIF                                                            AR583389
      *                                                                                     AR583389
     C                     ENDIF                                                            AR583389
      *                                                                                     AR583389
     C                     SUB  ICTD      INOUT
      *                                                                                     BUG12917
      ** Discount loan                                                                      BUG12917
      *                                                                                     BUG12917
     C           PTYP      IFEQ 63                                                          BUG12917
     C                     Z-ADD*ZEROS    INOUT                                             BUG12917
     C                     ENDIF                                                            BUG12917
      *                                                                                     BUG12917
     C                     MOVE *BLANK    WSTAC                                               209517
     C/COPY WNCPYSRC,LE0212C004
      *
      ** Get currency decimal places
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C***********          PARM CCY       K101    3                       157635
     C                     PARM CCYCL     K101    3                       157635
     C           SDCURR    PARM SDCURR    DSSDY
     C           @RTCD     IFNE *BLANKS
     C                     MOVEL'SDCURRPD'DBFILE           ************
     C***********          MOVE CCY       DBKEY            * DBERR 02 *   157635
     C                     MOVE CCYCL     DBKEY            *          *   157635
     C                     Z-ADD2         DBASE            ************
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     ELSE
     C***********          MOVE CCY       SCCY                            157635
     C***********          MOVE CCYCL     SCCY                      157635154011
     C                     Z-ADDA6NBDP    WNDEC1  10                                          193701
     C                     MOVE A6INCY    WINCY1  1                                           193701
     C                     ENDIF
      *
      ** Format amounts
      *
     C                     Z-ADDCPAM      ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SCPAM
      *
     C                     Z-ADDINOUT     ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    SINOT
      *
     C                     Z-ADDRAMT      ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVELZOUT21    ZOUT20 20
     C                     MOVE ZOUT20    SRAMT
      *
     C                     Z-ADDPWOD      ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVELZOUT21    ZOUT20
     C                     MOVE ZOUT20    SPWOD
      *
     C                     Z-ADDIWOD      ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVELZOUT21    ZOUT20
     C                     MOVE ZOUT20    SIWOD
      *
     C                     Z-ADDWTWD      ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVELZOUT21    ZOUT20
     C                     MOVE ZOUT20    SWTWD
      *                                                                                       204127
      ** Display outstanding manual adjustments                                               204127
      *                                                                                       204127
     C                     Z-ADDAIMN      ZFLD15                                              204127
     C                     Z-ADDA6NBDP    ZDECS                                               204127
     C                     MOVE 'J'       ZECODE                                              204127
     C                     EXSR ZSEDIT                                                        204127
     C                     MOVE ZOUT21    SAIMN                                               204127
      *
      ** Get client name
      *
     C                     MOVELCNUM      KEYC   10
      *****************************************************************   159255              207629
      ***If*Participations*Purchased*and*without*recourse,*display*****   159255              207629
      ** the original borrower*****************************************   159255              207629
      *****************************************************************   159255              207629
     C********** PTYP      IFEQ 64                                        159255              207629
     C********** PTYP      OREQ 65                                        159255              207629
     C********** PTYP      OREQ 68                                        159255              207629
     C********** CLE005    ANDEQ'Y'                                       159255              207629
     C********** PTYP      OREQ 71                                        159255              207629
     C********** CLE005    ANDEQ'Y'                                       159255              207629
     C********** RCSI      IFEQ 'N'                                       159255              207629
     C**********           MOVELOLNO      KEYC                            159255              207629
     C**********           ENDIF                                          159255              207629
     C**********           ENDIF                                          159255              207629
      *****************************************************************   159255              207629
     C***********          CALL 'AOCUSTR0'                                CSD007
     C                     CALL 'AOCUSTR2'                                CSD007
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           KEYC
     C                     PARM '*CNUM  ' KEYSTS  7
     C***********SDCUST    PARM SDCUST    DSSDY                           CSD007
     C           SDCUST    PARM SDCUST    DSLDY                           CSD007
      *                                                                   CSD007
     C           @RTCD     IFNE *BLANKS
     C           CSD007    ANDNE'Y'                                       CSD007
      *                                                                   CSD007
     C           @RTCD     ORNE *BLANKS                                   CSD007
     C           @RTCD     ANDEQ'*NRF   '                                 CSD007
     C           BBDTDL    ANDNE*ZEROS                                    CSD007
     C           CSD007    ANDEQ'Y'                                       CSD007
      *                                                                   CSD007
     C           @RTCD     ORNE *BLANKS                                   CSD007
     C           @RTCD     ANDNE'*NRF   '                                 CSD007
     C           CSD007    ANDEQ'Y'                                       CSD007
      *                                                                   CSD007
     C                     MOVE 'SDCUSTPD'DBFILE           ************
     C***********          MOVE CNUM      DBKEY            ************   159255
     C                     MOVELKEYC      DBKEY            * DBERR 03 *   159255
     C                     Z-ADD3         DBASE            ************
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     ELSE
     C***********          MOVE CNUM      SCNUM                           159255
     C                     MOVELKEYC      SCNUM                           159255
     C                     MOVE BBCRNM    SCRNM
     C                     ENDIF
      *
     C                     MOVE LNRF      SLNRF
     C                     MOVE BRCA      SBRCA
     C                     MOVE RDFC      SRDFC
      *
      ** Check for capitalisation
      *
     C           INTC      IFEQ 'Y'
     C                     MOVE 'YES'     SCAPI
     C                     ELSE
     C                     MOVE ' NO'     SCAPI
     C                     ENDIF
      *
      ** Check for 'Transfer from'
      *
     C********** TOLN      IFEQ *ZERO                                                         CLE148
     C           TOLN      IFEQ *BLANKS                                                       CLE148
     C                     MOVE *BLANKS   STOLN
     C                     ELSE
     C                     MOVELTOLN      STOLN
     C                     ENDIF
      *
     C                     MOVE FCUS      SFCUS
     C                     MOVELFTYP      SFTYP
     C                     MOVEL'-'       WDASH   3
     C                     MOVE FSEQ      WDASH
     C                     MOVE WDASH     SFTYP
      *
      ** Check if linked to syndicate
      *
     C                     SELEC
     C           LNKS      WHEQ 'Y'
     C                     MOVE 'YES'     SLNKS
     C           LNKS      WHEQ 'N'
     C                     MOVE ' NO'     SLNKS
     C           LNKS      WHEQ *BLANK
     C                     MOVE *BLANKS   SLNKS
     C                     ENDSL
      *
      ** Check if automatically or manually generated
      *
     C           MNSG      IFEQ 'S'
     C                     MOVE 'YES'     SMNSG
     C                     ELSE
     C                     MOVE ' NO'     SMNSG
     C                     ENDIF
      *
      ** Check if generated by assignment
      *
     C********** GASS      IFEQ 'Y'                                                           CLE106
     C           GASS      IFEQ 'A'                                                           CLE106
     C                     MOVE 'YES'     SGASS
     C                     ELSE
     C                     MOVE ' NO'     SGASS
     C                     ENDIF
      *
      ** Show other repayment details
      *
     C                     MOVE RFRQ      SRFRQ
     C                     MOVE REPT      SREPT
     C           RDYN      IFEQ *ZEROS
     C                     MOVE *BLANKS   SRDYN
     C                     ELSE
     C                     MOVE RDYN      SRDYN
     C                     ENDIF
      *
      ** Show other interest details
      *
     C                     MOVE IPFR      SIPFR
     C           IFDY      IFEQ *ZEROS
     C                     MOVE *BLANKS   SIFDY
     C                     ELSE
     C                     MOVE IFDY      SIFDY
     C                     ENDIF
      *
      ** Set up additional day indicator
      *
     C                     MOVE ADDI      SADDI
     C           RECI      IFEQ 'M'
     C                     MOVE MADDI     SADDI
     C                     ENDIF
      *                                                                   159255
      ** Set off Original borrower field                                  159255
      *                                                                   159255
     C                     MOVE *OFF      *IN57                           159255
      *
      ** Set on indicators to condition screen title for LOANS,
      ** PARTICIPATIONS PURCHASED, PARTICIPATIONS SOLD, GUARANTEES
      ** ISSUED.  Also, for parts purchased, output original borrower
      ** details if with recourse
      *
     C                     SELEC
     C           PTYP      WHEQ 61
     C           PTYP      OREQ 62
     C           PTYP      OREQ 63
     C           PTYP      OREQ 80                                                            CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C                     MOVE '1'       *IN16
      *
     C           PTYP      WHEQ 64
     C           PTYP      OREQ 65
     C           PTYP      OREQ 68
     C           CLE005    ANDEQ'Y'
     C           PTYP      OREQ 71
     C           CLE005    ANDEQ'Y'
     C                     MOVE '1'       *IN17
     C********** RCSI      IFEQ 'Y'                                                           207629
     C                     EXSR SRORIG
     C**********           ENDIF                                                              207629
      *
     C           PTYP      WHEQ 66
     C           PTYP      OREQ 67
     C           PTYP      OREQ 69
     C           CLE005    ANDEQ'Y'
     C           PTYP      OREQ 72
     C           CLE005    ANDEQ'Y'
     C                     MOVE '1'       *IN18
      *
     C           PTYP      WHEQ 70
     C                     MOVE '1'       *IN19
     C                     ENDSL
      *
      ** Determine nostro location for next date calculation
      *
      ** If CLE034 is on then check Settlement Allocations first:                             219717
      *                                                                                       219717
     C           STALCL    IFEQ 'Y'                                                           219717
     C                     EXSR SRSTAL                                                        219717
     C                     ENDIF                                                              219717
      *                                                                                       219717
     C                     MOVE *BLANKS   WNLOC
     C           MDST      IFEQ 01
     C           MDST      OREQ 02
     C           MDST      OREQ 07
     C           MDST      OREQ 08
     C           MDST      OREQ 12
     C***********          MOVE CCY       @KEYB                           157635
     C********** SCCY      IFEQ *BLANKS                                                154011 219717
     C           SCCYCL    IFEQ *BLANKS                                                       219717
     C                     MOVE CCYCL     @KEYB                           157635
     C                     ELSE                                           154011
     C**********           MOVE SCCY      @KEYB                                        154011 219717
     C                     MOVE SCCYCL    @KEYB                                               219717
     C                     END                                            154011
      *                                                                                       CLE031
      ** If CLE031 is on then use correct currency to access AONOSTR0                         CLE031
      *                                                                                       CLE031
     C           CLE031    IFEQ 'Y'                                                           CLE031
     C                     MOVE CCYCL     @KEYB                                               CLE031
     C           *IN18     IFEQ *ON                                                           CLE031
      *                                                                                       CLE031
     C           PSCYCL    IFNE *BLANKS                                                       CLE031
     C                     MOVE PSCYCL    @KEYB                                               CLE031
     C                     ENDIF                                                              CLE031
     C                     ELSE                                                               CLE031
     C           SCCYCL    IFNE *BLANKS                                                       CLE031
     C                     MOVE SCCYCL    @KEYB                                               CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     MOVELOMDA      @KEYE
     C                     CALL 'AONOSTR0'
     C                     PARM '*BLANKS' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM *BLANKS   @KEYA   6
     C                     PARM           @KEYB   3
     C**********           PARM *BLANKS   @KEYC   4                                           CGL029
     C                     PARM *BLANKS   @KEYC  10                                           CGL029
     C                     PARM *BLANKS   @KEYD   2
     C                     PARM           @KEYE   2
     C                     PARM *BLANKS   @BRCD   3
     C                     PARM *BLANKS   @CSSN  10
     C                     PARM *BLANKS   @PNOI   1
     C           SDNOST    PARM SDNOST    DSFDY
     C           @RTCD     IFEQ *BLANKS
     C**********           MOVE A7NOSN    WNLOC   2                                          CLE141A
     C                     MOVE A7NOSN    WNLOC   3                                          CLE141A
     C                     ELSE
     C                     MOVEL@KEYB     WK5     5
     C                     MOVE @KEYE     WK5
     C***********          MOVE 'SDCUSTPD'DBFILE           ************   154011
     C                     MOVE 'SDNOSTPD'DBFILE           ************   154011
     C                     MOVELWK5       DBKEY            * DBERR 04 *
     C                     Z-ADD4         DBASE            ************
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      *
      ** Initialise work fields
      *
     C                     MOVE SCDIN     WCDIN   1
     C                     MOVE *BLANKS   SLNIN
     C                     MOVE *BLANKS   SDTIN
     C                     MOVE *BLANKS   SCDIN
     C                     MOVE *BLANKS   WFRPR   1
     C                     MOVE *BLANKS   WFRIN   1
     C                     MOVE *BLANKS   WRPR1   1
     C                     MOVE *BLANKS   WRIN1   1
     C                     MOVE SPIN      WCUSI   1
     C                     Z-ADDRTSP      WCUSP  117
     C                     Z-ADDBRTE      WCUBR  117
     C           WICBS     IFEQ 0                                                            BUG9052
     C                     Z-ADDICBS      WICBS                                              BUG9052
     C                     ENDIF                                                             BUG9052
      *
      ** Determine values needed for frequency repayments
      *
     C                     Z-ADDNIDT      WNIDT   50
     C                     Z-ADDNRPD      WNRPD   50
      *                                                                                     BUG21922
     C           WRKFLD    IFEQ 'R'                                                         BUG21922
      *                                                                                     BUG21922
     C                     SELEC
     C           RLDT      WHNE *ZEROS
     C********** CAS005    ANDEQ'N'                                                    224646 246037
     C********** CAS005    ANDEQ'N'                                                 260274 MD020807A
     C           CAS5      ANDEQ'N'                                                        MD020807A
     C                     Z-ADDRLDT      WENDT   50
     C           MDAT      WHNE *ZEROS
     C                     Z-ADDMDAT      WENDT
     C                     OTHER
     C                     Z-ADD*ZEROS    WENDT
     C                     ENDSL
      *                                                                                     BUG21922
     C                     ELSE                                                             BUG21922
     C                     SELEC                                                            BUG21922
     C           RLDT      WHNE *ZEROS                                                      BUG21922
     C********** CAS005    ANDEQ'N'                                                BUG21922 MD039391
     C********** CAS5      ANDEQ'N'                                               MD039391 MD039391A
     C           CAS005    ANDEQ'N'                                                        MD039391A
     C                     Z-ADDRLDT      WENDT   50                                        BUG21922
     C           MDAT      WHNE *ZEROS                                                      BUG21922
     C                     Z-ADDMDAT      WENDT                                             BUG21922
     C                     OTHER                                                            BUG21922
     C**********           Z-ADD*ZEROS    WENDT                                   BUG21922 MD039391A
     C           RLDT      IFNE *ZEROS                                                     MD039391A
     C                     Z-ADD99999     WENDT                                            MD039391A
     C                     ENDIF
     C                     ENDSL                                                            BUG21922
     C                     ENDIF                                                            BUG21922
      *                                                                                       193701
     C                     MOVE 'B'       KRCDT                                               193701
     C           KEYL      CHAINCLOAN                38                                       193701
      ** Check if rollover is multi-currency                                                  193701
      *                                                                                       193701
     C                     MOVE '0'       *IN20                                               193701
     C           RLDT      IFNE *ZEROS                                                        193701
     C           NCCY      ANDNE*BLANK                                                        193701
     C                     MOVE '1'       *IN20                                               193701
     C                     Z-ADDFCXR      XRATE1 138                                          193701
     C                     MOVE FMDI      WMDIV1  1                                           193701
     C                     Z-ADDNFCE      XRATE2 138                                          193701
     C                     MOVE NFMD      WMDIV2  1                                           193701
     C                     ENDIF                                                              193701
      *
      ** Write loan details
      *
     C                     WRITELE0212F0
     C                     WRITELE0212F1
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRORIG  -  Extracts original borrower details                 *
      * Called by: SRLOAN - Sets up loan header details               *
      * Calls    : None                                               *
      *****************************************************************
     C           SRORIG    BEGSR
      *
     C                     MOVELOLNO      KEYC
     C***********          CALL 'AOCUSTR0'                                CSD007
     C                     CALL 'AOCUSTR2'                                CSD007
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           KEYC
     C                     PARM '*SHNAME' KEYSTS
     C***********SDCUST    PARM SDCUST    DSSDY                           CSD007
     C           SDCUST    PARM SDCUST    DSLDY                           CSD007
      *
     C           @RTCD     IFNE *BLANKS
     C           CSD007    ANDNE'Y'                                       CSD007
      *                                                                   CSD007
     C           @RTCD     ORNE *BLANKS                                   CSD007
     C           @RTCD     ANDEQ'*NRF   '                                 CSD007
     C           BBDTDL    ANDNE*ZEROS                                    CSD007
     C           CSD007    ANDEQ'Y'                                       CSD007
      *                                                                   CSD007
     C           @RTCD     ORNE *BLANKS                                   CSD007
     C           @RTCD     ANDNE'*NRF   '                                 CSD007
     C           CSD007    ANDEQ'Y'                                       CSD007
      *                                                                   CSD007
     C                     MOVE 'SDCUSTPD'DBFILE           ************
     C                     MOVE OLNO      DBKEY            * DBERR 05 *
     C                     Z-ADD5         DBASE            ************
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     ELSE
     C                     SETON                     57
     C                     MOVE OLNO      SOLNO
     C***********          MOVE BBCSSN    SCSSN                           159255
     C                     MOVELBBCRNM    SCSSN                           159255
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRCMDV  -  Standard subroutine for processing command keys    *
      * Called by: Main processing                                    *
      * Calls    : SRRETR - End of program processing                 *
      *****************************************************************
     C           SRCMDV    BEGSR
      *
     C                     MOVE *BLANK    RTNDWF  1
      *
      ** If F3 pressed, return to menu
      *
     C                     SELEC
     C           *INKC     WHEQ '1'
     C                     MOVE 'Q'       RTNDWF
     C                     EXSR SRRETR
      *
      ** If F1 pressed, return to initial enquiry
      *
     C           *INKA     WHEQ '1'
     C                     MOVE 'S'       RTNDWF
     C                     EXSR SRRETR
      *
      ** If F12 pressed, return to previous enquiry
      *
     C           *INKL     WHEQ '1'
     C                     MOVE 'U'       RTNDWF
     C                     EXSR SRRETR
      *                                                                                       CLE134
      ** If F21, call Past Due Loans Enquiry                                                  CLE134
      *                                                                                       CLE134
     C           *INKV     WHEQ *ON                                                           CLE134
     C                     CLEARD@PDUE                                                        CLE134
     C                     MOVE 'LOAN'    P@PDTP                                              CLE134
     C                     MOVE LNRF      P@LNRF                                              CLE134
     C                     MOVE LTYP      P@LTYP                                              CLE134
      *                                                                                       CLE134
     C**********           CALL 'LE0215'                                            CLE134 AR1076951
     C                     CALL 'LE000215'                                                 AR1076951
     C                     PARM *BLANKS   P@RTCD  7                                           CLE134
     C                     PARM           D@PDUE                                              CLE134
      *                                                                                       CLE134
     C           P@RTCD    IFEQ '*ERROR*'                                                     CLE134
     C                     EXSR *PSSR                                                         CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C/COPY WNCPYSRC,LEH01380
     C                     ENDSL
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRINIT  -  Initial Processing                                 *
      * Called by: Main routine                                       *
      * Calls    : SRLOAN - Set up loan header details                *
      *            SRPROC - Process each loan enquiry                 *
      *****************************************************************
     C           SRINIT    BEGSR
     C/COPY WNCPYSRC,LEH01089
      *
     C                     MOVEACPY@      BIS@   80
      *                                                                   156049
     C                     MOVE *BLANKS   DBPGM                                               219717
     C                     MOVE 'LE0212'  DBPGM                           154011
      *                                                                   154011
     C           *LIKE     DEFN ZYEAR     WKYEAR                          156049
     C           *LIKE     DEFN ZYEAR     WMYEAR                          156049
     C           *LIKE     DEFN ZMTH      WMMTH                           154221
     C           *LIKE     DEFN ZDAY      WMDAY                           154221
     C           *LIKE     DEFN SINDT     WINDTR                          154221
     C           *LIKE     DEFN SINDT     WINDTI                          154221
     C           *LIKE     DEFN SDUDT     WRDUDT                          154221
     C           *LIKE     DEFN SINDT     WRINDT                          154221
     C           *LIKE     DEFN SDUDT     WIDUDT                          154221
     C           *LIKE     DEFN SINDT     WIINDT                          154221
     C           *LIKE     DEFN ZDAYNO    WRPDNO                          154221
     C           *LIKE     DEFN ZDAYNO    WINDNO                          154221
     C           *LIKE     DEFN NRPD      ONRPD                           154221
     C           *LIKE     DEFN NIDT      ONIDT                           154221
     C           *LIKE     DEFN ZIEND     WZIEND                          154221
     C           *LIKE     DEFN INTAL     WINTAL                                              238722
     C           *LIKE     DEFN FEAML     WFEAML                                              238722
     C           *LIKE     DEFN WTXAL     WWTXAL                                              238722
     C           *LIKE     DEFN ZAMTCO    WZAMTC                                              238722
     C           *LIKE     DEFN BRTTL     WBRTT                                               239062
      *
      ** Access bank details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*DBERR ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C                     MOVE '0'       *IN98
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     ENDIF
      *
      ** Access Module Details
      *
     C                     CALL 'AOMMODR0'
     C                     PARM '*DBERR ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
      ** Access general ledger details
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD
     C                     PARM '*FIRST ' @OPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
      ** Check if SAR CLE005 is switched *ON.
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'CLE005 ' @SARD   6
     C           SCSARD    PARM SCSARD    DSFDY
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       CLE005  1
     C                     ELSE
     C                     MOVE 'N'       CLE005
     C           @RTCD     IFNE '*NRF    '
     C                     SETON                     U7U8LR
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     Z-ADD1         DBASE            * DBERR 01 *
     C                     MOVEL'CLE005  'DBKEY            ************
     C                     ENDIF
     C                     ENDIF
      *                                                                                       235907
      ** Check if Rollover Rate Fixing Day Enhancement switched on                            235907
      *                                                                                       235907
     C                     CALL 'AOSARDR0'                                                    235907
     C                     PARM *BLANKS   PRTCD                                               235907
     C                     PARM '*VERIFY' POPTN                                               235907
     C                     PARM 'CLE011'  PSARD                                               235907
      *                                                                                       235907
     C           PRTCD     IFEQ *BLANKS                                                       235907
     C                     MOVE 'Y'       CLE011  1                                           235907
     C                     ELSE                                                               235907
     C                     MOVE 'N'       CLE011                                              235907
     C           PRTCD     IFNE '*NRF   '                                                     235907
     C                     MOVEL'SCSARDPD'DBFILE                                              235907
     C                     MOVEL'CLE011'  DBKEY                                               235907
     C                     Z-ADD55        DBASE                                               235907
     C                     MOVE '1'       *INU7                                               235907
     C                     MOVE '1'       *INU8                                               235907
     C                     MOVE '1'       *INLR                                               235907
     C                     EXSR *PSSR                                                         235907
     C                     ENDIF                                                              235907
     C                     ENDIF                                                              235907
      *                                                                                       235907
      *                                                                   CDE002
      ** Access SAR details file to determine if CDE002 is switched on    CDE002
      *                                                                   CDE002
     C                     CALL 'AOSARDR0'                                CDE002
     C                     PARM *BLANKS   PRTCD   7                       CDE002
     C                     PARM '*VERIFY' POPTN   7                       CDE002
     C                     PARM 'CDE002'  PSARD   6                       CDE002
     C           SCSARD    PARM SCSARD    DSFDY                           CDE002
      *                                                                   CDE002
     C                     MOVE 'N'       CDE002  1                       CDE002
     C           PRTCD     IFEQ *BLANKS                                   CDE002
     C                     MOVE 'Y'       CDE002                          CDE002
     C                     ENDIF                                          CDE002
     C/COPY WNCPYSRC,LE0212C002
      *                                                                   187261
      ** Check if SAR CLE006 is switched *ON.                             187261
      *                                                                   187261
     C                     CALL 'AOSARDR0'                                187261
     C                     PARM *BLANKS   @RTCD                           187261
     C                     PARM '*VERIFY' @OPTN                           187261
     C                     PARM 'CLE006 ' @SARD   6                       187261
     C           SCSARD    PARM SCSARD    DSFDY                           187261
     C           @RTCD     IFEQ *BLANKS                                   187261
     C                     MOVE 'Y'       CLE006  1                       187261
     C                     MOVE *ON       *IN25                           187261
     C                     ELSE                                           187261
     C                     MOVE 'N'       CLE006                          187261
     C                     MOVE *OFF      *IN25                           187261
     C           @RTCD     IFNE '*NRF    '                                187261
     C                     SETON                     U7U8LR               187261
     C                     MOVEL'SCSARDPD'DBFILE           ************   187261
     C                     Z-ADD25        DBASE            * DBERR 25 *   187261
     C                     MOVEL'CLE006  'DBKEY            ************   187261
     C                     ENDIF                                          187261
     C                     ENDIF                                          187261
      *                                                                   187274
      ** Check if SAR CLE010 is switched *ON.                             187274
      *                                                                   187274
     C                     CALL 'AOSARDR0'                                187274
     C                     PARM *BLANKS   @RTCD                           187274
     C                     PARM '*VERIFY' @OPTN                           187274
     C                     PARM 'CLE010 ' @SARD   6                       187274
     C           SCSARD    PARM SCSARD    DSFDY                           187274
     C           @RTCD     IFEQ *BLANKS                                   187274
     C                     MOVE 'Y'       CLE010  1                       187274
     C                     MOVE *ON       *IN26                           187274
     C                     ELSE                                           187274
     C                     MOVE 'N'       CLE010                          187274
     C                     MOVE *OFF      *IN26                           187274
     C           @RTCD     IFNE '*NRF    '                                187274
     C                     SETON                     U7U8LR               187274
     C                     MOVEL'SCSARDPD'DBFILE           ************   187274
     C                     Z-ADD26        DBASE            * DBERR 26 *   187274
     C                     MOVEL'CLE010  'DBKEY            ************   187274
     C                     ENDIF                                          187274
     C                     ENDIF                                          187274
      *                                                                   CSD007
      ** Access SAR details file to check if 'Customer closing' is        CSD007
      ** installed.                                                       CSD007
      *                                                                   CSD007
     C                     MOVE 'N'       CSD007  1                       CSD007
     C                     CALL 'AOSARDR0'                                CSD007
     C                     PARM *BLANKS   @RTCD                           CSD007
     C                     PARM '*VERIFY' @OPTN                           CSD007
     C                     PARM 'CSD007'  @SARD                           CSD007
     C           SCSARD    PARM SCSARD    DSFDY                           CSD007
      *                                                                   CSD007
     C           @RTCD     IFEQ *BLANKS                                   CSD007
     C                     MOVE 'Y'       CSD007                          CSD007
     C                     ELSE                                           CSD007
     C           @RTCD     IFNE '*NRF   '                                 CSD007
     C                     MOVEL'SCSARDPD'DBFILE                          CSD007
     C                     MOVEL'CSD007'  DBKEY                           CSD007
     C                     Z-ADD6         DBASE                           CSD007
     C                     SETON                     U7U8LR               CSD007
     C                     ENDIF                                          CSD007
     C                     ENDIF                                          CSD007
      *
      ** Check if SAR CLE003 is switched *ON.                             181312
      *                                                                   181312
     C                     CALL 'AOSARDR0'                                181312
     C                     PARM *BLANKS   @RTCD                           181312
     C                     PARM '*VERIFY' @OPTN                           181312
     C                     PARM 'CLE003 ' @SARD   6                       181312
     C           SCSARD    PARM SCSARD    DSFDY                           181312
     C           @RTCD     IFEQ *BLANKS                                   181312
     C                     MOVE 'Y'       CLE003  1                       181312
     C                     ELSE                                           181312
     C                     MOVE 'N'       CLE003                          181312
     C           @RTCD     IFNE '*NRF    '                                181312
     C                     SETON                     U7U8LR               181312
     C                     MOVEL'SCSARDPD'DBFILE           ************   181312
     C                     Z-ADD6         DBASE            * DBERR 06 *   181312
     C                     MOVEL'CLE003  'DBKEY            ************   181312
     C                     ENDIF                                          181312
     C                     ENDIF                                          181312
      *                                                                   CLE014
      ** Check if SAR CLE014 is switched ON.                              CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM *BLANKS   PRTCD   7                       CLE014
     C                     PARM '*VERIFY' POPTN   7                       CLE014
     C                     PARM 'CLE014 ' PSARD   6                       CLE014
     C           SCSARD    PARM SCSARD    DSFDY                           CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C           PRTCD     IFNE '*NRF    '                                CLE014
     C                     MOVEL'SCSARDPD'DBFILE                          CLE014
     C                     Z-ADD7         DBASE                           CLE014
     C                     MOVEL'CLE014  'DBKEY                           CLE014
     C                     MOVE *ON       *INU7                           CLE014
     C                     MOVE *ON       *INU8                           CLE014
     C                     MOVE *ON       *INLR                           CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       CLE028
      ** Check whether SAR CLE028 is installed or not.                                        CLE028
      *                                                                                       CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM *BLANK    PRTCD                                               CLE028
     C                     PARM '*VERIFY' POPTN                                               CLE028
     C                     PARM 'CLE028'  PSARD                                               CLE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE028
      *                                                                                       CLE028
     C           PRTCD     IFEQ *BLANK                                                        CLE028
     C                     MOVE 'Y'       CLE028  1                                           CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE 'N'       CLE028                                              CLE028
     C           PRTCD     IFNE '*NRF   '                                                     CLE028
     C                     MOVEL'LE0212  'DBPGM     P                                         CLE028
     C                     MOVEL'SCSARDPD'DBFILE    P                                         CLE028
     C                     Z-ADD28        DBASE                                               CLE028
     C                     MOVEL'CLE028'  DBKEY     P                                         CLE028
     C                     MOVE *ON       *INU7                                               CLE028
     C                     MOVE *ON       *INU8                                               CLE028
     C                     MOVE *ON       *INLR                                               CLE028
     C                     EXSR *PSSR                                                         CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE031
      ** Check whether SAR CLE031 is installed or not.                                        CLE031
      *                                                                                       CLE031
     C                     CALL 'AOSARDR0'                                                    CLE031
     C                     PARM *BLANK    @RTCD   7                                           CLE031
     C                     PARM '*VERIFY' @OPTN   7                                           CLE031
     C                     PARM 'CLE031'  WSARD   6                                           CLE031
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE031
      *                                                                                       CLE031
     C           @RTCD     IFEQ *BLANK                                                        CLE031
     C                     MOVE 'Y'       CLE031  1                                           CLE031
     C                     ELSE                                                               CLE031
     C                     MOVE 'N'       CLE031                                              CLE031
     C           @RTCD     IFNE '*NRF   '                                                     CLE031
     C                     MOVEL'LE0212  'DBPGM                                               CLE031
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE031
     C                     Z-ADD8         DBASE                                               CLE031
     C                     MOVEL'CLE031'  DBKEY                                               CLE031
     C                     EXSR *PSSR                                                         CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       CLE031
     C                     ENDIF                                                              CLE031
      *                                                                                       219717
      ** Check whether SAR CLE034 is installed or not.                                        219717
      *                                                                                       219717
     C                     CALL 'AOSARDR0'                                                    219717
     C                     PARM *BLANK    @RTCD   7                                           219717
     C                     PARM '*VERIFY' @OPTN   7                                           219717
     C                     PARM 'CLE034'  WSARD   6                                           219717
     C           SCSARD    PARM SCSARD    DSFDY                                               219717
      *                                                                                       219717
     C           @RTCD     IFEQ *BLANK                                                        219717
     C                     MOVE 'Y'       CLE034  1                                           219717
     C                     ELSE                                                               219717
     C                     MOVE 'N'       CLE034                                              219717
     C           @RTCD     IFNE '*NRF   '                                                     219717
     C                     MOVEL'LE0212  'DBPGM                                               219717
     C                     MOVEL'SCSARDPD'DBFILE                                              219717
     C                     Z-ADD9         DBASE                                               219717
     C                     MOVEL'CLE034'  DBKEY                                               219717
     C                     EXSR *PSSR                                                         219717
     C                     ENDIF                                                              219717
      *                                                                                       219717
     C                     ENDIF                                                              219717
      *                                                                                       224646
      ** Check if SAR CAS005 is switched ON.                                                  224646
      *                                                                                       224646
     C                     CALL 'AOSARDR0'                                                    224646
     C                     PARM *BLANKS   PRTCD                                               224646
     C                     PARM '*VERIFY' POPTN                                               224646
     C                     PARM 'CAS005 ' PSARD                                               224646
     C           SCSARD    PARM SCSARD    DSFDY                                               224646
     C           PRTCD     IFEQ *BLANKS                                                       224646
     C                     MOVE 'Y'       CAS005  1                                           224646
     C                     MOVE 'Y'       CAS5    1                                        AR1049090
     C                     ELSE                                                               224646
     C                     MOVE 'N'       CAS005                                              224646
     C                     MOVE 'N'       CAS5                                             AR1049090
     C           PRTCD     IFNE '*NRF    '                                                    224646
     C                     MOVEL'SCSARDPD'DBFILE                                              224646
     C                     Z-ADD7         DBASE                                               224646
     C                     MOVEL'CAS005  'DBKEY                                               224646
     C                     MOVE *ON       *INU7                                               224646
     C                     MOVE *ON       *INU8                                               224646
     C                     MOVE *ON       *INLR                                               224646
     C                     EXSR *PSSR                                                         224646
     C                     ENDIF                                                              224646
     C                     ENDIF                                                              224646
      *                                                                                       CLE036
      ** Check whether CLE036 is installed or not.                                            CLE036
      *                                                                                       CLE036
     C                     CALL 'AOSARDR0'                                                    CLE036
     C                     PARM *BLANK    @RTCD                                               CLE036
     C                     PARM '*VERIFY' @OPTN                                               CLE036
     C                     PARM 'CLE036'  WSARD                                               CLE036
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE036
      *                                                                                       CLE036
     C           @RTCD     IFEQ *BLANK                                                        CLE036
     C                     MOVE 'Y'       CLE036  1                                           CLE036
     C                     ELSE                                                               CLE036
     C                     MOVE 'N'       CLE036                                              CLE036
     C           @RTCD     IFNE '*NRF   '                                                     CLE036
     C                     MOVEL'LE0212  'DBPGM                                               CLE036
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE036
     C                     Z-ADD10        DBASE                                               CLE036
     C                     MOVEL'CLE036'  DBKEY                                               CLE036
     C                     EXSR *PSSR                                                         CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE134
      ** Check whether CLE134 is installed or not.                                            CLE134
      *                                                                                       CLE134
     C                     CALL 'AOSARDR0'                                                    CLE134
     C                     PARM *BLANK    @RTCD                                               CLE134
     C                     PARM '*VERIFY' @OPTN                                               CLE134
     C                     PARM 'CLE134'  WSARD                                               CLE134
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE134
      *                                                                                       CLE134
     C           @RTCD     IFEQ *BLANK                                                        CLE134
     C                     MOVE 'Y'       CLE134  1                                           CLE134
     C                     MOVE *ON       *IN45                                               CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE 'N'       CLE134                                              CLE134
     C                     MOVE *OFF      *IN45                                               CLE134
     C           @RTCD     IFNE '*NRF   '                                                     CLE134
     C                     MOVEL'LE0212  'DBPGM                                               CLE134
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE134
     C                     Z-ADD11        DBASE                                               CLE134
     C                     MOVEL'CLE134'  DBKEY                                               CLE134
     C                     EXSR *PSSR                                                         CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE141
      ** Check if CLE141 is installed                                                         CLE141
      *                                                                                       CLE141
     C                     CALL 'AOSARDR0'                                                    CLE141
     C                     PARM *BLANK    @RTCD                                               CLE141
     C                     PARM '*VERIFY' @OPTN                                               CLE141
     C                     PARM 'CLE141'  WSARD                                               CLE141
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE141
      *                                                                                       CLE141
     C           @RTCD     IFEQ *BLANK                                                        CLE141
     C                     MOVE 'Y'       CLE141  1                                           CLE141
     C                     ELSE                                                               CLE141
     C                     MOVE 'N'       CLE141                                              CLE141
     C                     ENDIF                                                              CLE141
      *                                                                                       CLE154
      ** Check whether CLE154 is installed or not.                                            CLE154
      *                                                                                       CLE154
     C                     CALL 'AOSARDR0'                                                    CLE154
     C                     PARM *BLANK    @RTCD                                               CLE154
     C                     PARM '*VERIFY' @OPTN                                               CLE154
     C                     PARM 'CLE154'  WSARD                                               CLE154
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE154
      *                                                                                       CLE154
     C           @RTCD     IFEQ *BLANK                                                        CLE154
     C                     MOVE 'Y'       CLE154  1                                           CLE154
     C                     ELSE                                                               CLE154
     C                     MOVE 'N'       CLE154                                              CLE154
     C           @RTCD     IFNE '*NRF   '                                                     CLE154
     C                     MOVEL'LE0212  'DBPGM                                               CLE154
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE154
     C                     Z-ADD12        DBASE                                               CLE154
     C                     MOVEL'CLE154'  DBKEY                                               CLE154
     C                     EXSR *PSSR                                                         CLE154
     C                     ENDIF                                                              CLE154
      *                                                                                       CLE154
     C                     ENDIF                                                              CLE154
     C/COPY WNCPYSRC,LE0212C005
      *                                                                   181312
      ** Define data structures RUNDAT and EM linked enquiry
      *
     C           *NAMVAR   DEFN RUNDAT    RUNDT
     C                     IN   RUNDT
      *
     C           *NAMVAR   DEFN           EMSDS
     C           *LOCK     IN   EMSDS
     C                     MOVE RQDTD     MODID   2
     C                     OUT  EMSDS
     C/COPY WNCPYSRC,LEH01381
      *
      ** Check the multibranching indicator to protect and non-display
      ** the branch field for a single branch system
      *
     C                     MOVE '1'       *IN12
     C           MBIN      IFEQ 'Y'
     C                     MOVE '0'       *IN12
     C                     ENDIF
      *
      ** If U1 on then MATURED LOANS ACTIVITY ENQUIRY                                         190005
      *                                                                                       190005
     C           *INU1     IFEQ *ON                                                           190005
     C                     MOVE *ON       *IN77                                               190005
     C                     ELSE                                                               190005
     C                     MOVE *OFF      *IN77                                               190005
     C                     END                                                                190005
      *                                                                                       190005
      ** Keys for history and loan files
      *
     C           KEYH      KLIST
     C                     KFLD           BRCA
     C                     KFLD           CNUM
     C                     KFLD           LNRF
      *
     C           KEYL      KLIST
     C**********           KFLD           KLNRF   60                                          CLE148
     C                     KFLD           KLNRF   6                                           CLE148
     C                     KFLD           KRCDT   1
      *                                                                                       CLE134
     C           KPDUE4    KLIST                                                              CLE134
     C                     KFLD           KYBRCA                                              CLE134
     C                     KFLD           KYPLON                                              CLE134
     C                     KFLD           KYPDCT                                              CLE134
     C                     KFLD           KYPDVD                                              CLE134
     C                     KFLD           KYPOSQ                                              CLE134
      *                                                                                       CLE134
     C           KPDU4A    KLIST                                                              CLE134
     C                     KFLD           KYBRCA                                              CLE134
     C                     KFLD           KYPLON                                              CLE134
     C                     KFLD           KYPDCT                                              CLE134
     C                     KFLD           KYPDVD                                              CLE134
      *                                                                                       CLE134
     C           KPDUE7    KLIST                                                              CLE134
     C                     KFLD           KYRECI                                              CLE134
     C                     KFLD           KYPORG                                              CLE134
     C                     KFLD           KYPDCT                                              CLE134
      *                                                                                       CLE134
     C           KPDUE6    KLIST                                                              CLE134
     C                     KFLD           KYRECI                                              CLE134
     C                     KFLD           KYPLON                                              CLE134
     C                     KFLD           KYPDCT                                              CLE134
      *                                                                                       CLE134
     C           KPDU6A    KLIST                                                              263418
     C                     KFLD           KYBRCA                                              263418
     C                     KFLD           KYPLON                                              263418
     C                     KFLD           KYPDVD                                              263418
      *                                                                                       263418
     C           KPDUEA    KLIST                                                              263418
     C                     KFLD           KYRECI                                              263418
     C                     KFLD           KYPLON                                              263418
      *                                                                                       263418
     C           *LIKE     DEFN YBRCA     KYBRCA                                              CLE134
     C           *LIKE     DEFN YPDCT     KYPDCT                                              CLE134
     C           *LIKE     DEFN YPDVDT    KYPDVD                                              CLE134
     C           *LIKE     DEFN YPLON     KYPLON                                              CLE134
     C           *LIKE     DEFN YPORG     KYPORG                                              CLE134
     C           *LIKE     DEFN YPOSEQ    KYPOSQ                                              CLE134
     C           *LIKE     DEFN YRECI     KYRECI                                              CLE134
     C           *LIKE     DEFN YLCD      KYLCD                                             AR728070
     C/COPY WNCPYSRC,LEH01382
      *
     C                     MOVE *BLANK    WEXIT   1
     C                     MOVEL'LERMSGF 'ZAMSGF
      *
      ** If program has been called from a linked enquiry, set up loan
      ** reference and date activity from parameters
      *
     C           MODID     IFEQ 'LE'
     C                     MOVELLOANNO    SLNIN
     C                     MOVE *BLANKS   SDTIN
     C                     MOVE *BLANKS   SCDIN
     C                     MOVE '1'       *IN15
     C                     MOVE '1'       *IN69
     C                     MOVE '1'       *IN70                                             AR816406
     C                     MOVE 'A'       KRCDT
     C                     MOVE SLNIN     KLNRF
     C           KEYL      CHAINCLOAN                38
     C                     MOVE 'B'       KRCDT                           184903
     C           KEYL      CHAINCLOAN                38                   184903
     C                     MOVE SUTP      WHSUTP                          152154
     C                     MOVE CLAS      WHCLAS                                              CLE042
     C                     MOVE 'START  ' SACST
     C/COPY WNCPYSRC,LEH00924
     C                     EXSR SRLOAN
     C                     EXSR SRPROC
      *
      ** Not from linked enquiry, display first screen
      *
     C                     ELSE
     C                     MOVE '0'       *IN15
     C                     MOVE '0'       *IN69
     C           *INU1     IFEQ *ON                                                           190005
     C                     MOVE '1'       *IN69                                               190005
     C                     END                                                                190005
     C                     WRITELE0212F0
     C                     ENDIF
      *                                                                                       243394
      ** CHECK SYSTEM VALUE: Add Past Due Interest in Calculated                              243394
      ** Maturity Interest.                                                                   243394
      *                                                                                       243394
      ** Set up AOSVALR0 parameter with GISVAL "AddPastDueIntrInLOAC"                         243394
     C                     MOVE *BLANKS   WPARM                                               243394
     C                     MOVEL'AddPa'   WPARM1                                              243394
     C                     MOVEL'stDue'   WPARM2                                              243394
     C                     MOVEL'IntrI'   WPARM3                                              243394
     C                     MOVEL'nLOAC'   WPARM4                                              243394
     C                     MOVELWPARM     SVALK1                                              243394
      * Call Access object:                                                                   243394
     C                     CALL 'AOSVALR0'                                                    243394
     C                     PARM           RTNCDE  7                                           243394
     C                     PARM           SVALK1 20                                           243394
     C                     PARM           SVAL1 200                                           243394
     C                     PARM           SVALK2 20                                           243394
     C                     PARM           SVAL2 200                                           243394
     C                     PARM           SVALK3 20                                           243394
     C                     PARM           SVAL3 200                                           243394
     C                     PARM           SVALK4 20                                           243394
     C                     PARM           SVAL4 200                                           243394
     C                     PARM           SVALK5 20                                           243394
     C                     PARM           SVAL5 200                                           243394
     C                     PARM           SVALK6 20                                           243394
     C                     PARM           SVAL6 200                                           243394
     C                     PARM           SVALK7 20                                           243394
     C                     PARM           SVAL7 200                                           243394
     C                     PARM           SVALK8 20                                           243394
     C                     PARM           SVAL8 200                                           243394
     C                     PARM           SVALK9 20                                           243394
     C                     PARM           SVAL9 200                                           243394
     C                     PARM           SVALK0 20                                           243394
     C                     PARM           SVAL10200                                           243394
      * If the system value is not found then issue a database error                          243394
     C           RTNCDE    IFNE '        '                                                    243394
     C                     SETON                     U7U8                                     243394
     C                     MOVEL'SDSVALPD'DBFILE           ************                       243394
     C                     Z-ADD56        DBASE            * DBERR 56 *                       243394
     C                     MOVEL'SVALK1'  DBKEY            ************                       243394
     C                     MOVE '1'       *INU7                                               243394
     C                     MOVE '1'       *INU8                                               243394
     C                     MOVE '1'       *INLR                                               243394
     C                     EXSR *PSSR                                                         243394
     C                     ELSE                                                               243394
      * Isolate the first character of SVAL1 which is either 'Y' or 'N'.                      243394
     C                     MOVELSVAL1     WRK01   1        1 character fld                    243394
     C           WRK01     IFEQ 'Y'                                                           243394
     C                     MOVE 'Y'       ADDPDI  1                                           243394
     C                     ELSE                                                               243394
     C                     MOVE 'N'       ADDPDI                                              243394
     C                     ENDIF                                                              243394
     C                     ENDIF                                                              243394
      *                                                                                     BUG21922
      ** Check System Value if Loan Activity Enquiry will display                           BUG21922
      ** until Rollover or Maturity                                                         BUG21922
      *                                                                                     BUG21922
      ** Set up AOSVALR0 parameter with GISVAL "LoanRolloverMaturity"                       BUG21922
      *                                                                                     BUG21922
     C                     MOVE *BLANKS   WPARM                                             BUG21922
     C                     MOVEL'LoanR'   WPARM1                                            BUG21922
     C                     MOVEL'ollov'   WPARM2                                            BUG21922
     C                     MOVEL'erMat'   WPARM3                                            BUG21922
     C                     MOVEL'urity'   WPARM4                                            BUG21922
     C                     MOVELWPARM     SVALK1                                            BUG21922
      *                                                                                     BUG21922
      ** CALL ACCESS OBJECT:                                                                BUG21922
      *                                                                                     BUG21922
     C                     CALL 'AOSVALR0'                                                  BUG21922
     C                     PARM           RTNCDE  7                                         BUG21922
     C                     PARM           SVALK1 20                                         BUG21922
     C                     PARM           SVAL1 200                                         BUG21922
     C                     PARM           SVALK2 20                                         BUG21922
     C                     PARM           SVAL2 200                                         BUG21922
     C                     PARM           SVALK3 20                                         BUG21922
     C                     PARM           SVAL3 200                                         BUG21922
     C                     PARM           SVALK4 20                                         BUG21922
     C                     PARM           SVAL4 200                                         BUG21922
     C                     PARM           SVALK5 20                                         BUG21922
     C                     PARM           SVAL5 200                                         BUG21922
     C                     PARM           SVALK6 20                                         BUG21922
     C                     PARM           SVAL6 200                                         BUG21922
     C                     PARM           SVALK7 20                                         BUG21922
     C                     PARM           SVAL7 200                                         BUG21922
     C                     PARM           SVALK8 20                                         BUG21922
     C                     PARM           SVAL8 200                                         BUG21922
     C                     PARM           SVALK9 20                                         BUG21922
     C                     PARM           SVAL9 200                                         BUG21922
     C                     PARM           SVALK0 20                                         BUG21922
     C                     PARM           SVAL10200                                         BUG21922
      *                                                                                     BUG21922
      ** If the system value is not found then issue a database error                       BUG21922
      *                                                                                     BUG21922
     C           RTNCDE    IFNE '        '                                                  BUG21922
     C                     SETON                     U7U8                                   BUG21922
     C                     MOVEL'SDSVALPD'DBFILE           ************                     BUG21922
     C                     Z-ADD57        DBASE            * DBERR 57 *                     BUG21922
     C                     MOVEL'SVALK1'  DBKEY            ************                     BUG21922
     C                     MOVE '1'       *INLR                                             BUG21922
     C                     EXSR *PSSR                                                       BUG21922
     C                     ELSE                                                             BUG21922
      *                                                                                     BUG21922
      ** Isolate the first character of SVAL1 which is either 'R' or 'M'.                   BUG21922
      *                                                                                     BUG21922
     C                     MOVELSVAL1     WRKFLD  1        1 CHARACTER FLD                  BUG21922
     C                     ENDIF                                                            BUG21922
      *
     C/COPY WNCPYSRC,LE0212C013
     C                     ENDSR
      /EJECT
      *****************************************************************   133915
      * SRMDAT  -  Process Incoming Maturity Date                     *   133915
      * Called by: SRPROC - Process Enquiry request                   *   133915
      * Calls    : SRINCL - Interest Calculation                      *   133915
      *            SRTEXT - Set up text from message file             *   133915
      *                                                               *   133915
      *****************************************************************   133915
     C           SRMDAT    BEGSR                                          133915
      *                                                                                       207961
     C           WCDIN     IFEQ ' '                                                           207961
     C           WCDIN     OREQ 'F'                                                           207961
     C           MDAT      ANDGERUND                                                          207961
     C           WCDIN     OREQ 'B'                                                           207961
     C           MDAT      ANDLTRUND                                                          207961
      *                                                                   133915
     C********** VSLN      IFEQ 20                                 133915 188806
     C           VSLN      IFGE 20                                        188806
     C                     MOVE 'Y'       WFINL                           133915
     C                     ELSE                                           133915
     C                     SETOF                     68                   133915
      *                                                                                       202726
     C           MDAT      IFGE RUND                                                          202726
     C                     MOVE 'F'       SCODE                           133915
     C                     MOVE *BLANK    SINDT                           133915
     C                     ELSE                                                               202726
     C                     MOVE 'B'       SCODE                                               202726
     C                     Z-ADDLCD       ZDAYNO                                              202726
     C                     EXSR ZDATE2                                                        202726
     C                     MOVE ZADATE    SINDT                                               202726
     C                     ENDIF                                                              202726
      *                                                                                       202726
     C                     MOVE *BLANK    SSMSG                           133915
     C                     MOVE *BLANK    SSGAS                           133915
      *                                                                   133915
      ** Process Due Date                                                 133915
      *                                                                   133915
     C                     Z-ADDMDAT      ZDAYNO                          133915
     C                     EXSR ZDATE2                                    133915
     C                     MOVE ZADATE    SDUDT                           133915
     C                     MOVE ZADATE    SBLDT                           133915
      *                                                                   133915
      ** Maturity                                                         133915
      *                                                                   133915
     C           *IN22     IFEQ '0'                                       133915
     C                     MOVE SCUBL     SAMNT                           133915
     C                     MOVEL'LEE0018' ZAMSID                          133915
     C                     EXSR SRTEXT                                    133915
     C                     MOVELZAMSTX    SNARR                           133915
     C                     ADD  1         VSLN                            133915
     C                     WRITELE0212F2                                  133915
     C                     MOVE '1'       *IN22                           133915
     C                     ENDIF                                          133915
     C                     ENDIF                                          133915
      *                                                                   133915
      ** ... Interest                                                     133915
      *                                                                   133915
     C********** VSLN      IFEQ 20                                 133915 188806
     C           VSLN      IFGE 20                                        188806
     C                     MOVE 'Y'       WFINL                           133915
     C                     ELSE                                           133915
     C           *IN23     IFEQ '0'                                       133915
     C                     Z-ADDWLTDT     ZIBEG                           133915
     C           WSTAC     IFEQ 'Y'                                                           209517
     C                     Z-ADDWSTPA     ZIEND                                               209517
     C                     ELSE                                                               209517
     C                     Z-ADDMDAT      ZIEND                           133915
     C           ADDI      IFEQ 'B'                                                           245082
     C                     ADD  1         ZIEND                                               245082
     C                     ENDIF                                                              245082
     C                     ENDIF                                                              209517
     C                     Z-ADDMDAT      W78BEG                                              CLE028
     C                     Z-ADDMDAT      W78END                                              CLE028
     C                     MOVE 'R'       W78ROA                                              CLE028
     C                     EXSR SRINCL                                    133915
     C/COPY WNCPYSRC,LE0212C014
      *                                                                                       CLE028
      ** If add on interest, maturity interest should be zero                                 CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           ADIF      ANDEQ'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C                     Z-ADD*ZEROS    ZINTR                                               CLE028
     C                     Z-ADD*ZEROS    WCALC                                               CLE028
     C                     Z-ADD*ZEROS    WINPD                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C                     Z-ADDZINTR     ZFLD15                          133915
     C                     ADD  ZINTR     WCALC                           159779
      ***********                                                  154221 159779
      ***Subtract*interest*only*if*not*subtracted*for*this*date*al 154221 159779
      ***Repayment*type*3*only.*********************************** 154221 159779
      ***********                                                  154221 159779
     C           REPT      IFEQ 3                                         154221
     C           ZIEND     IFNE WZIEND                                    154221
     C***********WCALC     SUB  WIPAID    WCALC                    154221 159779
     C                     Z-ADDZIEND     WZIEND                          154221
     C                     ENDIF                                          154221
     C***********          ELSE                                    154221 159779
     C***********WCALC     SUB  WIPAID    WCALC                    133915 159779
     C                     ENDIF                                          154221
     C********** WCALC     SUB  WIPAID    ZFLD15                                       159779 188806
     C           WCALC     SUB  WINPD     ZFLD15                                              188806
     C                     Z-ADDWCALC     WIPAID                          159779
      *                                                                                       CLE028
      ** Display last interest payment computed on maturity if flat                           CLE028
      ** rate personal loan and non-add on interest                                           CLE028
      *                                                                                       CLE028
     C           CLE028    IFEQ 'Y'                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           ADIF      ANDNE'Y'                                                           CLE028
     C                     Z-ADDZINTR     ZFLD15                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C***********          ADD  WCALC     ZFLD15                    133915146311
     C***********          ADD  WCALC     ZFLD15                   154221 159779
     C***********ZINTR     IFNE 0                                   153370154221
     C***********          ADD  WCALC     ZFLD15                    153370154221
     C***********          ENDIF                                    153370154221
      *                                                                                       243394
      ** If systemvalue 'AddPastDueIntrInLOAC' = 'Y', add Past Due Interest                   243394
      ** into the calculated Maturity Interest.                                               243394
     C           ADDPDI    IFEQ 'Y'                                                           243394
     C                     ADD  IPDUE     ZFLD15                                              225849
     C                     ENDIF                                                              243394
      *                                                                                       243394
     C                     EXSR ZSEDIT                                    133915
     C                     MOVE ZOUT21    SAMNT                           133915
     C                     MOVEL'LEE0019' ZAMSID                          133915
     C                     EXSR SRTEXT                                    133915
     C                     MOVELZAMSTX    SNARR                           133915
     C                     ADD  1         VSLN                            133915
     C                     WRITELE0212F2                                  133915
     C                     MOVE '1'       *IN23                           133915
     C                     ENDIF                                          133915
     C                     ENDIF                                          133915
      *                                                                   133915
      ** ... withholding tax                                              133915
      *                                                                   133915
     C           WTRT      IFNE 0                                         133915
      *                                                                   133915
     C********** VSLN      IFEQ 20                                 133915 188806
     C           VSLN      IFGE 20                                        188806
     C                     MOVE 'Y'       WFINL                           133915
     C                     ELSE                                           133915
     C           *IN24     IFEQ '0'                                       133915
      *                                                                   133915
     C           WTIN      IFEQ 'R'                                       133915
     C           WTIN      OREQ 'G'                                       133915
     C           ZINTR     MULT WTRT      WRKAMT 130                      133915
     C           WRKAMT    DIV  100       WRKAMT                          133915
     C                     ENDIF                                          133915
     C           WTIN      IFEQ 'N'                                       133915
     C           100       SUB  WTRT      WRKAMT                          133915
     C           ZINTR     DIV  WRKAMT    WRKAMT                          133915
     C           WRKAMT    MULT 10        WRKAMT                          133915
     C                     ENDIF                                          133915
      *                                                                   133915
     C                     Z-ADDWRKAMT    ZFLD15                          133915
     C                     EXSR ZSEDIT                                    133915
     C                     MOVE ZOUT21    SAMNT                           133915
     C                     MOVEL'LEE0020' ZAMSID                          133915
     C                     EXSR SRTEXT                                    133915
     C                     MOVELZAMSTX    SNARR                           133915
     C                     ADD  1         VSLN                            133915
     C                     WRITELE0212F2                                  133915
     C                     MOVE '1'       *IN24                           133915
     C                     ENDIF                                          133915
     C                     ENDIF                                          133915
     C                     ENDIF                                          133915
      *                                                                   133915
      ** Final Balance                                                    133915
      *                                                                   133915
     C********** VSLN      IFEQ 20                                 133915 188806
     C           VSLN      IFGE 20                                        188806
     C                     MOVE 'Y'       WFINL                           133915
     C                     ELSE                                           133915
     C                     MOVE ZADATE    SBLDT                           133915
     C                     Z-ADD0         ZFLD15                          133915
     C                     EXSR ZSEDIT                                    133915
     C                     MOVE ZOUT21    SCUBL                           133915
      *                                                                   133915
     C                     SETON                     68                   133915
     C                     ADD  1         VSLN                            133915
     C                     WRITELE0212F2                                  133915
     C                     MOVE '1'       *IN31                           133915
     C                     ENDIF                                          133915
      *                                                                   133915
     C                     ELSE                                                               207961
     C                     MOVE '1'       *IN31                                               207961
     C                     ENDIF                                                              207961
      *                                                                                       207961
     C                     ENDSR                                          133915
      /EJECT                                                              133915
      *****************************************************************   184903
      *                                                               *   184903
      *  SRRDAT -  Display Rollover Details                           *   184903
      *                                                               *   184903
      *  Called By: SRPROC - Process Enquiry request                  *   184903
      *  Calls:                                                       *   184903
      *  SRDETL - Write detail line                                   *   184903
      *  AOBSRTR0 Access Program                                      *   184903
      *                                                               *   184903
      *****************************************************************   184903
      *                                                                   184903
     C           SRRDAT    BEGSR                                          184903
      *                                                                   184903
     C                     MOVE '0'       *IN68                           184903
     C                     MOVE *BLANK    SINDT                           184903
     C                     MOVE *BLANK    SCODE                           184903
     C                     MOVE *BLANK    SSMSG                           184903
     C                     MOVE *BLANK    SSGAS                           184903
     C                     MOVE FCALI     WCALI   1                       184903
     C                     MOVE FCALR     WCALR   1                       184903
     C                     MOVE ' '       FCALI                           184903
     C                     MOVE ' '       FCALR                           184903
     C                     Z-ADD*ZERO     WWBRTE                                             BUG9240
      *                                                                                       224646
      ** Do not write rollover details if the selected date is greater                        224646
      ** than the rollover date                                                               224646
      *                                                                                       224646
     C                     MOVE *BLANK    WNOTWR  1                                           224646
     C           CAS005    IFEQ 'Y'                                                           224646
     C           WDTIN     IFGT RLDT                                                          224646
     C                     MOVE 'Y'       WNOTWR                                              224646
     C                     ENDIF                                                              224646
     C                     ENDIF                                                              224646
      *                                                                   184903
     C           WCDIN     IFEQ ' '                                                           207961
     C           WCDIN     OREQ 'F'                                                           207961
     C           RLDT      ANDGERUND                                                          207961
     C           WCDIN     OREQ 'B'                                                           207961
     C           RLDT      ANDLTRUND                                                          207961
      *                                                                                       207961
     C           RLDT      IFLT RUND                                      184903
     C                     MOVE 'B'       SCODE                           184903
     C                     ELSE                                           184903
     C                     MOVE 'F'       SCODE                           184903
     C                     ENDIF                                          184903
      *                                                                   184903
      ** Process Due Date                                                 184903
      *                                                                   184903
     C                     Z-ADDRLDT      ZDAYNO                          184903
     C                     EXSR ZDATE2                                    184903
     C                     MOVE ZADATE    SDUDT                           184903
     C           SCODE     IFEQ 'B'                                       184903
     C                     Z-ADDRUND      ZDAYNO                          184903
     C                     EXSR ZDATE2                                    184903
     C                     MOVE ZADATE    SINDT                           184903
     C                     ENDIF                                          184903
      *                                                                   184903
     C           WROLL     IFEQ '0'                                       184903
      *                                                                   184903
      ** Setup base rate and rate spread to be used                       184903
      ** For CLE036, populate WBSRT to ensure that if Base Rate Code                          CLE036
      ** is Blank, Specific Base Rate would be used for the computation                       CLE036
      *                                                                   184903
     C                     Z-ADD*ZEROS    WBSRT  117                                          CLE036
     C           NRTS      IFEQ *ZEROS                                    184903
     C           NBRA      ANDEQ*ZEROS                                    184903
     C           CLE036    ANDEQ'N'                                                           CLE036
     C           NRTS      OREQ *ZEROS                                                        CLE036
     C           NBRA      ANDEQ*ZEROS                                                        CLE036
     C           NBSR      ANDEQ*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     MOVE BRTT      WBRAT   2                       184903
     C                     Z-ADDRTSP      WRSPR  117                      184903
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     Z-ADDBRTE      WBSRT                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ELSE                                           184903
     C                     MOVE NBRA      WBRAT                           184903
     C                     Z-ADDNRTS      WRSPR                           184903
      *                                                                                       CLE036
     C           CLE036    IFEQ 'Y'                                                           CLE036
     C                     Z-ADDNBSR      WBSRT                                               CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C                     ENDIF                                          184903
      *                                                                   184903
     C                     MOVE '1'       WROLL                           184903
      *                                                                                       193701
      ** Compute outstanding interest to be paid at rollover date                             193701
      *                                                                                       193701
     C                     EXSR SRNEWI                                                        193701
      *                                                                                     MD031067
      ** Do not compute if this is not a real rollover.                                     MD031067
      *                                                                                     MD031067
     C           WFXCOF    IFNE 'Y'                                                         MD031067
      *                                                                                     MD031067
     C                     Z-ADDRLDT      ZIEND                                               193701
     C                     EXSR SRINCL                                                        193701
     C                     Z-ADDRLDT      WLICD                                              BUG9240
     C           RDFC      IFEQ 'Y'                                                           193701
     C                     ADD  ZINTR     WINCA                                               193701
     C                     ELSE                                                               193701
     C                     ADD  ZINTR     WINCA     H                                         193701
     C                     ENDIF                                                              193701
      *                                                                                       224646
      ** Also add the computed interest up to the rollover date to WCALC                      224646
      ** field to correctly compute the outstanding maturity interest                         224646
      *                                                                                       224646
     C********** CAS005    IFEQ 'Y'                                                  224646 MD031067
     C           RDFC      IFEQ 'Y'                                                           224646
     C                     ADD  ZINTR     WCALC                                               224646
     C                     ELSE                                                               224646
     C                     ADD  ZINTR     WCALC     H                                         224646
     C                     ENDIF                                                              224646
     C**********           ENDIF                                                     224646 MD031067
      *                                                                                       193701
     C           REPT      IFEQ 1                                                             238722
     C           WINCA     SUB  WIPAID    WINTR                                               238722
     C                     ELSE                                                               238722
     C           WINCA     SUB  WINPD     WINTR                                               193701
     C                     ENDIF                                                              238722
      *                                                                                     MD031067
     C                     ENDIF                                                            MD031067
      *                                                                                       193701
     C           WCNT      IFEQ 0                                                             193701
     C                     MOVE ' '       WDTL1                           184903
     C                     MOVE ' '       WDTL2                           184903
     C                     MOVE ' '       WDTL3                           184903
     C                     MOVE ' '       WDTL4                           184903
     C                     MOVE ' '       WDTL5                           184903
     C                     MOVE ' '       WDTL6                                               193701
     C                     MOVE ' '       WDTL7                                               193701
     C                     MOVE ' '       WDTL8                                               193701
     C                     MOVE ' '       WDTL9                                               218984
      *                                                                   184903
      ** Count how many rollover details are to be displayed              184903
      *                                                                   184903
     C********** WBRAT     IFGT *ZEROS                                              184903 AR1071639
     C           WBRAT     IFNE *ZEROS                                                     AR1071639
     C           WBSRT     ORGT *ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     ADD  1         WCNT                            184903
     C                     ENDIF                                          184903
      *                                                                                    AR1071639
      ** Consider a negative rate.                                                         AR1071639
      *                                                                                    AR1071639
     C********** WRSPR     IFGT *ZEROS                                              184903 AR1071639
     C           WRSPR     IFNE *ZEROS                                                     AR1071639
     C           WBRAT     ANDEQ*ZEROS                                    184903
     C           CLE036    ANDEQ'N'                                                           CLE036
     C           WRSPR     ORGT *ZEROS                                                        CLE036
     C           WBRAT     ANDEQ*ZEROS                                                        CLE036
     C           WBSRT     ANDEQ*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     ADD  1         WCNT                            184903
     C                     ENDIF                                          184903
     C           NPRAM     IFNE *ZEROS                                    184903
     C**********           ADD  2         WCNT                            184903
     C                     ADD  2         WCNT                                                218984
     C                     ENDIF                                          184903
     C           *IN20     IFEQ '1'                                                           193701
     C                     ADD  3         WCNT                                                193701
     C           WCUPR     IFEQ 0                                                             193701
     C                     SUB  1         WCNT                                                193701
     C                     ENDIF                                                              193701
     C           WINTR     IFEQ 0                                                             193701
     C                     SUB  1         WCNT                                                193701
     C                     ENDIF                                                              193701
     C                     ENDIF                                                              193701
     C********** WRSPR     IFGT *ZEROS                                              184903 AR1071639
     C********** WBRAT     ANDGT*ZEROS                                              184903 AR1071639
     C           WRSPR     IFNE *ZEROS                                                     AR1071639
     C           WBRAT     ANDNE*ZEROS                                                     AR1071639
     C           WRSPR     ORGT *ZEROS                                                        CLE036
     C           WBSRT     ANDGT*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     ADD  1         WCNT                            184903
     C                     ENDIF                                          184903
     C                     ENDIF                                          184903
      *                                                                                       193701
      ** Write first the principal if rollover is multi-currency                              193701
      *                                                                                       193701
     C           *IN20     IFEQ '1'                                                           193701
      *                                                                                       193701
     C           WDTL1     IFEQ *BLANK                                                        193701
     C           VSLN      ANDLT20                                                            193701
     C           WINTR     ANDNE0                                                             193701
      *                                                                                       193701
      ** Display outstanding interest at rollover date                                        193701
      *                                                                                       193701
     C                     MOVEL'LEE0016' ZAMSID                                              193701
     C                     EXSR SRTEXT                                                        193701
     C                     MOVELZAMSTX    SNARR                                               193701
     C                     Z-ADDWINTR     ZFLD15                                              193701
     C                     EXSR ZSEDIT                                                        193701
     C                     MOVE ZOUT21    SAMNT                                               193701
     C           WNOTWR    IFEQ *BLANK                                                        224646
     C                     EXSR SRDETL                                                        193701
     C                     ENDIF                                                              224646
     C                     MOVE ' '       FCALR                                               193701
     C                     SUB  1         WCNT                                                193701
     C                     MOVE 'Y'       WDTL1                                               193701
      *                                                                                       193701
     C           VSLN      IFGE 20                                                            193701
     C           WDTL2     IFEQ *BLANK                                                        193701
     C           WCUPR     ANDGT*ZEROS                                                        193701
     C           WDTL3     OREQ *BLANK                                                        193701
     C           WDTL4     OREQ *BLANK                                                        193701
     C           WBRAT     ANDNE*ZEROS                                                        193701
     C           WDTL4     OREQ *BLANK                                                        CLE036
     C           WBSRT     ANDNE*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C           WDTL5     OREQ *BLANK                                                        193701
     C           WRSPR     ANDNE*ZEROS                                                        193701
     C           WDTL6     OREQ *BLANK                                                        193701
     C           NPRAM     ANDNE*ZEROS                                                        193701
     C           WDTL7     OREQ *BLANK                                                        193701
     C           NDAM      ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        193701
     C           WRSPR     ANDNE*ZEROS                                                        193701
     C           WBRAT     ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        CLE036
     C           WRSPR     ANDNE*ZEROS                                                        CLE036
     C           WBSRT     ANDNE*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     MOVE 'Y'       WSAME                                               193701
     C                     ENDIF                                                              193701
     C                     ENDIF                                                              193701
     C                     ENDIF                                                              193701
      *                                                                                       193701
     C           WDTL2     IFEQ *BLANK                                                        193701
     C           VSLN      ANDLT20                                                            193701
     C           WCUPR     ANDNE0                                                             193701
      *                                                                                       193701
      ** Display repayment of outstanding principal amount.                                   193701
      *                                                                                       193701
     C********** AUTOCL    IFEQ 'Y'                                                    218984 242909
     C                     MOVEL'LEE0028' ZAMSID                                              193701
     C**********           ELSE                                                        218984 242909
     C**********           MOVEL'LEE0063' ZAMSID                                       218984 242909
     C**********           ENDIF                                                       218984 242909
     C                     EXSR SRTEXT                                                        193701
     C                     MOVELZAMSTX    SNARR                                               193701
     C                     Z-ADDWCUPR     ZFLD15                                              193701
     C                     EXSR ZSEDIT                                                        193701
     C                     MOVE ZOUT21    SAMNT                                               193701
     C           WNOTWR    IFEQ *BLANK                                                        224646
     C                     EXSR SRDETL                                                        193701
     C                     ENDIF                                                              224646
     C                     MOVE ' '       FCALR                                               193701
     C                     SUB  1         WCNT                                                193701
     C                     MOVE 'Y'       WDTL2                                               193701
      *                                                                                       193701
     C           VSLN      IFGE 20                                                            193701
     C           WDTL3     IFEQ *BLANK                                                        193701
     C           WDTL4     OREQ *BLANK                                                        193701
     C           WBRAT     ANDNE*ZEROS                                                        193701
     C           WDTL4     OREQ *BLANK                                                        CLE036
     C           WBSRT     ANDNE*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C           WDTL5     OREQ *BLANK                                                        193701
     C           WRSPR     ANDNE*ZEROS                                                        193701
     C           WDTL6     OREQ *BLANK                                                        193701
     C           NPRAM     ANDNE*ZEROS                                                        193701
     C           WDTL7     OREQ *BLANK                                                        193701
     C           NDAM      ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        193701
     C           WRSPR     ANDNE*ZEROS                                                        193701
     C           WBRAT     ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        CLE036
     C           WRSPR     ANDNE*ZEROS                                                        CLE036
     C           WBSRT     ANDNE*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     MOVE 'Y'       WSAME                                               193701
     C                     ENDIF                                                              193701
     C                     ENDIF                                                              193701
     C                     ENDIF                                                              193701
      *                                                                                       193701
      ** Then show the converted principal amount                                             193701
      *                                                                                       193701
     C           WDTL3     IFEQ *BLANK                                                        193701
     C           VSLN      ANDLT20                                                            193701
      *                                                                                       193701
      ** Get first the details of the 'TO' currency.                                          193701
      *                                                                                       193701
     C                     MOVE NCCY      PCURR                                               193701
     C                     EXSR SRCURR                                                        193701
      *                                                                                       193701
     C           CCYCL     IFNE NCCY                                                          193701
     C           NCCY      ANDEQBKEURO                                                        193701
     C           WINCY1    ANDEQ'Y'                                                           193701
     C           CCYCL     ORNE NCCY                                                          193701
     C           CCYCL     ANDEQBKEURO                                                        193701
     C           WINCY2    ANDEQ'Y'                                                           193701
      *                                                                                       193701
     C                     MOVEL'Y'       WEUIN   1                                           193701
      *                                                                                       193701
     C           WAMCV     IFGT 0                                                             193701
     C                     Z-ADDWAMCV     PFRAM                                               193701
     C                     ELSE                                                               193701
     C                     Z-ADDWCUPR     PFRAM                                               193701
     C                     ENDIF                                                              193701
     C                     MOVE CCYCL     PFRCY                                               193701
     C                     MOVE NCCY      PTOCY                                               193701
     C                     EXSR SRCONV                                                        193701
      *                                                                                       193701
     C                     ELSE                                                               193701
      *                                                                                       193701
     C                     MOVEL'N'       WEUIN   1                                           193701
     C                     Z-ADDXRATE1    ZRATE1 138                                          193701
     C                     MOVE WMDIV1    ZMDI1   1                                           193701
     C                     Z-ADDXRATE2    ZRATE2 138                                          193701
     C                     MOVE WMDIV2    ZMDI2   1                                           193701
     C                     EXSR ZXRATE                                                        193701
      *                                                                                       193701
     C           WAMCV     IFGT 0                                                             193701
     C                     Z-ADDWAMCV     ZAMTCI                                              193701
     C                     ELSE                                                               193701
     C                     Z-ADDWCUPR     ZAMTCI                                              193701
     C                     ENDIF                                                              193701
      *                                                                                       193701
     C                     Z-ADDZRATEX    ZEXCH                                               193701
     C                     MOVE CCYCL     ZCCYI                                               193701
     C                     MOVE NCCY      ZCCYO                                               193701
     C                     MOVE WNDEC1    ZCDPI                                               193701
     C                     MOVE WNDEC2    ZCDPO                                               193701
     C                     MOVE ZMDIX     ZMD                                                 193701
      *                                                                                       193701
     C                     EXSR ZCONV                                                         193701
      *                                                                                       193701
     C                     ENDIF                                                              193701
      *                                                                                       193701
     C                     MOVEL'LEE0057' ZAMSID                                              193701
     C                     EXSR SRTEXT                                                        193701
     C                     MOVELZAMSTX    SNARR                                               193701
     C                     MOVELCCYCL     #CCY    6                                           193701
     C                     MOVE 'TO'      #CCY                                                193701
     C                     MOVELNCCY      WRLCY   4                                           193701
     C                     MOVE WRLCY     #RLCY   5                                           193701
     C                     MOVEL#CCY      #LCY   11                                           193701
     C                     MOVE #RLCY     #LCY                                                193701
     C                     MOVE #LCY      SNARR                                               193701
      *                                                                                       193701
     C           WEUIN     IFEQ 'Y'                                                           193701
     C                     Z-ADDPOUTA     ZFLD15                                              193701
     C                     ELSE                                                               193701
     C                     Z-ADDZAMTCO    ZFLD15                                              193701
     C                     ENDIF                                                              193701
     C                     Z-ADDZFLD15    WNCUPR                                              219717
      *                                                                                       238722
      ** Load converted amount (from multi-ccy rollover) to current principal                 238722
      *                                                                                       238722
     C                     Z-ADDZFLD15    WCUPR                                               238722
      *                                                                                       238722
     C                     Z-ADDA6NBDP    ZDECS                                               219717
      *                                                                                       193701
     C                     EXSR ZSEDIT                                                        193701
     C                     MOVE ZOUT21    SAMNT                                               193701
     C                     MOVE ZOUT21    SCUBL                                               238722
     C           WNOTWR    IFEQ *BLANK                                                        224646
     C                     EXSR SRDETL                                                        193701
     C                     ENDIF                                                              224646
     C                     SUB  1         WCNT                                                193701
     C                     MOVE 'Y'       WDTL3                                               193701
      *                                                                                       193701
     C           VSLN      IFGE 20                                                            193701
     C           WDTL4     IFEQ *BLANK                                                        193701
     C           WBRAT     ANDNE*ZEROS                                                        193701
     C           WDTL4     OREQ *BLANK                                                        CLE036
     C           WBSRT     ANDNE*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C           WDTL5     OREQ *BLANK                                                        193701
     C           WRSPR     ANDNE*ZEROS                                                        193701
     C           WDTL6     OREQ *BLANK                                                        193701
     C           NPRAM     ANDNE*ZEROS                                                        193701
     C           WDTL9     OREQ *BLANK                                                        218984
     C           NPRAM     ANDNE*ZEROS                                                        218984
     C           WDTL7     OREQ *BLANK                                                        193701
     C           NDAM      ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        193701
     C           WRSPR     ANDNE*ZEROS                                                        193701
     C           WBRAT     ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        CLE036
     C           WRSPR     ANDNE*ZEROS                                                        CLE036
     C           WBSRT     ANDNE*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     MOVE 'Y'       WSAME                                               193701
     C                     ENDIF                                                              193701
     C                     ENDIF                                                              193701
     C                     ENDIF                                                              193701
      *                                                                   184903
     C                     ENDIF                                                              193701
      *                                                                   184903
      ** Rollover - new base rate                                         184903
      *                                                                   184903
     C********** WBRAT     IFGT *ZEROS                                              184903 AR1071639
     C********** WDTL1     ANDEQ*BLANK                                                 184903 193701
      *                                                                                    AR1071639
      ** Consider a negative base rate.                                                    AR1071639
      *                                                                                    AR1071639
     C           WBRAT     IFNE *ZEROS                                                     AR1071639
     C           WDTL4     ANDEQ*BLANK                                                        193701
     C           VSLN      ANDLT20                                        184903
     C           WBSRT     ORGT *ZEROS                                                        CLE036
     C           WDTL4     ANDEQ*BLANK                                                        CLE036
     C           VSLN      ANDLT20                                                            CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C           *IN20     IFEQ '1'                                                           193701
     C                     MOVEL'LEE0058' ZAMSID                                              193701
     C                     ELSE                                                               193701
     C**********           SUB  1         WCNT                                         184903 193701
     C                     MOVEL'LEE0032' ZAMSID                          184903
     C                     ENDIF                                                              193701
     C                     EXSR SRTEXT                                    184903
     C                     MOVELZAMSTX    SNARR                           184903
     C                     MOVE 'CALC  '  SNARR                           186995
      *                                                                   186995
      ** Use the new calculation basis for rollover if inserted           186995
      *                                                                   186995
     C           NCAS      IFGT 0                                         186995
     C                     MOVE NCAS      SNARR                           186995
     C                     ELSE                                           186995
     C                     MOVE ICBS      SNARR                           186995
     C                     ENDIF                                          186995
      *                                                                   186995
     C           *IN20     IFEQ '1'                                                           193701
     C                     MOVE NCCY      PKEY1   3                                           193701
     C                     ELSE                                                               193701
     C***********          MOVE CCY       PKEY1   3                                    184903 219717
     C                     MOVE CCYCL     PKEY1   3                                           219717
     C                     ENDIF                                                              193701
      *                                                                                       CLE036
      ** For CLE036, when Base Rate Code is zero, Specific Base                               CLE036
      ** Rate is would be used for Rollover computation                                       CLE036
      *                                                                                       CLE036
     C           CLE036    IFEQ 'N'                                                           CLE036
     C           WBRAT     ORGT *ZERO                                                         CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
      *                                                                                       CLE036
     C                     MOVE WBRAT     PKEY2   2                       184903
     C                     CALL 'AOBSRTR0'                                184903
     C                     PARM *BLANKS   PRTCD   7                       184903
     C                     PARM '*KEY    'POPTN   7                       184903
     C                     PARM           PKEY1                           184903
     C                     PARM           PKEY2                           184903
     C           SDBSRT    PARM SDBSRT    DSFDY                           184903
      *                                                                   184903
     C           RLDT      IFGE BAVDNR                                    184903
     C                     MOVE BANBRT    ZFIELD                          184903
     C           CAS005    IFEQ 'Y'                                                           224646
     C                     Z-ADDBANBRT    WWBRTE 117                                          224646
     C                     Z-ADDBANBRT    WCUBR                                             BUG22332
     C                     ENDIF                                                              224646
     C                     ELSE                                           184903
     C                     MOVE BACBSR    ZFIELD                          184903
     C           CAS005    IFEQ 'Y'                                                           224646
     C                     Z-ADDBACBSR    WWBRTE                                              224646
     C                     ENDIF                                                              224646
     C                     ENDIF                                          184903
      *                                                                                       CLE036
     C                     ELSE                                                               CLE036
      *                                                                                       CLE036
     C                     MOVE *BLANKS   ZFIELD                                              CLE036
     C                     MOVE WBSRT     ZFIELD                                              CLE036
      *                                                                                       CLE036
     C                     ENDIF                                                              CLE036
      *                                                                                       CLE036
     C           CLE011    IFEQ 'Y'                                                           235907
     C           RFRI      ANDEQ'Y'                                                           235907
     C           CHIN      ANDEQ'R'                                                           235907
     C           CLE011    OREQ 'Y'                                                           235907
     C           RFRI      ANDEQ'Y'                                                           235907
     C           NCHI      ANDEQ'R'                                                           235907
     C           BRTT      ANDEQ0                                                             235907
     C           NBRA      ANDNE0                                                             235907
     C                     MOVE RFRT      ZFIELD                                              235907
     C                     ENDIF                                                              235907
      *                                                                                       235907
      ** Override the Current Base Rate based on History File                                 239062
      ** if rate fixing days is not equal to zero                                           MD039619
      ** and new rate's value date is < historic rate retrieved                             MD039651
      ** or new rate's value date is > rate re-fixing date                                  MD039651
      ** or rate fixing days is zero and rollover date is                                   MD039619
      ** less than the value date of new rate.                                              MD039619
      *                                                                                     MD039619
     C           CLE011    IFEQ 'Y'                                                           239062
     C           CHIN      ANDNE'N'                                                         MD025520
     C           RFDY      ANDNE*BLANKS                                                     MD039619
     C           RFDY      ANDNE'00'                                                        MD039619
     C           CLE011    OREQ 'Y'                                                         MD039619
     C           CHIN      ANDNE'N'                                                         MD039619
     C           RFDY      ANDEQ'00'                                                        MD039619
     C           RLDT      ANDLTBAVDNR                                                      MD039619
     C           CLE011    OREQ 'Y'                                                         MD039619
     C           CHIN      ANDNE'N'                                                         MD039619
     C           RFDY      ANDEQ*BLANKS                                                     MD039619
     C           RLDT      ANDLTBAVDNR                                                      MD039619
     C                     MOVE PKEY1     ZCCY                                                239062
     C                     MOVE PKEY2     WBRTT                                               239062
     C                     Z-ADDWCUBR     OWCUBR 117                                        MD039651
     C                     MOVE 'N'       USENEW  1                                         MD039651
     C                     EXSR SRBRFZ                                                        239062
     C           BANBRT    IFNE BACBSR                                                      MD039651
     C           USENEW    ANDEQ'Y'                                                         MD039651
     C                     MOVE OWCUBR    ZFIELD                                            MD039651
     C                     ELSE                                                             MD039651
     C                     MOVE WCUBR     ZFIELD                                              239062
     C                     ENDIF                                                            MD039651
     C                     ELSE                                                             MD025520
     C                     MOVE WCUBR     ZFIELD                                            MD025520
     C                     ENDIF                                                              239062
      *                                                                                       239062
     C                     Z-ADD7         ZADEC                           184903
     C                     EXSR ZEDIT                                     184903
     C                     MOVE ZFIELD    SAMNT                           184903
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C**********           MOVE 'Y'       WDTL1                                        184903 193701
     C           WNOTWR    IFEQ *BLANK                                                        224646
     C           WFXCOF    ANDNE'Y'                                                         MD031378
     C                     EXSR SRDETL                                    184903
     C                     ENDIF                                                              224646
     C/COPY WNCPYSRC,LEH00867
     C           WSAME     IFEQ *BLANK                                                       BUG9240
     C                     SUB  1         WCNT                                                193701
     C                     MOVE 'Y'       WDTL4                                               193701
     C                     ENDIF                                                             BUG9240
     C/COPY WNCPYSRC,LEH00868
      *                                                                   184903
     C********** VSLN      IFEQ 20                                                     184903 193701
     C********** WDTL2     IFEQ *BLANK                                                 184903 193701
     C********** WRSPR     ANDGT*ZEROS                                                 184903 193701
     C********** WBRAT     ANDNE*ZEROS                                                 184903 193701
     C********** WDTL5     OREQ *BLANK                                                 184903 193701
     C********** WRSPR     ANDEQ*ZEROS                                                 184903 193701
     C********** WBRAT     ANDEQ*ZEROS                                                 184903 193701
     C********** WDTL3     OREQ *BLANK                                                 184903 193701
     C********** NPRAM     ANDNE*ZEROS                                                 184903 193701
     C********** WDTL4     OREQ *BLANK                                                 184903 193701
     C********** NPRAM     ANDNE*ZEROS                                                 184903 193701
     C           VSLN      IFGE 20                                                            193701
     C           WDTL5     IFEQ *BLANK                                                        193701
     C           WRSPR     ANDNE*ZEROS                                                        193701
     C           WDTL6     OREQ *BLANK                                                        193701
     C           NPRAM     ANDNE*ZEROS                                                        193701
     C           WDTL7     OREQ *BLANK                                                        193701
     C           NDAM      ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        193701
     C           WRSPR     ANDNE*ZEROS                                                        193701
     C           WBRAT     ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        CLE036
     C           WRSPR     ANDNE*ZEROS                                                        CLE036
     C           WBSRT     ANDNE*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     MOVE 'Y'       WSAME                           184903
     C                     ENDIF                                          184903
     C                     ENDIF                                          184903
     C                     ENDIF                                          184903
      *                                                                   184903
      ** ... new rate                                                     184903
      *                                                                   184903
     C********** WRSPR     IFGT *ZEROS                                              184903 AR1071639
     C********** WBRAT     ANDEQ*ZEROS                                              184903 AR1071639
     C           WRSPR     IFNE *ZEROS                                                     AR1071639
     C           WBRAT     ANDEQ*ZEROS                                                     AR1071639
     C           CLE036    ANDEQ'N'                                                           CLE036
     C           WRSPR     ORGT *ZEROS                                                        CLE036
     C           WBRAT     ANDEQ*ZEROS                                                        CLE036
     C           WBSRT     ANDEQ*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C********** WDTL2     ANDEQ*BLANK                                                 184903 193701
     C           WDTL5     ANDEQ*BLANK                                                        219500
     C           VSLN      ANDLT20                                        184903
     C           *IN20     IFEQ '1'                                                           193701
     C                     MOVEL'LEE0059' ZAMSID                                              193701
     C                     ELSE                                                               193701
     C**********           SUB  1         WCNT                                         184903 193701
     C                     MOVEL'LEE0033' ZAMSID                          184903
     C                     ENDIF                                                              193701
     C                     EXSR SRTEXT                                    184903
     C                     MOVELZAMSTX    SNARR                           184903
     C                     MOVE 'CALC  '  SNARR                           186995
      *                                                                   186995
      ** Use the new calculation basis for rollover if inserted           186995
      *                                                                   186995
     C           NCAS      IFGT 0                                         186995
     C                     MOVE NCAS      SNARR                           186995
     C                     ELSE                                           186995
     C                     MOVE ICBS      SNARR                           186995
     C                     ENDIF                                          186995
      *                                                                                    AR1071639
      ** Display a negative rate properly.                                                 AR1071639
      *                                                                                    AR1071639
     C           WRSPR     IFLT 0                                                          AR1071639
     C                     MOVE 'Y'       WSUB    1                                        AR1071639
     C                     Z-SUBWRSPR     WRSPR                                            AR1071639
     C                     ENDIF                                                           AR1071639
      *                                                                   186995
     C                     MOVE WRSPR     ZFIELD                          184903
     C                     Z-ADD7         ZADEC                           184903
     C                     EXSR ZEDIT                                     184903
      *                                                                                    AR1071639
     C           WSUB      IFEQ 'Y'                                                        AR1071639
     C                     MOVE *BLANKS   WSUB                                             AR1071639
     C                     MOVE ZFIELD    WFLD1  19                                        AR1071639
     C           WFLD1     CAT  '-'       WFLD2  20                                        AR1071639
     C                     MOVE WFLD2     SAMNT                                            AR1071639
     C                     ELSE                                                            AR1071639
     C                     MOVE ZFIELD    SAMNT                           184903
     C                     ENDIF                                                           AR1071639
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C**********           MOVE 'Y'       WDTL2                                        184903 193701
     C           WNOTWR    IFEQ *BLANK                                                        224646
     C           WFXCOF    ANDNE'Y'                                                         MD031378
     C                     EXSR SRDETL                                    184903
     C                     ENDIF                                                              224646
     C                     SUB  1         WCNT                                                193701
     C                     MOVE 'Y'       WDTL5                                               193701
      *                                                                   184903
     C********** VSLN      IFEQ 20                                                     184903 193701
     C********** WDTL5     IFEQ *BLANK                                                 184903 193701
     C********** WRSPR     ANDEQ*ZEROS                                                 184903 193701
     C********** WBRAT     ANDEQ*ZEROS                                                 184903 193701
     C********** WDTL3     OREQ *BLANK                                                 184903 193701
     C********** NPRAM     ANDNE*ZEROS                                                 184903 193701
     C********** WDTL4     OREQ *BLANK                                                 184903 193701
     C********** NPRAM     ANDNE*ZEROS                                                 184903 193701
     C           VSLN      IFGE 20                                                            193701
     C           WDTL6     IFEQ *BLANK                                                        193701
     C           NPRAM     ANDNE*ZEROS                                                        193701
     C           WDTL9     OREQ *BLANK                                                        218984
     C           NPRAM     ANDNE*ZEROS                                                        218984
     C           WDTL7     OREQ *BLANK                                                        193701
     C           NDAM      ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        193701
     C           WRSPR     ANDNE*ZEROS                                                        193701
     C           WBRAT     ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        CLE036
     C           WRSPR     ANDNE*ZEROS                                                        CLE036
     C           WBSRT     ANDNE*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     MOVE 'Y'       WSAME                           184903
     C                     ENDIF                                          184903
     C                     ENDIF                                          184903
     C                     ENDIF                                          184903
      *                                                                   184903
      ** ... principal and discount                                       184903
      *                                                                   184903
     C           NPRAM     IFNE *ZEROS                                    184903
     C           WDTL6     ANDEQ*BLANK                                                        193701
     C           VSLN      ANDLT20                                        184903
     C********** WDTL3     IFEQ *BLANK                                                 184903 193701
      *                                                                                       218984
      ** If the principal rolled over is different from the current principal,                218984
      ** put out a line to show the Increase or Repayment amount.                             218984
      *                                                                                       218984
     C           WDTL9     IFEQ *BLANK                                                        218984
     C                     SUB  1         WCNT                                                219500
     C           NPRAM     IFNE WCUPR                                                         218984
     C           *IN20     ANDEQ'0'                                                           219717
     C           NPRAM     ORNE WNCUPR                                                        219717
     C           *IN20     ANDEQ'1'                                                           219717
     C           *IN20     IFEQ '0'                                                           219717
     C           WCUPR     SUB  NPRAM     RODIFF                                              218984
     C                     ELSE                                                               219717
     C           WNCUPR    SUB  NPRAM     RODIFF                                              219717
     C                     ENDIF                                                              219717
     C           RODIFF    IFLT 0                                                             218984
     C                     MOVEL'LEE0313' ZAMSID                                              218984
     C                     Z-SUBRODIFF    RODIFF                                              218984
     C                     ELSE                                                               218984
     C                     MOVEL'LEE0314' ZAMSID                                              218984
     C                     ENDIF                                                              218984
     C                     EXSR SRTEXT                                                        218984
     C                     MOVELZAMSTX    SNARR                                               218984
     C                     Z-ADDRODIFF    ZFLD15                                              218984
     C                     EXSR ZSEDIT                                                        218984
     C                     MOVE ZOUT21    SAMNT                                               218984
     C                     EXSR SRDETL                                                        218984
     C                     MOVE 'Y'       WDTL9                                               218984
     C                     ENDIF                                                              218984
     C                     ENDIF                                                              218984
      *                                                                                       218984
     C           VSLN      IFLT 20                                                            222380
     C                     SUB  1         WCNT                            184903
     C           *IN20     IFEQ '0'                                                           219717
     C                     MOVEL'LEE0053' ZAMSID                          184903
     C                     EXSR SRTEXT                                    184903
     C                     MOVELZAMSTX    SNARR                           184903
     C                     Z-ADDNPRAM     ZFLD15                          184903
     C                     EXSR ZSEDIT                                    184903
     C                     MOVE ZOUT21    SAMNT                           184903
     C**********           MOVE 'Y'       WDTL3                                        184903 193701
     C           WNOTWR    IFEQ *BLANK                                                        224646
     C                     EXSR SRDETL                                    184903
     C                     ENDIF                                                              224646
     C                     ENDIF                                                              219717
     C                     MOVE 'Y'       WDTL6                                               193701
     C                     Z-ADDNPRAM     WCUPR                                               218984
     C                     ENDIF                                                              222380
      *                                                                   184903
     C********** VSLN      IFEQ 20                                                     184903 193701
     C********** WDTL5     IFEQ *BLANK                                                 184903 193701
     C********** WRSPR     ANDEQ*ZEROS                                                 184903 193701
     C********** WBRAT     ANDEQ*ZEROS                                                 184903 193701
     C********** WDTL4     OREQ *BLANK                                                 184903 193701
     C********** NPRAM     ANDNE*ZEROS                                                 184903 193701
     C           VSLN      IFGE 20                                                            193701
     C           WDTL7     IFEQ *BLANK                                                        193701
     C           NDAM      ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        193701
     C           WRSPR     ANDNE*ZEROS                                                        193701
     C           WBRAT     ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        CLE036
     C           WRSPR     ANDNE*ZEROS                                                        CLE036
     C           WBSRT     ANDNE*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     MOVE 'Y'       WSAME                           184903
     C                     ENDIF                                          184903
     C                     ENDIF                                          184903
     C                     ENDIF                                          184903
      *                                                                   184903
     C********** WDTL4     IFEQ *BLANK                                                 184903 193701
     C********** VSLN      ANDNE20                                                     184903 193701
     C           WDTL7     IFEQ *BLANK                                                        193701
     C           NDAM      ANDNE*ZEROS                                                        193701
     C           VSLN      ANDLT20                                                            193701
     C                     SUB  1         WCNT                            184903
     C                     MOVEL'LEE0054' ZAMSID                          184903
     C                     EXSR SRTEXT                                    184903
     C                     MOVELZAMSTX    SNARR                           184903
     C                     Z-ADDNDAM      ZFLD15                          184903
     C                     EXSR ZSEDIT                                    184903
     C                     MOVE ZOUT21    SAMNT                           184903
     C**********           MOVE 'Y'       WDTL4                                        184903 193701
     C           WNOTWR    IFEQ *BLANK                                                        224646
     C                     EXSR SRDETL                                    184903
     C                     ENDIF                                                              224646
     C                     MOVE 'Y'       WDTL7                                               193701
      *                                                                   184903
     C********** VSLN      IFEQ 20                                                     184903 193701
     C********** WDTL5     OREQ *BLANK                                                 184903 193701
     C********** WRSPR     ANDEQ*ZEROS                                                 184903 193701
     C********** WBRAT     ANDEQ*ZEROS                                                 184903 193701
     C           VSLN      IFGE 20                                                            193701
     C           WDTL8     IFEQ *BLANK                                                        193701
     C           WRSPR     ANDNE*ZEROS                                                        193701
     C           WBRAT     ANDNE*ZEROS                                                        193701
     C           WDTL8     OREQ *BLANK                                                        CLE036
     C           WRSPR     ANDNE*ZEROS                                                        CLE036
     C           WBSRT     ANDNE*ZEROS                                                        CLE036
     C           CLE036    ANDEQ'Y'                                                           CLE036
     C                     MOVE 'Y'       WSAME                           184903
     C                     ENDIF                                          184903
     C                     ENDIF                                          184903
      *                                                                   184903
     C                     ENDIF                                          184903
     C                     ENDIF                                                              193701
      *                                                                   184903
      ** ... new spread rate                                              184903
      *                                                                   184903
     C********** WRSPR     IFGT *ZEROS                                              184903 AR1071639
     C********** WBRAT     ANDGT*ZEROS                                              184903 AR1071639
     C           WRSPR     IFNE *ZEROS                                                     AR1071639
     C           WBRAT     ANDNE*ZEROS                                                     AR1071639
     C********** WDTL5     ANDEQ*BLANK                                                 184903 193701
     C           WDTL8     ANDEQ*BLANK                                                        193701
     C           VSLN      ANDLT20                                        184903
     C           CLE036    OREQ 'Y'                                                           CLE036
     C           WRSPR     ANDGT*ZEROS                                                        CLE036
     C           WBSRT     ANDGT*ZEROS                                                        CLE036
     C           WDTL8     ANDEQ*BLANK                                                        CLE036
     C           VSLN      ANDLT20                                                            CLE036
     C                     SUB  1         WCNT                            184903
      *                                                                   188382
      ** If New Spread Indicator is blank and spread rate is displayed    188382
      ** move original spread indicator.                                  188382
      *                                                                   188382
     C                     MOVE NSIN      WNSIN   1                       188382
     C           NSIN      IFEQ *BLANK                                    188382
     C                     MOVE SPIN      NSIN                            188382
     C                     ENDIF                                          188382
      *                                                                   188382
     C                     SELEC                                          184903
     C           NSIN      WHEQ 'A'                                       184903
     C           *IN20     IFEQ '1'                                                           193701
     C                     MOVEL'LEE0060' ZAMSID                                              193701
     C                     ELSE                                                               193701
     C                     MOVEL'LEE0034' ZAMSID                          184903
     C                     ENDIF                                                              193701
     C           NSIN      WHEQ 'S'                                       184903
     C           *IN20     IFEQ '1'                                                           193701
     C                     MOVEL'LEE0061' ZAMSID                                              193701
     C                     ELSE                                                               193701
     C                     MOVEL'LEE0035' ZAMSID                          184903
     C                     ENDIF                                                              193701
     C           NSIN      WHEQ 'P'                                       184903
     C           *IN20     IFEQ '1'                                                           193701
     C                     MOVEL'LEE0062' ZAMSID                                              193701
     C                     ELSE                                                               193701
     C                     MOVEL'LEE0036' ZAMSID                          184903
     C                     ENDIF                                                              193701
     C                     ENDSL                                          184903
      *                                                                   188382
      ** Move back original New Spread Indicator.                         188382
      *                                                                   188382
     C                     MOVE WNSIN     NSIN                            188382
      *                                                                   188382
     C                     EXSR SRTEXT                                    184903
     C                     MOVELZAMSTX    SNARR                           184903
     C                     MOVE WRSPR     ZFIELD                          184903
     C                     Z-ADD7         ZADEC                           184903
     C                     EXSR ZEDIT                                     184903
     C                     MOVE ZFIELD    SAMNT                           184903
     C                     MOVE *BLANKS   ZFIELD                                            AR742875
     C**********           MOVE 'Y'       WDTL5                                        184903 193701
     C           WNOTWR    IFEQ *BLANK                                                        224646
     C           WFXCOF    ANDNE'Y'                                                         MD031378
     C                     EXSR SRDETL                                    184903
     C                     ENDIF                                                              224646
     C                     MOVE 'Y'       WDTL8                                               193701
     C                     ENDIF                                          184903
      *                                                                   184903
     C           WCNT      IFEQ 0                                         184903
     C                     MOVE '0'       WRLDS                           184903
     C                     MOVE ' '       WDTL1                           184903
     C                     MOVE ' '       WDTL2                           184903
     C                     MOVE ' '       WDTL3                           184903
     C                     MOVE ' '       WDTL4                           184903
     C                     MOVE ' '       WDTL5                           184903
     C                     MOVE ' '       WDTL6                                               193701
     C                     MOVE ' '       WDTL7                                               193701
     C                     MOVE ' '       WDTL8                                               193701
     C                     MOVE ' '       WDTL9                                               218984
     C**********           Z-ADD*ZERO     RLDT                                        BUG9240 246037
     C           WRKFLD    IFEQ 'M'                                                         BUG21922
     C           WENDT     ANDNE99999                                                      MD039391A
     C           WRKFLD    OREQ 'M'                                                        MD039391A
     C           WENDT     ANDEQ99999                                                      MD039391A
     C           VSLN      ANDLT20                                                         MD039391A
     C                     Z-ADD*ZERO     RLDT                                                260274
     C                     ENDIF                                                            BUG21922
     C                     ELSE                                                               193701
     C                     MOVE '0'       WROLL                                               193701
     C                     ENDIF                                          184903
      *                                                                   184903
     C                     MOVE WCALI     FCALI                           184903
     C                     MOVE WCALR     FCALR                           184903
      *                                                                                       207961
     C                     ENDIF                                                              207961
      *                                                                                      BUG9240
      ** Update new rate to calculate correctly the interest after                           BUG9240
      ** rollover date                                                                       BUG9240
      *                                                                                      BUG9240
     C           CAS005    IFEQ 'Y'                                                          BUG9240
     C           NSIN      IFNE *BLANK                                                       BUG9240
     C                     MOVE NSIN      WCUSI                                              BUG9240
     C                     ENDIF                                                             BUG9240
     C           NRTS      IFNE *ZERO                                                        BUG9240
     C                     Z-ADDNRTS      WCUSP                                              BUG9240
     C                     ENDIF                                                             BUG9240
     C           NCAS      IFNE *ZERO                                                       BUG22332
     C                     Z-ADDNCAS      OICBS                                             BUG22332
     C                     ENDIF                                                            BUG22332
     C           WWBRTE    IFNE *ZERO                                                        BUG9240
     C                     Z-ADDWWBRTE    WCUBR                                              BUG9240
     C                     ENDIF                                                             BUG9240
      * Get the Base Rate History (override the previous one)                                 239062
     C           CLE011    IFEQ 'Y'                                                           239062
     C**********           MOVE CCY       ZCCY                                         239062 244453
     C                     MOVE PKEY1     ZCCY                                                244453
     C**********           MOVE BRTT      WBRTT                                      239062 BUG22332
     C                     MOVE PKEY2     WBRTT                                             BUG22332
     C                     EXSR SRBRFZ                                                        239062
     C                     ENDIF                                                              239062
      *                                                                                       239062
     C                     EXSR SRNEWI                                                       BUG9240
     C                     ENDIF                                                             BUG9240
      *                                                                                       238722
     C           WWRLDT    IFGT 0                                                             238722
     C           NCCY      ANDNE*BLANKS                                                       238722
     C                     Z-ADD*ZERO     WINCA                                               238722
     C                     Z-ADD*ZERO     WCALC                                               238722
     C                     Z-ADD*ZERO     WINPD                                               238722
     C                     Z-ADD*ZERO     WIPAID                                              238722
     C                     ENDIF                                                              238722
      *                                                                   184903
     C/COPY WNCPYSRC,LEH00906
     C                     ENDSR                                          184903
      /EJECT                                                              184903
      *****************************************************************                       238722
      *                                                               *                       238722
      *  CONCCY - Subroutine to convert amounts to new ccy equivalent *                       238722
      *                                                               *                       238722
      *  Called By: SRLOAM- Processes loan amendment records          *                       238722
      *                                                               *                       238722
      *  Calls:     SRCONV                                            *                       238722
      *                                                               *                       238722
      *****************************************************************                       238722
      *                                                                                       238722
     C           CONCCY    BEGSR                                                              238722
      *                                                                                       238722
     C           CCYCL     IFNE NCCY                                                          238722
     C           NCCY      ANDEQBKEURO                                                        238722
     C           WINCY1    ANDEQ'Y'                                                           238722
     C           CCYCL     ORNE NCCY                                                          238722
     C           CCYCL     ANDEQBKEURO                                                        238722
     C           WINCY2    ANDEQ'Y'                                                           238722
      *                                                                                       238722
      ** Check for events with total amount value, need to convert                            238722
      ** both INTA and PRAML for MR events.                                                   238722
     C                     Z-ADDPRAML     PFRAM                                               238722
     C                     MOVE CCYCL     PFRCY                                               238722
     C                     MOVE NCCY      PTOCY                                               238722
     C                     EXSR SRCONV                                                        238722
      *                                                                                       238722
     C                     ELSE                                                               238722
      *                                                                                       238722
      ** Convert loan events currency to new currency equivalent                              238722
      *                                                                                       238722
     C           CCYL      IFEQ CCYCL                                                         238722
     C           *IN10     OREQ '1'                                                           238722
     C                     Z-ADDXRATE1    ZRATE1 138                                          238722
     C                     MOVE WMDIV1    ZMDI1   1                                           238722
     C                     Z-ADDXRATE2    ZRATE2 138                                          238722
     C                     MOVE WMDIV2    ZMDI2   1                                           238722
     C                     EXSR ZXRATE                                                        238722
      *                                                                                       238722
     C           *IN10     IFEQ '1'                                                           238722
     C           REPTL     IFLT 3                                                             238722
     C                     Z-ADDWPRAML    ZAMTCI                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDWTAMTL    ZAMTCI                                              238722
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     ELSE                                                               238722
     C           REPTL     IFLT 3                                                             238722
     C                     Z-ADDPRAML     ZAMTCI                                              238722
     C                     ELSE                                                               238722
     C                     Z-ADDTAMTL     ZAMTCI                                              238722
     C                     ENDIF                                                              238722
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C           AMTPL     IFEQ 'MR'                                                          238722
     C                     Z-ADD1         WCTR    10                                          238722
     C                     ELSE                                                               238722
     C                     Z-ADD4         WCTR                                                238722
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C           WCTR      DOWLE4                                                             238722
     C                     ADD  1         WCTR                                                238722
     C                     Z-ADDZRATEX    ZEXCH                                               238722
     C                     MOVE CCYCL     ZCCYI                                               238722
     C                     MOVE NCCY      ZCCYO                                               238722
     C                     MOVE WNDEC1    ZCDPI                                               238722
     C                     MOVE WNDEC2    ZCDPO                                               238722
     C                     MOVE ZMDIX     ZMD                                                 238722
      *                                                                                       238722
     C                     EXSR ZCONV                                                         238722
      *                                                                                       238722
     C           AMTPL     IFEQ 'MR'                                                          238722
     C                     SELEC                                                              238722
     C           WCTR      WHEQ 2                                                             238722
     C                     Z-ADDZAMTCO    WZAMTC                                              238722
     C                     Z-ADDINTAL     ZAMTCI                                              238722
     C           WCTR      WHEQ 3                                                             238722
     C                     Z-ADDZAMTCO    WINTAL                                              238722
     C                     Z-ADDWTXAL     ZAMTCI                                              238722
     C           WCTR      WHEQ 4                                                             238722
     C                     Z-ADDZAMTCO    WWTXAL                                              238722
     C                     Z-ADDFEAML     ZAMTCI                                              238722
     C           WCTR      WHEQ 5                                                             238722
     C                     Z-ADDZAMTCO    WFEAML                                              238722
     C                     Z-ADDWZAMTC    ZAMTCO                                              238722
     C                     ENDSL                                                              238722
     C                     ENDIF                                                              238722
     C                     ENDDO                                                              238722
      *                                                                                       238722
     C                     ENDIF                                                              238722
     C                     ENDIF                                                              238722
      *                                                                                       238722
     C                     ENDSR                                                              238722
      /EJECT                                                                                  238722
      *****************************************************************                       238722
      *****************************************************************                       193701
      *                                                               *                       193701
      *  SRCONV - Subroutine to convert amounts to Euro ccy equivalent*                       193701
      *                                                               *                       193701
      *  Called By: SRRDAT- Processes future rollovers(incl.multi-ccy)*                       193701
      *                                                               *                       193701
      *  Calls:     *PSSR - Program Error Processing                  *                       193701
      *                                                               *                       193701
      *****************************************************************                       193701
      *                                                                                       193701
     C           SRCONV    BEGSR                                                              193701
      *                                                                                       193701
     C                     CALL 'EU0200'                                                      193701
     C                     PARM *BLANKS   PRTCD   7                                           193701
     C                     PARM           PFRAM  183                                          193701
     C                     PARM           PFRCY   3                                           193701
     C                     PARM           PTOCY   3                                           193701
     C                     PARM           POUTA  150                                          193701
     C                     PARM           PINTA  183                                          193701
     C                     PARM           PEXRT  159                                          193701
     C                     PARM           PMDIN   1                                           193701
      *                                                                                       193701
      ** Handle Error                                                                         193701
      *                                                                                       193701
     C           PRTCD     IFNE *BLANKS                                                       193701
     C                     MOVEL'EU0200  'DBFILE           ************                       193701
     C                     MOVEL'*CALL   'DBKEY            * DBERR 6  *                       193701
     C                     Z-ADD6         DBASE            ************                       193701
     C                     SETON                     U7U8LR                                   193701
     C                     EXSR *PSSR                                                         193701
     C                     ENDIF                                                              193701
      *                                                                                       193701
     C                     ENDSR                                                              193701
      /EJECT                                                                                AR583389
      *****************************************************************                     AR583389
      *                                                               *                     AR583389
      *    SRNXT - CALCULATE NEXT INTEREST DATE                       *                     AR583389
      *                                                               *                     AR583389
      *    CALLED BY: S/R SRLOAN                                      *                     AR583389
      *                                                               *                     AR583389
      *    CALLS:                                                     *                     AR583389
      *                                                               *                     AR583389
      *****************************************************************                     AR583389
     C           SRNXT     BEGSR                                                            AR583389
     C                     Z-ADDTODAT     ZDAYNO                                            AR583389
     C                     MOVE IPFR      ZFREQ                                             AR583389
     C                     Z-ADDIFDY      ZMDAY                                             AR583389
     C                     MOVE CCYCL     ZCCY                                              AR583389
     C                     MOVE WNLOC     ZLOC                                              AR583389
      *                                                                                     AR583389
      ** If CLE005 is installed, take into consideration payment due                        AR583389
      ** date, thus allowing end date to fall on a holiday                                  AR583389
      *                                                                                     AR583389
     C           CLE005    IFEQ 'Y'                                                         AR583389
      *                                                                                     AR583389
      ** If rolldown restore original maturity date                                         AR583389
      *                                                                                     AR583389
     C           *IN09     IFEQ *ON                                                         AR583389
     C                     Z-ADDWMYEAR    ZYEAR                                             AR583389
     C                     Z-ADDWMMTH     ZMTH                                              AR583389
     C                     Z-ADDWMDAY     ZDAY                                              AR583389
     C                     ENDIF                                                            AR583389
      *                                                                                     AR583389
      ** If interest payment frequency is 'R', means 'at rollover' -                        AR583389
      ** actual interest frequency and interest payment date will be                        AR583389
      ** the same as rollover setup.                                                        AR583389
      *                                                                                     AR583389
     C           IPFR      IFEQ 'R'                                                         AR583389
     C                     MOVE RLFQ      ZFREQ                                             AR583389
     C                     Z-ADDRLDY      ZMDAY                                             AR583389
     C                     ENDIF                                                            AR583389
      *                                                                                     AR583389
     C                     EXSR ZFRQB3                                                      AR583389
     C           WDTIN     IFNE 0                                                           AR583389
     C                     Z-ADDWKYEAR    ZYEAR                                             AR583389
     C                     ENDIF                                                            AR583389
     C                     Z-ADDZDAYNO    W#NEXT  50                                        AR583389
     C                     Z-ADDZDAYNO    WINDNO                                            AR583389
     C                     Z-ADD*ZEROS    ZNRDYS                                            AR583389
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** MDST      ANDEQ01                                                    CLE141 CLE141A
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** MDST      ANDEQ07                                                    CLE141 CLE141A
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** MDST      ANDEQ08                                                    CLE141 CLE141A
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM PDDI      PPAYC   1                                           CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT   50                                          CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     SELEC                                                            AR583389
     C           PDDI      WHEQ 'P'                                                         AR583389
     C                     EXSR ZBKDT                                                       AR583389
     C           PDDI      WHEQ 'N'                                                         AR583389
     C                     EXSR ZFWDT                                                       AR583389
     C           PDDI      WHEQ 'A'                                                         AR583389
     C                     Z-ADDZDAYNO    ZDYNBR                                            AR583389
     C           PDDI      WHEQ 'M'                                                         AR583389
     C           PDDI      OREQ *BLANK                                                      AR583389
     C                     EXSR ZDATE2                                                      AR583389
     C           *IN98     IFEQ *OFF                                                        AR583389
     C                     MOVE ZDATE     MMYY    40P                                       AR583389
     C                     MOVELMMYY      MMNLCD  20P                                       AR583389
     C                     ELSE                                                             AR583389
     C                     MOVELZDATE     MMNLCD    P                                       AR583389
     C                     ENDIF                                                            AR583389
     C                     Z-ADDZDAYNO    @DAYNO  50                                        AR583389
     C                     EXSR ZFWDT                                                       AR583389
     C                     Z-ADDZDYNBR    ZDAYNO                                            AR583389
     C                     EXSR ZDATE2                                                      AR583389
     C           *IN98     IFEQ *OFF                                                        AR583389
     C                     MOVE ZDATE     MMYY      P                                       AR583389
     C                     MOVELMMYY      MMNWKD  20P                                       AR583389
     C                     ELSE                                                             AR583389
     C                     MOVELZDATE     MMNWKD    P                                       AR583389
     C                     ENDIF                                                            AR583389
     C           MMNLCD    IFNE MMNWKD                                                      AR583389
     C                     Z-ADD@DAYNO    ZDAYNO                                            AR583389
     C                     EXSR ZBKDT                                                       AR583389
      *                                                                                     AR583389
      ** If the next interest payment date falls on last interest                           AR583389
      ** date computed by the system, change the next interest payment                      AR583389
      ** date to next working day even if it is not on the same month.                      AR583389
      *                                                                                     AR583389
     C           ZDYNBR    IFEQ IACD                                                        AR583389
     C                     EXSR ZFWDT                                                       AR583389
     C                     ENDIF                                                            AR583389
      *                                                                                     AR583389
     C                     ENDIF                                                            AR583389
     C                     ENDSL                                                            AR583389
     C                     ENDIF                                                              CLE141
     C                     Z-ADDZDYNBR    WENDI   50                                        AR583389
      *                                                                                     AR583389
      ** Also, when interest is not capitalised, compute for the date                       AR583389
      ** when payment is to be taken if due date, falls on a holiday                        AR583389
      *                                                                                     AR583389
     C           SCAPI     IFEQ ' NO'                                                       AR583389
     C                     Z-ADDZDYNBR    ZDAYNO                                            AR583389
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** MDST      ANDEQ01                                                    CLE141 CLE141A
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** MDST      ANDEQ07                                                    CLE141 CLE141A
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** MDST      ANDEQ08                                                    CLE141 CLE141A
     C                     CALL 'LEZBDYCD'                                                    CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           CCYPI                                               CLE141
     C                     PARM           LOCPI                                               CLE141
     C                     PARM PTDI      PPAYC                                               CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           ZCCY                                               CLE141A
     C                     PARM           ZLOC                                               CLE141A
     C                     PARM *ZEROS    PAJDT                                               CLE141
     C                     Z-ADDPAJDT     ZDYNBR                                              CLE141
     C                     ELSE                                                               CLE141
     C                     SELEC                                                            AR583389
     C           PTDI      WHEQ 'P'                                                         AR583389
     C                     EXSR ZBKDT                                                       AR583389
     C           PTDI      WHEQ 'N'                                                         AR583389
     C                     EXSR ZFWDT                                                       AR583389
     C           PTDI      WHEQ 'M'                                                         AR583389
     C           PTDI      OREQ *BLANK                                                      AR583389
     C                     EXSR ZDATE2                                                      AR583389
     C           *IN98     IFEQ *OFF                                                        AR583389
     C                     MOVE ZDATE     MMYY    40P                                       AR583389
     C                     MOVELMMYY      MMNLCD  20P                                       AR583389
     C                     ELSE                                                             AR583389
     C                     MOVELZDATE     MMNLCD    P                                       AR583389
     C                     ENDIF                                                            AR583389
     C                     Z-ADDZDAYNO    @DAYNO  50                                        AR583389
     C                     EXSR ZFWDT                                                       AR583389
     C                     Z-ADDZDYNBR    ZDAYNO                                            AR583389
     C                     EXSR ZDATE2                                                      AR583389
     C           *IN98     IFEQ *OFF                                                        AR583389
     C                     MOVE ZDATE     MMYY      P                                       AR583389
     C                     MOVELMMYY      MMNWKD  20P                                       AR583389
     C                     ELSE                                                             AR583389
     C                     MOVELZDATE     MMNWKD    P                                       AR583389
     C                     ENDIF                                                            AR583389
     C           MMNLCD    IFNE MMNWKD                                                      AR583389
     C                     Z-ADD@DAYNO    ZDAYNO                                            AR583389
     C                     EXSR ZBKDT                                                       AR583389
      *                                                                                     AR583389
      ** If the next interest payment date falls on last interest                           AR583389
      ** date computed by the system, change the next interest payment                      AR583389
      ** date to next working day even if it is not on the same month.                      AR583389
      *                                                                                     AR583389
     C           ZDYNBR    IFEQ WLICD                                                       AR583389
     C                     EXSR ZFWDT                                                       AR583389
     C                     ENDIF                                                            AR583389
      *                                                                                     AR583389
     C                     ENDIF                                                            AR583389
     C                     ENDSL                                                            AR583389
     C                     ENDIF                                                              CLE141
     C                     ENDIF                                                            AR583389
      *                                                                                     AR583389
     C                     Z-ADDWENDI     W#NEXT                                            AR583389
     C                     Z-ADDZDYNBR    WENDI                                             AR583389
      *                                                                                     AR583389
     C                     ENDIF                                                            AR583389
     C                     ENDSR                                                            AR583389
      /EJECT                                                                                  193701
      *****************************************************************
      *                                                               *
      * *PSSR  - Subroutine to handle abnormal error conditions       *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
     C           @RUN      IFEQ *BLANKS
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
      *
      ** If called as linked enquiry, set return code to 'E' and
      ** execute end of program processing
      *
     C           *IN15     IFEQ '1'
     C                     MOVE 'E'       RTNDWF
     C                     EXSR SRRETR
     C                     END
     C                     END
      *
     C                     ENDSR
      /EJECT
      *****************************************************************
      * SRRETR  -  Standard subroutine to end linked enquiry          *
      * Called by: SRCMDV - Process command keys                      *
      *            *PSSR  - Error processing                          *
      * Calls    : None                                               *
      *****************************************************************
     C           SRRETR    BEGSR
      *
     C                     MOVE 'Y'       WEXIT
     C                     MOVE '1'       *INLR
      *
      * Access EM data area
      *
     C           *LOCK     IN   EMSDS
     C                     MOVE RTNDWF    RETND
     C                     OUT  EMSDS
      *
     C                     RETRN
      *
     C                     ENDSR
      /EJECT                                                                                  219717
      *****************************************************************                       219717
      * SRSTAL  -  Check for Settlement Allocations:                  *                       219717
      * Called by: SRLOAN - Set up Loan Header details                *                       219717
      *            *PSSR  - Error processing                          *                       219717
      * Calls    : None                                               *                       219717
      *****************************************************************                       219717
     C           SRSTAL    BEGSR                                                              219717
     C                     MOVE 'N'       WRKFLD  1                                           219717
      *                                                                                       219717
     C           *IN18     IFEQ '1'                                                           219717
     C                     MOVE 'P'       W#PYRC  1                                           219717
     C                     ELSE                                                               219717
     C                     MOVE 'R'       W#PYRC                                              219717
     C                     ENDIF                                                              219717
      *                                                                                       219717
     C                     MOVE LNRF      PLNRF                                               219717
     C                     CALL 'AOSTALR2'                                                    219717
     C                     PARM *BLANKS   STALCD  7                                           219717
     C                     PARM '*FIRST ' POPTN   7                                           219717
     C                     PARM 'LOAN'    PTYPE                                               219717
     C                     PARM           PLNRF   6                                           219717
     C                     PARM *BLANKS   PVDAT   5                                           219717
     C                     PARM *BLANKS   PLASN   3                                           219717
     C                     PARM *BLANKS   FECUS   6                                           219717
     C                     PARM *BLANKS   FEFAC   5                                           219717
     C                     PARM *BLANKS   FESEQ   2                                           219717
     C                     PARM W#PYRC    PPYRC   1                                           219717
     C           LESTAL    PARM *BLANKS   DSSDY                                               219717
     C*                                                                                       219717
     C           STALCD    IFNE *BLANKS                                                       219717
     C                     MOVEL'LESTALPD'DBFILE           ***************                    219717
     C                     MOVELLNRF      DBKEY            *** DB 051 ****                    219717
     C                     Z-ADD51        DBASE            ***************                    219717
     C                     SETON                     U7U8LR                                   219717
     C                     EXSR *PSSR                                                         219717
     C                     ENDIF                                                              219717
     C*                                                                                       219717
     C           WRKFLD    DOWEQ'N'                                                           219717
     C                     CALL 'AOSTALR2'                                                    219717
     C                     PARM *BLANKS   STALCD  7                                           219717
     C                     PARM '*NEXT  ' POPTN   7                                           219717
     C                     PARM 'LOAN'    PTYPE   4                                           219717
     C                     PARM           PLNRF   6                                           219717
     C                     PARM *BLANKS   PVDAT   5                                           219717
     C                     PARM *BLANKS   PLASN   3                                           219717
     C                     PARM *BLANKS   FECUS   6                                           219717
     C                     PARM *BLANKS   FEFAC   5                                           219717
     C                     PARM *BLANKS   FESEQ   2                                           219717
     C                     PARM W#PYRC    PPYRC   1                                           219717
     C           LESTAL    PARM *BLANKS   DSSDY                                               219717
     C*                                                                                       219717
     C* Last allocation read by AOSTALR2 is the largest.                                      219717
     C           STALCD    IFEQ '*EOF'                                                        219717
     C                     MOVE 'Y'       WRKFLD                                              219717
     C           W#PYRC    IFEQ 'R'                                                           219717
     C                     MOVE STRSTM    MDST                                                219717
     C                     MOVE RSCY      SCCYCL                                              219717
     C                     MOVE RONS      OMDA                                                219717
     C                     ELSE                                                               219717
     C                     MOVE STPSTM    MDST                                                219717
     C                     MOVE PSCY      PSCYCL                                              219717
     C                     MOVE PONS      OMDA                                                219717
     C                     ENDIF                                                              219717
     C                     ENDIF                                                              219717
     C                     ENDDO                                                              219717
      *                                                                                       219717
     C                     ENDSR                                                              219717
      /EJECT
      *****************************************************************                       193701
      * SRCURR  -  Get Currency Details                               *                       193701
      * Called by: SRRDAT - Display Rollover Details                  *                       193701
      * Calls    : None                                               *                       193701
      *****************************************************************                       193701
     C           SRCURR    BEGSR                                                              193701
      *                                                                                       193701
      **  No need to access currencies file to get details of the 'TO'   .                    193701
      **  currency.                                                                           193701
      *                                                                                       193701
     C                     MOVE *BLANKS   PRTCD                                               193701
     C           CCYCL     IFNE NCCY                                                          193701
      *                                                                                       193701
     C                     CALL 'AOCURRR0'                                                    193701
     C                     PARM           PRTCD                                               193701
     C                     PARM '*KEY    'POPTN                                               193701
     C                     PARM           PCURR   3                                           193701
     C           SDCURR    PARM SDCURR    DSSDY                                               193701
      *                                                                                       193701
     C           PRTCD     IFNE *BLANKS                                                       193701
     C                     MOVEL'SDCURRPD'DBFILE           ************                       193701
     C                     Z-ADD27        DBASE            * DBERR 27 *                       193701
     C                     MOVELNCCY      DBKEY            ************                       193701
     C                     EXSR *PSSR                                                         193701
     C                     ELSE                                                               193701
     C                     Z-ADDA6NBDP    WNDEC2  10                                          193701
     C                     MOVE A6INCY    WINCY2  1                                           193701
     C                     ENDIF                                                              193701
      *                                                                                       193701
     C                     ENDIF                                                              193701
      *                                                                                       193701
     C                     ENDSR                                                              193701
      /EJECT                                                                                  193701
      *****************************************************************                       239062
      * SRBRFZ  -  Get Base rate history                              *                       239062
      * Called by:                                                    *                       239062
      * Calls    : AOBSHSR0                                           *                       239062
      *****************************************************************                       239062
     C           SRBRFZ    BEGSR                                                              239062
      *                                                                                       239062
     C                     MOVE *BLANK    ZLOC                                                239062
     C                     MOVE RFDY      ZNRDYS                                              239062
     C                     EXSR ZBKDT                                                         239062
     C                     Z-ADDZDYNBR    WDAYN   50                                          239062
      *                                                                                       239062
     C                     CALL 'AOBSHSR0'                                                    239062
     C                     PARM *BLANK    @RTCD                                               239062
     C                     PARM '*KEY    'POPTN                                               239062
     C                     PARM           ZCCY                                                239062
     C                     PARM           WBRTT                                               239062
     C                     PARM           WDAYN                                               239062
     C           SDBSHS    PARM           SDBSHS                                              239062
      *                                                                                       239062
     C           @RTCD     IFEQ *BLANK                                                        239062
     C           CHIN      ANDNE'N'                                                         MD025520
     C                     Z-ADDG0CBSR    WCUBR  117                                          239062
     C           BAVDNR    IFGE G0HIDT                                                      MD039651
     C           BAVDNR    ANDLEWDAYN                                                       MD039651
     C                     MOVE 'Y'       USENEW                                            MD039651
     C                     ENDIF                                                            MD039651
     C                     ENDIF                                                              239062
      *                                                                                       239062
     C                     ENDSR                                                              239062
     C/COPY WNCPYSRC,LEH00869
      /EJECT                                                                                  239062
     C/COPY ZSRSRC,ZALIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZDATE1Z2
      /EJECT
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C/COPY ZSRSRC,GLINTCZ1
      /EJECT
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
     C/COPY ZSRSRC,ZSAVEZ1
      /EJECT
     C/COPY ZSRSRC,ZRSTORZ1
      /EJECT
     C/COPY ZSRSRC,ZFLACZ2
      /EJECT
     C/COPY ZSRSRC,ZINTDYZ2
      /EJECT
     C/COPY ZSRSRC,ZDATE9Z3
      /EJECT
     C/COPY ZSRSRC,ZACCH
      /EJECT
     C/COPY ZSRSRC,ZCHKH
      /EJECT
     C/COPY ZSRSRC,ZFREQBZ2
      /EJECT
     C/COPY ZSRSRC,ZFWDT
      /EJECT
     C/COPY ZSRSRC,ZBKDT
      /EJECT
     C/COPY ZSRSRC,ZFRQB3
      /EJECT                                                                                  CLE028
     C/COPY ZSRSRC,RULE78Z1                                                                   CLE028
      /EJECT
     C/COPY ZSRSRC,ZXRATEZ1                                                                   193701
      /EJECT                                                                                  193701
     C/COPY ZSRSRC,ZCONVZ1                                                                    193701
      /EJECT                                                                                  193701
** CPY@   **     Copyright statement
(c) Misys International Banking Systems Ltd. 2001
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION                                           193701
0000001                                                                                       193701
0000010                                                                                       193701
0000100                                                                                       193701
0001000                                                                                       193701
0010000                                                                                       193701
0100000                                                                                       193701
1000000                                                                                       193701
