<<<<<<< HEAD
     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Facility activity enquiry (CA & Part)')       *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE0213 - Midas LE Facility Activity Enquiry (CA & Part.)     *
      *                                                               *
      *  Function:  This program writes records to file LEFCENPD when *
      *  (I/C)      facility being enquired is a CA or a participant  *
      *             facility                                          *
      *                                                               *
      *  Called By: LE0211 - Facility Activity Enquiry                *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD055733           Date 03Jul20               *
      *  Prev Amend No. MD055657           Date 14May20               *
      *                 AR674226           Date 04Dec19               *
      *                 MD053295           Date 13Apr19               *
      *                 MD050139           Date 23Mar18               *
      *                 MD046248           Date 27Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD044620           Date 10Apr17               *
      *                 CGL184             Date 07Dec16               *
      *                 CLE154             Date 07Aug12               *
      *                 240697             Date 06Mar15               *
      *                 AR936915           Date 07Oct14               *
      *                 AR830785           Date 07May13               *
      *                 AR996895           Date 25Nov12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CLE064             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CPK028             Date 01Jun07               *
      *                 247204             Date 26Apr07               *
      *                 246141             Date 26Mar07               *
      *                 246233             Date 07Mar07               *
      *                 245182             Date 29Jan07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CLE106             Date 17Mar05               *
      *                 CIR013             Date 25Apr05               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 215966             Date 17Mar03               *
      *                 207963             Date 08Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 205543             Date 12Jun02               *
      *                 204479             Date 26Apr02               *
      *                 204441             Date 25Apr02               *
      *                 204383             Date 25Apr02               *
      *                 204669             Date 24Apr02               *
      *                 204795             Date 24Apr02               *
      *                 201909             Date 24Apr02               *
      *                 204304             Date 24Apr02               *
      *                 204477             Date 24Apr02               *
      *                 204026             Date 24Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 189570             Date 16Oct01               *
      *                 189343             Date 11Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CLE014             Date 20Mar01               *
      *                 190124             Date 17Apr01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      *                 189088             Date 02Feb01               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 163331             Date 05Jul99               *
      *                 CLE009             Date 11May99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 162967             Date 25Jun99               *
      *                 157545             Date 23Mar99               *
      *                 156226             Date 09Mar99               *
      *                 154245             Date 25Feb99               *
      *                 154591             Date 09Feb99               *
      *                 148725             Date 02Feb99               *
      *                 154114             Date 28Jan99               *
      *                 151292             Date 21Jan99               *
      *                 147488             Date 08Dec98               *
      *                 128980  *CREATE    Date 02Dec98               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD055733 - COB: Multiple UTCHOBJEX calls in LEC06A           *
      *             components                                        *
      *           - Redeliver of MD050139.                            *
      *  MD055657 - Manual transaction from FFC TI Interface went to  *
      *             repair queue because the facility exchange rate is*
      *             longer than the defined facility exchange rate in *
      *             Midas. Increase the field definition of the Midas *
      *             facility exchange rate. (Recompile)               *
      *  AR674226 - Manual transaction reached 999. Increase the size *
      *             of utilisation sequence no. and transaction       *
      *             sequence. (Child: AR674227)                       *
      *           - Applied for MD054782.                             *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  MD044620 - Temporary files of LEFCENPD & LEFATRPD are being  *
      *             created in XPLIB. Remove previous defined array:  *
      *             'CLRPFM FILE(          )' and instead, clear new  *
      *             members passed. Remove part of fix AR936915.      *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  CLE154 - Loan Repayment Schedule Enhancement (Recompile)     *
      *  240697 - Recompiled due to changed LF/LEFCAML8.              *
      *  AR936915 - Syndicated facility filtered by From Date shows   *
      *             Facility Increase for Funding Part in Facility    *
      *             Activity Enquiry. Filter events of participants   *
      *             by date. Also, remove previous defined arrays:    *
      *             1. CLRPFM FILE(QTEMP/LEFCENPD)                    *
      *             2. CLRPFM FILE(QTEMP/LEFATRPD)                    *
      *             and instead, clear new filenames passed.          *
      *             (Child: AR936917)                                 *
      *           - Applied for MD030660                              *
      *  AR830785 - Looping on insert of accrued interest adjustment  *
      *             Extended core fix 263533. (Child: AR830786)       *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CPK028 - CNUM & PCNUM are now alpha fields.                  *
      *  247204 - Unactioned Facility Amendments for CA are not shown *
      *           on the Facility Activity Enquiry. Key values used   *
      *           to chain to LEFCAML8 in subr/SRCRAG are overwritten *
      *           with zero values in SRFACH.                         *
      *         - Corrected 246233 to retrieve the details of the     *
      *           original facility being processed because fields    *
      *           are being overriden after processing subr/SRPART.   *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  246233 - Primary facility history is not consistent in       *
      *           display.  Included FIs of the participants on       *
      *           display.                                            *
      *  245182 - Code should be 'P' for maturity when it passed run  *
      *           date.                                               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CLE106 - Syndication Manager                                 *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enahancements to CAS001, CAS002 and CAS004          *
      *           (Recompile)                                         *
      *  215966 - Program looping because WSTAC = 'Y' stops ZDAYNO    *
      *           increasing up to maturity date.                     *
      *  207963 - Include all of the repayment frequency in the       *
      *           projection of loan's maturity.                      *
      *           For loan amendments, if rept = '1' and RPSC, show   *
      *           the correct repayment amount (TAMT).                *
      *  205543 - Recompiled due to changed LF/LEFCAML8.              *
      *  204479 - Future-valued loans entered prior to rundate are    *
      *           not included in the enquiry.                        *
      *  204441 - Projected maturity event being displayed after loan *
      *           has been reversed                                   *
      *  204383 - Proj freq based repayments not reflected on enquiry *
      *  204669 - Display Past Due repayments of principal if code 'A'*
      *           or code 'P' is used to select records. Don't show   *
      *           maturity if it has gone Past Due. Don't show history*
      *           if code 'B' or code 'P' was used to select records. *
      *  204795 - Future valued repayment has been displayed prior to *
      *           the loans maturity date.  Recompiled due to change  *
      *           in LF/LEFCAML8.                                     *
      *  201909 - Do not report reversed Manual Utilisations or Loans.*
      *           If loan was reversed today, do not display any of   *
      *           its records from the facility history file.         *
      *  204304 - Reversed loan which started prior to today is still *
      *           shown on the enquiry.                               *
      *  204477 - MFU booked and reversed still shows in facility     *
      *           activity enquiry                                    *
      *  204026 - A Reversed Manual Facility Utilisation (MFU) should *
      *           no longer be shown in the FCAC enquiry.             *
      *  189570 - Populate the facility detail fields on LEFCENPD.    *
      *  189343 - Generate records for future loan maturity date and  *
      *           MFU expiry date.                                    *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *           Applied part of fix of 189343                       *
      *  190124 - Enquiry should not display reversed loans or MFUs.  *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  189088 - Manual Facility Utilisations against Tranches should*
      *           appear for the Credit Agreement. Reinstate some code*
      *           removed by 154591. LEFCENPD/L0 are now situated in  *
      *           QTEMP to avoid locking problems, so CLRPFM LEFCENPD *
      *           from QTEMP.                                         *
      *  163331 - Future dated utilisation start not showing if       *
      *           entered on the previous day.                        *
      *  CLE009 - LE I/C Swift Message Generation for Fees (Recompile)*
      *  162967 - No decription is shown for manual utilisation       *
      *  157545 - Manual interest payment is shown on facility        *
      *           activity enquiry.                                   *
      *  156226 - 'ALL' for branch field should also be accepted.     *
      *  154245 - Revolving Credit changes to facility not working    *
      *           properly                                            *
      *  154591 - Facility amendments and utilisation of tranches and *
      *           participants should not be shown when enquiring     *
      *           Credit Agreement facility. Also, show other faclty  *
      *           activity if loan has SC amendment.                  *
      *  148725 - Spread rate change amendment for loan shows blank   *
      *           narrative and zero rate on enquiry.                 *
      *  154114 - Fee activity enquiry should input immediately.      *
      *           Recompiled due to change in LEFCAML8.               *
      *  151292 - Repayment for a risk loan appearing on facility     *
      *           activity enquiry when 'Code' field is left blank.   *
      *  147488 - Difficulty in distinguishing a prime and a          *
      *           participant facility on Facility Activity Enquiry   *
      *  128980 - Tranche does not show historic details of           *
      *           participant transactions                            *
      *                                                               *
      *****************************************************************
     FLEFCAML8IF  E           K        DISK         KINFDS FSDS
     FLEFCAMLAIF  E           K        DISK                               CLE014
     F            LOAMSDKF                          KRENAMELOAMSDLA       CLE014
     FLELOANL7IF  E           K        DISK
     FLEMNFUL0IF  E           K        DISK                                                   204026
     F            LEMNFUPF                          KRENAMELEMNF13                            204026
     F*CLOANLB*IF  E           K        DISK                       147488 156226
     F*********** CLOANCLF                          KRENAMECLOANLBF147488 156226
     F*FCLTYL1*IF  E           K        DISK                              156226
     F*********** FCLTYFMF                          KRENAMEFCLTY          156226
     FLEMNFUL7IF  E           K        DISK                                                   189343
     F            LEMNFUPF                          KRENAMELEMNUPLJ                           189343
     FFACHSAL3IF  E           K        DISK                                                   189343
     F            FACHISAF                          KRENAMEFACHISLJ                           189343
     FCLOAN   IF  E           K        DISK                               156226
     F            CLOANCLF                          KRENAMECLOANF         156226
     F            CLOANHHF                          KIGNORE               156226
     F            CLOANCKF                          KIGNORE               156226
     F            CLOANZ1F                          KIGNORE               156226
     FFCLTY   IF  E           K        DISK                               156226
     F            FCLTYFMF                          KRENAMEFCLTYF         156226
     F            FCLTYHHF                          KIGNORE               156226
     F            FCLTYFNF                          KIGNORE               156226
     F            FCLTYZZF                          KIGNORE               156226
     FLEFCLTL9IF  E           K        DISK
     FLEFCLTLEIF  E           K        DISK                                                   204026
     F            FCLTYFMF                          KRENAMELEFCLTZ1                           204026
     FFACHSAL1IF  E           K        DISK
     F            FACHISAF                          KRENAMEFACHISA1
     FLOAMS   IF  E           K        DISK
     F            LOAMSDHF                          KIGNORE
     F            LOAMSDKF                          KRENAMELOAM
     F            LOAMSZ1F                          KIGNORE
     FHISLAML0IF  E           K        DISK                               CLE014
     F            LOAMSDKF                          KRENAMELOAMS213       CLE014
     FLEFCENPDO   E                    DISK         KCOMIT            UC
     FLEFATRPDO   E                    DISK         KCOMIT            UC                      189343
     FFCLTYFM IF  E           K        DISK         KINFSR *PSSR                              246233
     F            FCLTYFMF                          KRENAMEFCLTYG                             246233
     FFACHSAL6IF  E           K        DISK                                                   246233
     F            FACHISAF                          KRENAMEFACHISA6                           246233
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      *   01  - Record not Found                                      *
      *   02  - Record not Found                                      *
      *   03  - Record not Found                                      *   147488
      *   05  - End of file LF/LEFCAMLA                               *   CLE014
      *   07  - Utilisation record from LEFCENL0                      *                       189343
      *   08  - RE record from history, skip INT computation          *   CLE014
      *   09  - Record not found in LEMNFUL7                          *                       189343
      *   15  - Record found in Past Due Array                        *                       204669
      *   16  - Chain to CLOAN.                                       *                       204669
      *                                                               *
      * U7+U8 - Database Error                                        *
      *                                                               *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  SRINIT - Program Initialisation                              *
      *  SRFACH - Subroutine to Process Records in FACHISA            *
      *  SRFCAM - Subroutine to Process Records in LEFCAML8 when      *
      *           facility being enquired is a CA                     *
      *  SRFTRA - Subroutine to Process Records in LEFCAML8 when      *
      *           facility being enquired is a participant facility   *
      *  SRLOAM - Subroutine to Process Records in LOAMSDK            *
      *  SRFRMT - Subroutine to Format Fields in LEFCENPD             *
      *  *PSSR  - Program Error Processing Subroutine                 *
      *                                                               *
      *****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E**********          PSDU      150  6 0             Past Due maturity             204669 CLE148
     E                    PSDU      150  6                                                    CLE148
     E**********          CMD     1   1 21               QCMDEXC Cmd      189088
     E**********          CMD     1   1 27               QCMDEXC Cmd                   189088 189343
     E**********          CMD     1   2 27               QCMDEXC Cmd                 189343 AR936915
     E**********          CMD     1   1 27               QCMDEXC Cmd               AR936915 MD044620
     E                    CMD     1   1 39               QCMDEXC Cmd                        MD044620
     E/COPY ZSRSRC,ZDATE9Z1                                               CLE014
     E/COPY ZSRSRC,ZFREQBZ1                                                                   207963
     E/COPY ZSRSRC,ZHOLE                                                                      207963
     E/COPY ZSRSRC,ZDATE2Z1                                                                   207963
      *
      ** Array containing Copyright statement
      *
      /SPACE 3
     ILEFCAMPF                                                                              AR674226
     I              SQNO                            FCSQNO                                  AR674226
      *                                                                   CLE014
     IFCLTYFMF                                                            CLE014
      ** Rename FCLTYFMF of LEFCLTL9                                      CLE014
      *                                                                   CLE014
     I              TRCA                            TRCAF                 CLE014
      *                                                                   CLE014
     IHISTSHMF                                                            CLE014
      ** Rename history header fields                                     CLE014
      *                                                                   CLE014
     I              BRCA                            BRCAHL                CLE014
     I              CNUM                            CNUMHL                CLE014
     I              LNRF                            LNRFHL                CLE014
     I              VDAT                            VDATHL                CLE014
     I              AMTP                            AMTPHL                CLE014
     I              PRAM                            PRAMHL                CLE014
     I              BRTT                            BRTTHL                CLE014
     I              BRTE                            BRTEHL                CLE014
     I              RTSP                            RTSPHL                CLE014
     I              SPIN                            SPINHL                CLE014
     I              REPT                            REPTHL                CLE014
     I              INTC                            INTCHL                CLE014
     I              SUTP                            SUTPHL                CLE014
     I              LCD                             LCDHL                 CLE014
     I              CPAM                            CPAMHL                CLE014
     I              AITC                            AITCHL                CLE014
     I              INTR                            INTRHL                CLE014
     I              AIAP                            AIAPHL                CLE014
     I              IPRD                            IPRDHL                CLE014
     I              WTIN                            WTINHL                CLE014
     I              TOTI                            TOTIHL                CLE014
     I              CALC                            CALCHL                CLE014
     I              CLAS                            CLASHL                                    CLE042
      *                                                                   CLE014
     IHISTSHPF                                                            CLE014
      ** Rename history amount fields                                     CLE014
      *                                                                   CLE014
     I              BRCA                            BRCAHL                CLE014
     I              CNUM                            CNUMHL                CLE014
     I              LNRF                            LNRFHL                CLE014
     I              VDAT                            VDATHL                CLE014
     I              AMTP                            AMTPHL                CLE014
     I              PRAM                            PRAMHL                CLE014
     I              INTA                            INTAHL                CLE014
     I              WTXA                            WTXAHL                CLE014
     I              FEAM                            FEAMHL                CLE014
     I              WOIN                            WOINHL                CLE014
     I              SUTP                            SUTPHL                CLE014
     I              LCD                             LCDHL                 CLE014
     I              CPAM                            CPAMHL                CLE014
     I              AITC                            AITCHL                CLE014
     I              INTR                            INTRHL                CLE014
     I              AIAP                            AIAPHL                CLE014
     I              IPRD                            IPRDHL                CLE014
     I              MNSG                            MNSGHL                CLE014
     I              GASS                            GASSHL                CLE014
     I              ROLN                            ROLNHL                CLE014
     I              CLAS                            CLASHL                                    CLE042
      *                                                                   CLE014
     IHISTSHQF                                                            CLE014
      ** Rename history rate fields                                       CLE014
      *                                                                   CLE014
     I              BRCA                            BRCAHL                CLE014
     I              CNUM                            CNUMHL                CLE014
     I              LNRF                            LNRFHL                CLE014
     I              VDAT                            VDATHL                CLE014
     I              CCY                             CCYHL                 CLE014
     I              AMTP                            AMTPHL                CLE014
     I              BRTT                            BRTTHL                CLE014
     I              BRTE                            BRTEHL                CLE014
     I              RTSP                            RTSPHL                CLE014
     I              SPIN                            SPINHL                CLE014
     I              STAI                            STAIHL                CLE014
     I              IRCF                            IRCFHL                CLE014
     I              LCD                             LCDHL                 CLE014
     I              CPAM                            CPAMHL                CLE014
     I              AITC                            AITCHL                CLE014
     I              INTR                            INTRHL                CLE014
     I              AIAP                            AIAPHL                CLE014
     I              IPRD                            IPRDHL                CLE014
     I              MNSG                            MNSGHL                CLE014
     I              RLCY                            RLCYHL                CLE014
     I              CALC                            CALCHL                CLE014
      *                                                                   CLE014
     ILOAMS213                                                            CLE014
      ** Rename Loan Amendments file                                      CLE014
      *                                                                   CLE014
     I              BRCA                            BRCAHL                CLE014
     I              CNUM                            CNUMHL                CLE014
     I              LNRF                            LNRFHL                CLE014
     I              VDAT                            VDATHL                CLE014
     I              AMTP                            AMTPHL                CLE014
     I              BRTT                            BRTTHL                CLE014
     I              RTSP                            RTSPHL                CLE014
     I              BRTE                            BRTEHL                CLE014
     I              SPIN                            SPINHL                CLE014
     I              CCY                             CCYHL                 CLE014
     I              PRAM                            PRAMHL                CLE014
     I              INTA                            INTAHL                CLE014
     I              TAMT                            TAMTHL                CLE014
     I              STAI                            STAIHL                CLE014
     I              LCD                             LCDHL                 CLE014
     I              CHTP                            CHTPHL                CLE014
     I              REPT                            REPTHL                CLE014
     I              GASS                            GASSHL                CLE014
      *                                                                   CLE014
     ILOAMSDLA                                                            CLE014
      ** Rename Loan Amendments file file from LEFCAMLA                   CLE014
      *                                                                   CLE014
     I              BRCA                            BRCALA                CLE014
     I              FCUS                            FCUSLA                CLE014
     I              FTYP                            FTYPLA                CLE014
     I              FSEQ                            FSEQLA                CLE014
     I              LNRF                            LNRFLA                CLE014
     I              VDAT                            VDATLA                CLE014
     I              AMTP                            AMTPLA                CLE014
     I              CCY                             CCYLA                 CLE014
      *                                                                   CLE014
     ILEMNUPLJ                                                                                189343
      ** Rename fields of LEMNFUL7                                                            189343
      *                                                                                       189343
     I              RECI                            RECILJ                                    189343
     I              BRCA                            BRCALJ                                    189343
     I              CNUM                            CNUMLJ                                    189343
     I              FACT                            FACTLJ                                    189343
     I              FCNO                            FCNOLJ                                    189343
     I              SQNO                            SQNOLJ                                    189343
     I              STDT                            STDTLJ                                    189343
     I              EXDT                            EXDTLJ                                    189343
      *                                                                                       189343
     ILEMNF13                                                                                 204026
     I              RECI                            RECI13                                    204026
     I              BRCA                            BRCA13                                    204026
     I              CNUM                            CNUM13                                    204026
     I              FACT                            FACT13                                    204026
     I              FCNO                            FCNO13                                    204026
     I              SQNO                            SQNO13                                    204026
     I              STDT                            STDT13                                    204026
     I              UCCY                            UCCY13                                    204026
     I              UAMT                            UAMT13                                    204026
     I              UNAR                            UNAR13                                    204026
     I              USTS                            USTS13                                    204026
     I              ORED                            ORED13                                    204026
     I              CHTP                            CHTP13                                    204026
     I              PUAM                            PUAM13                                    204026
     ILEFCLTZ1                                                                                204026
     I              CNUM                            CNUMZ1                                    204026
     I              FACT                            FACTZ1                                    204026
     I              FCNO                            FCNOZ1                                    204026
     I              BRCA                            BRCAZ1                                    204026
     I              CANM                            CANMZ1                                    204026
     I              CAFN                            CAFNZ1                                    204026
     I              CAFT                            CAFTZ1                                    204026
     I              TRCA                            TRCAZ1                                    204026
      *                                                                                       204026
     ILEFRBS      DS                       9999                           CLE014
     I**********                              1   60WRLNRF                             CLE014 CLE148
     I                                        1   6 WRLNRF                                    CLE148
     I                                    P   7  130WRRAMT                CLE014
      *                                                                   CLE014
     I            DS                                                                        AR936915
     I**********                              1  27 CMD                            AR936915 MD044620
     I                                        1  39 CMD                                     MD044620
     I                                       13  22 FLNAME                                  AR936915
     I                                       29  38 MBNAME                                  MD044620
      *                                                                                     AR936915
     ILDA       E DSLDA                         256
      *
      ** Local data area for database error details
      ** *LOCK IN LDA immediately before and OUT LDA immediately
      ** after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
      *
     IRUNDAT    E DSRUNDAT
      *
      ** Data Area giving Installation Control Details
      *
     ISCSARD    E DSSCSARDPD                                              CLE014
      ** SAR file details accessed via access program AOSARDR0            CLE014
      *                                                                   CLE014
     IDSSDY     E DSDSSDY                                                 CLE014
      ** Long data structure for Access Objects                           CLE014
      *                                                                   CLE014
     IDSFDY     E DSDSFDY                                                                     207963
      ** Short data structure for Access Objects                                              207963
      *                                                                                       207963
     ISDGELR    E DSSDGELRPD                                                                  207963
      **  External DS for general ledger details                                              207963
      *                                                                                       207963
     ISDBANK    E DSSDBANKPD                                                                  207963
      **  Bank details accesseD via access program                                            207963
      *                                                                                       207963
     ISDCUST    E DSSDCUSTPD                                                                  246233
      **  External data structures for Customer Details                                       246233
      *                                                                                       246233
     IPSDS       SDS
      *
      ** Program Status Data Structure
      *
     I                                     *PROGRAM PGM
     I                                      244 253 WSID
     I                                      254 263 USER
     IFSDS        DS
      ** File Status Data Structure
      *
     I                                     *RECORD  FREC
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I              'LEFCENPD'            C         FILE1                                   MD044620
     I              'LEFATRPD'            C         FILE2                                   MD044620
     I/COPY ZSRSRC,ZINTDYZ1                                               CLE014
     I/COPY ZSRSRC,ZDATE9Z2                                               CLE014
     I/COPY ZSRSRC,ZDAT10Z1                                               CLE014
     I/COPY ZSRSRC,ZHOLI                                                                      207963
     C/TITLE Main Processing
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
      ** Perform Initialisation.
      *
     C                     EXSR SRINIT
      *
     C***********WFCLT     CHAINFCLTYL1              01                   156226
     C           WFCLT     CHAINFCLTY                01                   156226
      *
     C           *IN01     IFEQ '1'
     C                     MOVELPBRCA     WKEY   14
     C                     MOVELPCNUM     WFCLTY 11
     C                     MOVELPFACT     WFATY   5
     C                     MOVE PFCNO     WFATY
     C                     MOVE WFATY     WFCLTY
     C                     MOVE WFCLTY    WKEY
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD1         DBASE            ************
     C***********          MOVEL'FCLTYL1 'DBFILE           * DBERR 01 *   156226
     C                     MOVEL'FCLTY   'DBFILE           * DBERR 01 *   156226
     C                     MOVEL'*KEY  '  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     EXSR SRFACH
      *
      ** Credit agreement
      *
     C           TRCA      IFEQ 'CA'
     C                     EXSR SRCRAG                                    154591
     C                     EXSR SRFCAM
     C                     ELSE
      *
      ** Participant facilities
      *
     C                     EXSR SRFTRA
     C                     EXSR SRLOAM
     C                     ENDIF
      *                                                                                       189343
      ** if facility being enquired is a credit agreement                                     189343
      *                                                                                       189343
     C           TRCA      IFEQ 'CA'                                                          189343
      *                                                                                       189343
      ** check all tranches attached to that CA                                               189343
      *                                                                                       189343
     C           WFCKY     SETLLLEFCLTL9                                                      189343
     C           *IN10     DOWEQ'0'                                                           189343
     C           WFCKY     READELEFCLTL9                 10                                   189343
      *                                                                                       189343
      ** if a tranche is found, retrieve all US records of that TR in                         189343
      ** FACHISA.                                                                             189343
      *                                                                                       189343
     C           *IN10     IFEQ '0'                                                           189343
     C                     MOVELBRCA      WBRCA   3                                           189343
     C**********           Z-ADDCNUM      WCSNO                                        189343 CSD027
     C                     MOVE CNUM      WCSNO                                               CSD027
     C                     MOVELFACT      WFLTY                                               189343
     C                     MOVE FCNO      WFLTY                                               189343
     C                     MOVE '0'       *IN13                                               189343
     C           WFACH     SETLLFACHSAL3                                                      189343
     C           *IN13     DOWEQ'0'                                                           189343
     C           WFACH     READEFACHSAL3                 13                                   189343
      *                                                                                       189343
      ** if US record was found in FACHISA, get FADATE and sequence                           189343
      *                                                                                       189343
     C           *IN13     IFEQ '0'                                                           189343
     C**********           Z-ADDFASQNO    TSEQ    30                                 189343 AR674226
     C                     Z-ADDFASQNO    TSEQ    40                                        AR674226
     C                     Z-ADDFADATE    TDATE   50                                          189343
     C           WLEMN7    SETLLLEMNFUL7                                                      189343
     C           WLEMN7    READELEMNFUL7                 14                                   189343
     C           *IN14     IFEQ '0'                                                           189343
     C                     Z-ADDEXDTLJ    TREXDT                                              189343
     C                     ELSE                                                               189343
     C                     Z-ADD1         TREXDT                                              189343
     C                     ENDIF                                                              189343
     C**********           Z-ADDCNUM      TRCNUM                                       189343 CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
     C                     Z-ADDFACT      TRFACT                                              189343
     C                     Z-ADDFCNO      TRFCNO                                              189343
     C                     Z-ADDTDATE     TRSTDT                                              189343
     C                     Z-ADDTSEQ      TRTSEQ                                              189343
     C                     WRITELEFATRD0                                                      189343
      *                    ENDIF                                                              189343
     C                     ELSE                                                               189343
     C                     MOVE '1'       *IN13                                               189343
     C                     ENDIF                                                              189343
     C                     ENDDO                                                              189343
     C                     ENDIF                                                              189343
      *                                                                                       189343
     C                     ENDDO                                                              189343
     C                     ENDIF                                                              189343
      *                                                                                       189343
      *
     C                     COMIT
     C                     ENDIF
      *
     C                     SETON                     LR
      *================================================================
      *  P R O G R A M   E N D                                        *
      *================================================================
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRINIT - Subroutine to do Program Initialisation.            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls    : QCMDEXC                                           *
      *                                                               *
      *****************************************************************
      *
     C           SRINIT    BEGSR
      *
     C           *ENTRY    PLIST
     C                     PARM           PBRCA   3
     C**********           PARM           PCNUM   60                                          CSD027
     C                     PARM           PCNUM   6                                           CSD027
     C                     PARM           PFACT   30
     C                     PARM           PFCNO   20
     C                     PARM           PCCY    3
     C                     PARM           PVLDT   50
     C                     PARM           PCODE   1
     C                     PARM           PNWPF1 10                                         AR936915
     C                     PARM           PNWPF2 10                                         AR936915
      *
      ** Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
      *                                                                   CLE014
      ** Determine if CLE014 is installed                                 CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM '       ' PRTCD   7                       CLE014
     C                     PARM '*VERIFY' POPTN   7                       CLE014
     C                     PARM 'CLE014'  PSARD   6                       CLE014
     C           SCSARD    PARM SCSARD    DSSDY                           CLE014
      *                                                                   CLE014
      ** Handle Database Error                                            CLE014
      *                                                                   CLE014
     C           PRTCD     IFNE *BLANKS                                   CLE014
     C           PRTCD     ANDNE'*NRF   '                                 CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVE 'SCSARDPD'DBFILE                          CLE014
     C                     MOVELPSARD     DBKEY                           CLE014
     C                     Z-ADD2         DBASE                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** CLE014 is installed                                              CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     Z-ADD*ZERO     C       40                      CLE014
     C                     Z-ADD*ZERO     Z       40                      CLE014
     C                     Z-ADD*ZERO     X       30                                          204669
     C                     Z-ADD*ZERO     Y       30                                          204669
     C                     ENDIF                                          CLE014
     C/COPY WNCPYSRC,LEH01303
      *                                                                                       207963
      ** Read bank details via access program                                                 207963
      *                                                                                       207963
     C                     CALL 'AOBANKR0'                                                    207963
     C                     PARM '*MSG   ' @RTCD   7                                           207963
     C                     PARM '*FIRST ' @OPTN   7                                           207963
     C           SDBANK    PARM SDBANK    DSFDY                                               207963
     C           @RTCD     IFNE *BLANK                                                        207963
     C                     MOVE '003'     DBASE            **********                         207963
     C                     MOVEL'*FIRST ' DBOPTN  7        *  003   *                         207963
     C                     MOVEL'*FIRST ' DBKEY            **********                         207963
     C                     MOVEL'SDBANKPD'DBFILE                                              207963
     C                     EXSR *PSSR                                                         207963
     C                     END                                                                207963
      *                                                                                       207963
     C           BJDFIN    IFEQ 'M'                                                           207963
     C                     MOVEL'1'       *IN98                                               207963
     C                     ENDIF                                                              207963
      *
     C**********           MOVELCMD,1     PCMD                                              AR936915
     C**********           MOVELPNWPF1    FLNAME                                   AR936915 MD044620
     C                     MOVELFILE1     FLNAME                                            MD044620
     C                     MOVELPNWPF1    MBNAME                                            MD044620
     C                     CALL 'QCMDEXC'              04
     C**********           PARM           PCMD   21                       189088
     C**********           PARM 21        PLEN   155                      189088
     C**********           PARM           PCMD   27                                  189088 AR936915
     C                     PARM           CMD                                               AR936915
     C**********           PARM 27        PLEN   155                                 189088 MD044620
     C                     PARM 39        PLEN   155                                        MD044620
     C**********           MOVELCMD,2     PCMD                                       189343 AR936915
     C**********           MOVELPNWPF2    FLNAME                                   AR936915 MD044620
     C                     MOVELFILE2     FLNAME                                            MD044620
     C                     MOVELPNWPF2    MBNAME                                            MD044620
     C                     CALL 'QCMDEXC'              06                                     189343
     C**********           PARM           PCMD   27                                  189343 AR936915
     C                     PARM           CMD                                               AR936915
     C**********           PARM 27        PLEN   155                                 189343 MD044620
     C                     PARM 39        PLEN   155                                        MD044620
      *****************************************************************            MD035545 MD047993
      ***Access*general*ledger*details.********************************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*MSG   ' @RTCD   7                                MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN   7                                MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
      ** Retrieve system value setting.                                                     MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   @RTCD                                             MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'.                            MD035545
      *                                                                                     MD035545
     C           @RTCD     IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *
      ** Read in Installation Data
      *
     C           *NAMVAR   DEFN           RUNDAT
     C           *NAMVAR   DEFN           LDA
     C                     IN   RUNDAT
      *
     C                     MOVELPFACT     WFCTY   50
     C                     MOVE PFCNO     WFCTY
      *
     C           WFCLT     KLIST
     C***********          KFLD           PBRCA                           156226
     C                     KFLD           PCNUM
     C                     KFLD           PFACT
     C                     KFLD           PFCNO
      *
     C           WFAKY     KLIST
     C                     KFLD           PCNUM
     C                     KFLD           WFCTY
      *
     C           WFCKY     KLIST
     C                     KFLD           PCNUM
     C                     KFLD           PFACT
     C                     KFLD           PFCNO
      *                                                                   CLE014
      ** Key list to chain LF/HISLAML0                                    CLE014
      *                                                                   CLE014
     C           KEYH      KLIST                                          CLE014
     C                     KFLD           BRCA                            CLE014
     C                     KFLD           CNUM                            CLE014
     C                     KFLD           LNRF                            CLE014
      *                                                                                       189343
     C           WFACH     KLIST                                                              189343
     C                     KFLD           WCSNO                                               189343
     C                     KFLD           WFLTY                                               189343
      *                                                                                       189343
     C           WLEMN7    KLIST                                                              189343
     C                     KFLD           BRCA                                                189343
     C                     KFLD           CNUM                                                189343
     C                     KFLD           FACT                                                189343
     C                     KFLD           FCNO                                                189343
     C                     KFLD           TDATE                                               189343
     C                     KFLD           TSEQ                                                189343
      *
     C           WCAKY     KLIST
     C***********          KFLD           WBRCH                           156226
     C                     KFLD           WCSNO
     C                     KFLD           WFLTY
      *                                                                                       204026
     C           WLEM13    KLIST                                                              204026
     C                     KFLD           WBRCA                                               204026
     C                     KFLD           WCNUM                                               204026
     C                     KFLD           WFACT                                               204026
     C                     KFLD           WFCNO                                               204026
     C                     KFLD           WSQNO                                               204026
      *
     C           WCLON     KLIST                                          147488
     C***********          KFLD           BRCA                     147488 156226
     C                     KFLD           WLNRF                           147488
      *                                                                   147488
     C           WPTKY     KLIST                                          147488
     C***********          KFLD           BRCA                     147488 156226
     C**********           KFLD           WFCUS   60                                   147488 CSD027
     C                     KFLD           WFCUS   6                                           CSD027
     C                     KFLD           WFTYP   30                      147488
     C                     KFLD           WFSEQ   20                      147488
      *                                                                   147488
     C                     OPEN LEFCENPD
      *
     C                     OPEN LEFATRPD                                                      189343
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRFACH - Subroutine to Process Records in FACHISA            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls    : NONE                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRFACH    BEGSR
      *
     C           WFAKY     SETLLFACHISA1
      *
     C           WFAKY     READEFACHISA1                 01
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN01     ANDEQ*OFF                                      156226
     C           WFAKY     READEFACHISA1                 01               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C           *IN01     DOWEQ'0'
      * Only display historic events if after selection date, and                             204669
      * if the User did not specify only Backvalued or only Past Due,                         204669
     C           FADATE    IFGE PVLDT
     C           PCODE     ANDNE'P'                                                           204669
     C           PCODE     ANDNE'B'                                                           204669
     C                     MOVE *BLANK    WREC    1                       147488
      *                                                                   147488
      ** Exclude participant transactions when code is not A              147488
      *                                                                   147488
     C           PRTR      IFNE 'P'                                       147488
     C           PRTR      ANDNE'I'                                       147488
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           PCODE     ANDNE'A'                                       147488
     C**********           Z-ADDFALOAN    WLNRF                                        147488 CLE148
     C                     MOVELFALOAN    WLNRF                                               CLE148
     C***********WCLON     CHAINCLOANLB              03            147488 156226
     C           WCLON     CHAINCLOAN                03                   156226
     C                     SELEC                                          147488
     C           *IN03     WHEQ '0'                                       147488
     C           LPFI      ANDNE'P'                                       147488
     C           LPFI      ANDNE'I'                                       147488
     C           LPFI      ANDNE'R'                                       151292
     C           LPFI      ANDNE'S'                                                           CLE106
     C**********           Z-ADDFCUS      WFCUS                                        147488 CSD027
     C                     MOVE FCUS      WFCUS                                               CSD027
     C                     Z-ADDFTYP      WFTYP                           147488
     C                     Z-ADDFSEQ      WFSEQ                           147488
     C***********WPTKY     SETLLFCLTYL1                            147488 156226
     C***********WPTKY     READEFCLTYL1                  03        147488 156226
     C           WPTKY     SETLLFCLTY                                     156226
     C           WPTKY     READEFCLTY                    03               156226
     C           *IN03     IFEQ '0'                                       147488
     C           PRTR      ANDEQ'P'                                       147488
     C           *IN03     OREQ '0'                                       147488
     C***********PRTR      ANDEQ'P'                                147488 156226
     C           PRTR      ANDEQ'I'                                       156226
     C           *IN03     OREQ '0'                                                           CLE106
     C           PRTR      ANDEQ'R'                                                           CLE106
     C           *IN03     OREQ '0'                                                           CLE106
     C           PRTR      ANDEQ'S'                                                           CLE106
     C                     MOVEL'Y'       WREC                            147488
     C                     ENDIF                                          147488
     C***********WFCLT     CHAINFCLTYL1              01            147488 156226
     C           WFCLT     CHAINFCLTY                01                   156226
     C           *IN03     WHEQ '0'                                       147488
     C                     MOVE 'Y'       WREC                            147488
     C                     ENDSL                                          147488
     C                     ENDIF                                          147488
      *                                                                                       201909
     C********** FALOAN    IFNE 0                                                      201909 CLE148
     C**********           Z-ADDFALOAN    WLNRF                                        201909 CLE148
     C           FALOAN    IFNE *BLANKS                                                       CLE148
     C                     MOVELFALOAN    WLNRF                                               CLE148
     C           WCLON     CHAINCLOAN                03                                       201909
     C           *IN03     IFEQ '0'                                                           201909
     C           RECI      ANDEQ'R'                                                           201909
     C                     MOVE 'Y'       WREC                                                201909
     C                     ENDIF                                                              201909
     C*                                                                                       204304
     C* If loan was reversed before today, do not display                                     204304
     C*                                                                                       204304
     C           FAREVI    IFEQ 'R'                                                           204304
     C                     MOVE 'Y'       WREC                                                204304
     C                     END                                                                204304
     C*                                                                                       204304
     C                     ENDIF                                                              201909
      *                                                                                       201909
     C           FAACTN    IFEQ 'US'                                                          204026
     C           FAACTN    OREQ 'UI'                                                          204026
     C           FAACTN    OREQ 'UD'                                                          204026
     C*                                                                                       204477
     C* If MFU was reversed before today, do not display                                      204477
     C*                                                                                       204477
     C           FAREVI    IFEQ 'R'                                                           204477
     C                     MOVE 'Y'       WREC                                                204477
     C                     END                                                                204477
     C*                                                                                       204477
     C           FAREVI    IFEQ ' '                                                           204026
      *                                                                                       204026
     C                     MOVE BRCA      WBRCA   3                                           204026
     C**********           Z-ADDFACNUM    WCNUM   60                                   204026 CSD027
     C                     MOVE FACNUM    WCNUM   6                                           CSD027
     C                     Z-ADDFACT      WFACT   30                                          204026
     C                     Z-ADDFCNO      WFCNO   20                                          204026
     C**********           Z-ADDFASQNO    WSQNO   30                                 204026 AR674226
     C                     Z-ADDFASQNO    WSQNO   40                                        AR674226
     C           TRCA      IFEQ 'CA'                                                          204026
      *                    MOVEL                                                              204026
     C           WLEMCA    KLIST                                                              204026
      *                                                                                       204026
     C                     KFLD           WCNUM                                               204026
     C                     KFLD           WFACT                                               204026
     C                     KFLD           WFCNO                                               204026
      *                                                                                       204026
     C           WLEMCA    SETLLLEFCLTLE                                                      204026
     C           WLEMCA    READELEFCLTLE                 05                                   204026
      *                                                                                       204026
     C           *IN05     DOWEQ'0'                                                           204026
     C                     MOVE BRCAZ1    WBRCA                                               204026
     C**********           Z-ADDCNUMZ1    WCNUM                                        204026 CSD027
     C                     MOVE CNUMZ1    WCNUM                                               CSD027
     C                     Z-ADDFACTZ1    WFACT                                               204026
     C                     Z-ADDFCNOZ1    WFCNO                                               204026
      *                                                                                       204026
     C           WLEM13    CHAINLEMNFUL0             03                                       204026
     C           *IN03     IFEQ '0'                                                           204026
     C           RECI13    ANDEQ'R'                                                           204026
     C                     MOVE 'Y'       WREC                                                204026
     C                     ENDIF                                                              204026
     C           WLEMCA    READELEFCLTLE                 05                                   204026
     C                     ENDDO                                                              204026
      *                                                                                       204026
     C                     ELSE                                                               204026
     C           WLEM13    CHAINLEMNFUL0             03                                       204026
     C           *IN03     IFEQ '0'                                                           204026
     C           RECI13    ANDEQ'R'                                                           204026
     C                     MOVE 'Y'       WREC                                                204026
     C                     ENDIF                                                              204026
     C                     ENDIF                                                              204026
     C                     ENDIF                                                              204026
     C                     ENDIF                                                              204026
      *                                                                   147488
     C           WREC      IFEQ *BLANK                                    147488
     C                     MOVE FARECI    RECI
     C**********           Z-ADDFALOAN    LNRF                                                CLE148
     C                     MOVELFALOAN    LNRF                                                CLE148
     C                     Z-ADDFADATE    ADAT
     C                     MOVELPCCY      CCY
     C                     Z-ADDFAAAMT    AMNT
     C                     MOVELFAACTN    ATYP
     C                     Z-ADDFASQNO    USEQ
     C                     MOVEL'H'       CODE
     C                     MOVE FARCIN    RVCR                            154245
     C                     Z-ADD*ZEROS    EDAT                                                189343
      *                                                                                       189343
      ** If FAACTN is 'US' for participations check LEMNFUPD for the                          189343
      ** MFU expiry date.                                                                     189343
      *                                                                                       189343
     C           FAACTN    IFEQ 'US'                                                          189343
     C           TRCA      ANDNE'CA'                                                          189343
     C                     MOVE '0'       *IN09                                               189343
     C           WLEMN     KLIST                                                              189343
     C                     KFLD           PBRCA                                               189343
     C                     KFLD           PCNUM                                               189343
     C                     KFLD           PFACT                                               189343
     C                     KFLD           PFCNO                                               189343
     C                     KFLD           PDATE                                               189343
     C                     KFLD           PSEQ                                                189343
      *                                                                                       189343
     C                     Z-ADDFADATE    PDATE   50                                          189343
     C**********           Z-ADDFASQNO    PSEQ    30                                 189343 AR674226
     C                     Z-ADDFASQNO    PSEQ    40                                        AR674226
      *                                                                                       189343
      *                                                                                       189343
     C           WLEMN     SETLLLEMNFUL7                                                      189343
     C           WLEMN     READELEMNFUL7                 09                                   189343
     C           *IN09     IFEQ '0'                                                           189343
     C                     Z-ADDEXDTLJ    EDAT                                                189343
     C                     ELSE                                                               189343
      *                                                                                       189343
      ** if not found Z-ADD 1 to EDAT to make sure that the correct                           189343
      ** narrative will be used by LE0211.                                                    189343
      *                                                                                       189343
     C                     Z-ADD1         EDAT                                                189343
     C                     ENDIF                                                              189343
     C                     ENDIF                                                              189343
      *                                                                                       189343
     C**********           Z-ADD0         CNUM                                         189570 CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     Z-ADD0         FACT                            189570
     C                     Z-ADD0         FCNO                            189570
     C                     WRITELEFCEND0
     C                     ENDIF                                          147488
     C                     ENDIF
     C           WFAKY     READEFACHISA1                 01
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN01     ANDEQ*OFF                                      156226
     C           WFAKY     READEFACHISA1                 01               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C                     ENDDO
      *
      ** Check if primary has participants, if so, display its FIs                            246233
      *                                                                                       246233
     C           PCODE     IFEQ 'H'                                                           246233
     C           PCODE     OREQ 'A'                                                           246233
     C                     EXSR SRPART                                                        246233
     C                     ENDIF                                                              246233
      *                                                                                       246233
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRFCAM - Subroutine to Process Records in LEFCAML8 when      *
      *           facility being enquired is a CA                     *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls    : NONE                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRFCAM    BEGSR
      *
      ** Retrieve facilities with a CA that is being enquired
      *
     C           WFCKY     SETLLLEFCLTL9
     C           WFCKY     READELEFCLTL9                 01
      *
     C           *IN01     DOWEQ'0'
     C                     MOVELBRCA      WBRCH   3
     C**********           Z-ADDCNUM      WCSNO   60                                          CSD027
     C                     MOVE CNUM      WCSNO   6                                           CSD027
     C                     MOVELFACT      WFLTY   50
     C                     MOVE FCNO      WFLTY
      *
      ** Retrieve actions
      *
     C           PCODE     IFEQ 'A'                                       147488
     C           PCODE     ORNE 'A'                                       147488
     C           PRTR      ANDNE'P'                                       147488
     C           PRTR      ANDNE'I'                                       147488
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           WCAKY     SETLLLEFCAML8
     C           WCAKY     READELEFCAML8                 02
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN02     ANDEQ*OFF                                      156226
     C           WCAKY     READELEFCAML8                 02               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C           *IN02     DOWEQ'0'
     C                     MOVEL'N'       PASTDU                                              204669
     C           PCODE     IFEQ 'B'
     C***********VLDT      ANDLTAGRDNB                                    154591
     C***********FREC      ANDEQ'LEFCAMPF'                                154591
     C***********PCODE     OREQ 'B'                                       154591
     C           VDAT      ANDLTAGRDNB
     C           FREC      ANDEQ'LOAMSDKF'
     C           ORED      ANDEQAGRDNB                                                        204669
     C           PCODE     OREQ 'P'                                                           204669
     C           FREC      ANDEQ'LOAMSDKF'                                                    204669
     C           AMTP      ANDEQ'PD'                                                          204669
     C           PCODE     OREQ 'B'
     C           VDAT      ANDLTAGRDNB
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'CLOANCL1'
     C           RECI      ANDNE'R'                                       190124
     C           CLE014    OREQ 'Y'                                       CLE014
     C           PCODE     ANDEQ'B'                                       CLE014
     C           NRPD      ANDLTAGRDNB                                    CLE014
     C********** ORED      ANDEQAGRDNB                                    CLE014              204383
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C           RECI      ANDNE'R'                                                           204441
     C***********PCODE     OREQ 'B'                                       154591
     C***********STDT      ANDLTAGRDNB                                    154591
     C***********ORED      ANDEQAGRDNB                                    154591
     C***********FREC      ANDEQ'LEMNFUPF'                                154591
     C***********PCODE     OREQ 'F'                                       154591
     C***********VLDT      ANDGEAGRDNB                                    154591
     C***********FREC      ANDEQ'LEFCAMPF'                                154591
     C           PCODE     OREQ 'B'                                       189088
     C           STDT      ANDLTAGRDNB                                    189088
     C           ORED      ANDEQAGRDNB                                    189088
     C           FREC      ANDEQ'LEMNFUPF'                                189088
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'F'
     C           VDAT      ANDGEAGRDNB
     C           FREC      ANDEQ'LOAMSDKF'
     C           PCODE     OREQ 'F'
     C           VDAT      ANDGEAGRDNB
     C********** ORED      ANDEQAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL1'
     C           RECI      ANDNE'R'                                       190124
      *                                                                   CLE014
      ** Future-valued Maturity date of loans                             CLE014
      *                                                                   CLE014
     C           PCODE     OREQ 'F'                                       CLE014
     C           MDAT      ANDGEAGRDNB                                    CLE014
     C           FREC      ANDEQ'CLOANCL3'                                CLE014
     C           RECI      ANDNE'R'                                                           204441
      *                                                                   CLE014
     C           PCODE     OREQ 'F'                                       CLE014
     C           MDAT      ANDGEAGRDNB                                    CLE014
     C           FREC      ANDEQ'CLOANCL4'                                CLE014
     C           RECI      ANDNE'R'                                                           204441
      *                                                                   CLE014
     C           CLE014    OREQ 'Y'                                       CLE014
     C           PCODE     ANDEQ'F'                                       CLE014
     C           NRPD      ANDGEAGRDNB                                    CLE014
     C********** ORED      ANDEQAGRDNB                                    CLE014              204383
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C           RECI      ANDNE'R'                                                           204441
     C***********PCODE     OREQ 'F'                                       154591
     C***********STDT      ANDGEAGRDNB                                    154591
     C***********ORED      ANDEQAGRDNB                                    154591
     C***********FREC      ANDEQ'LEMNFUPF'                                154591
     C           PCODE     OREQ 'F'                                       189088
     C           STDT      ANDGEAGRDNB                                    189088
     C           ORED      ANDEQAGRDNB                                    189088
     C           FREC      ANDEQ'LEMNFUPF'                                189088
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       189343
      ** For PCODE 'F', future manual utisation expiry date                                   189343
      *                                                                                       189343
     C           PCODE     OREQ 'F'                                                           189343
     C           EXDT      ANDGEAGRDNB                                                        189343
     C           FREC      ANDEQ'LEMNFUPE'                                                    189343
      *                                                                                       189343
     C           PCODE     OREQ *BLANKS
     C           FREC      ANDNE'FACHISAF'
     C           FREC      ANDNE'CLOANCL2'
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'A'                                       147488
     C           FREC      ANDNE'FACHISAF'                                147488
     C           FREC      ANDNE'CLOANCL2'                                147488
     C           RECI      ANDNE'R'                                       190124
      *
     C                     MOVE 'Y'       WPRIN   1                       157545
     C           AMTP      IFEQ 'MR'                                      157545
     C           PRAM      ANDEQ0                                         157545
     C                     MOVE 'N'       WPRIN                           157545
     C                     ENDIF                                          157545
      *                                                                                       204669
     C           AMTP      IFEQ 'PD'                                                          204669
     C           PRAM      ANDEQ0                                                             204669
     C                     MOVE 'N'       WPRIN                                               204669
     C                     ENDIF                                                              204669
      *                                                                                       204669
     C           FREC      IFEQ 'LOAMSDKF'                                                    204669
     C           AMTP      ANDEQ'PD'                                                          204669
     C           WPRIN     ANDEQ'Y'                                                           204669
     C                     Z-ADDVDAT      WVDAT   50                                          204669
     C           LNRF      CHAINCLOAN                16                                       204669
     C           WVDAT     IFEQ MDAT                                                          204669
     C           X         IFLE 150                                                           204669
     C           X         ADD  1         X                                                   204669
     C**********           Z-ADDLNRF      PSDU,X                                       204669 CLE148
     C                     MOVELLNRF      PSDU,X                                              CLE148
     C                     ENDIF                                                              204669
     C                     ENDIF                                                              204669
     C                     Z-ADDWVDAT     VDAT                                                204669
     C                     ENDIF                                                              204669
      *                                                                                       204669
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C                     EXSR SRRAMT                                    CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       204669
      * If Maturity, check whether this loan has gone Past Due                                204669
     C           FREC      IFEQ 'CLOANCL3'                                                    204669
     C                     Z-ADD1         Y       30                                          204669
     C           LNRF      LOKUPPSDU,Y                   15                                   204669
     C           *IN15     IFEQ '1'                                                           204669
     C                     MOVE 'Y'       PASTDU  1                                           204669
     C                     ENDIF                                                              204669
      *                                                                                       204669
     C                     ENDIF                                                              204669
      *                                                                   157545
     C********** VLDT      IFGE PVLDT                                     CLE014
      *                                                                   CLE014
      ** LOAMSDK uses VDAT not VLDT                                       CLE014
      *                                                                   CLE014
     C           VDAT      IFGE PVLDT                                     CLE014
     C***********FREC      ANDEQ'LEFCAMPF'                                154591
     C***********VDAT      ORGE PVLDT                                     154591
     C           FREC      ANDEQ'LOAMSDKF'
     C           WPRIN     ANDEQ'Y'                                       157545
     C           VDAT      ORGE PVLDT
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'CLOANCL1'
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       204479
     C           VDAT      ORGE AGRDNB                                                        204479
     C           VDAT      ANDGEPVLDT                                                         204479
     C           ORED      ANDNEAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL1'                                                    204479
     C           RECI      ANDNE'R'                                                           204479
      *                                                                                       204479
     C***********STDT      ORGE PVLDT                                     154591
     C***********ORED      ANDEQAGRDNB                                    154591
     C***********FREC      ANDEQ'LEMNFUPF'                                154591
     C           STDT      ORGE PVLDT                                     189088
     C           ORED      ANDEQAGRDNB                                    189088
     C           FREC      ANDEQ'LEMNFUPF'                                189088
     C           RECI      ANDNE'R'                                       190124
     C           STDT      ORGE AGRDNB                                                        189343
     C           PVLDT     ANDEQ*ZERO                                                         189343
     C           ORED      ANDLTAGRDNB                                                        189343
     C           FREC      ANDEQ'LEMNFUPF'                                                    189343
     C           RECI      ANDNE'R'                                                           189343
      *                                                                                       189343
      ** Manual Utilisation expiry/end date greater than or equal to                          189343
      ** from activity date (PVLDT).                                                          189343
      *                                                                                       189343
     C           EXDT      ORGE PVLDT                                                         189343
     C           FREC      ANDEQ'LEMNFUPE'                                                    189343
      *                                                                   CLE014
      ** Future loan maturity date                                        CLE014
      *                                                                   CLE014
     C           MDAT      ORGE PVLDT                                     CLE014
     C           FREC      ANDEQ'CLOANCL3'                                CLE014
     C           PASTDU    ANDNE'Y'                                                           204669
      *                                                                   CLE014
     C           MDAT      ORGE PVLDT                                     CLE014
     C           FREC      ANDEQ'CLOANCL4'                                CLE014
      *                                                                   CLE014
     C           CLE014    OREQ 'Y'                                       CLE014
     C           NRPD      ANDGEPVLDT                                     CLE014
     C********** ORED      ANDEQAGRDNB                                    CLE014              204383
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C           WRAMT     ANDGT*ZERO                                     CLE014
     C                     EXSR SRFRMT
     C                     ENDIF
      *
     C                     ENDIF
     C           WCAKY     READELEFCAML8                 02
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN02     ANDEQ*OFF                                      156226
     C           WCAKY     READELEFCAML8                 02               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C                     ENDDO
     C                     ENDIF                                          147488
     C           WFCKY     READELEFCLTL9                 01
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRFTRA - Subroutine to Process Records in LEFCAML8 when      *
      *           facility being enquired is a participant facility   *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls    : NONE                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRFTRA    BEGSR
      *
     C                     MOVELPBRCA     WBRCH
     C**********           Z-ADDPCNUM     WCSNO                                               CSD027
     C                     MOVE PCNUM     WCSNO                                               CSD027
     C                     MOVELPFACT     WFLTY
     C                     MOVE PFCNO     WFLTY
      *
      ** Retrieve records
      *
     C           WCAKY     SETLLLEFCAML8
     C           WCAKY     READELEFCAML8                 01
      *                                                                   156226
     C           WBRCH     IFNE 'ALL'                                     156226
     C           WBRCH     DOWNEBRCA                                      156226
     C           *IN01     ANDEQ*OFF                                      156226
     C           WCAKY     READELEFCAML8                 01               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *
     C           *IN01     DOWEQ'0'
     C           PCODE     IFEQ 'B'
     C           VLDT      ANDLTAGRDNB
     C           FREC      ANDEQ'LEFCAMPF'
     C           PCODE     OREQ 'B'
     C           VDAT      ANDLTAGRDNB
     C           FREC      ANDEQ'LOAMSDKF'
     C           PCODE     OREQ 'B'
     C           VDAT      ANDLTAGRDNB
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'CLOANCL1'
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'B'
     C           VDAT      ANDLTAGRDNB
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'CLOANCL2'
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'B'
     C           STDT      ANDLTAGRDNB
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'LEMNFUPF'
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'F'
     C           VLDT      ANDGEAGRDNB
     C           FREC      ANDEQ'LEFCAMPF'
     C           PCODE     OREQ 'F'
     C           VDAT      ANDGEAGRDNB
     C           FREC      ANDEQ'LOAMSDKF'
     C           PCODE     OREQ 'F'
     C           VDAT      ANDGEAGRDNB
     C********** ORED      ANDEQAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL1'
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'F'
     C           VDAT      ANDGEAGRDNB
     C********** ORED      ANDEQAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL2'
     C           RECI      ANDNE'R'                                       190124
     C********** PCODE     OREQ 'F'                                                           189343
      *                                                                   CLE014
     C           PCODE     OREQ 'F'                                       CLE014
     C           MDAT      ANDGEAGRDNB                                    CLE014
     C           FREC      ANDEQ'CLOANCL3'                                CLE014
      *                                                                   CLE014
     C           PCODE     OREQ 'F'                                       CLE014
     C           MDAT      ANDGEAGRDNB                                    CLE014
     C           FREC      ANDEQ'CLOANCL4'                                CLE014
      *                                                                   CLE014
     C           PCODE     OREQ 'F'                                                           189343
     C           STDT      ANDGEAGRDNB
     C***********ORED      ANDEQAGRDNB                                    163331
     C           ORED      ANDLEAGRDNB                                    163331
     C           FREC      ANDEQ'LEMNFUPF'
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       189343
      ** For PCODE 'F', future manual utisation expiry date                                   189343
      *                                                                                       189343
     C           PCODE     OREQ 'F'                                                           189343
     C           EXDT      ANDGEAGRDNB                                                        189343
     C           FREC      ANDEQ'LEMNFUPE'                                                    189343
      *                                                                                       189343
     C           PCODE     OREQ *BLANKS
     C           FREC      ANDNE'FACHISAF'
     C           PCODE     OREQ 'A'                                       147488
     C           FREC      ANDNE'FACHISAF'                                147488
      *
     C                     MOVE 'Y'       WPRIN                           157545
     C           AMTP      IFEQ 'MR'                                      157545
     C           PRAM      ANDEQ0                                         157545
     C                     MOVE 'N'       WPRIN                           157545
     C                     ENDIF                                          157545
      *                                                                   157545
     C           VLDT      IFGE PVLDT
     C           FREC      ANDEQ'LEFCAMPF'
     C           VDAT      ORGE PVLDT
     C           FREC      ANDEQ'LOAMSDKF'
     C           WPRIN     ANDEQ'Y'                                       157545
     C           VDAT      ORGE PVLDT
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'CLOANCL1'
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       204479
     C           VDAT      ORGE AGRDNB                                                        204479
     C           VDAT      ANDGEPVLDT                                                         204479
     C           ORED      ANDNEAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL1'                                                    204479
     C           RECI      ANDNE'R'                                                           204479
      *                                                                                       204479
     C           VDAT      ORGE PVLDT
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'CLOANCL2'
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       204479
     C           VDAT      ORGE AGRDNB                                                        204479
     C           VDAT      ANDGEPVLDT                                                         204479
     C           ORED      ANDNEAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL2'                                                    204479
     C           RECI      ANDNE'R'                                                           204479
      *                                                                                       204479
     C           STDT      ORGE PVLDT
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'LEMNFUPF'
     C           RECI      ANDNE'R'                                       190124
     C           STDT      ORGE PVLDT                                     163331
     C           STDT      ANDGEAGRDNB                                    163331
     C           ORED      ANDLTAGRDNB                                    163331
     C           FREC      ANDEQ'LEMNFUPF'                                163331
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       189343
      ** Manual Utilisation expiry/end date greater than or equal to                          189343
      ** from activity date (PVLDT).                                                          189343
      *                                                                                       189343
     C           EXDT      ORGE PVLDT                                                         189343
     C           FREC      ANDEQ'LEMNFUPE'                                                    189343
      *                                                                   CLE014
      ** Future loan maturity date                                        CLE014
      *                                                                   CLE014
     C           MDAT      ORGE PVLDT                                     CLE014
     C           FREC      ANDEQ'CLOANCL3'                                CLE014
      *                                                                   CLE014
     C           MDAT      ORGE PVLDT                                     CLE014
     C           FREC      ANDEQ'CLOANCL4'                                CLE014
      *                                                                   CLE014
     C**********           Z-ADD0         CNUM                                         189570 CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     Z-ADD0         FACT                            189570
     C                     Z-ADD0         FCNO                            189570
     C                     EXSR SRFRMT
     C                     ENDIF
      *
     C                     ENDIF
     C           WCAKY     READELEFCAML8                 01
      *                                                                   156226
     C           WBRCH     IFNE 'ALL'                                     156226
     C           WBRCH     DOWNEBRCA                                      156226
     C           *IN01     ANDEQ*OFF                                      156226
     C           WCAKY     READELEFCAML8                 01               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRLOAM - Subroutine to Process Records in LOAMSDK            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls    : NONE                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRLOAM    BEGSR
      *
      ** Retrieve loans with a participant facility that is being
      ** enquired
      *
     C           WFCKY     SETLLLELOANL7
     C           WFCKY     READELELOANL7                 01
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN01     ANDEQ*OFF                                      156226
     C           WFCKY     READELELOANL7                 01               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
      *
     C           *IN01     DOWEQ'0'
     C**********           Z-ADDLNRF      WLNRF   60                                          CLE148
     C                     MOVELLNRF      WLNRF   6                                           CLE148
      *
      ** Retrieve records
      *
     C           WLNRF     SETLLLOAMS
     C           WLNRF     READELOAMS                    02
      *
     C           *IN02     DOWEQ'0'
     C***********AMTP      ANDNE'SC'                               148725 154591
     C***********AMTP      ANDNE'BC'                               148725 154591
     C***********AMTP      ANDNE'LS'                               148725 154591
     C***********AMTP      ANDNE'SA'                               148725 154591
     C***********AMTP      ANDNE'PD'                               148725 154591
     C           PCODE     IFEQ 'B'
     C           VDAT      ANDLTAGRDNB
     C           PCODE     OREQ 'F'
     C           VDAT      ANDGEAGRDNB
     C           PCODE     OREQ *BLANK
     C           PCODE     OREQ 'A'                                       147488
      *
     C           VDAT      IFGE PVLDT
     C           AMTP      ANDNE'SC'                                      154591
     C           AMTP      ANDNE'BC'                                      154591
     C           AMTP      ANDNE'LS'                                      154591
     C           AMTP      ANDNE'SA'                                      154591
     C           AMTP      ANDNE'PD'                                      154591
      *                                                                   157545
     C           AMTP      IFEQ 'MR'                                      157545
     C           PRAM      ANDNE0                                         157545
     C           AMTP      ORNE 'MR'                                      157545
     C                     Z-ADD0         USEQ
     C                     Z-ADDVDAT      ADAT
     C                     Z-ADDTAMT      AMNT
     C                     MOVELAMTP      ATYP
     C                     MOVEL*BLANKS   WREC                            147488
      *                                                                   157545
     C           AMTP      IFEQ 'MR'                                      157545
     C                     Z-ADDPRAM      AMNT                            157545
     C                     ENDIF                                          157545
     C           PCODE     IFEQ *BLANKS
     C           PCODE     OREQ 'A'                                       147488
     C           VDAT      IFLT AGRDNB
     C                     MOVEL'B'       CODE
     C                     ELSE
     C                     MOVEL'F'       CODE
     C                     ENDIF
     C                     ELSE
     C                     MOVELPCODE     CODE
     C                     ENDIF
      *                                                                   147488
      ** Exclude participant transactions when code is not A              147488
      *                                                                   147488
     C           PCODE     IFNE 'A'                                       147488
     C           PRTR      ANDNE'P'                                       147488
     C           PRTR      ANDNE'I'                                       147488
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           LPFI      IFEQ 'P'                                       147488
     C           LPFI      OREQ 'I'                                       147488
     C           LPFI      OREQ 'R'                                       151292
     C           LPFI      OREQ 'S'                                                           CLE106
     C                     MOVEL'Y'       WREC                            147488
     C                     ENDIF                                          147488
     C                     ENDIF                                          147488
      *                                                                   147488
     C           WREC      IFEQ *BLANKS                                   147488
     C**********           Z-ADD0         CNUM                                         189570 CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     Z-ADD0         FACT                            189570
     C                     Z-ADD0         FCNO                            189570
     C                     WRITELEFCEND0
     C                     ENDIF                                          147488
     C                     ENDIF                                          157545
     C                     ENDIF
      *
     C                     ENDIF
     C           WLNRF     READELOAMS                    02
     C                     ENDDO
     C           WFCKY     READELELOANL7                 01
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN01     ANDEQ*OFF                                      156226
     C           WFCKY     READELELOANL7                 01               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRFRMT - Subroutine to Format Fields in LEFCENPD             *
      *                                                               *
      *  Called By: SRFCAM, SRFTRA                                    *
      *                                                               *
      *  Calls    : NONE                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRFRMT    BEGSR
      *
     C                     MOVEL*BLANK    WREC                            147488
     C                     Z-ADD0         USEQ
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     MOVEL*BLANK    FREQ                            CLE014
     C                     MOVEL*BLANK    EXFR                            CLE014
     C                     ENDIF                                          CLE014
     C                     SELEC
      *
     C           FREC      WHEQ 'LEFCAMPF'
     C**********           Z-ADD0         LNRF                                                CLE148
     C                     MOVEL*BLANKS   LNRF                                                CLE148
     C                     Z-ADDVLDT      ADAT
     C                     MOVELACCY      CCY
     C                     Z-ADDAAMT      AMNT
     C                     MOVELFATP      ATYP
      *                                                                                       247204
     C           TRCA      IFEQ 'CA'                                                          247204
     C**********           Z-ADD0         CNUM                                         247204 CPK028
     C                     MOVE *BLANKS   CNUM                                                CPK028
     C                     Z-ADD0         FACT                                                247204
     C                     Z-ADD0         FCNO                                                247204
     C                     ENDIF                                                              247204
      *                                                                                       247204
     C           PCODE     IFEQ *BLANKS
     C           PCODE     OREQ 'A'                                       147488
     C           VLDT      IFLT AGRDNB
     C                     MOVEL'B'       CODE
     C                     ELSE
     C                     MOVEL'F'       CODE
     C                     ENDIF
     C                     ELSE
     C                     MOVELPCODE     CODE
     C                     ENDIF
      *
     C           FREC      WHEQ 'LOAMSDKF'
     C                     Z-ADDVDAT      ADAT
     C                     Z-ADDTAMT      AMNT
     C                     MOVELAMTP      ATYP
      *                                                                                       207963
     C           REPT      IFEQ 1                                                             207963
     C           AMTP      ANDEQ'RE'                                                          207963
     C                     Z-ADDPRAM      AMNT                                                207963
     C                     ENDIF                                                              207963
      *                                                                   157545
     C           AMTP      IFEQ 'MR'                                      157545
     C                     Z-ADDPRAM      AMNT                            157545
     C                     ENDIF                                          157545
      *                                                                   157545
      ** Check for Past Due loan amendments:                                                  204669
     C           AMTP      IFEQ 'PD'                                                          204669
     C                     Z-ADDPRAM      AMNT                                                204669
     C                     MOVEL'P'       CODE                                                204669
     C                     ELSE                                                               204669
      *                                                                                       204669
     C           PCODE     IFEQ *BLANKS
     C           PCODE     OREQ 'A'                                       147488
     C           VDAT      IFLT AGRDNB
     C                     MOVEL'B'       CODE
     C                     ELSE
     C                     MOVEL'F'       CODE
     C                     ENDIF
     C                     ELSE
     C                     MOVELPCODE     CODE
     C                     ENDIF
      *                                                                                       204669
     C                     ENDIF                                                              204669
      *                                                                   147488
      ** Exclude participant transactions when code is not A              147488
      *                                                                   147488
     C           PCODE     IFNE 'A'                                       147488
     C           PRTR      ANDNE'P'                                       147488
     C           PRTR      ANDNE'I'                                       147488
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C**********           Z-ADDLNRF      WLNRF                                        147488 CLE148
     C                     MOVELLNRF      WLNRF                                               CLE148
     C***********WCLON     CHAINCLOANLB              03            147488 156226
     C           WCLON     CHAINCLOAN                03                   156226
     C           *IN03     IFEQ '0'                                       147488
     C           LPFI      ANDEQ'P'                                       147488
     C           *IN03     OREQ '0'                                       147488
     C           LPFI      ANDEQ'I'                                       147488
     C           *IN03     OREQ '0'                                       151292
     C           LPFI      ANDEQ'R'                                       151292
     C           *IN03     OREQ '0'                                                           CLE106
     C           LPFI      ANDEQ'S'                                                           CLE106
     C                     MOVEL'Y'       WREC                            147488
     C                     ENDIF                                          147488
     C                     ENDIF                                          147488
      *
     C           FREC      WHEQ 'CLOANCL1'
     C           FREC      OREQ 'CLOANCL2'
     C                     Z-ADDVDAT      ADAT
     C                     Z-ADDCPAM      AMNT
     C                     MOVEL'ST'      ATYP
     C           PCODE     IFEQ *BLANKS
     C           PCODE     OREQ 'A'                                       147488
     C           VDAT      IFLT AGRDNB
     C                     MOVEL'B'       CODE
     C                     ELSE
     C                     MOVEL'F'       CODE
     C                     ENDIF
     C                     ELSE
     C                     MOVELPCODE     CODE
     C                     ENDIF
      *                                                                   147488
      ** Exclude participant transactions when code is not A              147488
      *                                                                   147488
     C           PCODE     IFNE 'A'                                       147488
     C           PRTR      ANDNE'P'                                       147488
     C           PRTR      ANDNE'I'                                       147488
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           LPFI      IFEQ 'P'                                       147488
     C           LPFI      OREQ 'I'                                       147488
     C           LPFI      OREQ 'R'                                       151292
     C           LPFI      OREQ 'S'                                                           CLE106
     C                     MOVEL'Y'       WREC                            147488
     C                     ENDIF                                          147488
     C                     ENDIF                                          147488
      *                                                                   CLE014
     C           FREC      WHEQ 'CLOANCL3'                                CLE014
     C           FREC      OREQ 'CLOANCL4'                                CLE014
      *                                                                   CLE014
     C                     Z-ADD*ZEROS    WCALC                           CLE014
     C                     Z-ADD*ZEROS    WIPAID                          CLE014
     C                     Z-ADDMDAT      WMDAT   50                      CLE014
     C                     Z-ADDCPAM      MAMNT  130                      CLE014
     C**********           Z-ADDLNRF      WLOAN   60                                   CLE014 CLE148
     C                     MOVELLNRF      WLOAN   6                                           CLE148
     C                     Z-ADDIACD      WLICD   50                      CLE014
     C                     MOVE SPIN      WCUSI   1                       CLE014
     C                     Z-ADDINTR      WCURT                           CLE014
     C                     Z-ADDBRTE      WCUBR                           CLE014
     C                     Z-ADDRTSP      WCUSP                           CLE014
     C                     Z-ADDIACD      WLASD                           CLE014
     C                     MOVE ICBS      WICBS                           CLE014
     C                     MOVE *BLANK    WSTAC   1                       CLE014
      *                                                                   CLE014
      ** read LEFCAMLA to get all loan amendments which concerns          CLE014
      ** principal for repayment types 1 and 2                            CLE014
      *                                                                   CLE014
     C                     MOVE '0'       *IN05                           CLE014
      *                                                                   CLE014
     C           NRPD      IFNE 0                                                             207963
     C                     Z-ADDNRPD      ZDAYNO                                              207963
     C                     Z-ADDRDYN      ZMDAY                                               207963
     C                     MOVELCCY       ZCCY                                                207963
     C                     MOVELRFRQ      ZFREQ                                               207963
     C                     ENDIF                                                              207963
      *                                                                   CLE014
     C           REPT      IFLE 2                                         CLE014
      *                                                                   CLE014
     C           WLOAN     SETLLLEFCAMLA                                  CLE014
     C                     READ LEFCAMLA                 05               CLE014
      *                                                                                       189343
     C           *IN05     DOWEQ'0'                                       CLE014
     C           WLOAN     ANDEQLNRFLA                                    CLE014
      *                                                                   CLE014
     C           VDATLA    IFLE ZDAYNO                                                        207963
     C           ZDAYNO    ORLT NRPD                                                        AR830785
      *                                                                                       207963
     C           AMTPLA    IFEQ 'MR'                                      CLE014
     C           AMTPLA    OREQ 'RE'                                      CLE014
     C           AMTPLA    OREQ 'PF'                                      CLE014
      *                                                                   CLE014
      ** Subtract movement amount from current principal to project       CLE014
      ** maturity amount.                                                 CLE014
      *                                                                   CLE014
     C           MAMNT     SUB  PRAM      MAMNT                           CLE014
     C                     ELSE                                           CLE014
      *                                                                   CLE014
      ** Add PRAM to maturity amount for amendment types PI and PT        CLE014
      *                                                                   CLE014
     C           AMTPLA    IFEQ 'PI'                                      CLE014
     C           AMTPLA    OREQ 'PT'                                      CLE014
     C                     ADD  PRAM      MAMNT                           CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       189343
     C                     READ LEFCAMLA                 05               CLE014
      *                                                                                       207963
     C                     ELSE                                                               207963
     C           MAMNT     IFGT 0                                                             207963
     C                     SUB  RAMT      MAMNT                                               207963
     C           MAMNT     IFLT 0                                                             207963
     C                     Z-ADD0         MAMNT                                               207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
     C           RFRQ      IFNE ' '                                                           207963
     C                     EXSR ZFREQB                                                        207963
     C                     ELSE                                                               207963
     C                     Z-ADDMDAT      ZDAYNO                                              207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
     C                     ENDDO                                          CLE014
      *                                                                                       207963
      ** Continue the computation of principal at maturity.                                   207963
      *                                                                                       207963
     C                     MOVE ZDAYNO    TDAYNO  50                                        AR830785
     C           ZDAYNO    DOWLTMDAT                                                          207963
     C           ZDAYNO    ANDGETDAYNO                                                      AR830785
     C           MAMNT     ANDGT0                                                             207963
      *                                                                                       207963
     C                     SUB  RAMT      MAMNT                                               207963
     C           RFRQ      IFNE ' '                                                           207963
     C                     EXSR ZFREQB                                                        207963
     C                     ELSE                                                               207963
     C                     Z-ADDMDAT      ZDAYNO                                              207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C           MAMNT     IFLT 0                                                             207963
     C                     Z-ADD0         MAMNT                                               207963
     C                     ENDIF                                                              207963
     C                     ENDDO                                                              207963
      *                                                                   CLE014
     C                     ELSE                                           CLE014
      *                                                                   CLE014
      ** repayment type 3                                                 CLE014
      *                                                                   CLE014
     C                     Z-ADDCPAM      WCUPR                           CLE014
     C**********           Z-ADDFCUS      CNUM                                         CLE014 CSD027
     C                     MOVE FCUS      CNUM                                                CSD027
      *                                                                   CLE014
     C                     MOVE '0'       *IN37                           CLE014
     C                     Z-ADD0         WLASD   50                      CLE014
     C                     MOVE ZDAYNO    TDAYNO                                            AR830785
     C           KEYH      SETLLHISLAML0                                  CLE014
     C********** *IN37     DOWEQ'0'                                                    CLE014 207963
     C           KEYH      READEHISLAML0                 37               CLE014
      *                                                                   CLE014
      ** If no history or no amendments against the loan                  CLE014
      *                                                                   CLE014
     C           *IN37     IFEQ '1'                                       CLE014
     C                     Z-ADDCPAM      MAMNT                           CLE014
     C                     Z-ADDVDAT      WLASD                                               207963
     C                     ELSE                                           CLE014
      *                                                                                       207963
     C           *IN37     DOWEQ'0'                                                           207963
      *                                                                                       189343
      ** If loan has not start yet and there is an RE, initialise WLASD                       189343
      ** so that interest will be computed.                                                   189343
      *                                                                                       189343
     C********** AMTPHL    IFEQ 'RE'                                                   189343 207963
     C           AMTPHL    IFNE 'ST'                                                          207963
     C           WLASD     ANDEQ0                                                             189343
     C**********           Z-ADD1         WLASD                                        189343 207963
     C                     Z-ADDVDAT      WLASD                                               207963
     C                     ENDIF                                                              189343
      *                                                                   CLE014
      ** Accumulate interest on change of date                            CLE014
      *                                                                   CLE014
     C           VDATHL    IFLE ZDAYNO                                                        207963
     C           ZDAYNO    ORLT TDAYNO                                                      AR830785
      *                                                                                       207963
     C           WLASD     IFNE VDATHL                                    CLE014
     C           WLASD     ANDNE*ZEROS                                    CLE014
     C           WSTAC     ANDEQ*BLANK                                    CLE014
     C                     Z-ADDVDATHL    ZIEND                           CLE014
     C                     EXSR SRINCL                                    CLE014
     C                     ADD  ZINTR     WCALC  152                      CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           AMTPHL    IFEQ 'ST'                                      CLE014
     C           AMTPHL    OREQ 'RO'                                      CLE014
     C           AMTPHL    OREQ 'MC'                                      CLE014
     C                     MOVE CALCHL    WICBS   10                      CLE014
     C                     MOVE SPINHL    WCUSI                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     SELEC                                          CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'ST'                                      CLE014
     C           AMTPHL    OREQ 'MC'                                      CLE014
      *                                                                   CLE014
     C           AMTPHL    IFEQ 'ST'                                      CLE014
     C                     Z-ADDPRAMHL    WCUPR                           CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADDCPAMHL    WCUPR                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     Z-ADDBRTEHL    WCUBR  117                      CLE014
     C                     Z-ADDRTSPHL    WCUSP  117                      CLE014
     C                     Z-ADDINTRHL    WCURT  117                      CLE014
     C                     Z-ADDVDATHL    WLICD                           CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'IN'                                      CLE014
      *                                                                   CLE014
      ** WIPAID is interest paid for the loan                             CLE014
      *                                                                   CLE014
     C                     ADD  INTAHL    WIPAID 152                      CLE014
     C           INTCHL    IFEQ 'Y'                                       CLE014
     C                     ADD  INTAHL    WCUPR  130                      CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'RO'                                      CLE014
      *                                                                   CLE014
     C           PRINRO    IFNE *ZEROS                                    CLE014
     C                     Z-ADDPRINRO    WCUPR                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     Z-ADDBRTEHL    WCUBR                           CLE014
     C                     Z-ADDRTSPHL    WCUSP                           CLE014
     C                     Z-ADDINTRHL    WCURT                           CLE014
     C                     Z-ADDVDATHL    WLICD   50                      CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'PT'                                      CLE014
     C           AMTPHL    OREQ 'PI'                                      CLE014
     C                     ADD  PRAMHL    WCUPR                           CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'PF'                                      CLE014
     C                     SUB  PRAMHL    WCUPR                           CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'MR'                                      CLE014
     C           AMTPHL    OREQ 'RE'                                      CLE014
     C           AMTPHL    OREQ 'MA'                                      CLE014
      *                                                                   CLE014
      ** If RE is from LOAMSDK, compute for the outstanding interest to   CLE014
      ** date to determine what portion of the repayment amount will go   CLE014
      ** to the principal.                                                CLE014
      *                                                                   CLE014
     C           AMTPHL    IFEQ 'RE'                                      CLE014
     C                     MOVE '0'       *IN08                           CLE014
      *                                                                   CLE014
      ** If RE is from history, skip computation of outstanding INT       CLE014
      *                                                                   CLE014
     C           VDATHL    IFLT AGRDNB                                    CLE014
     C           LCDHL     ANDLTAGRDNB                                    CLE014
     C                     MOVE '1'       *IN08                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** If RE is from LOAMSDK                                            CLE014
      *                                                                   CLE014
     C           *IN08     IFEQ '0'                                       CLE014
     C           WCALC     SUB  WIPAID    WOUTIN 152                      CLE014
      *                                                                   CLE014
      ** Compute for the interest to be paid                              CLE014
      *                                                                   CLE014
     C           WOUTIN    IFLE TAMTHL                                    CLE014
     C           TAMTHL    SUB  WOUTIN    PRAMHL 130                      CLE014
     C                     Z-ADDWOUTIN    INTAHL                          CLE014
      *                                                                   CLE014
      ** If over paid                                                     CLE014
      *                                                                   CLE014
     C           WOUTIN    IFLT 0                                         CLE014
     C                     Z-ADDTAMTHL    PRAMHL                          CLE014
     C                     Z-ADD0         INTAHL                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADD*ZEROS    PRAMHL                          CLE014
     C                     Z-ADDTAMTHL    INTAHL                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ADD  INTAHL    WIPAID                          CLE014
     C                     SUB  PRAMHL    WCUPR                           CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'BR'                                      CLE014
     C           AMTPHL    OREQ 'BC'                                      CLE014
     C                     Z-ADDBRTEHL    WCUBR                           CLE014
     C                     EXSR SRNEWI                                    CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'SC'                                      CLE014
     C                     Z-ADDRTSPHL    WCUSP                           CLE014
     C                     EXSR SRNEWI                                    CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'MI'                                      CLE014
     C                     ADD  INTAHL    WCALC  152                      CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'SA'                                      CLE014
     C           STAIHL    IFEQ *BLANK                                    CLE014
     C                     Z-ADDVDATHL    WLICD                           CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'Y'       WSTAC                           CLE014
     C                     ENDIF                                          CLE014
     C                     ENDSL                                          CLE014
      *                                                                                       207963
     C                     Z-ADDVDATHL    WLASD                                               207964
      *                                                                                       207963
     C           KEYH      READEHISLAML0                 37                                   207963
      *                                                                                       207963
     C                     ELSE                                                               207963
      *                                                                                       207963
     C           WLASD     IFNE ZDAYNO                                                        207963
     C           WLASD     ANDNE*ZEROS                                                        207963
     C           WSTAC     ANDEQ*BLANK                                                        207963
     C           ZDAYNO    ANDLTMDAT                                                          207963
     C                     Z-ADDZDAYNO    ZIEND                                               207963
     C                     EXSR SRINCL                                                        207963
     C                     ADD  ZINTR     WCALC                                               207963
     C                     Z-ADDZDAYNO    WLASD                                               207963
     C           RFRQ      IFNE ' '                                                           207963
     C                     EXSR ZFREQB                                                        207963
     C                     ELSE                                                               207963
     C                     Z-ADDMDAT      ZDAYNO                                              207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C           WCALC     SUB  WIPAID    WOUTIN                                              207963
      *                                                                                       207963
      ** Compute for the interest to be paid                                                  207963
      *                                                                                       207963
     C           WOUTIN    IFLE RAMT                                                          207963
     C           RAMT      SUB  WOUTIN    WPRAM  130                                          207963
     C                     Z-ADDWOUTIN    WINTA  130                                          207963
      *                                                                                       207963
      ** If over paid                                                                         207963
      *                                                                                       207963
     C           WOUTIN    IFLT 0                                                             207963
     C                     Z-ADDRAMT      WPRAM                                               207963
     C                     Z-ADD0         WINTA                                               207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ELSE                                                               207963
     C                     Z-ADD*ZEROS    WPRAM                                               207963
     C                     Z-ADDRAMT      WINTA                                               207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ADD  WINTA     WIPAID                                              207963
     C           WCUPR     IFGT 0                                                             207963
     C                     SUB  WPRAM     WCUPR                                               207963
     C           WCUPR     IFLT 0                                                             207963
     C                     Z-ADD0         WCUPR                                               207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ENDIF                                                              207963
     C                     ENDDO                                                              207963
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C**********           Z-ADDVDATHL    WLASD                                        CLE014 207963
      **********                                                                       CLE014 207963
     C**********           ENDDO                                                       CLE014 207963
      *                                                                   CLE014
     C                     Z-ADDWCUPR     MAMNT                           CLE014
      *                                                                                       207963
      ** Continue the computation of principal at maturity.                                   207963
      *                                                                                       207963
     C                     MOVE ZDAYNO    TDAYNO                                            AR830785
     C           ZDAYNO    DOWLTMDAT                                                          207963
     C           ZDAYNO    ANDGETDAYNO                                                      AR830785
     C           MAMNT     ANDGT0                                                             207963
      *                                                                                       207963
     C           WLASD     IFNE ZDAYNO                                                        207963
     C           WLASD     ANDNE*ZEROS                                                        207963
     C           WSTAC     ANDEQ*BLANK                                                        207963
     C                     Z-ADDZDAYNO    ZIEND                                               207963
     C                     EXSR SRINCL                                                        207963
     C                     ADD  ZINTR     WCALC                                               207963
     C                     Z-ADDZDAYNO    WLASD                                               207963
     C                     ENDIF                                                              215966
     C           RFRQ      IFNE ' '                                                           207963
     C                     EXSR ZFREQB                                                        207963
     C                     ELSE                                                               207963
     C                     Z-ADDMDAT      ZDAYNO                                              207963
     C                     ENDIF                                                              207963
     C**********           ENDIF                                                       207963 215966
      *                                                                                       207963
     C           WCALC     SUB  WIPAID    WOUTIN                                              207963
      *                                                                                       207963
      ** Compute for the interest to be paid                                                  207963
      *                                                                                       207963
     C           WOUTIN    IFLE RAMT                                                          207963
     C           RAMT      SUB  WOUTIN    WPRAM  130                                          207963
     C                     Z-ADDWOUTIN    WINTA  130                                          207963
      *                                                                                       207963
      ** If over paid                                                                         207963
      *                                                                                       207963
     C           WOUTIN    IFLT 0                                                             207963
     C                     Z-ADDRAMT      WPRAM                                               207963
     C                     Z-ADD0         WINTA                                               207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ELSE                                                               207963
     C                     Z-ADD*ZEROS    WPRAM                                               207963
     C                     Z-ADDRAMT      WINTA                                               207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ADD  WINTA     WIPAID                                              207963
     C           WCUPR     IFGT 0                                                             207963
     C                     SUB  WPRAM     WCUPR                                               207963
     C           WCUPR     IFLT 0                                                             207963
     C                     Z-ADD0         WCUPR                                               207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ENDDO                                                              207963
      *                                                                                       207963
     C                     Z-ADDWCUPR     MAMNT                                               207963
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     MOVEL'MT'      ATYP                            CLE014
      *                                                                   CLE014
      ** Check if there are existing frequency based repayments against   CLE014
      ** the loan.                                                        CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     Z-ADD1         Z       40                      CLE014
     C           LNRF      DOUEQWRLNRF                                    CLE014
     C********** WRLNRF    OREQ *ZERO                                                  CLE014 CLE148
     C           WRLNRF    OREQ *BLANKS                                                       CLE148
     C           Z         OCUR LEFRBS                                    CLE014
     C           LEFRBS    IFEQ *BLANK                                    CLE014
     C**********           Z-ADD*ZERO     WRLNRF                                       CLE014 CLE148
     C                     MOVEL*BLANKS   WRLNRF                                              CLE148
     C                     Z-ADD*ZERO     WRRAMT                          CLE014
     C                     ENDIF                                          CLE014
     C                     ADD  1         Z                               CLE014
     C                     ENDDO                                          CLE014
      *                                                                   CLE014
      ** If a repayment is found, subtract repayment amount to maturi     CLE014
      ** ty amount.                                                       CLE014
      *                                                                   CLE014
     C           LNRF      IFEQ WRLNRF                                    CLE014
     C**********           SUB  WRRAMT    MAMNT                                        CLE014 207963
     C                     MOVE 'Y'       EXFR                            CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     Z-ADDMAMNT     AMNT                            CLE014
     C                     Z-ADDWMDAT     ADAT                            CLE014
      *                                                                   CLE014
     C           PCODE     IFEQ *BLANKS                                   CLE014
     C           PCODE     OREQ 'A'                                       CLE014
     C           MDAT      IFGE AGRDNB                                    CLE014
     C                     MOVEL'F'       CODE                            CLE014
     C                     ELSE                                           CLE014
     C**********           MOVEL'B'       CODE                                         CLE014 245182
     C                     MOVEL'P'       CODE                                                245182
     C                     ENDIF                                          CLE014
     C                     ELSE                                           CLE014
     C                     MOVELPCODE     CODE                            CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** Exclude participant transactions when code is not A              CLE014
      *                                                                   CLE014
     C           PCODE     IFNE 'A'                                       CLE014
     C           PRTR      ANDNE'P'                                       CLE014
     C           PRTR      ANDNE'I'                                       CLE014
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           LPFI      IFEQ 'P'                                       CLE014
     C           LPFI      OREQ 'I'                                       CLE014
     C           LPFI      OREQ 'R'                                       CLE014
     C           LPFI      OREQ 'S'                                                           CLE106
     C                     MOVEL'Y'       WREC                            CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           CLE014    WHEQ 'Y'                                       CLE014
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C                     ADD  1         C                               CLE014
     C           C         OCUR LEFRBS                                    CLE014
     C**********           Z-ADDLNRF      WRLNRF                                       CLE014 CLE148
     C                     MOVELLNRF      WRLNRF                                              CLE148
     C                     Z-ADDWRAMT     WRRAMT                          CLE014
     C                     Z-ADDNRPD      ADAT                            CLE014
     C                     Z-ADDWRAMT     AMNT                            CLE014
     C                     MOVEL'RE'      ATYP                            CLE014
     C           PCODE     IFEQ *BLANK                                    CLE014
     C           PCODE     OREQ 'A'                                       CLE014
     C           NRPD      IFLT AGRDNB                                    CLE014
     C                     MOVE 'B'       CODE                            CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'F'       CODE                            CLE014
     C                     ENDIF                                          CLE014
     C                     MOVE RFRQ      FREQ                            CLE014
     C                     ENDIF                                          CLE014
      *
     C           FREC      WHEQ 'LEMNFUPF'
     C**********           Z-ADD0         LNRF                                                CLE148
     C                     MOVEL*BLANKS   LNRF                                                CLE148
     C                     Z-ADDSTDT      ADAT
     C                     Z-ADDEXDT      EDAT                                                189343
     C                     MOVELUCCY      CCY
     C                     Z-ADDUAMT      AMNT
     C***********          MOVEL*BLANKS   ATYP                            162967
     C                     MOVEL'US'      ATYP                            162967
     C                     Z-ADDSQNO      USEQ                            162967
     C           PCODE     IFEQ *BLANKS
     C           PCODE     OREQ 'A'                                       147488
     C           STDT      IFLT AGRDNB
     C                     MOVEL'B'       CODE
     C                     ELSE
     C                     MOVEL'F'       CODE
     C                     ENDIF
     C                     ELSE
     C                     MOVELPCODE     CODE
     C                     ENDIF
      *                                                                                       189343
      ** Set up details of future manual utilisation end date/expiry.                         189343
      *                                                                                       189343
     C           FREC      WHEQ 'LEMNFUPE'                                                    189343
     C**********           Z-ADD0         LNRF                                         189343 CLE148
     C                     MOVEL*BLANKS   LNRF                                                CLE148
     C                     Z-ADDEXDT      ADAT                                                189343
     C                     MOVELUCCY      CCY                                                 189343
     C                     Z-ADDUAMT      AMNT                                                189343
     C                     MOVEL'UE'      ATYP                                                189343
     C                     Z-ADDSQNO      USEQ                                                189343
     C           PCODE     IFEQ *BLANKS                                                       189343
     C           PCODE     OREQ 'A'                                                           189343
     C           EXDT      IFGE AGRDNB                                                        189343
     C                     MOVEL'F'       CODE                                                189343
     C                     ELSE                                                               189343
     C                     MOVEL'B'       CODE                                                189343
     C                     ENDIF                                                              189343
     C                     ELSE                                                               189343
     C                     MOVELPCODE     CODE                                                189343
     C                     ENDIF                                                              189343
      *                                                                                       189343
     C                     ENDSL
      *
     C           WREC      IFEQ *BLANKS                                   147488
     C           FREC      IFNE 'LEMNFUPF'                                                    189343
     C           FREC      ANDNE'LEMNFUPE'                                                    189343
     C                     Z-ADD*ZEROS    EDAT                                                189343
     C                     ENDIF                                                              189343
     C                     WRITELEFCEND0
     C                     ENDIF                                          147488
      *
     C                     ENDSR
      /EJECT
      *                                                                   CLE014
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      *                                                               *   CLE014
      *  SRRAMT  -  Set Repayment Amount                              *   CLE014
      *                                                               *   CLE014
      *  Called by: SRFRMT                                            *   CLE014
      *  Calls:                                                       *   CLE014
      *  GLINTC - Calculates interest                                 *   CLE014
      *                                                               *   CLE014
      *****************************************************************   CLE014
      *                                                                   CLE014
     C           SRRAMT    BEGSR                                          CLE014
      *                                                                   CLE014
      ** Initialise repayment amount workfield                            CLE014
      *                                                                   CLE014
     C                     Z-ADD*ZERO     WRAMT  150                      CLE014
     C                     SELEC                                          CLE014
      *                                                                   CLE014
      ** Repayment type 1 or 2                                            CLE014
      *                                                                   CLE014
     C           REPT      WHEQ 1                                         CLE014
     C           REPT      OREQ 2                                         CLE014
     C                     Z-ADDRAMT      WRAMT                           CLE014
      *                                                                   CLE014
      ** Repayment type 3                                                 CLE014
      *                                                                   CLE014
     C           REPT      WHEQ 3                                         CLE014
      *                                                                   CLE014
      ** Compute for interest                                             CLE014
      *                                                                   CLE014
     C                     Z-ADDSLID      ZIBEG                           CLE014
     C                     Z-ADDNRPD      ZIEND                           CLE014
     C                     Z-ADDICBS      ZICALC                          CLE014
     C                     Z-ADDCPAM      ZIAMT                           CLE014
     C                     Z-ADDINTR      ZIRATE                          CLE014
     C/COPY WNCPYSRC,LEH01304
     C                     EXSR GLINTC                                    CLE014
      *                                                                   CLE014
      ** Round down interest if required                                  CLE014
      *                                                                   CLE014
     C           RDFC      IFEQ 'Y'                                       CLE014
     C                     Z-ADDZINTR     WRDOWN 130                      CLE014
     C                     Z-ADDWRDOWN    ZINTR                           CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADDZINTR     WRUP   130H                     CLE014
     C                     Z-ADDWRUP      ZINTR                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           RAMT      SUB  ZINTR     WRAMT                           CLE014
      *                                                                   CLE014
     C                     ENDSL                                          CLE014
      *                                                                   CLE014
     C                     ENDSR                                          CLE014
      *                                                                   CLE014
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      * SRNEWI  -  Compute for new interest rate                      *   CLE014
      * Called by: SRFRMT                                             *   CLE014
      *                                                               *   CLE014
      * Calls    : None                                               *   CLE014
      *****************************************************************   CLE014
     C           SRNEWI    BEGSR                                          CLE014
      *                                                                   CLE014
      ** Reflect spread to effective interest                             CLE014
      *                                                                   CLE014
     C                     SELEC                                          CLE014
     C           WCUSI     WHEQ 'A'                                       CLE014
     C           WCUBR     ADD  WCUSP     WCURT                           CLE014
     C           WCUSI     WHEQ 'S'                                       CLE014
     C           WCUBR     SUB  WCUSP     WCURT                           CLE014
     C           WCUSI     WHEQ 'P'                                       CLE014
     C           WCUSP     DIV  100       WWORK  119                      CLE014
     C           WCUBR     MULT WWORK     WCURT                           CLE014
     C                     ENDSL                                          CLE014
      *                                                                   CLE014
     C                     ENDSR                                          CLE014
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      * SRINCL  -  Interest calculation                               *   CLE014
      * Called by: SRFRMT                                             *   CLE014
      *                                                               *   CLE014
      * Calls    : GLINTC                                             *   CLE014
      *****************************************************************   CLE014
     C           SRINCL    BEGSR                                          CLE014
      *                                                                   CLE014
      ** Do not compute for interest if not greater than 0                CLE014
      *                                                                   CLE014
     C           WCURT     IFLE *ZEROS                                    CLE014
     C           CPAM      OREQ *ZEROS                                    CLE014
     C                     Z-ADD*ZEROS    ZINTR                           CLE014
     C                     ELSE                                           CLE014
      *                                                                   CLE014
     C                     Z-ADDWLICD     ZIBEG                           CLE014
     C                     MOVE WICBS     ZICALC                          CLE014
     C                     Z-ADDWCUPR     ZIAMT                           CLE014
     C                     Z-ADDWCURT     ZIRATE                          CLE014
     C/COPY WNCPYSRC,LEH01305
     C                     EXSR GLINTC                                    CLE014
      *                                                                   CLE014
      ** Round down interest if required                                  CLE014
      *                                                                   CLE014
     C           RDFC      IFEQ 'Y'                                       CLE014
     C                     Z-ADDZINTR     RDWORK 130                      CLE014
     C                     Z-ADDRDWORK    ZINTR                           CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADDZINTR     RUWORK 130H                     CLE014
     C                     Z-ADDRUWORK    ZINTR                           CLE014
     C                     ENDIF                                          CLE014
     C                     Z-ADDZIEND     WLICD                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDSR                                          CLE014
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   154591
      *                                                               *   154591
      *  SRCRAG - Subroutine to Process Records in LEFCAML8 when      *   154591
      *           facility being enquired is a CA                     *   154591
      *                                                               *   154591
      *  Called By: Main Processing                                   *   154591
      *                                                               *   154591
      *  Calls    : NONE                                              *   154591
      *                                                               *   154591
      *****************************************************************   154591
      *                                                                   154591
     C           SRCRAG    BEGSR                                          154591
      *                                                                   154591
     C                     MOVELBRCA      WBRCH   3                       154591
     C**********           Z-ADDCNUM      WCSNO   60                                   154591 247204
     C**********           MOVELFACT      WFLTY   50                                   154591 247204
     C**********           MOVE FCNO      WFLTY                                        154591 247204
     C**********           Z-ADDPCNUM     WCSNO   60                                   247204 CSD027
     C                     MOVE PCNUM     WCSNO   6                                           CSD027
     C                     MOVELPFACT     WFLTY   50                                          247204
     C                     MOVE PFCNO     WFLTY                                               247204
      *                                                                   154591
      ** Retrieve actions                                                 154591
      *                                                                   154591
     C           PCODE     IFEQ 'A'                                       154591
     C           PCODE     ORNE 'A'                                       154591
     C           PRTR      ANDNE'P'                                       154591
     C           PRTR      ANDNE'I'                                       154591
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           WCAKY     SETLLLEFCAML8                                  154591
     C           WCAKY     READELEFCAML8                 02               154591
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN02     ANDEQ*OFF                                      156226
     C           WCAKY     READELEFCAML8                 02               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C           *IN02     DOWEQ'0'                                       154591
     C           PCODE     IFEQ 'B'                                       154591
     C           VLDT      ANDLTAGRDNB                                    154591
     C           FREC      ANDEQ'LEFCAMPF'                                154591
     C           PCODE     OREQ 'B'                                       154591
     C           VDAT      ANDLTAGRDNB                                    154591
     C           FREC      ANDEQ'LOAMSDKF'                                154591
     C           PCODE     OREQ 'B'                                       154591
     C           VDAT      ANDLTAGRDNB                                    154591
     C           ORED      ANDEQAGRDNB                                    154591
     C           FREC      ANDEQ'CLOANCL1'                                154591
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'B'                                       154591
     C           STDT      ANDLTAGRDNB                                    154591
     C           ORED      ANDEQAGRDNB                                    154591
     C           FREC      ANDEQ'LEMNFUPF'                                154591
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'F'                                       154591
     C           VLDT      ANDGEAGRDNB                                    154591
     C           FREC      ANDEQ'LEFCAMPF'                                154591
     C           PCODE     OREQ 'F'                                       154591
     C           VDAT      ANDGEAGRDNB                                    154591
     C           FREC      ANDEQ'LOAMSDKF'                                154591
     C           PCODE     OREQ 'F'                                       154591
     C           VDAT      ANDGEAGRDNB                                    154591
     C********** ORED      ANDEQAGRDNB                                    154591              204479
     C           FREC      ANDEQ'CLOANCL1'                                154591
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'F'                                       154591
     C           STDT      ANDGEAGRDNB                                    154591
     C           ORED      ANDEQAGRDNB                                    154591
     C           FREC      ANDEQ'LEMNFUPF'                                154591
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ *BLANKS                                   154591
     C           FREC      ANDNE'FACHISAF'                                154591
     C           FREC      ANDNE'CLOANCL2'                                154591
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'A'                                       154591
     C           FREC      ANDNE'FACHISAF'                                154591
     C           FREC      ANDNE'CLOANCL2'                                154591
     C           RECI      ANDNE'R'                                       190124
      *                                                                   154591
     C                     MOVE 'Y'       WPRIN                           157545
     C           AMTP      IFEQ 'MR'                                      157545
     C           PRAM      ANDEQ0                                         157545
     C                     MOVE 'N'       WPRIN                           157545
     C                     ENDIF                                          157545
      *                                                                   157545
     C           VLDT      IFGE PVLDT                                     154591
     C           FREC      ANDEQ'LEFCAMPF'                                154591
     C           VDAT      ORGE PVLDT                                     154591
     C           FREC      ANDEQ'LOAMSDKF'                                154591
     C           WPRIN     ANDEQ'Y'                                       157545
     C           VDAT      ORGE PVLDT                                     154591
     C           ORED      ANDEQAGRDNB                                    154591
     C           FREC      ANDEQ'CLOANCL1'                                154591
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       204479
     C           VDAT      ORGE PVLDT                                     154591              204479
     C           VDAT      ANDGEAGRDNB                                    154591              204479
     C           ORED      ANDNEAGRDNB                                    154591              204479
     C           FREC      ANDEQ'CLOANCL1'                                154591              204479
     C           RECI      ANDNE'R'                                                           204479
      *                                                                                       204479
     C           STDT      ORGE PVLDT                                     154591
     C           ORED      ANDEQAGRDNB                                    154591
     C           FREC      ANDEQ'LEMNFUPF'                                154591
     C           RECI      ANDNE'R'                                       190124
     C                     EXSR SRFRMT                                    154591
     C                     ENDIF                                          154591
      *                                                                   154591
     C                     ENDIF                                          154591
     C           WCAKY     READELEFCAML8                 02               154591
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN02     ANDEQ*OFF                                      156226
     C           WCAKY     READELEFCAML8                 02               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C                     ENDDO                                          154591
     C                     ENDIF                                          154591
      *                                                                   154591
     C                     ENDSR                                          154591
      *                                                                   154591
      /EJECT                                                              154591
      *****************************************************************
      *                                                               *
      *  *PSSR   -  Program exception error routine                   *
      *             Called automatically if a program error occurs,   *
      *             or directly by the program code using EXSR.       *
      *             This subroutine DUMPs the program just once.      *
      *                                                               *
      *  Called by: Main Processing                                   *
      *  Calls: None                                                  *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR SR **
      *
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     CALL 'DBERRCTL'
     C                     END
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      /EJECT
      *****************************************************************                       246233
      *                                                               *                       246233
      *  SRPART  - Check if facility enquired on has participant(s)   *                       246233
      *                                                               *                       246233
      *  Called By: SRFACH                                            *                       246233
      *                                                               *                       246233
      *  Calls    : SRCUST                                            *                       246233
      *                                                               *                       246233
      *****************************************************************                       246233
      *                                                                                       246233
     C           SRPART    BEGSR                                                              246233
      *                                                                                       246233
     C                     READ FCLTYG                   99                                   246233
     C           *IN99     DOWEQ*OFF                                                          246233
      *                                                                                       246233
      ** Do While not EOF                                                                     246233
      *                                                                                       246233
     C           PMFC      IFEQ PCNUM                                                         246233
     C           PMFT      ANDEQPFACT                                                         246233
     C           PMFN      ANDEQPFCNO                                                         246233
      *                                                                                       246233
     C                     MOVELBRCA      WBRCA   3                                           246233
     C**********           Z-ADDCNUM      WCSNO                                        246233 CPK028
     C                     MOVE CNUM      WCSNO                                               CPK028
     C                     MOVELFACT      WFLTY                                               246233
     C                     MOVE FCNO      WFLTY                                               246233
     C                     MOVE *OFF      *IN97                                               246233
     C           WFACH     SETLLFACHISA6                                                      246233
     C           *IN97     DOWEQ*OFF                                                          246233
     C           WFACH     READEFACHISA6                 97                                   246233
     C           *IN97     IFEQ *OFF                                                          246233
     C           FADATE    ANDGEPVLDT                                                       AR936915
     C                     MOVELCNUM      ##CNUM 10                                           246233
     C                     EXSR SRCUST                                                        246233
     C                     MOVE FARECI    RECI                                                246233
     C**********           Z-ADDFALOAN    LNRF                                         246233 CLE148
     C                     MOVELFALOAN    LNRF                                                CLE148
     C                     Z-ADDFADATE    ADAT                                                246233
     C                     MOVELPCCY      CCY                                                 246233
     C                     Z-ADDFAAAMT    AMNT                                                246233
     C                     MOVELFAACTN    ATYP                                                246233
     C                     Z-ADDFASQNO    USEQ                                                246233
     C                     MOVEL'H'       CODE                                                246233
     C                     MOVE FARCIN    RVCR                                                246233
     C                     Z-ADD*ZEROS    EDAT                                                246233
     C                     WRITELEFCEND0                                                      246233
     C                     ENDIF                                                              246233
     C                     ENDDO                                                              246233
      *                                                                                       246233
     C                     ENDIF                                                              246233
     C                     READ FCLTYG                   99                                   246233
     C                     ENDDO                                                              246233
      *                                                                                       247204
      ** Retrieve the details of the original facility                                        247204
      *                                                                                       247204
     C           WFCLT     CHAINFCLTY                01                                       247204
      *                                                                                       246233
     C                     ENDSR                                                              246233
      *****************************************************************                       246233
      /EJECT                                                                                  246233
      *****************************************************************                       246233
      *                                                               *                       246233
      *  SRCUST - Verify Customer Number                              *                       246233
      *                                                               *                       246233
      *  Called By: SRPART                                            *                       246233
      *                                                               *                       246233
      *****************************************************************                       246233
      *                                                                                       246233
     C           SRCUST    BEGSR                                                              246233
      *                                                                                       246233
     C                     CALL 'AOCUSTR0'                                                    246233
     C                     PARM *BLANKS   P@RTCD  7                                           246233
     C                     PARM '*KEY   ' P@OPTN  7                                           246233
     C                     PARM ##CNUM    P@KEY1 10                                           246233
     C                     PARM           P@KYST  7                                           246233
     C           SDCUST    PARM SDCUST    DSSDY                                               246233
      *                                                                                       246233
      ** Handle Database Error                                                                246233
      *                                                                                       246233
     C           P@RTCD    IFNE *BLANKS                                                       246233
     C           *LOCK     IN   LDA                                                           246233
     C                     MOVEL'SDCUSTPD'DBFILE    P      ****************                   246233
     C                     MOVEL##CNUM    DBKEY     P      * DB ERROR 004 *                   246233
     C                     Z-ADD004       DBASE            ****************                   246233
     C                     EXSR *PSSR                                                         246233
     C                     ENDIF                                                              246233
      *                                                                                       246233
     C                     ENDSR                                                              246233
      *                                                                                       246233
      *****************************************************************                       246233
      /EJECT                                                                                  246233
     C/COPY ZSRSRC,ZDATE1Z2                                                                   207963
     C/COPY ZSRSRC,ZDATE2Z2                                                                   207963
     C/COPY ZSRSRC,GLINTCZ1                                               CLE014
     C/COPY ZSRSRC,ZINTDYZ2                                               CLE014
     C/COPY ZSRSRC,ZDATE9Z3                                               CLE014
     C/COPY ZSRSRC,ZDAT10Z2                                               CLE014
     C/COPY ZSRSRC,ZFREQBZ2                                                                   207963
     C/COPY ZSRSRC,ZACCH                                                                      207963
     C/COPY ZSRSRC,ZCHKH                                                                      207963
      ********************************************************************
**  CPY@
(c) Finastra International Limited 2001
** CMD - QCMDEXC COMMAND
CLRPFM FILE(          ) MBR(          )                                                     MD044620
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN    CLE014
00366007310109601461                                                      CLE014
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR       CLE014
00000000310005900090001200015100181002120024300273003040033400365         CLE014
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH                                                     207963
312831303130313130313031                                                                      207963
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                                          207963
0366073110961461                                                                              207963
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                                            207963
000031059090120151181212243273304334365                                                       207963
**   ZMNM - MONTHS SHORT NAMES                                                                207963
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC                                                          207963
=======
     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Facility activity enquiry (CA & Part)')       *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE0213 - Midas LE Facility Activity Enquiry (CA & Part.)     *
      *                                                               *
      *  Function:  This program writes records to file LEFCENPD when *
      *  (I/C)      facility being enquired is a CA or a participant  *
      *             facility                                          *
      *                                                               *
      *  Called By: LE0211 - Facility Activity Enquiry                *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD055657           Date 14May20               *
      *  Prev Amend No. AR674226           Date 04Dec19               *
      *                 MD053295           Date 13Apr19               *
      *                 MD050139           Date 23Mar18               *
      *                 MD046248           Date 27Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD044620           Date 10Apr17               *
      *                 CGL184             Date 07Dec16               *
      *                 CLE154             Date 07Aug12               *
      *                 240697             Date 06Mar15               *
      *                 AR936915           Date 07Oct14               *
      *                 AR830785           Date 07May13               *
      *                 AR996895           Date 25Nov12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CLE064             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CPK028             Date 01Jun07               *
      *                 247204             Date 26Apr07               *
      *                 246141             Date 26Mar07               *
      *                 246233             Date 07Mar07               *
      *                 245182             Date 29Jan07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CLE106             Date 17Mar05               *
      *                 CIR013             Date 25Apr05               *
      *                 CGL029             Date 01Sep03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 215966             Date 17Mar03               *
      *                 207963             Date 08Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 205543             Date 12Jun02               *
      *                 204479             Date 26Apr02               *
      *                 204441             Date 25Apr02               *
      *                 204383             Date 25Apr02               *
      *                 204669             Date 24Apr02               *
      *                 204795             Date 24Apr02               *
      *                 201909             Date 24Apr02               *
      *                 204304             Date 24Apr02               *
      *                 204477             Date 24Apr02               *
      *                 204026             Date 24Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 189570             Date 16Oct01               *
      *                 189343             Date 11Sep01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CLE014             Date 20Mar01               *
      *                 190124             Date 17Apr01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      *                 189088             Date 02Feb01               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 163331             Date 05Jul99               *
      *                 CLE009             Date 11May99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 162967             Date 25Jun99               *
      *                 157545             Date 23Mar99               *
      *                 156226             Date 09Mar99               *
      *                 154245             Date 25Feb99               *
      *                 154591             Date 09Feb99               *
      *                 148725             Date 02Feb99               *
      *                 154114             Date 28Jan99               *
      *                 151292             Date 21Jan99               *
      *                 147488             Date 08Dec98               *
      *                 128980  *CREATE    Date 02Dec98               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD055657 - Manual transaction from FFC TI Interface went to  *
      *             repair queue because the facility exchange rate is*
      *             longer than the defined facility exchange rate in *
      *             Midas. Increase the field definition of the Midas *
      *             facility exchange rate. (Recompile)               *
      *  AR674226 - Manual transaction reached 999. Increase the size *
      *             of utilisation sequence no. and transaction       *
      *             sequence. (Child: AR674227)                       *
      *           - Applied for MD054782.                             *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  MD044620 - Temporary files of LEFCENPD & LEFATRPD are being  *
      *             created in XPLIB. Remove previous defined array:  *
      *             'CLRPFM FILE(          )' and instead, clear new  *
      *             members passed. Remove part of fix AR936915.      *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  CLE154 - Loan Repayment Schedule Enhancement (Recompile)     *
      *  240697 - Recompiled due to changed LF/LEFCAML8.              *
      *  AR936915 - Syndicated facility filtered by From Date shows   *
      *             Facility Increase for Funding Part in Facility    *
      *             Activity Enquiry. Filter events of participants   *
      *             by date. Also, remove previous defined arrays:    *
      *             1. CLRPFM FILE(QTEMP/LEFCENPD)                    *
      *             2. CLRPFM FILE(QTEMP/LEFATRPD)                    *
      *             and instead, clear new filenames passed.          *
      *             (Child: AR936917)                                 *
      *           - Applied for MD030660                              *
      *  AR830785 - Looping on insert of accrued interest adjustment  *
      *             Extended core fix 263533. (Child: AR830786)       *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CPK028 - CNUM & PCNUM are now alpha fields.                  *
      *  247204 - Unactioned Facility Amendments for CA are not shown *
      *           on the Facility Activity Enquiry. Key values used   *
      *           to chain to LEFCAML8 in subr/SRCRAG are overwritten *
      *           with zero values in SRFACH.                         *
      *         - Corrected 246233 to retrieve the details of the     *
      *           original facility being processed because fields    *
      *           are being overriden after processing subr/SRPART.   *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  246233 - Primary facility history is not consistent in       *
      *           display.  Included FIs of the participants on       *
      *           display.                                            *
      *  245182 - Code should be 'P' for maturity when it passed run  *
      *           date.                                               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CLE106 - Syndication Manager                                 *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enahancements to CAS001, CAS002 and CAS004          *
      *           (Recompile)                                         *
      *  215966 - Program looping because WSTAC = 'Y' stops ZDAYNO    *
      *           increasing up to maturity date.                     *
      *  207963 - Include all of the repayment frequency in the       *
      *           projection of loan's maturity.                      *
      *           For loan amendments, if rept = '1' and RPSC, show   *
      *           the correct repayment amount (TAMT).                *
      *  205543 - Recompiled due to changed LF/LEFCAML8.              *
      *  204479 - Future-valued loans entered prior to rundate are    *
      *           not included in the enquiry.                        *
      *  204441 - Projected maturity event being displayed after loan *
      *           has been reversed                                   *
      *  204383 - Proj freq based repayments not reflected on enquiry *
      *  204669 - Display Past Due repayments of principal if code 'A'*
      *           or code 'P' is used to select records. Don't show   *
      *           maturity if it has gone Past Due. Don't show history*
      *           if code 'B' or code 'P' was used to select records. *
      *  204795 - Future valued repayment has been displayed prior to *
      *           the loans maturity date.  Recompiled due to change  *
      *           in LF/LEFCAML8.                                     *
      *  201909 - Do not report reversed Manual Utilisations or Loans.*
      *           If loan was reversed today, do not display any of   *
      *           its records from the facility history file.         *
      *  204304 - Reversed loan which started prior to today is still *
      *           shown on the enquiry.                               *
      *  204477 - MFU booked and reversed still shows in facility     *
      *           activity enquiry                                    *
      *  204026 - A Reversed Manual Facility Utilisation (MFU) should *
      *           no longer be shown in the FCAC enquiry.             *
      *  189570 - Populate the facility detail fields on LEFCENPD.    *
      *  189343 - Generate records for future loan maturity date and  *
      *           MFU expiry date.                                    *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *           Applied part of fix of 189343                       *
      *  190124 - Enquiry should not display reversed loans or MFUs.  *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  189088 - Manual Facility Utilisations against Tranches should*
      *           appear for the Credit Agreement. Reinstate some code*
      *           removed by 154591. LEFCENPD/L0 are now situated in  *
      *           QTEMP to avoid locking problems, so CLRPFM LEFCENPD *
      *           from QTEMP.                                         *
      *  163331 - Future dated utilisation start not showing if       *
      *           entered on the previous day.                        *
      *  CLE009 - LE I/C Swift Message Generation for Fees (Recompile)*
      *  162967 - No decription is shown for manual utilisation       *
      *  157545 - Manual interest payment is shown on facility        *
      *           activity enquiry.                                   *
      *  156226 - 'ALL' for branch field should also be accepted.     *
      *  154245 - Revolving Credit changes to facility not working    *
      *           properly                                            *
      *  154591 - Facility amendments and utilisation of tranches and *
      *           participants should not be shown when enquiring     *
      *           Credit Agreement facility. Also, show other faclty  *
      *           activity if loan has SC amendment.                  *
      *  148725 - Spread rate change amendment for loan shows blank   *
      *           narrative and zero rate on enquiry.                 *
      *  154114 - Fee activity enquiry should input immediately.      *
      *           Recompiled due to change in LEFCAML8.               *
      *  151292 - Repayment for a risk loan appearing on facility     *
      *           activity enquiry when 'Code' field is left blank.   *
      *  147488 - Difficulty in distinguishing a prime and a          *
      *           participant facility on Facility Activity Enquiry   *
      *  128980 - Tranche does not show historic details of           *
      *           participant transactions                            *
      *                                                               *
      *****************************************************************
     FLEFCAML8IF  E           K        DISK         KINFDS FSDS
     FLEFCAMLAIF  E           K        DISK                               CLE014
     F            LOAMSDKF                          KRENAMELOAMSDLA       CLE014
     FLELOANL7IF  E           K        DISK
     FLEMNFUL0IF  E           K        DISK                                                   204026
     F            LEMNFUPF                          KRENAMELEMNF13                            204026
     F*CLOANLB*IF  E           K        DISK                       147488 156226
     F*********** CLOANCLF                          KRENAMECLOANLBF147488 156226
     F*FCLTYL1*IF  E           K        DISK                              156226
     F*********** FCLTYFMF                          KRENAMEFCLTY          156226
     FLEMNFUL7IF  E           K        DISK                                                   189343
     F            LEMNFUPF                          KRENAMELEMNUPLJ                           189343
     FFACHSAL3IF  E           K        DISK                                                   189343
     F            FACHISAF                          KRENAMEFACHISLJ                           189343
     FCLOAN   IF  E           K        DISK                               156226
     F            CLOANCLF                          KRENAMECLOANF         156226
     F            CLOANHHF                          KIGNORE               156226
     F            CLOANCKF                          KIGNORE               156226
     F            CLOANZ1F                          KIGNORE               156226
     FFCLTY   IF  E           K        DISK                               156226
     F            FCLTYFMF                          KRENAMEFCLTYF         156226
     F            FCLTYHHF                          KIGNORE               156226
     F            FCLTYFNF                          KIGNORE               156226
     F            FCLTYZZF                          KIGNORE               156226
     FLEFCLTL9IF  E           K        DISK
     FLEFCLTLEIF  E           K        DISK                                                   204026
     F            FCLTYFMF                          KRENAMELEFCLTZ1                           204026
     FFACHSAL1IF  E           K        DISK
     F            FACHISAF                          KRENAMEFACHISA1
     FLOAMS   IF  E           K        DISK
     F            LOAMSDHF                          KIGNORE
     F            LOAMSDKF                          KRENAMELOAM
     F            LOAMSZ1F                          KIGNORE
     FHISLAML0IF  E           K        DISK                               CLE014
     F            LOAMSDKF                          KRENAMELOAMS213       CLE014
     FLEFCENPDO   E                    DISK         KCOMIT            UC
     FLEFATRPDO   E                    DISK         KCOMIT            UC                      189343
     FFCLTYFM IF  E           K        DISK         KINFSR *PSSR                              246233
     F            FCLTYFMF                          KRENAMEFCLTYG                             246233
     FFACHSAL6IF  E           K        DISK                                                   246233
     F            FACHISAF                          KRENAMEFACHISA6                           246233
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      *   01  - Record not Found                                      *
      *   02  - Record not Found                                      *
      *   03  - Record not Found                                      *   147488
      *   05  - End of file LF/LEFCAMLA                               *   CLE014
      *   07  - Utilisation record from LEFCENL0                      *                       189343
      *   08  - RE record from history, skip INT computation          *   CLE014
      *   09  - Record not found in LEMNFUL7                          *                       189343
      *   15  - Record found in Past Due Array                        *                       204669
      *   16  - Chain to CLOAN.                                       *                       204669
      *                                                               *
      * U7+U8 - Database Error                                        *
      *                                                               *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  SRINIT - Program Initialisation                              *
      *  SRFACH - Subroutine to Process Records in FACHISA            *
      *  SRFCAM - Subroutine to Process Records in LEFCAML8 when      *
      *           facility being enquired is a CA                     *
      *  SRFTRA - Subroutine to Process Records in LEFCAML8 when      *
      *           facility being enquired is a participant facility   *
      *  SRLOAM - Subroutine to Process Records in LOAMSDK            *
      *  SRFRMT - Subroutine to Format Fields in LEFCENPD             *
      *  *PSSR  - Program Error Processing Subroutine                 *
      *                                                               *
      *****************************************************************
      /EJECT
     E                    CPY@    1   1 80
     E**********          PSDU      150  6 0             Past Due maturity             204669 CLE148
     E                    PSDU      150  6                                                    CLE148
     E**********          CMD     1   1 21               QCMDEXC Cmd      189088
     E**********          CMD     1   1 27               QCMDEXC Cmd                   189088 189343
     E**********          CMD     1   2 27               QCMDEXC Cmd                 189343 AR936915
     E**********          CMD     1   1 27               QCMDEXC Cmd               AR936915 MD044620
     E                    CMD     1   1 39               QCMDEXC Cmd                        MD044620
     E/COPY ZSRSRC,ZDATE9Z1                                               CLE014
     E/COPY ZSRSRC,ZFREQBZ1                                                                   207963
     E/COPY ZSRSRC,ZHOLE                                                                      207963
     E/COPY ZSRSRC,ZDATE2Z1                                                                   207963
      *
      ** Array containing Copyright statement
      *
      /SPACE 3
     ILEFCAMPF                                                                              AR674226
     I              SQNO                            FCSQNO                                  AR674226
      *                                                                   CLE014
     IFCLTYFMF                                                            CLE014
      ** Rename FCLTYFMF of LEFCLTL9                                      CLE014
      *                                                                   CLE014
     I              TRCA                            TRCAF                 CLE014
      *                                                                   CLE014
     IHISTSHMF                                                            CLE014
      ** Rename history header fields                                     CLE014
      *                                                                   CLE014
     I              BRCA                            BRCAHL                CLE014
     I              CNUM                            CNUMHL                CLE014
     I              LNRF                            LNRFHL                CLE014
     I              VDAT                            VDATHL                CLE014
     I              AMTP                            AMTPHL                CLE014
     I              PRAM                            PRAMHL                CLE014
     I              BRTT                            BRTTHL                CLE014
     I              BRTE                            BRTEHL                CLE014
     I              RTSP                            RTSPHL                CLE014
     I              SPIN                            SPINHL                CLE014
     I              REPT                            REPTHL                CLE014
     I              INTC                            INTCHL                CLE014
     I              SUTP                            SUTPHL                CLE014
     I              LCD                             LCDHL                 CLE014
     I              CPAM                            CPAMHL                CLE014
     I              AITC                            AITCHL                CLE014
     I              INTR                            INTRHL                CLE014
     I              AIAP                            AIAPHL                CLE014
     I              IPRD                            IPRDHL                CLE014
     I              WTIN                            WTINHL                CLE014
     I              TOTI                            TOTIHL                CLE014
     I              CALC                            CALCHL                CLE014
     I              CLAS                            CLASHL                                    CLE042
      *                                                                   CLE014
     IHISTSHPF                                                            CLE014
      ** Rename history amount fields                                     CLE014
      *                                                                   CLE014
     I              BRCA                            BRCAHL                CLE014
     I              CNUM                            CNUMHL                CLE014
     I              LNRF                            LNRFHL                CLE014
     I              VDAT                            VDATHL                CLE014
     I              AMTP                            AMTPHL                CLE014
     I              PRAM                            PRAMHL                CLE014
     I              INTA                            INTAHL                CLE014
     I              WTXA                            WTXAHL                CLE014
     I              FEAM                            FEAMHL                CLE014
     I              WOIN                            WOINHL                CLE014
     I              SUTP                            SUTPHL                CLE014
     I              LCD                             LCDHL                 CLE014
     I              CPAM                            CPAMHL                CLE014
     I              AITC                            AITCHL                CLE014
     I              INTR                            INTRHL                CLE014
     I              AIAP                            AIAPHL                CLE014
     I              IPRD                            IPRDHL                CLE014
     I              MNSG                            MNSGHL                CLE014
     I              GASS                            GASSHL                CLE014
     I              ROLN                            ROLNHL                CLE014
     I              CLAS                            CLASHL                                    CLE042
      *                                                                   CLE014
     IHISTSHQF                                                            CLE014
      ** Rename history rate fields                                       CLE014
      *                                                                   CLE014
     I              BRCA                            BRCAHL                CLE014
     I              CNUM                            CNUMHL                CLE014
     I              LNRF                            LNRFHL                CLE014
     I              VDAT                            VDATHL                CLE014
     I              CCY                             CCYHL                 CLE014
     I              AMTP                            AMTPHL                CLE014
     I              BRTT                            BRTTHL                CLE014
     I              BRTE                            BRTEHL                CLE014
     I              RTSP                            RTSPHL                CLE014
     I              SPIN                            SPINHL                CLE014
     I              STAI                            STAIHL                CLE014
     I              IRCF                            IRCFHL                CLE014
     I              LCD                             LCDHL                 CLE014
     I              CPAM                            CPAMHL                CLE014
     I              AITC                            AITCHL                CLE014
     I              INTR                            INTRHL                CLE014
     I              AIAP                            AIAPHL                CLE014
     I              IPRD                            IPRDHL                CLE014
     I              MNSG                            MNSGHL                CLE014
     I              RLCY                            RLCYHL                CLE014
     I              CALC                            CALCHL                CLE014
      *                                                                   CLE014
     ILOAMS213                                                            CLE014
      ** Rename Loan Amendments file                                      CLE014
      *                                                                   CLE014
     I              BRCA                            BRCAHL                CLE014
     I              CNUM                            CNUMHL                CLE014
     I              LNRF                            LNRFHL                CLE014
     I              VDAT                            VDATHL                CLE014
     I              AMTP                            AMTPHL                CLE014
     I              BRTT                            BRTTHL                CLE014
     I              RTSP                            RTSPHL                CLE014
     I              BRTE                            BRTEHL                CLE014
     I              SPIN                            SPINHL                CLE014
     I              CCY                             CCYHL                 CLE014
     I              PRAM                            PRAMHL                CLE014
     I              INTA                            INTAHL                CLE014
     I              TAMT                            TAMTHL                CLE014
     I              STAI                            STAIHL                CLE014
     I              LCD                             LCDHL                 CLE014
     I              CHTP                            CHTPHL                CLE014
     I              REPT                            REPTHL                CLE014
     I              GASS                            GASSHL                CLE014
      *                                                                   CLE014
     ILOAMSDLA                                                            CLE014
      ** Rename Loan Amendments file file from LEFCAMLA                   CLE014
      *                                                                   CLE014
     I              BRCA                            BRCALA                CLE014
     I              FCUS                            FCUSLA                CLE014
     I              FTYP                            FTYPLA                CLE014
     I              FSEQ                            FSEQLA                CLE014
     I              LNRF                            LNRFLA                CLE014
     I              VDAT                            VDATLA                CLE014
     I              AMTP                            AMTPLA                CLE014
     I              CCY                             CCYLA                 CLE014
      *                                                                   CLE014
     ILEMNUPLJ                                                                                189343
      ** Rename fields of LEMNFUL7                                                            189343
      *                                                                                       189343
     I              RECI                            RECILJ                                    189343
     I              BRCA                            BRCALJ                                    189343
     I              CNUM                            CNUMLJ                                    189343
     I              FACT                            FACTLJ                                    189343
     I              FCNO                            FCNOLJ                                    189343
     I              SQNO                            SQNOLJ                                    189343
     I              STDT                            STDTLJ                                    189343
     I              EXDT                            EXDTLJ                                    189343
      *                                                                                       189343
     ILEMNF13                                                                                 204026
     I              RECI                            RECI13                                    204026
     I              BRCA                            BRCA13                                    204026
     I              CNUM                            CNUM13                                    204026
     I              FACT                            FACT13                                    204026
     I              FCNO                            FCNO13                                    204026
     I              SQNO                            SQNO13                                    204026
     I              STDT                            STDT13                                    204026
     I              UCCY                            UCCY13                                    204026
     I              UAMT                            UAMT13                                    204026
     I              UNAR                            UNAR13                                    204026
     I              USTS                            USTS13                                    204026
     I              ORED                            ORED13                                    204026
     I              CHTP                            CHTP13                                    204026
     I              PUAM                            PUAM13                                    204026
     ILEFCLTZ1                                                                                204026
     I              CNUM                            CNUMZ1                                    204026
     I              FACT                            FACTZ1                                    204026
     I              FCNO                            FCNOZ1                                    204026
     I              BRCA                            BRCAZ1                                    204026
     I              CANM                            CANMZ1                                    204026
     I              CAFN                            CAFNZ1                                    204026
     I              CAFT                            CAFTZ1                                    204026
     I              TRCA                            TRCAZ1                                    204026
      *                                                                                       204026
     ILEFRBS      DS                       9999                           CLE014
     I**********                              1   60WRLNRF                             CLE014 CLE148
     I                                        1   6 WRLNRF                                    CLE148
     I                                    P   7  130WRRAMT                CLE014
      *                                                                   CLE014
     I            DS                                                                        AR936915
     I**********                              1  27 CMD                            AR936915 MD044620
     I                                        1  39 CMD                                     MD044620
     I                                       13  22 FLNAME                                  AR936915
     I                                       29  38 MBNAME                                  MD044620
      *                                                                                     AR936915
     ILDA       E DSLDA                         256
      *
      ** Local data area for database error details
      ** *LOCK IN LDA immediately before and OUT LDA immediately
      ** after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
      *
     IRUNDAT    E DSRUNDAT
      *
      ** Data Area giving Installation Control Details
      *
     ISCSARD    E DSSCSARDPD                                              CLE014
      ** SAR file details accessed via access program AOSARDR0            CLE014
      *                                                                   CLE014
     IDSSDY     E DSDSSDY                                                 CLE014
      ** Long data structure for Access Objects                           CLE014
      *                                                                   CLE014
     IDSFDY     E DSDSFDY                                                                     207963
      ** Short data structure for Access Objects                                              207963
      *                                                                                       207963
     ISDGELR    E DSSDGELRPD                                                                  207963
      **  External DS for general ledger details                                              207963
      *                                                                                       207963
     ISDBANK    E DSSDBANKPD                                                                  207963
      **  Bank details accesseD via access program                                            207963
      *                                                                                       207963
     ISDCUST    E DSSDCUSTPD                                                                  246233
      **  External data structures for Customer Details                                       246233
      *                                                                                       246233
     IPSDS       SDS
      *
      ** Program Status Data Structure
      *
     I                                     *PROGRAM PGM
     I                                      244 253 WSID
     I                                      254 263 USER
     IFSDS        DS
      ** File Status Data Structure
      *
     I                                     *RECORD  FREC
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I              'LEFCENPD'            C         FILE1                                   MD044620
     I              'LEFATRPD'            C         FILE2                                   MD044620
     I/COPY ZSRSRC,ZINTDYZ1                                               CLE014
     I/COPY ZSRSRC,ZDATE9Z2                                               CLE014
     I/COPY ZSRSRC,ZDAT10Z1                                               CLE014
     I/COPY ZSRSRC,ZHOLI                                                                      207963
     C/TITLE Main Processing
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
      ** Perform Initialisation.
      *
     C                     EXSR SRINIT
      *
     C***********WFCLT     CHAINFCLTYL1              01                   156226
     C           WFCLT     CHAINFCLTY                01                   156226
      *
     C           *IN01     IFEQ '1'
     C                     MOVELPBRCA     WKEY   14
     C                     MOVELPCNUM     WFCLTY 11
     C                     MOVELPFACT     WFATY   5
     C                     MOVE PFCNO     WFATY
     C                     MOVE WFATY     WFCLTY
     C                     MOVE WFCLTY    WKEY
     C           *LOCK     IN   LDA
     C                     SETON                       U7U8
     C                     Z-ADD1         DBASE            ************
     C***********          MOVEL'FCLTYL1 'DBFILE           * DBERR 01 *   156226
     C                     MOVEL'FCLTY   'DBFILE           * DBERR 01 *   156226
     C                     MOVEL'*KEY  '  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     EXSR SRFACH
      *
      ** Credit agreement
      *
     C           TRCA      IFEQ 'CA'
     C                     EXSR SRCRAG                                    154591
     C                     EXSR SRFCAM
     C                     ELSE
      *
      ** Participant facilities
      *
     C                     EXSR SRFTRA
     C                     EXSR SRLOAM
     C                     ENDIF
      *                                                                                       189343
      ** if facility being enquired is a credit agreement                                     189343
      *                                                                                       189343
     C           TRCA      IFEQ 'CA'                                                          189343
      *                                                                                       189343
      ** check all tranches attached to that CA                                               189343
      *                                                                                       189343
     C           WFCKY     SETLLLEFCLTL9                                                      189343
     C           *IN10     DOWEQ'0'                                                           189343
     C           WFCKY     READELEFCLTL9                 10                                   189343
      *                                                                                       189343
      ** if a tranche is found, retrieve all US records of that TR in                         189343
      ** FACHISA.                                                                             189343
      *                                                                                       189343
     C           *IN10     IFEQ '0'                                                           189343
     C                     MOVELBRCA      WBRCA   3                                           189343
     C**********           Z-ADDCNUM      WCSNO                                        189343 CSD027
     C                     MOVE CNUM      WCSNO                                               CSD027
     C                     MOVELFACT      WFLTY                                               189343
     C                     MOVE FCNO      WFLTY                                               189343
     C                     MOVE '0'       *IN13                                               189343
     C           WFACH     SETLLFACHSAL3                                                      189343
     C           *IN13     DOWEQ'0'                                                           189343
     C           WFACH     READEFACHSAL3                 13                                   189343
      *                                                                                       189343
      ** if US record was found in FACHISA, get FADATE and sequence                           189343
      *                                                                                       189343
     C           *IN13     IFEQ '0'                                                           189343
     C**********           Z-ADDFASQNO    TSEQ    30                                 189343 AR674226
     C                     Z-ADDFASQNO    TSEQ    40                                        AR674226
     C                     Z-ADDFADATE    TDATE   50                                          189343
     C           WLEMN7    SETLLLEMNFUL7                                                      189343
     C           WLEMN7    READELEMNFUL7                 14                                   189343
     C           *IN14     IFEQ '0'                                                           189343
     C                     Z-ADDEXDTLJ    TREXDT                                              189343
     C                     ELSE                                                               189343
     C                     Z-ADD1         TREXDT                                              189343
     C                     ENDIF                                                              189343
     C**********           Z-ADDCNUM      TRCNUM                                       189343 CSD027
     C                     MOVE CNUM      TRCNUM                                              CSD027
     C                     Z-ADDFACT      TRFACT                                              189343
     C                     Z-ADDFCNO      TRFCNO                                              189343
     C                     Z-ADDTDATE     TRSTDT                                              189343
     C                     Z-ADDTSEQ      TRTSEQ                                              189343
     C                     WRITELEFATRD0                                                      189343
      *                    ENDIF                                                              189343
     C                     ELSE                                                               189343
     C                     MOVE '1'       *IN13                                               189343
     C                     ENDIF                                                              189343
     C                     ENDDO                                                              189343
     C                     ENDIF                                                              189343
      *                                                                                       189343
     C                     ENDDO                                                              189343
     C                     ENDIF                                                              189343
      *                                                                                       189343
      *
     C                     COMIT
     C                     ENDIF
      *
     C                     SETON                     LR
      *================================================================
      *  P R O G R A M   E N D                                        *
      *================================================================
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRINIT - Subroutine to do Program Initialisation.            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls    : QCMDEXC                                           *
      *                                                               *
      *****************************************************************
      *
     C           SRINIT    BEGSR
      *
     C           *ENTRY    PLIST
     C                     PARM           PBRCA   3
     C**********           PARM           PCNUM   60                                          CSD027
     C                     PARM           PCNUM   6                                           CSD027
     C                     PARM           PFACT   30
     C                     PARM           PFCNO   20
     C                     PARM           PCCY    3
     C                     PARM           PVLDT   50
     C                     PARM           PCODE   1
     C                     PARM           PNWPF1 10                                         AR936915
     C                     PARM           PNWPF2 10                                         AR936915
      *
      ** Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
      *                                                                   CLE014
      ** Determine if CLE014 is installed                                 CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM '       ' PRTCD   7                       CLE014
     C                     PARM '*VERIFY' POPTN   7                       CLE014
     C                     PARM 'CLE014'  PSARD   6                       CLE014
     C           SCSARD    PARM SCSARD    DSSDY                           CLE014
      *                                                                   CLE014
      ** Handle Database Error                                            CLE014
      *                                                                   CLE014
     C           PRTCD     IFNE *BLANKS                                   CLE014
     C           PRTCD     ANDNE'*NRF   '                                 CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVE 'SCSARDPD'DBFILE                          CLE014
     C                     MOVELPSARD     DBKEY                           CLE014
     C                     Z-ADD2         DBASE                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** CLE014 is installed                                              CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     Z-ADD*ZERO     C       40                      CLE014
     C                     Z-ADD*ZERO     Z       40                      CLE014
     C                     Z-ADD*ZERO     X       30                                          204669
     C                     Z-ADD*ZERO     Y       30                                          204669
     C                     ENDIF                                          CLE014
     C/COPY WNCPYSRC,LEH01303
      *                                                                                       207963
      ** Read bank details via access program                                                 207963
      *                                                                                       207963
     C                     CALL 'AOBANKR0'                                                    207963
     C                     PARM '*MSG   ' @RTCD   7                                           207963
     C                     PARM '*FIRST ' @OPTN   7                                           207963
     C           SDBANK    PARM SDBANK    DSFDY                                               207963
     C           @RTCD     IFNE *BLANK                                                        207963
     C                     MOVE '003'     DBASE            **********                         207963
     C                     MOVEL'*FIRST ' DBOPTN  7        *  003   *                         207963
     C                     MOVEL'*FIRST ' DBKEY            **********                         207963
     C                     MOVEL'SDBANKPD'DBFILE                                              207963
     C                     EXSR *PSSR                                                         207963
     C                     END                                                                207963
      *                                                                                       207963
     C           BJDFIN    IFEQ 'M'                                                           207963
     C                     MOVEL'1'       *IN98                                               207963
     C                     ENDIF                                                              207963
      *
     C**********           MOVELCMD,1     PCMD                                              AR936915
     C**********           MOVELPNWPF1    FLNAME                                   AR936915 MD044620
     C                     MOVELFILE1     FLNAME                                            MD044620
     C                     MOVELPNWPF1    MBNAME                                            MD044620
     C                     CALL 'QCMDEXC'              04
     C**********           PARM           PCMD   21                       189088
     C**********           PARM 21        PLEN   155                      189088
     C**********           PARM           PCMD   27                                  189088 AR936915
     C                     PARM           CMD                                               AR936915
     C**********           PARM 27        PLEN   155                                 189088 MD044620
     C                     PARM 39        PLEN   155                                        MD044620
     C**********           MOVELCMD,2     PCMD                                       189343 AR936915
     C**********           MOVELPNWPF2    FLNAME                                   AR936915 MD044620
     C                     MOVELFILE2     FLNAME                                            MD044620
     C                     MOVELPNWPF2    MBNAME                                            MD044620
     C                     CALL 'QCMDEXC'              06                                     189343
     C**********           PARM           PCMD   27                                  189343 AR936915
     C                     PARM           CMD                                               AR936915
     C**********           PARM 27        PLEN   155                                 189343 MD044620
     C                     PARM 39        PLEN   155                                        MD044620
      *****************************************************************            MD035545 MD047993
      ***Access*general*ledger*details.********************************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*MSG   ' @RTCD   7                                MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN   7                                MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
      ** Retrieve system value setting.                                                     MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   @RTCD                                             MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'.                            MD035545
      *                                                                                     MD035545
     C           @RTCD     IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *
      ** Read in Installation Data
      *
     C           *NAMVAR   DEFN           RUNDAT
     C           *NAMVAR   DEFN           LDA
     C                     IN   RUNDAT
      *
     C                     MOVELPFACT     WFCTY   50
     C                     MOVE PFCNO     WFCTY
      *
     C           WFCLT     KLIST
     C***********          KFLD           PBRCA                           156226
     C                     KFLD           PCNUM
     C                     KFLD           PFACT
     C                     KFLD           PFCNO
      *
     C           WFAKY     KLIST
     C                     KFLD           PCNUM
     C                     KFLD           WFCTY
      *
     C           WFCKY     KLIST
     C                     KFLD           PCNUM
     C                     KFLD           PFACT
     C                     KFLD           PFCNO
      *                                                                   CLE014
      ** Key list to chain LF/HISLAML0                                    CLE014
      *                                                                   CLE014
     C           KEYH      KLIST                                          CLE014
     C                     KFLD           BRCA                            CLE014
     C                     KFLD           CNUM                            CLE014
     C                     KFLD           LNRF                            CLE014
      *                                                                                       189343
     C           WFACH     KLIST                                                              189343
     C                     KFLD           WCSNO                                               189343
     C                     KFLD           WFLTY                                               189343
      *                                                                                       189343
     C           WLEMN7    KLIST                                                              189343
     C                     KFLD           BRCA                                                189343
     C                     KFLD           CNUM                                                189343
     C                     KFLD           FACT                                                189343
     C                     KFLD           FCNO                                                189343
     C                     KFLD           TDATE                                               189343
     C                     KFLD           TSEQ                                                189343
      *
     C           WCAKY     KLIST
     C***********          KFLD           WBRCH                           156226
     C                     KFLD           WCSNO
     C                     KFLD           WFLTY
      *                                                                                       204026
     C           WLEM13    KLIST                                                              204026
     C                     KFLD           WBRCA                                               204026
     C                     KFLD           WCNUM                                               204026
     C                     KFLD           WFACT                                               204026
     C                     KFLD           WFCNO                                               204026
     C                     KFLD           WSQNO                                               204026
      *
     C           WCLON     KLIST                                          147488
     C***********          KFLD           BRCA                     147488 156226
     C                     KFLD           WLNRF                           147488
      *                                                                   147488
     C           WPTKY     KLIST                                          147488
     C***********          KFLD           BRCA                     147488 156226
     C**********           KFLD           WFCUS   60                                   147488 CSD027
     C                     KFLD           WFCUS   6                                           CSD027
     C                     KFLD           WFTYP   30                      147488
     C                     KFLD           WFSEQ   20                      147488
      *                                                                   147488
     C                     OPEN LEFCENPD
      *
     C                     OPEN LEFATRPD                                                      189343
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRFACH - Subroutine to Process Records in FACHISA            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls    : NONE                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRFACH    BEGSR
      *
     C           WFAKY     SETLLFACHISA1
      *
     C           WFAKY     READEFACHISA1                 01
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN01     ANDEQ*OFF                                      156226
     C           WFAKY     READEFACHISA1                 01               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C           *IN01     DOWEQ'0'
      * Only display historic events if after selection date, and                             204669
      * if the User did not specify only Backvalued or only Past Due,                         204669
     C           FADATE    IFGE PVLDT
     C           PCODE     ANDNE'P'                                                           204669
     C           PCODE     ANDNE'B'                                                           204669
     C                     MOVE *BLANK    WREC    1                       147488
      *                                                                   147488
      ** Exclude participant transactions when code is not A              147488
      *                                                                   147488
     C           PRTR      IFNE 'P'                                       147488
     C           PRTR      ANDNE'I'                                       147488
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           PCODE     ANDNE'A'                                       147488
     C**********           Z-ADDFALOAN    WLNRF                                        147488 CLE148
     C                     MOVELFALOAN    WLNRF                                               CLE148
     C***********WCLON     CHAINCLOANLB              03            147488 156226
     C           WCLON     CHAINCLOAN                03                   156226
     C                     SELEC                                          147488
     C           *IN03     WHEQ '0'                                       147488
     C           LPFI      ANDNE'P'                                       147488
     C           LPFI      ANDNE'I'                                       147488
     C           LPFI      ANDNE'R'                                       151292
     C           LPFI      ANDNE'S'                                                           CLE106
     C**********           Z-ADDFCUS      WFCUS                                        147488 CSD027
     C                     MOVE FCUS      WFCUS                                               CSD027
     C                     Z-ADDFTYP      WFTYP                           147488
     C                     Z-ADDFSEQ      WFSEQ                           147488
     C***********WPTKY     SETLLFCLTYL1                            147488 156226
     C***********WPTKY     READEFCLTYL1                  03        147488 156226
     C           WPTKY     SETLLFCLTY                                     156226
     C           WPTKY     READEFCLTY                    03               156226
     C           *IN03     IFEQ '0'                                       147488
     C           PRTR      ANDEQ'P'                                       147488
     C           *IN03     OREQ '0'                                       147488
     C***********PRTR      ANDEQ'P'                                147488 156226
     C           PRTR      ANDEQ'I'                                       156226
     C           *IN03     OREQ '0'                                                           CLE106
     C           PRTR      ANDEQ'R'                                                           CLE106
     C           *IN03     OREQ '0'                                                           CLE106
     C           PRTR      ANDEQ'S'                                                           CLE106
     C                     MOVEL'Y'       WREC                            147488
     C                     ENDIF                                          147488
     C***********WFCLT     CHAINFCLTYL1              01            147488 156226
     C           WFCLT     CHAINFCLTY                01                   156226
     C           *IN03     WHEQ '0'                                       147488
     C                     MOVE 'Y'       WREC                            147488
     C                     ENDSL                                          147488
     C                     ENDIF                                          147488
      *                                                                                       201909
     C********** FALOAN    IFNE 0                                                      201909 CLE148
     C**********           Z-ADDFALOAN    WLNRF                                        201909 CLE148
     C           FALOAN    IFNE *BLANKS                                                       CLE148
     C                     MOVELFALOAN    WLNRF                                               CLE148
     C           WCLON     CHAINCLOAN                03                                       201909
     C           *IN03     IFEQ '0'                                                           201909
     C           RECI      ANDEQ'R'                                                           201909
     C                     MOVE 'Y'       WREC                                                201909
     C                     ENDIF                                                              201909
     C*                                                                                       204304
     C* If loan was reversed before today, do not display                                     204304
     C*                                                                                       204304
     C           FAREVI    IFEQ 'R'                                                           204304
     C                     MOVE 'Y'       WREC                                                204304
     C                     END                                                                204304
     C*                                                                                       204304
     C                     ENDIF                                                              201909
      *                                                                                       201909
     C           FAACTN    IFEQ 'US'                                                          204026
     C           FAACTN    OREQ 'UI'                                                          204026
     C           FAACTN    OREQ 'UD'                                                          204026
     C*                                                                                       204477
     C* If MFU was reversed before today, do not display                                      204477
     C*                                                                                       204477
     C           FAREVI    IFEQ 'R'                                                           204477
     C                     MOVE 'Y'       WREC                                                204477
     C                     END                                                                204477
     C*                                                                                       204477
     C           FAREVI    IFEQ ' '                                                           204026
      *                                                                                       204026
     C                     MOVE BRCA      WBRCA   3                                           204026
     C**********           Z-ADDFACNUM    WCNUM   60                                   204026 CSD027
     C                     MOVE FACNUM    WCNUM   6                                           CSD027
     C                     Z-ADDFACT      WFACT   30                                          204026
     C                     Z-ADDFCNO      WFCNO   20                                          204026
     C**********           Z-ADDFASQNO    WSQNO   30                                 204026 AR674226
     C                     Z-ADDFASQNO    WSQNO   40                                        AR674226
     C           TRCA      IFEQ 'CA'                                                          204026
      *                    MOVEL                                                              204026
     C           WLEMCA    KLIST                                                              204026
      *                                                                                       204026
     C                     KFLD           WCNUM                                               204026
     C                     KFLD           WFACT                                               204026
     C                     KFLD           WFCNO                                               204026
      *                                                                                       204026
     C           WLEMCA    SETLLLEFCLTLE                                                      204026
     C           WLEMCA    READELEFCLTLE                 05                                   204026
      *                                                                                       204026
     C           *IN05     DOWEQ'0'                                                           204026
     C                     MOVE BRCAZ1    WBRCA                                               204026
     C**********           Z-ADDCNUMZ1    WCNUM                                        204026 CSD027
     C                     MOVE CNUMZ1    WCNUM                                               CSD027
     C                     Z-ADDFACTZ1    WFACT                                               204026
     C                     Z-ADDFCNOZ1    WFCNO                                               204026
      *                                                                                       204026
     C           WLEM13    CHAINLEMNFUL0             03                                       204026
     C           *IN03     IFEQ '0'                                                           204026
     C           RECI13    ANDEQ'R'                                                           204026
     C                     MOVE 'Y'       WREC                                                204026
     C                     ENDIF                                                              204026
     C           WLEMCA    READELEFCLTLE                 05                                   204026
     C                     ENDDO                                                              204026
      *                                                                                       204026
     C                     ELSE                                                               204026
     C           WLEM13    CHAINLEMNFUL0             03                                       204026
     C           *IN03     IFEQ '0'                                                           204026
     C           RECI13    ANDEQ'R'                                                           204026
     C                     MOVE 'Y'       WREC                                                204026
     C                     ENDIF                                                              204026
     C                     ENDIF                                                              204026
     C                     ENDIF                                                              204026
     C                     ENDIF                                                              204026
      *                                                                   147488
     C           WREC      IFEQ *BLANK                                    147488
     C                     MOVE FARECI    RECI
     C**********           Z-ADDFALOAN    LNRF                                                CLE148
     C                     MOVELFALOAN    LNRF                                                CLE148
     C                     Z-ADDFADATE    ADAT
     C                     MOVELPCCY      CCY
     C                     Z-ADDFAAAMT    AMNT
     C                     MOVELFAACTN    ATYP
     C                     Z-ADDFASQNO    USEQ
     C                     MOVEL'H'       CODE
     C                     MOVE FARCIN    RVCR                            154245
     C                     Z-ADD*ZEROS    EDAT                                                189343
      *                                                                                       189343
      ** If FAACTN is 'US' for participations check LEMNFUPD for the                          189343
      ** MFU expiry date.                                                                     189343
      *                                                                                       189343
     C           FAACTN    IFEQ 'US'                                                          189343
     C           TRCA      ANDNE'CA'                                                          189343
     C                     MOVE '0'       *IN09                                               189343
     C           WLEMN     KLIST                                                              189343
     C                     KFLD           PBRCA                                               189343
     C                     KFLD           PCNUM                                               189343
     C                     KFLD           PFACT                                               189343
     C                     KFLD           PFCNO                                               189343
     C                     KFLD           PDATE                                               189343
     C                     KFLD           PSEQ                                                189343
      *                                                                                       189343
     C                     Z-ADDFADATE    PDATE   50                                          189343
     C**********           Z-ADDFASQNO    PSEQ    30                                 189343 AR674226
     C                     Z-ADDFASQNO    PSEQ    40                                        AR674226
      *                                                                                       189343
      *                                                                                       189343
     C           WLEMN     SETLLLEMNFUL7                                                      189343
     C           WLEMN     READELEMNFUL7                 09                                   189343
     C           *IN09     IFEQ '0'                                                           189343
     C                     Z-ADDEXDTLJ    EDAT                                                189343
     C                     ELSE                                                               189343
      *                                                                                       189343
      ** if not found Z-ADD 1 to EDAT to make sure that the correct                           189343
      ** narrative will be used by LE0211.                                                    189343
      *                                                                                       189343
     C                     Z-ADD1         EDAT                                                189343
     C                     ENDIF                                                              189343
     C                     ENDIF                                                              189343
      *                                                                                       189343
     C**********           Z-ADD0         CNUM                                         189570 CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     Z-ADD0         FACT                            189570
     C                     Z-ADD0         FCNO                            189570
     C                     WRITELEFCEND0
     C                     ENDIF                                          147488
     C                     ENDIF
     C           WFAKY     READEFACHISA1                 01
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN01     ANDEQ*OFF                                      156226
     C           WFAKY     READEFACHISA1                 01               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C                     ENDDO
      *
      ** Check if primary has participants, if so, display its FIs                            246233
      *                                                                                       246233
     C           PCODE     IFEQ 'H'                                                           246233
     C           PCODE     OREQ 'A'                                                           246233
     C                     EXSR SRPART                                                        246233
     C                     ENDIF                                                              246233
      *                                                                                       246233
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRFCAM - Subroutine to Process Records in LEFCAML8 when      *
      *           facility being enquired is a CA                     *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls    : NONE                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRFCAM    BEGSR
      *
      ** Retrieve facilities with a CA that is being enquired
      *
     C           WFCKY     SETLLLEFCLTL9
     C           WFCKY     READELEFCLTL9                 01
      *
     C           *IN01     DOWEQ'0'
     C                     MOVELBRCA      WBRCH   3
     C**********           Z-ADDCNUM      WCSNO   60                                          CSD027
     C                     MOVE CNUM      WCSNO   6                                           CSD027
     C                     MOVELFACT      WFLTY   50
     C                     MOVE FCNO      WFLTY
      *
      ** Retrieve actions
      *
     C           PCODE     IFEQ 'A'                                       147488
     C           PCODE     ORNE 'A'                                       147488
     C           PRTR      ANDNE'P'                                       147488
     C           PRTR      ANDNE'I'                                       147488
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           WCAKY     SETLLLEFCAML8
     C           WCAKY     READELEFCAML8                 02
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN02     ANDEQ*OFF                                      156226
     C           WCAKY     READELEFCAML8                 02               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C           *IN02     DOWEQ'0'
     C                     MOVEL'N'       PASTDU                                              204669
     C           PCODE     IFEQ 'B'
     C***********VLDT      ANDLTAGRDNB                                    154591
     C***********FREC      ANDEQ'LEFCAMPF'                                154591
     C***********PCODE     OREQ 'B'                                       154591
     C           VDAT      ANDLTAGRDNB
     C           FREC      ANDEQ'LOAMSDKF'
     C           ORED      ANDEQAGRDNB                                                        204669
     C           PCODE     OREQ 'P'                                                           204669
     C           FREC      ANDEQ'LOAMSDKF'                                                    204669
     C           AMTP      ANDEQ'PD'                                                          204669
     C           PCODE     OREQ 'B'
     C           VDAT      ANDLTAGRDNB
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'CLOANCL1'
     C           RECI      ANDNE'R'                                       190124
     C           CLE014    OREQ 'Y'                                       CLE014
     C           PCODE     ANDEQ'B'                                       CLE014
     C           NRPD      ANDLTAGRDNB                                    CLE014
     C********** ORED      ANDEQAGRDNB                                    CLE014              204383
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C           RECI      ANDNE'R'                                                           204441
     C***********PCODE     OREQ 'B'                                       154591
     C***********STDT      ANDLTAGRDNB                                    154591
     C***********ORED      ANDEQAGRDNB                                    154591
     C***********FREC      ANDEQ'LEMNFUPF'                                154591
     C***********PCODE     OREQ 'F'                                       154591
     C***********VLDT      ANDGEAGRDNB                                    154591
     C***********FREC      ANDEQ'LEFCAMPF'                                154591
     C           PCODE     OREQ 'B'                                       189088
     C           STDT      ANDLTAGRDNB                                    189088
     C           ORED      ANDEQAGRDNB                                    189088
     C           FREC      ANDEQ'LEMNFUPF'                                189088
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'F'
     C           VDAT      ANDGEAGRDNB
     C           FREC      ANDEQ'LOAMSDKF'
     C           PCODE     OREQ 'F'
     C           VDAT      ANDGEAGRDNB
     C********** ORED      ANDEQAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL1'
     C           RECI      ANDNE'R'                                       190124
      *                                                                   CLE014
      ** Future-valued Maturity date of loans                             CLE014
      *                                                                   CLE014
     C           PCODE     OREQ 'F'                                       CLE014
     C           MDAT      ANDGEAGRDNB                                    CLE014
     C           FREC      ANDEQ'CLOANCL3'                                CLE014
     C           RECI      ANDNE'R'                                                           204441
      *                                                                   CLE014
     C           PCODE     OREQ 'F'                                       CLE014
     C           MDAT      ANDGEAGRDNB                                    CLE014
     C           FREC      ANDEQ'CLOANCL4'                                CLE014
     C           RECI      ANDNE'R'                                                           204441
      *                                                                   CLE014
     C           CLE014    OREQ 'Y'                                       CLE014
     C           PCODE     ANDEQ'F'                                       CLE014
     C           NRPD      ANDGEAGRDNB                                    CLE014
     C********** ORED      ANDEQAGRDNB                                    CLE014              204383
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C           RECI      ANDNE'R'                                                           204441
     C***********PCODE     OREQ 'F'                                       154591
     C***********STDT      ANDGEAGRDNB                                    154591
     C***********ORED      ANDEQAGRDNB                                    154591
     C***********FREC      ANDEQ'LEMNFUPF'                                154591
     C           PCODE     OREQ 'F'                                       189088
     C           STDT      ANDGEAGRDNB                                    189088
     C           ORED      ANDEQAGRDNB                                    189088
     C           FREC      ANDEQ'LEMNFUPF'                                189088
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       189343
      ** For PCODE 'F', future manual utisation expiry date                                   189343
      *                                                                                       189343
     C           PCODE     OREQ 'F'                                                           189343
     C           EXDT      ANDGEAGRDNB                                                        189343
     C           FREC      ANDEQ'LEMNFUPE'                                                    189343
      *                                                                                       189343
     C           PCODE     OREQ *BLANKS
     C           FREC      ANDNE'FACHISAF'
     C           FREC      ANDNE'CLOANCL2'
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'A'                                       147488
     C           FREC      ANDNE'FACHISAF'                                147488
     C           FREC      ANDNE'CLOANCL2'                                147488
     C           RECI      ANDNE'R'                                       190124
      *
     C                     MOVE 'Y'       WPRIN   1                       157545
     C           AMTP      IFEQ 'MR'                                      157545
     C           PRAM      ANDEQ0                                         157545
     C                     MOVE 'N'       WPRIN                           157545
     C                     ENDIF                                          157545
      *                                                                                       204669
     C           AMTP      IFEQ 'PD'                                                          204669
     C           PRAM      ANDEQ0                                                             204669
     C                     MOVE 'N'       WPRIN                                               204669
     C                     ENDIF                                                              204669
      *                                                                                       204669
     C           FREC      IFEQ 'LOAMSDKF'                                                    204669
     C           AMTP      ANDEQ'PD'                                                          204669
     C           WPRIN     ANDEQ'Y'                                                           204669
     C                     Z-ADDVDAT      WVDAT   50                                          204669
     C           LNRF      CHAINCLOAN                16                                       204669
     C           WVDAT     IFEQ MDAT                                                          204669
     C           X         IFLE 150                                                           204669
     C           X         ADD  1         X                                                   204669
     C**********           Z-ADDLNRF      PSDU,X                                       204669 CLE148
     C                     MOVELLNRF      PSDU,X                                              CLE148
     C                     ENDIF                                                              204669
     C                     ENDIF                                                              204669
     C                     Z-ADDWVDAT     VDAT                                                204669
     C                     ENDIF                                                              204669
      *                                                                                       204669
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C                     EXSR SRRAMT                                    CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       204669
      * If Maturity, check whether this loan has gone Past Due                                204669
     C           FREC      IFEQ 'CLOANCL3'                                                    204669
     C                     Z-ADD1         Y       30                                          204669
     C           LNRF      LOKUPPSDU,Y                   15                                   204669
     C           *IN15     IFEQ '1'                                                           204669
     C                     MOVE 'Y'       PASTDU  1                                           204669
     C                     ENDIF                                                              204669
      *                                                                                       204669
     C                     ENDIF                                                              204669
      *                                                                   157545
     C********** VLDT      IFGE PVLDT                                     CLE014
      *                                                                   CLE014
      ** LOAMSDK uses VDAT not VLDT                                       CLE014
      *                                                                   CLE014
     C           VDAT      IFGE PVLDT                                     CLE014
     C***********FREC      ANDEQ'LEFCAMPF'                                154591
     C***********VDAT      ORGE PVLDT                                     154591
     C           FREC      ANDEQ'LOAMSDKF'
     C           WPRIN     ANDEQ'Y'                                       157545
     C           VDAT      ORGE PVLDT
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'CLOANCL1'
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       204479
     C           VDAT      ORGE AGRDNB                                                        204479
     C           VDAT      ANDGEPVLDT                                                         204479
     C           ORED      ANDNEAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL1'                                                    204479
     C           RECI      ANDNE'R'                                                           204479
      *                                                                                       204479
     C***********STDT      ORGE PVLDT                                     154591
     C***********ORED      ANDEQAGRDNB                                    154591
     C***********FREC      ANDEQ'LEMNFUPF'                                154591
     C           STDT      ORGE PVLDT                                     189088
     C           ORED      ANDEQAGRDNB                                    189088
     C           FREC      ANDEQ'LEMNFUPF'                                189088
     C           RECI      ANDNE'R'                                       190124
     C           STDT      ORGE AGRDNB                                                        189343
     C           PVLDT     ANDEQ*ZERO                                                         189343
     C           ORED      ANDLTAGRDNB                                                        189343
     C           FREC      ANDEQ'LEMNFUPF'                                                    189343
     C           RECI      ANDNE'R'                                                           189343
      *                                                                                       189343
      ** Manual Utilisation expiry/end date greater than or equal to                          189343
      ** from activity date (PVLDT).                                                          189343
      *                                                                                       189343
     C           EXDT      ORGE PVLDT                                                         189343
     C           FREC      ANDEQ'LEMNFUPE'                                                    189343
      *                                                                   CLE014
      ** Future loan maturity date                                        CLE014
      *                                                                   CLE014
     C           MDAT      ORGE PVLDT                                     CLE014
     C           FREC      ANDEQ'CLOANCL3'                                CLE014
     C           PASTDU    ANDNE'Y'                                                           204669
      *                                                                   CLE014
     C           MDAT      ORGE PVLDT                                     CLE014
     C           FREC      ANDEQ'CLOANCL4'                                CLE014
      *                                                                   CLE014
     C           CLE014    OREQ 'Y'                                       CLE014
     C           NRPD      ANDGEPVLDT                                     CLE014
     C********** ORED      ANDEQAGRDNB                                    CLE014              204383
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C           WRAMT     ANDGT*ZERO                                     CLE014
     C                     EXSR SRFRMT
     C                     ENDIF
      *
     C                     ENDIF
     C           WCAKY     READELEFCAML8                 02
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN02     ANDEQ*OFF                                      156226
     C           WCAKY     READELEFCAML8                 02               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C                     ENDDO
     C                     ENDIF                                          147488
     C           WFCKY     READELEFCLTL9                 01
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRFTRA - Subroutine to Process Records in LEFCAML8 when      *
      *           facility being enquired is a participant facility   *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls    : NONE                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRFTRA    BEGSR
      *
     C                     MOVELPBRCA     WBRCH
     C**********           Z-ADDPCNUM     WCSNO                                               CSD027
     C                     MOVE PCNUM     WCSNO                                               CSD027
     C                     MOVELPFACT     WFLTY
     C                     MOVE PFCNO     WFLTY
      *
      ** Retrieve records
      *
     C           WCAKY     SETLLLEFCAML8
     C           WCAKY     READELEFCAML8                 01
      *                                                                   156226
     C           WBRCH     IFNE 'ALL'                                     156226
     C           WBRCH     DOWNEBRCA                                      156226
     C           *IN01     ANDEQ*OFF                                      156226
     C           WCAKY     READELEFCAML8                 01               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *
     C           *IN01     DOWEQ'0'
     C           PCODE     IFEQ 'B'
     C           VLDT      ANDLTAGRDNB
     C           FREC      ANDEQ'LEFCAMPF'
     C           PCODE     OREQ 'B'
     C           VDAT      ANDLTAGRDNB
     C           FREC      ANDEQ'LOAMSDKF'
     C           PCODE     OREQ 'B'
     C           VDAT      ANDLTAGRDNB
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'CLOANCL1'
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'B'
     C           VDAT      ANDLTAGRDNB
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'CLOANCL2'
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'B'
     C           STDT      ANDLTAGRDNB
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'LEMNFUPF'
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'F'
     C           VLDT      ANDGEAGRDNB
     C           FREC      ANDEQ'LEFCAMPF'
     C           PCODE     OREQ 'F'
     C           VDAT      ANDGEAGRDNB
     C           FREC      ANDEQ'LOAMSDKF'
     C           PCODE     OREQ 'F'
     C           VDAT      ANDGEAGRDNB
     C********** ORED      ANDEQAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL1'
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'F'
     C           VDAT      ANDGEAGRDNB
     C********** ORED      ANDEQAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL2'
     C           RECI      ANDNE'R'                                       190124
     C********** PCODE     OREQ 'F'                                                           189343
      *                                                                   CLE014
     C           PCODE     OREQ 'F'                                       CLE014
     C           MDAT      ANDGEAGRDNB                                    CLE014
     C           FREC      ANDEQ'CLOANCL3'                                CLE014
      *                                                                   CLE014
     C           PCODE     OREQ 'F'                                       CLE014
     C           MDAT      ANDGEAGRDNB                                    CLE014
     C           FREC      ANDEQ'CLOANCL4'                                CLE014
      *                                                                   CLE014
     C           PCODE     OREQ 'F'                                                           189343
     C           STDT      ANDGEAGRDNB
     C***********ORED      ANDEQAGRDNB                                    163331
     C           ORED      ANDLEAGRDNB                                    163331
     C           FREC      ANDEQ'LEMNFUPF'
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       189343
      ** For PCODE 'F', future manual utisation expiry date                                   189343
      *                                                                                       189343
     C           PCODE     OREQ 'F'                                                           189343
     C           EXDT      ANDGEAGRDNB                                                        189343
     C           FREC      ANDEQ'LEMNFUPE'                                                    189343
      *                                                                                       189343
     C           PCODE     OREQ *BLANKS
     C           FREC      ANDNE'FACHISAF'
     C           PCODE     OREQ 'A'                                       147488
     C           FREC      ANDNE'FACHISAF'                                147488
      *
     C                     MOVE 'Y'       WPRIN                           157545
     C           AMTP      IFEQ 'MR'                                      157545
     C           PRAM      ANDEQ0                                         157545
     C                     MOVE 'N'       WPRIN                           157545
     C                     ENDIF                                          157545
      *                                                                   157545
     C           VLDT      IFGE PVLDT
     C           FREC      ANDEQ'LEFCAMPF'
     C           VDAT      ORGE PVLDT
     C           FREC      ANDEQ'LOAMSDKF'
     C           WPRIN     ANDEQ'Y'                                       157545
     C           VDAT      ORGE PVLDT
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'CLOANCL1'
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       204479
     C           VDAT      ORGE AGRDNB                                                        204479
     C           VDAT      ANDGEPVLDT                                                         204479
     C           ORED      ANDNEAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL1'                                                    204479
     C           RECI      ANDNE'R'                                                           204479
      *                                                                                       204479
     C           VDAT      ORGE PVLDT
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'CLOANCL2'
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       204479
     C           VDAT      ORGE AGRDNB                                                        204479
     C           VDAT      ANDGEPVLDT                                                         204479
     C           ORED      ANDNEAGRDNB                                                        204479
     C           FREC      ANDEQ'CLOANCL2'                                                    204479
     C           RECI      ANDNE'R'                                                           204479
      *                                                                                       204479
     C           STDT      ORGE PVLDT
     C           ORED      ANDEQAGRDNB
     C           FREC      ANDEQ'LEMNFUPF'
     C           RECI      ANDNE'R'                                       190124
     C           STDT      ORGE PVLDT                                     163331
     C           STDT      ANDGEAGRDNB                                    163331
     C           ORED      ANDLTAGRDNB                                    163331
     C           FREC      ANDEQ'LEMNFUPF'                                163331
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       189343
      ** Manual Utilisation expiry/end date greater than or equal to                          189343
      ** from activity date (PVLDT).                                                          189343
      *                                                                                       189343
     C           EXDT      ORGE PVLDT                                                         189343
     C           FREC      ANDEQ'LEMNFUPE'                                                    189343
      *                                                                   CLE014
      ** Future loan maturity date                                        CLE014
      *                                                                   CLE014
     C           MDAT      ORGE PVLDT                                     CLE014
     C           FREC      ANDEQ'CLOANCL3'                                CLE014
      *                                                                   CLE014
     C           MDAT      ORGE PVLDT                                     CLE014
     C           FREC      ANDEQ'CLOANCL4'                                CLE014
      *                                                                   CLE014
     C**********           Z-ADD0         CNUM                                         189570 CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     Z-ADD0         FACT                            189570
     C                     Z-ADD0         FCNO                            189570
     C                     EXSR SRFRMT
     C                     ENDIF
      *
     C                     ENDIF
     C           WCAKY     READELEFCAML8                 01
      *                                                                   156226
     C           WBRCH     IFNE 'ALL'                                     156226
     C           WBRCH     DOWNEBRCA                                      156226
     C           *IN01     ANDEQ*OFF                                      156226
     C           WCAKY     READELEFCAML8                 01               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRLOAM - Subroutine to Process Records in LOAMSDK            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *                                                               *
      *  Calls    : NONE                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRLOAM    BEGSR
      *
      ** Retrieve loans with a participant facility that is being
      ** enquired
      *
     C           WFCKY     SETLLLELOANL7
     C           WFCKY     READELELOANL7                 01
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN01     ANDEQ*OFF                                      156226
     C           WFCKY     READELELOANL7                 01               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
      *
     C           *IN01     DOWEQ'0'
     C**********           Z-ADDLNRF      WLNRF   60                                          CLE148
     C                     MOVELLNRF      WLNRF   6                                           CLE148
      *
      ** Retrieve records
      *
     C           WLNRF     SETLLLOAMS
     C           WLNRF     READELOAMS                    02
      *
     C           *IN02     DOWEQ'0'
     C***********AMTP      ANDNE'SC'                               148725 154591
     C***********AMTP      ANDNE'BC'                               148725 154591
     C***********AMTP      ANDNE'LS'                               148725 154591
     C***********AMTP      ANDNE'SA'                               148725 154591
     C***********AMTP      ANDNE'PD'                               148725 154591
     C           PCODE     IFEQ 'B'
     C           VDAT      ANDLTAGRDNB
     C           PCODE     OREQ 'F'
     C           VDAT      ANDGEAGRDNB
     C           PCODE     OREQ *BLANK
     C           PCODE     OREQ 'A'                                       147488
      *
     C           VDAT      IFGE PVLDT
     C           AMTP      ANDNE'SC'                                      154591
     C           AMTP      ANDNE'BC'                                      154591
     C           AMTP      ANDNE'LS'                                      154591
     C           AMTP      ANDNE'SA'                                      154591
     C           AMTP      ANDNE'PD'                                      154591
      *                                                                   157545
     C           AMTP      IFEQ 'MR'                                      157545
     C           PRAM      ANDNE0                                         157545
     C           AMTP      ORNE 'MR'                                      157545
     C                     Z-ADD0         USEQ
     C                     Z-ADDVDAT      ADAT
     C                     Z-ADDTAMT      AMNT
     C                     MOVELAMTP      ATYP
     C                     MOVEL*BLANKS   WREC                            147488
      *                                                                   157545
     C           AMTP      IFEQ 'MR'                                      157545
     C                     Z-ADDPRAM      AMNT                            157545
     C                     ENDIF                                          157545
     C           PCODE     IFEQ *BLANKS
     C           PCODE     OREQ 'A'                                       147488
     C           VDAT      IFLT AGRDNB
     C                     MOVEL'B'       CODE
     C                     ELSE
     C                     MOVEL'F'       CODE
     C                     ENDIF
     C                     ELSE
     C                     MOVELPCODE     CODE
     C                     ENDIF
      *                                                                   147488
      ** Exclude participant transactions when code is not A              147488
      *                                                                   147488
     C           PCODE     IFNE 'A'                                       147488
     C           PRTR      ANDNE'P'                                       147488
     C           PRTR      ANDNE'I'                                       147488
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           LPFI      IFEQ 'P'                                       147488
     C           LPFI      OREQ 'I'                                       147488
     C           LPFI      OREQ 'R'                                       151292
     C           LPFI      OREQ 'S'                                                           CLE106
     C                     MOVEL'Y'       WREC                            147488
     C                     ENDIF                                          147488
     C                     ENDIF                                          147488
      *                                                                   147488
     C           WREC      IFEQ *BLANKS                                   147488
     C**********           Z-ADD0         CNUM                                         189570 CSD027
     C                     MOVE *BLANKS   CNUM                                                CSD027
     C                     Z-ADD0         FACT                            189570
     C                     Z-ADD0         FCNO                            189570
     C                     WRITELEFCEND0
     C                     ENDIF                                          147488
     C                     ENDIF                                          157545
     C                     ENDIF
      *
     C                     ENDIF
     C           WLNRF     READELOAMS                    02
     C                     ENDDO
     C           WFCKY     READELELOANL7                 01
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN01     ANDEQ*OFF                                      156226
     C           WFCKY     READELELOANL7                 01               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C                     ENDDO
      *
     C                     ENDSR
      *
      /EJECT
      *****************************************************************
      *                                                               *
      *  SRFRMT - Subroutine to Format Fields in LEFCENPD             *
      *                                                               *
      *  Called By: SRFCAM, SRFTRA                                    *
      *                                                               *
      *  Calls    : NONE                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRFRMT    BEGSR
      *
     C                     MOVEL*BLANK    WREC                            147488
     C                     Z-ADD0         USEQ
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     MOVEL*BLANK    FREQ                            CLE014
     C                     MOVEL*BLANK    EXFR                            CLE014
     C                     ENDIF                                          CLE014
     C                     SELEC
      *
     C           FREC      WHEQ 'LEFCAMPF'
     C**********           Z-ADD0         LNRF                                                CLE148
     C                     MOVEL*BLANKS   LNRF                                                CLE148
     C                     Z-ADDVLDT      ADAT
     C                     MOVELACCY      CCY
     C                     Z-ADDAAMT      AMNT
     C                     MOVELFATP      ATYP
      *                                                                                       247204
     C           TRCA      IFEQ 'CA'                                                          247204
     C**********           Z-ADD0         CNUM                                         247204 CPK028
     C                     MOVE *BLANKS   CNUM                                                CPK028
     C                     Z-ADD0         FACT                                                247204
     C                     Z-ADD0         FCNO                                                247204
     C                     ENDIF                                                              247204
      *                                                                                       247204
     C           PCODE     IFEQ *BLANKS
     C           PCODE     OREQ 'A'                                       147488
     C           VLDT      IFLT AGRDNB
     C                     MOVEL'B'       CODE
     C                     ELSE
     C                     MOVEL'F'       CODE
     C                     ENDIF
     C                     ELSE
     C                     MOVELPCODE     CODE
     C                     ENDIF
      *
     C           FREC      WHEQ 'LOAMSDKF'
     C                     Z-ADDVDAT      ADAT
     C                     Z-ADDTAMT      AMNT
     C                     MOVELAMTP      ATYP
      *                                                                                       207963
     C           REPT      IFEQ 1                                                             207963
     C           AMTP      ANDEQ'RE'                                                          207963
     C                     Z-ADDPRAM      AMNT                                                207963
     C                     ENDIF                                                              207963
      *                                                                   157545
     C           AMTP      IFEQ 'MR'                                      157545
     C                     Z-ADDPRAM      AMNT                            157545
     C                     ENDIF                                          157545
      *                                                                   157545
      ** Check for Past Due loan amendments:                                                  204669
     C           AMTP      IFEQ 'PD'                                                          204669
     C                     Z-ADDPRAM      AMNT                                                204669
     C                     MOVEL'P'       CODE                                                204669
     C                     ELSE                                                               204669
      *                                                                                       204669
     C           PCODE     IFEQ *BLANKS
     C           PCODE     OREQ 'A'                                       147488
     C           VDAT      IFLT AGRDNB
     C                     MOVEL'B'       CODE
     C                     ELSE
     C                     MOVEL'F'       CODE
     C                     ENDIF
     C                     ELSE
     C                     MOVELPCODE     CODE
     C                     ENDIF
      *                                                                                       204669
     C                     ENDIF                                                              204669
      *                                                                   147488
      ** Exclude participant transactions when code is not A              147488
      *                                                                   147488
     C           PCODE     IFNE 'A'                                       147488
     C           PRTR      ANDNE'P'                                       147488
     C           PRTR      ANDNE'I'                                       147488
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C**********           Z-ADDLNRF      WLNRF                                        147488 CLE148
     C                     MOVELLNRF      WLNRF                                               CLE148
     C***********WCLON     CHAINCLOANLB              03            147488 156226
     C           WCLON     CHAINCLOAN                03                   156226
     C           *IN03     IFEQ '0'                                       147488
     C           LPFI      ANDEQ'P'                                       147488
     C           *IN03     OREQ '0'                                       147488
     C           LPFI      ANDEQ'I'                                       147488
     C           *IN03     OREQ '0'                                       151292
     C           LPFI      ANDEQ'R'                                       151292
     C           *IN03     OREQ '0'                                                           CLE106
     C           LPFI      ANDEQ'S'                                                           CLE106
     C                     MOVEL'Y'       WREC                            147488
     C                     ENDIF                                          147488
     C                     ENDIF                                          147488
      *
     C           FREC      WHEQ 'CLOANCL1'
     C           FREC      OREQ 'CLOANCL2'
     C                     Z-ADDVDAT      ADAT
     C                     Z-ADDCPAM      AMNT
     C                     MOVEL'ST'      ATYP
     C           PCODE     IFEQ *BLANKS
     C           PCODE     OREQ 'A'                                       147488
     C           VDAT      IFLT AGRDNB
     C                     MOVEL'B'       CODE
     C                     ELSE
     C                     MOVEL'F'       CODE
     C                     ENDIF
     C                     ELSE
     C                     MOVELPCODE     CODE
     C                     ENDIF
      *                                                                   147488
      ** Exclude participant transactions when code is not A              147488
      *                                                                   147488
     C           PCODE     IFNE 'A'                                       147488
     C           PRTR      ANDNE'P'                                       147488
     C           PRTR      ANDNE'I'                                       147488
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           LPFI      IFEQ 'P'                                       147488
     C           LPFI      OREQ 'I'                                       147488
     C           LPFI      OREQ 'R'                                       151292
     C           LPFI      OREQ 'S'                                                           CLE106
     C                     MOVEL'Y'       WREC                            147488
     C                     ENDIF                                          147488
     C                     ENDIF                                          147488
      *                                                                   CLE014
     C           FREC      WHEQ 'CLOANCL3'                                CLE014
     C           FREC      OREQ 'CLOANCL4'                                CLE014
      *                                                                   CLE014
     C                     Z-ADD*ZEROS    WCALC                           CLE014
     C                     Z-ADD*ZEROS    WIPAID                          CLE014
     C                     Z-ADDMDAT      WMDAT   50                      CLE014
     C                     Z-ADDCPAM      MAMNT  130                      CLE014
     C**********           Z-ADDLNRF      WLOAN   60                                   CLE014 CLE148
     C                     MOVELLNRF      WLOAN   6                                           CLE148
     C                     Z-ADDIACD      WLICD   50                      CLE014
     C                     MOVE SPIN      WCUSI   1                       CLE014
     C                     Z-ADDINTR      WCURT                           CLE014
     C                     Z-ADDBRTE      WCUBR                           CLE014
     C                     Z-ADDRTSP      WCUSP                           CLE014
     C                     Z-ADDIACD      WLASD                           CLE014
     C                     MOVE ICBS      WICBS                           CLE014
     C                     MOVE *BLANK    WSTAC   1                       CLE014
      *                                                                   CLE014
      ** read LEFCAMLA to get all loan amendments which concerns          CLE014
      ** principal for repayment types 1 and 2                            CLE014
      *                                                                   CLE014
     C                     MOVE '0'       *IN05                           CLE014
      *                                                                   CLE014
     C           NRPD      IFNE 0                                                             207963
     C                     Z-ADDNRPD      ZDAYNO                                              207963
     C                     Z-ADDRDYN      ZMDAY                                               207963
     C                     MOVELCCY       ZCCY                                                207963
     C                     MOVELRFRQ      ZFREQ                                               207963
     C                     ENDIF                                                              207963
      *                                                                   CLE014
     C           REPT      IFLE 2                                         CLE014
      *                                                                   CLE014
     C           WLOAN     SETLLLEFCAMLA                                  CLE014
     C                     READ LEFCAMLA                 05               CLE014
      *                                                                                       189343
     C           *IN05     DOWEQ'0'                                       CLE014
     C           WLOAN     ANDEQLNRFLA                                    CLE014
      *                                                                   CLE014
     C           VDATLA    IFLE ZDAYNO                                                        207963
     C           ZDAYNO    ORLT NRPD                                                        AR830785
      *                                                                                       207963
     C           AMTPLA    IFEQ 'MR'                                      CLE014
     C           AMTPLA    OREQ 'RE'                                      CLE014
     C           AMTPLA    OREQ 'PF'                                      CLE014
      *                                                                   CLE014
      ** Subtract movement amount from current principal to project       CLE014
      ** maturity amount.                                                 CLE014
      *                                                                   CLE014
     C           MAMNT     SUB  PRAM      MAMNT                           CLE014
     C                     ELSE                                           CLE014
      *                                                                   CLE014
      ** Add PRAM to maturity amount for amendment types PI and PT        CLE014
      *                                                                   CLE014
     C           AMTPLA    IFEQ 'PI'                                      CLE014
     C           AMTPLA    OREQ 'PT'                                      CLE014
     C                     ADD  PRAM      MAMNT                           CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       189343
     C                     READ LEFCAMLA                 05               CLE014
      *                                                                                       207963
     C                     ELSE                                                               207963
     C           MAMNT     IFGT 0                                                             207963
     C                     SUB  RAMT      MAMNT                                               207963
     C           MAMNT     IFLT 0                                                             207963
     C                     Z-ADD0         MAMNT                                               207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
     C           RFRQ      IFNE ' '                                                           207963
     C                     EXSR ZFREQB                                                        207963
     C                     ELSE                                                               207963
     C                     Z-ADDMDAT      ZDAYNO                                              207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
     C                     ENDDO                                          CLE014
      *                                                                                       207963
      ** Continue the computation of principal at maturity.                                   207963
      *                                                                                       207963
     C                     MOVE ZDAYNO    TDAYNO  50                                        AR830785
     C           ZDAYNO    DOWLTMDAT                                                          207963
     C           ZDAYNO    ANDGETDAYNO                                                      AR830785
     C           MAMNT     ANDGT0                                                             207963
      *                                                                                       207963
     C                     SUB  RAMT      MAMNT                                               207963
     C           RFRQ      IFNE ' '                                                           207963
     C                     EXSR ZFREQB                                                        207963
     C                     ELSE                                                               207963
     C                     Z-ADDMDAT      ZDAYNO                                              207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C           MAMNT     IFLT 0                                                             207963
     C                     Z-ADD0         MAMNT                                               207963
     C                     ENDIF                                                              207963
     C                     ENDDO                                                              207963
      *                                                                   CLE014
     C                     ELSE                                           CLE014
      *                                                                   CLE014
      ** repayment type 3                                                 CLE014
      *                                                                   CLE014
     C                     Z-ADDCPAM      WCUPR                           CLE014
     C**********           Z-ADDFCUS      CNUM                                         CLE014 CSD027
     C                     MOVE FCUS      CNUM                                                CSD027
      *                                                                   CLE014
     C                     MOVE '0'       *IN37                           CLE014
     C                     Z-ADD0         WLASD   50                      CLE014
     C                     MOVE ZDAYNO    TDAYNO                                            AR830785
     C           KEYH      SETLLHISLAML0                                  CLE014
     C********** *IN37     DOWEQ'0'                                                    CLE014 207963
     C           KEYH      READEHISLAML0                 37               CLE014
      *                                                                   CLE014
      ** If no history or no amendments against the loan                  CLE014
      *                                                                   CLE014
     C           *IN37     IFEQ '1'                                       CLE014
     C                     Z-ADDCPAM      MAMNT                           CLE014
     C                     Z-ADDVDAT      WLASD                                               207963
     C                     ELSE                                           CLE014
      *                                                                                       207963
     C           *IN37     DOWEQ'0'                                                           207963
      *                                                                                       189343
      ** If loan has not start yet and there is an RE, initialise WLASD                       189343
      ** so that interest will be computed.                                                   189343
      *                                                                                       189343
     C********** AMTPHL    IFEQ 'RE'                                                   189343 207963
     C           AMTPHL    IFNE 'ST'                                                          207963
     C           WLASD     ANDEQ0                                                             189343
     C**********           Z-ADD1         WLASD                                        189343 207963
     C                     Z-ADDVDAT      WLASD                                               207963
     C                     ENDIF                                                              189343
      *                                                                   CLE014
      ** Accumulate interest on change of date                            CLE014
      *                                                                   CLE014
     C           VDATHL    IFLE ZDAYNO                                                        207963
     C           ZDAYNO    ORLT TDAYNO                                                      AR830785
      *                                                                                       207963
     C           WLASD     IFNE VDATHL                                    CLE014
     C           WLASD     ANDNE*ZEROS                                    CLE014
     C           WSTAC     ANDEQ*BLANK                                    CLE014
     C                     Z-ADDVDATHL    ZIEND                           CLE014
     C                     EXSR SRINCL                                    CLE014
     C                     ADD  ZINTR     WCALC  152                      CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           AMTPHL    IFEQ 'ST'                                      CLE014
     C           AMTPHL    OREQ 'RO'                                      CLE014
     C           AMTPHL    OREQ 'MC'                                      CLE014
     C                     MOVE CALCHL    WICBS   10                      CLE014
     C                     MOVE SPINHL    WCUSI                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     SELEC                                          CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'ST'                                      CLE014
     C           AMTPHL    OREQ 'MC'                                      CLE014
      *                                                                   CLE014
     C           AMTPHL    IFEQ 'ST'                                      CLE014
     C                     Z-ADDPRAMHL    WCUPR                           CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADDCPAMHL    WCUPR                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     Z-ADDBRTEHL    WCUBR  117                      CLE014
     C                     Z-ADDRTSPHL    WCUSP  117                      CLE014
     C                     Z-ADDINTRHL    WCURT  117                      CLE014
     C                     Z-ADDVDATHL    WLICD                           CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'IN'                                      CLE014
      *                                                                   CLE014
      ** WIPAID is interest paid for the loan                             CLE014
      *                                                                   CLE014
     C                     ADD  INTAHL    WIPAID 152                      CLE014
     C           INTCHL    IFEQ 'Y'                                       CLE014
     C                     ADD  INTAHL    WCUPR  130                      CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'RO'                                      CLE014
      *                                                                   CLE014
     C           PRINRO    IFNE *ZEROS                                    CLE014
     C                     Z-ADDPRINRO    WCUPR                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     Z-ADDBRTEHL    WCUBR                           CLE014
     C                     Z-ADDRTSPHL    WCUSP                           CLE014
     C                     Z-ADDINTRHL    WCURT                           CLE014
     C                     Z-ADDVDATHL    WLICD   50                      CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'PT'                                      CLE014
     C           AMTPHL    OREQ 'PI'                                      CLE014
     C                     ADD  PRAMHL    WCUPR                           CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'PF'                                      CLE014
     C                     SUB  PRAMHL    WCUPR                           CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'MR'                                      CLE014
     C           AMTPHL    OREQ 'RE'                                      CLE014
     C           AMTPHL    OREQ 'MA'                                      CLE014
      *                                                                   CLE014
      ** If RE is from LOAMSDK, compute for the outstanding interest to   CLE014
      ** date to determine what portion of the repayment amount will go   CLE014
      ** to the principal.                                                CLE014
      *                                                                   CLE014
     C           AMTPHL    IFEQ 'RE'                                      CLE014
     C                     MOVE '0'       *IN08                           CLE014
      *                                                                   CLE014
      ** If RE is from history, skip computation of outstanding INT       CLE014
      *                                                                   CLE014
     C           VDATHL    IFLT AGRDNB                                    CLE014
     C           LCDHL     ANDLTAGRDNB                                    CLE014
     C                     MOVE '1'       *IN08                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** If RE is from LOAMSDK                                            CLE014
      *                                                                   CLE014
     C           *IN08     IFEQ '0'                                       CLE014
     C           WCALC     SUB  WIPAID    WOUTIN 152                      CLE014
      *                                                                   CLE014
      ** Compute for the interest to be paid                              CLE014
      *                                                                   CLE014
     C           WOUTIN    IFLE TAMTHL                                    CLE014
     C           TAMTHL    SUB  WOUTIN    PRAMHL 130                      CLE014
     C                     Z-ADDWOUTIN    INTAHL                          CLE014
      *                                                                   CLE014
      ** If over paid                                                     CLE014
      *                                                                   CLE014
     C           WOUTIN    IFLT 0                                         CLE014
     C                     Z-ADDTAMTHL    PRAMHL                          CLE014
     C                     Z-ADD0         INTAHL                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADD*ZEROS    PRAMHL                          CLE014
     C                     Z-ADDTAMTHL    INTAHL                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ADD  INTAHL    WIPAID                          CLE014
     C                     SUB  PRAMHL    WCUPR                           CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'BR'                                      CLE014
     C           AMTPHL    OREQ 'BC'                                      CLE014
     C                     Z-ADDBRTEHL    WCUBR                           CLE014
     C                     EXSR SRNEWI                                    CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'SC'                                      CLE014
     C                     Z-ADDRTSPHL    WCUSP                           CLE014
     C                     EXSR SRNEWI                                    CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'MI'                                      CLE014
     C                     ADD  INTAHL    WCALC  152                      CLE014
      *                                                                   CLE014
     C           AMTPHL    WHEQ 'SA'                                      CLE014
     C           STAIHL    IFEQ *BLANK                                    CLE014
     C                     Z-ADDVDATHL    WLICD                           CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'Y'       WSTAC                           CLE014
     C                     ENDIF                                          CLE014
     C                     ENDSL                                          CLE014
      *                                                                                       207963
     C                     Z-ADDVDATHL    WLASD                                               207964
      *                                                                                       207963
     C           KEYH      READEHISLAML0                 37                                   207963
      *                                                                                       207963
     C                     ELSE                                                               207963
      *                                                                                       207963
     C           WLASD     IFNE ZDAYNO                                                        207963
     C           WLASD     ANDNE*ZEROS                                                        207963
     C           WSTAC     ANDEQ*BLANK                                                        207963
     C           ZDAYNO    ANDLTMDAT                                                          207963
     C                     Z-ADDZDAYNO    ZIEND                                               207963
     C                     EXSR SRINCL                                                        207963
     C                     ADD  ZINTR     WCALC                                               207963
     C                     Z-ADDZDAYNO    WLASD                                               207963
     C           RFRQ      IFNE ' '                                                           207963
     C                     EXSR ZFREQB                                                        207963
     C                     ELSE                                                               207963
     C                     Z-ADDMDAT      ZDAYNO                                              207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C           WCALC     SUB  WIPAID    WOUTIN                                              207963
      *                                                                                       207963
      ** Compute for the interest to be paid                                                  207963
      *                                                                                       207963
     C           WOUTIN    IFLE RAMT                                                          207963
     C           RAMT      SUB  WOUTIN    WPRAM  130                                          207963
     C                     Z-ADDWOUTIN    WINTA  130                                          207963
      *                                                                                       207963
      ** If over paid                                                                         207963
      *                                                                                       207963
     C           WOUTIN    IFLT 0                                                             207963
     C                     Z-ADDRAMT      WPRAM                                               207963
     C                     Z-ADD0         WINTA                                               207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ELSE                                                               207963
     C                     Z-ADD*ZEROS    WPRAM                                               207963
     C                     Z-ADDRAMT      WINTA                                               207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ADD  WINTA     WIPAID                                              207963
     C           WCUPR     IFGT 0                                                             207963
     C                     SUB  WPRAM     WCUPR                                               207963
     C           WCUPR     IFLT 0                                                             207963
     C                     Z-ADD0         WCUPR                                               207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ENDIF                                                              207963
     C                     ENDDO                                                              207963
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C**********           Z-ADDVDATHL    WLASD                                        CLE014 207963
      **********                                                                       CLE014 207963
     C**********           ENDDO                                                       CLE014 207963
      *                                                                   CLE014
     C                     Z-ADDWCUPR     MAMNT                           CLE014
      *                                                                                       207963
      ** Continue the computation of principal at maturity.                                   207963
      *                                                                                       207963
     C                     MOVE ZDAYNO    TDAYNO                                            AR830785
     C           ZDAYNO    DOWLTMDAT                                                          207963
     C           ZDAYNO    ANDGETDAYNO                                                      AR830785
     C           MAMNT     ANDGT0                                                             207963
      *                                                                                       207963
     C           WLASD     IFNE ZDAYNO                                                        207963
     C           WLASD     ANDNE*ZEROS                                                        207963
     C           WSTAC     ANDEQ*BLANK                                                        207963
     C                     Z-ADDZDAYNO    ZIEND                                               207963
     C                     EXSR SRINCL                                                        207963
     C                     ADD  ZINTR     WCALC                                               207963
     C                     Z-ADDZDAYNO    WLASD                                               207963
     C                     ENDIF                                                              215966
     C           RFRQ      IFNE ' '                                                           207963
     C                     EXSR ZFREQB                                                        207963
     C                     ELSE                                                               207963
     C                     Z-ADDMDAT      ZDAYNO                                              207963
     C                     ENDIF                                                              207963
     C**********           ENDIF                                                       207963 215966
      *                                                                                       207963
     C           WCALC     SUB  WIPAID    WOUTIN                                              207963
      *                                                                                       207963
      ** Compute for the interest to be paid                                                  207963
      *                                                                                       207963
     C           WOUTIN    IFLE RAMT                                                          207963
     C           RAMT      SUB  WOUTIN    WPRAM  130                                          207963
     C                     Z-ADDWOUTIN    WINTA  130                                          207963
      *                                                                                       207963
      ** If over paid                                                                         207963
      *                                                                                       207963
     C           WOUTIN    IFLT 0                                                             207963
     C                     Z-ADDRAMT      WPRAM                                               207963
     C                     Z-ADD0         WINTA                                               207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ELSE                                                               207963
     C                     Z-ADD*ZEROS    WPRAM                                               207963
     C                     Z-ADDRAMT      WINTA                                               207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ADD  WINTA     WIPAID                                              207963
     C           WCUPR     IFGT 0                                                             207963
     C                     SUB  WPRAM     WCUPR                                               207963
     C           WCUPR     IFLT 0                                                             207963
     C                     Z-ADD0         WCUPR                                               207963
     C                     ENDIF                                                              207963
     C                     ENDIF                                                              207963
      *                                                                                       207963
     C                     ENDDO                                                              207963
      *                                                                                       207963
     C                     Z-ADDWCUPR     MAMNT                                               207963
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     MOVEL'MT'      ATYP                            CLE014
      *                                                                   CLE014
      ** Check if there are existing frequency based repayments against   CLE014
      ** the loan.                                                        CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     Z-ADD1         Z       40                      CLE014
     C           LNRF      DOUEQWRLNRF                                    CLE014
     C********** WRLNRF    OREQ *ZERO                                                  CLE014 CLE148
     C           WRLNRF    OREQ *BLANKS                                                       CLE148
     C           Z         OCUR LEFRBS                                    CLE014
     C           LEFRBS    IFEQ *BLANK                                    CLE014
     C**********           Z-ADD*ZERO     WRLNRF                                       CLE014 CLE148
     C                     MOVEL*BLANKS   WRLNRF                                              CLE148
     C                     Z-ADD*ZERO     WRRAMT                          CLE014
     C                     ENDIF                                          CLE014
     C                     ADD  1         Z                               CLE014
     C                     ENDDO                                          CLE014
      *                                                                   CLE014
      ** If a repayment is found, subtract repayment amount to maturi     CLE014
      ** ty amount.                                                       CLE014
      *                                                                   CLE014
     C           LNRF      IFEQ WRLNRF                                    CLE014
     C**********           SUB  WRRAMT    MAMNT                                        CLE014 207963
     C                     MOVE 'Y'       EXFR                            CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     Z-ADDMAMNT     AMNT                            CLE014
     C                     Z-ADDWMDAT     ADAT                            CLE014
      *                                                                   CLE014
     C           PCODE     IFEQ *BLANKS                                   CLE014
     C           PCODE     OREQ 'A'                                       CLE014
     C           MDAT      IFGE AGRDNB                                    CLE014
     C                     MOVEL'F'       CODE                            CLE014
     C                     ELSE                                           CLE014
     C**********           MOVEL'B'       CODE                                         CLE014 245182
     C                     MOVEL'P'       CODE                                                245182
     C                     ENDIF                                          CLE014
     C                     ELSE                                           CLE014
     C                     MOVELPCODE     CODE                            CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** Exclude participant transactions when code is not A              CLE014
      *                                                                   CLE014
     C           PCODE     IFNE 'A'                                       CLE014
     C           PRTR      ANDNE'P'                                       CLE014
     C           PRTR      ANDNE'I'                                       CLE014
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           LPFI      IFEQ 'P'                                       CLE014
     C           LPFI      OREQ 'I'                                       CLE014
     C           LPFI      OREQ 'R'                                       CLE014
     C           LPFI      OREQ 'S'                                                           CLE106
     C                     MOVEL'Y'       WREC                            CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           CLE014    WHEQ 'Y'                                       CLE014
     C           FREC      ANDEQ'CLOANCL5'                                CLE014
     C                     ADD  1         C                               CLE014
     C           C         OCUR LEFRBS                                    CLE014
     C**********           Z-ADDLNRF      WRLNRF                                       CLE014 CLE148
     C                     MOVELLNRF      WRLNRF                                              CLE148
     C                     Z-ADDWRAMT     WRRAMT                          CLE014
     C                     Z-ADDNRPD      ADAT                            CLE014
     C                     Z-ADDWRAMT     AMNT                            CLE014
     C                     MOVEL'RE'      ATYP                            CLE014
     C           PCODE     IFEQ *BLANK                                    CLE014
     C           PCODE     OREQ 'A'                                       CLE014
     C           NRPD      IFLT AGRDNB                                    CLE014
     C                     MOVE 'B'       CODE                            CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'F'       CODE                            CLE014
     C                     ENDIF                                          CLE014
     C                     MOVE RFRQ      FREQ                            CLE014
     C                     ENDIF                                          CLE014
      *
     C           FREC      WHEQ 'LEMNFUPF'
     C**********           Z-ADD0         LNRF                                                CLE148
     C                     MOVEL*BLANKS   LNRF                                                CLE148
     C                     Z-ADDSTDT      ADAT
     C                     Z-ADDEXDT      EDAT                                                189343
     C                     MOVELUCCY      CCY
     C                     Z-ADDUAMT      AMNT
     C***********          MOVEL*BLANKS   ATYP                            162967
     C                     MOVEL'US'      ATYP                            162967
     C                     Z-ADDSQNO      USEQ                            162967
     C           PCODE     IFEQ *BLANKS
     C           PCODE     OREQ 'A'                                       147488
     C           STDT      IFLT AGRDNB
     C                     MOVEL'B'       CODE
     C                     ELSE
     C                     MOVEL'F'       CODE
     C                     ENDIF
     C                     ELSE
     C                     MOVELPCODE     CODE
     C                     ENDIF
      *                                                                                       189343
      ** Set up details of future manual utilisation end date/expiry.                         189343
      *                                                                                       189343
     C           FREC      WHEQ 'LEMNFUPE'                                                    189343
     C**********           Z-ADD0         LNRF                                         189343 CLE148
     C                     MOVEL*BLANKS   LNRF                                                CLE148
     C                     Z-ADDEXDT      ADAT                                                189343
     C                     MOVELUCCY      CCY                                                 189343
     C                     Z-ADDUAMT      AMNT                                                189343
     C                     MOVEL'UE'      ATYP                                                189343
     C                     Z-ADDSQNO      USEQ                                                189343
     C           PCODE     IFEQ *BLANKS                                                       189343
     C           PCODE     OREQ 'A'                                                           189343
     C           EXDT      IFGE AGRDNB                                                        189343
     C                     MOVEL'F'       CODE                                                189343
     C                     ELSE                                                               189343
     C                     MOVEL'B'       CODE                                                189343
     C                     ENDIF                                                              189343
     C                     ELSE                                                               189343
     C                     MOVELPCODE     CODE                                                189343
     C                     ENDIF                                                              189343
      *                                                                                       189343
     C                     ENDSL
      *
     C           WREC      IFEQ *BLANKS                                   147488
     C           FREC      IFNE 'LEMNFUPF'                                                    189343
     C           FREC      ANDNE'LEMNFUPE'                                                    189343
     C                     Z-ADD*ZEROS    EDAT                                                189343
     C                     ENDIF                                                              189343
     C                     WRITELEFCEND0
     C                     ENDIF                                          147488
      *
     C                     ENDSR
      /EJECT
      *                                                                   CLE014
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      *                                                               *   CLE014
      *  SRRAMT  -  Set Repayment Amount                              *   CLE014
      *                                                               *   CLE014
      *  Called by: SRFRMT                                            *   CLE014
      *  Calls:                                                       *   CLE014
      *  GLINTC - Calculates interest                                 *   CLE014
      *                                                               *   CLE014
      *****************************************************************   CLE014
      *                                                                   CLE014
     C           SRRAMT    BEGSR                                          CLE014
      *                                                                   CLE014
      ** Initialise repayment amount workfield                            CLE014
      *                                                                   CLE014
     C                     Z-ADD*ZERO     WRAMT  150                      CLE014
     C                     SELEC                                          CLE014
      *                                                                   CLE014
      ** Repayment type 1 or 2                                            CLE014
      *                                                                   CLE014
     C           REPT      WHEQ 1                                         CLE014
     C           REPT      OREQ 2                                         CLE014
     C                     Z-ADDRAMT      WRAMT                           CLE014
      *                                                                   CLE014
      ** Repayment type 3                                                 CLE014
      *                                                                   CLE014
     C           REPT      WHEQ 3                                         CLE014
      *                                                                   CLE014
      ** Compute for interest                                             CLE014
      *                                                                   CLE014
     C                     Z-ADDSLID      ZIBEG                           CLE014
     C                     Z-ADDNRPD      ZIEND                           CLE014
     C                     Z-ADDICBS      ZICALC                          CLE014
     C                     Z-ADDCPAM      ZIAMT                           CLE014
     C                     Z-ADDINTR      ZIRATE                          CLE014
     C/COPY WNCPYSRC,LEH01304
     C                     EXSR GLINTC                                    CLE014
      *                                                                   CLE014
      ** Round down interest if required                                  CLE014
      *                                                                   CLE014
     C           RDFC      IFEQ 'Y'                                       CLE014
     C                     Z-ADDZINTR     WRDOWN 130                      CLE014
     C                     Z-ADDWRDOWN    ZINTR                           CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADDZINTR     WRUP   130H                     CLE014
     C                     Z-ADDWRUP      ZINTR                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           RAMT      SUB  ZINTR     WRAMT                           CLE014
      *                                                                   CLE014
     C                     ENDSL                                          CLE014
      *                                                                   CLE014
     C                     ENDSR                                          CLE014
      *                                                                   CLE014
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      * SRNEWI  -  Compute for new interest rate                      *   CLE014
      * Called by: SRFRMT                                             *   CLE014
      *                                                               *   CLE014
      * Calls    : None                                               *   CLE014
      *****************************************************************   CLE014
     C           SRNEWI    BEGSR                                          CLE014
      *                                                                   CLE014
      ** Reflect spread to effective interest                             CLE014
      *                                                                   CLE014
     C                     SELEC                                          CLE014
     C           WCUSI     WHEQ 'A'                                       CLE014
     C           WCUBR     ADD  WCUSP     WCURT                           CLE014
     C           WCUSI     WHEQ 'S'                                       CLE014
     C           WCUBR     SUB  WCUSP     WCURT                           CLE014
     C           WCUSI     WHEQ 'P'                                       CLE014
     C           WCUSP     DIV  100       WWORK  119                      CLE014
     C           WCUBR     MULT WWORK     WCURT                           CLE014
     C                     ENDSL                                          CLE014
      *                                                                   CLE014
     C                     ENDSR                                          CLE014
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      * SRINCL  -  Interest calculation                               *   CLE014
      * Called by: SRFRMT                                             *   CLE014
      *                                                               *   CLE014
      * Calls    : GLINTC                                             *   CLE014
      *****************************************************************   CLE014
     C           SRINCL    BEGSR                                          CLE014
      *                                                                   CLE014
      ** Do not compute for interest if not greater than 0                CLE014
      *                                                                   CLE014
     C           WCURT     IFLE *ZEROS                                    CLE014
     C           CPAM      OREQ *ZEROS                                    CLE014
     C                     Z-ADD*ZEROS    ZINTR                           CLE014
     C                     ELSE                                           CLE014
      *                                                                   CLE014
     C                     Z-ADDWLICD     ZIBEG                           CLE014
     C                     MOVE WICBS     ZICALC                          CLE014
     C                     Z-ADDWCUPR     ZIAMT                           CLE014
     C                     Z-ADDWCURT     ZIRATE                          CLE014
     C/COPY WNCPYSRC,LEH01305
     C                     EXSR GLINTC                                    CLE014
      *                                                                   CLE014
      ** Round down interest if required                                  CLE014
      *                                                                   CLE014
     C           RDFC      IFEQ 'Y'                                       CLE014
     C                     Z-ADDZINTR     RDWORK 130                      CLE014
     C                     Z-ADDRDWORK    ZINTR                           CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADDZINTR     RUWORK 130H                     CLE014
     C                     Z-ADDRUWORK    ZINTR                           CLE014
     C                     ENDIF                                          CLE014
     C                     Z-ADDZIEND     WLICD                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDSR                                          CLE014
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   154591
      *                                                               *   154591
      *  SRCRAG - Subroutine to Process Records in LEFCAML8 when      *   154591
      *           facility being enquired is a CA                     *   154591
      *                                                               *   154591
      *  Called By: Main Processing                                   *   154591
      *                                                               *   154591
      *  Calls    : NONE                                              *   154591
      *                                                               *   154591
      *****************************************************************   154591
      *                                                                   154591
     C           SRCRAG    BEGSR                                          154591
      *                                                                   154591
     C                     MOVELBRCA      WBRCH   3                       154591
     C**********           Z-ADDCNUM      WCSNO   60                                   154591 247204
     C**********           MOVELFACT      WFLTY   50                                   154591 247204
     C**********           MOVE FCNO      WFLTY                                        154591 247204
     C**********           Z-ADDPCNUM     WCSNO   60                                   247204 CSD027
     C                     MOVE PCNUM     WCSNO   6                                           CSD027
     C                     MOVELPFACT     WFLTY   50                                          247204
     C                     MOVE PFCNO     WFLTY                                               247204
      *                                                                   154591
      ** Retrieve actions                                                 154591
      *                                                                   154591
     C           PCODE     IFEQ 'A'                                       154591
     C           PCODE     ORNE 'A'                                       154591
     C           PRTR      ANDNE'P'                                       154591
     C           PRTR      ANDNE'I'                                       154591
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           WCAKY     SETLLLEFCAML8                                  154591
     C           WCAKY     READELEFCAML8                 02               154591
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN02     ANDEQ*OFF                                      156226
     C           WCAKY     READELEFCAML8                 02               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C           *IN02     DOWEQ'0'                                       154591
     C           PCODE     IFEQ 'B'                                       154591
     C           VLDT      ANDLTAGRDNB                                    154591
     C           FREC      ANDEQ'LEFCAMPF'                                154591
     C           PCODE     OREQ 'B'                                       154591
     C           VDAT      ANDLTAGRDNB                                    154591
     C           FREC      ANDEQ'LOAMSDKF'                                154591
     C           PCODE     OREQ 'B'                                       154591
     C           VDAT      ANDLTAGRDNB                                    154591
     C           ORED      ANDEQAGRDNB                                    154591
     C           FREC      ANDEQ'CLOANCL1'                                154591
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'B'                                       154591
     C           STDT      ANDLTAGRDNB                                    154591
     C           ORED      ANDEQAGRDNB                                    154591
     C           FREC      ANDEQ'LEMNFUPF'                                154591
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'F'                                       154591
     C           VLDT      ANDGEAGRDNB                                    154591
     C           FREC      ANDEQ'LEFCAMPF'                                154591
     C           PCODE     OREQ 'F'                                       154591
     C           VDAT      ANDGEAGRDNB                                    154591
     C           FREC      ANDEQ'LOAMSDKF'                                154591
     C           PCODE     OREQ 'F'                                       154591
     C           VDAT      ANDGEAGRDNB                                    154591
     C********** ORED      ANDEQAGRDNB                                    154591              204479
     C           FREC      ANDEQ'CLOANCL1'                                154591
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'F'                                       154591
     C           STDT      ANDGEAGRDNB                                    154591
     C           ORED      ANDEQAGRDNB                                    154591
     C           FREC      ANDEQ'LEMNFUPF'                                154591
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ *BLANKS                                   154591
     C           FREC      ANDNE'FACHISAF'                                154591
     C           FREC      ANDNE'CLOANCL2'                                154591
     C           RECI      ANDNE'R'                                       190124
     C           PCODE     OREQ 'A'                                       154591
     C           FREC      ANDNE'FACHISAF'                                154591
     C           FREC      ANDNE'CLOANCL2'                                154591
     C           RECI      ANDNE'R'                                       190124
      *                                                                   154591
     C                     MOVE 'Y'       WPRIN                           157545
     C           AMTP      IFEQ 'MR'                                      157545
     C           PRAM      ANDEQ0                                         157545
     C                     MOVE 'N'       WPRIN                           157545
     C                     ENDIF                                          157545
      *                                                                   157545
     C           VLDT      IFGE PVLDT                                     154591
     C           FREC      ANDEQ'LEFCAMPF'                                154591
     C           VDAT      ORGE PVLDT                                     154591
     C           FREC      ANDEQ'LOAMSDKF'                                154591
     C           WPRIN     ANDEQ'Y'                                       157545
     C           VDAT      ORGE PVLDT                                     154591
     C           ORED      ANDEQAGRDNB                                    154591
     C           FREC      ANDEQ'CLOANCL1'                                154591
     C           RECI      ANDNE'R'                                       190124
      *                                                                                       204479
     C           VDAT      ORGE PVLDT                                     154591              204479
     C           VDAT      ANDGEAGRDNB                                    154591              204479
     C           ORED      ANDNEAGRDNB                                    154591              204479
     C           FREC      ANDEQ'CLOANCL1'                                154591              204479
     C           RECI      ANDNE'R'                                                           204479
      *                                                                                       204479
     C           STDT      ORGE PVLDT                                     154591
     C           ORED      ANDEQAGRDNB                                    154591
     C           FREC      ANDEQ'LEMNFUPF'                                154591
     C           RECI      ANDNE'R'                                       190124
     C                     EXSR SRFRMT                                    154591
     C                     ENDIF                                          154591
      *                                                                   154591
     C                     ENDIF                                          154591
     C           WCAKY     READELEFCAML8                 02               154591
      *                                                                   156226
     C           PBRCA     IFNE 'ALL'                                     156226
     C           PBRCA     DOWNEBRCA                                      156226
     C           *IN02     ANDEQ*OFF                                      156226
     C           WCAKY     READELEFCAML8                 02               156226
     C                     ENDDO                                          156226
     C                     ENDIF                                          156226
      *                                                                   156226
     C                     ENDDO                                          154591
     C                     ENDIF                                          154591
      *                                                                   154591
     C                     ENDSR                                          154591
      *                                                                   154591
      /EJECT                                                              154591
      *****************************************************************
      *                                                               *
      *  *PSSR   -  Program exception error routine                   *
      *             Called automatically if a program error occurs,   *
      *             or directly by the program code using EXSR.       *
      *             This subroutine DUMPs the program just once.      *
      *                                                               *
      *  Called by: Main Processing                                   *
      *  Calls: None                                                  *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR SR **
      *
     C           @RUN      IFEQ *BLANK
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     CALL 'DBERRCTL'
     C                     END
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      /EJECT
      *****************************************************************                       246233
      *                                                               *                       246233
      *  SRPART  - Check if facility enquired on has participant(s)   *                       246233
      *                                                               *                       246233
      *  Called By: SRFACH                                            *                       246233
      *                                                               *                       246233
      *  Calls    : SRCUST                                            *                       246233
      *                                                               *                       246233
      *****************************************************************                       246233
      *                                                                                       246233
     C           SRPART    BEGSR                                                              246233
      *                                                                                       246233
     C                     READ FCLTYG                   99                                   246233
     C           *IN99     DOWEQ*OFF                                                          246233
      *                                                                                       246233
      ** Do While not EOF                                                                     246233
      *                                                                                       246233
     C           PMFC      IFEQ PCNUM                                                         246233
     C           PMFT      ANDEQPFACT                                                         246233
     C           PMFN      ANDEQPFCNO                                                         246233
      *                                                                                       246233
     C                     MOVELBRCA      WBRCA   3                                           246233
     C**********           Z-ADDCNUM      WCSNO                                        246233 CPK028
     C                     MOVE CNUM      WCSNO                                               CPK028
     C                     MOVELFACT      WFLTY                                               246233
     C                     MOVE FCNO      WFLTY                                               246233
     C                     MOVE *OFF      *IN97                                               246233
     C           WFACH     SETLLFACHISA6                                                      246233
     C           *IN97     DOWEQ*OFF                                                          246233
     C           WFACH     READEFACHISA6                 97                                   246233
     C           *IN97     IFEQ *OFF                                                          246233
     C           FADATE    ANDGEPVLDT                                                       AR936915
     C                     MOVELCNUM      ##CNUM 10                                           246233
     C                     EXSR SRCUST                                                        246233
     C                     MOVE FARECI    RECI                                                246233
     C**********           Z-ADDFALOAN    LNRF                                         246233 CLE148
     C                     MOVELFALOAN    LNRF                                                CLE148
     C                     Z-ADDFADATE    ADAT                                                246233
     C                     MOVELPCCY      CCY                                                 246233
     C                     Z-ADDFAAAMT    AMNT                                                246233
     C                     MOVELFAACTN    ATYP                                                246233
     C                     Z-ADDFASQNO    USEQ                                                246233
     C                     MOVEL'H'       CODE                                                246233
     C                     MOVE FARCIN    RVCR                                                246233
     C                     Z-ADD*ZEROS    EDAT                                                246233
     C                     WRITELEFCEND0                                                      246233
     C                     ENDIF                                                              246233
     C                     ENDDO                                                              246233
      *                                                                                       246233
     C                     ENDIF                                                              246233
     C                     READ FCLTYG                   99                                   246233
     C                     ENDDO                                                              246233
      *                                                                                       247204
      ** Retrieve the details of the original facility                                        247204
      *                                                                                       247204
     C           WFCLT     CHAINFCLTY                01                                       247204
      *                                                                                       246233
     C                     ENDSR                                                              246233
      *****************************************************************                       246233
      /EJECT                                                                                  246233
      *****************************************************************                       246233
      *                                                               *                       246233
      *  SRCUST - Verify Customer Number                              *                       246233
      *                                                               *                       246233
      *  Called By: SRPART                                            *                       246233
      *                                                               *                       246233
      *****************************************************************                       246233
      *                                                                                       246233
     C           SRCUST    BEGSR                                                              246233
      *                                                                                       246233
     C                     CALL 'AOCUSTR0'                                                    246233
     C                     PARM *BLANKS   P@RTCD  7                                           246233
     C                     PARM '*KEY   ' P@OPTN  7                                           246233
     C                     PARM ##CNUM    P@KEY1 10                                           246233
     C                     PARM           P@KYST  7                                           246233
     C           SDCUST    PARM SDCUST    DSSDY                                               246233
      *                                                                                       246233
      ** Handle Database Error                                                                246233
      *                                                                                       246233
     C           P@RTCD    IFNE *BLANKS                                                       246233
     C           *LOCK     IN   LDA                                                           246233
     C                     MOVEL'SDCUSTPD'DBFILE    P      ****************                   246233
     C                     MOVEL##CNUM    DBKEY     P      * DB ERROR 004 *                   246233
     C                     Z-ADD004       DBASE            ****************                   246233
     C                     EXSR *PSSR                                                         246233
     C                     ENDIF                                                              246233
      *                                                                                       246233
     C                     ENDSR                                                              246233
      *                                                                                       246233
      *****************************************************************                       246233
      /EJECT                                                                                  246233
     C/COPY ZSRSRC,ZDATE1Z2                                                                   207963
     C/COPY ZSRSRC,ZDATE2Z2                                                                   207963
     C/COPY ZSRSRC,GLINTCZ1                                               CLE014
     C/COPY ZSRSRC,ZINTDYZ2                                               CLE014
     C/COPY ZSRSRC,ZDATE9Z3                                               CLE014
     C/COPY ZSRSRC,ZDAT10Z2                                               CLE014
     C/COPY ZSRSRC,ZFREQBZ2                                                                   207963
     C/COPY ZSRSRC,ZACCH                                                                      207963
     C/COPY ZSRSRC,ZCHKH                                                                      207963
      ********************************************************************
**  CPY@
(c) Finastra International Limited 2001
** CMD - QCMDEXC COMMAND
CLRPFM FILE(          ) MBR(          )                                                     MD044620
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN    CLE014
00366007310109601461                                                      CLE014
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR       CLE014
00000000310005900090001200015100181002120024300273003040033400365         CLE014
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH                                                     207963
312831303130313130313031                                                                      207963
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                                          207963
0366073110961461                                                                              207963
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                                            207963
000031059090120151181212243273304334365                                                       207963
**   ZMNM - MONTHS SHORT NAMES                                                                207963
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC                                                          207963
>>>>>>> branch 'develop' of http://blrvslalm0006:7990/scm/md/midasrpg.git
