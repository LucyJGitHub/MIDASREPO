0001 H        1                                                           S01117
      *****************************************************************
/*S*D****RPGBASE*******************************************************                    AR1096969
0001 H***********                                                         S01117
0002 F*****************************************************************
0003 F*                                                               *
     F*  Midas - Customer Lending Module                              *
0005 F*                                                               *
0006 F*  LE0490 - CREATE COMMITMENT FEE EVENTS                        *
0007 F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
0009 F*                                                               *
      *  Last Amend No. AR1096969*REDUNDANTDate 21Mar13               *
      *  Prev Amend No. AR996895           Date 25Nov12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR787620           Date 10Jun11               *
      *                 CLE064             Date 06Dec10               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG22954           Date 18Feb09               *
      *                 CER016A            Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CSC042             Date 16Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 246141             Date 26Mar07               *
      *                 244516             Date 15Jan07               *
      *                 164847             Date 30Nov06               *
      *                 CRE026             Date 19Feb07               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CSW037A            Date 02May05               *
      *                 CIR013             Date 25Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CAP073             Date 08Aug01               *
      *                 CLE029             Date 04Sep02               *
      *                 CLE031             Date 07Feb03               *
      * Midas Release 4.01 -------------------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      *                 173117             Date 20Apr01               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CIR004             Date 20Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 163486             Date 14Oct99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 160659             Date 12May99               *
      *                 154799             Date 24Feb99               *
      *                 147261             DATE 17Dec98               *
      *                 CLE008             DATE 30NOV98               *
     F*                 126017             DATE 14NOV97               *
     F*                 121768             DATE 19FEB98               *
     F*                 122839             DATE 09SEP97               *
     F*                 097885             DATE 31JAN97               *
     F*                 111489             DATE 05DEC96                  *
     F*                 105140             DATE 18NOV96                  *
     F*                 095244             DATE 01NOV95               *
     F*                 095238             DATE 31OCT95               *
     F*                 066550             DATE  04FEB94                 *
     F*                 E48609             DATE  16DEC92                 *BHF581
     F*                 S01270             DATE  02NOV92                 *BHF581
     F*                 E38323             DATE 30JUL92                  *
     F*                 BHF627             DATE 02OCT90                  *
     F*                    BHF695             DATE 14SEP90               *
     F*                    BHF373             DATE 30AUG90               *
     F*                    BHF369             DATE 13AUG90               *
     F*                    LN0305             DATE 31MAY90               *
     F*                    S01243             DATE 15MAY90               *
     F*                    LN0007             DATE 27APR90               *
     F*                    S01194             DATE 10JAN90               *S01194
0009 F*                    S01117             DATE.07/09/89              *S01117
     F*                    E12849             DATE 26/04/88              *
     F*                    E12742             DATE 24/03/88              *
     F*                    S01147             DATE 03/12/87              *S01117
     F*                    E11849             DATE 20/11/87              *
0009 F*                    S01117             DATE.03/10/86              *S01117
     F*                    E80945             DATE 25/06/86              *
0011 F*                                                                  *
0011 F*------------------------------------------------------------------*
0011 F*                                                                  *
      *  AR1096969 - CBCFMGR_nn jobs should no longer run in our      *
      *              system                                           *
      *            - CCB022B - COB Restructure - COB File Manager     *
      *              (Missed out for drop2A delivery)                 *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,LEH00274                                 *
      *             WNCPYSRC,LEH00275                                 *
      *             WNCPYSRC,LEH00267                                 *
      *             WNCPYSRC,LEH00268                                 *
      *             WNCPYSRC,LEH00269                                 *
      *             WNCPYSRC,LEH00270                                 *
      *             WNCPYSRC,LEH00271                                 *
      *             WNCPYSRC,LEH00272                                 *
      *             WNCPYSRC,LEH00273                                 *
      *  CLE064 - Enhancement of Lending Frequencies                  *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG22954 - Incorrect update of facilities file after COB     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CSC042 - Pgm builds an array of ccy details in first cycle and  *
      *           then calls AOCURRR* for Telex Notice Days. Include     *
      *           Telex Notice Days in array and remove many repeated    *
      *           calls to AOCURRR*                                      *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  244516 - Error in LE0620P1 report. FOR ACCOUNT OF (FACO)     *
      *           field is not blank for a commitment fee             *
      *           record with Settlement Type 00. The value was       *
      *           erroneously taken from the last record processed    *
      *           in LE events file which has settlement details.     *
      *           FACO is expected to be blank if no settlement.      *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CRE026 - Consumer Banking                                    *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over GLINTC and ZINTDY.                   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CAP073 - Conversion of MN inputs into modular structure to   *
      *           use as APIs. Facility input Transaction Details     *
      *  CLE029 - Addition of Severity code and Limit ID to FCLTYFM   *
      *  CLE031 - Lending Enhancements.                               *
      *  173117 - Increase the size of branch internal customer       *
      *           number array due to the increment of size of        *
      *           branch code array.                                  *
      *  CIR004 - Dealing Calculation Method Change.                  *
      *         - Recompiled due to GLINTC and ZINTDY changes         *
      *  163486 - Recompiled due to change in LVENTEL & LVNTS.        *
      *  160659 - Recompiled due to change in CUTX2HP.                *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
     F*  147261 - Add Assignment or Participation indicator           *
     F*  CLE008 - Loan Administration ID Amendment                    *
     F*  126017 - Correction to interest calculation for calculation  *
     F*           basis 6 in SR/GLINTC. Add SR/ZDAT10                 *
     F*  121768 - Recompile over changed GLINTCZ1                     *
     F*  122839 - Record length is wrong                              *
     F*  097885 - Recompiled for wrong calculation of number of day   *
     F*           interest (ZINTDYZ2).                                *
0011 F*  111489 - 105140 missed 'O' spec for LVENTZZ. CONT22 is now      *
0011 F*           packed.                                                *
0011 F*  105140 - Recompile over changed LVENTZZ.                        *
0011 F*           Field NORE2 attribute changed!                         *
     F*  095244 - Recompiled for Calculation method 3                 *
     F*  095238 - Recompiled for Calculation method 3                 *
     F*    066550 - GLINTC has had historical problems and inaccuracies  *
     F*             and is now externaly descibed and changed to use     *
     F*             ZINTDYZ1. See document atached to error no on GEMS   *
     F*     E48609 - THIS PROGRAM IS REDUNDANT ONLY AFTER MONTHEND       *
     F*     S01270 - THIS PROGRAM IS REDUNDANT FROM REL 10.3.22          *
0011 F*  E38323 - Recompiled due to a change in copy source ZFWDT subr.  *
     F*     BHF627 -  EXCLUDE INTERBRANCH EVENTS WHEN UPDATING FACILITY  *
     F*               EXPOSURE BUT STILL OUTPUT TO LVENTEL               *
     F*     BHF695 -  BHF373 SHOULD USE EMDI THE SECOND TIME             *
     F*     BHF373 -  MULTIPLY DIVIDE INDICATORS ARE NOT M OR D FOR      *
     F*               SYNON INSTEAD OF 1 OR 0 (TABLE). INDICATORS        *
     F*               WERE STILL CHECKING 1 OR O.                        *
     F*     BHF369 -  WRONG FILE LAYOUT FOR LVENTEL                      *
     F*     LN0305 -  ALTERNATIVE ADDRESS ACCESS OBJECT INCORRECT
     F*     S01243 -  INCLUDE EVENTS FOR PRINCIPAL INCREASES ON          *S01243
     F*               TERM LOANS                                         *S01243
     F*     LN0007  -  USE OF ALTERNATIVE ADDRESS INCORRECTLY CODED
     F*     S01194  -  STANDING DATA CHANGES.                            *S01194
     F*     S01117  -  MULTIBRANCHING                                    *S01117
0011 F*     E12849  -  DATABASE ERROR AT 09,KEY 50 CAUSED FOR A CLIENT   *E12849
0011 F*                FOR WHICH A FEE IS GENERATED. CLIENT HAS PARENT.  *E12849
0011 F*                FIELD 'CDOM' IS BLANK FOR CLIENT AND CONTAINS     *E12849
0011 F*                ENTRY FOR PARENT.                                 *E12849
0011 F*     E12742  -  NEW FIELD DEFINITION FOR ACUP, NOW REFERRED       *E12742
0011 F*                TO AS ACUP0, IN CUPX2HP, NOT REFLECTED IN         *E12742
0011 F*                PROGRAM.                                          *E12742
0011 F*     S01147  -  RELEASE 22 (AMENDMENT TO GLINTC)                  *S01147
0011 F*     E11849  -  NEW FIELD DEFINITION FOR ACUP IN CUTX2HP          *E11849
0011 F*                NOT REFLECTED IN PROGRAM.                         *E11849
0011 F*     E80945  -  INDICATOR 98 SETTING IS SAVED AND RESTORED        *E80945
0011 F*                WHEN S.R.GLINTC IS PERFORMED.                     *E80945
0009 F*                                                                  *
     F*****************************************************************
0013 F***FCUPD   IP AF     256 12AI     2 DISK                            122839
0013 F**FCUPD   IP AF    1086 12AI     2 DISK                      122839 CLE008
0013 F***FCUPD   IP AF    1106 12AI     2 DISK                     CLE008 147261
0013 F***FCUPD   IP AF    1107 12AI     2 DISK                     147261 CLE031
0013 F***FCUPD   IP AF    1198 12AI     2 DISK                                         CLE031 CGL029
     F*FCUPD***IP*AF****1258 12AI     2 DISK                                           CGL029 CLE042
     F***FCUPD** IP AF    1263 12AI     2 DISK                                       CLE042 BUG22954
     F***FCUPD** IP AF    1269 12AI     2 DISK                                       BUG22954 CLE064
     FFCUPD   IP AF    1284 12AI     2 DISK                                                   CLE064
     F/COPY WNCPYSRC,LE0490F001
0014 F***LVNTS** IS AF     400 12AI     2 DISK                                                CGL029
     F*LVNTS***IS*AF****1124 12AI     2 DISK                                           CGL029 CLE042
     FLVNTS   IS AF    1128 12AI     2 DISK                                                   CLE042
0015 F*CLINT***IF**F*    256  7AI     2 DISK                              S01194
0016 F*TABLE***IF**F*     96 12AI     2 DISK                              S01194
0017 F*TABLED**IF**F*     96 12AI     2 DISK                              S01194
     F*******SDCURRPDIF  E                    DISK                                     S01194 CSC042
     FSDCURRPDIF  E                    DISK                           UC                      CSC042
     F*
     FSDBRCHPDIF  E                    DISK                               S01117
     F*
0018 FNFACLHH O   F     256            DISK
0018 F***NFACLFM O   F     256            DISK                            122839
     F**NFACLFM O   F    1086            DISK                      122839 CLE008
     F***NFACLFM O   F    1106            DISK                     CLE008 147261
     F***NFACLFM O   F    1107            DISK                     147261 CLE031
     F***NFACLFM O   F    1198            DISK                                         CLE031 CGL029
     F*NFACLFM*O***F****1258            DISK                                           CGL029 CLE042
     F***NFACLFM*O   F    1263            DISK                                       CLE042 BUG22954
     F***NFACLFM*O   F    1269            DISK                                       BUG22954 CLE064
     FNFACLFM O   F    1284            DISK                                                   CLE064
0018 F***NFACLFN O   F     256            DISK                                                CGL029
     F/COPY WNCPYSRC,LEH00274
     FNFACLFN O   F     348            DISK                                                   CGL029
     F/COPY WNCPYSRC,LEH00275
0018 FNFACLZZ O   F     256            DISK
0019 FLVENTHH O   F     400            DISK
     F***LVENTEL O   F     400            DISK                                                CGL029
     F*LVENTEL*O***F****1124            DISK                                           CGL029 CLE042
     FLVENTEL O   F    1128            DISK                                                   CLE042
     FLVENTZZ O   F     400            DISK
0020 FCUTX2HH O   F     100            DISK
     F*UTX2HP O   F     100            DISK
     F******CUTX2HP O   F     101            DISK                   E11849160659
     F******CUTX2HP O   F     103            DISK                  160659 CLE031
     FCUTX2HP O   F     111            DISK                               CLE031
     FCUTX2ZX O   F     100            DISK
0021 FCFTLXHH O   F     180            DISK
     F*FTLXPR O   F     180            DISK                               S01117
     F*CFTLXPR O   F     200            DISK                       S01117 CLE031
     F***CFTLXPR O   F     214            DISK                                         CLE031 CGL029
     FCFTLXPR O   F     232            DISK                                                   CGL029
     FCFTLXZZ O   F     180            DISK                               S01117
     F/COPY WNCPYSRC,LE0490F003
0022 F*E0490P1O***F     132            PRINTER                     S01124 S01117
     FLE0490AUO   F     132     OA     PRINTER                            S01117
0023 E***********         HCCY       25  3               ZDATE3           S01195
0024 E***********         TXAR      150  5 0             TLX DATE FOR CCY S01195
0025 E***********         ENAR      150  5 0             END DATE FOR CCY S01195
0026 E***********         CYAR      150  3               ARRAY OF CCYS    S01195
0027 E                    TABVAL  4   4  2               VALID EVENT TYPES
0028 E                    RUNS       10  5 0A            FCLTY AVAIL DATES
0029 E                    OAM        10 13 0             FCLTY AVAIL AMTS
0030 E                    CURR      150  3               ALL CCYS
0031 E                    CSPT      150 13 8             SPOT RATES/CCY
0032 E**********          MTDV      150  1 0             M/D INDICATOR/CCYS01194
0032 E                    MTDV      150  1               M/D INDICATOR/CCYS01194
0033 E                    CCDP      150  1 0             DEC PLACES/CCY
0034 E                    CSNO      150  2 0             SORT SEQ.NO/CCY
     E                    TXND      150  1 0             Telex Notice Days                    CSC042
     E/COPY WNCPYSRC,LE0490E001
0035 E                    POWR    1   7  7 3             POWERS OF 10
0036 E                    ZHC        50  3               ZFREQ SR. ARRAY
0037 E                    ZFMD   12  12  2               ZFREQ SR. ARRAY
0038 E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
0039 E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
0040 E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E*
     E** Branch Internal Customer Number array for use when checking if   S01117
     E** inter-branch purchase/loan.                                      S01117
     E*
     E**********          @BCA      150  6                         S01117 173117
     E                    @BCA      900  6                                173117
     E*
     E/COPY ZSRSRC,ZHOLE                                                  S01195
0041 E**
0042 F* ID F  C  H  L    FUNCTION OF INDICATORS
0043 F* 01            FCLTY FILE - HEADER
0044 F* 02                       - DETAIL 'A'
0045 F* 03                       - DETAIL 'B'
0046 F* 04                       - TRAILER
0047 F* 05            LVNTS FILE - HEADER
0048 F* 06                       - DETAIL
0049 F* 07                       - TRAILER
0050 F**08******      TABLE FILE DEFINED AS DEMAND FILE                   S01194
0051 F* 09            CLOSED FACILITY
0052 F**10******      CLINT FILE - DETAIL                                 S01194
0053 F*    20         'OUR AGENT' FIELD BLANK (FCLTY)
0054 F*    21         'THEIR AGENT' FIELD BLANK (FCLTY)
0055 F********11      END OF FILE ON TABLE DEMAND FILE                    S01194
     F*       11      END OF FILE ON READS ON SDCURRPD & SDBRCHPD         S01194
0056 F*       19      C/FEE PAYMENT DUE
     F*       22      PARTS SOLD WITH RECOURSE
0057 F*       31      CHAIN FAIL
0058 F*       35      PARENT NUMBER BLANK
0059 F*       41      C/FEE PROCESSING REQUIRED
0060 F*       42      USED IN FCLTY UPDATE
0061 F*       43      AT LEAST ONE FCLTY RECORD READ
0062 F*       44      EVENT TYPE 'A1'
     F*       50      Used to detect if BICN and also for EOF on          S01117
     F*               SDBRCHPD file when setting-up array of BICNs.       S01117
0063 F*       60      OUTPUT FCLTY 'A' AND 'B' RECORDS
0064 F*       62      OUTPUT C/FEE EVENT TO LVENT
0065 F*       63      OUTPUT CUST. BILL RECORD TO CUTX2
0066 F*       64      OUTPUT RECEIVE TELEX TO CFTLX
0067 F*       65      OUTPUT EVENT RECORD AS INPUT TO LVENT
0068 F*       70      WORK
0069 F*       71      WORK
0070 F*       72      DUMMY 'A1' EVENT READ
0071 F*       73      WORK
0072 F*       74      WORK
0073 F*       75      FCLTY NEITHER LIVE NOR CLOSED
0074 F********78****  FACILITY CURRENCY M/D INDIC = 0                     BHF373
0075 F********79****  EVENT      "       "    "   "                       BHF373
0074 F*       78      FACILITY CURRENCY M/D INDIC = D                     BHF373
0075 F*       79      EVENT      "       "    "   "                       BHF373
0076 F*       80      FCLTY FILE CONTROLS OUT OF BALANCE
0077 F*       81      LVNTS FILE CONTROLS OUT OF BALANCE
0078 F*          U8   FILE CONTROLS OUT OF BALANCE
0079 F*          U7+U8DATABASE IN ERROR
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZDATE9Z1                                               066550
0080 F*             L1CHANGE IN FCLTY KEY
     F/COPY WNCPYSRC,LE0490F002
0081 I**
0082 I**   F A C I L I T Y    F I L E
0083 I*
0084 IFCUPD   NS  01   1 CH
0085 I*
0086 I        NS  02   1 CD  13 CA
0087 I       OR        1 CE  13 CA
0088 I       OR   09   1 CC  13 CA
0089 I                                        1   1 RECIF
0090 I**********                              2   70CNUMF                                     CSD027
0090 I                                        2   7 CNUMF                                     CSD027
0091 I                                        8  100FACT
0092 I                                       11  120FCNO
0093 I*
0094 I                                        2  120FINF  L1M1
0095 I*
0096 I                                       13  13 RCTP
0097 I*****                                  14  160BRCDF                 S01117
     I************                           14  16 BRCA            S01117BHF369
     I                                       14  16 BRCAF                 BHF369
0098 I                                       17  17 FCTI
0099 I                                       18  20 FCCY
0100 I                                    P  21  270FAMT
0101 I                                    P  28  300OVPC
0102 I                                    P  31  330DTAP
0103 I                                    P  34  360DTEX
0104 I                                       37  37 RVCR
0105 I                                       38  38 SECI
0106 I                                       39  39 MCCY
0107 I                                       40  40 MCSI
0108 I                                       41  41 NACD
0109 I                                       42  43 CRSKF
0110 I                                    P  44  460DLFS
0111 I                                    P  47  527NOMR
0112 I                                    P  53  550RVDT
0113 I                                       56  56 RVFR
0114 I                                       57  580RVDY
0115 I                                       59  93 NAR1
0116 I                                       94 128 NAR2
0117 I                                      129 163 NAR3
0118 I                                      164 198 NAR4
0119 I                                    P 199 2050MTDH
0120 I                                    P 206 2120MTDL
0121 I                                    P 213 2190MTDA
0122 I                                    P 220 2270QTDA
0123 I                                    P 228 2350YTDA
0124 I                                      236 237 ACOFF
0125 I                                    P 247 2490ORED
0126 I                                    P 250 2520LCD
0127 I                                      253 253 CHTP
0128 I                                    P 254 2560TNLU
     I                                     10991101 SCCY                  CLE031
0133 I                                     11051106 LAID                  CLE008
0133 I                                     11071107 PASI                  147261
     I                                     11801186 REXR                  CLE031
     I                                     11871187 REXI                  CLE031
     I                                     11881190 PSCY                  CLE031
     I                                     11911197 PEXR                  CLE031
     I                                     11981198 PEXI                  CLE031
0129 I**
0130 I**   LOTF1 FOR OUTPUT FILE
0131 I******************                      1 256 LOTF1                 122839
0131 I*************                           11086 LOTF1          122839 CLE008
0131 I***********                             11106 LOTF1          CLE008 147261
0131 I**********                              11107 LOTF1          147261 CLE031
0131 I**********                              11198 LOTF1                              CLE031 CGL029
     I****************************************11258 LOTF1                              CGL029 CLE042
     I**********                              11263 LOTF1                            CLE042 BUG22954
     I**********                              11269 LOTF1                            BUG22954 CLE064
     I                                        11284 LOTF1                                     CLE064
0132 I        NS  03   1 CD  13 CB
0133 I       OR        1 CE  13 CB
0134 I       OR        1 CC  13 CB
0135 I                                        1   1 RECIF
0136 I**********                              2   70CNUMF                                     CSD027
0136 I                                        2   7 CNUMF                                     CSD027
0137 I                                        8  100FACT
0138 I                                       11  120FCNO
0139 I*
0140 I                                        2  120FINF    M1
0141 I*
0142 I                                       13  13 RCTP
0143 I                                       14  14 CMFT
0144 I                                       15  150CALC
0145 I                                    P  16  217SPRD
0146 I                                       22  230BCOD
0147 I                                    P  24  297BRAT
0148 I                                    P  30  320STDT
0149 I                                    P  33  350EDDT
0150 I                                    P  36  380DUDT
0151 I                                       39  39 BLFR
0152 I                                       40  410BLDN
0153 I                                       42  42 BTIN
     I/COPY WNCPYSRC,LE0490I002
0154 I                                       43  440BLDY
     I/COPY WNCPYSRC,LE0490I003
0155 I                                       45  460SETT
0156 I**********                             47  58 OBAC            20                        CGL029
     I                                       47  58 OBACQQ                                    CGL029
0157 I                                       59  68 TNAC            21
0158 I                                    P  69  710SLCD
0159 I                                    P  72  740ACCD
     I                                    P  75  812ADNP
0161 I                                    P  82  880PDTD
0162 I                                    P  89  950AFPD
0163 I                                    P  96 1020ADJP
0164 I                                    P 103 1090ADJN
0165 I                                    P 110 1160TOTD
     I                                    P 110 1160CTOTD
0166 I                                    P 117 1230CAMD
0167 I*****                               P 124 1300HFAM                  S01117
     I                                      130 130 MBFC                  S01117
0168 I                                      131 131 BITS
     I                                    P 132 1380PEXP
     I                                      142 144 CFBR                  S01117
0169 I                                    P 147 176 RUNS
0170 I                                    P 177 246 OAM
0171 I                                    P 247 2490ORED
0172 I                                    P 250 2520LCD
0173 I                                      253 253 CHTP
0174 I                                    P 254 2560TNLU
     I                                      331 348 OBAC            20                        CGL029
     I/COPY WNCPYSRC,LEH00267
0175 I**
0176 I**   LOTF2 FOR OUTPUT FILE
0177 I**********                              1 256 LOTF2                                     CGL029
     I/COPY WNCPYSRC,LEH00268
     I                                        1 348 LOTF2                                     CGL029
     I/COPY WNCPYSRC,LEH00269
0178 I**
0179 I**   FCLTY FILE TRAILER
0180 I        NS  04   1 CT
0181 I                                        1   1 RECIF
0182 I                                       13  13 RCTP
0183 I                                    P  17  190NORE1
0184 I                                    P  20  220FLSZ
0185 I                                    P  23  250NLRB
0186 I                                    P  26  280NINS
0187 I                                    P  29  310NDEL
0188 I                                    P  32  340NLRA
0189 I                                    P  35  420VLBF
0190 I                                    P  43  440VLBL
0191 I                                    P  45  520VRIF
0192 I                                    P  53  540VRIL
0193 I                                    P  55  620VRDF
0194 I                                    P  63  640VRDL
0195 I                                    P  65  720VRAF
0196 I                                    P  73  740VRAL
0197 I                                    P  75  820VLAF
0198 I                                    P  83  840VLAL
0199 I                                    P 250 2520LCD
0200 I                                      253 253 CHTP
0201 I                                    P 254 2560TNLU
0202 I**
0203 I**   LOTFT FOR OUTPUT FILE
0204 I                                        1 256 LOTFT
0205 I**
0206 I**   FCLTY FILE CATCHALL
0207 I        NS
0208 I                                        1   1 RECIF
0209 I**
0210 I**   C U S T O M E R    L E N D I N G    E V E N T S    F I L E
0211 I*
0212 ILVNTS   NS  05   1 CH
0213 I*
0214 I        NS  06   1 CL
0215 I                                        1   1 RECI
0216 I**********                              2   70LNRF                                      CLE148
     I                                        2   7 LNRF                                      CLE148
0217 I**********                              8  130CNUM                                      CSD027
0217 I                                        8  13 CNUM                                      CSD027
0218 I                                       14  17 ETYP
0219 I*
0220 I                                       14  15 PTP
0221 I                                       16  17 ETP
0222 I*
0223 I                                    P  18  200EDAT
0224 I                                    P  21  270EAMT
0225 I                                       28  30 ECCY
0226 I                                       31  320ECSS
0227 I                                       33  34 LTYP
0228 I                                       35  36 SUTP
0229 I***************                        37  390BRCD                  BHF369
0229 I                                       37  39 EBRC                  BHF369
0230 I                                    P  40  457INTR
0231 I                                       46  46 NGII
0232 I                                    P  47  490OTHD
0233 I                                    P  50  560OTHA
0234 I                                       57  59 FCCY
0235 I                                       60  610FCSS
0236 I                                       62  620ECDP
0237 I                                       63  630FCDP
0238 I                                    P  64  700DBCE
0239 I                                    P  71  770BCEQ
0240 I                                    P  78  848DBCR
0241 I                                    P  85  910DFCE
0242 I                                    P  92  980FCEQ
0243 I                                    P  99 1050DFCR
0244 I                                      106 106 FIRI
0245 I                                      107 1080SETP
0246 I**********                            109 120 OSAC                                      CGL029
     I                                      109 120 OSACQQ                                    CGL029
0247 I                                      121 130 TSEN
0248 I                                      131 140 FACO
0249 I                                      141 170 SPI1
0250 I                                      171 200 SPI2
0251 I                                      201 230 SPI3
0252 I                                      231 231 INOI
0253 I**********                            232 2370CPAR                                      CSD027
0253 I                                      232 237 CPAR                                      CSD027
0254 I                                      238 2380PARI
0255 I                                      239 258 CRNM
0256 I                                      259 268 CTWN
0257 I                                      269 276 CASK
0258 I                                      277 296 PRNM
0259 I                                      297 306 PTWN
0260 I                                      307 314 PASK
0261 I**********                            315 3200FCUS                                      CSD027
0261 I                                      315 320 FCUS                                      CSD027
0262 I                                      321 3230FTYP
0263 I                                      324 3250FSEQ
0264 I*
0265 I                                      315 3250FINF    M1
0266 I*
0267 I                                      326 327 CRSK
0268 I                                      328 329 REGC
0269 I                                      330 331 CDOM
0270 I                                      332 333 RDOM
0271 I                                      334 3360LASN
0272 I                                      337 337 FREO
0273 I                                      338 338 WTIN
0274 I                                    P 339 3447WTRT
0275 I                                    P 345 3510CPAM
0276 I                                      352 352 AUTO
0277 I                                      353 3530MRIN
0278 I                                      354 355 ACOF
0279 I                                      356 356 RCSI
0279 I                                      363 363 IBRE                  BHF627
0279 I                                      369 371 ORBR                  BHF369
0277 I                                      372 374 COOB                  BHF369
0278 I                                      375 377 BRCA                  BHF369
0279 I                                      378 380 COBB                  BHF369
     I                                     10711088 OSAC                                      CGL029
     I                                     11251128 CLAS                                      CLE042
0280 I**
0281 I**   LOT FOR OUTPUT
0282 I                                        1 200 LOTL1
0283 I**********                            201 400 LOTL2                                     CGL029
     I**************************************2011088 LOTL2                              CGL029 CLE042
     I                                      2011128 LOTL2                                     CLE042
0284 I*
0285 I**   TRAILER RECORD
0286 I*
0287 I        NS  07   1 CT
0288 I                                        1   1 RECI
0289 I**********                              2   60NORE2                 105140
0289 I                                    P   2   60NORE2                 105140
0290 I                                    P   7  140HRWN2
0291 I                                    P  15  160HRDC2
0292 I**
0293 I**   EVENT FILE CATCHALL
0294 I        NS
0295 I**                                                                  S01194
0296 I**   C U S T O M E R    M A S T E R    F I L E                      S01194
0297 I*****CLIENT FILE - HEADER RECORD.                                   S01194
0298 I*                                                                   S01194
0299 I*CLINT***NS*      1 CH                                              S01194
0300 I**********                              1   1 RECI                  S01194
0301 I**********                              2   70CNUM                  S01194
0302 I**********                              8   8 RCDT                  S01194
0303 I**********                              9  130TCUS                  S01194
0304 I**********                             14  180TINS                  S01194
0305 I**********                             19  230TDEL                  S01194
0306 I**********                             24  280TAMD                  S01194
0307 I*                                                                   S01194
0308 I*                                                                   S01194
0309 I*****CLIENT*FILE*-*CUSTOMER*STANDING*DATA*RECORD.                   S01194
0310 I*                                                                   S01194
0311 I*CLINT   NS  10   1 CD   8 CA                                       S01194
0312 I**********                              1   1 RECI                  S01194
0313 I**********                              2   70CNUM                  S01194
0314 I**********                              8   8 RCDT                  S01194
0315 I**********                              9  28 CRNM                  S01194
0316 I**********                             29  38 CTWN                  S01194
0317 I**********                             39  48 CSNM                  S01194
0318 I**********                             49  56 CASK                  S01194
0319 I**********                             57  68 TELX                  S01194
0320 I**********                             69  80 CSID                  S01194
0321 I**********                             81  82 ACOC                  S01194
0322 I**********                             83  83 CBSI                  S01194
0323 I**********                             84  85 CCTZ                  S01194
0324 I**********                             86  87 CLOC                  S01194
0325 I**********                             88  930CPAR                  S01194
0326 I*****                                  94  960BRCD                  S01194
0327 I**********                             97  980LINS                  S01194
0328 I**********                             99 1010LIND                  S01194
0329 I**********                          P 102 1040DASU                  S01194
0330 I**********                          P 105 1070CDIC                  S01194
0331 I**********                          P 108 1100DADE                  S01194
0332 I**********                            111 111 CMIN                  S01194
0333 I**********                            112 112 CTYP                  S01194
0334 I**********                            113 124 TELF                  S01194
0335 I**********                            125 133 CHID                  S01194
0336 I**********                            134 136 CHAB                  S01194
0337 I**********                          P 250 2520LCD                   S01194
0338 I**********                            253 253 CHTP                  S01194
0339 I**********                          P 254 2560TNLU                  S01194
0340 I*                                                                   S01194
0341 I*
0342 I*****CLIENT*FILE*-*CUSTOMER*NAME*AND*ADDRESS*RECORD.                S01194
0343 I*
0344 I********NS  10   1 CD   8NCA                                        S01194
0345 I**********                              1   1 RECI                  S01194
0346 I**********                              2   70CNUM                  S01194
0347 I**********                              8   8 RCDT                  S01194
0348 I**********                              9  43 CNA1                  S01194
0349 I**********                             44  78 CNA2                  S01194
0350 I**********                             79 113 CNA3                  S01194
0351 I**********                            114 148 CNA4                  S01194
0352 I*                                     149 160 TELF
0353 I*                                     161 172 TELX
0354 I*                                     173 174 CLOC
     I**********                            149 239 ZZ091                 S01194
0355 I**********                            240 249 CTWN                  S01194
0356 I**********                          P 250 2520LCD                   S01194
0357 I**********                            253 253 CHTP                  S01194
0358 I**********                          P 254 2560TNLU                  S01194
0359 I**
0360 I*****CATCHALL                                                       S01194
0361 I********NS                                                          S01194
0362 I**
0363 I**   T A B L E    F I L E  - INSTALLATION CONTROL RECORD DATA 1
0364 I*
0365 I*TABLE***NS       2 C0   3 C1  12 C1                                S01194
0366 I*******AND      13 C0                                               S01194
0367 I**********                              1   1 RECI                  S01194
0368 I**********                              2   30RECT                  S01194
0369 I**********                             12  130RCDE                  S01194
0370 I**********                             14  66 TITL                  S01194
0371 I***********                            67  67 DATF                  S01194
0372 I**********                             68  700DFBR                  S01194
0373 I**********                             74  74 MODI1                 S01194
0374 I**********                             75  75 MODI2                 S01194
0375 I**********                             76  76 MODI3                 S01194
0376 I***********                         P  77  790RUND                  S01194
0377 I***********                            80  86 RUNA                  S01194
0378 I**********                             87  870SFLG                  S01194
0379 I**********                          P  90  920LCD                   S01194
0380 I**********                             93  93 CHTP                  S01194
0381 I**********                          P  94  960TNLU                  S01194
0382 I*
0383 I*****TABLE*FILE*-*INSTALLATION*CONTROL*DATA*RECORD*2.               S01194
0384 I*
0385 I*TABLE***NS       1 CD   2 C0   3 C1                                S01194
0386 I*******AND      12 C1  13 C1                                        S01194
0387 I**********                              1   1 RECI                  S01194
0388 I**********                              2   30RECT                  S01194
0389 I**********                             12  130RCDE                  S01194
0390 I**********                             14  16 BCCY                  S01194
0391 I**********                             17  19 BCYL                  S01194
0392 I**********                             20  22 HOCY                  S01194
0393 I**********                             23  280HEAD                  S01194
0394 I**********                          P  29  310APDA                  S01194
0395 I**********                             35  35 APFQ                  S01194
0396 I**********                          P  36  380LOGS                  S01194
0397 I**********                             39  40 CUZR                  S01194
0398 I**********                          P  41  430DNWD                  S01194
0399 I**********                             44  460BVLP                  S01194
0400 I**********                             47  49 LOCY                  S01194
0401 I**********                             50  510FDAY                  S01194
0402 I**********                             52  52 ACLD                  S01194
0403 I***********                            53  53 MBIN                  S01194
0404 I**********                             86  86 ISAV                  S01194
0405 I**********                          P  87  890LLOG                  S01194
0406 I**********                          P  90  920LCD                   S01194
0407 I**********                             93  93 CHTP                  S01194
0408 I**********                          P  94  960TNLU                  S01194
0409 I*
0410 I*
0411 I*
0412 I*****TABLE*FILE*-*CURRENCIES*RECORD*1.                              S01194
0413 I*
0414 I*TABLE***NS       1 CD   2 C2   3 C0                                S01194
0415 I*******AND      13 C1                                               S01194
0416 I**********                              1   1 RECI                  S01194
0417 I**********                              2   30RECT                  S01194
0418 I**********                             10  12 CCY                   S01194
0419 I**********                             13  130SREC                  S01194
0420 I**********                             14  27 CCNM                  S01194
0421 I**********                          P  28  348SPOT                  S01194
0422 I**********                             35  37 CCYS                  S01194
0423 I**********                             38  380CDP                   S01194
0424 I**********                             39  390TNOT                  S01194
0425 I**********                             40  40 DCCY                  S01194
0426 I**********                             41  44 SRC1                  S01194
0427 I**********                             45  48 SRC2                  S01194
0428 I**********                             49  520TACC                  S01194
0429 I**********                             53  560TEQV                  S01194
0430 I**********                             57  600SWQV                  S01194
0431 I**********                             61  640TAC4                  S01194
0432 I**********                             65  680TAC5                  S01194
0433 I**********                             69  69 HIND                  S01194
0434 I**********                          P  70  768PART                  S01194
0435 I**********                             77  780SSNO                  S01194
0436 I**********                          P  79  858ERLC                  S01194
0437 I**********                             86  860MDIN                  S01194
0438 I**********                             87  870MDIA                  S01194
0439 I**********                             88  880MDIB                  S01194
0440 I**********                          P  90  920LCD                   S01194
0441 I**********                             93  93 CHTP                  S01194
0442 I**********                          P  94  960TNLU                  S01194
0696 I**
0443 I***********                                                         S01195
0444 I*****TABLE*FILE - HOLIDAY RECORD.                                   S01195
0445 I********E-EXCLUDE, I-INCLUDE.                                       S01195
0446 I***********                                                         S01195
0447 I*ABLE***NS*      1 CD   2 C2   3 C2                                 S01195
0448 I*******AND*     14 CE                                               S01195
0449 I*******OR**      1 CD   2 C2   3 C2                                 S01195
0450 I*******AND*     14 CI                                               S01195
0451 I***********                             1   1 RECI                  S01195
0452 I***********                             2   30RECT                  S01195
0453 I***********                             8  120HOL                   S01195
0454 I***********                            13  130SREC                  S01195
0455 I***********                            14  14 INEX                  S01195
0456 I***********                            15  89 HCCY                  S01195
0457 I***********                         P  90  920LCD                   S01195
0458 I***********                            93  93 CHTP                  S01195
0459 I***********                         P  94  960TNLU                  S01195
0460 I*
0461 I*****TABLE*FILE*-*COUNTRY*CODES*RECORD.                             S01194
0462 I*
0463 I*TABLE***NS       1 CD   2 C5   3 C0                                S01194
0464 I**********                              1   1 RECI                  S01194
0465 I**********                              2   30RECT                  S01194
0466 I**********                             12  13 CCOD                  S01194
0467 I**********                             14  43 CNM                   S01194
0468 I**********                             44  45 REGC                  S01194
0469 I**********                             46  480DEPT                  S01194
0470 I**********                          P  49  510DEPX                  S01194
0471 I**********                          P  52  560DEPA                  S01194
0472 I**********                             57  57 DEPF                  S01194
0473 I**********                          P  58  600DEPR                  S01194
0474 I**********                             61  620DLRD                  S01194
0475 I**********                             63  650FRXT                  S01194
0476 I**********                          P  66  680FRXX                  S01194
0477 I***********                                                         S01117
0478 I*****TABLE*FILE - BRANCH CODES RECORD.                              S01117
0479 I***********                                                         S01117
0480 I*ABLE***NS*      1 CD   2 C1   3 C0                                 S01117
0481 I***********                             1   1 RECI                  S01117
0482 I***********                             2   30RECT                  S01117
0483 I***********                            11  130BRCD                  S01117
0483 I***********                            11  13 BRCA                  S01117
0484 I***********                            14  43 BRNM                  S01117
0485 I***********                            44  490BICN                  S01117
0486 I***********                            50  51 LOCC                  S01117
0487 I***********                            52  53 CMPY                  S01117
0487 I***********                            52  54 CMPYM                 S01117
0488 I***********                         P  90  920LCD                   S01117
0489 I***********                            93  93 CHTP                  S01117
0490 I***********                         P  94  960TNLU                  S01117
0491 I**************                                                      S01194
0492 I*****CATCHALL*                                                      S01194
0493 I********NS****                                                      S01194
0494 I**************                          1   1 RECI                  S01194
0495 I**************                                                      S01194
0496 I*****TABLE*FILE*-*CURRENCIES*RECORD*-*DEFINED*AS*DEMAND*FILE        S01194
0497 I*TABLED**NS  08   2 C2   3 C0                                       S01194
0498 I**********                              1   1 RECI                  S01194
0499 I**********                              2   30RECT                  S01194
0500 I**********                             10  12 CCY                   S01194
0501 I**********                             13  130SREC                  S01194
0502 I**********                             14  27 CCNM                  S01194
0503 I**********                          P  28  348SPOT                  S01194
0504 I**********                             35  37 CCYS                  S01194
0505 I**********                             38  380CDP                   S01194
0506 I**********                             39  390TNOT                  S01194
0507 I**********                             40  40 DCCY                  S01194
0508 I**********                             41  44 SRC1                  S01194
0509 I**********                             45  48 SRC2                  S01194
0510 I**********                             49  520TACC                  S01194
0511 I**********                             53  560TEQV                  S01194
0512 I**********                             57  600SWQV                  S01194
0513 I**********                             61  640TAC4                  S01194
0514 I**********                             65  680TAC5                  S01194
0515 I**********                             69  69 HIND                  S01194
0516 I**********                          P  70  768PART                  S01194
0517 I**********                             77  780SSNO                  S01194
0518 I**********                          P  79  858ERLC                  S01194
0519 I**********                             86  860MDIN                  S01194
0520 I**********                             87  870MDIA                  S01194
0521 I**********                             88  880MDIB                  S01194
0522 I**********                          P  90  920LCD                   S01194
0523 I**********                             93  93 CHTP                  S01194
0524 I**********                          P  94  960TNLU                  S01194
0525 I**                                                                  S01194
0526 I*****CATCHALL                                                       S01194
0527 I********NS                                                          S01194
0528 I**********                              1   1 RECI                  S01194
     ISDCURRD0                                                            S01194
     I**   CURRENCY DETAILS                                               S01194
     I              A6NBDP                          CDP                   S01194
     I              A6CYCD                          CCY                   S01194
     I              A6SPRT                          SPOT                  S01194
     I              A6TXND                          TNOT                  S01194
     I              A6SSNB                          SSNO                  S01194
     I              A6MDIN                          MDIN                  S01194
     I*                                                                   S01194
      **                                                                  S01194
     ISDBRCHD0                                                            S01117
      **  FORMAT OF BRANCH CODE DETAILS FILE                              S01117
     I              A8BICN                          BICN                  S01117
     I/COPY WNCPYSRC,LE0490I001
     I*                                                                   S01117
     I/COPY ZSRSRC,ZHOLI                                                  S01195
      **  EXTERNAL DS FOR HOLIDAY DETAILS                                 S01195
      **                                                                  S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
      **  EXTERNAL DS FOR BRANCH CODE DETAILS                             S01117
     I              A8CMCD                          CMPYM                 S01117
     I              A8BICN                          BICN                  S01117
     I*                                                                   S01117
     ISDBANK    E DSSDBANKPD                                              S01117
     I**  EXTERNAL DS FOR BANK DETAILS                                    S01117
     I              BJURPT                          TITL                  S01117
     I              BJDNWD                          DNWD                  S01117
     I*
     I*****SDCURR    E DSSDCURRPD                                                      S01194 CSC042
     I****EXTERNAL DS FOR CURRENCY DETAILS                                             S01194 CSC042
     I**********    A6NBDP                          CDP                                S01194 CSC042
     I**********    A6CYCD                          CCY                                S01194 CSC042
     I**********    A6SPRT                          SPOT                               S01194 CSC042
     I**********    A6TXND                          TNOT                               S01194 CSC042
     I**********    A6SSNB                          SSNO                               S01194 CSC042
     I**********    A6MDIN                          MDIN                               S01194 CSC042
     I*                                                                   S01194
     ISDGELR    E DSSDGELRPD                                              S01117
     I              BKAPDT                          APDA                  S01195
     I**  EXTERNAL DS FOR GENERAL LEDGER DETAILS                          S01117
     I*
     ISDNOST    E DSSDNOSTPD                                              S01195
      **  EXTERNAL DS FOR NOSTRO DETAILS                                  S01195
     I              A7NOSN                          CSNM                  S01195
     I              QQACCD                          QQACC1                                    CGL029
     I*
     ISDCUST    E DSSDCUSTPD                                              S01117
     I**  EXTERNAL DS FOR CUSTOMER DETAILS                                S01117
     I              BBCOLC                          CLOC                  S01117
     I              QQDFAC                          QQDFA1                                    CGL029
     I*
     ISDCTRY    E DSSDCTRYPD                                              S01117
     I**  EXTERNAL DS FOR COUNTRY DETAILS                                 S01117
      *                                                                   S01194
     ISDALTN    E DSSDALTNPD                                              S01194
      **  EXTERNAL DS FOR CUSTOMER ALTERNATE NAME AND ADDRESS             S01194
     I*
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
      **                                                                  S01195
     IDSCSNM      DS                             10                       S01195
      ** DATA AREA FOR THE LOCATION CODE IN CUSTOMER SHORTNAME FIELD      S01195
     I                                        8  10 NRLC                  S01195
0529 I*
0530 I***   LOCAL DATA AREA
0531 ILDA        UDS                            256
0532 I***********                           134 177 DBINF                 S01117
0532 I                                      134 183 DBINF                 S01117
0533 I*
0534 I***********                           134 138 DBFILE                S01117
0535 I***********                           139 167 DBKEY                 S01117
0536 I***********                           168 175 DBPGM                 S01117
0537 I***********                           176 1770DBASE                 S01117
0534 I                                      134 141 DBFILE                S01117
0535 I                                      142 170 DBKEY                 S01117
0536 I                                      171 180 DBPGM                 S01117
0537 I                                      181 1830DBASE                 S01117
     I**                                                                  S01117
     IRUNDT       DS                                                      S01117
      **  DATA AREA RUNDAT                                                S01117
     I                                        1   7 RUNA                  S01117
     I                                    P   8  100RUND                  S01117
     I                                       11  11 SSF                   S01117
     I                                       12  12 DATF                  S01117
     I                                       13  13 MBIN                  S01117
0538 I/SPACE 3
     I/COPY ZSRSRC,ZINTDYZ1                                               066550
     I/COPY ZSRSRC,ZDATE9Z2                                               066550
     I/COPY ZSRSRC,ZDAT10Z1                                               126017
     C**********           MOVEACPY@      BIS@   80                                           CSC042
0539 C**
     C** PARAMETER LIST FOR PROGRAM 'AOBANKR0'                            S01194
     C           PLISTA    PLIST                                          S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C**                                                                  S01194
     C** PARAMETER LIST FOR PROGRAM 'AOGELRR0'                            S01194
     C           PLISTB    PLIST                                          S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*FIRST ' @OPTN                           S01194
     C********** SDGELR    PARM SDGELR    DSFDY                                        S01194 CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C**                                                                  S01194
     C***PARAMETER*LIST*FOR PROGRAM 'AOCURRR0'                                         S01194 CSC042
     C**********                                                                       S01194 CSC042
     C********** PLIST1    PLIST                                                       S01194 CSC042
     C**********           PARM '*BLANKS' @RTCD                                        S01194 CSC042
     C**********           PARM '*KEY   ' @OPTN                                        S01194 CSC042
     C**********           PARM           CURKEY  3                                    S01194 CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                        S01194 CSC042
     C** PARAMETER LIST FOR PROGRAM 'AOCTRYR0'                            S01194
     C*                                                                   S01194
     C           PLIST2    PLIST                                          S01194
     C                     PARM '*BLANKS' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM           CTKEY   2                    A  S01194
     C           SDCTRY    PARM SDCTRY    DSSDY                        B  S01194
     C**
     C** PARAMETER LIST FOR PROGRAM 'AOCUSTR0'                            S01194
     C*                                                                   S01194
     C           PLIST3    PLIST                                          S01194
     C                     PARM '*BLANKS' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM           CKEY   10                       S01194
     C                     PARM           KEYSTS  7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C**
     C** PARAMETER LIST FOR PROGRAM 'AOALTNR0'                            S01194
     C*                                                                   S01194
     C           PLIST4    PLIST                                          S01194
     C                     PARM '*BLANKS' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM           AENB    6                       S01194
     C                     PARM           AZCD    1                       S01194
     C           SDALTN    PARM SDALTN    DSFDY                           S01194
     C/COPY WNCPYSRC,LE0490C014
     C*                                                                   S01194
0540 C**   FCUPD HEADER READ - DO FIRST CYCLE PROCESSING
0541 C*
0542 C   01                EXSR FIRST
0543 C   U7                GOTO END
0544 C   01                Z-ADD1         COUNT1  50
0545 C   01                GOTO END
0546 C**
0547 C**   MAIN PROCESSING BEGINS HERE
0548 C           START     TAG                             ** START TAG **
0549 C**
0550 C**   MAINTAIN FCLTY RUN CONTROLS
0551 C   02
0552 COR 09
0553 COR 03
0554 COR 04      COUNT1    ADD  1         COUNT1
0555 C   02      FAMT      DIV  1000      ZZAMT
0556 C   02                Z-ADDTOTI1     ZZTOTI
0557 C   02                Z-ADDTOTD1     ZZTOTD
0558 C*
0559 C   02                EXSR GLZADD
0560 C*
0561 C   02                Z-ADDZZTOTI    TOTI1  150
0562 C   02                Z-ADDZZTOTD    TOTD1   30
0563 C**
0564 C**   SET ON IND IF DETAIL 'A' RECORD READ
0565 C   02N43
0566 COR 09N43             SETON                     43
0567 C**
0568 C   02
0569 COR 09
0570 COR 04                GOTO END
0571 C**
0572 C**   PROCESS FCLTY 'B' RECORD
0573 C   03                EXSR FCLTY
0574 C*
0575 C   03                GOTO END
0576 C**
0577 C**   EVENTS FILE PROCESSING - MAINTAIN COUNT OF RECORDS READ
0578 C   05
0579 COR 06
0580 C*OR*07******COUNT2    ADD  1         COUNT2  50                     105140
     COR 07      COUNT2    ADD  1         COUNT2  90                      105140
0581 C*
0582 C   05
0583 COR 07      COUNTX    ADD  1         COUNTX
0584 C  N06                GOTO END
0585 C**
0586 C**   KEEP HASH TOTAL OF EVENTS READ
0587 C           EAMT      DIV  1000      ZZAMT        71
0588 C   71                Z-SUBZZAMT     ZZAMT
0589 C                     Z-ADDTOTI2     ZZTOTI
0590 C                     Z-ADDTOTD2     ZZTOTD
0591 C*
0592 C                     EXSR GLZADD
0593 C*
0594 C                     Z-ADDZZTOTI    TOTI2  150
0595 C                     Z-ADDZZTOTD    TOTD2   30
0596 C*
0597 C**  DO NOT INCLUDE 'AI' EVENTS IN OUTPUT
0598 C**  CONTROLS, BECAUSE RECORDS DROPPED.
0599 C           ETP       COMP 'A1'                     44
0600 C      44             GOTO MISS
0601 C*
0602 C           COUNTX    ADD  1         COUNTX  50
0603 C           EAMT      DIV  1000      ZZAMT        71
0604 C      71             Z-SUBZZAMT     ZZAMT
0605 C                     Z-ADDTOTIX     ZZTOTI
0606 C                     Z-ADDTOTDX     ZZTOTD
0607 C                     EXSR GLZADD
0608 C                     Z-ADDZZTOTI    TOTIX  150
0609 C                     Z-ADDZZTOTD    TOTDX   30
0610 C*
0611 C           MISS      TAG                             ** MISS TAG **
0612 C**
0613 C**   PROCESS EVENT DETAIL RECORD
0614 C                     EXSR EVENT
     C*                                                                   S01117
     C** SETOF INTERBRANCH PARTICIPATION INDICATOR                        S01117
     C*                                                                   S01117
     C                     SETOF                     50                   S01117
0615 C**
0616 C**   TOTAL TIME PROCESSING
0617 C           END       TAG                             **  END TAG  **
0618 CL1 43NU7             EXSR LEVEL
0619 C*
0620 CLRNU7                EXSR LSTREC
     C*                                                                   S01117
     CLR U7 U8             EXSR *PSSR                                     S01117
     C*                                                                   S01117
     C/SPACE 3                                                            S01117
0621 C********************************************************************
0622 C*    SUBROUTINE TO HANDLE FIRST CYCLE PROCESSING
0623 C*
0624 C*    FIRST IS CALLED BY - MAIN PROCESSING
0625 C*
0626 C*             CALLS - ZSYSTM;TABCHN
0627 C*
0628 C***********
0629 C           FIRST     BEGSR                           * FIRST BEGSR *
     C                     MOVEACPY@      BIS@   80                                           CSC042
     C/COPY WNCPYSRC,LE0490C003
0630 C**
0631 C**   CLEAR DATABASE ERROR FIELDS & STORE PROGRAM NAME
0632 C                     MOVE ' '       BLANKS 50
0633 C                     MOVE BLANKS    DBINF
0634 C*
0635 C                     MOVE 'LE0490'  DBPGM
0636 C**
0637 C**   ACCESS I.C.D.R.1
     C                     CALL 'AOBANKR0'PLISTA                          S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                     U7U8LR               S01194
     C                     MOVE '01'      DBASE                           S01194
     C                     MOVE 'SDBANKPD'DBFILE                          S01194
     C                     GOTO FSTEND                                    S01194
     C                     END                                            S01194
     C*    CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
     C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON  S01194
     C*                                                                   S01194
0638 C**********           EXSR ZSYSTM                                    S01194
0639 C*
0640 C***99*****           MOVE '01'      DBASE            ***************S01194
0641 C***99*****           MOVE ZTABKY    DBKEY            ***   01   *** S01194
0642 C***99*****           MOVE 'TABLE'   DBFILE           ***************S01194
0643 C***99*****           SETON                     U7U8LR               S01194
0644 C***99*****           GOTO FSTEND                                    S01194
0645 C**
0646 C**   ACCESS I.C.D.R.2
     C**    ACCESS GENERAL LEDGER DETAILS                                 S01194
     C*                                                                   S01194
     C**********           CALL 'AOGELRR0'PLISTB                                       S01194 CGL029
     C                     CALL 'AOGELRR1'PLISTB                                              CGL029
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                     U7U8LR               S01194
     C                     MOVE '02'      DBASE                           S01194
     C                     MOVE 'SDGELRPD'DBFILE                          S01194
     C                     GOTO FSTEND                                    S01194
     C                     END                                            S01194
     C*                                                                   S01194
0647 C**********           MOVEL'01'      TABKEY                          S01194
0648 C**********           MOVE '11'      TABKEY 12                       S01194
0649 C**********                                                          S01194
0650 C**********           EXSR TABCHN                                    S01194
0651 C**********                                           ***************S01194
0652 C***U7*****           MOVE '02'      DBASE            ***   02    ***S01194
0653 C***U7*****           GOTO FSTEND                     ***************S01194
      **                                                                  S01117
      **   IN THE DATAAREA RUNDAT                                         S01117
      **                                                                  S01117
     C           *NAMVAR   DEFN RUNDAT    RUNDT                           S01117
     C                     IN   RUNDT                                     S01117
     C*    DEFINE LDA                                                     S01117
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
0654 C**
0655 C**   SET UP CURRENCY ARRAYS
0656 C**********           MOVEL'20'      TABKEY                          S01194
0657 C********** TABKEY    SETLLTABLED                                    S01194
     C                     OPEN SDCURRPD                                                      CSC042
0658 C                     Z-ADD0         X       30
0659 C*
0660 C           READC     TAG                             ** READC TAG **
0661 C*
0662 C                     SETOF                     08
0663 C**********           READ TABLED                   11               S01194
     C                     READ SDCURRPD                 11               S01194
0664 C***11*****                                                          S01194
0665 C*ORN08****            GOTO ENDRDC                                   S01194
0664 C   11                GOTO ENDRDC                                    S01194
0666 C*
0667 C********** RECI      COMP 'D'                      70               S01194
0668 C***70***** SREC      COMP 1                        70               S01194
0669 C**N70*****           GOTO READC                                     S01194
0670 C**
0671 C**   VALID CURRENCY RECORD - STORE DETAILS
0672 C           X         ADD  1         X
0673 C*
0674 C                     MOVE CCY       CURR,X
0675 C                     Z-ADDSPOT      CSPT,X
0676 C**********           Z-ADDMDIN      MTDV,X                          S01194
0676 C                     MOVELMDIN      MTDV,X                          S01194
0677 C                     Z-ADDCDP       CCDP,X
0678 C                     Z-ADDSSNO      CSNO,X
     C                     Z-ADDTNOT      TXND,X                                              CSC042
     C/COPY WNCPYSRC,LE0490C015
0679 C**
0680 C**   CHECK IF ARRAY IS FULL
0681 C           X         COMP 150                      70
0682 C  N70                GOTO READC
0683 C*
0684 C           ENDRDC    TAG                             ** ENDRDC TAG**
     C                     CLOSESDCURRPD                                                      CSC042
0685 C**********           MOVE BLANKS    TABKEY                          S01194
0686 C**
0687 C**   SET UP ZERO FIELDS
0688 C                     Z-ADD0         ZERO5   50
0689 C                     Z-ADD0         ZERO11 110
0690 C                     Z-ADD0         ZERO13 130
     C*********************Z-ADD0         ZERO15 150               E11849 E11849
0691 C***********          MOVE 'Y'       ZOPT                            S01117
     C                     MOVE *BLANKS   SEXI    1                       CLE031
     C                     Z-ADD0         SEXR   138                      CLE031
0692 C*
     C** Set-up the array of branch internal customer nos.                S01117
     C*                                                                   S01117
     C                     EXSR BCASR                                     S01117
     C*                                                                   S01117
     C/COPY WNCPYSRC,LE0490C006
0693 C           FSTEND    ENDSR                           ** FSTEND TAG**
0694 C********************************************************************
0695 C*    SUBROUTINE TO PROCESS FCLTY 'B' RECORD
0696 C*
0697 C*    FCLTY IS CALLED BY - MAIN PROCESSING
0698 C*
0699 C*             CALLS - FCLPDT;FCLCDT
0700 C*
0701 C***********
0702 C           FCLTY     BEGSR                           * FCLTY BEGSR *
0703 C                     SETOF                     4119
0704 C*
     C/COPY WNCPYSRC,LE0490C002
0705 C* ZEROISE CURRENT AMOUNT DRAWN
0706 C*  FOR EVENTS PROCESSING
0707 C                     Z-ADD0         CAMD
0707 C                     Z-ADD0         PEXP
     C/COPY WNCPYSRC,LE0490C001
0708 C**
0709 C**   IF FACILITY IS EXPIRED DO NO FURTHER PROCESSING
0710 C           RECIF     COMP 'E'                      75
0711 C*
0712 C   75                GOTO FCLTEN
0713 C**
0714 C**   CHECK IF FACILITY IS COMMITMENT FEE BEARING
0715 C           CMFT      COMP ' '                  7070
0716 C**
0717 C**   IF FEE BEARING CHECK IF END DATE REACHED
0718 C   70                TESTB'4'       BITS       70
0719 C**
0720 C**   END DATE NOT REACHED - CALCULATE PROCESSING DATES
     C**
     C**   CALCULATE REPORT DATES REGARDLESS OF COMM FEES
     C**
     C                     EXSR FCLPDT
0722 C**
0723 C**                    - SET UP COMM/FEE CALC. DETAILS
0724 C   70NU7             EXSR FCLCDT
0725 C*
0726 C           FCLTEN    ENDSR                           ** FCLTEN TAG**
0727 C********************************************************************
0728 C*    SUBROUTINE TO CALCULATE PROCESSING DATES FOR A FACILITY
0729 C*
0730 C*    FCLPDT IS CALLED BY - FCLTY
0731 C*
0732 C***************CALLS*-*ZDATE3,TABCHN*****                           S01195
     C*              CALLS - ZFWDT,TABCHN                                 S01195
0733 C*
0734 C***********
0735 C           FCLPDT    BEGSR                           * FCLPDT BEGSR*
0736 C**
0737 C**   CALCULATE BILLING DATE
0738 C           RUND      ADD  BLDY      BDAYS   50
0739 C***********                                                         S01195
0740 C*****CALCULATE EVENT END DATE - HAS CCY BEEN PROCESSED YET          S01195
0741 C***********          Z-ADD1         X                               S01195
0742 C***********FCCY      LOKUPCYAR,X                   71               S01195
0743 C***********                                                         S01195
0744 C*****CURRENCY HAS BEEN PROCESSED,USE DATES PREVIOUSLY CALCULATED    S01195
0745 C***71******          GOTO DAYFIL                                    S01195
0746 C***********                                                         S01195
0747 C*****CURRENCY NOT YET PROCESSED - FIND NEXT FREE ELEMENT IN ARRAYS  S01195
0748 C***********          Z-ADD1         X                               S01195
0749 C***********'   '     LOKUPCYAR,X                   71               S01195
0750 C**
0751 C**   CALCULATE EVENT END DATE
0752 C                     MOVE FCCY      ZCCY
0753 C                     Z-ADD15        ZNRDYS
0754 C                     Z-ADDRUND      ZDAYNO
     C                     MOVE *BLANKS   ZLOC                            S01195
0755 C*
0756 C***********          EXSR ZDATE3                                    S01195
0756 C                     EXSR ZFWDT                                     S01195
0757 C*
0758 C***********          MOVE FCCY      CYAR,X                          S01195
0759 C***********          Z-ADDZDYNBR    ENAR,X                          S01195
0759 C                     Z-ADDZDYNBR    ENAR    50                      S01195
0760 C**
0761 C*****NOW*CALCULATE*RECEIVE*TELEX*DATE*-*ACCESS*TABLE*FOR*TLX*NOT.DY S01194
0761 C* NOW CALCULATE RECEIVE TELEX DATE - ACCESS SDCURRPD FOR TLX NOT.DY S01194
0762 C**********           MOVEL'20'      TABKEY 12                       S01194
0763 C**********           MOVELFCCY      PART4   4                       S01194
0764 C**********           MOVE '1'       PART4                           S01194
0765 C**********           MOVE PART4     TABKEY                          S01194
0766 C**********                                                          S01194
0767 C**********           EXSR TABCHN                                    S01194
     C**********           MOVELFCCY      CURKEY                                       S01194 CSC042
     C**********           CALL 'AOCURRR0'PLIST1                                       S01194 CSC042
     C********** @RTCD     IFNE *BLANKS                                                S01194 CSC042
     C                     Z-ADD1         X                                                   CSC042
     C           FCCY      LOKUPCURR,X                   99                                   CSC042
     C           *IN99     IFEQ *ON                                                           CSC042
0674 C                     MOVE CURR,X    CCY                                                 CSC042
0675 C                     Z-ADDCSPT,X    SPOT                                                CSC042
0676 C                     MOVELMTDV,X    MDIN                                                CSC042
0677 C                     Z-ADDCCDP,X    CDP                                                 CSC042
0678 C                     Z-ADDCSNO,X    SSNO                                                CSC042
     C                     Z-ADDTXND,X    TNOT                                                CSC042
     C                     ELSE                                                               CSC042
     C**********           MOVE 'SDCURRPD'DBFILE                                       S01194 CSC042
     C                     MOVE 'CURR,X  'DBFILE                                              CSC042
     C**********           MOVE CURKEY    DBKEY            **************              S01194 CSC042
     C                     MOVE FCCY      DBKEY                                               CSC042
     C                     MOVE '03'      DBASE            ***   03   *** S01194
     C                     SETON                     U7U8LR************** S01194
     C                     GOTO ENDPDT                                    S01194
     C                     END                                            S01194
0768 C*                                                    ***************
0769 C***U7*****           MOVE '03'      DBASE            ***   03   *** S01194
0770 C***U7*****           GOTO ENDPDT                     ***************S01194
0771 C*
0772 C                     Z-ADDTNOT      ZNRDYS
     C                     Z-ADDSETT      W@STLL                          S01195
     C                     MOVELOBAC      W@OUR                           S01195
     C                     EXSR SETLOC                                    S01195
     C                     MOVE W@STBL    ZLOC                            S01195
0773 C*
0774 C***********          EXSR ZDATE3                                    S01195
0774 C                     EXSR ZFWDT                                     S01195
0775 C*
0776 C***********          Z-ADDZDYNBR    TXAR,X                          S01195
0776 C                     Z-ADDZDYNBR    TXAR    50                      S01195
0777 C**
0778 C**   CALCULATE EXTRACT DATE AS GREATER OF BILLING & EVENT END DATES
0779 C           DAYFIL    TAG                             ** DAYFIL TAG**
0780 C***********BDAYS     COMP ENAR,X               71                   S01195
0780 C           BDAYS     COMP ENAR                 71                   S01195
0781 C   71                Z-ADDBDAYS     EXDT    50
0782 C**N71******          Z-ADDENAR,X    EXDT                            S01195
0783 C***********          Z-ADDTXAR,X    TXDT    50                      S01195
0782 C  N71                Z-ADDENAR      EXDT                            S01195
0783 C                     Z-ADDTXAR      TXDT    50                      S01195
0784 C*
0785 C           ENDPDT    ENDSR                           **ENDPDT TAG **
0786 C********************************************************************
0787 C*    SUBROUTINE TO SET UP C/FEE CALCULATION DETAILS
0788 C*
0789 C*    FCLCDT IS CALLED BY - FCLTY
0790 C*
0791 C*              CALLS - FPYDTR
0792 C*
0793 C***********
0794 C           FCLCDT    BEGSR                           * FCLCDT BEGSR*
0795 C**
0796 C**   CALCULATE C/FEE RATE FROM BASE & SPREAD
0797 C           SPRD      ADD  BRAT      ZIRATE
0798 C**
0799 C**   SET INDICATOR FOR C/FEE PROCESSING REQUIRED
0800 C                     SETON                     41
0801 C**
0802 C**   CHECK FOR C/FEE PAYMENT DUE
0803 C                     EXSR FPYDTR
0804 C*
0805 C                     ENDSR
0806 C********************************************************************
0807 C********************************************************************
0808 C*
0809 C*  SUBROUTINE TO CHECK FOR C/FEE PAYMENT DUE THIS RUN
0810 C*
0811 C*  FPYDTR IS CALLED BY - FCLCDT
0812 C*
0813 C***********
0814 C           FPYDTR    BEGSR                           ** FPYDTR **
0815 C*
0816 C** CHECK COMMITMENT FEE DUE DATE
0817 C*
0818 C           DUDT      COMP 0                        70
0819 C*
0820 C  N70                GOTO DUDTNZ
0821 C*
0822 C** CHECK COMMITMENT FEE END DATE
0823 C*
0824 C           EDDT      COMP 0                        70
0825 C   70                SETOF                     19    NO C/FEE PT.DUE
0826 C   70                GOTO FPYDEN
0827 C*
0828 C** CHECK END DATE AGAINST EXTRACT DATE
0829 C*
0830 C           EDDT      COMP EXDT                 70
0831 C   70                SETOF                     19
0832 C   70                GOTO FPYDEN
0833 C*
0834 C** C/FEE PAYMENT DUE - SET INDICATOR AND PAYMENT DUE
0835 C*
0836 C                     SETON                     19
0837 C                     Z-ADDEDDT      PAYDAT  50
0838 C                     GOTO FPYDEN
0839 C*
0840 C           DUDTNZ    TAG                             ** DUDTNZ TAG *
0841 C*
0842 C** CHECK DUE DATE AGAINST EXTRACT DATE
0843 C*
0844 C           DUDT      COMP EXDT                 70
0845 C   70                SETOF                     19
0846 C  N70                SETON                     19
0847 C  N70                Z-ADDDUDT      PAYDAT
0848 C*
0849 C           FPYDEN    ENDSR                           ** FPYDEN **
0850 C*
0851 C********************************************************************
0852 C********************************************************************
0853 C*    SUBROUTINE TO PROCESS EVENT RECORD
0854 C*
0855 C*    EVENT IS CALLED BY - MAIN PROCESSING
0856 C*
0857 C*             CALLS - DRAWN;EXPSR;AVAIL;CONV
0858 C*
0859 C***********
0860 C           EVENT     BEGSR                           * EVENT BEGSR *
     C/COPY WNCPYSRC,LE0490C007
     C*                                                                   S01117
     C           IBRE      IFNE 'Y'                                       BHF627
     C*                                                                   BHF627
     C           PTP       IFNE '61'                                      S01117
     C           PTP       ANDNE'62'                                      S01117
     C           PTP       ANDNE'63'                                      S01117
     C           PTP       ANDNE'70'                                      S01117
     C*                                                                   S01117
     C** If customer is branch internal customer, then do not update      S01117
     C** facility availability. OR TOTAL DRAWN AMOUNT                     S01117
     C*                                                                   S01117
     C                     MOVE CNUM      W@CNUM  6                       S01117
     C*                                                                   S01117
     C***********CNUM      LOKUP@BCA                     50               S01117
     C           W@CNUM    LOKUP@BCA                     50               S01117
     C*                                                                   S01117
     C                     END                                            S01117
0861 C**
0862 C**   IF EVENT TYPE 'I2',I/O INDICATOR MUST BE BLANK
0863 C           ETP       COMP 'I2'                     70
0864 C   70      INOI      COMP ' '                      70
0865 C**
0866 C           ETP       COMP 'A1'                     72
0867 C**   OTHERWISE EVENT MUST BE A1,V1,R1,V3 OR M1
0868 C  N70N72   ETP       LOKUPTABVAL                   70
0869 C**
0870 C**   NOT 'A1' & > EXTRACT DATE IGNORE;'M1' & EVENT DATE = 0 IGNORE
0871 C  N72 70   EDAT      COMP EXDT                   7070
0872 C  N72 70   ETP       COMP 'M1'                     71
0873 C  N72 71 70EDAT      COMP 0                    70
0874 C**
0875 C**   EVENT DOES NOT QUALIFY - NO FURTHER PROCESSING
0876 C  N70N72             GOTO ENDEV1
0877 C**
0878 C**   CONVERT EVENT AMOUNTS TO FACILITY CURRENCY IF DIFF TO EVENT CCY
0879 C           FCCY      COMP ECCY                     71
0880 C                     EXSR CONV
0881 C   U7                GOTO ENDEV2
0882 C**
0883 C**   EVENT AFFECTS FCLTY AVAILABILITY & EXPOSURE - UPDATE DRAWN AMT
0884 C** NON- 'A1' EVENTS ONLY (TOTD UPDATED IN LE0460 FOR EVCD)
     C*                                                                   S01117
     C** ONLY IF EVENT IS NOT AN INTERBRANCH PARTICIPATION                S01117
     C*                                                                   S01117
     C           *IN50     IFEQ '0'                                       S01117
     C*                                                                   S01117
0885 C     N72             EXSR DRAWN
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
0886 C   U7                GOTO ENDEV2
0887 C**
0888 C**   UPDATE FACILITY EXPOSURE
0889 C                     EXSR EXPSR
0890 C**
0891 C**   UPDATE AVAILABILITY ARRAY
     C*                                                                   S01117
     C** ONLY IF EVENT IS NOT AN INTERBRANCH PARTICIPATION                S01117
     C*                                                                   S01117
     C           *IN50     IFEQ '0'                                       S01117
     C*                                                                   S01117
0892 C                     EXSR AVAIL
     C*                                                                   S01117
     C                     END                                            S01117
0893 C**
     C                     END                                            BHF627
0894 C**   OUTPUT EVENT JUST READ TO LVENT FILE
0895 C           ENDEV1    TAG                             ** ENDEV1 TAG**
0896 C     N72             SETON                     65
0897 C     N72             EXCPT
0898 C                     SETOF                     65
0899 C*
0900 C           ENDEV2    ENDSR                           ** ENDEV2 TAG**
0901 C********************************************************************
0902 C*    SUBROUTINE TO UPDATE AMOUNT ON WHICH C/FEES ARE CALCULATED
0903 C*
0904 C*    DRAWN IS CALLED BY - EVENT
0905 C*
0906 C*             CALLS - ACCRU
0907 C*
0908 C***********
0909 C           DRAWN     BEGSR                           * DRAWN BEGSR *
0910 C                     SETOF                     71
0911 C**
0912 C**   IF EVENT TYPE 'V1' & PROC.TYPE 66,67 OR 70 - IGNORE
0913 C           ETP       COMP 'V1'                     70
0914 C*
0915 C   70      PTP       COMP '66'                     71
0916 C   70N71   PTP       COMP '67'                     71
0917 C   70N71   PTP       COMP '70'                     71
0918 C**
0919 C**   OR IF C/FEE PROCESSING NOT REQUIRED - IGNORE
0920 C   70 71
0921 CORN41                GOTO ENDRWN
0922 C**
0923 C**   IF C/FEES CALCULATED ON FULL AMOUNT,EVENT TYPE NOT 'A1'-IGNORE
0924 C           CMFT      COMP 'F'                      70
0925 C   70                GOTO ENDRWN
0926 C**
0927 C**
0928 C**   EVENT TYPE NOT 'A1' - CALL SUBR. TO ACCRUE C/FEES
0929 C                     EXSR ACCRU
0930 C   U7                GOTO ENDRWN
0931 C**
0932 C**   ON UNDRAWN AMOUNT-'A1','R1'OR'M1' CHECK IF REVOLVING CREDIT
0933 C           ETP       COMP 'R1'                     70
0934 C  N70      ETP       COMP 'M1'                     70
0935 C   70      RVCR      COMP 'Y'                      71
0936 C**
0937 C**
0938 C**   'R1' & 'M1' & REVOLVING CREDIT - SUB EVENT AMT
0939 C   70 71   TOTD      SUB  EAMT      TOTD
0940 C   70                GOTO ENDRWN
0941 C**   REMAINING EVENTS - ADD EVENT AMT
0942 C           TOTD      ADD  EAMT      TOTD
0943 C*
0944 C           ENDRWN    ENDSR                           ** ENDRWN TAG**
0945 C********************************************************************
0946 C*    SUBROUTINE TO UPDATE FACILITY EXPOSURE AMOUNT
0947 C*
0948 C*    EXPSR IS CALLED BY - EVENT
0949 C*
0950 C***********
0951 C           EXPSR     BEGSR                           * EXPSR BEGSR *
0952 C**
0953 C**   'A1' EVENT BYPASS EVENT DATE CHECK
     C                     SETOF                         74
0954 C   72                GOTO PTCHK
0955 C**
0956 C**   IGNORE IF EVENT DATE > OR = NEXT WORKING DAY
0957 C           EDAT      COMP DNWD                 70  74
0958 C   70                GOTO ENDEXP
0959 C**
0960 C**   'V3' EVENT BYPASS PROC TYPE CHECK
0961 C           ETP       COMP 'V3'                     70
0962 C   70                GOTO EXPAD
0963 C**
0964 C**   IF PARTS SOLD,MUST BE WITHOUT RECOURSE
0965 C           PTCHK     TAG                             ** PTCHK TAG **
0966 C           PTP       COMP '66'                     70
0967 C  N70      PTP       COMP '67'                     70
0968 C   70      RCSI      COMP 'Y'                  7171
0969 C   70N71             GOTO ENDEXP
0970 C**
0971 C**   ADD EVENT AMT FOR 'R1' OR M1',ELSE SUBTRACT
0972 C   70      ETP       COMP 'R1'                     71
0973 C   70N71   ETP       COMP 'M1'                     71
0974 C*
0975 C   70 71   CAMD      ADD  EAMT      CAMD
0976 C   70N71   CAMD      SUB  EAMT      CAMD
0977 C*
     C**   SAVE EXPOSURE WITHOUT DNWD EVENTS FOR TODAYS DAILY REPORTS
     C   70 71N74PEXP      ADD  EAMT      PEXP
     C   70N71N74PEXP      SUB  EAMT      PEXP
     C*
0978 C   70                GOTO ENDEXP
0979 C**
0980 C**   NOT PARTS SOLD - SUBTRACT EVENT AMOUNT FOR'R1' OR'M1',ELSE ADD
0981 C           EXPAD     TAG                             ** EXPAD TAG **
0982 C           ETP       COMP 'R1'                     71
0983 C  N71      ETP       COMP 'M1'                     71
0984 C*
0985 C   71      CAMD      SUB  EAMT      CAMD
0986 C**N71******CAMD      ADD  EAMT      CAMD                            S01243
0983 C  N71      ETP       IFEQ 'V3'                       B1             S01243
     C  N71      PTP       IFEQ '66'                       B2             S01243
     C  N71      RCSI      IFEQ 'N'                        B3             S01243
     C           CAMD      SUB  EAMT      CAMD                            S01243
     C                     END                             E3             S01243
     C                     ELSE                                           S01243
     C           CAMD      ADD  EAMT      CAMD                            S01243
     C                     END                             E2             S01243
     C                     ELSE                                           S01243
     C           CAMD      ADD  EAMT      CAMD                            S01243
     C                     END                             E1             S01243
0987 C*
     C**   SAVE EXPOSURE WITHOUT DNWD EVENTS FOR TODAYS DAILY REPORTS
     C   71N74   PEXP      SUB  EAMT      PEXP
     C  N71N74   PEXP      ADD  EAMT      PEXP
     C*
0988 C           ENDEXP    ENDSR                           ** ENDEXP TAG**
0989 C********************************************************************
0990 C*    SUBROUTINE TO UPDATE THE AVAILABILITY ARRAY
0991 C*
0992 C*    AVAIL IS CALLED BY - EVENT
0993 C*
0994 C***********
0995 C           AVAIL     BEGSR                           * AVAIL BEGSR *
0996 C                     SETOF                     42
0997 C**
0998 C**   EVENT NOT 'A1',EVENT DATE > LAST DATE IN AVAIL ARRAY - IGNORE
0999 C  N72                Z-ADD1         Z       20
1000 C  N72      EDAT      LOKUPRUNS,Z               70  70
1001 C  N72N70             GOTO ENDAV
1002 C**
1003 C**   IS FACILITY OR COMMITMENT BEING PROCESSED ?
1004 C           FCTI      COMP 'C'                      73
1005 C**
1006 C**   PARTS SOLD & GUARANTEES MAY BE TREATED DIFFERENTLY
1007 C           PTP       COMP '66'                     70
1008 C  N70      PTP       COMP '67'                     70
1009 C   73N70   PTP       COMP '70'                     70
1010 C   70      ETP       COMP 'V3'                 7070
1011 C**
1012 C**   FOR 'A1','M1' & 'R1',ALSO DEPENDS ON REV.CREDIT INDICATOR
1013 C           ETP       COMP 'M1'                     71
1014 C  N71      ETP       COMP 'R1'                     71
1015 C   71
1016 COR 72      RVCR      COMP 'Y'                      74
1017 C**
1018 C**   'A1',NON-REV,CREDIT & NOT PARTS SOLD - USE ORIG PRINC
1019 C   72                Z-ADDEAMT      WRK13  130
1020 C   72N70N74          Z-ADDOTHA      WRK13
1021 C**
1022 C**   COMMITMENT,PARTS SOLD,NOT 'V3' NO UPDATING REQUIRED;
1023 C**   NON-REV CREDIT,'M1'OR'R1' UPDATING NOT REQUIRED.
1024 C**   FACILITY,NON-REV CREDIT,NOT PARTS SOLD,'M1' OR'R1' DONT UPDATE
1025 C   73 70
1026 COR 73N74 71          GOTO ENDAV
1027 C  N73N74N70
1028 CAN 71                GOTO ENDAV
     C**
     C**   DO NOT UPDATE IF PARTS SOLD WITH RECOURSE
     C           PTP       COMP '66'                     22
     C  N22      PTP       COMP '67'                     22
     C   22      RCSI      COMP 'Y'                      22
     C   22                GOTO ENDAV
1029 C**                                                                  S01243
     C**   DO NOT UPDATE IF PARTS SOLD                                    S01243
     C           PTP       IFEQ '66'                                      S01243
     C           PTP       OREQ '67'                                      S01243
     C***        RVCR      IFEQ 'N'                                       S01243
     C                     GOTO ENDAV                                     S01243
     C***                  END                                            S01243
     C                     END                                            S01243
1029 C**
1030 C**   FOR COMMITMENT,'M1'OR'R1' SUBTRACT AMNT
1031 C**   FACILITY-SUB IF'M1''R1',NOT PARTS SOLD, & REV CREDIT OR IF NOT
1032 C**   'M1' OR 'R1' & PARTS SOLD
1033 C  N73 71N70
2034 CAN 74                SETON                     42
1035 C  N73N71 70
1036 COR 73 71             SETON                     42
1037 C**
1038 C**   SET UP AMOUNT (ALREADY DONE FOR 'A1')
1039 C  N72                Z-ADDEAMT      WRK13
1040 C   42                Z-SUBWRK13     WRK13
1041 C**
     C*                                                                   S01117
1042 C**   UPDATE FACILITY AVAILABILITY ARRAY
1043 C   72                Z-ADD1         Z
1044 C           LOOP      TAG                             ** LOOP TAG **
1045 C           Z         COMP 11                     70
1046 C  N70                GOTO ENDAV
     C           ETP       COMP 'V3'                     45               S01243
1047 C******     OAM,Z     ADD  WRK13     OAM,Z                           S01243
1047 C  N45      OAM,Z     ADD  WRK13     OAM,Z                           S01243
     C   45      PTP       IFNE '66'                                      S01243
 047 C   45      OAM,Z     ADD  WRK13     OAM,Z                           S01243
     C*                    ELSE                                           S01243
     C*  45      RCSI      IFEQ 'N'                                       S01243
     C*          FCTI      ANDNE'C'                                       S01243
1047 C*          OAM,Z     ADD  WRK13     OAM,Z                           S01243
     C*                    END                                            S01243
     C                     END                                            S01243
1048 C*                                                                   S01243
1048 C*
1049 C           Z         ADD  1         Z
1050 C*
1051 C                     GOTO LOOP
1052 C*
1053 C           ENDAV     ENDSR                           ** ENDAV TAG **
1054 C********************************************************************
1055 C********************************************************************
1056 C*    SUBROUTINE TO ACCRUE COMMITMENT FEES
1057 C*
1058 C*    ACCRU IS CALLED BY - DRAWN
1059 C*
1060 C*             CALLS - FEEPAY;FEECLC
1061 C**
1062 C***********
1063 C           ACCRU     BEGSR                           * ACCRU BEGSR *
1064 C*
1065 C           PAYDUE    TAG                             ** PAYDUE TAG *
1066 C*
1067 C** CHECK IF A PAYMENT IS DUE THIS RUN
1068 C*
1069 C  N19                GOTO CLCFEE
1070 C*
1071 C** CHECK PAYMENT DATE AGAINST EVENT DATE
1072 C*
1073 C           PAYDAT    COMP EDAT                 70
1074 C   70                GOTO CLCFEE
1075 C*
1076 C** PERFORM C/FEE PAY'T PROCESSING AND UPDATE NEXT C/FEE PAY'T DATE
1077 C                     EXSR FEEPAY
1078 C   U7                GOTO ACCREN
1079 C*
1080 C** REPEAT PROCESSING SO FAR FOR NEW C/FEE PAY'T DATE
1081 C*
1082 C                     GOTO PAYDUE
1083 C*
1084 C           CLCFEE    TAG                             ** CLCFEE TAG *
1085 C*
1086 C** CALCULATE FEES FROM ACCR.CONT.DATE TO THIS ACTION
1087 C*
     C           EDAT      COMP ACCD                   7070
     C   70                GOTO ACCREN
     C*
1088 C                     Z-ADDACCD      ZIBEG
1089 C                     Z-ADDEDAT      ZIEND
1090 C*
1091 C                     EXSR FEECLC
1092 C*
1093 C**   UPDATE C/FEES ACCRUED TO CONTROL DATE
1094 C*
1095 C           ADNP      ADD  FEE       ADNP
1096 C*
1097 C** RESET C/FEE ACCRUAL CONTROL DATE
1098 C*
1099 C                     Z-ADDEDAT      ACCD
1100 C*
1101 C           ACCREN    ENDSR                           ** ACCREN TAG**
1102 C*
1103 C********************************************************************
1104 C********************************************************************
1105 C*    SUBROUTINE TO CALCULATE C/FEE AMOUNTS
1106 C*
1107 C*    FEECLC IS CALLED BY - ACCRU;FEEPAY
1108 C*
1109 C***********
1110 C           FEECLC    BEGSR                           * FEECLC BEGSR*
1111 C*
1112 C** CALCULATE UNDRAWN AMOUNT
1113 C*
     C**TOTD IS NOW MAINTAINED FOR ALL FACILITIES REGARDLESS OF C/FEE TYPE
     C           CMFT      COMP 'U'                      70
     C   70      FAMT      SUB  TOTD      ZIAMT
     C  N70                Z-ADDFAMT      ZIAMT
     C           ZIAMT     COMP 0                      70
1115 C   70                Z-ADD0         FEE              FCLTY OVERDRAWN
1116 C   70                GOTO FEECEN
1117 C*
1118 C** CALCULATE FEE
1119 C*
1120 C                     Z-ADDCALC      ZICALC
     C/COPY WNCPYSRC,LE0490C008
1121 C                     EXSR GLINTC
     C/COPY WNCPYSRC,LE0490C009
     C                     Z-ADDZINTR     FEE    132
1123 C*
1124 C           FEECEN    ENDSR                           ** FEECEN TAG**
1125 C*
1126 C********************************************************************
1127 C********************************************************************
1128 C*    SUBROUTINE TO PROCESS COMMITMENT FEE PAYMENTS
1129 C*
1130 C*    FEEPAY IS CALLED BY - ACCRU
1131 C*
1132 C*              CALLS - FEECLC;FPYDTR;FORMAT;GLZADD;RTLX;CBILL;
1133 C***********     ZFREQB;ZDATE5                                       S01195
1133 C*               FREQB;ZFWDT                                         S01195
1134 C*
1135 C***********
1136 C           FEEPAY    BEGSR                           * FEEPAY BEGSR*
1137 C*
1138 C** CALCULATE FEES FROM ACCR.CONT.DATE TO C/FEE PAY'T DATE
1139 C*
1140 C                     Z-ADDACCD      ZIBEG
1141 C                     Z-ADDPAYDAT    ZIEND
1142 C                     EXSR FEECLC
1143 C*
1144 C** UPDATE C/FEES ACCRUED TO CONTROL DATE
1145 C*
1146 C           ADNP      ADD  FEE       ADNP
1147 C*
1148 C** CALCULATE FEES NOW DUE
1149 C*
     C           ADNP      ADD  ADJP      TOTDUE 130H
1151 C           TOTDUE    ADD  ADJN      TOTDUE           TOTAL FEES DUE
1152 C*
1153 C           TOTDUE    SUB  PDTD      CFAMT  130       SUBT.FEES PAID
1154 C*
1155 C** ADD FEE DUE TO C/FEES PAID TO DATE
1156 C           PDTD      ADD  CFAMT     PDTD
1157 C**
1158 C**   FORMAT OUTPUT FIELDS FOR EVENT RECORD
1159 C                     EXSR FORMAT
1160 C   U7                SETOF                     19
1161 C   U7                GOTO FEEPEN
1162 C**
1163 C**   OUTPUT C/FEE EVENT
      **                                                                  S01117
     C           SETP      IFEQ 0                                                             244516
     C                     MOVE *BLANKS   FACO                                                244516
     C                     ENDIF                                                              244516
     C                     MOVE CNUMF     EVCNUM  6                       S01117
     C***********          MOVE BRCA      EBRC    3                 S01117BHF369
     C                     MOVE BRCAF     EBRC    3                       BHF369
     C                     MOVE FCMPY     ECPY    3                       S01117
     C                     MOVE 'N'       IBRE    1                       S01117
     C                     MOVE 'Y'       ICYE    1                       S01117
     C                     MOVE 'I'       INOUT   1                       S01117
     C*                                                                   S01117
1164 C                     SETON                     62
1165 C                     EXCPT
1166 C                     SETOF                     62
      **                                                                  S01117
      **   RECORDS OUTPUT WHEN BOOKING BRANCH <> SETTLEMENT BRANCH        S01117
      **    INCREASE THE HASH TOTAL ALSO                                  S01117
      **                                                                  S01117
     C           CFBR      IFNE *BLANKS                                   S01117
     C***********CFBR      ANDNEBRCA                                S01117BHF369
     C           CFBR      ANDNEBRCAF                                     BHF369
     C           INOUT     ANDNE*BLANKS                                   S01117
      **                                                                  S01117
      **   PERFORM RECORD COUNT & HASH TOTALS FOR EXTRA MULTIBRANCHING    S01117
      **   EVENT ENTRIES                                                  S01117
     C           CONT22    ADD  2         CONT22                          S01117
     C                     Z-ADDTOTI22    ZZTOTI                          S01117
     C                     Z-ADDTOTD22    ZZTOTD                          S01117
      **   ENTRY #1                                                       S01117
      **   IF AMOUNT IS NEGATIVE,REVERSE SIGN                             S01117
     C           CFAMT     DIV  1000      ZZAMT        71                 S01117
     C   71                Z-SUBZZAMT     ZZAMT                           S01117
     C                     EXSR GLZADD                                    S01117
      **   ENTRY #2                                                       S01117
      **   IF AMOUNT IS NEGATIVE,REVERSE SIGN                             S01117
     C           CFAMT     DIV  1000      ZZAMT        71                 S01117
     C   71                Z-SUBZZAMT     ZZAMT                           S01117
     C                     EXSR GLZADD                                    S01117
      *                                                                   S01117
     C                     Z-ADDZZTOTI    TOTI22 150                      S01117
     C                     Z-ADDZZTOTD    TOTD22  30                      S01117
      **                                                                  S01117
      **  OUTPUT INTER-BRANCH EVENT #1                                    S01117
     C                     MOVE CNUMF     EVCNUM                          S01117
     C                     MOVE CFBR      EBRC                            S01117
     C                     MOVE SBCMPY    ECPY                            S01117
     C                     MOVE 'Y'       IBRE                            S01117
      *                                                                   S01117
     C           FCMPY     IFEQ SBCMPY                                    S01117
     C                     MOVE 'N'       ICYE                            S01117
     C                     ELSE                                           S01117
     C                     MOVE 'Y'       ICYE                            S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     SETON                     62                   S01117
     C                     EXCPT                                          S01117
     C                     SETOF                     62                   S01117
      **                                                                  S01117
      **  OUTPUT INTER-BRANCH EVENT #2                                    S01117
     C                     MOVE FBICN     EVCNUM                          S01117
      *                                                                   S01117
     C           INOUT     IFEQ 'I'                                       S01117
     C                     MOVE 'O'       INOUT                           S01117
     C                     ELSE                                           S01117
     C                     MOVE 'I'       INOUT                           S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     SETON                     62                   S01117
     C                     EXCPT                                          S01117
     C                     SETOF                     62                   S01117
      *                                                                   S01117
     C                     END                                            S01117
1167 C**
1168 C**   MAINTAIN RUN CONTROLS OF NEW EVENTS OUTPUT
1169 C***********CONT22    ADD  1         CONT22  50                      111489
1169 C           CONT22    ADD  1         CONT22  90                      111489
1170 C           CFAMT     DIV  1000      ZZAMT        71
     C   71                Z-SUBZZAMT     ZZAMT
1171 C                     Z-ADDTOTI22    ZZTOTI
1172 C                     Z-ADDTOTD22    ZZTOTD
1173 C*
1174 C                     EXSR GLZADD
1175 C*
1176 C                     Z-ADDZZTOTI    TOTI22 150
1177 C                     Z-ADDZZTOTD    TOTD22  30
1178 C**
1179 C**   OUTPUT C/FEE RECEIVE TELEX
1180 C                     EXSR RTLX
1181 C   U7                SETOF                     19
1182 C   U7                GOTO FEEPEN
1183 C**
1184 C**   OUTPUT C/FEE CUSTOMER BILL
1185 C                     EXSR CBILL
1186 C**
1187 C**   UPDATE ACCR/CONT/DATE WITH THIS PAY DATE
1188 C                     Z-ADDPAYDAT    ACCD
1189 C*
1190 C** UPDATE PAYMENT DATE
1191 C*
1192 C** CHECK IF END DATE JUST PROCESSED
1193 C*
1194 C           PAYDAT    COMP EDDT                     70
1195 C   70                SETOF                     19    NO C/FEE PT DUE
1196 C   70                GOTO FEEPEN
1197 C*
1198 C** CALCULATE NEXT C/FEE PAYMENT DATE
1199 C*
1200 C** CHECK PAYMENT FREQUENCY
1201 C*
1202 C           BLFR      COMP ' '                      70
1203 C   70                Z-ADD0         DUDT
1204 C   70                GOTO PYTRUN
1205 C*
1206 C** SET UP FIELDS FOR SUBROUTINE
1207 C*
1208 C                     Z-ADDPAYDAT    ZDAYNO
1209 C                     MOVE BLFR      ZFREQ
1210 C                     MOVE FCCY      ZCCY
1211 C                     Z-ADDBLDN      ZMDAY
     C*                                                                   S01195
     C                     Z-ADDSETT      W@STLL                          S01195
     C                     MOVELOBAC      W@OUR                           S01195
     C                     EXSR SETLOC                                    S01195
     C                     MOVE W@STBL    ZLOC                            S01195
     C*                                                                   S01195
1212 C***********          EXSR ZFREQB                                    S01195
1213 C***********          EXSR ZDATE5                                    S01195
     C                     EXSR FREQB                                     S01195
     C                     Z-ADD0         ZNRDYS                          S01195
     C                     EXSR ZFWDT                                     S01195
1214 C*
1215 C                     Z-ADDZDYNBR    DUDT             NEXT PAY'T DATE
1216 C*
1217 C** CHECK NEXT PAYMENT DATE AGAINST END DATE
1218 C*
1219 C           DUDT      COMP EDDT                   70
1220 C   70                GOTO PYTRUN
1221 C*
1222 C** NEXT PAYMENT DATE IS BEYOND END DATE - SET TO ZERO
1223 C*
1224 C                     Z-ADD0         DUDT
1225 C*
1226 C           PYTRUN    TAG                             ** PYTRUN TAG**
1227 C*
1228 C** CHECK IF PAYMENT DUE THIS RUN
1229 C*
1230 C                     EXSR FPYDTR
1231 C*
1232 C           FEEPEN    ENDSR                           ** FEEPEN TAG**
1233 C*
1234 C********************************************************************
1235 C********************************************************************
1236 C*    SUBROUTINE TO ACCESS FIELDS FOR OUTPUT TO LVENT
1237 C*
1238 C*    FORMAT IS CALLED BY - FEEPAY
1239 C*
1240 C***************CALLS*-*TABCHN;CLCHN*****                            S01194
1240 C*              CALLS - NOTHING                                      S01194
1241 C*
1242 C***********
1243 C           FORMAT    BEGSR                           * FORMAT BEGSR*
1244 C**
1245 C**   CALCULATE BASE CURRENCY EQUIVALENT
1246 C*******    FMDI      COMP 0                        70               S01194
1246 C           FMDI      COMP 'D'                      70               S01194
1247 C   70      CFAMT     DIV  FSPT      DBCE
1248 C  N70      CFAMT     MULT FSPT      DBCE
1249 C**
1250 C**   SET UP THE FULL INSTRUCTIONS INDICATOR
1251 C           SETT      COMP 0                        70
1252 C     N70   SETT      COMP 1                        71
1253 C     N70N71SETT      COMP 7                        71
1254 C     N70N71SETT      COMP 8                        71
1255 C   71 20
1256 COR 71 21             SETON                     70
1257 C     N70   SETT      COMP 5                        71
1258 C     N70N71SETT      COMP 14                       71
1259 C     N70N71SETT      COMP 2                        71
1260 C     N70N71SETT      COMP 12                       71
1261 C  N70 71 20          SETON                     70
1262 C*
1263 C   70                MOVE 'N'       FINI    1
1264 C  N70                MOVE 'Y'       FINI
1265 C**
1266 C**   ACCESS CLIENT MASTER FILE FOR CUSTOMER DETAILS
1267 C**********           MOVELCNUMF     CLKEY   7                       S01194
1268 C**********           MOVE 'A'       CLKEY                           S01194
1269 C**********                                                          S01194
1270 C**********           EXSR CLCHN                                     S01194
     C                     MOVELCNUMF     CKEY                            S01194
     C                     CALL 'AOCUSTR0'PLIST3                          S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVE CKEY      DBKEY                           S01194
     C                     MOVE 'SDCUSTPD'DBFILE           ***************S01194
     C                     MOVE '05'      DBASE            ***   05    ***S01194
     C                     SETON                     U7U8LR***************S01194
     C                     GOTO ENDFOR                                    S01194
     C                     END                                            S01194
1271 C*
1272 C***U7*****           MOVE CLKEY     DBKEY            ***************S01194
1273 C***U7*****           MOVE '05'      DBASE            ***   05    ***S01194
1274 C***U7*****           GOTO ENDFOR                     ***************S01194
1275 C*
1276 C**********           TESTB'2'       CMIN           70               S01194
     C           BBPAIN    COMP 'P'                      70               S01194
1277 C                     Z-ADD1         PARI
1278 C  N70                Z-ADD0         PARI
     C                     MOVELBBPCNB    CPAR                            S01194
     C                     MOVELBBCRNM    CRNM                            S01194
     C                     MOVELBBCRTN    CTWN                            S01194
     C                     MOVELBBCASC    CASK                            S01194
1279 C**********           MOVE CPAR      CCPAR   60                                          CSD027
1279 C                     MOVE CPAR      CCPAR   6                                           CSD027
1280 C                     MOVE CRNM      CCRNM  20
1281 C                     MOVE CTWN      CCTWN  10
1282 C                     MOVE CASK      CCASK   8
1283 C**
1284 C**   ACCESS COUNTRIES RECORD FOR REGION OF RISK
1285 C**********           MOVEL'50'      TABKEY                          S01194
1286 C**********           MOVE CRSKF     TABKEY                          S01194
1287 C**********                                                          S01194
1288 C**********           EXSR TABCHN                                    S01194
1286 C                     MOVE CRSKF     CTKEY                           S01194
     C                     CALL 'AOCTRYR0'PLIST2                          S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
1290 C                     MOVE CTKEY     DBKEY                           S01194
1290 C                     MOVE 'SDCTRYPD'DBFILE           ***************S01194
1291 C                     MOVE '06'      DBASE            ***   06    ***S01194
     C                     SETON                     U7U8LR***************S01194
1292 C                     GOTO ENDFOR                                    S01194
     C                     END                                            S01194
1289 C*
1290 C***U7*****           MOVE TABKEY    DBKEY            ***************S01194
1291 C***U7*****           MOVE '06'      DBASE            ***   06    ***S01194
1292 C***U7*****           GOTO ENDFOR                     ***************S01194
1293 C                     MOVE REGC      RRSK    2
1294 C**
1295 C**   ACCESS COUNTRY OF DOMICILE
1296 C**********           MOVE NACD      CLKEY                           S01194
1297 C**********                                                          S01194
1298 C**********           EXSR CLCHN                                     S01194
     C* CHECK VALUE OF ALTERNATE NAME & ADDRESS CODE IS NOT EQUAL TO 'B'  LN0007
     C* IFEQ 'B' BYPASS ALTERNATE NAME & ADDRESS VALIDATION               LN0007
     C           NACD      IFNE 'B'                                       LN0007
     C*                                                                   LN0007
1296 C                     MOVELCNUMF     AENB                            S01194
1296 C                     MOVE NACD      AZCD                            S01194
     C***********          CALL 'AOALTNPD'PLIST4                          LN0305
     C                     CALL 'AOALTNR0'PLIST4                          LN0305
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVELCNUMF     DBKEY                           S01194
     C                     MOVE NACD      DBKEY                           S01194
     C                     MOVE 'SDALTNPD'DBFILE           ***************S01194
     C                     MOVE '07'      DBASE            ***   07    ***S01194
     C                     SETON                     U7U8LR***************S01194
     C                     GOTO ENDFOR                                    S01194
     C                     END                                            S01194
     C                     END                                            LN0007
1299 C*                                                                   LN0007
1300 C***U7*****           MOVE CLKEY     DBKEY            ***************S01194
1301 C***U7*****           MOVE '07'      DBASE            ***   07    ***S01194
1302 C***U7*****           GOTO ENDFOR                     ***************S01194
1303 C                     MOVE CLOC      CDOM
1304 C**
1305 C**   ACCESS PARENT DETAILS
     C                     MOVELBBPCNB    CPAR                            S01194
1306 C********** CPAR      COMP 0                        35                                   CSD027
1306 C           CPAR      COMP *BLANKS                  35                                   CSD027
1307 C         35          MOVE BLANKS    CRNM
1308 C         35          MOVE BLANKS    CTWN
1309 C         35          MOVE BLANKS    CASK
1310 C********N35          MOVELCPAR      CLKEY                           S01194
1311 C********N35          MOVE 'A'       CLKEY                           S01194
1312 C**********                                                          S01194
1313 C********N35          EXSR CLCHN                                     S01194
     C           *IN35     IFEQ '0'                                       S01194
1296 C                     MOVELCPAR      CKEY                            S01194
     C                     CALL 'AOCUSTR0'PLIST3                          S01194
     C                     MOVELBBCRNM    CRNM                            S01194
     C                     MOVELBBCRTN    CTWN                            S01194
     C                     MOVELBBCASC    CASK                            S01194
     C                     END                                            S01194
1314 C*
1312 C**   CLOC MOVED TO CDOM ONLY IF CLIENT HAS PARENT , CDOM IS         E12849
1318 C**   BLANK FOR CLIENT AND CLOC CONTAINS ENTRY FROM PARENT.          E12849
1314 C**                                                                  E12849
1312 C           *IN35     IFEQ '0'                                       E12849
1318 C           CDOM      IFEQ ' '                                       E12849
1314 C           CLOC      IFNE ' '                                       E12849
1314 C                     MOVE CLOC      CDOM                            E12849
1312 C                     END                                            E12849
1318 C                     END                                            E12849
1314 C                     END                                            E12849
     C**
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVE CKEY      DBKEY                           S01194
     C                     MOVE 'SDCUSTPD'DBFILE           ***************S01194
     C                     MOVE '08'      DBASE            ***   08    ***S01194
     C                     SETON                     U7U8LR***************S01194
     C                     GOTO ENDFOR                                    S01194
     C                     END                                            S01194
1314 C**                                                                  S01194
1315 C***U7*****           MOVE CLKEY     DBKEY            ***************S01194
1316 C***U7*****           MOVE '08'      DBASE            ***   08    ***S01194
1317 C***U7*****           GOTO ENDFOR                     ***************S01194
1318 C**
1319 C**   ACCESS COUNTRIES RECORD FOR REGION OF DOMICILE
1320 C**********           MOVEL'50'      TABKEY                          S01194
1321 C**********           MOVE CDOM      TABKEY                          S01194
1322 C**********                                                          S01194
1323 C**********           EXSR TABCHN                                    S01194
1321 C                     MOVE CDOM      CTKEY                           S01194
     C                     CALL 'AOCTRYR0'PLIST2                          S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     MOVE CTKEY     DBKEY                           S01194
     C                     MOVE 'SDCTRYPD'DBFILE           ***************S01194
     C                     MOVE '09'      DBASE            ***   09    ***S01194
     C                     SETON                     U7U8LR***************S01194
     C                     GOTO ENDFOR                                    S01194
     C                     END                                            S01194
1324 C*
1325 C***U7*****           MOVE TABKEY    DBKEY            ***************S01194
1326 C***U7*****           MOVE '09'      DBASE            ***   09    ***S01194
1327 C***U7*****           GOTO ENDFOR                     ***************S01194
     C                     MOVELA4RGCD    REGC                            S01194
1328 C                     MOVE REGC      RDOM    2
     C**                                                                  S01117
     C*** ACCESS THE BRANCH INFORMATION FOR FACILITY BRANCH               S01117
     C**                                                                  S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C***********          PARM BRCA      @DSNB   3                 S01117BHF369
     C                     PARM BRCAF     @DSNB   3                       BHF369
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL@DSNB     DBKEY                           S01117
     C                     MOVEL'SDBRCHPD'DBFILE           ***************S01117
     C                     Z-ADD24        DBASE            * DBERROR 024 *S01117
     C                     SETON                     U7U8LR***************S01117
     C                     GOTO ENDFOR                                    S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     MOVE CMPYM     FCMPY   3                       S01117
     C                     MOVE BICN      FBICN   6                       S01117
      **                                                                  S01117
      **  ACCESS THE BRANCH INFORMATION OF THE SETTLEMENT BRANCH          S01117
      **  IF THE BOOKING BRANCH <> SETTLEMENT BRANCH AND THE              S01117
      **  SETTLEMENT BRANCH IS NON-BLANK                                  S01117
      **                                                                  S01117
     C           CFBR      IFNE *BLANKS                                   S01117
     C***********CFBR      ANDNEBRCA                                S01117BHF369
     C           CFBR      ANDNEBRCAF                                     BHF369
      *                                                                   S01117
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM CFBR      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL@DSNB     DBKEY                           S01117
     C                     MOVEL'SDBRCHPD'DBFILE           ***************S01117
     C                     Z-ADD25        DBASE            * DBERROR 025 *S01117
     C                     SETON                     U7U8LR***************S01117
     C                     GOTO ENDFOR                                    S01117
     C                     END                                            S01117
      *                                                                   S01117
     C                     MOVE CMPYM     SBCMPY  3                       S01117
      *                                                                   S01117
     C                     END                                            S01117
1329 C**
1330 C**   IF EVENT DATE = DUE DATE USE FCLTY FREQ,ELSE BLANK
1331 C           PAYDAT    COMP EDDT                     70
1332 C   70                MOVE BLFR      FREQ    1
1333 C  N70                MOVE ' '       FREQ
1334 C*
1335 C           ENDFOR    ENDSR                           ** ENDFOR TAG**
1336 C********************************************************************
1337 C*    SUBROUTINE TO OUTPUT C/FEE CUSTOMER BILL
1338 C*
1339 C*    CBILL IS CALLED BY - FEEPAY
1340 C*
1341 C***********
1342 C           CBILL     BEGSR                           * CBILL BEGSR *
1343 C**
1344 C**   IF PAYMENT DATE > BILLING EXTRACT DATE,IGNORE
1345 C           PAYDAT    COMP BDAYS                70
1346 C   70                GOTO ENBILL
1347 C**
1348 C**   IS PAYMENT FOR DUE OR END DATE
1349 C           PAYDAT    COMP EDDT                     70
1350 C**
1351 C**   CHECK RELEVANT BILL INDICATOR-IF ON DO NOT PRODUCE BILL
1352 C  N70                TESTB'2'       BITS       71
1353 C   70                TESTB'3'       BITS       71
1354 C*
1355 C  N71                GOTO ENBILL
1356 C**
1357 C**   OUTPUT RECORD TO CUTX2
1358 C                     SETON                     63
1359 C                     EXCPT
1360 C                     SETOF                     63
1361 C**
1362 C**   UPDATE CUSTOMER BILL INDICATORS
1363 C  N70                BITON'2'       BITS
1364 C   70                BITON'3'       BITS
1365 C**
1366 C**   KEEP COUNT OF RECORDS OUTPUT FOR FILE CONTROLS
1367 C           COUNT3    ADD  1         COUNT3  50
1368 C*
1369 C           ENBILL    ENDSR                           ** ENBILL TAG**
1370 C********************************************************************
1371 C*    SUBROUTINE TO OUTPUT C/FEE RECEIVE TELEX
1372 C*
1373 C*    RTLX IS CALLED BY - FEEPAY
1374 C*
1375 C*            CALLS - TABCHN
1376 C***********
1377 C           RTLX      BEGSR                           * RTLX BEGSR  *
1378 C**
1379 C**   IF PAYDAT > TELEX EXTRACT DATE,IGNORE
1380 C           PAYDAT    COMP TXDT                 70
1381 C   70                GOTO ENRTLX
1382 C**
1383 C**   IS PAYMENT FOR DUE OR END DATE
1384 C           PAYDAT    COMP EDDT                     70
1385 C**
1386 C**   CHECK RELEVANT TELEX INDICATOR-IF ON,DO NOT PRODUCE TELEX
1387 C   70                TESTB'1'       BITS       71
1388 C  N70                TESTB'0'       BITS       71
1389 C*
1390 C  N71                GOTO ENRTLX
1391 C**
1392 C**   GET LOAN/FCLTY REF & BANK OWN NUMBER TO OUTPUT TO TELEX RECORD
1393 C                     MOVELFACT      PART5   5
1394 C                     MOVE FCNO      PART5
1395 C********             MOVEL'F'       FCLN    6                                           CLE148
1395 C                     MOVEL' '       FCLN    6                                           CLE148
1396 C                     MOVE PART5     FCLN
1397 C*
1398 C***********          MOVEL'10'      TABKEY                          S01117
1399 C***********          MOVE BRCDF     TABKEY                          S01117
1400 C***********                                                         S01117
1401 C***********          EXSR TABCHN                                    S01117
1402 C***********                                          ***************S01117
1403 C***U7******          MOVE '04'      DBASE            ***   04    ***S01117
1404 C***U7******          GOTO ENRTLX                     ***************S01117
1405 C**
1406 C**   OUTPUT RECORD TO CFTLX
1407 C                     SETON                     64
1408 C                     EXCPT
1409 C                     SETOF                     64
1410 C**
1411 C**   UPDATE TELEX INDICATORS
1412 C   70                BITON'1'       BITS
1413 C  N70                BITON'0'       BITS
1414 C**
1415 C**   MAINTAIN COUNT & HASH TOTAL OF RECORDS OUTPUT
1416 C           COUNT4    ADD  1         COUNT4  50
1417 C           CFAMT     DIV  1000      ZZAMT
1418 C                     Z-ADDTOTI4     ZZTOTI
1419 C                     Z-ADDTOTD4     ZZTOTD
1420 C*
1421 C                     EXSR GLZADD
1422 C*
1423 C                     Z-ADDZZTOTI    TOTI4  150
1424 C                     Z-ADDZZTOTD    TOTD4   30
1425 C*
1426 C           ENRTLX    ENDSR                           ** ENRTLX TAG**
1427 C********************************************************************
1428 C*    SUBROUTINE TO CARRY OUT TOTAL TIME PROCESSING
1429 C*
1430 C*    LEVEL IS CALLED BY - MAIN PROCESSING
1431 C*
1432 C*             CALLS - FEEPAY
1433 C***********
1434 C           LEVEL     BEGSR                           * LEVEL BEGSR *
1435 C**
1436 C**   EVENT TO BE PRODUCED BY FCLTY - GET CURRENCY DETAILS
1437 C                     SETOF                     71
1438 C  N75 19             SETON                     71
1439 C   71                EXSR CONV
1440 C   U7                GOTO ENLEV
1441 C**
1442 C**   IF FACILITY IS LIVE OR CLOSED,& PAYMENT DUE PERFORM C/FEE PROC.
1443 C           LOOPA     TAG                             ** LOOPA TAG **
1444 C  N75 19             EXSR FEEPAY
1445 C*
1446 C  N75 19             GOTO LOOPA
1447 C**
1448 C**   OUTPUT FCLTY 'A' & 'B' RECORDS TO S/NFACL
     C**
     C/COPY WNCPYSRC,LE0490C010
     C                     EXSR AVFIN
     C/COPY WNCPYSRC,LE0490C011
     C**
1449 C                     SETON                     60
1450 C                     EXCPT
1451 C                     SETOF                     60
1452 C*
1453 C           ENLEV     ENDSR                           ** ENLEV TAG **
1454 C********************************************************************
     C********************************************************************
     C/COPY WNCPYSRC,LE0490C012
     C*    SUBROUTINE TO DO TOTAL TIME PROCESSING OF THE AVAIL ARRAY
     C*
     C*    AVFIN IS CALLED BY - LEVEL
     C*
     C*             CALLS - NONE
     C**
     C           AVFIN     BEGSR                           * AVFIN BEGSR *
     C*
     C** AVAILABILITY ARRAYS FOR NON-REVOLVING CREDIT FACILITIES
     C** NEED TO BE ADJUSTED TO REFLECT LOANS MATURED TO DATE
     C*
     C                     Z-ADD1         Z
     C           RVCR      COMP 'Y'                      70
     C   70                GOTO LOOPN
     C*
     C** CTOTD IS THE TOTAL DRAWN AMOUNT UP TO THE EVCD
     C           CTOTD     SUB  OAM,1     WRK130 130   70
     C   70                Z-ADD0         WRK130
     C*
     C           OAM       ADD  WRK130    OAM
     C*
     C           LOOPN     TAG                             *  LOOPN TAG  *
     C*
     C** UPDATE AVAILABILITY TO REFLECT FORTHCOMING OR PRIOR EXPIRY
     C*
     C           DTEX      COMP RUNS,Z                 7070
     C   70                Z-ADDFAMT      OAM,Z
     C           Z         ADD  1         Z
     C           Z         COMP 10                     7070
     C   70                GOTO LOOPN
     C*
     C                     ENDSR
     C********************************************************************
     C/COPY WNCPYSRC,LE0490C013
1455 C*****SUBROUTINE*TO*ACCESS*TABLE*FILE*                               S01194
1456 C************                                                        S01194
1457 C*****TABCHN*IS*CALLED BY - FORMAT;RTLX;FCLPDT;FIRST;                S01194
1458 C************                                                        S01194
1459 C***********                                                         S01194
1460 C********** TABCHN    BEGSR                           * TABCHN BEGSR*S01194
1461 C********** TABKEY    CHAINTABLE                31                   S01194
1462 C**N31***** RECI      COMP 'D'                  3131                 S01194
1463 C**********                                                          S01194
1464 C***31*****           MOVE 'TABLE'   DBFILE                          S01194
1465 C***31*****           MOVE TABKEY    DBKEY                           S01194
1466 C***31*****           SETON                     U7U8LR               S01194
1467 C***31*****           GOTO ENDTAB                                    S01194
1468 C************                                                        S01194
1469 C*****BLANK OUT KEY AFTER CHAIN                                      S01194
1470 C**********           MOVE '        'TABKEY                          S01194
1471 C**********           MOVEL'    '    TABKEY                          S01194
1472 C**********                                                          S01194
1473 C********** ENDTAB    ENDSR                           ** ENDTAB TAG**S01194
1474 C********************************************************************
1475 C****CLCHN*--*A*SUB-ROUTINE*TO*ACCESS*THE*CLINT*FILE                 S01194
1476 C**********                                                          S01194
1477 C*****CLCHN*IS*CALLED*BY*-*FORMAT;                                   S01194
1478 C**********                                                          S01194
1479 C***********
1480 C********** CLCHN     BEGSR                           * CLCHN BEGSR *S01194
1481 C**********                                                          S01194
1482 C**********           SETOF                     3110                 S01194
1483 C********** CLKEY     CHAINCLINT                31                   S01194
1484 C**********                                                          S01194
1485 C**N10*****           SETON                     U7U8LR               S01194
1486 C**N10*****           MOVE 'CLINT'   DBFILE                          S01194
1487 C**N10*****           MOVE CLKEY     DBKEY                           S01194
1488 C**********                                                          S01194
1489 C**********           ENDSR                           ***  ENDSR  ***S01194
1490 C**
1491 C********************************************************************
     C/SPACE 3                                                            S01195
     C********************************************************************S01195
     C**  SETLOC - A SUB-ROUTINE TO ACCESS THE NOSTRO FILE                S01195
     C*                                                                   S01195
     C*   SETLOC IS CALLED BY - FCLPDT, FEEPAY;                           S01195
     C*                                                                   S01195
     C***********                                                         S01195
     C           SETLOC    BEGSR                           ***  SETLOC ***S01195
      *                                                                   S01195
      ** INITIALIZE WORKING VARIABLE - SETTLEMENT BRANCH LOCATION         S01195
      *                                                                   S01195
     C           *LIKE     DEFN NRLC      W@STBL                          S01195
     C                     MOVE *BLANKS   W@STBL                          S01195
     C                     Z-ADDW@STLL    W@STLL  20                      S01195
     C**********           MOVELW@OUR     W@OUR  12                                    S01195 CGL029
     C                     MOVELW@OUR     W@OUR  18                                           CGL029
      *                                                                   S01195
      ** FOR TYPE 01,02,07,08 OR 12, SETTLEMENT LOCATION IS DETERMINED    S01195
      ** BY THE NOSTRO BRANCH.                                            S01195
      *                                                                   S01195
     C           W@STLL    IFEQ 01                         *B1            S01195
     C           W@STLL    OREQ 02                                        S01195
     C           W@STLL    OREQ 07                                        S01195
     C           W@STLL    OREQ 08                                        S01195
     C           W@STLL    OREQ 12                                        S01195
      *                                                                   S01195
     C                     CALL 'AONOSTR0'                                S01195
     C                     PARM '*MSG   ' @RTCD   7                       S01195
     C                     PARM '*KEY   ' @OPTN   7                       S01195
     C                     PARM *BLANKS   @KEYA   6                       S01195
     C                     PARM FCCY      @KEYB   3                       S01195
     C**********           PARM *BLANKS   @KEYC   4                                    S01195 CGL029
     C                     PARM *BLANKS   @KEYC  10                                           CGL029
     C                     PARM *BLANKS   @KEYD   2                       S01195
     C                     PARM W@OUR     @KEYE   2                       S01195
     C                     PARM *BLANKS   @BRCD   3                       S01194
     C                     PARM *BLANKS   CSSN   10                       S01194
     C                     PARM *BLANKS   PNOI    1                       S01194
     C           SDNOST    PARM SDNOST    DSFDY                           S01195
     C           @RTCD     IFEQ *BLANKS                                   S01195
      **                                                                  S01195
      *    MOVE THE LAST 3 CHARACTERS OF CUSTOMER SHORT CODE (WHICH       S01195
      *    IS THE LOCATION CODE) TO START LOCATION CODE FIELD             S01195
      **                                                                  S01195
     C                     MOVE CSNM      DSCSNM                          S01195
     C                     MOVE NRLC      W@STBL                          S01195
     C                     END                                            S01195
      *                                                                   S01195
     C                     END                             *E1            S01195
      *                                                                   S01195
     C           SETRTN    ENDSR                           *** SETRTN *** S01195
     C********************************************************************S01195
     C/SPACE 3                                                            S01195
     C********************************************************************S01195
1492 C*    SUBROUTINE TO CONVERT EVENT AMOUNTS TO FACILITY CURRENCY
1493 C*
1494 C*    CONV IS CALLED BY - EVENT;LEVEL
1495 C*
1496 C***********
1497 C           CONV      BEGSR                           * CONV BEGSR  *
1498 C*
     C/COPY WNCPYSRC,LE0490C016
1499 C                     Z-ADD1         X
1500 C           FCCY      LOKUPCURR,X                   70
1501 C  N70                MOVE FCCY      CCYERR  3
1502 C  N70                GOTO ERROR
1503 C*
1504 C                     Z-ADDCSNO,X    FSNO    20
1505 C                     Z-ADDCCDP,X    FCDP
1506 C                     Z-ADDCSPT,X    FSPT   138
     C/COPY WNCPYSRC,LE0490C004
1507 C**********           Z-ADDMTDV,X    FMDI    10     78               S01194
1507 C**********           MOVELMTDV,X    FMDI    1      78         S01194BHF373
1507 C                     MOVELMTDV,X    FMDI    1                       BHF373
1507 C****                                                                BHF373
1507 C           MTDV,X    IFEQ 'D'                                       BHF373
1507 C                     MOVEL'1'       *IN,78                          BHF373
1507 C                     ELSE                                           BHF373
1507 C                     MOVEL'0'       *IN,78                          BHF373
1507 C                     END                                            BHF373
1507 C****                                                                BHF373
1508 C**
1509 C**   EVENT CCY - FCLTY CCY,OR EVENT GENERATED BY FCLTY REC - BYPASS
1510 C   71                GOTO CONEND
1511 C*
1512 C                     Z-ADD1         X
1513 C           ECCY      LOKUPCURR,X                   70
1514 C  N70                MOVE ECCY      CCYERR
1515 C  N70                GOTO ERROR
1516 C*
1517 C                     Z-ADDCSPT,X    ESPT   138
1518 C**********           Z-ADDMTDV,X    EMDI    10     79               S01194
1518 C**********           MOVELMTDV,X    EMDI    1      79         S01194BHF373
1507 C***********          MOVELMTDV,X    FMDI    1                 BHF373BHF695
1507 C                     MOVELMTDV,X    EMDI    1                       BHF695
1507 C****                                                                BHF373
1507 C           MTDV,X    IFEQ 'D'                                       BHF373
1507 C                     MOVEL'1'       *IN,79                          BHF373
1507 C                     ELSE                                           BHF373
1507 C                     MOVEL'0'       *IN,79                          BHF373
1507 C                     END                                            BHF373
1507 C****                                                                BHF373
1519 C*
1520 C                     GOTO CONVRT
1521 C**
1522 C**   DATABASE ERROR FOR CURRENCY
1523 C           ERROR     TAG                             ** ERROR TAG **
1524 C                     SETON                     U7U8LR
1525 C**********           MOVELBLANKS    TABKEY                          S01194
1526 C**********           MOVEL'20'      TABKEY                          S01194
1527 C**********           MOVELCCYERR    PART4                           S01194
1528 C**********           MOVE '1'       PART4                           S01194
1529 C**********           MOVE PART4     TABKEY                          S01194
1530 C**********                                                          S01194
1531 C**********           MOVE TABKEY    DBKEY            ***************S01194
1532 C**********           MOVE '10'      DBASE            ***   10    ***S01194
1533 C**********           MOVE 'TABLE'   DBFILE           ***************S01194
     C                     MOVELCCYERR    DBKEY            ***************S01194
1532 C                     MOVE '10'      DBASE            ***   10    ***S01194
1533 C                     MOVE 'SDCURRPD'DBFILE           ***************S01194
1534 C*
1535 C                     GOTO CONEND
1536 C*
1537 C           CONVRT    TAG                             ** CONVRT TAG**
1538 C**
1539 C**   CALCULATE CROSS RATE TO FACILITY CCY
1540 C   78N79
1541 CORN78 79   FSPT      MULT ESPT      ESPT      H
1542 C   78 79
1543 CORN78N79   FSPT      DIV  ESPT      ESPT      H
1544 C**
1545 C**   ADJUST EXCHANGE RATE FOR DECIMAL PLACES
1546 C           FCDP      SUB  ECDP      CX      10
1547 C           CX        ADD  4         CX
1548 C*
1549 C  N78      ESPT      DIV  POWR,CX   EXRATE 159H
1550 C  N78      1         DIV  EXRATE    EXRATE 159H
1551 C   78      ESPT      MULT POWR,CX   EXRATE    H
     C/COPY WNCPYSRC,LE0490C005
1552 C**
1553 C**   CONVERT EVENT AMOUNTS TO FACILITY CCY
1554 C           EAMT      MULT EXRATE    EAMT      H
1555 C*
1556 C   72      OTHA      MULT EXRATE    OTHA      H
1557 C*
1558 C           CONEND    ENDSR                           ** CONEND TAG**
     C/COPY WNCPYSRC,LE0490C017
     C*                                                                   S01117
     C********************************************************************S01117
     C**                                                                  S01117
     C** Sub-routine to set-up array of Branch Internal Customer          S01117
     C** Numbers                                                          S01117
     C**                                                                  S01117
     C** Is called from sub-routine FIRST and does not call any other     S01117
     C** sub-routines.                                                    S01117
     C**                                                                  S01117
     C*                                                                   S01117
     C           BCASR     BEGSR                                          S01117
     C*                                                                   S01117
     C                     READ SDBRCHPD                 50               S01117
     C*                                                                   S01117
     C           *IN50     IFEQ '0'                                       S01117
     C*                                                                   S01117
     C                     Z-ADD1         I       30                      S01117
     C*                                                                   S01117
     C           *IN50     DOWEQ'0'                                       S01117
     C*                                                                   S01117
     C** Check that Branch Internal Customer no. is non-blank             S01117
     C** and store if so                                                  S01117
     C*                                                                   S01117
     C           BICN      IFNE '      '                                  S01194
     C*                                                                   S01117
     C                     MOVE BICN      @BCA,I                          S01117
     C                     ADD  1         I                               S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     READ SDBRCHPD                 50               S01117
     C*                                                                   S01117
     C** End of DOW                                                       S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C                     SETON                     U7  U8               S01117
     C*                                                                   S01117
     C** Set-up local data area for reporting database error              S01117
     C*                                                                   S01117
     C                     MOVE 'SDBRCHPD'DBFILE           ***************S01117
     C                     MOVE '11'      DBASE            ***    11   ***S01117
     C*                                                    ***************S01117
     C** End of IF...ELSE statement                                       S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     SETOF                     50                   S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C*                                                                   S01117
     C*                                                                   S01117
     C********************************************************************S01117
1559 C********************************************************************
1560 C*    SUBROUTINE TO CARRY OUT LAST RECORD PROCESSING
1561 C*
1562 C*    LSTREC IS CALLED BY - MAIN PROCESSING
1563 C*
1564 C***********
1565 C           LSTREC    BEGSR                           * LSTREC BEGSR*
1566 C**
1567 C**   COMPARE FILE CONTROL TOTALS - FOR FCLTY
1568 C           NORE1     COMP COUNT1               8080
1569 C  N80      VLAF      COMP TOTI1                8080
1570 C  N80      VLAL      COMP TOTD1                8080
1571 C**
1572 C**                               - FOR LVNTS
1573 C           COUNTX    ADD  CONT22    CONT22
1574 C           TOTIX     ADD  TOTI22    TOTI22
1575 C           TOTDX     ADD  TOTD22    TOTTES  40
1576 C           TOTTES    COMP 1000                 70  70
1577 C   70      TOTTES    SUB  1000      TOTD22
1578 C   70      TOTI22    ADD  1         TOTI22
1579 C  N70                Z-ADDTOTTES    TOTD22
1580 C*
1581 C           NORE2     COMP COUNT2               8181
1582 C  N81      HRWN2     COMP TOTI2                8181
1583 C  N81      HRDC2     COMP TOTD2                8181
1584 C*
1585 C   80
1586 COR 81                SETON                     U8
1587 C**
1588 C**   COUNT HEADER & TRAILER RECORDS FOR CUTX2 & CFTLX
1589 C           COUNT3    ADD  2         COUNT3
1590 C           COUNT4    ADD  2         COUNT4
1591 C                     ENDSR
1592 C********************************************************************066550
1593 C***********                                                         066550
1594 C*****GLINTC SR. TO CALCULATE INTEREST BETWEEN ANY TWO DAY NUMBERS.  066550
1595 C***********                                                         066550
1596 C***********                                                         066550
1597 C*****THIS*VERSION REPLACES THE ORIGINAL GLINTC SR. NOW NAMED        066550
1598 C*****GLINTO.                                                        066550
1599 C***********                                                         066550
1600 C*****CALCULATION METHODS ARE -                                      066550
1601 C*****1**ACTUAL/365                                                  066550
1602 C*****2**ACTUAL/360                                                  066550
1603 C*****3**360/360 (SOMETIMES CALLED 30/360)                           066550
1604 C*****4**365/365 (EXCLUDING 29/02)                                   066550
1605 C*****5**365/360 (EXCLUDING 29/02)                                   066550
1606 C*****6**ACTUAL/366                                                  066550
1607 C***********                                                         066550
1608 C*****REQUIRES SUBRS. - ZDATE2, ZSAVE, & ZRSTOR.                     066550
1609 C***********                                                         066550
1610 C***********                                                         066550
1611 C*R*********GLINTC    BEGSR                           ** GLINTC  **  066550
1612 C***********                                                         066550
1613 C*****CALCULATIONS TO DEFINE INPUT FIELDS.                           066550
1614 C*R*********          Z-ADDZIBEG     ZIBEG   50       STARTING DATE  066550
1615 C*R*********          Z-ADDZIEND     ZIEND   50       FINISHING DATE 066550
1616 C*R*********          Z-ADDZICALC    ZICALC  10       CALC. BASIS    066550
1617 C*R*********          Z-ADDZIAMT     ZIAMT  150       PRINCIPAL      066550
1618 C*R*********          Z-ADDZIRATE    ZIRATE 117       RATE OF INTRST 066550
1619 C***********                                                         066550
1620 C****TO*DETERMINE NUMBER OF DAYS INTEREST TO BE CALCULATED           066550
1621 C*R*********ZIEND     SUB  ZIBEG     ZDAYN1  50                      066550
1622 C***********                                                         066550
1623 C****CHECK*FOR INTEREST CALCULATION BASIS                            066550
1624 C*****USE*OF INDICATRS                                               066550
1625 C*****1,92**2,90  3,91  4,97  5,96  6,95                             066550
1626 C***********          SETOF                     959697               066550
1627 C*R*********ZICALC    COMP 2                    919290               066550
1628 C**N91******          GOTO ZICAL                                     066550
1629 C***********ZICALC    COMP 5                    959796               066550
1630 C***97******ZICALC    COMP 3                    97  91               066550
1631 C***95******                                                         066550
1632 C*R*96******          SETOF                     91                   066550
1633 C**N91******          GOTO ZILPCK                                    066550
1634 C***********                                                         066550
1635 C*****THIS*CODING WILL CALCULATE THE NUMBER OF DAYS TO USE WHEN      066550
1636 C*****USING*THE 30/360 BASIS - METHOD 3.                             066550
1637 C***********          EXSR ZSAVE                                     066550
1638 C***********          Z-ADDZIBEG     ZDAYNO                          066550
1639 C***********          EXSR ZDATE2                                    066550
1640 C***********          MOVE ZDAY      ZISD    20                      066550
1641 C***********          MOVE ZMTH      ZISM    20                      066550
1642 C***********          MOVE ZYEAR     ZISY    20                      066550
1643 C***********          Z-ADDZIEND     ZDAYNO                          066550
1644 C***********          EXSR ZDATE2                                    066550
1645 C***********          MOVE ZDAY      ZIFD    20                      066550
1646 C***********          MOVE ZMTH      ZIFM    20                      066550
1647 C***********          MOVE ZYEAR     ZIFY    20                      066550
1648 C***********          EXSR ZRSTOR                                    066550
1649 C***********          SETOF                     93                   066550
     C****IN*ORDER FOR THE FINISH YEAR TO BE LESS THAN THE START YEAR IF  066550
     C****ZIEND*IS GREATER THAN ZIBEG,THEN THE DATE ZIEND MUST BE IN A    066550
     C****DIFFERENT CENTURY TO ZIBEG.IF SO ADD 100 YEARS TO IT.           066550
     C***********ZIEND     COMP ZIBEG                93                   066550
     C***93******ZIFY      COMP ZISY                   93                 066550
     C***********          Z-ADDZISY      ZISY2   30                      066550
     C**N93******          Z-ADDZIFY      ZIFY2   30                      066550
     C***93******ZIFY      ADD  100       ZIFY2                           066550
     C***********                                                         066550
     C*****DETERMINE*WHETHER*START*YEAR*IS*A*LEAP*YEAR*AND*IF*START*S01147066550
     C*****MONTH*IS*FEBRUARY.***************************************S01147066550
     C***********                                                   S01147066550
     C**N98******          BITOF'0'       ZGLBIT  1           E80945S01147066550
     C***98******          BITON'0'       ZGLBIT              E80945S01147066550
     C***********ZISY2     ADD  1900      ZLYCHK  40                S01147066550
     C***********ZLYCHK    DIV  4         ZLYCHK                    S01147066550
     C***********          MVR            ZLYREM  20                S01147066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAS01147066550
     C***********ZISM      COMP 2                        99*FEBRUARYS01147066550
2209 C**N99******30        SUB  ZISD      ZID1    50   93           S01147066550
2210 C**N99*93***          Z-ADD0         ZID1                      S01147066550
     C***99N98***28        SUB  ZISD      ZID1                      S01147066550
     C***99*98***29        SUB  ZISD      ZID1                     S01147 066550
2209 C***********30        SUB  ZISD      ZID1    50   93          S01147 066550
2211 C***********ZISM      COMP 12                       93        LE0490 066550
2212 C***93******          Z-ADD0         ZISM                     LE0490 066550
2213 C***93******ZISY      ADD  1         ZISY                     LE0490 066550
     C***93******ZISY2     ADD  1         ZISY2                    E1725  066550
     C***********                                                         066550
     C*****DETERMINE*WHETHER*END*YEAR*IS*A*LEAP*YEAR*AND*IF*END*MONS01147 066550
     C*****IS*FEBRUARY.********************************************S01147 066550
     C***********                                                  S01147 066550
     C***********ZIFY2     ADD  1900      ZLYCHK  40               S01147 066550
     C***********ZLYCHK    DIV  4         ZLYCHK                   S01147 066550
     C***********          MVR            ZLYREM  20               S01147 066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YES01147 066550
     C***********ZIFM      COMP 2                        99*FEBRUARS01147 066550
2214 C**N99******ZIFD      COMP 31                       93        S01147 066550
2214 C***99N98***ZIFD      COMP 28                       93         S01147066550
2214 C***99*98***ZIFD      COMP 29                       93         S01147066550
     C***********          SETOF                     98       E80945S01147066550
     C***********          TESTB'0'       ZGLBIT         98   E80945S01147066550
2214 C***********ZIFD      COMP 31                       93         S01147066550
     C*****DETERMINE*WHETHER*END*YEAR*IS*A*LEAP*YEAR*AND*IF*END*MONTS01147066550
     C*****IS*FEBRUARY.*********************************************S01147066550
     C***********                                                   S01147066550
     C***********ZIFY2     ADD  1900      ZLYCHK  40                S01147066550
     C***********ZLYCHK    DIV  4         ZLYCHK                    S01147066550
     C***********          MVR            ZLYREM  20                S01147066550
     C***********ZLYREM    COMP *ZERO                    98*LEAP YEAS01147066550
     C***********ZIFM      COMP 2                        99*FEBRUAR S01147066550
2214 C**N99******ZIFD      COMP 31                       93         S01147066550
2214 C***99N98***ZIFD      COMP 28                       93         S01147066550
2214 C***99*98***ZIFD      COMP 29                       93         S01147066550
     C***********          SETOF                     98       E80945S01147066550
     C***********          TESTB'0'       ZGLBIT         98   E80945S01147066550
2214 C***********ZIFD      COMP 31                       93         S01147066550
1656 C***93******ZID1      ADD  30        ZID1                            066550
1657 C**N93******ZID1      ADD  ZIFD      ZID1                            066550
1658 C***********ZIFM      SUB  1         ZIFM                            066550
     C***********ZISY      COMP ZIFY                     93               066550
1660 C***93******ZIFM      SUB  ZISM      ZINOM   30                      066550
1661 C***93******          GOTO ZIOUT                                     066550
1662 C***********12        SUB  ZISM      ZIM1    20                      066550
1663 C***********          Z-ADD1         ZISM                            066550
     C*****USE*ENLARGED FIELDS THAT CAN HANDLE 1999 ONWARDS               066550
     C***********ZISY2     ADD  1         ZISY2                           066550
     C***********ZIFY2     SUB  ZISY2     ZIY1    20                      066550
1666 C***********ZIY1      MULT 12        ZIM2    30                      066550
1667 C***********ZIM2      ADD  ZIFM      ZIM2                            066550
1668 C***********ZIM1      ADD  ZIM2      ZINOM                           066550
1669 C***********ZIOUT     TAG                             * ZIOUT TAG *  066550
1670 C***********ZINOM     MULT 30        ZID2    50                      066550
1671 C***********ZID2      ADD  ZID1      ZDAYN1                          066550
1672 C***********          SETOF                     93                   066550
1673 C***********ZILPCK    TAG                             * ZILPCK TAG * 066550
1674 C**N96N97***          GOTO ZICAL                                     066550
1675 C*****THE*FOLLOWING CODING APPLIES FOR METHODS 4 AND 5 ONLY.         066550
1676 C*****1*DAY*IS SUBTRACTED FROM ZDAYN1 FOR EACH OCCURANCE OF 29 FEB   066550
1677 C*****IN*THE INTEREST CALCULATION PERIOD INCLUSIVE OF ZIBEG, & ZIEND.066550
1678 C***********                                                         066550
1679 C*****FIND*NO OF 4 YEAR PERIODS BETWEEN DATES                        066550
1680 C***********ZDAYN1    DIV  1461      ZIMAN   20                      066550
1681 C***********          MVR            ZIREM   50                      066550
1682 C*****FIND*NEXT 29 FEB DAY NO. ON OR AFTER ZIBEG.                    066550
1683 C***********ZIBEG     SUB  60        ZIBW1   50                      066550
1684 C***********ZIBW1     DIV  1461      ZIDW1   20                      066550
1685 C***********          MVR            ZIDREM  50                      066550
1686 C***********ZIDREM    COMP 0                        94               066550
1687 C***94******          Z-ADDZIBEG     ZIDW2   50                      066550
1688 C***94******          GOTO ZILP1                                     066550
1689 C*****ROUND*UP RESULT                                                066550
1690 C***********ZIDW1     ADD  1         ZIDW2                           066550
1691 C*****CALCULATE NEXT 29 FEB.                                         066550
1692 C***********ZIDW2     MULT 1461      ZIDW2                           066550
1693 C***********ZIDW2     ADD  60        ZIDW2                           066550
1694 C***********ZILP1     TAG                             * ZILP1 TAG *  066550
1695 C*****IF*THIS NEXT 29 FEB. DAYNO - ZIBEG IS GR. TH. OR EQ. TO        066550
1696 C*****ZIREM*THEN ADD 1 TO ZIMAN.                                     066550
1697 C***********ZIDW2     SUB  ZIBEG     ZILPCP  50                      066550
1698 C***********ZIREM     COMP ZILPCP               94  94               066550
1699 C***94******ZIMAN     ADD  1         ZIMAN                           066550
1700 C*****SUBTRACT ZIMAN FROM ZDAYN1 TO GIVE VALUE OF ZDAYN1             066550
1701 C*****REQUIRED FOR THIS INTEREST CALCULATION.                        066550
1702 C***********ZDAYN1    SUB  ZIMAN     ZDAYN1                          066550
1703 C***********          SETOF                     94                   066550
1704 C***********ZICAL     TAG                             * ZICAL TAG *  066550
1705 C***********                                                         066550
1706 C****CALCULATE INTEREST                                              066550
1707 C***90******                                                         066550
1708 C*R*91******                                                         066550
1709 C*R*96******ZIAMT     DIV  36000     ZIWRK1 155H                     066550
1710 C***92******                                                         066550
1711 C*R*97******ZIAMT     DIV  36500     ZIWRK1    H                     066550
1712 C***95******ZIAMT     DIV  36600     ZIWRK1    H                     066550
1713 C*R*********ZIWRK1    MULT ZIRATE    ZIWRK2 155H                     066550
1714 C*R*********ZIWRK2    MULT ZDAYN1    ZINTR  152H      AMT. OF INTRST 066550
1715 C***********                                                         066550
1716 C***********          SETOF                     909192               066550
1717 C***********          SETOF                     959697               066550
1718 C*R*********          ENDSR                                          066550
1719 C***********                                                         066550
1720 C********************************************************************066550
1721 C**   ZDATE1 SR. TO VALIDATE DATES SUBMITTED AND
1722 C**              CONVERT TO A NUMBER OF DAYS.
1723 C**
1724 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
1725 C**
1726 C           ZDATE1    BEGSR                           *** ZDATE1 ***
1727 C**
1728 C**   CLEAR DAY NUMBER.
1729 C                     Z-ADD0         ZDAYNO  50
1730 C**
1731 C**   CALCULATION TO DEFINE INPUT DATE FIELD.
1732 C                     Z-ADDZDATE     ZDATE   60
1733 C**
1734 C**   GET INDIVIDUAL DAY, MONTH AND YEAR FIELDS.
1735 C                     MOVE ZDATE     ZYEAR   20
1736 C  N98                MOVELZDATE     ZDAY    20
1737 C   98                MOVELZDATE     ZMTH    20
1738 C                     MOVE ZDATE     ZWRK4   40
1739 C  N98                MOVELZWRK4     ZMTH
1740 C   98                MOVELZWRK4     ZDAY
1741 C**
1742 C**   ENSURE MONTH IS VALID.
1743 C           ZMTH      COMP 0                      9999
1744 C  N99      ZMTH      COMP 12                   99
1745 C   99                GOTO ZDEND1                     BYPASS IF ERROR
1746 C**
1747 C**   CHECK FOR 30 DAY MONTHS.
1748 C           ZMTH      COMP 4                        90IF 90 ON, 30
1749 C  N90      ZMTH      COMP 6                        90DAY MONTH.
1750 C  N90      ZMTH      COMP 9                        90
1751 C  N90      ZMTH      COMP 11                       90
1752 C**
1753 C**   ENSURE DAY IS VALID.
1754 C           ZDAY      COMP 0                      9999
1755 C   90N99   ZDAY      COMP 30                   99
1756 C  N90N99   ZDAY      COMP 31                   99
1757 C   99                GOTO ZDEND1                     BYPASS IF ERROR
1758 C**
1759 C**   CHECK FOR LEAP YEAR AND FEBRUARY.
1760 C           ZYEAR     ADD  28        ZYEAR
1761 C           ZYEAR     DIV  4         ZLYR    20
1762 C                     MVR            ZLY     10     91LEAP YR, 91 ON
1763 C           ZMTH      COMP 2                    93  92FEB., 92 ON
1764 C**                                                   PAST FEB, 93 ON
1765 C**   IF FEBUARY FURTHER VALIDATE DAY.
1766 C  N91 92   ZDAY      COMP 28                   99
1767 C   91 92   ZDAY      COMP 29                   99
1768 C   99                GOTO ZDEND1                     BYPASS IF ERROR
1769 C**
1770 C**   DETERMINE NUMBER OF DAYS FROM 31/12/1971.     NO.OF 4 YR. SPANS
1771 C           ZLYR      MULT 1461      ZDAYNO           X DAYS IN SPAN.
1772 C  N91      ZDAYNO    ADD  ZYDY,ZLY  ZDAYNO           SINCE LAST L.YR
1773 C   91 93   ZDAYNO    ADD  1         ZDAYNO           L.YR.,PAST FEB.
1774 C           ZDAYNO    ADD  ZMDY,ZMTH ZDAYNO           DAYS THIS YEAR
1775 C           ZDAYNO    ADD  ZDAY      ZDAYNO           DAYS THIS MONTH
1776 C**
1777 C           ZDEND1    ENDSR                           * ZDEND1 ENDSR*
1778 C**
1779 C**
1780 C********************************************************************
1781 C**
1782 C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
1783 C**
1784 C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
1785 C**
1786 C           ZDATE2    BEGSR                           *** ZDATE2 ***
1787 C**
1788 C**   CLEAR DATE FIELDS.
1789 C                     Z-ADD0         ZDATE   60
1790 C                     MOVEL'       ' ZADATE  7
1791 C**
1792 C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
1793 C                     Z-ADDZDAYNO    ZDAYNO  50
1794 C**
1795 C**   DETERMINE YEAR NUMBER.
1796 C**
1797 C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
1798 C           ZDAYNO    SUB  1         ZDAYN1  50   99
1799 C   99                GOTO ZDEND2
1800 C**
1801 C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
1802 C           ZDAYN1    DIV  1461      ZLYR    20
1803 C                     MVR            ZDAYN1           SAVE REMAINING
1804 C**                                                   DAYS
1805 C**   CALCULATE NUMBER OF REMAINING YEARS.
1806 C                     Z-ADD1         ZWRK2   20
1807 C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
1808 C           ZDAYN1    COMP ZYDY,ZWRK2             90
1809 C  N90      ZWRK2     ADD  1         ZWRK2
1810 C  N90                GOTO ZDTAG1
1811 C           ZWRK2     SUB  1         ZWRK2          91LEAP YR, 91 ON
1812 C**
1813 C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
1814 C  N91      ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
1815 C**
1816 C**   CALCULATE ACTUAL YEAR NUMBER.
1817 C           ZLYR      MULT 4         ZWRK3   30
1818 C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
1819 C                     Z-ADDZWRK3     ZYEAR   20
1820 C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
1821 C**
1822 C**   DETERMINE MONTH NUMBER.
1823 C**
1824 C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
1825 C                     SETOF                     9293
1826 C   91      ZDAYN1    COMP 59                     9293
1827 C   91N92   ZDAYN1    SUB  1         ZDAYN1
1828 C**
1829 C**   CALCULATE MONTH NUMBER.
1830 C                     Z-ADD2         ZWRK2
1831 C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
1832 C           ZDAYN1    COMP ZMDY,ZWRK2             94
1833 C  N94      ZWRK2     ADD  1         ZWRK2
1834 C  N94                GOTO ZDTAG2
1835 C           ZWRK2     SUB  1         ZWRK2
1836 C**
1837 C                     Z-ADDZWRK2     ZMTH    20       MONTH
1838 C**
1839 C**   DETERMINE DAY OF MONTH.
1840 C**
1841 C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
1842 C           ZDAYN1    ADD  1         ZDAYN1
1843 C**
1844 C**   CALCULATE DAY OF MONTH.
1845 C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
1846 C**
1847 C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
1848 C   93      ZDAY      ADD  1         ZDAY
1849 C**
1850 C**   FORMAT DATE, DDMMYY OR MMDDYY.
1851 C  N98                MOVELZDAY      ZWRK4   40
1852 C   98                MOVE ZDAY      ZWRK4
1853 C  N98                MOVE ZMTH      ZWRK4
1854 C   98                MOVELZMTH      ZWRK4
1855 C                     MOVELZWRK4     ZDATE
1856 C                     MOVE ZYEAR     ZDATE
1857 C**
1858 C**   FORMAT ALPHA DATE, DDMMMYY.
1859 C           ZDAY      COMP 10                     95
1860 C                     MOVELZDAY      ZWRK5   5
1861 C   95                MOVEL' '       ZWRK5
1862 C                     MOVE ZMNM,ZMTH ZWRK5
1863 C                     MOVELZWRK5     ZADATE
1864 C                     MOVE ZYEAR     ZADATE
1865 C**
1866 C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
1867 C**
1868 C**
1869 C********************************************************************
1870 C********************************************************************
1871 C**
1872 C**   ZRSTOR SR. TO RESTORE INDICATORS 90 - 97 TO THE SETTINGS
1873 C**              THEY HAD BEFORE THE EXECUTION OF SR. ZSAVE.
1874 C**
1875 C           ZRSTOR    BEGSR                           *** ZRSTOR ***
1876 C**
1877 C                     TESTB'0'       ZBITS          90
1878 C                     TESTB'1'       ZBITS          91
1879 C                     TESTB'2'       ZBITS          92
1880 C                     TESTB'3'       ZBITS          93
1881 C                     TESTB'4'       ZBITS          94
1882 C                     TESTB'5'       ZBITS          95
1883 C                     TESTB'6'       ZBITS          96
1884 C                     TESTB'7'       ZBITS          97
1885 C**
1886 C                     ENDSR
1887 C**
1888 C**
1889 C********************************************************************
1890 C**
1891 C**   ZSAVE SR. TO MEMORISE THE SETTINGS AND TO SET OFF INDICATORS
1892 C**              90 - 97 BEFORE EXECUTION OF A Z-SUBROUTINE.
1893 C**
1894 C**   THIS SR. IS REQUIRED ONLY IF INDICATORS
1895 C**   90 - 97 ARE USED ELSEWHERE IN A PROGRAM.
1896 C**
1897 C           ZSAVE     BEGSR                           *** ZSAVE ***
1898 C**
1899 C                     BITOF'01234567'ZBITS   1
1900 C   90                BITON'0'       ZBITS
1901 C   91                BITON'1'       ZBITS
1902 C   92                BITON'2'       ZBITS
1903 C   93                BITON'3'       ZBITS
1904 C   94                BITON'4'       ZBITS
1905 C   95                BITON'5'       ZBITS
1906 C   96                BITON'6'       ZBITS
1907 C   97                BITON'7'       ZBITS
1908 C**
1909 C                     SETOF                     909192
1910 C                     SETOF                     939495
1911 C                     SETOF                     9697
1912 C**
1913 C                     ENDSR
1914 C**
1915 C**
1916 C********************************************************************
1917 C**
1918 C*****ZSYSTM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   S01194
1919 C**********                                                          S01194
1920 C********** ZSYSTM    BEGSR                           *** ZSYSTM *** S01194
1921 C**********                                                          S01194
1922 C*****SET*UP KEY FOR INSTALLATION CONTROL RECORD.                    S01194
1923 C**********           MOVEL'01      'ZTABKY 12                       S01194
1924 C**********           MOVE '  10'    ZTABKY                          S01194
1925 C**********                                                          S01194
1926 C********** ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
1927 C**N99***** RECI      COMP 'D'                  9999  ON, IS DELETED S01194
1928 C**********                                                          S01194
1929 C*****CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
1930 C********** DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
1931 C**********                                                          S01194
1932 C**********           ENDSR                                          S01194
1933 C**
1934 C**
1935 C********************************************************************
1936 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
1937 C*   IND '99' IS SET BY AN OVERFLOW ERROR
1938 C*
1939 CSR         GLZADD    BEGSR                           *** GLZADD ****
1940 C*
1941 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
1942 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
1943 C*
1944 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
1945 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
1946 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
1947 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
1948 C*
1949 CSR                   EXSR GLZSUM
1950 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
1951 C*
1952 C********************************************************************
1953 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
1954 C*                        GLZADD, GLZSUB, GLZCMP.
1955 C*          PARAMETERS PASSED -
1956 C*                     I/P ZZAMTI ZZAMTD
1957 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
1958 C*
1959 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
1960 C*
1961 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
1962 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
1963 CSR                   SETOF                     919293
1964 CSR                   SETOF                     949599
1965 C*
1966 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
1967 CSR         ZZAMTI    COMP 0                      9293
1968 CSR 93      ZZAMTD    COMP 0                      9293
1969 CSR 93                GOTO ZZSEND                     ZERO BYPASS
1970 C*
1971 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
1972 CSR         ZZTOTI    COMP 0                      9193
1973 CSR 93      ZZTOTD    COMP 0                      9193
1974 C*
1975 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
1976 CSR 93                Z-ADDZZAMTI    ZZTOTI
1977 CSR 93                Z-ADDZZAMTD    ZZTOTD
1978 CSR 93                GOTO ZZSEND                     ZERO BYPASS
1979 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
1980 CSR 91N92
1981 CORN91 92             GOTO ZZOFPS
1982 C*
1983 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
1984 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
1985 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
1986 C*
1987 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
1988 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
1989 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
1990 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
1991 C*
1992 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
1993 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
1994 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
1995 CSRN99                Z-ADDZZWK2     ZZTOTD
1996 CSRN99                Z-ADDZZWK3     ZZTOTI
1997 C*
1998 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
1999 CSR 99                Z-ADD0         ZZAMT  153
2000 CSR                   GOTO ZZSEND
2001 C*
2002 C* THE 'SIGNS' ARE DIFFERENT
2003 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
2004 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
2005 C*
2006 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
2007 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
2008 C*
2009 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
2010 C*
2011 CSR 91                Z-SUBZZTOTI    ZZTOTI
2012 CSR 91                Z-SUBZZTOTD    ZZTOTD
2013 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
2014 C*
2015 CSR         ZZTOTI    COMP ZZAMTI               93  95
2016 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
2017 C*
2018 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
2019 CSR 95                Z-ADD0         ZZTOTI
2020 CSR 95                Z-ADD0         ZZTOTD
2021 CSR 95                GOTO ZZSEND
2022 C*
2023 C* IF ZZTOT GT. ZZAMT.
2024 CSR 93      ZZAMTD    COMP ZZTOTD               94
2025 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
2026 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
2027 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
2028 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
2029 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
2030 C*
2031 C*
2032 C* IF ZZAMT GT. ZZTOT.
2033 CSRN93      ZZTOTD    COMP ZZAMTD               94
2034 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
2035 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
2036 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
2037 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
2038 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
2039 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
2040 C*
2041 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
2042 CSR                   SETOF                     94
2043 CSR 93 91
2044 CORN93 92             SETON                     94
2045 CSR 94                Z-SUBZZTOTI    ZZTOTI
2046 CSR 94                Z-SUBZZTOTD    ZZTOTD
2047 C**
2048 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
2049 CSR 92                Z-SUBZZAMTI    ZZAMTI
2050 CSR 92                Z-SUBZZAMTD    ZZAMTD
2051 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
2052 C**
2053 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
2054 CSR                   SETOF                     96
2055 CSR         ZZTOTD    COMP 0                        91
2056 CSR 91      ZZTOTI    COMP 0                      96
2057 CSR 96                MOVE '.000-'   ZZNEGD  5
2058 CSR                   ENDSR                             ** ENDSR **
2059 C********************************************************************
2060 C***********                                                         S01195
2061 C*****ZDATE5 SR. TO DETERMINE IF A DAY NUMBER DATE IS A HOLIDAY      S01195
2062 C***********     IN GIVEN CURRENCY, AND, IF DAY IS A HOLIDAY         S01195
2063 C***********     AND IF REQUIRED, DETERMINE NEXT WORKING DAY.        S01195
2064 C***********                                                         S01195
2065 C***********ZDATE5    BEGSR                           *** ZDATE5 *** S01195
2066 C***********                                                         S01195
2067 C*****CALCULATIONS TO DEFINE INPUT FIELDS.                           S01195
2068 C***********          Z-ADDZDAYNO    ZDAYNO  50                      S01195
2069 C***********          MOVE ZCCY      ZCCY    3                       S01195
2070 C***********          MOVE ZOPT      ZOPT    1                       S01195
2071 C***********                                                         S01195
2072 C*****CALCULATIONS TO DEFINE/CLEAR WORKFIELDS.                       S01195
2073 C***********          MOVE '   '     ZHC                             S01195
2074 C***********                                                         S01195
2075 C*****RESET INDICATOR.                                               S01195
2076 C***********          SETOF                     99                   S01195
2077 C***********                                                         S01195
2078 C*****CALCULATION TO DEFINE/SET OUTPUT FIELD.                        S01195
2079 C***********          Z-ADDZDAYNO    ZDYNBR  50                      S01195
2080 C***********                                                         S01195
2081 C*****DETERMINE IF HOLIDAY                                           S01195
2082 C***********ZDHOL     TAG                             ** ZDHOL TAG **S01195
2083 C***********          SETOF                     91                   S01195
2084 C***********                                                         S01195
2085 C*****SET*KEY FOR FIRST HOLIDAY RECORD.                              S01195
2086 C***********          MOVEL'22      'ZTABKY 12                       S01195
2087 C***********          MOVELZDYNBR    ZWRK6   6                       S01195
2088 C***********          MOVE '1'       ZWRK6                           S01195
2089 C***********          MOVE ZWRK6     ZTABKY                          S01195
2090 C***********                                                         S01195
2091 C*****CHAIN*FOR HOLIDAY RECORD, RECORD 1 OR 2.                       S01195
2092 C***********ZDHCH5    TAG                             ** ZDHCH5 TAG *S01195
2093 C***********ZTABKY    CHAINTABLE                90    ON NOT THERE   S01195
2094 C**N90******RECI      COMP 'D'                  9090  DELETED        S01195
2095 C***********                                                         S01195
2096 C*****STORE*CURRENCIES IF RECORD FOUND.                              S01195
2097 C**N90N91***          MOVEAHCCY      ZHC,1                           S01195
2098 C***91N90***          MOVEAHCCY      ZHC,26                          S01195
2099 C***********                                                         S01195
2100 C*****GET*SECOND RECORD, IF NOT ALREADY DONE.                        S01195
2101 C***********          MOVE ZTABKY    ZWRK1N  10                      S01195
2102 C***********ZWRK1N    COMP 1                        91               S01195
2103 C***********          MOVE '2'       ZTABKY                          S01195
2104 C***91N90***          GOTO ZDHCH5                                    S01195
2105 C***********                                                         S01195
2106 C*****BYPASS TO END IF NO FIRST RECORD FOUND.                        S01195
2107 C***90*91***          GOTO ZDEND5                                    S01195
2108 C***********                                                         S01195
2109 C*****DETERMINE HOLIDAY RECORD TYPE.                                 S01195
2110 C***********INEX      COMP 'E'                      92               S01195
2111 C***********INEX      COMP 'I'                      93               S01195
2112 C***********                                                         S01195
2113 C*****CHECK*IF CURRENCY ON HOLIDAY.                                  S01195
2114 C***********ZCCY      LOKUPZHC                      94               S01195
2115 C***********                                                         S01195
2116 C*****BYPASS TO END IF NOT HOLIDAY FOR CURRENCY.                     S01195
2117 C***92*94***                                                         S01195
2118 C*R*93N94***          GOTO ZDEND5                                    S01195
2119 C***********                                                         S01195
2120 C*****SET*INDICATOR FOR HOLIDAY FOR DAY NUMBER.                      S01195
2121 C***********          SETON                     99                   S01195
2122 C***********                                                         S01195
2123 C***********                                                         S01195
2124 C*****CHECK*IF NEXT WORKING DAY REQUIRED.                            S01195
2125 C***********ZOPT      COMP 'Y'                      95               S01195
2126 C***95******ZDYNBR    ADD  1         ZDYNBR                          S01195
2127 C***95******          GOTO ZDHOL                                     S01195
2128 C***********ZDEND5    ENDSR                           * ZDEND5 ENDSR S01195
2129 C********************************************************************S01195
2130 C***********                                                         S01195
2131 C*****ZDATE3 SR. TO CALCULATE ANY NUMBER OF WORKING                  S01195
2132 C***********     DAYS FORWARD IN ANY CURRENCY.                       S01195
2133 C***********                                                         S01195
2134 C*********THIS SR. CAN BE USED WHEN THE INPUT CYCLE IS RUNNING AS    S01195
2135 C*********HOLIDAY RECORDS ARE ACCESSED BY CHAIN. THEREFORE NEWLY     S01195
2136 C*********ADDED RECORDS IN THE OVERFLOW AREA CAN ALSO BE ACCESSED.   S01195
2137 C***********                                                         S01195
2138 C***********ZDATE3    BEGSR                           *** ZDATE3 *** S01195
2139 C***********                                                         S01195
2140 C*****CALCULATIONS TO DEFINE INPUT FIELDS.                           S01195
2141 C***********          Z-ADDZDAYNO    ZDAYNO  50       STARTING DATE  S01195
2142 C***********          MOVE ZCCY      ZCCY    3        DATE CURRENCY  S01195
2143 C***********          Z-ADDZNRDYS    ZNRDYS  20       NBR OF WORKING S01195
2144 C***********                                                         S01195
2145 C*****CLEAR*COUNT OF NBR OF DAYS ADDED, & DEFINE ZDYNBR.             S01195
2146 C***********          Z-ADD0         ZDCNT   20                      S01195
2147 C***********          Z-ADDZDAYNO    ZDYNBR  50                      S01195
2148 C***********                                                         S01195
2149 C*****LOOP*TO INCREMENT DAY NUMBER AND CHECK FOR HOLIDAY.            S01195
2150 C***********ZDLOP1    TAG                             ** ZDLOP1 TAG *S01195
2151 C***********                                                         S01195
2152 C***********          SETOF                     9596                 S01195
2153 C***********ZDYNBR    ADD  1         ZDYNBR                          S01195
2154 C***********                                                         S01195
2155 C*****SET*KEY FOR FIRST HOLIDAY RECORD.                              S01195
2156 C***********          MOVEL'22    '  ZDHKEY 12                       S01195
2157 C***********          MOVELZDYNBR    ZWRK6   6                       S01195
2158 C***********          MOVE '1'       ZWRK6                           S01195
2159 C***********          MOVE ZWRK6     ZDHKEY                          S01195
2160 C***********                                                         S01195
2161 C*****CHAIN*FOR HOLIDAY RECORD, RECORD 1 OR 2                        S01195
2162 C***********ZDHCHN    TAG                             ** ZDHCHN TAG *S01195
2163 C***********                                                         S01195
2164 C***********ZDHKEY    CHAINTABLE                90    ON NOT THERE   S01195
2165 C**N90******RECI      COMP 'D'                  9090  DELETED        S01195
2166 C***********                                                         S01195
2167 C*****NO*RECORD 1 FOUND, IS NOT A HOLIDAY                            S01195
2168 C***90N95***          GOTO ZDOAGN                                    S01195
2169 C***********                                                         S01195
2170 C*****NO*RECORD 2 FOUND                                              S01195
2171 C***90*95*96          GOTO ZDLOP1                     EXC. NOT FOUND S01195
2172 C***90*95N96          GOTO ZDOAGN                     INC. NOT FOUND S01195
2173 C***********                                                         S01195
2174 C*****DETERMINE TYPE FOUND, INCLUDE OR EXCLUDE                       S01195
2175 C***********INEX      COMP 'E'                  92  91               S01195
2176 C***********                                                         S01195
2177 C*****CHECK IF DAY IS HOLIDAY FOR CURRENCY.                          S01195
2178 C***********ZCCY      LOKUPHCCY                     93               S01195
2179 C***91*93***          GOTO ZDOAGN                     EXCLUDE FOUND  S01195
2180 C***92*93***          GOTO ZDLOP1                     INCLUDE FOUND  S01195
2181 C***********                                                         S01195
2182 C*****IF*EXCLUDE OR INCLUDE NOT FOUND CHECK                          S01195
2183 C*****FOR*SECOND HOLIDAY RECORD, IF REQUIRED.                        S01195
2184 C***********'   '     LOKUPHCCY                     94ON IF NO RCD.2 S01195
2185 C***********          MOVE ZDHKEY    ZWRK1   1                       S01195
2186 C***********ZWRK1     COMP '1'                      95               S01195
2187 C***91*95***          SETON                     96                   S01195
2188 C***95N94***          MOVE '2'       ZDHKEY                          S01195
2189 C***95N94***          GOTO ZDHCHN                     GET SECOND REC S01195
2190 C***********                                                         S01195
2191 C***91******          GOTO ZDLOP1                     EXC. NOT FOUND S01195
2192 C***92******          GOTO ZDOAGN                     INC. NOT FOUND S01195
2193 C***********                                                         S01195
2194 C*****INCREMENT COUNT AND CHECK IF REQUIRED NUMBER OF DAYS           S01195
2195 C*****HAVE*BEEN ADDED. IF NOT, GO THROUGH LOOP1 AGAIN.               S01195
2196 C***********ZDOAGN    TAG                             ** ZDOAGN TAG *S01195
2197 C***********                                                         S01195
2198 C***********ZDCNT     ADD  1         ZDCNT                           S01195
2199 C***********ZDCNT     COMP ZNRDYS                 97                 S01195
2200 C***97******          GOTO ZDLOP1                                    S01195
2201 C***********                                                         S01195
2202 C***********          ENDSR                                          S01195
2203 C***********                                                         S01195
2204 C***********                                                         S01195
     C********************************************************************S01195
     C/SPACE 3                                                            S01195
     C********************************************************************S01195
     C*                                                                   S01195
     C* ZACCH  --- SUBROUTINE TO ACCESS A HOLIDAY RECORD FOR A            S01195
     C*            PARTICULAR CURRENCY AND (OPTIONAL) LOCATION.           S01195
     C*                                                                   S01195
     C* CALLED FROM: ZFWDT, ZBKDT                                         S01195
     C*                                                                   S01195
     C* CALLS: NOTHING                                                    S01195
     C*                                                                   S01195
     C********************************************************************S01195
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/SPACE 3                                                            S01195
     C********************************************************************S01195
     C*                                                                   S01195
     C* ZFWDT  --- SUBROUTINE TO CALCULATE THE NTH WORKING DAY            S01195
     C*            FORWARD FROM A GIVEN START DATE FOR ANY                S01195
     C*            PARTICULAR CURRENCY AND (OPTIONAL) LOCATION.           S01195
     C*                                                                   S01195
     C* CALLED FROM: FREQB, FCLPDT                                        S01195
     C*                                                                   S01195
     C* CALLS: ZACCH                                                      S01195
     C*                                                                   S01195
     C********************************************************************S01195
     C/COPY ZSRSRC,ZFWDT                                                  S01195
     C/SPACE 3                                                            S01195
     C********************************************************************S01195
     C*                                                                   S01195
     C* ZBKDT  --- SUBROUTINE TO CALCULATE THE NTH WORKING DAY            S01195
     C*            BACKWARD FROM A GIVEN START DATE FOR ANY               S01195
     C*            PARTICULAR CURRENCY AND (OPTIONAL) LOCATION.           S01195
     C*                                                                   S01195
     C* CALLED FROM: FREQA                                                S01195
     C*                                                                   S01195
     C* CALLS: ZACCH                                                      S01195
     C*                                                                   S01195
     C********************************************************************S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
     C/SPACE 3                                                            S01195
2205 C********************************************************************
2206 C**
2207 C*****ZFREQB-SR.*TO*INCREMENT*A*DAY*NUMBER*DATE*BY*A*****************S01195
2207 C**    FREQB-SR. TO INCREMENT A DAY NUMBER DATE BY A                 S01195
2208 C**             PERIOD VALUE DETERMINED BY A CODE.
2209 C**
2210 C***********ZFREQB    BEGSR                           ***  ZFREQB ***S01195
2210 C           FREQB     BEGSR                           ***  FREQB  ***S01195
2211 C**
2212 C**   CALCULATIONS TO DEFINE/CLEAR FIELDS.
2213 C                     MOVE ZFREQ     ZFREQ   1
2214 C                     Z-ADDZDAYNO    ZDAYNO  50
2215 C                     Z-ADDZMDAY     ZMDAY   20
2216 C                     MOVE ZCCY      ZCCY    3
2217 C**
2218 C***********          MOVE '   '     ZHC                             S01195
2219 C***********          MOVE ' '       ZTABKY 12                       S01195
2220 C*
2221 C*            FIELDS USED FOR PERIOD CODES M,T,Q,X,Y
2222 C*
2223 C                     MOVE '  '      ZINDE   2
2224 C***********          Z-ADD0         ZINTO   20                      S01195
2225 C**
2226 C**   CONVERT DAY NUMBER TO DATE.
2227 C                     EXSR ZDATE2
2228 C                     SETOF                     90
2229 C**
2230 C**   CHECK FOR AND INCREMENT FOR CODE D-DAILY-WORKING DAY.
2231 C***********ZFREQ     COMP 'D'                      91               S01195
2232 C***91******ZDAYNO    ADD  1         ZDAYNO                          S01195
2233 C***91******          GOTO ZFHCHK                                    S01195
     C           ZFREQ     IFEQ 'D'                                       S01195
     C                     Z-ADD1         ZNRDYS                          S01195
     C                     EXSR ZFWDT                                     S01195
     C                     Z-ADDZDYNBR    ZDAYNO                          S01195
     C                     GOTO ZFEND                                     S01195
     C                     END                                            S01195
2234 C**
2235 C**   CHECK FOR AND INCREMENT FOR CODE W-WEEKLY.
2236 C           ZFREQ     COMP 'W'                      91
2237 C   91      ZDAYNO    ADD  7         ZDAYNO
2238 C   91                GOTO ZFEND
2239 C**
2240 C**   CHECK FOR AND INCREMENT FOR CODE F-FORTNIGHTLY.
2241 C           ZFREQ     COMP 'F'                      91
2242 C   91      ZDAYNO    ADD  14        ZDAYNO
2243 C   91                GOTO ZFEND
2244 C**
2245 C**   CHECK FOR AND INCREMENT FOR CODE S-SEMI-MONTHLY.
2246 C           ZFREQ     COMP 'S'                      91
2247 C   91      ZDAY      COMP 15                   939292
2248 C   91 92             Z-ADD31        ZDAY
2249 C   91 93             Z-ADD15        ZDAY
2250 C   91 93   ZMTH      ADD  1         ZMTH
2251 C   91                GOTO ZFDATE
2252 C**
2253 C**   CHECK FOR AND INCREMENT FOR CODE M-MONTHLY.
2254 C           ZFREQ     COMP 'M'                      91
2255 C   91                MOVE 'IN'      ZINDE
2256 C   91                Z-ADDZMDAY     ZDAY
2257 C   91      ZMTH      ADD  1         ZMTH
2258 C   91                GOTO ZFDATE
2259 C**
2260 C**   CHECK FOR AND INCREMENT FOR CODE R-SIX DAYS BEFORE END OF MONTH
2261 C           ZFREQ     COMP 'R'                      91
2262 C   91                Z-ADD31        ZDAY
2263 C   91      ZMTH      ADD  1         ZMTH
2264 C   91                GOTO ZFDATE
2265 C**
2266 C**   CHECK FOR AND INCREMENT FOR CODE T-BIMONTHLY.
2267 C           ZFREQ     COMP 'T'                      91
2268 C   91                MOVE 'IN'      ZINDE
2269 C   91                Z-ADDZMDAY     ZDAY
2270 C   91      ZMTH      ADD  2         ZMTH
2271 C   91                GOTO ZFDATE
2272 C**
2273 C**   CHECK FOR AND INCREMENT FOR CODE Q-QUARTERLY.
2274 C           ZFREQ     COMP 'Q'                      91
2275 C   91                MOVE 'IN'      ZINDE
2276 C   91                Z-ADDZMDAY     ZDAY
2277 C   91      ZMTH      ADD  3         ZMTH
2278 C   91                GOTO ZFDATE
2279 C**
2280 C**   CHECK FOR AND INCREMENT FOR CODE X-SIX MONTHLY.
2281 C           ZFREQ     COMP 'X'                      91
2282 C   91                MOVE 'IN'      ZINDE
2283 C   91                Z-ADDZMDAY     ZDAY
2284 C   91      ZMTH      ADD  6         ZMTH
2285 C   91                GOTO ZFDATE
2286 C**
2287 C**   CHECK FOR AND INCREMENT FOR CODE Y-YEARLY.
2288 C           ZFREQ     COMP 'Y'                      91
2289 C   91                MOVE 'IN'      ZINDE
2283 C   91                Z-ADDZMDAY     ZDAY
2290 C   91      ZYEAR     ADD  1         ZYEAR
2291 C   91                GOTO ZFDATE
2292 C**
2293 C**   CHECK FOR AND INCREMENT FOR CODE L-LAST CALENDAR DAY OF MONTH.
2294 C           ZFREQ     COMP 'L'                      91
2295 C   91                Z-ADD31        ZDAY
2296 C   91      ZMTH      ADD  1         ZMTH
2297 C   91                GOTO ZFDATE
2298 C**
2299 C**   CHECK FOR AND INCREMENT FOR CODE B-LAST WORKING DAY OF MONTH.
2300 C           ZFREQ     COMP 'B'                      91
2301 C   91                Z-ADD31        ZDAY
2302 C   91      ZMTH      ADD  1         ZMTH
2303 C   91                GOTO ZFDATE
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE 4- 4 MONTHLY                                      CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP '4'                      91                                   CLE064
     C   91                MOVE 'IN'      ZINDE                                               CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  4         ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE 5- 5 MONTHLY                                      CLE064
      *                                                                                       CLE064
     C   91                MOVE 'IN'      ZINDE                                               CLE064
     C           ZFREQ     COMP '5'                      91                                   CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  5         ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE 7- 7 MONTHLY                                      CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP '7'                      91                                   CLE064
     C   91                MOVE 'IN'      ZINDE                                               CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  7         ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE 8- 8 MONTHLY                                      CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP '8'                      91                                   CLE064
     C   91                MOVE 'IN'      ZINDE                                               CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  8         ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE 9- 9 MONTHLY                                      CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP '9'                      91                                   CLE064
     C   91                MOVE 'IN'      ZINDE                                               CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  9         ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE V- 10 MONTHLY                                     CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'V'                      91                                   CLE064
     C   91                MOVE 'IN'      ZINDE                                               CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  10        ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE E- 11 MONTHLY                                     CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'E'                      91                                   CLE064
     C   91                MOVE 'IN'      ZINDE                                               CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZMTH      ADD  11        ZMTH                                                CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE C- 24 MONTHLY                                     CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'C'                      91                                   CLE064
     C   91                MOVE 'IN'      ZINDE                                               CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZYEAR     ADD  2         ZYEAR                                               CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE I- 36 MONTHLY                                     CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'I'                      91                                   CLE064
     C   91                MOVE 'IN'      ZINDE                                               CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZYEAR     ADD  3         ZYEAR                                               CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE J- 48 MONTHLY                                     CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'J'                      91                                   CLE064
     C   91                MOVE 'IN'      ZINDE                                               CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZYEAR     ADD  4         ZYEAR                                               CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE N- 60 MONTHLY                                     CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'N'                      91                                   CLE064
     C   91                MOVE 'IN'      ZINDE                                               CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZYEAR     ADD  5         ZYEAR                                               CLE064
     C   91                GOTO ZFDATE                                                        CLE064
      *                                                                                       CLE064
      **   CHECK FOR AND INCREMENT FOR CODE U- 120 MONTHLY                                    CLE064
      *                                                                                       CLE064
     C           ZFREQ     COMP 'U'                      91                                   CLE064
     C   91                MOVE 'IN'      ZINDE                                               CLE064
     C   91                Z-ADDZMDAY     ZDAY                                                CLE064
     C   91      ZYEAR     ADD  10        ZYEAR                                               CLE064
     C   91                GOTO ZFDATE                                                        CLE064
2304 C**
2305 C**   CHECK FOR AND INCREMENT FOR CODE A-MONTHLY ACCRUAL/PROFIT DATE.
2306 C           ZFREQ     COMP 'A'                      91
2307 C***91*****           MOVEL'01    '  ZTABKY                          S01194
2308 C***91*****           MOVE '    11'  ZTABKY                          S01194
2309 C***91***** ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
2310 C**N99***** RECI      COMP '*'                      99               S01194
     C***91*****           CALL 'AOGELRR0'PLISTB                                       S01194 CGL029
     C   91                CALL 'AOGELRR1'PLISTB                                              CGL029
     C   91      @RTCD     COMP *BLANKS              9999                 S01194
     C*                                                                   S01194
2311 C   91N99             Z-ADDAPDA      ZDAYNO
2312 C**
2313 C**   BYPASS IF ZFREQ IS 'A' OR ANY OTHER VALUE
2314 C                     GOTO ZFEND
2315 C**
2316 C**
2317 C**   REFORMAT DATE AND ENSURE VALID.
2318 C           ZFDATE    TAG                             ** ZFDATE TAG*
2319 C**
2320 C**   VALIDATE MONTH.
2321 C           ZMTH      COMP 12                   91
2322 C   91      ZMTH      SUB  12        ZMTH
2323 C   91      ZYEAR     ADD  1         ZYEAR
2324 C**
2325 C**   CHECK FOR LEAP YEAR.
2326 C           ZYEAR     DIV  4         ZLYR    20
2327 C                     MVR            ZLY     10     92LEAP YEAR-92 ON
2328 C**
2329 C**   VALIDATE DAY NUMBER.
2330 C                     MOVE ZFMD,ZMTH ZWRK2   20
2331 C           ZMTH      COMP 2                        93
2332 C   92 93             Z-ADD29        ZWRK2
2333 C**
2334 C           ZDAY      COMP ZWRK2                94
2335 C   94                Z-ADDZWRK2     ZDAY
2336 C**
2337 C**   CHECK IF CODE R, TO SUBTRACT 6 DAYS.
2338 C           ZFREQ     COMP 'R'                      91
2339 C   91      ZDAY      SUB  6         ZDAY
2340 C**
2341 C**   REFORMAT DATE, DDMMYY OR MMDDYY, AND CONVERT TO DAY NUMBER.
     C           *LIKE     DEFN ZMTH      W@ZMTH                          S01195
     C                     MOVE ZMTH      W@ZMTH                          S01195
     C           *LIKE     DEFN ZYEAR     W@ZYR                           S01195
     C                     MOVE ZYEAR     W@ZYR                           S01195
2342 C                     MOVELZDAY      ZWRK4   40
2343 C                     MOVE ZMTH      ZWRK4
2344 C   98                MOVELZMTH      ZWRK4
2345 C   98                MOVE ZDAY      ZWRK4
2346 C                     MOVELZWRK4     ZDATE
2347 C                     MOVE ZYEAR     ZDATE
2348 C                     EXSR ZDATE1
     C           *LIKE     DEFN ZDAYNO    W@ZDAY                          S01195
     C                     Z-ADDZDAYNO    W@ZDAY                          S01195
2349 C**
2350 C**   CHECK IF CODE B, OR M,T,Q,X,Y TO BE CHECKED FOR HOLIDAY.
2351 C           ZFREQ     COMP 'B'                      91
2352 C           ZINDE     COMP 'IN'                     92
2353 C   92N99
2354 COR 91N99             GOTO ZFHCHK
2355 C**
2356 C                     GOTO ZFEND
2357 C**
2358 C**   CHECK IF DAY NUMBER IS A HOLIDAY.
2359 C**
2360 C           ZFHCHK    TAG                             ** ZFHCHK TAG *
      *                                                                   S01195
     C           ZFREQ     IFNE 'B'                        *B1            S01195
     C                     Z-ADD0         ZNRDYS                          S01195
     C                     EXSR ZFWDT                                     S01195
     C                     Z-ADDZDYNBR    ZDAYNO                          S01195
     C                     EXSR ZDATE2                                    S01195
     C                     END                             *E1            S01195
      **                                                                  S01195
      **   IF FREQUENCY CODE IS 'B', OR THE INCREMENATION TAKES THE       S01195
      **   DATE TO THE FOLLOWING MONTH, BACK TO FIND THE NON-HOLIDAY      S01195
      **   BEFORE THE SPECIFIED DAY NO.                                   S01195
      **                                                                  S01195
     C           ZFREQ     IFEQ 'B'                        *B1            S01195
     C           ZMTH      ORNE W@ZMTH                                    S01195
     C           ZYEAR     ORNE W@ZYR                                     S01195
     C                     Z-ADDW@ZDAY    ZDAYNO                          S01195
     C                     Z-ADD0         ZNRDYS                          S01195
     C                     EXSR ZBKDT                                     S01195
     C                     Z-ADDZDYNBR    ZDAYNO                          S01195
     C                     END                             *E1            S01195
      *                                                                   S01195
2361 C***********          SETOF                     94                   S01195
2362 C***********ZFREQ     COMP 'D'                      91               S01195
2363 C***********ZFREQ     COMP 'B'                      92               S01195
2364 C***91******                                                         S01195
2365 C*R*92******          GOTO ZSETK                                     S01195
2366 C***********                                                         S01195
2367 C****FOR*CODES*M,T,Q,X,Y, CHECK ZINDE - 'IN' TO INCREMENT,           S01195
2368 C***********                          - 'DE' TO DECREMENT            S01195
2369 C***********                                                         S01195
2370 C***********ZINDE     COMP 'IN'                     90               S01195
2371 C***********ZINDE     COMP 'IN'                     91               S01195
2372 C***********ZINDE     COMP 'DE'                     92               S01195
2373 C***********                                                         S01195
2374 C*****SET*KEY FOR FIRST HOLIDAY RECORD.                              S01195
2375 C***********ZSETK     TAG                             ***ZSETKTTAG***S01195
2376 C***********          MOVEL'22    '  ZTABKY                          S01195
2377 C***********          MOVELZDAYNO    ZWRK6   6                       S01195
2378 C***********          MOVE 1         ZWRK6                           S01195
2379 C***********          MOVE ZWRK6     ZTABKY                          S01195
2380 C***********                                                         S01195
2381 C*****GET*HOLIDAY RECORD.                                            S01195
2382 C***********ZFHCHN    TAG                             ***ZFHCHNHTAG**S01195
2383 C***********ZTABKY    CHAINTABLE                93    ON NOT THERE   S01195
2384 C**N93******RECI      COMP '*'                      93               S01195
     C**N94******          MOVE '   '     ZHC                             S01195
2385 C***********                                                         S01195
2386 C*****STORE*CURRENCIES IF RECORD FOUND.                              S01195
2387 C**N94N93***          MOVEAHCCY      ZHC,1                           S01195
2388 C***94N93***          MOVEAHCCY      ZHC,26                          S01195
2389 C***********                                                         S01195
2390 C*****GET*SECOND RECORD, IF NOT ALREADY DONE.                        S01195
2391 C***********          MOVE ZTABKY    ZWRK1N  10                      S01195
2392 C***********ZWRK1N    COMP 1                        94               S01195
2393 C***********          MOVE '2'       ZTABKY                          S01195
2394 C***94N93***          GOTO ZFHCHN                                    S01195
2395 C***********                                                         S01195
2396 C*****BYPASS TO END IF NO FIRST RECORD FOUND.                        S01195
2397 C***93*94***          GOTO ZFEND                                     S01195
2398 C***********                                                         S01195
2399 C*****DETERMINE HOLIDAY RECORD TYPE.                                 S01195
2400 C***********INEX      COMP 'E'                      95               S01195
2401 C***********INEX      COMP 'I'                      96               S01195
2402 C***********                                                         S01195
2403 C*****CHECK*IF CURRENCY ON HOLIDAY.                                  S01195
2404 C***********ZCCY      LOKUPZHC                      97               S01195
2405 C***********                                                         S01195
2406 C*****BYPASS IF NOT HOLIDAY FOR CURRENCY.                            S01195
2407 C***95*97***                                          EXCLUDE FOUND  S01195
2408 C*R*96N97***          GOTO ZFEND                      INCL. NOT FOUNDS01195
2409 C***********                                                         S01195
2410 C***********                                                         S01195
2411 C***92******          GOTO ZDECR                                     S01195
2412 C***********                                                         S01195
2413 C*****INCREMENT OR DECREMENT DAY NUMBER AS REQUIRED.                 S01195
2414 C***91******ZDAYNO    ADD  1         ZDAYNO                          S01195
2415 C***********                                                         S01195
2416 C*****ONLY*FOR PERIOD CODE = M,T,Q,X OR Y, IF INCREMENTATION         S01195
2417 C*****TAKES*THE OUTPUT DATE INTO THE FOLLOWING MONTH, RETURN TO      S01195
2418 C*****THE*INPUT DATE AND DECREMENT - 92 ON.                          S01195
2419 C***********                                                         S01195
2420 C***90*91***ZINTO     ADD  1         ZINTO                           S01195
2421 C***90*91***ZINTO     ADD  ZDAY      ZINTOT  20                      S01195
2422 C***90*91***          MOVE ZINTOT    ZINTOA  2                       S01195
     C**TO*ALLOW*29 FEB ON LEAP YEARS TO PASS                             S01195
     C***********          SETOF                     93                   S01195
     C***90*91***ZYEAR     DIV  4         ZLYR                            S01195
     C***90*91***          MVR            ZLY            92               S01195
     C***90*91*92ZMTH      COMP 2                        93               S01195
     C***93******ZINTOA    COMP '29'                 92                   S01195
     C***90*91N93ZINTOA    COMP ZFMD,ZMTH            92                   S01195
2424 C***90*91*92ZDAYNO    SUB  ZINTO     ZDAYNO                          S01195
2425 C***90*91*92          MOVE 'DE'      ZINDE                           S01195
2426 C***********                                                         S01195
2427 C***********ZDECR     TAG                             ***ZDECRCTAG***S01195
2428 C***92*95N97                                          EXCL. NOT FOUNDS01195
2429 C*R*92*96*97ZDAYNO    SUB  1         ZDAYNO           INCLUDE FOUND  S01195
2430 C***********          GOTO ZFHCHK                                    S01195
2431 C**
2432 C**
2433 C           ZFEND     ENDSR                           * ZFEND ENDSR *
2434 C**
2435 C********************************************************************
     C/SPACE 3                                                            S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C*  *PSSR --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
     C*                                                                   S01117
     C*  CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                     S01117
     C*                                                                   S01117
     C*  CALLS: NOTHING                                                   S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C********************************************************************S01117
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZINTDYZ2                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,ZDATE9Z3                                               066550
      /EJECT                                                              066550
     C/COPY ZSRSRC,GLINTCZ1                                               066550
     C/EJECT                                                              S01117
     C/COPY ZSRSRC,ZDAT10Z2                                               126017
     C/EJECT                                                              126017
2436 O**
2437 O**   OUTPUT UPDATED FACILITY FILE
2438 ONFACLHH D        01
2439 O                                    1 'H'
2440 ONFACLFM E        60
2441 O*************            LOTF1    256                               122839
2441 O**********               LOTF1   1086                        122839 CLE008
2441 O***********              LOTF1   1106                        CLE008 147261
2441 O**********               LOTF1   1107                        147261 CLE031
2441 O***********              LOTF1   1198                                            CLE031 CGL029
     O*************************LOTF1   1258                                            CGL029 CLE042
     O**********               LOTF1   1263                                          CLE042 BUG22954
     O**********               LOTF1   1269                                          BUG22954 CLE064
     O                         LOTF1   1284                                                   CLE064
2442 ONFACLFN E        60
2443 O**********               LOTF2    256                                                   CGL029
     O/COPY WNCPYSRC,LEH00270
     O                         LOTF2    348                                                   CGL029
     O/COPY WNCPYSRC,LEH00271
2444 O                         CAMD     123P
2445 O                         BITS     131
     O                         PEXP     138P
2446 O                         OAM      246P
2447 ONFACLZZ T        LRNU7
2448 O                         LOTFT    256
2449 O**
2450 O**   OUTPUT UPDATED EVENTS FILE
2451 OLVENTHH D        01
2452 O                                    1 'H'
2453 OLVENTEL E        62
2454 O                                    1 'L'
2455 O**********                          7 '000000'                                          CLE148
     O                                    7 '      '                                          CLE148
2456 O***********              CNUMF     13                               S01117
     O                         EVCNUM    13                               S01117
2457 O                                   17 '71F2'
2458 O                         PAYDAT    20P
2459 O                         CFAMT     27P
2460 O                         FCCY      30
2461 O                         FSNO      32
2462 O***********              BRCDF     39                               S01117
     O                         EBRC      39                               S01117
2463 O                         ZIRATE    45P
2464 O                                   46 'N'
2465 O                         ZERO5     49P
2466 O                         ZERO13    56P
2467 O                         FCCY      59
2468 O                         FCDP      62
2469 O                         DBCE      70P
2470 O                         DBCE      77P
2471 O                         FSPT      84P
2472 O                         CFAMT     91P
2473 O                         FINI     106
2474 O                         SETT     108
2475 O**********               OBAC     120                                                   CGL029
     O                         OBACQQ   120                                                   CGL029
2476 O                         TNAC     130
2477 O***********                       231 'I'                           S01117
     O                         INOUT    231                               S01117
2478 O                         CCPAR    237
2479 O                         PARI     238
2480 O                         CCRNM    258
2481 O                         CCTWN    268
2482 O                         CCASK    276
2483 O                         CRNM     296
2484 O                         CTWN     306
2485 O                         CASK     314
2486 O                         CNUMF    320
     O                         FACT     323
2488 O                         FCNO     325
2489 O                         CRSKF    327
2490 O                         RRSK     329
2491 O                         CDOM     331
2492 O                         RDOM     333
2493 O                                  336 '000'
2494 O                         FREQ     337
2495 O                         ZERO11   344P
2496 O                         ZERO13   351P
2497 O                                  352 'Y'
2498 O                         ACOFF    355
     O****************         ECPY     359                         S01117BHF369
     O****************         IBRE     360                         S01117BHF369
     O****************         ICYE     361                         S01117BHF369
     O****************                  362 ' '                     S01117BHF369
     O****************                  363 'B'                     S01117BHF369
     O****************                  364 'C'                     S01117BHF369
     O****************                  365 'S'                     S01117BHF369
     O                         EBRC     359                               BHF369
     O                         ECPY     362                               BHF369
     O                         IBRE     363                               BHF369
     O                         ICYE     364                               BHF369
     O                                  365 ' '                           BHF369
     O                                  366 'B'                           BHF369
     O                                  367 'C'                           BHF369
     O                                  368 'S'                           BHF369
     O                         ORBR     371                               BHF369
     O                         COOB     374                               BHF369
     O                         BRCA     377                               BHF369
     O                         COBB     380                               BHF369
     O                         OBAC    1088                                                   CGL029
     O/COPY WNCPYSRC,LEH00272
     O                                 1128 '    '                                            CLE042
     O/COPY WNCPYSRC,LEH00273
2499 O        E        65
2500 O                         LOTL1    200
2501 O**********               LOTL2    400                                                   CGL029
     O*************************LOTL2   1088                                            CGL029 CLE042
     O                         LOTL2   1128                                                   CLE042
2502 OLVENTZZ T        LR
2503 O                                    1 'T'
2504 O***********              CONT22     6                               111489
2504 O                         CONT22     6P                              111489
2505 O                         TOTI22    14P
2506 O                         TOTD22    16P
2507 O**
2508 O**    CUSTOMER BILLS & TELEX FILE
2509 OCUTX2HH D        01
2510 O                                    1 'H'
2511 OCUTX2HP E        63
2512 O                                    1 'D'
2513 O                                    2 'F'
2514 O*****                    BRCDF      5                               S01117
     O***********              BRCA       5                         S01117BHF369
     O                         BRCAF      5                               BHF369
2515 O                         CNUMF     11
2516 O**********                         17 '000000'                                          CLE148
     O                                   17 '      '                                          CLE148
2517 O                         PAYDAT    22
2518 O                                   24 '00'
2519 O                                   27 '000'
2520 O                         CNUMF     33
     O                         FACT      36
2522 O                         FCNO      38
2523 O                                   40 '00'
2524 O                         FCCY      43
2525 O                         ZERO13    52P
2526 O                         CFAMT     59P
2527 O                         ZERO13    66P
2528 O                         ZERO13    73P
2529 O                                   75 '00'
2530 O                         ZERO5     79P
2531 O                         ZERO5     82P
2532 O************************ ZERO13    89P     *******
2533 O************************ NACD      97      *******
2534 O************************           99 'Y'  *******
2535 O************************ BTIN     100      *******
     O*                                                                   E12742
2532 O************************ ZERO15    90P                              E12742
2533 O************************ NACD      98                               E12742
2534 O************************          100 'Y'                           E12742
2535 O************************ BTIN     101                               E12742
     O*                                                                   E12742
2532 O                         ZERO13    89P                              E12742
2533 O                         NACD      97                               E12742
2534 O                                   99 'Y'                           E12742
2535 O                         BTIN     100                               E12742
     O*                                                                   E12742
     O                         SCCY     103                               CLE031
     O                         SEXR     110P                              CLE031
     O                         SEXI     111                               CLE031
2536 OCUTX2ZX T        LR
2537 O                                    1 'T'
2538 O                         COUNT3     4P
2539 O**
2540 O**   RECEIVE TELEX FILE
2541 OCFTLXHH D        01
2542 O                                    1 'H'
2543 OCFTLXPR E        64
2544 O                                    1 'D'
2545 O                                    2 'R'
2546 O                         SETT       4
2547 O                         FCCY       7
2548 O**********               OBAC      19                                                   CGL029
     O                         OBACQQ    19                                                   CGL029
2549 O                         PAYDAT    22P
2550 O                         TNAC      32
2551 O                         CNUMF     38
2552 O                         FCLN      44
2553 O                         CFAMT     51P
2554 O                                   52 'F'
2555 O                                   57 '000'
2556 O                                  158 '0'
2557 O                                  159 '0'
2558 O                                  160 '1'
2559 O                                  161 '0'
2560 O                         BICN     167
2561 O                                  173 '00'
2562 O                                  174 '4'
2563 O*****                    BRCDF    177                               S01117
     O***********              BRCA     177                         S01117BHF369
     O                         BRCAF    177                               BHF369
2564 O                                  178 'N'
     O                         CFBR     181                               S01117
     O                         SEXR     213P                              CLE031
     O                         SEXI     214                               CLE031
     O                         OBAC     232                                                   CGL029
2565 OCFTLXZZ T        LR
2566 O                                    1 'T'
2567 O                         COUNT4     4P
2568 O                         TOTI4     12P
2569 O                         TOTD4     14P
2570 O**
2571 O**    DATABASE IN ERROR
2572 O*E0490P1T**203***LR U7                                       S01124 S01117
     OLE0490AUT  203   LR U7                                              S01117
2573 O*****                              22 'REFERENCE LE0490'            S01117
2573 O                                   24 'REFERENCE LE0490AU'          S01117
2574 O                         TITL      89
2575 O                                  104 'DATE'
2576 O                         RUNA     112
2577 O                                  120 'PAGE'
2578 O                         PAGE  Z  127
2579 O        T  1     LR U7
2580 O                                   76 'COMMITMENT FEE EVENTS'
2581 O        T  3     LR U7
2582 O                                   76 '---------------------'
2583 O        T 32     LR U7
2584 O                                   42 '*** REFERENCE'
2585 O                         DBPGM     51
2586 O***********                        71 '- DATABASE ERROR AT'         S01117
2587 O***********              DBASE     74                               S01117
2586 O                                   71 'DATABASE ERROR AT'           S01117
2587 O                         DBASE     75                               S01117
2588 O        T        LR U7
2589 O***********                        37 'FILENAME'                    S01117
2590 O***********              DBFILE    43                               S01117
2591 O***********                        48 'KEY'                         S01117
2592 O***********              DBKEY     78                               S01117
2589 O                                   39 'FILENAME'                    S01117
2590 O                         DBFILE    48                               S01117
2591 O                                   52 'KEY'                         S01117
2592 O                         DBKEY     82                               S01117
2593 O**
2594 O**   FILE CONTROL REPORT
2595 O        T  203   LR
2573 O*****                              22 'REFERENCE LE0490'            S01117
2573 O                                   24 'REFERENCE LE0490AU'          S01117
2597 O                         TITL      89
2598 O                                  104 'DATE'
2599 O                         RUNA     112
2600 O                                  120 'PAGE'
2601 O                         PAGE  Z  127
2602 O        T        LR
2603 O                                   68 'COMMITMENT FEE EVENTS - '
2604 O                                   81 'FILE CONTROLS'
2605 O        T  3     LR
2606 O                                   68 '------------------------'
2607 O                                   81 '-------------'
2608 O        T        LR
2609 O                                   28 'S/FCUPD - RUN CONTROLS'
2610 O                                   59 'NUMBER'
2611 O                                   84 'VALUE'
2612 O        T  2     LR
2613 O                                   28 '----------------------'
2614 O                                   59 'OF RECORDS'
2615 O                                   84 'OF RECORDS'
2616 O        T  2     LR
2617 O                                   29 'TOTAL RECORDS ON FILE'
2618 O                         NORE1 3   59
2619 O                         VLAF  Z   81
2620 O                         VLAL      84
2621 O        T  3     LR
2622 O                                   32 'TOTAL RECORDS ON FILE - '
2623 O                                   42 'CALCULATED'
2624 O                         COUNT13   59
2625 O                         TOTI1 Z   81
2626 O                         TOTD1     84
2627 O                    80            111 '***   DIFFERENCE   ***'
2628 O        T        LR
2629 O                                   28 'S/LVNTS - RUN CONTROLS'
2630 O        T  2     LR
2631 O                                   28 '----------------------'
2632 O        T  2     LR
2633 O                                   29 'TOTAL RECORDS ON FILE'
2634 O                         NORE2 3   59
2635 O                         HRWN2 Z   81
2636 O                         HRDC2     84
2637 O        T  3     LR
2638 O                                   32 'TOTAL RECORDS ON FILE - '
2639 O                                   42 'CALCULATED'
2640 O                         COUNT23   59
2641 O                         TOTI2 Z   81
2642 O                         TOTD2     84
2643 O                    81            111 '***   DIFFERENCE   ***'
2644 O        T        LR
2645 O                                   28 'S/NFACL - RUN CONTROLS'
2646 O        T  2     LR
2647 O                                   28 '----------------------'
2648 O        T  3     LR
2649 O                                   29 'TOTAL RECORDS ON FILE'
2650 O                         COUNT13   59
2651 O                         TOTI1 Z   81
2652 O                         TOTD1     84
2653 O        T        LR
2654 O                                   28 'S/LVENT - RUN CONTROLS'
2655 O        T  2     LR
2656 O                                   28 '----------------------'
2657 O        T  3     LR
2658 O                                   29 'TOTAL RECORDS ON FILE'
2659 O                         CONT223   59
2660 O                         TOTI22Z   81
2661 O                         TOTD22    84
2662 O        T        LR
2663 O                                   28 'S/CUTX2 - RUN CONTROLS'
2664 O        T  2     LR
2665 O                                   28 '----------------------'
2666 O        T  3     LR
2667 O                                   29 'TOTAL RECORDS ON FILE'
2668 O                         COUNT33   59
2669 O        T        LR
2670 O                                   28 'S/CFTLX - RUN CONTROLS'
2671 O        T  2     LR
2672 O                                   28 '----------------------'
2673 O        T  3     LR
2674 O                                   29 'TOTAL RECORDS ON FILE'
2675 O                         COUNT43   59
2676 O********T*3      LR                                                 S01117
2677 O***********                        76 '*** END OF REPORT ***'       S01117
**  TABVAL - TABLE OF VALID EVENT TYPES AFFECTING FCLTY EXPOSURE
V1V3R1M1
** POWR -- ARRAY OF POWERS
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
