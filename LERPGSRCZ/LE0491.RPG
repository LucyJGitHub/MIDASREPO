     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Facility and events update')                  *
/*O*RF*:*OVRDBF*GLACP1L2*APOSTL11**************************************              CLE040 MD026119
/*XBI *  OVRDBF FILE(GLACP1L2) TOFILE(APOSTL12)                       *                     MD026119
     F*****************************************************************
     F*                                                               *
     F*  Midas - Customer Lending Module                              *
     F*                                                               *
     F*  LE0491 - Update Facilities File                              *
     F*                                                               *
     F*  Function: To update facilities file for Current Exposure     *
     F*            Amount Drawn, Previous Exposure, and Drawn Amount. *
     F*                                                               *
     F*            Also to copy Events from LVNTS to LVENTEL, dropping*
     F*            dummy events.                                      *
     F*                                                               *
     F*            Events processed by this program:                  *
     F*                                                               *
     F*            A1 - Dummy Event                                   *
     F*            V1 - Start Event                                   *
     F*            V3 - Principal Increase                            *
     F*            V5 - Principal Transfer To                         *   CLE004
     F*            R1 - Principal Repayment                           *
     F*            R7 - Principal Transfer From                       *   CLE004
     F*            M1 - Maturity Event                                *
     F*            I2 - Interest Repayment                            *
     F*            I2 with blank input/output indicator is a          *
     F*            capitalisation event.                              *
     F*            X2 - Interest Capitalisation Event                 *   118870
     F*                                                               *
     F*  (COB)                                                        *
     F*                                                               *
     F*  Called By:  LEC0609 - EM LE Events File Creation             *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD055950           Date 23Jun20               *
      *  Prev Amend No. MD050139           Date 23Mar18               *
      *                 MD044153           Date 07Apr18               *
      *                 CLE169             Date 07Apr18               *
      *                 CLE168             Date 26Feb18               *
      *                 MD046248           Date 27Oct17               *
      *                 CDL099             Date 06Oct17               *
      *                 CGL184             Date 07Dec16               *
      *                 MD042841           Date 21Dec16               *
      *                 CLE154             Date 06Aug12               *
      *                 AR1057175          Date 17Jun16               *
      *                 MD024229           Date 18Feb15               *
      *                 CGL165             Date 17Feb15               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 01Sep14               *
      *                 255811             Date 19Aug14               *
      *                 MD026119           Date 18Feb14               *
      *                 MD021155           Date 03Jul13               *
      *                 AR1042766          Date 24Oct12               *
      *                 AR1075061          Date 28Feb12               *
      *                 CLE075AF           Date 06Aug12               *
      *                 AR1023928A         Date 07Jan13               *
      *                 AR574425           Date 01Aug12               *
      *                 AR544187           Date 01Aug12               *
      *                 263840A            Date 01Aug12               *
      *                 263840             Date 01Aug12               *
      *                 262892             Date 01Aug12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CLE147             Date 30Sep11               *
      *                 AR677807           Date 14Dec10               *
      *                 CLE139             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG22954A          Date 04Mar09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CAP204             Date 09Feb10               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247896             Date 18May07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 244282             Date 06Dec06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 216641             Date 02Nov06               *
      *                 241629A            Date 27Sep06               *
      *                 240998             Date 31Aug06               *
      *                 229247             Date 06Jun06               *
      *                 239983             Date 25May06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG8707            Date 21Oct05               *
      *                 CLE042             Date 06Sep05               *
      *                 CLE106             Date 15Feb05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 BUG7643            Date 11Jul05               *
      *                 CLE041             Date 15Oct04               *
      *                 CDL028             Date 07Feb05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG5286            Date 20Dec04               *
      *                 BUG4510            Date 11Oct04               *
      *                 CLE040             Date 05Jul04               *
      *                 BUG3644            Date 12Jul04               *
      *                 BUG3382            Date 22Jun04               *
      *                 BUG3281            Date 17Jun04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CAP073             Date 08Aug02               *
      *                 CLE029             Date 04Sep02               *
      *                 CLE034             Date 21May03               *
      *                 CLE031             Date 07Feb03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 204531             Date 09Jan03               *
      *                 211579             Date 09Jan03               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 209504             Date 17Sep02               *
      *                 206593             Date 25Jul02               *
      *                 206300             Date 06Jun02               *
      *                 204716             Date 26Apr02               *
      *                 199220             Date 26Apr02               *
      *                 195865             Date 26Apr02               *
      *                 204450             Date 25Apr02               *
      *                 204446             Date 25Apr02               *
      *                 204708             Date 25Apr02               *
      *                 204671             Date 25Apr02               *
      *                 204663             Date 25Apr02               *
      *                 204557             Date 25Apr02               *
      *                 204435             Date 25Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP068             Date 25JUN02               *
      *                 203074             Date 14Feb02               *
      *                 203070             Date 14Feb02               *
      *                 CLE023             Date 19Nov01               *
      *                 193603             Date 31Aug01               *
      *                 194380             Date 23Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 199588             Date 31Oct01               *
      *                 180041             Date 30Jun01               *
      *                 151104             Date 15Jun01               *
      *                 CLE014             Date 20Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      *                 162343             Date 29Dec00               *
      *                 184606             Date 12Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 163791             Date 01Nov00               *
      *                 171691             Date 24Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 179912             Date 22Jun00               *
      *                 158317             Date 20Apr99               *
     F*                 167498             Date 18Jan00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 163486             Date 14Oct99               *
     F*                 CLE009             Date 11May99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 157645             Date 07May99               *
      *                 157597             DATE 21Mar99               *
      *                 157887             Date 29Jul98               *
      *                 157210             Date 18Mar99               *
      *                 156229             Date 05Mar99               *
      *                 CLE008             Date 10Dec98               *
      *                 154799             Date 04Mar99               *
      *                 154557             Date 04Mar99               *
      *                 151295             Date 04Mar99               *
      *                 149917             Date 04Mar98               *
      *                 147261             Date 04Mar99               *
      *                 144712             Date 04Mar98               *
      *                 141475             Date 18Feb99               *
      *                 128980             Date 03Jan99               *
     F*                 133342             Date 16JUN98               *
     F*                 128134             DATE 19MAY98               *
     F*                 118870             DATE 23FEB98               *
     F*                 127720             Date 25Nov97               *
     F*                 127659             Date 13Nov97               *
     F*                 CLE005             Date 22May97               *
     F*                 123855             Date 07Oct97               *
     F*                 CLE004             Date 02Dec96               *
     F*                 109148             DATE 12SEP97               *
     F*                 105140             DATE 18NOV96               *
     F*                 S01408             DATE 12AUG96               *
     F*                 101987             DATE 29MAY96               *
     F*                 091158             DATE 02AUG95               *
     F*                 S01473             DATE 01AUG94               *
     F*                 S01434             DATE 07FEB94               *
     F*                 054108 (BH4608)    DATE 27APR93               *
     F*                 045634             DATE 26APR93               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD055950 - Field AUTH in file FCLTYFM got overwritten in COB.*
      *           - Apply logic of MD-42841.                          *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD044153 - Fix to be formalised. Relates to FCM007.          *
      *             Need to rename fields for APOSTL4 as corrupt data *
      *             in others files                                   *
      *             Applied for CLE169.                               *
      *  CLE169 - Contingent Accounting Changes for Overdraft.        *
      *  CLE168 - Allow Debit of Blocked Account (Recompile)          *
      *  MD046248 - Finastra Rebranding                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  MD042841 - Component CGC2050 00020 failed during COB         *
      *  CLE154 - Loan Repayment Schedule Enhancement (Recompile)     *
      *  AR1057175 - ORBR field still being overwritten.              *
      *              Applied for MD038472                             *
      *  MD024229 - Facility Amount for expired facilities wrongly    *
      *             calculated on Java enquiry screen.                *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  255811 - Facility available in LE0720P1 does not include     *
      *           the debit/credit interest charges due for the same  *
      *           day for the linked account. Chain to CLEARPD to     *
      *           include interest charges.                           *
      *  MD026119 - COM changes, LE0491 code fix                      *
      *  MD021155 - COB Restructure Phase 1 remnants                  *
      *           - Calculation of balance when ABC on is adding      *
      *             GLACNTQD to balance instead of just getting       *
      *             balance from this file - double counting          *
      *  AR1042766 - Facility file fields overwritten.                *
      *            - Rename ORED, ORBR, REPI and REPA to prevent      *
      *              being overwritten in the facility file.          *
      *              (Child: AR1042767)                               *
      *  AR1075061 - Field AUTH of PF/NFACLFM is overwritten          *
      *  CLE075AF - COB Restructure - LE COB Optimisation Phase 1     *
      *  AR1023928A - Contingent entry for facility linked to retail  *
      *               account produces extra repayment account key.   *
      *               Ensure correct exposure for account movements.  *
      *               Apply part of fix AR669447. (Child: AR1023929A) *
      *  AR574425 - CLE134 Retention period issues                    *
      *             (Child: AR574426)                                 *
      *  AR544187 - CLE134 Performance enhancements for LEC07012      *
      *             component                                         *
      *             (Child: AR544189)                                 *
      *  263840A - For PDCLs check value of FAMU before including in  *
      *            the Utilisation & Availability calculations.       *
      *  263840 - Correct update of facility utilisation for PDCLs.   *
      *  262892 - Facility Exposure not updated by PDCL process       *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  CLE147 - Aggregate Facility (Recompile)                      *
      *  AR677807 - LE03150 Participant Facilities By Prime Facility  *
      *             Erroneous Customer Lending Value For Credit       *
      *             Agreement Facilities                              *
      *  CLE139 - Lending Fee Capitalisation                          *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG22954A - Incorrect update of facilities file after COB    *
      *              (Recompile)                                      *
      *  CAP204 - Teller Related APIs - Account Transfer (Recompile)  *
      *  247896 - Front office Id field in FLCTYFM is corrupted.      *
      *  244282 - Current Available and Exposure amount not accurate  *
      *           on Outstanding facility by customer. Apply 235444.  *
      *  235444 - Current Exposure of Prime Facility was negative.    *
      *  216641 - The available amount of the Credit Agreement is     *
      *           affected by the expiration of the tranche. Do not   *
      *           write a record to LECAUTPD if the facility has      *
      *           already expired, so as to prevent the update of the *
      *           Credit Agreement's drawn amount.                    *
      *  241629A - Avoid duplicate weighting code (Recompile)         *
      *  240998 - Runtime issue (Lending Events File creation)        *
      *  229247 - Rename ORED and CNUM from LELOANLF introduced by    *
      *           CLE004.                                             *
      *  239983 - Available amount in TR does not match the available *
      *           amount in CA.                                       *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG8707 - When next computed review date is greater than     *
      *            current expiry date, blank out review details      *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CLE106 - Syndication Manager                                 *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  BUG7643 - Facility Originating Branch missing after close of *
      *            business                                           *
      *  CLE041 - Collateralised Lending Phase 2B (Recompile)         *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG5286 - Wrong type for branch code                         *
      *  BUG4510 - Database error due to blank Instrument Code in     *
      *            PF/SDACODPD                                        *
      *  CLE040 - Collateralised Lending Phase 2                      *
      *  BUG3644 - Serious Error in Collateralised Lending            *
      *  BUG3382 - Facilities popup called from deals input shows an  *
      *            available amount of ZERO when a credit line has    *
      *            been drawn upon                                    *
      *  BUG3281 - Discrepancies on sources                           *
      *  CLE025 - Credit Lines                                        *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CAP073 - Conversion of MN inputs into modular structure to   *
      *           use as APIs. Facility input Transaction Details     *
      *  CLE029 - Addition of Severity code and Limit ID to FCLTYFM   *
      *  CLE034 - Lending Enhancements Phase 1 Priority 1A            *
      *  CLE031 - Lending Enhancements.                               *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enahancements to CAS001, CAS002 and CAS004          *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  204531 - Part sold loans attached to participant facilities  *
      *           should not update the drawn amount fields of the    *
      *           primary facility. Insert additional condition to en-*
      *           sure non-update of drawn amount field for this case.*
      *  211579 - Rename ORED from CLOANCLF, CLOANCKF, and LEFCAPPF   *
      *           to prevent update of ORED in NFACLFM and NFACLFN.   *
      *  209504 - Current amount drawn, exposure & availability of a  *
      *           Credit Agreement is wrong if Loan Ccy = CA Ccy. Do  *
      *           not convert from event ccy to TR ccy then to CA ccy.*
      *           Just use the event amount, without conversion.      *
      *  206593 - Previous exposure should not be updated for         *
      *           maturity event for non-auto settle loan.            *
      *  206300 - Availability in error when loan with no rollover    *
      *           date was processed. Do not convert amount for WNAMT *
      *           unless there is a rollover to a new rate.           *
      *  204716 - Availability in error when RC is inserted for a     *
      *           facility.  Processing for projection of repayments  *
      *           should consider an RC change with respect to the    *
      *           event date and value date of RC.                    *
      *  199220 - Addition to 195865, to cater for RC events valued   *
      *           before accruals/profit date, when BKAPFQ = 'D'.     *
      *  195865 - Facility's revolving credit indicator is changed    *
      *           in COB when an RC (revolving credit indicator       *
      *           change) is inserted during the day regardless of    *
      *           the amendment's value date.  Caused by RVCR field   *
      *           from LELEFAL1.  New RVCR field is written to        *
      *           NFACLFM (New Facilities file detail A) only if the  *
      *           facility amendment date is past the rundate.        *
      *  204450 - Reactivated loan should be considered in facility   *
      *           exposure.  Consider Autosettlement indicator before *
      *           updating exposure.                                  *
      *  204446 - Available amount in correct due to future 'RC'      *
      *           amendment with loan repayment date and maturity date*
      *           within the next 8 days.                             *
      *  204708 - Non-autosettled repayments should update OAM amount *
      *           on an autosettled loan's maturity date, because the *
      *           Maturity Event amount has already been reduced by   *
      *           the Repayment amount.                               *
      *  204671 - Reverse part of core fix 171691.  Autosettle flag   *
      *           should always be checked for projections, not just  *
      *           on event date.                                      *
      *  204663 - Current exposure for Credit Agreement not updated   *
      *           correctly.                                          *
      *  204557 - System may use incorrect value for autosettle flag  *
      *           when loan with autosettle 'N' has scheduled         *
      *           repayment with autosettle 'Y'.  Rename AUTO to      *
      *           ensure value from event is always used.             *
      *  204435 - Store autosettle flag on LECAUTPD to prevent        *
      *           corruption of availability in SR/AVAIL.             *
      *  CAP068 - Recompiled for changes to FCLTYFM and FCLTYFN.      *
      *  203074 - CAMD of CA is incorrectly updated for parts sold    *
      *           without recourse.                                   *
      *  203070 - Do not update drawn amounts when event is for       *
      *           participant facilities when the facility being      *
      *           processed is a Credit Agreement or a Tranche.       *
      *  CLE023 - Lending Facility History Improvements.              *
      *  193603 - Hash total must take account of negative FAMT       *
      *  194380 - Remove fix 167498 so that hash totals are calculated*
      *           using absolute value.                               *
      *  199588 - Facility history should use fixed rate.             *
      *           Reverse fix 162343. Fixed FCXR rate will be used to *
      *           convert facility history amounts.                   *
      *  180041 - Check loan capitalisation indicator before updating *
      *           facility drawn amounts for an interest payment      *
      *           event.                                              *
      *  151104 - Increase size of branch code & related array so that*
      *           it can hold up to 900 elements.                     *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
     F*  162343 - Facility update should use spot rate.               *
     F*  184606 - Expired facilities and still shown.  Incorrect      *
     F*           available amount was shown.                         *
     F*  163791 - Wrong facility available amount because OAM (drawn  *
     F*           amount) is not updated for participations sold. Fix *
     F*           was to rename CNUM in PF/CLOANCL to eliminate over- *
     F*           lapping of CNUM with LF/FCUPD.                      *
      *  171691 - Exposure should not be reduced by non-auto settle   *
      *           principal repayment upon value date. Availability   *
      *           however, should be updated against the expected     *
      *           repayment date but upon value date of the           *
      *           repayment, should be adjusted according to the      *
      *           auto settlement indicator.                          *
      *  179912 - Profit Center is being overwritten.                 *
     F*  158317 - Facility billing days value was overwritten with    *
     F*           loan billing days value.  Patterned fix from 101987.*
     F*  167498 - Due to fix 159499 in LER020, related to CLE005,     *
     F*           facility amount can now be negative; therefore need *
     F*           to total actual value, not hash total, to ensure    *
     F*           calculated value matches totals calc in LE0461.     *
      *  163486 - Recompiled due to changes to LVNTS.                 *
     F*  CLE009 - LE I/C Swift Message Generation for Fees (Recompile)*
      *  157645 - Principal transfer cause availability of the        *
      *           facility to decrease.                               *
      *  157597 - Fix 156229 should not add reactivated amount to     *
      *           trailer calculated value.                           *
     F*  157887 - PCRF field corrupted by CLOAN field with same name  *
      *  157210 - Do not delete review date if it is in the past and  *
      *           no frequency is entered.                            *
      *  156229 - For Facility Reactivations FCUPD has not yet had    *
      *         - RECI set to 'D', causing record to be ignored.      *
      *  CLE008 - Recompiled For Loan Administrator Id                *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  154557 - Internal funding participant facility available     *
      *           amount is not zero eventhough the facility is       *
      *           fully drawn.                                        *
      *  151295 - Problems authorising repayment schedules            *
      *           Recompiled due to changes in ZCHKH                  *
      *  149917 - OAM* of an Internal facility is not updated         *
      *           correctly when used as a participant in an IPP.     *
      *  147261 - Add Assignment/Participation indicator (Recompiled) *
      *  144712 - Change revolving to non-revolving, changes history. *
      *           Applied fix 143124.                                 *
      *           Reversed fix 091158 so that facility exposure is    *
      *           recalculated every night using the correct spot rate*
      *  141475 - Beneficiary details blanked out on funding part     *
      *           settle instructions after eod.                      *
      *  128980 - Tranche does not show historic details of           *
      *           participant transactions                            *
     F*  133342 - Execute SR/AVAIL even if CLE004 is not ON.          *
     F*           Remove condition checking if CLE004 is ON.          *
     F*  128134 - OAM not being updated because *IN05 is not set off. *
     F*  118870 - Interest capitalisation event (X2) should be        *
     F*           processed when updating the exposure and            *
     F*           availability of the facility.                       *
     F*  127720 - New Processing types not being checked.  No CAMD    *
     F*           update for Credit Agreement.                        *
     F*  127659 - Facility trailer fields overwritten                 *
     F*  CLE005 - Customer Lending Enhancements - Others (T3)         *
     F*  123855 - FOOB in LE events file, count2 is doubled           *
     F*  CLE004 - Customer Lending Enhancements - Syndications.       *
     F*  109148 - Include calculation of next Review Date. Applied fix*
     F*           092528.                                             *
     F*  105140 - Recompile over changed LVENTZZ.                     *
     F*           Field NORE  attribute changed.                      *
     F*  S01408 - Core Hook LE0491CCP7 Added                          *
     F*         - Core Hook LE0491CCP6 Added                          *
     F*         - Core Hook LE0491CCP5 Added                          *
     F*         - Core Hook LE0491CCP4 Added                          *
     F*         - Core Hook LE0491CCP3 Added                          *
     F*         - Core Hook LE0491CCP2 Added                          *
     F*         - Core Hook LE0491CCP1 Added                          *
     F*  101987 - During input cycle an address reference was changed *
     F*           to a value other than 'B'.  After COB, the address  *
     F*           reference had been changed to 'B'.                  *
     F*           A CHAIN is done in SR CONV to LF/CLOAN to get the   *
     F*           facility-loan ccy exchange rate, with this, the     *
     F*           field NACD of the facility is overwritten by the    *
     F*           NACD of PF/CLOANCL, therefore the error.            *
     F*  091158 - For facility availablity calculate value at rate    *
     F*           specified on the loan rather than the spot rate     *
     F*  S01473 - LEO/Midas R10 Interface. Inclusion of "LE" LEO  *
     F*           events (generated by CMIU40):                       *
     F*           85A1 - L/C liability outstanding                    *
     F*           85M1 - L/C liability at expiry                      *
     F*           86A1 - Negotiation liability outstanding            *
     F*           86M1 - Negotiation liability at settlement          *
     F*  S01434  - Recompiled for change to ZFWDT subroutine.         *
     F*  054108  -  Remove A1 event amounts from trailer.             *
     F* (BH4608)                                                      *
     F*  045634  -  Update ONLINE POSITIONS                           *
     F*             Events only OUTPUT by LE0492                      *
     F*                                                               *
     F*****************************************************************
     F/COPY WNCPYSRC,LE0491F001
     FFCUPD   IF  E           K        DISK
     F***LVNTS***IF  E           K        DISK                            144712
     FLVNTS   IF  E           K        DISK                           UC  144712
     F            LVENTZZF                          KIGNORE               054108
     FLVNTXZZ UF  E                    DISK         KINFSR *PSSR          054108
     FLEEVLOPDIF  E           K        DISK                               S01473
     F/COPY WNCPYSRC,LE0491F003
     FCLOAN   IF  E           K        DISK                               091158
     F            CLOANHHF                          KIGNORE               091158
     F**********  CLOANCKF                          KIGNORE                            091158 CLE023
     F            CLOANZ1F                          KIGNORE               091158
     F/COPY WNCPYSRC,LE0491F004
     F***SDCURRPDIF  E                    DISK                                               BUG3382
     FSDCURRL1IF  E           K        DISK                                                 CLE075AF
     FSDBRCHPDIF  E                    DISK
     FLELOANL7IF  E           K        DISK                               CLE004
     F            CLOANCLF                          KRENAMELELOANLF       CLE004
     FLELVNTL1IF  E           K        DISK                               CLE004
     F            LVENTELF                          KRENAMELELVNTLF       CLE004
     FLENFCTL0IF  E           K        DISK                           UC  CLE005
     F            FCLTYFMF                          KRENAMELENFCTLM       CLE005
     F**LELEFAL1IF**E***********K********DISK***************************UC* 144712            195865
     FLELEFAL1IF  E           K        DISK         KINFDS FSDS       UC                      195865
     F            LVENTELF                          KRENAMELEFAL1F        144712
     FLEFCLTLHUF  E           K        DISK         KINFSR *PSSR                              CLE025
     FDLDLDBL2IF  E           K        DISK         KINFSR *PSSR                              CLE025
     FDLDLDCL2IF  E           K        DISK         KINFSR *PSSR                              CLE025
     FDLDLDGLLIF  E           K        DISK         KINFSR *PSSR                              CLE025
     FDEALS   IF  E           K        DISK         KINFSR *PSSR                              CLE025
     F            DEALSDAF                          KIGNORE                                   CLE025
     F            DEALSDDF                          KIGNORE                                   CLE025
     F            DEALSDEF                          KIGNORE                                   CLE025
     F            DEALSDFF                          KIGNORE                                   CLE025
     FACCNTLA IF  E           K        DISK         KINFSR *PSSR                              CLE025
     FRSACMTL7IF  E           K        DISK         KINFSR *PSSR                              CLE025
     FGLACNTL4IF  E           K        DISK         KINFSR *PSSR                            CLE075AF
     FGPWEIGL0IF  E           K        DISK         KINFSR *PSSR                              CLE025
     FGLACP1L2IF  E           K        DISK         KINFSR *PSSR                              CLE040
     FLECAUTL0UF  E           K        DISK         KINFSR *PSSR A    UC  CLE005
     FLENFCTL1UF  E           K        DISK         KINFSR *PSSR      UC  CLE005
     F            FCLTYFNF                          KRENAMELENFCTLN       CLE005
     FNFACLHH O   E                    DISK         KINFSR *PSSR
     ***  Output of new updated facility file
     F            FCLTYHHF                          KRENAMENFACLHHF
     FNFACLFM O   E                    DISK         KINFSR *PSSR
     F            FCLTYFMF                          KRENAMENFACLFMF
     F/COPY WNCPYSRC,LE0491F005
     FNFACLFN O   E                    DISK         KINFSR *PSSR
     F            FCLTYFNF                          KRENAMENFACLFNF
     F/COPY WNCPYSRC,LE0491F006
     FNFACLZZ O   E                    DISK         KINFSR *PSSR
     F            FCLTYZZF                          KRENAMENFACLZZF
     F/COPY WNCPYSRC,LE0491F002
     F*LVENTHH*O*  E                    DISK         KINFSR *PSSR         045634
     *****Output*to*events*file*to*include*fee*events***************      045634
     F***********  LVENTHHF                          KRENAMEOLVENTHH      045634
     F*LVENTEL*O*  E                    DISK         KINFSR *PSSR         045634
     F***********  LVENTELF                          KRENAMEOLVENTEL      045634
     F*LVENTZZ*O*  E                    DISK         KINFSR *PSSR         045634
     F***********  LVENTZZF                          KRENAMEOLVENTZZ      045634
      *
     FLEFCAML0IF  E           K        DISK                               156229
     F            LEFCAMPF                          KRENAMELEFCAMRE       156229
     FAPOSTL4 IF  E           K        DISK         KINFSR *PSSR                              CLE169
     F            APOSTPDF                          KRENAMEAPOSTL4F                           CLE169
     F            GLACPHPF                          KIGNORE                                   CLE169
      *                                                                                       255811
     FCLEARL1 IF  E           K        DISK                                                   255811
     F            APOSTPDF                          KRENAMECLEARPDF                           255811
      *                                                                                       CLE025
     FLELOMKL2IF  E           K        DISK                                                   CLE134
     F            LOAMSDKF                          KRENAMELELOMKKF                           CLE134
     FLENEWLL1IF  E           K        DISK                                                   CLE134
     F            CLOANCLF                          KRENAMELENEWLDF                           CLE134
     FLEPDUEL6IF  E           K        DISK                                                  263840A
     FLEPDUFLAIF  E           K        DISK                                                  263840A
     FLE0491P1O   E             82     PRINTER      KINFDS SPOOL1                             CLE025
      ** Error Report                                                                         CLE025
      *                                                                   156229
     FLE0491AUO   E                    PRINTER
     ***  Audit report
      *
     F/EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*    01  - Currency array set up                                *
     F*    02  - Branch internal number array set up                  *
     F*    03  - Read of updated facilities file                      *
     F*    04  - Read of loan events file                             *
     F*    05  - Interbranch participation                            *
     F*    06  - Event type I2 with blank input/output indicator      *
     F*    07  - Valid event                                          *
     F*    09  - LOKUP of RUNS array                                  *
     F*    13  - LOKUP of CURR array for from currency                *
     F*    14  - LOKUP of CURR array for to currency                  *
     F*    15  - LOKUP of CARN array                                  *   CLE005
     F*    20  - Read of LEO events file PF/LEEVLOPD                  *   S01473
     F*    21  - MIDAS/LEO INTEGRATION FEATURE PRESENT                *   S01473
     F*    22  - CHAIN to CLOAN ended in error                        *   091158
     F*    23  - Participant Facility Update                          *   CLE004
     F*    24  - Read on LELOANL7                                     *   CLE004
     F*    25  - Read on LELVNTL1                                     *   CLE004
     F*    26  - Read on LENFCTL0                                     *   CLE005
     F*    27  - Read on LENFCTL1                                     *   CLE005
     F*    28  - Read on LECAUTL0                                     *   CLE005
     F*    29  - LEFCAML0 end-of-file                                 *   156229
      *    46  - Cache Hit for Instrument Types                       *                     CLE075AF
      *    47  - Cache Hit for Weighting Codes                        *                     CLE075AF
      *    48  - Cache Hit for Account Codes                          *                     CLE075AF
     F*                                                               *
     F*  U7+U8 - Database Error                                       *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  INIT   - Program Initialisation                              *
     F*  PROCES - Detail Processing                                   *
     F*  SRMOVE - Move fields to file fields                          *   CLE005
     F*  SRUPDF - Update Processing                                   *   CLE005
     F*  EVENT  - Event Processing                                    *
     F*  LEOVNT - LEO event Processing                                *   S01473
     F*  EXPSR  - Update of facility exposure                         *
     F*  AVAIL  - Update of availability array                        *
     F*  CONV   - Currency conversion                                 *
     F*  *PSSR  - Program Error Processing Subroutine                 *
     F*  AUDIT  - Produce Audit Report and End Program                *
     F*  ZXRATE - Access Holidays for Currency/Location               *
     F*  ZCONV  - Convert Amount to Another Currency                  *
     F*  ZFWDT  - Obtain day number for n working days forward        *
     F*  ZACCH  - Access a holiday record for a particular currency   *
     F*           and (optional) location.                            *
     F*  ZHASH  - Hash totalling processing                           *
      *  CHKINS - Check Instrument Types details in array             *                     CLE075AF
      *  ADDINS - Add Instrument Types details in array               *                     CLE075AF
      *  CHKWEI - Check Weighting Codes details in array              *                     CLE075AF
      *  ADDWEI - Add Weighting Codes details in array                *                     CLE075AF
      *  CHKACD - Check Account Codes details in array                *                     CLE075AF
      *  ADDACD - Add Account Codes details in array                  *                     CLE075AF
     F*                                                               *
     F*****************************************************************
     E/EJECT
     E                    CPY@    1   1 80               COPYRIGHT
     E***********         TABVAL  4   4  2               VALID EVENT TYPESCLE004
     E***********         TABVAL  6   6  2               VALID EVENTCLE004118870
     E**********          TABVAL  7   7  2                                118870              CLE028
     E**********          TABVAL  8   8  2                                             CLE028 CLE139
     E                    TABVAL  9   9  2                                                    CLE139
     E                    POWER   1   7  7 3             POWER ARRAY
     E                    RUNS       10  5 0A            FCLTY AVAIL DATES
     E                    OAM        10 13 0             FCLTY AVAIL AMTS
     E                    FEEM        5 11 0A            FEE AMOUNTS
     E                    FRT         5  7 5A            FEE RATES
     E                    CURR      150  3               ALL CCYS
     E                    CSPT      150 13 8             SPOT RATES/CCY
     E/COPY WNCPYSRC,LE0491E001
     E                    MTDV      150  1               M/D INDICATOR/CCY
     E                    CCDP      150  1 0             DEC PLACES/CCY
     E                    CCNO      150  2 0             SORT SEQ.NO/CCY
     E***********         BCA       150  6               BRCH INT. CUST   151104
     E                    BCA       900  6               BRCH INT. CUST   151104
     E                    INT         6 15 0             ZHASH INTEGERS
     E                    DEC         6  3 0             ZHASH DECIMALS
     E                    CARN       10  5 0A                             CLE005
     E                    CAOA       10 13 0                              CLE005
     E                    EXPA       10 13 0                                                  CLE025
     E                    OFFS       10 13 0                                                  CLE025
     E                    MARQ       10 13 0                                                  CLE025
     E                    ACCT       10 13 0                                                  CLE025
     E                    FCXO       10 13 0                                                  CLE025
     E                    CAXO       10 13 0                                                  CLE025
     E                    CAXM       10 13 0                                                  CLE025
     E                    WSOF       10 13 0                                                  CLE025
     E                    WSOA       10 13 0                                                  CLE025
     E                    WSMA       10 13 0                                                 BUG3281
     E                    EXPC       10 13                                                    CLE025
     E                    OFFC       10 13                                                    CLE025
     E                    #INS      200 13 0             Instrument Types Array             CLE075AF
     E                    #ISS      200 13 0             Instrument Types Sorted            CLE075AF
     E                    #ISK      200  3               Instrument Types Cache key         CLE075AF
     E                    #WEI      100 13 0             Weighting Codes Array              CLE075AF
     E                    #WES      100 13 0             Weighting Codes Sorted             CLE075AF
     E                    #WEK      100  2               Weighting Codes Cache Key          CLE075AF
     E                    #ACD      300 13 0             Account Codes Array                CLE075AF
     E                    #ACS      300 13 0             Account Codes Array Sorted         CLE075AF
     E                    #ACK      300 10               Account Codes Cache Key            CLE075AF
     E                    #CCY      250  3               Currency Codes Array               CLE075AF
      *
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZFREQBZ1                                               109148
     E/COPY ZSRSRC,ZDATE2Z1                                               109148
      *
     I/EJECT
     ICLOANCLF                                                            163791
     I              CNUM                            LCNUM                 163791
     I              ORED                            LORED                                     211579
     I              ORBR                            LORBR                                    BUG7643
     I              FRNT                            LFRNT                                     247896
     I              AFRT                            LAFRT                                     247896
     I              AUTH                            LAUTH                                  AR1075061
     ICLOANCKF                                                                                CLE023
     I              NLRA                            LNLRA                                     CLE023
     I              NAR1                            NAR1K                                    BUG7643
     I              NAR2                            NAR2K                                    BUG7643
     I              NAR3                            NAR3K                                    BUG7643
     I              NAR4                            NAR4K                                    BUG7643
     I              ORED                            LORED                                     211579
     I              FRNT                            LFRNT                                     247896
     I              AFRT                            LAFRT                                     247896
     I/COPY WNCPYSRC,LE0491I001
     ILEFCAMRE                                                            156229
     I              RECI                            BRECI                 156229
     I              BRCA                            BBRCA                 156229
     I              CNUM                            BCNUM                 156229
     I              FACT                            BFACT                 156229
     I              FCNO                            BFCNO                 156229
     I              RVCR                            BRVCR                 156229
     I              IUSR                            BIUSR                 156229
     I              AUSR                            BAUSR                 156229
     I              XUSR                            BXUSR                 156229
     I              ORED                            BORED                 156229
     I              CHTP                            BCHTP                 156229
     I              PCRF                            BPCRF                 156229
     I              PCOB                            BPCOB                 156229
     I              FRNT                            BFRNT                                     247896
     I              AFRT                            BAFRT                                     247896
     I              AUTH                            BAUTH                                  AR1075061
     I/COPY WNCPYSRC,LEH00438
      *                                                                   156229
     ILEFCAMPF                                                                                195865
     I              RVCR                            XRVCR                                     195865
     I              ORED                            BORED                                     211579
     I/COPY WNCPYSRC,LEH00439
      *                                                                                      BUG7643
     ILEFAL1F                                                                                BUG7643
     I              ORBR                            VORBR                                    BUG7643
      *                                                                                      BUG7643
     ILVENTELF                                                                               BUG7643
     I              ORBR                            VORBR                                    BUG7643
      *                                                                                      BUG7643
     ILELOANLF                                                                               BUG7643
     I              CNUM                            ZCNUM                                     229247
     I              ORED                            ZORED                                     229247
     I              ORBR                            LORBR                                    BUG7643
     I              FRNT                            LFRNT                                     247896
     I              AFRT                            LAFRT                                     247896
      *                                                                                      BUG7643
     ILELVNTLF                                                                               BUG7643
     I              ORBR                            VORBR                                    BUG7643
      *                                                                                      BUG7643
     ILENFCTLM                                                                               BUG7643
     I              ORBR                            FORBR                                    BUG7643
     I              FRNT                            FFRNT                                     247896
     I              AFRT                            FAFRT                                     247896
     IDEALSDBF                                                                                CLE025
     I              RECI                            DBRECI                                    CLE025
     I              DLNO                            DBDLNO                                    CLE025
     I              VDAT                            DBVDAT                                    CLE025
     I              CNUM                            DBCNUM                                    CLE025
     I              ORBR                            DBORBR                                 AR1042766
     I              ORED                            DBORED                                 AR1042766
     I              REPI                            DBREPI                                 AR1042766
     IDEALSDCF                                                                                CLE025
     I              RECI                            DCRECI                                    CLE025
     I              DLNO                            DCDLNO                                    CLE025
     I              VDAT                            DCVDAT                                    CLE025
     I              MDAT                            DCMDAT                                    CLE025
     I              CNUM                            DCCNUM                                    CLE025
     I              FACT                            DCFACT                                    CLE025
     I              FCNO                            DCFCNO                                    CLE025
     I              ORBR                            DCORBR                                 AR1042766
     I              ORED                            DCORED                                 AR1042766
     I              REPI                            DCREPI                                 AR1042766
     IDEALSDGF                                                                                CLE025
     I              RECI                            DGRECI                                    CLE025
     I              DLNO                            DGDLNO                                    CLE025
     I              DTYP                            DGDTYP                                    CLE025
     I              VDAT                            DGVDAT                                    CLE025
     I              MDAT                            DGMDAT                                    CLE025
     I              CNUM                            DGCNUM                                    CLE025
     I              FRNT                            DGFRNT                                    247896
     I              ORBR                            DGORBR                                 AR1042766
     I              ORED                            DGORED                                 AR1042766
     I              REPA                            DGREPA                                 AR1042766
     IACCNTABF                                                                                CLE025
     I              CNUM                            GLCNUM                                    CLE025
     I              CCY                             GLCCY                                     CLE025
     I              ACOD                            GLACOD                                    CLE025
     I              ACSQ                            GLACSQ                                    CLE025
     I              BRCA                            GLBRCA                                    CLE025
     I              CLBL                            GLCLBL                                    CLE025
     I              FCCU                            GLFCCU                                    CLE025
     I              FACT                            GLFACT                                    CLE025
     I              FCNO                            GLFCNO                                    CLE025
     I              FRNT                            GLFRNT                                    247896
     I              AFRT                            GLAFRT                                    247896
     I              ORED                            GLORED                                 AR1042766
     I              REPI                            GLREPI                                 AR1042766
     I              REPA                            GLREPA                                 AR1042766
     I              LDBL                            GLLDBL                                    CLE169
      *                                                                                       CLE169
     IAPOSTL4F                                                                              MD044153
     I              RECI                            YYRECI                                  MD044153
     I              CNUM                            YYCNUM                                  MD044153
     I              CCY                             YYCCY                                   MD044153
     I              ACODQQ                          YYACOQ                                  MD044153
     I              ACSQ                            YYACSQ                                  MD044153
     I              IPDN                            YYIPDN                                  MD044153
     I              ACNO                            YYACNO                                  MD044153
     I              PSTD                            YYPSTD                                  MD044153
     I              VALD                            YYVALD                                  MD044153
     I              TRAT                            YYTRAT                                  MD044153
     I              PNAR                            YYPNAR                                  MD044153
     I              PSTA                            YYPSTA                                  MD044153
     I              DRCR                            YYDRCR                                  MD044153
     I              ASOC                            YYASOC                                  MD044153
     I              CHQN                            YYCHQN                                  MD044153
     I              SPOS                            YYSPOS                                  MD044153
     I              BRCA                            YYBRCA                                  MD044153
     I              RIND                            YYRIND                                  MD044153
     I              REJC                            YYREJC                                  MD044153
     I              DPMT                            YYDPMT                                  MD044153
     I              RRNM                            YYRRNM                                  MD044153
     I              ZZ009                           YYZZ09                                  MD044153
     I              ATYP                            YYATYP                                  MD044153
     I              ZZ002                           YYZZ02                                  MD044153
     I              EXIN                            YYEXIN                                  MD044153
     I              PRIN                            YYPRIN                                  MD044153
     I              GETP                            YYGETP                                  MD044153
     I              ACUM                            YYACUM                                  MD044153
     I              PRFC                            YYPRFC                                  MD044153
     I              PTIM                            YYPTIN                                  MD044153
     I              VOIN                            YYVOIN                                  MD044153
     I              MGTT                            YYMGTT                                  MD044153
     I              ACSC                            YYACSC                                  MD044153
     I              LTAI                            YYLTAI                                  MD044153
     I              ZZ007                           YYZZ07                                  MD044153
     I              RINO                            YYRINO                                  MD044153
     I              SWCR                            YYSWCR                                  MD044153
     I              DLREF                           YYDLRF                                  MD044153
     I              FACO                            YYFACO                                  MD044153
     I              DBCNUM                          YDBCNM                                  MD044153
     I              PREF                            YYPREF                                  MD044153
     I              OTRFQQ                          YOTRFQ                                  MD044153
     I              OTST                            YYOTST                                  MD044153
     I              OTTP                            YYOTTP                                  MD044153
     I              SDCB                            YYSDCB                                  MD044153
     I              SDLB                            YYSDLB                                  MD044153
     I              BOKC                            YYBOKC                                  MD044153
     I              NITMS                           YYNITM                                  MD044153
     I              REBI                            YYREBI                                  MD044153
     I              CHGA                            YYCHGA                                  MD044153
     I              ZZ019                           YYZ019                                  MD044153
     I              TLIN                            YYTLIN                                  MD044153
     I              TRCCY                           YYTRCY                                  MD044153
     I              STYP                            YYSTYP                                  MD044153
     I              CQRI                            YYCQRI                                  MD044153
     I              PBTT                            YYPBTT                                  MD044153
     I              ORBR                            YYORBR                                  MD044153
     I              ORAMT                           YYORMT                                  MD044153
     I              XRFI                            YYXRFI                                  MD044153
     I              XRFN                            YYXRFN                                  MD044153
     I              TRST                            YYTRST                                  MD044153
     I              ACKEY                           YYACKY                                  MD044153
     I              FEEFLG                          YFEFLG                                  MD044153
     I              FEEVAL                          YFEVAL                                  MD044153
     I              FEEPCT                          YFEPCT                                  MD044153
     I              RORACT                          YRORAC                                  MD044153
     I              RORCTY                          YRORCY                                  MD044153
     I              RORBNK                          YRORBK                                  MD044153
     I              RORCDE                          YRORCD                                  MD044153
     I              PORACT                          YPORAC                                  MD044153
     I              PORCTY                          YPORCY                                  MD044153
     I              PORBNK                          YPORBK                                  MD044153
     I              PORCDE                          YPORCD                                  MD044153
     I              DSTACT                          YDSTAC                                  MD044153
     I              DSTCTY                          YDSTCY                                  MD044153
     I              DSTBNK                          YDSTBK                                  MD044153
     I              SETDAT                          YSETDT                                  MD044153
     I              TICKER                          YTIKER                                  MD044153
     I              EXCHNG                          YEXCHG                                  MD044153
     I              NOMINL                          YNOMIL                                  MD044153
     I              FDTRID                          YFDTRD                                  MD044153
     I              ACOD                            YYACOD                                  MD044153
     I              OTRF                            YYOTRF                                  MD044153
      *                                                                                    AR1057175
     IAPOSTPDF                                                                             AR1057175
     I              ORBR                            GLORBR                                 AR1057175
      *                                                                                    AR1057175
      *                                                                                       195865
     ILEPDUED0                                                                               263840A
      *                                                                                      263840A
      ** Rename LEPDUEL6 fields that are too long.                                           263840A
      *                                                                                      263840A
     I              YTKPACL                         YTPACL                                   263840A
     I              YTKPABR                         YTPABR                                   263840A
     I              YTKPAAC                         YTPAAC                                   263840A
     I              YTKPASE                         YTPASE                                   263840A
     I              YTKPACY                         YTPACY                                   263840A
     I              YTKIACL                         YTIACL                                   263840A
     I              YTKIABR                         YTIABR                                   263840A
     I              YTKIAAC                         YTIAAC                                   263840A
     I              YTKIASE                         YTIASE                                   263840A
     I              YTKIACY                         YTIACY                                   263840A
      *                                                                                      263840A
     ILEPDUFD0                                                                               263840A
      *                                                                                      263840A
      ** Rename LEPDUFLA fields that are too long.                                           263840A
      *                                                                                      263840A
     I              YTKPACL                         YTPACL                                   263840A
     I              YTKPABR                         YTPABR                                   263840A
     I              YTKPAAC                         YTPAAC                                   263840A
     I              YTKPASE                         YTPASE                                   263840A
     I              YTKPACY                         YTPACY                                   263840A
      *                                                                                      263840A
     INFACLZ    E DSNFACLZZ                                               127659
     ITNFACZ      DS                            256                       127659
      *
     IFSDS        DS                                                                          195865
      ** File Status Data Structure                                                           195865
      *                                                                                       195865
     I                                     *RECORD  FREC                                      195865
      *                                                                                       195865
     IPSDS       SDS
      ** Program Status Data Structure - gives Job/Workstation name and
      ** User ID
      *
     I                                      244 253 JOB
     I                                      244 246 WSID
      *
     IDSETYP      DS
      *** Data area for the break down of event type
     I                                       14  17 ETYP
     I                                       14  15 PTP
     I                                       16  17 ETP
      *                                                                                       CLE023
     IDCETYP      DS                                                                          CLE023
      ** Data area for the break down of event type                                           CLE023
     I                                       14  17 CAETP                                     CLE023
     I                                       14  15 CPTP                                      CLE023
     I                                       16  17 CETP                                      CLE023
      *
     IDSFCLT      DS                                                      S01473
      ** Data structure to construct facility ref. field for              S01473
      ** LEEVLOPD key.                                                    S01473
      *                                                                   S01473
     I**********                              1  110LOFCLT                             S01473 CSD027
     I**********                              1   60LOCNUM                             S01473 CSD027
     I                                        1  11 LOFCLT                                    CSD027
     I                                        1   6 LOCNUM                                    CSD027
     I                                        7   90LOFACT                S01473
     I                                       10  110LOFCNO                S01473
      *
     IDFCLTC      DS                                                      156229
      ** Current facility                                                 156229
     I                                        1   3 XBRCA                 156229
     I**********                              4   90XCNUM                              156229 CSD027
     I                                        4   9 XCNUM                                     CSD027
     I                                       10  120XFACT                 156229
     I                                       13  140XFCNO                 156229
     IDFCLTR      DS                                                      156229
      ** Read facility                                                    156229
     I                                        1   3 BBRCA                 156229
     I**********                              4   90BCNUM                              156229 CSD027
     I                                        4   9 BCNUM                                     CSD027
     I                                       10  120BFACT                 156229
     I                                       13  140BFCNO                 156229
     ISPOOL1      DS                                                                          CLE025
     I                                       83  92 SFILE1                                    CLE025
     I            DS
      *** Date data structure
     I                                    P   1  300RUNS
     I                                    P   1   30RUN0
     I                                    P   4   60RUN1
     I                                    P   7   90RUN2
     I                                    P  10  120RUN3
     I                                    P  13  150RUN4
     I                                    P  16  180RUN5
     I                                    P  19  210RUN6
     I                                    P  22  240RUN7
     I                                    P  25  270RUN8
     I                                    P  28  300RUN9
      *
     I            DS
      *** Facility Amount data structure
     I                                    P   1  700OAM
     I                                    P   1   70OAM1
     I                                    P   8  140OAM2
     I                                    P  15  210OAM3
     I                                    P  22  280OAM4
     I                                    P  29  350OAM5
     I                                    P  36  420OAM6
     I                                    P  43  490OAM7
     I                                    P  50  560OAM8
     I                                    P  57  630OAM9
     I                                    P  64  700OA10
     I            DS                                                      CLE005
      *** Credit Agreement Date Data Structure                            CLE005
     I                                    P   1  300CARN                  CLE005
     I                                    P   1   30CARUN0                CLE005
     I                                    P   4   60CARUN1                CLE005
     I                                    P   7   90CARUN2                CLE005
     I                                    P  10  120CARUN3                CLE005
     I                                    P  13  150CARUN4                CLE005
     I                                    P  16  180CARUN5                CLE005
     I                                    P  19  210CARUN6                CLE005
     I                                    P  22  240CARUN7                CLE005
     I                                    P  25  270CARUN8                CLE005
     I                                    P  28  300CARUN9                CLE005
      *                                                                   CLE005
     I            DS                                                      CLE005
      *** Credit Agreement Amount Data Structure                          CLE005
     I                                    P   1  700CAOA                  CLE005
     I                                    P   1   70CAOAM1                CLE005
     I                                    P   8  140CAOAM2                CLE005
     I                                    P  15  210CAOAM3                CLE005
     I                                    P  22  280CAOAM4                CLE005
     I                                    P  29  350CAOAM5                CLE005
     I                                    P  36  420CAOAM6                CLE005
     I                                    P  43  490CAOAM7                CLE005
     I                                    P  50  560CAOAM8                CLE005
     I                                    P  57  630CAOAM9                CLE005
     I                                    P  64  700CAOA10                CLE005
      *                                                                   CLE005
     I            DS                                                                          CLE025
      ** Margin Requirement Amount Data Structure                                             CLE025
     I                                    P   1  700MARQ                                      CLE025
     I                                    P   1   70FCXMR1                                    CLE025
     I                                    P   8  140FCXMR2                                    CLE025
     I                                    P  15  210FCXMR3                                    CLE025
     I                                    P  22  280FCXMR4                                    CLE025
     I                                    P  29  350FCXMR5                                    CLE025
     I                                    P  36  420FCXMR6                                    CLE025
     I                                    P  43  490FCXMR7                                    CLE025
     I                                    P  50  560FCXMR8                                    CLE025
     I                                    P  57  630FCXMR9                                    CLE025
     I                                    P  64  700FCXM10                                    CLE025
     I            DS                                                                          CLE025
      ** Offset Amount Data Structure                                                         CLE025
     I                                    P   1  700FCXO                                      CLE025
     I                                    P   1   70FCXOF1                                    CLE025
     I                                    P   8  140FCXOF2                                    CLE025
     I                                    P  15  210FCXOF3                                    CLE025
     I                                    P  22  280FCXOF4                                    CLE025
     I                                    P  29  350FCXOF5                                    CLE025
     I                                    P  36  420FCXOF6                                    CLE025
     I                                    P  43  490FCXOF7                                    CLE025
     I                                    P  50  560FCXOF8                                    CLE025
     I                                    P  57  630FCXOF9                                    CLE025
     I                                    P  64  700FCXO10                                    CLE025
     I            DS                                                                          CLE025
      ** Credit Agreement Offset Amount Array                                                 CLE025
     I                                    P   1  700CAXO                                      CLE025
     I                                    P   1   70CAXOF1                                    CLE025
     I                                    P   8  140CAXOF2                                    CLE025
     I                                    P  15  210CAXOF3                                    CLE025
     I                                    P  22  280CAXOF4                                    CLE025
     I                                    P  29  350CAXOF5                                    CLE025
     I                                    P  36  420CAXOF6                                    CLE025
     I                                    P  43  490CAXOF7                                    CLE025
     I                                    P  50  560CAXOF8                                    CLE025
     I                                    P  57  630CAXOF9                                    CLE025
     I                                    P  64  700CAOF10                                    CLE025
     I            DS                                                                          CLE025
      ** Credit Agreement Margin Exposure Array                                               CLE025
     I                                    P   1  700CAXM                                      CLE025
     I                                    P   1   70CAXMR1                                    CLE025
     I                                    P   8  140CAXMR2                                    CLE025
     I                                    P  15  210CAXMR3                                    CLE025
     I                                    P  22  280CAXMR4                                    CLE025
     I                                    P  29  350CAXMR5                                    CLE025
     I                                    P  36  420CAXMR6                                    CLE025
     I                                    P  43  490CAXMR7                                    CLE025
     I                                    P  50  560CAXMR8                                    CLE025
     I                                    P  57  630CAXMR9                                    CLE025
     I                                    P  64  700CAMR10                                    CLE025
     I            DS                                                                          CLE025
     I                                    P   1  700WSOA                                      CLE025
     I                                    P   1   70WSOAM1                                    CLE025
     I                                    P   8  140WSOAM2                                    CLE025
     I                                    P  15  210WSOAM3                                    CLE025
     I                                    P  22  280WSOAM4                                    CLE025
     I                                    P  29  350WSOAM5                                    CLE025
     I                                    P  36  420WSOAM6                                    CLE025
     I                                    P  43  490WSOAM7                                    CLE025
     I                                    P  50  560WSOAM8                                    CLE025
     I                                    P  57  630WSOAM9                                    CLE025
     I                                    P  64  700WSOA10                                    CLE025
     I            DS                                                                         BUG3281
      ** Margin Requirement Amount Data Structure                                            BUG3281
     I                                    P   1  700WSMA                                     BUG3281
     I                                    P   1   70WSMAR1                                   BUG3281
     I                                    P   8  140WSMAR2                                   BUG3281
     I                                    P  15  210WSMAR3                                   BUG3281
     I                                    P  22  280WSMAR4                                   BUG3281
     I                                    P  29  350WSMAR5                                   BUG3281
     I                                    P  36  420WSMAR6                                   BUG3281
     I                                    P  43  490WSMAR7                                   BUG3281
     I                                    P  50  560WSMAR8                                   BUG3281
     I                                    P  57  630WSMAR9                                   BUG3281
     I                                    P  64  700WSMA10                                   BUG3281
     I            DS                                                                          CLE025
     I                                        1  20 RINPUT                                    CLE025
     I                                        1   6 WKDL                                      CLE025
     I                                        7   7 WDASH1                                    CLE025
     I                                        8   9 PMOD                                      CLE025
     I                                       10  10 WDASH2                                    CLE025
     I                                       11  14 PSMOD                                     CLE025
     I                                        8  10 WFACT                                     CLE025
     I                                       11  11 WDASH3                                    CLE025
     I                                       12  13 WACSQ                                     CLE025
      *                                                                                       CLE025
     IPAMNT       DS                            260                                           CLE025
     I**                                      1 260 PAMNT                                     CLE025
     I                                        1 130 PEXPA                                     CLE025
     I                                      131 260 POFFS                                     CLE025
      *                                                                                       CLE025
     I/COPY ZSRSRC,ZHASHZ2
     I/COPY ZSRSRC,ZHOLI
      *
     ILDA       E DSLDA
      ** Database error DS
      *
     IRUNDAT    E DS
     I              AGRDNB                          RUND
      *
     ISDBANK    E DSSDBANKPD
     I              BJDNWD                          DNWD
     I*
     ISCSAR     E DSSCSARDPD                                              S01473
     I* SWITCHABLE FEATURE DETAILS                                        S01473
     I              LCD                             DLCD                  127659
     ISDGELR    E DSSDGELRPD                                              109148
      *
     I***SDACOD*   E DSSDACODPD                                                      CLE025 CLE075AF
     ISDACOD    E DSSDACODPD                300                                             CLE075AF
     I              QQACCD                          QQACC1                                    CLE025
      *                                                                                       CLE025
     I***SDPLIN*   E DSSDPLINPD                                                      CLE025 CLE075AF
     ISDPLIN    E DSSDPLINPD                200                                             CLE075AF
      *                                                                                       CLE025
     ISDCUST    E DSSDCUSTPD                                                                  CLE025
     I              QQDFAC                          QQDFA1                                    CLE025
      *                                                                                       CLE025
     I***SDCURR*   E DSSDCURRPD                                                     BUG3382 CLE075AF
     ISDCURR    E DSSDCURRPD                250                                             CLE075AF
      *                                                                                      BUG3382
     IGPWEIG    E DSGPWEIGPD                100                                             CLE075AF
     I              PDWEIG                          WCWEIG                                  CLE075AF
     I              PDLCD                           WCLCD                                   CLE075AF
      *                                                                                     CLE075AF
     IDSFDY     E DSDSFDY
      ** First DS for access programs, short data structure
      *
     IDSSDY     E DSDSSDY
      ** Second DS for access programs, long data structure
     I/COPY WNCPYSRC,LE0491I002
      *
     C/TITLE Main Processing
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
      ***  Perform Initialisation.
      *
     C                     EXSR INIT
     C/COPY WNCPYSRC,LE0491C004
      *
      ***  Perform Detail Processing.
      *
     C                     EXSR PROCES
      *
      ***  Output Audit Report and End Program.
      *
     C                     EXSR AUDIT
      *
      *****************************************************************
      /TITLE SR/INIT
      *****************************************************************
      *                                                               *
      *  INIT   - SUBROUTINE TO DO PROGRAM INITIALISATION.            *
      *                                                               *
      *  Called By: MAIN PROCESSING                                   *
      *                                                               *
      *  Calls:     AOBANKR0, AOCLNDR0                                *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR
      *                                                                                       CLE134
     C           *ENTRY    PLIST                                                              CLE134
     C                     PARM           WPNAM  10                                           CLE134
      *
      ***  Set up copyright statement.
      *
     C                     MOVEACPY@      BIS@   80
      *
      ***  Write header records to output files
      *
     C                     MOVE 'H'       RECI
     C                     WRITENFACLHHF
     C***********          WRITEOLVENTHH                                  045634
      *
      ***  Call access program for bank specific details, e.g., title
      ***  local currency, run date & day number.
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           WRTCD     IFNE *BLANKS                    ***B001
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0491  'DBPGM
     C                     MOVEL'*READ   'DBKEY
     C                     MOVE 'SDBANKPD'DBFILE           ************
     C                     Z-ADD1         DBASE            * DBERR 01 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END                             ***E001
      *                                                                   109148
      ** Check system date format, DDMMYY or MMDDYY.                      109148
     C           BJDFIN    IFEQ 'M'                                       109148
     C                     MOVE '1'       *IN98                           109148
     C                     END                                            109148
      *
      ***  Define keylists used within program.
      *
     C           KEYPD     KLIST                                                              CLE134
     C                     KFLD           EBRC                                                CLE134
     C                     KFLD           LNRF                                                CLE134
      *                                                                                       CLE134
     C           KEY001    KLIST
     C**********           KFLD           FCCNUM  60                                          CSD027
     C                     KFLD           FCCNUM  6                                           CSD027
     C                     KFLD           FCFACT  30
     C                     KFLD           FCFCNO  20
      *                                                                   S01473
     C           EVLKEY    KLIST                                          S01473
     C***********          KFLD           EVLEOK 110                      S01473              CSD027
     C                     KFLD           EVLEOK 11                                           CSD027
      *
     C/COPY WNCPYSRC,LE0491C020
     C           KEY002    KLIST                                          091158
     C                     KFLD           LNRF                            091158
     C                     KFLD           RCDT                            091158
     C/COPY WNCPYSRC,LE0491C021
      *                                                                   144712
     C           KEY003    KLIST                                          144712
     C                     KFLD           WRECI   1                       144712
     C**********           KFLD           FCCNUM  60                                   144712 CSD027
     C                     KFLD           FCCNUM  6                                           CSD027
     C                     KFLD           FCFACT  30                      144712
     C                     KFLD           FCFCNO  20                      144712
      *                                                                   CLE005
     C           FCTYKY    KLIST                                          CLE005
     C**********           KFLD           WSCNUM  60                                   CLE005 CSD027
     C                     KFLD           WSCNUM  6                                           CSD027
     C                     KFLD           WSFACT  30                      CLE005
     C                     KFLD           WSFCNO  20                      CLE005
      *                                                                   156229
     C           FCMKEY    KLIST                                          156229
     C                     KFLD           XBRCA                           156229
     C                     KFLD           XCNUM                           156229
     C                     KFLD           XFACT                           156229
     C                     KFLD           XFCNO                           156229
      *                                                                   156229
     C           KACCT     KLIST                                                              CLE025
     C                     KFLD           GLCNUM                                              CLE025
     C                     KFLD           GLCCY                                               CLE025
     C                     KFLD           GLACOD                                              CLE025
     C                     KFLD           GLACSQ                                              CLE025
      *                                                                                       CLE040
     C           KACCT2    KLIST                                                              CLE040
     C                     KFLD           GLBRCA                                              CLE040
     C                     KFLD           GLCNUM                                              CLE040
     C                     KFLD           GLCCY                                               CLE040
     C                     KFLD           GLACOD                                              CLE040
     C                     KFLD           GLACSQ                                              CLE040
      *                                                                                       CLE169
     C           KACCT3    KLIST                                                              CLE169
     C                     KFLD           GLBRCA                                              CLE169
     C                     KFLD           GLCNUM                                              CLE169
     C                     KFLD           GLCCY                                               CLE169
     C                     KFLD           GLACOD                                              CLE169
     C                     KFLD           GLACSQ                                              CLE169
     C                     KFLD           KPSTD   50                                          CLE169
     C                     KFLD           KDRCR   10                                          CLE169
      *                                                                                       CLE025
     C           KFACTL    KLIST                                                              CLE025
     C                     KFLD           KCNUM                                               CLE025
     C                     KFLD           KFCTP                                               CLE025
     C                     KFLD           KFCNO                                               CLE025
      *                                                                                       CLE025
     C           KFACTD    KLIST                                                              CLE025
     C                     KFLD           KCNUMD                                              CLE025
     C                     KFLD           KFCTPD                                              CLE025
     C                     KFLD           KFCNOD                                              CLE025
      *                                                                                      263840A
     C           KEYPDI    KLIST                                                             263840A
     C                     KFLD           WRECI                                              263840A
     C                     KFLD           WPLON   6                                          263840A
     C                     KFLD           WPDCT   1                                          263840A
      *                                                                                      263840A
     C           KEYPDF    KLIST                                                             263840A
     C                     KFLD           WRECI                                              263840A
     C                     KFLD           WPLON                                              263840A
      *                                                                   CLE005
      ** Define LDA
     C           *NAMVAR   DEFN           LDA
      *                                                                     0029
      ** Define RUNDAT                                                      0029
      *                                                                     0029
     C           *NAMVAR   DEFN           RUNDAT                            0029
     C                     IN   RUNDAT                                      0029
      *                                                                                       CLE025
     C           *LIKE     DEFN A5ACCD    PACOD                                               CLE025
     C/COPY WNCPYSRC,LE0491C003
      **********                                                                             BUG3382
      *****Set*up currency array                                                             BUG3382
      **********                                                                             BUG3382
     C                     Z-ADD0         X       30
     C**********           READ SDCURRPD                 01                                  BUG3382
      **********                                                                             BUG3382
      *****Database error if currency file empty at this stage.                              BUG3382
     C********** *IN01     IFEQ '1'                                                          BUG3382
     C********** *LOCK     IN   LDA                                                          BUG3382
     C**********           MOVEL'LE0491  'DBPGM                                              BUG3382
     C**********           MOVEL'*READ   'DBKEY                                              BUG3382
     C**********           MOVE 'SDCURRPD'DBFILE           ************                      BUG3382
     C**********           Z-ADD3         DBASE            * DBERR 03 *                      BUG3382
     C**********           OUT  LDA                        ************                      BUG3382
     C**********           EXSR *PSSR                                                        BUG3382
     C**********           END                                                               BUG3382
      **********                                                                             BUG3382
     C********** *IN01     DOWEQ'0'                        ***B001                           BUG3382
      **********                                                                             BUG3382
     C********** X         IFLE 150                        ***B002                           BUG3382
     C********** X         ADD  1         X                                                  BUG3382
     C**********           MOVE A6CYCD    CURR,X                                             BUG3382
     C**********           Z-ADDA6SPRT    CSPT,X                                             BUG3382
     C**********           MOVELA6MDIN    MTDV,X                                             BUG3382
     C**********           Z-ADDA6NBDP    CCDP,X                                             BUG3382
     C**********           Z-ADDA6SSNB    CCNO,X                                             BUG3382
     C/COPY WNCPYSRC,LE0491C028
     C**********           END                             ***E002                           BUG3382
      **********                                                                             BUG3382
     C**********           READ SDCURRPD                 01                                  BUG3382
      **********                                                                             BUG3382
     C**********           END                             ***E001                           BUG3382
      *
      *** Set-up array of branch internal customer numbers.
      *
     C                     READ SDBRCHPD                 02
      *
     C           *IN02     IFEQ '0'                        ***B001
     C                     Z-ADD1         I       30
      *
     C           *IN02     DOWEQ'0'                        ***B002
      *
      *** Only store details if the branch internal customer number is
      *** not blank.
      *
     C           A8BICN    IFNE *BLANKS                    ***B003
     C                     MOVE A8BICN    BCA,I
     C                     ADD  1         I
     C                     END                             ***E003
      *
     C                     READ SDBRCHPD                 02
      *
     C                     END                             ***E002
      *
     C                     ELSE                            ***X001
      *
      *** If no details found on SDBRCHPD then output database error
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0491  'DBPGM
     C                     MOVEL'*READ   'DBKEY
     C                     MOVE 'SDBRCHPD'DBFILE           ************
     C                     Z-ADD4         DBASE            * DBERR 04 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
      *
     C                     END                             ***E001
      *
     C                     SETOF                     02
      *
      *** Initialise record counts
      *
      *** Count1 =  All 'A' type facility records
      *** Count2 =  Events read in
      *** Countf =  Facility records written
      *** Countl =  Events records written
      *** Countd =  Dummy events read (and so dropped)
      *
     C                     Z-ADD2         COUNT1  50
     C**********           Z-ADD2         COUNT2  50                      105140
     C                     Z-ADD2         COUNT2  90                      105140
     C                     Z-ADD2         COUNTF  50
     C***********          Z-ADD2         COUNTL  50                      045634
     C                     Z-ADD0         COUNTD  50
      *
     C* CHECK ENHANCEMENT S01473 SWITCHED ON                              S01473
     C*                                                                   S01473
     C* ACCESS MIDAS/LEO INTEGRATION SWITCHABLE FEATURE DETAILS           S01473
     C*                                                                   S01473
     C                     CALL 'AOSARDR0'                                S01473
     C                     PARM '*BLANKS' @RTCD   7                       S01473
     C                     PARM '*VERIFY' @OPTN   7                       S01473
     C                     PARM 'S01473'  @SARD   6                       S01473
     C           SCSAR     PARM SCSAR     DSFDY                           S01473
     C*                                                                   S01473
     C           @RTCD     IFEQ *BLANKS                                   S01473
     C                     SETON                     21                   S01473
     C                     END                                            S01473
     C/COPY WNCPYSRC,LE0491C017
      *                                                                   CLE004
      ** Check if Customer Lending Enhancement for Syndication            CLE004
      ** is switched ON                                                   CLE004
      *                                                                   CLE004
     C                     CALL 'AOSARDR0'                                CLE004
     C                     PARM '*BLANKS' @RTCD   7                       CLE004
     C                     PARM '*VERIFY' @OPTN   7                       CLE004
     C                     PARM 'CLE004'  @SARD   6                       CLE004
     C           SCSAR     PARM SCSAR     DSFDY                           CLE004
      *                                                                   CLE004
     C           @RTCD     IFEQ *BLANKS                                   CLE004
     C                     MOVE 'Y'       CLE004  1                       CLE004
     C                     ELSE                                           CLE004
     C                     MOVE 'N'       CLE004  1                       CLE004
     C           @RTCD     IFNE '*NRF    '                                CLE004
     C           *LOCK     IN   LDA                                       CLE004
     C                     MOVEL'LE0491  'DBPGM                           CLE004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE004
     C                     Z-ADD5         DBASE            * DBERR 05 *   CLE004
     C                     MOVEL'CLE004'  DBKEY            ************   CLE004
     C                     OUT  LDA                                       CLE004
     C                     EXSR *PSSR                                     CLE004
     C                     ENDIF                                          CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
      ** Check if Customer Lending Enhancement for Others (T3)            CLE005
      ** is switched ON                                                   CLE005
      *                                                                   CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM '*BLANKS' @RTCD   7                       CLE005
     C                     PARM '*VERIFY' @OPTN   7                       CLE005
     C                     PARM 'CLE005'  @SARD   6                       CLE005
     C           SCSAR     PARM SCSAR     DSFDY                           CLE005
      *                                                                   CLE005
     C           @RTCD     IFEQ *BLANKS                                   CLE005
     C                     MOVE 'Y'       CLE005  1                       CLE005
     C                     OPEN LECAUTL0                                  CLE005
     C                     OPEN LENFCTL0                                  CLE005
     C                     OPEN LENFCTL1                                  CLE005
     C                     OPEN LELEFAL1                                  144712
     C                     ELSE                                           CLE005
     C                     MOVE 'N'       CLE005                          CLE005
     C                     OPEN LVNTS                                     144712
     C           @RTCD     IFNE '*NRF    '                                CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'LE0491  'DBPGM                           CLE005
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE005
     C                     Z-ADD6         DBASE            * DBERR 06 *   CLE005
     C                     MOVEL'CLE005'  DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE014
      ** Determine if CLE014 is installed                                 CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM '       ' PRTCD   7                       CLE014
     C                     PARM '*VERIFY' POPTN   7                       CLE014
     C                     PARM 'CLE014'  PSARD   6                       CLE014
     C           SCSAR     PARM SCSAR     DSSDY                           CLE014
      *                                                                   CLE014
      ** Handle Database Error                                            CLE014
      *                                                                   CLE014
     C           PRTCD     IFNE *BLANKS                                   CLE014
     C           PRTCD     ANDNE'*NRF   '                                 CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVE 'SCSARDPD'DBFILE                          CLE014
     C                     MOVEL'LE0491'  DBPGM                           CLE014
     C                     MOVELPSARD     DBKEY                           CLE014
     C                     Z-ADD31        DBASE                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** CLE014 is installed                                              CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       CLE023
      ** Check if CLE023 is installed.                                                        CLE023
      *                                                                                       CLE023
     C                     CALL 'AOSARDR0'                                                    CLE023
     C                     PARM '*BLANKS' @RTCD                                               CLE023
     C                     PARM '*VERIFY' @OPTN                                               CLE023
     C                     PARM 'CLE023'  @SARD                                               CLE023
     C           SCSAR     PARM SCSAR     DSFDY                                               CLE023
      *                                                                                       CLE023
     C           @RTCD     IFEQ *BLANKS                                                       CLE023
     C                     MOVE 'Y'       CLE023  1                                           CLE023
     C                     ELSE                                                               CLE023
     C                     MOVE 'N'       CLE023  1                                           CLE023
     C           @RTCD     IFNE '*NRF    '                                                    CLE023
     C           *LOCK     IN   LDA                                                           CLE023
     C                     MOVEL'LE0491  'DBPGM                                               CLE023
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE023
     C                     Z-ADD11        DBASE                                               CLE023
     C                     MOVEL'CLE023'  DBKEY                                               CLE023
     C                     OUT  LDA                                                           CLE023
     C                     EXSR *PSSR                                                         CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE028
      ** Determine if CLE028 is installed                                                     CLE028
      *                                                                                       CLE028
     C                     MOVE 'N'       CLE028                                              CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM '       ' PRTCD                                               CLE028
     C                     PARM '*VERIFY' POPTN                                               CLE028
     C                     PARM 'CLE028'  PSARD                                               CLE028
     C           SCSAR     PARM SCSAR     DSSDY                                               CLE028
      *                                                                                       CLE028
      ** Handle Database Error                                                                CLE028
      *                                                                                       CLE028
     C           PRTCD     IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'Y'       CLE028  1                                           CLE028
     C                     ELSE                                                               CLE028
     C           PRTCD     IFNE '*NRF   '                                                     CLE028
     C           *LOCK     IN   LDA                                                           CLE028
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE028
     C                     MOVEL'LE0491'  DBPGM                                               CLE028
     C                     MOVELPSARD     DBKEY                                               CLE028
     C                     Z-ADD32        DBASE                                               CLE028
     C                     OUT  LDA                                                           CLE028
     C                     EXSR *PSSR                                                         CLE028
     C                     ENDIF                                                              CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
      ** Check if Credit Lines is installed                                                   CLE025
      *                                                                                       CLE025
     C                     CALL 'AOSARDR0'                                                    CLE025
     C                     PARM *BLANKS   PRTCD                                               CLE025
     C                     PARM '*VERIFY' POPTN                                               CLE025
     C                     PARM 'CLE025'  PSARD                                               CLE025
     C           SCSAR     PARM SCSAR     DSSDY                                               CLE025
      *                                                                                       CLE025
      ** Handle Database Error                                                                CLE025
      *                                                                                       CLE025
     C           PRTCD     IFEQ *BLANKS                                                       CLE025
     C                     MOVE 'Y'       CLE025  1                                           CLE025
     C                     ELSE                                                               CLE025
     C                     MOVE 'N'       CLE025                                              CLE025
     C           PRTCD     IFNE '*NRF   '                                                     CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE025
     C                     MOVEL'LE0491'  DBPGM                                               CLE025
     C                     MOVELPSARD     DBKEY                                               CLE025
     C                     Z-ADD33        DBASE                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     MOVE 'N'       WERROR  1                                           CLE025
      *                                                                                       CLE025
     C                     CALL 'ZSFILE'                                                      CLE025
     C                     PARM           PSEQ    5                                           CLE025
     C                     PARM *BLANKS   PSENTY  3                                           CLE025
     C                     PARM SFILE1    PSFILE 10                                           CLE025
     C                     PARM           PZSNMU  60                                          CLE025
     C                     PARM *BLANKS   PZSERR  1                                           CLE025
      *                                                                                       CLE025
     C           PZSERR    IFEQ 'Y'                                                           CLE025
     C                     MOVE *ON       *INU7                                               CLE025
     C                     MOVE *ON       *INU8                                               CLE025
     C                     MOVE *ON       *INLR                                               CLE025
     C                     RETRN                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     WRITEHEADP1                                                        CLE025
      *                                                                                       CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Check if Syndication Manager is installed                                            CLE106
      *                                                                                       CLE106
     C                     CALL 'AOSARDR0'                                                    CLE106
     C                     PARM *BLANKS   PRTCD                                               CLE106
     C                     PARM '*VERIFY' POPTN                                               CLE106
     C                     PARM 'CLE106'  PSARD                                               CLE106
     C           SCSAR     PARM SCSAR     DSSDY                                               CLE106
      *                                                                                       CLE106
      ** Handle Database Error                                                                CLE106
      *                                                                                       CLE106
     C           PRTCD     IFEQ *BLANKS                                                       CLE106
     C                     MOVE 'Y'       CLE106  1                                           CLE106
     C                     ELSE                                                               CLE106
     C                     MOVE 'N'       CLE106                                              CLE106
     C           PRTCD     IFNE '*NRF   '                                                     CLE106
     C           *LOCK     IN   LDA                                                           CLE106
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE106
     C                     MOVEL'LE0491'  DBPGM                                               CLE106
     C                     MOVELPSARD     DBKEY                                               CLE106
     C                     Z-ADD44        DBASE                                               CLE106
     C                     OUT  LDA                                                           CLE106
     C                     EXSR *PSSR                                                         CLE106
     C                     ENDIF                                                              CLE106
     C                     ENDIF                                                              CLE106
      *                                                                                       CLE106
      ** CLE134 - Past Due Call Loans                                                         CLE134
      *                                                                                       CLE134
     C                     CALL 'AOSARDR0'                                                    CLE134
     C                     PARM *BLANKS   PRTCD                                               CLE134
     C                     PARM '*VERIFY' POPTN                                               CLE134
     C                     PARM 'CLE134'  PSARD                                               CLE134
     C           SCSAR     PARM SCSAR     DSSDY                                               CLE134
      *                                                                                       CLE134
      ** Handle Database Error                                                                CLE134
      *                                                                                       CLE134
     C           PRTCD     IFEQ *BLANKS                                                       CLE134
     C                     MOVE 'Y'       CLE134  1                                           CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE 'N'       CLE134                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Check if Account Balance Check is installed                                        CLE075AF
      *                                                                                     CLE075AF
     C                     CALL 'AOSARDR0'                                                  CLE075AF
     C                     PARM *BLANKS   PRTCD                                             CLE075AF
     C                     PARM '*VERIFY' POPTN                                             CLE075AF
     C                     PARM 'CAP205'  PSARD                                             CLE075AF
      *                                                                                     CLE075AF
     C           PRTCD     IFEQ *BLANKS                                                     CLE075AF
     C                     MOVE 'Y'       CAP205  1                                         CLE075AF
     C                     ELSE                                                             CLE075AF
     C                     MOVE 'N'       CAP205                                            CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
      ** CHECK IF CLE169 IS INSTALLED                                                         CLE169
      *                                                                                       CLE169
     C                     CALL 'AOSARDR0'                                                    CLE169
     C                     PARM *BLANKS   PRTCD                                               CLE169
     C                     PARM '*VERIFY' POPTN                                               CLE169
     C                     PARM 'CLE169'  PSARD                                               CLE169
     C           SCSAR     PARM SCSAR     DSSDY                                               CLE169
      *                                                                                       CLE169
      ** Handle Database Error                                                                CLE169
      *                                                                                       CLE169
     C           PRTCD     IFEQ *BLANKS                                                       CLE169
     C                     MOVE 'Y'       CLE169  1                                           CLE169
     C                     ELSE                                                               CLE169
     C                     MOVE 'N'       CLE169                                              CLE169
     C                     ENDIF                                                              CLE169
      *                                                                                       CLE169
     C/COPY WNCPYSRC,LE0491C024
      *                                                                   CLE005
     C           *LIKE     DEFN PCRF      WAPCRF                          157887
     C           *LIKE     DEFN PCOB      WAPCOB                          157887
     C           *LIKE     DEFN IUSR      WAIUSR                          157887
     C           *LIKE     DEFN AUSR      WAAUSR                          157887
     C           *LIKE     DEFN XUSR      WAXUSR                          157887
     C           *LIKE     DEFN DFTP      WADFTP                          157887
     C           *LIKE     DEFN DFST      WADFST                          157887
     C           *LIKE     DEFN DFCL      WADFCL                                              CLE042
     C           *LIKE     DEFN AWBA      WAAWBA                          157887
     C           *LIKE     DEFN AWBN      WAAWBN                          157887
     C           *LIKE     DEFN BENA      WABENA                          157887
     C           *LIKE     DEFN BENN      WABENN                          157887
     C           *LIKE     DEFN BTB1      WABTB1                          157887
     C           *LIKE     DEFN BTB2      WABTB2                          157887
     C           *LIKE     DEFN BTB3      WABTB3                          157887
     C           *LIKE     DEFN BTB4      WABTB4                          157887
     C           *LIKE     DEFN BTB5      WABTB5                          157887
     C           *LIKE     DEFN BTB6      WABTB6                          157887
     C           *LIKE     DEFN CVMR      WACVMR                          157887
     C           *LIKE     DEFN DCHG      WADCHG                          157887
     C           *LIKE     DEFN DTP1      WADTP1                          157887
     C           *LIKE     DEFN DTP2      WADTP2                          157887
     C           *LIKE     DEFN DTP3      WADTP3                          157887
     C           *LIKE     DEFN DTP4      WADTP4                          157887
     C           *LIKE     DEFN OMDB      WAOMDB                          157887
     C           *LIKE     DEFN OSDB      WAOSDB                          157887
     C           *LIKE     DEFN PIBA      WAPIBA                          157887
     C           *LIKE     DEFN PIBN      WAPIBN                          157887
     C           *LIKE     DEFN POBN      WAPOBN                          157887
     C           *LIKE     DEFN POCN      WAPOCN                          157887
     C           *LIKE     DEFN PSTM      WAPSTM                          157887
     C           *LIKE     DEFN PONS      WAPONS                          157887
     C           *LIKE     DEFN RCRA      WARCRA                          157887
     C           *LIKE     DEFN RCRN      WARCRN                          157887
     C           *LIKE     DEFN RSTM      WARSTM                          157887
     C           *LIKE     DEFN RONS      WARONS                          157887
     C           *LIKE     DEFN RIBA      WARIBA                          157887
     C           *LIKE     DEFN RIBN      WARIBN                          157887
     C           *LIKE     DEFN ROBN      WAROBN                          157887
     C           *LIKE     DEFN ROCN      WAROCN                          157887
     C           *LIKE     DEFN RVNO      WARVNO                          157887
     C           *LIKE     DEFN RCSI      WARCSI                          157887
     C           *LIKE     DEFN PRFC      WBPRFC                          179912
     C           *LIKE     DEFN AUTO      EVAUTO                          204557
     C           *LIKE     DEFN SCCY      WASCCY                          CLE031
     C           *LIKE     DEFN REXR      WAREXR                          CLE031
     C           *LIKE     DEFN REXI      WAREXI                          CLE031
     C           *LIKE     DEFN PSCY      WAPSCY                          CLE031
     C           *LIKE     DEFN PEXR      WAPEXR                          CLE031
     C           *LIKE     DEFN PEXI      WAPEXI                          CLE031
     C           *LIKE     DEFN STAL      WASTAL                          CLE034
     C           *LIKE     DEFN ORBR      WAORBR                                            MD042841
     C           *LIKE     DEFN AUTH      WAAUTH                                            MD055950
     C*                                                                   157887
      ** LRU element key and record arrival sequence                                        CLE075AF
      *                                                                                     CLE075AF
     C                     Z-ADD0         INSKEY 130                                        CLE075AF
     C           *LIKE     DEFN INSKEY    INSSEQ                                            CLE075AF
     C           *LIKE     DEFN INSKEY    WEIKEY                                            CLE075AF
     C           *LIKE     DEFN INSKEY    WEISEQ                                            CLE075AF
     C           *LIKE     DEFN INSKEY    ACDKEY                                            CLE075AF
     C           *LIKE     DEFN INSKEY    ACDSEQ                                            CLE075AF
      *                                                                                     CLE075AF
      ** Set start index to upper limit of LRU Caching arrays                               CLE075AF
      *                                                                                     CLE075AF
     C                     Z-ADD200       INSIDX  40                                        CLE075AF
     C           *LIKE     DEFN INSIDX    INSPRV                                            CLE075AF
     C           *LIKE     DEFN INSIDX    G                                                 CLE075AF
     C                     Z-ADD100       WEIIDX  40                                        CLE075AF
     C           *LIKE     DEFN WEIIDX    WEIPRV                                            CLE075AF
     C           *LIKE     DEFN WEIIDX    H                                                 CLE075AF
     C                     Z-ADD300       ACDIDX  40                                        CLE075AF
     C           *LIKE     DEFN ACDIDX    ACDPRV                                            CLE075AF
     C           *LIKE     DEFN ACDIDX    P                                                 CLE075AF
      *                                                                                     CLE075AF
      ** Initialize work fields of LRU array routines                                       CLE075AF
      *                                                                                     CLE075AF
     C                     MOVE *BLANK    INSIC   1                                         CLE075AF
     C                     MOVE *BLANK    WEIIC   1                                         CLE075AF
     C                     MOVE *BLANK    ACDIC   1                                         CLE075AF
     C                     MOVE *BLANKS   KEYINS  3                                         CLE075AF
     C                     MOVE *BLANKS   KEYWEI  2                                         CLE075AF
     C                     MOVE *BLANKS   KEYACD 10                                         CLE075AF
     C                     Z-ADD200       INSPRV                                            CLE075AF
     C                     Z-ADD100       WEIPRV                                            CLE075AF
     C                     Z-ADD300       ACDPRV                                            CLE075AF
     C                     Z-ADD200       G                                                 CLE075AF
     C                     Z-ADD100       H                                                 CLE075AF
     C                     Z-ADD300       P                                                 CLE075AF
      *                                                                                     CLE075AF
      ** Full Cache SDCURRPD                                                                CLE075AF
      *                                                                                     CLE075AF
     C           *LOVAL    SETLLSDCURRL1                                                    CLE075AF
     C                     Z-ADD250       A       30                                        CLE075AF
     C           A         OCUR SDCURR                                                      CLE075AF
     C                     READ SDCURRL1                 13                                 CLE075AF
     C                     MOVE A6CYCD    #CCY,A                                            CLE075AF
     C           *IN13     DOWEQ'0'                                                         CLE075AF
     C                     SUB  1         A                                                 CLE075AF
     C           A         OCUR SDCURR                                                      CLE075AF
     C                     READ SDCURRL1                 13                                 CLE075AF
     C                     MOVE A6CYCD    #CCY,A                                            CLE075AF
     C                     ENDDO                                                            CLE075AF
     C                     Z-ADDA         CURARR  30                                        CLE075AF
      *                                                                                       CLE134
      ** Set NEWCOB flag                                                                      CLE134
      *                                                                                       CLE134
     C                     MOVE 'N'       WFLAG   1                                           CLE134
     C                     MOVE 'N'       NEWCOB  1                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WPNAM     ANDEQ'NEWCOB'                                                      CLE134
     C                     MOVE 'Y'       NEWCOB  1                                           CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/PROCES
      *****************************************************************
      *                                                               *
      *  PROCES - SUBROUTINE TO PERFORM DETAIL PROCESSING.            *
      *                                                               *
      *  Called By: MAIN PROCESSING                                   *
      *                                                               *
      *  Calls:     EVENT, FEES, ZHASH, ZFWDT, AOCURRR0, SETLOC       *
      *             NONCAL                                            *
      *                                                               *
      *****************************************************************
      *
     C           PROCES    BEGSR
      *
      ***  Read through the updated facilities file.
      *
     C                     READ FCUPD                    03
      *
     C           *IN03     DOWEQ'0'                        ***B001
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     MOVE CNUM      KCNUM   6                                           CLE025
     C                     MOVE FACT      KFCTP   3                                           CLE025
     C                     MOVE FCNO      KFCNO   2                                           CLE025
     C**********           MOVE CNUM      KCNUMD  60                                   CLE025 CSD027
     C                     MOVE CNUM      KCNUMD  6                                           CSD027
     C                     MOVE FACT      KFCTPD  30                                          CLE025
     C                     MOVE FCNO      KFCNOD  20                                          CLE025
     C                     Z-ADD0         WSOF                                               BUG3281
     C                     Z-ADD0         WSMA                                               BUG3281
     C                     MOVE *ALL'0'   CAXO                                               BUG3281
     C                     MOVE *ALL'0'   CAXM                                               BUG3281
     C                     Z-ADD0         CAXOFC                                             BUG3281
     C                     ENDIF                                                              CLE025
      *
      ** If CLE005 is installed, check if facility is to be               156229
      ** reactivated (i.e., 'FR' amendment type exists).                  156229
      *                                                                   156229
     C           CLE005    IFEQ 'Y'                                       156229
     C                     MOVE 'N'       REACT   1                       157597
     C                     MOVE BRCA      XBRCA                           156229
     C**********           Z-ADDCNUM      XCNUM                                        156229 CSD027
     C                     MOVE CNUM      XCNUM                                               CSD027
     C                     Z-ADDFACT      XFACT                           156229
     C                     Z-ADDFCNO      XFCNO                           156229
     C********** FCMKEY    SETLLLEFCAML0                                             156229 AR544187
     C           FCMKEY    SETLLLEFCAML0             29                                     AR544187
     C           *IN29     IFEQ *OFF                                                        AR544187
     C                     READ LEFCAML0                 29               156229
     C           *IN29     DOWEQ*OFF                                      156229
     C           DFCLTC    ANDEQDFCLTR                                    156229
     C           FATP      IFEQ 'FR'                                      156229
     C           BRECI     ANDNE'R'                                       156229
     C***********          MOVE 'D'       RECI                     156229 157597
     C                     MOVE 'Y'       REACT                           157597
     C                     LEAVE                                          156229
     C                     ENDIF                                          156229
     C                     READ LEFCAML0                 29               156229
     C                     ENDDO                                          156229
     C                     ENDIF                                                            AR544187
     C                     ENDIF                                          156229
     C*                                                                   156229
     C           RCTP      IFEQ 'A'                        ***B002
      *
      ***  Stores any fields that have same name on more than one
      ***  input file to prevent the data being incorrect when writing
      ***  to the new updated facilities file.
      *
     C**********           Z-ADDCNUM      WACNUM  60                                          CSD027
     C                     MOVE CNUM      WACNUM  6                                           CSD027
     C                     Z-ADDFACT      WAFACT  30
     C                     Z-ADDFCNO      WAFCNO  20
     C                     MOVE BRCA      WABRCA  3
     C                     MOVE FCCY      WAFCCY  3
     C                     MOVE CRSK      WACRSK  2
     C                     MOVE ACOF      WAACOF  2
     C                     Z-ADDLCD       WALCD   50
     C                     MOVE CHTP      WACHTP  1
     C                     Z-ADDTNLU      WATNLU  50
     C                     MOVE NACD      WANACD  1                       101987
     C                     MOVE RVCR      WARVCR  1                       CLE014
     C                     MOVELPCRF      WAPCRF                          157887
     C                     MOVELPCOB      WAPCOB                          157887
     C                     MOVELIUSR      WAIUSR                          157887
     C                     MOVELAUSR      WAAUSR                          157887
     C                     MOVELXUSR      WAXUSR                          157887
     C                     MOVELDFTP      WADFTP                          157887
     C                     MOVELDFST      WADFST                          157887
     C                     MOVELDFCL      WADFCL                                              CLE042
     C                     MOVELAWBA      WAAWBA                          157887
     C                     MOVELAWBN      WAAWBN                          157887
     C                     MOVELBENA      WABENA                          157887
     C***********          MOVELBENA      WABENN                   157887 141475
     C                     MOVELBENN      WABENN                          141475
     C                     MOVELBTB1      WABTB1                          157887
     C                     MOVELBTB2      WABTB2                          157887
     C                     MOVELBTB3      WABTB3                          157887
     C                     MOVELBTB4      WABTB4                          157887
     C                     MOVELBTB5      WABTB5                          157887
     C                     MOVELBTB6      WABTB6                          157887
     C                     MOVELCVMR      WACVMR                          157887
     C                     MOVELDCHG      WADCHG                          157887
     C                     MOVELDTP1      WADTP1                          157887
     C                     MOVELDTP2      WADTP2                          157887
     C                     MOVELDTP3      WADTP3                          157887
     C                     MOVELDTP4      WADTP4                          157887
     C                     MOVELOMDB      WAOMDB                          157887
     C                     MOVELOSDB      WAOSDB                          157887
     C                     MOVELPIBA      WAPIBA                          157887
     C                     MOVELPIBN      WAPIBN                          157887
     C**********           Z-ADDPOBN      WAPOBN                                       157887 CSD027
     C**********           Z-ADDPOCN      WAPOCN                                       157887 CSD027
     C                     MOVE POBN      WAPOBN                                              CSD027
     C                     MOVE POCN      WAPOCN                                              CSD027
     C                     Z-ADDPSTM      WAPSTM                          157887
     C                     MOVELPONS      WAPONS                          157887
     C                     MOVELRCRA      WARCRA                          157887
     C                     MOVELRCRN      WARCRN                          157887
     C                     Z-ADDRSTM      WARSTM                          157887
     C                     MOVELRONS      WARONS                          157887
     C                     MOVELRIBA      WARIBA                          157887
     C                     MOVELRIBN      WARIBN                          157887
     C**********           Z-ADDROBN      WAROBN                                       157887 CSD027
     C**********           Z-ADDROCN      WAROCN                                       157887 CSD027
     C                     MOVE ROBN      WAROBN                                              CSD027
     C                     MOVE ROCN      WAROCN                                              CSD027
     C                     MOVELRVNO      WARVNO                          157887
     C                     MOVELRCSI      WARCSI                          157887
     C                     MOVE SCCY      WASCCY                          CLE031
     C                     Z-ADDREXR      WAREXR                          CLE031
     C                     MOVE REXI      WAREXI                          CLE031
     C                     MOVE PSCY      WAPSCY                          CLE031
     C                     Z-ADDPEXR      WAPEXR                          CLE031
     C                     MOVE PEXI      WAPEXI                          CLE031
     C                     MOVE STAL      WASTAL                          CLE034
     C                     MOVE ORBR      WAORBR                                            MD042841
     C                     MOVE AUTH      WAAUTH                                            MD055950
     C                     END                             ***E002
      *
     C           RCTP      IFEQ 'B'                        ***B002
     C**********           Z-ADDCNUM      WBCNUM  60                                          CSD027
     C                     MOVE CNUM      WBCNUM  6                                           CSD027
     C                     Z-ADDFACT      WBFACT  30
     C                     Z-ADDFCNO      WBFCNO  20
     C                     MOVE BTIN      WBBTIN  1
     C                     Z-ADDLCD       WBLCD   50
     C                     MOVE CHTP      WBCHTP  1
     C                     Z-ADDTNLU      WBTNLU  50
     C                     MOVELPRFC      WBPRFC                          179912
     C                     Z-ADDBLDY      WBBLDY  20                      158317
     C/COPY WNCPYSRC,LE0491C025
     C*                                                                   109148
     C** For live records, recalculate next Review date if equal to       109148
     C** or less than run date and if Frequency is not blank.  If         109148
     C** Expiry date is greater than the calculated date, update the      109148
     C** Review date.                                                     109148
     C*                                                                   109148
     C           RECI      IFEQ 'D'                                       109148
     C           RVDT      ANDLERUND                                      109148
     C           RVFR      ANDNE*BLANKS                                   109148
     C           REACT     OREQ 'Y'                                       157597
     C           RVDT      ANDLERUND                                      157597
     C           RVFR      ANDNE*BLANKS                                   157597
     C                     Z-ADDRVDT      ZDAYNO                          109148
     C                     MOVE RVFR      ZFREQ                           109148
     C                     MOVE BJLCCY    ZCCY                            109148
     C                     MOVE RVDY      ZMDAY                           109148
     C                     MOVE BJSLCD    ZLOC                            109148
     C                     EXSR ZFREQB                                    109148
     C           ZDAYNO    DOWLERUND                                      109148
     C                     EXSR ZFREQB                                    109148
     C                     END                                            109148
     C           REACT     IFEQ 'Y'                                       157597
     C           NDEX      IFGT ZDAYNO                                    157597
     C                     Z-ADDZDAYNO    RVDT                            157597
     C                     ENDIF                                          157597
     C                     ELSE                                           157597
     C           DTEX      IFGT ZDAYNO                                    109148
     C                     Z-ADDZDAYNO    RVDT                            109148
     C                     END                                            109148
     C           ZDAYNO    IFGT DTEX                                                         BUG8707
     C                     Z-ADD0         RVDT                                               BUG8707
     C                     MOVE *BLANKS   RVFR                                               BUG8707
     C                     Z-ADD*ZEROS    RVDY                                               BUG8707
     C                     ENDIF                                                             BUG8707
     C                     ENDIF                                          157597
     C                     END                                            109148
     C*                                                                   109148
     C***Also*for*live*record,*change*review*date*into*blank*if*it*i109148157210
     C***equal*or*less*than*rundate*and*if*frequency*is*blank.******109148157210
     C***********                                                   109148157210
     C***********RECI      IFEQ 'D'                                 109148157210
     C***********RVDT      ANDLERUND                                109148157210
     C***********RVFR      ANDEQ*BLANKS                             109148157210
     C***********          Z-ADD0         RVDT                      109148157210
     C***********          END                                      109148157210
     C                     END                             ***E002
     C/COPY WNCPYSRC,LE0491C026
      *
      ***  Set up key fields to ensure only records for this
      ***  facility are being processed.
      *
     C                     MOVE RECI      FCRECI  1
     C                     MOVE BRCA      FCBRCA  3
     C**********           Z-ADDCNUM      FCCNUM                                              CSD027
     C                     MOVE CNUM      FCCNUM                                              CSD027
     C                     Z-ADDFACT      FCFACT
     C                     Z-ADDFCNO      FCFCNO
      *                                                                   S01473
      ** If S01473 on, Set up key field for LEEVLOPD Processing.          S01473
      *                                                                   S01473
     C           *IN21     IFEQ '1'                                       S01473
     C**********           Z-ADDCNUM      LOCNUM                                       S01473 CSD027
     C                     MOVE CNUM      LOCNUM                                              CSD027
     C                     Z-ADDFACT      LOFACT                          S01473
     C                     Z-ADDFCNO      LOFCNO                          S01473
     C**********           Z-ADDLOFCLT    EVLEOK                                       S01473 CSD027
     C                     MOVE LOFCLT    EVLEOK                                              CSD027
     C                     END                                            S01473
      *
      *** Keep count of all 'A' and 'B' records. Use values from
      *** FCLTYFM ('A' records) for hash totalling but do not include
      *** values for closed facilities.
      *
     C           RCTP      IFEQ 'A'                        ***B002
     C           RCTP      OREQ 'B'
     C           COUNT1    ADD  1         COUNT1
     C                     END                             ***E002
      *
     C           RCTP      IFEQ 'A'                        ***B002
     C           RECI      ANDNE'C'
      *
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
      *
     C***********FAMT      DIV  1000      ZZAMT                           167498
     C**********           MOVE FAMT      ZZAMT                           167498              194380
     C           FAMT      DIV  1000      ZZAMT                                               194380
     C           FAMT      IFLT 0                                                             193603
     C                     Z-SUBZZAMT     ZZAMT                                               193603
     C                     END                                                                193603
     C                     Z-ADDTOTI1     ZZTOTI
     C                     Z-ADDTOTD1     ZZTOTD
      *
     C**********           EXSR ZHASH                                     167498
     C**********           EXSR GLZADD                                    167498              194380
     C                     EXSR ZHASH                                                         194380
      *
     C                     Z-ADDZZTOTI    TOTI1  150
     C                     Z-ADDZZTOTD    TOTD1   30
      *
     C                     END                             ***E002
      *
      ***  Event & fee processing should be performed only on 'B'
      ***  records that are not closed.
      *
     C           RCTP      IFEQ 'B'                        ***B002
     C           RECI      ANDNE'C'
     C           RCTP      OREQ 'B'                                       157597
     C           REACT     ANDEQ'Y'                                       157597
      *
      ***  Initialise current amount drawn and previous exposure
      *
     C/COPY WNCPYSRC,LE0491C001
     C                     Z-ADD0         CAMD
     C                     Z-ADD0         PEXP
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADD0         CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
     C/COPY WNCPYSRC,LE0491C002
      *
      ***  Calculate billing date
      *
     C           RUND      ADD  BLDY      BDAYS   50
     C/COPY WNCPYSRC,LE0491C022
      *
      ***  Calculate general end day (15) for use in event processing
      *
     C                     MOVE FCCY      ZCCY
     C                     Z-ADD15        ZNRDYS
     C                     Z-ADDRUND      ZDAYNO
     C                     MOVE *BLANKS   ZLOC
     C                     EXSR ZFWDT
     C                     Z-ADDZDYNBR    ENAR1   50
      *
      ***  Use greater of BDAYS & ENAR1 as extract date.  This is the
      ***  date bill/telexes are produced up to.
      *
     C           BDAYS     IFGT ENAR1                      ***B003
     C                     Z-ADDBDAYS     EXDT1   50
     C                     ELSE                            ***X003
     C                     Z-ADDENAR1     EXDT1
     C                     END                             ***E003
      *
      ***  Read all event records for the facility; adjusting          s
      ***  available and exposure amounts as appropriate.
      *
     C                     MOVE '0'       *IN23                           CLE004
      *                                                                   CLE004
     C                     MOVE RVCR      @RVCR   1                       144712
      *                                                                   144712
     C                     EXSR EVENT
      *                                                                   S01473
      ***  Read all LEO event records for the facility; adjusting         S01473
      ***  available and exposure amounts as appropriate.                 S01473
      *                                                                   S01473
     C           *IN21     IFEQ '1'                                       S01473
     C                     EXSR LEOVNT                                    S01473
     C                     END                                            S01473
      *                                                                                       CLE025
      ** Process all non-lending transactions linked to the facility                          CLE025
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     EXSR SRNLND                                                        CLE025
     C                     ENDIF                                                              CLE025
      *
      ***  Write facility records to new facility file
      *
     C                     MOVE FCRECI    RECI
      *
      ***  ('A' record can be written after read of 'B' record
      ***  because fields have different names)
      *
     C**********           Z-ADDWACNUM    CNUM                                                CSD027
     C                     MOVE WACNUM    CNUM                                                CSD027
     C                     Z-ADDWAFACT    FACT
     C                     Z-ADDWAFCNO    FCNO
     C                     MOVE WABRCA    BRCA
     C                     MOVE WAFCCY    FCCY
     C                     MOVE WACRSK    CRSK
     C                     MOVE WAACOF    ACOF
     C                     Z-ADDWALCD     LCD
     C                     MOVE WACHTP    CHTP
     C                     Z-ADDWATNLU    TNLU
     C                     MOVE WARVCR    RVCR                            CLE014
     C                     MOVE WANACD    NACD                            101987
     C                     MOVELWAPCRF    PCRF                            157887
     C                     MOVELWAPCOB    PCOB                            157887
     C                     MOVELWAIUSR    IUSR                            157887
     C                     MOVELWAAUSR    AUSR                            157887
     C                     MOVELWAXUSR    XUSR                            157887
     C                     MOVELWADFTP    DFTP                            157887
     C                     MOVELWADFST    DFST                            157887
     C                     MOVELWADFCL    DFCL                                                CLE042
     C                     MOVELWAAWBA    AWBA                            157887
     C                     MOVELWAAWBN    AWBN                            157887
     C                     MOVELWABENA    BENA                            157887
     C***********          MOVELWABENA    BENN                     157887 141475
     C                     MOVELWABENN    BENN                            141475
     C                     MOVELWABTB1    BTB1                            157887
     C                     MOVELWABTB2    BTB2                            157887
     C                     MOVELWABTB3    BTB3                            157887
     C                     MOVELWABTB4    BTB4                            157887
     C                     MOVELWABTB5    BTB5                            157887
     C                     MOVELWABTB6    BTB6                            157887
     C                     MOVELWACVMR    CVMR                            157887
     C                     MOVELWADCHG    DCHG                            157887
     C                     MOVELWADTP1    DTP1                            157887
     C                     MOVELWADTP2    DTP2                            157887
     C                     MOVELWADTP3    DTP3                            157887
     C                     MOVELWADTP4    DTP4                            157887
     C                     MOVELWAOMDB    OMDB                            157887
     C                     MOVELWAOSDB    OSDB                            157887
     C                     MOVELWAPIBA    PIBA                            157887
     C                     MOVELWAPIBN    PIBN                            157887
     C**********           Z-ADDWAPOBN    POBN                                         157887 CSD027
     C**********           Z-ADDWAPOCN    POCN                                         157887 CSD027
     C                     MOVE WAPOBN    POBN                                                CSD027
     C                     MOVE WAPOCN    POCN                                                CSD027
     C                     Z-ADDWAPSTM    PSTM                            157887
     C                     MOVELWAPONS    PONS                            157887
     C                     MOVELWARCRA    RCRA                            157887
     C                     MOVELWARCRN    RCRN                            157887
     C                     Z-ADDWARSTM    RSTM                            157887
     C                     MOVELWARONS    RONS                            157887
     C                     MOVELWARIBA    RIBA                            157887
     C                     MOVELWARIBN    RIBN                            157887
     C**********           Z-ADDWAROBN    ROBN                                         157887 CSD027
     C**********           Z-ADDWAROCN    ROCN                                         157887 CSD027
     C                     MOVE WAROBN    ROBN                                                CSD027
     C                     MOVE WAROCN    ROCN                                                CSD027
     C                     MOVELWARVNO    RVNO                            157887
     C                     MOVELWARCSI    RCSI                            157887
     C                     MOVE WASCCY    SCCY                            CLE031
     C                     Z-ADDWAREXR    REXR                            CLE031
     C                     MOVE WAREXI    REXI                            CLE031
     C                     MOVE WAPSCY    PSCY                            CLE031
     C                     Z-ADDWAPEXR    PEXR                            CLE031
     C                     MOVE WAPEXI    PEXI                            CLE031
     C                     MOVE WASTAL    STAL                            CLE034
     C                     MOVE WAORBR    ORBR                                              MD042841
     C                     MOVE WAAUTH    AUTH                                              MD055950
      *
     C                     MOVE 'A'       RCTP
     C                     WRITENFACLFMF
     C                     ADD  1         COUNTF
      *
     C**********           Z-ADDWBCNUM    CNUM                                                CSD027
     C                     MOVE WBCNUM    CNUM                                                CSD027
     C                     Z-ADDWBFACT    FACT
     C                     Z-ADDWBFCNO    FCNO
     C                     MOVE WBBTIN    BTIN
     C                     Z-ADDWBLCD     LCD
     C                     MOVE WBCHTP    CHTP
     C                     Z-ADDWBTNLU    TNLU
     C                     MOVELWBPRFC    PRFC                            179912
     C                     Z-ADDWBBLDY    BLDY                            158317
      *
     C                     MOVE 'B'       RCTP
      *                                                                   BH3505
      ** Update availability to reflect forthcoming or prior expiry.      BH3505
      *                                                                   BH3505
     C/COPY WNCPYSRC,LE0491C027
     C                     Z-ADD1         O       20                      BH3505
     C/COPY WNCPYSRC,LE0491C018
     C********** O         DOWLE10                                                   BH3505 MD024229
     C********** DTEX      IFLE RUNS,O                                    BH3505              204450
     C********** DTEX      IFLT RUNS,O                                               204450 MD024229
     C**********           Z-ADDFAMT      OAM,O                                      BH3505 MD024229
     C**********           END                                                       BH3505 MD024229
     C********** O         ADD  1         O                                          BH3505 MD024229
     C**********           END                                                       BH3505 MD024229
     C/COPY WNCPYSRC,LE0491C019
      *                                                                   BH3505
     C                     WRITENFACLFNF
     C/COPY WNCPYSRC,LE0491C005
     C                     ADD  1         COUNTF
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     UPDATLEFCLTD0                                                      CLE025
     C                     ENDIF                                                              CLE025
      *                                                                   CLE005
      ** If SAR CLE005 is installed                                       CLE005
      *                                                                   CLE005
     C           CLE014    IFEQ 'N'                                       CLE014
     C           CLE005    IFEQ 'Y'                                       CLE005
     C           TRCA      ANDEQ'TR'                                      CLE005
     C           PRTR      IFNE 'P'                                       128980
     C           PRTR      ANDNE'I'                                       128980
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C           RECI      IFNE 'E'                                                           216641
     C                     EXSR SRMOVE                                    CLE005
     C                     WRITELECAUTPF                                  CLE005
     C                     ENDIF                                                              216641
     C                     ENDIF                                          128980
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE014
      *
     C                     END                             ***E002
      *
      ***  Write closed facilities to file, unamended
      *
     C           RECI      IFEQ 'C'                        ***B002
     C           REACT     ANDNE'Y'                                       157597
      *
     C           RCTP      IFEQ 'A'                        ***B003
     C                     WRITENFACLFMF                                    0006
     C                     ADD  1         COUNTF
     C                     END                             ***E003
      *
     C           RCTP      IFEQ 'B'                        ***B003
     C/COPY WNCPYSRC,LE0491C023
     C                     WRITENFACLFNF
     C/COPY WNCPYSRC,LE0491C006
     C                     ADD  1         COUNTF
     C                     END                             ***E003
      *
     C                     END                             ***E002
      *
      ***  Initialise indicator used for setting up initial future
      ***  facility array
      *
     C                     MOVE '0'       *IN07
      *
      ***  Read next facility record
      *
     C                     READ FCUPD                    03
     C*
     C***  IT TRAILER READ....
     C*
     C           RECI      IFEQ 'T'
     C                     Z-ADDNORE      NOREFC  50
     C                     Z-ADDVLAF      VLAFFC 150
     C                     Z-ADDVLAL      VLALFC  30
     C                     SETON                     03
     C                     END
     C*
     C                     END                             ***E001
      *                                                                   CLE005
      ** If SAR CLE005 is installed                                       CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
     C                     MOVELNFACLZ    TNFACZ                          127659
     C                     READ LENFCTL0                 26               CLE005
      *                                                                   CLE005
     C           *IN26     DOWEQ*OFF                                      CLE005
      *                                                                   CLE005
      ** Save Facility details                                            CLE005
      *                                                                   CLE005
     C**********           Z-ADDCNUM      WSCNUM                                       CLE005 CSD027
     C                     MOVE CNUM      WSCNUM                                              CSD027
     C                     Z-ADDFACT      WSFACT                          CLE005
     C                     Z-ADDFCNO      WSFCNO                          CLE005
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     MOVE CNUM      KCNUM                                               CLE025
     C                     MOVE FACT      KFCTP                                               CLE025
     C                     MOVE FCNO      KFCNO                                               CLE025
     C                     ENDIF                                                              CLE025
      *                                                                   CLE005
     C                     MOVE FCNO      WSKEY0  5                       CLE005
     C                     MOVELFCNO      WSKEY0                          CLE005
     C                     MOVE WSKEY0    WSKEY  11                       CLE005
     C                     MOVELCNUM      WSKEY                           CLE005
      *                                                                   CLE005
      ** Set off update flag                                              CLE005
      *                                                                   CLE005
     C                     MOVE *OFF      WUPD    1                       CLE005
      *                                                                   CLE005
      ** Retrieve the Facility 'B' record                                 CLE005
      *                                                                   CLE005
     C           FCTYKY    CHAINLENFCTL1             27                   CLE005
      *                                                                   CLE005
     C           *IN27     IFEQ *ON                                       CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'LE0491  'DBPGM                           CLE005
     C                     MOVE 'LENFCTL1'DBFILE           ************   CLE005
     C                     Z-ADD09        DBASE            * DBERR 09 *   CLE005
     C                     MOVE WSKEY     DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           KFACTL    CHAINLEFCLTLH             81                                       CLE025
     C           *IN81     IFEQ *ON                                                           CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVEL'LE0491  'DBPGM                                               CLE025
     C                     MOVEL'LEFCLTLH'DBFILE                                              CLE025
     C                     Z-ADD43        DBASE                                               CLE025
     C                     MOVELCNUM      WKEY1                                               CLE025
     C                     MOVE FACT      WKEY1                                               CLE025
     C                     MOVELWKEY1     WKEY2                                               CLE025
     C                     MOVE FCNO      WKEY2                                               CLE025
     C                     MOVE WKEY2     DBKEY                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                   CLE014
     C                     Z-ADD*ZEROS    WKCAMD 130                      CLE014
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADD0         WKCEXP 130                                          CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE025
      ** Introduce new variable for offset accumulation of CA facilities                      CLE025
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     Z-ADD0         WKOFFS 130                                          CLE025
     C                     ENDIF                                                              CLE025
      *                                                                   CLE005
     C           FCTYKY    SETLLLECAUTL0                                  CLE005
     C                     READ LECAUTL0                 28               CLE005
      *                                                                   CLE005
     C           *IN28     DOWEQ*OFF                                      CLE005
     C           CAFCUS    ANDEQWSCNUM                                    CLE005
     C           CAFACT    ANDEQWSFACT                                    CLE005
     C           CAFCNO    ANDEQWSFCNO                                    CLE005
      *                                                                   CLE005
      ** Set on update flag                                               CLE005
      *                                                                   CLE005
     C                     MOVE *ON       WUPD                            CLE005
      *                                                                   CLE005
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     EXSR SRUPDT                                    CLE014
     C                     ELSE                                           CLE014
     C                     EXSR SRUPDF                                    CLE005
     C                     ENDIF                                          CLE014
     C                     READ LECAUTL0                 28               CLE005
     C                     ENDDO                                          CLE005
      *                                                                   CLE005
     C           WUPD      IFEQ *ON                                       CLE005
     C                     UPDATLENFCTLN                                  CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C                     UPDATLEFCLTD0                                                      CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     READ LENFCTL0                 26               CLE005
     C                     ENDDO                                          CLE005
      *                                                                   CLE005
     C                     MOVELTNFACZ    NFACLZ                          127659
     C                     ENDIF                                          CLE005
      *                                                                                       CLE025
      ** Write the end of the report for P1                                                   CLE025
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           WERROR    IFEQ 'N'                                                           CLE025
     C                     WRITENODTLS                                                        CLE025
     C                     ENDIF                                                              CLE025
     C                     WRITETRAILP1                                                       CLE025
     C                     ENDIF                                                              CLE025
      *
     C                     ENDSR
      *
      *****************************************************************   CLE005
      /TITLE SR/SRMOVE                                                    CLE005
      *****************************************************************   CLE005
      *                                                               *   CLE005
      *  SRMOVE - Move fields to file fields                          *   CLE005
      *                                                               *   CLE005
      *  Called By: PROCES                                            *   CLE005
      *                                                               *   CLE005
      *  Calls    : ZCONV                                             *   CLE005
      *                                                               *   CLE005
      *****************************************************************   CLE005
      *                                                                   CLE005
     C           SRMOVE    BEGSR                                          CLE005
      *                                                                   CLE005
      ** Move fields to file fields                                       CLE005
      *                                                                   CLE005
     C                     MOVE 'D'       CARECI                          CLE005
     C                     MOVE CANM      CAFCUS                          CLE005
     C                     MOVE CAFT      CAFACT                          CLE005
     C                     MOVE CAFN      CAFCNO                          CLE005
     C                     MOVE CNUM      CATRNM                          CLE005
     C                     MOVE FACT      CATRFT                          CLE005
     C                     MOVE FCNO      CATRFN                          CLE005
     C                     MOVE FCCY      CATRCY                          CLE005
     C                     MOVE CAXR      CACAXR                          CLE005
     C                     MOVE CMDI      CACMDI                          CLE005
     C                     MOVE CACY      CACACY                          CLE005
     C                     MOVE RUN0      CARUN0                          CLE005
     C                     MOVE RUN1      CARUN1                          CLE005
     C                     MOVE RUN2      CARUN2                          CLE005
     C                     MOVE RUN3      CARUN3                          CLE005
     C                     MOVE RUN4      CARUN4                          CLE005
     C                     MOVE RUN5      CARUN5                          CLE005
     C                     MOVE RUN6      CARUN6                          CLE005
     C                     MOVE RUN7      CARUN7                          CLE005
     C                     MOVE RUN8      CARUN8                          CLE005
     C                     MOVE RUN9      CARUN9                          CLE005
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           PTYP      ANDEQ0                                                             CLE025
     C                     MOVE WSOAM1    CAOAM1                                              CLE025
     C                     MOVE WSOAM2    CAOAM2                                              CLE025
     C                     MOVE WSOAM3    CAOAM3                                              CLE025
     C                     MOVE WSOAM4    CAOAM4                                              CLE025
     C                     MOVE WSOAM5    CAOAM5                                              CLE025
     C                     MOVE WSOAM6    CAOAM6                                              CLE025
     C                     MOVE WSOAM7    CAOAM7                                              CLE025
     C                     MOVE WSOAM8    CAOAM8                                              CLE025
     C                     MOVE WSOAM9    CAOAM9                                              CLE025
     C                     MOVE WSOA10    CAOA10                                              CLE025
     C                     ELSE                                                               CLE025
     C                     MOVE OAM1      CAOAM1                          CLE005
     C                     MOVE OAM2      CAOAM2                          CLE005
     C                     MOVE OAM3      CAOAM3                          CLE005
     C                     MOVE OAM4      CAOAM4                          CLE005
     C                     MOVE OAM5      CAOAM5                          CLE005
     C                     MOVE OAM6      CAOAM6                          CLE005
     C                     MOVE OAM7      CAOAM7                          CLE005
     C                     MOVE OAM8      CAOAM8                          CLE005
     C                     MOVE OAM9      CAOAM9                          CLE005
     C                     MOVE OA10      CAOA10                          CLE005
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           PTYP      ANDEQ0                                                             CLE025
     C                     MOVE WSCAMD    CACAMD                                              CLE025
     C                     ELSE                                                               CLE025
     C                     MOVE CAMD      CACAMD                          CLE005
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     MOVE PEXP      CAPEXP                          CLE005
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           CLE025    IFEQ 'Y'                                                          BUG3382
     C           PTYP      ANDEQ0                                                            BUG3382
     C                     MOVE WSCEXP    CACEXP                                             BUG3382
     C                     ELSE                                                              BUG3382
     C                     Z-ADDCEXP      CACEXP                                              CLE023
     C                     ENDIF                                                             BUG3382
     C                     ENDIF                                                              CLE023
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
      *                                                                   204435
     C                     MOVE EVAUTO    CAAUTO                          204557
      *                                                                   204435
     C                     MOVE RVCR      CATRRC                          CLE014
     C                     Z-ADDPTYP      CAPTP                           CLE014
     C                     MOVE RCSI      CARCSI                          CLE014
     C                     MOVE LPFI      CALPFI                          CLE014
     C                     Z-ADDEDAT      CAEDAT                          CLE014
     C                     MOVE ETYP      CAETP                           CLE014
     C                     MOVE INOI      CAINOI                          CLE014
      *                                                                                       209504
      ** Use event amount if it is already in CA ccy.                                         209504
     C           ECCY      IFNE CACACY                                                        209504
     C                     Z-ADDWEAMT     CAEAMT                          CLE014
     C                     ELSE                                                               209504
     C                     Z-ADDEAMT      CAEAMT                                              209504
     C                     ENDIF                                                              209504
      *                                                                                       CLE023
      ** If CLE023 is installed, move converted event amount (based on                        CLE023
      ** spot) to LECAUTPD field for CA processing.                                           CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           ECCY      IFNE CACACY                                                        209504
     C                     Z-ADDWSAMT     CASAMT                                              CLE023
     C                     ELSE                                                               209504
     C                     Z-ADDEAMT      CASAMT                                              209504
     C                     ENDIF                                                              209504
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                          CLE014
      *                                                                   CLE005
      ** If tranche currency and credit agreement currency are not the    CLE005
      ** same, convert amounts using the credit agreement exchange rate   CLE005
      * (except if Event was already in the correct ccy.)                                     209504
      *                                                                   CLE005
     C           CATRCY    IFNE CACACY                                    CLE005
     C           ECCY      ANDNECACACY                                                        209504
     C                     Z-ADDCACAXR    ZEXCH                           CLE005
     C                     MOVE CACMDI    ZMD                             CLE005
      *                                                                   CLE005
      ** Get Tranche Currency details                                     CLE005
      *                                                                   CLE005
     C**********           Z-ADD1         X                                          CLE005  BUG3382
     C********** CATRCY    LOKUPCURR,X                   13                          CLE005  BUG3382
      **********                                                                     CLE005  BUG3382
     C********** *IN13     IFEQ *ON                                                  CLE005  BUG3382
     C**********           Z-ADDCCDP,X    ZCDPI                                      CLE005  BUG3382
     C********** CLE023    IFEQ 'Y'                                                  CLE023  BUG3382
     C**********           MOVE MTDV,X    ZMDI1                                      CLE023  BUG3382
     C**********           Z-ADDCSPT,X    ZRATE1                                     CLE023  BUG3382
     C**********           ENDIF                                                     CLE023  BUG3382
     C**********           ELSE                                                      CLE005  BUG3382
     C                     MOVE CATRCY    PCURR                                              BUG3382
     C                     EXSR SRCURR                                                       BUG3382
     C           PRTCD     IFNE *BLANKS                                                      BUG3382
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'LE0491  'DBPGM                           CLE005
     C                     MOVE 'SDCURRPD'DBFILE           ************   CLE005
     C                     Z-ADD07        DBASE            * DBERR 07 *   CLE005
     C                     MOVE CATRCY    DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
     C                     Z-ADDA6NBDP    ZCDPI                                              BUG3382
     C           CLE023    IFEQ 'Y'                                                          BUG3382
     C                     MOVE A6MDIN    ZMDI1                                              BUG3382
     C                     Z-ADDA6SPRT    ZRATE1                                             BUG3382
     C                     ENDIF                                                             BUG3382
      *                                                                   CLE005
      ** Get Credit Agreement Currency details                            CLE005
      *                                                                   CLE005
     C**********           Z-ADD1         X                                           CLE005 BUG3382
     C********** CACACY    LOKUPCURR,X                   14                           CLE005 BUG3382
      **********                                                                      CLE005 BUG3382
     C********** *IN14     IFEQ *ON                                                   CLE005 BUG3382
     C**********           Z-ADDCCDP,X    ZCDPO                                       CLE005 BUG3382
     C********** CLE023    IFEQ 'Y'                                                   CLE023 BUG3382
     C**********           MOVE MTDV,X    ZMDI2                                       CLE023 BUG3382
     C**********           Z-ADDCSPT,X    ZRATE2                                      CLE023 BUG3382
     C**********           ENDIF                                                      CLE023 BUG3382
     C**********           ELSE                                                       CLE005 BUG3382
     C                     MOVE CACACY    PCURR                                              BUG3382
     C                     EXSR SRCURR                                                       BUG3382
     C           PRTCD     IFNE *BLANKS                                                      BUG3382
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'LE0491  'DBPGM                           CLE005
     C                     MOVE 'SDCURRPD'DBFILE           ************   CLE005
     C                     Z-ADD08        DBASE            * DBERR 08 *   CLE005
     C                     MOVE CACACY    DBKEY            ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
     C                     Z-ADDA6NBDP    ZCDPO                                              BUG3382
     C           CLE023    IFEQ 'Y'                                                          BUG3382
     C                     MOVE A6MDIN    ZMDI2                                              BUG3382
     C                     Z-ADDA6SPRT    ZRATE2                                             BUG3382
     C                     ENDIF                                                             BUG3382
      *                                                                   CLE005
      ** Convert Drawn Amount (CAOA,X)                                    CLE005
      *                                                                   CLE005
     C                     Z-ADD1         X                               CLE005
      *                                                                   CLE005
     C           X         DOWLE10                                        CLE005
     C                     Z-ADDCAOA,X    ZAMTCI                          CLE005
     C                     EXSR ZCONV                                     CLE005
     C                     Z-ADDZAMTCO    CAOA,X                          CLE005
     C                     ADD  1         X                               CLE005
     C                     ENDDO                                          CLE005
      *                                                                   CLE005
      ** Convert Current Exposure Amount Drawn (CACAMD)                   CLE005
      *                                                                   CLE005
     C                     Z-ADDCACAMD    ZAMTCI                          CLE005
     C                     EXSR ZCONV                                     CLE005
     C                     Z-ADDZAMTCO    CACAMD                          CLE005
      *                                                                   CLE005
      ** Convert Previous Exposure (CAPEXP)                               CLE005
      *                                                                   CLE005
     C                     Z-ADDCAPEXP    ZAMTCI                          CLE005
     C                     EXSR ZCONV                                     CLE005
     C                     Z-ADDZAMTCO    CAPEXP                          CLE005
      *                                                                   CLE014
      ** Convert Event Amount (CAEAMT)                                    CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     Z-ADDCAEAMT    ZAMTCI                          CLE014
     C                     EXSR ZCONV                                     CLE014
     C                     Z-ADDZAMTCO    CAEAMT                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       CLE023
      ** If CLE023 is installed, get cross rate between tranche and                           CLE023
      ** credit agreement and convert amount accordingly.                                     CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     EXSR ZXRATE                                                        CLE023
     C                     MOVE CATRCY    ZCCYI                                               CLE023
     C                     MOVE CACACY    ZCCYO                                               CLE023
     C                     Z-ADDZRATEX    ZEXCH                                               CLE023
     C                     MOVE ZMDIX     ZMD                                                 CLE023
      *                                                                                       CLE023
      ** Convert accumulated exposure in Tranche's ccy to CA's ccy.                           CLE023
      *                                                                                       CLE023
     C                     Z-ADDCACEXP    ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    CACEXP                                              CLE023
      *                                                                                       CLE023
      ** Convert event amount in Tranche's ccy to CA's ccy.                                   CLE023
      *                                                                                       CLE023
     C                     Z-ADDCASAMT    ZAMTCI                                              CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    CASAMT                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDSR                                          CLE005
      *                                                                   CLE005
      *****************************************************************   CLE005
      */TITLE*SR/GLZADD***                                                167498              194380
      *****************************************************************   167498              194380
      **********                                                      *   167498              194380
      ***GLZADD*-*Subroutine*to*add*an*amount*to*the*total***         *   167498              194380
      **********                                                      *   167498              194380
      ***Called*By:*PROCESS***                                        *   167498              194380
      **********                                                      *   167498              194380
      ***Calls:*****GLZSUM***                                         *   167498              194380
      **********                                                      *   167498              194380
      *****************************************************************   167498              194380
     C********** GLZADD    BEGSR                                          167498              194380
      **********                                                          167498              194380
     C**********           Z-ADDZZAMT     ZZAMT          91               167498              194380
     C***91*****           GOTO ZZAEND                                    167498              194380
     C********** ZZAMT     IFNE 0                                         167498              194380
      **********                                                          167498              194380
      ****Split*ZZAMT*into*integer*and*decimal*fields***                  167498              194380
      **********                                                          167498              194380
     C**********           Z-ADDZZAMT     ZZAMTI                          167498              194380
     C**********           MOVE ZZAMT     ZZAMTD                          167498              194380
      **********                                                          167498              194380
      ****Both*ZZAMTI*and*ZZAMTD*contain*a*'Sign'*zone*now***             167498              194380
      **********                                                          167498              194380
     C**********           EXSR GLZSUM                                    167498              194380
      **********                                                          167498              194380
     C**********           ENDIF                                          167498              194380
      **********                                                          167498              194380
     C********** ZZAEND    ENDSR                                          167498              194380
      *****************************************************************   167498              194380
      */TITLE*SR/GLZSUM****                                               167498              194380
      *****************************************************************   167498              194380
      **********                                                      *   167498              194380
      ***GLZSUM*-*Subroutine*to*carry*out*the*addition*for*GLZADD***  *   167498              194380
      **********                                                      *   167498              194380
      ***Called*By:*GLZADD***                                         *   167498              194380
      **********                                                      *   167498              194380
      ***Calls:*****None***                                           *   167498              194380
      **********                                                      *   167498              194380
      *****************************************************************   167498              194380
     C********** GLZSUM    BEGSR                                          167498              194380
      **********                                                          167498              194380
     C**********           Z-ADDZZTOTI    ZZTOTI                          167498              194380
     C**********           Z-ADDZZTOTD    ZZTOTD                          167498              194380
     C**********           SETOF                     919293               167498              194380
     C**********           SETOF                     949599               167498              194380
      **********                                                          167498              194380
      ***Determine*sign*of*ZZAMTI*and*D,*92*if*negative***                167498              194380
      **********                                                          167498              194380
     C********** ZZAMTI    COMP 0                      9293               167498              194380
     C***93***** ZZAMTD    COMP 0                      9293               167498              194380
     C***93*****           GOTO ZZSEND                                    167498              194380
      **********                                                          167498              194380
      ***Determine*sign*of*ZZTOTI*and*D,*91*if*negative***                167498              194380
      **********                                                          167498              194380
     C********** ZZTOTI    COMP 0                      9193               167498              194380
     C***93***** ZZTOTD    COMP 0                      9193               167498              194380
      **********                                                          167498              194380
      ***If*ZZTOTAL*is*zero,*return*ZZAMOUNT***                           167498              194380
      **********                                                          167498              194380
     C***93*****           Z-ADDZZAMTI    ZZTOTI                          167498              194380
     C***93*****           Z-ADDZZAMTD    ZZTOTD                          167498              194380
     C***93*****           GOTO ZZSEND                                    167498              194380
      **********                                                          167498              194380
      ***If*signs*differ*bypass*overflow*checks***                        167498              194380
      **********                                                          167498              194380
     C***91N92**                                                          167498              194380
     C*ORN91*92*           GOTO ZZOFPS                                    167498              194380
      **********                                                          167498              194380
     C********** ZZAMTD    ADD  ZZTOTD    ZZWK2   40                      167498              194380
     C********** ZZWK2     COMP 999                  93                   167498              194380
     C**N93***** ZZWK2     COMP -999                   93                 167498              194380
      **********                                                          167498              194380
     C***93N92** ZZAMTI    ADD  1         ZZWK3  150                      167498              194380
     C******93*92ZZAMTI    SUB  1         ZZWK3                           167498              194380
     C***93***** ZZTOTI    ADD  ZZWK3     ZZWK3                           167498              194380
     C**N93***** ZZTOTI    ADD  ZZAMTI    ZZWK3                           167498              194380
      **********                                                          167498              194380
      ****If*modulus*of*ZZWKK3*is*lt*mod.*ZZTOTI*then*o/f*has*occured**   167498              194380
      **********                                                          167498              194380
     C**N92***** ZZWK3     COMP ZZTOTI                 99                 167498              194380
     C***92***** ZZWK3     COMP ZZTOTI               99                   167498              194380
     C**N99*****           Z-ADDZZWK2     ZZTOTD                          167498              194380
     C**N99*****           Z-ADDZZWK3     ZZTOTI                          167498              194380
      **********                                                          167498              194380
      ***If*overflow*zeroise*ZZAMT*and*indicator*99*set*and*ZZTOT*field   167498              194380
      ***left*intact***                                                   167498              194380
      **********                                                          167498              194380
     C***99*****           Z-ADD0         ZZAMT                           167498              194380
     C**********           GOTO ZZSEND                                    167498              194380
      **********                                                          167498              194380
      *167498signs*are*different***                                       167498              194380
      **********                                                          167498              194380
     C********** ZZOFPS    TAG                                            167498              194380
      **********                                                          167498              194380
      ***If*ZZAMT*was*negative,*make*it*positive*to*compare*with*ZZTOT*   167498              194380
      **********                                                          167498              194380
     C***92*****           Z-SUBZZAMTI    ZZAMTI                          167498              194380
     C***92*****           Z-SUBZZAMTD    ZZAMTD                          167498              194380
      **********                                                          167498              194380
      ***If*ZZTOT*was*negative,*make*it*positive*to*compare*with*ZZAMT*   167498              194380
      **********                                                          167498              194380
     C***91*****           Z-SUBZZTOTI    ZZTOTI                          167498              194380
     C***91*****           Z-SUBZZTOTD    ZZTOTD                          167498              194380
      **********                                                          167498              194380
      ***Both*ZZAMT*and*ZZTOT*are*now*positive***                         167498              194380
      **********                                                          167498              194380
     C********** ZZTOTI    COMP ZZAMTI               93  95               167498              194380
     C***95***** ZZTOTD    COMP ZZAMTD               93  95               167498              194380
      **********                                                          167498              194380
      ***If*ZZTOT*equals*ZZAMT*return*zero***                             167498              194380
      **********                                                          167498              194380
     C***95*****           Z-ADD0         ZZTOTI                          167498              194380
     C***95*****           Z-ADD0         ZZTOTD                          167498              194380
     C***95*****           GOTO ZZSEND                                    167498              194380
      **********                                                          167498              194380
      ***If*ZZTOT*GT*ZZAMT***                                             167498              194380
      **********                                                          167498              194380
     C***93***** ZZAMTD    COMP ZZTOTD               94                   167498              194380
     C***93*94** ZZTOTI    SUB  1         ZZTOTI                          167498              194380
     C***93*94** ZZTOTD    ADD  1000      ZZWK2                           167498              194380
     C***93***** ZZTOTI    SUB  ZZAMTI    ZZTOTI                          167498              194380
     C***93*94** ZZWK2     SUB  ZZAMTD    ZZTOTD                          167498              194380
     C***93N94** ZZTOTD    SUB  ZZAMTD    ZZTOTD                          167498              194380
      **********                                                          167498              194380
      ****If*ZZAMT*GT*ZZTOT***                                            167498              194380
      **********                                                          167498              194380
     C**N93***** ZZTOTD    COMP ZZAMTD               94                   167498              194380
     C**N93*94** ZZAMTI    SUB  1         ZZWK3  150                      167498              194380
     C**N93*94** ZZAMTD    ADD  1000      ZZWK2                           167498              194380
     C**N93*94** ZZWK3     SUB  ZZTOTI    ZZTOTI                          167498              194380
     C**N93N94** ZZAMTI    SUB  ZZTOTI    ZZTOTI                          167498              194380
     C**N93*94** ZZWK2     SUB  ZZTOTD    ZZTOTD                          167498              194380
     C**N93N94** ZZAMTD    SUB  ZZTOTD    ZZTOTD                          167498              194380
      **********                                                          167498              194380
      ***Reverse*sign*of*ZZTOT*if*larger*i/p*fields*were*negative***      167498              194380
      **********                                                          167498              194380
     C**********           SETOF                     94                   167498              194380
     C***93*91**                                                          167498              194380
     C*ORN93*92*           SETON                     94                   167498              194380
     C***94*****           Z-SUBZZTOTI    ZZTOTI                          167498              194380
     C***94*****           Z-SUBZZTOTD    ZZTOTD                          167498              194380
      **********                                                          167498              194380
      ***Restore*sign*of*ZZAMTI*and*ZZAMTD*if*it*was*reversed***          167498              194380
      **********                                                          167498              194380
     C***92*****           Z-SUBZZAMTI    ZZAMTI                          167498              194380
     C***92*****           Z-SUBZZAMTD    ZZAMTD                          167498              194380
     C********** ZZSEND    TAG                                            167498              194380
      **********                                                          167498              194380
      ***If*ZZTOTD*is*zero,*and*ZZTOTI*is*negative*set-up*ZZNEGD***       167498              194380
      **********                                                          167498              194380
     C**********           SETOF                     96                   167498              194380
     C********** ZZTOTD    COMP 0                        91               167498              194380
     C***91***** ZZTOTI    COMP 0                      96                 167498              194380
     C***96*****           MOVE '.000-'   ZZNEGD  5                       167498              194380
      **********                                                          167498              194380
     C*SR*******           ENDSR                                          167498              194380
      *****************************************************************   167498              194380
      /TITLE SR/SRUPDF                                                    CLE005
      *****************************************************************   CLE005
      *                                                               *   CLE005
      *  SRUPDF - Update Processing                                   *   CLE005
      *                                                               *   CLE005
      *  Called By: PROCES                                            *   CLE005
      *                                                               *   CLE005
      *  Calls    : None                                              *   CLE005
      *                                                               *   CLE005
      *****************************************************************   CLE005
      *                                                                   CLE005
     C           SRUPDF    BEGSR                                          CLE005
      *                                                                   CLE005
     C                     Z-ADD1         X                               CLE005
     C                     ADD  CACAMD    CAMD                            127720
      *                                                                                       CLE023
      ** If CLE023 is installed, update Current Exposure field.                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     ADD  CACEXP    CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   CLE005
     C           X         DOWLE10                                        CLE005
     C                     Z-ADD1         Y                               CLE005
     C           RUNS,X    LOKUPCARN,Y                 1515               CLE005
      *                                                                   CLE005
     C           *IN15     IFEQ *ON                                       CLE005
     C                     ADD  CAOA,Y    OAM,X                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ADD  1         X                               CLE005
     C                     ENDDO                                          CLE005
      *                                                                   CLE005
     C                     ENDSR                                          CLE005
      *****************************************************************   CLE014
      /TITLE SR/SRUPDT                                                    CLE014
      *****************************************************************   CLE014
      *                                                               *   CLE014
      *  SRUPDT - Update processing                                   *   CLE014
      *                                                               *   CLE014
      *  Called By: PROCES                                            *   CLE014
      *                                                               *   CLE014
      *  Calls:                                                       *   CLE014
      *  AVAIL   - Subroutine to update availability array            *   CLE014
      *                                                               *   CLE014
      *****************************************************************   CLE014
      *                                                                   CLE014
     C           SRUPDT    BEGSR                                          CLE014
      *                                                                   CLE014
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           CAPTP     ANDEQ0                                                             CLE025
     C                     EXSR SRNONL                                                        CLE025
     C                     ELSE                                                               CLE025
      *                                                                                       CLE025
     C                     MOVELCAPTP     PTP                             CLE014
     C                     MOVELCARCSI    RCSI                            CLE014
     C                     MOVELCALPFI    LPFI                            CLE014
     C                     Z-ADDCAEDAT    EDAT                            CLE014
     C                     MOVE CAETP     ETP                             CLE014
     C                     MOVELCAINOI    INOI                            CLE014
     C                     Z-ADDCAEAMT    WEAMT                           CLE014
     C                     MOVE CAAUTO    EVAUTO                          204557
      *                                                                   CLE014
      ** Current exposure for the credit agreement                        CLE014
      *                                                                   CLE014
     C********** EDAT      IFLE BJRDNB                             CLE014 204663
     C*                                                                   204663
     C* Event date should check date next working day                     204663
     C*                                                                   204663
     C           EDAT      IFLE DNWD                                      204663
     C           ETP       IFEQ 'A1'                                      CLE014
     C           ETP       OREQ 'V1'                                      CLE014
     C           ETP       OREQ 'V3'                                      CLE014
     C           ETP       OREQ 'V5'                                      CLE014
     C           ETP       OREQ 'X3'                                                          CLE139
      *                                                                   204663
      * Use autosettle indicator from event                               204663
      *                                                                   204663
     C           EVAUTO    IFEQ 'Y'                                       204663
     C           EVAUTO    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
      *                                                                                       203074
      ** Current Amount Drawn is reduced for Parts sold w/o recourse,                         203074
      ** otherwise, it should be increased.                                                   203074
      *                                                                                       203074
     C           CPTP      IFNE '66'                                                          203074
     C           CPTP      ANDNE'67'                                                          203074
     C           CPTP      ANDNE'69'                                                          203074
     C           CPTP      ANDNE'72'                                                          203074
     C           CALPFI    IFNE 'I'                                                         AR677807
     C                     ADD  CAEAMT    WKCAMD                          CLE014
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     ADD  CASAMT    WKCEXP                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                            AR677807
     C                     ELSE                                                               203074
      *                                                                                       CLE023
      ** If CLE023 is installed, do not update CAMD for parts sold w/o                        CLE023
      ** recourse, only the Current Exposure must be affected.                                CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'N'                                                           CLE023
     C                     SUB  CAEAMT    WKCAMD                                              203074
     C                     ELSE                                                               CLE023
     C                     SUB  CASAMT    WKCEXP                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              203074
     C*                                                                   204663
     C                     ENDIF                                          204663
      *                                                                                       203074
     C                     ELSE                                           CLE014
     C           ETP       IFEQ 'R1'                                      CLE014
     C           ETP       OREQ 'R7'                                      CLE014
     C           ETP       OREQ 'M1'                                      CLE014
     C*                                                                   204663
     C* Use autosettle indicator from event                               204663
     C*                                                                   204663
     C           EVAUTO    IFEQ 'Y'                                       204663
     C           EVAUTO    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C*                                                                   204663
      *                                                                                       203074
      ** Current Amount Drawn is increased for Parts sold w/o recourse,                       203074
      ** otherwise, it should be decreased.                                                   203074
      *                                                                                       203074
     C           CPTP      IFNE '66'                                                          203074
     C           CPTP      ANDNE'67'                                                          203074
     C           CPTP      ANDNE'69'                                                          203074
     C           CPTP      ANDNE'72'                                                          203074
     C           CALPFI    IFNE 'I'                                                         AR677807
     C                     SUB  CAEAMT    WKCAMD                          CLE014
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     SUB  CASAMT    WKCEXP                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                            AR677807
     C                     ELSE                                                               203074
      *                                                                                       CLE023
      ** If CLE023 is installed, do not update CAMD for parts sold w/o                        CLE023
      ** recourse, only the Current Exposure must be affected.                                CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'N'                                                           CLE023
     C                     ADD  CAEAMT    WKCAMD                                              203074
     C                     ELSE                                                               CLE023
     C                     ADD  CASAMT    WKCEXP                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              203074
     C*                                                                   204663
     C                     ENDIF                                          204663
      *                                                                                       203074
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     Z-ADDWKCAMD    CAMD                            CLE014
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWKCEXP    CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
      *                                                                   CLE014
     C                     MOVE *OFF      *IN23                           CLE014
      *                                                                   CLE014
     C           ETP       IFEQ 'I2'                                      CLE014
     C           INOI      ANDEQ*BLANK                                    CLE014
     C                     MOVE *ON       *IN06                           CLE014
     C                     ELSE                                           CLE014
     C                     MOVE *OFF      *IN06                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           RVCR      IFEQ 'T'                                       CLE014
     C                     MOVE CATRRC    @RVCR                           CLE014
     C                     ELSE                                           CLE014
     C                     MOVE RVCR      @RVCR                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     EXSR AVAIL                                     CLE014
      *                                                                   CLE014
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSR                                          CLE014
      *                                                                   CLE014
      *                                                                   CLE005
      *****************************************************************                       CLE025
      /TITLE SR/SRNONL                                                                        CLE025
      *****************************************************************                       CLE025
      *                                                               *                       CLE025
      *  SRNONL - Compute for Non-Lending Exposures and Offsets       *                       CLE025
      *                                                               *                       CLE025
      *****************************************************************                       CLE025
      *                                                                                       CLE025
     C           SRNONL    BEGSR                                                              CLE025
      *                                                                                       CLE025
      ** Accumulate current offset of the tranches' records in LECAUTPD                       CLE025
      *                                                                                       CLE025
     C                     ADD  CAXOFC    WKOFFS                                              CLE025
      *                                                                                       CLE025
      ** Add current exposure of tranches' records to current exposure of CA                  CLE025
      *                                                                                       CLE025
     C                     ADD  CACAMD    WKCAMD                                              CLE025
     C                     ADD  CAXM,1    WKCAMD                                              CLE025
     C                     ADD  CACEXP    WKCEXP                                             BUG3382
     C                     ADD  CAXM,1    WKCEXP                                             BUG3382
      *                                                                                       CLE025
     C                     Z-ADDWKOFFS    FCXCOF                                              CLE025
     C                     Z-ADDWKCAMD    CAMD                                                CLE025
     C                     Z-ADDWKCEXP    CEXP                                               BUG3382
      *                                                                                       CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C                     ADD  CAXO,I    FCXO,I                                              CLE025
     C                     ADD  CAXM,I    MARQ,I                                              CLE025
     C                     ADD  CAOA,I    OAM,I                                               CLE025
     C                     ADD  CAXM,I    OAM,I                                               CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      *                                                                                       CLE025
      *****************************************************************
     C/COPY WNCPYSRC,LE0491C007
      /TITLE SR/EVENT
      *****************************************************************
      *                                                               *
      *  EVENT  - SUBROUTINE TO PROCESS EVENT RECORDS                 *
      *                                                               *
      *  Called By: PROCES                                            *
      *                                                               *
      *  Calls    : CONV, AVAIL, UFAMT, EXPSR, ZHASH                  *
      *                                                               *
      *****************************************************************
      *
     C           EVENT     BEGSR
      *
      ***  Obtain all event details for the facility being processed.
      *
     C           CLE005    IFEQ 'Y'                                       144712
     C                     MOVE 'N'       REVCHG  1                                           204716
     C                     MOVE 'N'       WFLAG1  1                       144712
     C                     MOVE 'D'       WRECI                           144712
     C********** KEY003    SETLLLELEFAL1                                             144712 AR544187
     C           KEY003    SETLLLELEFAL1             04                                     AR544187
     C           *IN04     IFEQ '0'                                                         AR544187
     C           KEY003    READELELEFAL1                 04               144712
     C                     ENDIF                                                            AR544187
     C           *IN04     IFEQ '1'                                       144712
     C                     MOVE 'L'       WRECI                           144712
     C********** KEY003    SETLLLELEFAL1                                             144712 AR544187
     C           KEY003    SETLLLELEFAL1             04                                     AR544187
     C           *IN04     IFEQ '0'                                                         AR544187
     C           KEY003    READELELEFAL1                 04               144712
     C                     ENDIF                                                            AR544187
     C                     MOVE 'Y'       WFLAG1  1                       144712
     C                     ELSE                                                               204716
     C           FATP      IFEQ 'RC'                                                          204716
     C                     MOVE 'Y'       REVCHG                                              204716
     C                     ENDIF                                                              204716
     C                     ENDIF                                          144712
     C                     ELSE                                           144712
     C********** KEY001    SETLLLVENTELF                                                    AR544187
     C           KEY001    SETLLLVENTELF             04                                     AR544187
     C           *IN04     IFEQ '0'                                                         AR544187
     C           KEY001    READELVENTELF                 04
     C                     ENDIF                                                            AR544187
     C                     ENDIF                                          144712
      *
     C           *IN04     DOWEQ'0'                        ***B001
      *                                                                   144712
      * Move AUTO to workfield to prevent corruption                      204557
      *                                                                   204557
     C                     MOVE AUTO      EVAUTO                          204557
      *                                                                   204557
     C********** CLE005    IFEQ 'Y'                                       144712              204716
     C********** RECI      ANDEQ'D'                                       144712              204716
      *                                                                   144712
     C           VLDT      IFLE EDAT                                                          204716
     C           REVCHG    ANDEQ'Y'                                                           204716
     C**********           MOVE ARVCR     @RVCR                                        144712 204446
     C                     ELSE                                                               204716
     C                     MOVE RVCR      @RVCR                                               204716
     C                     ENDIF                                                              204716
      *                                                                   144712
      *                                                                                       199220
      ** Move new ARVCR to RVCR if the amendment value date is less                           199220
      ** than or equal the rundate or accruals/profit date.                                   199220
      *                                                                                       199220
     C           FREC      IFEQ 'LEFCAMPF'                                                    195865
     C           FATP      ANDEQ'RC'                                                          195865
     C           VLDT      ANDLEBJRDNB                                                        195865
     C           FREC      OREQ 'LEFCAMPF'                                                    199220
     C           FATP      ANDEQ'RC'                                                          199220
     C           VLDT      ANDLEBKAPDT                                                        199220
     C           BKAPFQ    ANDEQ'D'                                                           199220
     C                     MOVE ARVCR     RVCR                                                195865
     C                     ENDIF                                                              195865
      *                                                                                       195865
     C**********           ELSE                                           144712              204716
     C           RECI      IFNE 'D'                                                           204716
      *
      ***  Save record ID for output later
      *
     C                     MOVE RECI      LERECI  1
     C                     MOVE '0'       *IN05                           128134
      *
      ***  Only process event further if this is not an inter-branch
      ***  event.
      *
     C           IBRE      IFNE 'Y'                        ***B002
      *
     C           PTP       IFEQ '64'                       ***B003
     C           PTP       OREQ '65'
     C           PTP       OREQ '66'
     C           PTP       OREQ '67'
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'68'                                      127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'69'                                      127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'71'                                      127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'72'                                      127720
      *
      *
      *** Find out if customer is a branch internal customer, if so
      *** availability as this is an inter-branch participation.
      *
     C                     MOVE CNUM      WCNUM   6
      *
     C           WCNUM     LOKUPBCA                      05
      *
     C                     END                             ***E003
      *
      ***  If event type 'I2' and incoming/outgoing indicator is
      ***  blank this is a capitalised interest repayment event.
      ***  Flag for use later.
      *
     C                     MOVE '0'       *IN06                        0066
     C           ETP       IFEQ 'I2'                       ***B003
     C           INOI      ANDEQ*BLANKS
     C           INTC      ANDEQ'Y'                                       180041
     C                     MOVE '1'       *IN06
     C                     END                             ***E003
     C                     MOVE CNUM      TCNUM   6                       184606
      *
      ***  Dummy event updating
      *
     C                     MOVE 'A'       RCDT                            CLE004
     C           KEY002    CHAINCLOAN                22                   CLE004
     C           *IN22     IFEQ '1'                        ***B003        CLE004
     C           *LOCK     IN   LDA                                       CLE004
     C                     MOVELLNRF      CLOANK  7                       CLE004
     C                     MOVE RCDT      CLOANK                          CLE004
     C                     MOVEL'LE0491  'DBPGM                           CLE004
     C                     MOVE 'CLOANCL 'DBFILE           ************   CLE004
     C                     Z-ADD24        DBASE            * DBERR 24 *   CLE004
     C                     MOVE CLOANK    DBKEY            ************   CLE004
     C                     OUT  LDA                                       CLE004
     C                     EXSR *PSSR                                     CLE004
     C                     ENDIF                           ***E003        CLE004
     C                     MOVE LPFI      WLPFI   1                       CLE004
     C                     MOVE AUTO      AUTOL   1                                           204708
     C                     Z-ADDMDAT      MDATL   50                                          204708
     C                     MOVE TCNUM     CNUM                            184606
      *                                                                   CLE004
     C                     MOVE 'N'       WPDCL   1                                           CLE134
     C                     EXSR SRPDCL                                                        CLE134
      *                                                                                       CLE134
     C           ETP       IFEQ 'A1'                       ***B003
      *
     C           COUNT2    ADD  1         COUNT2                            0020
      *
      ***  Changes to exposure or availability must be done in
      ***  the facility currency so if event currency different
      ***  the event amount needs to be converted.
      *
     C                     MOVE ECCY      INCCY   3
     C                     MOVE FCCY      OUTCCY  3
     C                     Z-ADDEAMT      WEAMT  130
      *
     C                     EXSR CONV
      *
      ***  Update facility exposure
      *
     C                     EXSR SRFAMU                                                       263840A
      *                                                                                       CLE134
     C           NEWCOB    IFEQ 'N'                                                           CLE134
     C           PROC      ANDEQ'Y'                                                          263840A
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           CLE134
     C           WPDCL     ANDEQ'Y'                                                           CLE134
     C           FAMU      ANDEQ'Y'                                                           CLE134
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           263840
     C           WPDCL     ANDEQ'Y'                                                           263840
     C           WTYP      ANDEQ'X'                                                           263840
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           262892
     C           WPDCL     ANDNE'Y'                                                           262892
     C           PROC      ANDEQ'Y'                                                          263840A
      *                                                                                       CLE134
     C                     EXSR EXPSR
     C                     ENDIF                                                              CLE134
      *
      ***  Only update facility availability array if this is not
      ***  an inter-branch participation event.
      *
     C           *IN05     IFEQ '0'                        ***B004
     C***********CLE004    IFEQ 'Y'                        ***B005 CLE004 133342
     C***********WLPFI     ANDEQ*BLANK                             CLE004 133342
      *                                                                                       CLE134
     C           NEWCOB    IFEQ 'N'                                                           CLE134
     C           PROC      ANDEQ'Y'                                                          263840A
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           CLE134
     C           WPDCL     ANDEQ'Y'                                                           CLE134
     C           FAMU      ANDEQ'Y'                                                           CLE134
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           263840
     C           WPDCL     ANDEQ'Y'                                                           263840
     C           WTYP      ANDEQ'X'                                                           263840
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           262892
     C           WPDCL     ANDNE'Y'                                                           262892
     C           PROC      ANDEQ'Y'                                                          263840A
      *                                                                                       CLE134
     C                     EXSR AVAIL
     C                     ENDIF                                                              CLE134
      *                                                                   CLE014
      ** If SAR CLE005 is installed                                       CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           CLE005    IFEQ 'Y'                                       CLE014
     C           TRCA      ANDEQ'TR'                                      CLE014
     C           PRTR      IFNE 'P'                                       CLE014
     C           PRTR      ANDNE'I'                                       CLE014
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C                     EXSR SRMOVE                                    CLE014
     C                     WRITELECAUTPF                                  CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C***********          END                             ***E005 CLE004 133342
     C                     END                             ***E004
      *
      ***  End for if equal to dummy event
      *
     C                     END                             ***E003
      *
      ****************************************************
      ***  UPDATING FOR ALL EVENTS EXCEPT DUMMY EVENTS ***
      ****************************************************
      *
      ***  Check that event is a valid event as held on event array
      *
     C           ETP       IFNE 'A1'                       ***B003
     C           *IN06     ANDNE'1'
     C           ETP       LOKUPTABVAL                   07
     C                     END                             ***E003
      *
      ***  If valid event or 'I2' with blank input/output indicator
      ***  compare event date and extract date.
      *
     C           *IN07     IFEQ '1'                        ***B003
     C           *IN06     OREQ '1'
      *
      ***  Only process events that are not greater than extract
      ***  date or maturity events with an extract date of zero.
      *
     C           EDAT      IFLE EXDT1                      ***B004
     C           EDAT      ANDNE0
      *
      ***  Obtain currency details
      *
      ***  Changes to exposure or availability must be done in
      ***  the facility currency so if event currency different
      ***  the event amount needs to be converted.
      *
     C                     MOVE ECCY      INCCY
     C                     MOVE FCCY      OUTCCY
     C                     Z-ADDEAMT      WEAMT
      *
     C                     EXSR CONV
      *
      *** Update facility expsoure
      *
     C                     EXSR SRFAMU                                                       263840A
      *                                                                                      263840A
     C           NEWCOB    IFEQ 'N'                                                           CLE134
     C           PROC      ANDEQ'Y'                                                          263840A
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           CLE134
     C           WPDCL     ANDEQ'Y'                                                           CLE134
     C           FAMU      ANDEQ'Y'                                                           CLE134
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           263840
     C           WPDCL     ANDEQ'Y'                                                           263840
     C           WTYP      ANDEQ'X'                                                           263840
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           262892
     C           WPDCL     ANDNE'Y'                                                           262892
     C           PROC      ANDEQ'Y'                                                          263840A
     C                     EXSR EXPSR
     C                     ENDIF                                                              CLE134
      *
      *** Only update facility availability if not an inter-branch
      *** participation.
      *
     C           *IN05     IFEQ '0'                        ***B005
     C***********CLE004    IFEQ 'Y'                        ***B006 CLE004 133342
     C***********WLPFI     ANDEQ*BLANK                             CLE004 133342
      *                                                                                       263840
     C           NEWCOB    IFEQ 'N'                                                           CLE134
     C           PROC      ANDEQ'Y'                                                          263840A
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           CLE134
     C           WPDCL     ANDEQ'Y'                                                           CLE134
     C           FAMU      ANDEQ'Y'                                                           CLE134
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           263840
     C           WPDCL     ANDEQ'Y'                                                           263840
     C           WTYP      ANDEQ'X'                                                           263840
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           262892
     C           WPDCL     ANDNE'Y'                                                           262892
     C           PROC      ANDEQ'Y'                                                          263840A
     C                     EXSR AVAIL
     C                     ENDIF                                                              CLE134
      *                                                                   CLE014
      ** If SAR CLE005 is installed                                       CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           CLE005    IFEQ 'Y'                                       CLE014
     C           TRCA      ANDEQ'TR'                                      CLE014
     C           PRTR      IFNE 'P'                                       CLE014
     C           PRTR      ANDNE'I'                                       CLE014
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C                     EXSR SRMOVE                                    CLE014
     C                     WRITELECAUTPF                                  CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C***********          END                             ***E006 CLE004 133342
     C                     END                             ***E005
      *
      *** End for if EDAT LE EXDT1
      *
     C                     END                             ***E004
      *
      *** End for if 06 & 07
      *
     C                     END                             ***E003
      *
      *** End for if multibranching
      *
     C                     END                             ***E002
     C*                                                                    0076
     C****Output*live,*expired*&*closed*events*-*do*not*output*dummy       0076
     C****events****************************************************       0076
     C**************************************************************       0076
     C           ETP       IFNE 'A1'                       ***B002         0076
     C*                                                                    0076
     C** Now output all events including the dummies as LE0492 needs       0076
     C** them for fee calculations                                         0076
     C*                                                                    0076
      *
     C           COUNT2    ADD  1         COUNT2
      *
     C                     Z-ADD1         Z
     C                     Z-ADD2         S
      *
     C           EAMT      DIV  1000      ZZAMT
     C                     Z-ADDTOTI2     ZZTOTI
     C                     Z-ADDTOTD2     ZZTOTD
      *
     C                     EXSR ZHASH
      *
     C                     Z-ADDZZTOTI    TOTI2  150
     C                     Z-ADDZZTOTD    TOTD2   30
      *
      ***  Reset record ID from saved data for output
      *
     C                     MOVE LERECI    RECI
      *
     C                     END                              ***E002 0076
      *                                                             0076
     C***********          WRITEOLVENTEL                                  045634
     C***********          ADD  1         COUNTL                          045634
     C*
     C***  UPDATE DUMMY COUNT IF DUMMY EVENT
     C*
     C           ETP       IFEQ 'A1'                                     0076
     C*********************ELSE                                          0076
     C                     ADD  1         COUNTD
     C                     END                                           0076
      *
     C*********************END                             ***E002         0076
      *
     C                     ENDIF                                          144712
      *                                                                   144712
     C                     MOVE '0'       *IN04                           144712
     C           CLE005    IFEQ 'Y'                                       144712
      *                                                                   144712
     C           WFLAG1    IFEQ 'N'                                       144712
     C                     MOVE 'D'       WRECI                           144712
     C           KEY003    READELELEFAL1                 04               144712
      *                                                                   144712
     C           *IN04     IFEQ '1'                                       144712
     C                     MOVE 'L'       WRECI                           144712
     C********** KEY003    SETLLLELEFAL1                                             144712 AR544187
     C           KEY003    SETLLLELEFAL1             04                                     AR544187
     C           *IN04     IFEQ '0'                                                         AR544187
     C           KEY003    READELELEFAL1                 04               144712
     C                     ENDIF                                                            AR544187
     C                     MOVE 'Y'       WFLAG1  1                       144712
      *                                                                                       204716
     C                     ELSE                                                               204716
      *                                                                                       204716
     C           FATP      IFEQ 'RC'                                                          204716
     C                     MOVE 'Y'       REVCHG                                              204716
     C                     ENDIF                                                              204716
     C                     ENDIF                                          144712
      *                                                                   144712
     C                     ELSE                                           144712
     C                     MOVE 'L'       WRECI                           144712
     C           KEY003    READELELEFAL1                 04               144712
     C                     ENDIF                                          144712
      *                                                                   144712
     C                     ELSE                                           144712
     C           KEY001    READELVENTELF                 04
     C                     ENDIF                                          144712
      *
      * End for do while
     C                     END                             ***E001
      *                                                                   CLE004
      ** Event processing for participant facility                        CLE004
      *                                                                   CLE004
     C           CLE004    IFEQ 'Y'                        ***B001        CLE004
     C           PRTR      ANDEQ'I'                                       CLE004
     C           CLE004    OREQ 'Y'                                       CLE004
     C           PRTR      ANDEQ'P'                                       CLE004
     C           CLE106    OREQ 'Y'                                                           CLE106
     C           PRTR      ANDEQ'R'                                                           CLE106
     C           CLE106    OREQ 'Y'                                                           CLE106
     C           PRTR      ANDEQ'S'                                                           CLE106
     C                     MOVE '1'       *IN23                           CLE004
      *                                                                   CLE004
     C           KEY001    SETLLLELOANL7                                  CLE004
     C           KEY001    READELELOANL7                 24               CLE004
      *                                                                   CLE004
     C           *IN24     DOWEQ'0'                        ***B002        CLE004
      *                                                                   CLE004
     C**********           Z-ADDLNRF      WLLOAN  60                                   CLE004 CLE148
     C                     MOVELLNRF      WLLOAN  6                                           CLE148
     C           WLLOAN    SETLLLELVNTL1                                  CLE004
     C           WLLOAN    READELELVNTL1                 25               CLE004
      *                                                                   CLE004
     C           *IN25     DOWEQ'0'                        ***B003        CLE004
      *                                                                   CLE004
     C                     MOVE '0'       *IN05                           154557
      *                                                                                       204716
     C                     MOVE 'D'       WRECI                                               204716
     C                     MOVE RVCR      @RVCR                                               204716
     C           KEY003    SETLLLEFCAMPF                                                      204716
     C           KEY003    READELEFCAMPF                 30                                   204716
     C           *IN30     DOWEQ'0'                                                           204716
     C           FATP      IFEQ 'RC'                                                          204716
     C           VLDT      IFLE BJRDNB                                                        204716
     C                     MOVE ARVCR     RVCR                                                204716
     C                     MOVE ARVCR     @RVCR                                               204716
     C                     LEAVE                                                              204716
     C                     ENDIF                                                              204716
     C           VLDT      IFLE EDAT                                                          204716
     C                     MOVE ARVCR     @RVCR                                               204716
     C                     LEAVE                                                              204716
     C                     ENDIF                                                              204716
     C                     ENDIF                                                              204716
     C           KEY003    READELEFCAMPF                 30                                   204716
     C                     ENDDO                                                              204716
      *                                                                                       204716
     C           IBRE      IFNE 'Y'                        ***B004        CLE004
      *                                                                   CLE004
     C***********PTP       IFEQ '64'                       ***B005 CLE004 154557
     C***********PTP       OREQ '65'                               CLE004 154557
     C***********PTP       OREQ '66'                               CLE004 154557
     C***********PTP       OREQ '67'                               CLE004 154557
      ***********                                                  127720 154557
     C***********CLE005    OREQ 'Y'                                127720 154557
     C***********PTP       ANDEQ'68'                               127720 154557
     C***********CLE005    OREQ 'Y'                                127720 154557
     C***********PTP       ANDEQ'69'                               127720 154557
     C***********CLE005    OREQ 'Y'                                127720 154557
     C***********PTP       ANDEQ'71'                               127720 154557
     C***********CLE005    OREQ 'Y'                                127720 154557
     C***********PTP       ANDEQ'72'                               127720 154557
      ***********                                                  CLE004 154557
      ****Find*out if customer is a branch internal customer, if soCLE004 154557
      ****availability as this is an inter-branch participation.   CLE004 154557
      ***********                                                  CLE004 154557
     C***********          MOVE FCCNUM    WCNUM   6                CLE004 154557
      ***********                                                  CLE004 154557
     C***********WCNUM     LOKUPBCA                      05        CLE004 154557
      ***********                                                  CLE004 154557
     C***********          END                             ***E005 CLE004 154557
      *                                                                   CLE004
      ***  If event type 'I2' and incoming/outgoing indicator is          CLE004
      ***  blank this is a capitalised interest repayment event.          CLE004
      ***  Flag for use later.                                            CLE004
      *                                                                   CLE004
     C                     MOVE '0'       *IN06                           CLE004
     C           ETP       IFEQ 'I2'                       ***B005        CLE004
     C           INOI      ANDEQ*BLANKS                                   CLE004
     C           INTC      ANDEQ'Y'                                       180041
     C                     MOVE '1'       *IN06                           CLE004
     C                     END                             ***E005        CLE004
      *                                                                   CLE004
      ***  Dummy event updating                                           CLE004
      *                                                                   CLE004
     C           ETP       IFEQ 'A1'                       ***B005        CLE004
      *                                                                   CLE004
     C***********COUNT2    ADD  1         COUNT2                   CLE004 123855
      *                                                                   CLE004
      ***  Changes to exposure or availability must be done in            CLE004
      ***  the facility currency so if event currency different           CLE004
      ***  the event amount needs to be converted.                        CLE004
      *                                                                   CLE004
     C                     MOVE ECCY      INCCY   3                       CLE004
     C                     MOVE FCCY      OUTCCY  3                       CLE004
     C                     Z-ADDEAMT      WEAMT  130                      CLE004
      *                                                                   CLE004
     C                     EXSR CONV                                      CLE004
      *                                                                   CLE004
     C                     EXSR SRFAMU                                                       263840A
      *                                                                                      263840A
     C           NEWCOB    IFEQ 'N'                                                           CLE134
     C           PROC      ANDEQ'Y'                                                          263840A
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           CLE134
     C           WPDCL     ANDEQ'Y'                                                           CLE134
     C           FAMU      ANDEQ'Y'                                                           CLE134
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           263840
     C           WPDCL     ANDEQ'Y'                                                           263840
     C           WTYP      ANDEQ'X'                                                           263840
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           262892
     C           WPDCL     ANDNE'Y'                                                           262892
     C           PROC      ANDEQ'Y'                                                          263840A
      ***  Update facility exposure                                       CLE004
      *                                                                   CLE004
     C                     EXSR EXPSR                                     CLE004
     C                     ENDIF                                                              CLE134
      *                                                                   CLE004
      ***  Only update facility availability array if this is not         CLE004
      ***  an inter-branch participation event.                           CLE004
      *                                                                   CLE004
     C           *IN05     IFEQ '0'                        ***B006        CLE004
     C           NEWCOB    IFEQ 'N'                                                           CLE134
     C           PROC      ANDEQ'Y'                                                          263840A
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           CLE134
     C           WPDCL     ANDEQ'Y'                                                           CLE134
     C           FAMU      ANDEQ'Y'                                                           CLE134
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           263840
     C           WPDCL     ANDEQ'Y'                                                           263840
     C           WTYP      ANDEQ'X'                                                           263840
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           262892
     C           WPDCL     ANDNE'Y'                                                           262892
     C           PROC      ANDEQ'Y'                                                          263840A
     C                     EXSR AVAIL                                     CLE004
     C                     ENDIF                                                             CLE134
      *                                                                   CLE014
      ** If SAR CLE005 is installed                                       CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           CLE005    IFEQ 'Y'                                       CLE014
     C           TRCA      ANDEQ'TR'                                      CLE014
     C           PRTR      IFNE 'P'                                       CLE014
     C           PRTR      ANDNE'I'                                       CLE014
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C                     EXSR SRMOVE                                    CLE014
     C                     WRITELECAUTPF                                  CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     END                             ***E006        CLE004
      *                                                                   CLE004
      ***  End for if equal to dummy event                                CLE004
      *                                                                   CLE004
     C                     END                             ***E005        CLE004
      *                                                                   CLE004
      ****************************************************                CLE004
      ***  UPDATING FOR ALL EVENTS EXCEPT DUMMY EVENTS ***                CLE004
      ****************************************************                CLE004
      *                                                                   CLE004
      ***  Check that event is a valid event as held on event array       CLE004
      *                                                                   CLE004
     C           ETP       IFNE 'A1'                       ***B005        CLE004
     C           *IN06     ANDNE'1'                                       CLE004
     C           ETP       LOKUPTABVAL                   07               CLE004
     C                     END                             ***E005        CLE004
      *                                                                   CLE004
      ***  If valid event or 'I2' with blank input/output indicator       CLE004
      ***  compare event date and extract date.                           CLE004
      *                                                                   CLE004
     C           *IN07     IFEQ '1'                        ***B005        CLE004
     C           *IN06     OREQ '1'                                       CLE004
      *                                                                   CLE004
      ***  Only process events that are not greater than extract          CLE004
      ***  date or maturity events with an extract date of zero.          CLE004
      *                                                                   CLE004
     C           EDAT      IFLE EXDT1                      ***B006        CLE004
     C           EDAT      ANDNE0                                         CLE004
      *                                                                   CLE004
      ***  Obtain currency details                                        CLE004
      *                                                                   CLE004
      ***  Changes to exposure or availability must be done in            CLE004
      ***  the facility currency so if event currency different           CLE004
      ***  the event amount needs to be converted.                        CLE004
      *                                                                   CLE004
     C                     MOVE ECCY      INCCY                           CLE004
     C                     MOVE FCCY      OUTCCY                          CLE004
     C                     Z-ADDEAMT      WEAMT                           CLE004
      *                                                                   CLE004
     C                     EXSR CONV                                      CLE004
      *                                                                   CLE004
      *** Update facility expsoure                                        CLE004
      *                                                                   CLE004
     C                     EXSR SRFAMU                                                       263840A
      *                                                                                      263840A
     C           NEWCOB    IFEQ 'N'                                                           CLE134
     C           PROC      ANDEQ'Y'                                                          263840A
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           CLE134
     C           WPDCL     ANDEQ'Y'                                                           CLE134
     C           FAMU      ANDEQ'Y'                                                           CLE134
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           263840
     C           WPDCL     ANDEQ'Y'                                                           263840
     C           WTYP      ANDEQ'X'                                                           263840
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           262892
     C           WPDCL     ANDNE'Y'                                                           262892
     C           PROC      ANDEQ'Y'                                                          263840A
     C                     EXSR EXPSR                                     CLE004
     C                     ENDIF                                                              CLE134
      *                                                                   CLE004
      *** Only update facility availability if not an inter-branch        CLE004
      *** participation.                                                  CLE004
      *                                                                   CLE004
     C           *IN05     IFEQ '0'                        ***B007        CLE004
     C           NEWCOB    IFEQ 'N'                                                           CLE134
     C           PROC      ANDEQ'Y'                                                          263840A
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           CLE134
     C           WPDCL     ANDEQ'Y'                                                           CLE134
     C           FAMU      ANDEQ'Y'                                                           CLE134
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           263840
     C           WPDCL     ANDEQ'Y'                                                           263840
     C           WTYP      ANDEQ'X'                                                           263840
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           262892
     C           WPDCL     ANDNE'Y'                                                           262892
     C           PROC      ANDEQ'Y'                                                          263840A
     C                     EXSR AVAIL                                     CLE004
     C                     ENDIF                                                              CLE134
      *                                                                   CLE014
      ** If SAR CLE005 is installed                                       CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           CLE005    IFEQ 'Y'                                       CLE014
     C           TRCA      ANDEQ'TR'                                      CLE014
     C           PRTR      IFNE 'P'                                       CLE014
     C           PRTR      ANDNE'I'                                       CLE014
     C           PRTR      ANDNE'R'                                                           CLE106
     C           PRTR      ANDNE'S'                                                           CLE106
     C                     EXSR SRMOVE                                    CLE014
     C                     WRITELECAUTPF                                  CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     END                             ***E007        CLE004
      *                                                                   CLE004
      *** End for if EDAT LE EXDT1                                        CLE004
      *                                                                   CLE004
     C                     END                             ***E006        CLE004
      *                                                                   CLE004
      *** End for if 06 & 07                                              CLE004
      *                                                                   CLE004
     C                     END                             ***E005        CLE004
      *                                                                   CLE004
      *** End for if multibranching                                       CLE004
      *                                                                   CLE004
     C                     END                             ***E004        CLE004
      *                                                                   CLE004
     C           WLLOAN    READELELVNTL1                 25               CLE004
      *                                                                   CLE004
     C                     ENDDO                           ***E003        CLE004
      *                                                                   CLE004
     C           KEY001    READELELOANL7                 24               CLE004
     C                     ENDDO                           ***E002        CLE004
      *                                                                   CLE004
     C                     ENDIF                           ***E001        CLE004
      *                                                                   CLE004
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/LEOVNT                                                    S01473
      *****************************************************************   S01473
      *                                                               *   S01473
      *  LEOVNT - Sub-routine to process LEO event records.           *   S01473
      *           Reads all LEO event records for the facility;       *   S01473
      *           adjusting available and exposure amounts as         *   S01473
      *           appropriate.                                        *   S01473
      *                                                               *   S01473
      *  Called By: PROCES                                            *   S01473
      *                                                               *   S01473
      *  Calls    : CONV, AVAIL, EXPSR                                *   S01473
      *                                                               *   S01473
      *****************************************************************   S01473
      *                                                                   S01473
     C           LEOVNT    BEGSR                                          S01473
      *                                                                   S01473
      ** Obtain all event details for the facility being processed.       S01473
      *                                                                   S01473
     C           EVLKEY    SETLLEVLEODF                                   S01473
     C           EVLKEY    READEEVLEODF                  20               S01473
      *                                                                   S01473
      ** N.B. LEO events generated with blank IBRE - process all records. S01473
      *                                                                   S01473
     C           *IN20     DOWEQ'0'                                       S01473
      *                                                                   S01473
      ** Initialise capitalised interest repayment event indicator.       S01473
      *                                                                   S01473
     C                     MOVE '0'       *IN06                           S01473
      *                                                                   S01473
      ** Process LEO events (85A1, 85M1, 86A1 and 86M1). Maturity date    S01473
      ** events are only processed if event date is less than or equal to S01473
      ** extract date and not equal to zero.                              S01473
      *                                                                   S01473
     C           ETP       IFEQ 'A1'                                      S01473
     C           ETP       OREQ 'M1'                                      S01473
     C           EDAT      ANDLEEXDT1                                     S01473
     C           EDAT      ANDNE0                                         S01473
      *                                                                   S01473
      ** Changes to exposure or availability must be in facility          S01473
      ** currency. If event currency is different convert event amount    S01473
      ** to facility currency.                                            S01473
      *                                                                   S01473
     C                     MOVE ECCY      INCCY                           S01473
     C                     MOVE FCCY      OUTCCY                          S01473
     C                     Z-ADDEAMT      WEAMT  130                      S01473
      *                                                                   S01473
     C                     EXSR CONV                                      S01473
      *                                                                   S01473
      ** Update facility exposure.                                        S01473
      *                                                                   S01473
     C                     EXSR SRFAMU                                                       263840A
      *                                                                                      263840A
     C           NEWCOB    IFEQ 'N'                                                           CLE134
     C           PROC      ANDEQ'Y'                                                          263840A
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           CLE134
     C           WPDCL     ANDEQ'Y'                                                           CLE134
     C           FAMU      ANDEQ'Y'                                                           CLE134
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           263840
     C           WPDCL     ANDEQ'Y'                                                           263840
     C           WTYP      ANDEQ'X'                                                           263840
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           262892
     C           WPDCL     ANDNE'Y'                                                           262892
     C           PROC      ANDEQ'Y'                                                          263840A
     C                     EXSR EXPSR                                     S01473
     C                     ENDIF                                                              CLE134
      *                                                                   S01473
      ** Update facility availability array.                              S01473
      *                                                                   S01473
     C           NEWCOB    IFEQ 'N'                                                           CLE134
     C           PROC      ANDEQ'Y'                                                          263840A
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           CLE134
     C           WPDCL     ANDEQ'Y'                                                           CLE134
     C           FAMU      ANDEQ'Y'                                                           CLE134
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           263840
     C           WPDCL     ANDEQ'Y'                                                           263840
     C           WTYP      ANDEQ'X'                                                           263840
      *                                                                                       263840
     C           NEWCOB    OREQ 'Y'                                                           262892
     C           WPDCL     ANDNE'Y'                                                           262892
     C           PROC      ANDEQ'Y'                                                          263840A
     C                     EXSR AVAIL                                     S01473
     C                     ENDIF                                                              CLE134
      *                                                                   S01473
      ***  End for processing LEO events.                                 S01473
      *                                                                   S01473
     C                     END                                            S01473
      *                                                                   S01473
     C           EVLKEY    READEEVLEODF                  20               S01473
      *                                                                   S01473
      * End for do while                                                  S01473
     C                     END                                            S01473
      *                                                                   S01473
     C                     ENDSR                                          S01473
      *                                                                   S01473
      *****************************************************************
      /TITLE SR/EXPSR
      *****************************************************************
      *                                                               *
      *  EXPSR  - SUBROUTINE TO UPDATE CURRENT AMOUNT DRAWN AND       *
      *           PREVIOUS EXPOSURE FIELD.  THESE FIELDS ARE          *
      *           OUTPUT WITH THEIR NEW VALUES.                       *
      *                                                               *
      *  Called By: EVENT                                             *
      *                                                               *
      *  Calls:     NOTHING                                           *
      *                                                               *
      *****************************************************************
      *
     C           EXPSR     BEGSR
      *
      *** Process all events except principal increase events
      *** with an event date less than or equal to next work day
      *
     C           ETP       IFEQ 'A1'                       ***B001
     C           EDAT      ORLE DNWD
     C           ETP       ANDNE'V3'
     C           ETP       ANDNE'X2'                                      118870
     C           ETP       ANDNE'H1'                                                          CLE028
     C           CLE004    ANDEQ'N'                                       CLE004
     C           ETP       ANDNE'X3'                                                          CLE139
     C           EDAT      ORLE DNWD                                      CLE004
     C           ETP       ANDNE'V3'                                      CLE004
     C           ETP       ANDNE'X2'                                      118870
     C           ETP       ANDNE'H1'                                                          CLE028
     C           ETP       ANDNE'V5'                                      CLE004
     C           CLE004    ANDEQ'Y'                                       CLE004
     C           ETP       ANDNE'X3'                                                          CLE139
      *
      ** Old Processing for when CLE004 was off:                                              235444
     C           CLE004    IFNE 'Y'                                       CLE004
     C           PTP       IFEQ '66'                       ***B002
     C           PTP       OREQ '67'
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'69'                                      127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'72'                                      127720
      *
     C           RCSI      IFNE 'Y'                        ***B003
      *
      *** Principal repayment or maturity event
      *
     C           ETP       IFEQ 'R1'                       ***B004
     C           ETP       OREQ 'M1'
      *                                                                   171691
      ** At value date, consider the auto settlement indicator            171691
      ** before updating facility exposure                                171691
      *                                                                   171691
     C***********AUTO      IFEQ 'Y'                                 171691204557
     C           EVAUTO    IFEQ 'Y'                                       204557
     C           EVAUTO    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     ADD  WSAMT     CEXP                                                CLE023
     C                     ELSE                                                               CLE023
     C                     ADD  WEAMT     CAMD
     C                     ENDIF                                                              CLE023
     C**********           END                                                         171691 206593
     C/COPY WNCPYSRC,LE0491C008
     C           EDAT      IFNE DNWD                       ***B005
     C           CLE023    ANDEQ'N'                                                           CLE023
     C                     ADD  WEAMT     PEXP
     C                     END                             ***E005
     C                     ENDIF                                                              206593
      *
      *** Not principal repayment or maturity event
      *
     C                     ELSE                            ***X004
      *
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     SUB  WSAMT     CEXP                                                CLE023
     C                     ELSE                                                               CLE023
     C                     SUB  WEAMT     CAMD
     C                     ENDIF                                                              CLE023
     C/COPY WNCPYSRC,LE0491C009
      *
     C           EDAT      IFNE DNWD                       ***B005
     C           CLE023    ANDEQ'N'                                                           CLE023
     C                     SUB  WEAMT     PEXP
     C                     END                             ***E005
      *
     C                     END                             ***E004
      *
      *** RCSI NE 'Y'
     C                     END                             ***E003
      *
      *** PTP 66 or 67
     C                     ELSE                            ***X002
      *
      *** Not 66 or 67
     C           ETP       IFEQ 'R1'                       ***B003
     C           ETP       OREQ 'M1'
      *                                                                   171691
      ** At value date, consider the auto settlement indicator            171691
      ** before updating facility exposure                                171691
      *                                                                   171691
     C***********AUTO      IFEQ 'Y'                                 171691204557
     C           EVAUTO    IFEQ 'Y'                                       204557
     C           EVAUTO    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     SUB  WEAMT     CAMD
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     SUB  WSAMT     CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
     C**********           END                                                         171691 206593
     C/COPY WNCPYSRC,LE0491C010
      *
     C           EDAT      IFNE DNWD                       ***B004
     C                     SUB  WEAMT     PEXP
     C                     END                             ***E004
     C                     ENDIF                                                              206593
      *
     C                     ELSE                            ***X003
      *
      ***  Not R1 or M1 event
      *
     C                     ADD  WEAMT     CAMD
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     ADD  WSAMT     CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
     C/COPY WNCPYSRC,LE0491C011
      *
     C           EDAT      IFNE DNWD                       ***B004
     C                     ADD  WEAMT     PEXP
     C                     END                             ***E004
      *
     C                     END                             ***E003
      *
      ***  Not processing type 66 or 67
      *
     C                     END                             ***E002
     C                     END                                            CLE004
      *                                                                   CLE004
      ** Processing for when CLE004 is on:                                                    235444
     C           CLE004    IFEQ 'Y'                                       CLE004
     C           PTP       IFEQ '64'                                      CLE004
     C           *IN23     ANDEQ'0'                                       CLE004
     C           LPFI      ANDNE*BLANK                                    CLE004
     C           PTP       OREQ '65'                                      CLE004
     C           *IN23     ANDEQ'0'                                       CLE004
     C           LPFI      ANDNE*BLANK                                    CLE004
     C           PTP       OREQ '66'                                      CLE004
     C           *IN23     ANDEQ'0'                                       CLE004
     C           LPFI      ANDNE*BLANK                                    CLE004
     C           PTP       OREQ '67'                                      CLE004
     C           *IN23     ANDEQ'0'                                       CLE004
     C           LPFI      ANDNE*BLANK                                    CLE004
     C           PTP       OREQ '66'                                      CLE004
     C           LPFI      ANDEQ*BLANK                                    CLE004
     C           PTP       OREQ '67'                                      CLE004
     C           LPFI      ANDEQ*BLANK                                    CLE004
      *                                                                   127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'68'                                      127720
     C           *IN23     ANDEQ'0'                                       127720
     C           LPFI      ANDNE*BLANK                                    127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'71'                                      127720
     C           *IN23     ANDEQ'0'                                       127720
     C           LPFI      ANDNE*BLANK                                    127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'69'                                      127720
     C           *IN23     ANDEQ'0'                                       127720
     C           LPFI      ANDNE*BLANK                                    127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'72'                                      127720
     C           *IN23     ANDEQ'0'                                       127720
     C           LPFI      ANDNE*BLANK                                    127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'69'                                      127720
     C           LPFI      ANDEQ*BLANK                                    127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'72'                                      127720
     C           LPFI      ANDEQ*BLANK                                    127720
      *                                                                   CLE004
      ** Loan is a Part Sold, or an internal Parts Purchased linked                           CLE023
      ** to a Participant Facility, with *IN23 off (the facility being                        CLE023
      ** processed is the Primary one, rather than the Participant)                           CLE023
      ** so these Participations DO NOT AFFECT the Drawn Amount.                              CLE023
      ** Internal Parts Purchased should not affect the CEXP either.                          235444
     C           LPFI      IFNE 'I'                                                           235444
      *
     C           RCSI      IFNE 'Y'                                       CLE004
      *                                                                   CLE004
      *** Principal repayment or maturity event                           CLE004
      *                                                                   CLE004
     C           ETP       IFEQ 'R1'                                      CLE004
     C           ETP       OREQ 'M1'                                      CLE004
     C           ETP       OREQ 'R7'                                      CLE004
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           EVAUTO    IFEQ 'Y'                                                           204450
     C           EVAUTO    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     ADD  WSAMT     CEXP                                                CLE023
     C                     ENDIF                                                              204450
     C                     ELSE                                                               CLE023
     C           EVAUTO    IFEQ 'Y'                                                           204450
     C           EVAUTO    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     ADD  WEAMT     CAMD                            CLE004
     C                     ENDIF                                                              204450
     C                     ENDIF                                                              CLE023
     C/COPY WNCPYSRC,LE0491C012
     C           EDAT      IFNE DNWD                                      CLE004
     C           CLE023    ANDEQ'N'                                                           CLE023
     C           EVAUTO    ANDEQ'Y'                                                           206593
     C           EDAT      ORNE DNWD                                                          CLE134
     C           CLE023    ANDEQ'N'                                                           CLE134
     C           EVAUTO    ANDEQ'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     ADD  WEAMT     PEXP                            CLE004
     C                     END                                            CLE004
      *                                                                   CLE004
      *** Not principal repayment or maturity event                       CLE004
      *                                                                   CLE004
     C                     ELSE                                           CLE004
      *                                                                   CLE004
      ** Current amount drawn should not be updated by Parts Sold                             CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     SUB  WSAMT     CEXP                                                CLE023
     C                     ELSE                                                               CLE023
     C                     SUB  WEAMT     CAMD                            CLE004
     C                     ENDIF                                                              CLE023
     C/COPY WNCPYSRC,LE0491C013
      *                                                                   CLE004
     C           EDAT      IFNE DNWD                                      CLE004
     C           CLE023    ANDEQ'N'                                                           CLE023
     C                     SUB  WEAMT     PEXP                            CLE004
     C                     END                                            CLE004
      *                                                                   CLE004
     C                     END                                            CLE004
      *                                                                   CLE004
      *** RCSI NE 'Y'                                                     CLE004
     C                     END                                            CLE004
     C                     ENDIF                                                              235444
      *                                                                   CLE004
     C                     ELSE                                           CLE004
      *                                                                                       CLE023
      ** Else, loan does not fit into any of the criteria listed earlier:                     CLE023
      ** Either it's not a Part Sold, or it's a Part Sold with a non-blank                    CLE023
      ** LPFI and *IN23 is on (Participant Facility is being processed).                      CLE023
      *                                                                   CLE004
     C           ETP       IFEQ 'R1'                                      CLE004
     C           ETP       OREQ 'M1'                                      CLE004
     C           ETP       OREQ 'R7'                                      CLE004
     C           EVAUTO    IFEQ 'Y'                                                           204450
     C           EVAUTO    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     SUB  WEAMT     CAMD                            CLE004
     C                     ENDIF                                                              204450
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           EVAUTO    IFEQ 'Y'                                                           204450
     C           EVAUTO    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     SUB  WSAMT     CEXP                                                CLE023
     C                     ENDIF                                                              204450
     C                     ENDIF                                                              CLE023
     C/COPY WNCPYSRC,LE0491C014
      *                                                                   CLE004
     C           EDAT      IFNE DNWD                                      CLE004
     C           EVAUTO    ANDEQ'Y'                                                           206593
     C           EDAT      ORNE DNWD                                                          CLE134
     C           EVAUTO    ANDEQ'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C                     SUB  WEAMT     PEXP                            CLE004
     C                     END                                            CLE004
      *                                                                   CLE004
     C                     ELSE                                           CLE004
      *                                                                   CLE004
      ***  Not R1 or M1 event                                             CLE004
      *                                                                   CLE004
     C                     ADD  WEAMT     CAMD                            CLE004
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     ADD  WSAMT     CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
     C/COPY WNCPYSRC,LE0491C015
      *                                                                   CLE004
     C           EDAT      IFNE DNWD                                      CLE004
     C                     ADD  WEAMT     PEXP                            CLE004
     C                     END                                            CLE004
      *                                                                   CLE004
     C                     END                                            CLE004
      *                                                                   CLE004
     C                     END                                            CLE004
     C                     END                                            CLE004
      *
     C                     END                             ***E001
      *
      ***  V3 events
      *
     C           EDAT      IFLE DNWD                       ***B001
     C           ETP       ANDEQ'V3'
     C           ETP       OREQ 'X2'                                      118870
     C           EDAT      ANDLEDNWD                                                          239983
     C           ETP       OREQ 'H1'                                                          CLE028
     C           EDAT      ANDLEDNWD                                      118870
     C           EDAT      ORLE DNWD                                      CLE004
     C           ETP       ANDEQ'V5'                                      CLE004
     C           CLE004    ANDEQ'Y'                                       CLE004
     C           EDAT      ORLE DNWD                                                          CLE139
     C           ETP       ANDEQ'X3'                                                          CLE139
      *                                                                                       235444
      * If this Principal Increase is against a Participation Sold                            235444
      * or an Internal Participation Purchased:                                               235444
     C           PTP       IFEQ '64'                                                          235444
     C           LPFI      ANDNE*BLANK                                                        235444
      *                                                                                       235444
     C           PTP       OREQ '65'                                                          235444
     C           LPFI      ANDNE*BLANK                                                        235444
      *                                                                                       235444
     C           PTP       OREQ '66'                                                          235444
     C           LPFI      ANDNE*BLANK                                                        235444
      *                                                                                       235444
     C           PTP       OREQ '67'                                                          235444
     C           LPFI      ANDNE*BLANK                                                        235444
      *                                                                                       235444
     C           CLE005    OREQ 'Y'                                                           235444
     C           PTP       ANDEQ'68'                                                          235444
     C           LPFI      ANDNE*BLANK                                                        235444
      *                                                                                       235444
     C           CLE005    OREQ 'Y'                                                           235444
     C           PTP       ANDEQ'69'                                                          235444
     C           LPFI      ANDNE*BLANK                                                        235444
      *                                                                                       235444
     C           CLE005    OREQ 'Y'                                                           235444
     C           PTP       ANDEQ'71'                                                          235444
     C           LPFI      ANDNE*BLANK                                                        235444
      *                                                                                       235444
     C           CLE005    OREQ 'Y'                                                           235444
     C           PTP       ANDEQ'72'                                                          235444
     C           LPFI      ANDNE*BLANK                                                        235444
      *                                                                                       235444
     C           PTP       OREQ '66'                                                          235444
     C           LPFI      ANDEQ*BLANK                                                        235444
      *                                                                                       235444
     C           PTP       OREQ '67'                                                          235444
     C           LPFI      ANDEQ*BLANK                                                        235444
      *                                                                                       235444
     C           CLE005    OREQ 'Y'                                                           235444
     C           PTP       ANDEQ'69'                                                          235444
     C           LPFI      ANDEQ*BLANK                                                        235444
      *                                                                                       235444
     C           CLE005    OREQ 'Y'                                                           235444
     C           PTP       ANDEQ'72'                                                          235444
     C           LPFI      ANDEQ*BLANK                                                        235444
      *                                                                                       235444
      * Either a Non-Syndicated Part Sold, or a Funding Participant's                         235444
      * Part Sold without recourse and the Primary Facility is                                235444
      * being processed, so the Current Exposure should be reduced,                           235444
      * but the Current Drawn amount should not be affected.                                  235444
      * Internal Participations should not update the Primary Facility                        235444
     C           *IN23     IFEQ '0'                                                           235444
     C           LPFI      ANDEQ*BLANKS                                                       235444
     C           RCSI      ANDNE'Y'                                                           235444
     C           *IN23     OREQ '0'                                                           235444
     C           LPFI      ANDNE'I'                                                           235444
     C           RCSI      ANDNE'Y'                                                           235444
     C                     SUB  WSAMT     CEXP                                                235444
     C                     ENDIF                                                              235444
      *                                                                                       235444
      * Syndicated Funding Participant's Parts Sold (with or without                          235444
      * recourse) or IPP, and this is the Funding Participant Facility                        235444
      * being processed, so the current exposure should be increased                          235444
      * and so should the Current Drawn amount.                                               235444
     C           *IN23     IFEQ '1'                                                           235444
     C           LPFI      ANDNE*BLANKS                                                       235444
      * Risk Part Sold, or an IPP or a Part Sold to a funding Participant                     235444
      * and this is the update of the Participant Facility                                    235444
     C                     ADD  WEAMT     CAMD
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     ADD  WSAMT     CEXP                                                CLE023
     C                     ENDIF                                                              CLE023
     C/COPY WNCPYSRC,LE0491C016
      *
     C           EDAT      IFNE DNWD                       ***B002
     C                     ADD  WEAMT     PEXP
     C                     END                             ***E002
     C                     ENDIF                                                              235444
      *                                                                                       235444
      *                                                                                       235444
     C                     ELSE                                                               235444
      * Else, not a Part Sold etc - e.g. just a Term loan or Part Purch                       235444
      * being processed, so the current exposure should be increased                          235444
      * and so should the Current Drawn amount.                                               235444
     C           CLE023    IFEQ 'Y'                                                           235444
     C                     ADD  WSAMT     CEXP                                                235444
     C                     ENDIF                                                              235444
      *                                                                                       235444
     C                     ADD  WEAMT     CAMD                                                235444
     C           EDAT      IFNE DNWD                                                          235444
     C                     ADD  WEAMT     PEXP                                                235444
     C                     END                                                                235444
      *                                                                                       235444
     C                     ENDIF                                                              235444
      *
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/AVAIL
      *****************************************************************
      *                                                               *
      *  AVAIL  - SUBROUTINE TO UPDATE AVAILABILITY ARRAY             *
      *                                                               *
      *  Called By: EVENT                                             *
      *                                                               *
      *  Calls    : NOTHING                                           *
      *                                                               *
      *****************************************************************
      *
     C           AVAIL     BEGSR
      *
     C                     Z-ADDWEAMT     WRK13  130
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADD1         I                                                   CLE023
     C           RLDT      LOKUPRUNS,I               10  10                                   CLE023
     C                     ENDIF                                                              CLE023
      *
      ***  Update of facility availability array for dummy events
      *
     C           ETP       IFEQ 'A1'                       ***B001
      *
      ***  Participation Sold
      *
     C                     MOVE 'N'       WEXNXT                          127720
     C           PTP       IFNE '66'                       ***B002
     C           PTP       ANDNE'67'
     C                     MOVE 'Y'       WEXNXT  1                       127720
     C                     ENDIF                                          127720
     C           CLE005    IFEQ 'Y'                                       127720
     C           PTP       IFEQ '69'                                      127720
     C           PTP       OREQ '72'                                      127720
     C                     MOVE 'N'       WEXNXT                          127720
     C                     ENDIF                                          127720
     C                     ENDIF                                          127720
      *
     C           WEXNXT    IFEQ 'Y'                                       127720
     C                     Z-ADD1         Y       20
     C           Y         DOWLT11                         ***B003
     C           LPFI      IFEQ *BLANK                                    154557
     C           OAM,Y     ADD  WRK13     OAM,Y
     C                     ENDIF                                          154557
     C                     ADD  1         Y
     C                     END                             ***E003
      *                                                                                       CLE023
      ** Update availability array base from new rate if future dated                         CLE023
      ** rollover on FCXR exists within the OAM period.                                       CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           WNAMT     ANDNE*ZERO                                                         CLE023
     C           *IN10     ANDEQ'1'                                                           CLE023
     C           LPFI      ANDEQ*BLANK                                                        CLE023
     C                     ADD  1         I                                                   CLE023
     C           I         DOWLT11                                                            CLE023
     C           OAM,I     SUB  WRK13     OAM,I                                               CLE023
     C           OAM,I     ADD  WNAMT     OAM,I                                               CLE023
     C                     ADD  1         I                                                   CLE023
     C                     ENDDO                                                              CLE023
     C                     ENDIF                                                              CLE023
      *
     C                     END                             ***E002
      *
      ***  Participations sold without recourse should only be
      ***  processed if they have a revolving credit facility.
      *
     C           PTP       IFEQ '66'                       ***B002
     C           RCSI      ANDNE'Y'
     C           FCTI      ANDNE'C'
     C***********RVCR      ANDEQ'Y'                                       144712
     C           @RVCR     ANDEQ'Y'                                       144712
     C           CLE023    ANDEQ'N'                                                           CLE023
      *
     C           PTP       OREQ '67'
     C           RCSI      ANDNE'Y'
     C           FCTI      ANDNE'C'
     C***********RVCR      ANDEQ'Y'                                       144712
     C           @RVCR     ANDEQ'Y'                                       144712
     C           CLE023    ANDEQ'N'                                                           CLE023
      *                                                                   127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'69'                                      127720
     C           RCSI      ANDNE'Y'                                       127720
     C           FCTI      ANDNE'C'                                       127720
     C***********RVCR      ANDEQ'Y'                                127720 144712
     C           @RVCR     ANDEQ'Y'                                       144712
     C           CLE023    ANDEQ'N'                                                           CLE023
      *                                                                   127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'72'                                      127720
     C           RCSI      ANDNE'Y'                                       127720
     C           FCTI      ANDNE'C'                                       127720
     C***********RVCR      ANDEQ'Y'                                127720 144712
     C           @RVCR     ANDEQ'Y'                                       144712
     C           CLE023    ANDEQ'N'                                                           CLE023
      *                                                                                       CLE023
      ** Parts Sold without recourse affects the availability of its                          CLE023
      ** Participant Facility just like a normal loan.                                        CLE023
      *
     C           PTP       OREQ '66'                                      128980
     C           LPFI      ANDNE*BLANK                                    128980
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   128980
     C           PTP       OREQ '67'                                      128980
     C           LPFI      ANDNE*BLANK                                    128980
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   128980
     C           PTP       OREQ '69'                                      128980
     C           CLE005    ANDEQ'Y'                                       128980
     C           LPFI      ANDNE*BLANK                                    128980
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   128980
     C           PTP       OREQ '72'                                      128980
     C           CLE005    ANDEQ'Y'                                       128980
     C           LPFI      ANDNE*BLANK                                    128980
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   128980
     C           PTP       OREQ '64'                                      149917
     C           LPFI      ANDEQ'I'                                       149917
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   149917
     C           PTP       OREQ '65'                                      149917
     C           LPFI      ANDEQ'I'                                       149917
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   149917
     C           PTP       OREQ '68'                                      149917
     C           LPFI      ANDEQ'I'                                       149917
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   149917
     C           PTP       OREQ '71'                                      149917
     C           LPFI      ANDEQ'I'                                       149917
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   149917
     C                     Z-ADD1         Y       20
      *
     C           Y         DOWLT11                         ***B003
     C           CLE004    IFEQ 'Y'                                       CLE004
     C           LPFI      ANDNE*BLANK                                    CLE004
     C           *IN23     ANDEQ'1'                                       CLE004
     C           OAM,Y     ADD  WRK13     OAM,Y                           CLE004
     C                     ELSE                                           CLE004
     C           CLE023    IFEQ 'N'                                                           CLE023
     C           *IN23     IFEQ '0'                                                           203070
     C           LPFI      ANDEQ*BLANK                                                        203070
     C           OAM,Y     SUB  WRK13     OAM,Y
     C                     ENDIF                                                              203070
     C                     ENDIF                                                              CLE023
     C                     END                                            CLE004
     C                     ADD  1         Y
     C                     END                             ***E003
      *                                                                                       CLE023
      ** Update availability array base from new rate if future dated                         CLE023
      ** rollover on FCXR exists within the OAM period.                                       CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           WNAMT     ANDNE*ZERO                                                         CLE023
     C           *IN10     ANDEQ'1'                                                           CLE023
     C                     ADD  1         I                                                   CLE023
     C           I         DOWLT11                                                            CLE023
     C           CLE004    IFEQ 'Y'                                                           CLE023
     C           LPFI      ANDNE*BLANK                                                        CLE023
     C           *IN23     ANDEQ'1'                                                           CLE023
     C           OAM,I     SUB  WRK13     OAM,I                                               CLE023
     C           OAM,I     ADD  WNAMT     OAM,I                                               CLE023
     C                     ENDIF                                                              CLE023
     C                     ADD  1         I                                                   CLE023
     C                     ENDDO                                                              CLE023
     C                     ENDIF                                                              CLE023
      *
     C                     END                             ***E002
      *
      ***  If ETP eq A1
     C                     END                             ***E001
      *
      ***  If not dummy event check if event date is within
      ***  facility availability dates (RUNS); if so update
      ***  availability array using event amount.
      *
     C                     MOVE '0'       *IN09
     C           ETP       IFNE 'A1'                       ***B001
     C                     Z-ADD1         W       20
     C***********EDAT      LOKUPRUNS,W                   09               045634
     C           EDAT      LOKUPRUNS,W               09  09               045634
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADD1         I                                                   CLE023
     C           RLDT      LOKUPRUNS,I               10  10                                   CLE023
     C                     ENDIF                                                              CLE023
     C                     END                             ***E001
      *
     C           *IN09     IFEQ '1'                        ***B001
      *
     C                     Z-ADDWEAMT     WRK13
      *
     C           PTP       IFEQ '61'                       ***B002
     C           PTP       OREQ '62'
     C           PTP       OREQ '63'
     C           PTP       OREQ '64'
     C           LPFI      ANDEQ*BLANKS                                                       235444
     C           *IN23     ANDEQ'0'                                                           235444
     C           PTP       OREQ '65'
     C           LPFI      ANDEQ*BLANKS                                                       235444
     C           *IN23     ANDEQ'0'                                                           235444
     C           PTP       OREQ '70'
     C           PTP       OREQ '85'                                      S01473
     C           *IN21     ANDEQ'1'                                       S01473
     C           PTP       OREQ '86'                                      S01473
     C           *IN21     ANDEQ'1'                                       S01473
      *                                                                   127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'68'                                      127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'71'                                      127720
      *                                                                   154557
     C           PTP       OREQ '66'                                      154557
     C           LPFI      ANDNE*BLANK                                    154557
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   154557
     C           PTP       OREQ '67'                                      154557
     C           LPFI      ANDNE*BLANK                                    154557
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   154557
     C           PTP       OREQ '69'                                      154557
     C           CLE005    ANDEQ'Y'                                       154557
     C           LPFI      ANDNE*BLANK                                    154557
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   154557
     C           PTP       OREQ '72'                                      154557
     C           CLE005    ANDEQ'Y'                                       154557
     C           LPFI      ANDNE*BLANK                                    154557
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   154557
     C           PTP       OREQ '64'                                      154557
     C           LPFI      ANDEQ'I'                                       154557
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   154557
     C           PTP       OREQ '65'                                      154557
     C           LPFI      ANDEQ'I'                                       154557
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   154557
     C           PTP       OREQ '68'                                      154557
     C           LPFI      ANDEQ'I'                                       154557
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                   154557
     C           PTP       OREQ '71'                                      154557
     C           LPFI      ANDEQ'I'                                       154557
     C           *IN23     ANDEQ'1'                                                           235444
      *                                                                                       CLE028
     C           CLE028    OREQ 'Y'                                                           CLE028
     C           PTP       ANDEQ'80'                                                          CLE028
      *
      ***  Availability reduced for the following events
      *
     C           ETP       IFEQ 'V1'                       ***B003
     C           ETP       OREQ 'V3'
     C           ETP       OREQ 'X2'                                      118870
     C           ETP       OREQ 'H1'                                                          CLE028
     C           ETP       OREQ 'V5'                                      CLE004
     C           CLE004    ANDEQ'Y'                                       CLE004
     C************IN05     OREQ '1'                                       0066
     C           *IN06     OREQ '1'                                       0066
     C           ETP       OREQ 'X3'                                                          CLE139
      *
     C           W         DOWLT11                         ***B004
     C                     ADD  WEAMT     OAM,W
     C                     ADD  1         W
     C                     END                             ***E004
      *                                                                                       CLE023
      ** Update OAM array for the event using the new rate if future                          CLE023
      ** dated rollover on facility exchange rate exists for the loan                         CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           WNAMT     ANDNE*ZERO                                                         CLE023
     C           *IN10     ANDEQ'1'                                                           CLE023
     C           EDAT      ANDGTRLDT                                                          CLE023
     C                     ADD  1         I                                                   CLE023
     C           I         DOWLT11                                                            CLE023
     C                     SUB  WEAMT     OAM,I                                               CLE023
     C                     ADD  WNAMT     OAM,I                                               CLE023
     C                     ADD  1         I                                                   CLE023
     C                     ENDDO                                                              CLE023
     C                     ENDIF                                                              CLE023
      *
     C                     END                             ***E003
      *
      ***  Availability increased for the following events
      *
     C           ETP       IFEQ 'R1'                       ***B003
     C***********RVCR      ANDEQ'Y'                                       144712
     C           @RVCR     ANDEQ'Y'                                       144712
     C           ETP       OREQ 'M1'
     C***********RVCR      ANDEQ'Y'                                       144712
     C           @RVCR     ANDEQ'Y'                                       144712
     C           ETP       OREQ 'R7'                                      CLE004
     C***********RVCR      ANDEQ'Y'                                CLE004 144712
     C***********@RVCR     ANDEQ'Y'                                144712 157645
     C           CLE004    ANDEQ'Y'                                       CLE004
      *
      ** Decrease drawn array OAM for negotiation repayments against      S01473
      ** non-revolving facilities to ensure correct facility              S01473
      ** availability (facility amount decreased for these repayments).   S01473
      *                                                                   S01473
     C           ETYP      OREQ '86M1'                                    S01473
     C           *IN21     ANDEQ'1'                                       S01473
     C***********RVCR      ANDEQ'N'                                S01473 144712
     C           @RVCR     ANDEQ'N'                                       144712
     C           EDAT      ANDLERUND                                      S01473
      *                                                                   171691
      ***At*value*date,*consider*the*auto*settlement*indicator********                 171691 204671
      ** Always consider/check the autosettle indicator of the event                          204671
      ** before updating facility availability                            171691
      *                                                                   171691
     C********** EDAT      IFLE DNWD                                      171691              204671
     C********** AUTO      ANDEQ'Y'                                       171691              204557
     C********** EDAT      ORGT DNWD                                      171691              204671
     C           EVAUTO    IFEQ 'Y'                                                           204671
     C           EVAUTO    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
      *
     C           W         DOWLT11                         ***B004
     C                     SUB  WEAMT     OAM,W
     C                     ADD  1         W
     C                     END                                            171691
      *                                                                                       CLE023
      ** Update OAM array for the event using the new rate if future                          CLE023
      ** dated rollover on facility exchange rate exists for the loan                         CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           WNAMT     ANDNE*ZERO                                                         CLE023
     C           *IN10     ANDEQ'1'                                                           CLE023
     C                     ADD  1         I                                                   CLE023
     C           I         DOWLT11                                                            CLE023
     C                     ADD  WEAMT     OAM,I                                               CLE023
     C                     SUB  WNAMT     OAM,I                                               CLE023
     C                     ADD  1         I                                                   CLE023
     C                     ENDDO                                                              CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       204708
     C                     ELSE                            Non-auto event                     204708
      * Else, Non-autosettle event - shouldn't affect availability.                           204708
      *                                                                                       204708
      *  However, if Auto-settled loan is due to mature soon, increase                        204708
      *  availability from maturity date onwards, by any non-autosettle                       204708
      *  repayments, as these will be automatically repaid at maturity.                       204708
      *  but amount on maturity event was already reduced by them.                            204708
     C           AUTOL     IFEQ 'Y'                        Autosettle Loan                    204708
     C           ETP       ANDEQ'R1'                                                          CLE134
     C           AUTOL     OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C           ETP       ANDEQ'R1'                       Repayment                          204708
     C                     Z-ADD1         K       20                                          204708
     C                     MOVE *OFF      *IN09                                               204708
     C           MDATL     LOKUPRUNS,K                   09                                   204708
     C           *IN09     IFEQ *ON                        Maturity soon                      204708
     C           K         DOWLT11                                                            204708
     C                     SUB  WEAMT     OAM,K                                               204708
     C                     ADD  1         K                                                   204708
     C                     ENDDO                                                              204708
      *                                                                                       204708
      ** Update OAM array for non-autosettled event against autosettle                        204708
      ** loan if a future dated rollover on facility exchange rate and                        204708
      ** loan is due to mature soon...                                                        204708
      *                                                                                       204708
     C           CLE023    IFEQ 'Y'                                                           204708
     C           WNAMT     ANDNE*ZERO                                                         204708
     C           *IN10     ANDEQ'1'                                                           204708
     C                     ADD  1         I                                                   204708
     C           I         DOWLT11                                                            204708
     C                     ADD  WEAMT     OAM,I                                               204708
     C                     SUB  WNAMT     OAM,I                                               204708
     C                     ADD  1         I                                                   204708
     C                     ENDDO                                                              204708
     C                     ENDIF                                                              204708
     C                     ENDIF                                                              204708
     C                     ENDIF                                                              204708
      *                                                                                       204708
     C                     END                             ***E004
      *
     C                     END                             ***E003
      *
     C                     END                             ***E002
      *
      ***  Participations sold without recourse should only be
      ***  processed if they have a revolving credit facility.
      *
     C           PTP       IFEQ '66'                       ***B002
     C           RCSI      ANDNE'Y'
     C           FCTI      ANDNE'C'
     C***********RVCR      ANDEQ'Y'                                       144712
     C           @RVCR     ANDEQ'Y'                                       144712
     C           CLE023    ANDEQ'N'                                                           CLE023
      *
     C           PTP       OREQ '67'
     C           RCSI      ANDNE'Y'
     C           FCTI      ANDNE'C'
     C***********RVCR      ANDEQ'Y'                                       144712
     C           @RVCR     ANDEQ'Y'                                       144712
     C           CLE023    ANDEQ'N'                                                           CLE023
      *                                                                   127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'69'                       ***B002        127720
     C           RCSI      ANDNE'Y'                                       127720
     C           FCTI      ANDNE'C'                                       127720
     C***********RVCR      ANDEQ'Y'                                127720 144712
     C           @RVCR     ANDEQ'Y'                                       144712
     C           CLE023    ANDEQ'N'                                                           CLE023
      *                                                                   127720
     C           CLE005    OREQ 'Y'                                       127720
     C           PTP       ANDEQ'72'                       ***B002        127720
     C           RCSI      ANDNE'Y'                                       127720
     C           FCTI      ANDNE'C'                                       127720
     C***********RVCR      ANDEQ'Y'                                127720 144712
     C           @RVCR     ANDEQ'Y'                                       144712
     C           CLE023    ANDEQ'N'                                                           CLE023
      *
      ***  Availability reduced for the following events
      *
     C           ETP       IFEQ 'V1'                       ***B003
     C           ETP       OREQ 'V3'
     C           ETP       OREQ 'X2'                                      118870
     C           ETP       OREQ 'H1'                                                          CLE028
     C           ETP       OREQ 'V5'                                      CLE004
     C           CLE004    ANDEQ'Y'                                       CLE004
     C************IN05     OREQ '1'                                       0066
     C           *IN06     OREQ '1'                                       0066
     C           ETP       OREQ 'X3'                                                          CLE139
      *
     C           W         DOWLT11                         ***B004
     C           CLE004    IFEQ 'Y'                                       CLE004
     C           LPFI      ANDNE*BLANK                                    CLE004
     C           *IN23     ANDEQ'1'                                       CLE004
     C                     ADD  WEAMT     OAM,W                           CLE004
     C                     ELSE                                           CLE004
     C           LPFI      IFEQ *BLANK                                                        204531
     C                     SUB  WEAMT     OAM,W
     C                     END                                                                204531
     C                     END                                            CLE004
     C                     ADD  1         W
     C                     END                             ***E004
      *
     C                     END                             ***E003
      *
      ***  Availability increased for the following events
      *
     C           ETP       IFEQ 'R1'                       ***B003
     C           ETP       OREQ 'M1'
     C           ETP       OREQ 'R7'                                      CLE004
     C           CLE004    ANDEQ'Y'                                       CLE004
      *                                                                   171691
      ***At*value*date,*consider*the*auto*settlement*indicator*********                171691 204671
      ** Always consider/check the autosettle indicator of the event                          204671
      ** before updating facility availability                            171691
      *                                                                   171691
     C********** EDAT      IFLE DNWD                                                   171691 204671
     C***********AUTO      ANDEQ'Y'                                                    171691 204671
     C********** EDAT      ORGT DNWD                                                   171691 204671
     C           EVAUTO    IFEQ 'Y'                                                           204671
     C           EVAUTO    OREQ 'C'                                                           CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
      *
     C           W         DOWLT11                         ***B004
     C           CLE004    IFEQ 'Y'                                       CLE004
     C           LPFI      ANDNE*BLANK                                    CLE004
     C           *IN23     ANDEQ'1'                                       CLE004
     C                     SUB  WEAMT     OAM,W                           CLE004
     C                     ELSE                                           CLE004
     C           LPFI      IFEQ *BLANK                                                        204531
     C                     ADD  WEAMT     OAM,W
     C                     END                                                                204531
     C                     END                                            CLE004
     C                     ADD  1         W
     C                     END                             ***E004
     C                     END                                            171691
      *
     C                     END                             ***E003
      *
     C                     END                             ***E002
      *
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/CONV
      *****************************************************************
      *                                                               *
      *  CONV   - SUBROUTINE TO CONVERT EVENT AMOUNTS INTO            *
      *           FACILITY CURRENCY                                   *
      *                                                               *
      *  Called By: EVENT, ACCRUE                                     *
      *                                                               *
      *  Calls:     ZXRATE, ZCONV                                     *
      *                                                               *
      *****************************************************************
      *
     C           CONV      BEGSR
      *
      ***  If currencies are the same retrieve relevant currency
      ***  details, but if currencies are different it is necessary
      ***  to first obtain the cross exchange rate between the two
      ***  currencies and use this to convert to appropriate
      ***  currency.
      *
     C           INCCY     IFEQ OUTCCY                     ***B001
     C**********           Z-ADD1         X                                                  BUG3382
     C********** INCCY     LOKUPCURR,X                   14                                  BUG3382
     C********** *IN14     IFEQ '1'                        ***B002                           BUG3382
     C***********          MOVE MTDV,X    ZMDI1   1                       091158
     C***********          Z-ADDCSPT,X    ZRATE1 138                      091158
     C**********           MOVE MTDV,X    ZMDI1   1                                   144712 BUG3382
     C**********           Z-ADDCSPT,X    ZRATE1 138                                  144712 BUG3382
     C*                                                                   S01408
     C/COPY WNCPYSRC,LE0491CCP1                                           S01408
     C*                                                                   S01408
     C**********           Z-ADDCCDP,X    ZNBDP1  10                                         BUG3382
     C**********           ELSE                            ***X002                           BUG3382
     C                     MOVE INCCY     PCURR                                              BUG3382
     C                     EXSR SRCURR                                                       BUG3382
     C           PRTCD     IFNE *BLANKS                                                      BUG3382
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0491  'DBPGM
     C                     MOVE 'SDCURRPD'DBFILE           ************
     C                     Z-ADD20        DBASE            * DBERR 20 *
     C                     MOVE INCCY     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             ***E002
     C                     MOVE A6MDIN    ZMDI1   1                                          BUG3382
     C                     Z-ADDA6SPRT    ZRATE1 138                                         BUG3382
     C                     Z-ADDA6NBDP    ZNBDP1  10                                         BUG3382
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADD*ZEROS    WNAMT                                               CLE023
     C                     MOVE '0'       *IN10                                               CLE023
     C                     Z-ADDWEAMT     WSAMT  130                                          CLE023
     C                     ENDIF                                                              CLE023
     C                     END                             ***E001
      *
     C           INCCY     IFNE OUTCCY                     ***B001
     C**********           Z-ADD1         X                                                  BUG3382
     C********** INCCY     LOKUPCURR,X                   13                                  BUG3382
     C********** *IN13     IFEQ '1'                        ***B002                           BUG3382
     C***********          MOVE MTDV,X    ZMDI1   1                       091158
     C***********          Z-ADDCSPT,X    ZRATE1 138                      091158
     C**********           MOVE MTDV,X    ZMDI1   1                                   144712 BUG3382
     C**********           Z-ADDCSPT,X    ZRATE1 138                                  144712 BUG3382
     C*                                                                   S01408
     C/COPY WNCPYSRC,LE0491CCP2                                           S01408
     C*                                                                   S01408
     C**********           Z-ADDCCDP,X    ZNBDP1  10                                         BUG3382
     C**********           ELSE                            ***X002                           BUG3382
     C                     MOVE INCCY     PCURR                                              BUG3382
     C                     EXSR SRCURR                                                       BUG3382
     C           PRTCD     IFNE *BLANKS                                                      BUG3382
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0491  'DBPGM
     C                     MOVE 'SDCURRPD'DBFILE           ************
     C                     Z-ADD21        DBASE            * DBERR 21 *
     C                     MOVE INCCY     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             ***E002
     C                     MOVE A6MDIN    ZMDI1                                              BUG3382
     C                     Z-ADDA6SPRT    ZRATE1                                             BUG3382
     C                     Z-ADDA6NBDP    ZNBDP1                                             BUG3382
      *
     C**********           Z-ADD1         X                                                  BUG3382
     C********** OUTCCY    LOKUPCURR,X                   14                                  BUG3382
     C********** *IN14     IFEQ '1'                        ***B002                           BUG3382
     C***********          MOVE MTDV,X    ZMDI2   1                       091158
     C***********          Z-ADDCSPT,X    ZRATE2 138                      091158
     C**********           MOVE MTDV,X    ZMDI2   1                                   144712 BUG3382
     C**********           Z-ADDCSPT,X    ZRATE2 138                                  144712 BUG3382
     C*                                                                   S01408
     C/COPY WNCPYSRC,LE0491CCP3                                           S01408
     C*                                                                   S01408
     C**********           Z-ADDCCDP,X    ZNBDP2  10                                         BUG3382
     C**********           ELSE                            ***X002                           BUG3382
     C                     MOVE OUTCCY    PCURR                                              BUG3382
     C                     EXSR SRCURR                                                       BUG3382
     C           PRTCD     IFNE *BLANKS                                                      BUG3382
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0491  'DBPGM
     C                     MOVE 'SDCURRPD'DBFILE           ************
     C                     Z-ADD22        DBASE            * DBERR 22 *
     C                     MOVE OUTCCY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             ***E002
     C                     MOVE A6MDIN    ZMDI2   1                                          BUG3382
     C                     Z-ADDA6SPRT    ZRATE2 138                                         BUG3382
     C                     Z-ADDA6NBDP    ZNBDP2  10                                         BUG3382
      ***********                                                         091158
      ***  Obtain cross exchange rate & cross multiply/divide indicator   091158
      *********                                                           091158
     C*********            EXSR ZXRATE                                    091158
      *                                                                   144712
      ***  Obtain cross exchange rate & cross multiply/divide indicator   144712
      *                                                                   144712
     C                     EXSR ZXRATE                                    144712
      *                                                                                       CLE023
      ** If CLE023 is installed, convert event amount based on spot                           CLE023
      ** rates.                                                                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADDWEAMT     ZAMTCI                                              CLE023
     C                     MOVE INCCY     ZCCYI                                               CLE023
     C                     MOVE OUTCCY    ZCCYO                                               CLE023
     C                     Z-ADDZNBDP1    ZCDPI                                               CLE023
     C                     Z-ADDZNBDP2    ZCDPO                                               CLE023
     C                     Z-ADDZRATEX    ZEXCH                                               CLE023
     C                     MOVE ZMDIX     ZMD                                                 CLE023
     C                     EXSR ZCONV                                                         CLE023
     C                     Z-ADDZAMTCO    WSAMT                                               CLE023
     C                     ENDIF                                                              CLE023
     C*                                                                   S01408
     C/COPY WNCPYSRC,LE0491CCP4                                           S01408
     C*                                                                   S01408
     C**********                                                   091158 162343
     C***Chain*to*CLOAN*to*get*the*loan's*Facility*Currency*Exchang091158 162343
     C***Rate*(FCXR)*and*Facility*Multiply/Divide*Indicator.*******091158 162343
     C***********                                                  091158 162343
     C***********          MOVE 'A'       RCDT                     091158 162343
     C***********KEY002    CHAINCLOAN                22            091158 162343
     C************IN22     IFNE '1'                        ***B001 091158 162343
     C***********          Z-ADDFCXR      ZEXCH  138               091158 162343
     C***********          MOVE FMDI      ZMD     1                091158 162343
     C***********          ELSE                            ***X001 091158 162343
     C************LOCK     IN   LDA                                091158 162343
     C***********          MOVELLNRF      CLOANK  7                091158 162343
     C***********          MOVE RCDT      CLOANK                   091158 162343
     C***********          MOVEL'LE0491  'DBPGM                    091158 162343
     C***********          MOVE 'CLOANCL 'DBFILE           ********091158 162343
     C***********          Z-ADD23        DBASE            * DBERR 091158 162343
     C***********          MOVE CLOANK    DBKEY            ********091158 162343
     C***********          OUT  LDA                                091158 162343
     C***********          EXSR *PSSR                              091158 162343
     C***********          END                             ***E001 091158 162343
      *                                                                                       199588
      ** Chain to CLOAN to get the loan's Facility Currency Exchange                          199588
      ** Rate (FCXR) and Facility Multiply/Divide Indicator.                                  199588
      *                                                                                       199588
     C                     MOVE 'A'       RCDT                                                199588
     C           KEY002    CHAINCLOAN                22                                       199588
     C           *IN22     IFNE '1'                                                           199588
     C**********           Z-ADDFCXR      ZEXCH  138                                   199588 CLE023
     C**********           MOVE FMDI      ZMD     1                                    199588 CLE023
     C                     Z-ADDFCXR      ZRATEX                                              CLE023
     C                     MOVE FMDI      ZMDIX                                               CLE023
     C                     ELSE                                                               199588
     C           *LOCK     IN   LDA                                                           199588
     C                     MOVELLNRF      CLOANK  7                                           199588
     C                     MOVE RCDT      CLOANK                                              199588
     C                     MOVEL'LE0491  'DBPGM                                               199588
     C                     MOVE 'CLOANCL 'DBFILE                                              199588
     C                     Z-ADD23        DBASE                                               199588
     C                     MOVE CLOANK    DBKEY                                               199588
     C                     OUT  LDA                                                           199588
     C                     EXSR *PSSR                                                         199588
     C                     ENDIF                                                              199588
     C*                                                                   S01408
     C/COPY WNCPYSRC,LE0491CCP5                                           S01408
     C*                                                                   S01408
      *
      ***  Set up input fields for conversion SR
      *
     C**********           Z-ADDZRATEX    ZEXCH  138                      091158
     C**********           MOVE ZMDIX     ZMD     1                       091158
     C                     Z-ADDZRATEX    ZEXCH  138                      144712
     C                     MOVE ZMDIX     ZMD     1                       144712
     C*                                                                   S01408
     C/COPY WNCPYSRC,LE0491CCP6                                           S01408
     C*                                                                   S01408
     C                     Z-ADDWEAMT     ZAMTCI 150
     C                     MOVE INCCY     ZCCYI   3
     C                     MOVE OUTCCY    ZCCYO   3
     C                     Z-ADDZNBDP1    ZCDPI   10
     C                     Z-ADDZNBDP2    ZCDPO   10
      *
     C                     EXSR ZCONV
      *
     C                     Z-ADDZAMTCO    WEAMT
      *                                                                                       CLE023
      ** Convert the event amount using the new rate if future dated                          CLE023
      ** rollover on facility exchange rate exists for the loan                               CLE023
      *                                                                                       CLE023
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C                     Z-ADD*ZERO     WNAMT  130                                          CLE023
     C                     Z-ADD1         I                                                   CLE023
      *                                                                                       206300
     C           RLDT      IFNE 0                                                             206300
     C           RLDT      LOKUPRUNS,I               10  10                                   CLE023
     C           *IN10     IFEQ *ON                                                           CLE023
     C                     MOVE 'B'       RCDT                                                CLE023
     C           KEY002    CHAINCLOAN                22                                       CLE023
     C           *IN22     IFEQ '0'                                                           CLE023
     C           NFCE      IFNE *ZERO                                                         CLE023
     C           NCCY      ANDEQ*BLANKS                                                       CLE023
     C                     Z-ADDNFCE      ZEXCH                                               CLE023
     C                     MOVE NFMD      ZMD                                                 CLE023
      *                                                                                       206300
     C                     EXSR ZCONV                                                         206300
      *                                                                                       206300
     C                     Z-ADDZAMTCO    WNAMT                                               206300
     C                     ENDIF                                                              CLE023
      *                                                                                       206300
     C                     ELSE                                                               CLE023
     C           *LOCK     IN   LDA                                                           CLE023
     C                     MOVELLNRF      CLOANK  7                                           CLE023
     C                     MOVE RCDT      CLOANK                                              CLE023
     C                     MOVEL'LE0491  'DBPGM                                               CLE023
     C                     MOVE 'CLOANCK 'DBFILE                                              CLE023
     C                     Z-ADD32        DBASE                                               CLE023
     C                     MOVE CLOANK    DBKEY                                               CLE023
     C                     OUT  LDA                                                           CLE023
     C                     EXSR *PSSR                                                         CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C**********           EXSR ZCONV                                                  CLE023 206300
      **********                                                                       CLE023 206300
     C**********           Z-ADDZAMTCO    WNAMT                                        CLE023 206300
     C                     ENDIF                                                              CLE023
     C                     ENDIF                                                              206300
     C                     ENDIF                                                              CLE023
      *
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRNLND                                                                        CLE025
      *****************************************************************                       CLE025
      *                                                               *                       CLE025
      *  SRNLND - Processing for non-lending transactions             *                       CLE025
      *                                                               *                       CLE025
      *****************************************************************                       CLE025
     C           SRNLND    BEGSR                                                              CLE025
      *                                                                                       CLE025
      ** Access the Facility Extension file LEFCLTQD                                          CLE025
      *                                                                                       CLE025
     C           KFACTL    CHAINLEFCLTLH             81                                       CLE025
     C           *IN81     IFEQ *ON                                                           CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVEL'LE0491  'DBPGM                                               CLE025
     C                     MOVEL'LEFCLTLH'DBFILE                                              CLE025
     C                     Z-ADD34        DBASE                                               CLE025
     C                     MOVELCNUM      WKEY1   9                                           CLE025
     C                     MOVE FACT      WKEY1                                               CLE025
     C                     MOVELWKEY1     WKEY2  11                                           CLE025
     C                     MOVE FCNO      WKEY2                                               CLE025
     C                     MOVE WKEY2     DBKEY                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                      BUG3281
     C                     MOVE *ALL'0'   FCXO                                               BUG3281
     C                     Z-ADD0         FCXCOF                                             BUG3281
      *                                                                                       CLE025
      ** Access all live records from DEALSDB/DLDLDBQD                                        CLE025
      *                                                                                       CLE025
     C           KFACTD    SETLLDLDLDBL2                                                      CLE025
     C           KFACTD    READEDLDLDBL2                 80                                   CLE025
      *                                                                                       CLE025
     C           *IN80     DOWEQ*OFF                                                          CLE025
      *                                                                                       CLE025
      ** Deal must be live and value date of the deal must be greater than                    CLE025
      ** or equal to date of next working day                                                 CLE025
      *                                                                                       CLE025
     C                     MOVE F1DLNO    KDLNO   60                                          CLE025
     C           KDLNO     CHAINDEALS                81                                       CLE025
     C           *IN81     IFEQ *OFF                                                          CLE025
     C           DBRECI    ANDEQ'D'                                                           CLE025
     C           DBVDAT    ANDGEDNWD                                                          CLE025
     C                     Z-ADD0         WSOF                                                CLE025
     C                     Z-ADD0         WSOA                                                CLE025
     C                     Z-ADD0         WSMA                                               BUG3281
     C                     EXSR SRFXDN                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           KFACTD    READEDLDLDBL2                 80                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
      ** Access all live records from DEALSDC/DLDLDCQD                                        CLE025
      *                                                                                       CLE025
     C           KFACTD    SETLLDLDLDCL2                                                      CLE025
     C           KFACTD    READEDLDLDCL2                 80                                   CLE025
      *                                                                                       CLE025
     C           *IN80     DOWEQ*OFF                                                          CLE025
      *                                                                                       CLE025
      ** Deal must be live and maturity date of the deal must be greater than                 CLE025
      ** or equal to date of next working day                                                 CLE025
      *                                                                                       CLE025
     C                     MOVE F1DLNO    KDLNO                                               CLE025
     C           KDLNO     CHAINDEALS                81                                       CLE025
     C           *IN81     IFEQ *OFF                                                          CLE025
     C           DCRECI    ANDEQ'D'                                                           CLE025
     C           DCMDAT    ANDGEDNWD                                                          CLE025
     C           *IN81     OREQ *OFF                                                          CLE025
     C           DCRECI    ANDEQ'D'                                                           CLE025
     C           DCMDAT    ANDEQ0                                                             CLE025
     C                     Z-ADD0         WSOF                                                CLE025
     C                     Z-ADD0         WSOA                                                CLE025
     C                     Z-ADD0         WSMA                                               BUG3281
     C                     EXSR SRLDNI                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           KFACTD    READEDLDLDCL2                 80                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
      ** Access all live records in DEALSDG/DLDLDGQD                                          CLE025
      *                                                                                       CLE025
     C           KFACTD    SETLLDLDLDGLL                                                      CLE025
     C           KFACTD    READEDLDLDGLL                 80                                   CLE025
      *                                                                                       CLE025
     C           *IN80     DOWEQ*OFF                                                          CLE025
      *                                                                                       CLE025
      ** Deal must be live and value date of the deal must be greater than                    CLE025
      ** or equal to date of next working day for an FRA                                      CLE025
      *                                                                                       CLE025
     C                     MOVE F1DLNO    KDLNO                                               CLE025
     C           KDLNO     CHAINDEALS                81                                       CLE025
     C           *IN81     IFEQ *OFF                                                          CLE025
     C           DGRECI    ANDEQ'D'                                                           CLE025
     C           DGDTYP    ANDEQ'FR'                                                          CLE025
     C           DGVDAT    ANDGEDNWD                                                          CLE025
     C                     Z-ADD0         WSOF                                                CLE025
     C                     Z-ADD0         WSOA                                                CLE025
     C                     Z-ADD0         WSMA                                               BUG3281
     C                     EXSR SRFRA                                                         CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Deal must be live and maturity date of the deal must be greater than                 CLE025
      ** or equal to date of next working day for an FRA                                      CLE025
      *                                                                                       CLE025
     C           *IN81     IFEQ *OFF                                                          CLE025
     C           DGRECI    ANDEQ'D'                                                           CLE025
     C           DGMDAT    ANDGEDNWD                                                          CLE025
      *                                                                                       CLE025
     C           DGDTYP    IFEQ 'RS'                                                          CLE025
     C           DGDTYP    OREQ 'RX'                                                          CLE025
     C********** DGDTYP    ANDEQ'RP'                                                  CLE025 BUG3281
     C********** DGDTYP    ANDEQ'RF'                                                  CLE025 BUG3281
     C********** DGDTYP    ANDEQ'RR'                                                  CLE025 BUG3281
     C           DGDTYP    OREQ 'RP'                                                         BUG3281
     C           DGDTYP    OREQ 'RF'                                                         BUG3281
     C           DGDTYP    OREQ 'RR'                                                         BUG3281
     C                     Z-ADD0         WSOF                                                CLE025
     C                     Z-ADD0         WSOA                                                CLE025
     C                     Z-ADD0         WSMA                                               BUG3281
     C                     EXSR SRIRS                                                         CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           KFACTD    READEDLDLDGLL                 80                                   CLE025
      *                                                                                       CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
      ** Margin Requirement                                                                   CLE025
      *                                                                                       CLE025
      ** Call LE000023 only when FX Margin Type has a value                                   240998
     C           FCXMST    IFNE *BLANK                                                        240998
     C                     Z-ADD0         WSOF                                                CLE025
     C                     Z-ADD0         WSOA                                                CLE025
     C                     Z-ADD0         WSMA                                               BUG3281
     C                     EXSR SRMARG                                                        CLE025
     C                     ENDIF                                                              240998
      *                                                                                       CLE025
      ** Access records from ACCNTAB/GLACTNQD                                                 CLE025
      *                                                                                       CLE025
     C           KFACTD    SETLLACCNTLA                                                       CLE025
     C           KFACTD    READEACCNTLA                  81                                   CLE025
      *                                                                                       CLE025
     C           *IN81     DOWEQ*OFF                                                          CLE025
     C                     Z-ADD0         WSOF                                                CLE025
     C                     Z-ADD0         WSOA                                                CLE025
     C                     Z-ADD0         WSMA                                               BUG3281
     C                     EXSR SRACCT                                                        CLE025
     C           KFACTD    READEACCNTLA                  81                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      *****************************************************************                       CLE025
      /TITLE SR/SRFXDN                                                                        CLE025
      *****************************************************************                       CLE025
      *                                                               *                       CLE025
      *  SRFXDN - Compute and Process Exposure Amount excluding value *                       CLE025
      *           date of the deal calls the FX Exposure Calculator   *                       CLE025
      *                                                               *                       CLE025
      *****************************************************************                       CLE025
     C           SRFXDN    BEGSR                                                              CLE025
      *                                                                                       CLE025
      ** Call the COB Exposure Calculator to compute for the deal's                           CLE025
      ** exposure                                                                             CLE025
      *                                                                                       CLE025
     C                     CALL 'LE000022'               90                                   CLE025
     C                     PARM *BLANKS   PRTCD   7                                           CLE025
     C                     PARM DBDLNO    PDLNO   60                                          CLE025
     C                     PARM 'DL'      PMOD    2                                           CLE025
     C                     PARM 'FXDL'    PSMOD   4                                           CLE025
     C                     PARM *ZEROS    PAMNT                                               CLE025
     C                     PARM *ZEROS    PCEXP  130                                         BUG3382
      *                                                                                       CLE025
     C           *IN90     IFEQ *ON                                                           CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVE 'LE000022'DBFILE                                              CLE025
     C                     MOVEL'LE0491'  DBPGM                                               CLE025
     C                     MOVEL'*CALL'   DBKEY                                               CLE025
     C                     Z-ADD38        DBASE                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           PRTCD     IFNE *BLANKS                                                       CLE025
     C                     MOVE 'Y'       WERROR                                              CLE025
     C                     MOVE DBDLNO    WKDL                                                CLE025
     C                     EXSR SRPRNT                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Determine if the return is an offset or an exposure amount                           CLE025
      *                                                                                       CLE025
     C           PRTCD     IFEQ *BLANKS                                                       CLE025
     C                     EXSR SRARY1                                                        CLE025
     C                     MOVE 'N'       WPOS    1                                           CLE025
     C                     MOVE 'N'       WOFF    1                                           CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C           EXPA,I    IFNE *ZEROS                                                        CLE025
     C                     MOVE 'Y'       WPOS                                                CLE025
     C                     ENDIF                                                              CLE025
     C           OFFS,I    IFNE *ZEROS                                                        CLE025
     C                     MOVE 'Y'       WOFF                                                CLE025
     C                     ENDIF                                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
      ** Update the drawn amounts with either the exposure amount or                          CLE025
      ** offset amount from today up to but excluding the value date                          CLE025
      ** of the deal                                                                          CLE025
      *                                                                                       CLE025
     C                     Z-ADD0         WSCEXP 130                                         BUG3382
     C                     Z-ADDPCEXP     WSCEXP                                             BUG3382
     C                     ADD  PCEXP     CEXP                                               BUG3382
     C                     Z-ADD0         WSCAMD                                              CLE025
     C           WPOS      IFEQ 'Y'                                                           CLE025
     C                     ADD  EXPA,1    CAMD                                                CLE025
     C                     Z-ADDEXPA,1    WSCAMD 130                                          CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C           RUNS,I    IFLT DBVDAT                                                        CLE025
     C                     ADD  EXPA,I    OAM,I                                               CLE025
     C                     Z-ADDEXPA,I    WSOA,I                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     Z-ADD0         WSFCXO                                              CLE025
     C           WOFF      IFEQ 'Y'                                                           CLE025
     C                     ADD  OFFS,1    FCXCOF                                              CLE025
     C                     Z-ADDOFFS,1    WSFCXO 130                                          CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C           RUNS,I    IFLT DBVDAT                                                        CLE025
     C                     ADD  OFFS,I    FCXO,I                                              CLE025
     C                     Z-ADDOFFS,I    WSOF,I                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** If facility is a tranche                                                             CLE025
      *                                                                                       CLE025
     C           TRCA      IFEQ 'TR'                                                          CLE025
     C                     MOVEL'00FX'    ETYP                                                CLE025
     C                     Z-ADD0         PTYP                                                CLE025
     C                     EXSR SRTRCA                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ELSE                                                               CLE025
     C                     EXSR SRPRNT                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      *****************************************************************                       CLE025
      /TITLE SR/SRLDNI                                                                        CLE025
      *****************************************************************                       CLE025
      *                                                               *                       CLE025
      *  SRLDNI - Compute and Process Exposure Amount by calling the  *                       CLE025
      *           COB MM Exposure Calculator                          *                       CLE025
      *                                                               *                       CLE025
      *****************************************************************                       CLE025
     C           SRLDNI    BEGSR                                                              CLE025
      *                                                                                       CLE025
      ** Call the COB Exposure Calculator to compute for the deal's                           CLE025
      ** exposure                                                                             CLE025
      *                                                                                       CLE025
     C                     CALL 'LE000022'               90                                   CLE025
     C                     PARM *BLANKS   PRTCD   7                                           CLE025
     C                     PARM DCDLNO    PDLNO   60                                          CLE025
     C                     PARM 'DL'      PMOD    2                                           CLE025
     C                     PARM 'LDNI'    PSMOD   4                                           CLE025
     C                     PARM *BLANKS   PAMNT                                               CLE025
     C                     PARM *ZEROS    PCEXP                                              BUG3382
      *                                                                                       CLE025
     C           *IN90     IFEQ *ON                                                           CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVE 'LE000022'DBFILE                                              CLE025
     C                     MOVEL'LE0491'  DBPGM                                               CLE025
     C                     MOVEL'*CALL'   DBKEY                                               CLE025
     C                     Z-ADD39        DBASE                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           PRTCD     IFNE *BLANKS                                                       CLE025
     C                     MOVE 'Y'       WERROR                                              CLE025
     C                     MOVE DCDLNO    WKDL                                                CLE025
     C                     EXSR SRPRNT                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Update the current exposure with the exposure amount 1                               CLE025
      *                                                                                       CLE025
     C           PRTCD     IFEQ *BLANKS                                                       CLE025
     C                     EXSR SRARY1                                                        CLE025
     C                     ADD  EXPA,1    CAMD                                                CLE025
     C                     Z-ADDEXPA,1    WSCAMD                                              CLE025
     C                     Z-ADD0         WSFCXO                                              CLE025
     C                     ADD  PCEXP     CEXP                                               BUG3382
     C                     Z-ADDPCEXP     WSCEXP                                             BUG3382
      *                                                                                       CLE025
      ** Update the drawn amounts with either the exposure amount                             CLE025
      ** from today (or value date of the deal, if later) up to but                           CLE025
      ** excluding the maturity date of the deal                                              CLE025
      *                                                                                       CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C           RUNS,I    IFGE BJRDNB                                                        CLE025
     C           RUNS,I    ANDGEDCVDAT                                                        CLE025
     C           RUNS,I    ANDLTDCMDAT                                                        CLE025
     C           RUNS,I    ORGE BJRDNB                                                        CLE025
     C           RUNS,I    ANDGEDCVDAT                                                        CLE025
     C           DCMDAT    ANDEQ0                                                             CLE025
     C                     ADD  EXPA,I    OAM,I                                               CLE025
     C                     Z-ADDEXPA,I    WSOA,I                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
      ** If facility is a tranche                                                             CLE025
      *                                                                                       CLE025
     C           TRCA      IFEQ 'TR'                                                          CLE025
     C                     MOVEL'00MM'    ETYP                                                CLE025
     C                     Z-ADD0         PTYP                                                CLE025
     C                     EXSR SRTRCA                                                        CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      *****************************************************************                       CLE025
      /TITLE SR/SRFRA                                                                         CLE025
      *****************************************************************                       CLE025
      *                                                               *                       CLE025
      *  SRFRA  - Compute and Process Exposure Amount by calling the  *                       CLE025
      *           COB FRA/IRS Exposure Calculator                     *                       CLE025
      *                                                               *                       CLE025
      *****************************************************************                       CLE025
     C           SRFRA     BEGSR                                                              CLE025
      *                                                                                       CLE025
      ** Call the COB Exposure Calculator to compute for the deal's                           CLE025
      ** exposure                                                                             CLE025
      *                                                                                       CLE025
     C                     CALL 'LE000022'               90                                   CLE025
     C                     PARM *BLANKS   PRTCD   7                                           CLE025
     C                     PARM DGDLNO    PDLNO   60                                          CLE025
     C                     PARM 'DL'      PMOD    2                                           CLE025
     C                     PARM 'FRAS'    PSMOD   4                                           CLE025
     C                     PARM *BLANKS   PAMNT                                               CLE025
     C                     PARM *ZEROS    PCEXP                                              BUG3382
      *                                                                                       CLE025
     C           *IN90     IFEQ *ON                                                           CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVE 'LE000022'DBFILE                                              CLE025
     C                     MOVEL'LE0491'  DBPGM                                               CLE025
     C                     MOVEL'*CALL'   DBKEY                                               CLE025
     C                     Z-ADD40        DBASE                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           PRTCD     IFNE *BLANKS                                                       CLE025
     C                     MOVE 'Y'       WERROR                                              CLE025
     C                     MOVE DGDLNO    WKDL                                                CLE025
     C                     EXSR SRPRNT                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Determine if the return is an offset or an exposure amount                           CLE025
      *                                                                                       CLE025
     C           PRTCD     IFEQ *BLANKS                                                       CLE025
     C                     EXSR SRARY1                                                        CLE025
     C                     MOVE 'N'       WPOS    1                                           CLE025
     C                     MOVE 'N'       WOFF    1                                           CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C           EXPA,I    IFNE *ZEROS                                                        CLE025
     C                     MOVE 'Y'       WPOS                                                CLE025
     C                     ENDIF                                                              CLE025
     C           OFFS,I    IFNE *ZEROS                                                        CLE025
     C                     MOVE 'Y'       WOFF                                                CLE025
     C                     ENDIF                                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
      ** Update the drawn amounts with either the exposure amount or                          CLE025
      ** offset amount from today up to but excluding the value date                          CLE025
      ** of the deal                                                                          CLE025
      *                                                                                       CLE025
     C                     Z-ADD0         WSCAMD                                              CLE025
     C                     Z-ADD0         WSCEXP                                             BUG3382
     C                     Z-ADDPCEXP     WSCEXP                                             BUG3382
     C                     ADD  PCEXP     CEXP                                               BUG3382
     C           WPOS      IFEQ 'Y'                                                           CLE025
     C                     ADD  EXPA,1    CAMD                                                CLE025
     C                     Z-ADDEXPA,1    WSCAMD                                              CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C           RUNS,I    IFLT DGVDAT                                                        CLE025
     C                     ADD  EXPA,I    OAM,I                                               CLE025
     C                     Z-ADDEXPA,I    WSOA,I                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     Z-ADD0         WSFCXO                                              CLE025
     C           WOFF      IFEQ 'Y'                                                           CLE025
     C                     ADD  OFFS,1    FCXCOF                                              CLE025
     C                     Z-ADDOFFS,1    WSFCXO                                              CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C           RUNS,I    IFLT DGVDAT                                                        CLE025
     C                     ADD  OFFS,I    FCXO,I                                              CLE025
     C                     Z-ADDOFFS,I    WSOF,I                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** If facility is a tranche                                                             CLE025
      *                                                                                       CLE025
     C           TRCA      IFEQ 'TR'                                                          CLE025
     C                     MOVEL'00FR'    ETYP                                                CLE025
     C                     Z-ADD0         PTYP                                                CLE025
     C                     EXSR SRTRCA                                                        CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      *****************************************************************                       CLE025
      /TITLE SR/SRIRS                                                                         CLE025
      *****************************************************************                       CLE025
      *                                                               *                       CLE025
      *  SRIRS  - Compute and Process Exposure Amount by calling the  *                       CLE025
      *           COB FRA/IRS Exposure Calculator                     *                       CLE025
      *                                                               *                       CLE025
      *****************************************************************                       CLE025
     C           SRIRS     BEGSR                                                              CLE025
      *                                                                                       CLE025
      ** Determine the sub-module                                                             CLE025
      *                                                                                       CLE025
     C                     SELEC                                                              CLE025
     C           DGDTYP    WHEQ 'RS'                                                          CLE025
     C                     MOVE 'SIRS'    PSMOD                                               CLE025
     C           DGDTYP    WHEQ 'RX'                                                          CLE025
     C                     MOVE 'CIRS'    PSMOD                                               CLE025
     C           DGDTYP    WHEQ 'RP'                                                          CLE025
     C           DGDTYP    OREQ 'RF'                                                          CLE025
     C           DGDTYP    OREQ 'RR'                                                          CLE025
     C                     MOVE 'CFCO'    PSMOD                                               CLE025
     C                     ENDSL                                                              CLE025
      *                                                                                       CLE025
      ** Call the COB Exposure Calculator to compute for the deal's                           CLE025
      ** exposure                                                                             CLE025
      *                                                                                       CLE025
     C                     CALL 'LE000022'               90                                   CLE025
     C                     PARM *BLANKS   PRTCD   7                                           CLE025
     C                     PARM DGDLNO    PDLNO                                               CLE025
     C                     PARM 'DL'      PMOD                                                CLE025
     C                     PARM           PSMOD                                               CLE025
     C                     PARM *BLANKS   PAMNT                                               CLE025
     C                     PARM *ZEROS    PCEXP                                              BUG3382
      *                                                                                       CLE025
     C           *IN90     IFEQ *ON                                                           CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVE 'LE000022'DBFILE                                              CLE025
     C                     MOVEL'LE0491'  DBPGM                                               CLE025
     C                     MOVEL'*CALL'   DBKEY                                               CLE025
     C                     Z-ADD41        DBASE                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           PRTCD     IFNE *BLANKS                                                       CLE025
     C                     MOVE 'Y'       WERROR                                              CLE025
     C                     MOVE DGDLNO    WKDL                                                CLE025
     C                     EXSR SRPRNT                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Determine if the return is an offset or an exposure amount                           CLE025
      *                                                                                       CLE025
     C           PRTCD     IFEQ *BLANKS                                                       CLE025
     C                     EXSR SRARY1                                                        CLE025
     C                     MOVE 'N'       WPOS    1                                           CLE025
     C                     MOVE 'N'       WOFF    1                                           CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C           EXPA,I    IFNE *ZEROS                                                        CLE025
     C                     MOVE 'Y'       WPOS                                                CLE025
     C                     ENDIF                                                              CLE025
     C           OFFS,I    IFNE *ZEROS                                                        CLE025
     C                     MOVE 'Y'       WOFF                                                CLE025
     C                     ENDIF                                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
      ** Update the drawn amounts with either the exposure amount or                          CLE025
      ** offset amount from today up to but excluding the maturity                            CLE025
      ** date of the deal                                                                     CLE025
      *                                                                                       CLE025
     C                     Z-ADD0         WSCAMD                                              CLE025
     C                     Z-ADD0         WSCEXP                                             BUG3382
     C                     Z-ADDPCEXP     WSCEXP                                             BUG3382
     C                     ADD  PCEXP     CEXP                                               BUG3382
     C           WPOS      IFEQ 'Y'                                                           CLE025
     C                     ADD  EXPA,1    CAMD                                                CLE025
     C                     Z-ADDEXPA,1    WSCAMD                                              CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C           RUNS,I    IFLT DGMDAT                                                        CLE025
     C                     ADD  EXPA,I    OAM,I                                               CLE025
     C                     Z-ADDEXPA,I    WSOA,I                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     Z-ADD0         WSFCXO                                              CLE025
     C           WOFF      IFEQ 'Y'                                                           CLE025
     C                     ADD  OFFS,1    FCXCOF                                              CLE025
     C                     Z-ADDOFFS,1    WSFCXO                                              CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C           RUNS,I    IFLT DGMDAT                                                        CLE025
     C                     ADD  OFFS,I    FCXO,I                                              CLE025
     C                     Z-ADDOFFS,I    WSOF,I                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** If facility is a tranche                                                             CLE025
      *                                                                                       CLE025
     C           TRCA      IFEQ 'TR'                                                          CLE025
     C                     MOVEL'00IR'    ETYP                                                CLE025
     C                     Z-ADD0         PTYP                                                CLE025
     C                     EXSR SRTRCA                                                        CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      *****************************************************************                       CLE025
      /TITLE SR/SRMARG                                                                        CLE025
      *****************************************************************                       CLE025
      *                                                               *                       CLE025
      *  SRMARG - Compute for facility's margin requirement           *                       CLE025
      *                                                               *                       CLE025
      *****************************************************************                       CLE025
     C           SRMARG    BEGSR                                                              CLE025
      *                                                                                       CLE025
     C                     Z-ADD0         WSCAMD                                              CLE025
     C                     Z-ADD0         WSCEXP                                             BUG3382
      *                                                                                       CLE025
      ** Call COB FX Margin Exposure Calculator                                               CLE025
      *                                                                                       CLE025
     C**********           MOVE FCXFCU    PFCCU   60                                    CLE025CSD027
     C                     MOVE FCXFCU    PFCCU   6                                           CSD027
     C                     MOVE FCXFTP    PFACT   30                                          CLE025
     C                     MOVE FCXFNO    PFCNO   20                                          CLE025
     C**********           MOVE FCXBRC    PFBRC   30                                 BUG3644 BUG5286
     C                     MOVE FCXBRC    PFBRC   3                                          BUG5286
     C                     CALL 'LE000023'               90                                   CLE025
     C                     PARM *BLANKS   PRTCD                                               CLE025
     C                     PARM           PFCCU                                               CLE025
     C                     PARM           PFACT                                               CLE025
     C                     PARM           PFCNO                                               CLE025
     C                     PARM *BLANKS   PEXPC 130                                           CLE025
     C                     PARM           PFBRC                                              BUG3644
      *                                                                                       CLE025
     C           *IN90     IFEQ *ON                                                           CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVE 'LE000023'DBFILE                                              CLE025
     C                     MOVEL'LE0491'  DBPGM                                               CLE025
     C                     MOVEL'*CALL'   DBKEY                                               CLE025
     C                     Z-ADD42        DBASE                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           PRTCD     IFNE *BLANKS                                                       CLE025
     C                     MOVE 'Y'       WERROR                                              CLE025
     C                     MOVE FCXFCU    WKDL                                                CLE025
     C                     MOVE FCXFTP    WFACT                                               CLE025
     C                     MOVE FCXFNO    WACSQ                                               CLE025
     C                     MOVE '-'       WDASH3                                              CLE025
     C                     EXSR SRPRNT                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Update the current exposure with the margin requirement                              CLE025
      ** amount 1                                                                             CLE025
      *                                                                                       CLE025
     C           PRTCD     IFEQ *BLANKS                                                       CLE025
     C                     EXSR SRARY2                                                        CLE025
     C                     ADD  EXPA,1    CAMD                                                CLE025
     C                     ADD  EXPA,1    CEXP                                               BUG3382
      *                                                                                       CLE025
      ** Update the drawn amounts and margin amounts from today up to 9                       CLE025
      ** working days forward                                                                 CLE025
      *                                                                                       CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C                     ADD  EXPA,I    OAM,I                                               CLE025
     C**********           ADD  EXPA,I    MARQ,I                                      CLE025 BUG3281
     C                     Z-ADDEXPA,I    WSMA,I                                             BUG3281
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
     C           TRCA      IFEQ 'TR'                                                          CLE025
     C                     MOVE 'Y'       WMGRQ   1                                           CLE025
     C                     MOVEL'00FM'    ETYP                                                CLE025
     C                     Z-ADD0         PTYP                                                CLE025
     C                     EXSR SRTRCA                                                        CLE025
     C                     MOVE ' '       WMGRQ                                               CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                      BUG3281
     C                     Z-ADD1         I                                                  BUG3281
     C           I         DOWLT11                                                           BUG3281
     C                     Z-ADDWSMA,I    MARQ,I                                             BUG3281
     C                     ADD  1         I                                                  BUG3281
     C                     ENDDO                                                             BUG3281
      *                                                                                      BUG3281
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      *****************************************************************                       CLE025
      /TITLE SR/SRACCT                                                                        CLE025
      *****************************************************************                       CLE025
      *                                                               *                       CLE025
      *  SRACCT - Processing for Accounts                             *                       CLE025
      *                                                               *                       CLE025
      *****************************************************************                       CLE025
     C           SRACCT    BEGSR                                                              CLE025
      *                                                                                     CLE075AF
      ** Get the value to be cached in LRU                                                  CLE075AF
      *                                                                                     CLE075AF
     C                     MOVELGLACOD    KEYACD                                            CLE075AF
     C                     ADD  1         ACDSEQ                                            CLE075AF
     C                     EXSR CHKACD                                                      CLE075AF
      *                                                                                     CLE075AF
      ** Use details from array if ACDKEY is found, otherwise,                              CLE075AF
      ** retrieve details from program call                                                 CLE075AF
      *                                                                                     CLE075AF
     C           ACDIC     IFEQ 'Y'                                                         CLE075AF
      *                                                                                     CLE075AF
      ** Set occurence to index found from #ACK array                                       CLE075AF
      *                                                                                     CLE075AF
     C           P         OCUR SDACOD                                                      CLE075AF
      *                                                                                     CLE075AF
     C                     ELSE                                                             CLE075AF
      *                                                                                     CLE075AF
     C           ACDIDX    IFNE 0                                                           CLE075AF
     C                     Z-ADDACDIDX    P                                                 CLE075AF
     C                     ELSE                                                             CLE075AF
     C                     Z-ADD1         P                                                 CLE075AF
     C                     MOVEA#ACD      #ACS                                              CLE075AF
     C                     SORTA#ACS                                                        CLE075AF
     C                     Z-ADD#ACS,1    ACDKEY                                            CLE075AF
     C           ACDKEY    LOKUP#ACD,P                   48                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C           P         OCUR SDACOD                                                      CLE075AF
      *                                                                                       CLE025
      ** Retrieve the instrument type                                                         CLE025
      *                                                                                       CLE025
     C                     MOVE GLACOD    PACOD                                               CLE025
     C                     CALL 'AOACODR0'                                                    CLE025
     C                     PARM *BLANKS   PRTCD                                               CLE025
     C                     PARM '*KEY   ' POPTN                                               CLE025
     C                     PARM           PACOD                                               CLE025
     C           SDACOD    PARM SDACOD    DSSDY                                               CLE025
      *                                                                                       CLE025
     C           PRTCD     IFNE *BLANKS                                                       CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVEL'SDACODPD'DBFILE                                              CLE025
     C                     Z-ADD35        DBASE                                               CLE025
     C                     MOVELPACOD     DBKEY                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ELSE                                                             CLE075AF
     C                     EXSR ADDACD                                                      CLE075AF
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                            CLE075AF
      *                                                                                      BUG4510
     C           A5INNR    IFNE *BLANKS                                                      BUG4510
     C                     MOVELA5INNR    KEYINS                                            CLE075AF
     C                     ADD  1         INSSEQ                                            CLE075AF
     C                     EXSR CHKINS                                                      CLE075AF
      *                                                                                     CLE075AF
      ** Use details from array if INSKEY is found, otherwise,                              CLE075AF
      ** retrieve details from program call                                                 CLE075AF
      *                                                                                     CLE075AF
     C           INSIC     IFEQ 'Y'                                                         CLE075AF
      *                                                                                     CLE075AF
      ** Set occurence to index found from #ISK array                                       CLE075AF
      *                                                                                     CLE075AF
     C           G         OCUR SDPLIN                                                      CLE075AF
      *                                                                                     CLE075AF
     C                     ELSE                                                             CLE075AF
      *                                                                                     CLE075AF
     C           INSIDX    IFNE 0                                                           CLE075AF
     C                     Z-ADDINSIDX    G                                                 CLE075AF
     C                     ELSE                                                             CLE075AF
     C                     Z-ADD1         G                                                 CLE075AF
     C                     MOVEA#INS      #ISS                                              CLE075AF
     C                     SORTA#ISS                                                        CLE075AF
     C                     Z-ADD#ISS,1    INSKEY                                            CLE075AF
     C           INSKEY    LOKUP#INS,G                   46                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C           G         OCUR SDPLIN                                                      CLE075AF
      *                                                                                       CLE025
      ** Retrieve weighting code and include offset indicator                                 CLE025
      *                                                                                       CLE025
     C                     CALL 'AOPLINR0'                                                    CLE025
     C                     PARM *BLANKS   PRTCD                                               CLE025
     C                     PARM '*KEY   ' POPTN                                               CLE025
     C                     PARM A5INNR    PINNR   3                                           CLE025
     C           SDPLIN    PARM SDPLIN    DSFDY                                               CLE025
      *                                                                                       CLE025
     C           PRTCD     IFNE *BLANKS                                                       CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVEL'SDPLINPD'DBFILE                                              CLE025
     C                     Z-ADD36        DBASE                                               CLE025
     C                     MOVELPINNR     DBKEY                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ELSE                                                             CLE075AF
     C                     EXSR ADDINS                                                      CLE075AF
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                            CLE075AF
      *                                                                                      BUG4510
     C                     ELSE                                                              BUG4510
     C                     MOVE *BLANKS   PDINOF                                             BUG4510
     C                     ENDIF                                                             BUG4510
      *                                                                                       CLE025
     C                     MOVE *OFF      *IN81                                               CLE025
      *                                                                                       CLE025
     C                     SELEC                                                              CLE025
     C           PDINOF    WHEQ 'Y'                                                           CLE025
     C                     MOVELPDWEIG    KEYWEI                                            CLE075AF
     C                     ADD  1         WEISEQ                                            CLE075AF
     C                     EXSR CHKWEI                                                      CLE075AF
      *                                                                                     CLE075AF
      ** Use details from array if WEIKEY is found, otherwise,                              CLE075AF
      ** retrieve details from program call                                                 CLE075AF
      *                                                                                     CLE075AF
     C           WEIIC     IFEQ 'Y'                                                         CLE075AF
      *                                                                                     CLE075AF
      ** Set occurence to index found from #BRK array                                       CLE075AF
      *                                                                                     CLE075AF
     C           H         OCUR GPWEIG                                                      CLE075AF
      *                                                                                     CLE075AF
     C                     ELSE                                                             CLE075AF
      *                                                                                     CLE075AF
     C           WEIIDX    IFNE 0                                                           CLE075AF
     C                     Z-ADDWEIIDX    H                                                 CLE075AF
     C                     ELSE                                                             CLE075AF
     C                     Z-ADD1         H                                                 CLE075AF
     C                     MOVEA#WEI      #WES                                              CLE075AF
     C                     SORTA#WES                                                        CLE075AF
     C                     Z-ADD#WES,1    WEIKEY                                            CLE075AF
     C           WEIKEY    LOKUP#WEI,H                   47                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C           H         OCUR GPWEIG                                                      CLE075AF
      *                                                                                     CLE075AF
     C           PDWEIG    CHAINGPWEIGL0             81                                       CLE025
     C           *IN81     IFEQ '0'                                                         CLE075AF
     C                     EXSR ADDWEI                                                      CLE075AF
     C                     ENDIF                                                            CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                       CLE025
     C           PDINOF    WHEQ 'C'                                                           CLE025
     C                     MOVE *BLANKS   PCNUM                                               CLE025
     C                     MOVE GLCNUM    PCNUM                                               CLE025
     C                     CALL 'AOCUSTR0'                                                    CLE025
     C                     PARM *BLANKS   PRTCD                                               CLE025
     C                     PARM '*KEY   ' POPTN                                               CLE025
     C                     PARM           PCNUM  10                                           CLE025
     C                     PARM           PKYST   7                                           CLE025
     C           SDCUST    PARM SDCUST    DSSDY                                               CLE025
      *                                                                                       CLE025
     C           PRTCD     IFNE *BLANKS                                                       CLE025
     C           *LOCK     IN   LDA                                                           CLE025
     C                     MOVEL'SDCUSTPD'DBFILE                                              CLE025
     C                     Z-ADD37        DBASE                                               CLE025
     C                     MOVELGLCNUM    DBKEY                                               CLE025
     C                     OUT  LDA                                                           CLE025
     C                     EXSR *PSSR                                                         CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           BBINOF    IFEQ 'Y'                                                           CLE025
     C                     MOVELPDWEIG    KEYWEI                                            CLE075AF
     C                     ADD  1         WEISEQ                                            CLE075AF
     C                     EXSR CHKWEI                                                      CLE075AF
      *                                                                                     CLE075AF
      ** Use details from array if WEIKEY is found, otherwise,                              CLE075AF
      ** retrieve details from program call                                                 CLE075AF
      *                                                                                     CLE075AF
     C           WEIIC     IFEQ 'Y'                                                         CLE075AF
      *                                                                                     CLE075AF
      ** Set occurence to index found from #BRK array                                       CLE075AF
      *                                                                                     CLE075AF
     C           H         OCUR GPWEIG                                                      CLE075AF
      *                                                                                     CLE075AF
     C                     ELSE                                                             CLE075AF
      *                                                                                     CLE075AF
     C           WEIIDX    IFNE 0                                                           CLE075AF
     C                     Z-ADDWEIIDX    H                                                 CLE075AF
     C                     ELSE                                                             CLE075AF
     C                     Z-ADD1         H                                                 CLE075AF
     C                     MOVEA#WEI      #WES                                              CLE075AF
     C                     SORTA#WES                                                        CLE075AF
     C                     Z-ADD#WES,1    WEIKEY                                            CLE075AF
     C           WEIKEY    LOKUP#WEI,H                   47                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C           H         OCUR GPWEIG                                                      CLE075AF
      *                                                                                     CLE075AF
     C           PDWEIG    CHAINGPWEIGL0             81                                       CLE025
     C           *IN81     IFEQ '0'                                                         CLE075AF
     C                     EXSR ADDWEI                                                      CLE075AF
     C                     ENDIF                                                            CLE075AF
     C                     ENDIF                                                            CLE075AF
     C                     ELSE                                                               CLE025
     C                     Z-ADD*ZEROS    PDPERC                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     OTHER                                                              CLE025
     C                     Z-ADD*ZEROS    PDPERC                                              CLE025
      *                                                                                       CLE025
     C                     ENDSL                                                              CLE025
      *                                                                                       CLE025
     C           *IN81     IFEQ *ON                                                           CLE025
     C                     Z-ADD100       PDPERC                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Set the account balance for the next 10 days with the cleared                        CLE025
      ** balance                                                                              CLE025
      *                                                                                       CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C           CLE169    IFEQ 'Y'                                                           CLE169
     C                     Z-ADDGLLDBL    ACCT,I                                              CLE169
     C                     ELSE                                                               CLE169
     C                     Z-ADDGLCLBL    ACCT,I                                              CLE025
     C                     ENDIF                                                              CLE169
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
      ** Access all records in RSACMTPD ofr the same account with value                       CLE025
      ** date less than 10 working days forward                                               CLE025
      *                                                                                       CLE025
     C           CAP205    IFEQ 'Y'                                                         CLE075AF
     C           KACCT     SETLLGLACNTL4                                                    CLE075AF
     C           KACCT     READEGLACNTL4                 81                                 CLE075AF
     C                     ENDIF                                                              CLE169
     C**********           ELSE                                                      CLE075AF CLE169
     C           CAP205    IFEQ 'N'                                                           CLE169
     C           CLE169    OREQ 'Y'                                                           CLE169
     C           KACCT     SETLLRSACMTL7                                                      CLE025
     C           KACCT     READERSACMTL7                 81                                   CLE025
     C                     ENDIF                                                            CLE075AF
      *                                                                                       CLE025
     C           *IN81     DOWEQ*OFF                                                          CLE025
     C           CAP205    ANDNE'Y'                                                         MD021155
     C           *IN81     OREQ *OFF                                                          CLE169
     C           CLE169    ANDEQ'Y'                                                           CLE169
      *                                                                                       CLE025
     C           CLE169    IFEQ 'N'                                                           CLE169
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
      *                                                                                       CLE025
     C********** VUDT      IFGE DNWD                                                  CLE025 BUG3281
     C********** VUDT      IFGE BJRDNB                                            BUG3281 AR1023928A
     C********** VUDT      ANDLERUNS,I                                             CLE025 AR1023928A
     C           VUDT      IFLE RUNS,I                                                    AR1023928A
     C           DORC      IFEQ 0                                                             CLE025
     C                     ADD  MVAM      ACCT,I                                              CLE025
     C                     ELSE                                                               CLE025
     C                     SUB  MVAM      ACCT,I                                              CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
      *
     C           *IN81     IFEQ *OFF                                                        MD021155
     C           CAP205    ANDEQ'Y'                                                         MD021155
      *
     C                     Z-ADD10        I                                                 MD021155
     C                     Z-ADDF1BAV0    ACCT,1                                            MD021155
     C                     Z-ADDF1BAV1    ACCT,2                                            MD021155
     C                     Z-ADDF1BAV2    ACCT,3                                            MD021155
     C                     Z-ADDF1BAV3    ACCT,4                                            MD021155
     C                     Z-ADDF1BAV4    ACCT,5                                            MD021155
     C                     Z-ADDF1BAV5    ACCT,6                                            MD021155
     C                     Z-ADDF1BAV6    ACCT,7                                            MD021155
     C                     Z-ADDF1BAV7    ACCT,8                                            MD021155
     C                     Z-ADDF1BAV8    ACCT,9                                            MD021155
     C                     Z-ADDF1BAV9    ACCT,I                                            MD021155
      *
     C                     ENDIF                                                            MD021155
     C                     ELSE                                                               CLE169
     C           PTDT      IFEQ BJRDNB                                                        CLE169
     C                     Z-ADDPTDT      KPSTD                                               CLE169
     C                     Z-ADDDORC      KDRCR                                               CLE169
     C           KACCT3    CHAINAPOSTL4              73                                       CLE169
     C           *IN73     IFEQ *OFF                                                          CLE169
     C           YYPSTD    ANDEQBJRDNB                                                      MD044153
     C                     ELSE                                                               CLE169
     C                     Z-ADD1         I                                                   CLE169
     C           I         DOWLT11                                                            CLE169
      *                                                                                       CLE169
     C           VUDT      IFLE RUNS,I                                                        CLE169
     C           CLE169    OREQ 'Y'                                                           CLE169
     C           PTDT      ANDLERUNS,I                                                        CLE169
     C           PTDT      ANDGEBJRDNB                                                        CLE169
     C           DORC      IFEQ 0                                                             CLE169
     C                     ADD  MVAM      ACCT,I                                              CLE169
     C                     ELSE                                                               CLE169
     C                     SUB  MVAM      ACCT,I                                              CLE169
     C                     ENDIF                                                              CLE169
     C                     ENDIF                                                              CLE169
      *                                                                                       CLE169
     C                     ADD  1         I                                                   CLE169
     C                     ENDDO                                                              CLE169
      *                                                                                       CLE169
     C                     ENDIF                                                              CLE169
     C                     ELSE                                                               CLE169
     C                     Z-ADD1         I                                                   CLE169
     C           I         DOWLT11                                                            CLE169
      *                                                                                       CLE169
     C           VUDT      IFGE BJRDNB                                                        CLE169
     C           VUDT      ANDLERUNS,I                                                        CLE169
     C           CLE169    OREQ 'Y'                                                           CLE169
     C           PTDT      ANDLERUNS,I                                                        CLE169
     C           PTDT      ANDGEBJRDNB                                                        CLE169
     C           DORC      IFEQ 0                                                             CLE169
     C                     ADD  MVAM      ACCT,I                                              CLE169
     C                     ELSE                                                               CLE169
     C                     SUB  MVAM      ACCT,I                                              CLE169
     C                     ENDIF                                                              CLE169
     C                     ENDIF                                                              CLE169
      *                                                                                       CLE169
     C                     ADD  1         I                                                   CLE169
     C                     ENDDO                                                              CLE169
      *                                                                                       CLE169
     C                     ENDIF                                                              CLE169
     C                     ENDIF                                                              CLE169
      *                                                                                       CLE025
     C           CAP205    IFEQ 'Y'                                                         CLE075AF
     C           KACCT     READEGLACNTL4                 81                                 CLE075AF
     C                     ENDIF                                                              CLE169
     C**********           ELSE                                                      CLE075AF CLE169
     C           CAP205    IFEQ 'N'                                                           CLE169
     C           CLE169    OREQ 'Y'                                                           CLE169
     C           KACCT     READERSACMTL7                 81                                   CLE025
     C                     ENDIF                                                            CLE075AF
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE040
      ** Access all records in GLACP1L2 for the same account with value                       CLE040
      ** date less than date of next working day                                              CLE040
      *                                                                                       CLE040
     C           CLE025    IFEQ 'Y'                                                           CLE040
      *                                                                                       CLE040
     C           KACCT2    SETLLGLACP1L2                                                      CLE040
     C           KACCT2    READEGLACP1L2                 81                                   CLE040
      *                                                                                       CLE040
     C           *IN81     DOWEQ*OFF                                                          CLE040
      *                                                                                       CLE040
     C           VALD      IFLT DNWD                                                          CLE040
     C           CLE169    OREQ 'Y'                                                           CLE169
     C           PSTD      ANDLTDNWD                                                          CLE169
      *                                                                                       CLE040
     C           DRCR      IFEQ 0                                                             CLE040
     C                     ADD  PSTA      ACCT,1                                              CLE040
     C                     ELSE                                                               CLE040
     C                     SUB  PSTA      ACCT,1                                              CLE040
     C                     ENDIF                                                              CLE040
      *                                                                                       CLE040
     C                     ENDIF                                                              CLE040
      *                                                                                       CLE040
     C           KACCT2    READEGLACP1L2                 81                                   CLE040
     C                     ENDDO                                                              CLE040
      *                                                                                       255811
      ** Chain to CLEARPD and include interest charges for the                                255811
      ** account if rundate is less than or equal to date in RUNS.                            255811
      *                                                                                       255811
     C           CLE169    IFEQ 'N'                                                           CLE169
     C           KACCT2    SETLLCLEARL1                                                       255811
     C           KACCT2    READECLEARL1                  81                                   255811
      *                                                                                       255811
     C           *IN81     DOWEQ*OFF                                                          255811
      *                                                                                       255811
     C                     Z-ADD1         J                                                   255811
     C           J         DOWLT11                                                            255811
      *                                                                                       255811
     C           VALD      IFLT DNWD                                                          255811
     C           VALD      ANDLERUNS,J                                                        255811
      *                                                                                       255811
     C           DRCR      IFEQ 0                                                             255811
     C                     ADD  PSTA      ACCT,J                                              255811
     C                     ELSE                                                               255811
     C                     SUB  PSTA      ACCT,J                                              255811
     C                     ENDIF                                                              255811
      *                                                                                       255811
     C                     ENDIF                                                              255811
     C                     ADD  1         J                                                   255811
     C                     ENDDO                                                              255811
      *                                                                                       255811
     C           KACCT2    READECLEARL1                  81                                   255811
     C                     ENDDO                                                              255811
     C                     ENDIF                                                              CLE169
      *                                                                                       CLE040
     C                     ENDIF                                                              CLE040
      *                                                                                       CLE025
      ** If facility currency <> Account currency:                                            CLE025
      ** Convert account balances for today and the next 9 working days into                  CLE025
      ** facility currency using the current spot rates                                       CLE025
      *                                                                                       CLE025
     C           FCCY      IFNE GLCCY                                                         CLE025
      *                                                                                       CLE025
      ** Retrieve the spot rates of each of the currency                                      CLE025
      *                                                                                       CLE025
     C********** GLCCY     LOKUPCURR,X                   81                           CLE025 BUG3382
     C********** *IN81     IFEQ *ON                                                   CLE025 BUG3382
     C**********           MOVE MTDV,X    ZMDI1                                       CLE025 BUG3382
     C**********           Z-ADDCSPT,X    ZRATE1                                      CLE025 BUG3382
     C**********           Z-ADDCCDP,X    ZCDPO                                       CLE025 BUG3382
     C**********           ENDIF                                                      CLE025 BUG3382
     C                     MOVE GLCCY     PCURR                                              BUG3382
     C                     EXSR SRCURR                                                       BUG3382
     C                     MOVE A6MDIN    ZMDI1                                              BUG3382
     C                     Z-ADDA6SPRT    ZRATE1                                             BUG3382
     C                     Z-ADDA6NBDP    ZCDPI                                              BUG3382
      *                                                                                       CLE025
     C********** FCCY      LOKUPCURR,X                   81                           CLE025 BUG3382
     C********** *IN81     IFEQ *ON                                                   CLE025 BUG3382
     C**********           MOVE MTDV,X    ZMDI2                                       CLE025 BUG3382
     C**********           Z-ADDCSPT,X    ZRATE2                                      CLE025 BUG3382
     C**********           Z-ADDCCDP,X    ZCDPI                                       CLE025 BUG3382
     C**********           ENDIF                                                      CLE025 BUG3382
     C                     MOVE FCCY      PCURR                                              BUG3382
     C                     EXSR SRCURR                                                       BUG3382
     C                     MOVE A6MDIN    ZMDI2                                              BUG3382
     C                     Z-ADDA6SPRT    ZRATE2                                             BUG3382
     C                     Z-ADDA6NBDP    ZCDPO                                              BUG3382
      *                                                                                       CLE025
     C                     EXSR ZXRATE                                                        CLE025
      *                                                                                       CLE025
     C                     Z-ADDZRATEX    ZEXCH                                               CLE025
     C                     MOVE ZMDIX     ZMD                                                 CLE025
     C                     MOVE GLCCY     ZCCYI                                               CLE025
     C                     MOVE FCCY      ZCCYO                                               CLE025
      *                                                                                       CLE025
      ** Convert to facility currency                                                         CLE025
      *                                                                                       CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C                     Z-ADDACCT,I    ZAMTCI                                              CLE025
     C                     EXSR ZCONV                                                         CLE025
     C                     Z-ADDZAMTCO    ACCT,I                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Process all Account balance amounts                                                  CLE025
      *                                                                                       CLE025
     C                     Z-ADD0         WSCAMD                                             BUG3281
     C                     Z-ADD0         WSFCXO                                             BUG3281
     C                     Z-ADD0         WSCEXP                                             BUG3382
      *                                                                                      BUG3281
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
      *                                                                                       CLE025
      ** Update exposure if account balance is positive                                       CLE025
      *                                                                                       CLE025
     C           ACCT,I    IFGE *ZEROS                                                        CLE025
      *                                                                                       CLE025
     C**********           Z-ADD0         WSCAMD                                      CLE025 BUG3281
     C**********           Z-ADD0         WSFCXO                                      CLE025 BUG3281
     C           I         IFEQ 1                                                             CLE025
     C                     ADD  ACCT,1    CAMD                                                CLE025
     C                     Z-ADDACCT,1    WSCAMD                                              CLE025
     C                     ADD  ACCT,1    CEXP                                               BUG3382
     C                     Z-ADDACCT,1    WSCEXP                                             BUG3382
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ADD  ACCT,I    OAM,I                                               CLE025
     C                     Z-ADDACCT,I    WSOA,I                                              CLE025
      *                                                                                       CLE025
     C                     ELSE                                                               CLE025
      *                                                                                       CLE025
      ** Update offset if account balance is negative                                         CLE025
      *                                                                                       CLE025
     C                     Z-SUBACCT,I    ACCT,I                                              CLE025
      *                                                                                       CLE025
      ** Multiply the weighting percentage                                                    CLE025
      *                                                                                       CLE025
     C           PDPERC    DIV  100       WPERC   32                                          CLE025
     C           WPERC     MULT ACCT,I    ACCT,I                                              CLE025
      *                                                                                       CLE025
     C**********           Z-ADD0         WSFCXO                                      CLE025 BUG3281
     C**********           Z-ADD0         WSCAMD                                      CLE025 BUG3281
     C           I         IFEQ 1                                                             CLE025
     C                     ADD  ACCT,1    FCXCOF                                              CLE025
     C                     Z-ADDACCT,1    WSFCXO                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           FCXO,I    ADD  ACCT,I    FCXO,I                                              CLE025
     C                     Z-ADDACCT,I    WSOF,I                                              CLE025
      *                                                                                       CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
     C           TRCA      IFEQ 'TR'                                                          CLE025
     C                     MOVEL'00AC'    ETYP                                                CLE025
     C                     Z-ADD0         PTYP                                                CLE025
     C                     EXSR SRTRCA                                                        CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      *****************************************************************                       CLE025
      /TITLE SR/SRARY1                                                                        CLE025
      *****************************************************************                       CLE025
      *                                                               *                       CLE025
      *  SRARY1 - Move to Array                                       *                       CLE025
      *                                                               *                       CLE025
      *****************************************************************                       CLE025
     C           SRARY1    BEGSR                                                              CLE025
      *                                                                                       CLE025
     C                     Z-ADD1         Y       20                                          CLE025
     C                     Z-ADD1         J       30                                          CLE025
      *                                                                                       CLE025
     C           Y         DOWLE10                                                            CLE025
     C           13        SUBSTPEXPA:J   EXPC,Y                                              CLE025
     C           13        SUBSTPOFFS:J   OFFC,Y                                              CLE025
     C                     ADD  13        J                                                   CLE025
     C                     ADD  1         Y                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
      ** Move to numeric array                                                                CLE025
      *                                                                                       CLE025
     C                     Z-ADD1         Y                                                   CLE025
     C           Y         DOWLE10                                                            CLE025
     C                     MOVE EXPC,Y    EXPA,Y                                              CLE025
     C                     MOVE OFFC,Y    OFFS,Y                                              CLE025
     C                     ADD  1         Y                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      *****************************************************************                       CLE025
      /TITLE SR/SRARY2                                                                        CLE025
      *****************************************************************                       CLE025
      *                                                               *                       CLE025
      *  SRARY2 - Move to Array                                       *                       CLE025
      *                                                               *                       CLE025
      *****************************************************************                       CLE025
     C           SRARY2    BEGSR                                                              CLE025
      *                                                                                       CLE025
     C                     Z-ADD1         Y                                                   CLE025
     C                     Z-ADD1         J                                                   CLE025
      *                                                                                       CLE025
     C           Y         DOWLE10                                                            CLE025
     C           13        SUBSTPEXPC:J   EXPC,Y                                              CLE025
     C                     ADD  13        J                                                   CLE025
     C                     ADD  1         Y                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
      ** Move to numeric array                                                                CLE025
      *                                                                                       CLE025
     C                     Z-ADD1         Y                                                   CLE025
     C           Y         DOWLE10                                                            CLE025
     C                     MOVE EXPC,Y    EXPA,Y                                              CLE025
     C                     ADD  1         Y                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      *****************************************************************                       CLE025
      /TITLE SR/SRTRCA                                                                        CLE025
      *****************************************************************                       CLE025
      *                                                               *                       CLE025
      *  SRTRCA - Process if facility is a tranche facility           *                       CLE025
      *                                                               *                       CLE025
      *****************************************************************                       CLE025
     C           SRTRCA    BEGSR                                                              CLE025
      *                                                                                       CLE025
      ** Populate fields for PF/LECAUTPD                                                      CLE025
      *                                                                                       CLE025
     C                     EXSR SRMOVE                                                        CLE025
      *                                                                                       CLE025
     C           CACY      IFNE FCCY                                                          CLE025
      *                                                                                       CLE025
     C                     MOVE FCCY      ZCCYI                                               CLE025
     C                     MOVE CACY      ZCCYO                                               CLE025
     C                     MOVE CMDI      ZMD                                                 CLE025
     C                     Z-ADDCAXR      ZEXCH                                               CLE025
      *                                                                                       CLE025
      ** Convert current exposure to CA currency                                              CLE025
      *                                                                                       CLE025
     C                     Z-ADDWSCAMD    ZAMTCI                                              CLE025
     C                     EXSR ZCONV                                                         CLE025
     C                     Z-ADDZAMTCO    CACAMD                                              CLE025
      *                                                                                      BUG3382
     C                     Z-ADDWSCEXP    ZAMTCI                                             BUG3382
     C                     EXSR ZCONV                                                        BUG3382
     C                     Z-ADDZAMTCO    CACEXP                                             BUG3382
      *                                                                                       CLE025
      ** Convert current offset to CA currency                                                CLE025
      *                                                                                       CLE025
     C           ETYP      IFNE '00FM'                                                        CLE025
     C                     Z-ADDWSFCXO    ZAMTCI                                              CLE025
     C                     EXSR ZCONV                                                         CLE025
     C                     Z-ADDZAMTCO    CAXOFC                                              CLE025
     C                     ELSE                                                               CLE025
     C                     Z-ADD0         CAXOFC                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Convert exposure amounts 1 to 10 to CA currency                                      CLE025
      *                                                                                       CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C                     Z-ADDWSOA,I    ZAMTCI                                              CLE025
     C                     EXSR ZCONV                                                         CLE025
     C                     Z-ADDZAMTCO    CAOA,I                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
      ** Convert offset amounts 1 to 10 to CA currency                                        CLE025
      *                                                                                       CLE025
     C           WMGRQ     IFNE 'Y'                                                           CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C                     Z-ADDWSOF,I    ZAMTCI                                              CLE025
     C                     EXSR ZCONV                                                         CLE025
     C                     Z-ADDZAMTCO    CAXO,I                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
     C                     ELSE                                                               CLE025
     C                     MOVE *ALL'0'   CAXO                                                CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
      ** Convert Margin exposure amount 1 to 10 to CA currency                                CLE025
      *                                                                                       CLE025
     C           WMGRQ     IFEQ 'Y'                                                           CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C**********           Z-ADDMARQ,I    ZAMTCI                                      CLE025 BUG3281
     C                     Z-ADDWSMA,I    ZAMTCI                                             BUG3281
     C                     EXSR ZCONV                                                         CLE025
     C                     Z-ADDZAMTCO    CAXM,I                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
     C                     ELSE                                                               CLE025
     C                     MOVE *ALL'0'   CAXM                                                CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ELSE                                                               CLE025
      *                                                                                       CLE025
     C                     Z-ADDWSCAMD    CACAMD                                              CLE025
     C                     Z-ADDWSCEXP    CACEXP                                             BUG3382
      *                                                                                       CLE025
     C           ETYP      IFNE '00FM'                                                        CLE025
     C                     Z-ADDWSFCXO    CAXOFC                                              CLE025
     C                     ELSE                                                               CLE025
     C                     Z-ADD0         CAXOFC                                              CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C                     Z-ADDWSOA,I    CAOA,I                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
      *                                                                                       CLE025
     C           WMGRQ     IFNE 'Y'                                                           CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C                     Z-ADDWSOF,I    CAXO,I                                              CLE025
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
     C                     ELSE                                                               CLE025
     C                     MOVE *ALL'0'   CAXO                                                CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C           WMGRQ     IFEQ 'Y'                                                           CLE025
     C                     Z-ADD1         I                                                   CLE025
     C           I         DOWLT11                                                            CLE025
     C**********           Z-ADDMARQ,I    CAXM,I                                      CLE025 BUG3281
     C                     Z-ADDWSMA,I    CAXM,I                                             BUG3281
     C                     ADD  1         I                                                   CLE025
     C                     ENDDO                                                              CLE025
     C                     ELSE                                                               CLE025
     C                     MOVE *ALL'0'   CAXM                                                CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     WRITELECAUTPF                                                      CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      *****************************************************************                       CLE025
      /TITLE SR/SRPRNT                                                                        CLE025
      *****************************************************************                       CLE025
      *                                                               *                       CLE025
      *  SRPRNT - Print an error report                               *                       CLE025
      *                                                               *                       CLE025
      *****************************************************************                       CLE025
     C           SRPRNT    BEGSR                                                              CLE025
      *                                                                                       CLE025
     C                     MOVE '-'       WDASH1                                              CLE025
     C                     MOVE '-'       WDASH2                                              CLE025
      *                                                                                       CLE025
     C           *IN82     IFEQ *ON                                                           CLE025
     C                     WRITEHEADP1                                                        CLE025
     C                     MOVE *OFF      *IN82                                               CLE025
     C                     ENDIF                                                              CLE025
      *                                                                                       CLE025
     C                     WRITEDETAIL1                                                       CLE025
      *                                                                                       CLE025
     C                     ENDSR                                                              CLE025
      *****************************************************************                       CLE025
      /TITLE SR/SRCURR                                                                       BUG3382
      *****************************************************************                      BUG3382
      *                                                               *                      BUG3382
      *  SRCURR - Access Currency Details                             *                      BUG3382
      *                                                               *                      BUG3382
      *****************************************************************                      BUG3382
     C           SRCURR    BEGSR                                                             BUG3382
      *                                                                                      BUG3382
     C                     MOVE *BLANKS   PRTCD                                             CLE075AF
     C                     Z-ADDCURARR    A                                                 CLE075AF
     C           PCURR     LOKUP#CCY,A                   48                                 CLE075AF
     C           *IN48     IFEQ '1'                                                         CLE075AF
     C           A         OCUR SDCURR                                                      CLE075AF
     C                     ELSE                                                             CLE075AF
     C                     CALL 'AOCURRR0'                                                   BUG3382
     C                     PARM *BLANKS   PRTCD   7                                          BUG3382
     C                     PARM '*KEY   ' POPTN   7                                          BUG3382
     C                     PARM           PCURR   3                                          BUG3382
     C           SDCURR    PARM SDCURR    DSSDY                                              BUG3382
     C                     ENDIF                                                            CLE075AF
      *                                                                                      BUG3382
     C                     ENDSR                                                             BUG3382
      *****************************************************************                       CLE134
      /TITLE SR/AVAIL                                                                         CLE134
      *****************************************************************                       CLE134
      *                                                               *                       CLE134
      *  SRPDCL - Past Due Call Loans                                 *                       CLE134
      *                                                               *                       CLE134
      *  Called By: EVENT                                             *                       CLE134
      *                                                               *                       CLE134
      *  Calls    : NOTHING                                           *                       CLE134
      *                                                               *                       CLE134
      *****************************************************************                       CLE134
      *                                                                                       CLE134
     C           SRPDCL    BEGSR                                                              CLE134
      *                                                                                       CLE134
     C                     MOVE 'N'       WPDCL                                               CLE134
      *                                                                                       CLE134
     C           NEWCOB    IFEQ 'Y'                                                           CLE134
      *                                                                                       CLE134
     C                     MOVELLTYP      WTYP    1                                           CLE134
     C           WTYP      IFEQ 'X'                                                           CLE134
     C           WTYP      OREQ 'Y'                                                           CLE134
     C           WTYP      OREQ 'Z'                                                           CLE134
      *                                                                                       CLE134
      ** Check if Loan generated today                                                        CLE134
      *                                                                                       CLE134
     C           ETP       IFEQ 'V1'                                                          CLE134
     C           KEYPD     CHAINLENEWLL1             88                                       CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C                     MOVE 'Y'       WPDCL                                               CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
      *                                                                                       CLE134
      ** check if a MR or a PI has been created by the PDCL process                           CLE134
      *                                                                                       CLE134
     C                     MOVE *OFF      *IN88                                               CLE134
     C           LNRF      SETLLLELOMKL2                                                      CLE134
     C           *IN88     DOWEQ*OFF                                                          CLE134
     C           LNRF      READELELOMKL2                 88                                   CLE134
     C           *IN88     IFEQ *OFF                                                          CLE134
     C           AMTP      IFEQ 'MR'                                                          CLE134
     C           AMTP      OREQ 'PI'                                                          CLE134
     C                     MOVE 'Y'       WPDCL                                               CLE134
     C                     MOVE *ON       *IN30                                               CLE134
     C                     MOVE *ON       *IN88                                               CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDDO                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDSR                                                              CLE134
      *                                                                                       CLE134
      *****************************************************************                      263840A
      /TITLE SR/SRFAMU                                                                       263840A
      *****************************************************************                      263840A
      *                                                               *                      263840A
      *  SRFAMU - Check value of FAMU for PDCL Loans                  *                      263840A
      *                                                               *                      263840A
      *  Called By: EVENT                                             *                      263840A
      *                                                               *                      263840A
      *  Calls    : NOTHING                                           *                      263840A
      *                                                               *                      263840A
      *****************************************************************                      263840A
      *                                                                                      263840A
     C           SRFAMU    BEGSR                                                             263840A
      *                                                                                      263840A
     C           NEWCOB    IFEQ 'N'                                                          263840A
     C           NEWCOB    OREQ 'Y'                                                          263840A
     C           WPDCL     ANDNE'Y'                                                          263840A
     C                     MOVEL'Y'       PROC    1                                          263840A
      *                                                                                      263840A
      ** Skip EXPSR and AVAIL routines if PDCL is for Interest Only or                       263840A
      ** for a Fee and if FAMU is 'N'.                                                       263840A
      *                                                                                      263840A
     C           CLE134    IFEQ 'Y'                                                          263840A
     C                     MOVEL'D'       WRECI                                              263840A
     C                     MOVELLNRF      WPLON                                              263840A
     C                     MOVEL'I'       WPDCT                                              263840A
     C           KEYPDI    CHAINLEPDUEL6             88                                      263840A
      *                                                                                      263840A
      ** Interest Only.                                                                      263840A
      *                                                                                      263840A
     C           *IN88     IFEQ '0'                                                          263840A
      *                                                                                      263840A
     C           YPFAMU    IFEQ 'N'                                                          263840A
     C                     MOVEL'N'       PROC                                               263840A
     C                     ENDIF                                                             263840A
      *                                                                                      263840A
     C                     ELSE                                                              263840A
     C           KEYPDF    CHAINLEPDUFLA             88                                      263840A
      *                                                                                      263840A
      ** Fee.                                                                                263840A
      *                                                                                      263840A
     C           *IN88     IFEQ '0'                                                          263840A
     C           YPFAMU    ANDEQ'N'                                                          263840A
     C                     MOVEL'N'       PROC                                               263840A
     C                     ENDIF                                                             263840A
      *                                                                                      263840A
     C                     ENDIF                                                             263840A
     C                     ENDIF                                                             263840A
     C                     ENDIF                                                             263840A
      *                                                                                      263840A
     C                     ENDSR                                                             263840A
      *                                                                                      263840A
      *****************************************************************                      BUG3382
      /TITLE SR/*PSSR
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      *  Called By: VARIOUS                                           *
      *                                                               *
      *  Calls:   AUDIT                                               *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      ***  Check to see that *PSSR has not already been called.
      *
     C           WRUN      IFEQ *BLANK                     ***B001
     C                     MOVE 'Y'       WRUN    1
      *
     C                     SETON                     U7U8
     C                     DUMP
     C                     EXSR AUDIT
     C                     END                             ***E001
      *
      ***  If *PSSR already run, then just end the program here.
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/AUDIT
      *****************************************************************
      *                                                               *
      *  AUDIT  - Subroutine to Produce Audit Report and End Program. *
      *                                                               *
      *  Called By: Main Processing, *PSSR                            *
      *                                                               *
      *  Calls:  NOTHING                                              *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR
      *
      ***  Output Report Header
      *
     C                     WRITEHEADAU
     C*
     C                     Z-ADDTOTI1     VLAFFX 150
     C                     Z-ADDTOTD1     VLALFX  30
      *
      ***  If difference in facility file controls output error
      *
     C           VLAF      IFNE TOTI1
     C           VLAL      ORNE TOTD1
     C                     SETON                     85U8  * DIFFERENCE
     C                     END
     C*
     C***  Output 'DIFFERENCE' if counts don't match
     C***  Facility trailer should match records read in
     C*
     C           NOREFC    IFNE COUNT1
     C                     SETON                     86U8  * DIFFERENCE
     C                     END
     C*
     C***  Output 'DIFFERENCE' if counts don't match
     C***  All records read in should have been written
     C*
     C           COUNTF    IFNE COUNT1
     C                     SETON                     87U8  * DIFFERENCE
     C                     END
     C*
     C************LOVAL    SETLLLVENTZZF                                  054108
     C                     READ LVENTZZF                 79
     C*
     C           *IN79     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0491  'DBPGM
     C                     MOVEL'*READ   'DBKEY
     C                     MOVE 'LVENTZZ 'DBFILE           ************
     C                     Z-ADD30        DBASE            * DBERR 30 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
     C**********           Z-ADDNORE      NORELV  50                      105140
     C                     Z-ADDNORE0     NORELV  90                      105140
      *
     C*
     C***  Output 'DIFFERENCE' if counts don't match
     C***  Events trailer should match records read in
     C*
     C                     SETOF                     88                                     AR574425
     C           NORELV    IFNE COUNT2
     C                     SETON                     88U8  * DIFFERENCE
     C                     DUMP
     C                     END
     C*
     C***  Output 'DIFFERENCE' if counts don't match
     C***  Records written plus dummy records should match records read
     C*
     C*                                                                   0077
     C** Dummy records are no longer dropped and should therefore         0077
     C** not be added back for the trailer check                          0077
     C*                                                                   0077
     C***********COUNTL    ADD  COUNTD    COUNTX  50                      0077
     C***********COUNT2    IFNE COUNTX                                    0077
     C***********COUNT2    IFNE COUNTL                               0077 045634
     C***********          SETON                     89U8  * DIFFERENCE   045634
     C***********          END                                            045634
     C*
     C*** Output audit report details
     C*
     C                     WRITECONTROL
      *
      ***  Write to new facility trailer record if an error has not
      ***  occurred.
      *
     C           *INU7     IFEQ '0'
     C           *INU8     ANDEQ'0'
      *
     C                     Z-ADDCOUNT1    NORE
     C                     Z-ADDTOTI1     VLAF
     C                     Z-ADDTOTD1     VLAL
     C                     WRITENFACLZZF
      *
      ***  Write to events file trailer
      *
     C                     MOVE 'T'       RECI
     C**********           Z-ADDCOUNT2    NORE                              0020
     C***********          Z-ADDCOUNTL    NORE                       0020 045634
     C                     Z-ADDTOTI2     HRWN
     C                     Z-ADDTOTD2     HRDC
      *
     C***********          WRITEOLVENTZZ                                  045634
     C*                                                                   054108
     C***  Update hashes on trailer as A1 events not included in hashes   054108
     C*                                                                   054108
     C                     EXCPTLZZ                                       054108
      *
     C                     END
      *
      ***  If there is a DB Error, output
      ***  report.
      *
     C           *INU7     IFEQ '1'                        ***B001
     C                     WRITEDBERROR
     C                     ELSE                            ***X001
      *
      ***  End Program and Return.
      *
     C                     SETON                     LR
     C                     RETRN
      *
     C                     END                             ***E001
      *                                                                                       CLE025
     C           CLE025    IFEQ 'Y'                                                           CLE025
     C           WERROR    IFEQ 'Y'                                                           CLE025
     C                     WRITETRAILP1                                                       CLE025
     C                     ELSE                                                               CLE025
     C                     WRITENODTLS                                                        CLE025
     C                     ENDIF                                                              CLE025
     C                     ENDIF                                                              CLE025
      *
     C                     ENDSR
      *****************************************************************                     CLE075AF
      *                                                               *                     CLE075AF
      *  CHKINS - Check Instrument Codes details to array             *                     CLE075AF
      *                                                               *                     CLE075AF
      *****************************************************************                     CLE075AF
     C           CHKINS    BEGSR                                                            CLE075AF
      *                                                                                     CLE075AF
      ** Reinitialize work fields                                                           CLE075AF
      *                                                                                     CLE075AF
     C                     MOVEL*BLANK    INSIC                                             CLE075AF
     C                     MOVE *OFF      *IN46                                             CLE075AF
      *                                                                                     CLE075AF
      ** Check previous base rate details if it's                                           CLE075AF
      ** same with current details                                                          CLE075AF
      *                                                                                     CLE075AF
     C                     Z-ADDINSPRV    G                                                 CLE075AF
      *                                                                                     CLE075AF
      ** Defend against index being 0                                                       CLE075AF
      ** Set current index to starting index                                                CLE075AF
      *                                                                                     CLE075AF
     C           G         IFEQ 0                                                           CLE075AF
     C                     Z-ADDINSIDX    G                                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
      ** If the KEYINS being checked is the same then use the index                         CLE075AF
      ** of the current detail rather than doing a LOKUP                                    CLE075AF
      *                                                                                     CLE075AF
     C           KEYINS    IFEQ #ISK,G                                                      CLE075AF
     C                     MOVE *ON       *IN46                                             CLE075AF
     C                     ELSE                                                             CLE075AF
      *                                                                                     CLE075AF
     C           INSIDX    IFEQ 0                                                           CLE075AF
     C                     Z-ADD1         G                                                 CLE075AF
     C                     ELSE                                                             CLE075AF
     C                     Z-ADDINSIDX    G                                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C           KEYINS    LOKUP#ISK,G                   46                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
      ** Save the last accessed detail to INSPRV                                            CLE075AF
      ** Set the indicator to show the data was found                                       CLE075AF
      *                                                                                     CLE075AF
     C           *IN46     IFEQ *ON                                                         CLE075AF
     C                     MOVE INSSEQ    #INS,G                                            CLE075AF
     C                     Z-ADDG         INSPRV                                            CLE075AF
     C                     MOVEL'Y'       INSIC                                             CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C                     ENDSR                                                            CLE075AF
      *****************************************************************                     CLE075AF
      *                                                               *                     CLE075AF
      *  ADDINS - Add Instrument Types details to array               *                     CLE075AF
      *                                                               *                     CLE075AF
      *****************************************************************                     CLE075AF
     C           ADDINS    BEGSR                                                            CLE075AF
      *                                                                                     CLE075AF
      ** If there is still room in the array then add the details                           CLE075AF
      *                                                                                     CLE075AF
     C           INSIDX    IFNE 0                                                           CLE075AF
     C                     SUB  1         INSIDX                                            CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C                     MOVELKEYINS    #ISK,G                                            CLE075AF
     C                     ADD  INSSEQ    #INS,G                                            CLE075AF
      *                                                                                     CLE075AF
      ** Set last accessed detail to INSIDX So that CHKINS checks this                      CLE075AF
      ** latest detail first                                                                CLE075AF
      *                                                                                     CLE075AF
     C                     Z-ADDG         INSPRV                                            CLE075AF
      *                                                                                     CLE075AF
     C                     ENDSR                                                            CLE075AF
      *****************************************************************                     CLE075AF
      *                                                               *                     CLE075AF
      *  CHKWEI - Check Weighting Codes details to array              *                     CLE075AF
      *                                                               *                     CLE075AF
      *****************************************************************                     CLE075AF
     C           CHKWEI    BEGSR                                                            CLE075AF
      *                                                                                     CLE075AF
      ** Reinitialize work fields                                                           CLE075AF
      *                                                                                     CLE075AF
     C                     MOVEL*BLANK    WEIIC                                             CLE075AF
     C                     MOVE *OFF      *IN47                                             CLE075AF
      *                                                                                     CLE075AF
      ** Check previous base rate details if it's                                           CLE075AF
      ** same with current details                                                          CLE075AF
      *                                                                                     CLE075AF
     C                     Z-ADDWEIPRV    H                                                 CLE075AF
      *                                                                                     CLE075AF
      ** Defend against index being 0                                                       CLE075AF
      ** Set current index to starting index                                                CLE075AF
      *                                                                                     CLE075AF
     C           H         IFEQ 0                                                           CLE075AF
     C                     Z-ADDWEIIDX    H                                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
      ** If the KEYWEI being checked is the same then use the index                         CLE075AF
      ** of the current detail rather than doing a LOKUP                                    CLE075AF
      *                                                                                     CLE075AF
     C           KEYWEI    IFEQ #WEK,H                                                      CLE075AF
     C                     MOVE *ON       *IN47                                             CLE075AF
     C                     ELSE                                                             CLE075AF
      *                                                                                     CLE075AF
     C           WEIIDX    IFEQ 0                                                           CLE075AF
     C                     Z-ADD1         H                                                 CLE075AF
     C                     ELSE                                                             CLE075AF
     C                     Z-ADDWEIIDX    H                                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C           KEYWEI    LOKUP#WEK,H                   47                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
      ** Save the last accessed detail to WEIPRV                                            CLE075AF
      ** Set the indicator to show the data was found                                       CLE075AF
      *                                                                                     CLE075AF
     C           *IN47     IFEQ *ON                                                         CLE075AF
     C                     MOVE WEISEQ    #WEI,H                                            CLE075AF
     C                     Z-ADDH         WEIPRV                                            CLE075AF
     C                     MOVEL'Y'       WEIIC                                             CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C                     ENDSR                                                            CLE075AF
      *****************************************************************                     CLE075AF
      *                                                               *                     CLE075AF
      *  ADDWEI - Add Weighting Codes details to array                *                     CLE075AF
      *                                                               *                     CLE075AF
      *****************************************************************                     CLE075AF
     C           ADDWEI    BEGSR                                                            CLE075AF
      *                                                                                     CLE075AF
      ** If there is still room in the array then add the details                           CLE075AF
      *                                                                                     CLE075AF
     C           WEIIDX    IFNE 0                                                           CLE075AF
     C                     SUB  1         WEIIDX                                            CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C                     MOVELKEYWEI    #WEK,H                                            CLE075AF
     C                     ADD  WEISEQ    #WEI,H                                            CLE075AF
      *                                                                                     CLE075AF
      ** Set last accessed detail to WEIPRV So that CHKWEI checks this                      CLE075AF
      ** latest detail first                                                                CLE075AF
      *                                                                                     CLE075AF
     C                     Z-ADDH         WEIPRV                                            CLE075AF
      *                                                                                     CLE075AF
     C                     ENDSR                                                            CLE075AF
      *****************************************************************                     CLE075AF
      *                                                               *                     CLE075AF
      *  CHKACD - Check Account Codes details to array                *                     CLE075AF
      *                                                               *                     CLE075AF
      *****************************************************************                     CLE075AF
     C           CHKACD    BEGSR                                                            CLE075AF
      *                                                                                     CLE075AF
      ** Reinitialize work fields                                                           CLE075AF
      *                                                                                     CLE075AF
     C                     MOVEL*BLANK    ACDIC                                             CLE075AF
     C                     MOVE *OFF      *IN48                                             CLE075AF
      *                                                                                     CLE075AF
      ** Check previous base rate details if it's                                           CLE075AF
      ** same with current details                                                          CLE075AF
      *                                                                                     CLE075AF
     C                     Z-ADDACDPRV    P                                                 CLE075AF
      *                                                                                     CLE075AF
      ** Defend against index being 0                                                       CLE075AF
      ** Set current index to starting index                                                CLE075AF
      *                                                                                     CLE075AF
     C           P         IFEQ 0                                                           CLE075AF
     C                     Z-ADDACDIDX    P                                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
      ** If the KEYACD being checked is the same then use the index                         CLE075AF
      ** of the current detail rather than doing a LOKUP                                    CLE075AF
      *                                                                                     CLE075AF
     C           KEYACD    IFEQ #ACK,P                                                      CLE075AF
     C                     MOVE *ON       *IN48                                             CLE075AF
     C                     ELSE                                                             CLE075AF
      *                                                                                     CLE075AF
     C           ACDIDX    IFEQ 0                                                           CLE075AF
     C                     Z-ADD1         P                                                 CLE075AF
     C                     ELSE                                                             CLE075AF
     C                     Z-ADDACDIDX    P                                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C           KEYACD    LOKUP#ACK,P                   48                                 CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
      ** Save the last accessed detail to ACDPRV                                            CLE075AF
      ** Set the indicator to show the data was found                                       CLE075AF
      *                                                                                     CLE075AF
     C           *IN48     IFEQ *ON                                                         CLE075AF
     C                     MOVE ACDSEQ    #ACD,P                                            CLE075AF
     C                     Z-ADDP         ACDPRV                                            CLE075AF
     C                     MOVEL'Y'       ACDIC                                             CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C                     ENDSR                                                            CLE075AF
      *****************************************************************                     CLE075AF
      *                                                               *                     CLE075AF
      *  ADDACD - Add Account Codes details to array                  *                     CLE075AF
      *                                                               *                     CLE075AF
      *****************************************************************                     CLE075AF
     C           ADDACD    BEGSR                                                            CLE075AF
      *                                                                                     CLE075AF
      ** If there is still room in the array then add the details                           CLE075AF
      *                                                                                     CLE075AF
     C           ACDIDX    IFNE 0                                                           CLE075AF
     C                     SUB  1         ACDIDX                                            CLE075AF
     C                     ENDIF                                                            CLE075AF
      *                                                                                     CLE075AF
     C                     MOVELKEYACD    #ACK,P                                            CLE075AF
     C                     ADD  ACDSEQ    #ACD,P                                            CLE075AF
      *                                                                                     CLE075AF
      ** Set last accessed detail to ACDPRV So that CHKACD checks this                      CLE075AF
      ** latest detail first                                                                CLE075AF
      *                                                                                     CLE075AF
     C                     Z-ADDP         ACDPRV                                            CLE075AF
      *                                                                                     CLE075AF
     C                     ENDSR                                                            CLE075AF
      *
     C********************************************************************
      /TITLE SR/ZFWDT
     C/COPY ZSRSRC,ZFWDT
      /TITLE SR/ZACCH
     C/COPY ZSRSRC,ZACCH
      /TITLE SR/ZCONV
     C/COPY ZSRSRC,ZCONVZ1
      ***/TITLE SR/ZXRATEZ1                                               091158
     C***/COPY ZSRSRC,ZXRATEZ1                                            091158
      /TITLE SR/ZXRATEZ1                                                  144712
     C/COPY ZSRSRC,ZXRATEZ1                                               144712
     C*                                                                   S01408
     C/COPY WNCPYSRC,LE0491CCP7                                           S01408
     C*                                                                   S01408
      /TITLE SR/ZHASH
     C/COPY ZSRSRC,ZHASHZ3
     C/COPY ZSRSRC,ZFREQBZ2                                               109148
     C/COPY ZSRSRC,ZCHKH                                                  109148
     C/COPY ZSRSRC,ZDATE1Z2                                               109148
     C/COPY ZSRSRC,ZDATE2Z4                                               109148
     O/TITLE
     OLVENTZZFE                LZZ                                        054108
     O                         HRWN                                       054108
     O                         HRDC                                       054108
     O/COPY WNCPYSRC,LE0491O001
      *
      /EJECT
      ** Add event type 'X2' in TABVAL                                    118870
      ** Add event type 'H1' in TABVAL                                                        CLE028
      ***
**  CPY@
(c) Finastra International Limited 2001
**  TABVAL - TABLE OF VALID EVENT TYPES AFFECTING FCLTY EXPOSURE
V1V3R1M1V5R7X2H1X3                                                                     CLE028 CLE139
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH                                 109148
312831303130313130313031                                                  109148
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                      109148
0366073110961461                                                          109148
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                        109148
000031059090120151181212243273304334365                                   109148
**   ZMNM - MONTHS SHORT NAMES                                            109148
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC                                      109148
