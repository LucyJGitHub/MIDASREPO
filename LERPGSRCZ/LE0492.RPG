     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Fees, bills and telexes extract')             *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Customer Lending Module                              *
     F*                                                               *
     F*  LE0492 - Create Fee Events, Bills & Telexes                  *
     F*                                                               *
     F*  Function: To generate facility and loan fee events to the    *
     F*            customer lending events file as follows:           *
     F*                                                               *
     F*            Calculated fee events if due within the next       *
     F*            15 working days.                                   *
     F*                                                               *
     F*            If BPGEEB on SDCLNPD is Y then generate non-       *
     F*            calculated and loan fee events to end of book;     *
     F*            if 'N' generate events due within the next         *
     F*            30 days.                                           *
     F*                                                               *
     F*            Output fee event bills if they fall due within     *
     F*            the customer billing period & a bill has not       *
     F*            already been sent.                                 *
     F*                                                               *
     F*            Output fee event telexes if they fall due within   *
     F*            the telex notice period & a telex has not already  *
     F*            already been sent.                                 *
     F*                                                               *
     F*            Events processed by this program:                  *
     F*                                                               *
     F*            A1 - Dummy Event                                   *
     F*            V1 - Start Event                                   *
     F*            V3 - Principal Increase                            *
     F*            R1 - Principal Repayment                           *
     F*            M1 - Maturity Event                                *
     F*            I2 - Interest Repayment                            *
     F*            I2 with blank input/output indicator is a          *
     F*            capitalisation event.                              *
     F*                                                               *
     F*            NOTE: In a non-working day accrual run, bills and  *     0039
     F*                  telexes are not produced (The event is still *     0039
     F*                  produced though)                             *     0039
     F*                                                               *     0039
     F*  (COB)                                                        *
     F*                                                               *
     F*  Called By:  LEC0609B - EM LE Events File Update for Fees     *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD055146           Date 04Feb20               *
      *  Prev Amend No. AR674226           Date 04Dec19               *
      *                 MD054101           Date 08Aug19               *
      *                 MD053873           Date 10Jul19               *
      *                 MD052216           Date 04Apr19               *
      *                 MD053295           Date 13Apr19               *
      *                 MD050139           Date 23Mar18               *
      *                 MD051907           Date 12Oct18               *
      *                 MD052071           Date 03Oct18               *
      *                 CLE071             Date 18Jul18               *
      *                 MD048400           Date 02Dec17               *
      *                 MD046248           Date 27Oct17               *
      *                 MD048606           Date 20Nov17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD037658           Date 19Feb16               *
      *                 MD046351           Date 23Aug17               *
      *                 MD045010           Date 05Apr17               *
      *                 CGL184             Date 07Dec16               *
      *                 CLE154             Date 06Aug12               *
      *                 CLE141A            Date 28Apr16               *
      *                 CLE141             Date 08Feb16               *
      *                 MD030700           Date 25Nov14               *
      *                 MD029794           Date 25Nov14               *
      *                 MD029191           Date 25Nov14               *
      *                 MD021155           Date 12Jul13               *
      *                 MD020427           Date 14May13               *
      *                 CLE075AP           Date 06Aug12               *
      *                 AR996895           Date 25Nov12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CER049             Date 06Dec10               *
      *                 AR787620           Date 10Jun11               *
      *                 CLE139             Date 06Dec10               *
      *                 CLE064             Date 06Dec10               *
      *                 CLE073             Date 13May08               *
      *                 262545             Date 19Jun09               *
      *                 263666             Date 01Feb10               *
      *                 259640             Date 02Apr09               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      *                 CER043             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CSC042             Date 16Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 243496B            Date 12Apr07               *
      *                 246141             Date 26Mar07               *
      *                 CAS016             Date 29May07               *
      *                 246018             Date 26Feb07               *
      *                 245803             Date 20Feb07               *
      *                 244804             Date 05Jan07               *
      *                 243496             Date 24Nov06               *
      *                 164847             Date 30Nov06               *
      *                 CRE026             Date 19Feb07               *
      *                 BUG13045           Date 19Jan07               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 243172             Date 09Dec05               *
      *                 242286             Date 26Sep06               *
      *                 240955             Date 11Jul06               *
      *                 239679             Date 06Jun06               *
      *                 212048             Date 06Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 16May06               *
      *                 237636             Date 03Jan06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG11071           Date 04Mar06               *
      *                 CLE042             Date 06Sep05               *
      *                 CLE106             Date 01Aug04               *
      *                 CLE036             Date 22Sep03               *
      *                 CLE038             Date 04Jun04               *
      *                 CAS009             Date 04May04               *
      *                 CSW037A            Date 02May05               *
      *                 CIR013             Date 25Apr05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 BUG3729            Date 21Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 28Oct03               *
      *                 221684             Date 06Oct03               *
      *                 221607             Date 24Sep03               *
      *                 CAP075             Date 08Aug02               *
      *                 218992             Date 10Jul03               *
      *                 218782             Date 23Jun03               *
      *                 CLE034 (+Revision) Date 28May03               *
      *                 217289             Date 05May03               *
      *                 CLE033 (+Revision) Date 26Mar03               *
      *                 CLE031             Date 05Feb03               *
      *                 CAS006             Date 21Jan03               *
      *                 CAS005             Date 16Dec02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 204452             Date 02May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 200289             Date 19Nov01               *
      *                 195748             Date 10Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 199588             Date 31Oct01               *
      *                 151104             Date 15Jun01               *
      *                 CLE014             Date 20Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE013             Date 06Nov00               *
      *                 CLE011             Date 07Nov00               *
      *                 162343             Date 14Dec00               *
      * Midas DBA 3.04 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 163486             Date 14Oct99               *
      *                 CLE009             Date 14Jun99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 157096             DATE 09Jun99               *
      *                 157283             Date 26Mar99               *
      *                 154799             Date 03Mar99               *
      *                 152166             Date 03Mar99               *
      *                 141453             Date 17Feb99               *
      *                 160659             Date 12May99               *
      *                 133888             Date 16JUN98               *
     F*                 CEU004             Date 02Feb98               *
     F*                 CLE007             Date 22May97               *
     F*                 CLE005             Date 22May97               *
     F*                 127966             Date 13Oct97               *
     F*                 CLE004             Date 02Dec96               *
     F*                 105140             DATE 18NOV96               *
     F*                 S01408             DATE 06SEP96               *
     F*                 103020             DATE 22MAY96               *
     F*                 101931             DATE 22MAY96               *
     F*                 101857             DATE 22MAY96               *
     F*                 101322             DATE 22MAY96               *
     F*                 100517             DATE 22MAY96               *
     F*                 100518             DATE 22MAY96               *
     F*                 100523             DATE 22MAY96               *
     F*                 100515             DATE 22MAY96               *
     F*                 060308             DATE 16OCT95               *
     F*                 S01408             DATE 25JUL95               *
     F*                 S01518             DATE 03OCT94               *
     F*                 S01434             DATE 07FEB94               *
     F*                 052445             DATE 27APR93               *
     F*                 045634             DATE 26APR93               *
     F*                 E45727             DATE 20NOV92               *
     F*                 BH3528             DATE 14SEP92               *
     F*                 BH3493             DATE 04SEP92               *
     F*                 BH3461             DATE 04AUG92               *
     F*                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD055146 - Failed MXC004802 seq. 00001 and others            *
      *             Increase Branches to 900.                         *
      *  AR674226 - Manual transaction reached 999. Increase the size *
      *             of utilisation sequence no. and transaction       *
      *             sequence. (Child: AR674227)                       *
      *           - Applied for MD054782.                             *
      *  MD054101 - When loan fee and CLE141 is ON, access CLOAN to   *
      *             ensure that correct currency/location combination *
      *             was used in holiday checking.                     *
      *  MD053873 - Set fee currency as first basis for checking      *
      *             currency holiday setup. Then, use settlement      *
      *             currency when CLE031 is ON and value is not blank *
      *  MD052216 - Lending Fee's Payment Due and Taken Day           *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD051907 - Duplicate posting of event in LVENTEL for Fee     *
      *  MD052071 - SR/SRFAMU was removed during CLE071 incorp.       *
      *             Restored the subroutine.                          *
      *  CLE071 - Value Dating of Rate Changes to Fees                *
      *  MD048400 - LE: Incorrect COB generated projection            *
      *             for the fee on payment date                       *
      *  MD046248 - Finastra Rebranding                               *
      *  MD048606 - Looping COB Component - LEC0609B seq 00001        *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  MD037658 - Define NDAYS/WDAYS w/decimal to cater calc basis 6*
      *  MD046351 - Rounding and truncation in fee accrual            *
      *             calculations due to mult/div using 15,9 fields    *
      *             being placed into 13,0/15,0 result fields.        *
      *  MD045010 - Component LEC06A 10008 looping during COB caused  *
      *             by CGL184. Recompile due to changes in ZFRQB3.    *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  CLE154 - Loan Repayment Schedule Enhancement (Recompile)     *
      *  CLE141A - CLE141 Change Control 1                            *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           for LE Transactions                                 *
      *  MD030700 - Also produce Fee advices and Telex for Bullet     *
      *             fees and other backdated fees entered today and   *
      *             has already matured. Also consider fees whose     *
      *             NPYD are changed to today or the past.            *
      *  MD029794 - Missing Fee Advice for a calculated facility fee  *
      *           - Calculate billing date based on bank's next       *
      *             working day if billing days falls on a holiday.   *
      *             Applied part of fix AR946860.                     *
      *  MD029191 - Missing Lending Loan Fee Advices for loan upfront *
      *             fees. Allow execution of CBILL for fees with      *
      *             FEPYON 'S' and fee entered today.                 *
      *  MD020427 - COB Restruture Phase 1 Remnants                   *
      *           - Change does not work fro Credit Agrerements       *
      *  MD020427 - A8CMCD was not moved to CMPYM field after READ.   *
      *  CLE075AP - COB Restructure - LE COB Optimisation Phase 1     *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  CER049 - Stamp Tax                                           *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,LEH00374                                 *
      *             WNCPYSRC,LEH00375                                 *
      *             WNCPYSRC,LEH00377                                 *
      *             WNCPYSRC,LEH00376                                 *
      *  CLE139 - Lending Fee Capitalisation (Recompile)              *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  CLE073 - Calculated Loan Based Fees                          *
      *  262545 - Reduce cob run time when IAS active                 *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  259640 - Generate events extract for live fees only.         *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CER043 - German Features LF041-00 New Fields and Defaulting  *
      *           (Recompile)                                         *
      *  CSC042 - COB Performance fix. Pgm builds arrays of ccy dtls  *
      *           in first cycle and then ignores this and calls      *
      *           AOCURRR* repeatedly. Expand the arrays to include   *
      *           some additional data and remove calls to AOCURRR*   *
      *  243496B- Reinstated fix 243496.                              *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  CAS016 - IAS18 EIR Recalculation (Fee Amortisation Over      *
      *           Whole Period) -Recompile.                           *
      *  246018 - Divide by zero error.                               *
      *  245803 - Reverse fix 243496.                                 *
      *  244804 - Populate IN/OUT indicator based on the type of      *
      *           participation.                                      *
      *  243496 - Fee amount in Financial Loans Diary should only     *
      *           include fee due for the period, should not include  *
      *           past due amount. Applied 199724.                    *
      *         - Use the Fee Adjustment Amount FEAMTA from PF/LEFEAM *
      *           Applied 216123 (plus re-open & 221326 correction).  *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  CRE026  - Consumer Banking                                   *
      *  BUG13045 - Duplicate cashflow is generated on the current    *
      *             'next payment date' for recurring fees (CAS009).  *
      *             This is causing the incorrect calculation of      *
      *             EIR and total fees to be amortised.               *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  243172 - Invalid timestamp (blanks)                          *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  240955 - Timestamp(STMP) from LEFEED file needs to be moved  *
      *           TMST of PF/LETLXDK for loan fees.                   *
      *           Applied fix 237636                                  *
      *  239679 - High order truncation in DELSC causes FCooB in      *
      *           LE0570.                                             *
      *  212048 - If calc method 6 then INT6DY contains the number    *
      *           of days from ZINTDY.                                *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A - Change Customer Number to alpha; post-103 build.   *
      *  237636 - Timestamp(STMP) from LEFEED file needs to be moved  *
      *           TMST of PF/LETLXDK for loan fees.                   *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG11071- Issued Update or Delete prior without prior Read.  *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CLE106 - Syndications Manager.                               *
      *  CLE036 - Lending Enhancements for Nordea Phase 1 Priority 2: *
      *           Allow repayments in facility currency (Recompile)   *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  BUG3729 - Do not process records with RECI='R' or '*'.       *
      *            Applied fix 224932.                                *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGl029 - Increase Account Code to 10 digits                  *
      *  222373 - Parameter Mismatch                                  *
      *  221684 - Ensure Settle in another currency flag is set off   *
      *           initially                                           *
      *  221607 - If settling in another currency and CLE031 is on    *
      *           then the pay settlement currency could be set up    *
      *           and not the receive settlement currency.            *
      *  CAP075 - Lending API enhancements - Loan Amendment.          *
      *           (amendment in common with CAP079)                   *
      *  218992 - For non calculated fees paying on Next, use the     *
      *           last payment date as LER130 will have moved the     *
      *           next payment date forward                           *
      *           Do not produce interbranch events for settlement    *
      *           method 09                                           *
      *           Always produce events for facility fees regardless  *
      *           of whether a settlement currency has been defined   *
      *           Check on system value was checking SETP for method  *
      *           09, but this field is not set up at this time       *
      *           Let AOSTALR1 check for the system value when called *
      *           for telex notice days                               *
      *  218782 - Check system value Settlement09Postings to decide   *
      *           whether to use Settlement or Transaction Ccy.       *
      *  CLE034 - Lending Enhancements Phase 1 Priority 1A            *
      *         - Logically deleted records should be excluded        *
      *  217289 - Settlement method 09 - booking branch fix           *
      *  CLE033 - Settlement method 09                                *
      *         - (REVISION) If settlement method 09, OSBR is always  *
      *           equal to booking branch                             *
      *  CLE031 - Lending Enhancements.                               *
      *  CAS006 - Hedge Accounting Phase B (Recompile)                *
      *  CAS005 - Enhancements to CAS001, CAS002 and CAS004           *
      *           (Recompile)                                         *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *           (Recompile)                                         *
      *  204452 - Recompiled due to changed PF/LEFEED.                *
      *  200289 - Increase facility sequence number in FACHISA from   *
      *           2 to 3.
      *  195748 - Divide by zero error. CFAMT is zero.                *
      *           Instead of populating CFAMT with TFAM, use WRKAR2   *
      *           which is the current facility amount. This will     *
      *           prevent divide by zero error and incorrect fee      *
      *           calculation for non-revolving facility.             *
      *  199588 - Facility history should use fixed rate.             *
      *           Reverse fix 162343 so that fixed FCXR rate is used  *
      *           when converting from loan currency to facility ccy. *
      *  151104 - Increase size of branch code & related array so that*
      *           it can hold up to 900 elements.                     *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *  CLE013 - Customer Lending Fees Enhancements - Phase I        *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
      *  162343 - When converting the principal of loan to facility   *
      *           currency use the current spot rate instead of using *
      *           the facility exchange rate from loan details. Thus, *
      *           reverse fix 101857.                                 *
      *  163486 - Recompiled due to changes in LVNTS.                 *
     F*  CLE009 - Customer Lending Enhancements - SWIFT Message       *
     F*           Generation for fees                                 *
      *  157096 - Array index is not valid in year 2000 testing.      *
      *           (Apply fix 147457)                                  *
     F*  157283 - Do not include overdue fees in Events amount        *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  152166 - Fees calculated as 2 days to next due date when it  *
      *           should be 1.                                        *
      *  141453 - Recompiled due to changes in PF/LEFEED              *
     F*  160659 - If CEU004 is on, use settlement currency for events *
     F*           generation in RSACMTPD. Output as well settlement   *
     F*           currency details in facility fee bills/telex file   *
     F*  133888 - Remove fix 101322.  No need to add/sub 1 to/from    *
     F*           the no. of days to be calculated for fee payment.   *
     F*           The Last Day Indicator should only be considered    *
     F*           for accruals and not for the actual amounts to      *
     F*           be paid.                                            *
      *  CEU004 - LE Settlement Ccy conversion Upgrade to DBA R2.0    *
     F*  CLE007 - Customer Lending Enhancements - Others (T3)         *
     F*  CLE005 - Customer Lending Enhancements - Others (T3)         *
     F*  127966 - Profit Centre Accounting Development:               *
     F*           Recompiled due to changes in LEFEEDL1               *
     F*  CLE004 - Customer Lending Enhancements - Syndication         *
     F*  105140 - Recompile over changed LVENTZZ.                     *
     F*           Field NORE attribute changed.                       *
     F*  S01408 - Core hook LE0492CCP1 added                          *
     F*           Core hook LE0492CCP2 added                          *
     F*           Core hook LE0492CCP3 added                          *
     F*           Core hook LE0492CCP4 added                          *
     F*           Core hook LE0492EEP1 added                          *
     F*           Core hook LE0492FFP1 added                          *
     F*           Core hook LE0492IIP1 added                          *
     F*  103020 - Calculated fee due amount is incorrect for fees     *
     F*           using threshold rates whenever the rate used is     *
     F*           the last in the rate array. Checking should be the  *
     F*           same as in LER135.                                  *
     F*  101931 - Also use the fee end date when selecting the fees   *
     F*           to be process so that fee events will not be missed *
     F*           for fees due on a holiday.                          *
     F*  101857 - When converting the principal of loan to facility   *
     F*           currency use the facility exchange rate from loan   *
     F*           details instead of using the latest exchange rate.  *
     F*  101322 - Take Accrue on Last Day indicator into account      *
     F*           when calculating the fee due amount.                *
     F*  100517 - Incorrect amount in the Facility Fee Due reported   *
     F*           in the Financial Loans Diary for calculated fees    *
     F*           with facility currency falling on a holiday.        *
     F*           Pattern fix from 094271. Additional processing      *
     F*           is added in the post control date processing.       *
     F*  100518 - Previously settled amount is included in fee due    *
     F*           amount.                                             *
     F*  100523 - Fee exchange rate is not being used for conversion. *
     F*  100515 - Recompile program due to changes in LEFEED.         *
     F*  060308  -  Ensure that the correct facility currency (FCCY)  *
     F*             is output to LVENTEL to show a correct Financial  *
     F*             Loans Diary Report.                               *
     F*  S01408 - Core hook LE0492CPG1 added                          *
     F*  S01518 - BLI Lending SWIFT Enhancements.                     *
     F*           Recompiled over amended PF/LOAMSDK whose format is  *
     F*           used by PF/LETLXDK.                                 *
     F*  S01434  - Recompiled for change to ZFWDT subroutine.         *
     F*  052445  -  No events on LVENTEL as nothing is drawn against  *
     F*             the facility. This messes up the fee calculation  *
     F*             for post-control date part. If no events, use     *
     F*             last pre-control date FACHISA record and FCLTY as *
     F*             base for post-control date calculations.          *
     F*  045634  -  Update ONLINE POSITIONS                           *
     F*             Events generation corrections and OUTPUT          *
     F*  E45727  -  Dodgy output on LE0520 traced back to here. If    *
     F*             end date of fee is before control date, and the   *
     F*             only record on FACHSAL1 is the FS record, then the*
     F*             event amount for LVENTEL and CFTLXPR is calculated*
     F*             as zero.                                          *
     F*             Furthermore, a next payment and an end date telex *
     F*             are output on day before end date. End Date only  *
     F*             now.                                              *
     F*             Also, pass the fee sequence to CFTLXPR to pass to *
     F*             LE0430.                                           *
     F*  BH3528  -  Event details still not output correctly.         *
     F*             And missing a bullet fee on events.               *
     F*             And fee amounts are rubbish as *IN19 is not       *
     F*             initialised for each facility, so SR/UFAMT is not *
     F*             doing the right thing.                            *
     F*  BH3493  -  Output parent details to correct fields on        *
     F*             PF/LVENTEL.                                       *
     F*  BH3461  -  If no records in CUTX1 and LETLX headers and      *
     F*             trailers, output some....                         *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*****************************************************************
     FLEFEEDL1UF  E           K        DISK         KINFSR *PSSR
     F****FCUPD***IF**E***********K********DISK************************     0025
     F/COPY WNCPYSRC,LE0492FFP1                                           S01408
     FFCLTY   IF  E           K        DISK                                 0025
     FFCLTYL0 IF  E           K        DISK                               060308
     F            FCLTYFMF                          KRENAMEFCLTYL0F       060308
     FCLOANL3 IF  E           K        DISK                               060308
     F            CLOANCLF                          KRENAMECLOANL3F       060308
     F****LVENT***IF**E***********K********DISK**********************A*     0076
     F*LVENT***UF  E           K        DISK                      A  0076 045634
     FLVNTS   IF  E           K        DISK                               045634
     F            LVENTHHF                          KIGNORE
     F*********** LVENTZZF                          KIGNORE               045634
     FFACHSAL1IF  E           K        DISK
     FFACHISH IF  E           K        DISK
     FLEFEEQL0IF  E           K        DISK                                                   CER049
     F****LEFEEDL2IF**E***********K********DISK************************     0068
     FLEFEEDL2UF  E           K        DISK                                 0068
     F            LEFEEDF                           KRENAMELEFEED2
     F********SDCURRPDIF  E                    DISK                                           CSC042
     FSDCURRPDIF  E                    DISK                           UC                      CSC042
     FSDBRCHPDIF  E                    DISK
     FLEFERCL3IF  E           K        DISK                                                   CLE071
     FSDCTRYL1IF  E           K        DISK                                                 CLE075AP
     F*LVENTZZ*UF  E                    DISK         KINFSR *PSSR         045634
     FLVENTHH O   E                    DISK         KINFSR *PSSR          045634
     ***  Output to events file to include fee events                     045634
     F            LVENTHHF                          KRENAMEOLVENTHH       045634
     FLVENTEL O   E                    DISK         KINFSR *PSSR          045634
     F            LVENTELF                          KRENAMEOLVENTEL       045634
     FLVENTZZ O   E                    DISK         KINFSR *PSSR          045634
     F            LVENTZZF                          KRENAMEOLVENTZZ
     FCUTX1HH IF  E                    DISK         KINFSR *PSSR A        BH3461
     FCUTX1HP O   E                    DISK         KINFSR *PSSR
     ***  Output of customer bill/telex file for loan based fees
     F**CUTX1ZX*UF**E********************DISK         KINFSR *PSSR        BH3461
     FCUTX1ZX UF  E                    DISK         KINFSR *PSSR A        BH3461
     FCUTX2HH O   E                    DISK         KINFSR *PSSR
     ***  Output of customer bill/telex file for facility based fees
     FCUTX2HP O   E                    DISK         KINFSR *PSSR
     FCUTX2ZX O   E                    DISK         KINFSR *PSSR
     FLETLXHH IF  E                    DISK         KINFSR *PSSR A        BH3461
     FLETLXDK O   E                    DISK         KINFSR *PSSR
     ***  Outate of pay/receive file for loan based fees
     F            LOAMSDKF                          KRENAMELETLXDKF
     F**LETLXZX*UF**E********************DISK         KINFSR *PSSR        BH3461
     FLETLXZX UF  E                    DISK         KINFSR *PSSR A        BH3461
     F            LOAMSZ1F                          KRENAMELETLXZXF
     FCFTLXHH O   E                    DISK         KINFSR *PSSR
     ***  Output to pay/receive file for facility based fees
     F            LETX1HHF                          KRENAMEOCFTLXHH
     FCFTLXPR O   E                    DISK         KINFSR *PSSR
     F            LETX1PRF                          KRENAMEOCFTLXPR
     FCFTLXZZ O   E                    DISK         KINFSR *PSSR
     F            LETX1ZZF                          KRENAMEOCFTLXZZ
     FLECAFEL0UF  E           K        DISK         KINFSR *PSSR A        CLE014
     FLE0480PDIF  E           K        DISK                                                   262545
      *
     F****LE0490AUO***E********************PRINTER**********OOOPS******     0030
     FLEFEAM  IF  E           K        DISK                                                  243496B
      *                                                                                      243496B
      *                                                                                       CLE073
     FCLOAN   IF  E           K        DISK                                                   CLE073
     F            CLOANHHF                          KIGNORE                                   CLE073
     F            CLOANZ1F                          KIGNORE                                   CLE073
     FLEHISTLAIF  E           K        DISK                                                   CLE073
     FLEHISTLBIF  E           K        DISK                                                   CLE073
     FLEPDUFL1IF  E           K        DISK                                                   CLE134
      *                                                                                       CLE073
     FLEPDUEL6IF  E           K        DISK                                                 MD048400
     F            LEPDUED0                          KRENAMELEPDUED1                         MD048400
     FLEPDUFLAIF  E           K        DISK                                                 MD048400
     F            LEPDUFD0                          KRENAMELEPDUFD1                         MD048400
     FLE0492AUO   E                    PRINTER                              0030
     ***  Audit report
     FLKYFEDL0IF  E           K        DISK                                                 MD030700
     FLEFEDNL0IF  E           K        DISK                                                 MD030700
      *
     F/EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*    01  - Currency array set up                                *
     F*    02  - Branch internal number array set up                  *
     F*    03  - Read of updated facilities file                      *
     F*    04  - Read of loan events file                             *
     F*    05  - Interbranch participation                            *
     F*    06  - Event type I2 with blank input/output indicator      *
     F*    07  - Valid event                                          *
     F*    08  - Chain to LEFEEDL1                                    *
     F*    09  - LOKUP of CDAT array                                  *
     F*    10  - Read of Facility Amounts file                        *
     F*    13  - LOKUP of CURR array for from currency                *
     F*    14  - LOKUP of CURR array for to currency                  *
     F*    15  - LOKUP of TABCAL array                                *
     F*    16  - LOKUP of FPC array                                   *
     F*    17  - LOKUP of FPC array                                   *
     F*    17  - READP to facility amounts file                       *
     F*    18  - Read of Facility History Header file                 *
     F*    19  - Read of trailer files - CUTX1ZX and LETLXZX          *
     F*    20  - Trailer missing                                      *
     F*    21  - Header missing                                       *   BH3461
     F*****23**-*Loan*details*not*found****************************101857 162343
      *    24  - Read of Credit Agreements extract file               *   CLE014
      *    30  - Read Files for Full Cache                            *                     CLE075AP
      *    44  - Cache Hit for SDNOSTPD                               *                     CLE075AP
      *    45  - Cache Hit for LESTALPD (AOSTALR1)                    *                     CLE075AP
      *    46  - Cache Hit for LESTALPD (AOSTALR2)                    *                     CLE075AP
      *    48  - Cache Hit for Full Caches                            *                     CLE075AP
      *    55  - Read of Fee Detail Extension File                    *                     MD052216
     F*                                                               *
     F*    U3  - Accrual for non-working day                          *     0039
     F*                                                               *     0039
     F*  U7+U8 - Database Error                                       *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  INIT   - Program Initialisation                              *
     F*  PROCES - Detail Processing                                   *
     F*  EVENT  - Event Processing
     F*  FEES   - Facility & loan fee processing                      *
     F*  ACCRUE - Accrual amount calculation                          *
     F*  NONCAL - Processing for non-calculated & loan fees due       *
     F*           this run                                            *
     F*  CALFEE - Processing for calculated fees due this run         *
     F*  FEEPAY - Fee payment event                                   *
     F*  SETLOC - Obtain settlement location details                  *
     F*  CONV   - Currency conversion                                 *
     F*  CALCSR - Calculation processing                              *
     F*  UFAMT  - Update of facility amount array                     *
     F*  RTLX   - Output to pay/receive telex files                   *
     F*  CBILL  - Output to customer/bill telex files                 *
     F*  LSTRAT - Last rate processing                                *
     F*  SRMOVE - Subroutine to save the trance/loan/event details    *   CLE014
     F*  SRPROC - Processing for the Credit Agreement                 *   CLE014
     F*  *PSSR  - Program Error Processing Subroutine                 *
     F*  AUDIT  - Produce Audit Report and End Program                *
     F*  LETLFM - Format of output to loan pay/receive telex file     *
     F*  CFTLFM - Format of output to facility pay/receive telex file *
     F*  CUT1FM - Format of output to loans bills/telex file          *
     F*  CUT2FM - Format of output to facility bills/telex file       *
     F*  ZXRATE - Access Holidays for Currency/Location               *
     F*  ZCONV  - Convert Amount to Another Currency                  *
     F*  ZFWDT  - Obtain day number for n working days forward        *
     F*  ZACCH  - Access a holiday record for a particular currency   *
     F*           and (optional) location.                            *
     F*  ZHASH  - Hash totalling processing                           *
      *  CHKNOS - Check Nostro details in array                       *                     CLE075AP
      *  ADDNOS - Add Nostro details in array                         *                     CLE075AP
      *  CHKSET - Check Settlement Allocation details in array        *                     CLE075AP
      *  ADDSET - Add Settlement Allocation details in array          *                     CLE075AP
      *  CHKSA2 - Check Settlement Allocation (AOSTALR2)              *                     CLE075AP
      *  ADDSA2 - Add Settlement Allocation (AOSTALR2)                *                     CLE075AP
     F*                                                               *
     F*****************************************************************
     E/EJECT
     E                    CPY@    1   1 80               COPYRIGHT
     E                    TABVAL  4   4  2               VALID EVENT TYPES
     E                    TABCAL  6   6  1 0 TABCBS  5 0 CALC.BASES
     E                    POWER   1   7  7 3             POWER ARRAY
     E/COPY ZSRSRC,ZDATE9Z1                                               CLE013
     E/COPY ZSRSRC,ZFREQBZ1                                                                   CAS009
     E/COPY ZSRSRC,ZDATE2Z1                                                                   CAS009
     E                    FEEM        5 11 0A            FEE AMOUNTS
     E                    FAM         5 15 0A            FEE AMOUNTS
     E                    FRT         5  7 5A            FEE RATES
     E                    FPC         5  6 3A            FEE PERCENTAGE
     E                    CURR      150  3               ALL CCYS
     E                    CSPT      150 13 8             SPOT RATES/CCY
     E                    MTDV      150  1               M/D INDICATOR/CCY
     E                    CCDP      150  1 0             DEC PLACES/CCY
     E                    CCNO      150  2 0             SORT SEQ.NO/CCY
     E                    TXDY      150  1 0             Telex Notice Days                    CSC042
     E                    INCY      150  1               In CCY ind                           CSC042
     E***********         BCA       150  6               BRCH INT. CUST   151104
     E**********          BCA       900  6               BRCH INT. CUST              151104 MD055146
     E                    BCA       999  6               BRCH INT. CUST                     MD055146
     E***********         CDAT       15  5 0             FUTURE DATES     045634
     E                    CDAT       15  5 0A            FUTURE DATES     045634
     E                    FFAM       15 13 0A            FUTURE FACILITY AMTS
     E                    FTOD       15 13 0A            FUTURE TOTAL DRAWN
     E                    TDAT       99  5 0A            FUT. HDAY/WRKDY  100517
     E                    TFAM       99 13 0A            FUT. FCLTY AMTS  100517
     E                    TTOD       99 13 0A            FUT. TOTAL DRAW  100517
     E                    INT         6 15 0             ZHASH INTEGERS
     E                    DEC         6  3 0             ZHASH DECIMALS
     E**********          #BCH      900  3               Branch Codes Array        CLE075AP MD055146
     E                    #BCH      999  3               Branch Codes Array                 MD055146
     E                    #CTY      400  2               Country Codes Array                CLE075AP
     E                    #NOS      200 13 0             Settlement Allocations Array       CLE075AP
     E                    #NSS      200 13 0             Settlement Allocations Sorted      CLE075AP
     E                    #NSK      200  5               Settlement Allocations Cache Key   CLE075AP
     E                    #SET      100 13 0             Settlement Allocations Array       CLE075AP
     E                    #SES      100 13 0             Settlement Allocations Sorted      CLE075AP
     E                    #SEK      100 25               Settlement Allocations Cache Key   CLE075AP
     E                    #SA2      100 13 0             Settlement Allocations Array       CLE075AP
     E                    #SAS      100 13 0             Settlement Allocations Sorted      CLE075AP
     E                    #SAK      100 20               Settlement Allocations Cache Key   CLE075AP
     E                    #XND      100  5 0             AOSTALR1 Return Value              CLE075AP
     E                    AKY        14  1                                                  MD030700
     E                    WFEM        5 11 0A                                                 CLE071
     E                    WFRT        5  7 5A                                                 CLE071
     E                    FCAM        5 11 0A                                                 CLE071
     E                    FCRT        5  7 5A                                                 CLE071
      *
     E/COPY ZSRSRC,ZHOLE
     E/COPY WNCPYSRC,LE0492EEP1                                           S01408
     E*                                                                   CLE033
     E**  System values array                                             CLE033
     E************        SVAL    1   2 20                                              CLE033218782
     E                    SVAL    1   3 20                                                    218782
     E*                                                                   CLE033
      *
     I/EJECT
     I*                                                                   060308
     I**  Redefine some fields of LF/FCLTYL0 to avoid overlap of values   060308
     I*                                                                   060308
     IFCLTYL0F                                                            060308
     I              CNUM                            CNUML0                060308
     I              FACT                            FACTL0                060308
     I              FCNO                            FCNOL0                060308
     I              FCCY                            FCCYL0                060308
     I*                                                                   060308
     I**  Redefine some fields of LF/CLOANL3 to avoid overlap of values   060308
     I*                                                                   060308
     ICLOANL3F                                                            060308
     I              LNRF                            LNRFL3                060308
     I              FCUS                            FCUSL3                060308
     I              FTYP                            FTYPL3                060308
     I              FSEQ                            FSEQL3                060308
     I              LTYP                            LTYPL3                060308
     I              SUTP                            SUTPL3                060308
     I/COPY WNCPYSRC,LE0492I002
     I***********   FCXR                            FCXRL3         101857 162343
     I***********   FMDI                            FMDIL3         101857 162343
     I              FCXR                            FCXRL3                                    199588
     I              FMDI                            FMDIL3                                    199588
     I              CLAS                            CLASL3                                    CLE042
     I/COPY WNCPYSRC,LE0492I003
      *
     ILETLXZXF
      **  Redefined number of records on file field
     I              NORE                            NORE1
      *
     ICUTX1ZXF
      **  Redefined number of records on file field
     I              NORE                            NORE2
      *                                                                                       CLE071
     ILEFHSTF                                                                                 CLE071
     I              HIFRT1                          FCFRT1                                    CLE071
     I              HIFRT2                          FCFRT2                                    CLE071
     I              HIFRT3                          FCFRT3                                    CLE071
     I              HIFRT4                          FCFRT4                                    CLE071
     I              HIFRT5                          FCFRT5                                    CLE071
     I              HIAMT1                          FCAMT1                                    CLE071
     I              HIAMT2                          FCAMT2                                    CLE071
     I              HIAMT3                          FCAMT3                                    CLE071
     I              HIAMT4                          FCAMT4                                    CLE071
     I              HIAMT5                          FCAMT5                                    CLE071
     I              HIPIND                          FCPIND                                    CLE071
     I              HIRCVD                          FCRCVD                                    CLE071
      *                                                                                       CLE071
     ILEPDUFD0                                                                                CLE134
      *                                                                                       CLE134
      ** Rename fields                                                                        CLE134
      *                                                                                       CLE134
     I              YTKPACL                         YTKPAC                                    CLE134
     I              YTKPABR                         YTKPAB                                    CLE134
     I              YTKPAAC                         YTKPAA                                    CLE134
     I              YTKPASE                         YTKPAS                                    CLE134
     I              YTKPACY                         YTKPCY                                    CLE134
      *                                                                                       CLE073
     ICLOANCLF                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIL                                     CLE073
     I              FTYP                            FTYPL                                     CLE073
     I              FSEQ                            FSEQL                                     CLE073
     I              CCY                             CCYL                                      CLE073
     I              LNRF                            LNRFL                                     CLE073
     I              PTYP                            PTYPL                                     CLE073
     I              RCDT                            RCDTL                                     CLE073
     I              MRIN                            MRINL                                     CLE073
     I              CNUM                            CNUML                                     CLE073
     I              BRCA                            BRCAL                                     CLE073
     I              LTYP                            LTYPL                                     CLE073
     I              SUTP                            SUTPL                                     CLE073
     I              DDAT                            DDATL                                     CLE073
     I              VDAT                            VDATL                                     CLE073
     I              MDAT                            MDATL                                     CLE073
     I              LASQ                            LASQL                                     CLE073
     I              FCUS                            FCUSL                                     CLE073
     I              CPAM                            CPAML                                     CLE073
     I              INTC                            INTCL                                     CLE073
     I              INTR                            INTRL                                     CLE073
     I              BRTT                            BRTTL                                     CLE073
     I              BRTE                            BRTEL                                     CLE073
     I              RTSP                            RTSPL                                     CLE073
     I              MARG                            MARGL                                     CLE073
     I              SPIN                            SPINL                                     CLE073
     I              CHIN                            CHINL                                     CLE073
     I              WTRT                            WTRTL                                     CLE073
     I              WTIN                            WTINL                                     CLE073
     I              REPT                            REPTL                                     CLE073
     I              RAMT                            RAMTL                                     CLE073
     I              NRPD                            NRPDL                                     CLE073
     I              RFRQ                            RFRQL                                     CLE073
     I              RDYN                            RDYNL                                     CLE073
     I              FCCY                            FCCYL                                     CLE073
     I              LIND                            LINDL                                     CLE073
     I              CRSK                            CRSKL                                     CLE073
     I              ACOF                            ACOFL                                     CLE073
     I              NACD                            NACDL                                     CLE073
     I              RELI                            RELIL                                     CLE073
     I              AUTO                            AUTOL                                     CLE073
     I              PSAM                            PSAML                                     CLE073
     I              BCXR                            BCXRL                                     CLE073
     I              FCXR                            FCXRL                                     CLE073
     I              SDST                            SDSTL                                     CLE073
     I              OSDA                            OSDAL                                     CLE073
     I              TSTN                            TSTNL                                     CLE073
     I              MDST                            MDSTL                                     CLE073
     I              OMDA                            OMDAL                                     CLE073
     I              TMAN                            TMANL                                     CLE073
     I              FACO                            FACOL                                     CLE073
     I              RLDT                            RLDTL                                     CLE073
     I              NROD                            NRODL                                     CLE073
     I              RLFQ                            RLFQL                                     CLE073
     I              RLDY                            RLDYL                                     CLE073
     I              RDFC                            RDFCL                                     CLE073
     I              NBRA                            NBRAL                                     CLE073
     I              NRTS                            NRTSL                                     CLE073
     I              NSIN                            NSINL                                     CLE073
     I              NCAS                            NCASL                                     CLE073
     I              AWTP                            AWTPL                                     CLE073
     I              WTRD                            WTRDL                                     CLE073
     I              WTWD                            WTWDL                                     CLE073
     I              IWOD                            IWODL                                     CLE073
     I              PWOD                            PWODL                                     CLE073
     I              BMDI                            BMDIL                                     CLE073
     I              FMDI                            FMDIL                                     CLE073
     I              PDIN                            PDINL                                     CLE073
     I              LSWC                            LSWCL                                     CLE073
     I              LSWS                            LSWSL                                     CLE073
     I              OSDB                            OSDBL                                     CLE073
     I              OMDB                            OMDBL                                     CLE073
     I              ORBR                            ORBRL                                     CLE073
     I              PRFC                            PRFCL                                     CLE073
     I              FCLB                            FCLBL                                     CLE073
     I              MLNR                            MLNRL                                     CLE073
     I              BTIN                            BTINL                                     CLE073
     I              BLDY                            BLDYL                                     CLE073
     I              OLNO                            OLNOL                                     CLE073
     I              RCSI                            RCSIL                                     CLE073
     I              ICBS                            ICBSL                                     CLE073
     I              IPFR                            IPFRL                                     CLE073
     I              TOTI                            TOTIL                                     CLE073
     I              NIDT                            NIDTL                                     CLE073
     I              IBDT                            IBDTL                                     CLE073
     I              SLID                            SLIDL                                     CLE073
     I              AIPD                            AIPDL                                     CLE073
     I              DLRC                            DLRCL                                     CLE073
     I              IACD                            IACDL                                     CLE073
     I              AITC                            AITCL                                     CLE073
     I              TFEP                            TFEPL                                     CLE073
     I              AIAP                            AIAPL                                     CLE073
     I              IPRD                            IPRDL                                     CLE073
     I              IPRM                            IPRML                                     CLE073
     I              ICTD                            ICTDL                                     CLE073
     I              AIMN                            AIMNL                                     CLE073
     I              RBDT                            RBDTL                                     CLE073
     I              NOPS                            NOPSL                                     CLE073
     I              NCHI                            NCHIL                                     CLE073
     I              IFDY                            IFDYL                                     CLE073
     I              LONI                            LONIL                                     CLE073
     I              CNFI                            CNFIL                                     CLE073
     I              ACEI                            ACEIL                                     CLE073
     I              TLXI                            TLXIL                                     CLE073
     I              CBLI                            CBLIL                                     CLE073
     I              ORED                            OREDL                                     CLE073
     I              LCD                             LCDL                                      CLE073
     I              CHTP                            CHTPL                                     CLE073
     I              TNLU                            TNLUL                                     CLE073
     I              ADDI                            ADDIL                                     CLE073
     I              ORMD                            ORMDL                                     CLE073
     I              ORTI                            ORTIL                                     CLE073
     I              BOKC                            BOKCL                                     CLE073
     I              COCU                            COCUL                                     CLE073
     I              RECE                            RECEL                                     CLE073
     I              OMDT                            OMDTL                                     CLE073
     I              NIPD                            NIPDL                                     CLE073
     I              NMDT                            NMDTL                                     CLE073
     I              APMI                            APMIL                                     CLE073
     I              RSTM                            RSTML                                     CLE073
     I              RONS                            RONSL                                     CLE073
     I              RIBN                            RIBNL                                     CLE073
     I              RIBA                            RIBAL                                     CLE073
     I              ROBN                            ROBNL                                     CLE073
     I              ROCN                            ROCNL                                     CLE073
     I              PSTM                            PSTML                                     CLE073
     I              PONS                            PONSL                                     CLE073
     I              PIBN                            PIBNL                                     CLE073
     I              PIBA                            PIBAL                                     CLE073
     I              POBN                            POBNL                                     CLE073
     I              POCN                            POCNL                                     CLE073
     I              RCRN                            RCRNL                                     CLE073
     I              RCRA                            RCRAL                                     CLE073
     I              RVNO                            RVNOL                                     CLE073
     I              AWBN                            AWBNL                                     CLE073
     I              AWBA                            AWBAL                                     CLE073
     I              BENN                            BENNL                                     CLE073
     I              BENA                            BENAL                                     CLE073
     I              DTP1                            DTP1L                                     CLE073
     I              DTP2                            DTP2L                                     CLE073
     I              DTP3                            DTP3L                                     CLE073
     I              DTP4                            DTP4L                                     CLE073
     I              DCHG                            DCHGL                                     CLE073
     I              BTB1                            BTB1L                                     CLE073
     I              BTB2                            BTB2L                                     CLE073
     I              BTB3                            BTB3L                                     CLE073
     I              BTB4                            BTB4L                                     CLE073
     I              BTB5                            BTB5L                                     CLE073
     I              BTB6                            BTB6L                                     CLE073
     I              CVMR                            CVMRL                                     CLE073
     I              PTFR                            PTFRL                                     CLE073
     I              HLEX                            HLEXL                                     CLE073
     I              FSRP                            FSRPL                                     CLE073
     I              FSGN                            FSGNL                                     CLE073
     I              FPRC                            FPRCL                                     CLE073
     I              TCOF                            TCOFL                                     CLE073
     I              ACPD                            ACPDL                                     CLE073
     I              ACDA                            ACDAL                                     CLE073
     I              ACAJ                            ACAJL                                     CLE073
     I              ACAP                            ACAPL                                     CLE073
     I              COFD                            COFDL                                     CLE073
     I              COFM                            COFML                                     CLE073
     I              CFCD                            CFCDL                                     CLE073
     I              NFRS                            NFRSL                                     CLE073
     I              NFSN                            NFSNL                                     CLE073
     I              NFPC                            NFPCL                                     CLE073
     I              PDCF                            PDCFL                                     CLE073
     I              FCTD                            FCTDL                                     CLE073
     I              FWOD                            FWODL                                     CLE073
     I              DFTP                            DFTPL                                     CLE073
     I              DFST                            DFSTL                                     CLE073
     I              MCRA                            MCRAL                                     CLE073
     I              FCRA                            FCRAL                                     CLE073
     I              PDDI                            PDDIL                                     CLE073
     I              PTDI                            PTDIL                                     CLE073
     I              GDPR                            GDPRL                                     CLE073
     I              GDIN                            GDINL                                     CLE073
     I              LNKS                            LNKSL                                     CLE073
     I              MNSG                            MNSGL                                     CLE073
     I              GASS                            GASSL                                     CLE073
     I              GPRT                            GPRTL                                     CLE073
     I              TOLN                            TOLNL                                     CLE073
     I              LSTS                            LSTSL                                     CLE073
     I              IUSR                            IUSRL                                     CLE073
     I              AUSR                            AUSRL                                     CLE073
     I              XUSR                            XUSRL                                     CLE073
     I              RATF                            RATFL                                     CLE073
     I              CNCF                            CNCFL                                     CLE073
     I              PCRF                            PCRFL                                     CLE073
     I              LPFI                            LPFIL                                     CLE073
     I              PTFC                            PTFCL                                     CLE073
     I              PTFT                            PTFTL                                     CLE073
     I              PTFN                            PTFNL                                     CLE073
     I              PCOB                            PCOBL                                     CLE073
     I              LRLD                            LRLDL                                     CLE073
     I              LMCD                            LMCDL                                     CLE073
     I              SCCY                            SCCYL                                     CLE073
     I              ICCY                            ICCYL                                     CLE073
     I              OINR                            OINRL                                     CLE073
     I              OIDT                            OIDTL                                     CLE073
     I              REPI                            REPIL                                     CLE073
     I              RFDY                            RFDYL                                     CLE073
     I              RFRI                            RFRIL                                     CLE073
     I              RFRT                            RFRTL                                     CLE073
     I              RFAR                            RFARL                                     CLE073
     I              FSYLDC                          LSYLDC                                    CLE073
     I              FSFYLD                          LSFYLD                                    CLE073
     I              FSURPL                          LSURPL                                    CLE073
     I              FSPLAM                          LSPLAM                                    CLE073
     I              FSPLDT                          LSPLDT                                    CLE073
     I              FSYUPL                          LSYUPL                                    CLE073
     I              TFAM                            TFAML                                     CLE073
     ICLOANCKF                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIK                                     CLE073
     I              LNRF                            LNRFK                                     CLE073
     I              RCDT                            RCDTK                                     CLE073
     I              MRIN                            MRINK                                     CLE073
     I              NAR1                            NAR1K                                     CLE073
     I              NAR2                            NAR2K                                     CLE073
     I              NAR3                            NAR3K                                     CLE073
     I              NAR4                            NAR4K                                     CLE073
     I              OPAM                            OPAMK                                     CLE073
     I              FRBC                            FRBCK                                     CLE073
     I              YPLN                            YPLNK                                     CLE073
     I              YFLN                            YFLNK                                     CLE073
     I              YWLN                            YWLNK                                     CLE073
     I              ABLN                            ABLNK                                     CLE073
     I              YPLC                            YPLCK                                     CLE073
     I              YFLC                            YFLCK                                     CLE073
     I              YWLC                            YWLCK                                     CLE073
     I              ABLC                            ABLCK                                     CLE073
     I              WWLN                            WWLNK                                     CLE073
     I              IWLN                            IWLNK                                     CLE073
     I              PWLN                            PWLNK                                     CLE073
     I              RDST                            RDSTK                                     CLE073
     I              SPI1                            SPI1K                                     CLE073
     I              SPI2                            SPI2K                                     CLE073
     I              SPI3                            SPI3K                                     CLE073
     I              YILN                            YILNK                                     CLE073
     I              ORVD                            ORVDK                                     CLE073
     I              THRN                            THRNK                                     CLE073
     I              NPRAM                           NPRAMK                                    CLE073
     I              NDAM                            NDAMK                                     CLE073
     I              RLBR                            RLBRK                                     CLE073
     I              ORED                            OREDK                                     CLE073
     I              LCD                             LCDK                                      CLE073
     I              CHTP                            CHTPK                                     CLE073
     I              TNLU                            TNLUK                                     CLE073
     I              RRST                            RRSTK                                     CLE073
     I              RRON                            RRONK                                     CLE073
     I              RRIB                            RRIBK                                     CLE073
     I              RRBA                            RRBAK                                     CLE073
     I              RROB                            RROBK                                     CLE073
     I              RROC                            RROCK                                     CLE073
     I              NCCY                            NCCYK                                     CLE073
     I              NCPA                            NCPAK                                     CLE073
     I              NFCE                            NFCEK                                     CLE073
     I              NFMD                            NFMDK                                     CLE073
     I              NLRA                            NLRAK                                     CLE073
     I              RSTS                            RSTSK                                     CLE073
     I              RIUS                            RIUSK                                     CLE073
     I              RAUS                            RAUSK                                     CLE073
     I              RXUS                            RXUSK                                     CLE073
     I              RPCR                            RPCRK                                     CLE073
     I              RLSB                            RLSBK                                     CLE073
     I              RPST                            RPSTK                                     CLE073
     I              RPON                            RPONK                                     CLE073
     I              RPIB                            RPIBK                                     CLE073
     I              RPBA                            RPBAK                                     CLE073
     I              RPOB                            RPOBK                                     CLE073
     I              RPOC                            RPOCK                                     CLE073
     I              RRCR                            RRCRK                                     CLE073
     I              RRCA                            RRCAK                                     CLE073
     I              RRVN                            RRVNK                                     CLE073
     I              RAWB                            RAWBK                                     CLE073
     I              RAWA                            RAWAK                                     CLE073
     I              RBEN                            RBENK                                     CLE073
     I              RBNA                            RBNAK                                     CLE073
     I              RDP1                            RDP1K                                     CLE073
     I              RDP2                            RDP2K                                     CLE073
     I              RDP3                            RDP3K                                     CLE073
     I              RDP4                            RDP4K                                     CLE073
     I              RDCH                            RDCHK                                     CLE073
     I              RBB1                            RBB1K                                     CLE073
     I              RBB2                            RBB2K                                     CLE073
     I              RBB3                            RBB3K                                     CLE073
     I              RBB4                            RBB4K                                     CLE073
     I              RBB5                            RBB5K                                     CLE073
     I              RBB6                            RBB6K                                     CLE073
     I              RCVM                            RCVMK                                     CLE073
     I              NBCE                            NBCEK                                     CLE073
     I              NBMD                            NBMDK                                     CLE073
     I              RRSC                            RRSCK                                     CLE073
     I              RPSC                            RPSCK                                     CLE073
     I              RICY                            RICYK                                     CLE073
     I              ECIN                            ECINK                                     CLE073
     I              RPSM                            RPSMK                                     CLE073
     I              RPOS                            RPOSK                                     CLE073
     I              RPTS                            RPTSK                                     CLE073
     I              RPSB                            RPSBK                                     CLE073
     I              RFAO                            RFAOK                                     CLE073
     I              FSFYLB                          KSFYLB                                    CLE073
      *                                                                                       CLE073
     IHISTSHPF                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIP                                     CLE073
     I              RCDT                            RCDTP                                     CLE073
     I              BRCA                            BRCAP                                     CLE073
     I              CNUM                            CNUMP                                     CLE073
     I              LNRF                            LNRFP                                     CLE073
     I              VDAT                            VDATP                                     CLE073
     I              PRSQ                            PRSQP                                     CLE073
     I              LASN                            LASNP                                     CLE073
     I              CCY                             CCYP                                      CLE073
     I              AMTP                            AMTPP                                     CLE073
     I              PRAM                            PRAMP                                     CLE073
     I              LCD                             LCDP                                      CLE073
     I              CPAM                            CPAMP                                     CLE073
      *                                                                                       CLE073
     IHISTSHMF                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIM                                     CLE073
     I              RCDT                            RCDTM                                     CLE073
     I              BRCA                            BRCAM                                     CLE073
     I              CNUM                            CNUMM                                     CLE073
     I              LNRF                            LNRFM                                     CLE073
     I              VDAT                            VDATM                                     CLE073
     I              PRSQ                            PRSQM                                     CLE073
     I              LASN                            LASNM                                     CLE073
     I              CCY                             CCYM                                      CLE073
     I              AMTP                            AMTPM                                     CLE073
     I              PRAM                            PRAMM                                     CLE073
     I              LCD                             LCDM                                      CLE073
     I              CPAM                            CPAMM                                     CLE073
     ILEPDUED1                                                                              MD048400
      *                                                                                     MD048400
      ** Rename LEPDUEL6 fields that are too long.                                          MD048400
      *                                                                                     MD048400
     I              YTKPACL                         YTPACL                                  MD048400
     I              YTKPABR                         YTPABR                                  MD048400
     I              YTKPAAC                         YTPAAC                                  MD048400
     I              YTKPASE                         YTPASE                                  MD048400
     I              YTKPACY                         YTPACY                                  MD048400
     I              YTKIACL                         YTIACL                                  MD048400
     I              YTKIABR                         YTIABR                                  MD048400
     I              YTKIAAC                         YTIAAC                                  MD048400
     I              YTKIASE                         YTIASE                                  MD048400
     I              YTKIACY                         YTIACY                                  MD048400
      *                                                                                     MD048400
     ILEPDUFD1                                                                              MD048400
      *                                                                                     MD048400
      ** Rename LEPDUFLA fields that are too long.                                          MD048400
      *                                                                                     MD048400
     I              YTKPACL                         YTPACL                                  MD048400
     I              YTKPABR                         YTPABR                                  MD048400
     I              YTKPAAC                         YTPAAC                                  MD048400
     I              YTKPASE                         YTPASE                                  MD048400
     I              YTKPACY                         YTPACY                                  MD048400
      *
     IPSDS       SDS
      ** Program Status Data Structure - gives Job/Workstation name and
      ** User ID
      *
     I                                      244 253 JOB
     I                                      244 246 WSID
      *
     IDSCSNM      DS                             10
      ** Location code in customer shortname field is last 2 positions.
     I                                        8  10 NRLC
      *
     IDSETYP      DS
      *** Data area for the break down of event type
     I                                       14  17 ETYP
     I                                       14  15 PTP
     I                                       16  17 ETP
      *                                                                   CLE013
     I/COPY ZSRSRC,ZINTDYZ1                                               CLE013
     I/COPY ZSRSRC,ZDATE9Z2                                               CLE013
     I/COPY ZSRSRC,ZDAT10Z1                                               CLE013
      *
     I            DS
      *** Redefine fee details.
     I                                        5   90FEFACL
     I                                        5   70FACT
     I                                        8   90FCNO
      *
     I            DS
      *** Redefine STDATE & STFSEQ
     I                                    P   1   30STDATE
     I**********                              4   50STFSEQ                                    200289
     I**********                              4   60STFSEQ                           200289 AR674226
     I                                        4   70STFSEQ                                  AR674226
     I/COPY WNCPYSRC,LE0492I001
      *
     I            DS
      *** Fee amounts data structure
     I                                    P   1  300FEEM
     I                                    P   1   60FEAMT1
     I                                    P   7  120FEAMT2
     I                                    P  13  180FEAMT3
     I                                    P  19  240FEAMT4
     I                                    P  25  300FEAMT5
      *
     I            DS
      *** Fee rates data structure
     I                                    P   1  205FRT
     I                                    P   1   45FEFRT1
     I                                    P   5   85FEFRT2
     I                                    P   9  125FEFRT3
     I                                    P  13  165FEFRT4
     I                                    P  17  205FEFRT5
      *                                                                                     CLE075AP
      ** LESTALPD Parameters Data Structure                                                 CLE075AP
      *                                                                                     CLE075AP
     I            DS                                                                        CLE075AP
     I                                        1  25 WSTAL                                   CLE075AP
     I                                    P   1   50WPDAY                                   CLE075AP
     I                                        6   6 WPSMI                                   CLE075AP
     I                                        7  12 WPLRF                                   CLE075AP
     I                                       13  18 WPCSF                                   CLE075AP
     I                                       19  23 WPFCF                                   CLE075AP
     I                                       24  25 WPFSQ                                   CLE075AP
     I            DS                                                                        CLE075AP
     I                                        1  20 WPSTAL                                  CLE075AP
     I                                        1   6 WPLNRF                                  CLE075AP
     I                                        7  12 WPCNUM                                  CLE075AP
     I                                       13  17 WPFACL                                  CLE075AP
     I                                       18  19 WPFSEQ                                  CLE075AP
     I                                       20  20 WPPYRC                                  CLE075AP
     I/COPY ZSRSRC,ZHASHZ2
     I/COPY ZSRSRC,ZHOLI
      *
     IACCY        DS                             30                                           CLE141
     I                                        1   3 C1PI                                      CLE141
     I                                        4   6 C2PI                                      CLE141
     I                                        7   9 C3PI                                      CLE141
     I                                       10  12 C4PI                                      CLE141
     I                                       13  15 C5PI                                      CLE141
     I                                       16  18 C6PI                                      CLE141
     I                                       19  21 C7PI                                      CLE141
     I                                       22  24 C8PI                                      CLE141
     I                                       25  27 C9PI                                      CLE141
     I                                       28  30 C0PI                                      CLE141
     IALOC        DS                             30                                           CLE141
     I                                        1   3 L1PI                                      CLE141
     I                                        4   6 L2PI                                      CLE141
     I                                        7   9 L3PI                                      CLE141
     I                                       10  12 L4PI                                      CLE141
     I                                       13  15 L5PI                                      CLE141
     I                                       16  18 L6PI                                      CLE141
     I                                       19  21 L7PI                                      CLE141
     I                                       22  24 L8PI                                      CLE141
     I                                       25  27 L9PI                                      CLE141
     I                                       28  30 L0PI                                      CLE141
      *                                                                                       CLE141
     ILDA       E DSLDA
      ** Database error DS
      *
     ILESTAT    E DSLESTAT
      ***  Data Structure to obtain control date
     I              FLSETUP                         SETUP
     I              HSTPROC                         HIST
     I              CODT                            WCODT
     IRUNDAT    E DS
     I              AGRDNB                          RUND
      *
     ISDBANK    E DSSDBANKPD
      *
     I***SDBRCH*    E DSSDBRCHPD                                                            CLE075AP
     I***SDBRCH*   E DSSDBRCHPD                900                                 CLE075AP MD055146
     ISDBRCH    E DSSDBRCHPD                999                                             MD055146
     I              A8CMCD                          CMPYM
      *
     ISDCUST    E DSSDCUSTPD
     I              BBCOLC                          CLOC
     I              QQDFAC                          DFACBK                                    CGL029
      *
     ISDCLND    E DSSDCLNDPD
      *
     I*SDSVAL*** E DSSDSVALPD                                                          CLE033 222373
      ****EXTERNAL DS FOR SYSTEM VALUES                                                CLE033 222737
     I**********                                                                       CLE033 222373
     I**********SDCURR    E DSSDCURRPD                                                        CSC042
     I**********    A6CYCD                          CCY                                       CSC042
     I**********    A6TXND                          TXND                                      CSC042
     I**********    A6NBDP                          CDP                                100523 CSC042
      *
     I***SDNOST*   E DSSDNOSTPD                                                             CLE075AP
     ISDNOST    E DSSDNOSTPD                200                                             CLE075AP
     I              A7NOSN                          CSNM
      *
     I***SDCTRY*   E DSSDCTRYPD                                                             CLE075AP
     ISDCTRY    E DSSDCTRYPD                400                                             CLE075AP
      *
     ISDALTN    E DSSDALTNPD
      *
     I/COPY ZSRSRC,ZAOZ2                                                                      CAS009
     I              QQACCD                          ACCDQQ                                    CGL029
     I*SDGELR****E*DSSDGELRPD                                      101322 133888
     I***General*Ledger*Details                                    101322 133888
     I***********                                                  101322 133888
     ISCSARD    E DSSCSARDPD                                              CLE004
      **  External data structure for Switchable Features                 CLE004
      *                                                                   CLE004
     I***LESTAL*   E DSLESTALPD                                                      CLE034 CLE075AP
     ILESTAL    E DSLESTALPD                100                                             CLE075AP
      ** External data structures for Settlement Allocation File                              CLE034
      *                                                                                       CLE034
     I              PSTM                            STPSTM                                    CLE034
     I              PONS                            STPONS                                    CLE034
     I              PIBN                            STPIBN                                    CLE034
     I              PIBA                            STPIBA                                    218992
     I              POBN                            STPOBN                                    218992
     I              POCN                            STPOCN                                    218992
     I              POBR                            STPOBR                                    CLE034
     I              RSTM                            STRSTM                                    CLE034
     I              RONS                            STRONS                                    CLE034
     I              RIBN                            STRIBN                                    CLE034
     I              RIBA                            STRIBA                                    218992
     I              ROBN                            STROBN                                    218992
     I              ROCN                            STROCN                                    218992
     I              ROBR                            STROBR                                    CLE034
     I              RSCY                            STRSCY                                    218992
     I              REXR                            STREXR                                    CLE034
     I              REXI                            STREXI                                    CLE034
     I              PEXR                            STPEXR                                    CLE034
     I              PEXI                            STPEXI                                    CLE034
     I              PSCY                            STPSCY                                    CLE034
     I              LASQ                            STLASQ                                    CLE034
     I              SEQ                             STSEQ                                     CLE034
     I              CVMR                            STCVMR                                    218992
     I              RCRN                            STRCRN                                    218992
     I              RCRA                            STRCRA                                    218992
     I              RVNO                            STRVNO                                    218992
     I              AWBN                            STAWBN                                    218992
     I              AWBA                            STAWBA                                    218992
     I              BENN                            STBENN                                    218992
     I              BENA                            STBENA                                    218992
     I              DTP1                            STDTP1                                    218992
     I              DTP2                            STDTP2                                    218992
     I              DTP3                            STDTP3                                    218992
     I              DTP4                            STDTP4                                    218992
     I              DCHG                            STDCHG                                    218992
     I              BTB1                            STBTB1                                    218992
     I              BTB2                            STBTB2                                    218992
     I              BTB3                            STBTB3                                    218992
     I              BTB4                            STBTB4                                    218992
     I              BTB5                            STBTB5                                    218992
     I              BTB6                            STBTB6                                    218992
     I              CCY                             STCCY                                     CLE038
     IDSFDY     E DSDSFDY
      ** First DS for access programs, short data structure
      *
     IDSSDY     E DSDSSDY
      ** Second DS for access programs, long data structure
      *
     ISDSTPD    E DSSDSTPDPD                                                                  CER049
      *                                                                                       CER049
     ISDACCT    E DSACCNTAB                                                                   CER049
     I              RECI                            ACRECI                                    CER049
     I              CNUM                            ACCNUM                                    CER049
     I              FACT                            ACFACT                                    CER049
     I              FCNO                            ACFCNO                                    CER049
     I              LCD                             ACLCD                                     CER049
     I              TMST                            ACTMST                                    CER049
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
      *                                                                                       CLE071
     I            DS                                                                          CLE071
      ** Fee amounts data structure                                                           CLE071
     I                                    P   1  300FCAM                                      CLE071
     I                                    P   1   60FCAMT1                                    CLE071
     I                                    P   7  120FCAMT2                                    CLE071
     I                                    P  13  180FCAMT3                                    CLE071
     I                                    P  19  240FCAMT4                                    CLE071
     I                                    P  25  300FCAMT5                                    CLE071
      *                                                                                       CLE071
      *                                                                                       CLE071
     I            DS                                                                          CLE071
      ** Fee rates data structure                                                             CLE071
     I                                    P   1  205FCRT                                      CLE071
     I                                    P   1   45FCFRT1                                    CLE071
     I                                    P   5   85FCFRT2                                    CLE071
     I                                    P   9  125FCFRT3                                    CLE071
     I                                    P  13  165FCFRT4                                    CLE071
     I                                    P  17  205FCFRT5                                    CLE071
     I/COPY WNCPYSRC,LE0492IIP1                                           S01408
     C/TITLE Main Processing
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
      ***  Perform Initialisation.
      *
     C                     EXSR INIT
      *
      ***  Perform Detail Processing.
      *
     C                     EXSR PROCES
      *
      ***  Output Audit Report and End Program.
      *
     C                     EXSR AUDIT
      *
      *****************************************************************
      /TITLE SR/INIT
      *****************************************************************
      *                                                               *
      *  INIT   - SUBROUTINE TO DO PROGRAM INITIALISATION.            *
      *                                                               *
      *  Called By: MAIN PROCESSING                                   *
      *                                                               *
      *  Calls:     AOBANKR0, AOCLNDR0                                *
      *                                                               *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
      ***  Set up copyright statement.
      *
     C                     MOVEACPY@      BIS@   80
      *
      ***  Set up LVENT count
      *
     C**********           Z-ADD2         COUNTL  50                        0031
     C**********           Z-ADD2         COUNT2  50                  0031105140
     C                     Z-ADD2         COUNT2  90                      105140
     C*                                                                     0084
     C** Initialise the count for the number of deleted A1 records          0084
     C*                                                                     0084
     C**********           Z-ADD0         DELSC   50                        0084              239679
     C                     Z-ADD0         DELSC   90                        0084              239679
     C*                                                                   100523
     C** Initialise fields for amount conversion                          100523
     C*                                                                   100523
     C                     Z-ADD0         TD      10                      100523
     C                     Z-ADD0         FD      10                      100523
     C                     Z-ADD0         WRK153 153                      100523
      *                                                                                       CLE071
     C           *LIKE     DEFN FEPIND    WKPIND                                              CLE071
     C           *LIKE     DEFN ZZEND     WKENDD                                              CLE071
     C           *LIKE     DEFN WEND      SVENDT                                              CLE071
      *
      ***  Write header records to output files
      *
      ***  Only do telex, etc stuff if not non-working day accrual run      0039
      *                                                                     0039
     C           *INU3     IFEQ '0'                                         0039
     C                     MOVE 'H'       RECI
     C                     WRITECUTX2HHF
     C                     WRITEOCFTLXHH
     C                     END                                              0039
      *                                                                   045634
      ***  Write header records to output files                           045634
     C                     WRITEOLVENTHH                                  045634
      *
      ***  Call access program for bank specific details, e.g., title
      ***  local currency, run date & day number.
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           WRTCD     IFNE *BLANKS                    ***B001
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVEL'*READ   'DBKEY
     C                     MOVE 'SDBANKPD'DBFILE           ************
     C                     Z-ADD1         DBASE            * DBERR 01 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END                             ***E001
      *                                                                                       CAS009
      ** Check System Date Format, DDMMYY (*IN98 off)                                         CAS009
      **                           MMDDYY (*IN98 on).                                         CAS009
      *                                                                                       CAS009
     C           BJDFIN    IFEQ 'M'                                                           CAS009
     C                     SETON                     98                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                   CLE004
      ** Check if SAR CLE004 is present                                   CLE004
      *                                                                   CLE004
     C                     CALL 'AOSARDR0'                                CLE004
     C                     PARM *BLANKS   P@RTCD  7                       CLE004
     C                     PARM '*KEY   ' P@OPTN  7                       CLE004
     C                     PARM 'CLE004'  P@SARD  6                       CLE004
     C           SCSARD    PARM SCSARD    DSFDY                           CLE004
      *                                                                   CLE004
     C           P@RTCD    IFEQ *BLANKS                                   CLE004
     C                     MOVE *ON       CLE004  1                       CLE004
     C                     ELSE                                           CLE004
      *                                                                   CLE004
      ** Handle Database Error                                            CLE004
      *                                                                   CLE004
     C           P@RTCD    IFNE '*NRF    '                                CLE004
     C           *LOCK     IN   LDA                                       CLE004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE004
     C                     Z-ADD24        DBASE            * DBERR 24 *   CLE004
     C                     MOVEL'CLE004'  DBKEY     P      ************   CLE004
     C                     OUT  LDA                                       CLE004
     C                     EXSR *PSSR                                     CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE005
      ** Check if SAR CLE005 is present                                   CLE005
      *                                                                   CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   P@RTCD  7                       CLE005
     C                     PARM '*KEY   ' P@OPTN  7                       CLE005
     C                     PARM 'CLE005'  P@SARD  6                       CLE005
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
      *                                                                   CLE005
     C           P@RTCD    IFEQ *BLANKS                                   CLE005
     C                     MOVE *ON       CLE005  1                       CLE005
     C                     ELSE                                           CLE005
      *                                                                   CLE005
      ** Handle Database Error                                            CLE005
      *                                                                   CLE005
     C           P@RTCD    IFNE '*NRF    '                                CLE005
     C           *LOCK     IN   LDA                                       CLE005
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE005
     C                     Z-ADD25        DBASE            * DBERR 25 *   CLE005
     C                     MOVEL'CLE005'  DBKEY     P      ************   CLE005
     C                     OUT  LDA                                       CLE005
     C                     EXSR *PSSR                                     CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE007
      ** Determine if Customer Lending Enhancements - Others (T3)         CLE007
      ** feature is installed                                             CLE007
      *                                                                   CLE007
     C                     CALL 'AOSARDR0'                                CLE007
     C                     PARM *BLANKS   P@RTCD  7                       CLE007
     C                     PARM '*KEY   ' P@OPTN  7                       CLE007
     C                     PARM 'CLE007'  P@SARD  6                       CLE007
     C           SCSARD    PARM SCSARD    DSFDY                           CLE007
      *                                                                   CLE007
     C           P@RTCD    IFEQ *BLANKS                                   CLE007
     C                     MOVE 'Y'       CLE007  1                       CLE007
     C                     ELSE                                           CLE007
     C                     MOVE 'N'       CLE007                          CLE007
      *                                                                   CLE007
     C           P@RTCD    IFNE '*NRF    '                                CLE007
     C           *LOCK     IN   LDA                                       CLE007
     C                     MOVEL'LE0492  'DBPGM                           CLE007
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE007
     C                     Z-ADD26        DBASE            * DBERR 26 *   CLE007
     C                     MOVEL'CLE007'  DBKEY     P      ************   CLE007
     C                     OUT  LDA                                       CLE007
     C                     EXSR *PSSR                                     CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CEU004
      ** Check if CLE009 is switched *ON.                                 CLE009
      *                                                                   CLE009
     C                     MOVE 'N'       CLE009  1                       CLE009
     C           CLE007    IFEQ 'Y'                                       CLE009
     C                     CALL 'AOSARDR0'                                CLE009
     C                     PARM *BLANKS   P@RTCD                          CLE009
     C                     PARM '*VERIFY' P@OPTN                          CLE009
     C                     PARM 'CLE009'  P@SARD                          CLE009
     C           SCSARD    PARM SCSARD    DSFDY                           CLE009
      *                                                                   CLE009
     C           P@RTCD    IFEQ *BLANKS                                   CLE009
     C                     MOVE 'Y'       CLE009                          CLE009
     C                     END                                            CLE009
      *                                                                   CLE009
     C           P@RTCD    IFNE *BLANKS                                   CLE009
     C           P@RTCD    ANDNE'*NRF   '                                 CLE009
      *                                                                   CLE009
      ** Call to program ended in error                                   CLE009
      *                                                                   CLE009
     C           *LOCK     IN   LDA                                       CLE009
     C                     MOVE *BLANKS   DBKEY                           CLE009
     C                     MOVEL'CLE009'  DBKEY            ************   CLE009
     C                     MOVE 'SCSARDPD'DBFILE           * DBERR 27 *   CLE009
     C                     Z-ADD27        DBASE            ************   CLE009
     C                     MOVEL'LE0492'  DBPGM                           CLE009
     C                     OUT  LDA                                       CLE009
     C                     EXSR *PSSR                                     CLE009
     C                     ENDIF                                          CLE009
     C                     ENDIF                                          CLE009
      ** Determine if Settlement Curremcy Conversion Upgrade              CEU004
      ** feature is installed                                             CEU004
      *                                                                   CEU004
     C                     CALL 'AOSARDR0'                                CEU004
     C                     PARM *BLANKS   P@RTCD                          CEU004
     C                     PARM '*KEY   ' P@OPTN                          CEU004
     C                     PARM 'CEU004'  P@SARD                          CEU004
     C           SCSARD    PARM SCSARD    DSFDY                           CEU004
      *                                                                   CEU004
     C           P@RTCD    IFEQ *BLANKS                                   CEU004
     C                     MOVE 'Y'       CEU004  1                       CEU004
     C                     ELSE                                           CEU004
     C                     MOVE 'N'       CEU004                          CEU004
      *                                                                   CEU004
     C           P@RTCD    IFNE '*NRF    '                                CEU004
     C           *LOCK     IN   LDA                                       CEU004
     C                     MOVEL'LE0492  'DBPGM                           CEU004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CEU004
     C                     Z-ADD51        DBASE            * DBERR 51 *   CEU004
     C                     MOVEL'CEU004'  DBKEY     P      ************   CEU004
     C                     OUT  LDA                                       CEU004
     C                     EXSR *PSSR                                     CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CLE014
      ** Check whether SAR CLE014 is installed or not.                    CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM *BLANK    PRTCD   7                       CLE014
     C                     PARM '*VERIFY' POPTN   7                       CLE014
     C                     PARM 'CLE014'  PSARD   6                       CLE014
     C           SCSARD    PARM SCSARD    DSFDY                           CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANK                                    CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C           PRTCD     IFNE '*NRF   '                                 CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVEL'LE0492  'DBPGM                           CLE014
     C                     MOVEL'SCSARDPD'DBFILE                          CLE014
     C                     Z-ADD52        DBASE                           CLE014
     C                     MOVEL'CLE014'  DBKEY                           CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C*                                                                   CLE033
     C**  Read switchable features file SCSARDPD using access object      CLE033
     C**  to determine if switchable feature (CLE033) is switched ON      CLE033
     C*                                                                   CLE033
     C                     MOVE 'N'       CLE033  1                       CLE033
     C*                                                                   CLE033
     C                     CALL 'AOSARDR0'                                CLE033
     C                     PARM *BLANKS   W0RTCD  7                       CLE033
     C                     PARM '*VERIFY' W0OPTN  7                       CLE033
     C                     PARM 'CLE033'  W0SARD  6                       CLE033
     C           SCSARD    PARM SCSARD    DSFDY                           CLE033
     C*                                                                   CLE033
     C**  If feature is on, set up CLE033 variable                        CLE033
     C*                                                                   CLE033
     C           W0RTCD    IFEQ *BLANKS                                   CLE033
      *                                                                   CLE033
     C                     MOVE 'Y'       CLE033                          CLE033
      *                                                                   CLE033
     C                     CALL 'AOSVALR0'                                CLE033
     C                     PARM *BLANKS   W0RTCD                          CLE033
     C                     PARM SVAL,1    P@OP01 20                       CLE033
     C                     PARM *BLANKS   P@VL01200                       CLE033
     C                     PARM SVAL,2    P@OP02 20                       CLE033
     C                     PARM *BLANKS   P@VL02200                       CLE033
     C*********************PARM *BLANKS   P@OP03 20                                     CLE033218782
     C                     PARM SVAL,3    P@OP03 20                                           218782
     C                     PARM *BLANKS   P@VL03200                       CLE033
     C                     PARM *BLANKS   P@OP04 20                       CLE033
     C                     PARM *BLANKS   P@VL04200                       CLE033
     C                     PARM *BLANKS   P@OP05 20                       CLE033
     C                     PARM *BLANKS   P@VL05200                       CLE033
     C                     PARM *BLANKS   P@OP06 20                       CLE033
     C                     PARM *BLANKS   P@VL06200                       CLE033
     C                     PARM *BLANKS   P@OP07 20                       CLE033
     C                     PARM *BLANKS   P@VL07200                       CLE033
     C                     PARM *BLANKS   P@OP08 20                       CLE033
     C                     PARM *BLANKS   P@VL08200                       CLE033
     C                     PARM *BLANKS   P@OP09 20                       CLE033
     C                     PARM *BLANKS   P@VL09200                       CLE033
     C                     PARM *BLANKS   P@OP10 20                       CLE033
     C                     PARM *BLANKS   P@VL10200                       CLE033
     C********** SDSVAL    PARM SDSVAL    DSSDY                                        CLE033 222373
      *                                                                   CLE033
     C           W0RTCD    IFNE *BLANKS                                   CLE033
     C                     MOVEL'LE0492  'DBPGM                           CLE033
     C                     MOVEL'SDSVALPD'DBFILE           ************   CLE033
     C                     MOVEL'*KEY   ' DBKEY            * DBERR 28 *   CLE033
     C                     Z-ADD28        DBASE            ************   CLE033
     C                     OUT  LDA                                       CLE033
     C                     EXSR *PSSR                                     CLE033
     C                     ENDIF                                          CLE033
      *                                                                                       218782
      ** Save value of Settlement09Postings in a one character field                          218782
     C                     MOVELP@VL03    SET09   1                                           218782
      *                                                                   CLE033
     C                     ELSE                                           CLE033
     C*                                                                   CLE033
     C** else, database error (return code other than *NRF)               CLE033
     C*                                                                   CLE033
     C           W0RTCD    IFNE '*NRF   '                                 CLE033
     C           *LOCK     IN   LDA                                       CLE033
     C                     MOVEL'LE0492'  DBPGM                           CLE033
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE033
     C                     MOVEL'*VERIFY' DBKEY            * DBERR 27 *   CLE033
     C                     Z-ADD27        DBASE            ************   CLE033
     C                     OUT  LDA                                       CLE033
     C                     EXSR *PSSR                                     CLE033
     C                     ENDIF                                          CLE033
     C*                                                                   CLE033
     C                     ENDIF                                          CLE033
     C*                                                                   CLE033
      *                                                                                       CAS009
      ** Determine if SAR CAS009 is installed                                                 CAS009
      *                                                                                       CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANKS   @RTCD                                               CAS009
     C                     PARM '*VERIFY '@OPTN                                               CAS009
     C                     PARM 'CAS009'  @SARD   6                                           CAS009
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS009
      *                                                                                       CAS009
     C           @RTCD     IFNE *BLANKS                                                       CAS009
     C           @RTCD     ANDNE'*NRF   '                                                     CAS009
     C                     MOVEL'SCSARDPD'DBFILE                                              CAS009
     C                     Z-ADD67        DBASE                                               CAS009
     C                     MOVEL'CAS009'  DBKEY                                               CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           @RTCD     IFEQ *BLANKS                                                       CAS009
     C                     MOVE 'Y'       CAS009  1                                           CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE 'N'       CAS009                                              CAS009
     C                     ENDIF                                                              CAS009
     C/COPY WNCPYSRC,LEH01140
      *                                                                                       CAS009
      *                                                                                       CLE073
      ** Check whether CAR CLE073 is ON                                                       CLE073
      *                                                                                       CLE073
     C                     CALL 'AOSARDR0'                                                    CLE073
     C                     PARM *BLANK    PRTCD   7                                           CLE073
     C                     PARM '*VERIFY' POPTN   7                                           CLE073
     C                     PARM 'CLE073'  PSARD   6                                           CLE073
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE073
      *                                                                                       CLE073
     C           PRTCD     IFEQ *BLANK                                                        CLE073
     C                     MOVE 'Y'       CLE073  1                                           CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE 'N'       CLE073                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Check whether CAR CLE134 is ON                                                       CLE134
      *                                                                                       CLE134
     C                     CALL 'AOSARDR0'                                                    CLE134
     C                     PARM *BLANK    PRTCD   7                                           CLE134
     C                     PARM '*VERIFY' POPTN   7                                           CLE134
     C                     PARM 'CLE134'  PSARD   6                                           CLE134
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE134
      *                                                                                       CLE134
     C           PRTCD     IFEQ *BLANK                                                        CLE134
     C                     MOVE 'Y'       CLE134  1                                           CLE134
     C                     ELSE                                                               CLE134
     C                     MOVE 'N'       CLE134                                              CLE134
     C                     ENDIF                                                              CLE134
     C/COPY WNCPYSRC,LE0492C014
      *                                                                   CLE031
      ** Check whether SAR CLE031 is installed or not.                    CLE031
      *                                                                   CLE031
     C                     CALL 'AOSARDR0'                                CLE031
     C                     PARM *BLANK    PRTCD   7                       CLE031
     C                     PARM '*VERIFY' POPTN   7                       CLE031
     C                     PARM 'CLE031'  PSARD   6                       CLE031
     C           SCSARD    PARM SCSARD    DSFDY                           CLE031
      *                                                                   CLE031
     C           PRTCD     IFEQ *BLANK                                    CLE031
     C                     MOVE 'Y'       CLE031  1                       CLE031
      *                                                                   CLE031
     C                     ELSE                                           CLE031
      *                                                                   CLE031
     C                     MOVE 'N'       CLE031                          CLE031
     C           PRTCD     IFNE '*NRF   '                                 CLE031
     C           *LOCK     IN   LDA                                       CLE031
     C                     MOVEL'LE0492  'DBPGM                           CLE031
     C                     MOVEL'SCSARDPD'DBFILE                          CLE031
     C                     Z-ADD53        DBASE                           CLE031
     C                     MOVEL'CLE031'  DBKEY                           CLE031
     C                     OUT  LDA                                       CLE031
     C                     EXSR *PSSR                                     CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
     C*                                                                                       CLE034
     C**  Read switchable features file SCSARDPD using access object                          CLE034
     C**  to determine if switchable feature (CLE034) is switched ON                          CLE034
     C*                                                                                       CLE034
     C                     CALL 'AOSARDR0'                                                    CLE034
     C                     PARM *BLANKS   W0RTCD  7                                           CLE034
     C                     PARM '*VERIFY' W0OPTN  7                                           CLE034
     C                     PARM 'CLE034'  W0SARD  6                                           CLE034
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE034
     C*                                                                                       CLE034
     C**  If feature is on, set up CLE034 indicator                                           CLE034
     C*                                                                                       CLE034
     C           W0RTCD    IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034  1                                           CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'N'       CLE034                                              CLE034
     C*                                                                                       CLE034
     C** else, database error (if return code other than *NRF)                                CLE034
     C*                                                                                       CLE034
     C           W0RTCD    IFNE '*NRF   '                                                     CLE034
     C                     MOVEL'LE0492'  DBPGM                                               CLE034
     C                     MOVEL'SCSARDPD'DBFILE           ************                       CLE034
     C                     MOVEL'CLE034 ' DBKEY            * DBERR 58 *                       CLE034
     C                     Z-ADD58        DBASE            ************                       CLE034
     C                     SETON                     U7U8LR                                   CLE034
     C                     END                                                                CLE034
     C                     ENDIF                                                              CLE034
     C*                                                                                       CLE034
      ** Check if Syndications Manager CLE106 is available                                    CLE106
      *                                                                                       CLE106
     C                     CALL 'AOSARDR0'                                                    CLE106
     C                     PARM *BLANKS   W0RTCD                                              CLE106
     C                     PARM '*VERIFY' W0OPTN                                              CLE106
     C                     PARM 'CLE106'  W0SARD                                              CLE106
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE106
      *                                                                                       CLE106
     C                     MOVE 'N'       CLE106  1                                           CLE106
     C           W0RTCD    IFEQ *BLANKS                                                       CLE106
     C                     MOVE 'Y'       CLE106                                              CLE106
     C                     ENDIF                                                              CLE106
      *                                                                                       CER049
      ** Determine if CER049 enhancement is installed                                         CER049
      *                                                                                       CER049
     C                     CALL 'AOSARDR0'                                                    CER049
     C                     PARM *BLANKS   W0RTCD                                              CER049
     C                     PARM '*VERIFY' W0OPTN                                              CER049
     C                     PARM 'CER049'  W0SARD                                              CER049
     C           SCSARD    PARM SCSARD    DSFDY                                               CER049
      *                                                                                       CER049
      ** If feature is on, set up SAR work flag                                               CER049
      *                                                                                       CER049
     C           W0RTCD    IFEQ *BLANKS                                                       CER049
     C                     MOVE 'Y'       CER049                                              CER049
     C                     ELSE                                                               CER049
     C                     MOVE 'N'       CER049  1                                           CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CLE141
      ** Determine if CLE141 is switched on                                                   CLE141
      *                                                                                       CLE141
     C                     MOVE 'N'       CLE141  1                                           CLE141
     C                     CALL 'AOSARDR0'                                                    CLE141
     C                     PARM *BLANKS   W0RTCD                                              CLE141
     C                     PARM '*VERIFY' W0OPTN                                              CLE141
     C                     PARM 'CLE141'  W0SARD                                              CLE141
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE141
     C           W0RTCD    IFEQ *BLANKS                                                       CLE141
     C                     MOVEL'Y'       CLE141                                              CLE141
     C                     ENDIF                                                              CLE141
      *                                                                                       CLE071
      ** Access SAR details to see if CLE071 is enabled.                                      CLE071
      *                                                                                       CLE071
     C                     MOVE 'N'       CLE071  1                                           CLE071
     C                     CALL 'AOSARDR0'                                                    CLE071
     C                     PARM *BLANKS   PRTCD                                               CLE071
     C                     PARM '*VERIFY' POPTN                                               CLE071
     C                     PARM 'CLE071'  PSARD                                               CLE071
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE071
      *                                                                                       CLE071
     C           PRTCD     IFEQ *BLANKS                                                       CLE071
     C                     MOVE 'Y'       CLE071                                              CLE071
     C                     ENDIF                                                              CLE071
      *
      ***  Call access program for Customer Lending details (BPGEEB)
      *
     C                     CALL 'AOCLNDR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C********** SDCLND    PARM SDCLND    DSFDY                                               CLE134
     C           SDCLND    PARM SDCLND    DSSDY                                               CLE134
     C           WRTCD     IFNE *BLANKS                    ***B001
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVEL'*READ   'DBKEY
     C                     MOVE 'SDCLNDPD'DBFILE           ************
     C                     Z-ADD2         DBASE            * DBERR 02 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END                             ***E001
      *****************************************************************            MD035545 MD047993
      ***Access*general*ledger*details.********************************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*DBERR ' @RTCD                                    MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN                                    MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
      ** Retrieve system value setting.                                                     MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   W0RTCD                                            MD035545
     C                     PARM           P@OP01                                            MD035545
     C                     PARM           P@VL01                                            MD035545
     C                     PARM           P@OP02                                            MD035545
     C                     PARM           P@VL02                                            MD035545
     C                     PARM           P@OP03                                            MD035545
     C                     PARM           P@VL03                                            MD035545
     C                     PARM           P@OP04                                            MD035545
     C                     PARM           P@VL04                                            MD035545
     C                     PARM           P@OP05                                            MD035545
     C                     PARM           P@VL05                                            MD035545
     C                     PARM           P@OP06                                            MD035545
     C                     PARM           P@VL06                                            MD035545
     C                     PARM           P@OP07                                            MD035545
     C                     PARM           P@VL07                                            MD035545
     C                     PARM           P@OP08                                            MD035545
     C                     PARM           P@VL08                                            MD035545
     C                     PARM           P@OP09                                            MD035545
     C                     PARM           P@VL09                                            MD035545
     C                     PARM           P@OP10                                            MD035545
     C                     PARM           P@VL10                                            MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'.                            MD035545
      *                                                                                     MD035545
     C           W0RTCD    IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
     C***********                                                  101322 133888
     C***Access*SDGELRPD*for*Accrue*on*Last*Day*indicator          101322 133888
     C***********                                                  101322 133888
     C***********          CALL 'AOGELRR0'                         101322 133888
     C***********          PARM '*MSG   ' WRTCD   7                101322 133888
     C***********          PARM '*FIRST ' WOPTN   7                101322 133888
     C***********SDGELR    PARM SDGELR    DSFDY                    101322 133888
     C***********WRTCD     IFNE *BLANKS                            101322 133888
     C************LOCK     IN   LDA                                101322 133888
     C***********          MOVEL'*READ   'DBKEY                    101322 133888
     C***********          MOVEL'LE0492'  DBPGM     ************   101322 133888
     C***********          MOVEL'SDGEFILE'DBFILE    * DBERR 23 *   101322 133888
     C***********          Z-ADD23        DBASE     ************   101322 133888
     C***********          OUT  LDA                                101322 133888
     C***********          EXSR *PSSR                              101322 133888
     C***********          END                                     101322 133888
      *
      ***  Define keylists used within program.
      *
     C           BDCHK     PLIST                                                              CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           ACCY                                                CLE141
     C                     PARM           ALOC                                                CLE141
     C                     PARM           PAYIND  1                                           CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           CCYLL   3                                          CLE141A
     C                     PARM           LOCLL   3                                          CLE141A
     C                     PARM *ZEROS    ZADJDT  50                                          CLE141
      *                                                                                       CLE141
     C           KEY001    KLIST
     C**********           KFLD           FCCNUM  60                                          CSD027
     C                     KFLD           FCCNUM  6                                           CSD027
     C                     KFLD           FCFACT  30
     C                     KFLD           FCFCNO  20
      *
     C           KEY002    KLIST
     C**********           KFLD           EVFCUS  60                                          CSD027
     C                     KFLD           EVFCUS  6                                           CSD027
     C                     KFLD           KYFACL  50
     C**********           KFLD           KYLOAN  60                                          CLE148
     C                     KFLD           KYLOAN  6                                           CLE148
      *
     C           KEY004    KLIST
     C                     KFLD           FECNUM
     C                     KFLD           FEFACL
     C                     KFLD           STDATE
     C                     KFLD           STFSEQ
      *
     C           KEY005    KLIST
     C                     KFLD           FECNUM
     C                     KFLD           FEFACL
      *
     C           KEY006    KLIST
     C                     KFLD           FECNUM
     C                     KFLD           FACT
     C                     KFLD           FCNO
     C*                                                                   060308
     C           KEY007    KLIST                                          060308
     C                     KFLD           FCUSL3                          060308
     C                     KFLD           FTYPL3                          060308
     C                     KFLD           FSEQL3                          060308
      *                                                                                     BUG11071
     C           KEY008    KLIST                                                            BUG11071
     C**********           KFLD           WECNUM  60                                BUG11071 CSD027A
     C                     KFLD           WECNUM  6                                          CSD027A
     C                     KFLD           WEFACL  50                                        BUG11071
     C**********           KFLD           WELOAN  60                                 BUG11071 CLE148
     C                     KFLD           WELOAN  6                                           CLE148
     C                     KFLD           WEFSEQ  20                                        BUG11071
      *                                                                                     MD030700
     C           KEY009    KLIST                                                            MD030700
     C                     KFLD           KACKEY                                            MD030700
     C                     KFLD           FECNUM                                            MD030700
     C                     KFLD           KLNNO                                             MD030700
     C                     KFLD           FEFSEQ                                            MD030700
      *                                                                                     MD030700
     C           KEY010    KLIST                                                            MD030700
     C                     KFLD           FFCNUM                                            MD030700
     C                     KFLD           FFFACL                                            MD030700
     C                     KFLD           FFLOAN                                            MD030700
     C                     KFLD           FFFSEQ                                            MD030700
      *                                                                                       CLE071
     C           KEY011    KLIST                                                              CLE071
     C                     KFLD           FECNUM                                              CLE071
     C                     KFLD           FEFACL                                              CLE071
     C                     KFLD           FELOAN                                              CLE071
     C                     KFLD           FEFSEQ                                              CLE071
     C                     KFLD           WSTART                                              CLE071
      *                                                                                       CLE071
     C           KEY012    KLIST                                                              CLE071
     C                     KFLD           FECNUM                                              CLE071
     C                     KFLD           FEFACL                                              CLE071
     C                     KFLD           FELOAN                                              CLE071
     C                     KFLD           FEFSEQ                                              CLE071
      *                                                                                       CLE071
      *                                                                                      243496B
      ** Define key list for read of LEFEAM file.                                            243496B
      *                                                                                      243496B
     C           FEAAMT    KLIST                                                             243496B
     C                     KFLD           FEBRCA                                             243496B
     C                     KFLD           FECNUM                                             243496B
     C                     KFLD           FEFACL                                             243496B
     C                     KFLD           FELOAN                                             243496B
     C                     KFLD           FEFSEQ                                             243496B
      *                                                                                       CER049
      ** Define key list for read of LEFEEDQD file                                            CER049
      *                                                                                       CER049
     C           FEEDQD    KLIST                                                              CER049
     C                     KFLD           FECNUM                                              CER049
     C                     KFLD           FEFACL                                              CER049
     C                     KFLD           FELOAN                                              CER049
     C                     KFLD           FEFSEQ                                              CER049
      *
      ***  Control date has previously been worked out in LER135
      ***  and held on data area LESTAT.
      *                                                                                       CLE073
      ** KLIST for file CLOAN                                                                 CLE073
      *                                                                                       CLE073
     C           KLOAN     KLIST                                                              CLE073
     C                     KFLD           FELOAN                                              CLE073
     C                     KFLD           WCLRT   1                                           CLE073
     C                     MOVE 'A'       WCLRT                                               CLE073
      *                                                                                       CLE073
      ** Key to access HISTSHP                                                                CLE073
      *                                                                                       CLE073
     C           KEYHST    KLIST                                                              CLE073
     C                     KFLD           FEBRCA                                              CLE073
     C                     KFLD           FECNUM                                              CLE073
     C                     KFLD           FELOAN                                              CLE073
     C                     KFLD           WVDAT   50                                          CLE073
     C                     KFLD           WLASN   30                                          CLE073
     C                     Z-ADD999       WLASN                                               CLE073
      *                                                                                       CLE073
      ** Partial Key to process HISTSHP                                                       CLE073
      *                                                                                       CLE073
     C           KEYPHS    KLIST                                                              CLE073
     C                     KFLD           FEBRCA                                              CLE073
     C                     KFLD           FECNUM                                              CLE073
     C                     KFLD           FELOAN                                              CLE073
      *                                                                                     MD048400
     C           KEYPDI    KLIST                                                            MD048400
     C                     KFLD           WRECI   1                                         MD048400
     C                     KFLD           WPLON   6                                         MD048400
     C                     KFLD           WPDCT   1                                         MD048400
      *                                                                                     MD048400
     C           KEYPDF    KLIST                                                            MD048400
     C                     KFLD           WRECI                                             MD048400
     C                     KFLD           WPLON                                             MD048400
      *
     C           *NAMVAR   DEFN           LESTAT
     C                     IN   LESTAT
      *                                                                     0029
      ***  Define RUNDAT                                                    0029
      *                                                                     0029
     C           *NAMVAR   DEFN           RUNDAT                            0029
     C                     IN   RUNDAT                                      0029
      *
      ** Define LDA
     C           *NAMVAR   DEFN           LDA
      *
      ***  Set up currency array
      *
     C                     Z-ADD0         X       30
     C                     OPEN SDCURRPD                                                      CSC042
     C                     READ SDCURRPD                 01
      *
      ***  Database error if currency file empty at this stage.
     C           *IN01     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVEL'*READ   'DBKEY
     C                     MOVE 'SDCURRPD'DBFILE           ************
     C                     Z-ADD3         DBASE            * DBERR 03 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *
     C           *IN01     DOWEQ'0'                        ***B001
      *
     C           X         IFLE 150                        ***B002
     C           X         ADD  1         X
     C                     MOVE A6CYCD    CURR,X
     C                     Z-ADDA6SPRT    CSPT,X
     C                     MOVELA6MDIN    MTDV,X
     C                     Z-ADDA6NBDP    CCDP,X
     C                     Z-ADDA6SSNB    CCNO,X
     C                     MOVE A6INCY    INCY,X                                              CSC042
     C                     Z-ADDA6TXND    TXDY,X                                              CSC042
     C                     END                             ***E002
      *
     C                     READ SDCURRPD                 01
      *
     C                     END                             ***E001
     C                     CLOSESDCURRPD                                                      CSC042
     C/COPY WNCPYSRC,LE0492C009
      *
      *** Set-up array of branch internal customer numbers.
      *
     C                     READ SDBRCHPD                 02
      *
     C           *IN02     IFEQ '0'                        ***B001
     C                     Z-ADD1         I       30
      *
     C           *IN02     DOWEQ'0'                        ***B002
      *
      *** Only store details if the branch internal customer number is
      *** not blank.
      *
     C           A8BICN    IFNE *BLANKS                    ***B003
     C                     MOVE A8BICN    BCA,I
     C                     ADD  1         I
     C                     END                             ***E003
      *
     C                     READ SDBRCHPD                 02
      *
     C                     END                             ***E002
      *
     C                     ELSE                            ***X001
      *
      *** If no details found on SDBRCHPD then output database error
      *
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVEL'*READ   'DBKEY
     C                     MOVE 'SDBRCHPD'DBFILE           ************
     C                     Z-ADD4         DBASE            * DBERR 04 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
      *
     C                     END                             ***E001
      *
     C                     SETOF                     02
      *
      *** Initialise record counts
      *
      *****************************************************************
      *** Count1 =  All 'A' type facility records
      *** Count2 =  Live, expired & closed events output to events file
      *** Count3 =  Records output to facility-based pay/receive file
      *** Count4 =  Records output to loan-based pay/receive file
      *** Count5 =  Records output to loan-based customer bills/telex
      *** Count6 =  Records output to facility-based customer bills/tlx
      *** Count7 =  Records added to loan-based pay/receive file            0055
      *** Count8 =  Records added to loan-based customer bills/telex        0055
      *
     C                     Z-ADD2         COUNT1  50
     C*
     C***********          READ OLVENTZZ                 20               045634
     C           *LOVAL    SETLLLVENTZZF                                  045634
     C                     READ LVENTZZF                 20               045634
     C           *IN20     IFEQ '0'
     C**********           Z-ADDNORE      COUNT2  50                        0031
     C**********           Z-ADDNORE      COUNTL  50                  0031105140
     C**********           Z-ADDNORE      NORELV  50                      105140
     C                     Z-ADDNORE0     COUNTL  90                      105140
     C                     Z-ADDNORE0     NORELV  90                      105140
     C                     Z-ADDHRWN      HRWN2  150
     C                     Z-ADDHRDC      HRDC2   30
     C                     ELSE
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVEL'*READ   'DBKEY
     C                     MOVE 'LVENTZZ 'DBFILE           ************
     C                     Z-ADD50        DBASE            * DBERR 50 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END
      *
      ***  Do not do Telexes,etc. on non-working day accrual run
      *
     C           *INU3     IFEQ '0'
     C*
     C*                                                                 0055
     C** Remove addition of header & trailer at this point as it        0055
     C** is wrong for the report                                        0055
     C*                                                                 0055
     C*********************Z-ADD2         COUNT3  50                    0055
      *
     C                     READ CUTX1ZXF                 20
     C           *IN20     IFEQ '0'
     C*                                                                   BH3461
     C                     MOVE 'Y'       TRCUT   1                       BH3461
     C*                                                                   BH3461
     C                     Z-ADDNORE2     COUNT5  50
     C*                                                                     0055
     C** Save the number of records on the file beforehand to allow         0055
     C** output of correct totals on the report                             0055
     C*                                                                     0055
     C                     Z-ADDNORE2     COUNT8  50                        0055
     C                     ELSE
     C*                                                                   BH3461
     C                     MOVE 'N'       TRCUT                           BH3461
     C*                                                                   BH3461
     C***  Write header if not one there already                          BH3461
     C*                                                                   BH3461
     C                     SETOF                     21                   BH3461
     C                     READ CUTX1HHF                 21               BH3461
     C           *IN21     IFEQ '0'                                       BH3461
     C                     MOVE 'H'       RECI                            BH3461
     C                     WRITECUTX1HHF                                  BH3461
     C                     END                                            BH3461
     C*                                                                   BH3461
     C***  Add 1 for trailer and 1 for header                             BH3461
     C*                                                                   BH3461
     C                     Z-ADD2         COUNT5                          BH3461
     C                     Z-ADD2         COUNT8                          BH3461
     C*                                                                   BH3461
     C********** *LOCK     IN   LDA                                       BH3461
     C**********           MOVEL'LE0492  'DBPGM                           BH3461
     C**********           MOVEL'*READ   'DBKEY                           BH3461
     C**********           MOVE 'CUTX1ZX 'DBFILE           ************   BH3461
     C**********           Z-ADD5         DBASE            * DBERR 05 *   BH3461
     C**********           OUT  LDA                        ************   BH3461
     C**********           EXSR *PSSR                                     BH3461
     C                     END
      *
     C                     READ LETLXZXF                 20
     C           *IN20     IFEQ '0'
     C*                                                                   BH3461
     C                     MOVE 'Y'       TRLET   1                       BH3461
     C*                                                                   BH3461
     C                     Z-ADDNORE1     COUNT4  50
     C*                                                                     0055
     C** Save the number of records on the file beforehand to allow         0055
     C** output of correct totals on the report                             0055
     C*                                                                     0055
     C                     Z-ADDNORE1     COUNT7  50                        0055
     C*                                                                     0055
     C                     ELSE
     C*                                                                   BH3461
     C                     MOVE 'N'       TRLET                           BH3461
     C*                                                                   BH3461
     C***  Write header if not one there already                          BH3461
     C*                                                                   BH3461
     C                     SETOF                     21                   BH3461
     C                     READ LOAMSDHF                 21               BH3461
     C           *IN21     IFEQ '0'                                       BH3461
     C                     MOVE 'H'       RECI                            BH3461
     C                     WRITELOAMSDHF                                  BH3461
     C                     END                                            BH3461
     C*                                                                   BH3461
     C***  Add 1 for trailer and 1 for header                             BH3461
     C*                                                                   BH3461
     C                     Z-ADD2         COUNT4                          BH3461
     C                     Z-ADD2         COUNT7                          BH3461
     C*                                                                   BH3461
     C********** *LOCK     IN   LDA                                       BH3461
     C**********           MOVEL'LE0492  'DBPGM                           BH3461
     C**********           MOVEL'*READ   'DBKEY                           BH3461
     C**********           MOVE 'LETLXZX 'DBFILE           ************   BH3461
     C**********           Z-ADD6         DBASE            * DBERR 06 *   BH3461
     C**********           OUT  LDA                        ************   BH3461
     C**********           EXSR *PSSR                                     BH3461
     C                     END
      *
     C*                                                                 0055
     C** Remove addition of header & trailer at this point as it        0055
     C** is wrong for the report                                        0055
     C*                                                                 0055
     C*********************Z-ADD2         COUNT6  50                    0055
      *
     C                     END
     C/COPY WNCPYSRC,LE0492CCP1                                           S01408
     C*
      ** LRU element key and record arrival sequence                                        CLE075AP
      *                                                                                     CLE075AP
     C                     Z-ADD0         NOSKEY 130                                        CLE075AP
     C           *LIKE     DEFN NOSKEY    NOSSEQ                                            CLE075AP
     C                     Z-ADD0         SETKEY 130                                        CLE075AP
     C           *LIKE     DEFN SETKEY    SETSEQ                                            CLE075AP
     C                     Z-ADD0         SA2KEY 130                                        CLE075AP
     C           *LIKE     DEFN SA2KEY    SA2SEQ                                            CLE075AP
      *                                                                                     CLE075AP
      ** Set start index to upper limit of LRU Caching arrays                               CLE075AP
      *                                                                                     CLE075AP
     C                     Z-ADD200       NOSIDX  40                                        CLE075AP
     C           *LIKE     DEFN NOSIDX    NOSPRV                                            CLE075AP
     C           *LIKE     DEFN NOSIDX    F                                                 CLE075AP
     C                     Z-ADD100       SETIDX  40                                        CLE075AP
     C           *LIKE     DEFN SETIDX    SETPRV                                            CLE075AP
     C           *LIKE     DEFN SETIDX    R                                                 CLE075AP
     C                     Z-ADD100       SA2IDX  40                                        CLE075AP
     C           *LIKE     DEFN SA2IDX    SA2PRV                                            CLE075AP
     C           *LIKE     DEFN SA2IDX    J                                                 CLE075AP
      *                                                                                     CLE075AP
      ** Initialize work fields of LRU array routines                                       CLE075AP
      *                                                                                     CLE075AP
     C                     MOVE *BLANKS   NOSIC   1                                         CLE075AP
     C                     MOVE *BLANKS   SETIC   1                                         CLE075AP
     C                     MOVE *BLANKS   SA2IC   1                                         CLE075AP
     C                     MOVE *BLANKS   KEYNOS  5                                         CLE075AP
     C                     MOVE *BLANKS   KEYSET 25                                         CLE075AP
     C                     MOVE *BLANKS   KEYSA2 20                                         CLE075AP
     C                     Z-ADD200       NOSPRV                                            CLE075AP
     C                     Z-ADD100       SETPRV                                            CLE075AP
     C                     Z-ADD100       SA2PRV                                            CLE075AP
     C                     Z-ADD200       F                                                 CLE075AP
     C                     Z-ADD100       R                                                 CLE075AP
     C                     Z-ADD100       J                                                 CLE075AP
      *                                                                                     CLE075AP
      ** Full Cache SDBRCHPD                                                                CLE075AP
      *                                                                                     CLE075AP
     C           1         SETLLSDBRCHPD                                                    CLE075AP
     C**********           Z-ADD900       A       30                               CLE075AP MD055146
     C                     Z-ADD999       A       30                                        MD055146
     C           A         OCUR SDBRCH                                                      CLE075AP
     C                     READ SDBRCHPD                 30                                 CLE075AP
     C                     MOVE A8BRCD    #BCH,A                                            CLE075AP
     C                     MOVE A8CMCD    CMPYM                                             MD020427
     C           *IN30     DOWEQ'0'                                                         CLE075AP
     C                     SUB  1         A                                                 CLE075AP
     C           A         OCUR SDBRCH                                                      CLE075AP
     C                     READ SDBRCHPD                 30                                 CLE075AP
     C                     MOVE A8BRCD    #BCH,A                                            CLE075AP
     C                     MOVE A8CMCD    CMPYM                                             MD020427
     C                     ENDDO                                                            CLE075AP
     C                     Z-ADDA         BCHARR  30                                        CLE075AP
      *                                                                                     CLE075AP
      ** Full Cache SDCTRYPD                                                                CLE075AP
      *                                                                                     CLE075AP
     C           *LOVAL    SETLLSDCTRYL1                                                    CLE075AP
     C                     Z-ADD400       B       30                                        CLE075AP
     C           B         OCUR SDCTRY                                                      CLE075AP
     C                     READ SDCTRYL1                 30                                 CLE075AP
     C                     MOVE A4CNCD    #CTY,B                                            CLE075AP
     C           *IN30     DOWEQ'0'                                                         CLE075AP
     C                     SUB  1         B                                                 CLE075AP
     C           B         OCUR SDCTRY                                                      CLE075AP
     C                     READ SDCTRYL1                 30                                 CLE075AP
     C                     MOVE A4CNCD    #CTY,B                                            CLE075AP
     C                     ENDDO                                                            CLE075AP
     C                     Z-ADDB         CTYARR  30                                        CLE075AP
      *                                                                                     CLE075AP
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              CSC042
     C********************************************************************CSC042
     C*                                                                   CSC042
     C*  ##CHKC  - Check the currency details                             CSC042
     C*                                                                   CSC042
     C********************************************************************CSC042
     C           ##CHKC    BEGSR                                          CSC042
      *                                                                   CSC042
     C           *LIKE     DEFN BJCYCD    ##KC                            CSC042
     C           *LIKE     DEFN Q         ##QSV                           CSC042
      *                                                                   CSC042
      * Set off the currency found indicator                              CSC042
     C                     MOVEL*BLANK    ##FIC   1                       CSC042
      *                                                                   CSC042
      * Save the state of indicator 87 so it can be reset at the end      CSC042
      * of the SR as it may be used elsewhere in the code                 CSC042
     C           *IN87     IFEQ *ON                                       CSC042
     C                     MOVEL'Y'       #IN87   1                       CSC042
     C                     ELSE                                           CSC042
     C                     MOVEL'N'       #IN87                           CSC042
     C                     END                                            CSC042
      *                                                                   CSC042
     C                     SETOF                         87               CSC042
      *                                                                   CSC042
      * Restore Q from ##QSV in case Q is used elsewhere in the code      CSC042
     C                     Z-ADD##QSV     Q       40                      CSC042
      *                                                                   CSC042
      * Are we looking for the same details as the last time this         CSC042
      * subroutine was called i.e. is Q already set correctly?            CSC042
      * If so then use the data rather than do another LOKUP              CSC042
      * First make sure that we don't reference the 0th array element     CSC042
     C           Q         IFEQ 0                                         CSC042
     C                     Z-ADD1         Q                               CSC042
     C                     END                                            CSC042
      * Now see if this search is same as last one performed              CSC042
      * If we have a match then seton 87 so the code after this           CSC042
      * subroutine knows it can use Q directly                            CSC042
     C           ##KC      IFEQ CURR,Q                                    CSC042
     C                     SETON                         87               CSC042
     C                     ELSE                                           CSC042
      * Otherwise hunt in the array and seton 87 if found                 CSC042
     C                     Z-ADD1         Q                               CSC042
     C           ##KC      LOKUPCURR,Q                   87               CSC042
     C                     END                                            CSC042
      *                                                                   CSC042
      * Save Q for next time                                              CSC042
     C           *IN87     IFEQ *ON                                       CSC042
     C                     Z-ADDQ         ##QSV                           CSC042
      * Set the indicator to show the data was found                      CSC042
     C                     MOVEL'Y'       ##FIC                           CSC042
     C                     END                                            CSC042
      *                                                                   CSC042
      * Reset the state of indicator 87.                                  CSC042
     C           #IN87     IFEQ 'Y'                                       CSC042
     C                     MOVEL*ON       *IN87                           CSC042
     C                     ELSE                                           CSC042
     C                     MOVEL*OFF      *IN87                           CSC042
     C                     END                                            CSC042
      *                                                                   CSC042
     C                     ENDSR                                          CSC042
      *                                                                   CSC042
     C********************************************************************CSC042
      /EJECT                                                              CSC042
     C********************************************************************CSC042
      *                                                                   CSC042
      * ##SETC - Sets up the fields from SDCURRPD (read from the arrays)  CSC042
      *          into the fields used by this program                     CSC042
     C********************************************************************CSC042
      *                                                                   CSC042
     C           ##SETC    BEGSR                                          CSC042
      *                                                                   CSC042
     C           *LIKE     DEFN A6NBDP    CDP                             CSC042
     C           *LIKE     DEFN A6TXND    TXND                            CSC042
      *                                                                   CSC042
     C                     MOVE CURR,Q    CCY                             CSC042
     C                     Z-ADDCSPT,Q    A6SPRT                          CSC042
     C                     MOVELMTDV,Q    A6MDIN                          CSC042
     C                     Z-ADDCCDP,Q    CDP                             CSC042
     C                     Z-ADDCCNO,Q    A6SSNB                          CSC042
     C                     MOVE INCY,Q    A6INCY                          CSC042
     C                     Z-ADDTXDY,Q    TXND                            CSC042
      *                                                                   CSC042
     C                     ENDSR                                          CSC042
     C********************************************************************CSC042
      /TITLE SR/PROCES
      *****************************************************************
      *                                                               *
      *  PROCES - SUBROUTINE TO PERFORM DETAIL PROCESSING.            *
      *                                                               *
      *  Called By: MAIN PROCESSING                                   *
      *                                                               *
      *  Calls:     EVENT, FEES, ZHASH, ZFWDT, AOCURRR0, SETLOC       *
      *             NONCAL                                            *
      *                                                               *
      *****************************************************************
      *
     C           PROCES    BEGSR
      *                                                                   CLE014
      ** Processing for Non-Credit Agreement Facility                     CLE014
      *                                                                   CLE014
      *
      ***  Read through the updated facilities file.
      *
     C**********           READ FCUPD                    03                 0025
     C                     READ FCLTY                    03                 0025
      *
     C           *IN03     DOWEQ'0'                        ***B001
      *
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           TRCA      ANDNE'CA'                                      CLE014
     C           CLE014    OREQ 'N'                                       CLE014
      *                                                                   CLE014
     C           RCTP      IFEQ 'A'                        ***B002
      *
      ***  Stores any fields that have same name on more than one
      ***  input file to prevent the data being incorrect when writing
      ***  to the new updated facilities file.
      *
     C**********           Z-ADDCNUM      WACNUM  60                                          CSD027
     C                     MOVE CNUM      WACNUM  6                                           CSD027
     C                     Z-ADDFACT      WAFACT  30
     C                     Z-ADDFCNO      WAFCNO  20
     C                     MOVE BRCA      WABRCA  3
     C                     MOVE FCCY      WAFCCY  3
     C                     MOVE CRSK      WACRSK  2
     C                     MOVE ACOF      WAACOF  2
     C                     Z-ADDLCD       WALCD   50
     C                     MOVE CHTP      WACHTP  1
     C                     Z-ADDTNLU      WATNLU  50
     C                     END                             ***E002
      *
     C           RCTP      IFEQ 'B'                        ***B002
     C**********           Z-ADDCNUM      WBCNUM  60                                          CSD027
     C                     MOVE CNUM      WBCNUM  6                                           CSD027
     C                     Z-ADDFACT      WBFACT  30
     C                     Z-ADDFCNO      WBFCNO  20
     C                     MOVE BTIN      WBBTIN  1
     C                     Z-ADDLCD       WBLCD   50
     C                     MOVE CHTP      WBCHTP  1
     C                     Z-ADDTNLU      WBTNLU  50
     C                     END                             ***E002
      *
      ***  Set up key fields to ensure only records for this
      ***  facility are being processed.
      *
     C                     MOVE RECI      FCRECI  1
     C                     MOVE BRCA      FCBRCA  3
     C**********           Z-ADDCNUM      FCCNUM                                              CSD027
     C                     MOVE CNUM      FCCNUM                                              CSD027
     C                     Z-ADDFACT      FCFACT
     C                     Z-ADDFCNO      FCFCNO
      *
      ***  Event & fee processing should be performed only on 'B'
      ***  records that are not closed.
      *
     C           RCTP      IFEQ 'B'                        ***B002
     C           RECI      ANDNE'C'
      *
      ***  Calculate billing date
      *
     C/COPY WNCPYSRC,LE0492C012
     C           RUND      ADD  BLDY      BDAYS   50
     C           BDAYS     IFLT BJDNWD                                                      MD029794
     C                     Z-ADDBJDNWD    BDAYS                                             MD029794
     C                     ENDIF                                                            MD029794
     C/COPY WNCPYSRC,LE0492C013
      *
      ***  Calculate general end day (15) for use in event processing
      *
     C                     MOVE FCCY      ZCCY
     C                     Z-ADD15        ZNRDYS
     C                     Z-ADDRUND      ZDAYNO
     C                     MOVE *BLANKS   ZLOC
     C                     EXSR ZFWDT
     C                     Z-ADDZDYNBR    ENAR1   50
      *
      ***  Use greater of BDAYS & ENAR1 as extract date.  This is the
      ***  date bill/telexes are produced up to.
      *
     C           BDAYS     IFGT ENAR1                      ***B003
     C                     Z-ADDBDAYS     EXDT1   50
     C                     ELSE                            ***X003
     C                     Z-ADDENAR1     EXDT1
     C                     END                             ***E003
      *
      ***  Read all event records for the facility; adjusting          s
      ***  available and exposure amounts as appropriate.
      *
     C                     EXSR EVENT
      *
      ***  Set up fee details.
      *
     C                     EXSR FEES
      *
     C                     END                             ***E002
      *
      ***  Initialise indicator used for setting up initial future
      ***  facility array
      *
     C                     MOVE '0'       *IN07
     C                     MOVE '0'       *IN19                           BH3528
     C                     ENDIF                                          CLE014
      *
      ***  Read next facility record
      *
     C**********           READ FCUPD                    03                 0025
     C**********           READ FCLTY                    03                            0025 CLE075AP
     C                     READ FCLTY                    03                                 MD021155
      *
     C**********           END                             ***E001                          CLE075AP
     C                     END                             ***E001                          MD021155
      *                                                                   CLE014
      ** Processing for Credit Agreement Facilties                        CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
      *                                                                   CLE014
     C********** *LOVAL    SETLLFCLTY                                                CLE014 CLE075AP
     C**********           READ FCLTY                    03                          CLE014 CLE075AP
     C           *LOVAL    SETLLFCLTY                                                       MD021155
     C                     READ FCLTY                    03                                 MD021155
      *                                                                   CLE014
      ** Process only the Credit Agreement Facilities                     CLE014
      ** Read through all the CA extract to get the correct credit        CLE014
      ** agreement amount from which the fees will be calculated          CLE014
      *                                                                   CLE014
     C********** *IN03     DOWEQ*OFF                                                 CLE014 CLE075AP
     C           *IN03     DOWEQ*OFF                                                        MD021155
      *                                                                   CLE014
     C           TRCA      IFEQ 'CA'                                      CLE014
      *                                                                   CLE014
     C                     EXSR SRPROC                                    CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C**********           ENDIF                                                   CLE075AP MD021155
     C                     READ FCLTY                    03               CLE014
     C**********           ENDDO                                                     CLE014 CLE075AP
     C                     ENDDO                                                            MD021155
      *                                                                   CLE014
     C**********           ENDIF                                                     CLE014 CLE075AP
     C**********           ENDDO                                                   CLE075AP MD021155
     C                     ENDIF                                                            MD021155
      *
      ********************************
      ***  Processing for Loan Fee ***
      ********************************
      *
      ***  This processing picks up fees on both live & matured loans
      *
     C                     MOVE '0'       *IN08
     C                     MOVEL*BLANK    WCALCF                                            MD052216
      *
     C           *LOVAL    SETLLLEFEEDL2                                    0068
     C                     READ LEFEEDL2                 08
      *
     C           *IN08     DOWEQ'0'                        ***B001
     C           FERECI    IFNE '*'                                                          BUG3729
     C           FERECI    ANDNE'R'                                                          BUG3729
     C           FERECI    ANDNE'M'                                                           259640
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C           FECALT    ORNE *BLANKS                                                     MD052216
     C           FEEDQD    CHAINLEFEEQL0             55                                       CER049
     C           *IN55     IFEQ *ON                                                           CER049
     C                     MOVEL'LE0492  'DBPGM                                               CER049
     C                     MOVEL'FEEDQD'  DBKEY                                               CER049
     C                     MOVE 'LEFEEDQD'DBFILE                                              CER049
     C                     Z-ADD55        DBASE                                               CER049
     C                     OUT  LDA                                                           CER049
     C                     EXSR *PSSR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *
      *** Calculate receive telex date using telex notice days from
      *** Settlement Allocation if CLE034 is on, or else from the                             CLE034
      *** currency file and settlement location details from fees
      *** file
      ***If settlement*method*is*09*and*postings*are*to*use*Transaction*****************218782218992
      ***currency,*do*not*look*up*settlement*allocations********************************218782218992
      *
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C***********CLE033    ANDNE'Y'                                                     218782218992
     C***********CLE034    OREQ 'Y'                                                     218782218992
     C***********FESTAL    ANDEQ'Y'                                                     218782218992
     C***********FERECI    ANDNE'*'                                                     218782218992
     C***********SETP      ANDNE09                                                      218782218992
     C***********CLE034    OREQ 'Y'                                                     218782218992
     C***********FESTAL    ANDEQ'Y'                                                     218782218992
     C***********FERECI    ANDNE'*'                                                     218782218992
     C***********SET09     ANDNE'T'                                                     218782218992
     C           PTFI      IFNE *BLANKS                                                       CLE034
     C                     MOVE 'E'       W#SMIN  1                                           CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'S'       W#SMIN                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADDRUND      PDAY    50                                          CLE034
     C                     MOVE FELOAN    PLNRF   6                                           CLE034
     C                     MOVE FECNUM    PCNUM   6                                           CLE034
     C                     MOVE FEFACL    PFACL   5                                           CLE034
     C                     MOVE FEFSEQ    PFSEQ   2                                           CLE034
      *                                                                                     CLE075AP
     C                     MOVE W#SMIN    WPSMI                                             CLE075AP
     C                     Z-ADDPDAY      WPDAY                                             CLE075AP
     C                     MOVE PLNRF     WPLRF                                             CLE075AP
     C                     MOVE PCNUM     WPCSF                                             CLE075AP
     C                     MOVE PFACL     WPFCF                                             CLE075AP
     C                     MOVE PFSEQ     WPFSQ                                             CLE075AP
     C                     MOVE WSTAL     KEYSET                                            CLE075AP
     C                     ADD  1         SETSEQ                                            CLE075AP
     C                     EXSR CHKSET                                                      CLE075AP
      *                                                                                     CLE075AP
      ** Use details from array if KEYSET is found, otherwise,                              CLE075AP
      ** retrieve details from program call                                                 CLE075AP
      *                                                                                     CLE075AP
     C           SETIC     IFEQ 'Y'                                                         CLE075AP
      *                                                                                     CLE075AP
      ** Set occurence to index found from #SEK array                                       CLE075AP
      *                                                                                     CLE075AP
     C                     Z-ADD#XND,R    PTLXND                                            CLE075AP
      *                                                                                     CLE075AP
     C                     ELSE                                                             CLE075AP
      *                                                                                     CLE075AP
     C           SETIDX    IFNE 0                                                           CLE075AP
     C                     Z-ADDSETIDX    R                                                 CLE075AP
     C                     ELSE                                                             CLE075AP
     C                     Z-ADD1         R                                                 CLE075AP
     C                     MOVEA#SET      #SES                                              CLE075AP
     C                     SORTA#SES                                                        CLE075AP
     C                     Z-ADD#SES,1    SETKEY                                            CLE075AP
     C           SETKEY    LOKUP#SET,R                   45                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C                     CALL 'AOSTALR1'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               222373
     C                     PARM '*TXDT  ' POPTN                                               CLE034
     C                     PARM           PDAY                                                CLE034
     C                     PARM *ZERO     PTYP                                                CLE034
     C                     PARM           W#SMIN                                              CLE034
     C                     PARM           FEFCCY                                              CLE034
     C                     PARM 'N'       PNCHK   1                                           CLE034
     C                     PARM 'FEES'    PTYPE   4                                           CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLNAVD  5                                           CLE034
     C                     PARM *BLANKS   PLNASQ  3                                           CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM *ZERO     PTLXND  50                                          CLE034
     C                     PARM *BLANK    PNOST   1                                           CLE034
      *                                                                                     CLE075AP
     C                     Z-ADDPTLXND    #XND,R                                            CLE075AP
     C                     EXSR ADDSET                                                      CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                       CLE034
     C                     Z-ADDPTLXND    WTXDT                                               CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, use transaction currency.                                                  218782
      *                                                                                       218782
     C           CLE033    IFEQ 'Y'                                                           218782
     C***********SETP      ANDEQ09                                                      218782218992
     C           FESTTL    ANDEQ09                                                            218992
     C           SET09     ANDEQ'T'                                                           218782
     C**********           MOVELFEFCCY    CURKEY                                       218782 CSC042
     C                     MOVELFEFCCY    CURKEY  3                                           CSC042
     C                     ELSE                                                               218782
      *                                                                                       218782
      ** Use settlement currency to retrieve the telex notice days and    160659
      ** location if CEU004 is on                                         160659
      *
     C           CEU004    IFEQ 'Y'                                       160659
     C           FESCCY    ANDNE*BLANKS                                   160659
     C                     MOVELFESCCY    CURKEY                          160659
     C                     ELSE                                           160659
     C                     MOVELFEFCCY    CURKEY
     C                     ENDIF                                          160659
      *                                                                   CLE031
      ** If CLE031 is active                                              CLE031
      *                                                                   CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
      *                                                                   CLE031
      ** If not a participant fee and receipt settlement ccy is present   CLE031
      ** use receipt settlement currency to determine telex notice days   CLE031
      *                                                                   CLE031
     C           PTFI      IFEQ *BLANKS                                   CLE031
     C           FESCCY    ANDNE*BLANKS                                   CLE031
     C                     MOVELFESCCY    CURKEY                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
      ** If a participant fee and pay settlement ccy is present           CLE031
      ** use pay settlement currency to determine telex notice days       CLE031
      *                                                                   CLE031
     C           PTFI      IFNE *BLANKS                                   CLE031
     C           FEPSCY    ANDNE*BLANKS                                   CLE031
     C                     MOVELFEPSCY    CURKEY                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                                              218782
      *                                                                   CLE031
     C**********           CALL 'AOCURRR0'                                                    CSC042
     C**********           PARM '*BLANKS' WRTCD                                               CSC042
     C**********           PARM '*KEY   ' WOPTN                                               CSC042
     C**********           PARM           CURKEY  3                                           CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                               CSC042
     C********** WRTCD     IFNE *BLANKS                    ***B002                            CSC042
     C                     MOVELCURKEY    ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
     C                     EXSR ##SETC                                                        CSC042
     C                     ELSE                                                               CSC042
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C**********           MOVE 'SDCURRPD'DBFILE           ************                       CSC042
     C                     MOVE 'CURR,Q  'DBFILE                                              CSC042
     C***********          MOVE FEFCCY    DBKEY            **DBERR*07**   160659
     C                     MOVE CURKEY    DBKEY            * DBERR 07 *   160659
     C                     Z-ADD7         DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             ***E002
      *
     C                     Z-ADDTXND      ZNRDYS
     C                     Z-ADDFESTTL    WKSTLL
     C                     MOVELFEOURS    WKOUR
      *
     C                     EXSR SETLOC
      *
     C                     MOVE WKSTBL    ZLOC
      *
      *** Use notice days & location information to obtain receive
      *** telex date
      *
     C                     EXSR ZFWDT
     C*
     C                     Z-ADDZDYNBR    WTXDT
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                     BUG11071
      ** Save Key Fields  - KEY008                                                          BUG11071
      *                                                                                     BUG11071
     C**********           Z-ADDFECNUM    WECNUM                                    BUG11071 CSD027A
     C                     MOVELFECNUM    WECNUM                                             CSD027A
     C                     Z-ADDFEFACL    WEFACL                                            BUG11071
     C**********           Z-ADDFELOAN    WELOAN                                     BUG11071 CLE148
     C                     MOVELFELOAN    WELOAN                                              CLE148
     C                     Z-ADDFEFSEQ    WEFSEQ                                            BUG11071
      *
      ***  Check if fee due this run
      *
     C                     MOVE 'L'       WKLNFE  1                         0068
     C/COPY WNCPYSRC,LE0492C015
     C                     EXSR NONCAL
     C                     MOVE ' '       WKLNFE                            0068
      *
     C                     ENDIF                                                             BUG3729
      *                                                                                     MD030700
      ** For Matured Fees                                                                   MD030700
      *                                                                                     MD030700
     C           FERECI    IFEQ 'M'                                                         MD030700
      *                                                                                     MD030700
     C                     MOVE 'L'       WKLNFE                                            MD030700
     C                     EXSR MCBILL                                                      MD030700
      *                                                                                     MD030700
     C                     ENDIF                                                            MD030700
      *                                                                                     MD030700
     C                     READ LEFEEDL2                 08
      *
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/EVENT
      *****************************************************************
      *                                                               *
      *  EVENT  - SUBROUTINE TO PROCESS EVENT RECORDS                 *
      *                                                               *
      *  Called By: PROCES                                            *
      *                                                               *
      *  Calls    : CONV, AVAIL, UFAMT, EXPSR, ZHASH                  *
      *                                                               *
      *****************************************************************
      *
     C           EVENT     BEGSR
      *
      ***  Obtain all event details for the facility being processed.
      *
     C           KEY001    SETLLLVENTELF
     C           KEY001    READELVENTELF                 04
      *                                                                   052445
      ***  If no events, set flag for post-control date processing.       052445
      ***  (No events as nothing is drawn against the facility).          052445
      *                                                                   052445
     C                     MOVE ' '       FOURON  1                       052445
     C           *IN04     IFEQ '1'                                       052445
     C                     MOVE 'Y'       FOURON                          052445
     C                     END                                            052445
      *
     C           *IN04     DOWEQ'0'                        ***B001
      *
      ***  Save record ID for output later
      *
     C                     MOVE RECI      LERECI  1
      *
      ***  Add 1 to LVENT count for each record read in
      *
     C**********           ADD  1         COUNTL                            0031
     C                     ADD  1         COUNT2                            0031
      *
      ***  Only process event further if this is not an inter-branch
      ***  event.
      *
     C           IBRE      IFNE 'Y'                        ***B002
      *
     C           PTP       IFEQ '64'                       ***B003
     C           PTP       OREQ '65'
     C           PTP       OREQ '66'
     C           PTP       OREQ '67'
      *                                                                   CLE005
      ** If SAR CLE005 is installed, include PTP 68,69,71 and 72          CLE005
      *                                                                   CLE005
     C           PTP       OREQ '68'                                      CLE005
     C           CLE005    ANDEQ*ON                                       CLE005
     C           PTP       OREQ '69'                                      CLE005
     C           CLE005    ANDEQ*ON                                       CLE005
     C           PTP       OREQ '71'                                      CLE005
     C           CLE005    ANDEQ*ON                                       CLE005
     C           PTP       OREQ '72'                                      CLE005
     C           CLE005    ANDEQ*ON                                       CLE005
      *
      *** Find out if customer is a branch internal customer, if so
      *** availability as this is an inter-branch participation.
      *
     C                     MOVE CNUM      WCNUM   6
      *
     C           WCNUM     LOKUPBCA                      05
      *
     C                     END                             ***E003
      *
      ***  If event type 'I2' and incoming/outgoing indicator is
      ***  blank this is a capitalised interest repayment event.
      ***  Flag for use later.
      *
     C                     MOVE '0'       *IN06                             0076
     C           ETP       IFEQ 'I2'                       ***B003
     C           INOI      ANDEQ*BLANKS
     C                     MOVE '1'       *IN06
     C                     END                             ***E003
      *
      ***  Dummy event updating
      *
     C           ETP       IFEQ 'A1'                       ***B003
      *
      ***  Changes to exposure or availability must be done in
      ***  the facility currency so if event currency different
      ***  the event amount needs to be converted.
      *
     C                     MOVE ECCY      INCCY   3
     C                     MOVE FCCY      OUTCCY  3
     C                     Z-ADDEAMT      WEAMT  130
      *
     C/COPY WNCPYSRC,LE0492C003
     C***Use*the*facility*currency*exchange*rate*from*loan*details*101857 162343
     C***when*converting*the*amount********************************101857 162343
     C***********                                                  101857 162343
     C***********          MOVE 'Y'       @LFXRT  1                101857 162343
      *                                                                                       199588
      ** Use the facility currency exchange rate from loan details                            199588
      ** when converting the amount                                                           199588
      *                                                                                       199588
     C                     MOVE 'Y'       @LFXRT  1                                           199588
     C                     EXSR CONV
     C***********          MOVE 'N'       @LFXRT                   101857 162343
     C                     MOVE 'N'       @LFXRT                                              199588
     C/COPY WNCPYSRC,LE0492C004
      *
      ***  Update facility amount and drawn amount array for
      ***  fee calculations.
      *
     C                     EXSR UFAMT
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           CLE005    IFEQ *ON                                       CLE014
     C           TRCA      ANDEQ'TR'                                      CLE014
     C           PRTR      IFNE 'P'                                       CLE014
     C           PRTR      ANDNE'I'                                       CLE014
     C           PRTR      ANDNE'S'                                                           CLE106
     C           PRTR      ANDNE'R'                                                           CLE106
     C                     EXSR SRMOVE                                    CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
      *
      ***  End for if equal to dummy event
      *
     C                     END                             ***E003
      *
      ***  Check that event is a valid event as held on event array
      *
     C           ETP       IFNE 'A1'                       ***B003
     C           *IN06     ANDNE'1'
     C           ETP       LOKUPTABVAL                   07
     C                     END                             ***E003
      *
      ***  If valid event or 'I2' with blank input/output indicator
      ***  compare event date and extract date.
      *
     C           *IN07     IFEQ '1'                        ***B003
     C           *IN06     OREQ '1'
      *
      ***  Only process events that are not greater than extract
      ***  date or maturity events with an extract date of zero.
      *
     C           EDAT      IFLE EXDT1                      ***B004
     C           EDAT      ANDNE0
      *
      ***  Obtain currency details
      *
      ***  Changes to exposure or availability must be done in
      ***  the facility currency so if event currency different
      ***  the event amount needs to be converted.
      *
     C                     MOVE ECCY      INCCY
     C                     MOVE FCCY      OUTCCY
     C                     Z-ADDEAMT      WEAMT
      *
     C/COPY WNCPYSRC,LE0492C005
     C***Use*the*facility*currency*exchange*rate*from*loan*details*101857 162343
     C***when*converting*the*amount********************************101857 162343
     C***********                                                  101857 162343
     C***********          MOVE 'Y'       @LFXRT                   101857 162343
      *                                                                                       199588
      ** Use the facility currency exchange rate from loan details                            199588
      ** when converting the amount                                                           199588
      *                                                                                       199588
     C                     MOVE 'Y'       @LFXRT                                              199588
     C                     EXSR CONV
     C***********          MOVE 'N'       @LFXRT                   101857 162343
     C                     MOVE 'N'       @LFXRT                                              199588
     C/COPY WNCPYSRC,LE0492C006
      *
      ***  If event is a non-revolving credit repayment then update
      ***  facility amount array - this is used for future fee calc.
      *
     C***********ETP       IFEQ 'R1'                       ***B005        045634
     C***********RVCR      ANDNE'Y'                                       045634
     C***********ETP       OREQ 'M1'                                      045634
     C***********RVCR      ANDNE'Y'                                       045634
     C           *IN05     IFEQ '0'                        ***B005        045634
     C                     EXSR UFAMT
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C           CLE005    IFEQ *ON                                       CLE014
     C           TRCA      ANDEQ'TR'                                      CLE014
     C           PRTR      IFNE 'P'                                       CLE014
     C           PRTR      ANDNE'I'                                       CLE014
     C           PRTR      ANDNE'S'                                                           CLE106
     C           PRTR      ANDNE'R'                                                           CLE106
     C                     EXSR SRMOVE                                    CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C                     ENDIF                                          CLE014
     C***********          MOVE '1'       *IN19                           045634
     C                     END                             ***E005
      *
      *** End for if EDAT LE EXDT1
      *
     C                     END                             ***E004
      *
      *** End for if 06 & 07
      *
     C                     END                             ***E003
      *
      *** End for if multibranching
      *
     C                     END                             ***E002
      *
      ***  DELETE DUMMY EVENTS                                              0076
      *                                                                     0076
     C           ETP       IFEQ 'A1'                                        0076
     C***********          DELETLVENTELF                             0076 045634
     C*                                                                     0084
     C** Count the number of deletions so that the trailer can be           0084
     C** updated                                                            0084
     C*                                                                     0084
     C                     ADD  1         DELSC                             0084
     C                     ELSE                                           045634
     C/COPY WNCPYSRC,LE0492C002
     C*                                                                   045634
     C** All events other than dummy (A1) events are output               045634
     C                     WRITEOLVENTEL                                  045634
     C                     END                                              0076
      *                                                                     0076
     C           KEY001    READELVENTELF                 04
      *
      * End for do while
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      *                                                               *   CLE014
      *  SRPROC - Processing for the credit agreement                 *   CLE014
      *                                                               *   CLE014
      *  Called By: EVENT                                             *   CLE014
      *                                                               *   CLE014
      *  Calls:     None                                              *   CLE014
      *                                                               *   CLE014
      *****************************************************************   CLE014
     C           SRPROC    BEGSR                                          CLE014
      *                                                                   CLE014
      ** Set up key fields to ensure only records for this                CLE014
      ** facility are being processed.                                    CLE014
      *                                                                   CLE014
     C**********           Z-ADDCNUM      FCCNUM                                       CLE014 CSD027
     C                     MOVE CNUM      FCCNUM                                              CSD027
     C                     Z-ADDFACT      FCFACT                          CLE014
     C                     Z-ADDFCNO      FCFCNO                          CLE014
      *                                                                   CLE014
      ** Save the revolving credit indicator of the credit agreemet       CLE014
      *                                                                   CLE014
     C                     MOVE RVCR      WRVCR   1                       CLE014
      *                                                                   CLE014
      ** If CLE005 is installed, read through all the credit ageement     CLE014
      ** records on file and process each the same was as the             CLE014
      ** tranches to create the fee events                                CLE014
      *                                                                   CLE014
     C           CLE005    IFEQ *ON                                       CLE014
      *                                                                   CLE014
      ** Read all records for the same credit agreement                   CLE014
      *                                                                   CLE014
     C           KEY001    SETLLLECAFEL0                                  CLE014
     C           KEY001    READELECAFEL0                 24               CLE014
      *                                                                   CLE014
      ** If no details exist for the credit agreement, perform            CLE014
      ** the same processing as for the tranches                          CLE014
      *                                                                   CLE014
     C           *IN24     IFEQ *ON                                       CLE014
      *                                                                   CLE014
      ** Event & fee processing should be performed only on 'B'           CLE014
      ** records that are not closed.                                     CLE014
      *                                                                   CLE014
     C           RCTP      IFEQ 'B'                                       CLE014
     C           RECI      ANDNE'C'                                       CLE014
      *                                                                   CLE014
      ** Calculate billing date                                           CLE014
      *                                                                   CLE014
     C           RUND      ADD  BLDY      BDAYS                           CLE014
     C           BDAYS     IFLT BJDNWD                                                      MD029794
     C                     Z-ADDBJDNWD    BDAYS                                             MD029794
     C                     ENDIF                                                            MD029794
      *                                                                   CLE014
      ** Calculate general end day (15) for use in event processing       CLE014
      *                                                                   CLE014
     C                     MOVE FCCY      ZCCY                            CLE014
     C                     Z-ADD15        ZNRDYS                          CLE014
     C                     Z-ADDRUND      ZDAYNO                          CLE014
     C                     MOVE *BLANKS   ZLOC                            CLE014
     C                     EXSR ZFWDT                                     CLE014
     C                     Z-ADDZDYNBR    ENAR1                           CLE014
      *                                                                   CLE014
      ** Use greater of BDAYS & ENAR1 as extract date.  This is the       CLE014
      ** date bill/telexes are produced up to.                            CLE014
      *                                                                   CLE014
     C           BDAYS     IFGT ENAR1                                     CLE014
     C                     Z-ADDBDAYS     EXDT1                           CLE014
     C                     ELSE                                           CLE014
     C                     Z-ADDENAR1     EXDT1                           CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** Read all event records for the facility; adjusting               CLE014
      ** available and exposure amounts as appropriate.                   CLE014
      *                                                                   CLE014
     C                     EXSR EVENT                                     CLE014
      *                                                                   CLE014
      ** Set up fee details                                               CLE014
      *                                                                   CLE014
     C                     EXSR FEES                                      CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** If details exist for the credit agreement                        CLE014
      *                                                                   CLE014
     C           *IN24     IFEQ *OFF                                      CLE014
     C           RCTP      ANDEQ'B'                                       CLE014
     C           RECI      ANDNE'C'                                       CLE014
      *                                                                   CLE014
     C                     MOVE *OFF      *IN19                           CLE014
      *                                                                   CLE014
     C           *IN24     DOWEQ*OFF                                      CLE014
      *                                                                   CLE014
     C                     Z-ADDCAEAMT    EAMT                            CLE014
     C                     Z-ADDCAEAMT    WEAMT                           CLE014
     C                     MOVE CAPTP     PTP                             CLE014
     C                     Z-ADDCAEDAT    EDAT                            CLE014
     C                     MOVE CARCSI    RCSI                            CLE014
     C                     MOVE CAETP     ETYP                            CLE014
      *                                                                   CLE014
      ** Use the tranche's revolving credit indicator                     CLE014
      *                                                                   CLE014
     C           WRVCR     IFEQ 'T'                                       CLE014
     C                     MOVE CATRRC    RVCR                            CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** Update facility amount and drawn amount array for                CLE014
      ** fee calculations                                                 CLE014
      *                                                                   CLE014
     C                     EXSR UFAMT                                     CLE014
      *                                                                   CLE014
     C           KEY001    READELECAFEL0                 24               CLE014
     C                     ENDDO                                          CLE014
      *                                                                   CLE014
      ** Set up fee details                                               CLE014
      *                                                                   CLE014
     C                     EXSR FEES                                      CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C                     ENDSR                                          CLE014
      *****************************************************************   CLE014
      /EJECT                                                              CLE014
      *****************************************************************   CLE014
      *                                                               *   CLE014
      *  SRMOVE - Subroutine to save the tranche/loan/event details   *   CLE014
      *                                                               *   CLE014
      *  Called By: EVENT                                             *   CLE014
      *                                                               *   CLE014
      *  Calls:     None                                              *   CLE014
      *                                                               *   CLE014
      *****************************************************************   CLE014
     C           SRMOVE    BEGSR                                          CLE014
      *                                                                   CLE014
     C                     MOVE RECI      CARECI                          CLE014
     C                     MOVE CANM      CAFCUS                          CLE014
     C                     MOVE CAFT      CAFACT                          CLE014
     C                     MOVE CAFN      CAFCNO                          CLE014
     C                     MOVE RVCR      CATRRC                          CLE014
     C                     MOVE PTP       CAPTP                           CLE014
     C                     MOVE RCSI      CARCSI                          CLE014
     C                     Z-ADDEDAT      CAEDAT                          CLE014
     C                     MOVE ETYP      CAETP                           CLE014
     C                     Z-ADDWEAMT     CAEAMT                          CLE014
     C                     MOVE IBRE      CAIBRE                          CLE014
      *                                                                   CLE014
     C                     WRITELECAFED0                                  CLE014
      *                                                                   CLE014
     C                     ENDSR                                          CLE014
      *****************************************************************   CLE014
      /TITLE SR/FEES
      *****************************************************************
      *                                                               *
      *  FEES   - SUBROUTINE TO PROCESS FACILITY FEES.                *
      *                                                               *
      *  Called By: PROCES                                            *
      *                                                               *
      *  Calls:     AOCURRR0, SETLOC, ZFWDT, NONCAL, CALFEE           *
      *                                                               *
      *****************************************************************
      *
     C           FEES      BEGSR
      *
      ***  Obtain fee data from master fees file.
      *
     C**********           Z-ADD0         KYLOAN                                              CLE148
     C                     MOVEL*BLANK    KYLOAN                                              CLE148
     C**********           Z-ADDFCCNUM    EVFCUS                                              CSD027
     C                     MOVE FCCNUM    EVFCUS                                              CSD027
     C                     Z-ADDFEFACL    KYFACL
     C                     MOVEL*BLANK    WCALCF  1                                         MD052216
     C           KEY002    SETLLLEFEEDL1
     C           KEY002    READELEFEEDL1                 08
      *
     C           *IN08     DOWEQ'0'                        ***B001
     C           FERECI    IFNE '*'                                                          BUG3729
     C           FERECI    ANDNE'R'                                                          BUG3729
      *
     C           FERECI    IFEQ 'D'                        ***B002
     C           FEPEND    ORGT RUND                                      101931
     C***********FERECI    ANDNE'*'                                                           CLE034
      *
      *** Calculate receive telex date using telex notice days from
      *** Settlement Allocation if CLE034 is on, or else from the                             CLE034
      *** currency file and settlement location details from fees
      *** file
      ***If settlement*method*is*09*and*postings*are*to*use*Transaction*****************218782218992
      ***currency,*do*not*look*up*settlement*allocations********************************218782218992
      *
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C***********CLE033    ANDNE'Y'                                                     218782218992
     C***********CLE034    OREQ 'Y'                                                     218782218992
     C***********FESTAL    ANDEQ'Y'                                                     218782218992
     C***********FERECI    ANDNE'*'                                                     218782218992
     C***********SETP      ANDNE09                                                      218782218992
     C***********CLE034    OREQ 'Y'                                                     218782218992
     C***********FESTAL    ANDEQ'Y'                                                     218782218992
     C***********FERECI    ANDNE'*'                                                     218782218992
     C***********SET09     ANDNE'T'                                                     218782218992
     C           PTFI      IFNE *BLANKS                                                       CLE034
     C                     MOVE 'E'       W#SMIN                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'S'       W#SMIN                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADDRUND      PDAY    50                                          CLE034
     C                     MOVE FELOAN    PLNRF   6                                           CLE034
     C                     MOVE FECNUM    PCNUM   6                                           CLE034
     C                     MOVE FEFACL    PFACL   5                                           CLE034
     C                     MOVE FEFSEQ    PFSEQ   2                                           CLE034
      *                                                                                     CLE075AP
     C                     MOVE W#SMIN    WPSMI                                             CLE075AP
     C                     Z-ADDPDAY      WPDAY                                             CLE075AP
     C                     MOVE PLNRF     WPLRF                                             CLE075AP
     C                     MOVE PCNUM     WPCSF                                             CLE075AP
     C                     MOVE PFACL     WPFCF                                             CLE075AP
     C                     MOVE PFSEQ     WPFSQ                                             CLE075AP
     C                     MOVE WSTAL     KEYSET                                            CLE075AP
     C                     ADD  1         SETSEQ                                            CLE075AP
     C                     EXSR CHKSET                                                      CLE075AP
      *                                                                                     CLE075AP
      ** Use details from array if KEYSET is found, otherwise,                              CLE075AP
      ** retrieve details from program call                                                 CLE075AP
      *                                                                                     CLE075AP
     C           SETIC     IFEQ 'Y'                                                         CLE075AP
      *                                                                                     CLE075AP
      ** Set occurence to index found from #SEK array                                       CLE075AP
      *                                                                                     CLE075AP
     C                     Z-ADD#XND,R    PTLXND                                            CLE075AP
      *                                                                                     CLE075AP
     C                     ELSE                                                             CLE075AP
      *                                                                                     CLE075AP
     C           SETIDX    IFNE 0                                                           CLE075AP
     C                     Z-ADDSETIDX    R                                                 CLE075AP
     C                     ELSE                                                             CLE075AP
     C                     Z-ADD1         R                                                 CLE075AP
     C                     MOVEA#SET      #SES                                              CLE075AP
     C                     SORTA#SES                                                        CLE075AP
     C                     Z-ADD#SES,1    SETKEY                                            CLE075AP
     C           SETKEY    LOKUP#SET,R                   45                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C                     CALL 'AOSTALR1'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               222373
     C                     PARM '*TXDT  ' POPTN                                               CLE034
     C                     PARM           PDAY                                                CLE034
     C                     PARM *ZERO     PPTYP   2                                           CLE034
     C                     PARM           W#SMIN                                              CLE034
     C                     PARM           FEFCCY                                              CLE034
     C                     PARM 'N'       PNCHK   1                                           CLE034
     C                     PARM 'FEES'    PTYPE   4                                           CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLNAVD  5                                           CLE034
     C                     PARM *BLANKS   PLNASQ  3                                           CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM *ZERO     PTLXND  50                                          CLE034
     C                     PARM *BLANK    PNOST   1                                           CLE034
      *                                                                                     CLE075AP
     C                     Z-ADDPTLXND    #XND,R                                            CLE075AP
     C                     EXSR ADDSET                                                      CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                       CLE034
     C                     Z-ADDPTLXND    WTXDT                                               CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVELFEFCCY    CURKEY
     C**********           CALL 'AOCURRR0'                                                    CSC042
     C**********           PARM '*BLANKS' WRTCD                                               CSC042
     C**********           PARM '*KEY   ' WOPTN                                               CSC042
     C**********           PARM           CURKEY  3                                           CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                               CSC042
     C********** WRTCD     IFNE *BLANKS                    ***B003                            CSC042
     C                     MOVELCURKEY    ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
     C                     EXSR ##SETC                                                        CSC042
     C                     ELSE                                                               CSC042
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C**********           MOVE 'SDCURRPD'DBFILE           ************                       CSC042
     C                     MOVE 'CURR,Q  'DBFILE           ************                       CSC042
     C**********           MOVE FEFCCY    DBKEY            * DBERR 08 *                       CSC042
     C                     MOVE CURKEY    DBKEY                                               CSC042
     C                     Z-ADD8         DBASE            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             ***E003
      *
     C           CDP       ADD  4         TD                              100523
      *                                                                                       218782
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, do not use settlement currency                                             218782
      *                                                                                       218782
     C           CLE033    IFEQ 'Y'                                                           218782
     C***********SETP      ANDEQ09                                                      218782218992
     C           FESTTL    ANDEQ09                                                            218992
     C           SET09     ANDEQ'T'                                                           218782
     C                     ELSE                                                               218782
      *                                                                   160659
      ** Use settlement currency to retrieve the telex notice days and    160659
      ** location if CEU004 is on                                         160659
      *                                                                   160659
     C           CEU004    IFEQ 'Y'                                       160659
     C           FESCCY    ANDNE*BLANKS                                   160659
     C                     MOVELFESCCY    CURKEY                          160659
     C**********           CALL 'AOCURRR0'                                             160659 CSC042
     C**********           PARM '*BLANKS' WRTCD                                        160659 CSC042
     C**********           PARM '*KEY   ' WOPTN                                        160659 CSC042
     C**********           PARM           CURKEY  3                                    160659 CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                        160659 CSC042
     C********** WRTCD     IFNE *BLANKS                                                160659 CSC042
     C                     MOVELCURKEY    ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
     C                     EXSR ##SETC                                                        CSC042
     C                     ELSE                                                               CSC042
     C           *LOCK     IN   LDA                                       160659
     C                     MOVEL'LE0492  'DBPGM                           160659
     C**********           MOVE 'SDCURRPD'DBFILE           ************                160659 CSC042
     C                     MOVE 'CURR,Q  'DBFILE                                              CSC042
     C**********           MOVE FESCCY    DBKEY            * DBERR 28 *                160659 CSC042
     C                     MOVE CURKEY    DBKEY            * DBERR 28 *                       CSC042
     C                     Z-ADD28        DBASE            ************   160659
     C                     OUT  LDA                                       160659
     C                     EXSR *PSSR                                     160659
     C                     ENDIF                                          160659
     C                     ENDIF                                          160659
      *                                                                   160659
      ** If CLE031 is active                                              CLE031
      *                                                                   CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
      *                                                                   CLE031
      ** If not a participant fee and receipt settlement ccy is present   CLE031
      ** use receipt settlement currency to determine telex notice days   CLE031
      *                                                                   CLE031
     C           PTFI      IFEQ *BLANKS                                   CLE031
     C           FESCCY    ANDNE*BLANKS                                   CLE031
     C                     MOVELFESCCY    CURKEY                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
      ** If a participant fee and pay settlement ccy is present           CLE031
      ** use pay settlement currency to determine telex notice days       CLE031
      *                                                                   CLE031
     C           PTFI      IFNE *BLANKS                                   CLE031
     C           FEPSCY    ANDNE*BLANKS                                   CLE031
     C                     MOVELFEPSCY    CURKEY                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
      ** Access currency details to determine telex notice days           CLE031
      *                                                                   CLE031
     C**********           CALL 'AOCURRR0'                                             CLE031 CSC042
     C**********           PARM '*BLANKS' WRTCD                                        CLE031 CSC042
     C**********           PARM '*KEY   ' WOPTN                                        CLE031 CSC042
     C**********           PARM           CURKEY  3                                    CLE031 CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                        CLE031 CSC042
      *                                                                   CLE031
     C********** WRTCD     IFNE *BLANKS                                                CLE031 CSC042
     C                     MOVELCURKEY    ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
     C                     EXSR ##SETC                                                        CSC042
     C                     ELSE                                                               CSC042
     C           *LOCK     IN   LDA                                       CLE031
     C                     MOVEL'LE0492  'DBPGM                           CLE031
     C**********           MOVE 'SDCURRPD'DBFILE           ************                CLE031 CSC042
     C                     MOVE 'CURR,Q  'DBFILE                                              CSC042
     C                     MOVE FESCCY    DBKEY            * DBERR 54 *   CLE031
     C                     Z-ADD54        DBASE            ************   CLE031
     C                     OUT  LDA                                       CLE031
     C                     EXSR *PSSR                                     CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                                              218782
      *                                                                   CLE031
     C                     Z-ADDTXND      ZNRDYS
     C                     Z-ADDFESTTL    WKSTLL  20
     C**********           MOVELFEOURS    WKOUR  12                                           CGL029
     C                     MOVELFEOURS    WKOUR  18                                           CGL029
      *
     C                     EXSR SETLOC
      *
     C                     MOVE WKSTBL    ZLOC
     C                     MOVE FEFCCY    ZCCY                              0076
     C                     Z-ADDRUND      ZDAYNO                            0076
      *
      *** Use notice days & location information to obtain receive
      *** telex date
      *
     C                     EXSR ZFWDT
     C*
     C                     Z-ADDZDYNBR    WTXDT   50
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *
      ***  Set up next payment date as follows:
      ***  If fee is due tomorrow, LER135 will have updated PF/LEFEED
      ***  for next payment date, and the last payment date will be
      ***  the one due tomorrow. So use the last payment date in this
      ***  case.  If fee is due in 2 days or more, use next payment
      ***  date.
      *
     C           FELPDT    IFGT RUND                       ***B003
     C                     Z-ADDFELPDT    WENPYD  50
     C                     ELSE                            ***X003
     C                     Z-ADDFENPYD    WENPYD
     C                     END                             ***E003
      *                                                                   045634
     C** Calculate Fees payed on end period only                          045634
     C           FEPYON    IFEQ 'E'                        ***B003        045634
     C                     Z-ADDFEPEND    WENPYD                          045634
     C                     END                             ***E003        045634
      *
      ****************************************************
      ***  Processing for non-calculated facility fees ***
      ****************************************************
      *
     C********** FELOAN    IFEQ *ZEROS                     ***B003                            CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C           FECALT    ANDEQ*BLANKS
      *
      ***  check if fee due this run
      *
      *                                                                                     BUG11071
      ** Save Key Fields  - KEY008                                                          BUG11071
      *                                                                                     BUG11071
     C**********           Z-ADDFECNUM    WECNUM                                    BUG11071 CSD027A
     C                     MOVELFECNUM    WECNUM                                             CSD027A
     C                     Z-ADDFEFACL    WEFACL                                            BUG11071
     C**********           Z-ADDFELOAN    WELOAN                                     BUG11071 CLE148
     C                     MOVELFELOAN    WELOAN                                              CLE148
     C                     Z-ADDFEFSEQ    WEFSEQ                                            BUG11071
     C                     EXSR NONCAL
      *
     C                     END                             ***E003
      *
      ************************************************
      ***  Processing for calculated facility fees ***
      ************************************************
      *
     C********** FELOAN    IFEQ *ZEROS                     ***B003                            CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C           FECALT    ANDNE*BLANKS
      *
     C** Only calculate future fees within extract period                 045634
     C           WENPYD    IFGT RUND                       ***B004        045634
     C           WENPYD    ANDLEEXDT1                                     045634
     C                     EXSR CALFEE
     C                     END                             ***E004        045634
      *
      ** Check for fees with NPYD amended to run date or less.                              MD030700
      *                                                                                     MD030700
     C                     MOVE FECNUM    FFCNUM                                            MD030700
     C                     Z-ADDFEFACL    FFFACL                                            MD030700
     C                     MOVE FELOAN    FFLOAN                                            MD030700
     C                     Z-ADDFEFSEQ    FFFSEQ                                            MD030700
     C           KEY010    CHAINLEFEDNL0             12                                     MD030700
     C           *IN12     IFEQ '0'                                                         MD030700
     C                     EXSR NPBILL                                                      MD030700
     C                     ENDIF                                                            MD030700
      *                                                                                     MD030700
     C                     END                             ***E003
      *
      ***  End for IFEQ 'D'
     C                     END                             ***E002
      *                                                                                     MD030700
      ** For Matured Fees                                                                   MD030700
      *                                                                                     MD030700
     C           FERECI    IFEQ 'M'                                                         MD030700
     C                     EXSR MCBILL                                                      MD030700
     C                     ENDIF                                                            MD030700
      *                                                                                     MD030700
     C                     ENDIF                                                             BUG3729
      *
     C           KEY002    READELEFEEDL1                 08
      *
      ***  End for DOWEQ '0'
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/NONCAL
      *****************************************************************
      *                                                               *
      *  NONCAL - SUBROUTINE TO CHECK IF NON-CALCULATED OR            *
      *           LOAN FEES DUE THIS RUN                              *
      *                                                               *
      *  Called By: FEES, PROCESS                                     *
      *                                                               *
      *  Calls:     FEEPAY, CBILL, RTLX                               *
      *                                                               *
      *****************************************************************
      *
     C           NONCAL    BEGSR
      *                                                                                       262545
      * If generation till end of book is not required on LE ICD                              262545
      * then check if the specific loan needs it for IAS purposes                             262545
      *                                                                                       262545
     C                     MOVE 'N'       WKGEN   1                                           262545
     C           BPGEEB    IFNE 'Y'                                                           262545
     C           FELOAN    CHAINLE0480PF             25                                       262545
     C           *IN25     IFEQ *OFF                                                          262545
     C                     MOVE 'Y'       WKGEN                                               262545
     C                     ENDIF                                                              262545
     C                     ENDIF                                                              262545
      *
      ***  Obtain date up to which non-calculated & loan fee events
      ***  should be generated. Either to end of book or 30 days in
      ***  advance.
      *
     C                     Z-ADD0         WFEE
     C                     Z-ADD0         ENAR2   50                      BH3528
     C                     Z-ADD0         EXDT2   50                      BH3528
      *
     C           BPGEEB    IFEQ 'Y'                        ***B001
     C           WKGEN     OREQ 'Y'                                                           262545
     C**********           Z-ADDFEPEND    EXDT2   50                      BH3528
     C                     Z-ADDFEPEND    ENAR2                           BH3528
     C*                                                                   BH3528
     C***  Bullet fees have no end date and are due on start date.        BH3528
     C*                                                                   BH3528
     C           FEPEND    IFEQ 0                                         BH3528
     C           FEPYON    ANDEQ' '                                       BH3528
     C                     Z-ADDFEPSTD    ENAR2                           BH3528
     C                     END                                            BH3528
     C*                                                                   BH3528
     C                     ELSE                            ***X001
     C           RUND      ADD  30        ENAR2   50
     C                     END                             ***E001
      *
     C           BDAYS     IFGT ENAR2                      ***B001
     C                     Z-ADDBDAYS     EXDT2
     C                     ELSE                            ***X001
     C                     Z-ADDENAR2     EXDT2
     C                     END                             ***E001
      *
      ***  If payment on indicator (FEPYON) is blank, fee should be
      ***  settled in full on start date;  if FEPYON is 'S' fee
      ***  is amortised so is paid up front, i.e., start date.
      *
     C           FEPYON    IFEQ *BLANKS                    ***B001
     C***********FEPSTD    ANDGERUND                                      045634
     C           FEPSTD    ANDGTRUND                                      045634
     C           FEPSTD    ANDLEEXDT2
     C           FEPYON    OREQ 'S'
     C***********FEPSTD    ANDGERUND                                      045634
     C           FEPSTD    ANDGTRUND                                      045634
     C           FEPSTD    ANDLEEXDT2
     C                     Z-ADDFEPSTD    PAYDAT  50
     C           FEFAMT    SUB  FEAMTS    WFEE
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WRKFLD  1                                           CLE034
     C                     MOVE '*EOF   ' STALCD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WRKFLD    DOWEQ'Y'                                                           CLE034
     C           STALCD    OREQ *BLANKS                    AOSTALR2 - RTCD                    CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXSR FEEPAY
     C/COPY WNCPYSRC,LE0492C016
      *                                                                     0039
     C/COPY WNCPYSRC,LE0492C017
      ***  Do not output telex if non-working day accrual run               0039
      *                                                                     0039
     C           *INU3     IFEQ '0'                                         0039
     C*                                                                     0039
      ***  Check if telex should be sent                                 E
      *                                                                  E
     C                     EXSR RTLX                                     E
      ***  If bills/telexes indicator 'Y' check if b/t should be sent.   E
     C/COPY WNCPYSRC,LE0492C018
     C           BTIN      IFNE 'N'                        ***B002       E
     C                     EXSR CBILL                                    E
     C                     END                             ***E002       E
     C/COPY WNCPYSRC,LE0492C019
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WRKFLD                                              CLE034
     C                     MOVE '*EOF   ' STALCD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           *INU3     IFEQ '0'                                                           CLE034
      *                                                                  E
      ***  Update pay/receive & bill/telex flags on LEFEED               E
     C           WKLNFE    IFEQ 'L'                                         0068
     C                     EXCPTXLEFL                                       0068
     C           KEY008    CHAINLEFEEDL2             25                                     BUG11071
     C                     ELSE                                             0068
     C                     EXCPTXLEF                                     E
     C           KEY008    CHAINLEFEEDL1             26                                     BUG11071
     C                     END                                              0068
      *                                                                  E
     C                     END                                              0039
      *                                                                     0039
     C                     END                             ***E001
      *                                                                                     MD029191
      ** Allow creation of bills and telex only (no event)                                  MD029191
      ** for fees with FEPYON = 'S' and ORED = runday.                                      MD029191
      ** Also for fees with FEPYON = ' ' and FEPYON = 'E'                                   MD030700
      *                                                                                     MD029191
     C           FEPYON    IFEQ 'S'                                                         MD029191
     C           FEPSTD    ANDLERUND                                                        MD030700
     C           FEPYON    OREQ ' '                                                         MD030700
     C           FEPSTD    ANDLERUND                                                        MD030700
     C           FEPYON    OREQ 'E'                                                         MD030700
     C           FEPEND    ANDLTRUND                                                        MD030700
      *                                                                                     MD030700
     C********** FEPSTD    ANDLERUND                                               MD029191 MD030700
     C********** FEPSTD    ANDLEEXDT2                                              MD029191 MD030700
     C********** FEORED    ANDEQRUND                                               MD029191 MD030700
     C           FEORED    IFEQ RUND                                                        MD030700
     C           *INU3     ANDEQ'0'                                                         MD029191
      *                                                                                     MD029191
     C           FEPYON    IFEQ 'E'                                                         MD030700
     C                     Z-ADDFEPEND    PAYDAT                                            MD030700
     C                     ELSE                                                             MD030700
     C                     Z-ADDFEPSTD    PAYDAT                                            MD029191
     C                     ENDIF                                                            MD030700
     C                     Z-ADDFEFAMT    WFEE                                              MD029191
     C                     MOVE FECNUM    FCUS                                              MD029191
     C                     Z-ADDFEFSEQ    LASN                                              MD029191
     C                     Z-ADD0         CPAM                                              MD029191
     C                     Z-ADDFEORED    ORED                                              MD029191
     C                     Z-ADD0         INTR                                              MD029191
      *                                                                                     MD029191
     C                     EXSR RTLX                                                        MD029191
      *                                                                                     MD029191
     C           BTIN      IFNE 'N'                                                         MD029191
     C                     EXSR CBILL                                                       MD029191
     C                     ENDIF                                                            MD029191
      *                                                                                     MD029191
      ** Update pay/receive & bill/telex flags on LEFEED                                    MD029191
      *                                                                                     MD029191
     C           WKLNFE    IFEQ 'L'                                                         MD029191
     C                     EXCPTXLEFL                                                       MD029191
     C           KEY008    CHAINLEFEEDL2             25                                     MD029191
     C                     ELSE                                                             MD029191
     C                     EXCPTXLEF                                                        MD029191
     C           KEY008    CHAINLEFEEDL1             26                                     MD029191
     C                     ENDIF                                                            MD029191
      *                                                                                     MD029191
     C                     ENDIF                                                            MD029191
     C                     ENDIF                                                            MD030700
      *
      ***  If payment on indicator (FEPYON) is 'E' fee is to be
      ***  accrued and settled on end date.
      *
     C           FEPYON    IFEQ 'E'                        ***B001
     C           FEPEND    ANDGERUND
     C           FEPEND    ANDLEEXDT2
     C                     MOVE FEPEND    PAYDAT
     C           FEFAMT    SUB  FEAMTS    WFEE
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WRKFLD  1                                           CLE034
     C                     MOVE '*EOF   ' STALCD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WRKFLD    DOWEQ'Y'                                                           CLE034
     C           STALCD    OREQ *BLANKS                    AOSTALR2 - RTCD                    CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXSR FEEPAY
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WRKFLD                                              CLE034
     C                     MOVE '*EOF   ' STALCD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
      ** If CLE031 is on AND Payment on 'Next' AND fee next payment       CLE031
      ** date is zero AND fee end date >= System Date AND fee end         CLE031
      ** date  <= Extract Date                                            CLE031
      *                                                                   CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
     C           FEPYON    ANDEQ'N'                                       CLE031
     C           FENPYD    ANDEQ*ZERO                                     CLE031
     C           FEPEND    ANDGERUND                                      CLE031
     C           FEPEND    ANDLEEXDT2                                     CLE031
     C                     MOVE FEPEND    PAYDAT                          CLE031
     C                     Z-ADDFEFAMT    WFEE                            CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WRKFLD  1                                           CLE034
     C                     MOVE '*EOF   ' STALCD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WRKFLD    DOWEQ'Y'                                                           CLE034
     C           STALCD    OREQ *BLANKS                    AOSTALR2 - RTCD                    CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXSR FEEPAY                                    CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WRKFLD                                              CLE034
     C                     MOVE '*EOF   ' STALCD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                          CLE031
      *                                                                                     MD051907
     C           CLE073    IFEQ 'Y'                                                         MD051907
     C           FECALT    ANDEQ'97'                                                        MD051907
     C           CLE073    OREQ 'Y'                                                         MD051907
     C           FECALT    ANDEQ'98'                                                        MD051907
     C           CLE073    OREQ 'Y'                                                         MD051907
     C           FECALT    ANDEQ'99'                                                        MD051907
     C                     MOVE 'Y'       WRK73   1                                         MD051907
     C                     ELSE                                                             MD051907
     C                     MOVE 'N'       WRK73                                             MD051907
     C                     ENDIF                                                            MD051907
      *                                                                   CLE031
      ** If CLE031 is on AND Payment on 'Next' AND fee next payment       CLE031
      ** date >= System date AND fee next payment date <= Extract date    CLE031
      *                                                                   CLE031
     C           FELPDT    IFGT RUND                                                          218992
     C                     Z-ADDFELPDT    WENPYD  50                                          218992
     C                     ELSE                                                               218992
     C                     Z-ADDFENPYD    WENPYD                                              218992
     C                     END                                                                218992
     C           CLE031    IFEQ 'Y'                                       CLE031
     C           FEPYON    ANDEQ'N'                                       CLE031
     C           WENPYD    ANDGERUND                                                          218992
     C           WENPYD    ANDLEEXDT2                                                         218992
     C           WRK73     ANDEQ'N'                                                         MD051907
     C***********FENPYD    ANDGERUND                                      CLE031              218992
     C***********FENPYD    ANDLEEXDT2                                     CLE031              218992
     C***********          MOVE FENPYD    PAYDAT                          CLE031              218992
     C                     MOVE WENPYD    PAYDAT                                              218992
     C                     Z-ADDFEFAMT    WFEE                            CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WRKFLD  1                                           CLE034
     C                     MOVE '*EOF   ' STALCD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WRKFLD    DOWEQ'Y'                                                           CLE034
     C           STALCD    OREQ *BLANKS                    AOSTALR2 - RTCD                    CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     EXSR FEEPAY                                    CLE031
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WRKFLD                                              CLE034
     C                     MOVE '*EOF   ' STALCD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
      ** If payment on 'End' AND fee end date >= system date AND          CLE031
      ** fee end date <= extract date                                     CLE031
      *                                                                   CLE031
     C           FEPYON    IFEQ 'E'                                       CLE031
     C           FEPEND    ANDGERUND                                      CLE031
     C           FEPEND    ANDLEEXDT2                                     CLE031
      *                                                                   CLE031
      ** Or CLE031 is on AND payment on 'Next' AND fee next payment       CLE031
      ** date is zero AND fee end date >= system date AND fee end         CLE031
      ** date <= extract date                                             CLE031
      *                                                                   CLE031
     C           CLE031    OREQ 'Y'                                       CLE031
     C           FEPYON    ANDEQ'N'                                       CLE031
     C           FENPYD    ANDEQ*ZERO                                     CLE031
     C           FEPEND    ANDGERUND                                      CLE031
     C           FEPEND    ANDLEEXDT2                                     CLE031
      *                                                                   CLE031
      ** Or CLE031 is on AND payment on 'Next AND fee next payment        CLE031
      ** date >= system date AND fee next payment date <= extract date    CLE031
      *                                                                   CLE031
     C           CLE031    OREQ 'Y'                                       CLE031
     C           FEPYON    ANDEQ'N'                                       CLE031
     C***********FENPYD    ANDGERUND                                      CLE031              218992
     C***********FENPYD    ANDLEEXDT2                                     CLE031              218992
     C           WENPYD    ANDGERUND                                                          218992
     C           WENPYD    ANDLEEXDT2                                                         218992
     C           WRK73     ANDEQ'N'                                                         MD051907
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WRKFLD                                              CLE034
     C                     MOVE '*EOF   ' STALCD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WRKFLD    DOWEQ'Y'                                                           CLE034
     C           STALCD    OREQ *BLANKS                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                     0039
      ***  Do not output telex if non-working day accrual run               0039
      *                                                                     0039
     C           *INU3     IFEQ '0'                                         0039
     C*                                                                     0039
      ***  Check if telex should be sent                                 E
     C                     EXSR RTLX                                     E
      ***  If bills/telexes indicator 'Y' check if b/t should be sent.   E
     C/COPY WNCPYSRC,LE0492C020
     C           BTIN      IFNE 'N'                        ***B002       E
     C                     EXSR CBILL                                    E
     C                     END                             ***E002       E
     C/COPY WNCPYSRC,LE0492C021
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WRKFLD                                              CLE034
     C                     MOVE '*EOF  '  STALCD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           *INU3     IFEQ '0'                                                           CLE034
      *                                                                  E
      ***  Update pay/receive & bill/telex flags on LEFEED               E
     C           WKLNFE    IFEQ 'L'                                       045634
     C                     EXCPTXLEFL                                     045634
     C           KEY008    CHAINLEFEEDL2             25                                     BUG11071
     C                     ELSE                                           045634
     C                     EXCPTXLEF                                     E
     C           KEY008    CHAINLEFEEDL1             26                                     BUG11071
     C                     END                                            045634
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                  E
     C                     END                                              0039
      *                                                                     0039
     C**********           END                             ***E001        CLE031
     C                     ENDIF                                          CLE031
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C/COPY WNCPYSRC,LEH01141
     C           FEPYON    ANDEQ'N'                                                           CAS009
     C           FENPYD    ANDNE*ZERO                                                       BUG13045
     C           FECALT    ANDEQ*BLANKS                                                     MD052216
      *                                                                                       CAS009
     C           FELPDT    IFGT RUND                                                          CAS009
     C                     Z-ADDFELPDT    WENPYD                                              CAS009
     C                     ELSE                                                               CAS009
     C                     Z-ADDFENPYD    WENPYD                                              CAS009
     C                     ENDIF                                                              CAS009
     C                     MOVE 'N'       WTELX   1                                           CAS009
      *                                                                                     BUG13045
      ** Start with the next payment frequency since the current payment                    BUG13045
      ** date was already written in the events file by CLE031 code                         BUG13045
      *                                                                                     BUG13045
     C                     EXSR SRSDAT                                                      BUG13045
      *                                                                                       CAS009
     C           WENPYD    DOWGTRUND                                                          CAS009
     C           WENPYD    ANDLEEXDT2                                                         CAS009
      *                                                                                       CAS009
     C                     Z-ADDWENPYD    PAYDAT                                              CAS009
     C                     Z-ADDFEFAMT    WFEE                                                CAS009
     C                     EXSR FEEPAY                                                        CAS009
      *                                                                                       CAS009
      ** Do not output telex if non-working day accrual run                                   CAS009
      *                                                                                       CAS009
     C           *INU3     IFEQ '0'                                                           CAS009
      *                                                                                       CAS009
      ** Check if telex should be sent                                                        CAS009
      *                                                                                       CAS009
     C                     EXSR RTLX                                                          CAS009
      *                                                                                       CAS009
      ** If bills/telexes indicator 'Y' check if they should be sent.                         CAS009
      *                                                                                       CAS009
     C           BTIN      IFNE 'N'                                                           CAS009
     C                     EXSR CBILL                                                         CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
      ** Update pay/receive & bill/telex flags on LEFEED                                      CAS009
      *                                                                                       CAS009
     C           WTELX     IFEQ 'N'                                                           CAS009
     C           WKLNFE    IFEQ 'L'                                                           CAS009
     C                     EXCPTXLEFL                                                         CAS009
     C           KEY008    CHAINLEFEEDL2             25                                     BUG11071
     C                     ELSE                                                               CAS009
     C                     EXCPTXLEF                                                          CAS009
     C           KEY008    CHAINLEFEEDL1             26                                     BUG11071
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     EXSR SRSDAT                                                        CAS009
      *                                                                                       CAS009
     C                     ENDDO                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C/COPY WNCPYSRC,LE0492C022
     C                     MOVE 'N'       WPDCL   1                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FECALT    IFEQ '90'                                                          CLE134
      *                                                                                       CLE134
      ** If there are no outstanding PDCL (with CPAM <> 0), then the                          CLE134
      ** fee 90 cannot be charged. Set WPDCL = 1 if there is at least                         CLE134
      ** one live PDCL with CPAM <> 0                                                         CLE134
      *                                                                                       CLE134
     C           FELOAN    SETLLLEPDUFL1                                                      CLE134
     C           *IN96     DOWEQ*OFF                                                          CLE134
     C           FELOAN    READELEPDUFL1                 96                                   CLE134
     C           *IN96     IFEQ *OFF                                                          CLE134
     C           FELOAN    CHAINCLOAN                97                                       CLE134
     C           *IN97     IFEQ *OFF                                                          CLE134
     C           CPAML     ANDNE*ZERO                                                         CLE134
     C           RECIL     ANDNE*ZERO                                                         CLE134
     C                     MOVE 'Y'       WPDCL                                               CLE134
     C                     MOVE *ON       *IN96                                               CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDDO                                                              CLE134
      *                                                                                       CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE073
      *                                                                                       CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'98'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'99'                                                          CLE073
      *                                                                                       CLE073
     C           FELPDT    IFGT RUND                                                          CLE073
     C                     Z-ADDFELPDT    WKNPYD  50                                          CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDFENPYD    WKNPYD  50                                          CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** If payment on indicator (FEPYON) is 'N' fee is to be                                 CLE073
      ** accrued and settled on next payment date.                                            CLE073
      *                                                                                       CLE073
     C           FEPYON    IFEQ 'N'                                                           CLE073
     C           WKNPYD    ANDGERUND                                                          CLE073
     C           WKNPYD    ANDLEEXDT2                                                         CLE073
     C                     MOVE WKNPYD    PAYDAT                                              CLE073
     C                     MOVEL'Y'       WCALCF                                            MD052216
     C                     EXSR CHKPAY                                                      MD052216
     C           FECALT    IFEQ '99'                                                          CLE073
     C                     Z-ADDFEFAMT    WFEE                                                CLE073
     C                     ADD  FEAMTA    WFEE                                                CLE073
     C           FELPDT    IFGT BJRDNB                                                        CLE073
     C                     Z-ADDFEAMTP    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C                     ELSE                                                               CLE073
     C                     EXSR CALLON                                                        CLE073
     C                     ENDIF                                                              CLE073
     C                     EXSR FEEPAY                                                        CLE073
      *                                                                                       CLE073
      ** Do not output telex if non-working day accrual run                                   CLE073
      *                                                                                       CLE073
     C           *INU3     IFEQ '0'                                                           CLE073
      *                                                                                       CLE073
      ** Check if telex should be sent                                                        CLE073
      *                                                                                       CLE073
     C                     EXSR RTLX                                                          CLE073
      *                                                                                       CLE073
      ** If bills/telexes indicator 'Y' check if b/t should be sent.                          CLE073
      *                                                                                       CLE073
     C           BTIN      IFNE 'N'                                                           CLE073
     C                     EXSR CBILL                                                         CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Update pay/receive & bill/telex flags on LEFEED                                      CLE073
      *                                                                                       CLE073
     C                     EXCPTXLEFL                                                         CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/CALFEE
      *****************************************************************
      *                                                               *
      *  CALFEE - SUBROUTINE TO CHECK IF CALCULATED FACILITY FEES     *
      *           ARE DUE THIS RUN.                                   *
      *                                                               *
      *  Called By:  FEES                                             *
      *                                                               *
      *  Calls:      CALCSR, ACCRUE, FEEPAY, RTLX, CBILL              *
      *                                                               *
      *****************************************************************
      *
     C           CALFEE    BEGSR
      *                                                                                       CLE071
     C           CLE071    IFEQ 'N'                                                           CLE071
     C                     MOVELFEEM      WFEM                                                CLE071
     C                     MOVELFRT       WFRT                                                CLE071
     C                     MOVELFEPIND    WKPIND                                              CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C           FECALT    IFEQ '01'                                                          CLE071
     C           FECALT    OREQ '02'                                                          CLE071
     C           FECALT    OREQ '03'                                                          CLE071
     C           FECALT    OREQ '11'                                                          CLE071
     C           FECALT    OREQ '12'                                                          CLE071
     C           FECALT    OREQ '13'                                                          CLE071
     C           FECALT    OREQ '21'                                                          CLE071
     C                     MOVEL'Y'       WKAVFE  1                                           CLE071
     C                     ELSE                                                               CLE071
     C                     MOVEL'N'       WKAVFE                                              CLE071
     C                     ENDIF                                                              CLE071
      *
      ***  If Last Payment Date is not Period End Date, and the Next
      ***  Payment Date or Period End Date is on or before the Extract
      ***  Date:
      *
     C***********FEPLPD    IFNE FEPEND                     ***B001        045634
     C***********WENPYD    ANDLEEXDT1                                     045634
     C***********FEPLPD    ORNE FEPEND                                    045634
     C***********FEPEND    ANDLEEXDT1                                     045634
      *
      ***  Initialise work fields
      *
     C                     Z-ADD0         WAMT   150
     C                     Z-ADD0         WPCT    63
     C                     Z-ADD0         WFEE   150
      *
      ***  Set up start date:
      *
     C***********FEPLPD    IFNE 0                          ***B002        100518
     C***********          Z-ADDFEPLPD    WSTART  50                      100518
     C***********          ELSE                            ***X002        100518
     C***********          Z-ADDFEPSTD    WSTART                          100518
     C***********          END                             ***E002        100518
     C*                                                                   100518
     C** If Last Payment Date is GT the run date, use the Previous Last   100518
     C** Payment Date (if not zero) else the fee start date as start.     100518
     C** Otherwise, if Last Payment Date has a value, use it as start     100518
     C** date, else use the Fee Start Date.                               100518
     C*                                                                   100518
     C           FELPDT    IFGT RUND                                      100518
     C           FEPLPD    IFNE 0                                         100518
     C                     Z-ADDFEPLPD    WSTART  50                      100518
     C                     ELSE                                           100518
     C                     Z-ADDFEPSTD    WSTART                          100518
     C                     END                                            100518
     C                     ELSE                                           100518
     C           FELPDT    IFNE 0                                         100518
     C                     Z-ADDFELPDT    WSTART                          100518
     C                     ELSE                                           100518
     C                     Z-ADDFEPSTD    WSTART                          100518
     C                     END                                            100518
     C                     END                                            100518
      *
      ***  Set up end date:
      *
     C           WENPYD    IFNE 0                          ***B002
     C                     MOVE WENPYD    WEND    50
     C                     ELSE                            ***X002
     C                     MOVE FEPEND    WEND
     C                     END                             ***E002
      *
      ***  Use start & end dates to obtain number of days in whole
      ***  calculation period.
      *
     C***********WEND      SUB  WSTART    WDAYS   50                      CLE013
     C                     Z-ADDWSTART    ZZBEG                           CLE013
     C                     Z-ADDWEND      ZZEND                           CLE013
     C                     MOVE FECALC    ZZCALC                          CLE013
     C                     EXSR ZINTDY                                    CLE013
     C           FECALC    IFEQ 6                                                             212048
     C                     Z-ADDINT6DY    WDAYS                                               212048
     C                     ELSE                                                               212048
     C**********           Z-ADDZZINDY    WDAYS   50                                 CLE013 MD037658
     C                     Z-ADDZZINDY    WDAYS  159                                        MD037658
     C                     END                                                                212048
      *                                                                                       CLE071
     C                     Z-ADDWEND      SVENDT                                              CLE071
      *
      ** BKALDI should not be considered when calculating fees due        152166
      ** to be paid.                                                      152166
      *                                                                   152166
     C***********                                                  101322 133888
     C***Consider*the*Accrue*on*Last*Day*indicator*when*calculating101322 133888
     C***for*the*due*amount*                                       101322 133888
     C***********                                                  101322 133888
     C***********FEPYON    IFEQ 'N'                                101322 133888
     C***********BKALDI    ANDNE'Y'                                101322 133888
     C***********FELPDT    IFEQ 0                                  101322 133888
     C***********FELPDT    ORGT RUND                               101322 133888
     C***********FEPLPD    ANDEQ0                                  101322 133888
     C***********          ADD  1         WDAYS                    101322 133888
     C***********          END                                     101322 133888
     C***********WEND      IFEQ FEPEND                             101322 133888
     C***********          SUB  1         WDAYS                    101322 133888
     C***********          END                                     101322 133888
     C***********          END                                     101322 133888
      *
     C                     Z-ADDWEND      PAYDAT
      *                                                                                     MD052216
      ** Consider payment taken day indicator on fee event date                             MD052216
      ** if due date falls on a holiday                                                     MD052216
      *                                                                                     MD052216
     C           FEEDQD    CHAINLEFEEQL0             55                                     MD052216
     C           *IN55     IFEQ *OFF                                                        MD052216
     C                     MOVEL'Y'       WCALCF                                            MD052216
     C                     EXSR CHKPAY                                                      MD052216
     C                     ENDIF                                                            MD052216
      *
      ***  Obtain amounts for calculation using information from the
      ***  latest record held on the facility amounts file for the
      ***  start date.
      *
     C                     Z-ADDWSTART    STDATE
     C**********           Z-ADD99        STFSEQ                                              200289
     C**********           Z-ADD999       STFSEQ                                     200289 AR674226
     C                     Z-ADD9999      STFSEQ                                            AR674226
     C/COPY WNCPYSRC,LE0492C001
      *
     C           KEY004    SETGTFACHSAL1
     C                     READPFACHSAL1                 17
      *
      ***  Records should exist so output database error if not found
      *
     C           *IN17     IFEQ '1'                        ***B002
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVE 'FACHSAL1'DBFILE           ************
     C                     MOVELFECNUM    DBKEY            * DBERR 09 *
     C                     MOVE FEFACL    DBKEY            ************
     C                     Z-ADD9         DBASE
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             ***E002
      *
      *** Fees calculated on available amount
      *
     C           FECALT    IFEQ '01'                       ***B002
     C           FECALT    OREQ '02'
     C           FECALT    OREQ '03'
     C           FECALT    OREQ '04'
     C           FECALT    OREQ '05'
     C           FECALT    OREQ '06'
     C           FAUNDR    IFGE 0                          ***B003
     C                     Z-ADDFAUNDR    AAMT   150
     C                     ELSE                            ***X003
     C                     Z-ADD0         AAMT
     C                     END                             ***E003
     C                     END                             ***E002
      *
      *** Fees calculated on outstanding amounts
      *
     C           FECALT    IFEQ '11'                       ***B002
     C           FECALT    OREQ '12'
     C           FECALT    OREQ '13'
     C           FECALT    OREQ '14'
     C           FECALT    OREQ '15'
     C           FECALT    OREQ '16'
     C                     Z-ADDFADRAM    AAMT
     C                     END                             ***E002
      *
      ***  For fees calculated on facility amount
      *
     C           FECALT    IFEQ '21'                       ***B002
     C           FECALT    OREQ '22'
     C                     Z-ADDFACFAM    AAMT
     C                     END                             ***E002
      *
      ***  Set up current facility amount from facility history
      ***  amounts file.
      *
     C                     Z-ADDFACFAM    CFAMT
     C/COPY WNCPYSRC,LE0492CCP2                                           S01408
      *
      *** Using amount & dates set up calculate fee amount
      *
     C                     Z-ADDFADRAM    WRKARY 130
     C                     MOVE '0'       *IN10
     C           KEY005    READEFACHSAL1                 10
     C*                                                                   E45727
     C**   If no record found,and End Date is on or before control date   E45727
     C*                                                                   E45727
     C           *IN10     IFEQ '1'                        ***B002        E45727
     C           WEND      ANDLEWCODT                                     E45727
     C*                                                                   E45727
     C**  Calculate number of days to base fee calculation upon.          E45727
     C*                                                                   E45727
     C           CLE071    IFEQ 'N'                                                           CLE071
     C           WKAVFE    OREQ 'Y'                                                           CLE071
     C***********WEND      SUB  WSTART    NDAYS                    E45727 CLE013
     C                     Z-ADDWSTART    ZZBEG                           CLE013
     C                     Z-ADDWEND      ZZEND                           CLE013
     C                     MOVE FECALC    ZZCALC                          CLE013
     C                     EXSR ZINTDY                                    CLE013
     C           FECALC    IFEQ 6                                                             212048
     C                     Z-ADDINT6DY    NDAYS                                               212048
     C                     ELSE                                                               212048
     C                     Z-ADDZZINDY    NDAYS                           CLE013
     C                     END                                                                212048
     C*                                                                   E45727
      ** BKALDI should not be considered when calculating fees due        152166
      ** to be paid.                                                      152166
      *                                                                   152166
     C***********                                                  101322 133888
     C***Consider*the*Accrue*on*Last*Day*indicator*when*calculating101322 133888
     C***for*the*due*amount                                        101322 133888
     C***********                                                  101322 133888
     C***********FEPYON    IFEQ 'N'                                101322 133888
     C***********BKALDI    ANDNE'Y'                                101322 133888
     C***********FELPDT    IFEQ 0                                  101322 133888
     C***********FELPDT    ORGT RUND                               101322 133888
     C***********FEPLPD    ANDEQ0                                  101322 133888
     C***********          ADD  1         NDAYS                    101322 133888
     C***********          END                                     101322 133888
     C***********WEND      IFEQ FEPEND                             101322 133888
     C***********          SUB  1         NDAYS                    101322 133888
     C***********          END                                     101322 133888
     C***********          END                                     101322 133888
     C*                                                                   E45727
     C**  Peform fee calculation                                          E45727
     C*                                                                   E45727
     C           NDAYS     IFGT 0                          ***B003        E45727
     C                     EXSR CALCSR                                    E45727
     C                     Z-ADDWEND      WSTART                          E45727
     C                     END                             ***E003        E45727
     C*                                                                   E45727
     C                     ELSE                                                               CLE071
      *                                                                                       CLE071
     C           CLE071    IFEQ 'Y'                                                           CLE071
     C           WKAVFE    ANDNE'Y'                                                           CLE071
     C                     Z-ADDWEND      WKENDD                                              CLE071
     C                     EXSR CALFE1                                                        CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     END                             ***E002        E45727
      *
      ***  If record found, and FACHISA Date is before end date and
      ***  before Control Date :
      *
     C           *IN10     DOWEQ'0'                        ***B002
     C           FADATE    ANDLEWEND
     C           FADATE    ANDLEWCODT
      *
      *** Calculate number of days to base fee calculation upon.
      *
     C           CLE071    IFEQ 'N'                                                           CLE071
     C           WKAVFE    OREQ 'Y'                                                           CLE071
      *                                                                                       CLE071
     C***********FADATE    SUB  WSTART    NDAYS   50                      CLE013
     C                     Z-ADDWSTART    ZZBEG                           CLE013
     C                     Z-ADDFADATE    ZZEND                           CLE013
     C                     MOVE FECALC    ZZCALC                          CLE013
     C                     EXSR ZINTDY                                    CLE013
     C           FECALC    IFEQ 6                                                             212048
     C                     Z-ADDINT6DY    NDAYS                                               212048
     C                     ELSE                                                               212048
     C**********           Z-ADDZZINDY    NDAYS   50                                 CLE013 MD037658
     C                     Z-ADDZZINDY    NDAYS  159                                        MD037658
     C                     END                                                                212048
      *
      *** Peform fee calculation & then make the date of the last fee
      *** action the starting date for calculating the next fee action
      *** from.
      *
     C           NDAYS     IFGT 0                          ***B003
     C                     EXSR CALCSR
     C                     Z-ADDFADATE    WSTART
     C                     END                             ***E003
      *
     C                     ELSE                                                               CLE071
      *                                                                                       CLE071
     C           CLE071    IFEQ 'Y'                                                           CLE071
     C           WKAVFE    ANDNE'Y'                                                           CLE071
     C                     Z-ADDFADATE    WKENDD                                              CLE071
     C                     EXSR CALFE1                                                        CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
      ***  Store current facility amount for use later.
      *
     C                     Z-ADDFACFAM    CFAMT  130
      *
      *** Reset AAMT field before reading next record.  This means
      *** that calculations for the next record are based on the
      *** previous undrawn/drawn/facility amount.
      *
     C           FECALT    IFEQ '01'                       ***B003
     C           FECALT    OREQ '02'
     C           FECALT    OREQ '03'
     C           FECALT    OREQ '04'
     C           FECALT    OREQ '05'
     C           FECALT    OREQ '06'
     C           FAUNDR    IFGE 0                          ***B004
     C                     Z-ADDFAUNDR    AAMT
     C                     ELSE                            ***X004
     C                     Z-ADD0         AAMT
     C                     END                             ***E004
     C                     END                             ***E003
      *
     C           FECALT    IFEQ '11'                       ***B003
     C           FECALT    OREQ '12'
     C           FECALT    OREQ '13'
     C           FECALT    OREQ '14'
     C           FECALT    OREQ '15'
     C           FECALT    OREQ '16'
     C                     Z-ADDFADRAM    AAMT
     C                     END                             ***E003
      *
     C           FECALT    IFEQ '21'                       ***B003
     C           FECALT    OREQ '22'
     C                     Z-ADDFACFAM    AAMT
     C                     END                             ***E003
      *
      *** Save drawn amount for future calculations
      *
     C                     Z-ADDFADRAM    WRKARY
      *
     C           KEY005    READEFACHSAL1                 10
      *
     C                     END                             ***E002
      *
      ************************************
      *** POST CONTROL DATE PROCESSING ***
      ************************************
      ***********                                                         100517
      *****If*end*date*is*after*the*control*date***********************   100517
      ***********                                                         100517
     C***********WEND      IFGT WCODT                      ***B002        100517
      *
      ***  Calculate future fee amounts.  As this amount depends
      ***  on the value of the facility for each day, check for
      ***  a change in value within extract period.
      *
     C                     Z-ADDCFAMT     WRKAR2 130
     C                     Z-ADD1         V       20
      *                                                                   052445
      ***  If there were no events on LVENTEL, set up necessary fields    052445
      ***  for post-control date fee calculations.                        052445
      *                                                                   052445
     C           FOURON    IFEQ 'Y'                        ***B003        052455
      *                                                                   052445
      ***  Date Array                                                     052445
      *                                                                   052445
     C                     Z-ADD1         X                               052445
     C           X         DOWLE15                         ***B004        052445
     C                     Z-ADDWCODT     ZDAYNO  50                      052445
     C                     MOVE FCCY      ZCCY    3                       052445
     C                     MOVE *BLANKS   ZLOC    3                       052445
     C                     Z-ADDX         ZNRDYS  20                      052445
     C                     EXSR ZFWDT                                     052445
     C                     Z-ADDZDYNBR    CDAT,X                          052445
     C                     ADD  1         X                               052445
     C                     END                             ***E004        052445
     C           CDAT,15   SUB  RUND      MM      20                      100517
     C           MM        IFGT 99                                        100517
     C                     Z-ADD99        MM                              100517
     C                     END                                            100517
     C                     Z-ADD1         M                               100517
     C           M         DOWLEMM                                        100517
     C           M         ANDNE0                                         157096
     C           RUND      ADD  M         TDAT,M                          100517
     C                     ADD  1         M                               100517
     C                     END                                            100517
      *                                                                   052445
      *** Facility Amount (initialised to value from FCLTY file)          052445
      *                                                                   052445
     C                     Z-ADDFAMT      FFAM                            052445
     C                     Z-ADDFAMT      TFAM                            100517
      *                                                                   052445
      *** Total Drawn Amount (work field) - use history drawn amount      052445
      *                                                                   052445
     C                     Z-ADDFADRAM    FTOD                            052445
     C                     Z-ADDFADRAM    TTOD                            100517
      *                                                                   052445
     C                     END                             ***E003        052445
      *
      ***  Arrays go 15 working days into the future, but calculations
      ***  should stop once end date reached
      ***  (NB WEND cannot be greater than CDAT,15 as that case
      ***  wouldn't have got in this far)
      *
     C***********V         DOWLE15                         ***B003        100517
     C***********CDAT,V    ANDLEWEND                                      100517
     C           V         DOWLEMM                                        100517
     C           TDAT,V    ANDLEWEND                                      100517
      *
      ***  Work through each value of total drawn, and facility amount
      ***  (the latter only if not a revolving credit), looking for a
      ***  change from the previous value, but stopping at the end date
      *
     C***********FTOD,V    IFNE WRKARY                     ***B004        100517
     C***********CDAT,V    ANDLEWEND                                      100517
     C***********FFAM,V    ORNE WRKAR2                                    100517
     C***********CDAT,V    ANDLEWEND                                      100517
     C***********RVCR      ANDNE'Y'                                       100517
     C***********CDAT,V    OREQ WEND                                      100517
     C           TTOD,V    IFNE WRKARY                                    100517
     C           TDAT,V    ANDLEWEND                                      100517
     C           TFAM,V    ORNE WRKAR2                                    100517
     C           TDAT,V    ANDLEWEND                                      100517
     C           RVCR      ANDNE'Y'                                       100517
     C           TDAT,V    OREQ WEND                                      100517
      *
      **************************************************************
      ***  Set up amount for accrual for actual amount type fees ***
      **************************************************************
      *
     C***********          Z-ADDFFAM,V    CFAMT                           100517
     C***********CDAT,V    SUB  WSTART    NDAYS                           100517
     C**********           Z-ADDTFAM,V    CFAMT                                        100517 195748
     C                     Z-ADDWRKAR2    CFAMT                                               195748
     C***********TDAT,V    SUB  WSTART    NDAYS                    100517 CLE013
      *                                                                                       CLE071
     C           CLE071    IFEQ 'N'                                                           CLE071
     C           WKAVFE    OREQ 'Y'                                                           CLE071
      *                                                                                       CLE071
     C                     Z-ADDWSTART    ZZBEG                           CLE013
     C                     Z-ADDTDAT,V    ZZEND                           CLE013
     C                     MOVE FECALC    ZZCALC                          CLE013
     C                     EXSR ZINTDY                                    CLE013
     C           FECALC    IFEQ 6                                                             212048
     C                     Z-ADDINT6DY    NDAYS                                               212048
     C                     ELSE                                                               212048
     C                     Z-ADDZZINDY    NDAYS                           CLE013
     C                     END                                                                212048
     C*                                                                   101322
      ** BKALDI should not be considered when calculating fees due        152166
      ** to be paid.                                                      152166
     C*                                                                   101322
     C***********                                                  101322 133888
     C***Consider*the*Accrue*on*Last*Day*indicator*when*calculating101322 133888
     C***for*the*due*amount                                        101322 133888
     C***********                                                  101322 133888
     C***********FEPYON    IFEQ 'N'                                101322 133888
     C***********BKALDI    ANDNE'Y'                                101322 133888
     C***********TDAT,V    ANDEQWEND                               101322 133888
     C***********FELPDT    IFEQ 0                                  101322 133888
     C***********FELPDT    ORGT RUND                               101322 133888
     C***********FEPLPD    ANDEQ0                                  101322 133888
     C***********          ADD  1         NDAYS                    101322 133888
     C***********          END                                     101322 133888
     C***********WEND      IFEQ FEPEND                             101322 133888
     C***********          SUB  1         NDAYS                    101322 133888
     C***********          END                                     101322 133888
     C***********          END                                     101322 133888
     C***********                                                  101322 133888
     C           NDAYS     IFGT 0                          ***B005
     C                     EXSR CALCSR
     C***********          Z-ADDCDAT,V    WSTART                          100517
     C                     Z-ADDTDAT,V    WSTART                          100517
     C                     END                             ***E005
      *
     C                     ELSE                                                               CLE071
      *                                                                                       CLE071
     C           CLE071    IFEQ 'Y'                                                           CLE071
     C           WKAVFE    ANDNE'Y'                                                           CLE071
     C                     Z-ADDTDAT,V    WKENDD                                              CLE071
     C                     EXSR CALFE1                                                        CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
      *** Set up fields for next search of arrays for any changes.
      *
     C           FECALT    IFEQ '01'                       ***B005
     C           FECALT    OREQ '02'
     C           FECALT    OREQ '03'
     C           FECALT    OREQ '04'
     C           FECALT    OREQ '05'
     C           FECALT    OREQ '06'
     C***********FFAM,V    SUB  FTOD,V    AAMT                            100517
     C           TFAM,V    SUB  TTOD,V    AAMT                            100517
     C                     END                             ***E005
      *
     C           FECALT    IFEQ '11'                       ***B005
     C           FECALT    OREQ '12'
     C           FECALT    OREQ '13'
     C           FECALT    OREQ '14'
     C           FECALT    OREQ '15'
     C           FECALT    OREQ '16'
     C***********          Z-ADDFTOD,V    AAMT                            100517
     C                     Z-ADDTTOD,V    AAMT                            100517
     C                     END                             ***E005
      *
     C           FECALT    IFEQ '21'                       ***B005
     C           FECALT    OREQ '22'
     C***********          Z-ADDFFAM,V    AAMT                            100517
     C                     Z-ADDTFAM,V    AAMT                            100517
     C                     END                             ***E005
      *
     C***********          Z-ADDFTOD,V    WRKARY 130                      100517
     C                     Z-ADDTTOD,V    WRKARY 130                      100517
      *
     C           RVCR      IFNE 'Y'                        ***B005
     C***********          Z-ADDFFAM,V    WRKAR2                          100517
     C                     Z-ADDTFAM,V    WRKAR2                          100517
     C                     END                             ***E005
      *
     C                     END                             ***E004
      *
     C                     ADD  1         V
      *
      *** End of V DOWLE 15 loop
     C                     END                             ***E003
      ***********                                                         100517
      *****End*if*WEND*GT*CODT*****************************************   100517
     C***********          END                             ***E002        100517
      *
      **************************************************************
      ***  Set up amount for average type fees which are accrued ***
      ***  over the whole period.                                ***
      **************************************************************
      *
     C           FECALT    IFEQ '01'                       ***B002
     C           FECALT    OREQ '02'
     C           FECALT    OREQ '03'
     C           FECALT    OREQ '11'
     C           FECALT    OREQ '12'
     C           FECALT    OREQ '13'
     C           FECALT    OREQ '21'
      *                                                                                       CLE071
     C           CLE071    IFEQ 'N'                                                           CLE071
     C                     EXSR ACCRUE
     C                     ADD  WTOT      WFEE
     C                     ELSE                                                               CLE071
     C                     EXSR CALFE2                                                        CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     END                             ***E002
     C/COPY WNCPYSRC,LE0492CCP4                                           S01408
      *                                                                   CLE005
     C           FELPDT    IFGT RUND                                      CLE005
     C           FEAUTO    IFNE 'Y'                                                           218992
     C           FEAUTO    ANDNE'C'                                                           CLE134
     C           FEAUT2    ANDNE'C'                                                           CLE134
     C                     Z-ADDFEAMTP    WFEE                            CLE005
     C                     ENDIF                                                              218992
      *                                                                                      243496B
      ** Do not include past due amount                                                      243496B
      *                                                                                      243496B
     C                     SUB  FEPAMP    WFEE                                               243496B
      *                                                                                      243496B
     C                     ELSE                                           CLE005
     C***********          ADD  FEAMTP    WFEE                     CLE005 157283
     C**********           ADD  FEAMTA    WFEE                                        CLE005 243496B
     C                     MOVE '0'       *IN30                                               243496
     C           FEAAMT    CHAINLEFEAMF              30                                       243496
      *                                                                                       243496
     C           *IN30     IFEQ '0'                                                           243496
     C                     ADD  FEOAMT    WFEE                                                243496
     C                     ENDIF                                                              243496
     C                     ENDIF                                          CLE005
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WRKFLD                                              CLE034
     C                     MOVE '*EOF   ' STALCD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WRKFLD    DOWEQ'Y'                                                           CLE034
     C           STALCD    OREQ *BLANKS                    AOSTALR2 - RTCD                    CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *
      ***  Output facility fee event
     C                     EXSR FEEPAY
      *                                                                     0039
      ***  Do not output telex if non-working day accrual run               0039
      *                                                                     0039
     C           *INU3     IFEQ '0'                                         0039
     C*                                                                     0039
      ***  Check if telex should be sent
     C                     EXSR RTLX
      ***  If bills/telexes indicator 'Y' check if b/t should be sent.
     C           BTIN      IFNE 'N'                        ***B002
     C                     EXSR CBILL
     C                     END                             ***E002
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WRKFLD                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
     C           FERECI    ANDNE'*'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     END                                                                CLE034
      *                                                                                       CLE034
     C           *INU3     IFEQ '0'                                                           CLE034
      *
      ***  Update pay/receive & bill/telex flags on LEFEED
      *
     C                     EXCPTXLEF
      *
     C                     END                                              0039
      *                                                                     0039
     C***********          END                             ***E001        045634
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/CALCSR
      *****************************************************************
      *                                                               *
      *  CALCSR - CALCULATION PROCESSING                              *
      *                                                               *
      *  Called By: CALFEE                                            *
      *                                                               *
      *  Calls:     ACCRUE                                            *
      *                                                               *
      *****************************************************************
      *
     C           CALCSR    BEGSR
      *
      *** If average amount type fees calculate proportion of AAMT
      *** applicable to NDAYS (WDAYS is whole period,) and add into
      *** total amount (WAMT)
      *
     C           FECALT    IFEQ '01'                       ***B001
     C           FECALT    OREQ '02'
     C           FECALT    OREQ '03'
     C           FECALT    OREQ '11'
     C           FECALT    OREQ '12'
     C           FECALT    OREQ '13'
     C           FECALT    OREQ '21'
      *
     C                     MULT NDAYS     AAMT
     C                     DIV  WDAYS     AAMT      H
     C                     ADD  AAMT      WAMT
      *
     C                     END                             ***E001
      *
      *** Actual amount fees
      *
     C           FECALT    IFEQ '04'                       ***B001
     C           FECALT    OREQ '05'
     C           FECALT    OREQ '06'
     C           FECALT    OREQ '14'
     C           FECALT    OREQ '15'
     C           FECALT    OREQ '16'
     C           FECALT    OREQ '22'
      *
     C                     Z-ADDNDAYS     WDAYS
     C                     Z-ADDAAMT      WAMT
     C                     EXSR ACCRUE
     C                     ADD  WTOT      WFEE   150
      *
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *********************************************************************
     C/TITLE SR/ACCRUE
      *********************************************************************
      *                                                                   *
      *  ACCRUE - SUBROUTINE TO CALCULATE ACCRUAL AMOUNT                  *
      *                                                                   *
      *  Called By: CALFEE, CALCSR                                        *
      *                                                                   *
      *  Calls:     CONV, LSTRAT,                                         *
      *                                                                   *
      *********************************************************************
      *
     C           ACCRUE    BEGSR
      *
     C                     Z-ADD0         WTOT   150
      *
      ** Calculate percentage if required.
      *
     C********** FEPIND    IFNE 'A'                        ***B001                            CLE071
     C           WKPIND    IFNE 'A'                                                           CLE071
      *
      ** For average amount type fees calculate what % WAMT is of the
      ** original facility amount
      *
     C           FECALT    IFEQ '01'                       ***B002
     C           FECALT    OREQ '02'
     C           FECALT    OREQ '03'
     C           FECALT    OREQ '11'
     C           FECALT    OREQ '12'
     C           FECALT    OREQ '13'
     C           FECALT    OREQ '21'
      *
     C           KEY006    CHAINFACHISH              18
      *
     C           *IN18     IFEQ '0'                        ***B003
     C                     MOVE FHFCCY    INCCY
     C           FHOFAM    IFGT 0                                                             246018
     C           WAMT      DIV  FHOFAM    WRK155 155H
     C                     ELSE                                                               246018
     C                     Z-ADD0         WRK155                                              246018
     C                     ENDIF                                                              246018
     C           WRK155    MULT 100       WPCT
     C                     Z-ADDFHOFAM    WAMT
     C                     ELSE
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVELFACT      WRKKEY  5
     C                     MOVE FCNO      WRKKEY
     C                     MOVELFECNUM    DBKEY
     C                     MOVE WRKKEY    DBKEY
     C                     MOVE 'FACHISH 'DBFILE           ************
     C                     Z-ADD10        DBASE            * DBERR 10 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END                             ***E003
      *
     C                     END                             ***E002
      *
      ***  Actual amount type fees calculate what percentage
      ***  WAMT is of the current facility amount
      *
     C           FECALT    IFEQ '04'                       ***B002
     C           FECALT    OREQ '05'
     C           FECALT    OREQ '06'
     C           FECALT    OREQ '14'
     C           FECALT    OREQ '15'
     C           FECALT    OREQ '16'
     C           FECALT    OREQ '22'
      *                                                                                       195748
     C           CFAMT     IFEQ 0                                                             195748
     C                     Z-ADD0         WPCT                                                195748
     C                     ELSE                                                               195748
     C           WAMT      DIV  CFAMT     WRK155    H
     C           WRK155    MULT 100       WPCT
     C                     ENDIF                                                              195748
      *                                                                                       195748
     C                     Z-ADDCFAMT     WAMT
     C                     MOVE FCCY      INCCY
     C                     END                             ***E002
      *
      ***  If percentage is > 100 then reset
      *
     C           WPCT      IFGT 100                        ***B002
     C                     Z-ADD100       WPCT
     C                     END                             ***E002
      *
     C                     ELSE                            ***X001
     C                     MOVE FCCY      INCCY
      *
     C                     END                             ***E001
      *
      *** Fee customer bills/telexes are output in fee currency so
      *** convert if required.
      *
     C                     MOVE FEFCCY    OUTCCY
     C                     Z-ADDWEAMT     SAVWEE 150
     C                     Z-ADDWAMT      WEAMT
      *
     C** Convert the amount to fee currency, using the fee exchange       100523
     C** rate (if not zero) or using cross exchange rate.                 100523
     C*                                                                   100523
     C           FEERAT    IFEQ 0                                         100523
     C                     EXSR CONV
     C                     ELSE                                           100523
     C**********           CALL 'AOCURRR0'                                             100523 CSC042
     C**********           PARM '*MSG   ' @RTCD   7                                    100523 CSC042
     C**********           PARM '*KEY   ' @OPTN   7                                    100523 CSC042
     C**********           PARM INCCY     CURKEY  3                                    100523 CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                        100523 CSC042
     C********** @RTCD     IFNE *BLANKS                                                100523 CSC042
     C                     MOVELINCCY     CURKEY                                              CSC042
     C                     MOVELCURKEY    ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
     C                     EXSR ##SETC                                                        CSC042
     C                     ELSE                                                               CSC042
     C           *LOCK     IN   LDA                                       100523
     C                     MOVEL'LE0492'  DBPGM                           100523
     C**********           MOVEL'SDCURRPD'DBFILE           ************                100523 CSC042
     C                     MOVEL'CURR,Q  'DBFILE                                              CSC042
     C                     MOVELINCCY     DBKEY            * DBERR 19 *   100523
     C                     Z-ADD19        DBASE            ************   100523
     C                     SETON                     U7U8                 100523
     C                     OUT  LDA                                       100523
     C                     EXSR *PSSR                                     100523
     C                     END                                            100523
     C*                                                                   100523
     C** Set up currency decimal place power position.                    100523
     C*                                                                   100523
     C           CDP       ADD  4         FD                              100523
     C*                                                                   100523
     C** Adjust incoming amount for from CCY decimal places.              100523
     C*                                                                   100523
     C           WEAMT     DIV  POWER,FD  WRK153                          100523
     C*                                                                   100523
     C** Exchange rate conversion.                                        100523
     C*                                                                   100523
     C           FEMDIN    IFEQ 'M'                                       100523
     C                     MULT FEERAT    WRK153                          100523
     C                     ELSE                                           100523
     C                     DIV  FEERAT    WRK153    H                     100523
     C                     END                                            100523
     C*                                                                   100523
     C** Adjust calculated amount for to currency decimal places.         100523
     c*                                                                   100523
     C           WRK153    MULT POWER,TD  WEAMT                           100523
     C*                                                                   100523
     C                     END                                            100523
      *
     C                     Z-ADDWEAMT     WAMT
     C                     Z-ADDSAVWEE    WEAMT
      *
      ** Retrieve calculation basis
      *
     C                     MOVE '0'       *IN15
     C           FECALC    LOKUPTABCAL    TABCBS         15
     C           *IN15     IFEQ '1'                        ***B001
     C                     Z-ADDTABCBS    WCBS    50
     C                     END                             ***E001
      *
      **************************
      *** TIERED CALCULATION ***
      **************************
      *
     C           FECALT    IFEQ '01'                       ***B001
     C           FECALT    OREQ '04'
     C           FECALT    OREQ '11'
     C           FECALT    OREQ '14'
      *
      *** Amount type calculation (not percentage)
      *
     C********** FEPIND    IFEQ 'A'                        ***B002                            CLE071
     C           WKPIND    IFEQ 'A'                                                           CLE071
      *
      *** Use power array to multiply each tier amount by the
      *** element four on from the number of decimal places of the
      *** currency (i.e., if 0 dec. places use element 4; etc)
      *** and place in separate array (FAM)
      *
     C                     Z-ADD1         X
     C           FEFCCY    LOKUPCURR,X                   13
      *
     C           CCDP,X    ADD  4         P       20
      *
     C********** FEEM      MULT POWER,P   FAM                                                 CLE071
     C           WFEM      MULT POWER,P   FAM                                                 CLE071
      *
     C                     Z-ADD0         WFAM   150
     C                     Z-ADDWAMT      WOAMT  150
     C                     Z-ADD1         X
      *
     C           WAMT      DOWGT0                          ***B003
     C           X         ANDLT6
      *
      ***  If the original amount is less than the current tier being
      ***  processed or the tier is zero multiply WAMT by the
      ***  corresponding fee rate for the tier and put in workfield.
      *
     C           WOAMT     IFLT FAM,X                      ***B004
     C           FAM,X     OREQ 0
     C********** WAMT      MULT FRT,X     WRK15  150                                          CLE071
     C           WAMT      MULT WFRT,X    WRK15  150                                          CLE071
     C                     END                             ***E004
      *
      ***  If the original amount is greater than or equal to the
      ***  current tier, and the tier is not zero subtract WFAM from
      ***  the tier.  Multiply the resultant work field by the
      ***  corresponding fee rate for the tier.
      *
     C           WOAMT     IFGE FAM,X                      ***B004
     C           FAM,X     ANDNE0
     C           FAM,X     SUB  WFAM      WRK15
     C**********           MULT FRT,X     WRK15                                               CLE071
     C                     MULT WFRT,X    WRK15                                               CLE071
     C                     END                             ***E004
      *
     C                     ADD  WRK15     WTOT
      *
     C                     SUB  FAM,X     WAMT
      *
     C                     ADD  WFAM      WAMT
     C                     Z-ADDFAM,X     WFAM
      *
     C                     ADD  1         X
      *
     C                     END                             ***E003
      *
     C                     END                             ***E002
      *
      *** Percentage type processing
      *
      ***  If percentage required divide each tier amount by 1000 &
      ***  store result in array FPC (fee percentage).
      *
     C********** FEPIND    IFNE 'A'                        ***B002                            CLE071
     C           WKPIND    IFNE 'A'                                                           CLE071
      *
     C********** FEEM      DIV  1000      FPC                                                 CLE071
     C           WFEM      DIV  1000      FPC                                                 CLE071
     C                     Z-ADD0         WFPC    63
     C                     Z-ADDWPCT      WOPCT   63
     C                     Z-ADD1         X
      *
     C           WPCT      DOWGT0                          ***B003
     C           X         ANDLT6
      *
      ***  If original percentage (WOPCT) is less than current element
      ***  of fee percentage array or if fee percentage is zero.
      *
     C           WOPCT     IFLT FPC,X                      ***B004
     C           FPC,X     OREQ 0
     C           WAMT      MULT WPCT      WRK15
     C                     END                             ***E004
      *
      ***  If original percentage (WOPCT) is greater than or equal to
      ***  fee percentage from array, and fee percentage not zero.
      *
     C           WOPCT     IFGE FPC,X                      ***B004
     C           FPC,X     ANDNE0
     C           FPC,X     SUB  WFPC      WRK63   63
     C           WAMT      MULT WRK63     WRK15
     C                     END                             ***E004
      *
     C**********           MULT FRT,X     WRK15                                               CLE071
     C                     MULT WFRT,X    WRK15                                               CLE071
     C                     DIV  100       WRK15     H
     C                     ADD  WRK15     WTOT
     C                     SUB  FPC,X     WPCT
     C                     ADD  WFPC      WPCT
     C                     Z-ADDFPC,X     WFPC
      *
     C                     ADD  1         X
      *
     C                     END                             ***E003
      *
     C                     END                             ***E002
      *
      ** Calculate final accrual amount.
      *
     C**********           MULT WDAYS     WTOT                                              MD046351
     C**********           DIV  WCBS      WTOT      H                                       MD046351
      *                                                                                     MD046351
     C           WTOT      MULT WDAYS     ZWK309 309                                        MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
      *
     C                     END                             ***E001
      *
      *
      *****************************
      *** THRESHOLD CALCULATION ***
      *****************************
      *
     C           FECALT    IFEQ '02'                       ***B001
     C           FECALT    OREQ '05'
     C           FECALT    OREQ '12'
     C           FECALT    OREQ '15'
      *
      *** Amount type processing
      *
     C********** FEPIND    IFEQ 'A'                        ***B002                            CLE071
     C           WKPIND    IFEQ 'A'                                                           CLE071
      *
      *** Use power array to multiply each threshold amount by the
      *** element four on from the number of decimal places of the
      *** currency (i.e., if 0 dec. places use element 4; etc)
      *** and place in separate array (FAM)
      *
     C                     Z-ADD1         X
     C           FEFCCY    LOKUPCURR,X                   13
      *
     C           CCDP,X    ADD  4         P
     C********** FEEM      MULT POWER,P   FAM                                                 CLE071
     C           WFEM      MULT POWER,P   FAM                                                 CLE071
      *
      *** Look up FAM array for amount greater than or equal to work
      *** amount (difference in field lengths so put WAMT in workfield
      *** to carry out LOKUP)
      *
     C                     Z-ADD1         X
     C                     MOVE '0'       *IN16
     C           WAMT      LOKUPFAM,X                16  16
      *
      ***  If none found perform last rate processing
      *
     C           *IN16     IFEQ '0'                        ***B003
     C                     EXSR LSTRAT
     C                     END                             ***E003
      *
      ***  If none found and appropriate amount & rate combination
      ***  from LSTRAT subroutine not found zeroise work amount.
      *
     C           *IN16     IFEQ '0'                        ***B003
     C           Y         ANDEQ0
     C                     MULT 0         WAMT
     C***********          END                             ***E003        103020
     C                     ELSE                                           103020
      *
      ***  If none found but appropriate amount & rate combination
      ***  is found, or else if a FAM element > or = to work amount.
      *
     C************IN16     IFEQ '0'                        ***B003        103020
     C***********Y         ANDLT0                                         103020
     C************IN16     OREQ '1'                                       103020
     C**********           MULT FRT,X     WAMT                                                CLE071
     C                     MULT WFRT,X    WAMT                                                CLE071
     C                     END                             ***E003
      *
     C                     END                             ***E002
      *
      *** Percentage type processing
      *
     C********** FEPIND    IFNE 'A'                        ***B002                            CLE071
     C           WKPIND    IFNE 'A'                                                           CLE071
      *
      *** Divide each threshold amount by 1000 & store in array
      *
     C********** FEEM      DIV  1000      FPC                                                 CLE071
     C           WFEM      DIV  1000      FPC                                                 CLE071
      *
      *** Search percentage array to find value larger than or equal
      *** to WPCT
      *
     C                     Z-ADD1         X
     C                     MOVE '0'       *IN17
     C           WPCT      LOKUPFPC,X                17  17
      *
      *** If none found perform last rate processing
      *
     C           *IN17     IFEQ '0'                        ***B003
     C                     EXSR LSTRAT
     C                     END                             ***E003
      *
     C                     MULT WPCT      WAMT
      *
     C           *IN17     IFEQ '0'                        ***B003
     C***********Y         ANDLT0                                         103020
     C           Y         ANDEQ0                                         103020
     C                     MULT 0         WAMT
     C***********          END                             ***E003        103020
     C                     ELSE                                           103020
      *
     C************IN17     IFEQ '0'                        ***B003        103020
     C***********Y         ANDEQ1                                         103020
     C************IN17     OREQ '1'                                       103020
     C**********           MULT FRT,X     WAMT                                                CLE071
     C                     MULT WFRT,X    WAMT                                                CLE071
     C                     END                             ***E003
      *
     C                     DIV  100       WAMT
      *
     C                     END                             ***E002
      *
     C********** WAMT      MULT WDAYS     WTOT                                              MD046351
     C**********           DIV  WCBS      WTOT      H                                       MD046351
      *                                                                                     MD046351
     C           WAMT      MULT WDAYS     ZWK309                                            MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
      *
     C                     END                             ***E001
      *
      ***************************
      *** SINGLE CALCULATION: ***
      ***************************
      *
     C           FECALT    IFEQ '03'                       ***B001
     C           FECALT    OREQ '06'
     C           FECALT    OREQ '13'
     C           FECALT    OREQ '16'
     C           FECALT    OREQ '21'
     C           FECALT    OREQ '22'
      *
     C********** WAMT      MULT FRT,1     WTOT                                              MD046351
     C**********           MULT WDAYS     WTOT                                              MD046351
     C**********           DIV  WCBS      WTOT      H                                       MD046351
      *                                                                                     MD046351
     C********** WAMT      MULT FRT,1     ZWK309                                     MD046351 CLE071
     C           WAMT      MULT WFRT,1    ZWK309                                              CLE071
     C                     MULT WDAYS     ZWK309                                            MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
      *
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/FEEPAY
      *****************************************************************
      *                                                               *
      *  FEEPAY - FEE PAYMENT EVENT                                   *
      *                                                               *
      *  Called By: NONCAL, CALFEE                                    *
      *                                                               *
      *  Calls:     AOCUSTR0, AOCTRYR0, AOALTNR0, AOBRCHR0, ZHASH     *
      *             AOCURRR0                                          *   CLE031
      *                                                               *
      *****************************************************************
      *
     C           FEEPAY    BEGSR
      *
      *** Set up fields for output of the fee event.
      *
      *** Convert base currency equivalent for output
      *
     C***********          Z-ADD1         X                               045634
     C***********FEFCCY    LOKUPCURR,X                   13               045634
     C***********MTDV,X    IFEQ 'D'                        ***B001        045634
     C***********CFAMT     DIV  CSPT,X    DBCE                            045634
     C***********          ELSE                            ***X001        045634
     C***********CFAMT     MULT CSPT,X    DBCE                            045634
     C***********          END                             ***E001        045634
      *                                                                   045634
     C                     MOVE FEFCCY    INCCY            FEE CCY        045634
     C                     MOVE BJCYCD    OUTCCY           BASE CCY       045634
     C                     Z-ADDWFEE      WEAMT                           045634
      *                                                                   045634
     C                     EXSR CONV                                      045634
     C                     Z-ADDWEAMT     DBCE                            045634
     C                     Z-ADDWEAMT     BCEQ                            045634
      *
      *** Set up the full instructions indicator
      *
     C           FESTTL    IFEQ 0                          ***B001
     C                     MOVE 'N'       FIPI
     C                     END                             ***E001
      *
     C           FESTTL    IFEQ 1                          ***B001
     C           FESTTL    OREQ 7
     C           FESTTL    OREQ 8
     C           FEOURS    ANDEQ*BLANKS
     C           FETHER    OREQ *BLANKS
     C                     MOVE 'N'       FIPI
     C                     END                             ***E001
      *
     C           FESTTL    IFEQ 2                          ***B001
     C           FESTTL    OREQ 5
     C           FESTTL    OREQ 12
     C           FESTTL    OREQ 14
     C           FEOURS    ANDEQ*BLANKS
     C                     MOVE 'N'       FIPI
     C                     END                             ***E001
      *
     C           FIPI      IFNE 'N'                        ***B001
     C                     MOVE 'Y'       FIPI
     C                     END                             ***E001
      *
     C                     MOVE FESTTL    SETP
     C                     MOVE FEOURS    OSAC
     C                     MOVE FETHER    TSEN
      *                                                                                       244804
      ** For facility FEES:                                                                   244804
      ** If participant and sub-participant, it should be outgoing.                           244804
      ** If internal participant, it should be blank (neutral).                               244804
      ** Other than these, it should be incoming.                                             244804
      *                                                                                       244804
     C           FEFACL    IFGT 0                                                             244804
      *                                                                                       244804
     C           PRTR      IFEQ 'P'                                                           244804
     C           PRTR      OREQ 'S'                                                           244804
     C                     MOVE 'O'       INOI                                                244804
     C                     ELSE                                                               244804
     C                     MOVE 'I'       INOI
     C                     ENDIF                                                              244804
      *                                                                                       244804
     C           PRTR      IFEQ 'I'                                                           244804
     C                     MOVE 'N'       INOI                                                244804
     C                     ENDIF                                                              244804
      *                                                                                       244804
     C                     ENDIF                                                              244804
      *                                                                                       244804
      ** Loan based FEES:                                                                     244804
      *                                                                                       244804
     C********** FELOAN    IFGT 0                                                      244804 CLE148
     C           FELOAN    IFNE *BLANKS                                                       CLE148
      *                                                                                       244804
     C           PTFI      IFEQ 'P'                                                           244804
     C           PTFI      OREQ 'S'                                                           244804
     C                     MOVE 'O'       INOI                                                244804
     C                     ELSE                                                               244804
     C                     MOVE 'I'       INOI                                                244804
     C                     ENDIF                                                              244804
      *                                                                                       244804
     C           PTFI      IFEQ 'I'                                                           244804
     C                     MOVE 'N'       INOI                                                244804
     C                     ENDIF                                                              244804
      *                                                                                       244804
     C                     ENDIF                                                              244804
      *                                                                                       244804
     C                     MOVE FEOSBR    OSBR                            045634
     C                     Z-ADDFEFSEQ    LASN                            045634
     C                     MOVE *BLANKS   EXEI                            045634
     C                     MOVE 'B'       ELVB                            045634
     C                     MOVE 'C'       ELVC                            045634
     C                     MOVE 'S'       ELVS                            045634
      *                                                                                       218992
     C                     MOVELOSDB      ROBR                                                218992
     C                     MOVELOMDB      POBR                                                218992
     C                     MOVELFESCCY    RSCY                                                218992
     C                     MOVELFEPSCY    PSCY                                                218992
     C                     MOVELFEICCY    IC72                                                218992
     C                     Z-ADDFEREXR    REXR                                                218992
     C                     MOVELFEREXI    REXI                                                218992
     C                     Z-ADDFEPEXR    PEXR                                                218992
     C                     MOVELFEPEXI    PEXI                                                218992
      *                                                                   CLE033
     C           CLE033    IFEQ 'Y'                                       CLE033
     C           FESTTL    ANDEQ09                                        CLE033
      *                                                                   CLE033
     C**********           MOVELP@VL02    W0ACOD  4                                    CLE033 CGL029
     C                     MOVELP@VL02    W0ACOD 10                                           CGL029
     C                     MOVELP@VL01    W0CNUM  6                       CLE033
     C           W0CNUM    CAT  W0ACOD    OSAC                            CLE033
     C                     MOVE '01'      OSAC                            CLE033
      *                                                                   CLE033
     C                     MOVE 'Y'       FIPI                            CLE033
      *                                                                   CLE033
     C                     ENDIF                                          CLE033
      *
      ***  Access client master file for customer details
      *
     C                     MOVELFECNUM    CKEY
     C                     CALL 'AOCUSTR0'
     C                     PARM '*BLANKS' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM           CKEY   10
     C                     PARM           KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
     C           WRTCD     IFNE *BLANKS                    ***B001
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVE FECNUM    DBKEY
     C                     MOVE 'SDCUSTPD'DBFILE           ************
     C                     Z-ADD11        DBASE            * DBERR 11 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END                             ***E001
      *
     C           BBPAIN    IFNE 'P'                        ***B001
     C                     Z-ADD0         PARI
     C                     ELSE                            ***X001
     C                     Z-ADD1         PARI
     C                     END                             ***E001
      *
     C                     MOVELBBPCNB    PTNU
     C                     MOVELBBCRNM    CRNM
     C                     MOVELBBCRTN    CTWN
     C                     MOVELBBCASC    CASK
      *
      ***  Access countries record for region of risk
      *
     C***********          MOVE CRSK      CTKEY                           045634
     C                     MOVE BBCNCZ    CTKEY                           045634
     C********** FELOAN    IFEQ *ZEROS                                                 045634 CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C                     MOVE WACRSK    CTKEY                           045634
     C                     END                                            045634
      *
     C                     Z-ADDCTYARR    B                                                 CLE075AP
     C           CTKEY     LOKUP#CTY,B                   48                                 CLE075AP
     C           *IN48     IFEQ '1'                                                         CLE075AP
     C           B         OCUR SDCTRY                                                      CLE075AP
     C                     ELSE                                                             CLE075AP
     C                     CALL 'AOCTRYR0'
     C                     PARM '*BLANKS' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM           CTKEY   2
     C           SDCTRY    PARM SDCTRY    DSSDY
     C           WRTCD     IFNE *BLANKS                    ***B001
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C***********          MOVE CRSK      DBKEY                           045634
     C                     MOVE CTKEY     DBKEY                           045634
     C                     MOVE 'SDCTRYPD'DBFILE           ************
     C                     Z-ADD12        DBASE            * DBERR 12 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END                             ***E001
     C                     ENDIF                                                            CLE075AP
     C                     MOVELA4RGCD    REGC                            045634
      *
      ****Check*value*of*alternate*name*&*address*code.**If*equal*to***   045634
      ****'B'*bypass*alternate*name*&*address*validation.**************   045634
      *****************************************************************   045634
     C***********NACD      IFNE 'B'                        ***B001        045634
     C***********          MOVELFECNUM    AENB                            045634
     C***********          MOVE NACD      AZCD                            045634
     C***********          CALL 'AOALTNR0'                                045634
     C***********          PARM '*BLANKS' WRTCD                           045634
     C***********          PARM '*KEY   ' WOPTN                           045634
     C***********          PARM           AENB    6                       045634
     C***********          PARM           AZCD    1                       045634
     C***********SDALTN    PARM SDALTN    DSFDY                           045634
     C***********WRTCD     IFNE *BLANKS                    ***B002        045634
     C************LOCK     IN   LDA                                       045634
     C***********          MOVEL'LE0492  'DBPGM                           045634
     C***********          MOVELFECNUM    DBKEY                           045634
     C***********          MOVE NACD      DBKEY                           045634
     C***********          MOVE 'SDALTNPD'DBFILE           ************   045634
     C***********          Z-ADD13        DBASE            * DBERR 13 *   045634
     C***********          OUT  LDA                        ************   045634
     C***********          EXSR *PSSR                                     045634
     C***********          END                             ***E002        045634
     C***********          END                             ***E001        045634
      *
     C                     MOVE CLOC      CDOM
      *
      ***  Access parent details
      *
     C                     MOVELBBPCNB    CPAR    6
     C           CPAR      IFEQ *BLANKS                    ***B001
     C           CPAR      OREQ '000000'
     C***********          MOVE *BLANKS   CRNM                            BH3493
     C***********          MOVE *BLANKS   CTWN                            BH3493
     C***********          MOVE *BLANKS   CASK                            BH3493
     C                     MOVE *BLANKS   PRNM                            BH3493
     C                     MOVE *BLANKS   PTWN                            BH3493
     C                     MOVE *BLANKS   PASK                            BH3493
     C                     ELSE                            ***X001
     C                     MOVELCPAR      CKEY
     C                     CALL 'AOCUSTR0'
     C                     PARM '*BLANKS' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM           CKEY   10
     C                     PARM           KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
      *
     C***********          MOVELBBCRNM    CRNM                            BH3493
     C***********          MOVELBBCRTN    CTWN                            BH3493
     C***********          MOVELBBCASC    CASK                            BH3493
     C                     MOVELBBCRNM    PRNM                            BH3493
     C                     MOVELBBCRTN    PTWN                            BH3493
     C                     MOVELBBCASC    PASK                            BH3493
     C                     END                             ***E001
      *
      *****CLOC*is*moved*to*CDOM*only*if*client*has*parent,*CDOM*******   045634
      *****is*blank*for*client*and*CLOC*contrains*entry*from*parent.***   045634
      *****************************************************************   045634
     C***********CPAR      IFNE *BLANKS                    ***B001        045634
     C***********CPAR      ANDNE'000000'                                  045634
     C***********CDOM      ANDEQ' '                                       045634
     C***********CLOC      ANDNE' '                                       045634
     C***********          MOVE CLOC      CDOM                            045634
     C***********          END                             ***E001        045634
      *
     C***********WRTCD     IFNE *BLANKS                    ***B001        045634
     C************LOCK     IN   LDA                                       045634
     C***********          MOVEL'LE0492  'DBPGM                           045634
     C***********          MOVE CKEY      DBKEY                           045634
     C***********          MOVE 'SDCUSTPD'DBFILE           ************   045634
     C***********          Z-ADD14        DBASE            * DBERR 14 *   045634
     C***********          OUT  LDA                        ************   045634
     C***********          EXSR *PSSR                                     045634
     C***********          END                             ***E001        045634
      *
     C                     MOVE CDOM      CTKEY
     C                     Z-ADDCTYARR    B                                                 CLE075AP
     C           CTKEY     LOKUP#CTY,B                   48                                 CLE075AP
     C           *IN48     IFEQ '1'                                                         CLE075AP
     C           B         OCUR SDCTRY                                                      CLE075AP
     C                     ELSE                                                             CLE075AP
     C                     CALL 'AOCTRYR0'
     C                     PARM '*BLANKS' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM           CTKEY   2
     C           SDCTRY    PARM SDCTRY    DSSDY
     C           WRTCD     IFNE *BLANKS                    ***B001
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVE CTKEY     DBKEY
     C                     MOVE 'SDCTRYPD'DBFILE           ************
     C                     Z-ADD15        DBASE            * DBERR 15 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END                             ***E001
     C                     ENDIF                                                            CLE075AP
      *
     C***********          MOVELA4RGCD    REGC                            045634
     C***********          MOVE REGC      RDOM    2                       045634
     C                     MOVELA4RGCD    RDOM                            045634
      *
      *** Access the branch information for fee branch
      *
     C                     Z-ADDBCHARR    A                                                 CLE075AP
     C           FEBRCA    LOKUP#BCH,A                   48                                 CLE075AP
     C           *IN48     IFEQ '1'                                                         CLE075AP
     C           A         OCUR SDBRCH                                                      CLE075AP
     C                     ELSE                                                             CLE075AP
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM FEBRCA    WDSNB   3
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           WRTCD     IFNE *BLANKS                    ***B001
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVELFEBRCA    DBKEY
     C                     MOVEL'SDBRCHPD'DBFILE           ************
     C                     Z-ADD16        DBASE            * DBERR 16 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END                             ***E001
     C                     ENDIF                                                            CLE075AP
      *
     C                     MOVE CMPYM     ECPY
     C                     MOVE CMPYM     COOB                            045634
      *
      ***  Access the branch information of the settlement branch
      ***  if the booking branch <> settlement branch and the
      ***  settlement branch is non-blank
      *
     C***********CFBR      IFNE *BLANKS                    ***B001        045634
     C***********CFBR      ANDNEFEBRCA                                    045634
     C           FEOSBR    IFNE *BLANKS                    ***B001        045634
     C           FEOSBR    ANDNEFEBRCA                                    045634
     C           FESTTL    ANDNE09                                        CLE033
     C                     Z-ADDBCHARR    A                                                 CLE075AP
     C           FEOSBR    LOKUP#BCH,A                   48                                 CLE075AP
     C           *IN48     IFEQ '1'                                                         CLE075AP
     C           A         OCUR SDBRCH                                                      CLE075AP
     C                     ELSE                                                             CLE075AP
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C***********          PARM CFBR      WDSNB   3                       045634
     C                     PARM FEOSBR    WDSNB   3                       045634
     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           WRTCD     IFNE *BLANKS                    ***B002
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVELWDSNB     DBKEY
     C                     MOVEL'SDBRCHPD'DBFILE           ************
     C                     Z-ADD17        DBASE            * DBERR 17 *
     C                     OUT  LDA                        ************
     C                     EXSR *PSSR
     C                     END                             ***E002
     C                     ENDIF                                                            CLE075AP
      *
     C***********          MOVE CMPYM     SBCMPY  3                S01117 045634
     C                     MOVE CMPYM     COBB                            045634
      *
     C                     END                             ***E001
      *
     C                     MOVE FEACOF    ACOF
     C                     MOVE 'N'       IBRE
     C           COBB      IFEQ ECPY                                      045634
     C                     MOVE 'N'       ICYE                            045634
     C                     ELSE                            ***X002        045634
     C                     MOVE 'Y'       ICYE
     C                     END                             ***E002        045634
      *
     C           FEFACL    IFEQ *ZEROS                     ***B001
     C                     MOVE '71F1'    WETYP   4
     C***********          Z-ADDLNRF      WLNRF   60                      045634
     C**********           Z-ADDFELOAN    WLNRF   60                                   045634 CLE148
     C                     MOVELFELOAN    WLNRF   6                                           CLE148
     C                     MOVE LTYP      WLTYP   2
     C                     MOVE SUTP      WSUTP   2
     C                     MOVE CLAS      WCLAS   4                                           CLE042
     C*                                                                   060308
     C** Chain to LF/CLOANL3 then to LF/FCLTYL0 to get the facility ccy   060308
     C*                                                                   060308
     C/COPY WNCPYSRC,LE0492C023
     C           WLNRF     CHAINCLOANL3              22                   060308
     C/COPY WNCPYSRC,LE0492C024
     C  N22      KEY007    CHAINFCLTYL0              22                   060308
     C  N22                MOVE FCCYL0    FCCY                            060308
     C  N22                MOVE LTYPL3    LTYP                            060308
     C  N22                MOVE SUTPL3    SUTP                            060308
     C  N22                MOVE CLASL3    CLAS                                                CLE042
     C*                                                                   060308
     C                     ELSE                            ***X001
     C                     MOVE '71F2'    WETYP
     C**********           Z-ADD*ZEROS    WLNRF                                               CLE148
     C                     MOVEL*BLANKS   WLNRF                                               CLE148
     C                     MOVE *BLANKS   WLTYP
     C                     MOVE *BLANKS   WSUTP
     C                     MOVE *BLANKS   WCLAS                                               CLE042
     C/COPY WNCPYSRC,LEH00374
     C                     END                             ***E001
      *
     C                     MOVE 'L'       RECI
     C**********           Z-ADDWLNRF     LNRF                                                CLE148
     C                     MOVELWLNRF     LNRF                                                CLE148
     C                     MOVE FECNUM    CUNR
     C                     MOVE FECNUM    OLNO                            BH3493
     C                     MOVE FECNUM    FCUS                            BH3493
     C           FECALT    IFEQ '03'                                      BH3528
     C           FECALT    OREQ '06'                                      BH3528
     C           FECALT    OREQ '13'                                      BH3528
     C           FECALT    OREQ '16'                                      BH3528
     C           FECALT    OREQ '21'                                      BH3528
     C           FECALT    OREQ '22'                                      BH3528
     C/COPY WNCPYSRC,LEH00728
      *                                                                                       CLE073
     C           FECALT    OREQ '97'                                                          CLE073
     C           CLE073    ANDEQ'Y'                                                           CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C           CLE073    ANDEQ'Y'                                                           CLE073
      *                                                                                       CLE073
     C                     Z-ADDFEFRT1    INTR                            BH3528
     C                     ELSE                                           BH3528
     C                     Z-ADD0         INTR                            BH3528
     C                     END                                            BH3528
     C                     MOVE WETYP     ETYP
     C                     Z-ADDPAYDAT    EDAT
      *                                                                                     MD052216
      ** If calculated fee, use event date computed based on                                MD052216
      ** Payment Taken Day Indicator                                                        MD052216
      *                                                                                     MD052216
     C           WCALCF    IFEQ 'Y'                                                         MD052216
     C                     Z-ADDPAYDT1    EDAT                                              MD052216
     C                     MOVEL*BLANK    WCALCF                                            MD052216
     C                     ENDIF                                                            MD052216
      *                                                                   160659
      ** Convert event amount to settlement currency if CEU004 is on      160659
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, do not convert.                                                            218782
      *                                                                                       218782
     C                     MOVE *BLANKS   SIAC                                                221684
     C           CLE033    IFEQ 'Y'                                                           218782
     C***********SETP      ANDEQ09                                                      218782218992
     C           FESTTL    ANDEQ09                                                            218992
     C           SET09     ANDEQ'T'                                                           218782
     C                     ELSE                                                               218782
      *                                                                   160659
     C           CEU004    IFEQ 'Y'                                       160659
     C           FESCCY    ANDNE*BLANKS                                   160659
     C           FEFCCY    ANDNEFESCCY                                    160659
      *                                                                   160659
      ** OR if CLE031 is active AND fee is not a participant fee AND      CLE031
      ** receipt settlement ccy is entered AND fee ccy is not the same    CLE031
      ** as receipt settlement ccy                                        CLE031
      *                                                                   CLE031
     C           CLE031    OREQ 'Y'                                       CLE031
     C           PTFI      ANDEQ*BLANKS                                   CLE031
     C           FESCCY    ANDNE*BLANKS                                   CLE031
     C           FEFCCY    ANDNEFESCCY                                    CLE031
      *                                                                   CLE031
      ** OR if CLE031 is active AND fee is a participant fee AND pay      CLE031
      ** settlement ccy is entered AND fee currency is not the same       CLE031
      ** as pay settlement ccy                                            CLE031
      *                                                                   CLE031
     C           CLE031    OREQ 'Y'                                       CLE031
     C           PTFI      ANDNE*BLANKS                                   CLE031
     C           FEPSCY    ANDNE*BLANKS                                   CLE031
     C           FEFCCY    ANDNEFEPSCY                                    CLE031
      *                                                                   CLE031
      ** Set settlement in another ccy to 'Y'                             CLE031
      *                                                                   CLE031
     C                     MOVE 'Y'       SIAC                            CLE031
     C                     ENDIF                                                              218992
     C                     ENDIF                                                              218992
      *                                                                   CLE031
     C**********           Z-ADDWFEE      P@FRAM    -Set Amnt Parm 160659 CLE031
     C**********           MOVE FEFCCY    P@FRCY    -Set FrCcy Prm 160659 CLE031
     C**********           MOVE FESCCY    P@TOCY    -Set ToCcy Prm 160659 CLE031
      **********                                    Input:         160659 CLE031
     C**********           CALL 'EU0200'                           160659 CLE031
     C**********           PARM '       ' P@RTCD  7 -Return Code   160659 CLE031
     C**********           PARM           P@FRAM 183-FROM Ccy Amt  160659 CLE031
     C**********           PARM           P@FRCY  3 -FROM Currency 160659 CLE031
     C**********           PARM           P@TOCY  3 -TO Currency   160659 CLE031
      **********                                    Output:        160659 CLE031
     C**********           PARM           P@OUTA 150-Outright Amt  160659 CLE031
     C**********           PARM           P@INTA 183-Interim Amt   160659 CLE031
     C**********           PARM           P@EXRT 159-Exchange Rate 160659 CLE031
     C**********           PARM           P@MDIN  1 -Mult/Div Ind. 160659 CLE031
      **********                                                   160659 CLE031
     C********** P@RTCD    IFNE *BLANK              If Error       160659 CLE031
     C**********           MOVEL'EU0200  'DBFILE     Set File      160659 CLE031
     C**********           MOVELFESCCY    DBKEY      Set Key       160659 CLE031
     C**********           Z-ADD27        DBASE      Set Ref       160659 CLE031
     C**********           OUT  LDA                 ************   160659 CLE031
     C**********           EXSR *PSSR                              160659 CLE031
     C**********           ENDIF                    End If         160659 CLE031
      **********                                                   160659 CLE031
     C**********           Z-ADDP@OUTA    EAMT       Set Cvrt Amt  160659 CLE031
     C**********           MOVE FESCCY    ECCY                     160659 CLE031
      **********                                                   160659 CLE031
     C**********           ELSE                                    160659 CLE031
      **********                                                   160659 CLE031
      *                                                                   CLE031
      ** Set up Event Amount and Event Ccy using the fee ccy              CLE031
      *                                                                   CLE031
     C                     Z-ADDWFEE      EAMT
     C                     MOVE FEFCCY    ECCY
     C**********           ENDIF                                   160659 CLE031
      *                                                                   160659
     C           WETYP     IFNE '71F1'                                    060308
     C                     MOVE WLTYP     LTYP
     C                     MOVE WSUTP     SUTP
     C/COPY WNCPYSRC,LEH00375
     C                     MOVE WCLAS     CLAS                                                CLE042
     C/COPY WNCPYSRC,LEH00377
     C                     END                                            060308
     C                     MOVE FEBRCA    EBRC
     C                     MOVE FEBRCA    BRCA
     C                     Z-ADD0         OTHD
     C                     Z-ADD0         OTHA
     C                     MOVE FEAUTO    AUTO                            045634
      *
      ***  If event date = due date use facility frequency, else blank
      *
     C           PAYDAT    IFEQ EDDT                       ***B001
     C                     MOVE FEFREQ    FREO
     C                     ELSE                            ***X001
     C                     MOVE ' '       FREO
     C                     END                             ***E001
     C*                                                                   S01408
     C/COPY WNCPYSRC,LE0492CPG1                                           S01408
     C*                                                                   S01408
      *                                                                   CLE004
      ** If SAR CLE004 is Present                                         CLE004
      ** and Internal Customer                                            CLE004
      ** and Shared Fee                                                   CLE004
      ** and Generated by Fund Participant                                CLE004
      *                                                                   CLE004
     C           CLE004    IFEQ *ON                                       CLE004
     C           PTFI      ANDEQ'I'                                       CLE004
     C           SHFI      ANDEQ'Y'                                       CLE004
     C           GFPT      ANDEQ'Y'                                       CLE004
      *                                                                   CLE004
      ** Toggle INOI                                                      CLE004
      *                                                                   CLE004
     C           INOI      IFEQ 'I'                                       CLE004
     C                     MOVEL'O'       INOI                            CLE004
     C                     ELSE                                           CLE004
     C           INOI      IFEQ 'O'                                       CLE004
     C                     MOVEL'I'       INOI                            CLE004
     C                     ENDIF                                          CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
     C                     ENDIF                                          CLE004
      *
     C***********          WRITELVENTELF                                  045634
     C                     WRITEOLVENTEL                                  045634
      *
      ***  Update count and hash totals for number of records output
      ***  to events file for first fee event
      *
     C********** COUNT2    ADD  1         COUNT2                            0031
     C           COUNTL    ADD  1         COUNTL                            0031
      *
     C                     Z-ADD1         Z
     C                     Z-ADD2         S
      *
     C           EAMT      DIV  1000      ZZAMT
     C                     Z-ADDTOTI2     ZZTOTI
     C                     Z-ADDTOTD2     ZZTOTD
      *
     C                     EXSR ZHASH
      *
     C                     Z-ADDZZTOTI    TOTI2  150
     C                     Z-ADDZZTOTD    TOTD2   30
      *                                                                                       CER049
     C           CER049    IFEQ 'Y'                                                           CER049
     C                     EXSR SRSTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                                       218992
     C           SIAC      IFEQ 'Y'                                                           218992
      *                                                                   CLE031
      ** Check if Fee ccy or receipt settlement ccy are an 'In' ccy       CLE031
      *                                                                   CLE031
     C**********           CALL 'AOCURRR0'                                             CLE031 CSC042
     C**********           PARM '*BLANKS' WRTCD                                        CLE031 CSC042
     C**********           PARM '*KEY   ' WOPTN                                        CLE031 CSC042
     C**********           PARM FEFCCY    CURKEY  3                                    CLE031 CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                        CLE031 CSC042
     C********** WRTCD     IFNE *BLANKS                                                CLE031 CSC042
     C                     MOVELFEFCCY    CURKEY                                              CSC042
     C                     MOVELCURKEY    ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
     C                     EXSR ##SETC                                                        CSC042
     C                     ELSE                                                               CSC042
     C           *LOCK     IN   LDA                                       CLE031
     C                     MOVEL'LE0492  'DBPGM                           CLE031
     C**********           MOVE 'SDCURRPD'DBFILE           ************                CLE031 CSC042
     C                     MOVE 'CURR,Q  'DBFILE                                              CSC042
     C                     MOVE CURKEY    DBKEY            * DBERR 55 *   CLE031
     C                     Z-ADD55        DBASE            ************   CLE031
     C                     OUT  LDA                                       CLE031
     C                     EXSR *PSSR                                     CLE031
     C                     END                                            CLE031
      *                                                                   CLE031
      ** Store Values needed for later use                                CLE031
      *                                                                   CLE031
     C                     MOVE A6INCY    WFINCY  1                       CLE031
     C                     MOVE A6NBDP    WFCDP   10                      CLE031
      *                                                                   CLE031
     C           FESCCY    IFEQ *BLANKS                                                       221607
     C           CLE031    ANDEQ'Y'                                                           221607
     C                     MOVEL*BLANKS   WSINCY                                              221607
     C                     ELSE                                                               221607
     C**********           CALL 'AOCURRR0'                                             CLE031 CSC042
     C**********           PARM '*BLANKS' WRTCD                                        CLE031 CSC042
     C**********           PARM '*KEY   ' WOPTN                                        CLE031 CSC042
     C**********           PARM FESCCY    CURKEY  3                                    CLE031 CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                        CLE031 CSC042
     C********** WRTCD     IFNE *BLANKS                                                CLE031 CSC042
     C                     MOVELFESCCY    CURKEY                                              CSC042
     C                     MOVELCURKEY    ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
     C                     EXSR ##SETC                                                        CSC042
     C                     ELSE                                                               CSC042
     C           *LOCK     IN   LDA                                       CLE031
     C                     MOVEL'LE0492  'DBPGM                           CLE031
     C**********           MOVE 'SDCURRPD'DBFILE           ************                CLE031 CSC042
     C                     MOVE 'CURR,Q  'DBFILE                                              CSC042
     C                     MOVE CURKEY    DBKEY            * DBERR 56 *   CLE031
     C                     Z-ADD56        DBASE            ************   CLE031
     C                     OUT  LDA                                       CLE031
     C                     EXSR *PSSR                                     CLE031
     C                     END                                            CLE031
      *                                                                   CLE031
      ** Store Values needed for later use                                CLE031
      *                                                                   CLE031
     C                     MOVE A6INCY    WSINCY  1                       CLE031
     C                     MOVE A6NBDP    WRSDP   10                      CLE031
     C                     ENDIF                                                              221607
      *                                                                   CLE031
      ** If Fee ccy or receipt settlement ccy are an 'In' ccy then set    CLE031
      ** IFXC to 'Y' and convert fee event amt to receipt settlement ccy  CLE031
      *                                                                   CLE031
     C           WFINCY    IFEQ 'Y'                                       CLE031
     C           WSINCY    OREQ 'Y'                                       CLE031
      *                                                                   CLE031
     C                     MOVE 'Y'       IFXC                            CLE031
      *                                                                   CLE031
     C                     Z-ADDWFEE      P@FRAM           -Set Amnt Parm CLE031
     C                     MOVE FEFCCY    P@FRCY           -Set FrCcy Prm CLE031
     C                     MOVE FESCCY    P@TOCY           -Set ToCcy Prm CLE031
      *                                                    Input:         CLE031
     C                     CALL 'EU0200'                                  CLE031
     C                     PARM '       ' P@RTCD  7        -Return Code   CLE031
     C                     PARM           P@FRAM 183       -FROM Ccy Amt  CLE031
     C                     PARM           P@FRCY  3        -FROM Currency CLE031
     C                     PARM           P@TOCY  3        -TO Currency   CLE031
      *                                                    Output:        CLE031
     C                     PARM           P@OUTA 150       -Outright Amt  CLE031
     C                     PARM           P@INTA 183       -Interim Amt   CLE031
     C                     PARM           P@EXRT 159       -Exchange Rate CLE031
     C                     PARM           P@MDIN  1        -Mult/Div Ind. CLE031
      *                                                                   CLE031
     C           P@RTCD    IFNE *BLANK                     If Error       CLE031
     C                     MOVEL'EU0200  'DBFILE            Set File      CLE031
     C                     MOVELFESCCY    DBKEY             Set Key       CLE031
     C                     Z-ADD27        DBASE             Set Ref       CLE031
     C                     OUT  LDA                        ************   CLE031
     C                     EXSR *PSSR                                     CLE031
     C                     ENDIF                           End If         CLE031
      *                                                                   CLE031
     C                     Z-ADDP@OUTA    WCEAMT 150        Set Cvrt Amt  CLE031
      *                                                                   CLE031
     C                     ELSE                                           CLE031
      *                                                                   CLE031
      ** Otherwise convert event amount to either receipt settlement      CLE031
      ** ccy or pay settlement ccy depending on whether the fee is a      CLE031
      ** participant fee or not                                           CLE031
      *                                                                   CLE031
     C                     MOVE *BLANKS   IFXC                            CLE031
      *                                                                   CLE031
     C           PTFI      IFEQ *BLANKS                                   CLE031
      *                                                                   CLE031
      ** Convert fee event amount to receipt settlement ccy               CLE031
      *                                                                   CLE031
     C                     Z-ADDWFEE      ZAMTCI                          CLE031
     C                     Z-ADDFEREXR    ZEXCH                           CLE031
     C                     MOVE FEREXI    ZMD                             CLE031
     C                     MOVE FEFCCY    ZCCYI                           CLE031
     C                     MOVE FESCCY    ZCCYO                           CLE031
     C                     Z-ADDWFCDP     ZCDPI                           CLE031
     C                     Z-ADDWRSDP     ZCDPO                           CLE031
     C                     EXSR ZCONV                                     CLE031
     C                     Z-ADDZAMTCO    WCEAMT                          CLE031
      *                                                                   CLE031
     C                     ELSE                                           CLE031
      *                                                                   CLE031
      ** Convert fee event amount to pay settlement ccy                   CLE031
      *                                                                   CLE031
     C**********           CALL 'AOCURRR0'                                             CLE031 CSC042
     C**********           PARM '*BLANKS' WRTCD                                        CLE031 CSC042
     C**********           PARM '*KEY   ' WOPTN                                        CLE031 CSC042
     C**********           PARM FEPSCY    CURKEY  3                                    CLE031 CSC042
     C********** SDCURR    PARM SDCURR    DSSDY                                        CLE031 CSC042
     C********** WRTCD     IFNE *BLANKS                                                CLE031 CSC042
     C                     MOVELFEPSCY    CURKEY                                              CSC042
     C                     MOVELCURKEY    ##KC                                                CSC042
     C                     EXSR ##CHKC                                                        CSC042
     C           ##FIC     IFEQ 'Y'                                                           CSC042
     C                     EXSR ##SETC                                                        CSC042
     C                     ELSE                                                               CSC042
     C           *LOCK     IN   LDA                                       CLE031
     C                     MOVEL'LE0492  'DBPGM                           CLE031
     C**********           MOVE 'SDCURRPD'DBFILE           ************                CLE031 CSC042
     C                     MOVE 'CURR,Q  'DBFILE                                              CSC042
     C                     MOVE CURKEY    DBKEY            * DBERR 57 *   CLE031
     C                     Z-ADD57        DBASE            ************   CLE031
     C                     OUT  LDA                                       CLE031
     C                     EXSR *PSSR                                     CLE031
     C                     END                                            CLE031
      *                                                                   CLE031
      ** Set up number of decimal places for pay settlement ccy           CLE031
      *                                                                   CLE031
     C                     MOVE A6NBDP    WPSDP   10                      CLE031
      *                                                                   CLE031
     C                     Z-ADDWFEE      ZAMTCI                          CLE031
     C                     Z-ADDFEPEXR    ZEXCH                           CLE031
     C                     MOVE FEPEXI    ZMD                             CLE031
     C                     MOVE FEFCCY    ZCCYI                           CLE031
     C                     MOVE FEPSCY    ZCCYO                           CLE031
     C                     Z-ADDWFCDP     ZCDPI                           CLE031
     C                     Z-ADDWPSDP     ZCDPO                           CLE031
     C                     EXSR ZCONV                                     CLE031
     C                     Z-ADDZAMTCO    WCEAMT                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
      ** Toggle INOI                                                      CLE031
      *                                                                   CLE031
     C           INOI      IFEQ 'I'                                       CLE031
     C                     MOVEL'O'       INOI                            CLE031
     C                     ELSE                                           CLE031
     C           INOI      IFEQ 'O'                                       CLE031
     C                     MOVEL'I'       INOI                            CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
      ** Write the reversal event for the previous event, with fee        CLE031
      ** Fee payment amount in fee ccy and settlement in another ccy      CLE031
      ** If Main Event Type is '71F1' set event type to '71FX'            CLE031
      ** Otherwise set Event Type to '71FY'                               CLE031
      *                                                                   CLE031
     C           WETYP     IFEQ '71F1'                                    CLE031
     C                     MOVE '71FX'    ETYP                            CLE031
     C                     ELSE                                           CLE031
     C                     MOVE '71FY'    ETYP                            CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     WRITEOLVENTEL                                  CLE031
      *                                                                   CLE031
      ***  Update count and hash totals for number of records output      CLE031
      ***  to events file for first fee event                             CLE031
      *                                                                   CLE031
     C           COUNTL    ADD  1         COUNTL                          CLE031
      *                                                                   CLE031
     C                     Z-ADD1         Z                               CLE031
     C                     Z-ADD2         S                               CLE031
      *                                                                   CLE031
     C           EAMT      DIV  1000      ZZAMT                           CLE031
     C                     Z-ADDTOTI2     ZZTOTI                          CLE031
     C                     Z-ADDTOTD2     ZZTOTD                          CLE031
      *                                                                   CLE031
     C                     EXSR ZHASH                                     CLE031
      *                                                                   CLE031
     C                     Z-ADDZZTOTI    TOTI2  150                      CLE031
     C                     Z-ADDZZTOTD    TOTD2   30                      CLE031
      *                                                                   CLE031
      ** Set settlement in another ccy to blanks and set up               CLE031
      ** fields to contain converted event amount and ccy                 CLE031
      ** and write the event                                              CLE031
      *                                                                   CLE031
     C                     MOVE *BLANKS   SIAC                            CLE031
      *                                                                   CLE031
     C           PTFI      IFEQ *BLANKS                                   CLE031
     C                     MOVE FESCCY    ECCY                            CLE031
     C                     ELSE                                           CLE031
     C                     MOVE FEPSCY    ECCY                            CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     Z-ADDWCEAMT    EAMT                            CLE031
      *                                                                   CLE031
      ** Toggle INOI so that it is same as the main event                 CLE031
      *                                                                   CLE031
     C           INOI      IFEQ 'I'                                       CLE031
     C                     MOVEL'O'       INOI                            CLE031
     C                     ELSE                                           CLE031
     C           INOI      IFEQ 'O'                                       CLE031
     C                     MOVEL'I'       INOI                            CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     WRITEOLVENTEL                                  CLE031
      *                                                                   CLE031
     C                     MOVE *BLANKS   IFXC                            CLE031
      *                                                                   CLE031
      ***  Update count and hash totals for number of records output      CLE031
      ***  to events file for first fee event                             CLE031
      *                                                                   CLE031
     C           COUNTL    ADD  1         COUNTL                          CLE031
      *                                                                   CLE031
     C                     Z-ADD1         Z                               CLE031
     C                     Z-ADD2         S                               CLE031
      *                                                                   CLE031
     C           EAMT      DIV  1000      ZZAMT                           CLE031
     C                     Z-ADDTOTI2     ZZTOTI                          CLE031
     C                     Z-ADDTOTD2     ZZTOTD                          CLE031
      *                                                                   CLE031
     C                     EXSR ZHASH                                     CLE031
      *                                                                   CLE031
     C                     Z-ADDZZTOTI    TOTI2  150                      CLE031
     C                     Z-ADDZZTOTD    TOTD2   30                      CLE031
      *                                                                   CLE031
     C                     MOVE WETYP     ETYP                                                218992
     C                     ENDIF                                          CLE031
     C**************       ENDIF                                                        218782218992
      *
      *****************************************
      ***  PRODUCTION OF INTERBRANCH EVENTS ***
      *****************************************
      *
      ***  If the fee settlement branch is not blank and
      ***  is not the same as the facility branch code then output
      ***  inter-branch events.
      *
     C***********CFBR      IFNE *BLANKS                    ***B001        045634
     C***********CFBR      ANDNEFCBRCA                                    045634
     C           FEOSBR    IFNE *BLANKS                                   045634
     C           FEOSBR    ANDNEFEBRCA                                    045634
     C           FESTTL    ANDNE09                                                            218992
      *
      ***  FIRST INTERBRANCH EVENT where the fee settlement branch
      ***  is the event branch.
      *
     C***********          MOVE CFBR      EBRC                            045634
     C           CLE033    IFEQ 'Y'                                       217289
     C           SETP      ANDEQ09                                        217289
     C                     MOVE FEBRCA    EBRC                            217289
     C                     ELSE                                           217289
     C                     MOVE FEOSBR    EBRC                            045634
     C                     ENDIF                                          217289
     C                     MOVE BRCA      ORBR                            045634
     C                     MOVE FEOSBR    BRCA                            045634
      *
      *****Company*of*event*branch*should*be*the*compay*code*of*the****   045634
      *****event*branch*as*found*on*branch*codes*file.*****************   045634
      *****************************************************************   045634
     C***********          CALL 'AOBRCHR0'                                045634
     C***********          PARM '*MSG   ' @RTCD   7                       045634
     C***********          PARM '*KEY   ' @OPTN   7                       045634
     C***********          PARM CFBR      @DSNB   3                       045634
     C***********SDBRCH    PARM SDBRCH    DSFDY                           045634
     C***********@RTCD     IFNE *BLANKS                    ***B002        045634
     C************LOCK     IN   LDA                                       045634
     C***********          MOVEL'LE0492  'DBPGM                           045634
     C***********          MOVELCFBR      DBKEY                           045634
     C***********          MOVEL'SDBRCHPD'DBFILE           ************   045634
     C***********          Z-ADD18        DBASE            * DBERR 18 *   045634
     C***********          OUT  LDA                        ************   045634
     C***********          EXSR *PSSR                                     045634
     C***********          END                             ***E002        045634
      *
     C** Permute the company information from the Main event              045634
     C***********          MOVE CMPYM     ECPY                            045634
     C                     MOVE COBB      ECPY                            045634
     C                     MOVE COOB      COBB                            045634
     C                     MOVE ECPY      COOB                            045634
      *
      ***  Multibranching event flag
      *
     C                     MOVE 'Y'       IBRE
      *
      ***  The inter-company event flag should be 'Y' unless the
      ***  company code just retrieved is the same as the company
      ***  code for the facility branch (then it should be 'N')
      *
      ****Obtain*branch*information*for*the*facility*branch************   045634
      *****************************************************************   045634
     C***********          CALL 'AOBRCHR0'                                045634
     C***********          PARM '*MSG   ' @RTCD   7                       045634
     C***********          PARM '*KEY   ' @OPTN   7                       045634
     C***********          PARM FCBRCA    @DSNB   3                       045634
     C***********SDBRCH    PARM SDBRCH    DSFDY                           045634
     C***********@RTCD     IFNE *BLANKS                    ***B002        045634
     C************LOCK     IN   LDA                                       045634
     C***********          MOVEL'LE0492  'DBPGM                           045634
     C***********          MOVELFCBRCA    DBKEY                           045634
     C***********          MOVEL'SDBRCHPD'DBFILE           ************   045634
     C***********          Z-ADD19        DBASE            * DBERR 19 *   045634
     C***********          OUT  LDA                        ************   045634
     C***********          EXSR *PSSR                                  ***045634
     C***********          END                             ***E002        045634
      ***********                                                         045634
     C***********          MOVE CMPYM     FCMPY   3                       045634
     C***********          MOVE A8BICN    FBICN   6                       045634
      *
     C***********FCMPY     IFEQ ECPY                       ***B002        045634
     C           COBB      IFEQ ECPY                                      045634
     C                     MOVE 'N'       ICYE
     C                     ELSE                            ***X002
     C                     MOVE 'Y'       ICYE
     C                     END                             ***E002
      *
     C                     MOVE 'I'       INOI
      *                                                                   CLE004
      ** If SAR CLE004 is Present                                         CLE004
      ** and Internal Customer                                            CLE004
      ** and Shared Fee                                                   CLE004
      ** and Generated by Fund Participant                                CLE004
      *                                                                   CLE004
     C           CLE004    IFEQ *ON                                       CLE004
     C           PTFI      ANDEQ'I'                                       CLE004
     C           SHFI      ANDEQ'Y'                                       CLE004
     C           GFPT      ANDEQ'Y'                                       CLE004
      *                                                                   CLE004
     C           INOI      IFEQ 'I'                                       CLE004
     C                     MOVEL'O'       INOI                            CLE004
     C                     ELSE                                           CLE004
     C                     MOVEL'I'       INOI                            CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
     C                     ENDIF                                          CLE004
      *
     C***********          WRITELVENTELF                                  045634
     C/COPY WNCPYSRC,LE0492C010
     C                     WRITEOLVENTEL                                  045634
      *
      ***  Update count and hash totals for number of records output
      ***  to events file for this first inter-branch event.
      *
     C********** COUNT2    ADD  1         COUNT2                            0031
     C           COUNTL    ADD  1         COUNTL                            0031
      *
     C                     Z-ADD1         Z
     C                     Z-ADD2         S
      *
     C           EAMT      DIV  1000      ZZAMT
     C                     Z-ADDTOTI2     ZZTOTI
     C                     Z-ADDTOTD2     ZZTOTD
      *
     C                     EXSR ZHASH
      *
     C                     Z-ADDZZTOTI    TOTI2
     C                     Z-ADDZZTOTD    TOTD2
      *
      ***  Output a second inter-branch event, identical to the first
      ***  inter-branch event except that the event customer number
      ***  should be the branch internal customer number of the
      ***  facility branch and the incoming/outgoing indicator
      ***  should be zero.
      *
      *
     C***********          MOVE FBICN     CUNR                            045634
     C                     MOVE A8BICN    CUNR                            045634
     C                     MOVE 'O'       INOI
      *                                                                   CLE004
      ** If SAR CLE004 is Present                                         CLE004
      ** and Internal Customer                                            CLE004
      ** and Shared Fee                                                   CLE004
      ** and Generated by Fund Participant                                CLE004
      *                                                                   CLE004
     C           CLE004    IFEQ *ON                                       CLE004
     C           PTFI      ANDEQ'I'                                       CLE004
     C           SHFI      ANDEQ'Y'                                       CLE004
     C           GFPT      ANDEQ'Y'                                       CLE004
      *                                                                   CLE004
     C           INOI      IFEQ 'I'                                       CLE004
     C                     MOVEL'O'       INOI                            CLE004
     C                     ELSE                                           CLE004
     C                     MOVEL'I'       INOI                            CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
     C                     ENDIF                                          CLE004
      *
     C***********          WRITELVENTELF                                  045634
     C/COPY WNCPYSRC,LE0492C011
     C                     WRITEOLVENTEL                                  045634
      *
      ***  Update count and hash totals for number of records output
      ***  to events file for third fee event when this is an inter-
      ***  branch event.
      *
     C********** COUNT2    ADD  1         COUNT2                            0031
     C           COUNTL    ADD  1         COUNTL                            0031
      *
     C                     Z-ADD1         Z
     C                     Z-ADD2         S
      *
     C           EAMT      DIV  1000      ZZAMT
     C                     Z-ADDTOTI2     ZZTOTI
     C                     Z-ADDTOTD2     ZZTOTD
      *
     C                     EXSR ZHASH
      *
     C                     Z-ADDZZTOTI    TOTI2
     C                     Z-ADDZZTOTD    TOTD2
      *
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SETLOC
      *****************************************************************
      *                                                               *
      *  SETLOC - SUBROUTINE TO ACCESS NOSTRO FILE                    *
      *                                                               *
      *  Called By: PROCES, FEES                                      *
      *                                                               *
      *  Calls:     AONOSTR0                                          *
      *                                                               *
      *****************************************************************
      *
     C           SETLOC    BEGSR
      *
      *** Initialise settlement branch location variable
      *
     C           *LIKE     DEFN NRLC      WKSTBL
     C                     MOVE *BLANKS   WKSTBL
      *                                                                   CLE031
      ** Initialise ccy to check nostro table with                        CLE031
      *                                                                   CLE031
     C                     MOVE FEFCCY    WCCYNS  3                       CLE031
      *                                                                   CLE031
      ** If CEU004 is on AND receipt settlement ccy is present            CLE031
      ** Or                                                               CLE031
      ** CLE031 is on AND fee is not a participant fee AND receipt        CLE031
      ** settlement ccy is present then use receipt settlement ccy        CLE031
      ** to access nostro details                                         CLE031
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, do not set up WCCYNS                                                       218782
      *                                                                                       218782
     C           CLE033    IFEQ 'Y'                                                           218782
     C***********SETP      ANDEQ09                                                      218782218992
     C           FESTTL    ANDEQ09                                                            218992
     C           SET09     ANDEQ'T'                                                           218782
     C                     ELSE                                                               218782
      *                                                                   CLE031
     C           CEU004    IFEQ 'Y'                                       CLE031
     C           FESCCY    ANDNE*BLANKS                                   CLE031
      *                                                                   CLE031
     C           CLE031    OREQ 'Y'                                       CLE031
     C           PTFI      ANDEQ*BLANKS                                   CLE031
     C           FESCCY    ANDNE*BLANKS                                   CLE031
      *                                                                   CLE031
     C                     MOVE FESCCY    WCCYNS                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
      ** If CLE031 is on AND fee is a participant fee AND settlement      CLE031
      ** ccy is present, use pay settlement ccy to access nostro details  CLE031
      *                                                                   CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
     C           PTFI      ANDNE*BLANKS                                   CLE031
     C           FEPSCY    ANDNE*BLANKS                                   CLE031
      *                                                                   CLE031
     C                     MOVE FEPSCY    WCCYNS                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                                              218782
      *
      *** For types 01, 02, 07, 08 OR 12 the settlement location is
      *** determined by the nostro branch.
      *
     C           WKSTLL    IFEQ 01                         ***B001
     C           WKSTLL    OREQ 02
     C           WKSTLL    OREQ 07
     C           WKSTLL    OREQ 08
     C           WKSTLL    OREQ 12
      *
     C                     MOVELWCCYNS    KEYNOS                                            CLE075AP
     C                     MOVE WKOUR     KEYNOS                                            CLE075AP
     C                     ADD  1         NOSSEQ                                            CLE075AP
     C                     EXSR CHKNOS                                                      CLE075AP
      *                                                                                     CLE075AP
      ** Use details from array if KEYNOS is found, otherwise,                              CLE075AP
      ** retrieve details from program call                                                 CLE075AP
      *                                                                                     CLE075AP
     C           NOSIC     IFEQ 'Y'                                                         CLE075AP
      *                                                                                     CLE075AP
      ** Set occurence to index found from #NSK array                                       CLE075AP
      *                                                                                     CLE075AP
     C           F         OCUR SDNOST                                                      CLE075AP
      *                                                                                     CLE075AP
     C                     ELSE                                                             CLE075AP
      *                                                                                     CLE075AP
     C           NOSIDX    IFNE 0                                                           CLE075AP
     C                     Z-ADDNOSIDX    F                                                 CLE075AP
     C                     ELSE                                                             CLE075AP
     C                     Z-ADD1         F                                                 CLE075AP
     C                     MOVEA#NOS      #NSS                                              CLE075AP
     C                     SORTA#NSS                                                        CLE075AP
     C                     Z-ADD#NSS,1    NOSKEY                                            CLE075AP
     C           NOSKEY    LOKUP#NOS,F                   44                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C           F         OCUR SDNOST                                                      CLE075AP
      *                                                                                     CLE075AP
     C                     CALL 'AONOSTR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM *BLANKS   WKEYA   6
     C**********           PARM FEFCCY    WKEYB   3                       CLE031
     C                     PARM WCCYNS    WKEYB   3                       CLE031
     C*********            PARM *BLANKS   WKEYC   4                                           CGL029
     C                     PARM *BLANKS   WKEYC  10                                           CGL029
     C                     PARM *BLANKS   WKEYD   2
     C                     PARM WKOUR     WKEYE   2
     C                     PARM *BLANKS   WBRCD   3
     C                     PARM *BLANKS   CSSN   10
     C                     PARM *BLANKS   PNOI    1
     C           SDNOST    PARM SDNOST    DSFDY
      *
     C           WRTCD     IFEQ *BLANKS                    ***B002
      *
      ***  Move the last 3 characters of customer short code (which
      ***  is the location code) to start location code field
      *
     C                     MOVE CSNM      DSCSNM
     C                     MOVE NRLC      WKSTBL
     C                     EXSR ADDNOS                                                      CLE075AP
     C                     ENDIF                                                            CLE075AP
      *
     C                     END                             ***E002
      *
     C                     END                             ***E001
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/CONV
      *****************************************************************
      *                                                               *
      *  CONV   - SUBROUTINE TO CONVERT EVENT AMOUNTS INTO            *
      *           FACILITY CURRENCY                                   *
      *                                                               *
      *  Called By: EVENT, ACCRUE                                     *
      *                                                               *
      *  Calls:     ZXRATE, ZCONV                                     *
      *                                                               *
      *****************************************************************
      *
     C           CONV      BEGSR
      *
      ***  If currencies are the same retrieve relevant currency
      ***  details, but if currencies are different it is necessary
      ***  to first obtain the cross exchange rate between the two
      ***  currencies and use this to convert to appropriate
      ***  currency.
      *
     C           INCCY     IFEQ OUTCCY                     ***B001
     C                     Z-ADD1         X
     C           INCCY     LOKUPCURR,X                   14
     C           *IN14     IFEQ '1'                        ***B002
     C                     MOVE MTDV,X    ZMDI1   1
     C                     Z-ADDCSPT,X    ZRATE1 138
     C                     Z-ADDCCDP,X    ZNBDP1  10
     C                     ELSE                            ***X002
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVE 'SDCURRPD'DBFILE           ************
     C                     Z-ADD20        DBASE            * DBERR 20 *
     C                     MOVE INCCY     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             ***E002
     C                     END                             ***E001
      *
     C           INCCY     IFNE OUTCCY                     ***B001
     C                     Z-ADD1         X
     C           INCCY     LOKUPCURR,X                   13
     C           *IN13     IFEQ '1'                        ***B002
     C                     MOVE MTDV,X    ZMDI1   1
     C                     Z-ADDCSPT,X    ZRATE1 138
     C                     Z-ADDCCDP,X    ZNBDP1  10
     C                     ELSE                            ***X002
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVE 'SDCURRPD'DBFILE           ************
     C                     Z-ADD21        DBASE            * DBERR 21 *
     C                     MOVE INCCY     DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             ***E002
      *
     C                     Z-ADD1         X
     C           OUTCCY    LOKUPCURR,X                   14
     C           *IN14     IFEQ '1'                        ***B002
     C                     MOVE MTDV,X    ZMDI2   1
     C                     Z-ADDCSPT,X    ZRATE2 138
     C                     Z-ADDCCDP,X    ZNBDP2  10
     C                     ELSE                            ***X002
     C           *LOCK     IN   LDA
     C                     MOVEL'LE0492  'DBPGM
     C                     MOVE 'SDCURRPD'DBFILE           ************
     C                     Z-ADD22        DBASE            * DBERR 22 *
     C                     MOVE OUTCCY    DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             ***E002
      *
      ***  Obtain cross exchange rate & cross multiply/divide indicator
      *
     C                     EXSR ZXRATE
      *
      ***  Set up input fields for conversion SR
      *
     C                     Z-ADDZRATEX    ZEXCH  138
     C                     MOVE ZMDIX     ZMD     1
     C**********                                                   101857 162343
     C/COPY WNCPYSRC,LE0492C007
     C***When*converting*the*amount*from*loan*events,*use*the******101857 162343
     C***facility*currency*exchange*rate*from*loan*details.********101857 162343
     C**********                                                   101857 162343
     C***********@LFXRT    IFEQ 'Y'                                101857 162343
     C***********LNRF      CHAINCLOANL3              23            101857 162343
     C************IN23     IFEQ '0'                                101857 162343
     C***********          Z-ADDFCXRL3    ZEXCH                    101857 162343
     C***********          MOVELFMDIL3    ZMD                      101857 162343
     C***********          END                                     101857 162343
     C***********          END                                     101857 162343
      *                                                                                       199588
      ** When converting the amount from loan events, use the                                 199588
      ** facility currency exchange rate from loan details.                                   199588
      *                                                                                       199588
     C           @LFXRT    IFEQ 'Y'                                                           199588
     C           LNRF      CHAINCLOANL3              23                                       199588
     C           *IN23     IFEQ '0'                                                           199588
     C                     Z-ADDFCXRL3    ZEXCH                                               199588
     C                     MOVELFMDIL3    ZMD                                                 199588
     C                     ENDIF                                                              199588
     C                     ENDIF                                                              199588
      *                                                                                       199588
     C/COPY WNCPYSRC,LE0492C008
     C**********                                                   101857 162343
     C                     Z-ADDWEAMT     ZAMTCI 150
     C                     MOVE INCCY     ZCCYI   3
     C                     MOVE OUTCCY    ZCCYO   3
     C                     Z-ADDZNBDP1    ZCDPI   10
     C                     Z-ADDZNBDP2    ZCDPO   10
      *
     C                     EXSR ZCONV
      *
     C                     Z-ADDZAMTCO    WEAMT
      *
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/UFAMT
      *****************************************************************
      *                                                               *
      *  UFAMT  - SUBROUTINE TO SET UP ARRAYS HOLDING FUTURE          *
      *           DATA, i.e., DATES, FACILITY AMOUNTS & TOTAL         *
      *           DRAWN.                                              *
      *                                                               *
      *  Called By: EVENT                                             *
      *                                                               *
      *  Calls:     ZFWDT                                             *
      *                                                               *
      *****************************************************************
      *
     C           UFAMT     BEGSR
      *
      ***  For the first repayment event record processed set up an
      ***  array to hold dates, facility & total drawn amounts for
      ***  15 working days in the future.
      *
     C           *IN19     IFEQ '0'                        ***B001
      *
      ***  Date Array
     C                     Z-ADD1         X
     C           X         DOWLE15                         ***B002
     C                     Z-ADDWCODT     ZDAYNO  50
     C                     MOVE FCCY      ZCCY    3
     C                     MOVE *BLANKS   ZLOC    3
     C                     Z-ADDX         ZNRDYS  20
     C                     EXSR ZFWDT
     C                     Z-ADDZDYNBR    CDAT,X
     C                     ADD  1         X
     C                     END                             ***E002
     C           CDAT,15   SUB  RUND      MM      20                      100517
     C           MM        IFGT 99                                        100517
     C                     Z-ADD99        MM                              100517
     C                     END                                            100517
     C                     Z-ADD1         M                               100517
     C           M         DOWLEMM                                        100517
     C           M         ANDNE0                                         157096
     C           RUND      ADD  M         TDAT,M                          100517
     C                     ADD  1         M                               100517
     C                     END                                            100517
      *
     C                     MOVE '1'       *IN19
      *
      ****Facility*Amount*(initialised*to*value*from*FCUPD*file)*******     0025
      *** Facility Amount (initialised to value from FCLTY file)            0025
      *
     C                     Z-ADDFAMT      FFAM
     C                     Z-ADDFAMT      TFAM                            100517
      *
      *** Total Drawn Amount (work field)
      *
     C                     Z-ADD0         FTOD
     C                     Z-ADD0         TTOD                            100517
      *
     C                     END                             ***E001
      *
      ***  Update of future total amount drawn array
      *
     C           ETP       IFEQ 'A1'                       ***B001
      *                                                                                     MD048400
      ** Call subroutine to check if amounts should update                                  MD048400
      ** facility exposure                                                                  MD048400
      *                                                                                     MD048400
     C                     MOVEL'Y'       PROCFL  1                                         MD048400
     C           CLE134    IFEQ 'Y'                                                         MD048400
     C                     EXSR SRFAMU                                                      MD048400
     C                     ENDIF                                                            MD048400
     C           PROCFL    IFEQ 'Y'                                                         MD048400
     C                     Z-ADDWEAMT     WRK13
     C                     ELSE                                                             MD048400
     C                     Z-ADD0         WRK13                                             MD048400
     C                     ENDIF                                                            MD048400
      *
     C***********PTP       IFNE '66'                       ***B002        CLE005
     C***********PTP       ORNE '67'                                      CLE005
     C           PTP       IFEQ '66'                       ***B002        CLE005
     C           PTP       OREQ '67'                                      CLE005
      *                                                                   CLE005
      ** The above coding was fixed by SAR CLE005 for the inclusion of    CLE005
      ** PTP 69 and 72                                                    CLE005
      *                                                                   CLE005
     C           PTP       OREQ '69'                                      CLE005
     C           CLE005    ANDEQ*ON                                       CLE005
     C           PTP       OREQ '72'                                      CLE005
     C           CLE005    ANDEQ*ON                                       CLE005
     C                     ELSE                                           CLE005
      *
     C                     Z-ADD1         Y
     C           Y         DOWLT16                         ***B003
     C           FTOD,Y    ADD  WRK13     FTOD,Y
     C                     ADD  1         Y
     C                     END                             ***E003
     C                     Z-ADD1         M                               100517
     C           M         DOWLEMM                                        100517
     C           M         ANDNE0                                         157096
     C           TTOD,M    ADD  WRK13     TTOD,M                          100517
     C                     ADD  1         M                               100517
     C                     END                                            100517
      *
     C                     END                             ***E002
      *
      ***  Participations sold without recourse should only be
      ***  processed if facility is revolving.
      *
     C           PTP       IFEQ '66'                       ***B002
     C           RCSI      ANDNE'Y'
     C           FCTI      ANDNE'C'
     C           RVCR      ANDEQ'Y'
     C           PTP       OREQ '67'
     C           RCSI      ANDNE'Y'
     C           FCTI      ANDNE'C'
     C           RVCR      ANDEQ'Y'
      *                                                                   CLE005
      ** If SAR CLE005 is installed, include PTP 69 and 72                CLE005
      *                                                                   CLE005
     C           PTP       OREQ '69'                                      CLE005
     C           CLE005    ANDEQ*ON                                       CLE005
     C           RCSI      ANDNE'Y'                                       CLE005
     C           FCTI      ANDNE'C'                                       CLE005
     C           RVCR      ANDEQ'Y'                                       CLE005
     C           PTP       OREQ '72'                                      CLE005
     C           CLE005    ANDEQ*ON                                       CLE005
     C           RCSI      ANDNE'Y'                                       CLE005
     C           FCTI      ANDNE'C'                                       CLE005
     C           RVCR      ANDEQ'Y'                                       CLE005
      *
     C                     Z-ADD1         Y
     C           Y         DOWLT16                         ***B003
     C           FTOD,Y    SUB  WRK13     FTOD,Y
     C                     ADD  1         Y
     C                     END                             ***E003
     C                     Z-ADD1         M                               100517
     C           M         DOWLEMM                                        100517
     C           M         ANDNE0                                         157096
     C           TTOD,Y    SUB  WRK13     TTOD,M                          100517
     C                     ADD  1         M                               100517
     C                     END                                            100517
      *
     C                     END                             ***E002
      *
      ***  If ETP eq A1 event
      *
     C                     END                             ***E001
      *
      ***  If not dummy event check if event date is within
      ***  facility availability dates; if so update
      ***  availability array using event amount.
      *
     C                     MOVE '0'       *IN09
     C           ETP       IFNE 'A1'                       ***B001
     C                     Z-ADD1         X
     C                     Z-ADD1         M       20                      100517
     C***********EDAT      LOKUPCDAT,X                   09               045634
     C           EDAT      LOKUPTDAT,M               09  09               100517
     C           EDAT      LOKUPCDAT,X               09  09               045634
     C                     END                             ***E001
      *
     C           *IN09     IFEQ '1'                        ***B001
      *
     C                     Z-ADDWEAMT     WRK13  130
      *
     C           PTP       IFEQ '61'                       ***B002
     C           PTP       OREQ '62'
     C           PTP       OREQ '63'
     C           PTP       OREQ '64'
     C           PTP       OREQ '65'
     C           PTP       OREQ '70'
      *                                                                   CLE005
      ** If SAR CLE005 is installed, include PTP 68 and 71                CLE005
      *                                                                   CLE005
     C           PTP       OREQ '68'                                      CLE005
     C           CLE005    ANDEQ*ON                                       CLE005
     C           PTP       OREQ '71'                                      CLE005
     C           CLE005    ANDEQ*ON                                       CLE005
      *
      ***  Availability reduced for the following events
      *
     C           ETP       IFEQ 'V1'                       ***B003
     C           ETP       OREQ 'V3'
     C************IN05     OREQ '1'                                       0080
     C           *IN06     OREQ '1'                                       0080
      *
     C           X         DOWLT16                         ***B004
     C                     ADD  WEAMT     FTOD,X
     C                     ADD  1         X
     C                     END                             ***E004
     C           M         DOWLEMM                                        100517
     C           M         ANDNE0                                         157096
     C                     ADD  WEAMT     TTOD,M                          100517
     C                     ADD  1         M                               100517
     C                     END                                            100517
      *
     C                     END                             ***E003
      *
      ***  Availability increased for the following events
      *
     C           ETP       IFEQ 'R1'                       ***B003
     C           ETP       OREQ 'M1'
      *
     C           X         DOWLT16                         ***B004
     C           RVCR      IFNE 'Y'                        ***B005
     C                     SUB  WEAMT     FFAM,X
     C                     END                             ***E005
     C                     SUB  WEAMT     FTOD,X
     C                     ADD  1         X
     C                     END                             ***E004
     C           M         DOWLEMM                                        100517
     C           M         ANDNE0                                         157096
     C           RVCR      IFNE 'Y'                                       100517
     C                     SUB  WEAMT     TFAM,M                          100517
     C                     END                                            100517
     C                     SUB  WEAMT     TTOD,M                          100517
     C                     ADD  1         M                               100517
     C                     END                                            100517
      *
     C                     END                             ***E003
      *
     C                     END                             ***E002
      *
      ***  Participations sold without recourse should only be
      ***  processed if facility is revolving.
      *
     C           PTP       IFEQ '66'                       ***B002
     C           RCSI      ANDNE'Y'
     C           FCTI      ANDNE'C'
     C           RVCR      ANDEQ'Y'
     C           PTP       OREQ '67'
     C           RCSI      ANDNE'Y'
     C           FCTI      ANDNE'C'
     C           RVCR      ANDEQ'Y'
      *                                                                   CLE005
      ** If SAR CLE005 is installed, include PTP 69 and 72                CLE005
      *                                                                   CLE005
     C           PTP       OREQ '69'                                      CLE005
     C           CLE005    ANDEQ*ON                                       CLE005
     C           RCSI      ANDNE'Y'                                       CLE005
     C           FCTI      ANDNE'C'                                       CLE005
     C           RVCR      ANDEQ'Y'                                       CLE005
     C           PTP       OREQ '72'                                      CLE005
     C           CLE005    ANDEQ*ON                                       CLE005
     C           RCSI      ANDNE'Y'                                       CLE005
     C           FCTI      ANDNE'C'                                       CLE005
     C           RVCR      ANDEQ'Y'                                       CLE005
      *
     C           ETP       IFEQ 'V1'                       ***B003
     C           ETP       OREQ 'V3'
     C************IN05     OREQ '1'                                       0080
     C           *IN06     OREQ '1'                                       0080
      *
     C           X         DOWLT16                         ***B004
     C                     SUB  WEAMT     FTOD,X
     C                     ADD  1         X
     C                     END                             ***E004
     C           M         DOWLEMM                                        100517
     C           M         ANDNE0                                         157096
     C                     SUB  WEAMT     TTOD,M                          100517
     C                     ADD  1         M                               100517
     C                     END                                            100517
      *
     C                     END                             ***E003
      *
     C           ETP       IFEQ 'R1'                       ***B003
     C           ETP       OREQ 'M1'
      *
     C           X         DOWLT16                         ***B004
     C                     ADD  WEAMT     FTOD,X
     C                     ADD  1         X
     C                     END                             ***E004
     C           M         DOWLEMM                                        100517
     C           M         ANDNE0                                         157096
     C                     ADD  WEAMT     TTOD,M                          100517
     C                     ADD  1         M                               100517
     C                     END                                            100517
      *
     C                     END                             ***E003
      *
     C                     END                             ***E002
      *
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/RTLX
      *****************************************************************
      *                                                               *
      *  RTLX   - SUBROUTINE TO OUTPUT DETAILS TO PAY/RECEIVE         *
      *           TELEX FILES                                         *
      *                                                               *
      *  Called By: NONCAL, CALFEE                                    *
      *                                                               *
      *  Calls:     CFTLFM, LETLFM                                    *
      *                                                               *
      *****************************************************************
      *
     C           RTLX      BEGSR
      *
     C           PAYDAT    IFLE WTXDT                      ***B001
      *
     C                     MOVE FEAUTO    WFEAUT  1                                           CLE134
     C           WFEAUT    IFEQ 'C'                                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           CLE009    IFEQ 'Y'                        ***B001a       CLE009
     C********** FEAUTO    ANDEQ'Y'                                                    CLE009 CLE134
     C           WFEAUT    ANDEQ'Y'                                                           CLE134
     C           CLE009    OREQ 'N'                                       CLE009
      *                                                                   CLE009
      **************************************
      ***  NON-CALCULATED FACILITY FEES  ***
      **************************************
      *
     C********** FELOAN    IFEQ *ZEROS                     ***B002                            CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C           FECALT    ANDEQ*BLANKS
      *
      ***  If pay date is equal to fee period start date and the start
      ***  pay/receive telex indicator is blank a start date fee telex
      ***  should be sent.
      *
     C           PAYDAT    IFEQ FEPSTD                     ***B003
     C           FESPTI    ANDEQ*BLANKS
      *
      ***  Set up facility number
      *
     C********             MOVEL'F'       WFCLN   6                                           CLE148
     C                     MOVEL' '       WFCLN   6                                           CLE148
     C                     MOVE FEFACL    WFCLN
      *
     C           CLE007    IFEQ 'Y'                                       CLE007
     C                     MOVE *BLANKS   FESPTI                          CLE007
     C                     ELSE                                           CLE007
     C                     MOVE 'Y'       FESPTI
     C                     ENDIF                                          CLE007
      *
      ***  Output a record to detail format of the facility based
      ***  pay/receive file.
      *
     C                     EXSR CFTLFM
      *
     C                     END                             ***E003
      *
      ***  If pay date is equal to fee period end date and the end
      ***  pay/receive telex indicator is blank, an end date fee telex
      ***  should be sent.
      *
     C           PAYDAT    IFEQ FEPEND                     ***B003
     C           FEEPTI    ANDEQ*BLANKS
      *
      ***  Set up facility number
      *
     C********             MOVEL'F'       WFCLN   6                                           CLE148
     C                     MOVEL' '       WFCLN   6                                           CLE148
     C                     MOVE FEFACL    WFCLN
      *
     C           CLE007    IFEQ 'Y'                                       CLE007
     C                     MOVE *BLANKS   FEEPTI                          CLE007
     C                     ELSE                                           CLE007
     C                     MOVE 'Y'       FEEPTI
     C                     ENDIF                                          CLE007
      *
      ***  Output a record to detail format of the facility based
      ***  pay/receive file.
      *
     C                     EXSR CFTLFM
      *
     C                     END                             ***E003
      *
     C                     END                             ***E002
      *
      ********************************************
      ***  CALCULATED FACILITY FEES PROCESSING ***
      ********************************************
      *
     C********** FELOAN    IFEQ *ZEROS                     ***B002                            CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C           FECALT    ANDNE*BLANKS
      *
      ***  If PAYDAT equals fee next pay date and payment pay/
      ***  receive telex indicator is blank a next payment date fee
      ***  telex should be sent.
      *
     C           PAYDAT    IFEQ WENPYD                     ***B003
     C           WENPYD    ANDNEFEPEND                                    E45727
     C           FEPPTI    ANDEQ*BLANKS
      *
     C********             MOVEL'F'       WFCLN   6                                           CLE148
     C                     MOVEL' '       WFCLN   6                                           CLE148
     C                     MOVE FEFACL    WFCLN
      *
     C           CLE007    IFEQ 'Y'                                       CLE007
     C                     MOVE *BLANKS   FEPPTI                          CLE007
     C                     ELSE                                           CLE007
     C                     MOVE 'Y'       FEPPTI
     C                     ENDIF                                          CLE007
      *
      ***  Output a record to detail format of the facility based
      ***  pay/receive file.
      *
     C                     EXSR CFTLFM
      *
     C                     END                             ***E003
      *
      ***  If PAYDAT equals fee period end date and the end
      ***  pay/receive telex indicator is blank, an end date fee telex
      ***  should be sent.
      *
     C           PAYDAT    IFEQ FEPEND                     ***B003
     C           FEEPTI    ANDEQ*BLANKS
      *
      ***  Set up facility number
      *
     C********             MOVEL'F'       WFCLN   6                                           CLE148
     C                     MOVEL' '       WFCLN   6                                           CLE148
     C                     MOVE FEFACL    WFCLN
      *
     C           CLE007    IFEQ 'Y'                                       CLE007
     C                     MOVE *BLANKS   FEEPTI                          CLE007
     C                     ELSE                                           CLE007
     C                     MOVE 'Y'       FEEPTI
     C                     ENDIF                                          CLE007
      *
      ***  Output a record to detail format of the facility based
      ***  pay/receive file.
      *
     C                     EXSR CFTLFM
      *
     C                     END                             ***E003
      *                                                                                     MD030700
      ** WBDPAY = 'Y' covers Fees whose next Payment Date are changed                       MD030700
      ** to current run day or less.                                                        MD030700
      *                                                                                     MD030700
     C           WBDPAY    IFEQ 'Y'                                                         MD030700
     C           PAYDAT    ANDNEFEPEND                                                      MD030700
     C           PAYDAT    ANDNEWENPYD                                                      MD030700
      *                                                                                     MD030700
     C                     MOVEL' '       WFCLN                                             MD030700
     C                     MOVE FEFACL    WFCLN                                             MD030700
     C                     EXSR CFTLFM                                                      MD030700
      *                                                                                     MD030700
     C                     ENDIF                                                            MD030700
      *
     C                     END                             ***E002
      *
      ******************************
      ***  LOAN FEES PROCESSING  ***
      ******************************
      *
     C           FEFACL    IFEQ *ZEROS                     ***B002
      *
      ***  If PAYDAT equals fee fee period start date and start
      ***  pay/receive telex indicator is blank, a start date fee
      ***  telex should be sent.
      *
     C           PAYDAT    IFEQ FEPSTD                     ***B003
     C           FESPTI    ANDEQ*BLANKS
      *
     C                     MOVE LNRF      WFCLN
     C                     MOVE 'Y'       FESPTI
      *
      ***  Output a record to detail format of the loan based
      ***  pay/receive file.
      *
     C                     EXSR LETLFM
      *
     C                     END                             ***E003
      *
      ***  If PAYDAT equals fee period end date and the end
      ***  pay/receive telex indicator is blank, an end date fee telex
      ***  should be sent.
      *
     C           PAYDAT    IFEQ FEPEND                     ***B003
     C           FEEPTI    ANDEQ*BLANKS
      *
     C                     MOVE LNRF      WFCLN
     C                     MOVE 'Y'       FEEPTI
      *
      ***  Output a record to detail format of the loan based
      ***  pay/receive file.
      *
     C                     EXSR LETLFM
      *
     C                     END                             ***E003
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           PAYDAT    ANDEQWENPYD                                                        CAS009
     C           PAYDAT    ANDNEFEPEND                                                        CAS009
     C           FEPPTI    ANDEQ*BLANK                                                        CAS009
      *                                                                                       CAS009
     C                     MOVE LNRF      WFCLN                                               CAS009
     C                     MOVE 'Y'       FEPPTI                                              CAS009
      *                                                                                       CAS009
      ** Output a record to detail format of the loan based                                   CAS009
      ** pay/receive file.                                                                    CAS009
      *                                                                                       CAS009
     C                     EXSR LETLFM                                                        CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
     C/COPY WNCPYSRC,LEH00729
      *                                                                                       CLE073
      ** If PAYDAT equals fee next payment date and payment date pay/receive telex            CLE073
      ** indicator is blank, a payment date fee telex should be sent.                         CLE073
      *                                                                                       CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'98'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'99'                                                          CLE073
      *                                                                                       CLE073
      ** Past Due Call Loan                                                                   CLE134
      *                                                                                       CLE134
     C           CLE134    OREQ 'Y'                                                           CLE134
     C           FECALT    ANDEQ'90'                                                          CLE134
     C           WPDCL     ANDEQ'Y'                                                           CLE134
     C           PAYDAT    IFEQ WKNPYD                     ***B003                            CLE073
     C           FEPPTI    ANDEQ*BLANKS                                                       CLE073
      *                                                                                       CLE073
     C                     MOVE LNRF      WFCLN                                               CLE073
     C                     MOVE 'Y'       FEPPTI                                              CLE073
      *                                                                                       CLE073
      ** Output a record to detail format of the loan based                                   CLE073
      ** pay/receive file.                                                                    CLE073
      *                                                                                       CLE073
     C                     EXSR LETLFM                                                        CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *
     C                     END                             ***E002
      *                                                                   CLE009
     C                     END                             ***E001a       CLE009
      *
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/CFTLFM
      *****************************************************************
      *                                                               *
      *  CFTLFM - FORMAT OUTPUT FOR FACILITY PAY/RECEIVE FILE         *
      *                                                               *
      *  Called By: RTLX                                              *
      *                                                               *
      *  Calls:     ZHASH                                             *
      *                                                               *
      *****************************************************************
      *
     C           CFTLFM    BEGSR
      *
     C                     MOVE 'D'       RECI
     C                     MOVE 'R'       PYRC
      *                                                                   CLE007
      ** The pay/receive indicator is condition under                     CLE007
      ** SAR (CLE007), shared fee ind. and participant fee ind.           CLE007
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           SHFI      ANDEQ'Y'                                       CLE007
     C           PTFI      ANDEQ'P'                                       CLE007
     C           CLE106    OREQ 'Y'                                                           CLE106
     C           SHFI      ANDEQ'Y'                                                           CLE106
     C           PRTR      ANDEQ'S'                                                           CLE106
     C           CLE106    OREQ 'Y'                                                           CLE106
     C           SHFI      ANDEQ'Y'                                                           CLE106
     C           PRTR      ANDEQ'R'                                                           CLE106
     C                     MOVE 'P'       PYRC                            CLE007
     C                     ENDIF                                          CLE007
     C                     Z-ADDFESTTL    SETP
     C                     MOVE FEFCCY    CCY
     C                     MOVE FEOURS    OSAC
     C                     Z-ADDPAYDAT    VDAT
     C                     MOVE FETHER    TSEN
     C**********           Z-ADDFECNUM    CNUM                                                CSD027
     C                     MOVE FECNUM    CNUM                                                CSD027
     C                     MOVE WFCLN     FCLN
     C                     Z-ADDWFEE      EAMT
     C                     MOVE 'F'       RCDT
     C                     Z-ADD1         PRI3
     C                     MOVE '4'       TIND
     C                     MOVE FEBRCA    BRCA
     C                     MOVE 'N'       INTC
     C***********          MOVE CFBR      OSBR                            045634
     C                     MOVE FEOSBR    OSBR                            045634
     C                     Z-ADDFEFSEQ    FEESEQ                          E45727
      *                                                                   CEU004
      ** Move Settlement Currency and IN Ccy for Fld 72                   CEU004
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, do not set up SCCY.                                                        218782
      *                                                                   CEU004
     C           CLE033    IFEQ 'Y'                                                           218782
     C           SETP      ANDEQ09                                                            218782
     C           SET09     ANDEQ'T'                                                           218782
     C                     ELSE                                                               218782
      *                                                                                       218782
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE FESCCY    SCCY                            CEU004
     C                     MOVE FEICCY    ICCY                            CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                       CLE031
      *                                                                   CLE031
     C           PTFI      IFEQ *BLANKS                                   CLE031
     C                     MOVE FESCCY    SCCY                            CLE031
     C                     MOVE FEREXR    REXR                            CLE031
     C                     MOVE FEREXI    REXI                            CLE031
     C                     ELSE                                           CLE031
     C                     MOVE FEPSCY    PSCY                            CLE031
     C                     MOVE FEPEXR    PEXR                            CLE031
     C                     MOVE FEPEXI    PEXI                            CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                                              218782
      *
     C/COPY WNCPYSRC,LEH00376
     C                     WRITEOCFTLXPR
      *
      ***  Maintain count & hash total of records output
      *
     C           COUNT3    ADD  1         COUNT3
      *
     C                     Z-ADD1         Z
     C                     Z-ADD3         S
     C           CFAMT     DIV  1000      ZZAMT
     C                     Z-ADDTOTI3     ZZTOTI
     C                     Z-ADDTOTD3     ZZTOTD
      *
     C                     EXSR ZHASH
      *
     C                     Z-ADDZZTOTI    TOTI3  150
     C                     Z-ADDZZTOTD    TOTD3   30
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/LETLFM
      *****************************************************************
      *                                                               *
      *  LETLFM  - FORMAT OUTPUT TO LOANS PAY/RECEIVE TELEX FILE      *
      *                                                               *
      *  Called By: RTLX                                              *
      *                                                               *
      *  Calls:     NOTHING                                           *
      *                                                               *
      *****************************************************************
      *
     C           LETLFM    BEGSR
      *
     C                     MOVE 'D'       RECI
     C**********           Z-ADDFELOAN    LNRF                                                CLE148
     C                     MOVELFELOAN    LNRF                                                CLE148
     C                     Z-ADDPAYDAT    VDAT
     C                     MOVE FELTYP    LTYP
     C                     MOVE FESUTP    SUTP
     C                     MOVE FECLAS    CLAS                                                CLE042
     C                     MOVE FEFCCY    CCY
     C                     Z-ADDWFEE      INTA
     C                     Z-ADDWFEE      TAMT
     C                     MOVE FEBRCA    BRCA
     C**********           Z-ADDFECNUM    CNUM                                                CSD027
     C                     MOVE FECNUM    CNUM                                                CSD027
     C                     MOVE FEAUTO    AUTO
     C                     Z-ADDFESTTL    SETP
     C                     MOVE FEOURS    OSAC
     C                     MOVE FETHER    TSEN
     C                     MOVE FECALC    CALC
     C                     MOVE 'R'       TLXY
     C                     MOVE STMP      TMST                                                237636
      *                                                                   CLE007
      ** The pay/receive telex indicator is condition under               CLE007
      ** SAR (CLE007), shared fee ind. and participant fee ind.           CLE007
      *                                                                   CLE007
     C           CLE007    IFEQ 'Y'                                       CLE007
     C           SHFI      ANDEQ'Y'                                       CLE007
     C           PTFI      ANDEQ'P'                                       CLE007
     C           CLE106    OREQ 'Y'                                                           CLE106
     C           SHFI      ANDEQ'Y'                                                           CLE106
     C           PRTR      ANDEQ'S'                                                           CLE106
     C           CLE106    OREQ 'Y'                                                           CLE106
     C           SHFI      ANDEQ'Y'                                                           CLE106
     C           PRTR      ANDEQ'R'                                                           CLE106
     C                     MOVE 'P'       TLXY                            CLE007
     C                     ENDIF                                          CLE007
      *                                                                   CEU004
      ** Move Settlement Currency and IN Ccy for Fld 72                   CEU004
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, do not set up SCCY                                                         218782
      *                                                                   CEU004
     C           CLE033    IFEQ 'Y'                                                           218782
     C           SETP      ANDEQ09                                                            218782
     C           SET09     ANDEQ'T'                                                           218782
     C                     ELSE                                                               218782
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE FESCCY    SCCY                            CEU004
     C                     MOVE FEICCY    ICCY                            CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                       CLE031
      *                                                                   CLE031
     C           PTFI      IFEQ *BLANKS                                   CLE031
     C                     MOVE FESCCY    SCCY                            CLE031
     C                     MOVE FEREXR    REXR                            CLE031
     C                     MOVE FEREXI    REXI                            CLE031
     C                     ELSE                                           CLE031
     C                     MOVE FEPSCY    PSCY                            CLE031
     C                     MOVE FEPEXR    PEXR                            CLE031
     C                     MOVE FEPEXI    PEXI                            CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                                              218782
     C           CLE033    IFEQ 'Y'                                       CLE033
     C           SETP      ANDEQ09                                        CLE033
     C                     MOVE FEBRCA    OSBR                            CLE033
     C                     ENDIF                                          CLE033
      *                                                                   CLE031
     C                     MOVE 'N'       INTC
      *
     C           COUNT4    ADD  1         COUNT4
      *
      * Timestamp                                                                             243172
     C                     MOVE STMP      TMST                                                243172
     C                     WRITELETLXDKF
      *
      *
     C                     ENDSR
      *
      *****************************************************************                     MD030700
      /TITLE SR/NPBILL                                                                      MD030700
      *****************************************************************                     MD030700
      *                                                               *                     MD030700
      *  NPBILL  - ALLOW GENERATION OF FEE ADVICES FOR BACKDATED      *                     MD030700
      *            PAYMENTS SETTLED TODAY.                            *                     MD030700
      *                                                               *                     MD030700
      *  Called By: PROCES, FEES                                      *                     MD030700
      *                                                               *                     MD030700
      *  Calls:     RTLX, CBILL                                       *                     MD030700
      *                                                               *                     MD030700
      *****************************************************************                     MD030700
      *                                                                                     MD030700
     C           NPBILL    BEGSR                                                            MD030700
      *                                                                                     MD030700
      ** Confirm in LKEYFED if settlement is made today.                                    MD030700
      *                                                                                     MD030700
     C                     MOVE ' '       WBDPAY  1                                         MD030700
     C                     MOVE *BLANKS   AKY                                               MD030700
     C                     MOVE FACT      WKFACT  3                                         MD030700
     C                     MOVE FEFCOD    WKFCOD  2                                         MD030700
     C                     MOVEAWKFACT    AKY,1                                             MD030700
     C                     MOVE 'R'       AKY,4                                             MD030700
     C                     MOVE PTFI      AKY,7                                             MD030700
     C                     MOVEAWKFCOD    AKY,8                                             MD030700
     C                     MOVE 'F'       AKY,10                                            MD030700
     C                     MOVEAAKY       KACKEY 14                                         MD030700
     C                     MOVE *BLANKS   KLNNO   6                                         MD030700
     C                     MOVE FEFACL    KLNNO                                             MD030700
      *                                                                                     MD030700
     C           KEY009    SETGTLKYFEDL0                                                    MD030700
     C           KEY009    REDPELKYFEDL0                 27                                 MD030700
      *                                                                                     MD030700
      ** If event date of repayment is equal amended date of fee                            MD030700
      ** from IC, then this qualifies for a fee advice generation                           MD030700
      *                                                                                     MD030700
     C           *IN27     IFEQ '0'                                                         MD030700
     C           FFANPD    ANDEQLKEDAT                                                      MD030700
     C           *IN27     OREQ '0'                                                         MD030700
     C           FEFREQ    ANDNE' '                                                         MD030700
     C           FEAUTO    OREQ 'N'                                                         MD030700
      *                                                                                     MD030700
     C           *IN27     IFEQ '0'                                                         MD030700
     C                     Z-ADDLKEDAT    PAYDAT                                            MD030700
     C                     Z-ADDLKEAMT    WFEE                                              MD030700
     C                     ENDIF                                                            MD030700
      *                                                                                     MD030700
     C           FEAUTO    IFEQ 'N'                                                         MD030700
     C                     Z-ADDFEDDAT    PAYDAT                                            MD030700
     C                     Z-ADDFEAMTP    WFEE                                              MD030700
     C                     ENDIF                                                            MD030700
      *                                                                                     MD030700
     C                     MOVE 'Y'       WBDPAY                                            MD030700
     C                     MOVE FECNUM    FCUS                                              MD030700
     C                     Z-ADDFEFSEQ    LASN                                              MD030700
     C                     Z-ADD0         CPAM                                              MD030700
     C                     Z-ADDFEORED    ORED                                              MD030700
     C                     Z-ADD0         INTR                                              MD030700
      *                                                                                     MD030700
     C           *INU3     IFEQ '0'                                                         MD030700
     C                     EXSR RTLX                                                        MD030700
      *                                                                                     MD030700
     C           BTIN      IFNE 'N'                                                         MD030700
     C                     EXSR CBILL                                                       MD030700
     C                     ENDIF                                                            MD030700
     C                     ENDIF                                                            MD030700
      *                                                                                     MD030700
     C                     MOVE 'N'       WBDPAY                                            MD030700
      *                                                                                     MD030700
     C                     ENDIF                                                            MD030700
      *                                                                                     MD030700
     C                     ENDSR                                                            MD030700
      *                                                                                     MD030700
      *****************************************************************                     MD030700
      /TITLE SR/MCBILL                                                                      MD030700
      *****************************************************************                     MD030700
      *                                                               *                     MD030700
      *  MCBILL  - ALLOW GENERATION OF FEE ADVICES FOR MATURED FEES   *                     MD030700
      *            INSERTED TODAY.                                    *                     MD030700
      *                                                               *                     MD030700
      *  Called By: PROCES, FEES                                      *                     MD030700
      *                                                               *                     MD030700
      *  Calls:     CBILL                                             *                     MD030700
      *                                                               *                     MD030700
      *****************************************************************                     MD030700
      *                                                                                     MD030700
     C           MCBILL    BEGSR                                                            MD030700
      *                                                                                     MD030700
     C           FEORED    IFEQ RUND                                                        MD030700
     C           *INU3     ANDEQ'0'                                                         MD030700
      *                                                                                     MD030700
     C           FEPYON    IFEQ ' '                                                         MD030700
     C           FEPYON    OREQ 'S'                                                         MD030700
     C                     Z-ADDFEPSTD    PAYDAT                                            MD030700
     C                     ELSE                                                             MD030700
     C                     Z-ADDFEPEND    PAYDAT                                            MD030700
     C                     ENDIF                                                            MD030700
      *                                                                                     MD030700
     C                     Z-ADDFEFAMT    WFEE                                              MD030700
     C                     MOVE FECNUM    FCUS                                              MD030700
     C                     Z-ADDFEFSEQ    LASN                                              MD030700
     C                     Z-ADD0         CPAM                                              MD030700
     C                     Z-ADDFEORED    ORED                                              MD030700
     C                     Z-ADD0         INTR                                              MD030700
      *                                                                                     MD030700
     C                     EXSR RTLX                                                        MD030700
      *                                                                                     MD030700
     C           BTIN      IFNE 'N'                                                         MD030700
     C                     EXSR CBILL                                                       MD030700
     C                     ENDIF                                                            MD030700
      *                                                                                     MD030700
      ** Update pay/receive & bill/telex flags on LEFEED                                    MD030700
      *                                                                                     MD030700
     C                     MOVELFECNUM    WECNUM                                            MD030700
     C                     Z-ADDFEFACL    WEFACL                                            MD030700
     C                     MOVELFELOAN    WELOAN                                            MD030700
     C                     Z-ADDFEFSEQ    WEFSEQ                                            MD030700
      *                                                                                     MD030700
     C           WKLNFE    IFEQ 'L'                                                         MD030700
     C                     EXCPTXLEFL                                                       MD030700
     C           KEY008    CHAINLEFEEDL2             25                                     MD030700
     C                     ELSE                                                             MD030700
     C                     EXCPTXLEF                                                        MD030700
     C           KEY008    CHAINLEFEEDL1             26                                     MD030700
     C                     ENDIF                                                            MD030700
      *                                                                                     MD030700
     C                     ENDIF                                                            MD030700
     C                     MOVE ' '       WKLNFE                                            MD030700
      *                                                                                     MD030700
     C                     ENDSR                                                            MD030700
      *                                                                                     MD030700
      *****************************************************************
      /TITLE SR/CBILL
      *****************************************************************
      *                                                               *
      *  CBILL  - OUTPUT TO CUSTOMER BILLS/TELEX FILES                *
      *                                                               *
      *  Called By: NONCAL, FEEPAY                                    *
      *                                                               *
      *  Calls:     CUT2FM, CUT1FM                                    *
      *                                                               *
      *****************************************************************
      *
     C           CBILL     BEGSR
      *
      ***  If pay date less than or equal to billing days
      *
     C           PAYDAT    IFLE BDAYS                      ***B001
      *
      ************************************************
      ***  Non calculated facility fees processing ***
      ************************************************
      *
     C********** FELOAN    IFEQ *ZEROS                     ***B002                            CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C           FECALT    ANDEQ*BLANKS
      *
      ***  If PAYDATE equals to fee period start date and start cust
      ***  bill/telex indicator is blank a start date fee bill/telex
      ***  should be sent.
      *
     C           PAYDAT    IFEQ FEPSTD                     ***B003
     C           FESBTI    ANDEQ*BLANKS
      *
     C                     MOVE 'Y'       FESBTI
      *
      ***  Output a record to detail format of the customer bills/telex
      ***  file for facility-based fees.
      *
     C                     EXSR CUT2FM
      *
     C                     END                             ***E003
      *
      ***  If PAYDAT equals to fee period end date and the end cust.
      ***  bill/telex indicator is blank, an end date fee bill/telex
      ***  should be sent.
      *
     C           PAYDAT    IFEQ FEPEND                     ***B003
     C           FEEBTI    ANDEQ*BLANKS
      *
     C                     MOVE 'Y'       FEEBTI
      *
      ***  Output a record to detail format of the customer bills/telex
      ***  file for facility-based fees.
      *
     C                     EXSR CUT2FM
      *
     C                     END                             ***E003
      *
     C                     END                             ***E002
      *
      ********************************************
      ***  Calculated facility fees processing ***
      ********************************************
      *
     C********** FELOAN    IFEQ *ZEROS                     ***B002                            CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C           FECALT    ANDNE*BLANKS
      *
      ***  If PAYDAT equals fee next pay date and payment cust.
      ***  bill/telex indicator is blank a next payment date fee
      ***  telex should be sent.
      *
     C           PAYDAT    IFEQ WENPYD                     ***B003
     C           FEPBTI    ANDEQ*BLANKS
      *
     C                     MOVE 'Y'       FEPBTI
      *
      ***  Output a record to detail format of the customer bills/telex
      ***  file for facility-based fees.
      *
     C                     EXSR CUT2FM
      *
     C                     END                             ***E003
      *
      ***  If PAYDAT equals fee period end date and the end cust.
      ***  bill/telex indicator is blank, an end date fee bill/telex
      ***  should be sent.
      *
     C           PAYDAT    IFEQ FEPEND                     ***B003
     C           FEEBTI    ANDEQ*BLANKS
      *
     C                     MOVE 'Y'       FEEBTI
      *
      ***  Output a record to detail format of the customer bills/telex
      ***  file for facility-based fees.
      *
     C                     EXSR CUT2FM
      *
     C                     END                             ***E003
      *                                                                                     MD030700
      ** WBDPAY = 'Y' covers Fees whose next Payment Date are changed                       MD030700
      *  to current run day or less.                                                        MD030700
      *                                                                                     MD030700
     C           WBDPAY    IFEQ 'Y'                                                         MD030700
     C           PAYDAT    ANDNEWENPYD                                                      MD030700
     C           PAYDAT    ANDNEFEPEND                                                      MD030700
      *                                                                                     MD030700
     C                     EXSR CUT2FM                                                      MD030700
      *                                                                                     MD030700
     C                     END                                                              MD030700
      *
     C                     END                             ***E002
      *
      *****************************
      ***  Loan fees processing ***
      *****************************
      *
     C           FEFACL    IFEQ *ZEROS                     ***B002
      *
      ***  If PAYDAT equals fee period start date and start cust
      ***  bill/telex indicator is blank, a start date fee bill/
      ***  telex should be sent.
      *
     C           PAYDAT    IFEQ FEPSTD                     ***B003
     C           FESBTI    ANDEQ*BLANKS
      *
     C                     MOVE 'Y'       FESBTI
      *
      ***  Output a record to detail format of the customer bills/telex
      ***  file for loan-based fees
      *
     C                     EXSR CUT1FM
      *
     C                     END                             ***E003
      *
      ***  If PAYDAT equals fee period end date and the end cust.
      ***  bill/telex indicator is blank, an end date fee telex
      ***  should be sent.
      *
     C           PAYDAT    IFEQ FEPEND                     ***B003
     C           FEEBTI    ANDEQ*BLANKS
      *
     C                     MOVE 'Y'       FEEBTI
      *
      ***  Output a record to detail format of the customer bills/telex
      ***  file for loan-based fees
      *
     C                     EXSR CUT1FM
      *
     C                     END                             ***E003
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           PAYDAT    ANDEQWENPYD                                                        CAS009
     C           FEPBTI    ANDEQ*BLANK                                                        CAS009
      *                                                                                       CAS009
     C                     MOVE LNRF      WFCLN                                               CAS009
     C                     MOVE 'Y'       FEPBTI                                              CAS009
      *                                                                                       CAS009
      ** Output a record to detail format of the loan based                                   CAS009
      ** pay/receive file.                                                                    CAS009
      *                                                                                       CAS009
     C                     EXSR CUT1FM                                                        CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
     C/COPY WNCPYSRC,LEH00730
      *                                                                                       CLE073
      ** If PAYDAT equals fee next payment date and payment date bill/telex                   CLE073
      ** indicator is blank, a payment date fee bill/telex should be sent.                    CLE073
      *                                                                                       CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'98'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'99'                                                          CLE073
      *                                                                                       CLE134
      ** Past Due Call Loans                                                                  CLE134
      *                                                                                       CLE134
     C           CLE134    OREQ 'Y'                                                           CLE134
     C           FECALT    ANDEQ'90'                                                          CLE134
     C           WPDCL     ANDEQ'Y'                                                           CLE134
      *                                                                                       CLE073
     C           PAYDAT    IFEQ WKNPYD                                                        CLE073
     C           FEPBTI    ANDEQ*BLANKS                                                       CLE073
      *                                                                                       CLE073
     C                     MOVE 'Y'       FEPBTI                                              CLE073
      *                                                                                       CLE073
      ** Output a record to detail format of the customer bills/telex                         CLE073
      ** file for loan-based fees                                                             CLE073
      *                                                                                       CLE073
     C                     EXSR CUT1FM                                                        CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *
     C                     END                             ***E002
      *
      ***  End if PAYDAT LE BDAYS
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/CUT1FM
      *****************************************************************
      *                                                               *
      *  CUT1FM  - FORMAT OUTPUT TO LOAN-BASED CUSTOMER BILLS/TELEX   *
      *            FILE                                               *
      *                                                               *
      *  Called By: CBILL                                             *
      *                                                               *
      *  Calls:     NOTHING                                           *
      *                                                               *
      *****************************************************************
      *
     C           CUT1FM    BEGSR
      *
     C                     MOVE 'D'       RECI
     C                     MOVE 'B'       RCDT
     C**********           Z-ADDFELOAN    LNRF                                                CLE148
     C                     MOVELFELOAN    LNRF                                                CLE148
     C                     Z-ADDPAYDAT    VDAT
     C                     MOVE NACD      CNAC
     C                     MOVE FEFCCY    CCY
     C/COPY WNCPYSRC,LE0492C025
     C                     Z-ADDWFEE      INTA
     C                     MOVE FEBRCA    BRCA
     C**********           Z-ADDFECNUM    CNUM                                                CSD027
     C**********           Z-ADD*ZEROS    FCUS                                                CSD027
     C                     MOVE FECNUM    CNUM                                                CSD027
     C                     MOVE *BLANKS   FCUS                                                CSD027
     C                     Z-ADD*ZEROS    FTYP
     C                     Z-ADD*ZEROS    FSEQ
     C                     MOVE 'Y'       BTRQ
     C                     MOVE 'B'       BTIN
      *                                                                   CEU004
      ** Move Settlement Currency and IN Ccy for Fld 72                   CEU004
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, do not set up SCCY.                                                        218782
      *                                                                   CEU004
     C           CLE033    IFEQ 'Y'                                                           218782
     C***********SETP      ANDEQ09                                                      218782218992
     C           FESTTL    ANDEQ09                                                            218992
     C           SET09     ANDEQ'T'                                                           218782
     C                     ELSE                                                               218782
     C           CEU004    IFEQ 'Y'                                       CEU004
     C                     MOVE FESCCY    SCCY                            CEU004
     C                     ENDIF                                          CEU004
      *                                                                   CEU004
     C           CLE031    IFEQ 'Y'                                       CLE031
      *                                                                   CLE031
     C           PTFI      IFEQ *BLANKS                                   CLE031
     C                     MOVE FESCCY    SCCY                            CLE031
     C                     MOVE FEREXR    REXR                            CLE031
     C                     MOVE FEREXI    REXI                            CLE031
     C                     ELSE                                           CLE031
     C                     MOVE FEPSCY    PSCY                            CLE031
     C                     MOVE FEPEXR    PEXR                            CLE031
     C                     MOVE FEPEXI    PEXI                            CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                                              218782
      *
     C           COUNT5    ADD  1         COUNT5
      *
     C                     WRITECUTX1HPF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/CUT2FM
      *****************************************************************
      *                                                               *
      *  CUT2FM  - FORMAT OUTPUT TO FACILITY BASED CUSTOMER BILLS/    *
      *            TELEX FILE                                         *
      *                                                               *
      *  Called By: CBILL                                             *
      *                                                               *
      *  Calls:     NOTHING                                           *
      *                                                               *
      *****************************************************************
      *
     C           CUT2FM    BEGSR
      *
     C                     MOVE 'D'       RECI
     C                     MOVE 'F'       RCDT
     C                     MOVE FEBRCA    BRCA
     C**********           Z-ADDFECNUM    CNUM                                                CSD027
     C                     MOVE FECNUM    CNUM                                                CSD027
     C**********           Z-ADD*ZEROS    LNRF                                                CLE148
     C                     MOVEL*BLANKS   LNRF                                                CLE148
     C                     Z-ADDPAYDAT    VDAT
     C**********           Z-ADDFCUS      FCUS                                                CSD027
     C                     MOVE FCUS      FCUS                                                CSD027
     C                     Z-ADDFACT      FTYP
     C                     Z-ADDFCNO      FSEQ
     C                     MOVE FEFCCY    CCY
     C                     Z-ADDWFEE      INTA
     C                     Z-ADD*ZEROS    PRAM
     C                     Z-ADD*ZEROS    WTXA
     C                     Z-ADD*ZEROS    FEAM
     C                     MOVE NACD      CNAC
     C                     MOVE 'Y'       BTRQ
      *                                                                   160659
      ** Move Settlement Currency and IN Ccy for Fld 72                   160659
      ** If settlement method is 09 and postings are to use Transaction                       218782
      ** currency, do not set up SCCY.                                                        218782
      *                                                                   160659
     C           CLE033    IFEQ 'Y'                                                           218782
     C***********SETP      ANDEQ09                                                      218782218992
     C           FESTTL    ANDEQ09                                                            218992
     C           SET09     ANDEQ'T'                                                           218782
     C                     ELSE                                                               218782
     C           CEU004    IFEQ 'Y'                                       160659
     C                     MOVE FESCCY    SCCY                            160659
     C                     ENDIF                                          160659
      *                                                                   CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
      *                                                                   CLE031
     C           PTFI      IFEQ *BLANKS                                   CLE031
     C                     MOVE FESCCY    SCCY                            CLE031
     C                     MOVE FEREXR    REXR                            CLE031
     C                     MOVE FEREXI    REXI                            CLE031
     C                     ELSE                                           CLE031
     C                     MOVE FEPSCY    PSCY                            CLE031
     C                     MOVE FEPEXR    PEXR                            CLE031
     C                     MOVE FEPEXI    PEXI                            CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                                              218782
      *
     C                     WRITECUTX2HPF
      *
     C           COUNT6    ADD  1         COUNT6
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/LSTRAT
      *****************************************************************
      *                                                               *
      *  LSTRAT - SUBROUTINE CALLED IF LOOK UP OF FAM OR FPC ARRAY    *
      *           FOR VALUES GREATER THAN OR EQUAL TO LOKUP FACTOR    *
      *           FAILS.                                              *
      *                                                               *
      *  Called By: ACCRUE                                            *
      *                                                               *
      *  Calls:     NOTHING                                           *
      *                                                               *
      *****************************************************************
      *
     C           LSTRAT    BEGSR
      *
     C                     Z-ADD5         Y       20
     C           Y         DOWGT0                          ***B001
      *
      ***  If current fee amount being processed is zero and its
      ***  corresponding fee rate on FRT array is not zero, set
      ***  array element count (in SR/ACCRUE) to the value of Y and
      ***  zeroise afterwards.
      *
     C********** FEEM,Y    IFEQ 0                          ***B002                            CLE071
     C********** FRT,Y     ANDNE0                                                             CLE071
     C           WFEM,Y    IFEQ 0                                                             CLE071
     C           WFRT,Y    ANDNE0                                                             CLE071
     C                     Z-ADDY         X
     C                     Z-ADD0         Y
     C                     END                             ***E002
     C                     SUB  1         Y
     C                     END                             ***E001
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SRSDAT                                                                           CAS009
      *****************************************************************                       CAS009
      *                                                               *                       CAS009
      *  SRSDAT - Calculate the Next Fee Payment Date.                *                       CAS009
      *                                                               *                       CAS009
      *  Called By: NONCAL                                            *                       CAS009
      *  Calls:                                                       *                       CAS009
      *   ZFREQB                                                      *                       CAS009
      *                                                               *                       CAS009
      *****************************************************************                       CAS009
      *                                                                                       CAS009
     C           SRSDAT    BEGSR                                                              CAS009
      *                                                                                       CAS009
     C                     MOVE 'Y'       WTELX                                               CAS009
     C                     SELEC                                                              CAS009
      *                                                                                       CAS009
     C           FEFREQ    WHNE *BLANKS                                                       CAS009
      *                                                                                       CAS009
     C           WENPYD    IFEQ FEPEND                                                        CAS009
     C                     Z-ADD0         WENPYD                                              CAS009
     C                     ELSE                                                               CAS009
      *                                                                                       CAS009
     C                     MOVE *BLANKS   ZZERR@                                              CAS009
     C                     MOVE FEFREQ    ZFREQ                                               CAS009
     C                     Z-ADDWENPYD    ZDAYNO                                              CAS009
     C                     MOVE BJLCCY    ZCCY                                                CAS009
     C                     MOVE FEDYIM    ZMDAY                                               CAS009
      *                                                                                       CAS009
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C********** FESTTL    ANDEQ1                                                     CLE141 CLE141A
     C           FELOAN    ANDNE*BLANKS                                                       CLE141
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** FESTTL    ANDEQ7                                                     CLE141 CLE141A
     C********** FELOAN    ANDNE*BLANKS                                               CLE141 CLE141A
     C********** CLE141    OREQ 'Y'                                                   CLE141 CLE141A
     C********** FESTTL    ANDEQ8                                                     CLE141 CLE141A
     C********** FELOAN    ANDNE*BLANKS                                               CLE141 CLE141A
     C                     EXSR ZFRQB3                                                        CLE141
     C                     MOVELZCCY      CCYLL                                              CLE141A
     C                     MOVELZLOC      LOCLL                                              CLE141A
     C                     MOVEL'A'       WCLRT                                             MD054101
     C           KLOAN     CHAINCLOAN                95                                     MD054101
     C                     MOVEL*BLANKS   PAYIND                                              CLE141
     C                     CALL 'LEZBDYCD'BDCHK                                               CLE141
     C                     MOVELZADJDT    ZDAYNO                                              CLE141
     C           ZDAYNO    IFGT FEPEND                                                        CLE141
     C                     Z-ADDFEPEND    WENPYD                                              CLE141
     C                     ELSE                                                               CLE141
     C                     Z-ADDZDAYNO    WENPYD                                              CLE141
     C                     ENDIF                                                              CLE141
     C                     ELSE                                                               CLE141
     C                     EXSR ZFREQB                                                        CAS009
      *                                                                                       CAS009
     C           ZZERR@    IFNE *BLANKS                                                       CAS009
      *                                                                                       CAS009
     C                     MOVEL'ZFREQB  'DBFILE                                              CAS009
     C                     Z-ADD68        DBASE                                               CAS009
     C                     MOVELWENPYD    DBKEY                                               CAS009
     C                     EXSR *PSSR                                                         CAS009
      *                                                                                       CAS009
     C                     ELSE                                                               CAS009
      *                                                                                       CAS009
     C           ZDAYNO    IFGT FEPEND                                                        CAS009
     C                     Z-ADDFEPEND    WENPYD                                              CAS009
     C                     ELSE                                                               CAS009
     C                     Z-ADDZDAYNO    WENPYD                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CLE141
      *                                                                                       CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           FEFREQ    WHEQ *BLANKS                                                       CAS009
      *                                                                                       CAS009
     C********** WENPYD    IFLE FEPEND                                               CAS009 BUG13045
     C           WENPYD    IFLT FEPEND                                                      BUG13045
     C                     Z-ADDFEPEND    WENPYD                                              CAS009
     C                     ELSE                                                               CAS009
     C                     Z-ADD0         WENPYD                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDSL                                                              CAS009
      *                                                                                       CAS009
     C                     ENDSR                                                              CAS009
      *                                                                                       CAS009
      *****************************************************************                       CAS009
      /TITLE SR/*PSSR
      *****************************************************************
      *                                                               *
      * *PSSR  - Program exception error routine                      *
      *          Called automatically if a program error occurs,      *
      *          or directly by the program code using EXSR.          *
      *          This subroutine DUMPs the program just once.         *
      *                                                               *
      *  Called By: VARIOUS                                           *
      *                                                               *
      *  Calls:   AUDIT                                               *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      ***  Check to see that *PSSR has not already been called.
      *
     C           WRUN      IFEQ *BLANK                     ***B001
     C                     MOVE 'Y'       WRUN    1
      *
     C                     SETON                     U7U8
     C                     DUMP
     C                     EXSR AUDIT
     C                     END                             ***E001
      *
      ***  If *PSSR already run, then just end the program here.
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/AUDIT
      *****************************************************************
      *                                                               *
      *  AUDIT  - Subroutine to Produce Audit Report and End Program. *
      *                                                               *
      *  Called By: Main Processing, PROCES, *PSSR                    *
      *                                                               *
      *  Calls:  NOTHING                                              *
      *                                                               *
      *****************************************************************
      *
     C           AUDIT     BEGSR
      *
      ***  Output Report Header and File Controls.
      *
     C                     WRITEHEADAU
     C*
     C***  COUNT ON TRAILER SHOULD MATCH RECORDS READ
     C***  IF NOT, OUTPUT 'DIFFERENCE'
     C*
     C********** NORELV    IFNE COUNTL                                      0031
     C           NORELV    IFNE COUNT2                                      0031
     C                     SETON                     88U8
     C                     END
     C*                                                                     0055
     C** Calculate the number of records that have been added by the        0055
     C** program for the report                                             0055
     C*                                                                     0055
     C           COUNT4    SUB  COUNT7    COUNT7                            0055
     C*                                                                     0055
     C** Calculate the number of records that have been added by the        0055
     C** program for the report                                             0055
     C*                                                                     0055
     C           COUNT5    SUB  COUNT8    COUNT8                            0055
      *                                                                     0039
      ***  Telex/bill trailers not updated if non-working day accrual       0039
      ***  run, so zero their counts on the audit report                    0039
      *                                                                     0039
     C           *INU3     IFEQ '1'                                         0039
     C                     Z-ADD0         COUNT3                            0039
     C                     Z-ADD0         COUNT4                            0039
     C                     Z-ADD0         COUNT5                            0039
     C                     Z-ADD0         COUNT6                            0039
     C                     END                                              0039
     C*
     C                     WRITECONTROL
      *
      ***  Write to trailer record if an error has not
      ***  occurred.
      *
     C           *INU7     IFEQ '0'
     C           *INU8     ANDEQ'0'
      *
      ***  Write to events file trailer
      *
     C                     MOVE 'T'       RECI
     C**********           Z-ADDCOUNT2    NORE                              0031
     C**********           Z-ADDCOUNTL    NORE                        0031105140
     C                     Z-ADDCOUNTL    NORE0                           105140
     C*                                                                     0084
     C** Subtract the number of A1 records dropped from the trailer         0084
     C** total (hashing is OK as A1 records have never been included        0084
     C*                                                                     0084
     C********** NORE      SUB  DELSC     NORE                        0084105140
     C           NORE0     SUB  DELSC     NORE0                           105140
     C           HRWN2     ADD  TOTI2     HRWN
     C           HRDC2     ADD  TOTD2     HRDC
     C*                                                                     0052
     C***  Add 1 to integers if decimal addition goes over 999              0052
     C*                                                                     0052
     C           HRDC      IFLT TOTD2                                       0052
     C                     ADD  1         HRWN                              0052
     C                     END                                              0052
      *
     C***********          UPDATOLVENTZZ                                  045634
     C                     WRITEOLVENTZZ                                  045634
      *                                                                     0039
      ***  Do not update telex/bill trailers if non-working day accrual     0039
      ***  run                                                              0039
      *                                                                     0039
     C           *INU3     IFEQ '0'                                         0039
      *
      ***  Write to facility-based pay/receive trailer file
      *
     C                     MOVE 'T'       RECI
     C                     Z-ADDCOUNT3    NORE
     C           NORE      ADD  2         NORE                             0055
     C                     Z-ADDTOTI3     HRWN
     C                     Z-ADDTOTD3     HRDC
      *
     C                     WRITEOCFTLXZZ
      *
      ***  Update loan-based pay/receive trailer file
      *
     C*********************ADD  COUNT4    NORE1   50                        0032
     C                     Z-ADDCOUNT4    NORE1   50                        0032
      *
     C           TRLET     IFEQ 'Y'                                       BH3461
     C                     UPDATLETLXZXF
     C                     ELSE                                           BH3461
     C                     MOVE 'T'       RECI                            BH3461
     C                     WRITELETLXZXF                                  BH3461
     C                     END                                            BH3461
      *
      ***  Update loan-based customer bill/telexes trailer
      *
     C*********************ADD  COUNT5    NORE2   50                        0032
     C                     Z-ADDCOUNT5    NORE2   50                        0032
      *
     C           TRCUT     IFEQ 'Y'                                       BH3461
     C                     UPDATCUTX1ZXF
     C                     ELSE                                           BH3461
     C                     MOVE 'T'       RECI                            BH3461
     C                     WRITECUTX1ZXF                                  BH3461
     C                     END                                            BH3461
      *
      ***  Write to facility-based customer bill/telexes trailer
      *
     C                     MOVE 'T'       RECI
     C                     Z-ADDCOUNT6    NORE
     C           NORE      ADD  2         NORE                              0055
      *
     C                     WRITECUTX2ZXF
      *                                                                     0039
     C                     END                                              0039
      *
     C                     END
      *
      ***  If there is a DB Error or file controls problem output
      ***  report.
      *
     C           *INU7     IFEQ '1'                        ***B001
     C                     WRITEDBERROR
     C                     ELSE                            ***X001
      *
      ***  End Program and Return.
      *
     C                     SETON                     LR
     C                     RETRN
      *
     C                     END                             ***E001
      *
     C                     ENDSR
      *
     C********************************************************************
      *                                                                                       CLE034
      * SR34A  --- Initial set up for CLE034 processing                                       CLE034
      *                                                                                       CLE034
      * CALLED FROM: NONCAL, CALFEE                                                           CLE034
      *                                                                                       CLE034
      * CALLS: AOSTALR2                                                                       CLE034
      *                                                                                       CLE034
      ********************************************************************                    CLE034
      *                                                                                       CLE034
     C           SR34A     BEGSR                           ** SR34A **                        CLE034
     C                     Z-ADDWFEE      SAVAMT 130                                          CLE034
      *                                                                                       CLE034
     C           PTFI      IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'R'       W#PYRC  1                                           CLE034
     C                     ELSE                                                               CLE034
     C           PTFI      IFEQ 'P'                                                           CLE034
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'P'       W#PYRC                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
     C*                                                                                       CLE034
      * Save values which might be overwritten by fields on LESTALPD                          CLE034
     C                     Z-ADD0         TOTAMT 130                                          CLE034
     C                     Z-ADD0         WRKAMT 130                                          CLE034
     C                     MOVE ' '       WRKFLD  1                                           CLE034
      *                                                                                       CLE034
     C                     MOVE OSDB      WSOSDB  3                                           CLE034
     C                     MOVE OMDB      WSOMDB  3                                           CLE034
     C**********           MOVE FEOURS    WSOURS 12                                    CLE034 CGL029
     C                     MOVE FEOURS    WSOURS 18                                           CGL029
     C                     MOVE FESTTL    WSSTTL  20                                          CLE034
     C                     MOVE FEOSBR    WSOSBR  3                                           CLE034
     C                     MOVE FETHER    WSTHER 10                                           CLE034
     C                     MOVE PSTM      WSPSTM  20                                          CLE034
     C**********           MOVE PONS      WSPONS 12                                    CLE034 CGL029
     C                     MOVE PONS      WSPONS 18                                           CGL029
     C                     MOVE RSTM      WSRSTM  20                                          CLE034
     C**********           MOVE RONS      WSRONS 12                                    CLE034 CGL029
     C                     MOVE RONS      WSRONS 18                                           CGL029
     C                     MOVE FESCCY    WSSCCY  3                                           CLE034
     C                     MOVE FEICCY    WSICCY  3                                           CLE034
     C                     MOVE FEPSCY    WSPSCY  3                                           CLE034
     C                     MOVE FEREXR    WSREXR 138                                          CLE034
     C                     MOVE FEREXI    WSREXI  1                                           CLE034
     C                     MOVE FEPEXR    WSPEXR 138                                          CLE034
     C                     MOVE FEPEXI    WSPEXI  1                                           CLE034
     C*                                                                                       218992
     C           *LIKE     DEFN CVMR      WSCVMR                                              218992
     C           *LIKE     DEFN RIBN      WSRIBN                                              218992
     C           *LIKE     DEFN RIBA      WSRIBA                                              218992
     C           *LIKE     DEFN ROBN      WSROBN                                              218992
     C           *LIKE     DEFN ROCN      WSROCN                                              218992
     C           *LIKE     DEFN PIBN      WSPIBN                                              218992
     C           *LIKE     DEFN PIBA      WSPIBA                                              218992
     C           *LIKE     DEFN POBN      WSPOBN                                              218992
     C           *LIKE     DEFN POCN      WSPOCN                                              218992
     C           *LIKE     DEFN RCRN      WSRCRN                                              218992
     C           *LIKE     DEFN RCRA      WSRCRA                                              218992
     C           *LIKE     DEFN RVNO      WSRVNO                                              218992
     C           *LIKE     DEFN AWBN      WSAWBN                                              218992
     C           *LIKE     DEFN AWBA      WSAWBA                                              218992
     C           *LIKE     DEFN BENN      WSBENN                                              218992
     C           *LIKE     DEFN BENA      WSBENA                                              218992
     C           *LIKE     DEFN DTP1      WSDTP1                                              218992
     C           *LIKE     DEFN DTP2      WSDTP2                                              218992
     C           *LIKE     DEFN DTP3      WSDTP3                                              218992
     C           *LIKE     DEFN DTP4      WSDTP4                                              218992
     C           *LIKE     DEFN DCHG      WSDCHG                                              218992
     C           *LIKE     DEFN BTB1      WSBTB1                                              218992
     C           *LIKE     DEFN BTB2      WSBTB2                                              218992
     C           *LIKE     DEFN BTB3      WSBTB3                                              218992
     C           *LIKE     DEFN BTB4      WSBTB4                                              218992
     C           *LIKE     DEFN BTB5      WSBTB5                                              218992
     C           *LIKE     DEFN BTB6      WSBTB6                                              218992
     C                     MOVELCVMR      WSCVMR                                              218992
     C                     MOVELRIBN      WSRIBN                                              218992
     C                     MOVELRIBA      WSRIBA                                              218992
     C                     MOVELROBN      WSROBN                                              218992
     C                     MOVELROCN      WSROCN                                              218992
     C                     MOVELPIBN      WSPIBN                                              218992
     C                     MOVELPIBA      WSPIBA                                              218992
     C                     MOVELPOBN      WSPOBN                                              218992
     C                     MOVELPOCN      WSPOCN                                              218992
     C                     MOVELRCRN      WSRCRN                                              218992
     C                     MOVELRCRA      WSRCRA                                              218992
     C                     MOVELRVNO      WSRVNO                                              218992
     C                     MOVELAWBN      WSAWBN                                              218992
     C                     MOVELAWBA      WSAWBA                                              218992
     C                     MOVELBENN      WSBENN                                              218992
     C                     MOVELBENA      WSBENA                                              218992
     C                     MOVELDTP1      WSDTP1                                              218992
     C                     MOVELDTP2      WSDTP2                                              218992
     C                     MOVELDTP3      WSDTP3                                              218992
     C                     MOVELDTP4      WSDTP4                                              218992
     C                     MOVELDCHG      WSDCHG                                              218992
     C                     MOVELBTB1      WSBTB1                                              218992
     C                     MOVELBTB2      WSBTB2                                              218992
     C                     MOVELBTB3      WSBTB3                                              218992
     C                     MOVELBTB4      WSBTB4                                              218992
     C                     MOVELBTB5      WSBTB5                                              218992
     C                     MOVELBTB6      WSBTB6                                              218992
      *                                                                                       CLE034
     C                     MOVE FELOAN    PLNRF                                               CLE034
     C                     MOVE FECNUM    PCNUM                                               CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C                     MOVE PLNRF     WPLNRF                                            CLE075AP
     C                     MOVE PCNUM     WPCNUM                                            CLE075AP
     C                     MOVE PFACL     WPFACL                                            CLE075AP
     C                     MOVE PFSEQ     WPFSEQ                                            CLE075AP
     C                     MOVE W#PYRC    WPPYRC                                            CLE075AP
     C                     MOVE WPSTAL    KEYSA2                                            CLE075AP
     C                     ADD  1         SA2SEQ                                            CLE075AP
     C                     EXSR CHKSA2                                                      CLE075AP
      *                                                                                     CLE075AP
      ** Use details from array if KEYSA2 is found, otherwise,                              CLE075AP
      ** retrieve details from program call                                                 CLE075AP
      *                                                                                     CLE075AP
     C           SA2IC     IFEQ 'Y'                                                         CLE075AP
      *                                                                                     CLE075AP
      ** Set occurence to index found from #SAK array                                       CLE075AP
      *                                                                                     CLE075AP
     C           J         OCUR LESTAL                                                      CLE075AP
      *                                                                                     CLE075AP
     C                     ELSE                                                             CLE075AP
      *                                                                                     CLE075AP
     C           SA2IDX    IFNE 0                                                           CLE075AP
     C                     Z-ADDSA2IDX    J                                                 CLE075AP
     C                     ELSE                                                             CLE075AP
     C                     Z-ADD1         J                                                 CLE075AP
     C                     MOVEA#SA2      #SAS                                              CLE075AP
     C                     SORTA#SAS                                                        CLE075AP
     C                     Z-ADD#SAS,1    SA2KEY                                            CLE075AP
     C           SA2KEY    LOKUP#SA2,J                   46                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C           J         OCUR LESTAL                                                      CLE075AP
      *                                                                                     CLE075AP
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   STALCD  7                                           CLE034
     C                     PARM '*FIRST ' POPTN   7                                           CLE034
     C                     PARM 'FEES'    PTYPE                                               CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD   5                                           CLE034
     C                     PARM *BLANKS   PLASQ   3                                           CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           W#PYRC                                              CLE034
     C           LESTAL    PARM *BLANKS   DSSDY                                               CLE034
      *                                                                                       CLE034
     C           STALCD    IFNE *BLANKS                                                       CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVEL'LE0492  'DBPGM            ***************                    CLE034
     C                     MOVEL'AOSTALR2'DBFILE           * DBERROR 30  *                    CLE034
     C                     Z-ADD30        DBASE            ***************                    CLE034
     C                     MOVELPOPTN     DBKEY                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     ELSE                                                             CLE075AP
     C                     EXSR ADDSA2                                                      CLE075AP
     C                     ENDIF                                                            CLE075AP
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                           ** SR34A **                        CLE034
      *                                                                                       CLE034
      ********************************************************************                    CLE034
      * SR34B  - Processing to calculate amount for settlement allocation                     CLE034
      *                                                                                       CLE034
      * CALLED FROM:  NONCAL, CALFEE                                                          CLE034
      *                                                                                       CLE034
      * CALLS:                                                                                CLE034
      *                                                                                       CLE034
      ********************************************************************                    CLE034
      *                                                                                       CLE034
     C           SR34B     BEGSR                           ** SR34B **                        CLE034
      *                                                                                       CLE034
     C           W#PYRC    IFEQ 'P'                                                           CLE034
     C           PYPC      DIV  100       W#PYPC 139                                          CLE034
     C           SAVAMT    MULT W#PYPC    WRKAMT    H                                         CLE034
     C                     ELSE                                                               CLE034
     C           RCPC      DIV  100       W#RCPC 139                                          CLE034
     C           SAVAMT    MULT W#RCPC    WRKAMT    H                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           TOTAMT    ADD  WRKAMT    TOTAMT                                              CLE034
      *                                                                                       CLE034
     C           WRKFLD    IFEQ 'Y'                                                           CLE034
     C           SAVAMT    ANDNETOTAMT                                                        CLE034
     C           SAVAMT    SUB  TOTAMT    W#DIFF 130                                          CLE034
     C           WRKAMT    ADD  W#DIFF    WRKAMT                                              CLE034
     C**********           Z-ADDWRKAMT    WFEE                                         CLE034 218992
     C                     ENDIF                                                              CLE034
     C                     Z-ADDWRKAMT    WFEE                                                218992
     C                     EXSR SR34D                                                         CLE034
     C                     ENDSR                           ** SR34B **                        CLE034
      *                                                                                       CLE034
      ********************************************************************                    CLE034
      * SR34C  - Processing to get next settlement allocation            *                    CLE034
      *                                                                  *                    CLE034
      * CALLED FROM: NONCAL, CALFEE                                      *                    CLE034
      *                                                                  *                    CLE034
      * CALLS: AOSTALR2                                                  *                    CLE034
      *                                                                  *                    CLE034
      ********************************************************************                    CLE034
      *                                                                                       CLE034
     C           SR34C     BEGSR                           ** SR34C **                        CLE034
     C           WRKFLD    IFEQ 'Y'                                                           CLE034
     C                     MOVE ' '       WRKFLD                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE FELOAN    PLNRF                                               CLE034
     C                     MOVE FECNUM    PCNUM                                               CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C**********           MOVE PLNRF     WPLNRF                                   CLE075AP MD048606
     C**********           MOVE PCNUM     WPCNUM                                   CLE075AP MD048606
     C**********           MOVE PFACL     WPFACL                                   CLE075AP MD048606
     C**********           MOVE PFSEQ     WPFSEQ                                   CLE075AP MD048606
     C**********           MOVE W#PYRC    WPPYRC                                   CLE075AP MD048606
     C**********           MOVE WPSTAL    KEYSA2                                   CLE075AP MD048606
     C**********           ADD  1         SA2SEQ                                   CLE075AP MD048606
     C**********           EXSR CHKSA2                                             CLE075AP MD048606
      *****************************************************************            CLE075AP MD048606
      ***Use*details*from*array*if*KEYSA2*is*found,*otherwise,*********            CLE075AP MD048606
      ***retrieve*details*from*program*call****************************            CLE075AP MD048606
      *****************************************************************            CLE075AP MD048606
     C********** SA2IC     IFEQ 'Y'                                                CLE075AP MD048606
      *****************************************************************            CLE075AP MD048606
      ***Set*occurence*to*index*found*from*#SAK*array******************            CLE075AP MD048606
      *****************************************************************            CLE075AP MD048606
     C********** J         OCUR LESTAL                                             CLE075AP MD048606
      *****************************************************************            CLE075AP MD048606
     C**********           ELSE                                                    CLE075AP MD048606
      *****************************************************************            CLE075AP MD048606
     C********** SA2IDX    IFNE 0                                                  CLE075AP MD048606
     C**********           Z-ADDSA2IDX    J                                        CLE075AP MD048606
     C**********           ELSE                                                    CLE075AP MD048606
     C**********           Z-ADD1         J                                        CLE075AP MD048606
     C**********           MOVEA#SA2      #SAS                                     CLE075AP MD048606
     C**********           SORTA#SAS                                               CLE075AP MD048606
     C**********           Z-ADD#SAS,1    SA2KEY                                   CLE075AP MD048606
     C********** SA2KEY    LOKUP#SA2,J                   46                        CLE075AP MD048606
     C**********           ENDIF                                                   CLE075AP MD048606
      *****************************************************************            CLE075AP MD048606
     C********** J         OCUR LESTAL                                             CLE075AP MD048606
      *****************************************************************            CLE075AP MD048606
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   STALCD                                              CLE034
     C                     PARM '*NEXT  ' POPTN                                               CLE034
     C                     PARM 'FEES'    PTYPE                                               CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           W#PYRC                                              CLE034
     C           LESTAL    PARM *BLANKS   DSSDY                                               CLE034
      *                                                                                       CLE034
     C           STALCD    IFEQ '*EOF   '                                                     CLE034
     C                     MOVE 'Y'       WRKFLD                                              CLE034
     C**********           ELSE                                                    CLE075AP MD048606
     C**********           EXSR ADDSA2                                             CLE075AP MD048606
     C**********           ENDIF                                                   CLE075AP MD048606
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDSR                           ** SR34C **                        CLE034
      ********************************************************************                    CLE034
      * SR34D  - Set up fields from settlement allocation                *                    CLE034
      *                                                                  *                    CLE034
      * CALLED FROM: SR34B                                               *                    CLE034
      *                                                                  *                    CLE034
      * CALLS:                                                           *                    CLE034
      *                                                                  *                    CLE034
      ********************************************************************                    CLE034
      *                                                                                       CLE034
     C           SR34D     BEGSR                           ** SR34D **                        CLE034
      *                                                                                       CLE034
     C           W#PYRC    IFEQ 'P'                                                           CLE034
      *                                                                                       CLE034
     C                     MOVE STPSTM    FESTTL                                              CLE034
     C                     MOVE STPONS    FEOURS                                              CLE034
     C                     MOVE STPOBR    FEOSBR                                              CLE034
     C                     MOVE STPIBN    FETHER                                              CLE034
     C                     MOVE STPOBR    OMDB                                                218992
     C                     MOVE *BLANKS   OSDB                                                218992
     C                     ELSE                                                               CLE034
     C                     MOVE STRSTM    FESTTL                                              CLE034
     C                     MOVE STRONS    FEOURS                                              CLE034
     C                     MOVE STROBR    FEOSBR                                              CLE034
     C                     MOVE STRIBN    FETHER                                              CLE034
     C                     MOVE STROBR    OSDB                                                218992
     C                     MOVE *BLANKS   OMDB                                                218992
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE STRSTM    RSTM                                                CLE034
     C                     MOVE STRONS    RONS                                                CLE034
     C                     MOVE STPSTM    PSTM                                                CLE034
     C                     MOVE STPONS    PONS                                                CLE034
     C                     MOVE STREXR    FEREXR                                              CLE034
     C                     MOVE STREXI    FEREXI                                              CLE034
     C                     MOVE STPEXR    FEPEXR                                              CLE034
     C                     MOVE STPEXI    FEPEXI                                              CLE034
     C                     MOVE STPSCY    FEPSCY                                              CLE034
     C**********           MOVE RSCY      FESCCY                                       CLE034 218992
     C                     MOVE STRSCY    FESCCY                                              218992
     C                     MOVE ICCY      FEICCY                                              CLE034
     C                     MOVELSTCVMR    CVMR                                                218992
     C                     MOVELSTRIBN    RIBN                                                218992
     C                     MOVELSTRIBA    RIBA                                                218992
     C                     MOVELSTROBN    ROBN                                                218992
     C                     MOVELSTROCN    ROCN                                                218992
     C                     MOVELSTPIBN    PIBN                                                218992
     C                     MOVELSTPIBA    PIBA                                                218992
     C                     MOVELSTPOBN    POBN                                                218992
     C                     MOVELSTPOCN    POCN                                                218992
     C                     MOVELSTRCRN    RCRN                                                218992
     C                     MOVELSTRCRA    RCRA                                                218992
     C                     MOVELSTRVNO    RVNO                                                218992
     C                     MOVELSTAWBN    AWBN                                                218992
     C                     MOVELSTAWBA    AWBA                                                218992
     C                     MOVELSTBENN    BENN                                                218992
     C                     MOVELSTBENA    BENA                                                218992
     C                     MOVELSTDTP1    DTP1                                                218992
     C                     MOVELSTDTP2    DTP2                                                218992
     C                     MOVELSTDTP3    DTP3                                                218992
     C                     MOVELSTDTP4    DTP4                                                218992
     C                     MOVELSTDCHG    DCHG                                                218992
     C                     MOVELSTBTB1    BTB1                                                218992
     C                     MOVELSTBTB2    BTB2                                                218992
     C                     MOVELSTBTB3    BTB3                                                218992
     C                     MOVELSTBTB4    BTB4                                                218992
     C                     MOVELSTBTB5    BTB5                                                218992
     C                     MOVELSTBTB6    BTB6                                                218992
      *                                                                                       CLE034
     C                     ENDSR                           ** SR34D **                        CLE034
      ********************************************************************                    CLE034
      * SR34E  - Restore original fields                                 *                    CLE034
      *                                                                  *                    CLE034
      * CALLED FROM: NONCAL, CALFEE                                      *                    CLE034
      *                                                                  *                    CLE034
      * CALLS:                                                           *                    CLE034
      *                                                                  *                    CLE034
      ********************************************************************                    CLE034
      *                                                                                       CLE034
     C           SR34E     BEGSR                           ** SR34E **                        CLE034
     C                     MOVE SAVAMT    WFEE                                                CLE034
     C                     MOVE WSOSDB    OSDB                                                CLE034
     C                     MOVE WSOMDB    OMDB                                                CLE034
     C                     MOVE WSPSTM    PSTM                                                CLE034
     C                     MOVE WSPONS    PONS                                                CLE034
     C                     MOVE WSRSTM    RSTM                                                CLE034
     C                     MOVE WSRONS    RONS                                                CLE034
     C                     MOVE WSOURS    FEOURS                                              CLE034
     C                     MOVE WSSTTL    FESTTL                                              CLE034
     C                     MOVE WSOSBR    FEOSBR                                              CLE034
     C                     MOVE WSTHER    FETHER                                              CLE034
     C                     MOVE WSSCCY    FESCCY                                              CLE034
     C                     MOVE WSICCY    FEICCY                                              CLE034
     C                     MOVE WSPSCY    FEPSCY                                              CLE034
     C                     MOVE WSREXR    FEREXR                                              CLE034
     C                     MOVE WSREXI    FEREXI                                              CLE034
     C                     MOVE WSPEXR    FEPEXR                                              CLE034
     C                     MOVE WSPEXI    FEPEXI                                              CLE034
     C                     MOVELWSCVMR    CVMR                                                218992
     C                     MOVELWSRIBN    RIBN                                                218992
     C                     MOVELWSRIBA    RIBA                                                218992
     C                     MOVELWSROBN    ROBN                                                218992
     C                     MOVELWSROCN    ROCN                                                218992
     C                     MOVELWSPIBN    PIBN                                                218992
     C                     MOVELWSPIBA    PIBA                                                218992
     C                     MOVELWSPOBN    POBN                                                218992
     C                     MOVELWSPOCN    POCN                                                218992
     C                     MOVELWSRCRN    RCRN                                                218992
     C                     MOVELWSRCRA    RCRA                                                218992
     C                     MOVELWSRVNO    RVNO                                                218992
     C                     MOVELWSAWBN    AWBN                                                218992
     C                     MOVELWSAWBA    AWBA                                                218992
     C                     MOVELWSBENN    BENN                                                218992
     C                     MOVELWSBENA    BENA                                                218992
     C                     MOVELWSDTP1    DTP1                                                218992
     C                     MOVELWSDTP2    DTP2                                                218992
     C                     MOVELWSDTP3    DTP3                                                218992
     C                     MOVELWSDTP4    DTP4                                                218992
     C                     MOVELWSDCHG    DCHG                                                218992
     C                     MOVELWSBTB1    BTB1                                                218992
     C                     MOVELWSBTB2    BTB2                                                218992
     C                     MOVELWSBTB3    BTB3                                                218992
     C                     MOVELWSBTB4    BTB4                                                218992
     C                     MOVELWSBTB5    BTB5                                                218992
     C                     MOVELWSBTB6    BTB6                                                218992
      *                                                                                       CLE034
     C                     ENDSR                           ** SR34E **                        CLE034
      ********************************************************************                    CLE034
      /EJECT                                                                                  CLE073
      *****************************************************************                       CLE073
      /TITLE SR/CALLON                                                                        CLE073
      *****************************************************************                       CLE073
      *                                                               *                       CLE073
      *  CALLON - Calculate fee amount due for types 97 and 98        *                       CLE073
      *                                                               *                       CLE073
      *  Called By:  NONCAL                                           *                       CLE073
      *                                                               *                       CLE073
      *  Calls:                                                       *                       CLE073
      *                                                               *                       CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
     C           CALLON    BEGSR                                                              CLE073
      *                                                                                       CLE073
      ** Initialise work fields                                                               CLE073
      *                                                                                       CLE073
     C                     Z-ADD0         WAMT   150                                          CLE073
     C                     Z-ADD0         WFEE   150                                          CLE073
      *                                                                                       CLE073
      ** Set up start date:                                                                   CLE073
      *                                                                                       CLE073
      ** If Last Payment Date is GT the run date, use the Previous Last payment date          CLE073
      ** (if not 0) else the fee start date as start.                                         CLE073
      ** Otherwise, if Last Payment Date has a value, use it as start date, else use          CLE073
      ** the Fee Start Date.                                                                  CLE073
      *                                                                                       CLE073
     C           FELPDT    IFGT RUND                                                          CLE073
     C           FEPLPD    IFNE 0                                                             CLE073
     C                     Z-ADDFEPLPD    WSTART  50                                          CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDFEPSTD    WSTART                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ELSE                                                               CLE073
     C           FELPDT    IFNE 0                                                             CLE073
     C                     Z-ADDFELPDT    WSTART                                              CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDFEPSTD    WSTART                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Set up end date:                                                                     CLE073
      *                                                                                       CLE073
     C           WKNPYD    IFNE 0                                                             CLE073
     C                     MOVE WKNPYD    WEND    50                                          CLE073
     C                     ELSE                                                               CLE073
     C                     MOVE FEPEND    WEND                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Use start & end dates to obtain number of days in whole                              CLE073
      ** calculation period.                                                                  CLE073
      *                                                                                       CLE073
     C                     Z-ADDWSTART    ZZBEG                                               CLE073
     C                     Z-ADDWEND      ZZEND                                               CLE073
     C                     MOVE FECALC    ZZCALC                                              CLE073
     C                     EXSR ZINTDY                                                        CLE073
     C           FECALC    IFEQ 6                                                             CLE073
     C                     Z-ADDINT6DY    WDAYS                                               CLE073
     C                     ELSE                                                               CLE073
     C**********           Z-ADDZZINDY    WDAYS   50                                 CLE073 MD037658
     C                     Z-ADDZZINDY    WDAYS  159                                        MD037658
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDWEND      PAYDAT                                              CLE073
      *                                                                                     MD052216
      ** Consider payment taken day indicator on fee event date                             MD052216
      ** if due date falls on a holiday                                                     MD052216
      *                                                                                     MD052216
     C                     EXSR CHKPAY                                                      MD052216
      *                                                                                     MD052216
     C                     Z-ADDWSTART    WVDAT                                               CLE073
      *                                                                                       CLE073
     C                     MOVE 'A'       WCLRT                                               CLE073
     C           KLOAN     CHAINCLOAN                96                                       CLE073
     C           *IN96     IFEQ *ON                                                           CLE073
     C                     Z-ADD0         CPAML                                               CLE073
     C                     ENDIF                                                              CLE073
     C                     MOVE 'B'       WCLRT                                               CLE073
     C           KLOAN     CHAINCLOAN                96                                       CLE073
     C           *IN96     IFEQ *ON                                                           CLE073
     C                     Z-ADD0         OPAMK                                               CLE073
     C                     ENDIF                                                              CLE073
     C           KEYPHS    CHAINLEHISTLB             11                                       CLE073
     C           *IN11     IFEQ *OFF                                                          CLE073
     C                     Z-ADDPRAMM     OPAMK                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Calculation type '97'                                                                CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C                     Z-ADDOPAMK     AAMT                                                CLE073
      *                                                                                       CLE073
     C                     Z-ADD999       WLASN                                               CLE073
     C           KEYHST    SETGTLEHISTLA                                                      CLE073
     C           KEYPHS    REDPELEHISTLA                 97                                   CLE073
      *                                                                                       CLE073
     C           *IN97     IFEQ *OFF                                                          CLE073
     C                     Z-ADDCPAMP     AAMT                                                CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADD001       WLASN                                               CLE073
     C           KEYHST    SETLLLEHISTLA                 97                                   CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Read file until date read is greater than date of end of                             CLE073
      ** this accrual period.                                                                 CLE073
      ** NDAYS is the number of days in this accrual.                                         CLE073
      *                                                                                       CLE073
     C                     MOVE '0'       *IN97                                               CLE073
     C           *IN97     DOWEQ'0'                                                           CLE073
     C           KEYPHS    READELEHISTLA                 97                                   CLE073
      *                                                                                       CLE073
     C           *IN97     IFEQ '1'                                                           CLE073
     C           VDATP     ORGT WEND                                                          CLE073
     C                     Z-ADDWEND      VDATP                                               CLE073
     C                     MOVE '1'       *IN97                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           CLE071    IFEQ 'Y'                                                           CLE071
     C                     Z-ADDVDATP     WKENDD                                              CLE071
     C                     EXSR CALLN1                                                        CLE071
     C                     ELSE                                                               CLE071
      *                                                                                       CLE071
     C                     Z-ADDWSTART    ZZBEG                                               CLE073
     C           VDATP     IFGT WSTART                                                        CLE073
     C                     Z-ADDVDATP     ZZEND                                               CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDWSTART    ZZEND                                               CLE073
     C                     ENDIF                                                              CLE073
     C                     MOVE FECALC    ZZCALC                                              CLE073
     C                     EXSR ZINTDY                                                        CLE073
     C           FECALC    IFEQ 6                                                             CLE073
     C                     Z-ADDINT6DY    NDAYS                                               CLE073
     C                     ELSE                                                               CLE073
     C**********           Z-ADDZZINDY    NDAYS   50                                 CLE073 MD037658
     C                     Z-ADDZZINDY    NDAYS  159                                        MD037658
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           NDAYS     IFGT 0                                                             CLE073
     C                     Z-ADDNDAYS     WDAYS                                               CLE073
     C                     Z-ADDAAMT      WAMT                                                CLE073
     C                     EXSR LONACC                                                        CLE073
     C                     ADD  WTOT      WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C           VDATP     IFGT WSTART                                                        CLE073
     C                     Z-ADDVDATP     WSTART                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Reset amount to accrue - comes from next record on amounts                           CLE073
      ** file.                                                                                CLE073
      *                                                                                       CLE073
     C           *IN97     IFNE '1'                                                           CLE073
     C                     Z-ADDCPAMP     AAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDDO                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Calculation type '98'                                                                CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '98'                                                          CLE073
     C                     Z-ADDOPAMK     WAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           FECALT    IFNE '97'                                                          CLE073
     C           CLE071    IFEQ 'Y'                                                           CLE071
     C           FECALT    ANDEQ'98'                                                          CLE071
     C                     Z-ADDWEND      WKENDD                                              CLE071
     C                     EXSR CALLN1                                                        CLE071
     C                     ELSE                                                               CLE071
     C                     EXSR LONACC                                                        CLE073
     C                     Z-ADDWTOT      WFEE                                                CLE073
     C                     ENDIF                                                              CLE071
     C                     END                                                                CLE073
      *                                                                                       CLE073
     C                     ADD  FEAMTA    WFEE                                                CLE073
     C           FELPDT    IFGT BJRDNB                                                        CLE073
     C                     Z-ADDFEAMTP    WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      *                                                                                       CLE073
      *********************************************************************                   CLE073
     C/TITLE SR/LONACC                                                                        CLE073
      *********************************************************************                   CLE073
      *                                                                   *                   CLE073
      *  LONACC - SUBROUTINE TO CALCULATE ACCRUAL AMOUNT                  *                   CLE073
      *                                                                   *                   CLE073
      *  Called By: CALLON                                                *                   CLE073
      *                                                                   *                   CLE073
      *  Calls:     CONV                                                  *                   CLE073
      *                                                                   *                   CLE073
      *********************************************************************                   CLE073
      *                                                                                       CLE073
     C           LONACC    BEGSR                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADD0         WTOT   150                                          CLE073
      *                                                                                       CLE073
      ** Calculate percentage if required.                                                    CLE073
      *                                                                                       CLE073
     C                     MOVE CCYL      INCCY                                               CLE073
     C                     MOVE FEFCCY    OUTCCY                                              CLE073
     C                     Z-ADDWEAMT     SAVWEE 150                                          CLE073
     C                     Z-ADDWAMT      WEAMT                                               CLE073
      *                                                                                       CLE073
      ** Convert the amount to fee currency, using the fee exchange                           CLE073
      ** rate (if not zero) or using cross exchange rate.                                     CLE073
      *                                                                                       CLE073
     C           FEERAT    IFEQ 0                                                             CLE073
     C                     EXSR CONV                                                          CLE073
     C                     ELSE                                                               CLE073
      *                                                                                       CLE073
      ** Set up currency decimal place power position.                                        CLE073
      *                                                                                       CLE073
     C           CDP       ADD  4         FD                                                  CLE073
      *                                                                                       CLE073
      ** Adjust incoming amount for from CCY decimal places.                                  CLE073
      *                                                                                       CLE073
     C           WEAMT     DIV  POWER,FD  WRK153                                              CLE073
      *                                                                                       CLE073
      ** Exchange rate conversion.                                                            CLE073
      *                                                                                       CLE073
     C           FEMDIN    IFEQ 'M'                                                           CLE073
     C                     MULT FEERAT    WRK153                                              CLE073
     C                     ELSE                                                               CLE073
     C                     DIV  FEERAT    WRK153    H                                         CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Adjust calculated amount for to currency decimal places.                             CLE073
      *                                                                                       CLE073
     C           WRK153    MULT POWER,TD  WEAMT                                               CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDWEAMT     WAMT                                                CLE073
     C                     Z-ADDSAVWEE    WEAMT                                               CLE073
      *                                                                                       CLE073
      ** Retrieve calculation basis                                                           CLE073
      *                                                                                       CLE073
     C                     MOVE '0'       *IN15                                               CLE073
     C           FECALC    LOKUPTABCAL    TABCBS         15                                   CLE073
     C           *IN15     IFEQ '1'                                                           CLE073
     C                     Z-ADDTABCBS    WCBS    50                                          CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           WAMT      IFNE 0                                                             CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C           WAMT      MULT FRT,1     WTOT                                                CLE073
     C                     ENDIF                                                              CLE073
     C**********           MULT WDAYS     WTOT                                       CLE073 MD046351
     C**********           DIV  WCBS      WTOT      H                                CLE073 MD046351
      *                                                                                     MD046351
     C           WTOT      MULT WDAYS     ZWK309                                            MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
     C/COPY WNCPYSRC,LEH00731
      *                                                                                       CLE073
      *****************************************************************                       CER049
      *                                                               *                       CER049
      *  SRSTAX - Generate Stamp tax event type 49ST                  *                       CER049
      *                                                               *                       CER049
      *****************************************************************                       CER049
      *                                                                                       CER049
     C           SRSTAX    BEGSR                                                              CER049
      *                                                                                       CER049
     C           FQTAX     IFEQ 'Y'                                                           CER049
      *                                                                                       CER049
     C           ETYP      IFEQ '71F1'                                                        CER049
     C                     EXSR SVSTAX                                                        CER049
     C                     MOVEL'49ST'    ETYP                                                CER049
     C                     MOVELFQDCST    CUNR                                                CER049
     C                     MOVELFQDCCY    ECCY                                                CER049
     C                     MOVEL'O'       INOI                                                CER049
     C                     MOVE 'N'       IBRE                                                CER049
     C                     MOVE ' '       SIAC                                                CER049
     C                     MOVELFQDCST    PTNU                                                CER049
     C                     MOVELFQDBRC    POBR                                                CER049
     C                     MOVELFQDCCY    PSCY                                                CER049
     C                     EXSR CASTAX                                                        CER049
     C                     EXSR SRCUST                                                        CER049
     C                     MOVELZRATEX    PEXR                                                CER049
     C                     MOVELZMDI1     PEXI                                                CER049
     C                     WRITEOLVENTEL                                                      CER049
      *                                                                                       CER049
     C                     EXSR WAUDIT                                                        CER049
      *                                                                                       CER049
      ** Generate inter branch events                                                         CER049
      *                                                                                       CER049
     C           FEBRCA    IFNE FQDBRC                                                        CER049
     C                     MOVE 'Y'       IBRE                                                CER049
     C                     MOVE 'I'       INOI                                                CER049
     C                     MOVE 'Y'       SIAC                                                CER049
     C                     WRITEOLVENTEL                                                      CER049
     C                     EXSR WAUDIT                                                        CER049
      *                                                                                       CER049
     C                     MOVE A8BICN    CUNR                                                CER049
     C                     MOVE 'O'       INOI                                                CER049
     C                     MOVE ' '       SIAC                                                CER049
     C                     WRITEOLVENTEL                                                      CER049
     C                     EXSR WAUDIT                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     EXSR RESTAX                                                        CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     ENDIF                                                              CER049
     C                     ENDSR                                                              CER049
      *                                                                                       CER049
      *****************************************************************                       CER049
      /EJECT                                                                                  CER049
      *****************************************************************                       CER049
      *                                                               *                       CER049
      *  CASTAX - Calculate Stamp tax amount                          *                       CER049
      *                                                               *                       CER049
      *****************************************************************                       CER049
      *                                                                                       CER049
     C           CASTAX    BEGSR                                                              CER049
      *                                                                                       CER049
     C                     CALL 'SD008141'                                                    CER049
     C                     PARM VDATL     U#DATE  50                                          CER049
     C                     PARM 'FEE'     U#ORGN 10                                           CER049
     C                     PARM LTYP      ##TYPE  4                                           CER049
     C                     PARM           U#CTAX 138                                          CER049
     C                     PARM           U#MTAX 138                                          CER049
     C                     PARM           U#CCCY  3                                           CER049
     C                     PARM           U#MCCY  3                                           CER049
     C                     PARM           U#CSCC  2                                           CER049
     C                     PARM           U#MSCC  2                                           CER049
     C                     PARM           U#TXTY  1                                           CER049
     C                     PARM           SDSTPD                                              CER049
      *                                                                                       CER049
      ** If there is a default for the Module use this tax rate and ccy                       CER049
      ** otherwise use the ICD Control defaults.                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C                     Z-ADDU#MTAX    U#TAXR 138                                          CER049
     C                     ELSE                                                               CER049
     C                     Z-ADDU#CTAX    U#TAXR                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           U#MTAX    IFNE *ZEROS                                                        CER049
     C           PTYP      IFEQ 62                                                            CER049
     C           PTYP      OREQ 63                                                            CER049
     C           PTYP      OREQ 70                                                            CER049
     C                     CALL 'SD008142'                                                    CER049
     C                     PARM *ZEROS    PVALD   60                                          CER049
     C                     PARM *ZEROS    PMATD   60                                          CER049
     C                     PARM           SDSTPD                                              CER049
     C                     PARM           U#TAXR                                              CER049
     C                     PARM *BLANKS   U#PERD  1                                           CER049
     C                     PARM 0         U#TXBR 138                                          CER049
     C                     PARM 0         U#MNTH  70                                          CER049
     C                     PARM           VDATL                                               CER049
     C                     PARM           MDATL                                               CER049
     C                     ENDIF                                                              CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     MOVE EAMT      WSTAX  150                                          CER049
      *                                                                                       CER049
     C           ECCY      IFNE FQDCCY                                                        CER049
      *                                                                                       CER049
      ** Access stamp tax currency for decimal places                                         CER049
      *                                                                                       CER049
     C                     MOVELFQDCCY    ##KC                                                CER049
     C                     EXSR ##CHKC                                                        CER049
     C           ##FIC     IFEQ 'Y'                                                           CER049
     C                     EXSR ##SETC                                                        CER049
     C                     ELSE                                                               CER049
     C           *LOCK     IN   LDA                                                           CER049
     C                     MOVEL'LE0492  'DBPGM                                               CER049
     C                     MOVE 'CURR,Q  'DBFILE                                              CER049
     C                     MOVE ##KC      DBKEY                                               CER049
     C                     Z-ADD22        DBASE                                               CER049
     C                     OUT  LDA                                                           CER049
     C                     EXSR *PSSR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     MOVE CDP       NDP     10                                          CER049
     C                     MOVELA6SPRT    ZRATE1 138                                          CER049
     C                     MOVELA6MDIN    ZMDI1   1                                           CER049
      *                                                                                       CER049
      ** Access event currency for decimal places                                             CER049
      *                                                                                       CER049
     C                     MOVELECCY      ##KC                                                CER049
     C                     EXSR ##CHKC                                                        CER049
     C           ##FIC     IFEQ 'Y'                                                           CER049
     C                     EXSR ##SETC                                                        CER049
     C                     ELSE                                                               CER049
     C           *LOCK     IN   LDA                                                           CER049
     C                     MOVEL'LE0492  'DBPGM                                               CER049
     C                     MOVE 'CURR,Q  'DBFILE                                              CER049
     C                     MOVE ##KC      DBKEY                                               CER049
     C                     Z-ADD21        DBASE                                               CER049
     C                     OUT  LDA                                                           CER049
     C                     EXSR *PSSR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     MOVELA6SPRT    ZRATE2 138                                          CER049
     C                     MOVELA6MDIN    ZMDI2   1                                           CER049
      *                                                                                       CER049
      ** Get exchange rate                                                                    CER049
      *                                                                                       CER049
     C                     EXSR RTZXRT                                                        CER049
      *                                                                                       CER049
     C                     Z-ADDZRATEX    ZEXCH                                               CER049
     C                     MOVE ZMDI1     ZMD                                                 CER049
     C                     Z-ADDWSTAX     ZAMTCI                                              CER049
     C                     Z-ADDA6NBDP    ZCDPI                                               CER049
     C                     Z-ADDNDP       ZCDPO                                               CER049
     C                     EXSR ZCONV                                                         CER049
     C                     Z-ADDZAMTCO    WSTAX                                               CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           WSTAX     MULT U#TAXR    EAMT                                                CER049
      *                                                                                       CER049
     C                     ENDSR                                                              CER049
      *****************************************************************                       CER049
      /EJECT                                                                                  CER049
      *****************************************************************                       CER049
      *                                                               *                       CER049
      *  SRCUST - Get customer/parent information and retail account  *                       CER049
      *                                                               *                       CER049
      *****************************************************************                       CER049
      *                                                                                       CER049
     C           SRCUST    BEGSR                                                              CER049
      *                                                                                       CER049
      ***  Access client master file for customer details                                     CER049
      *                                                                                       CER049
     C                     MOVELFQDCST    CKEY                                                CER049
     C                     CALL 'AOCUSTR0'                                                    CER049
     C                     PARM '*BLANKS' WRTCD                                               CER049
     C                     PARM '*KEY   ' WOPTN                                               CER049
     C                     PARM           CKEY                                                CER049
     C                     PARM           KEYSTS                                              CER049
     C           SDCUST    PARM SDCUST    DSSDY                                               CER049
     C           WRTCD     IFNE *BLANKS                                                       CER049
     C           *LOCK     IN   LDA                                                           CER049
     C                     MOVEL'LE0492  'DBPGM                                               CER049
     C                     MOVE FECNUM    DBKEY                                               CER049
     C                     MOVE 'SDCUSTPD'DBFILE                                              CER049
     C                     Z-ADD35        DBASE                                               CER049
     C                     OUT  LDA                                                           CER049
     C                     EXSR *PSSR                                                         CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C           BBPAIN    IFNE 'P'                                                           CER049
     C                     Z-ADD0         PARI                                                CER049
     C                     ELSE                                                               CER049
     C                     Z-ADD1         PARI                                                CER049
     C                     END                                                                CER049
      *                                                                                       CER049
     C                     MOVELBBCRNM    CRNM                                                CER049
     C                     MOVELBBCRTN    CTWN                                                CER049
     C                     MOVELBBCASC    CASK                                                CER049
      *                                                                                       CER049
      ***  Access parent details                                                              CER049
      *                                                                                       CER049
     C                     MOVELBBPCNB    CPAR                                                CER049
     C           CPAR      IFEQ *BLANKS                                                       CER049
     C           CPAR      OREQ '000000'                                                      CER049
     C                     MOVE *BLANKS   PRNM                                                CER049
     C                     MOVE *BLANKS   PTWN                                                CER049
     C                     MOVE *BLANKS   PASK                                                CER049
     C                     ELSE                                                               CER049
     C                     MOVELCPAR      CKEY                                                CER049
     C                     CALL 'AOCUSTR0'                                                    CER049
     C                     PARM '*BLANKS' WRTCD                                               CER049
     C                     PARM '*KEY   ' WOPTN                                               CER049
     C                     PARM           CKEY                                                CER049
     C                     PARM           KEYSTS                                              CER049
     C           SDCUST    PARM SDCUST    DSSDY                                               CER049
     C           WRTCD     IFNE *BLANKS                                                       CER049
     C           *LOCK     IN   LDA                                                           CER049
     C                     MOVEL'LE0492  'DBPGM                                               CER049
     C                     MOVE FECNUM    DBKEY                                               CER049
     C                     MOVE 'SDCUSTPD'DBFILE                                              CER049
     C                     Z-ADD36        DBASE                                               CER049
     C                     OUT  LDA                                                           CER049
     C                     EXSR *PSSR                                                         CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     MOVELBBCRNM    PRNM                                                CER049
     C                     MOVELBBCRTN    PTWN                                                CER049
     C                     MOVELBBCASC    PASK                                                CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
      ***  Access countries record for region of risk                                         CER049
      *                                                                                       CER049
     C                     MOVE BBCNCZ    CTKEY                                               CER049
      *                                                                                       CER049
     C                     CALL 'AOCTRYR0'                                                    CER049
     C                     PARM '*BLANKS' WRTCD                                               CER049
     C                     PARM '*KEY   ' WOPTN                                               CER049
     C                     PARM           CTKEY                                               CER049
     C           SDCTRY    PARM SDCTRY    DSSDY                                               CER049
     C           WRTCD     IFNE *BLANKS                                                       CER049
     C           *LOCK     IN   LDA                                                           CER049
     C                     MOVEL'LE0492  'DBPGM                                               CER049
     C                     MOVE CTKEY     DBKEY                                               CER049
     C                     MOVE 'SDCTRYPD'DBFILE                                              CER049
     C                     Z-ADD37        DBASE                                               CER049
     C                     OUT  LDA                                                           CER049
     C                     EXSR *PSSR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     MOVELA4RGCD    REGC                                                CER049
     C                     MOVE CLOC      CDOM                                                CER049
      *                                                                                       CER049
     C                     MOVE CDOM      CTKEY                                               CER049
     C                     CALL 'AOCTRYR0'                                                    CER049
     C                     PARM '*BLANKS' WRTCD                                               CER049
     C                     PARM '*KEY   ' WOPTN                                               CER049
     C                     PARM           CTKEY   2                                           CER049
     C           SDCTRY    PARM SDCTRY    DSSDY                                               CER049
     C           WRTCD     IFNE *BLANKS                                                       CER049
     C           *LOCK     IN   LDA                                                           CER049
     C                     MOVEL'LE0492  'DBPGM                                               CER049
     C                     MOVE CTKEY     DBKEY                                               CER049
     C                     MOVE 'SDCTRYPD'DBFILE                                              CER049
     C                     Z-ADD38        DBASE                                               CER049
     C                     OUT  LDA                                                           CER049
     C                     EXSR *PSSR                                                         CER049
     C                     END                                                                CER049
     C                     MOVELA4RGCD    RDOM                                                CER049
      *                                                                                       CER049
      ***  Access accounts detail                                                             CER049
      *                                                                                       CER049
     C                     MOVE FQDCST    @CNUM                                               CER049
     C                     MOVE FQDCCY    @CUCD                                               CER049
     C                     MOVE FQDACD    @ACCD                                               CER049
     C                     MOVE FQDASC    @ACSQ                                               CER049
     C                     MOVE FQDBRC    @BRCA                                               CER049
     C                     CALL 'AOACCTR0'                                                    CER049
     C                     PARM *BLANKS   @RTCD                                               CER049
     C                     PARM '*KEY   ' @OPTN                                               CER049
     C                     PARM *ZEROS    FQRETL 10                                           CER049
     C                     PARM           @CNUM   6                                           CER049
     C                     PARM           @CUCD   3                                           CER049
     C                     PARM           @ACCD  10                                           CER049
     C                     PARM           @ACSQ   2                                           CER049
     C                     PARM           @BRCA   3                                           CER049
     C           SDACCT    PARM SDACCT    DSSDY                                               CER049
      ** If error occured, terminate the program                                              CER049
     C           @RTCD     IFNE *BLANKS                                                       CER049
     C           @RTCD     ANDNE'*NRF   '                                                     CER049
     C           *LOCK     IN   LDA                                                           CER049
     C                     MOVEL'ACCNTAB 'DBFILE                                              CER049
     C                     MOVEL@OPTN     DBKEY                                               CER049
     C                     Z-ADD39        DBASE                                               CER049
     C                     EXSR *PSSR                                                         CER049
     C                     ENDIF                                                              CER049
     C                     MOVE *ZEROS    SETP                                                CER049
     C                     MOVEL*BLANKS   OSAC                                                CER049
     C           ATYP      IFEQ 'R'                                                           CER049
     C                     MOVE 14        SETP                                                CER049
     C                     MOVELACNO      OSAC                                                CER049
     C                     ENDIF                                                              CER049
      *                                                                                       CER049
     C                     ENDSR                                                              CER049
      *****************************************************************                       CER049
      /EJECT                                                                                  CER049
      *****************************************************************                       CER049
      *                                                               *                       CER049
      *  SVSTAX - Save stamp tax information                          *                       CER049
      *                                                               *                       CER049
      *****************************************************************                       CER049
     C           SVSTAX    BEGSR                                                              CER049
     C                     MOVELETYP      SETYP   4                                           CER049
     C                     MOVELCUNR      SCUNR   6                                           CER049
     C                     MOVELECCY      SECCY   3                                           CER049
     C                     MOVELINOI      SINOI   1                                           CER049
     C                     MOVELPTNU      SPTNU   6                                           CER049
     C                     MOVELPARI      SPARI   1                                           CER049
     C                     MOVELPOBR      SPOBR   3                                           CER049
     C                     MOVELPRNM      SPRNM  20                                           CER049
     C                     MOVELPTWN      SPTWN  10                                           CER049
     C                     MOVELPASK      SPASK   8                                           CER049
     C                     MOVELREGC      SREGC   2                                           CER049
     C                     MOVELCDOM      SCDOM   2                                           CER049
     C                     MOVELRDOM      SRDOM   2                                           CER049
     C                     MOVELPSCY      SPSCY   3                                           CER049
     C                     MOVELPEXR      SPEXR  138                                          CER049
     C                     MOVELPEXI      SPEXI   1                                           CER049
     C                     MOVELSETP      SSETP   20                                          CER049
     C                     MOVELOSAC      SOSAC  18                                           CER049
     C                     MOVELEAMT      SEAMT  130                                          CER049
     C                     ENDSR                                                              CER049
      *****************************************************************                       CER049
      /EJECT                                                                                  CER049
      *****************************************************************                       CER049
      *                                                               *                       CER049
      *  RESTAX - Restore stamp tax information                       *                       CER049
      *                                                               *                       CER049
      *****************************************************************                       CER049
     C           RESTAX    BEGSR                                                              CER049
     C                     MOVELSETYP     ETYP                                                CER049
     C                     MOVELSCUNR     CUNR                                                CER049
     C                     MOVELSECCY     ECCY                                                CER049
     C                     MOVELSINOI     INOI                                                CER049
     C                     MOVELSPTNU     PTNU                                                CER049
     C                     MOVELSPARI     PARI                                                CER049
     C                     MOVELSPOBR     POBR                                                CER049
     C                     MOVELSPRNM     PRNM                                                CER049
     C                     MOVELSPTWN     PTWN                                                CER049
     C                     MOVELSPASK     PASK                                                CER049
     C                     MOVELSREGC     REGC                                                CER049
     C                     MOVELSCDOM     CDOM                                                CER049
     C                     MOVELSRDOM     RDOM                                                CER049
     C                     MOVELSPSCY     PSCY                                                CER049
     C                     MOVELSPEXR     PEXR                                                CER049
     C                     MOVELSPEXI     PEXI                                                CER049
     C                     MOVELSSETP     SETP                                                CER049
     C                     MOVELSOSAC     OSAC                                                CER049
     C                     MOVELSEAMT     EAMT                                                CER049
     C                     ENDSR                                                              CER049
      *****************************************************************                       CER049
      /EJECT                                                                                  CER049
      *****************************************************************                       CER049
     C           WAUDIT    BEGSR                                                              CER049
      *                                                                                       CER049
     C           COUNTL    ADD  1         COUNTL                                              CER049
     C                     Z-ADD1         Z                                                   CER049
     C                     Z-ADD2         S                                                   CER049
      *                                                                                       CER049
     C           EAMT      DIV  1000      ZZAMT                                               CER049
     C                     Z-ADDTOTI2     ZZTOTI                                              CER049
     C                     Z-ADDTOTD2     ZZTOTD                                              CER049
     C                     EXSR ZHASH                                                         CER049
     C                     Z-ADDZZTOTI    TOTI2                                               CER049
     C                     Z-ADDZZTOTD    TOTD2                                               CER049
     C                     ENDSR                                                              CER049
      /EJECT                                                                                  CER049
      *****************************************************************                       CER049
      /EJECT                                                                                  CER049
      *****************************************************************                     CLE075AP
      *                                                               *                     CLE075AP
      *  CHKNOS - Check Nostro details in array                       *                     CLE075AP
      *                                                               *                     CLE075AP
      *****************************************************************                     CLE075AP
     C           CHKNOS    BEGSR                                                            CLE075AP
      *                                                                                     CLE075AP
      ** Reinitialize work fields                                                           CLE075AP
      *                                                                                     CLE075AP
     C                     MOVEL*BLANK    NOSIC                                             CLE075AP
     C                     MOVE *OFF      *IN44                                             CLE075AP
     C           KEYNOS    IFNE *BLANKS                                                     CLE075AP
      *                                                                                     CLE075AP
      ** Check previous base rate details if it's                                           CLE075AP
      ** same with current details                                                          CLE075AP
      *                                                                                     CLE075AP
     C                     Z-ADDNOSPRV    F                                                 CLE075AP
      *                                                                                     CLE075AP
      ** Defend against index being 0                                                       CLE075AP
      ** Set current index to starting index                                                CLE075AP
      *                                                                                     CLE075AP
     C           F         IFEQ 0                                                           CLE075AP
     C                     Z-ADDNOSIDX    F                                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
      ** If the KEYNOS being checked is the same then use the index                         CLE075AP
      ** of the current detail rather than doing a LOKUP                                    CLE075AP
      *                                                                                     CLE075AP
     C           KEYNOS    IFEQ #NSK,F                                                      CLE075AP
     C                     MOVE *ON       *IN44                                             CLE075AP
     C                     ELSE                                                             CLE075AP
      *                                                                                     CLE075AP
     C           NOSIDX    IFEQ 0                                                           CLE075AP
     C                     Z-ADD1         F                                                 CLE075AP
     C                     ELSE                                                             CLE075AP
     C                     Z-ADDNOSIDX    F                                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C           KEYNOS    LOKUP#NSK,F                   44                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
      ** Save the last accessed detail to NOSPRV                                            CLE075AP
      ** Set the indicator to show the data was found                                       CLE075AP
      *                                                                                     CLE075AP
     C           *IN44     IFEQ *ON                                                         CLE075AP
     C                     MOVE NOSSEQ    #NOS,F                                            CLE075AP
     C                     Z-ADDF         NOSPRV                                            CLE075AP
     C                     MOVEL'Y'       NOSIC                                             CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C                     ENDIF                                                            CLE075AP
     C                     ENDSR                                                            CLE075AP
     C/EJECT                                                                                CLE075AP
      *****************************************************************                     CLE075AP
      *                                                               *                     CLE075AP
      *  ADDNOS - Add Nostro details to array                         *                     CLE075AP
      *                                                               *                     CLE075AP
      *****************************************************************                     CLE075AP
     C           ADDNOS    BEGSR                                                            CLE075AP
      *                                                                                     CLE075AP
      ** If there is still room in the array then add the details                           CLE075AP
      *                                                                                     CLE075AP
     C           NOSIDX    IFNE 0                                                           CLE075AP
     C                     SUB  1         NOSIDX                                            CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C                     MOVELKEYNOS    #NSK,F                                            CLE075AP
     C                     ADD  NOSSEQ    #NOS,F                                            CLE075AP
      *                                                                                     CLE075AP
      ** Set last accessed detail to NOSPRV So that CHKNOS checks this                      CLE075AP
      ** latest detail first                                                                CLE075AP
      *                                                                                     CLE075AP
     C                     Z-ADDF         NOSPRV                                            CLE075AP
      *                                                                                     CLE075AP
     C                     ENDSR                                                            CLE075AP
     C/EJECT                                                                                CLE075AP
      *****************************************************************                     CLE075AP
      *                                                               *                     CLE075AP
      *  CHKSET - Check Settlement Allocations details in array       *                     CLE075AP
      *                                                               *                     CLE075AP
      *****************************************************************                     CLE075AP
     C           CHKSET    BEGSR                                                            CLE075AP
      *                                                                                     CLE075AP
      ** Reinitialize work fields                                                           CLE075AP
      *                                                                                     CLE075AP
     C                     MOVEL*BLANK    SETIC                                             CLE075AP
     C                     MOVE *OFF      *IN45                                             CLE075AP
     C           KEYSET    IFNE *BLANKS                                                     CLE075AP
      *                                                                                     CLE075AP
      ** Check previous base rate details if it's                                           CLE075AP
      ** same with current details                                                          CLE075AP
      *                                                                                     CLE075AP
     C                     Z-ADDSETPRV    R                                                 CLE075AP
      *                                                                                     CLE075AP
      ** Defend against index being 0                                                       CLE075AP
      ** Set current index to starting index                                                CLE075AP
      *                                                                                     CLE075AP
     C           R         IFEQ 0                                                           CLE075AP
     C                     Z-ADDSETIDX    R                                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
      ** If the KEYSET being checked is the same then use the index                         CLE075AP
      ** of the current detail rather than doing a LOKUP                                    CLE075AP
      *                                                                                     CLE075AP
     C           KEYSET    IFEQ #SEK,R                                                      CLE075AP
     C                     MOVE *ON       *IN45                                             CLE075AP
     C                     ELSE                                                             CLE075AP
      *                                                                                     CLE075AP
     C           SETIDX    IFEQ 0                                                           CLE075AP
     C                     Z-ADD1         R                                                 CLE075AP
     C                     ELSE                                                             CLE075AP
     C                     Z-ADDSETIDX    R                                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C           KEYSET    LOKUP#SEK,R                   45                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
      ** Save the last accessed detail to NOSPRV                                            CLE075AP
      ** Set the indicator to show the data was found                                       CLE075AP
      *                                                                                     CLE075AP
     C           *IN45     IFEQ *ON                                                         CLE075AP
     C                     MOVE SETSEQ    #SET,R                                            CLE075AP
     C                     Z-ADDR         SETPRV                                            CLE075AP
     C                     MOVEL'Y'       SETIC                                             CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C                     ENDIF                                                            CLE075AP
     C                     ENDSR                                                            CLE075AP
     C/EJECT                                                                                CLE075AP
      *****************************************************************                     CLE075AP
      *                                                               *                     CLE075AP
      *  ADDSET - Add Settlements Allocations details to array        *                     CLE075AP
      *                                                               *                     CLE075AP
      *****************************************************************                     CLE075AP
     C           ADDSET    BEGSR                                                            CLE075AP
      *                                                                                     CLE075AP
      ** If there is still room in the array then add the details                           CLE075AP
      *                                                                                     CLE075AP
     C           SETIDX    IFNE 0                                                           CLE075AP
     C                     SUB  1         SETIDX                                            CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C                     MOVELKEYSET    #SEK,R                                            CLE075AP
     C                     ADD  SETSEQ    #SET,R                                            CLE075AP
      *                                                                                     CLE075AP
      ** Set last accessed detail to SETPRV So that CHKSET checks this                      CLE075AP
      ** latest detail first                                                                CLE075AP
      *                                                                                     CLE075AP
     C                     Z-ADDR         SETPRV                                            CLE075AP
      *                                                                                     CLE075AP
     C                     ENDSR                                                            CLE075AP
     C/EJECT                                                                                CLE075AP
      *****************************************************************                     CLE075AP
      *                                                               *                     CLE075AP
      *  CHKSA2 - Check Settlement Allocations (AOSTALR2)             *                     CLE075AP
      *                                                               *                     CLE075AP
      *****************************************************************                     CLE075AP
     C           CHKSA2    BEGSR                                                            CLE075AP
      *                                                                                     CLE075AP
      ** Reinitialize work fields                                                           CLE075AP
      *                                                                                     CLE075AP
     C                     MOVEL*BLANK    SA2IC                                             CLE075AP
     C                     MOVE *OFF      *IN46                                             CLE075AP
     C           KEYSA2    IFNE *BLANKS                                                     CLE075AP
      *                                                                                     CLE075AP
      ** Check previous base rate details if it's                                           CLE075AP
      ** same with current details                                                          CLE075AP
      *                                                                                     CLE075AP
     C                     Z-ADDSA2PRV    J                                                 CLE075AP
      *                                                                                     CLE075AP
      ** Defend against index being 0                                                       CLE075AP
      ** Set current index to starting index                                                CLE075AP
      *                                                                                     CLE075AP
     C           J         IFEQ 0                                                           CLE075AP
     C                     Z-ADDSA2IDX    J                                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
      ** If the KEYSET being checked is the same then use the index                         CLE075AP
      ** of the current detail rather than doing a LOKUP                                    CLE075AP
      *                                                                                     CLE075AP
     C           KEYSA2    IFEQ #SAK,J                                                      CLE075AP
     C                     MOVE *ON       *IN46                                             CLE075AP
     C                     ELSE                                                             CLE075AP
      *                                                                                     CLE075AP
     C           SA2IDX    IFEQ 0                                                           CLE075AP
     C                     Z-ADD1         J                                                 CLE075AP
     C                     ELSE                                                             CLE075AP
     C                     Z-ADDSA2IDX    J                                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C           KEYSA2    LOKUP#SAK,J                   46                                 CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
      ** Save the last accessed detail to SA2PRV                                            CLE075AP
      ** Set the indicator to show the data was found                                       CLE075AP
      *                                                                                     CLE075AP
     C           *IN46     IFEQ *ON                                                         CLE075AP
     C                     MOVE SA2SEQ    #SA2,J                                            CLE075AP
     C                     Z-ADDQ         SA2PRV                                            CLE075AP
     C                     MOVEL'Y'       SA2IC                                             CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C                     ENDIF                                                            CLE075AP
     C                     ENDSR                                                            CLE075AP
     C/EJECT                                                                                CLE075AP
      *****************************************************************                     CLE075AP
      *                                                               *                     CLE075AP
      *  ADDSA2 - Add Settlements Allocations (AOSTALR2)              *                     CLE075AP
      *                                                               *                     CLE075AP
      *****************************************************************                     CLE075AP
     C           ADDSA2    BEGSR                                                            CLE075AP
      *                                                                                     CLE075AP
      ** If there is still room in the array then add the details                           CLE075AP
      *                                                                                     CLE075AP
     C           SA2IDX    IFNE 0                                                           CLE075AP
     C                     SUB  1         SA2IDX                                            CLE075AP
     C                     ENDIF                                                            CLE075AP
      *                                                                                     CLE075AP
     C                     MOVELKEYSA2    #SAK,J                                            CLE075AP
     C                     ADD  SA2SEQ    #SA2,J                                            CLE075AP
      *                                                                                     CLE075AP
      ** Set last accessed detail to SA2PRV So that CHKSA2 checks this                      CLE075AP
      ** latest detail first                                                                CLE075AP
      *                                                                                     CLE075AP
     C                     Z-ADDJ         SA2PRV                                            CLE075AP
      *                                                                                     CLE075AP
     C                     ENDSR                                                            CLE075AP
     C/EJECT                                                                                CLE075AP
      *                                                                                     CLE075AP
      *****************************************************************                     MD048400
      *                                                               *                     MD048400
      *  SRFAMU - Check facility amount utilisation flag for Y and Z  *                     MD048400
      *                                                               *                     MD048400
      *****************************************************************                     MD048400
     C           SRFAMU    BEGSR                                                            MD048400
     C                     MOVELLTYP      LONTYP  1                                         MD048400
      *                                                                                     MD048400
      ** Interest PDCL                                                                      MD048400
      *                                                                                     MD048400
     C           LONTYP    IFEQ 'Y'                                                         MD048400
     C                     MOVEL'D'       WRECI                                             MD048400
     C                     MOVELLNRF      WPLON                                             MD048400
     C                     MOVEL'I'       WPDCT                                             MD048400
     C           KEYPDI    CHAINLEPDUEL6             88                                     MD048400
     C           *IN88     IFEQ *OFF                                                        MD048400
     C                     MOVELYPFAMU    PROCFL                                            MD048400
     C                     ENDIF                                                            MD048400
     C                     ENDIF                                                            MD048400
      *                                                                                     MD048400
      ** Fee PDCL                                                                           MD048400
      *                                                                                     MD048400
     C           LONTYP    IFEQ 'Z'                                                         MD048400
     C                     MOVEL'D'       WRECI                                             MD048400
     C                     MOVELLNRF      WPLON                                             MD048400
     C           KEYPDF    CHAINLEPDUFLA             88                                     MD048400
     C           *IN88     IFEQ *OFF                                                        MD048400
     C                     MOVELYPFAMU    PROCFL                                            MD048400
     C                     ENDIF                                                            MD048400
     C                     ENDIF                                                            MD048400
      *                                                                                     MD048400
     C                     ENDSR                                                            MD048400
     C/EJECT                                                                                MD048400
      *                                                                                     MD048400
      ********************************************************************                    CLE071
      * CALFE1 - Subroutine to Calculate the Facility Fee                *                    CLE071
      *                                                                  *                    CLE071
      * CALLED FROM: CALFEE                                              *                    CLE071
      *                                                                  *                    CLE071
      * CALLS: ZINTDY, CALCSR                                            *                    CLE071
      *                                                                  *                    CLE071
      ********************************************************************                    CLE071
     C           CALFE1    BEGSR                                                              CLE071
      *                                                                                       CLE071
     C           KEY011    SETGTLEFERCL3                                                      CLE071
     C           KEY012    REDPELEFERCL3                 17                                   CLE071
      *                                                                                       CLE071
     C                     MOVELFCAM      WFEM                                                CLE071
     C                     MOVELFCRT      WFRT                                                CLE071
     C                     MOVELFCPIND    WKPIND                                              CLE071
     C           KEY012    READELEFERCL3                 04                                   CLE071
      *                                                                                       CLE071
     C           *IN04     DOWEQ*OFF                                                          CLE071
     C           FCRCVD    ANDLTWKENDD                                                        CLE071
      *                                                                                       CLE071
     C                     MOVELWSTART    ZZBEG                                               CLE071
     C                     MOVELFCRCVD    ZZEND                                               CLE071
     C                     MOVELFECALC    ZZCALC                                              CLE071
     C                     EXSR ZINTDY                                                        CLE071
      *                                                                                       CLE071
     C           FECALC    IFEQ 6                                                             CLE071
     C                     Z-ADDINT6DY    NDAYS                                               CLE071
     C                     ELSE                                                               CLE071
     C                     Z-ADDZZINDY    NDAYS                                               CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C           NDAYS     IFGT 0                                                             CLE071
     C                     EXSR CALCSR                                                        CLE071
     C                     MOVELFCRCVD    WSTART                                              CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     MOVELFCAM      WFEM                                                CLE071
     C                     MOVELFCRT      WFRT                                                CLE071
     C                     MOVELFCPIND    WKPIND                                              CLE071
     C           KEY012    READELEFERCL3                 04                                   CLE071
      *                                                                                       CLE071
     C                     ENDDO                                                              CLE071
      *                                                                                       CLE071
     C           WSTART    IFLT WKENDD                                                        CLE071
      *                                                                                       CLE071
     C                     MOVELWSTART    ZZBEG                                               CLE071
     C                     MOVELWKENDD    ZZEND                                               CLE071
     C                     MOVELFECALC    ZZCALC                                              CLE071
     C                     EXSR ZINTDY                                                        CLE071
      *                                                                                       CLE071
     C           FECALC    IFEQ 6                                                             CLE071
     C                     Z-ADDINT6DY    NDAYS                                               CLE071
     C                     ELSE                                                               CLE071
     C                     Z-ADDZZINDY    NDAYS                                               CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C           NDAYS     IFGT 0                                                             CLE071
     C                     EXSR CALCSR                                                        CLE071
     C                     MOVELWKENDD    WSTART                                              CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ENDSR                                                              CLE071
      ********************************************************************                    CLE071
      * CALFE2 - Subroutine to Calculate the Facility Fee                *                    CLE071
      *                                                                  *                    CLE071
      * CALLED FROM: CALFEE                                              *                    CLE071
      *                                                                  *                    CLE071
      * CALLS: ZINTDY, CALCSR, ACCRUE                                    *                    CLE071
      *                                                                  *                    CLE071
      ********************************************************************                    CLE071
     C           CALFE2    BEGSR                                                              CLE071
      *                                                                                       CLE071
      ** Retrieve the last rate before payment date                                           CLE071
      *                                                                                       CLE071
     C                     MOVELSVENDT    WSTART                                              CL1071
      *                                                                                       CLE071
     C           KEY011    SETGTLEFERCL3                                                      CLE071
     C           KEY012    REDPELEFERCL3                 17                                   CLE071
      *                                                                                       CLE071
     C           *IN17     IFEQ *OFF                                                          CLE071
     C           FCRCVD    ANDLTSVENDT                                                        CLE071
     C                     MOVELFCPIND    WKPIND                                              CLE071
     C                     MOVELFCAM      WFEM                                                CLE071
     C                     MOVELFCRT      WFRT                                                CLE071
     C                     ELSE                                                               CLE071
     C                     MOVELFEPIND    WKPIND                                              CLE071
     C                     MOVELFEEM      WFEM                                                CLE071
     C                     MOVELFRT       WFRT                                                CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     EXSR ACCRUE                                                        CLE071
     C                     ADD  WTOT      WFEE                                                CLE071
      *                                                                                       CLE071
     C                     ENDSR                                                              CLE071
      ********************************************************************                    CLE071
      * CALLN1 - Subroutine to Calculate Loan Fee                        *                    CLE071
      *                                                                  *                    CLE071
      * CALLED FROM: CALLON                                              *                    CLE071
      *                                                                  *                    CLE071
      * CALLS: ZINTDY, LONACC                                            *                    CLE071
      *                                                                  *                    CLE071
      ********************************************************************                    CLE071
     C           CALLN1    BEGSR                                                              CLE071
      *                                                                                       CLE071
      ** Save rates and amounts from LEFEED to working arrays.                                CLE071
      *                                                                                       CLE071
     C                     Z-ADDFEEM      WFEM                                                CLE071
     C                     Z-ADDFRT       WFRT                                                CLE071
      *                                                                                       CLE071
     C           KEY011    SETGTLEFERCL3                                                      CLE071
     C           KEY012    REDPELEFERCL3                 17                                   CLE071
      *                                                                                       CLE071
      ** Move rates and amounts from historical file to FEEM & FRT                            CLE071
      *                                                                                       CLE071
     C                     MOVELFCAM      FEEM                                                CLE071
     C                     MOVELFCRT      FRT                                                 CLE071
     C           KEY012    READELEFERCL3                 04                                   CLE071
      *                                                                                       CLE071
     C           *IN04     DOWEQ*OFF                                                          CLE071
     C           FCRCVD    ANDLTWKENDD                                                        CLE071
      *                                                                                       CLE071
     C                     MOVELWSTART    ZZBEG                                               CLE071
     C                     MOVELFCRCVD    ZZEND                                               CLE071
     C                     MOVELFECALC    ZZCALC                                              CLE071
     C                     EXSR ZINTDY                                                        CLE071
      *                                                                                       CLE071
     C           FECALC    IFEQ 6                                                             CLE071
     C                     Z-ADDINT6DY    NDAYS                                               CLE071
     C                     ELSE                                                               CLE071
     C                     Z-ADDZZINDY    NDAYS                                               CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C           NDAYS     IFGT 0                                                             CLE071
     C                     EXSR LONACC                                                        CLE071
     C                     ADD  WTOT      WFEE                                                CLE071
     C                     MOVELFCRCVD    WSTART                                              CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     MOVELFCAM      FEEM                                                CLE071
     C                     MOVELFCRT      FRT                                                 CLE071
     C           KEY012    READELEFERCL3                 04                                   CLE071
      *                                                                                       CLE071
     C                     ENDDO                                                              CLE071
      *                                                                                       CLE071
     C           WSTART    IFLT WKENDD                                                        CLE071
      *                                                                                       CLE071
     C                     MOVELWSTART    ZZBEG                                               CLE071
     C                     MOVELWKENDD    ZZEND                                               CLE071
     C                     MOVELFECALC    ZZCALC                                              CLE071
     C                     EXSR ZINTDY                                                        CLE071
      *                                                                                       CLE071
     C           FECALC    IFEQ 6                                                             CLE071
     C                     Z-ADDINT6DY    NDAYS                                               CLE071
     C                     ELSE                                                               CLE071
     C                     Z-ADDZZINDY    NDAYS                                               CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C           NDAYS     IFGT 0                                                             CLE071
     C                     EXSR LONACC                                                        CLE071
     C                     ADD  WTOT      WFEE                                                CLE071
     C                     MOVELWKENDD    WSTART                                              CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
     C                     ENDIF                                                              CLE071
      *                                                                                       CLE071
      ** Move rates and amounts from working arrays back to FEEM & FRT                        CLE071
      *                                                                                       CLE071
     C                     Z-ADDWFEM      FEEM                                                CLE071
     C                     Z-ADDWFRT      FRT                                                 CLE071
      *                                                                                       CLE071
     C                     ENDSR                                                              CLE071
      ********************************************************************                    CLE071
      *                                                                                     MD052216
      *  CHKPAY - Check Payment Taken Day Indicator                                         MD052216
      *                                                                                     MD052216
      *  CALLED FROM: CALFEE, CALLON                                                        MD052216
      *                                                                                     MD052216
      *  CALLS: CCYLOC                                                                      MD052216
      *                                                                                     MD052216
      *****************************************************************                     MD052216
     C           CHKPAY    BEGSR                                                            MD052216
      *                                                                                     MD052216
     C                     Z-ADDPAYDAT    ZDAYNO                                            MD052216
     C                     Z-ADDPAYDAT    ZDYNBR                                            MD052216
     C                     Z-ADD*ZEROS    ZNRDYS                                            MD052216
     C                     EXSR CCYLOC                                                      MD052216
      *                                                                                     MD052216
     C           CLE141    IFEQ 'Y'                                                         MD052216
     C           FELOAN    ANDNE*BLANKS                                                     MD052216
      *                                                                                     MD052216
     C                     MOVELZCCY      CCYLL                                             MD052216
     C                     MOVELZLOC      LOCLL                                             MD052216
     C                     MOVEL'A'       WCLRT                                             MD054101
     C           KLOAN     CHAINCLOAN                95                                     MD054101
     C           FQPTDI    IFEQ *BLANK                                                      MD052216
     C                     MOVEL'M'       PAYIND                                            MD052216
     C                     ELSE                                                             MD052216
     C                     MOVELFQPTDI    PAYIND                                            MD052216
     C                     ENDIF                                                            MD052216
     C                     CALL 'LEZBDYCD'BDCHK                                             MD052216
     C                     MOVELZADJDT    ZDYNBR                                            MD052216
      *                                                                                     MD052216
     C                     ELSE                                                             MD052216
     C                     SELEC                                                            MD052216
      *                                                                                     MD052216
     C           FQPTDI    WHEQ 'P'                                                         MD052216
     C                     EXSR ZBKDT                                                       MD052216
      *                                                                                     MD052216
     C           FQPTDI    WHEQ 'N'                                                         MD052216
     C                     EXSR ZFWDT                                                       MD052216
      *                                                                                     MD052216
     C           FQPTDI    WHEQ 'M'                                                         MD052216
     C           FQPTDI    OREQ *BLANK                                                      MD052216
     C                     EXSR ZDATE2                                                      MD052216
     C           *IN98     IFEQ *OFF                                                        MD052216
     C                     MOVE ZDATE     MMYY    40P                                       MD052216
     C                     MOVELMMYY      MMNLCD  20P                                       MD052216
     C                     ELSE                                                             MD052216
     C                     MOVELZDATE     MMNLCD    P                                       MD052216
     C                     ENDIF                                                            MD052216
     C                     Z-ADDZDAYNO    @DAYNO  50                                        MD052216
     C                     EXSR ZFWDT                                                       MD052216
     C                     Z-ADDZDYNBR    ZDAYNO                                            MD052216
     C                     EXSR ZDATE2                                                      MD052216
     C           *IN98     IFEQ *OFF                                                        MD052216
     C                     MOVE ZDATE     MMYY      P                                       MD052216
     C                     MOVELMMYY      MMNWKD  20P                                       MD052216
     C                     ELSE                                                             MD052216
     C                     MOVELZDATE     MMNWKD    P                                       MD052216
     C                     ENDIF                                                            MD052216
     C           MMNLCD    IFNE MMNWKD                                                      MD052216
     C                     Z-ADD@DAYNO    ZDAYNO                                            MD052216
     C                     EXSR ZBKDT                                                       MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C                     ENDSL                                                            MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C                     Z-ADDZDYNBR    PAYDT1  50                                        MD052216
      *                                                                                     MD052216
     C                     ENDSR                                                            MD052216
      *****************************************************************                     MD052216
      /EJECT                                                                                MD052216
      *****************************************************************                     MD052216
      *                                                                                     MD052216
      *  CCYLOC - Set currency & location depending on settlement type                      MD052216
      *                                                                                     MD052216
      *  CALLED FROM: CHKPAY                                                                MD052216
      *                                                                                     MD052216
      *  CALLS:                                                                             MD052216
      *                                                                                     MD052216
      *****************************************************************                     MD052216
     C           CCYLOC    BEGSR                                                            MD052216
      *                                                                                     MD052216
      ** If Fee Settlement type is '01', '02', '07', '08' or '12',                          MD052216
      ** use Fee Currency and Nostro location                                               MD052216
      *                                                                                     MD052216
     C           FESTTL    IFEQ 01                                                          MD052216
     C           FESTTL    OREQ 02                                                          MD052216
     C           FESTTL    OREQ 07                                                          MD052216
     C           FESTTL    OREQ 08                                                          MD052216
     C           FESTTL    OREQ 12                                                          MD052216
      *                                                                                     MD052216
     C                     MOVELFEFCCY    WKEYB                                             MD053873
      *                                                                                     MD053873
     C           CLE031    IFEQ 'Y'                                                         MD053873
      *                                                                                     MD053873
     C           PTFI      IFEQ *BLANKS                                                     MD053873
     C           FESCCY    ANDNE*BLANKS                                                     MD053873
     C                     MOVELFESCCY    WKEYB                                             MD053873
     C                     ENDIF                                                            MD053873
      *                                                                                     MD053873
     C           PTFI      IFNE *BLANKS                                                     MD053873
     C           FEPSCY    ANDNE*BLANKS                                                     MD053873
     C                     MOVELFEPSCY    WKEYB                                             MD053873
     C                     ENDIF                                                            MD053873
      *                                                                                     MD053873
     C                     ENDIF                                                            MD053873
      *                                                                                     MD053873
     C                     MOVELFEOURS    WKOURS  2                                         MD052216
     C**********           MOVELFEFCCY    KEYNOS                                   MD052216 MD053873
     C                     MOVELWKEYB     KEYNOS                                            MD053873
     C                     MOVE WKOURS    KEYNOS                                            MD052216
     C                     ADD  1         NOSSEQ                                            MD052216
     C                     EXSR CHKNOS                                                      MD052216
      *                                                                                     MD052216
      ** Use details from array if KEYNOS is found, otherwise,                              MD052216
      ** retrieve details from program call                                                 MD052216
      *                                                                                     MD052216
     C           NOSIC     IFEQ 'Y'                                                         MD052216
      *                                                                                     MD052216
      ** Set occurence to index found from #NSK array                                       MD052216
      *                                                                                     MD052216
     C           F         OCUR SDNOST                                                      MD052216
     C                     MOVE CSNM      DSCSNM                                            MD052216
      *                                                                                     MD052216
     C                     ELSE                                                             MD052216
      *                                                                                     MD052216
     C           NOSIDX    IFNE 0                                                           MD052216
     C                     Z-ADDNOSIDX    F                                                 MD052216
     C                     ELSE                                                             MD052216
     C                     Z-ADD1         F                                                 MD052216
     C                     MOVEA#NOS      #NSS                                              MD052216
     C                     SORTA#NSS                                                        MD052216
     C                     Z-ADD#NSS,1    NOSKEY                                            MD052216
     C           NOSKEY    LOKUP#NOS,F                   44                                 MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C           F         OCUR SDNOST                                                      MD052216
      *                                                                                     MD052216
     C                     CALL 'AONOSTR0'                                                  MD052216
     C                     PARM '*MSG   ' WRTCD                                             MD052216
     C                     PARM '*KEY   ' WOPTN                                             MD052216
     C                     PARM *BLANKS   WKEYA                                             MD052216
     C**********           PARM FEFCCY    WKEYB                                    MD052216 MD053873
     C                     PARM           WKEYB                                             MD053873
     C                     PARM *BLANKS   WKEYC                                             MD052216
     C                     PARM *BLANKS   WKEYD                                             MD052216
     C                     PARM FEOURS    WKEYE                                             MD052216
     C                     PARM *BLANKS   WBRCD                                             MD052216
     C                     PARM *BLANKS   CSSN                                              MD052216
     C                     PARM *BLANKS   PNOI                                              MD052216
     C           SDNOST    PARM SDNOST    DSFDY                                             MD052216
      *                                                                                     MD052216
     C           WRTCD     IFEQ *BLANKS                                                     MD052216
      *                                                                                     MD052216
      ** Move the last 3 characters of customer short code (which                           MD052216
      ** is the location code) to start location code field                                 MD052216
      *                                                                                     MD052216
     C                     MOVE CSNM      DSCSNM                                            MD052216
     C                     EXSR ADDNOS                                                      MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C**********           MOVELFEFCCY    ZCCY                                     MD052216 MD053873
     C                     MOVELWKEYB     ZCCY                                              MD053873
     C                     MOVE NRLC      ZLOC                                              MD052216
      *                                                                                     MD052216
     C                     ELSE                                                             MD052216
      *                                                                                     MD052216
      ** For other settlement types, use Local Currency & Location                          MD052216
      *                                                                                     MD052216
     C                     MOVE BJLCCY    ZCCY                                              MD052216
     C                     MOVE BJSLCD    ZLOC                                              MD052216
      *                                                                                     MD052216
     C                     ENDIF                                                            MD052216
      *                                                                                     MD052216
     C                     ENDSR                                                            MD052216
      *****************************************************************                     MD052216
      /TITLE SR/ZFWDT
     C/COPY ZSRSRC,ZFWDT
      /TITLE SR/ZACCH
     C/COPY ZSRSRC,ZACCH
      /TITLE SR/ZCONV
     C/COPY ZSRSRC,ZCONVZ1
      /TITLE SR/ZXRATEZ1
     C/COPY ZSRSRC,ZXRATEZ1
      /TITLE SR/ZHASH
     C/COPY ZSRSRC,ZHASHZ3
     C/COPY WNCPYSRC,LE0492CCP3                                           S01408
      /TITLE SR/ZINTDY                                                    CLE013
     C/COPY ZSRSRC,ZINTDYZ2                                               CLE013
      /TITLE SR/ZDATE9                                                    CLE013
     C/COPY ZSRSRC,ZDATE9Z3                                               CLE013
      /TITLE SR/ZDAT10                                                    CLE013
     C/COPY ZSRSRC,ZDAT10Z2                                               CLE013
      /TITLE SR/ZFREQB                                                                        CAS009
     C/COPY ZSRSRC,ZFREQBZ2                                                                   CAS009
      /TITLE SR/ZCHKH                                                                         CAS009
     C/COPY ZSRSRC,ZCHKH                                                                      CAS009
      /TITLE SR/ZDATE1                                                                        CAS009
     C/COPY ZSRSRC,ZDATE1Z2                                                                   CAS009
      /TITLE SR/ZDATE2                                                                        CAS009
     C/COPY ZSRSRC,ZDATE2Z2                                                                   CAS009
      /EJECT                                                                                  CER049
     C/COPY ZSRSRC,RTZXRTC1                                                                   CER049
     C/COPY ZSRSRC,ZFRQB3                                                                     CLE141
     C/COPY ZSRSRC,ZBKDT                                                                    MD052216
     O/TITLE
      *
      ***  Update of new bills/telexes flag on LEFEED
     OLEFEEDF E                XLEF
     O                         FESPTI
     O                         FEPPTI
     O                         FEEPTI
     O                         FESBTI
     O                         FEPBTI
     O                         FEEBTI
      ***  Update of new bills/telexes flag on LEFEED - Loan Fees           0068
     OLEFEED2 E                XLEFL                                        0068
     O                         FESPTI                                       0068
     O                         FEPPTI                                       0068
     O                         FEEPTI                                       0068
     O                         FESBTI                                       0068
     O                         FEPBTI                                       0068
     O                         FEEBTI                                       0068
      /EJECT
      ***
**  CPY@
(c) Finastra International Limited 2001
**  TABVAL - TABLE OF VALID EVENT TYPES AFFECTING FCLTY EXPOSURE
V1V3R1M1
**   TABCAL/TABCBS - CALCULATION BASES.
136500236000336000436500536000636600
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN    CLE013
00366007310109601461                                                      CLE013
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR       CLE013
00000000310005900090001200015100181002120024300273003040033400365         CLE013
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH                                                     CAS009
312831303130313130313031                                                                      CAS009
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                                          CAS009
0366073110961461                                                                              CAS009
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                                            CAS009
000031059090120151181212243273304334365                                                       CAS009
**   ZMNM - MONTHS SHORT NAMES                                                                CAS009
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC                                                          CAS009
**   SVAL  -  SYSTEM VALUES ARRAY                                                             CLE033
Settlement09Customer                                                                          CLE033
Settlement09AccCode                                                                           CLE033
Settlement09Postings                                                                          218782
