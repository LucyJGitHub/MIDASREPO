     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Facility amendments processing')              *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE0496 - Facility Amendments Processing                      *
      *                                                               *
      *  Function:  This program processes the facility amendments    *
      *  (COB)      to be actioned.                                   *
      *             All Facility Amendments transactions whose value  *
      *             date falls on or before the event control date    *
      *             should be actioned and dropped from the Facility  *
      *             Amendments file. It also does the following:      *
      *                                                               *
      *             (1) Update the facility with the action required: *
      *                 i.e. increase/decrease in the facility amount,*
      *                 change of revolving credit indicator or       *
      *                 reactivation of facility;                     *
      *             (2) Create a new record in HISACT file, including *
      *                 the new 'FR' action type;                     *
      *                 for tivation of facility;                     *
      *             (3) Whenever the facility utilisation is updated  *
      *                 for a tranche, then the credit agreement      *
      *                 utilisation will be updated as well.          *
      *                                                               *
      *                                                               *
      *  Called By: LEC0609D - Facility Amendments Processing         *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD035945           Date 11Feb20               *
      *                 AR674226           Date 04Dec19               *
      *                 MD046248           Date 27Oct17               *
      *                 MD041443           Date 19Sep16               *
      *                 CLE148             Date 23Jul12               *
      *                 AR787620           Date 10Jun11               *
      *                 CLE064             Date 06Dec10               *
      *                 AR679409           Date 17Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 255336             Date 24Jul08               *
      *                 246191             Date 06Mar07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 223967             Date 06Jun06               *
      *                 228002             Date 26May06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG8222            Date 23Sep05               *
      *                 CLE042             Date 06Sep05               *
      *                 CLE106             Date 22Feb05               *
      *                 225591             Date 08Jul04               *
      *                 CSW037A            Date 02May05               *
      *                 CLE041             Date 11Oct04               *
      *                 CSD025             Date 11Jan05               *
      *                 BUG5224            Date 16Dec04               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CLE029             Date 04Sep02               *
      *                 CAP073             Date 08Aug02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP068             Date 25Jun02               *
      *                 CAP071             Date 19Mar02               *
      *                 CLE023             Date 19Nov01               *
      *                 200289             Date 19Nov01               *
      *                 193603             Date 31Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CLE014             Date 20Mar01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 187779             Date 15Jan01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 172697             Date 02Mar00               *
      *                 CLE009             Date 11May99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 159961             Date 29Apr99               *
      *                 159212             Date 26Apr99               *
      *                 159496             Date 22Apr99               *
      *                 156297             Date 08Mar99               *
      *                 154584             Date 03Mar99               *
      *                 153787             Date 03Mar99               *
      *                 144712             Date 03Mar99               *
      *                 128980             Date 03Mar99               *
      *                 127738             Date 11Dec97               *
      *                 127721             Date 24Nov97               *
      *                 127714             Date 18Nov97               *
      *                 CLE005 *CREATE     Date 22May97               *
      *                                    Date ddmmmyy               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *           (Recompile)                                         *
      *  MD035945 - Do not update trailer file for closed facility,   *
      *             to be consistent to LE0491 trailer update.        *
      *           - Applied for MD055026.                             *
      *  AR674226 - Manual transaction reached 999. Increase the size *
      *             of utilisation sequence no. and transaction       *
      *             sequence. Recompile. (Child: AR674227)            *
      *           - Applied for MD054782.                             *
      *  MD046248 - Finastra Rebranding                               *
      *  MD041443 - CBC022001 failed due to invalid character in file *
      *             text description (Recompile)                      *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,LEH00336                                 *
      *             WNCPYSRC,LEH00337                                 *
      *             WNCPYSRC,LEH00338                                 *
      *             WNCPYSRC,LEH00339                                 *
      *             WNCPYSRC,LEH00340                                 *
      *             WNCPYSRC,LEH00341                                 *
      *             WNCPYSRC,LEH00342                                 *
      *             WNCPYSRC,LEH00343                                 *
      *             WNCPYSRC,LEH00344                                 *
      *             WNCPYSRC,LEH00345                                 *
      *  CLE064 - Enhancement of Lending Frequencies (Recompile)      *
      *  AR679409 - Recalculate percentage shares of facility         *
      *             participants when there is FI/FD event            *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus                                          *
      *  255336 - Check amendment type 'FR' if expiry date is less    *
      *           than or equal to rundate to correctly expire the    *
      *           facility. Applied fix 196508.                       *
      *  246191 - Display the amount for reactivated facilities       *
      *  223967 - Facility amount not updated when amendments are     *
      *           processed.  Add processing for EMXT4F1 file.        *
      *           Apply fix 215864.                                   *
      *  228002 - Rework from value date when zero FAMT is increased  *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG8222- If event date is earlier than take-on date, use     *
      *           take-on date instead. This is only for facilities   *
      *           existing prior to M+.                               *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CLE106 - Syndication Manager                                 *
      *  225591 - Facility history changes for repayments due to      *
      *           rollover (recompile)                                *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CLE041 - Collateralised Lending Phase 2B                     *
      *  CSD025 - Customer De-Activation                              *
      *  BUG5224 - LE3180P1 reported a facility imbalance error       *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CLE029 - Addition of Severity code and Limit ID to FCLTYFM   *
      *  CAP073 - Conversion of MN inputs into modular structure to   *
      *           use as APIs. Facility input Transaction Details     *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *           (Recompile)                                         *
      *  CAP068 - Recompiled for changes to FCLTYFM and FCLTYFN.      *
      *  CAP071 - Conversion of LE inputs into modular structure to   *
      *           use as APIs. (Recompile)                            *
      *  CLE023 - Lending Facility History Improvements.              *
      *  200289 - Increase Facility sequence number from 2 to 3.      *
      *  193603 - FooB caused by FAMT's going negative.  Various      *
      *           FOOB problems caused by facility reactivation.      *
      *  CLE014 - Customer Driven Lending Enhancements                *
      *  187779 - For RC's, ensure the field RVCD is updated.         *
      *  172697 - For FR's, place current amount drawn in OAM array.  *
      *           (if no loans, OAM had kept old facility amount).    *
      *  CLE009 - LE I/C Swift Message Generation for Fees (Recompile)*
      *  159961 - For RC's, write sequence -2 to HISACT               *
      *           so that LER032 handles them correctly.              *
      *  159212 - For FR's write sequence 96 to HISACT, and process   *
      *           zero amount like any other positive amount.         *
      *  159496 - For FI's and FD's, write sequence 97 to HISACT      *
      *           so that LER032 handles them correctly.              *
      *  156297 - Update AVLD with NDTEX for facility reactivation    *
      *           only if facility is not amended today.              *
      *  154584 - Wrong value moved to revolving credit indicator in  *
      *           HISACT.                                             *
      *  153787 - Update Last Availability Date for reactivated fclty.*
      *  144712 - Change revolving to non-revolving, changes history  *
      *           Remove remaining codes of 127721                    *
      *  128980 - Facility amendments should only apply for the       *
      *           Tranche that they are entered against.              *
      *  127738 - Reactivate FCLTYFN record as well                   *
      *  127721 - Update Facility History Header File                 *
      *  127714 - Update trailer file                                 *
      *  CLE005 - Customer Lending Enhancements - Others (T3)         *
      *                                                               *
      *****************************************************************
     FHISACTL2IF  E           K        DISK         KINFSR *PSSR
     F            HISACTF                           KRENAMEHISACIF
     FFCUPDL0 IF  E           K        DISK         KINFSR *PSSR          154584
     F            FCLTYFMF                          KRENAMEFCUPDM         154584
     FLEFCAML1UF  E           K        DISK         KINFSR *PSSR
     FFACACT  UF  E           K        DISK         KINFSR *PSSR A
     FFCLTY   UF  E           K        DISK         KINFSR *PSSR
     FLEFCAMZZUF  E                    DISK         KINFSR *PSSR
     FLEAGACPDUF  E           K        DISK         KINFSR *PSSR A    UC                      CLE041
     FLETRAGL0IF  E           K        DISK         KINFSR *PSSR                              CLE041
     F***FACHISH*UF  E           K        DISK         KINFSR *PSSR127721 144712
     FFACHISH UF  E           K        DISK         KINFSR *PSSR                              CLE023
     FLEFNPRL0UF  E           K        DISK         KINFSR *PSSR                              CLE106
     FEMXT4F1LUF  E           K        DISK         KINFSR *PSSR                              223967
      * Exposure facilities file                                                              223967
      *                                                                                       223967
     FLEFCLTLDIF  E           K        DISK         KINFSR *PSSR                            AR679409
     F            FCLTYFMF                          KRENAMEFCLTYD                           AR679409
      * Participant facilities file                                                         AR679409
      *                                                                                     AR679409
     FHISACT  O   E                    DISK         KINFSR *PSSR
     F/COPY WNCPYSRC,LEH00574
     FLE0496AUO   E                    PRINTER
     F                                              KINFDS SPOOLU
     FLE0496P1O   E                    PRINTER                        UC
     F                                              KINFDS SPOOL1
      *****************************************************************
      *                                                               *
      *  F U N C T I O N   O F   I N D I C A T O R S                  *
      *                                                               *
      *   18  - Chain to LEFNPRL0                                     *                       CLE106
      *   37  - Multibranching ON                                     *
      *   80  - Chain to LEFCAML1                                     *
      *   81  - Chain to FCLTY                                        *
      *   82  - Chain to FACACT                                       *
      *   83  - Chain to LEFCAMZZ                                     *
      *   84  - Read to HISACTL2                                      *
      *   85  - Chain to FACHISH                                      *                       CLE023
      *   30  - Facility Increase                                     *
      *   31  - Facility Decrease                                     *
      *   32  - Revolving Credit Change                               *
      *   33  - Revovling Credit Change --> from Y to N               *
      *   34  -                             from N to Y               *
      *   35  - Facility Reactivation                                 *
      *   98  - Date Format: DDMMYY (off); MMDDYY (on)                *
      * 90-99 - Used by Standard Subroutines                          *
      * U7+U8 - Database Error                                        *
      *                                                               *
      *****************************************************************
      /SPACE 3
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  SRINIT - Program Initialisation                              *
      *  SRDETL - Detail Processing                                   *
      *  SRACTN - History Action Processing                           *
      *  SRFCLT - Facility Update Processing                          *
      ***SRFHUP*-*Facility*History*Header*Update*Processing********127721 144712
      ***SRCAUP*-*Credit*Agreement*Update*Processing*******************   128980
      *  SRNBDP - Get the currency's number of decimal places         *
      *  SRTRAL - File Trailer Processing                             *
      *  SRDTLR - Detail Report Processing                            *
      *  SRIFLD - Reinitialise report fields                          *
      *  SRENDP - Output audit report and end program.                *
      *  WP1REC - Write a detail record to the report                 *
      *  WP1END - Write End of Report                                 *
      *  RCFP1  - RCF Processing for P1 Report                        *
      *  RCFAU  - RCF Processing for Audit Report                     *
      *  ZDATE2 - Convert Midas Day Number into Date (DDMMYY/MMDDYY)  *
      *  ZFRPED - Format an Amount                                    *
      *  GLZADD - Adds an amount (ZZAMT) to the total (ZZTOTI,ZZTOTD) *
      *  GLZSUM - Carries out the addition of the amounts             *
      *  SRDROP - Drop Participant's non Pro-Rata Facility events     *                       CLE106
      *  *PSSR  - Program Error Processing Subroutine                 *
      *                                                               *
      *****************************************************************
     E/EJECT
     E                    CPY@    1   1 80
      ** Copyright statement array.
      *
     E                    POWER   1   7  7 3             CCY CONVERSIONS
      ** Power array used for currency conversion.
      *
     E/COPY ZSRSRC,ZDATE2Z1
     E/COPY ZSRSRC,ZFRPEDZ1
      *
      /SPACE 3
      *
      ** Rename fields to avoid override.
      *
     ILEFCAMPF
     I              RECI                            ARECI
     I              BRCA                            ABRCA
     I              CNUM                            ACNUM
     I              FACT                            AFACT
     I              FCNO                            AFCNO
     I              VLDT                            AVLDT
     I              ACCY                            AACCY
     I              AAMT                            AAAMT
     I              RVCR                            ARVCR
     I              FATP                            AFATP
     I              NDEX                            ANDEX
     I              IUSR                            AIUSR
     I              AUSR                            AAUSR
     I              XUSR                            AXUSR
     I              ORED                            AORED
     I              CHTP                            ACHTP
     I              PCRF                            APCRF
     I              PCOB                            APCOB
     I/COPY WNCPYSRC,LEH00336
     ILEFCAMZF
     I              RECI                            ZRECI
     IHISACIF
     I              BRCA                            HABRCA
     IFACACTF
     I              BRCA                            FCBRCA
     IFCLTYFNF
     I              RECI                            FRECI
     I/COPY WNCPYSRC,LEH00337
     IFCLTYFMF
     I              RECI                            FRECI
     I              BRCA                            FBRCA
     I              ORED                            FMORED                                   BUG8222
     I              PMFC                            FPMFC                                   AR679409
     I              PMFT                            FPMFT                                   AR679409
     I              PMFN                            FPMFN                                   AR679409
     IFCLTYD                                                                                AR679409
     I              CNUM                            #CNUM                                   AR679409
     I              FACT                            #FACT                                   AR679409
     I              FCNO                            #FCNO                                   AR679409
     I              FCCY                            #FCCY                                   AR679409
     I              TRCA                            #TRCA                                   AR679409
     I              AVLD                            #AVLD                                   AR679409
     I              FAMT                            #FAMT                                   AR679409
      *                                                                                       CLE106
      ** Rename fields in LEFNPRL0 file                                                       CLE106
      *                                                                                       CLE106
     ILEFNPRP0                                                                                CLE106
     I              BRCA                            FNBRCA                                    CLE106
     I              CNUM                            FNCNUM                                    CLE106
     I              FACT                            FNFACT                                    CLE106
     I              FCNO                            FNFCNO                                    CLE106
     I              PRTR                            FNPRTR                                    CLE106
     I              NSHT                            FNNSHT                                    CLE106
     I              NSHP                            FNNSHP                                    CLE106
     I              NSHA                            FNNSHA                                    CLE106
     I              PRNT                            FNPRNT                                    CLE106
     IEMXT4F1F                                                                                223967
     I              RECI                            MRECI                                     223967
      *
     ILDA       E DSLDA                         256
      ** Local data area for database error details
      ** *LOCK IN LDA immediately before and OUT LDA immediately
      ** after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
      *
     IRUNDAT    E DSRUNDAT
      ** Data Area for getting the rundate.
      *
     IPSDS       SDS
      ** Program Status Data Structure
      *
     I                                     *PROGRAM PGM
     I                                      244 253 WSID
     I                                      254 263 USER
     ISPOOL1      DS
      ** File Information Data Structure for LE0496P1.
      *
     I                                        9   9 OPEN1
     I                                       83  92 SFILE1
     I                                    B 123 1240SFNUM1
     I                                    B 188 1890OFLLN1
     I                                    B 367 3680PRTLN1
     ISPOOLU      DS
      ** File Information Data Structure for LE0496AU.
      *
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
     IDSFCLT      DS
     I**********                              1   60ACNUM                                     CSD027
     I                                        1   6 ACNUM                                     CSD027
     I                                        7   90AFACT
     I                                       10  110AFCNO
     I                                       12  12 WRCTP
     IDSFCA       DS
     I**********                              1   60CANM                                      CSD027
     I                                        1   6 CANM                                      CSD027
     I                                        7   90CAFT
     I                                       10  110CAFN
     I                                       12  12 WCRCT
     IDSFC2       DS
     I                                        1   6 RCNUM
     I                                        7   9 RFACT
     I                                       10  11 RFCNO
     I                                       12  12 WHRCT
     I            DS
     I                                        1   30WFACT
     I                                        4   50WFCNO
     I                                        1   50HAFCTY
      *
     ISDBANK    E DSSDBANKPD
      ** Bank Details
      *
     ISCSARD    E DSSCSARDPD                                              CLE014
      ** External data structures for access objects                      CLE014
      *                                                                   CLE014
     ISDGELR    E DSSDGELRPD
      ** General Ledger Details
      *
     ISDCUST    E DSSDCUSTPD
      ** Customer Details
      *
     ISDCURR    E DSSDCURRPD
      ** Currency Details
      *
     ISDBRCH    E DSSDBRCHPD
      ** Branch Details
     I              QQDFAC                          DFACBK                                    CGL029
      *
     ILERSTS    E DSLERSTS                                                                   BUG8222
     I              FACHISD                         TONDAT                                   BUG8222
     I              LERC2030                        RENAM1                                   BUG8222
     I              LERC135                         RENAM2                                   BUG8222
     I              LERC315                         RENAM3                                   BUG8222
     I              LERC425                         RENAM4                                   BUG8222
     I              EOYFLAG                         RENAM5                                   BUG8222
     IDSFDY     E DSDSFDY
      ** Short data structure for access objects
      *
     IDSSDY     E DSDSSDY
      ** Long data structure for access objects
      *
     IMMOD       UDS                            256                                           223967
      ** Midas Modules                                                                        223967
      *                                                                                       223967
     I                                        7   7 EMFLG                                     223967
      *                                                                                       223967
     I/COPY ZSRSRC,ZFRPEDZ2
     C/TITLE Main Processing
      *
      *================================================================
      *  P R O G R A M   S T A R T                                    *
      *================================================================
      *
      ** Initialisation.
      *
     C                     EXSR SRINIT
      *
      ** Detail Processing.
      *
     C                     READ LEFCAML1                 80
     C           *IN80     DOWEQ'0'
     C                     EXSR SRDETL
     C                     READ LEFCAML1                 80
     C                     ENDDO
      *
      ** File Trailer Processing followed by Report generation then
      ** final processing.
      *
     C           *INU7     IFEQ '0'
     C                     EXSR SRTRAL
     C                     EXSR SRDTLR
     C                     EXSR SRENDP
     C                     ENDIF
      *
      *================================================================
      *  P R O G R A M   E N D                                        *
      *================================================================
      *
     C/EJECT
     C/TITLE SR/SRINIT
      *****************************************************************
      *                                                               *
      *  SRINIT - Program Initialisation                              *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:                                                       *
      *  AOBANKR0 Access Program                                      *
      *  AOGELRR0 Access Program                                      *
      *                                                               *
      *****************************************************************
      *
     C           SRINIT    BEGSR                           *** SRINIT ***
      *
      ** Set up copyright parameter
      *
     C                     MOVEACPY@      CPY2@  80
      *
      ** Access RUNDAT for multibranching indicator.
      *
     C           *NAMVAR   DEFN           LDA
     C                     IN   RUNDAT
     C           AGMBIN    IFEQ 'Y'
     C                     SETON                     37
     C                     END
      *                                                                                      BUG8222
      ** Define LERSTS                                                                       BUG8222
      *                                                                                      BUG8222
     C           *NAMVAR   DEFN           LERSTS                                             BUG8222
     C                     IN   LERSTS                                                       BUG8222
      *
      ** Initialise LDA field.
      *
     C           *NAMVAR   DEFN           RUNDAT
     C           *LOCK     IN   LDA
     C***********          MOVEL'LE0496'  DBPGM                           127721
     C                     MOVEL'LE0496  'DBPGM                           127721
     C                     OUT  LDA
      *
      ** Call Access Program for Bank Details - Title, Run Date
      *
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' WRTCD   7
     C                     PARM '*FIRST ' WOPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE 'SDBANKPD'DBFILE           ***************
     C                     Z-ADD001       DBASE            * DB ERROR 01 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Check System Date Format, DDMMYY (*IN98 off)
      **                           MMDDYY (*IN98 on).
      *
     C           BJDFIN    IFEQ 'M'
     C                     SETON                     98
     C                     ENDIF
      *                                                                   CLE014
      ** Determine if CLE014 is installed                                 CLE014
      *                                                                   CLE014
     C                     CALL 'AOSARDR0'                                CLE014
     C                     PARM '       ' PRTCD   7                       CLE014
     C                     PARM '*VERIFY' POPTN   7                       CLE014
     C                     PARM 'CLE014'  PSARD   6                       CLE014
     C           SCSARD    PARM SCSARD    DSSDY                           CLE014
      *                                                                   CLE014
      ** Handle Database Error                                            CLE014
      *                                                                   CLE014
     C           PRTCD     IFNE *BLANKS                                   CLE014
     C           PRTCD     ANDNE'*NRF   '                                 CLE014
     C           *LOCK     IN   LDA                                       CLE014
     C                     MOVE 'SCSARDPD'DBFILE                          CLE014
     C                     MOVEL'CLE014'  DBKEY            *************  CLE014
     C                     Z-ADD016       DBASE            * DBERR 016 *  CLE014
     C                     MOVEL'LE0496'  DBPGM            *************  CLE014
     C                     OUT  LDA                                       CLE014
     C                     EXSR *PSSR                                     CLE014
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
      ** CLE014 is installed                                              CLE014
      *                                                                   CLE014
     C           PRTCD     IFEQ *BLANKS                                   CLE014
     C                     MOVE 'Y'       CLE014  1                       CLE014
     C                     ELSE                                           CLE014
     C                     MOVE 'N'       CLE014                          CLE014
     C                     ENDIF                                          CLE014
      *                                                                                       CLE023
      ** Determine if CLE023 is installed                                                     CLE023
      *                                                                                       CLE023
     C                     CALL 'AOSARDR0'                                                    CLE023
     C                     PARM '       ' PRTCD   7                                           CLE023
     C                     PARM '*VERIFY' POPTN   7                                           CLE023
     C                     PARM 'CLE023'  PSARD   6                                           CLE023
     C           SCSARD    PARM SCSARD    DSSDY                                               CLE023
      *                                                                                       CLE023
      ** Handle Database Error                                                                CLE023
      *                                                                                       CLE023
     C           PRTCD     IFNE *BLANKS                                                       CLE023
     C           PRTCD     ANDNE'*NRF   '                                                     CLE023
     C           *LOCK     IN   LDA                                                           CLE023
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE023
     C                     MOVEL'CLE023'  DBKEY                                               CLE023
     C                     Z-ADD017       DBASE                                               CLE023
     C                     MOVEL'LE0496'  DBPGM                                               CLE023
     C                     OUT  LDA                                                           CLE023
     C                     EXSR *PSSR                                                         CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** CLE023 is installed                                                                  CLE023
      *                                                                                       CLE023
     C           PRTCD     IFEQ *BLANKS                                                       CLE023
     C                     MOVE 'Y'       CLE023  1                                           CLE023
     C                     ELSE                                                               CLE023
     C                     MOVE 'N'       CLE023                                              CLE023
     C                     ENDIF                                                              CLE023
     C/COPY WNCPYSRC,LEH00575
      *                                                                                       CLE041
      ** Determine if CLE025 is installed                                                     CLE041
      *                                                                                       CLE041
     C                     CALL 'AOSARDR0'                                                    CLE041
     C                     PARM '       ' PRTCD                                               CLE041
     C                     PARM '*VERIFY' POPTN                                               CLE041
     C                     PARM 'CLE025'  PSARD                                               CLE041
     C           SCSARD    PARM SCSARD    DSSDY                                               CLE041
      *                                                                                       CLE041
      ** Handle Database Error                                                                CLE041
      *                                                                                       CLE041
     C           PRTCD     IFNE *BLANKS                                                       CLE041
     C           PRTCD     ANDNE'*NRF   '                                                     CLE041
     C           *LOCK     IN   LDA                                                           CLE041
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE041
     C                     MOVEL'CLE025'  DBKEY                                               CLE041
     C                     Z-ADD018       DBASE                                               CLE041
     C                     MOVEL'LE0496'  DBPGM                                               CLE041
     C                     OUT  LDA                                                           CLE041
     C                     EXSR *PSSR                                                         CLE041
     C                     ENDIF                                                              CLE041
      *                                                                                       CLE041
      ** CLE025 is installed                                                                  CLE041
      *                                                                                       CLE041
     C           PRTCD     IFEQ *BLANKS                                                       CLE041
     C                     MOVE 'Y'       CLE025  1                                           CLE041
     C                     OPEN LEAGACPD                                                      CLE041
     C                     ELSE                                                               CLE041
     C                     MOVE 'N'       CLE025                                              CLE041
     C                     ENDIF                                                              CLE041
      *                                                                                       CLE106
      ** Determine if CLE106 is installed                                                     CLE106
      *                                                                                       CLE106
     C                     CALL 'AOSARDR0'                                                    CLE106
     C                     PARM '       ' PRTCD   7                                           CLE106
     C                     PARM '*VERIFY' POPTN   7                                           CLE106
     C                     PARM 'CLE106'  PSARD   6                                           CLE106
     C           SCSARD    PARM SCSARD    DSSDY                                               CLE106
      *                                                                                       CLE106
      ** Handle Database Error                                                                CLE106
      *                                                                                       CLE106
     C           PRTCD     IFNE *BLANKS                                                       CLE106
     C           PRTCD     ANDNE'*NRF   '                                                     CLE106
     C           *LOCK     IN   LDA                                                           CLE106
     C                     MOVE 'SCSARDPD'DBFILE                                              CLE106
     C                     MOVEL'CLE106'  DBKEY                                               CLE106
     C                     Z-ADD018       DBASE                                               CLE106
     C                     MOVEL'LE0496'  DBPGM                                               CLE106
     C                     OUT  LDA                                                           CLE106
     C                     EXSR *PSSR                                                         CLE106
     C                     ENDIF                                                              CLE106
      *                                                                                       CLE106
      ** CLE106 is installed                                                                  CLE106
      *                                                                                       CLE106
     C           PRTCD     IFEQ *BLANKS                                                       CLE106
     C                     MOVE 'Y'       CLE106  1                                           CLE106
     C                     ELSE                                                               CLE106
     C                     MOVE 'N'       CLE106                                              CLE106
     C                     ENDIF                                                              CLE106
      *                                                                                       CER020
      ** Access SAR Details file to check whether CER020 feature                              CER020
      ** is installed                                                                         CER020
      *                                                                                       CER020
     C                     CALL 'AOSARDR0'                                                    CER020
     C                     PARM *BLANKS   PRTCD                                               CER020
     C                     PARM '*VERIFY' POPTN                                               CER020
     C                     PARM 'CER020'  PSARD                                               CER020
     C           SCSARD    PARM SCSARD    DSFDY                                               CER020
      *                                                                                       CER020
      ** Handle Database Error                                                                CER020
      *                                                                                       CER020
     C           PRTCD     IFNE *BLANKS                                                       CER020
     C           PRTCD     ANDNE'*NRF'                                                        CER020
     C           *LOCK     IN   LDA                                                           CER020
     C                     MOVE 'SCSARDPD'DBFILE                                              CER020
     C                     MOVEL'CER020'  DBKEY                                               CER020
     C                     Z-ADD019       DBASE                                               CER020
     C                     MOVEL'LE0496'  DBPGM                                               CER020
     C                     OUT  LDA                                                           CER020
     C                     EXSR *PSSR                                                         CER020
     C                     ENDIF                                                              CER020
      *                                                                                       CER020
     C           PRTCD     IFEQ *BLANKS                                                       CER020
     C                     MOVE 'Y'       CER020  1                                           CER020
     C                     ELSE                                                               CER020
     C                     MOVE 'N'       CER020                                              CER020
     C                     ENDIF                                                              CER020
     C/COPY WNCPYSRC,LEH00338
      *
      ** Access General Ledger details.
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM '*MSG   ' WRTCD
     C                     PARM '*FIRST ' WOPTN
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE 'SDGELRPD'DBFILE           ***************
     C                     Z-ADD002       DBASE            * DB ERROR 02 *
     C                     OUT  LDA                        ***************
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Set up event control date.
      *
     C                     Z-ADDBJDNWD    WECD    50
     C                     SUB  1         WECD
     C           BKAPDT    IFLT WECD
     C                     Z-ADDBKAPDT    WECD
     C                     ENDIF
      *
      ** RCF Processing for Audit File.
      *
     C                     EXSR RCFAU
      *
      ** Trailer and Report work fields.
      *
     C                     Z-ADD0         RDROP
     C                     Z-ADD0         RNTRL
     C                     Z-ADD0         RVTRL
     C                     Z-ADD0         RNADD
      *
     C                     Z-ADD0         WCNTR   50
     C                     Z-ADD0         RQDLN1  30
     C                     Z-ADD0         DIFLN1  30
      *
     C                     Z-ADD0         WROUT   50
     C                     Z-ADD0         WRDRP   50
     C                     Z-ADD0         WRNUM   50
     C                     Z-ADD0         WRAMT  130
     C                     Z-ADD0         WCDBS   30
     C**********           Z-ADD0         WCSNO   60                                   154584 CSD027
     C                     MOVE *BLANKS   WCSNO   6                                           CSD027
     C                     Z-ADD0         WFCTY   50                      154584
      *
     C           KEYFCL    KLIST
     C                     KFLD           ACNUM
     C                     KFLD           AFACT
     C                     KFLD           AFCNO
     C                     KFLD           WRCTP
      *
     C           KEYFC2    KLIST
     C                     KFLD           HACNUM
     C                     KFLD           WFACT
     C                     KFLD           WFCNO
     C                     KFLD           WHRCT
      *
     C           KEYFCA    KLIST
     C                     KFLD           CANM
     C                     KFLD           CAFT
     C                     KFLD           CAFN
     C                     KFLD           WCRCT
      *
     C           KEYACT    KLIST
     C                     KFLD           BRCA
     C                     KFLD           HACNUM
     C                     KFLD           HAFCTY
      *                                                                   154584
     C           WFCUP     KLIST                                          154584
     C                     KFLD           ACNUM                           154584
     C                     KFLD           AFACT                           154584
     C                     KFLD           AFCNO                           154584
      *************************************************************127721 144712
     C***********KFACH     KLIST                                   127721 144712
     C***********          KFLD           WCNUM                    127721 144712
     C***********          KFLD           WFCTH   30               127721 144712
     C***********          KFLD           WFCNH   20               127721 144712
      *************************************************************127721 144712
     C           KFCZZ     KLIST                                          127714
     C**********           KFLD           WCNUM   60                                   127714 CSD027
     C                     KFLD           WCNUM   6                                           CSD027
     C                     KFLD           WFCTZ   30                      127714
     C                     KFLD           WFCNZ   20                      127714
     C                     KFLD           WRCTP                           127714
      *
     C           KFACH     KLIST                                                              CLE023
     C                     KFLD           ACNUM                                               CLE023
     C                     KFLD           AFACT                                               CLE023
     C                     KFLD           AFCNO                                               CLE023
     C/COPY WNCPYSRC,LEH00576
      *                                                                                     AR679409
     C           KYFCLS    KLIST                                                            AR679409
     C                     KFLD           FPMFC                                             AR679409
     C                     KFLD           FPMFT                                             AR679409
     C                     KFLD           FPMFN                                             AR679409
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRDETL
      *****************************************************************
      *                                                               *
      *  SRDETL - Detail Processing                                   *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls:                                                       *
      *  SRACTN - History Action Processing                           *
      *  SRFCLT - Facility Update Processing                          *
      ***SRCAUP*-*Credit*Agreement*Update*Processing*******************   128980
      *                                                               *
      *****************************************************************
      *
     C           SRDETL    BEGSR                           *** SRDETL ***
      *
      ** If record is reversed, just delete it physically
      *
     C           ARECI     IFEQ 'R'
     C/COPY WNCPYSRC,LEH00577
     C                     DELETLEFCAMPF
      *                                                                                       CLE106
      ** If Syndication Manager on, drop Participant non Pro-Rata recs                        CLE106
     C           CLE106    IFEQ 'Y'                                                           CLE106
     C           NPRT      ANDEQ'Y'                                                           CLE106
     C                     EXSR SRDROP                                                        CLE106
     C                     ENDIF                                                              CLE106
      *                                                                                       CLE106
     C                     ELSE
      *
      ** Retrieve the facility details used on the facility amendments.
      ** Perform database error if facility does not exist.
      *
     C                     MOVE 'A'       WRCTP   1
     C           KEYFCL    CHAINFCLTY                81
      *
     C           *IN81     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTYFM 'DBFILE           ***************
     C                     Z-ADD003       DBASE            * DB ERROR 03 *
     C                     MOVELDSFCLT    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
      *                                                                                     AR679409
      ** Check if Credit Agreement Participant                                              AR679409
      *                                                                                     AR679409
     C                     MOVE 'N'       WCAPRT  1                                         AR679409
     C           *BLANKS   IFNE FPMFC                                                       AR679409
     C           *ZERO     ANDNEFPMFT                                                       AR679409
     C           *ZERO     ANDNEFPMFN                                                       AR679409
     C           CLE106    ANDEQ'Y'                                                         AR679409
      *                                                                                     AR679409
     C           KYFCLS    CHAINLEFCLTLD             81                                     AR679409
      *                                                                                     AR679409
     C           *IN81     IFEQ *OFF                                                        AR679409
     C                     MOVE 'Y'       WCAPRT                                            AR679409
     C                     ENDIF                                                            AR679409
      *                                                                                     AR679409
     C                     ENDIF                                                            AR679409
      *
      ** Facility exists.
      *
     C           ARECI     IFNE 'R'
     C           AVLDT     ANDLEWECD
      *
     C                     SELEC
     C           AFATP     WHEQ 'FI'
     C                     MOVE 'FI'      HAACTN
     C           AFATP     WHEQ 'FD'
     C                     MOVE 'FD'      HAACTN
     C           AFATP     WHEQ 'RC'
     C                     MOVE 'RC'      HAACTN
     C           AFATP     WHEQ 'FR'
     C                     MOVE 'FR'      HAACTN
     C/COPY WNCPYSRC,LEH00339
     C                     ENDSL
      *
      ** Do History Action and Facility Update processings.
      *
     C                     EXSR SRACTN
     C                     EXSR SRFCLT
     C***********          EXSR SRFHUP                             127721 144712
      ***********                                                         128980
      ***Tranche/Credit*Agreement*is*'TR'*and*Amendment*type*is*******    128980
      ***either*'FI'*or*'FD'.*****************************************    128980
      ***********                                                         128980
     C***********TRCA      IFEQ 'TR'                                      128980
     C***********AFATP     IFEQ 'FI'                                      128980
     C***********AFATP     OREQ 'FD'                                      128980
     C***********          EXSR SRCAUP                                    128980
     C***********          EXSR SRFHUP                             127721 128980
     C***********          ENDIF                                          128980
     C***********          ENDIF                                          128980
      *
      ** For live facility, add 1 to the number of facility amendments
      ** dropped and delete the facility amendment. Otherwise, add 1 to
      ** the number of facility amendments referring to deleted
      ** facilities and accumulate the Amendment Amounts.
      *
     C/COPY WNCPYSRC,LEH00578
     C                     ADD  1         WRDRP
     C                     DELETLEFCAMPF
      *                                                                                       CLE106
      ** If Syndication Manager on, drop Participant non Pro-Rata recs                        CLE106
     C           CLE106    IFEQ 'Y'                                                           CLE106
     C           NPRT      ANDEQ'Y'                                                           CLE106
     C                     EXSR SRDROP                                                        CLE106
     C                     ENDIF                                                              CLE106
      *
     C                     ELSE
     C                     ADD  1         WRNUM
     C                     ADD  AAAMT     WRAMT
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRACTN
      *****************************************************************
      *                                                               *
      *  SRACTN - History Action Processing                           *
      *                                                               *
      *  Called By: SRDETL                                            *
      *  Calls: None                                                  *
      *                                                               *
      *****************************************************************
      *
     C           SRACTN    BEGSR                           *** SRACTN ***
      *                                                                                       CLE041
      ** Credit Lines is installed, update aggregate facilities in                            CLE041
      ** LEAGACPD file                                                                        CLE041
      *                                                                                       CLE041
     C           CLE025    IFEQ 'Y'                                                           CLE041
     C           TRCA      IFEQ 'TR'                                                          CLE041
     C           AFATP     ANDEQ'RC'                                                          CLE041
     C                     EXSR SRAGFC                                                        CLE041
     C                     ENDIF                                                              CLE041
     C                     ENDIF                                                              CLE041
      *
      ** Move values to History Actions fields.
      *
     C                     MOVE ABRCA     BRCA
     C                     SELEC                                          159496
     C           HAACTN    WHEQ 'FI'                                      159496
     C           HAACTN    OREQ 'FD'                                      159496
     C                     Z-ADD97        HASEQ                           159496
     C                     Z-ADD97        HATSEQ                                              200289
     C           HAACTN    WHEQ 'FR'                                      159212
     C                     Z-ADD96        HASEQ                           159212
     C                     Z-ADD96        HATSEQ                                              200289
     C           HAACTN    WHEQ 'RC'                                      159961
     C                     Z-ADD-2        HASEQ                           159961
     C                     Z-ADD-2        HATSEQ                                              200289
     C                     OTHER                                          159496
     C                     Z-ADD0         HASEQ
     C                     Z-ADD0         HATSEQ                                              200289
     C                     ENDSL                                          159496
     C**********           Z-ADDACNUM     HACNUM                                              CSD027
     C                     MOVE ACNUM     HACNUM                                              CSD027
     C           AFACT     MULT 100       HAFCTY
     C                     ADD  AFCNO     HAFCTY
     C                     Z-ADDAVLDT     HADATE
      *                                                                                      BUG8222
     C           HADATE    IFLT TONDAT                                                       BUG8222
     C           FMORED    ANDLTTONDAT                                                       BUG8222
     C                     Z-ADDTONDAT    HADATE                                             BUG8222
     C                     ENDIF                                                             BUG8222
      *                                                                                      BUG8222
     C                     Z-ADDAAAMT     HAAAMT
      *                                                                   144712
     C           HACNUM    IFNE WCSNO                                     154584
     C           HAFCTY    ORNE WFCTY                                     154584
     C           WFCUP     CHAINFCUPDL0              36                   154584
     C           *IN36     IFEQ '0'                                       154584
     C                     MOVE FRVCR     HARCIN                          154584
     C**********           Z-ADDHACNUM    WCSNO                                        154584 CSD027
     C                     MOVE HACNUM    WCSNO                                               CSD027
     C                     Z-ADDHAFCTY    WFCTY                           154584
     C                     ENDIF                                          154584
     C                     ENDIF                                          154584
      *                                                                   154584
     C           AFATP     IFEQ 'RC'                                      144712
     C                     MOVE ARVCR     HARCIN                          144712
     C                     ENDIF                                          144712
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     MOVE RVCR      HAOLRC                          CLE014
     C                     ENDIF                                          CLE014
      *
      ** Increment the number of records output then write a record
      ** to the History Actions file.
      *
     C                     ADD  1         WROUT
     C/COPY WNCPYSRC,LEH00340
     C                     WRITEHISACTF
      *
      ** Update Facilities with Actions File if existing. Otherwise
      ** write a new record in the file.
      *
     C           KEYACT    CHAINFACACT               82
     C           *IN82     IFEQ '0'
     C           HADATE    IFLE FCDATE
     C                     MOVE HADATE    FCDATE
     C                     UPDATFACACTF
     C                     ENDIF
     C                     ELSE
     C                     MOVE BRCA      FCBRCA
     C                     MOVE HACNUM    FCCNUM
     C                     MOVE HAFCTY    FCFCTY
     C                     MOVE HADATE    FCDATE
     C                     WRITEFACACTF
     C                     ENDIF
      *
     C           CLE023    IFEQ 'Y'                                                           CLE023
     C           FCDATE    ANDLTBJRDNB                                                        CLE023
     C           CLE023    OREQ 'Y'                                                          BUG5224
     C           HAACTN    ANDEQ'FI'                                                         BUG5224
     C           FAMT      ANDEQ0                                                            BUG5224
     C           KFACH     CHAINFACHISHF             85                                       CLE023
      *                                                                                       CLE023
     C           *IN85     IFEQ '0'                                                           CLE023
     C                     MOVEL'Y'       FHRWKR                                              CLE023
      *                                                                                       CLE023
     C           FHRWDT    IFEQ 0                                                             CLE023
     C           FHRWDT    ORGT FCDATE                                                        CLE023
      *                    Z-ADDFCDATE    FHRWDT                                              CLE023
     C                     ENDIF                                                              CLE023
     C                     MOVEL'B'       FHRWTP                                              CLE023
     C                     UPDATFACHISHF                                                      CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
     C                     ENDSR
      *                                                                                       CLE041
      *****************************************************************                       CLE041
      /TITLE SR/SRAGFC                                                                        CLE041
      *****************************************************************                       CLE041
      *                                                               *                       CLE041
      *  SRAGFC - Update Aggregate Facility File                      *                       CLE041
      *                                                               *                       CLE041
      *  Called By: SRACTN                                            *                       CLE041
      *  Calls: None                                                  *                       CLE041
      *                                                               *                       CLE041
      *****************************************************************                       CLE041
      *                                                                                       CLE041
     C           SRAGFC    BEGSR                           *** SRAGFC ***                     CLE041
      *                                                                                       CLE041
     C           KTRFC     KLIST                                                              CLE041
     C                     KFLD           ACNUM                                               CLE041
     C                     KFLD           AFACT                                               CLE041
     C                     KFLD           AFCNO                                               CLE041
      *                                                                                       CLE041
     C           KAGAC     KLIST                                                              CLE041
     C                     KFLD           AGAGBR                                              CLE041
     C                     KFLD           AGAGNM                                              CLE041
     C                     KFLD           WFACTY                                              CLE041
      *                                                                                       CLE041
     C           KTRFC     SETLLLETRAGL0                                                      CLE041
     C                     READ LETRAGL0                 50                                   CLE041
      *                                                                                       CLE041
     C           *IN50     DOWEQ*OFF                                                          CLE041
     C           AGTRNM    ANDEQACNUM                                                         CLE041
     C           AGTRFT    ANDEQAFACT                                                         CLE041
     C           AGTRFN    ANDEQAFCNO                                                         CLE041
      *                                                                                       CLE041
     C                     MOVELAGAGFT    WFACTY  50                                          CLE041
     C                     MOVE AGAGFN    WFACTY                                              CLE041
     C           KAGAC     CHAINLEAGACPD             51                                       CLE041
      *                                                                                       CLE041
     C           *IN51     IFEQ *OFF                                                          CLE041
      *                                                                                       CLE041
     C           AVLDT     IFLT AJDATE                                                        CLE041
     C                     Z-ADDAVLDT     AJDATE                                              CLE041
     C                     UPDATLEAGACD0                                                      CLE041
     C                     ENDIF                                                              CLE041
      *                                                                                       CLE041
     C                     ELSE                                                               CLE041
      *                                                                                       CLE041
     C                     MOVE AGAGBR    AJBRCA                                              CLE041
     C**********           Z-ADDAGAGNM    AJCNUM                                       CLE041 CSD027
     C                     MOVE AGAGNM    AJCNUM                                              CSD027
     C                     MOVELAGAGFT    AJFCTY                                              CLE041
     C                     MOVE AGAGFN    AJFCTY                                              CLE041
     C                     Z-ADDAVLDT     AJDATE                                              CLE041
     C                     WRITELEAGACD0                                                      CLE041
     C                     ENDIF                                                              CLE041
      *                                                                                       CLE041
     C                     READ LETRAGL0                 50                                   CLE041
     C                     ENDDO                                                              CLE041
      *                                                                                       CLE041
     C                     ENDSR                                                              CLE041
      *
      *****************************************************************
      /TITLE SR/SRFCLT
      *****************************************************************
      *                                                               *
      *  SRFCLT - Facility Update Processing                          *
      *                                                               *
      *  Called By: SRDETL                                            *
      *  Calls: None                                                  *
      *                                                               *
      *****************************************************************
      *
     C           SRFCLT    BEGSR                           *** SRFCLT ***
      *                                                                                       193603
     C                     Z-ADDFAMT      WFAMT  130                                          193603
     C                     Z-ADDFAMT      EXAMT  130                                          223967
     C           WFAMT     IFLT 0                                                             193603
     C                     Z-SUBWFAMT     WFAMT                                               193603
     C                     END                                                                193603
      *
      ** Facility Increase.
      *
     C                     SELEC
     C           AFATP     WHEQ 'FI'
     C                     ADD  AAAMT     FAMT
     C           WCAPRT    IFEQ 'Y'                                                         AR679409
     C                     EXSR SRCALP                                                      AR679409
     C                     ENDIF                                                            AR679409
      *
      ** Facility Decrease.
      *
     C           AFATP     WHEQ 'FD'
     C                     SUB  AAAMT     FAMT
     C           WCAPRT    IFEQ 'Y'                                                         AR679409
     C                     EXSR SRCALP                                                      AR679409
     C                     ENDIF                                                            AR679409
      *
      ** Revolving Credit Indicator.
      *
     C           AFATP     WHEQ 'RC'
     C                     MOVE ARVCR     RVCR
      *                                                                   187779
      ** Revolving Credit Last Changed Date                               187779
      *                                                                   187779
     C                     MOVE AVLDT     RVCD                            187779
      *
      ** Facility Reactivation.
      *
     C           AFATP     WHEQ 'FR'
     C                     MOVE FRECI     WRECI   1                       127714
     C                     MOVE 'D'       FRECI
     C                     MOVE DTEX      WDTEX   50                      156297
     C                     MOVE ANDEX     DTEX
      *                                                                                       CER020
      ** Populate Previous and Penultimate Expiry Dates as                                    CER020
      ** applicable if CER020 is ON                                                           CER020
      *                                                                                       CER020
     C           CER020    IFEQ 'Y'                                                           CER020
      *                                                                                       CER020
     C           DTEX      IFNE WDTEX                                                         CER020
     C                     MOVE PEXD      PNXD                                                CER020
     C                     MOVE WDTEX     PEXD                                                CER020
     C                     ENDIF                                                              CER020
      *                                                                                       CER020
     C                     ENDIF                                                              CER020
      *                                                                                       CER020
     C           LCD       IFNE BJRDNB                                    156297
     C           AVLD      ORLE WDTEX                                     156297
     C                     MOVE ANDEX     AVLD                            153787
     C                     ENDIF                                          156297
      *                                                                                       255336
      ** Check if the new expiry date is less than or equal                                   255336
      ** to rundate in order to expire the facility in FCLTYFM                                255336
      *                                                                                       255336
     C           DTEX      IFLE BJRDNB                                                        255336
     C                     MOVE 'E'       FRECI                                               255336
     C                     MOVE FRECI     WRECI                                               255336
     C                     ENDIF                                                              255336
     C**********           Z-ADDFAMT      WFAMT  130                                   127714 193603
     C***********AAAMT     IFGT 0                                         159212
     C           AAAMT     IFGE 0                                         159212
     C                     Z-ADDAAAMT     FAMT
     C                     ENDIF
     C                     ENDSL
      *
      ** Update the facility file - record type 'A'
      *
     C                     UPDATFCLTYFMF
      *
      ** Update the facility file - record type 'B'
      *
     C           AFATP     IFEQ 'FR'
     C/COPY WNCPYSRC,LEH00434
     C                     MOVE 'B'       WRCTP
     C           KEYFCL    CHAINFCLTY                81
      *
     C           *IN81     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTYFN 'DBFILE           ***************
     C                     Z-ADD004       DBASE            * DB ERROR 04 *
     C                     MOVELDSFCLT    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
      *
     C                     MOVE 'D'       FRECI                           127738
      *                                                                                       255336
      ** Check if the new expiry date is less than or equal                                   255336
      ** to rundate in order to expire the facility in FCLTYFM                                255336
      *                                                                                       255336
     C           DTEX      IFLE BJRDNB                                                        255336
     C                     MOVE 'E'       FRECI                                               255336
     C                     ENDIF                                                              255336
     C***********          Z-ADD0         OAM1                            159212
     C***********          Z-ADD0         OAM2                            159212
     C***********          Z-ADD0         OAM3                            159212
     C***********          Z-ADD0         OAM4                            159212
     C***********          Z-ADD0         OAM5                            159212
     C***********          Z-ADD0         OAM6                            159212
     C***********          Z-ADD0         OAM7                            159212
     C***********          Z-ADD0         OAM8                            159212
     C***********          Z-ADD0         OAM9                            159212
     C***********          Z-ADD0         OA10                            159212
     C                     Z-ADDCAMD      OAM1                            172697
     C                     Z-ADDCAMD      OAM2                            172697
     C                     Z-ADDCAMD      OAM3                            172697
     C                     Z-ADDCAMD      OAM4                            172697
     C                     Z-ADDCAMD      OAM5                            172697
     C                     Z-ADDCAMD      OAM6                            172697
     C                     Z-ADDCAMD      OAM7                            172697
     C                     Z-ADDCAMD      OAM8                            172697
     C                     Z-ADDCAMD      OAM9                            172697
     C                     Z-ADDCAMD      OA10                            172697
     C/COPY WNCPYSRC,LEH00341
     C                     UPDATFCLTYFNF
     C                     ENDIF
      *
     C                     ENDIF
     C                     MOVE FRECI     WKRECI  1                                         MD035945
     C/COPY WNCPYSRC,LEH00546
      *                                                                                       223967
      *  Update exposure file if necessary                                                    223967
      *                                                                                       223967
     C           EMFLG     IFEQ 'Y'                                                           223967
     C           FAMT      ANDNEEXAMT                                                         223967
      *                                                                                       223967
     C           EMKEY     KLIST                                                              223967
     C                     KFLD           MCUN                                                223967
     C                     KFLD           MFTP                                                223967
     C                     KFLD           MFN                                                 223967
      *                                                                                       223967
     C**********           Z-ADDACNUM     MCUN                                         223967 CSD031
     C                     MOVE ACNUM     MCUN                                                CSD031
     C                     Z-ADDAFACT     MFTP                                                223967
     C                     Z-ADDAFCNO     MFN                                                 223967
      *                                                                                       223967
     C           EMKEY     CHAINEMXT4F1F             26                                       223967
      *                                                                                       223967
     C           *IN26     IFEQ *OFF                                                          223967
     C                     Z-ADDFAMT      MCYA                                                223967
     C                     UPDATEMXT4F1F                                                      223967
     C                     ENDIF                                                              223967
     C                     ENDIF                                                              223967
      *
      **  Update trailer file                                             127714
      *                                                                                       193603
     C                     Z-ADDFAMT      NFAMT  130                                          193603
     C           NFAMT     IFLT 0                                                             193603
     C                     Z-SUBNFAMT     NFAMT                                               193603
     C                     END                                                                193603
      *                                                                   127714
     C           AFATP     IFEQ 'FI'                                      127714
     C           AFATP     OREQ 'FD'                                      127714
     C           AFATP     OREQ 'FR'                                      127714
     C********** AAAMT     ANDNE0                                                      127714 193603
     C**********           Z-ADD999999    WCNUM                                        127714 CSD027
     C                     MOVE '999999'  WCNUM                                               CSD027
     C                     Z-ADD999       WFCTZ                           127714
     C                     Z-ADD99        WFCNZ                           127714
     C                     MOVE 'Z'       WRCTP                           127714
      *                                                                   127714
     C           KFCZZ     CHAINFCLTY                81                   127714
      *                                                                   127714
     C           *IN81     IFEQ '1'                                       127714
     C           *IN81     OREQ '0'                                       127714
     C           RECI      ANDNE'T'                                       127714
     C                     MOVEL'FCLTYZZ 'DBFILE           ***************127714
     C                     Z-ADD013       DBASE            * DB ERROR 13 *127714
     C                     MOVELDSFCLT    DBKEY            ***************127714
     C                     OUT  LDA                                       127714
     C                     EXSR *PSSR                                     127714
     C                     ENDIF                                          127714
      *                                                                   127714
     C           AAAMT     DIV  1000      ZZAMT                                        127714 193603
     C           NFAMT     SUB  WFAMT     NDIFF  130                                          193603
     C           NDIFF     DIV  1000      ZZAMT                                               193603
      *                                                                   127714
     C                     Z-ADDVLBF      ZZTOTI                          127714
     C                     Z-ADDVLBL      ZZTOTD                          127714
     C                     SELEC                                          127714
     C           AFATP     WHEQ 'FI'                                      127714
     C           AFATP     OREQ 'FD'                                                          193603
     C           WKRECI    ANDNE'C'                                                         MD035945
     C                     EXSR GLZADD                                    127714
     C********** AFATP     WHEQ 'FD'                                                   127714 193603
     C**********           EXSR GLZSUB                                                 127714 193603
     C           AFATP     WHEQ 'FR'                                      127714
     C***********AAAMT     IFGT 0                                   127714159212
     C           AAAMT     IFGE 0                                         159212
     C           WRECI     IFNE 'C'                                       127714
     C           WFAMT     DIV  1000      ZZAMT                           127714
     C                     EXSR GLZSUB                                    127714
     C                     ELSE                                                               193603
     C                     ADD  2         NLRB                                                193603
     C                     ENDIF                                          127714
     C           AAAMT     DIV  1000      ZZAMT                           127714
     C                     EXSR GLZADD                                    127714
     C                     ENDIF                                          127714
     C                     ENDSL                                          127714
     C                     Z-ADDZZTOTI    VLBF                            127714
     C                     Z-ADDZZTOTD    VLBL                            127714
      *                                                                   127714
     C                     Z-ADD0         ZZAMT                           127714
     C********** AAAMT     DIV  1000      ZZAMT                                        127714 193603
     C           NFAMT     SUB  WFAMT     NDIFF                                               193603
     C           NDIFF     DIV  1000      ZZAMT                                               193603
      *                                                                   127714
     C                     Z-ADDVLAF      ZZTOTI                          127714
     C                     Z-ADDVLAL      ZZTOTD                          127714
     C                     SELEC                                          127714
     C           AFATP     WHEQ 'FI'                                      127714
     C           AFATP     OREQ 'FD'                                                          193603
     C           WKRECI    ANDNE'C'                                                         MD035945
     C                     EXSR GLZADD                                    127714
     C********** AFATP     WHEQ 'FD'                                                   127714 193603
     C**********           EXSR GLZSUB                                                 127714 193603
     C           AFATP     WHEQ 'FR'                                      127714
     C***********AAAMT     IFGT 0                                   127714159212
     C           AAAMT     IFGE 0                                         159212
     C           WRECI     IFNE 'C'                                       127714
     C           WFAMT     DIV  1000      ZZAMT                           127714
     C                     EXSR GLZSUB                                    127714
     C                     ELSE                                                               193603
     C                     ADD  2         NLRA                                                193603
     C                     ENDIF                                          127714
     C           AAAMT     DIV  1000      ZZAMT                           127714
     C                     EXSR GLZADD                                    127714
     C                     ENDIF                                          127714
     C                     ENDSL                                          127714
     C                     Z-ADDZZTOTI    VLAF                            127714
     C                     Z-ADDZZTOTD    VLAL                            127714
      *                                                                   127714
     C                     UPDATFCLTYZZF                                  127714
     C                     ENDIF                                          127714
      *                                                                   127714
     C***********          MOVE 'N'       WFLGCA                   127721 128980
     C                     ENDSR
      ***/TITLE*SR/SRCAUP**********************************************   128980
      *****************************************************************
      ***********                                                     *   128980
      ***SRCAUP*-*Credit*Agreement*Update*Processing*******************   128980
      ***********                                                     *   128980
      ***Called*By:*SRDETL*********************************************   128980
      ***Calls****:****************************************************   128980
      ***SRNBDP*-*Get*the*currency's*number*of*decimal*places**********   128980
      ***********                                                     *   128980
      *****************************************************************
      ***********                                                         128980
     C***********SRCAUP    BEGSR                           *** SRCAUP *** 128980
      ***********                                                         128980
      ***Move*values*to*History*Actions*fields.***********************    128980
      ***********                                                         128980
     C***********          MOVE ABRCA     BRCA                            128980
     C***********          Z-ADD0         HASEQ                           128980
     C***********          Z-ADDCANM      HACNUM                          128980
     C***********CAFT      MULT 100       HAFCTY                          128980
     C***********          ADD  CAFN      HAFCTY                          128980
     C***********          MOVE AVLDT     HADATE                          128980
      ***********                                                         128980
      ***Move*amendment*amount*to*history*action*amount.*If*tranche***    128980
      ***and*credit*agreement*currencies*are*not*the*same,*convert****    128980
      ***amendment*amount*to*credit*agreement*currency.***************    128980
      ***********                                                         128980
     C***********FCCY      IFEQ CACY                                      128980
     C***********          Z-ADDAAAMT     HAAAMT                          128980
     C***********          ELSE                                           128980
      ***********                                                         128980
      ***Get*the*number*of*decimal*places:****************************    128980
      ***********                                                         128980
      ***(1)*Tranche*Currency.****************************************    128980
      ***********                                                         128980
     C***********          Z-ADD005       WCDBS                           128980
     C***********          MOVE FCCY      WCURR                           128980
     C***********          EXSR SRNBDP                                    128980
     C***********          Z-ADDWNBDP     ZCDPI                           128980
      ***********                                                         128980
      ***(2)*Credit*Agreement*Currency.*******************************    128980
      ***********                                                         128980
     C***********          Z-ADD006       WCDBS                           128980
     C***********          MOVE CACY      WCURR                           128980
     C***********          EXSR SRNBDP                                    128980
     C***********          Z-ADDWNBDP     ZCDPO                           128980
      ***********                                                         128980
      ***Convert*Amendment*Amount*to*credit*agreement*currency.*******    128980
      ***********                                                         128980
     C***********          Z-ADDAAAMT     ZAMTCI                          128980
     C***********          Z-ADDCAXR      ZEXCH                           128980
     C***********          MOVE CMDI      ZMD                             128980
     C***********          EXSR ZCONVN                                    128980
     C***********          Z-ADDZAMTCO    HAAAMT                          128980
     C***********          ENDIF                                          128980
      ***********                                                         128980
      ***Increment*the*number*of*records*output*then*write*a*record***    128980
      ***to*the*History*Actions*file.*********************************    128980
      ***********                                                         128980
     C***********          ADD  1         WROUT                           128980
     C***********          WRITEHISACTF                                   128980
      ***********                                                         128980
      ***Retrieve*facility*details*of*Credit*Agreement*facility*******    128980
      ***********                                                         128980
     C***********          MOVE 'A'       WCRCT   1                       128980
     C***********KEYFCA    CHAINFCLTY                81                   128980
     C************IN81     IFEQ '1'                                       128980
     C************LOCK     IN   LDA                                       128980
     C***********          MOVEL'FCLTYFM 'DBFILE           ***************128980
     C***********          Z-ADD007       DBASE            * DB ERROR 07 *128980
     C***********          MOVELDSFCA     DBKEY            ***************128980
     C***********          OUT  LDA                                       128980
     C***********          EXSR *PSSR                                     128980
      ***********                                                         128980
     C***********          ELSE                                           128980
      ***********                                                         128980
      ***Update*Facilities*with*Actions*File*if*existing.*Otherwise***    128980
      ***write*a*new*record*in*the*file.******************************    128980
      ***********                                                         128980
     C***********KEYACT    CHAINFACACT               82                   128980
     C************IN82     IFEQ '0'                                       128980
     C***********HADATE    IFLE FCDATE                                    128980
     C***********          MOVE HADATE    FCDATE                          128980
     C***********          UPDATFACACTF                                   128980
     C***********          ENDIF                                          128980
     C***********          ELSE                                           128980
     C***********          MOVE HACNUM    FCCNUM                          128980
     C***********          MOVE HAFCTY    FCFCTY                          128980
     C***********          MOVE HADATE    FCDATE                          128980
     C***********          WRITEFACACTF                                   128980
     C***********          ENDIF                                          128980
      ***********                                                         128980
      ***Update*Facility*File.****************************************    128980
      ***********                                                         128980
      ***Facility*Increase.*******************************************    128980
      ***********                                                         128980
     C***********          SELEC                                          128980
     C***********AFATP     WHEQ 'FI'                                      128980
     C***********          ADD  HAAAMT    FAMT                            128980
      ***********                                                         128980
      ***Facility*Decrease.*******************************************    128980
      ***********                                                         128980
     C***********AFATP     WHEQ 'FD'                                      128980
     C***********          SUB  HAAAMT    FAMT                            128980
     C***********          ENDSL                                          128980
      ***********                                                         128980
     C***********          UPDATFCLTYFMF                                  128980
     C***********          ENDIF                                          128980
      ***********                                                  127714 128980
      ****Update*trailer*file**************************************127714 128980
      ***********                                                  127714 128980
     C***********          Z-ADD999999    WCNUM                    127714 128980
     C***********          Z-ADD999       WFCTZ                    127714 128980
     C***********          Z-ADD99        WFCNZ                    127714 128980
     C***********          MOVE 'Z'       WRCTP                    127714 128980
      ***********                                                  127714 128980
     C***********KFCZZ     CHAINFCLTY                81            127714 128980
      ***********                                                  127714 128980
     C************IN81     IFEQ '1'                                127714 128980
     C************IN81     OREQ '0'                                127714 128980
     C***********RECI      ANDNE'T'                                127714 128980
     C***********          MOVEL'FCLTYZZ 'DBFILE    ***************127714 128980
     C***********          Z-ADD014       DBASE     * DB ERROR 14 *127714 128980
     C***********          MOVELDSFCLT    DBKEY     ***************127714 128980
     C***********          OUT  LDA                                127714 128980
     C***********          EXSR *PSSR                              127714 128980
     C***********          ENDIF                                   127714 128980
      ***********                                                  127714 128980
     C***********HAAAMT    DIV  1000      ZZAMT                    127714 128980
      ***********                                                  127714 128980
     C***********          Z-ADDVLBF      ZZTOTI                   127714 128980
     C***********          Z-ADDVLBL      ZZTOTD                   127714 128980
      ***********                                                  127714 128980
     C***********          SELEC                                   127714 128980
     C***********AFATP     WHEQ 'FI'                               127714 128980
     C***********          EXSR GLZADD                             127714 128980
     C***********AFATP     WHEQ 'FD'                               127714 128980
     C***********          EXSR GLZSUB                             127714 128980
     C***********          ENDSL                                   127714 128980
      ***********                                                  127714 128980
     C***********          Z-ADDZZTOTI    VLBF                     127714 128980
     C***********          Z-ADDZZTOTD    VLBL                     127714 128980
      ***********                                                  127714 128980
     C***********          Z-ADD0         ZZAMT                    127714 128980
     C***********HAAAMT    DIV  1000      ZZAMT                    127714 128980
      ***********                                                  127714 128980
     C***********          Z-ADDVLAF      ZZTOTI                   127714 128980
     C***********          Z-ADDVLAL      ZZTOTD                   127714 128980
      ***********                                                  127714 128980
     C***********          SELEC                                   127714 128980
     C***********AFATP     WHEQ 'FI'                               127714 128980
     C***********          EXSR GLZADD                             127714 128980
     C***********AFATP     WHEQ 'FD'                               127714 128980
     C***********          EXSR GLZSUB                             127714 128980
     C***********          ENDSL                                   127714 128980
      ***********                                                  127714 128980
     C***********          Z-ADDZZTOTI    VLAF                     127714 128980
     C***********          Z-ADDZZTOTD    VLAL                     127714 128980
      ***********                                                  127714 128980
     C***********          UPDATFCLTYZZF                           127714 128980
      ***********                                                         128980
     C***********          MOVE 'Y'       WFLGCA  1                127721 128980
     C***********          ENDSR                                          128980
      */TITLE*SR/SRFHUP********************************************127721 144712
      *****************************************************************   127721
      *************************************************************127721 144712
      ***SRFHUP*-*Facility*History*Header*Update*Processing********127721 144712
      *************************************************************127721 144712
      ***Called*By:*SRDETL*****************************************127721 144712
      ***Calls****:************************************************127721 144712
      *************************************************************127721 144712
      *****************************************************************   127721
     C***********SRFHUP    BEGSR                        *** SRFHUP 127721 144712
      *************************************************************127721 144712
     C***********WFLGCA    IFEQ 'Y'                                127721 128980
     C***********          MOVE HACNUM    WCNUM                    127721 128980
     C***********          MOVELHAFCTY    WFCTH                    127721 128980
     C***********          MOVE HAFCTY    WFCNH                    127721 128980
     C***********          ELSE                                    127721 128980
     C***********          MOVE ACNUM     WCNUM                    127721 144712
     C***********          MOVE AFACT     WFCTH                    127721 144712
     C***********          MOVE AFCNO     WFCNH                    127721 144712
     C***********          ENDIF                                   127721 128980
      *************************************************************127721 144712
     C***********KFACH     CHAINFACHISHF             85            127721 144712
      *************************************************************127721 144712
     C************IN85     IFEQ '1'                                127721 144712
     C************LOCK     IN   LDA                                127721 144712
     C***********          MOVEL'FACHISH 'DBFILE     **************127721 144712
     C***********          Z-ADD015       DBASE      * DB ERROR 15 127721 144712
     C***********          MOVELWCNUM     DBKEY      **************127721 144712
     C***********          OUT  LDA                                127721 144712
     C***********          EXSR *PSSR                              127721 144712
      *************************************************************127721 144712
     C***********          ELSE                                    127721 144712
     C***********          SELEC                                   127721 144712
     C***********AFATP     WHEQ 'FI'                               127721 144712
     C***********WFLGCA    IFEQ 'N'                                127721 128980
     C***********          ADD  AAAMT     FHLFAM                   127721 144712
     C***********          ELSE                                    127721 128980
     C***********          ADD  HAAAMT    FHLFAM                   127721 128980
     C***********          ENDIF                                   127721 128980
      *************************************************************127721 144712
     C***********AFATP     WHEQ 'FD'                               127721 144712
     C***********WFLGCA    IFEQ 'N'                                127721 128980
     C***********          SUB  AAAMT     FHLFAM                   127721 144712
     C***********          ELSE                                    127721 128980
     C***********          SUB  HAAAMT    FHLFAM                   127721 128980
     C***********          ENDIF                                   127721 128980
      *************************************************************127721 144712
     C***********AFATP     WHEQ 'RC'                               127721 144712
     C***********          MOVE ARVCR     FHRCIN                   127721 144712
      *************************************************************127721 144712
     C***********AFATP     WHEQ 'FR'                               127721 144712
     C***********          MOVE 'D'       FHRECI                   127721 144712
     C***********          Z-ADDANDEX     FHEXDT                   127721 144712
     C***********AAAMT     IFGT 0                                  127721 144712
     C***********          Z-ADDAAAMT     FHLFAM                   127721 144712
     C***********          ENDIF                                   127721 144712
      *************************************************************127721 144712
     C***********          ENDSL                                   127721 144712
      *************************************************************127721 144712
     C***********          UPDATFACHISHF                           127721 144712
     C***********          ENDIF                                   127721 144712
      *************************************************************127721 144712
     C***********          ENDSR                                   127721 144712
      *************************************************************127721 144712
      /TITLE SR/SRNBDP
      *****************************************************************
      *                                                               *
      *  SRNBDP - Get the currency's number of decimal places         *
      *                                                               *
      ***Called*By:*WP1REC,*SRCAUP*************************************   128980
      *  Called By: WP1REC                                            *   128980
      *  Calls    :                                                   *
      *  AOCURRR0 Access Program                                      *
      *                                                               *
      *****************************************************************
      *
     C           SRNBDP    BEGSR                           *** SRNBDP ***
      *
     C                     CALL 'AOCURRR0'
     C                     PARM '*BLANK ' WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM           WCURR   3
     C           SDCURR    PARM SDCURR    DSSDY
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCURRPD'DBFILE           ***************
     C                     Z-ADDWCDBS     DBASE            * DB ERROR XX *
     C                     MOVELWCURR     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     Z-ADDA6NBDP    WNBDP   10
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRTRAL
      *****************************************************************
      *                                                               *
      *  SRTRAL - File Trailer Processing                             *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRTRAL    BEGSR                           *** SRIFLD ***
      *
      ** Chain to trailer file. Do database error processing if no
      ** record exists.
      *
     C           1         CHAINLEFCAMZZ             83
     C           *IN83     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'LEFCAMZZ'DBFILE           ***************
     C                     Z-ADD008       DBASE            * DB ERROR 08 *
     C                     MOVE *BLANKS   DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
      *
      ** Update fields.
      *
     C                     Z-ADDWRNUM     NORE
     C                     Z-ADD0         NINS
     C                     Z-ADD0         NAMD
     C                     Z-ADD0         NDEL
     C                     Z-ADDWRNUM     NLRB
     C                     Z-ADDWRNUM     NLRA
     C                     Z-ADD0         VIRF
     C                     Z-ADD0         VIRL
     C                     Z-ADD0         VARF
     C                     Z-ADD0         VARL
     C                     Z-ADD0         VDRF
     C                     Z-ADD0         VDRL
     C           WRAMT     DIV  1000      ZZAMT
     C                     Z-ADD0         ZZTOTI
     C                     Z-ADD0         ZZTOTD
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    VLBF
     C                     Z-ADDZZTOTD    VLBL
     C                     Z-ADDZZTOTI    VLAF
     C                     Z-ADDZZTOTD    VLAL
      *
      ** Update trailer file.
      *
     C                     UPDATLEFCAMZF
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRDTLR
      *****************************************************************
      *                                                               *
      *  SRDTLR - Detail Report Processing                            *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls    :                                                   *
      *  WP1REC - Write a detail record to the report                 *
      *  WP1END - Write End of Report                                 *
      *  RCFP1  - RCF Processing for P1 Report                        *
      *  AOBRCHR0 Access Program                                      *
      *                                                               *
      *****************************************************************
      *
     C           SRDTLR    BEGSR                           *** SRDTLR ***
      *
      ** Do while not end-of-file.
      *
     C                     READ HISACTL2                 84
     C           *IN84     DOWEQ'0'
      *
      ** Check if there is change of branch.
      *
     C           HABRCA    IFNE WPBRC
     C           AGMBIN    ANDEQ'Y'
     C           OPEN1     ORNE '1'
     C           AGMBIN    ANDEQ'N'
      *
     C           OPEN1     IFEQ '1'
     C                     EXSR WP1END
     C                     ENDIF
      *
      ** Close, open and register to RCF.
      *
     C                     MOVE HABRCA    WPBRC   3
     C                     CLOSELE0496P1
     C                     OPEN LE0496P1
     C                     EXSR RCFP1
      *
      ** Get the branch description then write report header.
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C           RBRCA     PARM HABRCA    WBRCA   3
     C********** SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDBRCHPD'DBFILE           ***************
     C                     Z-ADD009       DBASE            * DB ERROR 09 *
     C                     MOVELWBRCA     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     WRITEHEADP1
     C                     ENDIF
      *
      ** Move action fields to report fields and  write details to
      ** report.
      *
     C                     EXSR WP1REC
      *
      ** Read next record.
      *
     C                     ADD  1         WCNTR
     C                     READ HISACTL2                 84
     C                     ENDDO
      *
     C           OPEN1     IFEQ '1'
     C                     EXSR WP1END
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/WP1REC
      *****************************************************************
      *                                                               *
      *  WP1REC - Subroutine to Write a Detail record to the Report.  *
      *                                                               *
      *  Called By: SRDTLR                                            *
      *  Calls:                                                       *
      *  SRIFLD - Reinitilise report fields                           *
      *  ZDATE2 - Convert Midas Day Number into Date (DDMMYY/MMDDYY)  *
      *  ZFRPED - Format an Amount                                    *
      *  SRNBDP - Get the currency's number of decimal places         *
      *  AOBANKR0 Access Program                                      *
      *                                                               *
      *****************************************************************
      *
     C           WP1REC    BEGSR                           *** WP1REC ***
      *
      ** Reinitialise Report fields.
      *
     C                     EXSR SRIFLD
      *
     C                     MOVE HACNUM    RCNUM
     C                     MOVE WFACT     RFACT
     C                     MOVE WFCNO     RFCNO
      *
      ** Format Value Date.
      *
     C           HADATE    IFEQ 0
     C                     MOVE *BLANKS   RVDAT
     C                     ELSE
     C                     MOVE HADATE    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZADATE    RVDAT
     C                     ENDIF
      *
      ** Get Customer Name.
      *
     C                     MOVELHACNUM    WCUST
     C                     CALL 'AOCUSTR0'
     C                     PARM *BLANKS   WRTCD
     C                     PARM '*KEY   ' WOPTN
     C                     PARM           WCUST  10
     C                     PARM *BLANKS   PKYST   7
     C           SDCUST    PARM SDCUST    DSSDY
     C           WRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'SDCUSTPD'DBFILE           ***************
     C                     Z-ADD010       DBASE            * DB ERROR 10 *
     C                     MOVELHACNUM    DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVELBBCRNM    RCNAM
     C                     ENDIF
      *
      ** Get the facility amendment currency.
      *
     C                     MOVE 'A'       WHRCT   1
     C           KEYFC2    CHAINFCLTY                81
      *
     C           *IN81     IFEQ '1'
     C           *LOCK     IN   LDA
     C                     MOVEL'FCLTYFM 'DBFILE           ***************
     C                     Z-ADD011       DBASE            * DB ERROR 11 *
     C                     MOVELDSFC2     DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE
     C                     MOVE FCCY      RHCCY
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00342
      *
      ** Get Action narrative.
      *
     C                     SELEC
     C           HAACTN    WHEQ 'FI'
     C                     MOVE '1'       *IN30
     C           HAACTN    WHEQ 'FD'
     C                     MOVE '1'       *IN31
     C           HAACTN    WHEQ 'RC'
     C                     MOVE '1'       *IN32
     C           HAACTN    WHEQ 'FR'
     C                     MOVE '1'       *IN35
     C/COPY WNCPYSRC,LEH00343
     C                     ENDSL
      *
      ** Format Amendment Amount for Facility Increase/Decrease.
      *
     C                     SELEC
     C           HAACTN    WHEQ 'FI'
     C           HAACTN    OREQ 'FD'
     C           HAACTN    OREQ 'FR'                                                          246191
      *
      ** Get the number of decimal places.
      *
     C                     Z-ADD012       WCDBS
     C                     MOVE RHCCY     WCURR
     C                     EXSR SRNBDP
     C                     Z-ADDWNBDP     ZDECS
      *
     C                     MOVE *BLANKS   ZFLD15
     C                     Z-ADDHAAAMT    ZFLD15
     C                     EXSR ZFRPED
     C                     MOVE ZOUT1     RHAMT
      *
     C           HAACTN    WHEQ 'RC'
     C           CLE014    IFEQ 'N'                                       CLE014
     C           RVCR      IFEQ 'N'
     C                     MOVE '1'       *IN33
     C                     ELSE
     C                     MOVE '1'       *IN34
     C                     ENDIF
     C                     ENDIF                                          CLE014
      *                                                                   CLE014
     C           CLE014    IFEQ 'Y'                                       CLE014
     C                     MOVE '0'       *IN33                           CLE014
     C                     MOVE '0'       *IN34                           CLE014
     C                     MOVE '0'       *IN38                           CLE014
     C                     MOVE '0'       *IN39                           CLE014
     C                     MOVE '0'       *IN40                           CLE014
     C                     MOVE '0'       *IN41                           CLE014
     C                     SELEC                                          CLE014
     C           HAOLRC    WHEQ 'N'                                       CLE014
     C           HARCIN    ANDEQ'Y'                                       CLE014
     C                     MOVE '1'       *IN34                           CLE014
     C           HAOLRC    WHEQ 'Y'                                       CLE014
     C           HARCIN    ANDEQ'N'                                       CLE014
     C                     MOVE '1'       *IN33                           CLE014
     C           HAOLRC    WHEQ 'Y'                                       CLE014
     C           HARCIN    ANDEQ'T'                                       CLE014
     C                     MOVE '1'       *IN38                           CLE014
     C           HAOLRC    WHEQ 'N'                                       CLE014
     C           HARCIN    ANDEQ'T'                                       CLE014
     C                     MOVE '1'       *IN39                           CLE014
     C           HAOLRC    WHEQ 'T'                                       CLE014
     C           HARCIN    ANDEQ'Y'                                       CLE014
     C                     MOVE '1'       *IN40                           CLE014
     C           HAOLRC    WHEQ 'T'                                       CLE014
     C           HARCIN    ANDEQ'N'                                       CLE014
     C                     MOVE '1'       *IN41                           CLE014
     C                     ENDSL                                          CLE014
     C                     ENDIF                                          CLE014
     C/COPY WNCPYSRC,LEH00344
      *
     C                     ENDSL
      *
      ** Check that sufficient lines remain for the Format. If not,
      ** write out the Main Headings on a new page.
      *
     C                     Z-ADD2         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     ENDIF
      *
      ** Write out Detail Record.
      *
     C                     WRITEDETAL1
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRIFLD
      *****************************************************************
      *                                                               *
      *  SRIFLD - Reinitialise report fields                          *
      *                                                               *
      *  Called By: WP1REC                                            *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           SRIFLD    BEGSR                           *** SRIFLD ***
      *
     C                     MOVE *BLANKS   RCNUM
     C                     MOVE *BLANKS   RCNAM
     C                     MOVE *BLANKS   RFACT
     C                     MOVE *BLANKS   RFCNO
     C                     MOVE *BLANKS   RHCCY
     C                     MOVE *BLANKS   RVDAT
     C                     MOVE *BLANKS   RHAMT
      *
     C                     MOVEA'000000'  *IN,30
      *
     C/COPY WNCPYSRC,LEH00345
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/WP1END
      *****************************************************************
      *                                                               *
      *  WP1END - Subroutine to Write End of Report.                  *
      *                                                               *
      *  Called By: SRDTLR                                            *
      *  Calls    : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           WP1END    BEGSR                           *** WP1END ***
      *
      ** Check that sufficient lines remain for the Format. If not,
      ** write out the Main Headings on a new page.
      *
     C                     Z-ADD4         RQDLN1
     C           OFLLN1    SUB  PRTLN1    DIFLN1
     C           DIFLN1    IFLE RQDLN1
     C                     WRITEHEADP1
     C                     ENDIF
      *
      ** Write out Total Format.
      *
     C                     WRITETRAILP1
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/SRENDP
      *****************************************************************
      *                                                               *
      *  SRENDP - Output audit report and end program.                *
      *                                                               *
      *  Called By: Main Processing                                   *
      *  Calls: None                                                  *
      *                                                               *
      *****************************************************************
      *
     C           SRENDP    BEGSR                           *** SRENDP ***
      *
      ** Output Report Header and File Controls.
      *
     C                     WRITEHEADAU
      *
      ** If there is a DB Error, Output the DB Error Information.
      *
     C           *INU7     IFEQ '1'
     C                     WRITEDBERROR
     C                     ELSE
      *
      ** Or, if no records read, Output "No Details" message.
      *
     C           WCNTR     IFEQ 0
     C                     WRITENODTLS
      *
      ** Output File Controls.
      *
     C                     ELSE
     C                     MOVE WRDRP     RDROP
     C                     MOVE WRNUM     RNTRL
     C                     MOVE WRAMT     RVTRL
     C                     MOVE WROUT     RNADD
     C                     WRITECONTROL
      *
     C                     ENDIF
     C                     ENDIF
      *
      ** End Program and Return.
      *
     C                     SETON                     LR
     C                     RETRN
      *
     C                     ENDSR
     C/COPY WNCPYSRC,LEH00579
      *
      *****************************************************************
      /TITLE SR/*PSSR
      *****************************************************************
      *                                                               *
      *  *PSSR  - Error control subroutine                            *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR                           ** *PSSR **
      *
      ***  Check to see that *PSSR has not already been called.
      *
     C           WRUN      IFEQ *BLANK
     C                     MOVE 'Y'       WRUN    1
      *
     C                     SETON                     U7U8LR
     C                     DUMP
     C                     EXSR SRENDP
     C                     ENDIF
      *
      ** If *PSSR already run, then just end the program here.
      *
     C                     SETON                     U7U8LR
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/RCFP1
      *****************************************************************
      *                                                               *
      *  RCFP1  - Subroutine to register the P1 Printer File via RCF. *
      *                                                               *
      *****************************************************************
      *
     C           RCFP1     BEGSR                            *** RCFP1  ***
      *
      ** Ensure Report Spool File recorded by RCF.
      *
     C                     Z-ADDSFNUM1    ZSNUM   60
      *
     C           AGMBIN    IFEQ 'Y'
     C                     MOVE HABRCA    SENTY
     C                     ELSE
     C                     MOVE *BLANKS   SENTY
     C                     ENDIF
      *
     C                     CALL 'ZSFILE'
     C                     PARM *BLANKS   SEQ     5
     C                     PARM           SENTY   3
     C                     PARM           SFILE1
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
      ** If Error occurs during ZSFILE processing, then return to the
      ** Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/RCFAU
      *****************************************************************
      *                                                               *
      *  RCFAU  - Subroutine to register the AU Printer File via RCF. *
      *                                                               *
      *****************************************************************
      *
     C           RCFAU     BEGSR                            *** RCFAU  ***
      *
      ** Ensure Audit Spool File recorded by RCF.
      *
     C                     Z-ADDSFNUMU    ZSNUMU  60
      *
     C                     CALL 'ZSFILE'
     C                     PARM *BLANKS   SEQ
     C                     PARM *BLANKS   SENTY
     C                     PARM           SFILEU
     C                     PARM           ZSNUMU
     C                     PARM *BLANK    ZSERR
      *
      ** If Error occurs during ZSFILE processing, then return to the
      ** Calling Program.
      *
     C           ZSERR     IFEQ 'Y'
     C                     SETON                     U7U8LR
     C                     RETRN
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /TITLE SR/GLZADD
      *****************************************************************
      *                                                               *
      *  GLZADD - Adds an amount (ZZAMT) to the total (ZZTOTI,ZZTOTD) *
      *                                                               *
      *  Called by: SRTRAL                                            *
      *  Calls    :                                                   *
      *  GLZSUM - Carries out the addition of the amounts             *
      *                                                               *
      *****************************************************************
      *
     C           GLZADD    BEGSR
      *
     C           ZZAMT     IFNE *ZERO
      *
      ** Split ZZAMT into integer and decimal fields
      *
     C                     Z-ADDZZAMT     ZZAMTI 150
     C                     MOVE ZZAMT     ZZAMTD  30
      *
      ** Both ZZAMTI and ZZAMTD contain a 'sign' zone now
      *
     C                     EXSR GLZSUM
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************   127714
      /TITLE SR/GLZSUB                                                    127714
      *****************************************************************   127714
      *                                                               *   127714
      *  GLZSUB - Subtracts amnt (ZZAMT) to the total (ZZTOTI,ZZTOTD) *   127714
      *                                                               *   127714
      *  Called by: SRFCTL                                            *   127714
      *  Calls    :                                                   *   127714
      *  GLZSUM - Carries out the addition of the amounts             *   127714
      *                                                               *   127714
      *****************************************************************   127714
      *                                                                   127714
     C           GLZSUB    BEGSR                                          127714
      *                                                                   127714
      ** Just reverse the 'sign' and add                                  127714
      *                                                                   127714
     C                     Z-SUBZZAMT     ZZAMT                           127714
     C                     EXSR GLZADD                                    127714
     C                     Z-SUBZZAMT     ZZAMT                           127714
      *                                                                   127714
     C                     ENDSR                                          127714
      *                                                                   127714
      *****************************************************************
      /TITLE SR/GLZSUM
      *****************************************************************
      *                                                               *
      *  GLZSUM - Carries out the addition of the amounts             *
      *                                                               *
      *  Called by: GLZADD                                            *
      *  Calles   : None                                              *
      *                                                               *
      *****************************************************************
      *
     C           GLZSUM    BEGSR
      *
      ** Save values of indicators to be used in the program
      *
     C                     MOVE *IN91     WIN91   1
     C                     MOVE *IN92     WIN92   1
     C                     MOVE *IN93     WIN93   1
     C                     MOVE *IN94     WIN94   1
     C                     MOVE *IN95     WIN95   1
     C                     MOVE *IN96     WIN96   1
     C                     SETOF                     919293
     C                     SETOF                     949599
      *
      ** Determine sign of ZZAMTI and ZZAMTD, 92 if neg
      *
     C           ZZAMTI    COMP 0                      9293
     C   93      ZZAMTD    COMP 0                      9293
     C   93                GOTO ZZSEND                     ZERO BYPASS
      *
      ** Determine sign of ZZTOTI and ZZTOTD, 91 if neg
      *
     C           ZZTOTI    COMP 0                      9193
     C   93      ZZTOTD    COMP 0                      9193
      *
      ** If ZZTOTAL is zero, return ZZAMOUNT
      *
     C   93                Z-ADDZZAMTI    ZZTOTI 150
     C   93                Z-ADDZZAMTD    ZZTOTD  30
     C   93                GOTO ZZSEND                     ZERO BYPASS
      *
      ** If signs differ, bypass overflow checks
      *
     C   91N92
     CORN91 92             GOTO ZZOFPS
     C*
     C           ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     C           ZZWK2     COMP 999                  93    '93' = CARRY
     C  N93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     C   93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     C      93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     C   93      ZZTOTI    ADD  ZZWK3     ZZWK3
     C  N93      ZZTOTI    ADD  ZZAMTI    ZZWK3
      *
      ** If the modulus of ZZWK3 is lt mod. ZZTOTI then O/F has occured
      *
     C  N92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     C   92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     C  N99                Z-ADDZZWK2     ZZTOTD
     C  N99                Z-ADDZZWK3     ZZTOTI
      *
      ** If O/F zeroise ZZAMT, Ind '99' set and ZZTOT fields left intact
      *
     C   99                Z-ADD0         ZZAMT  153
     C                     GOTO ZZSEND
      *
      ** The 'signs' are different
      *
     C           ZZOFPS    TAG
      *
      ** If ZZAMT was negative, make it pos. to como with ZZTOT
      *
     C   92                Z-SUBZZAMTI    ZZAMTI 150
     C   92                Z-SUBZZAMTD    ZZAMTD  30
      *
      ** If ZZTOT was negative, make it pos. to comp with ZZAMT.
      *
     C   91                Z-SUBZZTOTI    ZZTOTI
     C   91                Z-SUBZZTOTD    ZZTOTD
      *
      ** Both ZZAMT and ZZTOT are now positive
      *
     C           ZZTOTI    COMP ZZAMTI               93  95
     C   95      ZZTOTD    COMP ZZAMTD               93  95
      *
      ** If ZZTOT eq. ZZAMT return ZERO.
      *
     C   95                Z-ADD0         ZZTOTI
     C   95                Z-ADD0         ZZTOTD
     C   95                GOTO ZZSEND
      *
      ** If ZZTOT gt. ZZAMT.
      *
     C   93      ZZAMTD    COMP ZZTOTD               94
     C   93 94   ZZTOTI    SUB  1         ZZTOTI
     C   93 94   ZZTOTD    ADD  1000      ZZWK2
     C   93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     C   93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     C   93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
      *
      ** If ZZAMT gt. ZZTOT.
      *
     C  N93      ZZTOTD    COMP ZZAMTD               94
     C  N93 94   ZZAMTI    SUB  1         ZZWK3  150
     C  N93 94   ZZAMTD    ADD  1000      ZZWK2
     C  N93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     C  N93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     C  N93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     C  N93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
      *
      ** Reverse sign of ZZTOT if larger I/P fields were negative
      *
     C                     SETOF                     94
     C   93 91
     CORN93 92             SETON                     94
     C   94                Z-SUBZZTOTI    ZZTOTI
     C   94                Z-SUBZZTOTD    ZZTOTD
      *
      ** Restore sign of ZZAMTI & ZZAMTD if it was reversed
      *
     C   92                Z-SUBZZAMTI    ZZAMTI
     C   92                Z-SUBZZAMTD    ZZAMTD
     C           ZZSEND    TAG
      *
      **   If ZZTOTD is zero, and ZZTOTI is neg. set up ZZNEGD.
      *
     C                     SETOF                     96
     C           ZZTOTD    COMP 0                        91
     C   91      ZZTOTI    COMP 0                      96
     C   96                MOVE '.000-'   ZZNEGD  5
      *
      ** Restore previous indicator values
      *
     C                     MOVE WIN91     *IN91
     C                     MOVE WIN92     *IN92
     C                     MOVE WIN93     *IN93
     C                     MOVE WIN94     *IN94
     C                     MOVE WIN95     *IN95
     C                     MOVE WIN96     *IN96
      *
     C                     ENDSR
      *****************************************************************
      /TITLE SR/SRDROP                                                                        CLE106
      *****************************************************************                       CLE106
      *                                                               *                       CLE106
      *  SRDROP - Drop Participant's non Pro-Rata Facility events     *                       CLE106
      *                                                               *                       CLE106
      *  Called By: SRDETL                                            *                       CLE106
      *  Calls    : None                                              *                       CLE106
      *                                                               *                       CLE106
      *****************************************************************                       CLE106
      *                                                                                       CLE106
     C           SRDROP    BEGSR                           *** SRDROP ***                     CLE106
      *                                                                                       CLE106
      * Drop all related non Pro-Rata Facility event records                                  CLE106
      *                                                                                       CLE106
     C           CLE106    IFEQ 'Y'                                                           CLE106
      *                                                                                       CLE106
     C           *LOVAL    SETLLLEFNPRP0                                                      CLE106
     C           *IN18     DOUEQ*ON                                                           CLE106
     C           APCRF     DELETLEFNPRP0             18                                       CLE106
     C                     ENDDO                                                              CLE106
      *                                                                                       CLE106
     C                     ENDIF                                                              CLE106
      *                                                                                       CLE106
     C                     ENDSR                                                              CLE106
      *                                                                                       CLE106
      *****************************************************************                       CLE106
      /TITLE SR/SRCALP                                                                      AR679409
      *****************************************************************                     AR679409
      *                                                               *                     AR679409
      *  SRCALP - Recalculate participant share percentage on FI/FD   *                     AR679409
      *                                                               *                     AR679409
      *  Called By: SRFCLT                                            *                     AR679409
      *  Calls    : None                                              *                     AR679409
      *                                                               *                     AR679409
      *****************************************************************                     AR679409
      *                                                                                     AR679409
     C           SRCALP    BEGSR                                                            AR679409
      *                                                                                     AR679409
     C                     MOVE FAMT      P#FAMT                                            AR679409
     C                     MOVE #FAMT     P#PAMT                                            AR679409
     C                     CALL 'LE2024'                                                    AR679409
     C                     PARM           P#PAMT 13                                         AR679409
     C                     PARM *BLANKS   P#SHPC 15                                         AR679409
     C                     PARM           P#FAMT 13                                         AR679409
     C                     PARM 'A'       P#SHTP  1                                         AR679409
     C                     MOVE P#SHPC    SHPC                                              AR679409
      *                                                                                     AR679409
     C                     ENDSR                                                            AR679409
      *****************************************************************                     AR679409
      /TITLE SR/ZDATE2
     C/COPY ZSRSRC,ZDATE2Z2
      /TITLE SR/ZFRPED
     C/COPY ZSRSRC,ZFRPEDZ3
      /TITLE SR/ZCONVN
     C/COPY ZSRSRC,ZCONVNZ1
**  CPY@
(c) Finastra International Limited 2001
**  POWER -- USED IN CURRENCY CONVERSION(FACILITY)
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
