0001 H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Extract facilities exceeded')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Customer Lending Module                              *
     F*                                                               *
     F*  LE0663 - EXTRACT FACILITIES EXCEEDED                         *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *  Prev Amend No. CSC042             Date 16Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 231062             Date 22Sep06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CLE041             Date 11Oct04               *
      *                 CGL029             Date 01Sep03               *
      *                 222373             Date 28Oct03               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CLE023             Date 19Nov01               *
      *                 193603             Date 31Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 061411             Date 13Jan98               *
      *                 CLE004             Date 02Dec96               *
     F*                 S01498             DATE 11AUG94               *
     F*                 S01270             DATE 22MAR91               *
     F*                 S01194               DATE  10JAN90            *
     F*                 S01117               DATE  15/08/89           *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CSC042 - COB Performance fix.                                *
      *           Cut down no of calls to AOBRCHR0. At RZB Sofia AO   *
      *           pgm is called 100K times for 205 branches           *
      *  231062 - Future amendments to facility amount not considered *
      *           when reporting exceeded facilities.                 *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CLE041 - Collateralised Lending Phase 2B                     *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  222373 - Parameter Mismatch                                  *
      *  CLE023 - Lending Facilty History Improvements.               *
      *  193603 - Take negative facility amounts into consideration   *
     F*  061411 - Facilities are incorrectly extracted, causing them  *
     F*           to appear on the report with blank excess value     *
     F*           for all the projected dates. Fix is to move the     *
     F*           validation of the dates from LE0670 to the extract  *
     F*           program LE0663.                                     *
     F*  CLE004 - Customer Lending Enhancements - Syndication         *
     F*  S01498 - Portfolio Lending Upgrade to Release 10             *
     F*     S01270 - CUSTOMER LENDING CHANGES                            *S01270
     F*     S01194 - STANDING DATA CHANGES                               *S01194
     F*     S01117 - MULTIBRANCHING                                      *
     F*                                                                  *
0011 F********************************************************************
0014 F*FCLTY***IP  F     256 12AI     2 DISK                              CLE004
0014 F***FCLTY** IP  F     401 12AI     2 DISK                                         CLE004 CLE041
     FLEFCLTLKIP  F     401 12AI     2 DISK                                                   CLE041
     FLEAGFCL2IS  F     401 12AI     2 DISK                           U1                      CLE041
     FFCLTYZZ IS  F     256            DISK                                                   CLE041
     FLEAGFZPDIF  E                    DISK                                                   CLE041
     F            FCLTYZZF                          KRENAMEAGFCTYZF                           CLE041
     FLEFCAML7IF  E           K        DISK                                                   231062
0015 F*TABLE***IF**F      96 12AI     2 DISK                              S01194
0016 FFCLTBHH O   F     160            DISK
0016 F*CLTBFX O   F     160            DISK                               S01117
0016 F*FCLTBFX*O***F*****161            DISK                              S01117              231062
     FFCLTBFX O   F     231            DISK                                                   231062
0016 FFCLTBZZ O   F     160            DISK
0017 FLE0663AUO   F     132     OF     PRINTER                            S01117
0017 F*E0663P1O** F     132     OF     PRINTER                  S01124    S01117
0018 F*
0019 F* ID F  C  H  L    FUNCTION OF INDICATORS
0020 F* 01            FCLTY - HEADER
0021 F* 02                  - RECI'D', TYPE A
0022 F* 03                  - RECI'E', TYPE A
0023 F* 04                  - RECI'D' TYPE B
0024 F* 05                  - RECI'E', TYPE B
0025 F* 06                  - TRAILER
0026 F* 07                  - RECI 'R' OR 'C'
0027 F* 08                  - CATCHALL
0028 F**09******      TABLE - ICD-1                                       S01194
0029 F**
0030 F*      10       FIRST CYCLE INDICATOR
0031 F*      15       USED TO CHECK SEQUENCE OF RECORDS
0032 F*      16       USED TO CHECK SEQUENCE OF RECORDS
0033 F*      17       RECORDS OUT OF SEQUENCE
0034 F*      20       FACILITY EXCEEDED
0035 F*      25       FILE CONTROLS BALANCE
     F*                                                               *   CLE004
     F*       30      SAR CLE004 is present                           *   CLE004
      *       31      SAR CLE023 is present                           *                       CLE023
      *       32      End of file                                     *                       CLE041
     F*                                                               *   CLE004
0036 F*      40       OUTPUT FILE CONTROLS REPORT
     F*      50       DATE OF OUTSTANDING AMOUNT IS BEFORE EXPIRY DATE    061411
     F*      55       FACILITY EXPIRY DATE IS AFTER RUN DATE              061411
      *   80 -  End of file for LEFCAMPD                              *                       231062
0037 F**
0038 F*         U7U8 DATABASE ERROR
0039 F*         U8    FILE CONTROLS NOT BALANCE
     E                    CPY@    1   1 80
     E                    ##BR      999  3               Branch codes                         CSC042
     E                    ##BC      999  3               Company codes                        CSC042
      *                                                                                       231062
     E                    RUNS       10  5 0A                                                 231062
      ** Facility rundates array                                                              231062
     E                    FAMS       10 13 0                                                  231062
      ** Facility drawn amounts array                                                         231062
     E                    OAMS       10 13 0                                                  231062
      ** Facility amounts array                                                               231062
     E                    EXCS       10 13 0                                                  231062
      ** Facility excess amounts array                                                        231062
0040 F**
0041 I*
     ILEFCAMPF                                                                                231062
     I              BRCA                            BRCAA                                     231062
     I              CNUM                            CNUMA                                     231062
     I              FACT                            FACTA                                     231062
     I              FCNO                            FCNOA                                     231062
     I              RVCR                            RVCRA                                     231062
      *                                                                                       231062
0042 I*
0043 I**   FACILITIES FILE - HEADER
0044 I*
0045 I***FCLTY** NS  01   1 CH                                                                CLE041
0045 ILEFCLTLKNS  01   1 CH                                                                   CLE041
0046 I                                        1   1 RECI
0047 I*
0048 I**   FACILITIES FILE - DETAIL RECORD 1
0049 I*
0050 I        NS  02   1 CD  13 CA
0051 I       OR   03   1 CE  13 CA
0052 I                                        1   1 RECI
0053 I**********                              2   70CNUM                                      CSD027
0053 I                                        2   7 CNUM                                      CSD027
0054 I                                        8  100FACT
0055 I                                       11  120FCNO
0056 I                                       13  13 RCTP
     I                                       14  16 BRCA                  S01117
0057 I***********                            14  160BRCD                  S01117
0058 I                                       17  17 FCTI
0059 I                                       18  20 FCCY
0060 I                                    P  21  270FAMT
0061 I                                    P  28  303OVPC
0062 I                                    P  31  330DTAP
0063 I                                    P  34  360DTEX
0064 I                                       37  37 RVCR
0065 I                                       38  38 SECI
0066 I                                       39  39 MCCY
0067 I                                       40  40 MCSI
0068 I                                       41  41 NACD
0069 I                                       42  43 CRSK
0070 I                                    P  44  460DLFS
0071 I                                    P  47  527NOMR
0072 I                                    P  53  550RVDT
0073 I                                       56  56 RVFR
0074 I                                       57  580RVDY
0075 I                                       59  93 NAR1
0076 I                                       94 128 NAR2
0077 I                                      129 163 NAR3
0078 I                                      164 198 NAR4
0079 I                                    P 199 2050MTDH
0080 I                                    P 206 2120MTDL
0081 I                                    P 213 2190MTDA
0082 I                                    P 220 2270QTDA
0083 I                                    P 228 2350YTDA
0084 I                                      236 237 ACOF
     I                                    P 242 2440RVCD                  S01270
0085 I                                    P 247 2490ORED
0086 I                                    P 250 2520LCD
0087 I                                      253 253 CHTP
0088 I                                    P 254 2560TNLU
     I                                      401 401 PRTR                  CLE004
0089 I*   COMBINED FIELD FOR SEQUENCE CHECK
0090 I                                        1  12 DSA1
0091 I*   COMBINED FIELD FOR DATABASE MESSAGE
0092 I                                        2  13 KEY
0093 I*
0094 I**   FACILITIES FILE - DETAIL RECORD 2
0095 I*
0096 I        NS  04   1 CD  13 CB
0097 I       OR   05   1 CE  13 CB
0098 I                                        1   1 RECI
0099 I**********                              2   70CNUM                                      CSD027
0099 I                                        2   7 CNUM                                      CSD027
0100 I                                        8  100FACT
0101 I                                       11  120FCNO
0102 I                                       13  13 RCTP
0103 I                                       14  14 CMFT
0104 I                                       15  150CALC
0105 I                                    P  16  217SPRD
0106 I                                       22  230BCOD
0107 I                                    P  24  297BRAT
0108 I                                    P  30  320STDT
0109 I                                    P  33  350EDDT
0110 I                                    P  36  380DUDT
0111 I                                       39  39 BLFR
0112 I                                       40  410BLDN
0113 I                                       42  42 BTIN
0114 I                                       43  440BLDY
0115 I                                       45  460SETT
0116 I**********                             47  58 OBAC                                      CGL029
     I                                       47  58 OBACQQ                                    CGL029
0117 I                                       59  68 TNAC
0118 I                                    P  69  710SLCD
0119 I                                    P  72  740ACCD
0120 I                                    P  75  810ADNP
0121 I                                    P  82  880PDTD
0122 I                                    P  89  950AFPD
0123 I                                    P  96 1020ADJP
0124 I                                    P 103 1090ADJN
0125 I                                    P 110 1160TOTD
0126 I                                    P 117 1230CAMD
0127 I*****                               P 124 1300HFAM                  S01117
0127 I                                      130 130 MBFC                  S01117
     I                                    P 132 1380PEXP
0128 I                                    P 147 1490RUN0
0129 I                                    P 150 1520RUN1
0130 I                                    P 153 1550RUN2
0131 I                                    P 156 1580RUN3
0132 I                                    P 159 1610RUN4
0133 I                                    P 162 1640RUN5
0134 I                                    P 165 1670RUN6
0135 I                                    P 168 1700RUN7
0136 I                                    P 171 1730RUN8
0137 I                                    P 174 1760RUN9
0138 I                                    P 177 1830OAM1
0139 I                                    P 184 1900OAM2
0140 I                                    P 191 1970OAM3
0141 I                                    P 198 2040OAM4
0142 I                                    P 205 2110OAM5
0143 I                                    P 212 2180OAM6
0144 I                                    P 219 2250OAM7
0145 I                                    P 226 2320OAM8
0146 I                                    P 233 2390OAM9
0147 I                                    P 240 2460OA10
0148 I                                    P 247 2490ORED
0149 I                                    P 250 2520LCD
0150 I                                      253 253 CHTP
0151 I                                    P 254 2560TNLU
     I                                    P 257 2630CEXP                                      CLE023
     I                                      331 348 OBAC                                      CGL029
     I                                      401 401 PRTR                  CLE004
0152 I*   COMBINED FIELD FOR SEQUENCE CHECK
0153 I                                        1  12 DSB1
0154 I*   COMBINED FIELD FOR DATABASE MESSAGE
0155 I                                        2  13 KEY
0156 I*****************************************************************                       CLE041
0157 I*****FACILITIES*FILE*-*TRAILER***********************************                       CLE041
0158 I*****************************************************************                       CLE041
0159 I********NS  06   1 CT                                                                   CLE041
0160 I**********                              1   1 RECI                                      CLE041
0161 I**********                          P  17  190NORE                                      CLE041
0162 I**********                          P  20  220FLSZ                                      CLE041
0163 I**********                          P  23  250NLRB                                      CLE041
0164 I**********                          P  26  280NINS                                      CLE041
0165 I**********                          P  29  310NDEL                                      CLE041
0166 I**********                          P  32  340NLRA                                      CLE041
0167 I**********                          P  35  420VLBF                                      CLE041
0168 I**********                          P  43  440VLBL                                      CLE041
0169 I**********                          P  45  520VRIF                                      CLE041
0170 I**********                          P  53  540VRIL                                      CLE041
0171 I**********                          P  55  620VRDF                                      CLE041
0172 I**********                          P  63  640VRDL                                      CLE041
0173 I**********                          P  65  720VRAF                                      CLE041
0174 I**********                          P  73  740VRAL                                      CLE041
0175 I**********                          P  75  820VLAF                                      CLE041
0176 I**********                          P  83  840VLAL                                      CLE041
0177 I**********                          P 250 2520LCD                                       CLE041
0178 I**********                            253 253 CHTP                                      CLE041
0179 I**********                          P 254 2560TNLU                                      CLE041
0180 I*
0181 I*    FACILITIES FILE - REVERSED OR CLOSED
0182 I        NS  07   1 CR
0183 I       OR        1 CC
0184 I                                        1   1 RECI
0185 I*
0186 I*    FACILITIES FILE - CATCHALL
0187 I*
0188 I        NS  08
0189 I                                        1   1 RECI
0190 I                                        2  13 KEY
      *                                                                                       CLE041
      ** Aggregate Facilities file - detail record 1                                          CLE041
      *                                                                                       CLE041
     ILEAGFCL2NS  02   1 CD  13 CA                                                            CLE041
     I       OR   03   1 CE  13 CA                                                            CLE041
     I                                        1   1 RECI                                      CLE041
     I**********                              2   70CNUM                               CLE041 CSD027
     I                                        2   7 CNUM                                      CSD027
     I                                        8  100FACT                                      CLE041
     I                                       11  120FCNO                                      CLE041
     I                                       13  13 RCTP                                      CLE041
     I                                       14  16 BRCA                                      CLE041
     I                                       17  17 FCTI                                      CLE041
     I                                       18  20 FCCY                                      CLE041
     I                                    P  21  270FAMT                                      CLE041
     I                                    P  28  303OVPC                                      CLE041
     I                                    P  31  330DTAP                                      CLE041
     I                                    P  34  360DTEX                                      CLE041
     I                                       37  37 RVCR                                      CLE041
     I                                       38  38 SECI                                      CLE041
     I                                       39  39 MCCY                                      CLE041
     I                                       40  40 MCSI                                      CLE041
     I                                       41  41 NACD                                      CLE041
     I                                       42  43 CRSK                                      CLE041
     I                                    P  44  460DLFS                                      CLE041
     I                                    P  47  527NOMR                                      CLE041
     I                                    P  53  550RVDT                                      CLE041
     I                                       56  56 RVFR                                      CLE041
     I                                       57  580RVDY                                      CLE041
     I                                       59  93 NAR1                                      CLE041
     I                                       94 128 NAR2                                      CLE041
     I                                      129 163 NAR3                                      CLE041
     I                                      164 198 NAR4                                      CLE041
     I                                    P 199 2050MTDH                                      CLE041
     I                                    P 206 2120MTDL                                      CLE041
     I                                    P 213 2190MTDA                                      CLE041
     I                                    P 220 2270QTDA                                      CLE041
     I                                    P 228 2350YTDA                                      CLE041
     I                                      236 237 ACOF                                      CLE041
     I                                    P 242 2440RVCD                                      CLE041
     I                                    P 247 2490ORED                                      CLE041
     I                                    P 250 2520LCD                                       CLE041
     I                                      253 253 CHTP                                      CLE041
     I                                    P 254 2560TNLU                                      CLE041
     I                                      401 401 PRTR                                      CLE041
      *                                                                                       CLE041
      ** Combined field for sequence check                                                    CLE041
     I                                        1  12 DSA1                                      CLE041
      *                                                                                       CLE041
      ** Combined field for database message                                                  CLE041
     I                                        2  13 KEY                                       CLE041
      *                                                                                       CLE041
      ** Aggregate Facilities File - Detail Record 2                                          CLE041
      *                                                                                       CLE041
     I        NS  04   1 CD  13 CB                                                            CLE041
     I       OR   05   1 CE  13 CB                                                            CLE041
     I                                        1   1 RECI                                      CLE041
     I**********                              2   70CNUM                               CLE041 CSD027
     I                                        2   7 CNUM                                      CSD027
     I                                        8  100FACT                                      CLE041
     I                                       11  120FCNO                                      CLE041
     I                                       13  13 RCTP                                      CLE041
     I                                       14  14 CMFT                                      CLE041
     I                                       15  150CALC                                      CLE041
     I                                    P  16  217SPRD                                      CLE041
     I                                       22  230BCOD                                      CLE041
     I                                    P  24  297BRAT                                      CLE041
     I                                    P  30  320STDT                                      CLE041
     I                                    P  33  350EDDT                                      CLE041
     I                                    P  36  380DUDT                                      CLE041
     I                                       39  39 BLFR                                      CLE041
     I                                       40  410BLDN                                      CLE041
     I                                       42  42 BTIN                                      CLE041
     I                                       43  440BLDY                                      CLE041
     I                                       45  460SETT                                      CLE041
     I                                       47  58 OBACQQ                                    CLE041
     I                                       59  68 TNAC                                      CLE041
     I                                    P  69  710SLCD                                      CLE041
     I                                    P  72  740ACCD                                      CLE041
     I                                    P  75  810ADNP                                      CLE041
     I                                    P  82  880PDTD                                      CLE041
     I                                    P  89  950AFPD                                      CLE041
     I                                    P  96 1020ADJP                                      CLE041
     I                                    P 103 1090ADJN                                      CLE041
     I                                    P 110 1160TOTD                                      CLE041
     I                                    P 117 1230CAMD                                      CLE041
     I                                      130 130 MBFC                                      CLE041
     I                                    P 132 1380PEXP                                      CLE041
     I                                    P 147 1490RUN0                                      CLE041
     I                                    P 150 1520RUN1                                      CLE041
     I                                    P 153 1550RUN2                                      CLE041
     I                                    P 156 1580RUN3                                      CLE041
     I                                    P 159 1610RUN4                                      CLE041
     I                                    P 162 1640RUN5                                      CLE041
     I                                    P 165 1670RUN6                                      CLE041
     I                                    P 168 1700RUN7                                      CLE041
     I                                    P 171 1730RUN8                                      CLE041
     I                                    P 174 1760RUN9                                      CLE041
     I                                    P 177 1830OAM1                                      CLE041
     I                                    P 184 1900OAM2                                      CLE041
     I                                    P 191 1970OAM3                                      CLE041
     I                                    P 198 2040OAM4                                      CLE041
     I                                    P 205 2110OAM5                                      CLE041
     I                                    P 212 2180OAM6                                      CLE041
     I                                    P 219 2250OAM7                                      CLE041
     I                                    P 226 2320OAM8                                      CLE041
     I                                    P 233 2390OAM9                                      CLE041
     I                                    P 240 2460OA10                                      CLE041
     I                                    P 247 2490ORED                                      CLE041
     I                                    P 250 2520LCD                                       CLE041
     I                                      253 253 CHTP                                      CLE041
     I                                    P 254 2560TNLU                                      CLE041
     I                                    P 257 2630CEXP                                      CLE041
     I                                      331 348 OBAC                                      CLE041
     I                                      401 401 PRTR                                      CLE041
      *                                                                                       CLE041
      ** Combined field for sequence check                                                    CLE041
     I                                        1  12 DSB1                                      CLE041
      *                                                                                       CLE041
      ** Combined field for database message                                                  CLE041
     I                                        2  13 KEY                                       CLE041
      *                                                                                       CLE041
      ** Aggregate Facilities File - Reversed or CLosed                                       CLE041
      *                                                                                       CLE041
     I        NS  07   1 CR                                                                   CLE041
     I       OR        1 CC                                                                   CLE041
     I                                        1   1 RECI                                      CLE041
      *                                                                                       CLE041
      ** Aggregate Facilities file - catchall                                                 CLE041
      *                                                                                       CLE041
     I        NS  08                                                                          CLE041
     I                                        1   1 RECI                                      CLE041
     I                                        2  13 KEY                                       CLE041
      *                                                                                       CLE041
      ** Facilities File - Trailer                                                            CLE041
      *                                                                                       CLE041
     IFCLTYZZ NS  06   1 CT                                                                   CLE041
     I                                        1   1 RECI                                      CLE041
     I                                    P  17  190NORE                                      CLE041
     I                                    P  20  220FLSZ                                      CLE041
     I                                    P  23  250NLRB                                      CLE041
     I                                    P  26  280NINS                                      CLE041
     I                                    P  29  310NDEL                                      CLE041
     I                                    P  32  340NLRA                                      CLE041
     I                                    P  35  420VLBF                                      CLE041
     I                                    P  43  440VLBL                                      CLE041
     I                                    P  45  520VRIF                                      CLE041
     I                                    P  53  540VRIL                                      CLE041
     I                                    P  55  620VRDF                                      CLE041
     I                                    P  63  640VRDL                                      CLE041
     I                                    P  65  720VRAF                                      CLE041
     I                                    P  73  740VRAL                                      CLE041
     I                                    P  75  820VLAF                                      CLE041
     I                                    P  83  840VLAL                                      CLE041
     I                                    P 250 2520LCD                                       CLE041
     I                                      253 253 CHTP                                      CLE041
     I                                    P 254 2560TNLU                                      CLE041
      *                                                                                       CLE041
      ** Aggregate Facilities File - Trailer Record                                           CLE041
      *                                                                                       CLE041
     IAGFCTYZF                                                                                CLE041
     I              RECI                            AGRECI                                    CLE041
     I              NORE                            AGNORE                                    CLE041
     I              NLRB                            AGNLRB                                    CLE041
     I              NINS                            AGNINS                                    CLE041
     I              NDEL                            AGNDEL                                    CLE041
     I              NLRA                            AGNLRA                                    CLE041
     I              VLBF                            AGVLBF                                    CLE041
     I              VLBL                            AGVLBL                                    CLE041
     I              VRIF                            AGVRIF                                    CLE041
     I              VRIL                            AGVRIL                                    CLE041
     I              VRDF                            AGVRDF                                    CLE041
     I              VRDL                            AGVRDL                                    CLE041
     I              VRAF                            AGVRAF                                    CLE041
     I              VRAL                            AGVRAL                                    CLE041
     I              VLAF                            AGVLAF                                    CLE041
     I              VLAL                            AGVLAL                                    CLE041
     I              LCD                             AGLCD                                     CLE041
     I              CHTP                            AGCHTP                                    CLE041
     I              TNLU                            AGTNLU                                    CLE041
0191 I*
0192 I*****TABLE*FILE*-*INSTALLATION*CONTROL*DATA*RECORD*1.               S01194
0193 I*
0194 I*TABLE***NS  09   2 C0   3 C1  12 C1                                S01194
0195 I*******AND      13 C0                                               S01194
0196 I**********                              1   1 RECI                  S01194
0197 I**********                              2   30RECT                  S01194
0198 I**********                             12  130RCDE                  S01194
0199 I**********                             14  66 TITL                  S01194
0200 I**********                             67  67 DATF                  S01194
0201 I***********                            68  700DFBR                  S01194
0202 I**********                             74  74 MODI1                 S01194
0203 I**********                             75  75 MODI2                 S01194
0204 I**********                             76  76 MODI3                 S01194
0205 I**********                          P  77  790RUND                  S01194
0206 I**********                             80  86 RUNA                  S01194
0207 I**********                             87  870SFLG                  S01194
0208 I**********                          P  90  920LCD                   S01194
0209 I**********                             93  93 CHTP                  S01194
0210 I**********                          P  94  960TNLU                  S01194
0211 I**********                                                          S01194
0212 I*****TABLE*FILE*-*CATCH-ALL                                         S01194
0213 I**********                                                          S01194
0214 I********NS       1NCD                                               S01194
0215 I**********                              1   1 RECI                  S01194
0216 I**********                                                          S01194
0217 I*    LOCAL DATA AREA FOR DATABASE ERROR REFERENCES
0218 I*
0219 ILDA        UDS                            256
0220 I***********                           134 138 DBFILE                S01117
0221 I***********                           139 167 DBKEY                 S01117
0222 I***********                           168 175 DBPGM                 S01117
0223 I***********                           176 177 DBASE                 S01117
     I                                      134 141 DBFILE                S01117
     I                                      142 170 DBKEY                 S01117
     I                                      171 180 DBPGM                 S01117
     I                                      181 1830DBASE                 S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
      **  EXTERNAL DS FOR BRANCH CODE DETAILS                             S01117
     I              A8CMCD                          CMPYM                 S01194
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I**  EXTERNAL DS FOR BANK DETAILS                                    S01194
     I              BJURPT                          TITL                  S01194
     I              BJDFIN                          DATF                  S01194
     I              BJMRDT                          RUNA                  S01194
     ISDMMOD    E DSSDMMODPD                                              S01498
     I** Dummy record format for Module details                           S01498
     I*                                                                   S01498
     ISDLOMB    E DSSDLOMBPD                                              S01498
     I** Dummy record format for Portfolio Lending ICD.                   S01498
     I*                                                                   S01498
     ISDLBCS    E DSSDLBCSPD                                              S01498
     I** Dummy record format for Portfolio Lending Customer File          S01498
     I*                                                                   S01498
     ISCSARD    E DSSCSARDPD                                              CLE004
      ***  External data structures for SAR Details                       CLE004
      *                                                                   CLE004
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01498
     I*                                                                   S01498
     I** Second DS for access programs, long data structure               S01498
     I*                                                                   S01498
      *                                                                                       231062
     I            DS                                                                          231062
      ** Data structure of rundates                                                           231062
     I                                    P   1   30RUN0                                      231062
     I                                    P   4   60RUN1                                      231062
     I                                    P   7   90RUN2                                      231062
     I                                    P  10  120RUN3                                      231062
     I                                    P  13  150RUN4                                      231062
     I                                    P  16  180RUN5                                      231062
     I                                    P  19  210RUN6                                      231062
     I                                    P  22  240RUN7                                      231062
     I                                    P  25  270RUN8                                      231062
     I                                    P  28  300RUN9                                      231062
     I                                    P   1  300RUNS                                      231062
      *                                                                                       231062
     I            DS                                                                          231062
      ** Data structure of facility amounts                                                   231062
     I                                    P   1   70FAMT1                                     231062
     I                                    P   8  140FAMT2                                     231062
     I                                    P  15  210FAMT3                                     231062
     I                                    P  22  280FAMT4                                     231062
     I                                    P  29  350FAMT5                                     231062
     I                                    P  36  420FAMT6                                     231062
     I                                    P  43  490FAMT7                                     231062
     I                                    P  50  560FAMT8                                     231062
     I                                    P  57  630FAMT9                                     231062
     I                                    P  64  700FAM10                                     231062
     I                                    P   1  700FAMS                                      231062
      *                                                                                       231062
     I            DS                                                                          231062
      ** Data structure of facility drawn amounts                                             231062
     I                                    P   1   70OAM1                                      231062
     I                                    P   8  140OAM2                                      231062
     I                                    P  15  210OAM3                                      231062
     I                                    P  22  280OAM4                                      231062
     I                                    P  29  350OAM5                                      231062
     I                                    P  36  420OAM6                                      231062
     I                                    P  43  490OAM7                                      231062
     I                                    P  50  560OAM8                                      231062
     I                                    P  57  630OAM9                                      231062
     I                                    P  64  700OA10                                      231062
     I                                    P   1  700OAMS                                      231062
      *                                                                                       231062
     I            DS                                                                          231062
      ** Data structure of excess amounts                                                     231062
     I                                    P   1   70EXCS1                                     231062
     I                                    P   8  140EXCS2                                     231062
     I                                    P  15  210EXCS3                                     231062
     I                                    P  22  280EXCS4                                     231062
     I                                    P  29  350EXCS5                                     231062
     I                                    P  36  420EXCS6                                     231062
     I                                    P  43  490EXCS7                                     231062
     I                                    P  50  560EXCS8                                     231062
     I                                    P  57  630EXCS9                                     231062
     I                                    P  64  700EXC10                                     231062
     I                                    P   1  700EXCS                                      231062
      *                                                                                       231062
     C**********           MOVEACPY@      BIS@   80                                           CSC042
0224 C********************************************************************
     C** PARAMETER LIST FOR PROGRAM 'AOBANKR0'                            S01194
     C           PLISTA    PLIST                                          S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C**                                                                  S01194
0225 C******     FIRST CYCLE PROCESSING              *********************
0226 C*
0227 C   10                GOTO ENDFC
0228 C                     SETON                     10
     C                     MOVEACPY@      BIS@   80                                           CSC042
0229 C*
     C*    DEFINE LDA                                                     S01117
     C           *NAMVAR   DEFN           LDA                             S01117
     C           *LOCK     IN   LDA                                       S01117
     C*
0230 C*    COUNT HEADER INPUT
0231 C                     Z-ADD1         NORI    50
0232 C*
0233 C* SET UP DATABASE ERROR REFS IN LDA
0234 C                     MOVE 'LE0663  'DBPGM
0235 C                     MOVE ' '       BLANKS 29
0236 C                     MOVE BLANKS    DBKEY
0237 C*
0238 C* ACCESS ICD-1 FOR REPORT. DATABASE ERROR IF NOT FOUND.
     C                     CALL 'AOBANKR0'PLISTA                          S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                     U7U8LR               S01194
     C                     MOVE '01'      DBASE                           S01194
     C                     MOVE 'SDBANKPD'DBFILE                          S01194
     C                     GOTO ENDD                                      S01194
     C                     END                                            S01194
     C*    CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
     C           DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
      *                                                                   CLE004
      ** Check if SAR CLE004 is present                                   CLE004
      *                                                                   CLE004
     C                     CALL 'AOSARDR0'                                CLE004
     C                     PARM *BLANKS   P@RTCD  7                       CLE004
     C                     PARM '*KEY   ' P@OPTN  7                       CLE004
     C                     PARM 'CLE004'  P@SARD  6                       CLE004
     C           SCSARD    PARM SCSARD    DSFDY                           CLE004
      *                                                                   CLE004
     C           P@RTCD    IFEQ *BLANKS                                   CLE004
     C                     MOVE *ON       *IN30                           CLE004
     C                     ENDIF                                          CLE004
      *                                                                                       CLE023
      ** Check if Lending Facility Improvements CLE023 is installed                           CLE023
      *                                                                                       CLE023
     C                     CALL 'AOSARDR0'                                                    CLE023
     C                     PARM *BLANKS   P@RTCD                                              CLE023
     C                     PARM '*KEY   ' P@OPTN                                              CLE023
     C                     PARM 'CLE023'  P@SARD                                              CLE023
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE023
      *                                                                                       CLE023
     C           P@RTCD    IFEQ *BLANKS                                                       CLE023
     C                     MOVE '1'       *IN31                                               CLE023
     C                     ENDIF                                                              CLE023
      *                                                                                       CLE023
      ** from LEC0710, if *INU1 is *ON, CLE025 is *ON                                         CLE041
      *                                                                                       CLE041
     C                     MOVE 'N'       CLE025  1                                           CLE041
     C           *INU1     IFEQ *ON                                                           CLE041
     C                     MOVE 'Y'       CLE025                                              CLE041
     C                     ENDIF                                                              CLE041
      *                                                                                       CLE041
     C           *LIKE     DEFN NORE      WNORE                                               CLE041
     C           *LIKE     DEFN VLAF      WVLAF                                               CLE041
     C           *LIKE     DEFN VLAL      WVLAL                                               CLE041
      *                                                                                       CLE041
     C/COPY WNCPYSRC,LE0663C001
      *                                                                   S01498
      ** Call Access Program for Module Details                           S01498
     C                     CALL 'AOMMODR0'                                S01498
     C                     PARM '*MSG    '@RTCD   7                       S01498
     C                     PARM '*FIRST  '@OPTN   7                       S01498
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01498
      *                                                                   S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C                     MOVEL'SDMMODPD'DBFILE            ************* S01498
     C                     MOVEL'08'      DBASE             *DBERROR 008* S01498
     C                     MOVEL@OPTN     DBOPTN  7         ************* S01498
     C                     SETON                     U7U8LR               S01498
     C                     EXSR *PSSR                                     S01498
     C                     GOTO ENDD                                      S01498
     C                     END                                            S01498
      *                                                                   S01498
      ** Call Access Program for Portfolio Lending ICD.                   S01498
     C           BGLMCR    IFEQ 'Y'                                       S01498
     C                     CALL 'AOLOMBR0'                                S01498
     C                     PARM '*MSG    '@RTCD   7                       S01498
     C                     PARM '*FIRST  '@OPTN   7                       S01498
     C           SDLOMB    PARM SDLOMB    DSFDY                           S01498
      *                                                                   S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C                     MOVEL'SDLOMBPD'DBFILE            ************* S01498
     C                     MOVEL'09'      DBASE             *DBERROR 009* S01498
     C                     MOVEL@OPTN     DBOPTN  7         ************* S01498
     C                     SETON                     U7U8LR               S01498
     C                     EXSR *PSSR                                     S01498
     C                     GOTO ENDD                                      S01498
     C                     END                                            S01498
     C                     END                                            S01498
      *                                                                   S01498
     C*                                                                   S01194
0638 C**********           EXSR ZSYSTM                                    S01194
0240 C***99*****           SETON                     U7U8LR               S01194
0241 C***99*****           MOVE '01'      DBASE                           S01194
0242 C***99*****           MOVE 'TABLE'   DBFILE                          S01194
0243 C***99*****           MOVELZTABKY    DBKEY                           S01194
0244 C***99*****           GOTO ENDD                                      S01194
0245 C*
     C                     Z-ADD0         ##BNDX  40                                          CSC042
     C           *LIKE     DEFN ##BNDX    B                                                   CSC042
     C           *LIKE     DEFN ##BNDX    ##BSV                                               CSC042
      *                                                                                       CSC042
0246 C*   COUNT HEADER OUTPUT TO EXTRACT FILE
0247 C                     Z-ADD1         NROP    50
0248 C                     GOTO ENDD
0249 C*
0250 C*
0251 C********************************************************************
0252 *******     MAIN PROCESSING                     *********************
0253 C*
0254 C           ENDFC     TAG                             ** ENDFC TAG **
0255 C*
0256 C* COUNT NO. RECORDS INPUT - ALL TYPES EXCEPT DELETED(*).
0257 C  N08      NORI      ADD  1         NORI    50
      *                                                                   S01498
      ** If Portfolio Lending is switched on, if a LB customer            S01498
      ** is selected for extraction ignore it when the LB setup           S01498
      ** is to, not include LB customers for DL Exposure reports.         S01498
      *                                                                   S01498
     C           BGLMCR    IFEQ 'Y'                                       S01498
     C           LBLCLE    ANDEQ'N'                                       S01498
      *                                                                   S01498
      ** Call Access Program to determine if a LB Customer.               S01498
     C                     MOVELCNUM      @AENB                           S01498
     C                     CALL 'AOLBCSR0'                                S01498
     C                     PARM '*MSG    '@RTCD                           S01498
     C                     PARM '*KEY    '@OPTN                           S01498
     C                     PARM           @AENB  10                       S01498
     C**********           PARM *BLANKS   @KYST   7                S01498 222373
     C           SDLBCS    PARM SDLBCS    DSSDY                           S01498
     C*                                                                   S01498
     C           @RTCD     IFNE *BLANK                                    S01498
     C           @RTCD     ANDNE'*NRF'                                    S01498
     C                     MOVEL'SDLBCSPD'DBFILE            ************* S01498
     C                     MOVEL'10'      DBASE             *DBERROR 010* S01498
     C                     MOVEL@OPTN     DBOPTN            ************* S01498
     C                     MOVELCNUM      DBKEY  29                       S01498
     C                     SETON                     U7U8LR               S01498
     C                     EXSR *PSSR                                     S01498
     C                     END                                            S01498
      *                                                                   S01498
      ** Customer is a LB customer - ignore.                              S01498
     C           @RTCD     IFEQ *BLANKS                                   S01498
     C                     GOTO ENDD                                      S01498
     C                     END                                            S01498
     C                     END                                            S01498
0258 C*
0259 C* SETOF OUTPUT INDICATOR
0260 C                     SETOF                     20
0261 C*
0262 C* IF NOT RECI 'D','E' OR 'T', NO FURTHER PROCESSING
0263 C   07
0264 COR 08                GOTO ENDD
0265 C*
0266 C* CHECK SEQUENCE - CORRECT'B'RECORD FOLLOWS'A'RECORD.
0267 C* IF NOT, DATABASE ERROR
0268 C   15N04
0269 COR 16N05             SETON                     17    17=SEQ.ERROR
0270 C*
0271 C   04N17
0272 COR 05N17   DSA1      COMP DSB1                 1717
0273 C   17                SETON                     U7U8LR
0274 C   17                MOVE '02'      DBASE
0275 C   17                MOVE 'FCLTY'   DBFILE
0276 C   17                MOVELKEY       DBKEY
0277 C   17                GOTO ENDD
0278 C*
0279 C* SET INDICATOR FOR NEXT SEQUENCE CHECK
0280 C   02                SETON                     15
0281 C   03                SETON                     16
0282 C   04                SETOF                     15
0283 C   05                SETOF                     16
0284 C*
0285 C* GO TO FURTHER PROCESSING WHERE APPLICABLE
0286 C   02
0287 COR 03                GOTO HASH
0288 C**                  (AND THEN TO END)
0289 C   04                GOTO DETB
     C/COPY WNCPYSRC,LE0663C002
0290 C   05                GOTO ENDD
     C/COPY WNCPYSRC,LE0663C003
0291 C   06                GOTO TRAILR
0292 C*
0293 C*
0294 C********************************************************************
0295 C******     PROCESSING TO HASH TOTAL FAC.AMOUNT    ******************
0296 C*****      (INPUT) ON LIVE 'A' RECORDS            ******************
0297 C*
0298 C*
0299 C           HASH      TAG                             ** HASH TAG **
0300 C*
0301 C                     Z-ADD0         ZZAMT
0302 C                     MOVE FAMT      ZZAMT
     C           ZZAMT     IFLT 0                                                             193603
     C                     Z-SUBZZAMT     ZZAMT                                               193603
     C                     END                                                                193603
0303 C                     Z-ADDINTOTI    ZZTOTI
0304 C                     Z-ADDINTOTD    ZZTOTD
0305 C                     EXSR GLZADD
0306 C                     Z-ADDZZTOTI    INTOTI 150
0307 C                     Z-ADDZZTOTD    INTOTD  30
0308 C*
0309 C                     GOTO ENDD
0310 C*
0311 C*
0312 C********************************************************************
0313 C**** PROCESSING FOR 'D'RECORDS,TYPE B.         *********************
0314 C***  IF FACILITY EXCEEDED, OUTPUT RECORD TO FCLTB. *****************
0315 C*
0316 C*
0317 C*
0318 C           DETB      TAG                             ** DETB TAG **
     C**                                                                  061411
     C/COPY WNCPYSRC,LE0663C004
     C**   CHECK WHETHER RUN DATE IS AFTER EXPIRY DATE OF FACILITY        061411
     C**                                                                  061411
     C           DTEX      COMP BJRDNB               55                   061411
     C  N55                GOTO SKIP                                      061411
     C**                                                                  061411
     C**   NO AMOUNT OUTSTANDING IF DATE PAST EXPIRY DATE                 061411
     C**                                                                  061411
     C           DTEX      COMP RUN0                 50                   061411
     C  N50                Z-ADD0         OAM1                            061411
     C           DTEX      COMP RUN1                 50                   061411
     C  N50                Z-ADD0         OAM2                            061411
     C           DTEX      COMP RUN2                 50                   061411
     C  N50                Z-ADD0         OAM3                            061411
     C           DTEX      COMP RUN3                 50                   061411
     C  N50                Z-ADD0         OAM4                            061411
     C           DTEX      COMP RUN4                 50                   061411
     C  N50                Z-ADD0         OAM5                            061411
     C           DTEX      COMP RUN5                 50                   061411
     C  N50                Z-ADD0         OAM6                            061411
     C           DTEX      COMP RUN6                 50                   061411
     C  N50                Z-ADD0         OAM7                            061411
     C           DTEX      COMP RUN7                 50                   061411
     C  N50                Z-ADD0         OAM8                            061411
     C           DTEX      COMP RUN8                 50                   061411
     C  N50                Z-ADD0         OAM9                            061411
     C           DTEX      COMP RUN9                 50                   061411
     C  N50                Z-ADD0         OA10                            061411
     C**                                                                  061411
     C           SKIP      TAG                             ***SKIP TAG ***061411
0319 C*
0320 C*
0321 C* EXCESS = DRAWN AMT DAYX - {FAMT + (FAMT MULT OVPC, DIV 100)}
0322 C*
      *                                                                                       231062
      ** Consider future facility amendments in determining the                               231062
      ** facility amount                                                                      231062
      *                                                                                       231062
     C           KEY001    KLIST                                                              231062
     C                     KFLD           BRCA                                                231062
     C                     KFLD           CNUM                                                231062
     C                     KFLD           FACT                                                231062
     C                     KFLD           FCNO                                                231062
      *                                                                                       231062
     C                     Z-ADDFAMT      FAMS                                                231062
     C                     Z-ADD0         EXCS                                                231062
      *                                                                                       231062
      ** Access facility amendment file LEFCAMPD                                              231062
      *                                                                                       231062
     C                     Z-ADD1         S       20                                          231062
     C           S         DOWLE10                                                            231062
     C           KEY001    SETLLLEFCAML7                                                      231062
     C           KEY001    READELEFCAML7                 80                                   231062
     C           *IN80     DOWEQ'0'                                                           231062
     C           VLDT      ANDLERUNS,S                                                        231062
     C                     SELEC                                                              231062
     C           FATP      WHEQ 'FI'                                                          231062
     C                     ADD  AAMT      FAMS,S                                              231062
     C           FATP      WHEQ 'FD'                                                          231062
     C                     SUB  AAMT      FAMS,S                                              231062
     C                     ENDSL                                                              231062
     C           KEY001    READELEFCAML7                 80                                   231062
     C                     ENDDO                                                              231062
     C                     ADD  1         S                                                   231062
     C                     ENDDO                                                              231062
      *                                                                                       231062
      ** Consider the overline percentage in computing for the                                231062
      ** facility amount                                                                      231062
      *                                                                                       231062
     C                     Z-ADD1         S                                                   231062
     C           OVPC      DIV  100       WRK1    55                                          231062
     C           S         DOWLE10                                                            231062
     C           WRK1      MULT FAMS,S    WRK2   130H                                         231062
     C                     ADD  WRK2      FAMS,S                                              231062
     C                     ADD  1         S                                                   231062
     C                     ENDDO                                                              231062
      *                                                                                       231062
      ** Compute for the excess amount                                                        231062
      *                                                                                       231062
     C                     Z-ADD1         S                                                   231062
     C           S         DOWLE10                                                            231062
     C           OAMS,S    SUB  FAMS,S    EXCS,S                                              231062
     C           EXCS,S    IFGT 0                                                             231062
     C                     MOVE '1'       *IN20                                               231062
     C                     ENDIF                                                              231062
     C                     ADD  1         S                                                   231062
     C                     ENDDO                                                              231062
      *                                                                                       231062
0323 C********** OVPC      DIV  100       WRK1    55                                          231062
0324 C********** WRK1      MULT FAMT      WRK2   130H                                         231062
0325 C********** WRK2      ADD  FAMT      WRK3   130                                          231062
0326 C*
0327 C********** OAM1      SUB  WRK3      EXCS1  130 20                                       231062
0328 C**N20***** OAM2      SUB  WRK3      EXCS2  130 20                                       231062
0329 C**N20***** OAM3      SUB  WRK3      EXCS3  130 20                                       231062
0330 C**N20***** OAM4      SUB  WRK3      EXCS4  130 20                                       231062
0331 C**N20***** OAM5      SUB  WRK3      EXCS5  130 20                                       231062
0332 C**N20***** OAM6      SUB  WRK3      EXCS6  130 20                                       231062
0333 C**N20***** OAM7      SUB  WRK3      EXCS7  130 20                                       231062
0334 C**N20***** OAM8      SUB  WRK3      EXCS8  130 20                                       231062
0335 C**N20***** OAM9      SUB  WRK3      EXCS9  130 20                                       231062
0336 C**N20***** OA10      SUB  WRK3      EXC10  130 20                                       231062
     C**                                                                  S01117
     C**  TO GET COMPANY NAME FOR OUTPUT TO FCLTB                         S01117
     C* Check whether details for Branch already in array                                     CSC042
     C                     MOVELBRCA      ##KB                                                CSC042
     C                     EXSR ##CHKB                                                        CSC042
      * If branch is in the array then use the details                                        CSC042
     C           ##FIC     IFEQ 'Y'                        *** B10                            CSC042
     C                     EXSR ##SETB                                                        CSC042
     C                     ELSE                            *** X10                            CSC042
     C**********           CALL 'AOBRCHR0'                                             S01117 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRCA      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        S01117 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
      *                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     MOVEL@DSNB     DBKEY                           S01117
     C                     MOVEL'SDBRCHPD'DBFILE           ***************S01117
     C                     Z-ADD03        DBASE            * DBERROR 003 *S01117
     C                     SETON                     U7U8LR **************S01117
     C                     GOTO ENDD                                      S01117
     C                     ELSE                                                               CSC042
      * Details found on the DB so add them to the array                                      CSC042
      * if the array still has room                                                           CSC042
     C                     EXSR ##ADDB                                                        CSC042
     C                     END                                            S01117
     C                     ENDIF                           *** E10                            CSC042
0337 C*
0338 C*
0339 C* FACILITY EXCEEDED, COUNT RECORD OUTPUT
0340 C   20      NROP      ADD  1         NROP
0341 C*
0342 C* AND # TOTAL FAMT OUTPUT
0343 C   20                Z-ADD0         ZZAMT
0344 C   20                MOVE FAMT      ZZAMT
     C   20      ZZAMT     IFLT 0                                                             193603
     C                     Z-SUBZZAMT     ZZAMT                                               193603
     C                     END                                                                193603
0345 C   20                Z-ADDOUTOTI    ZZTOTI
0346 C   20                Z-ADDOUTOTD    ZZTOTD
0347 C   20                EXSR GLZADD
0348 C   20                Z-ADDZZTOTI    OUTOTI 150
0349 C   20                Z-ADDZZTOTD    OUTOTD  30
0350 C*
0351 C                     GOTO ENDD
0352 C*
0353 C*
0354 C********************************************************************
0355 C******     TRAILER PROCESSING                  *********************
0356 C*
0357 C           TRAILR    TAG                             ** TRAILR TAG**
      *                                                                                       CLE041
     C           CLE025    IFEQ 'Y'                                                           CLE041
     C                     READ LEAGFZPD                 32                                   CLE041
     C                     ENDIF                                                              CLE041
      *                                                                                       CLE041
     C           CLE025    IFEQ 'Y'                                                           CLE041
     C           *IN32     ANDEQ*OFF                                                          CLE041
     C           NORE      ADD  AGNORE    WNORE                                               CLE041
      *                                                                                       CLE041
      ** Header and trailer record count for AGFCTY are redundant for                         CLE041
      ** the extract file, hence remove them from record count                                CLE041
      *                                                                                       CLE041
     C           WNORE     SUB  2         WNORE                                               CLE041
      *                                                                                       CLE041
     C           VLAF      ADD  AGVLAF    WVLAF                                               CLE041
     C           VLAL      ADD  AGVLAL    WTMP40  40                                          CLE041
     C           WTMP40    IFGT 999                                                           CLE041
     C                     ADD  1         WVLAF                                               CLE041
     C                     ENDIF                                                              CLE041
     C                     MOVE WTMP40    WVLAL                                               CLE041
      *                                                                                       CLE041
      ** Compare input file controls calculated with agg/facility trailer                     CLE041
      *                                                                                       CLE041
     C           NORI      COMP WNORE                    25                                   CLE041
     C   25      INTOTI    COMP WVLAF                    25                                   CLE041
     C   25      INTOTD    COMP WVLAL                    25                                   CLE041
     C  N25                SETON                     U8                                       CLE041
      *                                                                                       CLE041
     C                     ELSE                                                               CLE041
0358 C*
0359 C* COMPARE INPUT FILE CONTROLS CALCULATED WITH FCLTY TRAILER.
0360 C           NORI      COMP NORE                     25
0361 C   25      INTOTI    COMP VLAF                     25
0362 C   25      INTOTD    COMP VLAL                     25
0363 C  N25                SETON                     U8
      *                                                                                       CLE041
     C                     Z-ADDNORE      WNORE                                               CLE041
     C                     Z-ADDVLAF      WVLAF                                               CLE041
     C                     Z-ADDVLAL      WVLAL                                               CLE041
     C                     ENDIF                                                              CLE041
0364 C*
0365 C* COUNT RECORD OUTPUT
0366 C           NROP      ADD  1         NROP
0367 C*
0368 C           ENDD      TAG                             ** ENDD TAG **
0369 C*
      **                                                                  S01117
      **   EXCUTE ERROR ROUTINE IF DATABASE ERROR EXISTS                  S01117
      **                                                                  S01117
     CLR         *INU7     IFEQ '1'                                       S01117
     CLR         *INU8     ANDEQ'1'                                       S01117
     CLR                   EXSR *PSSR                                     S01117
     CLR                   END                                            S01117
0372 C********************************************************************
0373 C********************************************************************
      /EJECT                                                                                  CSC042
     C********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##CHKB - Subroutine to check the Branch in the arrays                                 CSC042
      *                                                                                       CSC042
     C           ##CHKB    BEGSR                                                              CSC042
      *                                                                                       CSC042
     C           *LIKE     DEFN A8BRCD    ##KB                                                CSC042
      *                                                                                       CSC042
      * Set off the branch found indicator                                                    CSC042
     C                     MOVEL*BLANK    ##FIC   1                                           CSC042
      *                                                                                       CSC042
      * Save the state of indicator 30 so it can be reset at the end                          CSC042
      * of the SR as it may be used elsewhere in the code                                     CSC042
     C           *IN30     IFEQ *ON                                                           CSC042
     C                     MOVEL'Y'       #IN30   1                                           CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL'N'       #IN30                                               CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
     C                     SETOF                         30                                   CSC042
      *                                                                                       CSC042
      * Restore the saved Value of B                                                          CSC042
     C                     Z-ADD##BSV     B                                                   CSC042
      *                                                                                       CSC042
     C* Check whether details for Branch already in array                                     CSC042
      *                                                                                       CSC042
      * Is this the same as the last LOKUP, if so we can bypass                               CSC042
      * the LOKUP                                                                             CSC042
      * Defend against B being 0                                                              CSC042
     C           B         IFEQ 0                                                             CSC042
     C                     Z-ADD1         B                                                   CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * If the branch being checked is the same then use these                                CSC042
      * details rather than doing a LOKUP                                                     CSC042
     C           ##KB      IFEQ ##BR,B                                                        CSC042
      * Found so seton 30                                                                     CSC042
     C                     SETON                         30                                   CSC042
     C                     ELSE                                                               CSC042
     C                     Z-ADD1         B                                                   CSC042
     C           ##KB      LOKUP##BR,B                   30                                   CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * Save the last update to B                                                             CSC042
     C           *IN30     IFEQ *ON                                                           CSC042
     C                     Z-ADDB         ##BSV                                               CSC042
      * Set the indicator to show the data was found                                          CSC042
     C                     MOVEL'Y'       ##FIC                                               CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * Reset the state of indicator 30.                                                      CSC042
     C           #IN30     IFEQ 'Y'                                                           CSC042
     C                     MOVEL*ON       *IN30                                               CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL*OFF      *IN30                                               CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
      ********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##SETB - Sets up the SDBRCHPD fields used in the code from the                        CSC042
      * arrays                                                                                CSC042
      *                                                                                       CSC042
     C           ##SETB    BEGSR                                                              CSC042
      *                                                                                       CSC042
     C                     MOVEL##BR,B    A8BRCD                                              CSC042
     C                     MOVEL##BC,B    CMPYM                                               CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      *                                                                                       CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
      ********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##ADDB - Adds the SDBRCHPD fields used in the code to the                             CSC042
      * arrays                                                                                CSC042
      *                                                                                       CSC042
     C           ##ADDB    BEGSR                                                              CSC042
      *                                                                                       CSC042
      * If there is still room in the array then add the details                              CSC042
     C           ##BNDX    IFLT 999                                                           CSC042
     C                     ADD  1         ##BNDX                                              CSC042
     C                     Z-ADD##BNDX    B                                                   CSC042
     C                     MOVELA8BRCD    ##BR,B                                              CSC042
     C                     MOVELCMPYM     ##BC,B                                              CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * Update ##BSV  so next call to ##CHKB checks this latest adddition                     CSC042
      * to the array first                                                                    CSC042
     C                     Z-ADDB         ##BSV                                               CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
      ********************************************************************                    CSC042
0374 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
0375 C*   IND '99' IS SET BY AN OVERFLOW ERROR
0376 C*
0377 CSR         GLZADD    BEGSR                           *** GLZADD ****
0378 C*
0379 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
0380 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
0381 C*
0382 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
0383 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
0384 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
0385 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
0386 C*
0387 CSR                   EXSR GLZSUM
0388 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
0389 C*
0390 C********************************************************************
0391 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
0392 C*                        GLZADD, GLZSUB, GLZCMP.
0393 C*          PARAMETERS PASSED -
0394 C*                     I/P ZZAMTI ZZAMTD
0395 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
0396 C*
0397 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
0398 C*
0399 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
0400 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
0401 CSR                   SETOF                     919293
0402 CSR                   SETOF                     949599
0403 C*
0404 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
0405 CSR         ZZAMTI    COMP 0                      9293
0406 CSR 93      ZZAMTD    COMP 0                      9293
0407 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0408 C*
0409 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
0410 CSR         ZZTOTI    COMP 0                      9193
0411 CSR 93      ZZTOTD    COMP 0                      9193
0412 C*
0413 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
0414 CSR 93                Z-ADDZZAMTI    ZZTOTI
0415 CSR 93                Z-ADDZZAMTD    ZZTOTD
0416 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0417 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
0418 CSR 91N92
0419 CORN91 92             GOTO ZZOFPS
0420 C*
0421 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
0422 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
0423 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
0424 C*
0425 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
0426 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
0427 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
0428 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
0429 C*
0430 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
0431 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
0432 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
0433 CSRN99                Z-ADDZZWK2     ZZTOTD
0434 CSRN99                Z-ADDZZWK3     ZZTOTI
0435 C*
0436 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
0437 CSR 99                Z-ADD0         ZZAMT  153
0438 CSR                   GOTO ZZSEND
0439 C*
0440 C* THE 'SIGNS' ARE DIFFERENT
0441 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
0442 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
0443 C*
0444 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
0445 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
0446 C*
0447 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
0448 C*
0449 CSR 91                Z-SUBZZTOTI    ZZTOTI
0450 CSR 91                Z-SUBZZTOTD    ZZTOTD
0451 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
0452 C*
0453 CSR         ZZTOTI    COMP ZZAMTI               93  95
0454 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
0455 C*
0456 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
0457 CSR 95                Z-ADD0         ZZTOTI
0458 CSR 95                Z-ADD0         ZZTOTD
0459 CSR 95                GOTO ZZSEND
0460 C*
0461 C* IF ZZTOT GT. ZZAMT.
0462 CSR 93      ZZAMTD    COMP ZZTOTD               94
0463 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
0464 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
0465 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
0466 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
0467 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
0468 C*
0469 C*
0470 C* IF ZZAMT GT. ZZTOT.
0471 CSRN93      ZZTOTD    COMP ZZAMTD               94
0472 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
0473 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
0474 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
0475 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
0476 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
0477 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
0478 C*
0479 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
0480 CSR                   SETOF                     94
0481 CSR 93 91
0482 CORN93 92             SETON                     94
0483 CSR 94                Z-SUBZZTOTI    ZZTOTI
0484 CSR 94                Z-SUBZZTOTD    ZZTOTD
0485 C**
0486 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
0487 CSR 92                Z-SUBZZAMTI    ZZAMTI
0488 CSR 92                Z-SUBZZAMTD    ZZAMTD
0489 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
0490 C**
0491 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
0492 CSR                   SETOF                     96
0493 CSR         ZZTOTD    COMP 0                        91
0494 CSR 91      ZZTOTI    COMP 0                      96
0495 CSR 96                MOVE '.000-'   ZZNEGD  5
0496 CSR                   ENDSR                             ** ENDSR **
0497 C********************************************************************
0498 C**
1918 C*****ZSYSTM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   S01194
1919 C**********                                                          S01194
1920 C********** ZSYSTM    BEGSR                           *** ZSYSTM *** S01194
1921 C**********                                                          S01194
1922 C*****SET*UP KEY FOR INSTALLATION CONTROL RECORD.                    S01194
1923 C**********           MOVEL'01      'ZTABKY 12                       S01194
1924 C**********           MOVE '  10'    ZTABKY                          S01194
1925 C**********                                                          S01194
1926 C********** ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
1927 C**N99***** RECI      COMP 'D'                  9999  ON, IS DELETED S01194
1928 C**********                                                          S01194
1929 C*****CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
1930 C********** DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
1931 C**********                                                          S01194
1932 C**********           ENDSR                                          S01194
0514 C**
0515 C**
0516 C********************************************************************
     C*                                                                   S01117
     C* *PSSR  --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
     C*                                                                   S01117
     C* CALLED FROM: AFTER ABNORNAL OPERATION OCCURS                      S01117
     C*                                                                   S01117
     C* CALLS: NOTHING                                                    S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C********************************************************************S01117
0517 OFCLTBHH H        01
0518 O                                    1 'H'
0519 OFCLTBFX D        20
0520 O                                    1 'D'
     O                         BRCA       4                               S01117
0521 O***********              BRCD       4                               S01117
0522 O                         CNUM      10
0523 O                         FACT      13
0524 O                         FCNO      15
0525 O                         FCCY      18
0526 O                         FAMT      25P
0527 O                         RUN0      33P
0528 O                         RUN1      36P
0529 O                         RUN2      39P
0530 O                         RUN3      42P
0531 O                         RUN4      45P
0532 O                         RUN5      48P
0533 O                         RUN6      51P
0534 O                         RUN7      54P
0535 O                         RUN8      57P
0536 O                         RUN9      60P
0537 O                         OAM1      67P
0538 O                         OAM2      74P
0539 O                         OAM3      81P
0540 O                         OAM4      88P
0541 O                         OAM5      95P
0542 O                         OAM6     102P
0543 O                         OAM7     109P
0544 O                         OAM8     116P
0545 O                         OAM9     123P
0546 O                         OA10     130P
0547 O                         DTEX     133P
0548 O                         PEXP     140P
     O                 31      CEXP     140P                                                  CLE023
0549 O                         OVPC     143P
0550 O                         RVCR     144
     O                         MBFC     145                               S01117
     O                         CMPYM    160                               S01117
     O                 30      PRTR     161                               CLE004
     O                         EXCS1    168P                                                  231062
     O                         EXCS2    175P                                                  231062
     O                         EXCS3    182P                                                  231062
     O                         EXCS4    189P                                                  231062
     O                         EXCS5    196P                                                  231062
     O                         EXCS6    203P                                                  231062
     O                         EXCS7    210P                                                  231062
     O                         EXCS8    217P                                                  231062
     O                         EXCS9    224P                                                  231062
     O                         EXC10    231P                                                  231062
0551 O*
0552 O**  TRAILER FIELDS: NROP FOR NORE, OUTOTI/D FOR VLRF/L.
0553 OFCLTBZZ D        06
0554 O                                    1 'T'
0555 O                         NROP      16P
0556 O                         OUTOTI    24P
0557 O                         OUTOTD    26P
0558 O**
0559 O**
0560 O**0663P1T**203   LR U7 U8                                 S01124    S01117
0561 O***********                        22 'REFERENCE LE0663'            S01117
0562 O***********              TITL      89                               S01117
0563 O***********                       104 'DATE'                        S01117
0564 O***********              RUNA     112                               S01117
0565 O***********                       122 'PAGE'                        S01117
0566 O***********              PAGE     127                               S01117
0567 O********T**   21 LR U7 U8                                           S01117
0568 O***********                        47 '---------------'             S01117
0569 O***********                        68 'FACILITIES EXCEEDED'         S01117
0570 O***********                        76 'EXTRACT'                     S01117
0571 O***********                        93 '---------------'             S01117
0572 O********T**2     LR U7 U8                                           S01117
0573 O***********                        51 '*** REFERENCE LE0663'        S01117
0574 O***********                        71 'DATABASE ERROR AT'           S01117
0575 O***********              DBASE     74                               S01117
0576 O********T**1     LR U7 U8                                           S01117
0577 O***********                        37 'FILENAME'                    S01117
0578 O***********              DBFILE    43                               S01117
0579 O***********                        48 'KEY'                         S01117
0580 O***********              DBKEY     78                               S01117
0581 O********T**203   LR                                                 S01117
     OLE0663AUT  203   LR                                                 S01117
0582 O***********                        22 'REFERENCE LE0663'            S01117
0582 O                                   24 'REFERENCE LE0663AU'          S01117
0583 O                         TITL      89
0584 O                                  104 'DATE'
0585 O                         RUNA     112
0586 O                                  122 'PAGE'
0587 O                         PAGE     127
0588 O        T  1     LR
0589 O                                   59 'FACILITIES EXCEEDED'
0590 O                                   70 'EXTRACT  -'
0591 O                                   85 'FILE CONTROLS'
0592 O        T  3     LR
0593 O                                   64 '------------------------'
0594 O                                   85 '---------------------'
0595 O        T  1     LR
0596 O                                   28 'S/FCLTY - RUN CONTROLS'
0597 O                                   59 'NUMBER'
0598 O                                   84 'VALUE'
0599 O        T  2     LR
0600 O                                   28 '----------------------'
0601 O                                   59 'OF RECORDS'
0602 O                                   84 'OF RECORDS'
0603 O        T  2     LR
0604 O                                   29 'TOTAL RECORDS ON FILE'
0605 O**********         NU7   NORE  3   59                                                   CLE041
0606 O**********         NU7   VLAF  4   81                                                   CLE041
0607 O**********         NU7   VLAL      84                                                   CLE041
0605 O                   NU7   WNORE 3   59                                                   CLE041
0606 O                   NU7   WVLAF 4   81                                                   CLE041
0607 O                   NU7   WVLAL     84                                                   CLE041
0608 O        T  3     LR
0609 O                                   29 'TOTAL RECORDS ON FILE'
0610 O                                   42 '- CALCULATED'
0611 O                         NORI  3   59
0612 O                         INTOTI4   81
0613 O                         INTOTD    84
0614 O                    U8NU7         111 '***   DIFFERENCE   ***'
0615 O        T  1     LR
0616 O                                   28 'S/FCLTB - RUN CONTROLS'
0617 O        T  2     LR
0618 O                                   28 '----------------------'
0619 O        T  3     LR
0620 O                                   29 'TOTAL RECORDS ON FILE'
0621 O                         NROP  3   59
0622 O                         OUTOTI4   81
0623 O                         OUTOTD    84
     O        T  3     LR U7 U8                                           S01117
     O                                   51 '*** REFERENCE LE0663'        S01117
     O                                   71 'DATABASE ERROR AT'           S01117
     O                         DBASE     75                               S01117
     O        T  1     LR U7 U8                                           S01117
     O                                   39 'FILENAME'                    S01117
     O                         DBFILE    48                               S01117
     O                                   52 'KEY'                         S01117
     O                         DBKEY     82                               S01117
0624 O********T*3         LR                                              S01117
0625 O***********                        76 '*** END OF REPORT ***'       S01117
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
