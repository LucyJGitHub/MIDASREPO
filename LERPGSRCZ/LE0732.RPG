0001 H        1                                                           S01117
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas Limits Extract for Lend Portfolio')              *
0001 H***********                                                         S01117
0002 F********************************************************************
0003 F*                                                                  *
     F*  Midas  - Customer Lending Module
0005 F*                                                                  *
0006 F*       LE0732 - LIMITS EXTRACT FOR LENDING PORTFOLIO              *
0007 F*                                                                  *
      *  (c) Finastra International Limited 2001                      *
0009 F*                                                                  *
      *  Last Amend No. MD041994           Date 28Apr20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 054818             Date 05May93               *
      *                 BHF728             Date 05Oct90               *
     F*                      S01194              DATE 22JAN90            *S01194
     F*                      S01117              DATE 09/01/90            S01117
0009 F*                                                                  *S01117
0012 F********************************************************************
     F*                                                               *
      *  MD041994 - COB components LEC08 10012 and LEC08 10003 failed *
      *             due to closed customer. Do not process DBERR when *
      *             when customer is closed.                          *
      *           - Applied for MD-55209                              *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*       054818  -  IF LIMIT IS DELETED AND CUTOMER IS DELETED      *
     F*                  A DATABASE ERROR OCCURS.                        *
     F*       BHF728  -  LIMITS EXTRACT FILE SHOULD INCLUDE SYSTEM       *
     F*                  LEVEL CLIENTS LIMITS                            *
     F*       S01194  -  STANDING DATA CHANGES                           *S01194
     F*       S01117  -  MULTIBRANCHING                                  *S01117
     F*                                                                  *
     F********************************************************************
0013 F**
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
0014 F*LIMIT***IP**F      96  6AI     2 DISK                              S01194
0015 F*TABLE***IF**F      96 12AI     2 DISK                              S01194
0016 F*CLINT***IF**F     256  7AI     2 DISK                              S01194
     FSDCLLMPDIP  E                    DISK                               S01194
0017 F*FPORTFP*O***F******96            DISK                                                  CLE042
     FFPORTFP O   F     126            DISK                                                   CLE042
0017 FFPORTT2 O   F      96            DISK
0018 F*E0732P1O***F*****132************PRINTER***************       S01124S01117
0018 FLE0732AUO   F     132            PRINTER                            S01117
0019 F**
0020 F* ID F  C  H  L    FUNCTION OF INDICATORS
0021 F**01**********  LIMITS FILE - HEADER RECORD                         S01194
0022 F**02**********              - DETAIL RECORD                         S01194
0022 F* 02            CUSTOMER LIMITS FILE - DETAIL RECORD                S01194
0023 F**03**********  TABLE FILE - INST. CONTROL DATA RECORD 1            S01194
0024 F**04**********             -              -DATA RECORD 2            S01194
0025 F**05**********  TABLE FILE - CURRENCIES RECORD                      S01194
0026 F**06**********  CLINT FILE - DETAIL RECORD                          S01194
0027 F**07**********  TABLE FILE - INST. CONTROL DATA RECORD 5            S01194
0028 F*    20         PARENT NO ZERO
     F*    22         LENDING LIMIT TYPE ZERO
0029 F*       30      FIRST CYCLE INDICATOR
0030 F********31****  WORK INDICATOR                                      S01194
0031 F*       32      CURRENCY - 1 DECIMAL PLACE
0032 F*       33               - 2 DECIMAL PLACES
0033 F*       34               - 3 DECIMAL PLACES
0034 F*       35      CUSTOMER/PARENT INDICATOR ON
0034 F*       69      BRANCH LEVEL LIMIT                                  S01117
0034 F*       70      COMPANY LEVEL LIMIT                                 S01117
0034 F*       71      SYSTEM LEVEL LIMIT                                  S01117
0035 F*       90-99   STANDARD SUBROUTINES
0036 F*       U7,U8   STANDARD MIDAS USAGE
     E*
     E                    CPY@    1   1 80
     E*
0037 I**************                                                      S01194
0038 I*****CUSTOMER*LIMITS FILE - HEADER RECORD.                          S01194
0039 I**************                                                      S01194
0040 I**MIT   NS  01   1 CH                                               S01194
0041 I*****************                       1   1 RECI                  S01194
0042 I*****************                       2   70CNUM                  S01194
0043 I*****************                   P   8  100NORE                  S01194
0044 I*****************                   P  11  130FLSZ                  S01194
0045 I*****************                   P  14  160NLRB                  S01194
0046 I*****************                   P  17  190NINS                  S01194
0047 I*****************                   P  20  220NAMD                  S01194
0048 I*****************                   P  23  250NDEL                  S01194
0049 I*****************                   P  26  280NLRA                  S01194
0050 I*****************                   P  90  920LCD                   S01194
0051 I*****************                      93  93 CHTP                  S01194
0052 I*****************                   P  94  960TNLU                  S01194
0053 I**************                                                      S01194
0054 I*****CUSTOMER*LIMITS FILE - DETAIL RECORD.                          S01194
0055 I**************                                                      S01194
0056 I*LIMIT***NS**02   1 CD                                              S01194
0057 I**************                          1   1 RECI                  S01194
0058 I**************                          2   70CNUM                  S01194
0059 I**************                          8  100FLTY                  S01194
0060 I**************                      P  11  150FLAM                  S01194
0061 I**************                      P  16  180FLED                  S01194
0062 I**************                      P  19  210FLVD                  S01194
0063 I**************                         22  22 FLRF                  S01194
0064 I**************                      P  23  270RLAM                  S01194
0065 I**************                         28  300LLTY            22    S01194
0066 I**************                      P  31  350LLAM                  S01194
0067 I**************                      P  36  380LLED                  S01194
0068 I**************                      P  39  410LLRD                  S01194
0069 I**************                         42  42 LLRF                  S01194
0070 I**************                         43  43 LLSE                  S01194
0071 I**************                      P  90  920LCD                   S01194
0072 I**************                         93  93 CHTP                  S01194
0073 I**************                      P  94  960TNLU                  S01194
0074 I**************                                                      S01194
0075 I****LIMITS*CATCHALL                                                 S01194
0076 I********NS****                                                      S01194
0077 I**************                                                      S01194
     I*                                                                   S01194
     I*  CUSTOMER LIMITS FILE                                             S01194
     I*                                                                   S01194
     ISDCLLMD0    02                                                      S01194
     I*                                                                   S01194
0078 I*****TABLE*FILE - INSTALLATION CONTROL DATA RECORD 1.               S01194
0079 I**************                                                      S01194
0080 I*TABLE***NS**03   2 C0   3 C1  12 C1                                S01194
0081 I*******AND****  13 C0   1 CD                                        S01194
0082 I**************                          1   1 RECI                  S01194
0083 I**************                          2   30RECT                  S01194
0084 I**************                         12  130RCDE                  S01194
0085 I**************                         14  66 TITL                  S01194
0086 I**************                         67  67 DATF                  S01194
0087 I***********                            68  700DFBR                  S01194
0088 I**************                         74  74 MODI1                 S01194
0089 I**************                         75  75 MODI2                 S01194
0090 I**************                         76  76 MODI3                 S01194
0091 I**************                      P  77  790RUND                  S01194
0092 I**************                         80  86 RUNA                  S01194
0093 I**************                         87  870SFLG                  S01194
0094 I**************                      P  90  920LCD                   S01194
0095 I**************                         93  93 CHTP                  S01194
0096 I**************                      P  94  960TNLU                  S01194
0097 I**************                                                      S01194
0098 I**************                                                      S01194
0099 I*****TABLE*FILE - INSTALLATION CONTROL DATA RECORD 2.               S01194
0100 I**************                                                      S01194
0101 I*TABLE***NS**04   1 CD   2 C0   3 C1                                S01194
0102 I*******AND****  12 C1  13 C1                                        S01194
0103 I**************                          1   1 RECI                  S01194
0104 I**************                          2   30RECT                  S01194
0105 I**************                         12  130RCDE                  S01194
0106 I**************                         14  16 BCCY                  S01194
0107 I**************                         17  19 BCYL                  S01194
0108 I**************                         20  22 HOCY                  S01194
0109 I**************                         23  280HEAD                  S01194
0110 I**************                      P  29  310APDA                  S01194
0111 I**************                         35  35 APFQ                  S01194
0112 I**************                      P  36  380LOGS                  S01194
0113 I**************                         39  40 CUZR                  S01194
0114 I**************                      P  41  430DNWD                  S01194
0115 I**************                         44  460BVLP                  S01194
0116 I**************                         47  49 LOCY                  S01194
0117 I**************                         50  510FDAY                  S01194
0118 I**************                         86  86 ISAV                  S01194
0119 I**************                      P  87  890LLOG                  S01194
0120 I**************                      P  90  920LCD                   S01194
0121 I**************                         93  93 CHTP                  S01194
0122 I**************                      P  94  960TNLU                  S01194
0123 I**************                                                      S01194
0124 I*****TABLE*FILE - INSTALLATION CONTROL DATA RECORD 5.  S/TABLE,TB-40S01194
0125 I**************                                                      S01194
0126 I*TABLE***NS**07   1 CD   2 C0   3 C1                                S01194
0127 I*******AND****  12 C4  13 C0                                        S01194
0128 I**************                          1   1 RECI                  S01194
0129 I**************                          2   30RECT                  S01194
0130 I**************                         12  130RCDE                  S01194
0131 I**************                         18  210CSAC                  S01194
0132 I**************                         22  22 TLII                  S01194
0133 I**************                         23  23 MCRI                  S01194
0134 I**************                      P  24  250MCEP                  S01194
0135 I**************                         26  270MCLP                  S01194
0136 I**************                         28  28 FRDI                  S01194
0137 I**************                         29  29 BRCF                  S01194
0138 I**************                         30  350PSCN                  S01194
0139 I***********                            36  380DLBR                  S01194
0140 I**************                         39  420FRPA                  S01194
0141 I**************                         43  460FRPC                  S01194
0142 I**************                         47  49 USCY                  S01194
0143 I**************                         50  52 STCY                  S01194
0144 I**************                      P  53  553MBGE                  S01194
0145 I**************                         57  57 FFNY                  S01194
0146 I**************                         58  58 OURC                  S01194
0147 I**************                         59  59 BRNC                  S01194
0148 I**************                         60  60 LCYN                  S01194
0149 I**************                         61  61 XPBI                  S01194
0150 I**************                         62  640LSTT                  S01194
0151 I**************                      P  90  920LCD                   S01194
0152 I**************                         93  93 CHTP                  S01194
0153 I**************                      P  94  960TNLU                  S01194
0154 I**************                                                      S01194
0155 I**************                                                      S01194
0156 I*****TABLE*FILE - CURRENCIES RECORD 1.                              S01194
0157 I**************                                                      S01194
0158 I*TABLE***NS**05   1 CD   2 C2   3 C0                                S01194
0159 I*******AND****  13 C1                                               S01194
0160 I**************                          1   1 RECI                  S01194
0161 I**************                          2   30RECT                  S01194
0162 I**************                         13  130SREC                  S01194
0163 I**************                         14  27 CCNM                  S01194
0164 I**************                      P  28  348SPOT                  S01194
0165 I**************                         35  37 CCYS                  S01194
0166 I**************                         38  380CDP                   S01194
0167 I**************                         39  390TNOT                  S01194
0168 I**************                         40  40 DCCY                  S01194
0169 I**************                         41  44 SRC1                  S01194
0170 I**************                         45  48 SRC2                  S01194
0171 I**************                         49  520TACC                  S01194
0172 I**************                         53  560TEQV                  S01194
0173 I**************                         57  600SWQV                  S01194
0174 I**************                         61  640TAC4                  S01194
0175 I**************                         65  680TAC5                  S01194
0176 I**************                         69  69 HIND                  S01194
0177 I**************                      P  70  768PART                  S01194
0178 I**************                         77  780SSNO                  S01194
0179 I**************                      P  79  858ERLC                  S01194
0180 I**************                      P  90  920LCD                   S01194
0181 I**************                         93  93 CHTP                  S01194
0182 I**************                      P  94  960TNLU                  S01194
0183 I**************                                                      S01194
0184 I****CATCHALL**                                                      S01194
0185 I********NS****                                                      S01194
0186 I*****CLIENT*FILE - CUSTOMER STANDING DATA RECORD.                   S01194
0187 I**************                                                      S01194
0188 I*CLINT***NS**06   1 CD   8 CA                                       S01194
0189 I**************                          1   1 RECI                  S01194
0190 I**************                          8   8 RCDT                  S01194
0191 I**************                          9  28 CRNM                  S01194
0192 I**************                         29  38 CTWN                  S01194
0193 I**************                         39  48 CSNM                  S01194
0194 I**************                         49  56 CASK                  S01194
0195 I**************                         57  68 TELX                  S01194
0196 I**************                         69  80 CSID                  S01194
0197 I**************                         81  82 ACOC                  S01194
0198 I**************                         83  83 CBSI                  S01194
0199 I**************                         84  85 CCTZ                  S01194
0200 I**************                         86  87 CLOC                  S01194
0201 I**************                         88  930CPAR            20    S01194
0202 I***********                            94  960BRCD                  S01194
0203 I**************                         97  980LINS                  S01194
0204 I**************                         99 1010LIND                  S01194
0205 I**************                      P 102 1040DASU                  S01194
0206 I**************                      P 105 1070CDIC                  S01194
0207 I**************                      P 108 1100DADE                  S01194
0208 I**************                        111 111 CMIN                  S01194
0209 I**************                        112 112 CTYP                  S01194
0210 I**************                        113 124 TELF                  S01194
0211 I**************                        125 133 CHID                  S01194
0212 I**************                        134 136 CHAB                  S01194
0213 I**************                      P 250 2520LCD                   S01194
0214 I**************                        253 253 CHTP                  S01194
0215 I**************                      P 254 2560TNLU                  S01194
0216 I**************                                                      S01194
0217 I****CATCHALL**                                                      S01194
0218 I********NS****                                                      S01194
0219 I**************                                                      S01194
0220 I****DATA*STRUCTURE FOR TABLES FILE KEY                              S01194
0221 I************DS                                                      S01194
0222 I**************                          1  12 TBKEY                 S01194
0223 I**************                          1   2 TBKY1                 S01194
0224 I**************                          9  11 BCYL                  S01194
0225 I**************                         12  12 TBKY3                 S01194
0226 I**************                                                      S01194
0227 I****DATA*STRUCTURE FOR CLINT FILE                                   S01194
0228 I************DS                                                      S01194
0229 I**************                          1   7 CLNKEY                S01194
0230 I**************                          1   60CNUM                  S01194
0231 I**************                          7   7 A                     S01194
0232 I**  DATA STRUCTURE FOR EXTRACT O/P DATA
0233 I            DS
0234 I                                        1  15 CLINTD
0235 I                                        1   2 ACOC
0236 I***********                             3   80PNUM                                      CSD027
     I                                        3   8 PNUM                                      CSD027
0237 I***********                             9  140CUST                                      CSD027
     I                                        9  14 CUST                                      CSD027
0238 I                                       15  15 PCIND
     I*                                                                   S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I** EXTERNAL DS FOR BANK DETAILS                                     S01194
     I**                                                                  S01194
     I              BJURPT                          TITL                  S01194
     I              BJMRDT                          RUNA                  S01194
     I*                                                                   S01194
     ISDCURR    E DSSDCURRPD                                              S01194
     I** EXTERNAL DS FOR CURRENCY DETAILS                                 S01194
     I**                                                                  S01194
     I              A6NBDP                          CDP                   S01194
     I*                                                                   S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I** EXTERNAL DS FOR CUSTOMER DETAILS                                 S01194
     I**                                                                  S01194
     I*                                                                   S01194
     ISDDEAL    E DSSDDEALPD                                              S01194
     I** EXTERNAL DS FOR DEALING DETAILS                                  S01194
     I**                                                                  S01194
     I              BNCYCD                          BCYL                  S01194
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
0239 I**   LOCAL DATA AREA FOR DATABASE ERROR IDENTIFICATION
0240 ILDA        UDS                            256
0241 I***********                           134 138 DBFILE                S01117
0242 I***********                           139 167 DBKEY                 S01117
0243 I***********                           168 175 DBPGM                 S01117
0244 I***********                           176 1770DBASE                 S01117
0273 I                                      134 141 DBFILE                S01117
0274 I                                      142 170 DBKEY                 S01117
0275 I                                      171 180 DBPGM                 S01117
0276 I                                      181 1830DBASE                 S01117
0245 C**
     C                     MOVEACPY@      BIS@   80
     C*
0246 C**  FIRST CYCLE CALCULATIONS
0247 C   30                GOTO ENDFC
0248 C                     SETON                     30
0249 C**************                                                      S01194
0250 C****OBTAIN*INST. CONTROL RECORD 5                                   S01194
0251 C**************       MOVE '01'      TBKY1                           S01194
0252 C**************       MOVE '40'      TBKEY                           S01194
0253 C**************       EXSR TABCHN                                    S01194
0254 C**************                                                      S01194
0255 C**N07*********       SETON                     U7U8LR               S01194
0256 C**N07*********       MOVE TBKEY     DBKEY                           S01194
0257 C**N07*********       MOVE 'TABLE'   DBFILE                          S01194
0258 C**N07*********       Z-ADD5         DBASE            DBASE 5        S01194
0259 C**N07*********       GOTO END                                       S01194
0260 C**
0261 C**  OBTAIN INST. CONTROL RECORD 1 & 2
0262 C**************       MOVE '01'      TBKY1                           S01194
0263 C**************       MOVE '10'      TBKEY                           S01194
0264 C**************       EXSR TABCHN                                    S01194
0265 C**
0266 C**N03*********       SETON                     U7U8LR               S01194
0267 C**N03*********       MOVE TBKEY     DBKEY                           S01194
0268 C**N03*********       MOVE 'TABLE'   DBFILE                          S01194
0269 C**N03*********       Z-ADD1         DBASE            DBASE 1        S01194
0270 C**N03*********       GOTO END                                       S01194
     C**                                                                  S01194
     C**   ACCESS BANK DETAILS                                            S01194
     C**                                                                  S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     SETON                     U7U8LR               S01194
     C                     MOVEL'SDBANKPD'DBFILE                          S01194
     C                     MOVEL@OPTN     DBKEY            ***************S01194
     C                     MOVEL@OPTN     DBOPTN  7        * DBERROR 001 *S01194
     C                     Z-ADD1         DBASE            ***************S01194
     C                     GOTO END                                       S01194
     C                     END                                            S01194
0271 C**
0272 C**************       MOVE '11'      TBKEY                           S01194
0273 C**************       EXSR TABCHN                                    S01194
0274 C**
0275 C**N04*********       SETON                     U7U8LR               S01194
0276 C**N04*********       MOVE TBKEY     DBKEY                           S01194
0277 C**N04*********       MOVE 'TABLE'   DBFILE                          S01194
0278 C**N04*********       Z-ADD2         DBASE            DBASE 2        S01194
0279 C**N04*********       GOTO END                                       S01194
     C**                                                                  S01194
     C** ACCESS DEALING DATA                                              S01194
     C**                                                                  S01194
     C**********           CALL 'AODEALR0'                                             S01194 CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C********** SDDEAL    PARM SDDEAL    DSFDY                                        S01194 CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     SETON                     U7U8LR               S01194
     C                     MOVEL'SDDEALPD'DBFILE                          S01194
     C                     MOVEL@OPTN     DBKEY              *************S01194
     C                     MOVEL@OPTN     DBOPTN             * DBERR 002 *S01194
     C                     MOVE '002'     DBASE              *************S01194
     C                     GOTO END                                       S01194
     C                     END                                            S01194
0280 C**************                                                      S01194
0281 C****SET*UP*FIELDS                                                   S01194
0282 C**************       MOVE 'A'       A                               S01194
0283 C**************       MOVE '20'      TBKY1                           S01194
0284 C**************       MOVE '1'       TBKY3                           S01194
0285 C**
0286 C**  OBTAIN NO. OF DECIMAL PLACES FOR AMOUNT CONVERSION FOR LIMIT CCY
0287 C**************       EXSR TABCHN                                    S01194
0288 C**
0289 C**N05*********       SETON                     U7U8LR               S01194
0290 C**N05*********       MOVE TBKEY     DBKEY                           S01194
0291 C**N05*********       MOVE 'TABLE'   DBFILE                          S01194
0292 C**N05*********       Z-ADD3         DBASE            DBASE 3        S01194
0293 C**N05*********       GOTO END                                       S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM BCYL      TKEY    3                    A  S01194
     C           SDCURR    PARM SDCURR    DSSDY                        B  S01194
     C           @RTCD     IFNE *BLANK                     ***************S01194
     C                     Z-ADD03        DBASE            * DB ERROR 03 *S01194
     C                     MOVELTKEY      DBKEY            ***************S01194
     C                     MOVEL'SDCURRPD'DBFILE                          S01194
     C                     GOTO END                                       S01194
     C                     END                                            S01194
     C**                                                                  S01194
     C**  IF CURRENCIES RECORD CHECK FOR NO. OF DECIMAL PLACES            S01194
     C           CDP       COMP 1                        32               S01194
     C           CDP       COMP 2                    34  33               S01194
0294 C**
0295 C           ENDFC     TAG                             * ENDFC TAG
0296 C**
0297 C**  SKIP PROCESSING FOR NON-DETAIL RECORDS
     C**   OR IF LENDING LIMIT TYPE IS ZERO (I.E. NO LIMIT SET)
     C   02      TOTCNT    ADD  1         TOTCNT  50
     C                     SETOF                         22               S01194
     C           DZLLTY    IFEQ *BLANKS                                   S01194
     C                     SETON                         22               S01194
     C                     END                                            S01194
     C*                                                                   054818
     C** IF THE LIMIT IS DELETED SKIP PROCESSING.                         054818
     C           DZTYLC    IFEQ 'D'                                       054818
     C                     SETON                         22               054818
     C                     END                                            054818
     C   22
     CORN02                GOTO END
     C***                                                                 S01117
     C***     SETON IND.TO DEFINE IF BY BRANCH, COMPANY OR SYSTEM LIMIT   S01117
     C           DZLEVL    COMP 'C'                  716970               S01117
     C***71                GOTO END                                S01117 BHF728
0299 C**
0300 C**  CHECK FOR EXISTENCE OF CUSTOMER ON CLINT
0301 C                     EXSR CLNCHN
0302 C  N06                SETON                     U7U8LR
0303 C  N06                MOVE CLNKEY    DBKEY
0304 C**N06*********       MOVE 'CLINT'   DBFILE                          S01194
0304 C  N06                MOVE 'SDCUSTPD'DBFILE                          S01194
0305 C  N06                Z-ADD4         DBASE            DBASE 4
0306 C  N06                GOTO END
0307 C**
0308 C**  ACCUMULATE COUNT AND HASH OF RECORDS FOR EXTRACT
     C           COUNT     ADD  1         COUNT   50
0310 C***********LLAM      MULT 1000      LLAMT  130       CONVERT AMTS TOS01194
0310 C           DZLLAM    MULT 1000      LLAMT  130       CONVERT AMTS TOS01194
0311 C   32      LLAMT     MULT 10        LLAMT            UNITS FROM
0312 C   33      LLAMT     MULT 100       LLAMT            '000'S CCY
0313 C   34      LLAMT     MULT 1000      LLAMT
0314 C**
0315 C**  ACCUMULATE HASH TOTALS
0316 C                     MOVE LLAMT     ZZAMT
0317 C                     Z-ADDTOTWHN    ZZTOTI
0318 C                     Z-ADDTOTDC     ZZTOTD
0319 C                     EXSR GLZADD
0320 C**
0321 C                     Z-ADDZZTOTI    TOTWHN 150
0322 C                     Z-ADDZZTOTD    TOTDC   30
0323 C**
0324 C           END       TAG                             * END TAG
0325 C**
     CLR         COUNT     ADD  1         COUNT
0327 CLR U7                MOVE 'LE0732'  DBPGM
0328 C*LRNU7******TOTCNT    COMP NLRA                 U8U8                S01194
     CLR U7 U8             EXSR *PSSR                                     S01117
0329 C**
0330 C********************************************************************
0331 C****TABCHN*SUBR. TO RANDOM ACCESS TABLE FILE                       *S01194
0332 C**************                                                     *S01194
0333 C***********TABCHN    BEGSR                           **  TABCHN   **S01194
0334 C**************                                                      S01194
0335 C**************       SETOF                     030405               S01194
0336 C**************       SETOF                     07                   S01194
0337 C***********TBKEY     CHAINTABLE                31                   S01194
0338 C**N05*********       GOTO TABEND                                    S01194
0339 C**************                                                      S01194
0340 C****IF*CURRENCIES RECORD CHECK FOR NO. OF DECIMAL PLACES            S01194
0341 C***********CDP       COMP 1                        32               S01194
0342 C***********CDP       COMP 2                    34  33               S01194
0343 C**************                                                      S01194
0344 C***********TABEND    ENDSR                           * TABEND ENDSR S01194
0345 C**************                                                      S01194
0346 C********************************************************************S01194
0347 C**
0348 C********************************************************************
0349 C**  CLNCHN SUBR. TO RANDOM ACCESS CLINT FILE                       *
0350 C**
0351 CSR         CLNCHN    BEGSR                           **  CLNCHN   **
0352 C**
0353 C**************       SETOF                     3106                 S01194
0354 C***********CLNKEY    CHAINCLINT                31                   S01194
     C                     SETOF                     06                   S01194
     C                     MOVELDZCUST    CLNKEY 10                       S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM           CLNKEY                          S01194
     C                     PARM '       ' KEYSTS  7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C           @RTCD     IFEQ *BLANKS                                   S01194
     C           @RTCD     OREQ '*CUSCLS'                                                   MD041994
     C                     SETON                     06                   S01194
     C                     END                                            S01194
0355 C  N06                GOTO CLNEND
0356 C**
0357 C**  CHECK FOR 'PARENT','CHILD' OR 'LONER'
0358 C**  PARENT NO. ZERO,PARENT IND. 1 - CUST. - PARENT
0359 C**  PARENT NO. NON-ZERO, PARENT IND. 0 -  CUST. - CHILD
0360 C**  PARENT NO. ZERO, PARENT IND. 0 - CUST. - LONER
0361 C**************       TESTB'2'       CMIN           35               S01194
      *                                                                   BHF728
     C                     SETOF                     3520                 BHF728
      *                                                                   BHF728
     C           BBPAIN    IFEQ 'P'                                       S01194
     C                     SETON                     35                   S01194
     C                     END                                            S01194
     C           BBPCNB    IFEQ *BLANKS                                   S01194
     C                     SETON                     20                   S01194
     C                     END                                            S01194
     C                     MOVE BBACOC    ACOC                            S01194
     C***********          MOVE BBPCNB    CPAR    60                      S01194              CSD027
     C                     MOVE BBPCNB    CPAR    6                                           CSD027
0362 C***20*35******       Z-ADDCNUM      PNUM             PARENT         S01194
0362 C   20 35             MOVELDZCUST    PNUM             PARENT         S01194
0363 C*****N35***          Z-ADDCPAR      PNUM             CHILD/LONER                        CSD027
     C     N35             MOVE CPAR      PNUM             CHILD/LONER                        CSD027
0364 C**  CUST. NO. SETTING
0365 C***20*35***          Z-ADD999999    CUST                                                CSD027
     C   20 35             MOVE '999999'  CUST                                                CSD027
0366 C*****N35******       Z-ADDCNUM      CUST                            S01194
0366 C     N35             MOVELDZCUST    CUST                            S01194
0367 C**  PARENT/CUST. IND. SETTING
0368 C   20 35             MOVE 'P'       PCIND            PARENT
0369 C  N20N35             MOVE 'C'       PCIND            CHILD
0370 C   20N35             MOVE 'L'       PCIND            LONER
0371 C**
0372 C           CLNEND    ENDSR                           * CLNEND ENDSR
0373 C**
0374 C********************************************************************
0375 C**
0376 C********************************************************************
0377 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
0378 C*   IND '99' IS SET BY AN OVERFLOW ERROR
0379 C*
0380 CSR         GLZADD    BEGSR                           *** GLZADD ****
0381 C*
0382 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
0383 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
0384 C*
0385 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
0386 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
0387 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
0388 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
0389 C*
0390 CSR                   EXSR GLZSUM
0391 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
0392 C*
0393 C********************************************************************
0394 C********************************************************************
0395 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
0396 C*                        GLZADD, GLZSUB, GLZCMP.
0397 C*          PARAMETERS PASSED -
0398 C*                     I/P ZZAMTI ZZAMTD
0399 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
0400 C*
0401 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
0402 C*
0403 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
0404 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
0405 CSR                   SETOF                     919293
0406 CSR                   SETOF                     949599
0407 C*
0408 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
0409 CSR         ZZAMTI    COMP 0                      9293
0410 CSR 93      ZZAMTD    COMP 0                      9293
0411 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0412 C*
0413 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
0414 CSR         ZZTOTI    COMP 0                      9193
0415 CSR 93      ZZTOTD    COMP 0                      9193
0416 C*
0417 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
0418 CSR 93                Z-ADDZZAMTI    ZZTOTI
0419 CSR 93                Z-ADDZZAMTD    ZZTOTD
0420 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0421 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
0422 CSR 91N92
0423 CORN91 92             GOTO ZZOFPS
0424 C*
0425 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
0426 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
0427 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
0428 C*
0429 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
0430 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
0431 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
0432 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
0433 C*
0434 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
0435 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
0436 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
0437 CSRN99                Z-ADDZZWK2     ZZTOTD
0438 CSRN99                Z-ADDZZWK3     ZZTOTI
0439 C*
0440 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
0441 CSR 99                Z-ADD0         ZZAMT  153
0442 CSR                   GOTO ZZSEND
0443 C*
0444 C* THE 'SIGNS' ARE DIFFERENT
0445 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
0446 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
0447 C*
0448 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
0449 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
0450 C*
0451 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
0452 C*
0453 CSR 91                Z-SUBZZTOTI    ZZTOTI
0454 CSR 91                Z-SUBZZTOTD    ZZTOTD
0455 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
0456 C*
0457 CSR         ZZTOTI    COMP ZZAMTI               93  95
0458 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
0459 C*
0460 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
0461 CSR 95                Z-ADD0         ZZTOTI
0462 CSR 95                Z-ADD0         ZZTOTD
0463 CSR 95                GOTO ZZSEND
0464 C*
0465 C* IF ZZTOT GT. ZZAMT.
0466 CSR 93      ZZAMTD    COMP ZZTOTD               94
0467 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
0468 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
0469 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
0470 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
0471 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
0472 C*
0473 C*
0474 C* IF ZZAMT GT. ZZTOT.
0475 CSRN93      ZZTOTD    COMP ZZAMTD               94
0476 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
0477 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
0478 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
0479 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
0480 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
0481 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
0482 C*
0483 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
0484 CSR                   SETOF                     94
0485 CSR 93 91
0486 CORN93 92             SETON                     94
0487 CSR 94                Z-SUBZZTOTI    ZZTOTI
0488 CSR 94                Z-SUBZZTOTD    ZZTOTD
0489 C**
0490 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
0491 CSR 92                Z-SUBZZAMTI    ZZAMTI
0492 CSR 92                Z-SUBZZAMTD    ZZAMTD
0493 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
0494 C**
0495 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
0496 CSR                   SETOF                     96
0497 CSR         ZZTOTD    COMP 0                        91
0498 CSR 91      ZZTOTI    COMP 0                      96
0499 CSR 96                MOVE '.000-'   ZZNEGD  5
0500 CSR                   ENDSR                             ** ENDSR **
     C********************************************************************S01117
     C*                                                                   S01117
     C*  *PSSR --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
     C*                                                                   S01117
     C*  CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                     S01117
     C*                                                                   S01117
     C*  CALLS: NOTHING                                                   S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C*                                                                   S01117
0501 C********************************************************************
0502 OFPORTFP D        02NLRN22
     O*******AND      N71                                          S01117 BHF728
0503 O                                    1 'D'
0504 O                         CLINTD    16
0505 O                                   17 '4'
0506 O                                   18 'G'
0507 O                         BCYL      21
0508 O                         LLAMT     29P
0509 O**************           LLED      38P                              S01194
0509 O                         DZLLED    38P                              S01194
0510 O                                   47 'L'
0511 O****                     DLBR      50                               S01117
     O                 69      DZBCCD    50                               S01194
     O                         DZLEVL    64                               S01194
     O                 70      DZBCCD    70                               S01194
     O                 69      DZBCCD    73                               S01194
     O                 70      DZBCCD    76                               S01194
0512 O**  FPORT TRAILER
0513 OFPORTT2 T        LRNU7
0514 O                                    1 'T'
0515 O                         COUNT      4P
0516 O                         TOTWHN    12P
0517 O                         TOTDC     14P
0518 O**
0519 O**   CONTROL REPORT
0520 O**
0521 O*E0732P1T**203***LR*U7*****************************           S01124S01117
0521 OLE0732AUT  203   LR U7                                              S01117
0522 O*****                              22 'REFERENCE LE0732'            S01117
0522 O                                   24 'REFERENCE LE0732AU'          S01117
0523 O                         TITL      89
0524 O                                  104 'DATE'
0525 O                         RUNA     112
0526 O                                  122 'PAGE'
0527 O                         PAGE  Z  127
0528 O        T  1     LR U7
0529 O                                   71 'LIMITS EXTRACT FOR LENDI'
0530 O                                   83 'NG PORTFOLIO'
0531 O        T  3     LR U7
0532 O                                   71 '------------------------'
0533 O                                   83 '------------'
0534 O        T 32     LR U7
0535 O                                   51 '*** REFERENCE LE0732'
0536 O                                   71 '- DATABASE ERROR AT'
0537 O***********              DBASE     74                               S01117
0537 O                         DBASE     75                               S01117
0538 O        T        LR U7
0539 O                                   37 'FILENAME'
0540 O***********              DBFILE    43                               S01117
0541 O***********                        48 'KEY'                         S01117
0542 O***********              DBKEY     78                               S01117
0750 O                         DBFILE    46                               S01117
0751 O                                   51 'KEY'                         S01117
0752 O                         DBKEY     81                               S01117
0543 O        T   03   LR
0544 O*****                              22 'REFERENCE LE0732'            S01117
0544 O                                   24 'REFERENCE LE0732AU'          S01117
0545 O                         TITL      89
0546 O                                  104 'DATE'
0547 O                         RUNA     112
0548 O                                  122 'PAGE'
0549 O                         PAGE  Z  127
0550 O        T 2      LR
0551 O                                   64 'LIMITS EXTRACT FOR LENDI'
0552 O                                   88 'NG PORTFOLIO - FILE CONT'
0553 O                                   92 'ROLS'
0554 O        T 1      LR
0555 O                                   64 '------------------------'
0556 O                                   88 '------------------------'
0557 O                                   92 '----'
0558 O        T 3      LR
0559 O                                   28 'S/LIMIT - RUN CONTROLS'
0560 O                                   59 'NUMBER'
0561 O                                   84 'VALUE'
0562 O        T 1      LR
0563 O                                   28 '----------------------'
0564 O                                   59 'OF RECORDS'
0565 O                                   84 'OF RECORDS'
0566 O********T*2***   LR                                                 S01194
0567 O**************                     29 'TOTAL RECORDS ON FILE'       S01194
0568 O**************        NU7NLRA  3   59                               S01194
0569 O        T 2      LR
0570 O                                   29 'TOTAL RECORDS ON FILE'
0571 O                                   42 '- CALCULATED'
0572 O                         TOTCNT3   59
0573 O**************     NU7 U8         111 '***   DIFFERENCE   ***'      S01194
0574 O        T 3      LR
0575 O                                   28 'S/FPORT - RUN CONTROLS'
0576 O        T 1      LR
0577 O                                   28 '----------------------'
0578 O        T 2      LR
0579 O                                   29 'RECORDS ADDED TO FILE'
0580 O                         COUNT 3   59
0581 O                         TOTWHN4   81
0582 O                         TOTDC     84
0583 O***********      LR                                                 S01117
0584 O***********                        76 '*** END OF REPORT ***'       S01117
**  CPY@  **  OBJECT COPYRIGHT
(c) Finastra International Limited 2001
