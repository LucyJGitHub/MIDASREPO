0001 H        1                                                           S01117
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas Loans Extrct for Lend Portfolio(2)')             *
0001 H***********                                                         S01117
0002 F********************************************************************
0003 F*                                                                  *
     F*  Midas - Customer Lending Module
0005 F*                                                                  *
0006 F*       LE0740 - LOANS EXTRACT FOR LENDING PORTFOLIO(2)            *
0007 F*                                                                  *
      *  (c) Finastra International Limited 2001                      *
0009 F*                                                                  *
      *  Last Amend No. CSD103             Date 10Aug20               *
      *  Prev Amend No. MD041994           Date 28Apr20               *
      *                 MD046248           Date 27Oct17               *
      *                 CLE141             Date 08Feb16               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CER059             Date 19Jul10               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 260507             Date 01Jun09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 254794             Date 05Jun08               *
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 243804             Date 15Nov06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CLE005             Date 22May97               *
      *                 E26731 BHF611      Date 03Jun92 (04Oct91)     *
     F*                 S01220             DATE 15MAR91               *
     F*                      MEP062              DATE 29NOV90            *
     F*                      S01194              DATE 15JAN90            *S01194
     F*                      S01117              DATE 22/08/89           *
     F*                                                                  *
     F*------------------------------------------------------------------*
     F*                                                                  *
      *  CSD103 - LIBOR Deregulation - Common Layer/Standing Data     *
      *  MD041994 - COB components LEC08 10012 and LEC08 10003 failed *
      *             due to closed customer. Do not process DBERR when *
      *             when customer is closed.                          *
      *           - Applied for MD-55209                              *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           (Recompile)                                         *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus                                          *
      *  260507 - Unnecessary accesses to AOBRCHR1.                   *
      *           Keep an array which holds branch codes used. Check  *
      *           if branch is found at the array else, check in      *
      *           branch codes file via AOBRCHR1.                     *
      *  254794 - Include maturity records on hash totalling to avoid *
      *           FOOB.                                               *
      *  243804 - Originating branch is not used and causes DB error  *
      *           12 when it is blank. Orignally coded as BUG8868.    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
     F*  CLE005 - Customer Lending Enhancements - Tranche 3           *
     F*    E26731  -  FORWARD-VALUED LOANS SHOULD NOT APPEAR ON LENDING  *
     F*               PORTFOLIO REPORT                                   *
     F*       S01220 - AMENDED FOR STRATEGIC RISK MANAGEMENT             *S01220
     F*                RELEASE 10 TO ALLOW THE INPUT OF A BOOK           *S01220
     F*                CODE AGAINST A LOAN.                              *S01220
0009 F*       MEP062 - OUTPUT VALUE DATE OF LOAN TO EXTRACT FILE.        *MEP062
     F*       S01194 - STANDING DATA CHANGES.                            *S01194
     F*       S01117 - MULTIBRANCHING                                    *
     F*                                                                  *
0012 F********************************************************************
0011 F*                                                                  *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
0013 F*CLOAN***IP**F*****400  7AI     2 DISK                              S01220
0013 F*CLOAN***IP**F     436  7AI     2 DISK                       S01220 CLE011
0013 F***CLOAN** IP  F    1310  7AI     2 DISK                                         CLE011 CGL029
     F*CLOAN***IP**F****1461  7AI     2 DISK                                           CGL029 CLE042
     F***CLOAN** IP  F    1773  7AI     2 DISK                                         CLE042 CER020
     F***CLOAN** IP  F    1782  7AI     2 DISK                                         CER020 CLE134
     FCLOAN   IP  F    1874  7AI     2 DISK                                                   CLE134
0014 F*TABLE***IF  F      96 12AI     2 DISK                              S01194
0015 F*CLINT***IF  F     256  7AI     2 DISK                              S01194
0014 FFCLTY   IF  F     256 11AI     2 DISK                               S01117
     F/COPY WNCPYSRC,LE0740F001
0016 F***FPORTFP O   F      96            DISK                                                CGL029
     F*FPORTFP*O***F*****122            DISK                                           CGL029 CLE042
     FFPORTFP O   F     126            DISK                                                   CLE042
0016 FFPORTT2 O   F      96            DISK
0017 F*E0740P1O***F     132            PRINTER                   S01124   S01117
0017 FLE0740AUO   F     132            PRINTER                            S01117
0011 F*                                                                  *
0018 F* ID F  C  H  L    FUNCTION OF INDICATORS
0019 F* 01            CLOAN LIVE RECORD
0020 F* 02            CLOAN MATURED/REVERSED RECORD
0020 F* 03            FACILITIES DETAILS 1 RECORD                         S01117
0021 F*    20         CURRENT PRINCIPAL NEGATIVE
0022 F*       40      FIRST CYCLE
0024 F*       41      PARENT
0025 F*       42      CHILD
0026 F*       43      LONER
     F*       51      PROCESSING TYPE 61-65,70
0028 F*       52      ------"------   66-67
     F*       61      CHAIN FAIL ON FCLTY                                 S01117
0030 F*       90-99   STANDARD SUBROUTINES
     E                    CPY@    1   1 80
     E                    ##BR      999  3               Branch codes                         260507
     E                    ##BC      999  3               Company codes                        260507
     E                    ##BI      999  6               BICN                                 260507
      *                                                                                       260507
0031 F*       U7,U8   STANDARD MIDAS USAGE
0032 I*
0033 I*    CUSTOMER LENDING LOANS FILE DETAIL 1
0034 I*
0035 ICLOAN   NS  01   1 CD   8 CA
0036 I       OR   02   1 CM   8 CA
0037 I       OR   02   1 CR   8 CA
0038 I                                        1   1 RECI
0039 I**********                              2   70LNRF                                      CLE148
     I                                        2   7 LNRF                                      CLE148
0040 I                                        8   8 RCDT
0041 I                                        9   90MRIN
0042 I                                       10  110PTYP
0043 I**********                             12  170CNUM                                      CSD027
0043 I                                       12  17 CNUM                                      CSD027
0044 I***********                            18  200BRCD                  S01117
0044 I                                       18  20 BRCA                  S01117
0045 I                                       21  22 LTYP
0046 I                                       23  24 SUTP
0047 I                                    P  25  270DDAT
0048 I                                    P  28  300VDAT
0049 I                                    P  31  330MDAT
0050 I                                       34  350LASQ
0051 I**********                             36  410FCUS                                      CSD027
0051 I                                       36  41 FCUS                                      CSD027
0052 I                                       42  440FTYP
0053 I                                       45  460FSEQ
0054 I                                       47  49 CCY
0055 I                                    P  50  560CPAM          20
0056 I                                       57  57 INTC
0057 I                                    P  58  637INTR
0058 I**********                             64  650BRTT                                      CSD103
0058 I                                       64  65 BRTT                                      CSD103
0059 I                                    P  66  717BRTE
0060 I                                    P  72  777RTSP
0061 I                                    P  78  815MARG
0062 I                                       82  82 SPIN
0063 I                                       83  83 CHIN
0064 I                                    P  84  897WTRT
0065 I                                       90  90 WTIN
0066 I                                       91  910REPT
0067 I                                    P  92  980RAMT
0068 I                                    P  99 1010NRPD
0069 I                                      102 102 RFRQ
0070 I                                      103 1040RDYN
0071 I                                      105 107 FCCY
0072 I                                      108 1100LIND
0073 I                                      111 112 CRSK
0074 I                                      113 114 ACOF
0075 I                                      115 115 NACD
0076 I                                      116 116 RELI
0077 I                                      117 117 AUTO
0078 I                                    P 118 1240PSAM
0079 I                                    P 125 1318BCXR
0080 I                                    P 132 1388FCXR
0081 I                                      139 1400SDST
0082 I**********                            141 152 OSDA                                      CGL029
     I                                      141 152 OSDAQQ                                    CGL029
0083 I                                      153 162 TSTN
0084 I                                      163 1640MDST
0085 I**********                            165 176 OMDA                                      CGL029
     I                                      165 176 OMDAQQ                                    CGL029
0086 I                                      177 186 TMAN
0087 I                                      187 196 FACO
0088 I                                    P 197 1990RLDT
0089 I                                    P 200 2020NROD
0090 I                                      203 203 RLFQ
0091 I                                      204 2050RLDY
0092 I**********                            207 2080NBRA                                      CSD103
0092 I                                      207 208 NBRA                                      CSD103
0093 I                                    P 209 2147NRTS
0094 I                                      215 215 NSIN
0095 I                                      216 2160NCAC
0096 I                                    P 217 2230AWTP
0097 I                                    P 224 2300WTRD
0098 I                                    P 231 2370WTWD
0099 I                                    P 238 2440IWOD
0100 I                                    P 245 2510PWOD
0101 I                                      252 252 BMDI
0102 I                                      253 253 FMDI
0103 I                                    P 254 2600PDIN
     I                                      271 273 ORBR                  S01117
     I                                      278 280 FCLB                  S01117
0104 I                                      287 287 BTIN
0105 I                                      288 2890BLDY
0106 I**********                            290 2950OLNO                                      CSD027
0106 I                                      290 295 OLNO                                      CSD027
0107 I                                      296 296 RCSI
0108 I                                      297 2970ICBS
0109 I                                      298 298 IPFR
0110 I                                    P 299 3050TOTI
0111 I                                    P 306 3080NIDT
0112 I                                    P 309 3110IBDT
0113 I                                    P 312 3140SLID
0114 I                                    P 315 3210AIPD
0115 I                                    P 322 3240DLRC
0116 I                                    P 325 3270IACD
0117 I                                    P 328 3340AITC
0118 I                                    P 335 3410TFEP
0119 I                                    P 342 3480AIAP
0120 I                                    P 349 3550IPRD
0121 I                                    P 356 3620IPRM
0122 I                                    P 363 3690ICTD
0123 I                                    P 370 3760AIMN
0124 I                                    P 377 3790RBDT
0125 I                                      384 3850IFDY
0126 I                                      386 386 LONI
0127 I                                      387 387 CNFI
0128 I                                      388 388 ACEI
0129 I                                      389 389 TLXI
0130 I                                      390 390 CBLI
0131 I                                    P 391 3930ORED
0132 I                                    P 394 3960LCD
0133 I                                      397 397 CHTP
0134 I                                    P 398 4000TNLU
     I                                      435 436 BOKC                  S01220
     I*************************************13901407 OSDA                               CGL029 CLE042
     I*************************************14081425 OMDA                               CGL029 CLE042
     I                                     15611578 OSDA                                      CLE042
     I                                     15791596 OMDA                                      CLE042
     I                                     17621765 CLAS                                      CLE042
     I                                     17801782 LOIC                                      CER020
      *                                                                                       CLE134
     I                                     18301830 FAMU                                      CLE134
     I                                     18311831 FPNR                                      CLE134
     I                                    P183218340RIDT                                      CLE134
     I                                    P183518360RIDC                                      CLE134
     I                                     183718370RCAT                                      CLE134
     I                                    P183818390RCAC                                      CLE134
     I                                    P184018420RCSD                                      CLE134
     I                                    P184318440RCDY                                      CLE134
     I                                    P184518460RICC                                      CLE134
      *                                                                                       CLE134
     I                                    P184718490BIDT                                      CLE134
     I                                    P185018510BIDC                                      CLE134
     I                                     185218520BCAT                                      CLE134
     I                                    P185318540BCAC                                      CLE134
     I                                    P185518570BCSD                                      CLE134
     I                                    P185818590BCDY                                      CLE134
     I                                    P186018610BICC                                      CLE134
      *                                                                                       CLE134
     I                                     18621864 XRFI                                      CLE134
     I                                     186518740XRFN                                      CLE134
      *                                                                                       CLE134
     I                                     17741774 FAMU                                      CLE134
     I                                     17751775 FPNR                                      CLE134
     I                                    P177617780RIDT                                      CLE134
     I                                    P177917800RIDC                                      CLE134
     I                                     178117810RCAT                                      CLE134
     I                                    P178217830RCAC                                      CLE134
     I                                    P178417860RCSD                                      CLE134
     I                                    P178717880RCDY                                      CLE134
     I                                    P178917900RCCY                                      CLE134
      *                                                                                       CLE134
     I                                    P179117930BIDT                                      CLE134
     I                                    P179417950BIDC                                      CLE134
     I                                     179617960BCAT                                      CLE134
     I                                    P179717980BCAC                                      CLE134
     I                                    P179918010BCSD                                      CLE134
     I                                    P180218030BCDY                                      CLE134
     I                                    P180418050BICC                                      CLE134
      *                                                                                       CLE134
     I                                     18061808 XRFI                                      CLE134
     I                                     180918180XRFN                                      CLE134
      *                                                                                       CLE134
     I                                     17741774 FAMU                                      CLE134
     I                                     17751775 FPNR                                      CLE134
     I                                    P177617780RIDT                                      CLE134
     I                                    P177917800RIDC                                      CLE134
     I                                     178117810RCAT                                      CLE134
     I                                    P178217830RCAC                                      CLE134
     I                                    P178417860RCSD                                      CLE134
     I                                    P178717880RCDY                                      CLE134
     I                                    P178917900RCCY                                      CLE134
      *                                                                                       CLE134
     I                                    P179117930BIDT                                      CLE134
     I                                    P179417950BIDC                                      CLE134
     I                                     179617960BCAT                                      CLE134
     I                                    P179717980BCAC                                      CLE134
     I                                    P179918010BCSD                                      CLE134
     I                                    P180218030BCDY                                      CLE134
     I                                    P180418050BICC                                      CLE134
      *                                                                                       CLE134
     I                                     18061808 XRFI                                      CLE134
     I                                     180918180XRFN                                      CLE134
      *                                                                                       CLE134
     I                                     17741774 FAMU                                      CLE134
     I                                     17751775 FPNR                                      CLE134
     I                                    P177617780RIDT                                      CLE134
     I                                    P177917800RIDC                                      CLE134
     I                                     178117810RCAT                                      CLE134
     I                                    P178217830RCAC                                      CLE134
     I                                    P178417860RCSD                                      CLE134
     I                                    P178717880RCDY                                      CLE134
     I                                    P178917900RCCY                                      CLE134
      *                                                                                       CLE134
     I                                    P179117930BIDT                                      CLE134
     I                                    P179417950BIDC                                      CLE134
     I                                     179617960BCAT                                      CLE134
     I                                    P179717980BCAC                                      CLE134
     I                                    P179918010BCSD                                      CLE134
     I                                    P180218030BCDY                                      CLE134
     I                                    P180418050BICC                                      CLE134
      *                                                                                       CLE134
     I                                     18061808 XRFI                                      CLE134
     I                                     180918180XRFN                                      CLE134
      *                                                                                       CLE134
0135 I*
0136 I*    LOANS FILE - TRAILER
0137 I*
0138 I        NS       1 CT
0139 I                                        1   1 RECI
0140 I**********                              2   70LNRF                                      CLE148
     I                                        2   7 LNRF                                      CLE148
0141 I                                        8   8 RCDT
0142 I                                    P  17  190NORE
0143 I                                    P  20  220FLSZ
0144 I                                    P  23  250NLRB
0145 I                                    P  26  280NINS
0146 I                                    P  29  310NDEL
0147 I                                    P  32  340NLRA
0148 I                                    P  35  420VLBF
0149 I                                    P  43  440VLBL
0150 I                                    P  45  520VRIF
0151 I                                    P  53  540VRIL
0152 I                                    P  55  620VRDF
0153 I                                    P  63  640VRDL
0154 I                                    P  65  720VLAF
0155 I                                    P  73  740VLAL
0156 I                                    P  75  770DTMR
0157 I                                    P  78  800ITMR
0158 I                                    P 394 3960LCD
0159 I                                      397 397 CHTP
0160 I                                    P 398 4000TNLU
0161 I        NS
0167 I*
0168 I*****TABLE*FILE*-*INSTALLATION*CONTROL*DATA*RECORD*1.               S01194
0169 I**********                                                          S01194
0170 I*TABLE***NS       2 C0   3 C1  12 C1                                S01194
0171 I*******AND      13 C0                                               S01194
0172 I**********                              1   1 RECI                  S01194
0173 I**********                             12  130RCDE                  S01194
0174 I**********                             14  66 TITL                  S01194
0175 I**********                             67  67 DATF                  S01194
0176 I**********                             68  700DFBR                  S01194
0177 I**********                             74  74 MODI1                 S01194
0178 I**********                             75  75 MODI2                 S01194
0179 I**********                             76  76 MODI3                 S01194
0180 I**********                          P  77  790RUND                  S01194
0181 I**********                             80  86 RUNA                  S01194
0182 I**********                             87  870SFLG                  S01194
0183 I********NS                                                          S01194
0184 I**********                                                          S01194
0185 I*****CLIENT*FILE*-*CUSTOMER*STANDING*DATA*RECORD.                   S01194
0186 I**********                                                          S01194
0187 I*CLINT***NS       8 CA                                              S01194
0188 I**********                              1   1 RECI                  S01194
0189 I**********                              2   70CNUM                  S01194
0190 I**********                              8   8 RCDT                  S01194
0191 I**********                              9  28 CRNM                  S01194
0192 I**********                             29  38 CTWN                  S01194
0193 I**********                             39  48 CSNM                  S01194
0194 I**********                             49  56 CASK                  S01194
0195 I**********                             57  68 TELX                  S01194
0196 I**********                             69  80 CSID                  S01194
0197 I**********                             81  82 ACOC                  S01194
0198 I**********                             83  83 CBSI                  S01194
0199 I**********                             84  85 CCTZ                  S01194
0200 I**********                             86  87 CLOC                  S01194
0201 I**********                             88  930CPAR                  S01194
0202 I****FIELD**NAME*CHANGED*FOR*PROGRAM                                 S01194
0203 I***********                            94  960BRCDA                 S01194
0204 I**********                             97  980LINS                  S01194
0205 I**********                             99 1010LIND                  S01194
0206 I**********                          P 102 1040DASU                  S01194
0207 I**********                          P 105 1070CDIC                  S01194
0208 I**********                          P 108 1100DADE                  S01194
0142 I**********                            111 111 CMIN                  S01194
0210 I**********                            112 112 CTYP                  S01194
0211 I**********                            113 124 TELF                  S01194
0212 I**********                            125 133 CHID                  S01194
0213 I**********                            134 136 CHAB                  S01194
0214 I**********                          P 250 2520LCD                   S01194
0215 I**********                            253 253 CHTP                  S01194
0216 I**********                          P 254 2560TNLU                  S01194
0217 I********NS                                                          S01194
     I*                                                                   S01117
     I*    FACILITY FILE - DETAIL 1                                       S01117
     I*                                                                   S01117
     IFCLTY   NS  03  13 CA                                               S01117
     I                                        1   1 RECI                  S01117
     I                                      238 240 ORBR                  S01117
     I        NS                                                          S01117
     I/COPY WNCPYSRC,LE0740I001
      *                                                                   CLE005
     ISCSARD    E DSSCSARDPD                                              CLE005
      ** External DS for SAR details                                      CLE005
     I*                                                                   S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I** EXTERNAL DS FOR BRANCHES DETAILS                                 S01117
     I**                                                                  S01117
     I              A8CMCD                          CMPYM                 S01117
     ISDBANK    E DSSDBANKPD                                              S01194
      **  EXTERNAL DS FOR BANK DETAILS                                    S01194
     I              BJURPT                          TITL                  S01194
     I              BJMRDT                          RUNA                  S01194
     I              BJRDNB                          RUND                  E26731
     I              BJDFIN                          DATF                  S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
      **  EXTERNAL DS FOR CUSTOMER DETAILS                                S01194
     I              BBACOC                          ACOC                  S01194
     I              BBPCNB                          CPAR                  S01194
     I              QQDFAC                          QQDFA1                                    CGL029
      *                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
      **                                                                  S01117
0218 I**
0219 I**   DATA STRUCTURES - CHILD DETAILS
0220 I**
0221 I            DS
0222 I                                        1  14 CDET
0223 I                                        1   2 ACOCC
0224 I**********                              3   80CPARC                                     CSD027
0225 I**********                              9  140CNUMC                                     CSD027
0224 I                                        3   8 CPARC                                     CSD027
0225 I                                        9  14 CNUMC                                     CSD027
0226 I**   PARENT DETAILS
0227 I            DS
0228 I                                        1   8 PDET
0229 I                                        1   2 ACOCP
0230 I**********                              3   80CPARP                                     CSD027
0230 I                                        3   8 CPARP                                     CSD027
0231 I**   LOCAL DATA AREA FOR DATABASE ERROR IDENTIFICATION
0232 ILDA        UDS                            256
0233 I***********                           134 138 DBFILE                S01117
0234 I***********                           139 167 DBKEY                 S01117
0235 I***********                           168 175 DBPGM                 S01117
0236 I***********                           176 1770DBASE                 S01117
0233 I                                      134 141 DBFILE                S01117
0234 I                                      142 170 DBKEY                 S01117
0235 I                                      171 180 DBPGM                 S01117
0236 I                                      181 1830DBASE                 S01117
     I*                                                                   S01117
     I**   DETERMINE THE ORIGINATING BRANCH OF THE FACILITY               S01117
     I@FKEYA      DS                             11                       S01117
     I**********                              1  110@FKEY                              S01117 CSD027
     I**********                              1   60FCUS                               S01117 CSD027
     I                                        1  11 @FKEY                                     CSD027
     I                                        1   6 FCUS                                      CSD027
     I                                        7   90FTYP                  S01117
     I                                       10  110FSEQ                  S01117
      *
     C** PARAMETER LIST FOR PROGRAM 'AOBANKR0'                            S01194
     C           PLISTA    PLIST                                          S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C** PARAMETER LIST FOR PROGRAM 'AOCUSTR0'                            S01194
     C*                                                                   S01194
     C           PLIST1    PLIST                                          S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM           CKEY   10                       S01194
     C                     PARM '*CNUM  ' KEYSTS  7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C*                                                                   S01194
     C**********           MOVEACPY@      BIS@   80                                           260507
0237 C**
0238 C**   FIRST CYCLE PROCESSING
0239 C**
0240 C   40                GOTO ENDFC
0241 C                     SETON                     40
     C                     MOVEACPY@      BIS@   80                                           260507
     C                     Z-ADD0         ##BNDX  40                                          260507
     C           *LIKE     DEFN ##BNDX    B                                                   260507
     C           *LIKE     DEFN ##BNDX    ##BSV                                               260507
     C           *NAMVAR   DEFN           LDA                             S01194
0211 C**********           EXSR ZSYSTM                                    S01194
0199 C***99*****           SETON                     U7U8LR**DATABASE 01**S01194
0200 C***99*****           Z-ADD1         DBASE                           S01194
0201 C***99*****           MOVE ZTABKY    DBKEY                           S01194
0202 C***99*****           MOVE 'TABLE'   DBFILE                          S01194
     C                     CALL 'AOBANKR0'PLISTA                          S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
0199 C                     SETON                     U7U8LR**DATABASE 01**S01194
0200 C                     Z-ADD1         DBASE                           S01194
0202 C                     MOVE 'SDBANKPD'DBFILE                          S01194
     C                     ELSE                                           S01194
     C*
     C*    CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
     C           DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
      *                                                                   CLE005
      ** Check if SAR CLE005 is present                                   CLE005
      *                                                                   CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   @RTCD                           CLE005
     C                     PARM '*KEY   ' @OPTN                           CLE005
     C                     PARM 'CLE005'  @SARD   6                       CLE005
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
     C           @RTCD     IFEQ *BLANKS                                   CLE005
     C                     MOVE 'Y'       CLE005  1                       CLE005
     C                     ELSE                                           CLE005
     C           @RTCD     IFNE '*NRF   '                                 CLE005
     C                     SETON                     U7U8LR               CLE005
     C                     Z-ADD14        DBASE            ************   CLE005
     C                     MOVEL'SCSARDPD'DBFILE           * DBERR 14 *   CLE005
     C                     MOVEL'CLE005  'DBKEY            ************   CLE005
     C                     GOTO END                                       CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
0247 C**
0248 C**   SET UP HASH FIELDS
0249 C**
0250 C                     Z-ADD1         CONTIN  50
0251 C                     Z-ADD0         HASHF  150
0252 C                     Z-ADD0         HASHL   30
0253 C**
0254 C                     Z-ADD0         EXTCNT  50
0255 C                     Z-ADD0         EXTWHN 150
0256 C                     Z-ADD0         EXTDC   30
0257 C**
0258 C**   CLIKEY USED FOR CHAIN TO CLINT AND CLOANC
0259 C**
0260 C**********           MOVE 'A'       CLIKEY  7                       S01194
0261 C                     Z-ADD0         ZERO5   50
     C                     END                                            S01194
0262 C                     GOTO END
0263 C           ENDFC     TAG                             ** ENDFC TAG **
0264 C**
0265 C**   MAIN PROCESSING - PERFORM HASH TOTALLING OF RECORDS READ IN
0266 C**
     C                     SETOF                     5152
0268 C  N01N02             GOTO END
0269 C           CONTIN    ADD  2         CONTIN
0270 C*                                                                   E26731
0270 C**  IF NOT LIVE LOAN RECORD, SKIP PROCESSING                        E26731
     C/COPY WNCPYSRC,LE0740C001
0270 C**N01*****           GOTO END                                                           254794
      *                                                                                       254794
      ** Include matured records on hash totalling, reversed records were                     254794
      ** aready dropped by this time (LE0450 does not include reversed loans)                 254794
      *                                                                                       254794
0270 C*                                                                   E26731
0271 C                     Z-ADDHASHF     ZZTOTI
0272 C                     Z-ADDHASHL     ZZTOTD
0273 C                     MOVE CPAM      ZZAMT
0274 C   20                Z-SUBZZAMT     ZZAMT
0275 C                     EXSR GLZADD
0276 C                     Z-ADDZZTOTI    HASHF
0277 C                     Z-ADDZZTOTD    HASHL
      *                                                                                       254794
     C           *IN01     IFEQ '0'                                                           254794
     C                     GOTO END                                                           254794
     C                     ENDIF                                                              254794
     C*                                                                   S01117
0270 C**  IF LOAN IS FORWARD-VALUED, SKIP PROCESSING                      E26731
0270 C           VDAT      IFGT RUND                                      E26731
0270 C                     GOTO END                                       E26731
0270 C                     END                                            E26731
0270 C*                                                                   E26731
     C**   TO DETERMINE THE FACILITY ORIGINATING BRANCH                   S01117
     C           @FKEY     CHAINFCLTY                61                   S01117
     C           *IN61     IFEQ '1'                                       S01117
     C           *IN03     ORNE '1'                                       S01117
     C                     MOVEL'FCLTY'   DBFILE                          S01117
     C                     MOVEL@FKEYA    DBKEY                           S01117
     C                     Z-ADD13        DBASE            DBASE 13       S01117
     C                     SETON                     U7U8LR               S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO END                                       S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C** To get COMPANY OF ORIGINATING BRANCH (COOB) :                    S01117
     C*                                                                   S01117
     C           ORBR      IFEQ '   '                                                         243804
     C                     MOVELFCLB      ORBR                                                243804
     C                     ENDIF                                                              243804
      *                                                                                       243804
      ** Check whether details for Branch already in array                                    260507
      *                                                                                       260507
     C                     MOVELORBR      ##KB                                                260507
     C                     EXSR ##CHKB                                                        260507
      *                                                                                       260507
      ** If branch is in the array then use the details                                       260507
      *                                                                                       260507
     C           ##FIC     IFEQ 'Y'                                                           260507
     C                     EXSR ##SETB                                                        260507
     C                     ELSE                                                               260507
      *                                                                                       260507
      ** If branch is not in the array then get details from DB                               260507
      *                                                                                       260507
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM ORBR      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     U7U8LR               S01117
     C                     MOVEL'SDBRCHPD'DBFILE                          S01117
     C                     MOVEL@DSNB     DBKEY            ************** S01117
     C                     MOVEL@OPTN     DBOPTN  7        *DBASE 12 **** S01117
     C                     Z-ADD12        DBASE            ************** S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO END                                       S01117
     C                     ELSE                                                               260507
      *                                                                                       260507
      ** Details found on the DB so add them to the array                                     260507
      ** if the array still has room                                                          260507
      *                                                                                       260507
     C                     EXSR ##ADDB                                                        260507
     C                     END                                            S01117
     C                     ENDIF                                                              260507
     C*                                                                   S01117
     C                     MOVE CMPYM     COOB    3                       S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C** TO GET COMPANY  FOR LOAN EXTRACT RECORDS,                        S01117
     C**           USING FACILITY BRANCH CODE                             S01117
      *                                                                                       260507
      ** Check whether details for Branch already in array                                    260507
      *                                                                                       260507
     C                     MOVELFCLB      ##KB                                                260507
     C                     EXSR ##CHKB                                                        260507
      *                                                                                       260507
      ** If branch is in the array then use the details                                       260507
      *                                                                                       260507
     C           ##FIC     IFEQ 'Y'                                                           260507
     C                     EXSR ##SETB                                                        260507
     C                     ELSE                                                               260507
      *                                                                                       260507
      ** If branch is not in the array then get details from DB                               260507
      *                                                                                       260507
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM FCLB      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C*                                                                   S01117
     C           @RTCD     IFNE *BLANKS                                   S01117
     C                     SETON                     U7U8LR               S01117
     C                     MOVEL'SDBRCHPD'DBFILE                          S01117
     C                     MOVEL@DSNB     DBKEY            ************** S01117
     C                     MOVEL@OPTN     DBOPTN  7        *DBASE 11 **** S01117
     C                     Z-ADD11        DBASE            ************** S01117
     C                     EXSR *PSSR                                     S01117
     C                     GOTO END                                       S01117
     C                     ELSE                                                               260507
      *                                                                                       260507
      ** Details found on the DB so add them to the array                                     260507
      ** if the array still has room                                                          260507
      *                                                                                       260507
     C                     EXSR ##ADDB                                                        260507
     C                     END                                            S01117
     C                     ENDIF                                                              260507
0278 C**
0279 C**   DETERMINE WHICH TYPE OF RECORD TO OUTPUT
     C**
     C**   GUARANTEES ISSUED ARE NOW REPORTED IN THE SAME WAY AS
     C**   LOANS SINCE THEY ARE ATTACHED TO FACILITIES.
     C**
     C           PTYP      COMP 66                       52
     C  N52      PTYP      COMP 67                       52
      *                                                                   CLE005
     C           *IN52     IFEQ '0'                                       CLE005
     C           CLE005    ANDEQ'Y'                                       CLE005
     C           PTYP      IFEQ 69                                        CLE005
     C           PTYP      OREQ 72                                        CLE005
     C                     MOVE '1'       *IN52                           CLE005
     C                     ENDIF                                          CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C  N52                SETON                     51
0286 C**
0287 C           ACCESS    TAG                             ** ACCESS TAG *
0288 C**
0289 C**   ACCESS CLINT RECORD AND ASCERTAIN WHETHER LONER OR CHILD
0290 C**
0291 C**********           MOVELFCUS      CLIKEY                          S01194
0292 C**********           EXSR CLICHN                                    S01194
0293 C***99*****           GOTO END                                       S01194
0291 C                     MOVELFCUS      CKEY                            S01194
     C                     CALL 'AOCUSTR0'PLIST1                          S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C           @RTCD     ANDNE'*CUSCLS'                                                   MD041994
     C                     MOVE CKEY      DBKEY                        ***S01194
     C                     MOVE 'SDCUSTPD'DBFILE           ***************S01194
0237 C                     Z-ADD2         DBASE            DBASE 2        S01194
0234 C                     SETON                     U7U8LR               S01194
0209 C                     GOTO END                                       S01194
     C                     END                                            S01194
0294 C**
0295 C********************************************************************
0296 C                     SETOF                     414243
0297 C**
0298 C**   DETERMINE WHETHER PARENT CHILD OR LONER
0299 C**
0300 C**********           TESTB'2'       CMIN           41               S01194
     C           BBPAIN    COMP 'P'                      41               S01194
0301 C********** CPAR      COMP 0                    42                   S01194
0301 C           CPAR      COMP *BLANKS              4242                 S01194
0302 C  N41N42             SETON                     43
0303 C**
0304 C**   SET UP FIELDS FOR OUTPUT
0305 C**
0306 C   41                MOVE FCUS      CPARP
0307 C   41                MOVE ACOF      ACOCP
0308 C   42                MOVE ACOF      ACOCC
0309 C   42                MOVE CPAR      CPARC
0310 C   42                MOVE FCUS      CNUMC
0311 C   42                MOVE CPAR      CPARP
0312 C   42                SETON                     41
0313 C  N42                GOTO HASH
0314 C**
0315 C**   IF A CHILD CHAIN TO CLINT FOR PARENT'S A/C OFFICER
0316 C**
0317 C**********           MOVELCPAR      CLIKEY                          S01194
0318 C**********           EXSR CLICHN                                    S01194
0319 C***99*****           GOTO END                                       S01194
0317 C                     MOVELCPAR      CKEY                            S01194
     C                     CALL 'AOCUSTR0'PLIST1                          S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C           @RTCD     ANDNE'*CUSCLS'                                                   MD041994
     C                     MOVE CKEY      DBKEY                        ***S01194
     C                     MOVE 'SDCUSTPD'DBFILE           ***************S01194
0237 C                     Z-ADD3         DBASE            DBASE 3        S01194
0234 C                     SETON                     U7U8LR               S01194
0209 C                     GOTO END                                       S01194
     C                     END                                            S01194
0320 C**
0321 C                     MOVE ACOC      ACOCP
0322 C**
0323 C**   PERFORM HASH TOTALLING FOR RECORDS EXTRACTED
0324 C**
0325 C           HASH      TAG                             ** HASH TAG ***
0326 C                     EXSR HASTOT
0327 C   42                EXSR HASTOT
0328 C**
0329 C           END       TAG                             ** END TAG ****
0330 C**
0331 C**   LAST RECORD CALCS
0332 C**
0333 CLR         EXTCNT    ADD  1         EXTCNT
0334 CLR         CONTIN    ADD  1         CONTIN
0335 CLRNU8      CONTIN    COMP NORE                 U8U8
0336 CLRNU8      HASHF     COMP VLAF                 U8U8
0337 CLRNU8      HASHL     COMP VLAL                 U8U8
0338 CLR U7                MOVE 'LE0740'  DBPGM
     CLR U7 U8             EXSR *PSSR                                     S01117
0339 C********************************************************************
      /EJECT                                                                                  260507
      ********************************************************************                    260507
      *                                                                  *                    260507
      * ##CHKB - Subroutine to check the Branch in the arrays            *                    260507
      *                                                                  *                    260507
      ********************************************************************                    260507
     C           ##CHKB    BEGSR                                                              260507
      *                                                                                       260507
     C           *LIKE     DEFN A8BRCD    ##KB                                                260507
      *                                                                                       260507
      ** Set off the branch found indicator                                                   260507
      *                                                                                       260507
     C                     MOVEL*BLANK    ##FIC   1                                           260507
      *                                                                                       260507
      ** Save the state of indicator 30 so it can be reset at the end                         260507
      ** of the SR as it may be used elsewhere in the code                                    260507
      *                                                                                       260507
     C           *IN30     IFEQ *ON                                                           260507
     C                     MOVEL'Y'       #IN30   1                                           260507
     C                     ELSE                                                               260507
     C                     MOVEL'N'       #IN30                                               260507
     C                     ENDIF                                                              260507
      *                                                                                       260507
     C                     SETOF                         30                                   260507
      *                                                                                       260507
      ** Restore the saved value of B                                                         260507
      *                                                                                       260507
     C                     Z-ADD##BSV     B                                                   260507
      *                                                                                       260507
      ** Check whether details for Branch already in array                                    260507
      *                                                                                       260507
      ** Is this the same as the last LOKUP, if so we can bypass                              260507
      ** the LOKUP                                                                            260507
      ** Defend against B being 0                                                             260507
      *                                                                                       260507
     C           B         IFEQ 0                                                             260507
     C                     Z-ADD1         B                                                   260507
     C                     ENDIF                                                              260507
      *                                                                                       260507
      ** If the branch being checked is the same then use these                               260507
      ** details rather than doing a LOKUP                                                    260507
      *                                                                                       260507
     C           ##KB      IFEQ ##BR,B                                                        260507
      *                                                                                       260507
      ** Found, so seton 30                                                                   260507
      *                                                                                       260507
     C                     SETON                         30                                   260507
     C                     ELSE                                                               260507
     C                     Z-ADD1         B                                                   260507
     C           ##KB      LOKUP##BR,B                   30                                   260507
     C                     ENDIF                                                              260507
      *                                                                                       260507
      ** Save the last update to B                                                            260507
      *                                                                                       260507
     C           *IN30     IFEQ *ON                                                           260507
     C                     Z-ADDB         ##BSV                                               260507
      *                                                                                       260507
      ** Set the indicator to show the data was found                                         260507
      *                                                                                       260507
     C                     MOVEL'Y'       ##FIC                                               260507
     C                     ENDIF                                                              260507
      *                                                                                       260507
      ** Reset the state of indicator 30.                                                     260507
      *                                                                                       260507
     C           #IN30     IFEQ 'Y'                                                           260507
     C                     MOVEL*ON       *IN30                                               260507
     C                     ELSE                                                               260507
     C                     MOVEL*OFF      *IN30                                               260507
     C                     ENDIF                                                              260507
      *                                                                                       260507
     C                     ENDSR                                                              260507
      ********************************************************************                    260507
      /EJECT                                                                                  260507
      ********************************************************************                    260507
      *                                                                  *                    260507
      * ##SETB - Sets up the SDBRCHPD fields used in the code from the   *                    260507
      *          arrays                                                  *                    260507
      *                                                                  *                    260507
      ********************************************************************                    260507
     C           ##SETB    BEGSR                                                              260507
      *                                                                                       260507
     C                     MOVEL##BR,B    A8BRCD                                              260507
     C                     MOVEL##BC,B    CMPYM                                               260507
     C                     MOVEL##BI,B    A8BICN                                              260507
      *                                                                                       260507
     C                     ENDSR                                                              260507
      *                                                                                       260507
      ********************************************************************                    260507
      /EJECT                                                                                  260507
      ********************************************************************                    260507
      *                                                                  *                    260507
      * ##ADDB - Adds the SDBRCHPD fields used in the code to the arrays *                    260507
      *                                                                  *                    260507
      ********************************************************************                    260507
     C           ##ADDB    BEGSR                                                              260507
      *                                                                                       260507
      ** If there is still room in the array then add the details                             260507
      *                                                                                       260507
     C           ##BNDX    IFLT 999                                                           260507
     C                     ADD  1         ##BNDX                                              260507
     C                     Z-ADD##BNDX    B                                                   260507
     C                     MOVELA8BRCD    ##BR,B                                              260507
     C                     MOVELCMPYM     ##BC,B                                              260507
     C                     MOVELA8BICN    ##BI,B                                              260507
     C                     ENDIF                                                              260507
      *                                                                                       260507
      ** Update ##BSV so next call to ##CHKB checks this latest addition                      260507
      ** to the array first                                                                   260507
      *                                                                                       260507
     C                     Z-ADDB         ##BSV                                               260507
      *                                                                                       260507
     C                     ENDSR                                                              260507
      ********************************************************************                    260507
      /EJECT                                                                                  260507
      ********************************************************************                    260507
0340 C*                                                                  *
0341 C*****CLICHN*SR.*TO*CHAIN*TO*CLINT*AND SET INDICATORS IF NOT FOUND  *S01194
0342 C*                                                                  *S01194
0343 C********** CLICHN    BEGSR                           ** CLICHN BEGSRS01194
0344 C**********                                                          S01194
0345 C**********           SETOF                     99                   S01194
0346 C********** CLIKEY    CHAINCLINT                99                   S01194
0347 C**N99***** RECI      COMP 'D'                  9999                 S01194
0348 C***99*****           MOVE 'CLINT'   DBFILE                          S01194
0349 C***99*****           MOVE CLIKEY    DBKEY                           S01194
0350 C***99*****           Z-ADD3         DBASE            DBASE 3        S01194
0351 C***99*****           SETON                     U7U8LR               S01194
0352 C**********                                                          S01194
0353 C**********           ENDSR                                          S01194
0354 C*                                                                  *
0355 C********************************************************************
0356 C********************************************************************
0357 C*                                                                  *
0358 C*    HASTOT SR. TO ACCUMULATE HASH TOTALS OF RECORDS OUTPUT        *
0359 C           HASTOT    BEGSR                           ** HASTOT BEGSR
0360 C**
0361 C           EXTCNT    ADD  1         EXTCNT
0362 C                     Z-ADDEXTWHN    ZZTOTI
0363 C                     Z-ADDEXTDC     ZZTOTD
0364 C                     MOVE CPAM      ZZAMT
0365 C   20                Z-SUBZZAMT     ZZAMT
0366 C                     EXSR GLZADD
0367 C                     Z-ADDZZTOTI    EXTWHN
0368 C                     Z-ADDZZTOTD    EXTDC
0369 C**
0370 C                     ENDSR
0371 C*                                                                  *
0372 C********************************************************************
0373 C********************************************************************
0374 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
0375 C*   IND '99' IS SET BY AN OVERFLOW ERROR
0376 C*
0377 CSR         GLZADD    BEGSR                           *** GLZADD ****
0378 C*
0379 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
0380 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
0381 C*
0382 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
0383 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
0384 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
0385 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
0386 C*
0387 CSR                   EXSR GLZSUM
0388 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
0389 C*
0390 C********************************************************************
0391 C********************************************************************
0392 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
0393 C*                        GLZADD, GLZSUB, GLZCMP.
0394 C*          PARAMETERS PASSED -
0395 C*                     I/P ZZAMTI ZZAMTD
0396 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
0397 C*
0398 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
0399 C*
0400 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
0401 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
0402 CSR                   SETOF                     919293
0403 CSR                   SETOF                     949599
0404 C*
0405 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
0406 CSR         ZZAMTI    COMP 0                      9293
0407 CSR 93      ZZAMTD    COMP 0                      9293
0408 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0409 C*
0410 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
0411 CSR         ZZTOTI    COMP 0                      9193
0412 CSR 93      ZZTOTD    COMP 0                      9193
0413 C*
0414 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
0415 CSR 93                Z-ADDZZAMTI    ZZTOTI
0416 CSR 93                Z-ADDZZAMTD    ZZTOTD
0417 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0418 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
0419 CSR 91N92
0420 CORN91 92             GOTO ZZOFPS
0421 C*
0422 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
0423 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
0424 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
0425 C*
0426 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
0427 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
0428 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
0429 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
0430 C*
0431 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
0432 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
0433 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
0434 CSRN99                Z-ADDZZWK2     ZZTOTD
0435 CSRN99                Z-ADDZZWK3     ZZTOTI
0436 C*
0437 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
0438 CSR 99                Z-ADD0         ZZAMT  153
0439 CSR                   GOTO ZZSEND
0440 C*
0441 C* THE 'SIGNS' ARE DIFFERENT
0442 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
0443 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
0444 C*
0445 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
0446 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
0447 C*
0448 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
0449 C*
0450 CSR 91                Z-SUBZZTOTI    ZZTOTI
0451 CSR 91                Z-SUBZZTOTD    ZZTOTD
0452 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
0453 C*
0454 CSR         ZZTOTI    COMP ZZAMTI               93  95
0455 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
0456 C*
0457 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
0458 CSR 95                Z-ADD0         ZZTOTI
0459 CSR 95                Z-ADD0         ZZTOTD
0460 CSR 95                GOTO ZZSEND
0461 C*
0462 C* IF ZZTOT GT. ZZAMT.
0463 CSR 93      ZZAMTD    COMP ZZTOTD               94
0464 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
0465 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
0466 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
0467 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
0468 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
0469 C*
0470 C*
0471 C* IF ZZAMT GT. ZZTOT.
0472 CSRN93      ZZTOTD    COMP ZZAMTD               94
0473 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
0474 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
0475 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
0476 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
0477 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
0478 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
0479 C*
0480 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
0481 CSR                   SETOF                     94
0482 CSR 93 91
0483 CORN93 92             SETON                     94
0484 CSR 94                Z-SUBZZTOTI    ZZTOTI
0485 CSR 94                Z-SUBZZTOTD    ZZTOTD
0486 C**
0487 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
0488 CSR 92                Z-SUBZZAMTI    ZZAMTI
0489 CSR 92                Z-SUBZZAMTD    ZZAMTD
0490 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
0491 C**
0492 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
0493 CSR                   SETOF                     96
0494 CSR         ZZTOTD    COMP 0                        91
0495 CSR 91      ZZTOTI    COMP 0                      96
0496 CSR 96                MOVE '.000-'   ZZNEGD  5
0497 CSR                   ENDSR                             ** ENDSR **
     C/COPY WNCPYSRC,LE0740C002
0498 C********************************************************************
0499 C********************************************************************
0500 C**
0469 C*****ZSYSTM*SR.*TO*CHAIN TO THE INSTALLATION CONTROL DATA RECORD.   S01194
0470 C**********                                                          S01194
0471 C********** ZSYSTM    BEGSR                           *** ZSYSTM *** S01194
0472 C**********                                                          S01194
0473 C*****SET*UP*KEY*FOR*INSTALLATION CONTROL RECORD.                    S01194
0474 C**********           MOVEL'01      'ZTABKY 12                       S01194
0475 C**********           MOVE '  10'    ZTABKY                          S01194
0476 C**********                                                          S01194
0477 C********** ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
0478 C**N99***** RECI      COMP 'D'                  9999  ON, IS DELETED S01194
0479 C**********                                                          S01194
0480 C*****CHECK*SYSTEM*DATE FORMAT, DDMMYY OR MMDDYY.                    S01194
0481 C********** DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
0482 C**********                                                          S01194
0483 C**********           ENDSR                                          S01194
0516 C**
0517 C**
0518 C********************************************************************
     C********************************************************************S01117
     C*                                                                   S01117
     C*  *PSSR --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
     C*                                                                   S01117
     C*  CALLED FROM: AFTER ABNORMAL OPERATION OCCURS                     S01117
     C*                                                                   S01117
     C*  CALLS: NOTHING                                                   S01117
     C*                                                                   S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C********************************************************************S01117
0519 O**
0520 O**   UTILISED FOR LONER - PTYP 61-65
0521 O**
0522 OFPORTFP D        51 43
0523 O                                    1 'D'
     O                         ACOF       3
0525 O**********                          9 '000000'                                          CSD027
     O                                    9 '      '                                          CSD027
0526 O                         FCUS      15
0527 O                                   18 'L6U'
0528 O                         CCY       21
0529 O                         CPAM      29P
0530 O**********               FTYP      32                                                   CGL029
0531 O**********                         33 '-'                                               CGL029
0532 O**********               FSEQ      35                                                   CGL029
0533 O                         ZERO5     38P
0534 O**********               LNRF      44                                                   CGL029
0535 O**********                         47 'LEB'                                             CGL029
     O                                   47 'B'                                               CGL029
0536 O***********              BRCD      50                               S01117
     O                         FCLB      50                               S01117
0537 O                         RCSI      57
0538 O                         LTYP      59
0539 O                                   60 '/'
0540 O                         SUTP      62
     O                         CMPYM     70                               S01117
     O                         ORBR      73                               S01117
     O                         COOB      76                               S01117
     O                         BRCA      79                               S01117
     O                         VDAT      82P                              MEP062
     O                         FTYP      99                                                   CGL029
     O                                  100 '-'                                               CGL029
     O                         FSEQ     102                                                   CGL029
     O                         LNRF     114                                                   CGL029
     O                                  122 'LE'                                              CGL029
     O                         CLAS     126                                                   CLE042
0541 O**
0542 O**   UTILISED FOR LONER - PTYP 66-67
0543 O**
0544 O        D        52 43
0545 O                                    1 'D'
     O                         ACOF       3
0547 O*********                           9 '000000'                                          CSD027
     O                                    9 '      '                                          CSD027
0548 O                         FCUS      15
0549 O                                   18 'L6U'
0550 O                         CCY       21
0551 O                         CPAM      29P
0552 O**********               FTYP      32                                                   CGL029
0553 O**********                         33 '-'                                               CGL029
0554 O**********               FSEQ      35                                                   CGL029
0555 O                         ZERO5     38P
0556 O**********               OLNO      44                                                   CGL029
0557 O**********                         47 'SOB'                                             CGL029
     O                                   47 'B'                                               CGL029
0558 O***********              BRCD      50                               S01117
0558 O                         FCLB      50                               S01117
0559 O                         LNRF      56
0560 O                         RCSI      57
0561 O                         LTYP      59
0562 O                                   60 '/'
0563 O                         SUTP      62
     O                         CMPYM     70                               S01117
     O                         ORBR      73                               S01117
     O                         COOB      76                               S01117
     O                         BRCA      79                               S01117
     O                         VDAT      82P                              MEP062
     O                         FTYP      99                                                   CGL029
     O                                  100 '-'                                               CGL029
     O                         FSEQ     102                                                   CGL029
     O                         OLNO     114                                                   CGL029
     O                                  122 'SO'                                              CGL029
     O                         CLAS     126                                                   CLE042
0582 O**
0583 O**   UTILISED FOR CHILD AND PARENT - PTYP 61-65
0584 O**
0585 O        D        51 42
0586 O                                    1 'D'
0587 O                         CDET      15
0588 O                                   18 'C6U'
0589 O                         CCY       21
0590 O                         CPAM      29P
0591 O**********               FTYP      32                                                   CGL029
0592 O**********                         33 '-'                                               CGL029
0593 O**********               FSEQ      35                                                   CGL029
0594 O                         ZERO5     38P
0595 O**********               LNRF      44                                                   CGL029
0596 O**********                         47 'LEB'                                             CGL029
     O                                   47 'B'                                               CGL029
0597 O***********              BRCD      50                               S01117
0597 O                         FCLB      50                               S01117
0598 O                         RCSI      57
0599 O                         LTYP      59
0600 O                                   60 '/'
0601 O                         SUTP      62
     O                         CMPYM     70                               S01117
     O                         ORBR      73                               S01117
     O                         COOB      76                               S01117
     O                         BRCA      79                               S01117
     O                         VDAT      82P                              MEP062
     O                         FTYP      99                                                   CGL029
     O                                  100 '-'                                               CGL029
     O                         FSEQ     102                                                   CGL029
     O                         LNRF     114                                                   CGL029
     O                                  122 'LE'                                              CGL029
     O                         CLAS     126                                                   CLE042
0602 O        D        51 41
0603 O                                    1 'D'
0604 O                         PDET       9
0605 O                                   18 '999999P6U'
0606 O                         CCY       21
0607 O                         CPAM      29P
0608 O**********               FTYP      32                                                   CGL029
0609 O**********                         33 '-'                                               CGL029
0610 O**********               FSEQ      35                                                   CGL029
0611 O                         ZERO5     38P
0612 O**********               LNRF      44                                                   CGL029
0613 O**********                         47 'LEB'                                             CGL029
     O                                   47 'B'                                               CGL029
0614 O***********              BRCD      50                               S01117
0614 O                         FCLB      50                               S01117
0615 O                         RCSI      57
0616 O                         LTYP      59
0617 O                                   60 '/'
0618 O                         SUTP      62
0619 O                       42          63 'C'
     O                         CMPYM     70                               S01117
     O                         ORBR      73                               S01117
     O                         COOB      76                               S01117
     O                         BRCA      79                               S01117
     O                         VDAT      82P                              MEP062
     O                         FTYP      99                                                   CGL029
     O                                  100 '-'                                               CGL029
     O                         FSEQ     102                                                   CGL029
     O                         LNRF     114                                                   CGL029
     O                                  122 'LE'                                              CGL029
     O                         CLAS     126                                                   CLE042
0620 O**
0621 O**   UTILISED FOR CHILD AND PARENT - PTYP 66-67
0622 O**
0623 O        D        52 42
0624 O                                    1 'D'
0625 O                         CDET      15
0626 O                                   18 'C6U'
0627 O                         CCY       21
0628 O                         CPAM      29P
0629 O**********               FTYP      32                                                   CGL029
0630 O**********                         33 '-'                                               CGL029
0631 O**********               FSEQ      35                                                   CGL029
0632 O                         ZERO5     38P
0633 O**********               OLNO      44                                                   CGL029
0634 O**********                         47 'SOB'                                             CGL029
     O                                   47 'B'                                               CGL029
0635 O***********              BRCD      50                               S01117
0635 O                         FCLB      50                               S01117
0636 O                         LNRF      56
0637 O                         RCSI      57
0638 O                         LTYP      59
0639 O                                   60 '/'
0640 O                         SUTP      62
     O                         CMPYM     70                               S01117
     O                         ORBR      73                               S01117
     O                         COOB      76                               S01117
     O                         BRCA      79                               S01117
     O                         VDAT      82P                              MEP062
     O                         FTYP      99                                                   CGL029
     O                                  100 '-'                                               CGL029
     O                         FSEQ     102                                                   CGL029
     O                         OLNO     114                                                   CGL029
     O                                  122 'SO'                                              CGL029
     O                         CLAS     126                                                   CLE042
0641 O        D        52 41
0642 O                                    1 'D'
0643 O                         PDET       9
0644 O                                   18 '999999P6U'
0645 O                         CCY       21
0646 O                         CPAM      29P
0647 O**********               FTYP      32                                                   CGL029
0648 O**********                         33 '-'                                               CGL029
0649 O**********               FSEQ      35                                                   CGL029
0650 O                         ZERO5     38P
0651 O**********               OLNO      44                                                   CGL029
0652 O**********                         47 'SOB'                                             CGL029
     O                                   47 'B'                                               CGL029
0653 O***********              BRCD      50                               S01117
0653 O                         FCLB      50                               S01117
0654 O                         LNRF      56
0655 O                         RCSI      57
0656 O                         LTYP      59
0657 O                                   60 '/'
0658 O                         SUTP      62
0659 O                       42          63 'C'
     O                         CMPYM     70                               S01117
     O                         ORBR      73                               S01117
     O                         COOB      76                               S01117
     O                         BRCA      79                               S01117
     O                         VDAT      82P                              MEP062
     O                         FTYP      99                                                   CGL029
     O                                  100 '-'                                               CGL029
     O                         FSEQ     102                                                   CGL029
     O                         OLNO     114                                                   CGL029
     O                                  122 'SO'                                              CGL029
     O                         CLAS     126                                                   CLE042
0689 O**
0690 O**   TRAILER
0691 O**
0692 OFPORTT2 T        LR
0693 O                                    1 'T'
0694 O                         EXTCNT     4P
0695 O                         EXTWHN    12P
0696 O                         EXTDC     14P
0697 O**
0698 O**   CONTROL REPORT
0699 O**
0700 O*E0740P1T**203   LR U7                                     S01124   S01117
0700 OLE0740AUT  203   LR U7                                              S01117
0701 O***********                        22 'REFERENCE LE0740'            S01117
0701 O                                   24 'REFERENCE LE0740AU'          S01117
0702 O                         TITL      89
0703 O                                  104 'DATE'
0704 O                         RUNA     112
0705 O                                  122 'PAGE'
0706 O                         PAGE  Z  127
0707 O        T  1     LR U7
0708 O                                   67 'LOANS EXTRACT FOR CUSTOM'
0709 O                                   90 'ER LENDING PORTFOLIO(2)'
0710 O        T  3     LR U7
0711 O                                   67 '------------------------'
0712 O                                   90 '-----------------------'
0713 O        T 32     LR U7
0714 O                                   51 '*** REFERENCE LE0740'
0715 O                                   71 '- DATABASE ERROR AT'
0716 O***********              DBASE     74                               S01117
0716 O                         DBASE     75                               S01117
0717 O        T        LR U7
0718 O                                   37 'FILENAME'
0719 O***********              DBFILE    43                               S01117
0720 O***********                        48 'KEY'                         S01117
0721 O***********              DBKEY     78                               S01117
0719 O                         DBFILE    46                               S01117
0720 O                                   51 'KEY'                         S01117
0721 O                         DBKEY     81                               S01117
0722 O        T   03   LR
0723 O***********                        22 'REFERENCE LE0740'            S01117
0723 O                                   24 'REFERENCE LE0740AU'          S01117
0724 O                         TITL      89
0725 O                                  104 'DATE'
0726 O                         RUNA     112
0727 O                                  122 'PAGE'
0728 O                         PAGE  Z  127
0729 O        T 2      LR
0730 O                                   59 'LOANS EXTRACT FOR CUSTOM'
0731 O                                   82 'ER LENDING PORTFOLIO(2)'
0732 O                                   98 '- FILE CONTROLS'
0733 O        T 1      LR
0734 O                                   59 '------------------------'
0735 O                                   83 '------------------------'
0736 O                                   98 '---------------'
0737 O        T 3      LR
0738 O                                   28 'S/CLOAN - RUN CONTROLS'
0739 O                                   59 'NUMBER'
0740 O                                   84 'VALUE'
0741 O        T 1      LR
0742 O                                   28 '----------------------'
0743 O                                   59 'OF RECORDS'
0744 O                                   84 'OF RECORDS'
0745 O        T 2      LR
0746 O                                   29 'TOTAL RECORDS ON FILE'
0747 O                      NU7NORE  3   59
0748 O                      NU7VLAF  4   81
0749 O                      NU7VLAL      84
0750 O        T 2      LR
0751 O                                   29 'TOTAL RECORDS ON FILE'
0752 O                                   42 '- CALCULATED'
0753 O                         CONTIN3   59
0754 O                         HASHF 4   81
0755 O                         HASHL     84
0756 O                   NU7 U8         111 '***   DIFFERENCE   ***'
0757 O        T 3      LR
0758 O                                   28 'S/FPORT - RUN CONTROLS'
0759 O        T 1      LR
0760 O                                   28 '----------------------'
0761 O        T 2      LR
0762 O                                   29 'RECORDS ADDED TO FILE'
0763 O                         EXTCNT3   59
0764 O                         EXTWHN4   81
0765 O                         EXTDC     84
0766 O********T*3      LR                                                 S01117
0767 O***********                        76 '*** END OF REPORT ***'       S01117
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
