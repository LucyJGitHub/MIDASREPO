0001 H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Loan & Guarantee Details Extract')            *
0002 F*****************************************************************
0003 F*                                                               *
     F*  Midas  Customer Lending Module                               *
0005 F*                                                               *
0006 F*     LE0780 - GUARANTEES MULTI-PURPOSE EXTRACT                 *
0007 F*                                                               *
      *  (c) Finastra International Limited 2001                      *
0009 F*                                                               *
      *  Last Amend No. CLE172             Date 01Oct20               *
      *  Prev Amend No. CSD103             Date 10Aug20               *
      *                 MD046248           Date 27Oct17               *
      *                 CLE141             Date 08Feb16               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CER059             Date 19Jul10               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CCB016             Date 20Sep07               *
      *                 CSC042             Date 16Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 198910             Date 06Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3644            Date 12Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 198590             Date 02Jan02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 168267             Date 10Oct99               *
      *                 165426             Date 08Oct99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 124245             Date 11Oct98               *
      *                 CLE005             Date 22May97               *
      *                 S01220             Date 15Mar91               *
      *                 S01194             DATE 16JAN90               *
      *                 S01117             DATE 04/06/89              *
      *                 E86109             DATE 21/10/87              *
      *                 E10821             DATE 21/08/87              *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  CLE172 - LIBOR Deregulation - Lending (Recompile)            *
      *  CSD103 - Libor Deregulation - Common Layer/Standing Data     *
      *  MD046248 - Finastra Rebranding                               *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           (Recompile)                                         *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus                                          *
      *  CCB016 - CoB performance enhancement                         *
      *           Stop looping once the key value is less than the    *
      *           values being read in.                               *
      *  CSC042 - COB performance Fixes                               *
      *         - Pgm calls AOBRCHR* 100K times for 205 records at RZB*
      *           Sofia. Reduce calls to AOBRCR* by caching data      *
      *         - Reduce number of calls to AOCUSTR by reusing data   *
      *           if current key is same as previous call to AOCUST   *
      *         - Reduce number of calls to AOCTRYR by reusing data   *
      *           if current key is same as previous call to AOCTRY   *
      *         - Fix database error processing in SR FACIL           *
      *  CRE026 - Consumer Banking                                    *
      *  198910 - Complete 177371.                                    *
      *           For Facility details, Facility Customer should be   *
      *           output in the Customer Number, not the Loan         *
      *           Customer. Otherwise the P2 report showing Facility  *
      *           Customer is ouput in Loan Customer sequence.        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type                              *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3644 - Serious Error in Collateralised Lending (Recompile)*
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  198590 - Output guarantee of undrawn facility in LE0780P2    *
      *           report.                                             *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
     F*  168267 - Correction to 124245, to add COLC to end of GSCEXGG,*
     F*           to comply with standard coding practice.            *
     F*  165426 - Total records on file GTEESGT must be calculated    *
     F*           by including records with RECI of '*', since they   *
     F*           are physically on the file.                         *
     F*  124245 - Upgrade of 61326 and 60984 to DBA2.  Exclude        *
     F*           forward dated loans and add additional field to     *
     F*           output extract file.                                *
     F*         - Output collateral code field to GSCEXGG.            *
     F*  CLE005 - Customer Lending Enhancements - Others (T3)         *
     F*     S01220  -  AMENDED FOR STRATEGIC RISK MANAGEMENT             *S01220
     F*                RELEASE 10 TO ALLOW THE INPUT OF A BOOK           *S01220
     F*                CODE AGAINST A LOAN.                              *S01220
     F*     S01194 - STANDING DATA CHANGES                               *S01194
     F*                                                                  *S01194
0009 F*     S01117  -  MULTIBRANCHING                                    *
     F*                                                                  *E10821
     F*     E10821 - CHAIN TO CLINT FILE FOR LATEST GUARANTOR DETAILS.   *E10821
     F*                                                                  *E10821
     F*     E86109 - CURRENCY AND AMOUNT OF GUARANTEE SHOULD ONLY        *E86109
     F*              APPEAR ONCE ON REPORT LE0780 FOR FACILITY           *E86109
     F*              BASED COLLATERAL.                                   *E86109
     F*                                                                  *E86109
     F********************************************************************E10821
0011 F*                                                                  *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
0013 FGTEES   IP  F     128 15AI     2 DISK
0014 F*TABLE***IF**F      96 12AI     2 DISK                              S01194
0015 F*CLOAN***IF**F*****400  7AI     2 DISK                              S01220
0015 F*CLOAN***IF**F     436  7AI     2 DISK                       S01220 CLE011
0015 F***CLOAN** IF  F    1310  7AI     2 DISK                                         CLE011 CGL029
     F*CLOAN***IF**F****1461  7AI     2 DISK                                           CGL029 CLE042
     F***CLOAN** IF  F    1773  7AI     2 DISK                                         CLE042 CER020
     F***CLOAN** IF  F    1782  7AI     2 DISK                                         CER020 CLE134
     FCLOAN   IF  F    1874  7AI     2 DISK                                                   CLE134
0016 FLEREF   IF  F      20 17AI     2 DISK
     F*CLINT***IF**F     256  7AI     2 DISK                        E10821S01194
0017 F*GSCEXHH O   F     128            DISK                              124245
0017 F*GSCEXGG O   F     128            DISK                              124245
0017 F*GSCEXT2 O   F     128            DISK                              124245
     F***********GSCEXHH O   F     134            DISK             124245 168267
     F***********GSCEXGG O   F     134            DISK             124245 168267
     F***********GSCEXT2 O   F     134            DISK             124245 168267
     FGSCEXHH O   F     137            DISK                               168267
     FGSCEXGG O   F     137            DISK                               168267
     FGSCEXT2 O   F     137            DISK                               168267
0018 F*E0780P1O   F     132            PRINTER                            S01124
     FLE0780AUO   F     132     OB     PRINTER                            S01117
0011 F*                                                                  *
0019 F* ID F  C  H  L    FUNCTION OF INDICATORS
0020 F* 01            LOAN-BASED GUARANTEE
0021 F* 02            FACILITY-BASED GUARANTEE
0022 F**10************TABLE,CLOAN,LEREF LIVE RECORD                       E10821
     F**10************TABLE,CLOAN,LEREF,CLINT LIVE RECORD           E10821S01194
     F* 10            CLOAN,LEREF LIVE RECORD                             S01194
0023 F*       20      FIRST CYCLE
0024 F*       21      PROCESSING TYPE OUT OF RANGE
0025 F*       22      OUTPUT TO EXTRACT FILE
0026 F*       23      FACILITY SAME
0027 F*       39      CHAIN FAIL
0028 F*       90-99   STANDARD SUBROUTINES
     E                    CPY@    1   1 80
     E                    ##BR      999  3               Branch codes                         CSC042
     E                    ##BC      999  3               Company codes                        CSC042
0029 F*       U7,U8   STANDARD MIDAS USAGE
0030 I*
0031 I*    GUARANTEES/SECURITY/COLLATERAL FILE - DETAIL
0032 I*
0033 I****GTEES*  NS  01   1 CD   8NCF                                                        CLE148
0034 I********** OR   02   1 CD   8 CF                                                        CLE148
0033 IGTEES   NS  01   1 CD   8NC                                                             CLE148
0034 I       OR   02   1 CD   8 C                                                             CLE148
0035 I                                        1   1 RECI
0036 I**********                              2   70CNUM                                      CSD027
0036 I**********                              2   70FCNUM                              124245 CSD027
0036 I                                        2   7 CNUM                                      CSD027
0036 I                                        2   7 FCNUM                                     CSD027
0037 I                                        8  13 FCLN
0038 I                                        9  130FCLNF
0039 I                                       14  160GUSN
0040 I                                    P  17  190STTD
0041 I                                    P  20  220EDDT
0042 I                                    P  23  250RVDT
0043 I                                       26  26 RVFR
0044 I                                       27  280RVDY
0045 I                                       29  31 CCY
0046 I                                    P  32  380UAMT
0047 I                                    P  39  410NOUN
0048 I                                    P  42  480TAMT
0049 I                                       49  83 NARR
0050 I                                       84  84 GSCI
0051 I                                       85  90 GBCN
0052 I                                       95  96 GCRK
0053 I                                       97  99 COLC
     I                                      109 111 BRCA                                      198590
0054 I                                    P 112 1180STAM
0055 I                                    P 119 1210ORED
0056 I                                    P 122 1240LCD
0057 I                                      125 125 CHTP
0058 I                                    P 126 1280TNLU
0059 I*
0060 I*    GUARANTEES/SECURITIES/COLLATERAL FILE - TRAILER
0061 I*
0062 I        NS       1 CT
0063 I                                        1   1 RECI
0064 I**********                              2   70CNUM                                      CSD027
0064 I                                        2   7 CNUM                                      CSD027
0065 I                                        8  13 FCLN
0066 I                                       14  160GUSN
0067 I                                    P  17  190NORE
0068 I                                    P  20  220FLSZ
0069 I                                    P  23  250NLRB
0070 I                                    P  26  280NINS
0071 I                                    P  29  310NDEL
0072 I                                    P  32  340NLRA
0073 I                                    P  35  420VLBF
0074 I                                    P  43  440VLBL
0075 I                                    P  45  520VRIF
0076 I                                    P  53  540VRIL
0077 I                                    P  55  620VRDF
0078 I                                    P  63  640VRDL
0079 I                                    P  65  720VRAF
0080 I                                    P  73  740VRAL
0081 I                                    P  75  820VLAF
0082 I                                    P  83  840VLAL
0083 I                                    P 122 1240LCD
0084 I                                      125 125 CHTP
0085 I                                    P 126 1280TNLU
0086 I        NS
0063 I                                        1   1 RECI
0087 I**************                                                      S01194
0088 I*****TABLE*FILE - INSTALLATION CONTROL DATA RECORD 1.               S01194
0089 I**************                                                      S01194
0090 I*TABLE***NS***    2 C0   3 C1  12 C1                                S01194
0091 I*******AND****  13 C0                                               S01194
0092 I**************                          1   1 RECI                  S01194
0093 I**************                         12  130RCDE                  S01194
0094 I**************                         14  66 TITL                  S01194
0095 I**************                         67  67 DATF                  S01194
0096 I***********                            68  700DFBR                  S01194
0097 I**************                         74  74 MODI1                 S01194
0098 I**************                         75  75 MODI2                 S01194
0099 I**************                         76  76 MODI3                 S01194
0100 I**************                      P  77  790RUND                  S01194
0101 I**************                         80  86 RUNA                  S01194
0102 I**************                         87  870SFLG                  S01194
0103 I**************                                                      S01194
0104 I*****TABLE*FILE - COUNTRY CODES RECORD.                             S01194
0105 I**************                                                      S01194
0106 I********NS**10   1 CD   2 C5   3 C0                                 S01194
0107 I**************                          1   1 RECI                  S01194
0108 I**************                          2   30RECT                  S01194
0109 I**************                         12  13 CCOD                  S01194
0110 I**************                         14  43 CNM                   S01194
0111 I**************                         44  45 REGC                  S01194
0112 I**************                         46  480DEPT                  S01194
0113 I**************                      P  49  510DEPX                  S01194
0114 I**************                      P  52  560DEPA                  S01194
0115 I**************                         57  57 DEPF                  S01194
0116 I**************                      P  58  600DEPR                  S01194
0117 I**************                         61  620DLRD                  S01194
0118 I**************                         63  650FRXT                  S01194
0119 I**************                      P  66  680FRXX                  S01194
0120 I**************                      P  69  730FRXA                  S01194
0121 I**************                         74  74 FRXF                  S01194
0122 I**************                      P  75  770FRXR                  S01194
0123 I**************                         78  790FLRD                  S01194
0124 I**************                      P  90  920LCD                   S01194
0125 I**************                         93  93 CHTP                  S01194
0126 I**************                      P  94  960TNLU                  S01194
0127 I********NS****                                                      S01194
0128 I*
0129 I*    CUSTOMER LENDING LOANS FILE - DETAIL RECORD 1
0130 I*
0131 ICLOAN   NS  10   1 CD   8 CA
0132 I                                        1   1 RECI
0133 I                                        2   7 LNRF
0134 I                                        8   8 RCDT
0135 I                                        9   90MRIN
0136 I                                       10  110PTYP
0137 I**********                             12  170CNUML                                     CSD027
0137 I                                       12  17 CNUML                                     CSD027
0138 I***********                            18  200BRCD                  S01117
0138 I**********                             18  20 BRCA                               S01117 198590
0138 I                                       18  20 CLBRCA                                    198590
0139 I                                       21  22 LTYP
0140 I                                       23  24 SUTP
0141 I                                    P  25  270DDAT
0142 I                                    P  28  300VDAT
0143 I                                    P  31  330MDAT
0144 I                                       34  350LASQ
0145 I**********                             36  410FCUS                                      CSD027
0145 I                                       36  41 FCUS                                      CSD027
0146 I                                       42  440FTYP
0147 I                                       45  460FSEQ
0148 I                                       47  49 CCYL
0149 I                                    P  50  560CPAM
0150 I                                       57  57 INTC
0151 I                                    P  58  637INTR
0152 I**********                             64  650BRTT                                      CSD103
0152 I                                       64  65 BRTT                                      CSD103
0153 I                                    P  66  717BRTE
0154 I                                    P  72  777RTSP
0155 I                                    P  78  815MARG
0156 I                                       82  82 SPIN
0157 I                                       83  83 CHIN
0158 I                                    P  84  897WTRT
0159 I                                       90  90 WTIN
0160 I                                       91  910REPT
0161 I                                    P  92  980RAMT
0162 I                                    P  99 1010NRPD
0163 I                                      102 102 RFRQ
0164 I                                      103 1040RDYN
0165 I                                      105 107 FCCY
0166 I                                      108 1100LIND
0167 I                                      111 112 CRSK
0168 I                                      113 114 ACOF
0169 I                                      115 115 NACD
0170 I                                      116 116 RELI
0171 I                                      117 117 AUTO
0172 I                                    P 118 1240PSAM
0173 I                                    P 125 1318BCXR
0174 I                                    P 132 1388FCXR
0175 I                                      139 1400SDST
0176 I**********                            141 152 OSDA                                      CGL029
     I                                      141 152 OSDAQQ                                    CGL029
0177 I                                      153 162 TSTN
0178 I                                      163 1640MDST
0179 I**********                            165 176 OMDA                                      CGL029
     I                                      165 176 OMDAQQ                                    CGL029
0180 I                                      177 186 TMAN
0181 I                                      187 196 FACO
0182 I                                    P 197 1990RLDT
0183 I                                    P 200 2020NROD
0184 I                                      203 203 RLFQ
0185 I                                      204 2050RLDY
0186 I**********                            207 2080NBRA                                      CSD103
0186 I                                      207 208 NBRA                                      CSD103
0187 I                                    P 209 2147NRTS
0188 I                                      215 215 NSIN
0189 I                                      216 2160NCAC
0190 I                                    P 217 2230AWTP
0191 I                                    P 224 2300WTRD
0192 I                                    P 231 2370WTWD
0193 I                                    P 238 2440IWOD
0194 I                                    P 245 2510PWOD
0195 I                                      252 252 BMDI
0196 I                                      253 253 FMDI
0197 I                                    P 254 2600PDIN
0198 I                                      287 287 BTIN
0199 I                                      288 2890BLDY
0200 I**********                            290 2950OLNO                                      CSD027
0200 I                                      290 295 OLNO                                      CSD027
0201 I                                      296 296 RCSI
0202 I                                      297 2970ICBS
0203 I                                      298 298 IPFR
0204 I                                    P 299 3050TOTI
0205 I                                    P 306 3080NIDT
0206 I                                    P 309 3110IBDT
0207 I                                    P 312 3140SLID
0208 I                                    P 315 3210AIPD
0209 I                                    P 322 3240DLRC
0210 I                                    P 325 3270IACD
0211 I                                    P 328 3340AITC
0212 I                                    P 335 3410TFEP
0213 I                                    P 342 3480AIAP
0214 I                                    P 349 3550IPRD
0215 I                                    P 356 3620IPRM
0216 I                                    P 363 3690ICTD
0217 I                                    P 370 3760AIMN
0218 I                                    P 377 3790RBDT
0219 I                                      384 3850IFDY
0220 I                                      386 386 LONI
0221 I                                      387 387 CNFI
0222 I                                      388 388 ACEI
0223 I                                      389 389 TLXI
0224 I                                      390 390 CBLI
0225 I                                    P 391 3930ORED
0226 I                                    P 394 3960LCD
0227 I                                      397 397 CHTP
0228 I                                    P 398 4000TNLU
     I                                      435 436 BOKC                  S01220
     I*************************************13901407 OSDA                               CGL029 CLE042
     I*************************************14081425 OMDA                               CGL029 CLE042
     I                                     15611578 OSDA                                      CLE042
     I                                     15791596 OMDA                                      CLE042
     I                                     17621765 CLAS                                      CLE042
     I                                     17801782 LOIC                                      CER020
      *                                                                                       CLE134
     I                                     18301830 FAMU                                      CLE134
     I                                     18311831 FPNR                                      CLE134
     I                                    P183218340RIDT                                      CLE134
     I                                    P183518360RIDC                                      CLE134
     I                                     183718370RCAT                                      CLE134
     I                                    P183818390RCAC                                      CLE134
     I                                    P184018420RCSD                                      CLE134
     I                                    P184318440RCDY                                      CLE134
     I                                    P184518460RICC                                      CLE134
      *                                                                                       CLE134
     I                                    P184718490BIDT                                      CLE134
     I                                    P185018510BIDC                                      CLE134
     I                                     185218520BCAT                                      CLE134
     I                                    P185318540BCAC                                      CLE134
     I                                    P185518570BCSD                                      CLE134
     I                                    P185818590BCDY                                      CLE134
     I                                    P186018610BICC                                      CLE134
      *                                                                                       CLE134
     I                                     18621864 XRFI                                      CLE134
     I                                     186518740XRFN                                      CLE134
      *                                                                                       CLE134
0229 I        NS
0230 I**
0231 I**   CUSTOMER/FACILITY/LOAN CROSS REFERENCE FILE
0232 I**
0233 ILEREF   NS  10   1 CD
0234 I                                        1   1 RECI
0235 I**********                              2   70CNUMR                                     CSD027
0235 I                                        2   7 CNUMR                                     CSD027
0236 I                                        8  120FCTN
0237 I                                       13  18 LNNO
0238 I                                       19  19 FLIN
0239 I        NS
0240 I**************                                                E10821S01194
     I*****CUSTOMER*DETAILS FILE                                    E10821S01194
     I**************                                                E10821S01194
     I*CLINT***NS**10   1 CD   8 CA                                 E10821S01194
     I*******OR*****   1 CC   8 CA                                  E10821S01194
     I**************                         84  85 CCTZ            E10821S01194
     I********NS****                                                E10821S01194
     I**************                                                      S01194
0241 I*****DATA*STRUCTURE - KEY TO COUNTRY CODES TABLE                    S01194
0242 I**************                                                      S01194
0243 I************DS                                                      S01194
0244 I**************                          1  12 CKEY                  S01194
0245 I**************                         11  12 GCRK                  S01194
0246 I**   KEY TO LEREF
0247 I            DS
0248 I                                        1  17 LEKEY
0248 I                                        1  17 LEKEY1                                    198590
0249 I**********                              1   60CNUM                                      CSD027
0249 I                                        1   6 CNUM                                      CSD027
0250 I                                        7  110FCLNF
0251 I**   LOCAL DATA AREA FOR DATABASE ERROR IDENTIFICATION
0252 ILDA        UDS                            256
0232 I*******                               134 138 DBFILE                S01117
0233 I*******                               139 167 DBKEY                 S01117
0234 I*******                               168 175 DBPGM                 S01117
0235 I*******                               176 1770DBASE                 S01117
0232 I                                      134 141 DBFILE                S01117
0233 I                                      142 170 DBKEY                 S01117
0234 I                                      171 180 DBPGM                 S01117
0235 I                                      181 1830DBASE                 S01117
     I**                                                                  S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I**  EXTERNAL DS FOR BANK CODES                                      S01194
     I              BJURPT                          TITL                  S01194
     I              BJMRDT                          RUNA                  S01194
     I              BJDFIN                          DATF                  S01194
     I**                                                                  S01117
     ISDBRCH    E DSSDBRCHPD                                              S01117
     I              A8CMCD                          CMPYM                 S01117
     I**  EXTERNAL DS FOR BRANCH CODES                                    S01117
     I**                                                                  S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I**  EXTERNAL DS FOR CUSTOMER DETAILS                                S01194
     I              BBCNCZ                          CCTZ                  S01194
     I              QQDFAC                          QQDFA1                                    CGL029
     I**                                                                  S01194
     ISDCTRY    E DSSDCTRYPD                                              S01194
     I**  EXTERNAL DS FOR COUNTRY DETAILS                                 S01194
     I              A4RGCD                          REGC                  S01194
     I**                                                                  CLE005
     ISCSARD    E DSSCSARDPD                                              CLE005
     I**  External DS for SAR Details                                     CLE005
     I*                                                                   S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
     I**                                                                  S01117
     C**********           MOVEACPY@      BIS@   80                                           CSC042
0257 C   20                GOTO ENDFC
0258 C                     SETON                     20
     C                     MOVEACPY@      BIS@   80                                           CSC042
     C                     Z-ADD0         ##BNDX  40                                          CSC042
     C           *LIKE     DEFN ##BNDX    B                                                   CSC042
     C           *LIKE     DEFN ##BNDX    ##BSV                                               CSC042
      *                                                                                       CSC042
0259 C**
0260 C**   FIRST CYCLE CALCS
0261 C**
     C                     MOVE *BLANK    DBFILE                          S11117
     C                     MOVE *BLANK    DBKEY                           S11117
0296 C                     MOVE 'LE0780'  DBPGM                           S01117
0262 C                     EXSR ZSYSTM
0263 C***99*********       SETON                     LRU7U8               S01194
0264 C***99*********       MOVE 'TABLE'   DBFILE                          S01194
0265 C***99*********       MOVE ZTABKY    DBKEY                           S01194
0266 C***99*********       Z-ADD1         DBASE            DBASE 1        S01194
0267 C   99                GOTO END
      *                                                                   CLE005
      ** Check if SAR CLE005 is present                                   CLE005
      *                                                                   CLE005
     C                     MOVE 'N'       CLE005  1                       CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   P@RTCD  7                       CLE005
     C                     PARM '*KEY   ' P@OPTN  7                       CLE005
     C                     PARM 'CLE005'  P@SARD  6                       CLE005
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
      *                                                                   CLE005
     C           P@RTCD    IFEQ *BLANKS                                   CLE005
     C                     MOVE 'Y'       CLE005  1                       CLE005
     C                     ELSE                                           CLE005
      *                                                                   CLE005
      ** Handle Database Error                                            CLE005
      *                                                                   CLE005
     C           P@RTCD    IFNE '*NRF    '                                CLE005
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE005
     C                     Z-ADD5         DBASE            * DBERR 05 *   CLE005
     C                     MOVEL'CLE005'  DBKEY            ************   CLE005
     C                     MOVE *ON       *INU7                           CLE005
     C                     MOVE *ON       *INU8                           CLE005
     C                     MOVE *ON       *INLR                           CLE005
     C                     MOVE *ON       *IN99                           CLE005
     C                     GOTO END                                       CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                                       CLE028
      ** Determine if Flat Rate Personal Loans (Rule of 78s) is                               CLE028
      ** installed                                                                            CLE028
      *                                                                                       CLE028
     C                     CALL 'AOSARDR0'                                                    CLE028
     C                     PARM *BLANKS   P@RTCD                                              CLE028
     C                     PARM '*VERIFY' P@OPTN                                              CLE028
     C                     PARM 'CLE028'  P@SARD                                              CLE028
     C           SCSARD    PARM SCSARD    DSFDY                                               CLE028
      *                                                                                       CLE028
     C           P@RTCD    IFNE *BLANKS                                                       CLE028
     C           P@RTCD    ANDNE'*NRF   '                                                     CLE028
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE028
     C                     Z-ADD6         DBASE                                               CLE028
     C                     MOVELP@SARD    DBKEY                                               CLE028
     C                     MOVE *ON       *INU7                                               CLE028
     C                     MOVE *ON       *INU8                                               CLE028
     C                     MOVE *ON       *INLR                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
     C           P@RTCD    IFEQ *BLANKS                                                       CLE028
     C                     MOVE 'Y'       CLE028  1                                           CLE028
     C                     ELSE                                                               CLE028
     C                     MOVE 'N'       CLE028                                              CLE028
     C                     ENDIF                                                              CLE028
0268 C**
0269 C                     Z-ADD2         OUTREC  50
0270 C                     Z-ADD0         ORECF  150
0271 C                     Z-ADD0         ORECL   30
0272 C                     Z-ADD0         INREC   50
0273 C                     Z-ADD0         INRECF 150
0274 C                     Z-ADD0         INRECL  30
0275 C**
0276 C                     MOVE 'A'       CLOKEY  7
0277 C**************       MOVEL'50'      CKEY                            S01194
0278 C           ENDFC     TAG                             ** ENDFC TAG **
0279 C**
0280 C**   DETAIL CALCS
0281 C**
0282 C                     EXSR HASHIN
0283 C   01                EXSR LOAN
0284 C   02                EXSR FACIL
0285 C**
0286 C           END       TAG                             ** END TAG ****
0287 C**
0288 C**   LAST RECORD CALCS
     C**
0289 C**
0290 CLR U7                GOTO ENDLR
0291 CLR         INREC     COMP NORE                 U8U8
0292 CLRNU8      INRECF    COMP VLAF                 U8U8
0293 CLRNU8      INRECL    COMP VLAL                 U8U8
0294 C**
0295 CLR         ENDLR     TAG                             ** ENDLR TAG **
0296 C*R*U7*******         MOVE 'LE0780'  DBPGM                           S01117
     CLR U7 U8             EXSR *PSSR                                     S01117
0297 C********************************************************************
0298 C*                                                                  *
0299 C*    LOAN SR. TO PROCESS LOAN-BASED GUARANTEES                     *
0300 C*                                                                  *
0301 C           LOAN      BEGSR                           ** LOAN BEGSR *
0302 C**
0303 C                     MOVELFCLN      CLOKEY
0304 C                     EXSR CLOCHN
0305 C**
0306 C                     ENDSR
0307 C*                                                                  *
0308 C********************************************************************
0309 C********************************************************************
0310 C*                                                                  *
0311 C*    HASHIN SR. TO MAINTAIN TOTALS OF RECORDS READ IN              *
0312 C*                                                                  *
0313 C           HASHIN    BEGSR                           ** HASHIN BEGSR
0314 C**
     C***********RECI      CABEQ'*'       HSEND                           165426
     C*
0315 C           INREC     ADD  1         INREC
0316 C  N01N02             GOTO HSEND
0317 C                     Z-ADDINRECF    ZZTOTI
0318 C                     Z-ADDINRECL    ZZTOTD
0319 C                     MOVE UAMT      ZZAMT
0320 C                     EXSR GLZADD
0321 C                     Z-ADDZZTOTI    INRECF
0322 C                     Z-ADDZZTOTD    INRECL
0323 C**
0324 C           HSEND     ENDSR                           ** HSEND ENDSR
0325 C*                                                                  *
0326 C********************************************************************
0327 C********************************************************************
0328 C*                                                                  *
0329 C*    CLOCHN SR. TO CHAIN TO CLOAN FILE AND CHECK WHETHER           *
0330 C*    RECORD FOUND MEETS REQUIREMENTS FOR EXTRACT.                  *
0331 C*                                                                  *
0332 C           CLOCHN    BEGSR                           ** CLOCHN BEGSR
0333 C**
0334 C                     SETOF                     3910
0335 C           CLOKEY    CHAINCLOAN                39
0336 C  N10                GOTO CLEND
0337 C**
0338 C           PTYP      COMP 61                     21
0339 C  N21      PTYP      COMP 65                   21
     C**   INCLUDE RISK LOANS IN EXTRACT
     C   21      PTYP      COMP 70                   2121
      *                                                                   CLE005
      ** If SAR CLE005 is Present and PTYP is 68 or 71                    CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ 'Y'                                       CLE005
      *                                                                   CLE005
     C           PTYP      IFEQ 68                                        CLE005
     C           PTYP      OREQ 71                                        CLE005
     C                     MOVE *OFF      *IN21                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
      ** Include Flat rate personal loans in extract                                          CLE028
      *                                                                                       CLE028
     C           *IN21     IFEQ *ON                                                           CLE028
     C           PTYP      ANDEQ80                                                            CLE028
     C           CLE028    ANDEQ'Y'                                                           CLE028
     C                     MOVE *OFF      *IN21                                               CLE028
     C                     ENDIF                                                              CLE028
      *                                                                                       CLE028
0340 C   21                GOTO CLEND
      *                                                                   124245
      ** Do not extract forward value dated loans                         124245
      *                                                                   124245
     C           VDAT      CABGTBJRDNB    CLEND                           124245
     C**                                                                  E10821
     C*****CHAIN*TO*CLINT FILE FOR GUARANTOR COUNTRY OF RISK              E10821
     C**   CALL CUSTOMER ACCESS PROGRAMME FOR GUARANTOR COUNTRY OF RISK   E10821
     C**                                                                  E10821
     C**************       SETOF                     3910           E10821S01194
     C**************       MOVELGBCN      CLIKEY  7                 E10821S01194
     C**************       MOVE 'A'       CLIKEY                    E10821S01194
     C***********CLIKEY    CHAINCLINT                39             E10821S01194
     C                     MOVELGBCN      CLIKEY 10                 E10821S01194
      * If this is the same customer as the last lookup then use the                          CSC042
      * data from the last lookup rather than call AOCUST again                               CSC042
     C           *LIKE     DEFN GBCN      ##LCUS                                              CSC042
     C           *LIKE     DEFN CCTZ      ##LCTZ                                              CSC042
     C           GBCN      IFEQ ##LCUS                                                        CSC042
     C                     MOVEL##LCTZ    CCTZ                                                CSC042
     C                     ELSE                                                               CSC042
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                           S01194
     C                     PARM '*KEY   ' @OPTN                           S01194
     C                     PARM           CLIKEY                          S01194
     C                     PARM '*CNUM  ' KEYSTS  7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C           @RTCD     IFNE *BLANKS                                   S01194
     C                     SETON                     U7U8LR               S01194
     C                     MOVE CLIKEY    DBKEY            ***************S01194
     C                     MOVE 'SDCUSTPD'DBFILE           * DBERROR 03  *S01194
     C                     Z-ADD3         DBASE            ***************S01194
     C                     GOTO CLEND                                     S01194
     C                     ELSE                                                               CSC042
     C                     MOVELGBCN      ##LCUS                                              CSC042
     C                     MOVELCCTZ      ##LCTZ                                              CSC042
     C                     END                                            S01194
     C                     ENDIF                                                              CSC042
     C**N10*********       SETON                     LRU7U8         E10821S01194
     C**N10*********       MOVE 'CLINT'   DBFILE                    E10821S01194
     C**N10*********       MOVE CLIKEY    DBKEY                     E10821S01194
     C**N10*********       Z-ADD3         DBASE            DBASE 3  E10821S01194
     C**N10*********       GOTO CLEND                               E10821S01194
     C                     MOVE CCTZ      GCRK                            E01821
0341 C**
0342 C*****CHAIN*TO*TABLE*FILE*FOR*REGION*CODE                            S01194
0342 C**   CALL COUNTRY ACCESS PROGRAMME FOR REGION CODE                  S01194
0343 C**
0344 C**************       SETOF                     3910                 S01194
0345 C***********CKEY      CHAINTABLE                39                   S01194
      * If this country code is the same as the last one looked up then   CSC042
      * reuse the data rather than call AOCTRY again                      CSC042
     C           *LIKE     DEFN GCRK      ##LCNT                          CSC042
     C           *LIKE     DEFN REGC      ##LREG                          CSC042
     C           GCRK      IFEQ ##LCNT                                    CSC042
     C                     MOVEL##LREG    REGC                            CSC042
     C                     ELSE                                           CSC042
     C                     CALL 'AOCTRYR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM GCRK      @KEY    2                       S01194
     C           SDCTRY    PARM SDCTRY    DSFDY                           S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     SETON                     U7U8LR               S01194
     C                     MOVEL'SDCTRYPD'DBFILE                          S01194
     C                     MOVEL@KEY      DBKEY            ***************S01194
     C                     MOVEL@OPTN     DBOPTN  7        * DBERROR 002 *S01194
     C                     MOVEL'002'     DBASE            ***************S01194
     C                     GOTO CLEND                                     S01194
     C                     ELSE                                                               CSC042
     C                     MOVELGCRK      ##LCNT                                              CSC042
     C                     MOVELREGC      ##LREG                                              CSC042
     C                     ENDIF                                                              CSC042
     C                     END                                            S01194
0346 C**N10*********       SETON                     LRU7U8               S01194
0347 C**N10*********       MOVE 'TABLE'   DBFILE                          S01194
0348 C**N10*********       MOVE CKEY      DBKEY                           S01194
0349 C**N10*********       Z-ADD2         DBASE            DBASE 2        S01194
0350 C**N10*********       GOTO CLEND                                     S01194
0323 C**                                                                  S01117
0323 C*****CHAIN*TO*TABLE FILE FOR CMPYM                                  S01117
0323 C**   CALL BRANCH ACCESS PROGRAMME FOR COMPANY CODE                  S01117
0323 C**                                                                  S01117
     C* Check whether details for Branch already in array                                     CSC042
     C                     MOVELBRCA      ##KB                                                CSC042
     C                     EXSR ##CHKB                                                        CSC042
      * If branch is in the array then use the details                                        CSC042
     C           ##FIC     IFEQ 'Y'                        *** B10                            CSC042
     C                     EXSR ##SETB                                                        CSC042
     C                     ELSE                            *** X10                            CSC042
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                       S01117
     C                     PARM '*KEY   ' @OPTN   7                       S01117
     C                     PARM BRCA      @DSNB   3                       S01117
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK                                    S01117
     C                     SETON                     U7U8LR               S01117
     C                     MOVEL'SDBRCHPD'DBFILE                          S01117
     C                     MOVEL@DSNB     DBKEY            ***************S01117
     C                     MOVEL@OPTN     DBOPTN  7        * DBERROR 004 *S01117
     C                     MOVEL'004'     DBASE            ***************S01117
     C                     ELSE                                                               CSC042
      * Details found on the DB so add them to the array                                      CSC042
      * if the array still has room                                                           CSC042
     C                     EXSR ##ADDB                                                        CSC042
     C                     END                                            S01117
     C                     ENDIF                           *** E10                            CSC042
     C   U7 U8             GOTO CLEND                                     S01117
0351 C**
0352 C**   OUTPUT TO EXTRACT FILE
0353 C**
0354 C                     SETON                     22
0355 C                     EXCPT
0356 C                     SETOF                     22
0357 C**
0358 C**   MAINTAIN HASH TOTAL OF RECORDS OUTPUT
0359 C**
0360 C           OUTREC    ADD  1         OUTREC
0361 C                     Z-ADDORECF     ZZTOTI
0362 C                     Z-ADDORECL     ZZTOTD
0363 C                     MOVE TAMT      ZZAMT
0364 C                     EXSR GLZADD
0365 C                     Z-ADDZZTOTI    ORECF
0366 C                     Z-ADDZZTOTD    ORECL
0367 C**
0368 C           CLEND     ENDSR                           ** CLEND ENDSR
0369 C*                                                                  *
0370 C********************************************************************
0371 C********************************************************************
0372 C*                                                                  *
0373 C*    FACIL SR. TO PROCESS FACILITY-BASED RECORDS                   *
0374 C*                                                                  *
0375 C           FACIL     BEGSR                           ** FACIL BEGSR
0376 C**
0377 C**   SEARCH LEREF FOR LOAN REFERENCES
0378 C**
     C                     MOVE '0'       *IN39                                               198590
     C                     MOVE 'N'       FLOAN   1                                           198590
     C***********LEKEY1    SETLLLEREF                                                  198590 CCB016
     C           LEKEY1    SETLLLEREF                39                                       CCB016
     C***********          READ LEREF                    39                            198590 CCB016
     C  N39                READ LEREF                    39                                   CCB016
     C           *IN39     DOWEQ'0'                                                           198590
     C           *IN10     IFNE '0'                                                           CCB016
     C           CNUM      IFEQ CNUMR                                                         198590
     C           FCLNF     ANDEQFCTN                                                          198590
     C                     MOVE '1'       *IN39                                               198590
     C                     MOVE 'Y'       FLOAN                                               198590
     C                     ELSE                                                               CCB016
     C           CNUM      IFLT CNUMR                                                         CCB016
     C           CNUM      OREQ CNUMR                                                         CCB016
     C           FCLNF     ANDLTFCTN                                                          CCB016
     C                     MOVE '1'       *IN39                                               CCB016
     C                     ENDIF                                                              CCB016
     C                     ENDIF                                                              198590
     C                     ENDIF                                                              CCB016
     C           *IN39     IFEQ '0'                                                           198590
     C                     READ LEREF                    39                                   198590
     C                     ENDIF                                                              198590
     C                     ENDDO                                                              198590
      *                                                                                       198590
      ** Output guaranteed undrawn facilities                                                 198590
      *                                                                                       198590
     C           FLOAN     IFEQ 'N'                                                           198590
     C                     MOVELGBCN      CLIKEY 10                                           198590
      * If this is the same customer as the last lookup then use the                          CSC042
      * data from the last lookup rather than call AOCUST again                               CSC042
     C           GBCN      IFEQ ##LCUS                                                        CSC042
     C                     MOVEL##LCTZ    CCTZ                                                CSC042
     C                     ELSE                                                               CSC042
     C                     CALL 'AOCUSTR0'                                                    198590
     C                     PARM '*MSG   ' @RTCD                                               198590
     C                     PARM '*KEY   ' @OPTN                                               198590
     C                     PARM           CLIKEY                                              198590
     C                     PARM '*CNUM  ' KEYSTS  7                                           198590
     C           SDCUST    PARM SDCUST    DSSDY                                               198590
     C           @RTCD     IFNE *BLANKS                                                       198590
     C                     SETON                     U7U8LR                                   198590
     C                     MOVE CLIKEY    DBKEY                                               198590
     C                     MOVE 'SDCUSTPD'DBFILE                                              198590
     C                     Z-ADD6         DBASE                                               198590
     C                     GOTO FCEND                                                         CSC042
     C                     ELSE                                                               CSC042
     C                     MOVELGBCN      ##LCUS                                              CSC042
     C                     MOVELCCTZ      ##LCTZ                                              CSC042
     C                     ENDIF                                                              198590
     C                     ENDIF                                                              CSC042
     C                     MOVE CCTZ      GCRK                                                198590
      * If this country code is the same as the last one looked up then                       CSC042
      * reuse the data rather than call AOCTRY again                                          CSC042
     C           GCRK      IFEQ ##LCNT                                                        CSC042
     C                     MOVEL##LREG    REGC                                                CSC042
     C                     ELSE                                                               CSC042
     C                     CALL 'AOCTRYR0'                                                    198590
     C                     PARM '*MSG   ' @RTCD   7                                           198590
     C                     PARM '*KEY   ' @OPTN   7                                           198590
     C                     PARM GCRK      @KEY    2                                           198590
     C           SDCTRY    PARM SDCTRY    DSFDY                                               198590
     C           @RTCD     IFNE *BLANK                                                        198590
     C                     SETON                     U7U8LR                                   198590
     C                     MOVEL'SDCTRYPD'DBFILE                                              198590
     C                     MOVEL@KEY      DBKEY                                               198590
     C                     MOVEL@OPTN     DBOPTN  7                                           198590
     C                     Z-ADD7         DBASE                                               198590
     C                     GOTO FCEND                                                         CSC042
     C                     ELSE                                                               CSC042
     C                     MOVELGCRK      ##LCNT                                              CSC042
     C                     MOVELREGC      ##LREG                                              CSC042
     C                     ENDIF                                                              198590
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
     C* Check whether details for Branch already in array                                     CSC042
     C                     MOVELBRCA      ##KB                                                CSC042
     C                     EXSR ##CHKB                                                        CSC042
      * If branch is in the array then use the details                                        CSC042
     C           ##FIC     IFEQ 'Y'                        *** B10                            CSC042
     C                     EXSR ##SETB                                                        CSC042
     C                     ELSE                            *** X10                            CSC042
     C**********           CALL 'AOBRCHR0'                                             198590 CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*MSG   ' @RTCD   7                                           198590
     C                     PARM '*KEY   ' @OPTN   7                                           198590
     C                     PARM BRCA      @DSNB   3                                           198590
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        198590 CGL029
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
     C           @RTCD     IFNE *BLANK                                                        198590
     C                     SETON                     U7U8LR                                   198590
     C                     MOVEL'SDBRCHPD'DBFILE                                              198590
     C                     MOVEL@DSNB     DBKEY                                               198590
     C                     MOVEL@OPTN     DBOPTN  7                                           198590
     C                     Z-ADD8         DBASE                                               198590
     C                     GOTO FCEND                                                         CSC042
     C                     ELSE                                                               CSC042
      * Details found on the DB so add them to the array                                      CSC042
      * if the array still has room                                                           CSC042
     C                     EXSR ##ADDB                                                        CSC042
     C                     ENDIF                                                              198590
     C                     ENDIF                           *** E10                            CSC042
     C                     MOVE FCNUM     CNUML                                               198590
     C**********           MOVE *ZEROS    LNNO                                         198590 CLE148
     C                     MOVE *BLANKS   LNNO                                                CLE148
     C                     MOVE CCY       CCYL                                                198590
     C                     Z-ADD0         CPAM                                                198590
     C                     MOVE *BLANKS   CLBRCA                                              198590
     C                     MOVE '1'       *IN22                                               198590
     C                     EXCPT                                                              198590
     C                     MOVE '0'       *IN22                                               198590
     C           OUTREC    ADD  1         OUTREC                                              198590
     C                     Z-ADDORECF     ZZTOTI                                              198590
     C                     Z-ADDORECL     ZZTOTD                                              198590
     C                     MOVE TAMT      ZZAMT                                               198590
     C                     EXSR GLZADD                                                        198590
     C                     Z-ADDZZTOTI    ORECF                                               198590
     C                     Z-ADDZZTOTD    ORECL                                               198590
     C                     ENDIF                                                              198590
      *                                                                                       198590
0379 C**********           MOVE '000000'  LEKEY                                               CLE148
     C                     MOVE '      '  LEKEY                                               CLE148
0380 C***********LEKEY     SETLLLEREF                                                         CCB016
0380 C           LEKEY     SETLLLEREF                39                                       CCB016
0384 C   39                GOTO FCEND                                                         CCB016
0381 C           LOOP      TAG                             ** LOOP TAG ***
0382 C                     SETOF                     103923
0383 C                     READ LEREF                    39
0384 C   39                GOTO FCEND
0385 C  N10                GOTO LOOP
0386 C           CNUM      COMP CNUMR                    23
0387 C   23      FCTN      COMP FCLNF                    23
0388 C  N23                GOTO FCEND
0389 C**
0390 C                     MOVELLNNO      CLOKEY
0391 C                     EXSR CLOCHN
0392 C  NU7                GOTO LOOP
0393 C**
0394 C           FCEND     ENDSR                           ** FCEND ENDSR
0395 C*                                                                  *
0396 C********************************************************************
     C********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##CHKB - Subroutine to check the Branch in the arrays                                 CSC042
      *                                                                                       CSC042
     C           ##CHKB    BEGSR                                                              CSC042
      *                                                                                       CSC042
     C           *LIKE     DEFN A8BRCD    ##KB                                                CSC042
      *                                                                                       CSC042
      * Set off the branch found indicator                                                    CSC042
     C                     MOVEL*BLANK    ##FIC   1                                           CSC042
      *                                                                                       CSC042
      * Save the state of indicator 30 so it can be reset at the end                          CSC042
      * of the SR as it may be used elsewhere in the code                                     CSC042
     C           *IN30     IFEQ *ON                                                           CSC042
     C                     MOVEL'Y'       #IN30   1                                           CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL'N'       #IN30                                               CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
     C                     SETOF                         30                                   CSC042
      *                                                                                       CSC042
      * Restore the saved Value of B                                                          CSC042
     C                     Z-ADD##BSV     B                                                   CSC042
      *                                                                                       CSC042
     C* Check whether details for Branch already in array                                     CSC042
      *                                                                                       CSC042
      * Is this the same as the last LOKUP, if so we can bypass                               CSC042
      * the LOKUP                                                                             CSC042
      * Defend against B being 0                                                              CSC042
     C           B         IFEQ 0                                                             CSC042
     C                     Z-ADD1         B                                                   CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * If the branch being checked is the same then use these                                CSC042
      * details rather than doing a LOKUP                                                     CSC042
     C           ##KB      IFEQ ##BR,B                                                        CSC042
      * Found so seton 30                                                                     CSC042
     C                     SETON                         30                                   CSC042
     C                     ELSE                                                               CSC042
     C                     Z-ADD1         B                                                   CSC042
     C           ##KB      LOKUP##BR,B                   30                                   CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * Save the last update to B                                                             CSC042
     C           *IN30     IFEQ *ON                                                           CSC042
     C                     Z-ADDB         ##BSV                                               CSC042
      * Set the indicator to show the data was found                                          CSC042
     C                     MOVEL'Y'       ##FIC                                               CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * Reset the state of indicator 30.                                                      CSC042
     C           #IN30     IFEQ 'Y'                                                           CSC042
     C                     MOVEL*ON       *IN30                                               CSC042
     C                     ELSE                                                               CSC042
     C                     MOVEL*OFF      *IN30                                               CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
      ********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##SETB - Sets up the SDBRCHPD fields used in the code from the                        CSC042
      * arrays                                                                                CSC042
      *                                                                                       CSC042
     C           ##SETB    BEGSR                                                              CSC042
      *                                                                                       CSC042
     C                     MOVEL##BR,B    A8BRCD                                              CSC042
     C                     MOVEL##BC,B    CMPYM                                               CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      *                                                                                       CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
      ********************************************************************                    CSC042
      *                                                                                       CSC042
      * ##ADDB - Adds the SDBRCHPD fields used in the code to the                             CSC042
      * arrays                                                                                CSC042
      *                                                                                       CSC042
     C           ##ADDB    BEGSR                                                              CSC042
      *                                                                                       CSC042
      * If there is still room in the array then add the details                              CSC042
     C           ##BNDX    IFLT 999                                                           CSC042
     C                     ADD  1         ##BNDX                                              CSC042
     C                     Z-ADD##BNDX    B                                                   CSC042
     C                     MOVELA8BRCD    ##BR,B                                              CSC042
     C                     MOVELCMPYM     ##BC,B                                              CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      * Update ##BSV  so next call to ##CHKB checks this latest adddition                     CSC042
      * to the array first                                                                    CSC042
     C                     Z-ADDB         ##BSV                                               CSC042
      *                                                                                       CSC042
     C                     ENDSR                                                              CSC042
      ********************************************************************                    CSC042
      /EJECT                                                                                  CSC042
      ********************************************************************                    CSC042
0397 C********************************************************************
0398 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
0399 C*   IND '99' IS SET BY AN OVERFLOW ERROR
0400 C*
0401 CSR         GLZADD    BEGSR                           *** GLZADD ****
0402 C*
0403 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
0404 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
0405 C*
0406 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
0407 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
0408 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
0409 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
0410 C*
0411 CSR                   EXSR GLZSUM
0412 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
0413 C*
0414 C********************************************************************
0415 C********************************************************************
0416 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
0417 C*                        GLZADD, GLZSUB, GLZCMP.
0418 C*          PARAMETERS PASSED -
0419 C*                     I/P ZZAMTI ZZAMTD
0420 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
0421 C*
0422 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
0423 C*
0424 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
0425 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
0426 CSR                   SETOF                     919293
0427 CSR                   SETOF                     949599
0428 C*
0429 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
0430 CSR         ZZAMTI    COMP 0                      9293
0431 CSR 93      ZZAMTD    COMP 0                      9293
0432 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0433 C*
0434 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
0435 CSR         ZZTOTI    COMP 0                      9193
0436 CSR 93      ZZTOTD    COMP 0                      9193
0437 C*
0438 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
0439 CSR 93                Z-ADDZZAMTI    ZZTOTI
0440 CSR 93                Z-ADDZZAMTD    ZZTOTD
0441 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0442 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
0443 CSR 91N92
0444 CORN91 92             GOTO ZZOFPS
0445 C*
0446 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
0447 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
0448 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
0449 C*
0450 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
0451 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
0452 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
0453 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
0454 C*
0455 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
0456 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
0457 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
0458 CSRN99                Z-ADDZZWK2     ZZTOTD
0459 CSRN99                Z-ADDZZWK3     ZZTOTI
0460 C*
0461 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
0462 CSR 99                Z-ADD0         ZZAMT  153
0463 CSR                   GOTO ZZSEND
0464 C*
0465 C* THE 'SIGNS' ARE DIFFERENT
0466 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
0467 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
0468 C*
0469 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
0470 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
0471 C*
0472 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
0473 C*
0474 CSR 91                Z-SUBZZTOTI    ZZTOTI
0475 CSR 91                Z-SUBZZTOTD    ZZTOTD
0476 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
0477 C*
0478 CSR         ZZTOTI    COMP ZZAMTI               93  95
0479 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
0480 C*
0481 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
0482 CSR 95                Z-ADD0         ZZTOTI
0483 CSR 95                Z-ADD0         ZZTOTD
0484 CSR 95                GOTO ZZSEND
0485 C*
0486 C* IF ZZTOT GT. ZZAMT.
0487 CSR 93      ZZAMTD    COMP ZZTOTD               94
0488 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
0489 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
0490 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
0491 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
0492 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
0493 C*
0494 C*
0495 C* IF ZZAMT GT. ZZTOT.
0496 CSRN93      ZZTOTD    COMP ZZAMTD               94
0497 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
0498 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
0499 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
0500 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
0501 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
0502 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
0503 C*
0504 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
0505 CSR                   SETOF                     94
0506 CSR 93 91
0507 CORN93 92             SETON                     94
0508 CSR 94                Z-SUBZZTOTI    ZZTOTI
0509 CSR 94                Z-SUBZZTOTD    ZZTOTD
0510 C**
0511 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
0512 CSR 92                Z-SUBZZAMTI    ZZAMTI
0513 CSR 92                Z-SUBZZAMTD    ZZAMTD
0514 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
0515 C**
0516 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
0517 CSR                   SETOF                     96
0518 CSR         ZZTOTD    COMP 0                        91
0519 CSR 91      ZZTOTI    COMP 0                      96
0520 CSR 96                MOVE '.000-'   ZZNEGD  5
0521 CSR                   ENDSR                             ** ENDSR **
0522 C********************************************************************
0523 C********************************************************************
0524 C**
0525 C**   ZSYSTM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.
0526 C**
0527 C           ZSYSTM    BEGSR                           *** ZSYSTM ***
0528 C**************                                                      S01194
0529 C*****SET*UP*KEY FOR INSTALLATION CONTROL RECORD.                    S01194
0530 C**************       MOVEL'01      'ZTABKY 12                       S01194
0531 C**************       MOVE '  10'    ZTABKY                          S01194
0532 C**************                                                      S01194
0533 C***********ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
0534 C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01194
     C**                                                                  S01194
     C**   ACCESS BANK DETAILS                                            S01194
     C**                                                                  S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     SETON                     U7U8LR               S01194
     C                     SETON                     99                   S01194
     C                     MOVEL'SDBANKPD'DBFILE                          S01194
     C                     MOVEL@OPTN     DBKEY            ***************S01194
     C                     MOVEL@OPTN     DBOPTN  7        * DBERROR 001 *S01194
     C                     Z-ADD1         DBASE            ***************S01194
     C                     ELSE                                           S01194
0535 C**
0536 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
0537 C           DATF      COMP 'M'                      98MMDDYY, 98 ON
     C                     END                                            S01194
0538 C**
0539 C                     ENDSR
0540 C**
0541 C**
0542 C********************************************************************
1100 C********************************************************************S01117
     C*                                                                   S01117
     C* *PSSR  --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
     C*                                                                   S01117
     C* CALLED FROM: AFTER ABNORNAL OPERATION OCCURS                      S01117
     C*                                                                   S01117
     C* CALLS: NOTHING                                                    S01117
     C*                                                                   S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C*                                                                   S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C********************************************************************S01117
0543 O**
0544 O**   GUARANTEES MULTI-PURPOSE EXTRACT FILE
0545 O**
0546 OGSCEXHH H        1P
0547 O                                    1 'H'
0548 OGSCEXT2 T        LR
0549 O                                    1 'T'
0550 O                         OUTREC     4P
0551 O                         ORECF     12P
0552 O                         ORECL     14P
0553 OGSCEXGG E        22
0554 O                                    1 'D'
0555 O                         REGC       3
0556 O                         GCRK       5
0557 O***********              BRCD       8                               S01117
0557 O                         BRCA       8                               S01117
0558 O                         CNUML     14
     O                       02FCNUM     14                               198910
0559 O                       01FCLN      20
0560 O                       02LNNO      20
0561 O                         GUSN      23
0562 O                         GBCN      29
0563 O                         CCY       32
0564 O                         UAMT      39P
0565 O                         NOUN      42P
0566 O                         TAMT      49P
0567 O                         NARR      84
0568 O                         GSCI      85
0569 O                         CCYL      88
0570 O                         CPAM      95P
     O***********              COLC      98                        124245 168267
     O                         CMPYM    123                               S01117
     O                       01         128 '00000'                       E86109
     O                       02FCLNF    128                               E86109
     O                         FCNUM    134                               124245
     O                         COLC     137                               168267
0571 O**
0572 O**   RUN CONTROL REPORT
0573 O**
0574 O*E0780P1T** 03   LR U7                                    S01124    S01117
0574 OLE0780AUT   03   LR U7                                              S01117
0575 O***********                        51 '*** REFERENCE LE0780'        S01117
0575 O***********                        51 '*** REFERENCE LE0780AU'      S01117
0576 O***********                        71 '- DATABASE ERROR AT'         S11117
0577 O***********              DBASE     74                               S11117
0578 O********T** 05   LR U7                                              S11117
0579 O***********                        37 'FILENAME'                    S11117
0580 O***********              DBFILE    43                               S11117
0581 O***********                        48 'KEY'                         S11117
0582 O***********              DBKEY     78                               S11117
0583 O        T 3      LR
0584 O***********                        22 'REFERENCE  LE0780'           S01117
0584 O                                   22 'REFERENCE  LE0780AU'         S01117
0585 O                         TITL      89
0586 O                                  104 'DATE'
0587 O                         RUNA     112
0588 O                                  127 'PAGE    1'
0589 O        T 2      LR
0590 O                                   68 'COLLATERAL AND LOANS EXT'
0591 O                                   88 'RACT - FILE CONTROLS'
0592 O        T 1      LR
0593 O                                   68 '------------------------'
0594 O                                   88 '--------------------'
0595 O        T 3      LR
0596 O                                   28 'S/GSCEX - RUN CONTROLS'
0597 O                                   59 'NUMBER'
0598 O                                   84 'VALUE'
0599 O        T 1      LR
0600 O                                   28 '----------------------'
0601 O                                   59 'OF RECORDS'
0602 O                                   84 'OF RECORDS'
0603 O        T 2      LR
0604 O                                   29 'TOTAL RECORDS ON FILE'
0605 O                         OUTREC3   59
0606 O                         ORECF 4   81
0607 O                         ORECL     84
0608 O        T 3      LR
0609 O                                   28 'S/GTEES - RUN CONTROLS'
0610 O        T 1      LR
0611 O                                   28 '----------------------'
0612 O        T 2      LR
0613 O                                   29 'TOTAL RECORDS ON FILE'
0614 O                         NORE  3   59
0615 O                         VLAF  4   81
0616 O                         VLAL      84
0617 O        T 2      LR
0618 O                                   29 'TOTAL RECORDS ON FILE'
0619 O                                   42 '- CALCULATED'
0620 O                         INREC 3   59
0621 O                         INRECF4   81
0622 O                         INRECL    84
0623 O                   NU7 U8         111 '***   DIFFERENCE   ***'
0578 O        T 3      LR U7                                              S11117
0575 O                                   51 '*** REFERENCE LE0780AU'      S11117
0576 O                                   71 '- DATABASE ERROR AT'         S11117
0577 O                         DBASE     74                               S11117
0578 O        T 1      LR U7                                              S11117
0579 O                                   37 'FILENAME'                    S11117
0580 O                         DBFILE    46                               S11117
0581 O                                   51 'KEY'                         S11117
0582 O                         DBKEY     81                               S11117
0624 O********T*3      LR                                                 S11117
0625 O***********                        76 '*** END OF REPORT ***'       S11117
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
