0001 H        1                                                           S01117
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Update mnth to date figures on facilities')   *
0001 H***********                                                         S01117
0002 F********************************************************************
0003 F*                                                                  *
     F*  Midas - Customer Lending Module
0005 F*                                                                  *
0006 F*     FACILITIES MONTH TO DATE FIGURES UPDATE - LE0860             *
0007 F*                                                                  *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Last Amend No. LUC109             Date 19Sep16               *
      *  Prev Amend No. MD021155           Date 19Jul13               *
      *                 AR1095473          Date 12Mar13               *
      *                 CLE075AB           Date 06Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR787620           Date 10Jun11               *
      *                 CLE064             Date 06Dec10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG23624           Date 30Mar09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 247599             Date 07May07               *
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 BUG8957            Date 10Oct05               *
      *                 CGL029             Date 01Sep03               *
      *                 CAP073             Date 08Aug02               *
      *                 208948             Date 30Aug02               *
      *                 CLE028             Date 27Jun02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 209774             Date 20Sep02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CAP068             Date 25JUN02               *
      *                 CLE023             Date 19Nov01               *
      *                 197084             Date 23Aug01               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 173117             Date 25Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      *                 167498             Date 18Jan00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 154799             Date 24Feb99               *
      *                 151295             Date 18Feb99               *
      *                 147261             Date 17Dec98               *
      *                 CLE008             Date 30Nov98               *
     F*                 127736             DATE 10DEC97               *
     F*                 CLE005             DATE 22MAY97               *
     F*                 123915             DATE 31OCT96               *
     F*                 CLE004             Date 02DEC96               *
     F*                 052151             DATE 27APR93               *
     F*                 S01392             DATE 05OCT92               *S01392
     F*                    BHF821         DATE 31MAR92                   *
     F*                    S01270         DATE 22MAR91                   *
     F*                    S01194         DATE 16JAN90                   *
     F*                    S01195              15/08/89                  *
     F*                    S01117              19/07/89                  *
     F*                                                                  *
     F********************************************************************
      *                                                               *
      *  LUC109 - HO Reporting (Upgrade to FBM 2.1)                   *
      *           Amendment of core hook LE0860C001                   *
      *           Amendment of core hook LE0860C002                   *
      *  MD021155 - COB Restructure Phase 1 remnants                  *
      *           - Additional Cache on Facility Currency             *
      *  AR1095473 - LEC06A seq 00003 encountered FOOB in Day 0 COB   *
      *              for EN                                           *
      *  CLE075AB - COB Restructure - LE Module Optimisation Phase 1  *
      *  CLE148 - Alpha Loan Reference                                *
      *  AR787620 - Hooks Incorporation                               *
      *             WNCPYSRC,LEH00365                                 *
      *             WNCPYSRC,LEH00366                                 *
      *             WNCPYSRC,LEH00360                                 *
      *             WNCPYSRC,LEH00361                                 *
      *             WNCPYSRC,LEH00362                                 *
      *             WNCPYSRC,LEH00363                                 *
      *             WNCPYSRC,LEH00364                                 *
      *  CLE064 - Enhancement of Lending Frequencies                  *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG23624 - No value being defaulted in new fields:Previous   *
      *             Exp Date and Penultimate Exp Date                 *
      *  247599 - CLE062 not complete, fields from CLE062 are reset   *
      *           to blanks.                                          *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  BUG8957- Account in facility is blanked out during COB       *
      *  CGL029 - Increase Account Code to 10 digits (Recompile)      *
      *  CAP073 - Conversion of MN inputs into modular structure to   *
      *           use as APIs. Facility input Transaction Details     *
      *  208948 - Error in Timestamp Format                           *
      *  CLE028 - Flat Rate Personal Loans (Rule of 78s)              *
      *  209774 - Need to increase the length of the FCLUPFN to match *
      *           the new fields introduced by CAP068. I had a MSGW   *
      *           in LEC10A, program LE0860, data mapping error in    *
      *           file FCLUPFN for field STMP error code 17.          *
      *  CAP068 - Recompiled for changes to FCLTYFM and FCLTYFN.      *
      *  CLE023 - Lending Facility History Improvements.              *
      *  194380 - Remove fix 167498 so that hash totals are calculated*
      *           using absolute value.                               *
      *  173117 - Increase the size of branch internal customer       *
      *           number array due to the increment of size of        *
      *           branch code array.                                  *
     F*  167498 - Due to fix 159499 in LER020, related to CLE005,     *
     F*           facility amount can now be negative; so need        *
     F*           to sum actual values, not hash totals, to ensure    *
     F*           calculated value matches totals output in LE0461.   *
      *  154799 - Recompiled due to changes in /COPY,ZACCH            *
      *  151295 - Problems authorising repayment schedules            *
      *           Recompiled due to changes in ZCHKH                  *
     F*   147261  -  Add Assignment or Participation indicator        *
     F*   CLE008  -  Loan Administration ID Amendment                 *
     F*   127736  -  FCLTY fields missing some fields after COB       *
     F*   CLE005  -  Customer Lending Enhancements - Others (T3)      *
     F*   123915  -  Add new fields to FCLUPFM                        *
     F*   CLE004  -  Customer Lending Enhancements - Syndication      *
     F*   052151  -  Layout of FCLUPFM causes problems with the          *
     F*              revolving credit indicator last change date when    *
     F*              the copy of FCLUPFM into FCLTYFM is done at EOM     *
     F*              As even the report that uses FCLUPFM LE0870         *
     F*              does not use the field CMPYM that is causing        *
     F*              the problem I am removing this field and making     *
     F*              the layout of the surrounding fields like those     *
     F*              in FCLTYFM                                          *
     F*              ALSO IN THIS PROGRAM CMPYM IS NO LONGER OUTPUT      *
     F*              TO THE FILE                                         *
     F*     S01392 - JAPANESE SUB MODULE ENHANCEMENTS                    *S01392
     F*     BHF821 - WRONG FIELD POSITION AND WRONG PROCESSING OF        *
     F*              BRANCH CODE
     F*     S01270 - CUSTOMER LENDING CHANGES                            *S01270
     F*     S01194 - STANDING DATA CHANGES                               *S01194
     F*     S01117 - MULTIBRANCHING                                      *
     F*     S01195 - HOLIDAY AMENDMENT                                   *
0009 F*                                                                  *
0012 F********************************************************************
0013 F***FCLTY   IPEAF     256 12AI     2 DISK                            123915
     F***FCLTY***IPEAF    1086 12AI     2 DISK                     123915 127736
     F****FCLTY   IPEAF    1098 12AI     2 DISK                    127736 CLE008
     F***FCLTY   IPEAF    1106 12AI     2 DISK                     CLE008 147261
     F***FCLTY** IPEAF    1107 12AI     2 DISK                                         147261 CLE028
     F***FCLTY** IPEAF    1181 12AI     2 DISK                                         CLE028 CGL029
     F***FCLTY***IPEAF    1217 12AI     2 DISK                                        CGL029 BUG8957
     F***FCLTY***IPEAF    1258 12AI     2 DISK                                       BUG8957  247599
     F***FCLTY***IPEAF    1267 12AI     2 DISK                                       247599 BUG23624
     F***FCLTY***IPEAF    1269 12AI     2 DISK                                       BUG23624 CLE064
     FFCLTY   IPEAF    1284 12AI     2 DISK                                                   CLE064
0014 FMNHSR   ISEAF      64 16AI     2 DISK
0015 F*TABLE***IF**F      96 12AI     2 DISK                              S01194
     F*ABLETR*IF* F      96 12AI     2 DISK                               S01195
     FSDBRCHL5IF  E           K        DISK                               S01195
     F*                                                                   S01117
0016 FFCLUPHH O   F     256            DISK
     F***FCLUPFM O   F     256            DISK                            123915
     F***FCLUPFM*O***F    1086            DISK                     123915 127736
     F****FCLUPFM O   F    1098            DISK                    127736 CLE008
     F***FCLUPFM O   F    1106            DISK                     CLE008 147261
     F***FCLUPFM O   F    1107            DISK                                         147261 CLE028
     F***FCLUPFM O   F    1181            DISK                                         CLE028 CGL029
     F***FCLUPFM O   F    1217            DISK                                        CGL029 BUG8957
     F***FCLUPFM O   F    1258            DISK                                        BUG8957 247599
     F***FCLUPFM*O***F    1267            DISK                                       247599 BUG23624
     F***FCLUPFM*O***F    1269            DISK                                       BUG23624 CLE064
     FFCLUPFM O   F    1284            DISK                                                   CLE064
     F***FCLUPFN*O***F     256            DISK                                                CLE023
     F***FCLUPFN*O***F     263            DISK                                          CLE023209774
     F***FCLUPFN O   F     330            DISK                                         209774 CGL029
     F/COPY WNCPYSRC,LEH00365
     FFCLUPFN O   F     348            DISK                                                   CGL029
     F/COPY WNCPYSRC,LEH00366
     FFCLUPZZ O   F     256            DISK
0017 F*E0860P1O** F     132            PRINTER                  S01124    S01117
0017 FLE0860AUO   F     132            PRINTER                            S01117
0018 F* ID F  C  H  L    FUNCTION OF INDICATORS
0019 F* 01            MNHSR HEADER
0020 F* 02            FCLTY HEADER
0021 F* 03            MNHSR DETAIL
0022 F* 04            FCLTY DETAIL A REC LIVE
0023 F* 05            FCLTY DETAIL A REC EXPIRED
0024 F* 06            FCLTY DETAIL A REC (REST EXCEPT *)
0025 F* 07            FCLTY DETAIL B RECS (NOT *)
0026 F* 08            MNHSR TRAILER
0027 F* 09            FCLTY TRAILER
0028 F* 10            FCLTY CATCHALL (* RECS)
0029 F*       20      MNHSR REC IS IN FACILITY CCY,NO CONVERSION NEEDED.
0030 F*       25      AT LEAST ONE DETAIL RECORD READ
0031 F*       30      WORK INDICATOR
0032 F*       38      MONTH IS FEBRUARY                            FIRCYL
0033 F*       39      MONTH IS FEBRUARY AND THIS IS LEAP YEAR      FIRCYL
0034 F*       40      LAST DAY IN MONTH FOR ARRAY                   ARADD
     F*               (ALSO CHECKS FOR ARRAY INDEX > NO.OF DAYS IN MONTH)
0035 F*       50      REC TO ADD TO ARRAY                           ARADD
0036 F*       51      REC TO SUB FROM ARRAY                         ARADD
0037 F*       55      ELEMENT HIGHER THAN HIGH
0038 F*       56      END OF WORKING ARRAY
0039 F*       57      ELEMENT LOWER THAN LOW
0040 F********59*     HASH FIELD IS NEGATIVE                        HASH  167498
0040 F*       59      HASH FIELD IS NEGATIVE                        HASH                      194380
0041 F*       60      MONTH IS JAN                                 FIRCYL
0042 F*       61      MONTH IS FIRST MONTH OF QUARTER              FIRCYL
0043 F*       62      WORK INDIC                                   FIRCYL
0044 F*       66      PROCESSING TYPE 66 OR 67                     ARADD
     F*               includes new types 69 and 72                        CLE005
     F*       70      EOF indicator                                       S01117
     F*       75      Customer is internal                                S01117
0045 F*       80      SPOT INDIC = DIVIDE                         BASCCY
0046 F*       86      FACILITY FILE TOTALS DIFFER                 HSHCOM
0047 F*       87      MNHSR FILE TOTALS DIFFER                    HSHCOM
0048 F*       U7 U8 99DATABASE ERROR
0049 F*       L1      CONTROL BREAK ON MNHSR FACILITY REF.
     E/COPY ZSRSRC,ZFREQBZ1                                               S01392
     E/COPY ZSRSRC,ZDATE2Z1                                               S01392
0056 E                    POW     7   7  7 3             BASE CCY CONV ARR
0057 E                    ARM        31 13 0             MONTH TOTAL ARRAY
     E*                                                                   S01117
     E** Branch Internal Customer Number array for use                    S01117
     E** when checking if inter-branch participation                      S01117
     E*                                                                   S01117
     E***********         @BCA      150  6                         S01117 173117
     E***********         @BCA      900  6                                           173117 CLE075AB
     E**********          @BCA     2000  6 0                                      CLE075AB AR1095473
     E                    @BCA     2000  6                                                 AR1095473
     E                    @CCY      250  3                                                  CLE075AB
     E                    #LRU      200 13 0                                                CLE075AB
     E                    #LRUC     200 13 0                                                CLE075AB
     E*                                                                   S01117
     E/COPY ZSRSRC,ZHOLE                                                  S01195
     E                    CPY@    1   1 80
     E*                                                                   S01195
0058 I**  FACILITIES FILE
0059 I*       HEADER
0060 I*
0061 IFCLTY   NS  02   1 CH
0062 I                                        1   1 RECI
0063 I*
0064 I*       DETAIL 'A'
0065 I*
0066 I        NS  04   1 CD  13 CA
0067 I       OR   05   1 CE  13 CA
0068 I       OR   06   1 CR  13 CA
0069 I       OR   06   1 CC  13 CA
0070 I                                        1   1 RECI
0071 I**********                              2   70CNUM                                      CSD027
0071 I                                        2   7 CNUM                                      CSD027
0072 I                                        8  100FACT
0073 I                                       11  120FCNO
0074 I*MULTI FIELD FOR MATCH
0075 I**********                              2  120FACRF L1M1                                CSD027
0075 I                                        2  12 FACRF L1M1                                CSD027
0076 I                                       13  13 RCTP
0077 I***********                            14  160BRCD                  S01117
0077 I                                       14  16 BRCA                  S01117
0078 I                                       17  17 FCTI
0079 I                                       18  20 FCCY
0080 I                                    P  21  270FAMT
0081 I                                    P  28  303OVPC
0082 I                                    P  31  330DTAP
0083 I                                    P  34  360DTEX
0084 I                                       37  37 RVCR
0085 I                                       38  38 SECI
0086 I                                       39  39 MCCY
0087 I                                       40  40 MCSI
0088 I                                       41  41 NACD
0089 I                                       42  43 CRSK
0090 I                                    P  44  460DLFS
0091 I                                    P  47  527NOMR
0092 I                                    P  53  550RVDT
0093 I                                       56  56 RVFR
0094 I                                       57  580RVDY
0095 I                                       59  93 NAR1
0096 I                                       94 128 NAR2
0097 I                                      129 163 NAR3
0098 I                                      164 198 NAR4
0099 I                                    P 199 2050MTDH
0100 I                                    P 206 2120MTDL
0101 I                                    P 213 2190MTDA
0102 I                                    P 220 2270QTDA
0103 I                                    P 228 2350YTDA
0104 I                                      236 237 ACOF
     I                                    P 242 2440RVCD                  S01270
0105 I                                    P 247 2490ORED
0106 I                                    P 250 2520LCD
0107 I                                      253 253 CHTP
0108 I                                    P 254 2560TNLU
0133 I                                     11051106 LAID                  CLE008
0133 I                                     11071107 PASI                  147261
     I                                     11761181 DTPX                                      CLE028
0109 I*REC REDEFINED
0110 I                                        1 200 LOTAA
0111 I                                      201 256 LOTAB
     I***********                           2571086 LOTAC          123915 127736
     I****************                      2571098 LOTAC          127736 CLE008
     I***********                           2571106 LOTAC          CLE008 147261
     I**********                            2571107 LOTAC                              147261 CLE028
     I**********                            2571181 LOTAC                              CLE028 CGL029
     I************                          2571217 LOTAC                             CGL029 BUG8957
     I**********                            2571258 LOTAC                             BUG8957 247599
     I**********                            2571267 LOTAC                            247599 BUG23624
     I**********                            2571269 LOTAC                            BUG23624 CLE064
     I                                      2571284 LOTAC                                     CLE064
0112 I        NS  07   1NC*  13 CB
0113 I                                        1   1 RECI
0114 I**********                              2   70CNUM                                      CSD027
0114 I                                        2   7 CNUM                                      CSD027
0115 I                                        8  100FACT
0116 I                                       11  120FCNO
0117 I*MULTI FILE FOR MATCH
0118 I**********                              2  120FACRF   M1                                CSD027
0118 I                                        2  12 FACRF   M1                                CSD027
0119 I                                       13  13 RCTP
0120 I                                       14  14 CMFT
0121 I                                       15  150CALC
0122 I                                    P  16  217SPRD
0123 I                                       22  230BCOD
0124 I                                    P  24  297BRAT
0125 I                                    P  30  320STDT
0126 I                                    P  33  350EDDT
0127 I                                    P  36  380DUDT
0128 I                                       39  39 BLFR
0129 I                                       40  410BLDN
0130 I                                       42  42 BTIN
0131 I                                       43  440BLDY
0132 I                                       45  460SETT
0133 I**********                             47  58 OBAC                                      CGL029
     I                                       47  58 QQOBAC                                    CGL029
0134 I                                       59  68 TNAC
0135 I                                    P  69  710SLCD
0136 I                                    P  72  740ACCD
0137 I                                    P  75  810ADNP
0138 I                                    P  82  880PDTD
0139 I                                    P  89  950AFPD
0140 I                                    P  96 1020ADJP
0141 I                                    P 103 1090ADJN
0142 I                                    P 110 1160TOTD
0143 I                                    P 117 1230CAMD
     I                                      130 130 MBFC                  S01117
0144 I                                      131 131 BITS
0145 I                                    P 147 1490RUN0
0146 I                                    P 150 1520RUN1
0147 I                                    P 153 1550RUN2
0148 I                                    P 156 1580RUN3
0149 I                                    P 159 1610RUN4
0150 I                                    P 162 1640RUN5
0151 I                                    P 165 1670RUN6
0152 I                                    P 168 1700RUN7
0153 I                                    P 171 1730RUN8
0154 I                                    P 174 1760RUN9
0155 I                                    P 177 1830OAM1
0156 I                                    P 184 1900OAM2
0157 I                                    P 191 1970OAM3
0158 I                                    P 198 2040OAM4
0159 I                                    P 205 2110OAM5
0160 I                                    P 212 2180OAM6
0161 I                                    P 219 2250OAM7
0162 I                                    P 226 2320OAM8
0163 I                                    P 233 2390OAM9
0164 I                                    P 240 2460OA10
0165 I                                    P 247 2490ORED
0166 I                                    P 250 2520LCD
0167 I                                      253 253 CHTP
0168 I                                    P 254 2560TNLU
     I                                      305 330 STMP                                      208948
     I                                      331 348 OBAC                                      CGL029
     I/COPY WNCPYSRC,LEH00360
0169 I* RECORD REDEFINED
0170 I                                        1 200 LOTBA
0171 I**********                            201 256 LOTBB                                     CLE023
     I**********                            201 263 LOTBB                               CLE023209774
     I**********                            201 330 LOTBB                              209774 CGL029
     I/COPY WNCPYSRC,LEH00361
     I                                      201 348 LOTBB                                     CGL029
     I/COPY WNCPYSRC,LEH00362
0172 I*
0173 I*       TRAILER
0174 I*
0175 I        NS  09   1 CT
0176 I                                        1   1 RECI
0177 I**********                              2   70CNUM                                      CSD027
0177 I                                        2   7 CNUM                                      CSD027
0178 I                                        8  100FACT
0179 I                                       11  120FCNO
0180 I                                       13  13 RCTP
0181 I                                    P  17  190NORE
0182 I                                    P  23  250NLRB
0183 I                                    P  26  280NINS
0184 I                                    P  29  310NDEL
0185 I                                    P  32  340NLRA
0186 I                                    P  35  420VLBF
0187 I                                    P  43  440VLBL
0188 I                                    P  45  520VRIF
0189 I                                    P  53  540VRIL
0190 I                                    P  55  620VRDF
0191 I                                    P  63  640VRDL
0192 I                                    P  65  720VRAF
0193 I                                    P  73  740VRAL
0194 I                                    P  75  820VLAF
0195 I                                    P  83  840VLAL
0196 I                                    P 250 2520LCD
0197 I                                      253 253 CHTP
0198 I                                    P 254 2560TNLU
0199 I** TRAILER REC REDEFINED
0200 I                                        1 200 LOTTA
0201 I                                      201 256 LOTTB
0202 I*CATCHALL
0203 I*
0204 I        NS  10
0205 I**  MNHSR FILE
0206 I*       HEADER
0207 I*
0208 IMNHSR   NS  01   1 CH
0209 I                                        1   1 RECI
0210 I*
0211 I*       DETAIL
0212 I*
0213 I*FIELD NAMES REDEFINED
0214 I        NS  03   1 CD
0215 I                                        1   1 RECI
0216 I**********                              2   70CNUMM                                     CSD027
0216 I                                        2   7 CNUMM                                     CSD027
0217 I                                        8  100FACTM
0218 I                                       11  120FCNOM
0219 I*MULTI FIELD FOR MATCH
0220 I**********                              2  120FACRFM  M1                                CSD027
0220 I                                        2  12 FACRFM  M1                                CSD027
0221 I***********                            13  150BRCDM                 S01117
0221 I                                       13  15 BRCAM                 S01117
0222 I                                       16  17 AMTPM
0223 I                                    P  18  240AMNTM
0224 I                                    P  25  270VDATM
0225 I**********                             28  330LNRFM                                     CLE148
     I                                       28  33 LNRFM                                     CLE148
0226 I                                       34  36 CCYM
0227 I                                       37  380PTYPM
     I***********                            39  440CNML                  S01195
     I***********                            39  44 CNML            S01195BHF821
     I                                       59  64 CNML                  BHF821
0228 I*
0229 I*       TRAILER
0230 I*
0231 I        NS  08   1 CT
0232 I                                        1   1 RECI
0233 I                                    P   2   40NOREM
0234 I                                    P   5  120VLORF
0235 I                                    P  13  140VLORL
0236 I* CATCHALL
0237 I        NS
0238 I*****TABLE*FILE - INSTALLATION CONTROL DATA RECORD 1.               S01194
0239 I**************                                                      S01194
0240 I*TABLE***NS***    2 C0   3 C1  12 C1                                S01194
0241 I*******AND****  13 C0                                               S01194
0242 I**************                          1   1 RECI                  S01194
0243 I**************                          2   30RECT                  S01194
0244 I**************                         12  130RCDE                  S01194
0245 I**************                         14  66 TITL                  S01194
0246 I**************                         67  67 DATF                  S01194
0247 I***********                            68  700DFBR                  S01194
0248 I**************                         74  74 MODI1                 S01194
0249 I**************                         75  75 MODI2                 S01194
0250 I**************                         76  76 MODI3                 S01194
0251 I**************                      P  77  790RUND                  S01194
0252 I**************                         80  86 RUNA                  S01194
0253 I**************                         87  870SFLG                  S01194
0254 I**************                      P  90  920LCD                   S01194
0255 I**************                         93  93 CHTP                  S01194
0256 I**************                      P  94  960TNLU                  S01194
0257 I**************                                                      S01194
0258 I*****TABLE*FILE - INSTALLATION CONTROL DATA RECORD 2.               S01194
0259 I**************                                                      S01194
0260 I*TABLE***NS***    1 CD   2 C0   3 C1                                S01194
0261 I*******AND****  12 C1  13 C1                                        S01194
0262 I**************                          1   1 RECI                  S01194
0263 I**************                          2   30RECT                  S01194
0264 I**************                         12  130RCDE                  S01194
0265 I**************                         14  16 BCCY                  S01194
0266 I**************                         17  19 BCYL                  S01194
0267 I**************                         20  22 HOCY                  S01194
0268 I**************                         23  280HEAD                  S01194
0269 I**************                      P  29  310APDA                  S01194
0270 I**************                         35  35 APFQ                  S01194
0271 I**************                      P  36  380LOGS                  S01194
0272 I**************                         39  40 CUZR                  S01194
0273 I**************                      P  41  430DNWD                  S01194
0274 I**************                         44  460BVLP                  S01194
0275 I***********                            47  49 LOCY                  S01195
0276 I**************                         50  510FDAY                  S01194
0277 I**************                         52  52 ACLD                  S01194
0278 I**************                         53  53 MBIN                  S01194
0279 I**************                         86  86 ISAV                  S01194
0280 I**************                      P  87  890LLOG                  S01194
0281 I**************                      P  90  920LCD                   S01194
0282 I**************                         93  93 CHTP                  S01194
0283 I**************                      P  94  960TNLU                  S01194
0284 I**************                                                      S01194
0285 I*****TABLE*FILE - CURRENCIES RECORD 1.                              S01194
0286 I**************                                                      S01194
0287 I********NS****   1 CD   2 C2   3 C0                                 S01194
0288 I*******AND****  13 C1                                               S01194
0289 I**************                          1   1 RECI                  S01194
0290 I**************                          2   30RECT                  S01194
0291 I**************                         10  12 CCY                   S01194
0292 I**************                         13  130SREC                  S01194
0293 I**************                         14  27 CCNM                  S01194
0294 I**************                      P  28  348SPOT                  S01194
0295 I**************                         35  37 CCYS                  S01194
0296 I**************                         38  380CDP                   S01194
0297 I**************                         39  390TNOT                  S01194
0298 I**************                         40  40 DCCY                  S01194
0299 I**************                         41  44 SRC1                  S01194
0300 I**************                         45  48 SRC2                  S01194
0301 I**************                         49  520TACC                  S01194
0302 I**************                         53  560TEQV                  S01194
0303 I**************                         57  600SWQV                  S01194
0304 I**************                         61  640TAC4                  S01194
0305 I**************                         65  680TAC5                  S01194
0306 I**************                         69  69 HIND                  S01194
0307 I**************                      P  70  768PART                  S01194
0308 I**************                         77  780SSNO                  S01194
0309 I**************                      P  79  858ERLC                  S01194
0310 I**************                         86  860MDIN                  S01194
0311 I**************                         87  870MDIA                  S01194
0312 I**************                         88  880MDIB                  S01194
0313 I**************                      P  90  920LCD                   S01194
0314 I**************                         93  93 CHTP                  S01194
0315 I**************                      P  94  960TNLU                  S01194
0316 I*****TABLE*FILE - HOLIDAY RECORD.                                   S01195
0317 I********E-EXCLUDE, I-INCLUDE.                                       S01195
0318 I***********                                                         S01195
0319 I*ABLE***NS*      1 CD   2 C2   3 C2                                 S01195
0320 I*******AND*     14 CE                                               S01195
0321 I*******OR**      1 CD   2 C2   3 C2                                 S01195
0322 I*******AND*     14 CI                                               S01195
0323 I***********                             1   1 RECI                  S01195
0324 I***********                             2   30RECT                  S01195
0325 I***********                             8  120HOL                   S01195
0326 I***********                            13  130SREC                  S01195
0327 I***********                            14  14 INEX                  S01195
0328 I***********                            15  89 HCCY                  S01195
0329 I***********                         P  90  920LCD                   S01195
0330 I***********                            93  93 CHTP                  S01195
0331 I***********                         P  94  960TNLU                  S01195
0332 I***CATCHALL                                                         S01194
0333 I********NS*                                                         S01194
0334 I**************                          1   1 RECI                  S01194
0335 I***DATA*STRUCTURE FOR                                               S01194
0336 I**************       CURRENCY KEY                                   S01194
0337 I************DS                                                      S01194
0338 I**************                          1   8 XTAB                  S01194
0339 I**************                          9  11 WCCY                  S01194
0340 I**************                         12  12 XTAB2                 S01194
0341 I**************                          1  12 TBLKY2                S01194
0342 I* LOCAL DATA AREA FOR DATABASE ERROR
0343 ILDA        UDS                            256
0344 I***********                           134 138 DBFILE                S01117
0345 I***********                           139 167 DBKEY                 S01117
0346 I***********                           168 175 DBPGM                 S01117
0347 I***********                           176 1770DBASE                 S01117
0344 I                                      134 141 DBFILE                S01117
0345 I                                      142 170 DBKEY                 S01117
0346 I                                      171 180 DBPGM                 S01117
0347 I                                      181 1830DBASE                 S01117
     I***SDBRCH    E DSSDBRCHPD                                                      S01117 CLE075AB
     ISDBRCH    E DSSDBRCHPD               2000                                             CLE075AB
      **  EXTERNAL DS FOR BRANCH CODE DETAILS                             S01117
     I**********    A8BICN                          BICN            S01117BHF821
     I              A8CMCD                          CMPYM                 S01117
     ISDBANK    E DSSDBANKPD                                              S01195
      **  EXTERNAL DS FOR BANK DETAILS                                    S01195
     I              BJLCCY                          LOCY                  S01195
     I              BJSLCD                          SYSL                  S01194
     I              BJURPT                          TITL                  S01194
     I              BJMRDT                          RUNA                  S01194
     I              BJRDNB                          RUND                  S01194
     I**                                                                  S01194
     I***SDCURR    E DSSDCURRPD                                                      S01194 CLE075AB
     ISDCURR    E DSSDCURRPD                250                                             CLE075AB
      **  EXTERNAL DS FOR CURRENCY DETAILS                                S01194
     I              A6NBDP                          CDP                   S01194
     I              A6SPRT                          SPOT                  S01194
     I**                                                                  S01194
     ISDGELR    E DSSDGELRPD                                              S01194
      **  EXTERNAL DS FOR GENERAL LEDGER DETAILS                          S01194
     I*****         BKAPDT                          APDA           S01194 S01392
     I**                                                                  CLE004
     ISCSARD    E DSSCSARDPD                                              CLE004
      **  External DS for SAR Details                                     CLE004
     I**                                                                  S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE                S01194
     I*                                                                   S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I* SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE                S01194
     I*                                                                   S01194
     I*                                                                   S01195
     I/COPY ZSRSRC,ZHOLI                                                  S01195
     I*                                                                   S01195
     C                     MOVEACPY@      BIS@   80
0348 C   01                EXSR FIRCYL
0349 C*
0350 C                     SETOF                     20
0351 C*
0352 C** AT LEAST ONE DETAIL RECORD READ - SET INDICATOR
0354 C   04
0355 COR 05
0356 COR 06                SETON                     25
     C** GET 'CMPYM'                                                      S01117
     C**                                                                  S01117
     C           *IN25     IFEQ '1'                                       S01117
     C**********           CALL 'AOBRCHR0'                                S01117              CGL029
     C**********           CALL 'AOBRCHR1'                                           CGL029 CLE075AB
     C**********           PARM '*MSG   ' @RTCD   7                                  S01117 CLE075AB
     C**********           PARM '*KEY   ' @OPTN   7                                  S01117 CLE075AB
     C**********           PARM BRCA      @DSNB   3                                  S01117 CLE075AB
     C********** SDBRCH    PARM SDBRCH    DSFDY                           S01117              CGL029
     C********** SDBRCH    PARM SDBRCH    DSSDY                                      CGL029 CLE075AB
     C********** @RTCD     IFNE *BLANKS                                              S01117 CLE075AB
     C                     MOVE BRCA      @DSNB   3                                         CLE075AB
     C**********           MOVE BRCA      WBRCA   60                              CLE075AB AR1095473
     C                     MOVE A8BICN    WBICN   6                                        AR1095473
      *                                                                                     CLE075AB
      ** Get the company name on the cached array                                           CLE075AB
      *                                                                                     CLE075AB
     C                     SETOF                         26                                 CLE075AB
     C                     Z-ADD1         Y       40                                        CLE075AB
     C********** WBRCA     LOKUP@BCA,Y                   26                       CLE075AB AR1095473
     C           WBICN     LOKUP@BCA,Y                   26                                AR1095473
      *                                                                                     CLE075AB
     C           *IN26     IFEQ *ON                                                         CLE075AB
      *                                                                                     CLE075AB
     C           Y         OCUR SDBRCH                                                      CLE075AB
     C**********           MOVE A8BRNM    CMPYM                                   CLE075AB AR1095473
      *                                                                                     CLE075AB
     C                     ELSE                                                             CLE075AB
      *                                                                                     CLE075AB
     C                     MOVEL@DSNB     DBKEY            ***********    S01117
     C                     MOVEL'SDBRCHPD'DBFILE           * DBERR 6 *    S01117
     C                     Z-ADD06        DBASE            ***********    S01117
     C                     EXSR *PSSR                                     S01117
     C                     SETON                     U7U8LR               S01117
     C                     END                                            S01117
     C                     END                                            S01117
     C   U8 25             GOTO MPEND                                     S01117
0357 C   03
1530 COR 04
0359 COR 05                GOTO MP1
0360 C*
0361 C                     GOTO MPEND
0362 C           MP1       TAG                             *** MP1 TAG ***
     C**
     C**  IF RECORD READ FROM S/MNHST WITHOUT MATCHING 'LIVE' OR
     C**  'EXPIRED' RECORD ON S/FCLTY, SKIP PROCESSING
     C   03N45             GOTO HASHT
0363 C   03                EXSR FACCCY
0364 C   U7 U8 LR          GOTO MPEND
0365 C*
0366 C* USE ZDATE2 TO GET DAYS FROM VALUE DATE
0367 C*
0368 C   03                MOVE VDATM     ZDAYNO
0369 C   03                EXSR ZDATE2
0370 C   03 99             MOVELVDATM     DBKEY            ---------------
0371 C   03 99             MOVE 'MNHSR'   DBFILE           --DATABASE 5 --
0372 C   03 99             Z-ADD5         DBASE            ---------------
0373 C   03 99             SETON                     U7U8LR
0374 C   03 99             GOTO MPEND
0375 C   03                MOVE ZDAY      A       20
0376 C   03                EXSR ARADD
0377 C*            HASH TOTAL
0378 C           HASHT     TAG                             *** HASHT ***
0378 C                     EXSR HASH
0379 C*
0380 C* COUNT RECORDS NOT COUNTED IN HASH
0381 C           MPEND     TAG                             ** MPEND TAG **
0382 C   06
0383 COR 07      RECF      ADD  1         RECF
0384 C   04
0385 COR 05                SETON                     45
0386 C*
0387 C   LR U7 U8          MOVE 'LE0860'  DBPGM
0388 CL1 45                EXSR FACTOT
0389 CL1                   SETOF                     45
0390 CLRNU7                EXSR HSHCOM
0391 C********************************************************************
0392 C** CONVERTS AMOUNT TO FACILITY CURRENCY
0393 C*
0394 C* CALLED BY: MP
0395 C*
0396 C           FACCCY    BEGSR                           ** FACCCY **
0397 C*
0398 C* COMPARE LOAN & FAC CCY. IF SAME NO CALCS
0399 C           FCCY      COMP CCYM                     20
0400 C   20                Z-ADDAMNTM     WBAS
0401 C   20                GOTO FACEND
0402 C*
0403 C* CHAIN IN MNHSR CCY REC FOR DEC PLACES.
0404 C**************       MOVE CCYM      WCCY                            S01194
0404 C                     MOVE CCYM      WCCY    3                       S01194
      *                                                                                     CLE075AB
      ** Check if the Currency details are existing in the cache                            CLE075AB
      *                                                                                     CLE075AB
     C                     EXSR SRCHKP                                                      CLE075AB
     C           ##PFIC    IFEQ 'Y'                                                         CLE075AB
     C           C         OCUR SDCURR                                                      CLE075AB
     C                     ELSE                                                             CLE075AB
      *                                                                                     CLE075AB
     C                     EXSR SRADDP                                                      CLE075AB
     C           C         OCUR SDCURR                                                      CLE075AB
      *                                                                                     CLE075AB
0405 C***********TBLKY2    CHAINTABLE                99                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           WCCY                         A  S01194
     C           SDCURR    PARM SDCURR    DSSDY                        B  S01194
0406 C**N99******RECI      COMP 'D'                  9999                 S01194
      *                                                                                     CLE075AB
     C                     MOVE WCCY      @CCY,C                                            CLE075AB
     C                     ENDIF                                                            CLE075AB
      *                                                                                     CLE075AB
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     SETON                     99                   S01194
     C                     SETON                     LRU7U8               S01194
     C                     MOVE 'SDCURRPD'DBFILE           ***************S01194
     C                     Z-ADD3         DBASE            * DBERROR 03  *S01194
     C                     MOVE WCCY      DBKEY            ***************S01194
     C                     END                                            S01194
0407 C***99*********       SETON                     U7U8LR               S01194
0408 C***99*********       Z-ADD3         DBASE            ---------------S01194
0409 C***99*********       MOVE 'TABLE'   DBFILE           -- DATABASE 3- S01194
0410 C***99*********       MOVELTBLKY2    DBKEY            ---------------S01194
0411 C   99                GOTO FACEND
0412 C***********MDIN      COMP 0                        86               S01194
0412 C           A6MDIN    COMP 'D'                      86               S01194
0413 C   86                MOVE 'D'       MDINC   1
0414 C  N86                MOVE 'M'       MDINC
0415 C                     MOVE SPOT      SPOTC  138
0416 C                     MOVE CDP       LOCDP   10
0417 C* NL1                GOTO FACPAS
0418 C* IF FACILITY CANGES GET NEW FCCY DEC PLCS
0419 C*
0420 C                     MOVE FCCY      WCCY
0421 C***********TBLKY2    CHAINTABLE                99                   S01194
      *                                                                                     MD021155
      ** Check if the Currency details are existing in the cache                            MD021155
      *                                                                                     MD021155
     C                     EXSR SRCHKP                                                      MD021155
     C           ##PFIC    IFEQ 'Y'                                                         MD021155
     C           C         OCUR SDCURR                                                      MD021155
     C                     ELSE                                                             MD021155
      *                                                                                     MD021155
     C                     EXSR SRADDP                                                      MD021155
     C           C         OCUR SDCURR                                                      MD021155
      *                                                                                     MD021155
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*MSG   ' @RTCD                            S0119
     C                     PARM '*KEY   ' @OPTN                            S0119
     C                     PARM           WCCY                            S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
0422 C**N99******RECI      COMP 'D'                  9999                 S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     SETON                     99                   S01194
     C                     SETON                     LRU7U8               S01194
     C                     MOVE 'SDCURRPD'DBFILE           ***************S01194
     C                     Z-ADD4         DBASE            * DBERROR  04 *S01194
     C                     MOVE WCCY      DBKEY            ***************S01194
     C                     END                                            S01194
      *                                                                                     MD021155
     C                     MOVE WCCY      @CCY,C                                            MD021155
     C                     ENDIF                                                            MD021155
      *                                                                                     MD021155
0423 C***99*********       SETON                     U7U8LR               S01194
0424 C***99*********       Z-ADD4         DBASE            ---------------S01194
0425 C***99*********       MOVE 'TABLE'   DBFILE           -- DATABASE 4--S01194
0426 C***99*********       MOVELTBLKY2    DBKEY            ---------------S01194
0427 C   99                GOTO FACEND
0428 C                     MOVE CDP       FACDP   10
0429 C*
0430 C***********MDIN      COMP 0                    85                   S01194
     C           A6MDIN    COMP 'D'                  85                   S01194
0431 C           MDINC     COMP 'M'                      86
0432 C   85                MOVE 'D'       MDINX   1
0433 C  N85                MOVE 'M'       MDINX
0434 C**
0435 C   86N85
0436 CORN86 85   SPOT      MULT SPOTC     SPOTB  138H
0437 C  N86N85
0438 COR 86 85   SPOT      DIV  SPOTC     SPOTB     H
0439 C                     Z-ADDSPOTB     FCXR   138
0440 C                     MOVE MDINX     FMDI    1
0441 C           FACPAS    TAG                             ** FACPAS TAG**
0442 C* CONVERT AMOUNT TO FACILITY CCY
0443 C*
0444 C           FACDP     SUB  LOCDP     X       10
0445 C           X         ADD  4         X
0446 C*
0447 C           FMDI      COMP 'D'                      80ON = DIVIDE
0448 C*
0449 C   80      FCXR      DIV  POW,X     EFF    117
0450 C   80      1         DIV  EFF       EFF
0451 C*
0452 C  N80      FCXR      MULT POW,X     EFF
0453 C           AMNTM     MULT EFF       WBAS   130H
0454 C*
0455 C           FACEND    ENDSR                           **FACEND TAG**
0456 C********************************************************************
0457 C* SR TO ADD OR SUBTRACT RECS TO ARRAY.
0458 C*
0459 C* CALLED BY :MP
0460 C           ARADD     BEGSR                           ***  ARADD  ***
0461 C*
0462 C* PI,BA,ST,IN RECS ADD INTO ARRAY; RE,MR,MA SUBTRACT-
0463 C* FROM IT. IF PROC TYPE 66 OR 67 THIS IS REVERSED
0464 C                     SETOF                     665051
0465 C                     SETOF                     40
0466 C           PTYPM     COMP 66                       66
0467 C  N66      PTYPM     COMP 67                       66
      *                                                                   CLE005
      ** If SAR CLE005 is *ON and PTYPM is 69 or 72                       CLE005
      *                                                                   CLE005
     C           CLE005    IFEQ *ON                                       CLE005
      *                                                                   CLE005
     C           PTYPM     IFEQ 69                                        CLE005
     C           PTYPM     OREQ 72                                        CLE005
     C                     MOVE *ON       *IN66                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
0468 C*
0469 C           AMTPM     COMP 'BA'                     50
0470 C  N50      AMTPM     COMP 'PI'                     50
0471 C  N50      AMTPM     COMP 'ST'                     50
0472 C  N50      AMTPM     COMP 'IN'                     50
      *                                                                   CLE004
      ** If SAR CLE004 is Present                                         CLE004
      *                                                                   CLE004
     C           CLE004    IFEQ *ON                                       CLE004
      *                                                                   CLE004
      ** Include Amend Type 'PT'                                          CLE004
      *                                                                   CLE004
     C           AMTPM     IFEQ 'PT'                                      CLE004
     C                     MOVE *ON       *IN50                           CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
     C                     ENDIF                                          CLE004
0473 C*
0474 C   50                GOTO AR1
0475 C*
0476 C           AMTPM     COMP 'RE'                     51
0477 C  N51      AMTPM     COMP 'MR'                     51
0478 C  N51      AMTPM     COMP 'MA'                     51
      *                                                                   CLE004
      ** If SAR CLE004 is Present                                         CLE004
      *                                                                   CLE004
     C           CLE004    IFEQ *ON                                       CLE004
      *                                                                   CLE004
      ** Include Amend Type 'PF'                                          CLE004
      *                                                                   CLE004
     C           AMTPM     IFEQ 'PF'                                      CLE004
     C                     MOVE *ON       *IN51                           CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
     C                     ENDIF                                          CLE004
0479 C*
0480 C* INVALID RECORD SEN TO END.
0481 C  N51                GOTO AR4
0482 C*
0483 C*REVERSE INDIC FOR PROC 66 & 67
0484 C   66 51             SETON                     50
0485 C   66 51             SETOF                     51
0486 C                     GOTO AR2
0487 C*
0488 C           AR1       TAG                             *** AR1 TAG ***
0489 C   66 50             SETON                     51
0490 C   66 50             SETOF                     50
0491 C*
0492 C           AR2       TAG                             *** AR2 TAG ***
     C*                                                                   S01117
     C           PTYPM     IFEQ 64                                        S01117
     C           PTYPM     OREQ 65                                        S01117
     C           PTYPM     OREQ 66                                        S01117
     C           PTYPM     OREQ 67                                        S01117
      *                                                                   CLE005
      ** If SAR CLE005 is Present and PTYPM is 68, 69, 71 or 72           CLE005
      *                                                                   CLE005
     C           CLE005    OREQ *ON                                       CLE005
     C           PTYPM     ANDEQ68                                        CLE005
     C           CLE005    OREQ *ON                                       CLE005
     C           PTYPM     ANDEQ69                                        CLE005
     C           CLE005    OREQ *ON                                       CLE005
     C           PTYPM     ANDEQ71                                        CLE005
     C           CLE005    OREQ *ON                                       CLE005
     C           PTYPM     ANDEQ72                                        CLE005
     C*                                                                   S01117
     C**********           MOVE CNML      WCNML   60                              CLE075AB AR1095473
     C                     MOVE CNML      WCNML   6                                        AR1095473
     C********** CNML      LOKUP@BCA                     75                          S01117 CLE075AB
     C           WCNML     LOKUP@BCA                     75                                 CLE075AB
     C*                                                                   S01117
     C                     END
     C*                                                                   S01117
     C** If not inter-branch participation, then update array as before   S01117
     C*                                                                   S01117
     C           *IN75     IFEQ '0'                                       S01117
0493 C*
0494 C* 50 WILL ADD, 51 WILL SUB FROM ARRAY
0495 C   51                GOTO AR3
0496 C*
0497 C* ADD INTO ARRAY FROM  VAL DATE TO END OF MONTH
0498 C           ARBAC     TAG                             ** ARBAC TAG **
0499 C*
0500 C           ARM,A     ADD  WBAS      ARM,A
0501 C*
0502 C           A         COMP WDAYS                40  40
0503 C   40                GOTO AR4
0504 C*
0505 C           A         ADD  1         A
0506 C                     GOTO ARBAC
0507 C*
0508 C           AR3       TAG                             *** AR3 TAG ***
0509 C*
0510 C* SUBTRACT FROM ARRAY FROM VAL DATE TIL END OF MONTH
0511 C*
0512 C           ARM,A     SUB  WBAS      ARM,A
0513 C*
0514 C           A         COMP WDAYS                40  40
0515 C   40                GOTO AR4
0516 C*
0517 C           A         ADD  1         A
0518 C                     GOTO AR3
0519 C*
     C                     ELSE                                           S01117
     C                     SETOF                     75                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
0520 C           AR4       ENDSR                           *** AR4 TAG ***
0521 C********************************************************************
0522 C* SR TO HASH BOTH FILES
0523 C*
0524 C* CALLED BY : MP
0525 C* CALLS : GLZADD
0526 C           HASH      BEGSR                            HASH BEGSR
0527 C*
0528 C   03                GOTO HSH1
0529 C           RECF      ADD  1         RECF
0530 C*
0531 C* IF HASH FIELD IS NEG. REVERSE SIGN.
0532 C***********FAMT      DIV  1000      ZZAMT        59                 167498
0533 C***59******          Z-SUBZZAMT     ZZAMT                           167498
0534 C***********          SETOF                     59                   167498
0532 C********** FAMT      DIV  1000      ZZAMT                           167498              194380
0532 C           FAMT      DIV  1000      ZZAMT        59                                     194380
0533 C   59                Z-SUBZZAMT     ZZAMT                                               194380
0534 C                     SETOF                     59                                       194380
0535 C                     Z-ADDFAC1      ZZTOTI
0536 C                     Z-ADDFAC2      ZZTOTD
0537 C                     EXSR GLZADD
0538 C*
0539 C                     Z-ADDZZTOTI    FAC1   150
0540 C                     Z-ADDZZTOTD    FAC2    30
0541 C                     GOTO HSHEND
0542 C*
0543 C           HSH1      TAG                             ** HSH1 TAG **
0544 C           RECM      ADD  1         RECM
0545 C*NEG SIGN IS IGNORED IN MNHSR TOTALS
0546 C                     MOVE AMNTM     ZZAMT
0547 C*
0548 C                     Z-ADDMAT1      ZZTOTI
0549 C                     Z-ADDMAT2      ZZTOTD
0550 C                     EXSR GLZADD
0551 C*
0552 C                     Z-ADDZZTOTI    MAT1   150
0553 C                     Z-ADDZZTOTD    MAT2    30
0554 C           HSHEND    ENDSR                           ** HSHEND  **
0555 C********************************************************************
0556 C* TOTAL ARRAY AND ADD TO RELEVANT MTD,QTD,YTD FIGURES
0557 C*
0558 C* CALLED BY:MP
0559 C*
0560 C           FACTOT    BEGSR                            *** FACTOT ***
0561 C*
0562 C* TOTAL ALL ELEMENTS
0563 C*
0564 C                     XFOOTARM       MTDAG  130
0565 C* OBTAIN MTD HIGH AND LOW FIGURES.
0566 C*
0567 C                     Z-ADDARM,1     HIGH   130
0568 C                     Z-ADDARM,1     LOW    130
0569 C                     Z-ADD2         B       20
0570 C           FACBAC    TAG                             **FACBAC TAG **
0571 C*
0572 C           ARM,B     COMP HIGH                 55
0573 C           ARM,B     COMP LOW                    57
0574 C*
0575 C   55                Z-ADDARM,B     HIGH
0576 C   57                Z-ADDARM,B     LOW
0577 C*
0578 C           B         COMP WDAYS                    56
0579 C   56                GOTO QFAC1
0580 C           B         ADD  1         B
0581 C                     GOTO FACBAC
0582 C           QFAC1     TAG                             **QFAC1 TAG **
0583 C                     Z-ADDHIGH      MTDH
0584 C                     Z-ADDLOW       MTDL
0585 C** ADD MONTHLY AGGREGATE INTO ACCUMULATES
0586 C  N60      YTDA      ADD  MTDAG     YTDA
0587 C  N60N61   QTDA      ADD  MTDAG     QTDA
0588 C   60                Z-ADDMTDAG     YTDA
0589 C   60
0590 COR 61                Z-ADDMTDAG     QTDA
0591 C** ZEROISE ARRAY FOR NEXT FACILITY
0592 C                     Z-ADD0         ARM
0593 C                     Z-ADDMTDAG     MTDA
0594 C*
0595 C** LIVE RECS. ONLY - UPDATE REVIEW DATE
0596 C*
     C/COPY WNCPYSRC,LE0860C001
0597 C   05                GOTO FACTEN
0598 C           RVFR      COMP ' '                      30
0599 C   30                GOTO FACTEN
0600 C           RVDT      COMP RUND                   3030
0601 C  N30                GOTO FACTEN
0602 C                     Z-ADDRVDT      ZDAYNO
0603 C                     MOVE RVFR      ZFREQ
0604 C***********          MOVE FCCY      ZCCY                            S01195
     C                     MOVE LOCY      ZCCY                            S01195
0605 C                     MOVE RVDY      ZMDAY
     C                     MOVE SYSL      ZLOC                            S01195
0606 C           UPDFQ     TAG                             ** UPDFQ TAG **
0607 C***********          EXSR ZFREQB                                    S01195
     C*****                EXSR FREQB                                     S01392
     C                     EXSR ZFREQB                                    S01392
0608 C           ZDAYNO    COMP RUND                   3030
0609 C   30                GOTO UPDFQ
0610 C           DTEX      COMP ZDAYNO                 3030
0611 C  N30                Z-ADDZDAYNO    RVDT
0612 C           FACTEN    ENDSR
      *****************************************************************                     CLE075AB
      * SRCHKP - Checks if Retail Transaction type is already in the  *                     CLE075AB
      *          array.                                               *                     CLE075AB
      *  Called By: FACCCY                                            *                     CLE075AB
      *  Calls:     None                                              *                     CLE075AB
      *****************************************************************                     CLE075AB
     C           SRCHKP    BEGSR                                                            CLE075AB
     C                     MOVE *IN20     #IN20   1                                         CLE075AB
     C                     ADD  1         ##LC                                              CLE075AB
     C                     MOVEL*BLANK    ##PFIC  1                                         CLE075AB
      *                                                                                     CLE075AB
      ** Restore saved value of A index                                                     CLE075AB
      *                                                                                     CLE075AB
     C                     Z-ADD##PSAV    C                                                 CLE075AB
      *                                                                                     CLE075AB
      ** Defend against C == 0                                                              CLE075AB
      *                                                                                     CLE075AB
     C           C         IFEQ 0                                                           CLE075AB
     C                     Z-ADD1         C                                                 CLE075AB
     C                     ENDIF                                                            CLE075AB
      *                                                                                     CLE075AB
      ** Is this the same as the last LOKUP? if so, we can bypass LOKUP                     CLE075AB
      *                                                                                     CLE075AB
     C           WCCY      IFEQ @CCY,C                                                      CLE075AB
     C                     SETON                         20                                 CLE075AB
     C                     ELSE                                                             CLE075AB
      *                                                                                     CLE075AB
      ** Begin lookup from last saved or if full, start from 1                              CLE075AB
      *                                                                                     CLE075AB
     C           ##PNDX    IFEQ 0                                                           CLE075AB
     C                     Z-ADD1         C                                                 CLE075AB
     C                     ELSE                                                             CLE075AB
     C                     Z-ADD##PNDX    C                                                 CLE075AB
     C                     ENDIF                                                            CLE075AB
      *                                                                                     CLE075AB
     C           WCCY      LOKUP@CCY,C                   20                                 CLE075AB
     C                     ENDIF                                                            CLE075AB
      *                                                                                     CLE075AB
     C           *IN20     IFEQ *ON                                                         CLE075AB
     C                     MOVE ##LC      #LRU,C                                            CLE075AB
      *                                                                                     CLE075AB
      ** Save the last update to C                                                          CLE075AB
      *                                                                                     CLE075AB
     C                     Z-ADDC         ##PSAV                                            CLE075AB
      *                                                                                     CLE075AB
      ** Turn on indicator so that program will know it is in the array                     CLE075AB
      *                                                                                     CLE075AB
     C                     MOVEL'Y'       ##PFIC                                            CLE075AB
     C                     ENDIF                                                            CLE075AB
      *                                                                                     CLE075AB
     C                     MOVE #IN20     *IN20                                             CLE075AB
     C                     ENDSR                                                            CLE075AB
      *****************************************************************                     CLE075AB
      * SRADDP - This subroutine adds the newly chained Currency      *                     CLE075AB
      *          details to the cache. if the cache is full,          *                     CLE075AB
      *          it replaces the least recently used.                 *                     CLE075AB
      *  Called By: FACCCY                                            *                     CLE075AB
      *  Calls:     None                                              *                     CLE075AB
      *****************************************************************                     CLE075AB
     C           SRADDP    BEGSR                                                            CLE075AB
     C                     MOVE *IN40     #IN40   1                                         CLE075AB
      *                                                                                     CLE075AB
      ** Check if there is still available slot in the array.                               CLE075AB
      *                                                                                     CLE075AB
     C           ##PNDX    IFNE 0                                                           CLE075AB
     C                     Z-ADD##PNDX    C                                                 CLE075AB
      *                                                                                     CLE075AB
     C                     MOVE ##LC      #LRU,C                                            CLE075AB
      *                                                                                     CLE075AB
     C                     SUB  1         ##PNDX                                            CLE075AB
      *                                                                                     CLE075AB
      ** Else replace the LRU                                                               CLE075AB
      *                                                                                     CLE075AB
     C                     ELSE                                                             CLE075AB
     C                     Z-ADD1         C                                                 CLE075AB
     C                     MOVEA#LRU      #LRUC                                             CLE075AB
     C                     SORTA#LRUC                                                       CLE075AB
     C                     Z-ADD#LRUC,1   #LEAST                                            CLE075AB
     C           #LEAST    LOKUP#LRU,C                   40                                 CLE075AB
      *                                                                                     CLE075AB
     C                     MOVE ##LC      #LRU,C                                            CLE075AB
      *                                                                                     CLE075AB
     C                     ENDIF                                                            CLE075AB
      *                                                                                     CLE075AB
      ** Update PSAVE so next call to SRCHKP checks                                         CLE075AB
      ** this newly added element.                                                          CLE075AB
      *                                                                                     CLE075AB
     C                     Z-ADDC         ##PSAV                                            CLE075AB
     C                     MOVE #IN40     *IN40                                             CLE075AB
     C                     ENDSR                                                            CLE075AB
0765 C********************************************************************
0766 C*  SR TO COMPARE HASH TOTALS
0767 C*
0768 C*  CALLED BY : LR PROCESSING (MP)
0769 C*
0770 C           HSHCOM    BEGSR                           *** HSHCOM ***
0771 C* ADD TO COUNTS FOR TRAILERS
0772 C*
0773 C           RECF      ADD  1         RECF
0774 C           RECM      ADD  1         RECM
0775 C* FACILITY
0776 C           NORE      COMP RECF                 8686
0777 C  N86      VLAF      COMP FAC1                 8686
0778 C  N86      VLAL      COMP FAC2                 8686
0779 C*
0780 C* MNHSR
0781 C           NOREM     COMP RECM                 8787
0782 C  N87      VLORF     COMP MAT1                 8787
0783 C  N87      VLORL     COMP MAT2                 8787
0784 C   87
0785 COR 86                SETON                     U8
0786 C                     ENDSR                           * HSHCOM ENDSR*
0787 C********************************************************************
0788 C* SUBROUTINE FOR FIRST CYCLE PROCESSING.
0789 C*
0790 C* CALLED BY : MAIN PROCESSING
0791 C* CALLS  :  ZSYSTM
0791 C* CALLS  :  ZSYSTM, BCASR                                           S01117
0792 C*
0793 C           FIRCYL    BEGSR                           ** FIRCYL  **
     C           *NAMVAR   DEFN           LDA                             S01194
0794 C*
0795 C* OBTAIN ICDR REC
0796 C                     EXSR ZSYSTM                     ---------------
0797 C***99*********       Z-ADD1         DBASE            --DATABASE 1 --S01194
0798 C***99*********       MOVELZTABKY    DBKEY            ---------------S01194
0799 C   99                GOTO FIREND
0800 C*
0801 C* OBTAIN MONTH NO,FROM RUN DATE
0802 C                     Z-ADDRUND      ZDAYNO
0803 C                     EXSR ZDATE2
0804 C                     Z-ADDZMTH      M       20
0805 C*
0806 C* SET FIELD FOR NO. OF DAYS IN THIS MONTH
0807 C*
0808 C           ZFMD,M    COMP '28'                     38
0809 C                     MOVE ZFMD,M    WDAYS   20
0810 C*
0811 C* IF FEB  CHECK FOR LEAP YR
0812 C*
0813 C   38      ZYEAR     DIV  4         WORK    20
0814 C   38                MVR            WOR2    10     39LEAP YEAR 39ON
0815 C   39                Z-ADD29        WDAYS
0816 C***SETUP*BASIS OF TABLE CCY KEY                                     S01194
0817 C**************       MOVEL'20      'XTAB                            S01194
0818 C**************       MOVE '1'       XTAB2                           S01194
0819 C*
0820 C** CHECK MONTH TO SEE IF TO DATE FIGURES WILL ADD OR OVERWRITE
0821 C           M         COMP 01                       60-YTD AND QTD
0822 C  N60      M         COMP 04                   62  61 61 = QTD
0823 C   62      M         COMP 07                   62  61
0824 C   62      M         COMP 10                       61
0825 C           FIREND    TAG                             ++ FIREND TAG +
0826 C***99*********       MOVE 'TABLE'   DBFILE                          S01194
0827 C***99*********       SETON                     U7U8LR               S01194
0828 C** SETUP REC COUNT FIELDS
0829 C                     Z-ADD1         RECM    50
0830 C                     Z-ADD1         RECF    50
     C*                                                                   S01117
     C           *INU7     IFEQ '0'                                       S01117
     C*                                                                   S01117
     C                     EXSR BCASR                                     S01117
     C*                                                                   S01117
     C                     END                                            S01117
      *                                                                                     CLE075AB
      ** Define variables for LRU and initializations.                                      CLE075AB
      *                                                                                     CLE075AB
     C                     Z-ADD0         #LEAST 130                                        CLE075AB
     C           *LIKE     DEFN #LEAST    ##LC                                              CLE075AB
      *                                                                                     CLE075AB
     C                     Z-ADD0         ##PNDX  40                                        CLE075AB
     C           *LIKE     DEFN ##PNDX    C                                                 CLE075AB
     C           *LIKE     DEFN ##PNDX    ##PSAV                                            CLE075AB
     C                     Z-ADD200       ##PNDX                                            CLE075AB
     C                     Z-ADD0         ##LC                                              CLE075AB
     C*                                                                   S01117
0831 C                     ENDSR
0832 C********************************************************************
     C** Sub-routine to set-up array of Branch Internal Customer          S01117
     C** Numbers                                                          S01117
     C** Called from: FIRCYL                                              S01117
     C** Calls: None                                                      S01117
     C*****************************************************************   S01117
     C*                                                                   S01117
     C           BCASR     BEGSR                                          S01117
     C*                                                                   S01117
     C                     Z-ADD1         I       30                                         CLE07AB
     C           I         OCUR SDBRCH                                                       CLE07AB
      *                                                                                      CLE07AB
     C                     READ SDBRCHL5                 70               S01195
     C*                                                                   S01195
     C           *IN70     IFEQ '0'                                       S01117
     C**********           Z-ADD1         I       30                                  S01117 CLE07AB
     C*                                                                   S01117
     C           *IN70     DOWEQ'0'                                       S01117
     C           *INU7     ANDEQ'0'                                       S01117
     C*                                                                   S01117
     C***If*no*more*than*150*branch*internal*customer*nos,*(BICN)*tS01117 173117
     C***If*no*more*than*900*branch*internal*customer*nos,*(BICN)*then***            173117 CLE075AB
     C** if no more than 2000 branch internal customer numbers, then                        CLE075AB
     C** continue processing, otherwise database error                    S01117
     C*                                                                   S01117
     C***********I         IFLE 150                                S01117 173117
     C********** I         IFLE 900                                                  173117 CLE075AB
     C           I         IFLE 2000                                                        CLE075AB
     C*                                                                   S01117
     C** Check that record is active and store BICN if so                 S01117
     C*                                                                   S01117
     C*********  RECI      IFEQ 'D'                                 S01117BHF821
     C                     MOVEL*BLANKS   @BCA,I                          S01117
     C*********            MOVELBICN      @BCA,I                    S01117BHF821
     C                     MOVELA8BICN    @BCA,I                          BHF821
     C                     MOVELA8CMCD    CMPYM                                            AR1095473
     C                     ADD  1         I                               S01117
     C**********           END                                      S01117BHF821
      *                                                                                     CLE075AB
     C           I         OCUR SDBRCH                                                      CLE075AB
      *                                                                                     CLE075AB
     C                     READ SDBRCHL5                 70               S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C***More*than*150*BICNs***************************************S01117 173117
     C***More*than*900*BICNs*********************************************            173117 CLE075AB
      *                                                                                     CLE075AB
      ** More than 2000 BICNs                                                               CLE075AB
      *                                                                                     CLE075AB
     C                     MOVE '@BCA'    DBFILE           ***************S01117
     C                     MOVEL'OVERFLOW'DBKEY            ***  DB 29  ***S01117
     C                     MOVE '29'      DBASE            ***************S01117
     C                     SETON                     U7U8LR               S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ELSE                                           S01117
     C*                                                                   S01117
     C                     SETON                     U7U8LR               S01117
     C                     MOVE 'SDBRCHL5'DBFILE           ***************S01117
     C                     MOVE '28'      DBASE            ***  DB 28  ***S01117
     C*                                                    ***************S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                                          S01117
     C********************************************************************S01117
0833 C**
0834 C**   ZSYSTM SR. TO CHAIN TO THE INSTALLATION CONTROL DATA RECORD.
0835 C**
0836 C           ZSYSTM    BEGSR                           *** ZSYSTM ***
0837 C**************                                                      S01194
0838 C*****SET*UP*KEY FOR INSTALLATION CONTROL RECORD.                    S01194
0839 C**************       MOVEL'01      'ZTABKY 12                       S01194
0840 C**************       MOVE '  10'    ZTABKY                          S01194
0841 C**************                                                      S01194
0842 C***********ZTABKY    CHAINTABLE                99    ON NOT THERE   S01194
0843 C**N99******RECI      COMP 'D'                  9999  ON, IS DELETED S01194
     C**                                                                  S01194
     C**   ACCESS BANK DETAILS                                            S01194
     C**                                                                  S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*MSG   ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
     C*                                                                   S01194
     C           @RTCD     IFNE *BLANK                                    S01194
     C                     SETON                     U7U8LR               S01194
     C                     SETON                     99    ***************S01194
     C                     MOVEL'SDBANKPD'DBFILE           * DBERROR 01  *S01194
     C                     Z-ADD1         DBASE            ***************S01194
     C                     ELSE                                           S01194
0844 C**
0845 C**   CHECK SYSTEM DATE FORMAT, DDMMYY OR MMDDYY.
0846 C***********DATF      COMP 'M'                      98MMDDYY, 98 ON  S01194
0846 C           BJDFIN    COMP 'M'                      98MMDDYY, 98 ON  S01194
     C                     END                                            S01194
      *                                                                   CLE004
      ** Check if SAR CLE004 is present                                   CLE004
      *                                                                   CLE004
     C                     CALL 'AOSARDR0'                                CLE004
     C                     PARM *BLANKS   P@RTCD  7                       CLE004
     C                     PARM '*KEY   ' P@OPTN  7                       CLE004
     C                     PARM 'CLE004'  P@SARD  6                       CLE004
     C           SCSARD    PARM SCSARD    DSFDY                           CLE004
      *                                                                   CLE004
     C           P@RTCD    IFEQ *BLANKS                                   CLE004
     C                     MOVE *ON       CLE004  1                       CLE004
     C                     ELSE                                           CLE004
      *                                                                   CLE004
      ** Handle Database Error                                            CLE004
      *                                                                   CLE004
     C           P@RTCD    IFNE '*NRF    '                                CLE004
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE004
     C                     Z-ADD7         DBASE            * DBERR 07 *   CLE004
     C                     MOVEL'CLE004'  DBKEY            ************   CLE004
     C                     MOVE *ON       *INU7                           CLE004
     C                     MOVE *ON       *INU8                           CLE004
     C                     MOVE *ON       *INLR                           CLE004
     C                     MOVE *ON       *IN99                           CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE004
     C                     ENDIF                                          CLE004
      *                                                                   CLE005
      ** Check if SAR CLE005 is present                                   CLE005
      *                                                                   CLE005
     C                     CALL 'AOSARDR0'                                CLE005
     C                     PARM *BLANKS   P@RTCD  7                       CLE005
     C                     PARM '*KEY   ' P@OPTN  7                       CLE005
     C                     PARM 'CLE005'  P@SARD  6                       CLE005
     C           SCSARD    PARM SCSARD    DSFDY                           CLE005
      *                                                                   CLE005
     C           P@RTCD    IFEQ *BLANKS                                   CLE005
     C                     MOVE *ON       CLE005  1                       CLE005
     C                     ELSE                                           CLE005
      *                                                                   CLE005
      ** Handle Database Error                                            CLE005
      *                                                                   CLE005
     C           P@RTCD    IFNE '*NRF    '                                CLE005
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE005
     C                     Z-ADD8         DBASE            * DBERR 08 *   CLE005
     C                     MOVEL'CLE005'  DBKEY            ************   CLE005
     C                     MOVE *ON       *INU7                           CLE005
     C                     MOVE *ON       *INU8                           CLE005
     C                     MOVE *ON       *INLR                           CLE005
     C                     MOVE *ON       *IN99                           CLE005
     C                     ENDIF                                          CLE005
      *                                                                   CLE005
     C                     ENDIF                                          CLE005
0847 C**
     C/COPY WNCPYSRC,LE0860C002
0848 C                     ENDSR
0849 C********************************************************************
0850 C********************************************************************
0851 C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
0852 C*   IND '99' IS SET BY AN OVERFLOW ERROR
0853 C*
0854 CSR         GLZADD    BEGSR                           *** GLZADD ****
0855 C*
0856 CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
0857 CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
0858 C*
0859 C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
0860 CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
0861 CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
0862 C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
0863 C*
0864 CSR                   EXSR GLZSUM
0865 CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
0866 C*
0867 C********************************************************************
0868 C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
0869 C*                        GLZADD, GLZSUB, GLZCMP.
0870 C*          PARAMETERS PASSED -
0871 C*                     I/P ZZAMTI ZZAMTD
0872 C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
0873 C*
0874 CSR         GLZSUM    BEGSR                           *** GLZSUM ****
0875 C*
0876 CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
0877 CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
0878 CSR                   SETOF                     919293
0879 CSR                   SETOF                     949599
0880 C*
0881 C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
0882 CSR         ZZAMTI    COMP 0                      9293
0883 CSR 93      ZZAMTD    COMP 0                      9293
0884 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0885 C*
0886 C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
0887 CSR         ZZTOTI    COMP 0                      9193
0888 CSR 93      ZZTOTD    COMP 0                      9193
0889 C*
0890 C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
0891 CSR 93                Z-ADDZZAMTI    ZZTOTI
0892 CSR 93                Z-ADDZZAMTD    ZZTOTD
0893 CSR 93                GOTO ZZSEND                     ZERO BYPASS
0894 C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
0895 CSR 91N92
0896 CORN91 92             GOTO ZZOFPS
0897 C*
0898 CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
0899 CSR         ZZWK2     COMP 999                  93    '93' = CARRY
0900 CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
0901 C*
0902 CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
0903 CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
0904 CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
0905 CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
0906 C*
0907 C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
0908 CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
0909 CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
0910 CSRN99                Z-ADDZZWK2     ZZTOTD
0911 CSRN99                Z-ADDZZWK3     ZZTOTI
0912 C*
0913 C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
0914 CSR 99                Z-ADD0         ZZAMT  153
0915 CSR                   GOTO ZZSEND
0916 C*
0917 C* THE 'SIGNS' ARE DIFFERENT
0918 CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
0919 C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
0920 C*
0921 CSR 92                Z-SUBZZAMTI    ZZAMTI 150
0922 CSR 92                Z-SUBZZAMTD    ZZAMTD  30
0923 C*
0924 C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
0925 C*
0926 CSR 91                Z-SUBZZTOTI    ZZTOTI
0927 CSR 91                Z-SUBZZTOTD    ZZTOTD
0928 C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
0929 C*
0930 CSR         ZZTOTI    COMP ZZAMTI               93  95
0931 CSR 95      ZZTOTD    COMP ZZAMTD               93  95
0932 C*
0933 C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
0934 CSR 95                Z-ADD0         ZZTOTI
0935 CSR 95                Z-ADD0         ZZTOTD
0936 CSR 95                GOTO ZZSEND
0937 C*
0938 C* IF ZZTOT GT. ZZAMT.
0939 CSR 93      ZZAMTD    COMP ZZTOTD               94
0940 CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
0941 CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
0942 CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
0943 CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
0944 CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
0945 C*
0946 C*
0947 C* IF ZZAMT GT. ZZTOT.
0948 CSRN93      ZZTOTD    COMP ZZAMTD               94
0949 CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
0950 CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
0951 CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
0952 CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
0953 CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
0954 CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
0955 C*
0956 C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
0957 CSR                   SETOF                     94
0958 CSR 93 91
0959 CORN93 92             SETON                     94
0960 CSR 94                Z-SUBZZTOTI    ZZTOTI
0961 CSR 94                Z-SUBZZTOTD    ZZTOTD
0962 C**
0963 C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
0964 CSR 92                Z-SUBZZAMTI    ZZAMTI
0965 CSR 92                Z-SUBZZAMTD    ZZAMTD
0966 CSR         ZZSEND    TAG                             ** ZZSEND TAG *
0967 C**
0968 C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
0969 CSR                   SETOF                     96
0970 CSR         ZZTOTD    COMP 0                        91
0971 CSR 91      ZZTOTI    COMP 0                      96
0972 CSR 96                MOVE '.000-'   ZZNEGD  5
0973 CSR                   ENDSR                             ** ENDSR **
0974 C********************************************************************
     C/EJECT                                                              S01195
     C********************************************************************S01117
     C* *PSSR  --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS         S01117
     C*                                                                   S01117
     C* CALLED FROM: AFTER ABNORNAL OPERATION OCCURS                      S01117
     C********************************************************************S01117
     C*                                                                   S01117
     C           *PSSR     BEGSR                           ** *PSSR **    S01117
     C*                                                                   S01117
     C           @RUN      IFEQ *BLANKS                                   S01117
     C                     MOVE 'Y'       @RUN    1                       S01117
     C                     DUMP                                           S01117
     C                     END                                            S01117
     C*                                                                   S01117
     C                     ENDSR                           ** *PSSR **    S01117
     C********************************************************************
     C/COPY ZSRSRC,ZACCH                                                  S01195
     C/COPY ZSRSRC,ZFWDT                                                  S01195
     C/COPY ZSRSRC,ZBKDT                                                  S01195
     C/COPY ZSRSRC,ZCHKH                                                  S01195
     C/COPY ZSRSRC,ZDATE1Z2                                               S01392
     C/COPY ZSRSRC,ZDATE2Z4                                               S01392
     C/COPY ZSRSRC,ZFREQBZ2                                               S01392
     C**************************************************************************
1206 O** UPDATED FACILITIES FILE
1207 O*      HEADER
1208 O*
1209 OFCLUPHH H        02
1210 O                                    1 'H'
1211 O*
1212 O*       DETAIL'A' UPDATED
1213 OFCLUPFM T        L1 25
1214 O                         LOTAA    200
1215 O                         LOTAB    256
     O***********              LOTAC   1086                        123915 127736
     O************             LOTAC   1098                        127736 CLE008
     O***********              LOTAC   1106                        CLE008 147261
     O**********               LOTAC   1107                                            147261 CLE028
     O**********               LOTAC   1181                                            CLE028 CGL029
     O************             LOTAC   1217                                           CGL029 BUG8957
     O**********               LOTAC   1258                                           BUG8957 247599
     O**********               LOTAC   1267                                          247599 BUG23624
     O**********               LOTAC   1269                                          BUG23624 CLE064
     O                         LOTAC   1284                                                   CLE064
1216 O                         RVDT      55P
1217 O                         MTDH     205P
1218 O                         MTDL     212P
1219 O                         MTDA     219P
1220 O                         QTDA     227P
1221 O                         YTDA     235P
     O***************          CMPYM    243                        S01117 052151
1222 O*
1223 O*       DETAIL 'B'
1224 OFCLUPFN T        L1 25
1225 O                         LOTBA    200
1226 O**********               LOTBB    256                                                   CLE023
     O**********               LOTBB    263                                             CLE023209774
     O**********               LOTBB    330                                            209774 CGL029
     O/COPY WNCPYSRC,LEH00363
     O                         LOTBB    348                                                   CGL029
     O/COPY WNCPYSRC,LEH00364
1227 O*      TRAILER
1228 OFCLUPZZ T        LRNU7
1229 O                         LOTTA    200
1230 O                         LOTTB    256
1231 O* CONTROL REPORT
1232 O*E0860P1T** 03   LR                                       S01124    S01117
1232 OLE0860AUT   03   LR                                                 S01117
1233 O***********                        22 'REFERENCE LE0860'            S01117
1233 O                                   24 'REFERENCE LE0860AU'          S01117
1234 O                         TITL      89
1235 O                                  122 'DATE              PAGE'
1236 O                         RUNA     112
1237 O                         PAGE  Z  127
1238 O        T 2      LR
1239 O                                   53 'UPDATE MONTH TO DATE ON '
1240 O                                   77 'FACILITIES FILE CONTROLS'
1241 O        T 13     LR
1242 O                                   53 '------------------------'
1243 O                                   77 '------------------------'
1244 O        T 1      LR
1245 O                                   28 'S/MNHSR - RUN CONTROLS'
1246 O                                   59 'NUMBER'
1247 O                                   84 'VALUE'
1248 O        T 1      LR
1249 O                                   28 '----------------------'
1250 O                                   59 'OF RECORDS'
1251 O                                   84 'OF RECORDS'
1252 O        T 2      LR
1253 O                                   29 'TOTAL RECORDS ON FILE'
1254 O                      NU7NOREM 3   59
1255 O                      NU7VLORF Z   81
1256 O                      NU7VLORL     84
1257 O        T 2      LR
1258 O                                   30 'TOTAL RECORDS ON FILE -'
1259 O                                   41 'CALCULATED'
1260 O                         RECM  3   59
1261 O                         MAT1  Z   81
1262 O                         MAT2      84
1263 O                       87         111 '***   DIFFERENCE   ***'
1264 O* FCLTY FILE
1265 O        T 3      LR
1266 O                                   28 'S/FCLTY - RUN CONTROLS'
1267 O        T 1      LR
1268 O                                   28 '----------------------'
1269 O        T 2      LR
1270 O                                   29 'TOTAL RECORDS ON FILE'
1271 O                      NU7NORE  3   59
1272 O                      NU7VLAF  Z   81
1273 O                      NU7VLAL      84
1274 O        T 23     LR
1275 O                                   30 'TOTAL RECORDS ON FILE -'
1276 O                                   41 'CALCULATED'
1277 O                         RECF  3   59
1278 O                         FAC1  Z   81
1279 O                         FAC2      84
1280 O                    86            111 '***   DIFFERENCE   ***'
1281 O        T 1      LR U7 U8
1282 O                                   42 '*** REFERENCE'
1283 O***********              DBPGM     51                               S01117
     O                         DBPGM     53                               S01117
1284 O                                   71 '-DATABASE ERROR AT'
1285 O***********              DBASE     74                               S01117
1285 O                         DBASE     76                               S01117
1286 O        T 23     LR U7 U8
1287 O                                   37 'FILENAME'
1288 O***********              DBFILE    43                               S01117
1289 O***********                        48 'KEY'                         S01117
1290 O***********              DBKEY     78                               S01117
1288 O                         DBFILE    47                               S01117
1289 O                                   53 'KEY'                         S01117
1290 O                         DBKEY     86                               S01117
1291 O********T*3      LR                                                 S01117
1292 O***********                        76 '*** END OF REPORT ***'       S01117
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH
312831303130313130313031
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**   POW ARRAY FOR BASE CURRENCY CONV
0000001000001000001000001000001000001000001000000
** CPY@   **      OBJECT COPYRIGHT
(c) Misys International Banking Systems Ltd. 2001
