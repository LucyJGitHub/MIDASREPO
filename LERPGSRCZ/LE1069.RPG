     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas LE Create extract files for fees')               *
      *****************************************************************
      *                                                               *
      *  Midas - Customer Lending Module                              *
      *                                                               *
      *  LE1069    LE Create Extract Files for Fees                   *
      *                                                               *
      *  Function: This program will, for each fee, calculate the fee *
      *            amount, calculate the fee payment date, generate   *
      *            the fee message, and the fee settlement message.   *
      *                                                               *
      *  Called By: LEC0213, LEC0402                                  *
      *                                                               *
      *  Calls:                                                       *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD029653           Date 06Nov19               *
      *  Prev Amend No. MD055001           Date 02Apr20               *
      *                 MD053295           Date 13Apr19               *
      *                 MD050139           Date 23Mar18               *
      *                 MD046370           Date 07Nov17               *
      *                 MD046248           Date 27Oct17               *
      *                 MD047474           Date 16Oct17               *
      *                 MD047993           Date 23Sep17               *
      *                 MD035545           Date 11Sep15               *
      *                 MD037658           Date 19Feb16               *
      *                 MD046351           Date 23Aug17               *
      *                 MD045010           Date 05Apr17               *
      *                 CGL184             Date 07Dec16               *
      *                 CLE154             Date 07Aug12               *
      *                 CLE141A            Date 28Apr16               *
      *                 CLE141             Date 08Feb16               *
      *                 AR996895           Date 25Nov12               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 CLE073             Date 13May08               *
      *                 262328             Date 30Oct09               *
      *                 263666             Date 01Feb10               *
      *                 CER059             Date 19Jul10               *
      *                 CER016A            Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      *                 CSC042             Date 16Feb09               *
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 BUG21167           Date 25Sep08               *
      *                 247959             Date 22May07               *
      *                 246141             Date 26Mar07               *
      *                 246018             Date 26Feb07               *
      *                 164847             Date 30Nov06               *
      *                 BUG12990           Date 05Jan07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 242286             Date 25Sep06               *
      *                 212048             Date 06Jun06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CLE106             Date 01Aug04               *
      *                 CLE038             Date 04Jun04               *
      *                 CSW037A            Date 02May05               *
      *                 CIR013             Date 25Apr05               *
      *                 230521             Date 28Oct04               *
      *                 CAS009             Date 04May04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CLE034             Date 05May03               *
      *                 CLE031             Date 17Feb03               *
      * Midas Release 4.01.03 ----------------------------------------*
      *                 212398             Date 22Nov02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 204452             Date 03May02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 200022             Date 29Jan02               *
      *                 186066             Date 27Nov01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE013             Date 06Nov00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CLE009 *CREATE     Date 17May99               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD029653 - Pay/receive generation failure. Program encounters*
      *             RPG0102 when it tried to divide by 0.             *
      *  MD055001 - Wrong branch assigned. Used branch from LEFEEAD.  *
      *  MD053295 - Lending loan with Interest Calculation Basis      *
      *             method 3 (30/360) has wrong interest payment      *
      *             amount for month of March (Recompile)             *
      *  MD050139- AOSARDR0 called every time causing performance     *
      *            issue. Recompile due to changes in /COPY           *
      *            ZFREQ/ZFRQ*.                                       *
      *  MD046370 - Component LERC135 is looping in COB. If system    *
      *             value AutoEndCalcLoanFee is 'Y', ensure that fee  *
      *             start date does not fall after fee end date/next  *
      *             payment date.  If value is 'N', fee end date/next *
      *             payment date should not be changed at all.        *
      *             Applicable for all calculated loan fees.          *
      *  MD046248 - Finastra Rebranding                               *
      *  MD047474 - Exchange rate conversion occurs for loan fees with*
      *             calculation type 99. Skip exchange rate           *
      *             calculation if FECALT = 99.                       *
      *  MD047993 - Modified MD035545. Removed dependency on Accrue   *
      *             on Last Day indicator.                            *
      *  MD035545 - LE: Interest Calculation in Leap year. Consider   *
      *             Accrue on Last Day Indicator for method 6.        *
      *  MD037658 - Define NDAYS/WDAYS w/decimal to cater calc basis 6*
      *  MD046351 - Rounding and truncation in fee accrual            *
      *             calculations due to mult/div using 15,9 fields    *
      *             being placed into 13,0/15,0 result fields.        *
      *  MD045010 - Component LEC06A 10008 looping during COB caused  *
      *             by CGL184. Recompile due to changes in ZFRQB3.    *
      *  CGL184 - New Frequencies for Account Statements (Recompile)  *
      *  CLE154 - Loan Repayment Schedule Enhancement (Recompile)     *
      *  CLE141A - CLE141 Change Control 1                            *
      *  CLE141 - Currency and Location Business Day Convention       *
      *           for LE Transactions                                 *
      *  AR996895 - Incorrect acrrual interest calculation            *
      *             (Child: AR996897) (Recompile)                     *
      *  CLE134 - Past Due Call Loan Processing                       *
      *  CLE148 - Alpha Loan Reference                                *
      *  CLE073 - Calculated Loan Based Fees                          *
      *  262328 - LEC0213 in MSGW. Increase size of CURR array from   *
      *           from 150 to 900.                                    *
      *  263666 - Recompiled due to changes in ZINTDYZ2               *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER016A - German Interest Calculation: Upgarde of FGE059     *
      *            to Midas Plus (Recompile)                          *
      *  CSC042 - Close of Business Performance Enhancements          *
      *           Only call LE1070 for the specific facility          *
      *           for which the history needs to be extracted.        *
      *  BUG21167 - No generation of MT103, 202 and 210               *
      *  247959 - Re-build LEFEETPD only for affected facilities.     *
      *  246141 - Recompiled due to changes in ZINTDYZ2               *
      *  246018 - Divide by zero error.                               *
      *  164847 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  BUG12990 - Recompiled due to changes in ZINTDYZ2/ZINTDYZ2LE  *
      *  242286 - Recompile over changes in /COPY ZINTDYZ2.           *
      *  212048 - If calc method 6 then INT6DY contains the number    *
      *           of days from ZINTDY.                                *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CLE106 - Syndications Manager                                *
      *  CLE038 - Lending Enhancement for Nordea: Allocation by Amount*
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CIR013 - Additional Calculation Method for FRA/IRS/CCF       *
      *           Recompile over ZINTDY.                              *
      *  230521 - Store the loan/facility customer.  Applied 215643.  *
      *  CAS009 - Effective Interest Rate/Amortised Cost Accounting   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CLE034 - Lending Enhancements for Phase 1 Priority 1A        *
      *  CLE031 - Lending Enhancements.                               *
      *  212398 - Increase array sizes for branches and Branch        *
      *           Internal Customer Numbers to 900.                   *
      *  204452 - Recompiled due to changed PF/LEFEED.                *
      *  200022 - Pass customer number to AOCUSTR0, rather than       *
      *           passing the NOSTRO shortname.                       *
      *  186066 - Allow cancellation or deletion processing for fees  *
      *           which have been reversed or whose settlement method *
      *           has been amended from 08 to 01.                     *
      *  CLE013 - Customer Lending Fees Enhancements - Phase I        *
     F*  CLE009 - New Program                                         *
     F*                                                               *
     F*****************************************************************
     F*
     FFCLTY   IF  E           K        DISK         KINFSR *PSSR
     F            FCLTYHHF                          KIGNORE
     F            FCLTYFNF                          KIGNORE
     F            FCLTYZZF                          KIGNORE
      ** Customer Lending Facility
      *
     FLEFEEDL1IF  E           K        DISK         KINFSR *PSSR
      ** Fees File
      *
     FLEFEEAL2IF  E           K        DISK         KINFSR *PSSR
     FLEFEEAL0UF  E           K        DISK         KINFSR *PSSR
     F            LEFEEADF                          KRENAMELEFEEA0
      ** Fees Settlement File
      *
     FLEFEETL0IF  E           K        DISK         KINFSR *PSSR
      ** Fees Temporary Activity File
      *
     FFACHISH IF  E           K        DISK         KINFSR *PSSR
      ** Facility History Header File
     F/COPY WNCPYSRC,LEH00732
      *                                                                                       CLE073
     FCLOAN   IF  E           K        DISK                                                   CLE073
     F            CLOANHHF                          KIGNORE                                   CLE073
     F            CLOANZ1F                          KIGNORE                                   CLE073
     FLEHISTLAIF  E           K        DISK                                                   CLE073
     FLEHISTLBIF  E           K        DISK                                                   CLE073
      *
     FLETX1HH UF  E                    DISK         KINFSR *PSSR A
      ** Lending Pay/Receive 1 Header File
     FLETX2HH UF  E                    DISK         KINFSR *PSSR A
      ** Lending Pay/Receive 2 Header File
     FLETX3HH UF  E                    DISK         KINFSR *PSSR A
      ** Lending Pay/Receive 3 Header File
     FLEPXTAA UF  E                    DISK         KINFSR *PSSR A
      ** Pay/Receive Extract Header File
     FLETX1ZZ UF  E                    DISK         KINFSR *PSSR A
      ** Lending Pay/Receive 1 Trailer File
     FLETX2ZZ UF  E                    DISK         KINFSR *PSSR A
      ** Lending Pay/Receive 2 Trailer File
     FLETX3ZZ UF  E                    DISK         KINFSR *PSSR A
      ** Lending Pay/Receive 3 Trailer File
     FLEPXTAC UF  E                    DISK         KINFSR *PSSR A
      ** Pay/Receive Extract Trailer File
      *
     FLETX1PR O   E                    DISK         KINFSR *PSSR
      ** Lending Pay/Receive 1 Detail File
     FLETX2PR O   E                    DISK         KINFSR *PSSR
      ** Lending Pay/Receive 2 Detail File
     FLETX3PR O   E                    DISK         KINFSR *PSSR
      ** Lending Pay/Receive 3 Detail File
     FLEPXTAB O   E                    DISK         KINFSR *PSSR
      ** Pay/Receive Extract Detail File
      *
      *
     FLEPDUFL1IF  E           K        DISK                                                   CLE134
      *                                                                                       CLE134
     FLE1069AUO   E                    PRINTER      KINFDS SPOOLU
      ** Pay/Receive Extract for Fees Printer File
      *
      *
     F/EJECT
     F*****************************************************************
     F*                                                               *
     F*  F U N C T I O N   O F   I N D I C A T O R S                  *
     F*                                                               *
     F*                                                               *
     F*   30  - LOKUP Indicator                                       *
     F*
     F*   70  - Read Indicator (LEFEEDL1)                             *
     F*   71  - Read Indicator (LEFEEAL2)                             *
     F*   72  - Read Indicator (FACHISH )                             *
     F*   73  - Read Indicator (LEFEETL0)                             *
     F*   74  - Read  Indicator Pay/Receive Header/Trailer Files      *
     F*   75  - Read Indicator (LEFEEAL0)                             *
     F*   76  - Read Indicator (LEFEEAL2)                             *
     F*   80  - Read Indicator (SDCURRPD)                             *
     F*                                                               *
     F* 90-99 - Used by Standard Subroutines                          *
     F*                                                               *
     F* U7-U8 - Data Base Error                                       *
     F*    U8 - File Controls out of Balance                          *
     F*                                                               *
     F*****************************************************************
     F/SPACE 3
     F*****************************************************************
     F*                                                               *
     F*  S U B R O U T I N E   I N D E X                              *
     F*                                                               *
     F*  DETAIL - Details for Fees                                    *
     F*  DETLLS - Details for Fee Settlements                         *
     F*  CREATE - Create Message                                      *
     F*  CHKSW  - Check if SWIFT                                      *
     F*  OUTPUT - Output Message to appropriate file                  *
     F*  VALID  - Validation of Instructions                          *
     F*  SRTXDT - Set Telex Notice Date                               *
     F*  CALAMT - Calculate Amounts                                   *
     F*  AMTSR  - Calculate Amount to Accrue                          *
     F*  ACCRUE - Accrue Amount                                       *
     F*  LSTRAT -                                                     *
     F*  HASH   - Maintain Hash Total (1)                             *
     F*  HASHT  - Maintain Hash Total (2)                             *
     F*  GLZADD - Add Amount to the Total                             *
     F*  GLZSUM - Carry Out the Addition for GLZADD                   *
     F*  TRAIL  - Update Header & Trailer Files                       *
     F*  SRNOREC- Set up of totals for new Trailer Record             *
     F*  SRRECD - Set up of Totals for existing Trailer Record        *
     F*  XCAMT  - Convert Amount                                      *
     F*  INIT   -                                                     *
     F*  DBERR  - To perform database error processing                *
     F*  *PSSR  - To Handle Abnormal Error Conditions                 *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     E                    INT         4 15 0             Hash Tot Int.
     E                    DEC         4  3 0             Hash Tot Dec.
     E                    ROP         4  5 0             Numb. of Reco.
     E**********          BRCH       50  3               Branch Codes                         212398
     E**********          BICU       50  6 0             Brch Int. Cust                       212398
     E                    BRCH      900  3               Branch Codes                         212398
     E**********          BICU      900  6 0             Brch Int. Cust                212398 CSD027
     E                    BICU      900  6               Brch Int. Cust                       CSD027
     E**********          CURR      150  3               CCY DETAILS                          262328
     E                    CURR      900  3               CCY DETAILS                          262328
     E**********          MDI       150  1               Mult/Div Ind.                        262328
     E                    MDI       900  1               Mult/Div Ind.                        262328
     E**********          SPRT      150 13 8             Spot Rate                            262328
     E                    SPRT      900 13 8             Spot Rate                            262328
     E**********          NBDP      150  1 0             NB Dec. Places                       262328
     E                    NBDP      900  1 0             NB Dec. Places                       262328
     E**********          TND       150  1 0             Tlx Notice Day                       262328
     E                    TND       900  1 0             Tlx Notice Day                       262328
     E**********          INCY      150  1               IN ccy                        CLE031 262328
     E                    INCY      900  1               IN ccy                               262328
     E                    FAMT        5 11 0A            Fee Lim. Amoun
     E                    FRT         5  7 5A            Fee Lim. Rate
     E                    FAM         5 13 0A            Fee Amounts
     E                    FPC         5  6 3A            Fee Percenta.
     E                    CPY@    1   1 80               COPYRIGHT
     E                    POWER   1   7  7 3             POWER ARRAY
     E                    TABCAL  6   6  1 0 TABCBS  5 0 Calcul. Basis
     E/COPY ZSRSRC,ZHOLE
     E/COPY ZSRSRC,ZDATE9Z1                                               CLE013
      *                                                                                       CLE073
     E/COPY ZSRSRC,ZFREQBZ1                                                                   CLE073
     E/COPY ZSRSRC,ZDATE2Z1                                                                   CLE073
      *                                                                                       CLE073
      *
     I**  Redefine some fields of LF/FCLTYL0 to avoid overlap of values
     I*
     IFCLTYFMF
     I              FAMT                            FYFAMT
     I              FCCY                            FYFCCY
     ILEPDUFD0                                                                                CLE134
      *                                                                                       CLE134
      ** Rename fields                                                                        CLE134
      *                                                                                       CLE134
     I              YTKPACL                         YTKPAC                                    CLE134
     I              YTKPABR                         YTKPAB                                    CLE134
     I              YTKPAAC                         YTKPAA                                    CLE134
     I              YTKPASE                         YTKPAS                                    CLE134
     I              YTKPACY                         YTKPCY                                    CLE134
      *                                                                                       CLE073
     I/COPY WNCPYSRC,LEH00733
     ICLOANCLF                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIL                                     CLE073
     I              FTYP                            FTYPL                                     CLE073
     I              FSEQ                            FSEQL                                     CLE073
     I              CCY                             CCYL                                      CLE073
     I              LNRF                            LNRFL                                     CLE073
     I              PTYP                            PTYPL                                     CLE073
     I              RCDT                            RCDTL                                     CLE073
     I              MRIN                            MRINL                                     CLE073
     I              CNUM                            CNUML                                     CLE073
     I              BRCA                            BRCAL                                     CLE073
     I              LTYP                            LTYPL                                     CLE073
     I              SUTP                            SUTPL                                     CLE073
     I              DDAT                            DDATL                                     CLE073
     I              VDAT                            VDATL                                     CLE073
     I              MDAT                            MDATL                                     CLE073
     I              LASQ                            LASQL                                     CLE073
     I              FCUS                            FCUSL                                     CLE073
     I              CPAM                            CPAML                                     CLE073
     I              INTC                            INTCL                                     CLE073
     I              INTR                            INTRL                                     CLE073
     I              BRTT                            BRTTL                                     CLE073
     I              BRTE                            BRTEL                                     CLE073
     I              RTSP                            RTSPL                                     CLE073
     I              MARG                            MARGL                                     CLE073
     I              SPIN                            SPINL                                     CLE073
     I              CHIN                            CHINL                                     CLE073
     I              WTRT                            WTRTL                                     CLE073
     I              WTIN                            WTINL                                     CLE073
     I              REPT                            REPTL                                     CLE073
     I              RAMT                            RAMTL                                     CLE073
     I              NRPD                            NRPDL                                     CLE073
     I              RFRQ                            RFRQL                                     CLE073
     I              RDYN                            RDYNL                                     CLE073
     I              FCCY                            FCCYL                                     CLE073
     I              LIND                            LINDL                                     CLE073
     I              CRSK                            CRSKL                                     CLE073
     I              ACOF                            ACOFL                                     CLE073
     I              NACD                            NACDL                                     CLE073
     I              RELI                            RELIL                                     CLE073
     I              AUTO                            AUTOL                                     CLE073
     I              PSAM                            PSAML                                     CLE073
     I              BCXR                            BCXRL                                     CLE073
     I              FCXR                            FCXRL                                     CLE073
     I              SDST                            SDSTL                                     CLE073
     I              OSDA                            OSDAL                                     CLE073
     I              TSTN                            TSTNL                                     CLE073
     I              MDST                            MDSTL                                     CLE073
     I              OMDA                            OMDAL                                     CLE073
     I              TMAN                            TMANL                                     CLE073
     I              FACO                            FACOL                                     CLE073
     I              RLDT                            RLDTL                                     CLE073
     I              NROD                            NRODL                                     CLE073
     I              RLFQ                            RLFQL                                     CLE073
     I              RLDY                            RLDYL                                     CLE073
     I              RDFC                            RDFCL                                     CLE073
     I              NBRA                            NBRAL                                     CLE073
     I              NRTS                            NRTSL                                     CLE073
     I              NSIN                            NSINL                                     CLE073
     I              NCAS                            NCASL                                     CLE073
     I              AWTP                            AWTPL                                     CLE073
     I              WTRD                            WTRDL                                     CLE073
     I              WTWD                            WTWDL                                     CLE073
     I              IWOD                            IWODL                                     CLE073
     I              PWOD                            PWODL                                     CLE073
     I              BMDI                            BMDIL                                     CLE073
     I              FMDI                            FMDIL                                     CLE073
     I              PDIN                            PDINL                                     CLE073
     I              LSWC                            LSWCL                                     CLE073
     I              LSWS                            LSWSL                                     CLE073
     I              OSDB                            OSDBL                                     CLE073
     I              OMDB                            OMDBL                                     CLE073
     I              ORBR                            ORBRL                                     CLE073
     I              PRFC                            PRFCL                                     CLE073
     I              FCLB                            FCLBL                                     CLE073
     I              MLNR                            MLNRL                                     CLE073
     I              BTIN                            BTINL                                     CLE073
     I              BLDY                            BLDYL                                     CLE073
     I              OLNO                            OLNOL                                     CLE073
     I              RCSI                            RCSIL                                     CLE073
     I              ICBS                            ICBSL                                     CLE073
     I              IPFR                            IPFRL                                     CLE073
     I              TOTI                            TOTIL                                     CLE073
     I              NIDT                            NIDTL                                     CLE073
     I              IBDT                            IBDTL                                     CLE073
     I              SLID                            SLIDL                                     CLE073
     I              AIPD                            AIPDL                                     CLE073
     I              DLRC                            DLRCL                                     CLE073
     I              IACD                            IACDL                                     CLE073
     I              AITC                            AITCL                                     CLE073
     I              TFEP                            TFEPL                                     CLE073
     I              AIAP                            AIAPL                                     CLE073
     I              IPRD                            IPRDL                                     CLE073
     I              IPRM                            IPRML                                     CLE073
     I              ICTD                            ICTDL                                     CLE073
     I              AIMN                            AIMNL                                     CLE073
     I              RBDT                            RBDTL                                     CLE073
     I              NOPS                            NOPSL                                     CLE073
     I              NCHI                            NCHIL                                     CLE073
     I              IFDY                            IFDYL                                     CLE073
     I              LONI                            LONIL                                     CLE073
     I              CNFI                            CNFIL                                     CLE073
     I              ACEI                            ACEIL                                     CLE073
     I              TLXI                            TLXIL                                     CLE073
     I              CBLI                            CBLIL                                     CLE073
     I              ORED                            OREDL                                     CLE073
     I              LCD                             LCDL                                      CLE073
     I              CHTP                            CHTPL                                     CLE073
     I              TNLU                            TNLUL                                     CLE073
     I              ADDI                            ADDIL                                     CLE073
     I              ORMD                            ORMDL                                     CLE073
     I              ORTI                            ORTIL                                     CLE073
     I              BOKC                            BOKCL                                     CLE073
     I              COCU                            COCUL                                     CLE073
     I              RECE                            RECEL                                     CLE073
     I              OMDT                            OMDTL                                     CLE073
     I              NIPD                            NIPDL                                     CLE073
     I              NMDT                            NMDTL                                     CLE073
     I              APMI                            APMIL                                     CLE073
     I              RSTM                            RSTML                                     CLE073
     I              RONS                            RONSL                                     CLE073
     I              RIBN                            RIBNL                                     CLE073
     I              RIBA                            RIBAL                                     CLE073
     I              ROBN                            ROBNL                                     CLE073
     I              ROCN                            ROCNL                                     CLE073
     I              PSTM                            PSTML                                     CLE073
     I              PONS                            PONSL                                     CLE073
     I              PIBN                            PIBNL                                     CLE073
     I              PIBA                            PIBAL                                     CLE073
     I              POBN                            POBNL                                     CLE073
     I              POCN                            POCNL                                     CLE073
     I              RCRN                            RCRNL                                     CLE073
     I              RCRA                            RCRAL                                     CLE073
     I              RVNO                            RVNOL                                     CLE073
     I              AWBN                            AWBNL                                     CLE073
     I              AWBA                            AWBAL                                     CLE073
     I              BENN                            BENNL                                     CLE073
     I              BENA                            BENAL                                     CLE073
     I              DTP1                            DTP1L                                     CLE073
     I              DTP2                            DTP2L                                     CLE073
     I              DTP3                            DTP3L                                     CLE073
     I              DTP4                            DTP4L                                     CLE073
     I              DCHG                            DCHGL                                     CLE073
     I              BTB1                            BTB1L                                     CLE073
     I              BTB2                            BTB2L                                     CLE073
     I              BTB3                            BTB3L                                     CLE073
     I              BTB4                            BTB4L                                     CLE073
     I              BTB5                            BTB5L                                     CLE073
     I              BTB6                            BTB6L                                     CLE073
     I              CVMR                            CVMRL                                     CLE073
     I              PTFR                            PTFRL                                     CLE073
     I              HLEX                            HLEXL                                     CLE073
     I              FSRP                            FSRPL                                     CLE073
     I              FSGN                            FSGNL                                     CLE073
     I              FPRC                            FPRCL                                     CLE073
     I              TCOF                            TCOFL                                     CLE073
     I              ACPD                            ACPDL                                     CLE073
     I              ACDA                            ACDAL                                     CLE073
     I              ACAJ                            ACAJL                                     CLE073
     I              ACAP                            ACAPL                                     CLE073
     I              COFD                            COFDL                                     CLE073
     I              COFM                            COFML                                     CLE073
     I              CFCD                            CFCDL                                     CLE073
     I              NFRS                            NFRSL                                     CLE073
     I              NFSN                            NFSNL                                     CLE073
     I              NFPC                            NFPCL                                     CLE073
     I              PDCF                            PDCFL                                     CLE073
     I              FCTD                            FCTDL                                     CLE073
     I              FWOD                            FWODL                                     CLE073
     I              DFTP                            DFTPL                                     CLE073
     I              DFST                            DFSTL                                     CLE073
     I              MCRA                            MCRAL                                     CLE073
     I              FCRA                            FCRAL                                     CLE073
     I              PDDI                            PDDIL                                     CLE073
     I              PTDI                            PTDIL                                     CLE073
     I              GDPR                            GDPRL                                     CLE073
     I              GDIN                            GDINL                                     CLE073
     I              LNKS                            LNKSL                                     CLE073
     I              MNSG                            MNSGL                                     CLE073
     I              GASS                            GASSL                                     CLE073
     I              GPRT                            GPRTL                                     CLE073
     I              TOLN                            TOLNL                                     CLE073
     I              LSTS                            LSTSL                                     CLE073
     I              IUSR                            IUSRL                                     CLE073
     I              AUSR                            AUSRL                                     CLE073
     I              XUSR                            XUSRL                                     CLE073
     I              RATF                            RATFL                                     CLE073
     I              CNCF                            CNCFL                                     CLE073
     I              PCRF                            PCRFL                                     CLE073
     I              LPFI                            LPFIL                                     CLE073
     I              PTFC                            PTFCL                                     CLE073
     I              PTFT                            PTFTL                                     CLE073
     I              PTFN                            PTFNL                                     CLE073
     I              PCOB                            PCOBL                                     CLE073
     I              LRLD                            LRLDL                                     CLE073
     I              LMCD                            LMCDL                                     CLE073
     I              SCCY                            SCCYL                                     CLE073
     I              ICCY                            ICCYL                                     CLE073
     I              OINR                            OINRL                                     CLE073
     I              OIDT                            OIDTL                                     CLE073
     I              REPI                            REPIL                                     CLE073
     I              RFDY                            RFDYL                                     CLE073
     I              RFRI                            RFRIL                                     CLE073
     I              RFRT                            RFRTL                                     CLE073
     I              RFAR                            RFARL                                     CLE073
     I              FSYLDC                          LSYLDC                                    CLE073
     I              FSFYLD                          LSFYLD                                    CLE073
     I              FSURPL                          LSURPL                                    CLE073
     I              FSPLAM                          LSPLAM                                    CLE073
     I              FSPLDT                          LSPLDT                                    CLE073
     I              FSYUPL                          LSYUPL                                    CLE073
      *                                                                                       CLE073
     ICLOANCKF                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIK                                     CLE073
     I              LNRF                            LNRFK                                     CLE073
     I              RCDT                            RCDTK                                     CLE073
     I              MRIN                            MRINK                                     CLE073
     I              NAR1                            NAR1K                                     CLE073
     I              NAR2                            NAR2K                                     CLE073
     I              NAR3                            NAR3K                                     CLE073
     I              NAR4                            NAR4K                                     CLE073
     I              OPAM                            OPAMK                                     CLE073
     I              FRBC                            FRBCK                                     CLE073
     I              YPLN                            YPLNK                                     CLE073
     I              YFLN                            YFLNK                                     CLE073
     I              YWLN                            YWLNK                                     CLE073
     I              ABLN                            ABLNK                                     CLE073
     I              YPLC                            YPLCK                                     CLE073
     I              YFLC                            YFLCK                                     CLE073
     I              YWLC                            YWLCK                                     CLE073
     I              ABLC                            ABLCK                                     CLE073
     I              WWLN                            WWLNK                                     CLE073
     I              IWLN                            IWLNK                                     CLE073
     I              PWLN                            PWLNK                                     CLE073
     I              RDST                            RDSTK                                     CLE073
     I              SPI1                            SPI1K                                     CLE073
     I              SPI2                            SPI2K                                     CLE073
     I              SPI3                            SPI3K                                     CLE073
     I              YILN                            YILNK                                     CLE073
     I              ORVD                            ORVDK                                     CLE073
     I              THRN                            THRNK                                     CLE073
     I              NPRAM                           NPRAMK                                    CLE073
     I              NDAM                            NDAMK                                     CLE073
     I              RLBR                            RLBRK                                     CLE073
     I              ORED                            OREDK                                     CLE073
     I              LCD                             LCDK                                      CLE073
     I              CHTP                            CHTPK                                     CLE073
     I              TNLU                            TNLUK                                     CLE073
     I              RRST                            RRSTK                                     CLE073
     I              RRON                            RRONK                                     CLE073
     I              RRIB                            RRIBK                                     CLE073
     I              RRBA                            RRBAK                                     CLE073
     I              RROB                            RROBK                                     CLE073
     I              RROC                            RROCK                                     CLE073
     I              NCCY                            NCCYK                                     CLE073
     I              NCPA                            NCPAK                                     CLE073
     I              NFCE                            NFCEK                                     CLE073
     I              NFMD                            NFMDK                                     CLE073
     I              NLRA                            NLRAK                                     CLE073
     I              RSTS                            RSTSK                                     CLE073
     I              RIUS                            RIUSK                                     CLE073
     I              RAUS                            RAUSK                                     CLE073
     I              RXUS                            RXUSK                                     CLE073
     I              RPCR                            RPCRK                                     CLE073
     I              RLSB                            RLSBK                                     CLE073
     I              RPST                            RPSTK                                     CLE073
     I              RPON                            RPONK                                     CLE073
     I              RPIB                            RPIBK                                     CLE073
     I              RPBA                            RPBAK                                     CLE073
     I              RPOB                            RPOBK                                     CLE073
     I              RPOC                            RPOCK                                     CLE073
     I              RRCR                            RRCRK                                     CLE073
     I              RRCA                            RRCAK                                     CLE073
     I              RRVN                            RRVNK                                     CLE073
     I              RAWB                            RAWBK                                     CLE073
     I              RAWA                            RAWAK                                     CLE073
     I              RBEN                            RBENK                                     CLE073
     I              RBNA                            RBNAK                                     CLE073
     I              RDP1                            RDP1K                                     CLE073
     I              RDP2                            RDP2K                                     CLE073
     I              RDP3                            RDP3K                                     CLE073
     I              RDP4                            RDP4K                                     CLE073
     I              RDCH                            RDCHK                                     CLE073
     I              RBB1                            RBB1K                                     CLE073
     I              RBB2                            RBB2K                                     CLE073
     I              RBB3                            RBB3K                                     CLE073
     I              RBB4                            RBB4K                                     CLE073
     I              RBB5                            RBB5K                                     CLE073
     I              RBB6                            RBB6K                                     CLE073
     I              RCVM                            RCVMK                                     CLE073
     I              NBCE                            NBCEK                                     CLE073
     I              NBMD                            NBMDK                                     CLE073
     I              RRSC                            RRSCK                                     CLE073
     I              RPSC                            RPSCK                                     CLE073
     I              RICY                            RICYK                                     CLE073
     I              ECIN                            ECINK                                     CLE073
     I              RPSM                            RPSMK                                     CLE073
     I              RPOS                            RPOSK                                     CLE073
     I              RPTS                            RPTSK                                     CLE073
     I              RPSB                            RPSBK                                     CLE073
     I              RFAO                            RFAOK                                     CLE073
     I              FSFYLB                          KSFYLB                                    CLE073
      *                                                                                       CLE073
     IHISTSHPF                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIP                                     CLE073
     I              RCDT                            RCDTP                                     CLE073
     I              BRCA                            BRCAP                                     CLE073
     I              CNUM                            CNUMP                                     CLE073
     I              LNRF                            LNRFP                                     CLE073
     I              VDAT                            VDATP                                     CLE073
     I              PRSQ                            PRSQP                                     CLE073
     I              LASN                            LASNP                                     CLE073
     I              CCY                             CCYP                                      CLE073
     I              AMTP                            AMTPP                                     CLE073
     I              PRAM                            PRAMP                                     CLE073
     I              LCD                             LCDP                                      CLE073
     I              CPAM                            CPAMP                                     CLE073
      *                                                                                       CLE073
     IHISTSHMF                                                                                CLE073
      ** Rename fields                                                                        CLE073
     I              RECI                            RECIM                                     CLE073
     I              RCDT                            RCDTM                                     CLE073
     I              BRCA                            BRCAM                                     CLE073
     I              CNUM                            CNUMM                                     CLE073
     I              LNRF                            LNRFM                                     CLE073
     I              VDAT                            VDATM                                     CLE073
     I              PRSQ                            PRSQM                                     CLE073
     I              LASN                            LASNM                                     CLE073
     I              CCY                             CCYM                                      CLE073
     I              AMTP                            AMTPM                                     CLE073
     I              PRAM                            PRAMM                                     CLE073
     I              LCD                             LCDM                                      CLE073
     I              CPAM                            CPAMM                                     CLE073
      *                                                                                       CLE073
     ILESTAL    E DSLESTALPD                                                                  CLE034
      ** External data structures for Settlement Allocation File                              CLE034
      *                                                                                       CLE034
     I              PSTM                            STPSTM                                    CLE034
     I              PONS                            STPONS                                    CLE034
     I              POBN                            STPOBN                                    CLE034
     I              POBR                            STPOBR                                    CLE034
     I              PIBN                            STPIBN                                    CLE034
     I              RSTM                            STRSTM                                    CLE034
     I              RONS                            STRONS                                    CLE034
     I              ROBR                            STROBR                                    CLE034
     I              RIBN                            STRIBN                                    CLE034
     I              REXR                            STREXR                                    CLE034
     I              REXI                            STREXI                                    CLE034
     I              PEXR                            STPEXR                                    CLE034
     I              PEXI                            STPEXI                                    CLE034
     I              PSCY                            STPSCY                                    CLE034
     I              RIBA                            STRIBA                                    CLE034
     I              PIBA                            STPIBA                                    CLE034
     I              ROBN                            STROBN                                    CLE034
     I              ROCN                            STROCN                                    CLE034
     I              POCN                            STPOCN                                    CLE034
     I              CVMR                            STCVMR                                    CLE034
     I              RVNO                            STRVNO                                    CLE034
     I              RCRN                            STRCRN                                    CLE034
     I              RCRA                            STRCRA                                    CLE034
     I              BENN                            STBENN                                    CLE034
     I              BTB1                            STBTB1                                    CLE034
     I              BTB2                            STBTB2                                    CLE034
     I              BTB3                            STBTB3                                    CLE034
     I              BTB4                            STBTB4                                    CLE034
     I              IC72                            STIC72                                    CLE034
     I              SEQ                             STSEQ                                     CLE034
     I              CCY                             STCCY                                     CLE038
      *                                                                   CLE013
     I/COPY ZSRSRC,ZINTDYZ1                                               CLE013
     I/COPY ZSRSRC,ZDATE9Z2                                               CLE013
     I/COPY ZSRSRC,ZDAT10Z1                                               CLE013
      *                                                                                       CLE073
     I/COPY ZSRSRC,ZAOZ2                                                                      CLE073
      *                                                                                       CLE073
     I*
      *
     IACCY        DS                             30                                           CLE141
     I                                        1   3 C1PI                                      CLE141
     I                                        4   6 C2PI                                      CLE141
     I                                        7   9 C3PI                                      CLE141
     I                                       10  12 C4PI                                      CLE141
     I                                       13  15 C5PI                                      CLE141
     I                                       16  18 C6PI                                      CLE141
     I                                       19  21 C7PI                                      CLE141
     I                                       22  24 C8PI                                      CLE141
     I                                       25  27 C9PI                                      CLE141
     I                                       28  30 C0PI                                      CLE141
     IALOC        DS                             30                                           CLE141
     I                                        1   3 L1PI                                      CLE141
     I                                        4   6 L2PI                                      CLE141
     I                                        7   9 L3PI                                      CLE141
     I                                       10  12 L4PI                                      CLE141
     I                                       13  15 L5PI                                      CLE141
     I                                       16  18 L6PI                                      CLE141
     I                                       19  21 L7PI                                      CLE141
     I                                       22  24 L8PI                                      CLE141
     I                                       25  27 L9PI                                      CLE141
     I                                       28  30 L0PI                                      CLE141
      *                                                                                       CLE141
     I            DS
      * Data Structure for FEE Amount
      *
     I                                    P   1  300FAMT
     I                                    P   1   60FEAMT1
     I                                    P   7  120FEAMT2
     I                                    P  13  180FEAMT3
     I                                    P  19  240FEAMT4
     I                                    P  25  300FEAMT5
      *
      *
     I            DS
      * Data Structure for FEE Rate
      *
     I                                    P   1  205FRT
     I                                    P   1   45FEFRT1
     I                                    P   5   85FEFRT2
     I                                    P   9  125FEFRT3
     I                                    P  13  165FEFRT4
     I                                    P  17  205FEFRT5
      *
     I            DS
      * Data Structure for FEE Details
      *
     I                                        1   50FEFACL
     I                                        1   30FACT1
     I                                        4   50FCNO1
      *
      *
      *
     I            DS
      * Data Structure for Calculation type
      *
     I                                        1   2 FECALT
     I                                        1   20WCALT
      *
      *
     ISPOOLU      DS
      **  File Information Data Structure for LE1069AU.
      *
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     IPSDS       SDS
      ** PROGRAM STATUS DATA STRUCTURE - REQUIRED FOR DUMP
     I                                      244 253 JOB
     I                                      254 263 USER
      *
     ILDA       E DSLDA
      * DATABASE ERROR DS
      *
     IRUNDAT    E DSRUNDAT
      * RUNDAT DATA AREA
      *
     ISDBANK    E DSSDBANKPD
      **  EXTERNAL DS FOR BANK DETAILS
      *
     ISDTRAD    E DSSDTRADPD
      **   TRADING DETAILS
     I              QQACCD                          QQACC3                                    CLE073
      *
     ISDBRCH    E DSSDBRCHPD
      * Define Access Object Branch detail
      *
     ISDCURR    E DSSDCURRPD
      ** Currency Details
      *
     ISDMMOD    E DSSDMMODPD
      ** Midas modules details
      *
     ISDCUST    E DSSDCUSTPD
      ***  EXTERNAL DS FOR CUSTOMER DETAILS
      ***  SPLIT UP A/C OFFICER FOR VALIDITY CHECK.
      *
     I              QQDFAC                          QQDFC1                                    CGL029
     I                                        1   1 BB1
      *
     ISDNOST    E DSSDNOSTPD
      **  EXTERNAL DS FOR NOSTRO DETAILS
     I              A7BRCD                          NBRCD
     I              A7ACCD                          WACOD
     I              A7ACSN                          WACSQ
     I              QQACCD                          QQACC1                                    CGL029
      *
     I*
     ISCSARD    E DSSCSARDPD
     I              LCD                             LCDX
     I* SAR FILE DETAILS
     I*
     IDSFDY     E DSDSFDY
      * FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE
      *
     IDSSDY     E DSDSSDY
      * SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE
      *
     I              'LECalcBasis6LeapYear'C         WPARML                                  MD035545
     I              'AutoEndCalcLoanFee'  C         WPARM1                                  MD046370
     I/COPY ZSRSRC,ZHOLI
      *
     C/EJECT
      *
     C*****************************************************************
     C*  MAIN PROCESSING
     C*****************************************************************
      *
     C                     EXSR INIT
      **Perform initial processing
      *
      ** ==== 1- GENERATE FEE AND REVERSAL FEE MESSAGES ========
      *
     C                     READ LEFEEDL1                 70
      ** Read first Fee
      *
     C           *IN70     DOWEQ*OFF
     C           FERECI    ANDNE'D'
     C           FERECI    ANDNE'R'                                                           186066
     C                     READ LEFEEDL1                 70
     C                     ENDDO
      *
     C           *IN70     DOWEQ*OFF
      *                                                                                       CLE134
     C                     MOVE FEAUTO    WFEAUT  1                                           CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    ANDEQ'C'                                                           CLE134
     C                     MOVE 'Y'       WFEAUT                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ** Do while there are Fees within File LEFEEDL1
      *
     C           FELCHD    IFEQ BJRDNB
     C           FEORED    ANDEQBJRDNB
     C           FELCHD    OREQ BJRDNB
     C           FESWRI    ANDNE*BLANKS
      *
     C********** FEAUTO    IFEQ 'Y'                                                           CLE134
     C           WFEAUT    IFEQ 'Y'                                                           CLE134
     C           FECALT    ANDNE*BLANKS
      *                                                                                       CLE073
     C/COPY WNCPYSRC,LEH00734
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'98'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'99'                                                          CLE073
     C           CLE134    OREQ 'Y'                                                           CLE134
     C           FECALT    ANDEQ'90'                                                          CLE134
     C                     EXSR NEWCAL                                                        CLE073
     C                     ELSE                                                               CLE073
      *                                                                                       CLE073
      *
     C********** WFIRST    IFEQ 'Y'                                                           247959
      *                                                                                       CSC042
     C           FECNUM    IFNE SVCNUM                                                        CSC042
     C           FEFACL    ORNE SVFACL                                                        CSC042
     C           *LIKE     DEFN FECNUM    SVCNUM                                              CSC042
     C           *LIKE     DEFN FEFACL    SVFACL                                              CSC042
     C                     MOVE FECNUM    SVCNUM                                              CSC042
     C                     Z-ADDFEFACL    SVFACL                                              CSC042
      *                                                                                       CSC042
     C**********           Z-ADDFACT1     #ACT1                                        247959 CSC042
     C**********           Z-ADDFCNO1     #CNO1                                        247959 CSC042
      * Check if details already output (ie as part of CA)                                    CSC042
     C           KLEFT2    CHAINLEFEETL0             73                                       CSC042
     C           *IN73     IFEQ '1'                                                           CSC042
     C                     CALL 'LE1070'
     C                     PARM           SVCNUM                                              CSC042
     C                     PARM           SVFACL                                              CSC042
     C**********           PARM           FECNUM                                       247959 CSC042
     C**********           PARM           #ACT1   30                                   247959 CSC042
     C**********           PARM           #CNO1   20                                   247959 CSC042
     C**********           MOVE 'N'       WFIRST                                              247959
     C**********           ENDIF                                                              247959
     C                     ENDIF                                                              CSC042
     C                     ENDIF                                                              CSC042
      *                                                                                       CSC042
      ** Update Temporary Fees Actions File (LEFEETPD)
      *
     C                     EXSR CALAMT
     C/COPY WNCPYSRC,LEH00735
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Calculate Amounts
     C                     Z-ADDWFEE      WWAMT  130
      ** Set Work Amount to Work Fee
     C                     ELSE
     C                     Z-ADDFEFAMT    WWAMT
      ** Set Work Amount to Fee Amount
     C                     ENDIF
      *
      ** if fee is allowed to be suspended, add suspended amount                              CLE134
      ** to WWAMT                                                                             CLE134
      *                                                                                       CLE134
     C           CLE134    IFEQ 'Y'                                                           CLE134
     C           FEFSFA    ANDEQ'Y'                                                           CLE134
     C                     ADD  FESFA     WWAMT                                               CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           FEAUTO    IFEQ 'N'
     C                     Z-ADD0         WWAMT
     C                     ENDIF
      *
     C           KLEFEA    CHAINLEFEEAL0             75
     C           *IN75     IFEQ *OFF
     C           FASIGN    IFEQ *BLANK
     C           FASIGN    OREQ '+'
     C                     ADD  FASADJ    WWAMT
     C                     ELSE
     C                     SUB  FASADJ    WWAMT
     C                     ENDIF
     C                     MOVE 'X'       FASWRI
     C                     UPDATLEFEEA0
     C                     ENDIF
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PTFI      IFNE *BLANKS                                                       CLE034
     C                     MOVE 'E'       WRKSTM  1                                           CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'S'       WRKSTM                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADDAGRDNB    PDAY    50                                          CLE034
     C                     MOVE FELOAN    PLNRF   6                                           CLE034
     C                     MOVE FECNUM    PCNUM   6                                           CLE034
     C                     MOVE FEFACL    PFACL   5                                           CLE034
     C                     MOVE FEFSEQ    PFSEQ   2                                           CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR1'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*TXDT  ' POPTN   7                                           CLE034
     C                     PARM           PDAY                                                CLE034
     C                     PARM *ZEROS    PPTYPE                                              CLE034
     C                     PARM           WRKSTM                                              CLE034
     C                     PARM FEFCCY    PTCCY   3                                           CLE034
     C                     PARM 'N'       PNCHK   1                                           CLE034
     C                     PARM 'FEES'    PTYPE   4                                           CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD   5                                           CLE034
     C                     PARM *BLANKS   PLASQ   3                                           CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM *ZEROS    PTNOTD  50                                          CLE034
     C                     PARM *BLANKS   PNOSTR  1                                           CLE034
      *                                                                                       CLE034
     C                     Z-ADDPTNOTD    TXDT                                                CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
      ** Adjust Amount if there is a correspondant record on LEFEEAD
      *
     C                     Z-ADDFESTTL    WSETTL  20
     C                     MOVELFEOURS    WOURS   2
     C                     MOVE FETHER    WTHEIR 10
      ** Set Settlements
     C                     MOVE FEFCCY    WCURR   3
      *
     C           CLE031    IFEQ 'Y'                                       CLE031
     C           PTFI      IFEQ 'P'                                       CLE031
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C           FEPSCY    IFNE FEFCCY                                    CLE031
     C           FEPSCY    ANDNE*BLANKS                                   CLE031
     C                     MOVE FEPSCY    WCURR                           CLE031
     C                     ENDIF                                          CLE031
     C                     ELSE                                           CLE031
     C           FESCCY    IFNE FEFCCY                                    CLE031
     C           FESCCY    ANDNE*BLANKS                                   CLE031
     C                     MOVE FESCCY    WCURR                           CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      ** Set Currency
     C                     EXSR SRTXDT
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Set Telex Notice Date
     C                     Z-ADD0         PAYDAT
      ** Zeroise Payment Date
      *
     C           FEFACL    IFEQ 0                          Loan Fee
     C********** FELOAN    OREQ 0                          Facility Fee                       CLE148
     C           FELOAN    OREQ *BLANKS                                                       CLE148
     C           FECALT    ANDEQ*BLANKS                    Calc. Type
      *
     C           FEPYON    IFEQ *BLANKS
     C           FEPSTD    ANDGEBJRDNB
     C           FEPSTD    ANDLETXDT
     C           FEPYON    OREQ 'S'
     C           FEPSTD    ANDGEBJRDNB
     C           FEPSTD    ANDLETXDT
      ** "Payment on" is Blank or Start, and Start Date is  between
      **  Today and Telex Notice Date
     C                     Z-ADDFEPSTD    PAYDAT
      ** Set Payment Date to Start Date
     C                     ENDIF
      *
      *
     C           FEPYON    IFEQ 'E'
     C           FEPEND    ANDGEBJRDNB
     C           FEPEND    ANDLETXDT
      ** "Payment on" is End and Start Date is between
      **  Today and Telex Notice Date
      *
     C                     Z-ADDFEPEND    PAYDAT
      ** Set Payment Date to End Date
      *
     C                     ENDIF
      *                                                                   CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
     C           FEPYON    ANDEQ'N'                                       CLE031
     C           FENPYD    IFEQ 0                                         CLE031
     C           FEPEND    ANDGEBJRDNB                                    CLE031
     C           FEPEND    ANDLETXDT                                      CLE031
     C                     Z-ADDFEPEND    PAYDAT                          CLE031
     C                     ENDIF                                          CLE031
     C           FENPYD    IFGE BJRDNB                                    CLE031
     C           FENPYD    ANDLETXDT                                      CLE031
     C                     Z-ADDFENPYD    PAYDAT                          CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                                       CAS009
      ** Process repetitive loan fees for "Payment On" indicator = 'N'                        CAS009
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           FEPYON    ANDEQ'N'                                                           CAS009
      *                                                                                       CAS009
     C           FENPYD    IFEQ 0                                                             CAS009
     C           FEPEND    ANDGEBJRDNB                                                        CAS009
     C           FEPEND    ANDLTTXDT                                                          CAS009
     C                     Z-ADDFEPEND    PAYDAT                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           FENPYD    IFGE BJRDNB                                                        CAS009
     C           FENPYD    ANDLTTXDT                                                          CAS009
     C                     Z-ADDFENPYD    PAYDAT                                              CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C                     ENDIF
     C*
     C********** FELOAN    IFEQ 0                                                             CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C           FECALT    ANDNE*BLANKS
      ** Loan Number is zero and Calculation Type is not blank
      *
     C           FELPDT    IFGE BJRDNB
      ** Last Payment Date is same or later than today
     C                     Z-ADDFELPDT    WPAYDT  50
      ** Set Work Payment Date to Last Payment Date
     C                     ELSE
     C                     Z-ADDFENPYD    WPAYDT
      ** Set Work Payment Date to Next Payment Date
     C                     ENDIF
      *
     C           FEPYON    IFEQ 'E'
      ** "Payment On" is End
     C                     Z-ADDFEPEND    WPAYDT
      ** Set Work Payment Date to End Date
     C                     ENDIF
      *
     C           WPAYDT    IFNE 0
     C           WPAYDT    IFLE TXDT
     C                     Z-ADDWPAYDT    PAYDAT  50
     C                     ENDIF
     C                     ELSE
     C           FEPEND    IFLE TXDT
     C                     Z-ADDFEPEND    PAYDAT
     C                     ENDIF
     C                     ENDIF
      ** Set Payment Date
      *
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00736
      *                                                                                       CLE073
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'98'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'99'                                                          CLE073
     C           CLE134    OREQ 'Y'                                                           CLE134
     C           FECALT    ANDEQ'90'                                                          CLE134
      *                                                                                       CLE073
     C           FELPDT    IFGE BJRDNB                                                        CLE073
     C                     Z-ADDFELPDT    WPAYDT  50                                          CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDFENPYD    WPAYDT                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           WPAYDT    IFEQ 0                                                             CLE073
     C                     MOVE FEFREQ    ZFREQ                                               CLE073
     C           FELPDT    IFEQ 0                                                             CLE073
     C                     Z-ADDFEPSTD    ZDAYNO                                              CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDFELPDT    ZDAYNO                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     MOVE FEDYIM    ZMDAY                                               CLE073
     C                     MOVE FEFCCY    ZCCY                                                CLE073
     C                     MOVE *BLANKS   ZLOC                                                CLE073
      *                                                                                       CLE134
     C           CLE134    IFNE 'Y'                                                           CLE134
     C           CLE134    OREQ 'Y'                                                           CLE134
     C           FECALT    ANDNE'90'                                                          CLE134
      *                                                                                       CLE134
     C           CLE141    IFEQ 'Y'                                                           CLE141
     C           FELOAN    ANDNE*BLANKS                                                       CLE141
     C           KLOAN     CHAINCLOAN                79                                       CLE141
     C           *IN79     IFEQ *OFF                                                          CLE141
     C                     EXSR ZFRQB3                                                        CLE141
     C                     MOVELZCCY      CCYLL                                              CLE141A
     C                     MOVELZLOC      LOCLL                                              CLE141A
     C                     MOVEL*BLANKS   PAYIND                                              CLE141
     C                     CALL 'LEZBDYCD'BDCHK                                               CLE141
     C                     MOVELZADJDT    ZDAYNO                                              CLE141
     C                     ELSE                                                               CLE141
     C                     MOVEL'CLOANCL 'DBFILE                                              CLE141
     C                     Z-ADD16        DBASE                                               CLE141
     C                     MOVE *BLANKS   DBKEY                                               CLE141
     C                     MOVELFELOAN    DBKEY                                               CLE141
     C                     MOVE *BLANKS   DBPGM                                               CLE141
     C                     MOVEL'LE1069 ' DBPGM                                               CLE141
     C                     OUT  LDA                                                           CLE141
     C                     EXSR *PSSR                                                         CLE141
     C                     EXSR DBERR                                                         CLE141
     C                     ENDIF                                                              CLE141
     C                     ELSE                                                               CLE141
     C                     EXSR ZFREQB                                                        CLE073
     C                     ENDIF                                                              CLE141
     C           ZZERR@    IFEQ *BLANK                                                        CLE073
     C           ZDAYNO    ANDNE0                                                             CLE073
     C           ZDAYNO    IFGT FEPEND                                                        CLE073
     C                     Z-ADDFEPEND    WPAYDT                                              CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDZDAYNO    WPAYDT                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE134
      ** if type is 90, then set next payment date = next principal                           CLE134
      ** payment date                                                                         CLE134
      *                                                                                       CLE134
     C                     ELSE                                                               CLE134
     C                     Z-ADDNRPDL     WPAYDT                                              CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** if Fee calculation type is 90                                                        CLE134
      *                                                                                       CLE134
     C                     MOVE 'N'       WPDCL   1                                           CLE134
     C           FECALT    IFEQ '90'                                                          CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C           WPAYDT    ANDEQ0                                                             CLE134
     C                     Z-ADD0         WWAMT                                               CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           FECALT    IFEQ '90'                                                          CLE134
     C           CLE134    ANDEQ'Y'                                                           CLE134
     C           WWAMT     ANDNE0                                                             CLE134
     C           FELOAN    SETLLLEPDUFL1                                                      CLE134
     C                     MOVE *OFF      *IN77                                               CLE134
      *                                                                                       CLE134
     C           *IN77     DOWEQ*OFF                                                          CLE134
     C           FELOAN    READELEPDUFL1                 77                                   CLE134
     C           *IN77     IFEQ *OFF                                                          CLE134
     C                     MOVE 'A'       WCLRT                                               CLE134
     C           KLOANP    CHAINCLOAN                79                                       CLE134
     C           *IN79     IFEQ *OFF                                                          CLE134
     C           CPAML     ANDNE*ZERO                                                         CLE134
     C                     MOVE 'Y'       WPDCL                                               CLE134
     C                     MOVE *ON       *IN77                                               CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C                     ENDDO                                                              CLE134
     C                     MOVE 'A'       WCLRT                                               CLE134
     C           KLOAN     CHAINCLOAN                79                                       CLE134
      *                                                                                       CLE134
     C           WPDCL     IFNE 'Y'                                                           CLE134
     C                     Z-ADD*ZEROS    WWAMT                                               CLE134
     C                     ENDIF                                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
     C           WPAYDT    IFNE 0                                                             CLE073
     C           WPAYDT    ANDLETXDT                                                          CLE073
     C                     Z-ADDWPAYDT    PAYDAT                                              CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADD0         PAYDAT                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *
     C                     MOVE 'D'       RECI
     C                     MOVE 'LF'      AMTP
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FESTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PTFI      IFEQ 'P'                                                           CLE034
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'P'       WKPREC  1                                           CLE034
     C                     ELSE                                                               CLE034
     C           PTFI      IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'R'       WKPREC                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           PTFI      IFEQ 'P'                                                           CLE034
     C           PTFI      OREQ *BLANKS                                                       CLE034
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'Y'       WKPROC  1                                           CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WKFLD   1                                           CLE034
     C                     MOVE '*EOF   ' PRTCDE                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WKFLD                                               CLE034
     C                     MOVE '*EOF   ' PRTCDE                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     DOWEQ'Y'                                                           CLE034
     C           PRTCDE    OREQ *BLANKS                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           WKPROC    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** Set Record Identifier and Amendment Type
      *
      ** --------1a) THE FEE HAS BEEN INSERTED  -------------
     C           FESWRI    IFEQ *BLANKS
      *
     C/COPY WNCPYSRC,LEH00737
     C           CLE073    IFEQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'97'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'98'                                                          CLE073
     C           CLE073    OREQ 'Y'                                                           CLE073
     C           FECALT    ANDEQ'99'                                                          CLE073
     C           CLE134    OREQ 'Y'                                                           CLE134
     C           FECALT    ANDEQ'90'                                                          CLE134
      *                                                                                       CLE073
     C           PAYDAT    IFEQ FEPSTD                                                        CLE073
     C           FESPTI    ANDEQ*BLANKS                                                       CLE073
     C           PAYDAT    OREQ FENPYD                                                        CLE073
     C           FEPPTI    ANDEQ*BLANKS                                                       CLE073
     C           PAYDAT    OREQ FEPEND                                                        CLE073
     C           FEEPTI    ANDEQ*BLANKS                                                       CLE073
     C                     EXSR DETAIL                                                        CLE073
     C                     ENDIF                                                              CLE073
     C                     ELSE                                                               CLE073
      *                                                                                       CLE073
     C           FEFACL    IFEQ 0
     C********** FELOAN    OREQ 0                                                             CLE148
     C           FELOAN    OREQ *BLANKS                                                       CLE148
     C           FECALT    ANDEQ*BLANKS
      ** Loan Fee or Non-Calculated Facility Fee
      *
     C           PAYDAT    IFEQ FEPSTD
     C           FESPTI    ANDEQ*BLANKS
      * Pay Date equal Start Date and Start Pay/Rec Telex Ind is blank
     C                     EXSR DETAIL
     C                     ENDIF
      *
     C           PAYDAT    IFEQ FEPEND
     C           FEPYON    ANDEQ'E'
     C           FEEPTI    ANDEQ*BLANKS
      *Pay Date equal End Date and End Pay/Rec Telex Ind is blank
     C                     EXSR DETAIL
     C                     ENDIF
      *                                                                   CLE031
     C           CLE031    IFEQ 'Y'                                       CLE031
     C           FEPYON    ANDEQ'N'                                       CLE031
     C           PAYDAT    IFEQ FENPYD                                    CLE031
     C           FESPTI    ANDEQ*BLANKS                                   CLE031
     C                     EXSR DETAIL                                    CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C           PAYDAT    IFEQ FEPEND                                    CLE031
     C           FEEPTI    ANDEQ*BLANKS                                   CLE031
     C                     EXSR DETAIL                                    CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                                       CAS009
     C           CAS009    IFEQ 'Y'                                                           CAS009
     C           FEPYON    ANDEQ'N'                                                           CAS009
      *                                                                                       CAS009
     C           PAYDAT    IFEQ FENPYD                                                        CAS009
     C           FEPPTI    ANDEQ*BLANKS                                                       CAS009
     C                     EXSR DETAIL                                                        CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           PAYDAT    IFEQ FEPEND                                                        CAS009
     C           FEEPTI    ANDEQ*BLANKS                                                       CAS009
     C                     EXSR DETAIL                                                        CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *
     C                     ENDIF
      *
     C********** FELOAN    IFEQ 0                                                             CLE148
     C           FELOAN    IFEQ *BLANKS                                                       CLE148
     C           FECALT    ANDNE*BLANKS
      ** Calculated Facility Fee
      *
     C           PAYDAT    IFEQ WPAYDT
     C           WPAYDT    ANDNEFEPEND
     C           FEPPTI    ANDEQ*BLANKS
     C                     EXSR DETAIL
     C                     ENDIF
      *
     C           PAYDAT    IFEQ FEPEND
     C           FEEPTI    ANDEQ*BLANKS
     C                     EXSR DETAIL
     C                     ENDIF
      *
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00738
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *
     C                     ENDIF
      *
      ** --- 1b) SWIFT MSG REGEN. INDIC. IS AMEND OR REVERSE -------
     C           FESWRI    IFEQ 'A'
     C           FESWRI    OREQ 'R'
     C                     MOVE 'R'       RECI
     C                     EXSR DETAIL
     C                     ENDIF
      *
      ** --- 1c) SWIFT MSG REGEN. INDIC. IS AMEND OR GENERATE------
     C           FESWRI    IFEQ 'A'
     C           FESWRI    OREQ 'G'
     C                     MOVE 'D'       RECI
     C                     EXSR DETAIL
     C                     ENDIF
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           WKPROC    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           WKPROC    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      ** ----------------------------------------------------------
     C                     ENDIF
     C                     READ LEFEEDL1                 70
      *
     C           *IN70     DOWEQ*OFF
     C           FERECI    ANDNE'D'
     C           FERECI    ANDNE'R'                                                           186066
     C                     READ LEFEEDL1                 70
     C                     ENDDO
      *
     C                     ENDDO
      *
      *
      ** ==== 2- GENERATE FEE SETTLEMENT AND REVERSAL  ========
      ** ====    FEE SETTLEMENT MESSAGES               ========
      *
     C                     READ LEFEEAL2                 71
      ** Read first Fee Settlement
      *
     C           *IN71     DOWEQ*OFF
      ** Do while there are Fees Settlements within File LEFEEAL2
      *
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FASTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PTFI      IFNE *BLANKS                                                       CLE034
     C                     MOVE 'E'       WRKSTM                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'S'       WRKSTM                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADDAGRDNB    PDAY                                                CLE034
     C                     MOVE FALOAN    PLNRF                                               CLE034
     C                     MOVE FAVDAT    PLAVD                                               CLE034
     C                     MOVE FACNUM    PCNUM                                               CLE034
     C                     MOVE FAFACL    PFACL                                               CLE034
     C                     MOVE FAFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR1'                                                    CLE034
     C                     PARM *BLANKS   PRTCD                                               CLE034
     C                     PARM '*TXDT  ' POPTN                                               CLE034
     C                     PARM           PDAY                                                CLE034
     C                     PARM *ZEROS    PPTYPE                                              CLE034
     C                     PARM           WRKSTM                                              CLE034
     C                     PARM FAFCCY    PTCCY                                               CLE034
     C                     PARM 'N'       PNCHK                                               CLE034
     C                     PARM 'FSET'    PTYPE                                               CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM           PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM *ZEROS    PTNOTD                                              CLE034
     C                     PARM *BLANKS   PNOSTR                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADDPTNOTD    TXDT                                                CLE034
     C                     ELSE                                                               CLE034
      *
     C                     Z-ADDFAMETH    WSETTL  20
     C                     MOVELFAOURS    WOURS
     C                     MOVE FATHER    WTHEIR
      ** Set Settlements
     C                     MOVE FAFCCY    WCURR
      *
     C           CLE031    IFEQ 'Y'                                       CLE031
     C           PTFI      IFEQ 'P'                                       CLE031
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C           FAPSCY    IFNE FAFCCY                                    CLE031
     C           FAPSCY    ANDNE*BLANKS                                   CLE031
     C                     MOVE FAPSCY    WCURR                           CLE031
     C                     ENDIF                                          CLE031
     C                     ELSE                                           CLE031
     C           FASCCY    IFNE FAFCCY                                    CLE031
     C           FASCCY    ANDNE*BLANKS                                   CLE031
     C                     MOVE FASCCY    WCURR                           CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      ** Set Currency
     C                     EXSR SRTXDT
     C                     ENDIF                                                              CLE034
      ** Set Telex Notice Date
      *
     C           FAVDAT    IFLE TXDT
      ** Value Date is before or same as Telex notice Date
     C                     Z-ADDFAVDAT    PAYDAT
     C                     MOVE 'D'       RECI
     C                     MOVE 'LS'      AMTP
     C                     Z-ADDFASADJ    WWAMT
      *
     C           FASIGN    IFEQ '-'
     C                     Z-SUBWWAMT     WWAMT
     C                     ENDIF
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           FASTAL    ANDEQ'Y'                                                           CLE034
      *                                                                                       CLE034
     C           PTFI      IFEQ 'P'                                                           CLE034
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
     C                     MOVE 'P'       WKPREC                                              CLE034
     C                     ELSE                                                               CLE034
     C           PTFI      IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'R'       WKPREC                                              CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           PTFI      IFEQ 'P'                                                           CLE034
     C           PTFI      OREQ 'S'                                                           CLE034
     C           PTFI      OREQ 'R'                                                           CLE034
     C           PTFI      OREQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       WKPROC                                              CLE034
     C                     EXSR SR34A                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WKFLD                                               CLE034
     C                     MOVE '*EOF   ' PRTCDE                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE 'Y'       WKFLD                                               CLE034
     C                     MOVE '*EOF   ' PRTCDE                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     DOWEQ'Y'                                                           CLE034
     C           PRTCDE    OREQ *BLANKS                                                       CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           WKPROC    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34B                                                         CLE034
     C                     ENDIF                                                              CLE034
      *
      ** --- 2a) FEE SETTLEMENT HAS BEEN INSERTED --------------------
     C           FASTTI    IFEQ *BLANKS
      ** Fee Settlement has been inserted
      *
     C           FATYPE    IFEQ 'P'
     C           FATYPE    OREQ 'F'
      ** Settlement Type is Partially or Fully Settled
      *
     C           PAYDAT    IFEQ BJRDNB
     C           PTFI      ANDNE'I'
      ** Payment Date is same as Today and Participant Fee Indicator
      ** is not Internal
     C                     EXSR DETLLS
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      *
      ** --- 2b) SWIFT MESSAGE REGENERATION IS AMEND OR REVERSE ----
     C           FASWRI    IFEQ 'A'
     C           FASWRI    OREQ 'R'
     C                     MOVE 'R'       RECI
     C                     EXSR DETLLS
     C                     ENDIF
      *
      ** --- 2c) SWIFT MESSAGE REGERATION IS AMEND -----------
     C           FASWRI    IFEQ 'A'
      ** Swift Msg Regeneration Indicator is Amend
     C                     MOVE 'D'       RECI
     C                     EXSR DETLLS
     C                     ENDIF
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           WKPROC    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34C                                                         CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDDO                                                              CLE034
      *                                                                                       CLE034
     C           CLE034    IFEQ 'Y'                                                           CLE034
     C           WKPROC    ANDEQ'Y'                                                           CLE034
     C                     EXSR SR34E                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
      ** ---------------------------------------------------------
      *
     C                     ENDIF
      *
     C                     READ LEFEEAL2                 71
     C                     ENDDO
      *
      *
     C                     EXSR TRAIL
     C*
     C                     WRITELE1069A1
     C                     WRITELE1069A2
      ** Print the Audit Report
      *
      *
     C                     SETON                         LR
     C                     RETRN
      ** End Program
      *
      *****************************************************************
      *
      *    DETAIL - Details for Fees
      *
      *    CALLED BY: MAIN    - Main Processing
      *    CALLS    : CREATE  - Create Message
      *
      ********************************************************************
      *
     C           DETAIL    BEGSR
      *
      ** Note: Participant Fee Indicator (PTFI) is set to 'P' for
      **       participants and to 'I' for Internal Participant
      *
     C           PTFI      IFEQ 'P'
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
      *
     C                     MOVE 'P'       PAYREC  1
      ** Set Pay/Receive Indicator to Pay
     C                     ENDIF
      *
     C           PTFI      IFEQ *BLANK
      *
     C                     MOVE 'R'       PAYREC
      ** Set Pay/Receive Indicator to Receive
     C                     ENDIF
      *
     C                     MOVE FESCCY    SCCY    3        Settl. CCY
     C                     MOVE FEICCY    ICCY    3        IN CCY
     C**********           Z-ADDFECNUM    CNUM             Cust Nbr                           CSD027
     C                     MOVE FECNUM    CNUM             Cust Nbr                           CSD027
      *
     C           FEFACL    IFEQ 0
     C                     MOVE FELOAN    FCLN
      ** Set Loan/Facility Ref to Loan Ref
     C                     ELSE
     C********             MOVEL'F'       FCLN                                                CLE148
     C                     MOVEL' '       FCLN                                                CLE148
     C                     MOVE FEFACL    FCLN
      ** Set Loan/Facility Ref to Facility Ref
     C                     ENDIF
      *
      *
     C           CEU004    IFEQ 'Y'
     C           FESCCY    IFNE FEFCCY
     C           FESCCY    ANDNE*BLANKS
     C                     MOVE FESCCY    WCURR
     C                     MOVE FEFCCY    CCYSV   3
     C                     Z-ADDWWAMT     AMTSV  150
     C                     ENDIF
     C                     ENDIF
      *
     C           CLE031    IFEQ 'Y'                                       CLE031
     C           PAYREC    IFEQ 'P'                                       CLE031
     C           FEPSCY    IFNE FEFCCY                                    CLE031
     C           FEPSCY    ANDNE*BLANKS                                   CLE031
     C                     MOVE FEPSCY    WCURR                           CLE031
     C                     MOVE FEFCCY    CCYSV   3                       CLE031
     C                     Z-ADDWWAMT     AMTSV  150                      CLE031
     C                     Z-ADDFEPEXR    WEXR   138                      CLE031
     C                     MOVE FEPEXI    WMDIN   1                       CLE031
     C                     ENDIF                                          CLE031
     C                     ELSE                                           CLE031
     C           FESCCY    IFNE FEFCCY                                    CLE031
     C           FESCCY    ANDNE*BLANKS                                   CLE031
     C                     MOVE FESCCY    WCURR                           CLE031
     C                     MOVE FEFCCY    CCYSV   3                       CLE031
     C                     Z-ADDWWAMT     AMTSV  150                      CLE031
     C                     Z-ADDFEREXR    WEXR   138                      CLE031
     C                     MOVE FEREXI    WMDIN   1                       CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C           WWAMT     IFNE *ZERO
     C           PTFI      ANDNE'I'
     C                     EXSR CREATE
     C                     ENDIF
      ** Create Message
      *
     C                     ENDSR
      *****************************************************************
      *
      *    DETLLS - Details for Fees Settlements
      *
      *    CALLED BY: MAIN    - Main Processing
      *    CALLS    : CREATE  - Create Message
      *
      ********************************************************************
      *
     C           DETLLS    BEGSR
      *
      *
     C           PTFI      IFEQ 'P'
     C           PTFI      OREQ 'S'                                                           CLE106
     C           PTFI      OREQ 'R'                                                           CLE106
      *
     C                     MOVE 'P'       PAYREC
      ** Set Pay/Receive Indicator to Pay
     C                     ENDIF
      *
     C           PTFI      IFEQ *BLANK
      *
     C                     MOVE 'R'       PAYREC
      ** Set Pay/Receive Indicator to Receive
     C                     ENDIF
      *
     C                     MOVE FASCCY    SCCY             Settl. CCY
     C                     MOVE FAICCY    ICCY             IN CCY
     C**********           Z-ADDFACNUM    CNUM             Cust Nbr                           CSD027
     C                     MOVE FACNUM    CNUM             Cust Nbr                           CSD027
      *
     C           FAFACL    IFEQ 0
     C                     MOVE FALOAN    FCLN
      ** Set Loan/Facility Ref to Loan Ref
     C                     ELSE
     C********             MOVEL'F'       FCLN                                                CLE148
     C                     MOVEL' '       FCLN                                                CLE148
     C                     MOVE FAFACL    FCLN
      ** Set Loan/Facility Ref to Facility Ref
     C                     ENDIF
      *
      *
     C           CEU004    IFEQ 'Y'
     C           FASCCY    IFNE FEFCCY
     C           FASCCY    ANDNE*BLANKS
     C                     MOVE FASCCY    WCURR
     C                     MOVE FAFCCY    CCYSV
     C                     Z-ADDWWAMT     AMTSV
     C                     ENDIF
     C                     ENDIF
      *
     C           CLE031    IFEQ 'Y'                                       CLE031
     C           PAYREC    IFEQ 'P'                                       CLE031
     C           FAPSCY    IFNE FEFCCY                                    CLE031
     C           FAPSCY    ANDNE*BLANKS                                   CLE031
     C                     MOVE FAPSCY    WCURR                           CLE031
     C                     MOVE FAFCCY    CCYSV   3                       CLE031
     C                     Z-ADDWWAMT     AMTSV  150                      CLE031
     C                     Z-ADDFAPEXR    WEXR   138                      CLE031
     C                     MOVE FAPEXI    WMDIN   1                       CLE031
     C                     ENDIF                                          CLE031
     C                     ELSE                                           CLE031
     C           FASCCY    IFNE FEFCCY                                    CLE031
     C           FASCCY    ANDNE*BLANKS                                   CLE031
     C                     MOVE FASCCY    WCURR                           CLE031
     C                     MOVE FAFCCY    CCYSV   3                       CLE031
     C                     Z-ADDWWAMT     AMTSV  150                      CLE031
     C                     Z-ADDFAREXR    WEXR   138                      CLE031
     C                     MOVE FAREXI    WMDIN   1                       CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                   CLE031
     C                     EXSR CREATE
      ** Create Message
      *
     C                     ENDSR
      *****************************************************************
      *
      *    CREATE - Create Message
      *
      *    CALLED BY: DETAIL  - Detail for Fees
      *             : DETTLS  - Detail for Fee Settlements
      *    CALLS    : OUTPUT  - Output Message to appropriate File
      *             : HASH    - Maintain Hash Total
      *             : VALID   - Validation of Instruction
      *             : CHKSW   - Check if SWIFT
      ********************************************************************
      *
     C           CREATE    BEGSR
      *
     C           WSETTL    IFEQ 1
     C           WSETTL    OREQ 2
     C           WSETTL    OREQ 7
     C           WSETTL    OREQ 8
     C           WSETTL    OREQ 12
      ** Method = Telex, Cheque to be sent, CHIPS, SWIFT, or Cheque to
      **          be Collected
      *
     C           WOURS     IFEQ *BLANKS
      *
     C           AMTP      IFEQ 'LF'
      ** Amendment Type is Fee
      *
     C                     MOVE FEBRCA    OSBR
     C                     ELSE
     C                     MOVE FABRCA    OSBR
     C                     ENDIF
      *
     C                     ELSE
      *
     C           AMTP      IFEQ 'LF'
     C                     MOVE FEOSBR    OSBR
     C                     ELSE
     C                     MOVE FAOSBR    OSBR
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           WSETTL    IFEQ 8
     C           WSETTL    OREQ 1                                                             186066
     C           FELCHT    ANDEQ'A'                                                           186066
     C           RECI      ANDEQ'R'                                                           186066
     C           WSETTL    OREQ 1                                                             186066
     C           FELCHT    ANDEQ'X'                                                           186066
     C           RECI      ANDEQ'R'                                                           186066
      ** SWIFT Method
     C                     EXSR CHKSW
     C           SWIFT     IFEQ 'Y'
     C                     MOVE 'S'       MSGTYP  1
     C                     Z-ADD4         X
      *
     C           S01518    IFEQ 'Y'
      ** Lending SWIFT Switchable Feature is Active
      *
     C           CVMI      DOUNE'P'
     C                     EXSR OUTPUT
     C                     EXSR HASH
     C                     ENDDO
     C                     MOVE *BLANKS   CVMI
      *
     C                     ELSE
     C                     EXSR OUTPUT
     C                     EXSR HASH
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** Note: only have to handle reversals for SWIFT
      *
     C           WSETTL    IFEQ 8
     C           SWIFT     ANDNE'Y'
     C           WSETTL    OREQ 7
      ** SWIFT Method and CHIPS Method
      *
     C           RECI      IFNE 'R'
     C                     EXSR VALID
      *
     C           WCOMP     IFEQ 'Y'
     C                     MOVE 'C'       MSGTYP
     C                     Z-ADD1         X
     C                     EXSR OUTPUT
     C                     EXSR HASH
      *
     C                     ELSE
     C                     MOVE 'I'       MSGTYP
     C                     Z-ADD2         X
     C                     EXSR OUTPUT
     C                     EXSR HASH
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C           WSETTL    IFEQ 1
      ** Telex Method
      *
     C           RECI      IFNE 'R'
     C           BLLCTB    ANDEQ'B'                        Telex/Bank
     C           WCURR     ANDEQBJLCCY                     Lcl CCy
     C                     MOVE 'B'       MSGTYP
     C                     Z-ADD3         X
     C                     EXSR OUTPUT
     C                     EXSR HASH
      *
     C                     ELSE
     C**********           EXSR CHKSW                                                         186066
      *
     C********** SWIFT     IFEQ 'Y'                                                           186066
     C**********           MOVE 'S'       MSGTYP                                              186066
     C**********           Z-ADD4         X                                                   186066
     C**********           EXSR OUTPUT                                                        186066
     C**********           EXSR HASH                                                          186066
      *
     C**********           ELSE                                                               186066
      *
     C           RECI      IFNE 'R'
     C                     EXSR VALID
      *
     C           WCOMP     IFEQ 'Y'
     C                     MOVE 'C'       MSGTYP
     C                     Z-ADD1         X
     C                     EXSR OUTPUT
     C                     EXSR HASH
     C                     ELSE
     C                     MOVE 'I'       MSGTYP
     C                     Z-ADD2         X
     C                     EXSR OUTPUT
     C                     EXSR HASH
     C                     ENDIF
      *
     C                     ENDIF
      *
     C**********           ENDIF                                                              186066
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      *
     C           WSETTL    IFEQ 2
     C           WSETTL    OREQ 12
      ** Cheque to be sent or Cheque to be collected
      *
     C           RECI      IFNE 'R'
     C                     MOVE 'B'       MSGTYP
     C                     Z-ADD3         X
     C                     EXSR OUTPUT
     C                     EXSR HASH
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDSR
     C*
      *****************************************************************
      *
      *    CHKSW  - Check if SWIFT
      *
      *    CALLED BY: CREATE  - Create message
      *    CALLS    :
      ********************************************************************
      *
     C           CHKSW     BEGSR
      *
     C                     MOVE *BLANKS   SWIFT   1
     C                     MOVE *BLANKS   TELEX   1
      *
     C           WOURS     IFNE *BLANKS
      *
     C                     MOVE WOURS     KNONB
     C                     MOVE WCURR     KCCY
     C                     MOVE *BLANKS   KCNUM
     C                     CALL 'AONOSTR0'PLIST1
      *
     C           @RTCD     IFNE *BLANKS                    **************
     C                     Z-ADD1         DBASE            * DBERR 1   **
     C                     MOVE 'SDNOSTPD'DBFILE           **************
     C                     MOVE *BLANKS   DBKEY
     C                     MOVELWOURS     DBKEY
     C                     MOVE KCCY      DBKEY
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LE1069'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     EXSR DBERR
     C                     END
      *
     C**********           MOVELA7NOSN    KEYC1                                               200022
     C                     MOVELA7CUST    KEYC1                                               200022
     C                     CALL 'AOCUSTR0'
     C                     PARM '*BLANKS' @RTCD   7
     C                     PARM '*KEY   ' WOPTN   7
     C                     PARM           KEYC1  10
     C                     PARM *BLANKS   KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
      ** Call Nostro Details Access Object
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C**********           MOVELA7NOSN    DBKEY            ***************                    200022
     C                     MOVELA7CUST    DBKEY            ***************                    200022
     C                     Z-ADD2         DBASE            * DBERR 2     *
     C                     MOVEL'SDCUSTPD'DBFILE           ***************
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LE1069'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     EXSR DBERR
     C                     END
      *
     C           BGMSDL    IFEQ 'Y'
      ** Generate Swift Direct Link Module is On
     C           BBGSFM    IFEQ 'Y'
      ** Generate Swift Message Format is Yes
     C                     MOVE 'Y'       SWIFT
     C                     ENDIF
      *
     C                     ELSE
      *
     C           BBCSID    IFEQ 'Y'
      ** Generate Swift Message Format is Yes
     C                     MOVE 'Y'       SWIFT
     C                     ENDIF
     C                     ENDIF
      *
      *
     C           BBCMTI    IFEQ 'Y'
      ** Customer Module Telex
     C                     MOVE 'Y'       TELEX
     C                     ENDIF
      *
     C           SWIFT     IFEQ 'Y'
     C           TELEX     ANDEQ'Y'
      *
     C           BLSWPY    IFGT BLTXPY
      ** Swift Confirmation Priority is greater than Telex confirmation
      ** Priority
     C                     MOVE *BLANKS   SWIFT
     C                     MOVE 'Y'       TELEX
      *
     C                     ELSE
      *
     C           BLSWPY    IFLT BLTXPY
      ** Swift Confirmation Priority is less than Telex confirmation
      ** Priority
     C                     MOVE *BLANKS   TELEX
     C                     MOVE 'Y'       SWIFT
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      *
     C********** WSETTL    IFEQ 1                                                             186066
      ***Telex*Method**************************************************                       186066
     C**********           MOVE *BLANKS   SWIFT                                               186066
     C**********           ENDIF                                                              186066
      *
     C                     ENDIF
      *
     C                     ENDSR
     C*
      *****************************************************************
      *
      *    OUTPUT - Output Message to appropriate file
      *
      *    CALLED BY: CREATE  - Create message
      *    CALLS    : XCAMT   - Convert amount
      ********************************************************************
      *
     C           OUTPUT    BEGSR
      *
     C           CEU004    IFEQ 'Y'
      ** LE Settlement Ccy Conversion switchable feature CEU004 is ON
     C                     Z-ADD0         OTAM
     C                     MOVE *BLANKS   OTCY
     C                     ENDIF
      *
     C                     Z-ADDPAYDAT    VDAT
     C                     MOVE 'F'       RCDT
     C                     MOVE FCLN      LNRFA
      ** Set Value Date, Record Type, Loan/Facility Ref Number
      *
     C           CEU004    IFEQ 'Y'
     C           CLE031    OREQ 'Y'                                       CLE031
      ** LE Settlement Ccy Conversion switchable feature CEU004 is ON
      *
     C***********SCCY      IFNE CCYSV                                     CLE031
     C           CEU004    IFEQ 'Y'                                       CLE031
     C           SCCY      ANDNECCYSV                                     CLE031
     C           SCCY      ANDNE*BLANKS
     C           CLE031    OREQ 'Y'                                       CLE031
     C           WCURR     ANDNECCYSV                                     CLE031
     C           WCURR     ANDNE*BLANKS                                   CLE031
     C                     Z-ADDWWAMT     FRAM
     C                     MOVE CCYSV     FRCY
     C                     MOVE SCCY      TOCY
     C                     EXSR XCAMT
     C           CLE031    IFEQ 'N'                                       CLE031
     C           CLE031    OREQ 'Y'                                       CLE031
     C           FCCYIN    ANDEQ'Y'                                       CLE031
     C           CLE031    OREQ 'Y'                                       CLE031
     C           TCCYIN    ANDEQ'Y'                                       CLE031
     C                     Z-ADDOUTA      WWAMT
     C                     ENDIF                                          CLE031
     C                     ENDIF
      *
      ** For Payments, populate the other amount/Currency fields
      ** according to wheter the 'IN' Ccy is equal to the
      ** transaction Currency.
     C           PAYREC    IFEQ 'P'
      *
     C           ICCY      IFNE *BLANKS
      *
     C           ICCY      IFEQ CCYSV
     C                     Z-ADDAMTSV     OTAM
     C                     MOVE CCYSV     OTCY
      *
     C                     ELSE
     C                     Z-ADDAMTSV     FRAM
     C                     MOVE CCYSV     FRCY
     C                     MOVE ICCY      TOCY
     C                     EXSR XCAMT
     C                     Z-ADDOUTA      OTAM
     C                     MOVE ICCY      OTCY
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      *
     C           AMTP      IFEQ 'LF'
      ** Amendment Type is Fee
     C                     Z-ADDFEFSEQ    LASNS
      *
     C                     ELSE
     C                     Z-ADDFAFSEQ    LASNS
      ** from the Fee Settlement
     C                     ENDIF
      *
     C                     Z-ADDLASNS     LASN
      ** Set Last Sequence Number
      *
     C           S01518    IFEQ 'Y'
      ** Lending Swift Switchable Feature is active
      ** Store Fee customer no.                                                               230521
      *                                                                                       230521
     C**********           Z-ADDCNUM      LFCN                                         230521 CSD027
     C                     MOVE CNUM      LFCN                                                CSD027
      *
     C           WSETTL    IFEQ 1
     C           WSETTL    OREQ 8
      ** Telex Method or Swift
      *
     C           PAYREC    IFNE 'R'
     C*
     C** If beneficiary is a bank, 'CNUM' is ordering bank, otherwise
     C** ordering customer
     C********** POBN      IFNE 0                                                             CSD027
     C**********           Z-ADDPOBN      CNUM                                                CSD027
     C           POBN      IFNE *BLANKS                                                       CSD027
     C                     MOVE POBN      CNUM                                                CSD027
     C*
     C                     ELSE
     C********** POCN      IFNE 0                                                             CSD027
     C**********           Z-ADDPOCN      CNUM                                                CSD027
     C           POCN      IFNE *BLANKS                                                       CSD027
     C                     MOVE POCN      CNUM                                                CSD027
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C           PAYREC    IFEQ 'R'
     C** If beneficiary is a bank, 'CNUM' is ordering bank, otherwise
     C** ordering customer
     C*
     C********** ROBN      IFNE 0                                                             CSD027
     C**********           Z-ADDROBN      CNUM                                                CSD027
     C           ROBN      IFNE *BLANKS                                                       CSD027
     C                     MOVE ROBN      CNUM                                                CSD027
     C                     ELSE
     C********** ROCN      IFNE 0                                                             CSD027
     C**********           Z-ADDROCN      CNUM                                                CSD027
     C           ROCN      IFNE *BLANKS                                                       CSD027
     C                     MOVE ROCN      CNUM                                                CSD027
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C** If MT202 part of MT100 / supplementary MT202 message being
     C** produced, set up details as below
     C*
     C           CVMI      IFEQ 'P'
     C           CVMR      ANDEQ'Y'
     C           PAYREC    ANDEQ'R'
     C                     MOVE RVNO      FACO
     C                     MOVE RCRN      WTHEIR
     C                     MOVE PONS      WOURS
     C                     MOVE 'S'       CVMI
     C                     END
     C*
     C** If MT100 part of MT100 / supplementary MT202 message being
     C** produced, set up details as below
     C*
     C           CVMI      IFEQ ' '
     C           CVMR      ANDEQ'Y'
     C           PAYREC    ANDNE'R'
     C                     MOVE RVNO      WOURS
     C                     MOVE 'P'       CVMI
     C                     ENDIF
      *
     C                     ENDIF
     C                     ENDIF
      *
     C           AMTP      IFEQ 'LF'                                                        MD055001
      ** Amendment Type is Fee                                                              MD055001
     C                     MOVE FEBRCA    WBRCA   3
      *                                                                                     MD055001
     C                     ELSE                                                             MD055001
     C                     MOVE FABRCA    WBRCA   3                                         MD055001
      ** from the Fee Settlement                                                            MD055001
     C                     ENDIF                                                            MD055001
      *
     C           BJSBRC    IFEQ *BLANKS
      *
     C**********           Z-ADD1         Z       20                                          212398
     C                     Z-ADD1         Z       30                                          212398
     C           WBRCA     LOKUPBRCH,Z                   30
     C           *IN30     IFEQ *OFF
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'Branch'  DBKEY
     C                     MOVE WBRCA     DBKEY            ************
     C                     Z-ADD3         DBASE            * DBERR 03
     C                     MOVE 'LEFEED'  DBFILE           ************
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LE1069'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     EXSR DBERR
     C                     ENDIF
      *
     C                     MOVE BICU,Z    BICN
     C                     ENDIF
      *
     C                     MOVE PAYREC    PYRC
     C                     MOVE WSETTL    SETP
     C                     MOVE WCURR     CCY
     C                     MOVELWOURS     OSAC
     C                     MOVE WTHEIR    TSEN
     C                     Z-ADDWWAMT     EAMT
     C                     MOVE WBRCA     BRCA
     C                     Z-ADDFEFSEQ    FEESEQ
     C                     MOVE BBCSID    CSID
      *
      *
     C           MSGTYP    IFEQ 'S'                        : Swift
     C                     WRITELEPXTABF
     C                     ENDIF
      *
     C           MSGTYP    IFEQ 'C'                        : Complete
     C                     WRITELETX1PRF
     C                     ENDIF
      *
     C           MSGTYP    IFEQ 'I'                        : Incomplete
     C                     WRITELETX2PRF
     C                     ENDIF
      *
     C           MSGTYP    IFEQ 'B'                        : Bankers
     C                     WRITELETX3PRF
     C                     ENDIF
      *
     C                     ENDSR
     C*
      *****************************************************************
      *
      *    VALID  - Validation of Instructions
      *
      *    CALLED BY: CREATE  - Create message
      *    CALLS    :
      ********************************************************************
      *
     C           VALID     BEGSR
      *
     C           WOURS     IFNE *BLANKS
      *
     C                     MOVE WOURS     KNONB
     C                     MOVE WCURR     KCCY
     C                     MOVE *BLANKS   KCNUM
     C                     CALL 'AONOSTR0'PLIST1
      ** Call Nostro Details Access Object
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C                     MOVELWOURS     DBKEY
     C                     MOVE WCURR     DBKEY            ************
     C                     Z-ADD4         DBASE            * DBERR 04
     C                     MOVEL'SDNOSTPD'DBFILE           ************
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LE1069'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     EXSR DBERR
     C                     ENDIF
      *
     C           WTHEIR    IFNE *BLANKS
     C                     MOVE 'Y'       WCOMP   1
      ** If Their Settlement is a customer number, that is a 6 digits
      ** Number
     C           PAYREC    IFEQ 'P'
     C           WTHEIR    IFEQ A7NOSN
     C                     MOVE 'C'       PAYREC
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *    SRTXDT - Set Telex Notice Date
      *
      *    CALLED BY: MAIN  - Main Processing
      *    CALLS    : ZFWDT -
      ********************************************************************
      *
     C           SRTXDT    BEGSR
      *
     C                     MOVE WCURR     ZCCY
     C                     Z-ADDBJRDNB    ZDAYNO
      *
     C           WCURR     LOKUPCURR,X                   69
     C                     MOVE *OFF      *IN69
     C                     MOVE TND,X     ZNRDYS
      *
     C           WSETTL    IFEQ 1
     C           WSETTL    OREQ 2
     C           WSETTL    OREQ 7
     C           WSETTL    OREQ 8
     C           WSETTL    OREQ 12
      ** Method = Telex, Cheque to be sent, CHIPS, SWIFT, or Cheque to
      **          Collected
      *
     C                     MOVE WOURS     KNONB
     C                     MOVE WCURR     KCCY
     C                     MOVE *BLANKS   KCNUM
     C                     CALL 'AONOSTR0'PLIST1
      ** Call Nostro Details Access Object
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C                     MOVELWOURS     DBKEY
     C                     MOVE WCURR     DBKEY            ************
     C                     Z-ADD5         DBASE            * DBERR 05
     C                     MOVEL'SDNOSTPD'DBFILE           ************
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LE1069'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     EXSR DBERR
     C                     ENDIF
      *
     C                     MOVE A7NOSN    ZLOC
      *
     C                     ELSE
     C                     MOVE *BLANKS   ZLOC
     C                     ENDIF
      *
     C                     EXSR ZFWDT
      ** Calculate Number of days forward
      *
     C                     Z-ADDZDYNBR    TXDT    50
      ** Set Telex Notice Date
      *
     C                     ENDSR
      *
     C/TITLE SR/ZFWDT
     C/COPY ZSRSRC,ZFWDT
      * Calculate Working day Forward
     C/TITLE SR/ZACCH
     C/COPY ZSRSRC,ZACCH
      * Access a record from the holiday file
      *****************************************************************
      *
      *    CALAMT - Calculate Amounts
      *
      *    CALLED BY: MAIN   - Main processing
      *    CALLS    : AMTSR  - Calculate Amount to Accrue
      *               ACCRUE - Accrue Amount
      ********************************************************************
      *
     C           CALAMT    BEGSR
      *
     C           KFACH     CHAINFACHISH              72
      *
     C           *IN72     IFEQ *ON
     C           FEORED    IFEQ BJRDNB
      * If the facility has been input today,no database error
     C           KFCLTY    CHAINFCLTY                72
     C                     Z-ADDFYFAMT    FHOFAM
     C                     MOVE FYFCCY    FHFCCY
     C                     ENDIF
     C           *IN72     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     MOVEL'FACHISF 'DBFILE           ************
     C                     Z-ADD6         DBASE            * DBERR 06 *
     C                     MOVE *BLANKS   DBKEY            ************
     C                     MOVELFECNUM    DBKEY
     C                     MOVE FEFACL    DBKEY
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LE1069 ' DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     EXSR DBERR
     C                     ENDIF
     C                     ENDIF
      *
     C                     Z-ADD0         WAMT   130
     C                     Z-ADD0         WPCT    63
     C                     Z-ADD0         WFEE   130
      *
     C                     Z-ADDFELPDT    STDATE  50
     C           STDATE    IFEQ 0
     C                     Z-ADDFEPSTD    STDATE
     C                     ENDIF
      *
     C                     Z-ADDFENPYD    ENDATE  50
     C           ENDATE    IFEQ 0
     C                     Z-ADDFEPEND    ENDATE
     C                     ENDIF
     C           FEPEND    IFLT BJDNWD                     Nxt Wrk Day
     C                     Z-ADDFEPEND    ENDATE
     C                     ENDIF
      *
     C           FECALT    IFEQ '04'
     C           FECALT    OREQ '05'
     C           FECALT    OREQ '06'
     C           FECALT    OREQ '14'
     C           FECALT    OREQ '15'
     C           FECALT    OREQ '16'
     C           FECALT    OREQ '22'
     C                     MOVE 'C'       WKTYPE  1
      *
     C                     ELSE
     C                     MOVE *BLANK    WKTYPE  1
     C***********ENDATE    SUB  STDATE    WDAYS   50                      CLE013
     C                     Z-ADDSTDATE    ZZBEG                           CLE013
     C                     Z-ADDENDATE    ZZEND                           CLE013
     C                     MOVE FECALC    ZZCALC                          CLE013
     C                     EXSR ZINTDY                                    CLE013
     C           FECALC    IFEQ 6                                                             212048
     C                     Z-ADDINT6DY    WDAYS                                               212048
     C                     ELSE                                                               212048
     C**********           Z-ADDZZINDY    WDAYS   50                                 CLE013 MD037658
     C                     Z-ADDZZINDY    WDAYS  159                                        MD037658
     C                     END                                                                212048
     C                     ENDIF
      *
     C           KLEFT1    SETGTLEFEETL0
     C                     READPLEFEETL0                 73
      ** Read the last Record for the Start Date on Temporary Activity
      ** File for Fees
      *
     C                     Z-ADDFCCFAM    WKCFAM 130
      *
     C                     EXSR AMTSR
      *
     C           *IN73     DOWEQ*OFF
     C           KLEFT2    READELEFEETL0                 73
     C           FCADAT    IFGT ENDATE
     C           *IN73     OREQ *ON
     C                     Z-ADDENDATE    FCADAT
     C                     MOVE *ON       *IN73
     C                     ENDIF
      *
     C***********FCADAT    SUB  STDATE    NDAYS   50                      CLE013
     C                     Z-ADDSTDATE    ZZBEG                           CLE013
     C                     Z-ADDFCADAT    ZZEND                           CLE013
     C                     MOVE FECALC    ZZCALC                          CLE013
     C                     EXSR ZINTDY                                    CLE013
     C           FECALC    IFEQ 6                                                             212048
     C                     Z-ADDINT6DY    NDAYS                                               212048
     C                     ELSE                                                               212048
     C**********           Z-ADDZZINDY    NDAYS   50                                 CLE013 MD037658
     C                     Z-ADDZZINDY    NDAYS  159                                        MD037658
     C                     END                                                                212048
      *
     C           NDAYS     IFGT 0
      *
     C           WKTYPE    IFNE 'C'
     C                     MULT NDAYS     AAMT   150
     C                     DIV  WDAYS     AAMT      H
     C                     ADD  AAMT      WAMT
     C                     Z-ADDFCADAT    STDATE
     C                     ELSE
     C                     Z-ADDNDAYS     WDAYS
     C                     Z-ADDAAMT      WAMT
     C                     EXSR ACCRUE
     C                     ADD  WTOT      WFEE   130
     C                     Z-ADDFCADAT    STDATE
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     Z-ADDFCCFAM    WKCFAM
      *
     C                     EXSR AMTSR
     C                     ENDDO
      *
     C           WKTYPE    IFNE 'C'
     C                     EXSR ACCRUE
     C                     Z-ADDWTOT      WFEE
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *    AMTSR  - Calculate Amount to Accrue
      *
      *    CALLED BY: CALAMT - Calculate Amounts
      *    CALLS    :
      ********************************************************************
      *
     C           AMTSR     BEGSR
      *
     C           WCALT     IFLE 6
      ** Calculation Type for Available Amount
      *
     C           FCUNDR    IFGE 0
     C                     Z-ADDFCUNDR    AAMT
     C                     ELSE
     C                     Z-ADD0         AAMT
     C                     ENDIF
      *
     C                     ELSE
     C           WCALT     IFLE 16
      ** Calculation Type for Outstanding Amount
     C                     Z-ADDFCDRAM    AAMT
     C                     ELSE
     C           WCALT     IFLE 22
      ** Calculation Type for Facility Amount
     C                     Z-ADDFCCFAM    AAMT
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *    ACCRUE - Accrue Amount
      *
      *    CALLED BY: CALAMT - Calculate Amounts
      *    CALLS    : ZXRATE - Access Holidays for Currency/Location
      *               LSTRAT
      *               ZCONV  - Convert Amount to another currency
      ********************************************************************
      *
     C           ACCRUE    BEGSR
      *
     C                     Z-ADD0         WTOT
     C                     Z-ADD1         N
     C           FEFCCY    LOKUPCURR,N                   30
     C           NBDP,N    ADD  4         WTD     10
      ** Set Fee Number of Decimal Places
      *
      *
     C           FEPIND    IFNE 'A'
      *
     C           WKTYPE    IFNE 'C'
     C           FHOFAM    IFGT 0                                                             246018
     C           WAMT      DIV  FHOFAM    WRK155 155H
     C           WRK155    MULT 100       WPCT
     C                     ELSE                                                               246018
     C                     Z-ADD0         WRK155                                              246018
     C                     Z-ADD0         WPCT                                                246018
     C                     ENDIF                                                              246018
     C                     Z-ADDFHOFAM    WAMT
     C                     ELSE
     C           WKCFAM    IFGT 0                                                           MD029653
     C           WAMT      DIV  WKCFAM    WRK155    H
     C           WRK155    MULT 100       WPCT
     C                     ELSE                                                             MD029653
     C                     Z-ADD0         WRK155                                            MD029653
     C                     Z-ADD0         WPCT                                              MD029653
     C                     ENDIF                                                            MD029653
     C                     Z-ADDWKCFAM    WAMT
     C                     ENDIF
      *
     C           WPCT      IFGT 100
     C                     Z-ADD100       WPCT
     C                     ENDIF
     C                     ENDIF
      *
     C           FHFCCY    IFNE FEFCCY
      * Convert from Facility to fee Currency
     C                     Z-ADDWAMT      CAMT   130
     C           FEERAT    IFEQ 0
      ** Need to obtain cross-currency exchange rate for these two
      ** currencies from the standing data files.
     C                     MOVE FHFCCY    INCCY   3
     C                     MOVE FEFCCY    OUTCCY  3
      *
     C                     Z-ADD1         N       30
     C           INCCY     LOKUPCURR,N                   30
     C                     Z-ADDNBDP,N    ZNBDP1  10
     C                     MOVE MDI,N     ZMDI1   1
     C                     Z-ADDSPRT,N    ZRATE1 138
      *
     C                     Z-ADD1         N
     C           OUTCCY    LOKUPCURR,N                   30
     C                     Z-ADDNBDP,N    ZNBDP2  10
     C                     MOVE MDI,N     ZMDI2   1
     C                     Z-ADDSPRT,N    ZRATE2 138
      *
     C                     EXSR ZXRATE
      ** Obtain cross Exchange Rate & Cross Multiply/Divide Indicator
      *
     C                     Z-ADDZRATEX    ZEXCH
     C                     MOVE ZMDIX     ZMD
     C                     Z-ADDCAMT      ZAMTCI
     C                     MOVE INCCY     ZCCYI
     C                     MOVE OUTCCY    ZCCYO
     C                     Z-ADDZNBDP1    ZCDPI
     C                     Z-ADDZNBDP2    ZCDPO
     C                     EXSR ZCONV
      ** Convert Amount
     C                     Z-ADDZAMTCO    CAMT
      *
     C                     ELSE
      ** Fee Exchange Rate is not zero
      *
     C                     Z-ADD1         N
     C           FHFCCY    LOKUPCURR,N                   30
     C           NBDP,N    ADD  4         WFD     10
      ** Set Facility Number of Decimal Places
      *
     C           CAMT      DIV  POWER,WFD WRK153 153
      *
     C           FEMDIN    IFEQ 'M'
     C                     MULT FEERAT    WRK153
     C                     ELSE
     C                     DIV  FEERAT    WRK153
     C                     ENDIF
      *
     C           WRK153    MULT POWER,WTD CAMT
     C                     ENDIF
      *
     C                     Z-ADDCAMT      WAMT
     C                     ENDIF
      *
      *
     C           FECALC    LOKUPTABCAL    TABCBS         30
     C           *IN30     IFEQ '1'
     C                     Z-ADDTABCBS    WCBS    50
     C                     END
      *
      * Retrieve the Calculation Day Basis
      *
     C           FECALT    IFEQ '01'
     C           FECALT    OREQ '04'
     C           FECALT    OREQ '11'
     C           FECALT    OREQ '14'
      ** Calculation Type is tiered
     C           FEPIND    IFEQ 'A'
      ** Percentage Indicator is Amount
      *
     C           FAMT      MULT POWER,WTD FAM
     C                     Z-ADD0         WFAM   130
     C                     Z-ADDWAMT      WOAMT  130
      *
     C                     Z-ADD1         IX      10       Index
     C           WAMT      DOWGT0
     C           IX        ANDLT6                          5 Rates
      *
     C           WOAMT     IFLT FAM,IX
     C           FAM,IX    OREQ 0
      *
     C           WAMT      MULT FRT,IX    WRK15  150
      *
     C                     ELSE
      *
     C           FAM,IX    SUB  WFAM      WRK15
     C                     MULT FRT,IX    WRK15
     C                     ENDIF
      *
     C                     ADD  WRK15     WTOT
     C                     SUB  FAM,IX    WAMT
     C                     ADD  WFAM      WAMT
     C                     Z-ADDFAM,IX    WFAM
      *
     C                     ADD  1         IX
     C                     ENDDO
      *
     C**********           MULT WDAYS     WTOT                                              MD046351
     C**********           DIV  WCBS      WTOT                                              MD046351
      *                                                                                     MD046351
     C           WTOT      MULT WDAYS     ZWK309 309                                        MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
      *
     C                     ELSE
      * Percentage indicator is Percentage
     C           FAMT      DIV  1000      FPC
     C                     Z-ADD0         WFPC    63
     C                     Z-ADDWPCT      WOPCT   63
      *
      *
     C                     Z-ADD1         IX               Index
     C           WPCT      DOWGT0
     C           IX        ANDLT6                          5 Rates
      *
     C           WOPCT     IFLT FPC,IX
     C           FPC,IX    OREQ 0
      *
     C           WAMT      MULT WPCT      WRK15
      *
     C                     ELSE
     C           FPC,IX    SUB  WFPC      WRK63   63
     C           WAMT      MULT WRK63     WRK15
     C                     ENDIF
      *
     C                     MULT FRT,IX    WRK15
     C                     DIV  100       WRK15
     C                     ADD  WRK15     WTOT
     C                     SUB  FPC,IX    WPCT
     C                     ADD  WFPC      WPCT
     C                     Z-ADDFPC,IX    WFPC
      *
     C                     ADD  1         IX
     C                     ENDDO
      *
     C**********           MULT WDAYS     WTOT                                              MD046351
     C**********           DIV  WCBS      WTOT                                              MD046351
      *                                                                                     MD046351
     C           WTOT      MULT WDAYS     ZWK309                                            MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
     C                     ENDIF
     C                     ENDIF
      *
     C           FECALT    IFEQ '02'
     C           FECALT    OREQ '05'
     C           FECALT    OREQ '12'
     C           FECALT    OREQ '15'
      ** Calculation Type is threshold
     C           FEPIND    IFEQ 'A'
      ** Percentage Indicator is Amount
      *
     C           FAMT      MULT POWER,WTD FAM
     C                     Z-ADD1         IX
     C           WAMT      LOKUPFAM,IX               30  30
     C           *IN30     IFEQ *OFF
     C                     EXSR LSTRAT
     C                     ENDIF
      *
     C           *IN30     IFEQ *OFF
     C           WFND      ANDNE'Y'
     C                     Z-ADD0         WAMT
     C                     ELSE
     C                     MULT FRT,IX    WAMT
     C                     ENDIF
      *
      *
     C********** WAMT      MULT WDAYS     WTOT                                              MD046351
     C**********           DIV  WCBS      WTOT                                              MD046351
      *                                                                                     MD046351
     C           WAMT      MULT WDAYS     ZWK309                                            MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
      *
      *
     C                     ELSE
      * Percentage indicator is Percentage
     C           FAMT      DIV  1000      FPC
     C                     Z-ADD1         IX
     C           WPCT      LOKUPFPC,IX               30  30
     C           *IN30     IFEQ *OFF
     C                     EXSR LSTRAT
     C                     ENDIF
     C                     MULT WPCT      WAMT
      *
     C           *IN30     IFEQ *OFF
     C           WFND      ANDNE'Y'
     C                     Z-ADD0         WAMT
     C                     ELSE
     C                     MULT FRT,IX    WAMT
     C                     ENDIF
      *
     C                     DIV  100       WAMT
     C********** WAMT      MULT WDAYS     WTOT                                              MD046351
     C**********           DIV  WCBS      WTOT                                              MD046351
      *                                                                                     MD046351
     C           WAMT      MULT WDAYS     ZWK309                                            MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
     C                     ENDIF
     C                     ENDIF
      *
      *
     C           FECALT    IFEQ '03'
     C           FECALT    OREQ '06'
     C           FECALT    OREQ '13'
     C           FECALT    OREQ '16'
     C           FECALT    OREQ '21'
     C           FECALT    OREQ '22'
      ** Calculation Type is Single
      *
     C********** WAMT      MULT FRT,1     WTOT                                              MD046351
     C**********           MULT WDAYS     WTOT   153                                        MD046351
     C**********           DIV  WCBS      WTOT                                              MD046351
      *
     C           WAMT      MULT FRT,1     ZWK309                                            MD046351
     C                     MULT WDAYS     ZWK309                                            MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT   153H                                       MD046351
     C                     ENDIF
      *
     C                     ENDSR
      *
      /TITLE SR/ZXRATEZ1
     C/COPY ZSRSRC,ZXRATEZ1
      /TITLE SR/ZCONV
     C/COPY ZSRSRC,ZCONVZ1
      *****************************************************************
      *
      *    LSTRAT - LAST RATE
      *
      *    CALLED BY: ACCRUE - Accrue amount
      *    CALLS    :
      ********************************************************************
      *
     C           LSTRAT    BEGSR
      *
     C                     Z-ADD5         Y       10
     C                     MOVE 'N'       WFND    1
      *
     C           Y         DOWGT0
     C           FAMT,Y    IFEQ 0
     C           FRT,Y     ANDNE0
      ** Fee Limit Amount is Zero and Fee Rate is not Zero
     C                     Z-ADDY         IX
     C                     Z-ADD0         Y
     C                     MOVE 'Y'       WFND    1
     C                     ENDIF
     C                     SUB  1         Y
     C                     ENDDO
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *    HASH   - Maintain Hash Totals (1)
      *
      *    CALLED BY: CREATE - Create Message
      *    CALLS    :
      ********************************************************************
      *
     C           HASH      BEGSR
      *
     C                     Z-ADDINT,X     ZZTOTI
     C                     Z-ADDDEC,X     ZZTOTD
     C           WWAMT     DIV  1000      ZZAMT
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    INT,X
     C                     Z-ADDZZTOTD    DEC,X
      *
     C                     ADD  1         ROP,X
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *    HASHT  - Maintain Hash Totals (2)
      *
      *    CALLED BY: SRRECD - Set Up of totals for new Trailer Record
      *    CALLS    : GLZADD - Add Amount to the Total
      ********************************************************************
      *
     C           HASHT     BEGSR
      *
     C                     Z-ADDINT,X     ZZTOTI
     C                     Z-ADDDEC,X     ZZTOTD
     C           HRDC      DIV  1000      ZZAMT
     C                     ADD  HRWN      ZZAMT
     C                     EXSR GLZADD
     C                     Z-ADDZZTOTI    INT,X
     C                     Z-ADDZZTOTD    DEC,X
      *
     C                     ADD  NORE      ROP,X
      *
     C                     ENDSR
     C/COPY WNCPYSRC,LEH00739
      *
      *****************************************************************                       CLE073
      /EJECT                                                                                  CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
      *    NEWCAL - Calculate Amounts for types 97, 98 and 99                                 CLE073
      *                                                                                       CLE073
      *    CALLED BY: MAIN   - Main processing                                                CLE073
      *    CALLS    : ACCLON - Accrual processing                                             CLE073
      ********************************************************************                    CLE073
      *                                                                                       CLE073
     C           NEWCAL    BEGSR                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADD0         WAMT   130                                          CLE073
     C                     Z-ADD0         WFEE   130                                          CLE073
      *                                                                                       CLE073
      ** Access loan files                                                                    CLE073
      *                                                                                       CLE073
     C                     MOVE 'A'       WCLRT                                               CLE073
     C           KLOAN     CHAINCLOAN                79                                       CLE073
     C           *IN79     IFEQ *ON                                                           CLE073
     C                     Z-ADD0         CPAML                                               CLE073
     C                     ENDIF                                                              CLE073
     C                     MOVE 'B'       WCLRT                                               CLE073
     C           KLOAN     CHAINCLOAN                79                                       CLE073
     C           *IN79     IFEQ *ON                                                           CLE073
     C                     Z-ADD0         OPAMK                                               CLE073
     C                     ENDIF                                                              CLE073
     C           KEYPHS    CHAINLEHISTLB             79                                       CLE073
     C           *IN79     IFEQ *OFF                                                          CLE073
     C                     Z-ADDPRAMM     OPAMK                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Check if loan maturity date is earlier than next pay date or end date                CLE073
      *                                                                                       CLE073
     C           MDATL     IFLT FENPYD                                                        CLE073
     C           MDATL     ANDNE0                                                             CLE073
     C           MDATL     ORLT FEPEND                                                        CLE073
     C           MDATL     ANDNE0                                                             CLE073
     C           CPAML     OREQ 0                                                             CLE073
     C                     EXSR CHKDTE                                                        CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDFELPDT    STDATE  50                                          CLE073
     C           STDATE    IFEQ 0                                                             CLE073
     C                     Z-ADDFEPSTD    STDATE                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDFENPYD    ENDATE  50                                          CLE073
     C           ENDATE    IFEQ 0                                                             CLE073
     C                     Z-ADDFEPEND    ENDATE                                              CLE073
     C                     ENDIF                                                              CLE073
     C           ENDATE    IFLT BJRDNB                                                        CLE073
     C           ENDATE    ANDEQFELPDT                                                        CLE073
     C                     Z-ADDFEPEND    ENDATE                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDSTDATE    ZZBEG                                               CLE073
     C                     Z-ADDENDATE    ZZEND                                               CLE073
     C                     MOVE FECALC    ZZCALC                                              CLE073
     C                     EXSR ZINTDY                                                        CLE073
     C           FECALC    IFEQ 6                                                             CLE073
     C                     Z-ADDINT6DY    WDAYS                                               CLE073
     C                     ELSE                                                               CLE073
     C**********           Z-ADDZZINDY    WDAYS   50                                 CLE073 MD037658
     C                     Z-ADDZZINDY    WDAYS  159                                        MD037658
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Type 99: Fixed Amount                                                                CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '99'                                                          CLE073
     C           FECALT    OREQ '90'                                                          CLE134
     C                     Z-ADDFEFAMT    AAMT                                                CLE073
     C                     Z-ADDFEFAMT    WAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Type 98: Loan Original Amount                                                        CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '98'                                                          CLE073
     C                     Z-ADDOPAMK     AAMT                                                CLE073
     C                     Z-ADDOPAMK     WAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Caculation type 97: get amount from loan history file                                CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C                     Z-ADDSTDATE    KVDAT   50                                          CLE073
      *                                                                                       CLE073
     C                     Z-ADDOPAMK     AAMT                                                CLE073
      *                                                                                       CLE073
      ** Get amount from loan history file                                                    CLE073
      *                                                                                       CLE073
     C                     Z-ADD999       WLASN                                               CLE073
     C           KEYHST    SETGTLEHISTLA                                                      CLE073
     C           KEYPHS    REDPELEHISTLA                 78                                   CLE073
     C           *IN78     IFEQ *OFF                                                          CLE073
     C                     Z-ADDCPAMP     AAMT                                                CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADD001       WLASN                                               CLE073
     C           KEYHST    SETLLLEHISTLA                 78                                   CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Read file until date read is greater than date of end of                             CLE073
      ** this accrual period.                                                                 CLE073
      ** NDAYS is the number of days in this accrual.                                         CLE073
      *                                                                                       CLE073
     C                     MOVE '0'       *IN78                                               CLE073
     C           *IN78     DOWEQ'0'                          B* DO                            CLE073
     C           KEYPHS    READELEHISTLA                 78                                   CLE073
      *                                                                                       CLE073
     C           *IN78     IFEQ '1'                                                           CLE073
     C           VDATP     ORGT ENDATE                                                        CLE073
     C                     Z-ADDENDATE    VDATP                                               CLE073
     C                     MOVE '1'       *IN78                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDSTDATE    ZZBEG                                               CLE073
     C           VDATP     IFGT STDATE                                                        CLE073
     C                     Z-ADDVDATP     ZZEND                                               CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDSTDATE    ZZEND                                               CLE073
     C                     END                                                                CLE073
     C                     MOVE FECALC    ZZCALC                                              CLE073
     C                     EXSR ZINTDY                                                        CLE073
     C           FECALC    IFEQ 6                                                             CLE073
     C                     Z-ADDINT6DY    NDAYS                                               CLE073
     C                     ELSE                                                               CLE073
     C**********           Z-ADDZZINDY    NDAYS   50                                 CLE073 MD037658
     C                     Z-ADDZZINDY    NDAYS  159                                        MD037658
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           NDAYS     IFGT 0                                                             CLE073
     C                     Z-ADDNDAYS     WDAYS                                               CLE073
     C                     Z-ADDAAMT      WAMT                                                CLE073
     C                     EXSR ACCLON                                                        CLE073
     C                     ADD  WTOT      WFEE                                                CLE073
     C                     ENDIF                                                              CLE073
     C           VDATP     IFGT STDATE                                                        CLE073
     C                     Z-ADDVDATP     STDATE                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Reset amount to accrue - comes from next record on amounts                           CLE073
      ** file.                                                                                CLE073
      *                                                                                       CLE073
     C           *IN78     IFNE '1'                                                           CLE073
     C                     Z-ADDCPAMP     AAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDDO                             E* DO                            CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Process accrual                                                                      CLE073
      *                                                                                       CLE073
     C           FECALT    IFNE '97'                                                          CLE073
     C                     EXSR ACCLON                                                        CLE073
     C                     Z-ADDWTOT      WFEE                                                CLE073
     C                     END                                                                CLE073
      *                                                                                       CLE073
     C                     ADD  FEAMTP    WFEE                                                CLE073
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
      *    CHKDTE - Check Loan Maturity date and principal amount                             CLE073
      *             update Next Pay date and End date equal to Loan maturity date             CLE073
      *             or to date loan amount became zero.                                       CLE073
      *                                                                                       CLE073
      *    CALLED BY: NEWCAL - Calculate Amounts for types 97, 98 and 99                      CLE073
      *    CALLS    :                                                                         CLE073
      *                                                                                       CLE073
      ********************************************************************                    CLE073
      *                                                                                       CLE073
     C           CHKDTE    BEGSR                                                              CLE073
      *                                                                                       CLE073
     C           AUENFE    IFEQ 'N'                                                         MD046370
     C           FECALT    IFEQ '97'                                                        MD046370
     C           FECALT    OREQ '98'                                                        MD046370
     C           FECALT    OREQ '99'                                                        MD046370
     C                     GOTO ENDCHK                                                      MD046370
     C                     ENDIF                                                            MD046370
     C                     ENDIF                                                            MD046370
      *                                                                                     MD046370
     C           MDATL     IFNE 0                                                             CLE073
     C           MDATL     IFLT FENPYD                                                        CLE073
     C           FENPYD    ANDGTBJRDNB                                                        CLE073
     C                     Z-ADDMDATL     FENPYD                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           MDATL     IFLT FEPEND                                                        CLE073
     C           FEPEND    ANDGTBJRDNB                                                        CLE073
     C                     Z-ADDMDATL     FEPEND                                              CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** If principal amount is zero, retrieve date it became zero                            CLE073
      *                                                                                       CLE073
     C                     MOVE '0'       *IN78                                               CLE073
     C                     Z-ADD999       WLASN                                               CLE073
     C                     Z-ADDFENPYD    KVDAT                                               CLE073
     C                     Z-ADDFENPYD    NWMAT   50                                          CLE073
     C           CPAML     IFEQ 0                                                             CLE073
     C           KEYHST    SETGTLEHISTLA                                                      CLE073
     C           KEYPHS    REDPELEHISTLA                 78                                   CLE073
     C           *IN78     DOWEQ'0'                                                           CLE073
     C           CPAMP     ANDEQ0                                                             CLE073
     C           CPAMP     IFEQ 0                                                             CLE073
     C                     Z-ADDVDATP     NWMAT                                               CLE073
     C                     ENDIF                                                              CLE073
     C           KEYPHS    REDPELEHISTLA                 78                                   CLE073
     C                     ENDDO                                                              CLE073
      *                                                                                       CLE073
     C           NWMAT     IFLT FEPEND                                                        CLE073
     C           FEPEND    ANDGTBJRDNB                                                        CLE073
     C                     Z-ADDNWMAT     FEPEND                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           NWMAT     IFLT FENPYD                                                        CLE073
     C           FENPYD    ANDGTBJRDNB                                                        CLE073
     C                     Z-ADDNWMAT     FENPYD                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                     MD046370
     C           AUENFE    IFEQ 'Y'                                                         MD046370
     C           FECALT    IFEQ '97'                                                        MD046370
     C           FECALT    OREQ '98'                                                        MD046370
     C           FECALT    OREQ '99'                                                        MD046370
      *                                                                                     MD046370
     C           FEPEND    IFLE FEPSTD                                                      MD046370
     C           FELPDT    IFGT 0                                                           MD046370
     C                     Z-ADDFELPDT    FEPEND                                            MD046370
     C                     ENDIF                                                            MD046370
     C           FELPDT    IFEQ 0                                                           MD046370
     C                     SELEC                                                            MD046370
     C           FEPSTD    WHEQ BJRDNB                                                      MD046370
     C           FEPSTD    ADD  1         FEPEND                                            MD046370
      *                                                                                     MD046370
     C           FEPSTD    WHGT BJRDNB                                                      MD046370
     C           FEPSTD    ADD  1         FEPEND                                            MD046370
      *                                                                                     MD046370
     C           FEPSTD    WHLT BJRDNB                                                      MD046370
     C           FEPSTD    ADD  1         FEPEND                                            MD046370
     C                     ENDSL                                                            MD046370
     C                     ENDIF                                                            MD046370
     C                     ENDIF                                                            MD046370
      *                                                                                     MD046370
     C           FENPYD    IFLE FEPSTD                                                      MD046370
     C           FELPDT    IFGT 0                                                           MD046370
     C                     Z-ADDFELPDT    FENPYD                                            MD046370
     C                     ENDIF                                                            MD046370
     C           FELPDT    IFEQ 0                                                           MD046370
     C                     SELEC                                                            MD046370
     C           FEPSTD    WHEQ BJRDNB                                                      MD046370
     C           FEPSTD    ADD  1         FENPYD                                            MD046370
      *                                                                                     MD046370
     C           FEPSTD    WHGT BJRDNB                                                      MD046370
     C           FEPSTD    ADD  1         FENPYD                                            MD046370
      *                                                                                     MD046370
     C           FEPSTD    WHLT BJRDNB                                                      MD046370
     C           FEPSTD    ADD  1         FENPYD                                            MD046370
     C                     ENDSL                                                            MD046370
     C                     ENDIF                                                            MD046370
     C                     ENDIF                                                            MD046370
      *                                                                                     MD046370
     C                     ENDIF                                                            MD046370
     C                     ENDIF                                                            MD046370
      *                                                                                     MD046370
     C           ENDCHK    TAG                                                              MD046370
      *                                                                                     MD046370
     C                     Z-ADD0         KVDAT                                               CLE073
     C                     Z-ADD0         VDATP                                               CLE073
     C                     Z-ADD0         CPAMP                                               CLE073
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      *                                                                                       CLE073
      *****************************************************************                       CLE073
      *                                                                                       CLE073
      *    ACCLON - Accrue Amount for loans and calc. type 97 and 98                          CLE073
      *                                                                                       CLE073
      *    CALLED BY: NEWCAL - Calculate Amounts for types 97, 98 and 99                      CLE073
      *    CALLS    : ZXRATE - Access Holidays for Currency/Location                          CLE073
      *               ZCONV  - Convert Amount to another currency                             CLE073
      ********************************************************************                    CLE073
      *                                                                                       CLE073
     C           ACCLON    BEGSR                                                              CLE073
      *                                                                                       CLE073
      ** Set Fee Number of Decimal Places                                                     CLE073
      *                                                                                       CLE073
     C                     Z-ADD0         WTOT                                                CLE073
     C                     Z-ADD1         N                                                   CLE073
     C           FEFCCY    LOKUPCURR,N                   30                                   CLE073
     C           NBDP,N    ADD  4         WTD     10                                          CLE073
      *                                                                                       CLE073
      ** Convert from Facility to fee Currency                                                CLE073
      *                                                                                       CLE073
     C           WAMT      IFNE 0                                                             CLE073
     C           CCYL      IFNE FEFCCY                                                        CLE073
     C           FECALT    ANDNE'99'                                                        MD047474
     C                     Z-ADDWAMT      CAMT   130                                          CLE073
     C           FEERAT    IFEQ 0                                                             CLE073
     C                     MOVE CCYL      INCCY   3                                           CLE073
     C                     MOVE FEFCCY    OUTCCY  3                                           CLE073
      *                                                                                       CLE073
     C                     Z-ADD1         N       30                                          CLE073
     C           INCCY     LOKUPCURR,N                   30                                   CLE073
     C                     Z-ADDNBDP,N    ZNBDP1  10                                          CLE073
     C                     MOVE MDI,N     ZMDI1   1                                           CLE073
     C                     Z-ADDSPRT,N    ZRATE1 138                                          CLE073
      *                                                                                       CLE073
     C                     Z-ADD1         N                                                   CLE073
     C           OUTCCY    LOKUPCURR,N                   30                                   CLE073
     C                     Z-ADDNBDP,N    ZNBDP2  10                                          CLE073
     C                     MOVE MDI,N     ZMDI2   1                                           CLE073
     C                     Z-ADDSPRT,N    ZRATE2 138                                          CLE073
      *                                                                                       CLE073
     C                     EXSR ZXRATE                                                        CLE073
      *                                                                                       CLE073
      ** Obtain cross Exchange Rate & Cross Multiply/Divide Indicator                         CLE073
      *                                                                                       CLE073
     C                     Z-ADDZRATEX    ZEXCH                                               CLE073
     C                     MOVE ZMDIX     ZMD                                                 CLE073
     C                     Z-ADDCAMT      ZAMTCI                                              CLE073
     C                     MOVE INCCY     ZCCYI                                               CLE073
     C                     MOVE OUTCCY    ZCCYO                                               CLE073
     C                     Z-ADDZNBDP1    ZCDPI                                               CLE073
     C                     Z-ADDZNBDP2    ZCDPO                                               CLE073
     C                     EXSR ZCONV                                                         CLE073
      *                                                                                       CLE073
      ** Convert Amount                                                                       CLE073
      *                                                                                       CLE073
     C                     Z-ADDZAMTCO    CAMT                                                CLE073
      *                                                                                       CLE073
     C                     ELSE                                                               CLE073
      *                                                                                       CLE073
      ** Fee Exchange Rate is not zero                                                        CLE073
      *                                                                                       CLE073
     C                     Z-ADD1         N                                                   CLE073
     C           FHFCCY    LOKUPCURR,N                   30                                   CLE073
     C           NBDP,N    ADD  4         WFD     10                                          CLE073
      *                                                                                       CLE073
      ** Set Facility Number of Decimal Places                                                CLE073
      *                                                                                       CLE073
     C           CAMT      DIV  POWER,WFD WRK153 153                                          CLE073
      *                                                                                       CLE073
     C           FEMDIN    IFEQ 'M'                                                           CLE073
     C                     MULT FEERAT    WRK153                                              CLE073
     C                     ELSE                                                               CLE073
     C                     DIV  FEERAT    WRK153                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           WRK153    MULT POWER,WTD CAMT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     Z-ADDCAMT      WAMT                                                CLE073
     C                     ENDIF                                                              CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** Retrieve the Calculation Day Basis                                                   CLE073
      *                                                                                       CLE073
     C           FECALC    LOKUPTABCAL    TABCBS         30                                   CLE073
     C           *IN30     IFEQ '1'                                                           CLE073
     C                     Z-ADDTABCBS    WCBS    50                                          CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C           FECALT    IFEQ '97'                                                          CLE073
     C           FECALT    OREQ '98'                                                          CLE073
     C           WAMT      MULT FRT,1     WTOT                                                CLE073
     C                     ELSE                                                               CLE073
     C                     Z-ADDWAMT      WTOT                                                CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C**********           MULT WDAYS     WTOT   153                                 CLE073 MD046351
      **********                                                                     CLE073 MD046351
     C********** FECALT    IFNE '99'                                                 CLE073 MD046351
     C********** WTOT      ANDNE0                                                    CLE073 MD046351
     C**********           DIV  WCBS      WTOT                                       CLE073 MD046351
     C**********           ELSE                                                      CLE073 MD046351
     C**********           Z-ADDFEFAMT    WTOT                                       CLE073 MD046351
      *                                                                                     MD046351
     C           WTOT      MULT WDAYS     ZWK309                                            MD046351
     C           FECALT    IFNE '99'                                                        MD046351
     C           ZWK309    ANDNE0                                                           MD046351
     C                     DIV  WCBS      ZWK309    H                                       MD046351
     C                     Z-ADDZWK309    WTOT      H                                       MD046351
     C                     ELSE                                                             MD046351
     C                     Z-ADDFEFAMT    WTOT                                              MD046351
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
     C                     ENDSR                                                              CLE073
      *****************************************************************                       CLE073
      /EJECT                                                                                  CLE073
     C********************************************************************
     C* SUBROUTINE TO ADD AN AMOUNT (ZZAMT) TO THE TOTAL (ZZTOTI,ZZTOTD)
     C*   IND '99' IS SET BY AN OVERFLOW ERROR
     C*
     CSR         GLZADD    BEGSR                           *** GLZADD ****
     C*
     CSR                   Z-ADDZZAMT     ZZAMT  153     91-DEFINE ZZAMT
     CSR 91                GOTO ZZAEND                     AMT = 0.BYPASS
     C*
     C* SPLIT ZZAMT INTO INTEGER AND DECIMAL FIELDS
     CSR                   Z-ADDZZAMT     ZZAMTI 150       INTEGER FIELD
     CSR                   MOVE ZZAMT     ZZAMTD  30       DECIMAL FIELD
     C* BOTH ZZAMTI AND ZZAMTD CONTAIN A 'SIGN' ZONE NOW
     C*
     CSR                   EXSR GLZSUM
     CSR         ZZAEND    ENDSR                           ** ZZAEND TAG *
     C*
     C********************************************************************
     C* SUBROUTINE TO CARRY OUT THE ADDITION FOR SUBROUTINES -
     C*                        GLZADD, GLZSUB, GLZCMP.
     C*          PARAMETERS PASSED -
     C*                     I/P ZZAMTI ZZAMTD
     C*                     O/P ZZTOTI ZZTOTD ZZNEGD IND 96 IND 99.
     C*
     CSR         GLZSUM    BEGSR                           *** GLZSUM ****
     C*
     CSR                   Z-ADDZZTOTI    ZZTOTI 150       DEFINE ZZTOTI
     CSR                   Z-ADDZZTOTD    ZZTOTD  30       DEFINE ZZTOTD
     CSR                   SETOF                     919293
     CSR                   SETOF                     949599
     C*
     C*    DETERMINE SIGN OF ZZAMTI & D,   92 IF NEG
     CSR         ZZAMTI    COMP 0                      9293
     CSR 93      ZZAMTD    COMP 0                      9293
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
     C*
     C*    DETERMINE SIGN OF ZZTOTI & D, 91 IF NEG.
     CSR         ZZTOTI    COMP 0                      9193
     CSR 93      ZZTOTD    COMP 0                      9193
     C*
     C*    IF ZZTOTAL IS ZERO, RETURN ZZAMOUNT.
     CSR 93                Z-ADDZZAMTI    ZZTOTI
     CSR 93                Z-ADDZZAMTD    ZZTOTD
     CSR 93                GOTO ZZSEND                     ZERO BYPASS
     C*    IF SIGNS DIFFER BYPASS OVERFLOW CHECKS.
     CSR 91N92
     CORN91 92             GOTO ZZOFPS
     C*
     CSR         ZZAMTD    ADD  ZZTOTD    ZZWK2   40
     CSR         ZZWK2     COMP 999                  93    '93' = CARRY
     CSRN93      ZZWK2     COMP -999                   93    INTO INTEGER.
     C*
     CSR 93N92   ZZAMTI    ADD  1         ZZWK3  150       ADD 'CARRY' +VE
     CSR    93 92ZZAMTI    SUB  1         ZZWK3            SUB 'CARRY' -VE
     CSR 93      ZZTOTI    ADD  ZZWK3     ZZWK3
     CSRN93      ZZTOTI    ADD  ZZAMTI    ZZWK3
     C*
     C* IF THE MODULUS OF ZZWK3 IS LT MOD. ZZTOTI THEN O/F HAS OCCURED
     CSRN92      ZZWK3     COMP ZZTOTI                 99  -92 MEANS NOS.
     CSR 92      ZZWK3     COMP ZZTOTI               99     NEGATIVE
     CSRN99                Z-ADDZZWK2     ZZTOTD
     CSRN99                Z-ADDZZWK3     ZZTOTI
     C*
     C* IF O/F ZEROIZE ZZAMT , IND '99' SET AND ZZTOT FIELDS LEFT INTACT.
     CSR 99                Z-ADD0         ZZAMT  153
     CSR                   GOTO ZZSEND
     C*
     C* THE 'SIGNS' ARE DIFFERENT
     CSR         ZZOFPS    TAG                             ** ZZOFPS TAG**
     C* IF ZZAMT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZTOT
     C*
     CSR 92                Z-SUBZZAMTI    ZZAMTI 150
     CSR 92                Z-SUBZZAMTD    ZZAMTD  30
     C*
     C* IF ZZTOT WAS NEGATIVE, MAKE IT POS. TO COMP WITH ZZAMT.
     C*
     CSR 91                Z-SUBZZTOTI    ZZTOTI
     CSR 91                Z-SUBZZTOTD    ZZTOTD
     C* BOTH ZZAMT AND ZZTOT ARE NOW POSITIVE.
     C*
     CSR         ZZTOTI    COMP ZZAMTI               93  95
     CSR 95      ZZTOTD    COMP ZZAMTD               93  95
     C*
     C* IF ZZTOT EQ. ZZAMT RETURN ZERO.
     CSR 95                Z-ADD0         ZZTOTI
     CSR 95                Z-ADD0         ZZTOTD
     CSR 95                GOTO ZZSEND
     C*
     C* IF ZZTOT GT. ZZAMT.
     CSR 93      ZZAMTD    COMP ZZTOTD               94
     CSR 93 94   ZZTOTI    SUB  1         ZZTOTI
     CSR 93 94   ZZTOTD    ADD  1000      ZZWK2
     CSR 93      ZZTOTI    SUB  ZZAMTI    ZZTOTI
     CSR 93 94   ZZWK2     SUB  ZZAMTD    ZZTOTD
     CSR 93N94   ZZTOTD    SUB  ZZAMTD    ZZTOTD
     C*
     C*
     C* IF ZZAMT GT. ZZTOT.
     CSRN93      ZZTOTD    COMP ZZAMTD               94
     CSRN93 94   ZZAMTI    SUB  1         ZZWK3  150
     CSRN93 94   ZZAMTD    ADD  1000      ZZWK2
     CSRN93 94   ZZWK3     SUB  ZZTOTI    ZZTOTI
     CSRN93N94   ZZAMTI    SUB  ZZTOTI    ZZTOTI
     CSRN93 94   ZZWK2     SUB  ZZTOTD    ZZTOTD
     CSRN93N94   ZZAMTD    SUB  ZZTOTD    ZZTOTD
     C*
     C* REVERSE SIGN OF ZZTOT IF LARGER I/P FIELDS WERE NEGATIVE
     CSR                   SETOF                     94
     CSR 93 91
     CORN93 92             SETON                     94
     CSR 94                Z-SUBZZTOTI    ZZTOTI
     CSR 94                Z-SUBZZTOTD    ZZTOTD
     C**
     C**   RESTORE SIGN OF ZZAMTI & ZZAMTD IF IT WAS REVERSED.
     CSR 92                Z-SUBZZAMTI    ZZAMTI
     CSR 92                Z-SUBZZAMTD    ZZAMTD
     CSR         ZZSEND    TAG                             ** ZZSEND TAG *
     C**
     C**   IF ZZTOTD IS ZERO, AND ZZTOTI IS NEG. SET UP ZZNEGD.
     CSR                   SETOF                     96
     CSR         ZZTOTD    COMP 0                        91
     CSR 91      ZZTOTI    COMP 0                      96
     CSR 96                MOVE '.000-'   ZZNEGD  5
     CSR                   ENDSR                             ** ENDSR **
      *****************************************************************
      *
      *    TRAIL  - Update Header & Trailer Files
      *
      *    CALLED BY: MAIN   - Main Processing
      *    CALLS    : SRNORC - Set up of Total for New Trailer record
      *             : SRRECD - Set up of Total for Existing Trailer Rcd
      ********************************************************************
      *
     C           TRAIL     BEGSR
      *
     C                     READ LETX1HH                  74
     C           *IN74     IFEQ *ON
     C                     MOVE 'H'       RECI
     C                     WRITELETX1HHF
     C                     ENDIF
      *
     C                     READ LETX2HH                  74
     C           *IN74     IFEQ *ON
     C                     MOVE 'H'       RECI
     C                     WRITELETX2HHF
     C                     ENDIF
      *
     C                     READ LETX3HH                  74
     C           *IN74     IFEQ *ON
     C                     MOVE 'H'       RECI
     C                     WRITELETX3HHF
     C                     ENDIF
      *
     C                     READ LEPXTAA                  74
     C           *IN74     IFEQ *ON
     C                     MOVE 'H'       RECI
     C                     WRITELEPXTAAF
     C                     ENDIF
      *
     C                     READ LETX1ZZ                  74
     C                     Z-ADD1         X
     C           *IN74     IFEQ *ON
     C                     EXSR SRNORC
     C                     MOVE 'T'       RECI
     C                     WRITELETX1ZZF
     C                     Z-ADDROP,1     NORE1
     C                     ELSE
     C                     EXSR SRRECD
     C                     UPDATLETX1ZZF
     C                     Z-ADDROP,1     NORE1
     C                     ENDIF
      *
     C                     READ LETX2ZZ                  74
     C                     Z-ADD2         X
     C           *IN74     IFEQ *ON
     C                     EXSR SRNORC
     C                     MOVE 'T'       RECI
     C                     WRITELETX2ZZF
     C                     Z-ADDROP,2     NORE2
     C                     ELSE
     C                     EXSR SRRECD
     C                     UPDATLETX2ZZF
     C                     Z-ADDROP,2     NORE2
     C                     ENDIF
      *
     C                     READ LETX3ZZ                  74
     C                     Z-ADD3         X
     C           *IN74     IFEQ *ON
     C                     EXSR SRNORC
     C                     MOVE 'T'       RECI
     C                     WRITELETX3ZZF
     C                     Z-ADDROP,3     NORE3
     C                     ELSE
     C                     EXSR SRRECD
     C                     UPDATLETX3ZZF
     C                     Z-ADDROP,3     NORE3
     C                     ENDIF
      *
     C                     READ LEPXTAC                  74
     C                     Z-ADD4         X
     C           *IN74     IFEQ *ON
     C                     EXSR SRNORC
     C                     MOVE 'T'       RECI
     C                     WRITELEPXTACF
     C                     Z-ADDROP,4     NORE4
     C                     ELSE
     C                     EXSR SRRECD
     C                     UPDATLEPXTACF
     C                     Z-ADDROP,4     NORE4
     C                     ENDIF
      *
     C                     Z-ADDINT,1     INT1
     C                     Z-ADDINT,2     INT2
     C                     Z-ADDINT,3     INT3
     C                     Z-ADDINT,4     INT4
     C                     Z-ADDDEC,1     DEC1
     C                     Z-ADDDEC,2     DEC2
     C                     Z-ADDDEC,3     DEC3
     C                     Z-ADDDEC,4     DEC4
      ** Prepare the audit report
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *    SRNORC - Set up of totals for new trailer record
      *
      *    CALLED BY: TRAIL - Update Header & Trailer Files
      *    CALLS    :
      ********************************************************************
      *
     C           SRNORC    BEGSR
      *
     C                     ADD  2         ROP,X
     C                     Z-ADDDEC,X     HRDC
     C                     Z-ADDINT,X     HRWN
     C                     Z-ADDROP,X     NORE
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *    SRRECD - Set up of totals for existing Record
      *
      *    CALLED BY: TRAIL - Update Header & Trailer Files
      *    CALLS    : HASHT - Maintain Hash Total
      ********************************************************************
      *
     C           SRRECD    BEGSR
      *
     C                     EXSR HASHT
     C                     Z-ADDDEC,X     HRDC
     C                     Z-ADDINT,X     HRWN
     C                     Z-ADDROP,X     NORE
      *
     C                     ENDSR
      *
      *****************************************************************
      *
      *    XCAMT  - Convert Amount
      *
      *    CALLED BY:
      *    CALLS    :
      ********************************************************************
      *
     C           XCAMT     BEGSR
      *
     C           CLE031    IFEQ 'Y'                                       CLE031
     C                     Z-ADD1         N                               CLE031
     C                     MOVE *OFF      *IN31                           CLE031
     C           FRCY      LOKUPCURR,N                   31               CLE031
     C                     MOVE INCY,N    FCCYIN  1                       CLE031
      *                                                                   CLE031
     C                     Z-ADD1         N                               CLE031
     C                     MOVE *OFF      *IN31                           CLE031
     C           TOCY      LOKUPCURR,N                   31               CLE031
     C                     MOVE INCY,N    TCCYIN  1                       CLE031
      *                                                                   CLE031
     C                     ENDIF                                          CLE031
      *
     C           CLE031    IFEQ 'N'                                       CLE031
     C           CLE031    OREQ 'Y'                                       CLE031
     C           FCCYIN    ANDEQ'Y'                                       CLE031
     C           CLE031    OREQ 'Y'                                       CLE031
     C           TCCYIN    ANDEQ'Y'                                       CLE031
     C                     CALL 'EU0200'
     C                     PARM *BLANKS   PRTCD   7        Return Code
     C                     PARM           FRAM   183       From amount
     C                     PARM           FRCY    3        From Currency
     C                     PARM           TOCY    3        To Currency
     C                     PARM           OUTA   150       Out amount
     C                     PARM           P@INTA 183       In amount
     C                     PARM           P@EXRT 159       Exchange Rate
     C                     PARM           P@MDIN  1        Mult/Div Ind
      *
     C           PRTCD     IFNE *BLANKS
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'EU0200  'DBFILE           *************
     C                     MOVELFRCY      DBKEY            * DBERR  07 *
     C                     Z-ADD7         DBASE            *************
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LE1069 ' DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     EXSR DBERR
     C                     ENDIF
      *
     C                     ELSE                                           CLE031
     C                     Z-ADD1         N                               CLE031
     C                     MOVE *OFF      *IN31                           CLE031
     C           CCYSV     LOKUPCURR,N                   31               CLE031
      *                                                                   CLE031
     C                     Z-ADDNBDP,N    CCYSDP  10                      CLE031
      *                                                                   CLE031
     C                     Z-ADD1         N                               CLE031
     C                     MOVE *OFF      *IN31                           CLE031
     C           WCURR     LOKUPCURR,N                   31               CLE031
      *                                                                   CLE031
     C                     Z-ADDNBDP,N    WCURDP  10                      CLE031
      *                                                                   CLE031
     C           WEXR      IFGT 0                                                           BUG21167
      *                                                                                     BUG21167
     C                     Z-ADDWWAMT     ZAMTCI                          CLE031
     C                     Z-ADDWEXR      ZEXCH                           CLE031
     C                     MOVE WMDIN     ZMD                             CLE031
     C                     MOVE CCYSV     ZCCYI                           CLE031
     C                     MOVE WCURR     ZCCYO                           CLE031
     C                     Z-ADDCCYSDP    ZCDPI                           CLE031
     C                     Z-ADDWCURDP    ZCDPO                           CLE031
      *                                                                   CLE031
     C                     CALL 'ZCONVZ1'                                 CLE031
     C                     PARM           ZAMTCI 150                      CLE031
     C                     PARM           ZEXCH  138                      CLE031
     C                     PARM           ZMD     1                       CLE031
     C                     PARM           ZCCYI   3                       CLE031
     C                     PARM           ZCCYO   3                       CLE031
     C                     PARM           ZCDPI   10                      CLE031
     C                     PARM           ZCDPO   10                      CLE031
     C                     PARM           ZAMTCO 150                      CLE031
      *                                                                   CLE031
     C                     Z-ADDZAMTCO    WWAMT                           CLE031
      *                                                                                     BUG21167
     C                     ENDIF                                                            BUG21167
      *                                                                                     BUG21167
     C                     ENDIF                                          CLE031
     C                     ENDSR
      *
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34A - Initial Setup for CLE034 Processing                  *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34A     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE WWAMT     WSAMT                                               CLE034
     C                     Z-ADD0         TOTAMT                                              CLE034
     C                     Z-ADD0         WKAMT                                               CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
      *                                                                                       CLE034
     C           AMTP      IFEQ 'LF'                                                          CLE034
     C                     MOVE FEOURS    WEOURS                                              CLE034
     C                     MOVE FESTTL    WESTTL                                              CLE034
     C                     MOVE FEOSBR    WEOSBR                                              CLE034
     C                     MOVE FETHER    WETHER                                              CLE034
     C                     MOVE PSTM      WSPSTM                                              CLE034
     C                     MOVE PONS      WSPONS                                              CLE034
     C                     MOVE RSTM      WSRSTM                                              CLE034
     C                     MOVE RONS      WSRONS                                              CLE034
     C                     MOVE FESCCY    WESCCY                                              CLE034
     C                     MOVE FEICCY    WEICCY                                              CLE034
     C                     MOVE FEPSCY    WEPSCY                                              CLE034
     C                     MOVE FEREXR    WEREXR                                              CLE034
     C                     MOVE FEREXI    WEREXI                                              CLE034
     C                     MOVE FEPEXR    WEPEXR                                              CLE034
     C                     MOVE FEPEXI    WEPEXI                                              CLE034
     C                     MOVE ROBN      WSROBN                                              CLE034
     C                     MOVE ROCN      WSROCN                                              CLE034
     C                     MOVE RIBN      WSRIBN                                              CLE034
     C                     MOVE RIBA      WSRIBA                                              CLE034
     C                     MOVE POBN      WSPOBN                                              CLE034
     C                     MOVE POCN      WSPOCN                                              CLE034
     C                     MOVE PIBN      WSPIBN                                              CLE034
     C                     MOVE PIBA      WSPIBA                                              CLE034
     C                     MOVE RVNO      WSRVNO                                              CLE034
     C                     MOVE CVMR      WSCVMR                                              CLE034
     C                     MOVE RCRN      WSRCRN                                              CLE034
     C                     MOVE RCRA      WSRCRA                                              CLE034
      *                                                                                       CLE034
     C                     MOVE FELOAN    PLNRF                                               CLE034
     C                     MOVE FECNUM    PCNUM                                               CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   PRTCDE  7                                           CLE034
     C                     PARM '*FIRST ' POPTN                                               CLE034
     C                     PARM 'FEES'    PTYPE                                               CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           WKPREC                                              CLE034
     C           LESTAL    PARM *BLANKS   DSSDY                                               CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C                     MOVE FAOURS    WAOURS                                              CLE034
     C                     MOVE FAMETH    WAMETH                                              CLE034
     C                     MOVE FAOSBR    WAOSBR                                              CLE034
     C                     MOVE FATHER    WATHER                                              CLE034
     C                     MOVE PSTM      WSPSTM                                              CLE034
     C                     MOVE PONS      WSPONS                                              CLE034
     C                     MOVE RSTM      WSRSTM                                              CLE034
     C                     MOVE RONS      WSRONS                                              CLE034
     C                     MOVE FASCCY    WASCCY                                              CLE034
     C                     MOVE FAPSCY    WAPSCY                                              CLE034
     C                     MOVE FAREXR    WAREXR                                              CLE034
     C                     MOVE FAREXI    WAREXI                                              CLE034
     C                     MOVE FAPEXR    WAPEXR                                              CLE034
     C                     MOVE FAPEXI    WAPEXI                                              CLE034
     C                     MOVE ROBN      WSROBN                                              CLE034
     C                     MOVE ROCN      WSROCN                                              CLE034
     C                     MOVE RIBN      WSRIBN                                              CLE034
     C                     MOVE RIBA      WSRIBA                                              CLE034
     C                     MOVE POBN      WSPOBN                                              CLE034
     C                     MOVE POCN      WSPOCN                                              CLE034
     C                     MOVE PIBN      WSPIBN                                              CLE034
     C                     MOVE PIBA      WSPIBA                                              CLE034
     C                     MOVE RVNO      WSRVNO                                              CLE034
     C                     MOVE CVMR      WSCVMR                                              CLE034
     C                     MOVE RCRN      WSRCRN                                              CLE034
     C                     MOVE RCRA      WSRCRA                                              CLE034
      *                                                                                       CLE034
     C                     MOVE FALOAN    PLNRF                                               CLE034
     C                     MOVE FAVDAT    PLAVD                                               CLE034
     C                     MOVE FACNUM    PCNUM                                               CLE034
     C                     MOVE FAFACL    PFACL                                               CLE034
     C                     MOVE FAFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   PRTCDE                                              CLE034
     C                     PARM '*FIRST ' POPTN                                               CLE034
     C                     PARM 'FSET'    PTYPE                                               CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM           PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           WKPREC                                              CLE034
     C           LESTAL    PARM *BLANKS   DSSDY                                               CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           PRTCDE    IFNE *BLANKS                                                       CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVE *BLANKS   DBKEY                                               CLE034
     C                     MOVEL'*FIRST ' DBKEY                                               CLE034
     C                     Z-ADD15        DBASE                                               CLE034
     C                     MOVEL'AOSTALR2'DBFILE                                              CLE034
     C                     MOVE *BLANKS   DBPGM                                               CLE034
     C                     MOVEL'LE1069 ' DBPGM                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     EXSR DBERR                                                         CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34B - Processing to Calculate Amount for Sett. Allocation  *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34B     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           WKPREC    IFEQ 'P'                                                           CLE034
     C           WSAMT     MULT PYPC      WKAMT                                               CLE034
     C                     DIV  100       WKAMT                                               CLE034
     C                     ELSE                                                               CLE034
     C           WSAMT     MULT RCPC      WKAMT                                               CLE034
     C                     DIV  100       WKAMT                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ADD  WKAMT     TOTAMT                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     IFEQ 'Y'                                                           CLE034
     C           TOTAMT    ANDNEWSAMT                                                         CLE034
     C           WSAMT     SUB  TOTAMT    WDIFF  130                                          CLE034
     C                     ADD  WDIFF     WKAMT                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     Z-ADDWKAMT     WWAMT                                               CLE034
     C                     EXSR SR34D                                                         CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34C - Processing to Get Next Settlement Allocation         *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34C     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           WKFLD     IFEQ 'Y'                                                           CLE034
     C                     MOVE *BLANKS   WKFLD                                               CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           AMTP      IFEQ 'LF'                                                          CLE034
     C                     MOVE FELOAN    PLNRF                                               CLE034
     C                     MOVE FECNUM    PCNUM                                               CLE034
     C                     MOVE FEFACL    PFACL                                               CLE034
     C                     MOVE FEFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   PRTCDE                                              CLE034
     C                     PARM '*NEXT  ' POPTN                                               CLE034
     C                     PARM 'FEES'    PTYPE                                               CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM *BLANKS   PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           WKPREC                                              CLE034
     C           LESTAL    PARM *BLANKS   DSSDY                                               CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE FALOAN    PLNRF                                               CLE034
     C                     MOVE FAVDAT    PLAVD                                               CLE034
     C                     MOVE FACNUM    PCNUM                                               CLE034
     C                     MOVE FAFACL    PFACL                                               CLE034
     C                     MOVE FAFSEQ    PFSEQ                                               CLE034
      *                                                                                       CLE034
     C                     CALL 'AOSTALR2'                                                    CLE034
     C                     PARM *BLANKS   PRTCDE                                              CLE034
     C                     PARM '*NEXT  ' POPTN                                               CLE034
     C                     PARM 'FSET'    PTYPE                                               CLE034
     C                     PARM           PLNRF                                               CLE034
     C                     PARM           PLAVD                                               CLE034
     C                     PARM *BLANKS   PLASQ                                               CLE034
     C                     PARM           PCNUM                                               CLE034
     C                     PARM           PFACL                                               CLE034
     C                     PARM           PFSEQ                                               CLE034
     C                     PARM           WKPREC                                              CLE034
     C           LESTAL    PARM *BLANKS   DSSDY                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           PRTCDE    IFEQ '*EOF   '                                                     CLE034
     C                     MOVE 'Y'       WKFLD                                               CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34D - Setup Fields from Settlement Allocation              *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34D     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C           AMTP      IFEQ 'LF'                                                          CLE034
      *                                                                                       CLE034
     C           WKPREC    IFEQ 'P'                                                           CLE034
     C                     MOVE STPSTM    FESTTL                                              CLE034
     C                     MOVE STPONS    FEOURS                                              CLE034
     C                     MOVE STPOBR    FEOSBR                                              CLE034
     C                     MOVE STPIBN    FETHER                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE STRSTM    FESTTL                                              CLE034
     C                     MOVE STRONS    FEOURS                                              CLE034
     C                     MOVE STROBR    FEOSBR                                              CLE034
     C                     MOVE STRIBN    FETHER                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE STRSTM    RSTM                                                CLE034
     C                     MOVE STRONS    RONS                                                CLE034
     C                     MOVE STPSTM    PSTM                                                CLE034
     C                     MOVE STPONS    PONS                                                CLE034
     C                     MOVE STREXR    FEREXR                                              CLE034
     C                     MOVE STREXI    FEREXI                                              CLE034
     C                     MOVE STPEXR    FEPEXR                                              CLE034
     C                     MOVE STPEXI    FEPEXI                                              CLE034
     C                     MOVE STPSCY    FEPSCY                                              CLE034
     C                     MOVE RSCY      FESCCY                                              CLE034
     C                     MOVE STIC72    FEICCY                                              CLE034
     C                     MOVE STROBN    ROBN                                                CLE034
     C                     MOVE STROCN    ROCN                                                CLE034
     C                     MOVE STRIBN    RIBN                                                CLE034
     C                     MOVE STRIBA    RIBA                                                CLE034
     C                     MOVE STPOBN    POBN                                                CLE034
     C                     MOVE STPOCN    POCN                                                CLE034
     C                     MOVE STPIBN    PIBN                                                CLE034
     C                     MOVE STPIBA    PIBA                                                CLE034
     C                     MOVE STCVMR    CVMR                                                CLE034
     C                     MOVE STRVNO    RVNO                                                CLE034
     C                     MOVE STRCRN    RCRN                                                CLE034
     C                     MOVE STRCRA    RCRA                                                CLE034
      *                                                                                       CLE034
     C                     MOVE FESTTL    WSETTL                                              CLE034
     C                     MOVE FEOURS    WOURS                                               CLE034
     C                     MOVE FETHER    WTHEIR                                              CLE034
     C                     MOVE FEFCCY    WCURR                                               CLE034
      *                                                                                       CLE034
     C                     ELSE                                                               CLE034
      *                                                                                       CLE034
     C           WKPREC    IFEQ 'P'                                                           CLE034
     C                     MOVE STPSTM    FAMETH                                              CLE034
     C                     MOVE STPONS    FAOURS                                              CLE034
     C                     MOVE STPOBR    FAOSBR                                              CLE034
     C                     MOVE STPIBN    FATHER                                              CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE STRSTM    FAMETH                                              CLE034
     C                     MOVE STRONS    FAOURS                                              CLE034
     C                     MOVE STROBR    FAOSBR                                              CLE034
     C                     MOVE STRIBN    FATHER                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE STRSTM    RSTM                                                CLE034
     C                     MOVE STRONS    RONS                                                CLE034
     C                     MOVE STPSTM    PSTM                                                CLE034
     C                     MOVE STPONS    PONS                                                CLE034
     C                     MOVE RSCY      FASCCY                                              CLE034
     C                     MOVE STIC72    FAICCY                                              CLE034
     C                     MOVE STREXR    FAREXR                                              CLE034
     C                     MOVE STREXI    FAREXI                                              CLE034
     C                     MOVE STROBN    ROBN                                                CLE034
     C                     MOVE STROCN    ROCN                                                CLE034
     C                     MOVE STRIBN    RIBN                                                CLE034
     C                     MOVE STRIBA    RIBA                                                CLE034
     C                     MOVE STPSCY    FAPSCY                                              CLE034
     C                     MOVE STPEXR    FAPEXR                                              CLE034
     C                     MOVE STPEXI    FAPEXI                                              CLE034
     C                     MOVE STPOBN    POBN                                                CLE034
     C                     MOVE STPOCN    POCN                                                CLE034
     C                     MOVE STPIBN    PIBN                                                CLE034
     C                     MOVE STPIBA    PIBA                                                CLE034
     C                     MOVE STCVMR    CVMR                                                CLE034
     C                     MOVE STRVNO    RVNO                                                CLE034
     C                     MOVE STRCRN    RCRN                                                CLE034
     C                     MOVE STRCRA    RCRA                                                CLE034
      *                                                                                       CLE034
     C                     MOVE FAMETH    WSETTL                                              CLE034
     C                     MOVE FAOURS    WOURS                                               CLE034
     C                     MOVE FATHER    WTHEIR                                              CLE034
     C                     MOVE FAFCCY    WCURR                                               CLE034
      *                                                                                       CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
      *****************************************************************                       CLE034
      *                                                               *                       CLE034
      *  SR34E - Restore Original Fields                              *                       CLE034
      *                                                               *                       CLE034
      *****************************************************************                       CLE034
      *                                                                                       CLE034
     C           SR34E     BEGSR                                                              CLE034
      *                                                                                       CLE034
     C                     MOVE WSAMT     WWAMT                                               CLE034
      *                                                                                       CLE034
     C           AMTP      IFEQ 'LF'                                                          CLE034
     C                     MOVE WEOURS    FEOURS                                              CLE034
     C                     MOVE WESTTL    FESTTL                                              CLE034
     C                     MOVE WEOSBR    FEOSBR                                              CLE034
     C                     MOVE WETHER    FETHER                                              CLE034
     C                     MOVE WSPSTM    PSTM                                                CLE034
     C                     MOVE WSPONS    PONS                                                CLE034
     C                     MOVE WSRSTM    RSTM                                                CLE034
     C                     MOVE WSRONS    RONS                                                CLE034
     C                     MOVE WESCCY    FESCCY                                              CLE034
     C                     MOVE WEICCY    FEICCY                                              CLE034
     C                     MOVE WEPSCY    FEPSCY                                              CLE034
     C                     MOVE WEREXR    FEREXR                                              CLE034
     C                     MOVE WEREXI    FEREXI                                              CLE034
     C                     MOVE WEPEXR    FEPEXR                                              CLE034
     C                     MOVE WEPEXI    FEPEXI                                              CLE034
     C                     MOVE WSROBN    ROBN                                                CLE034
     C                     MOVE WSROCN    ROCN                                                CLE034
     C                     MOVE WSRIBN    RIBN                                                CLE034
     C                     MOVE WSRIBA    RIBA                                                CLE034
     C                     MOVE WSPOBN    POBN                                                CLE034
     C                     MOVE WSPOCN    POCN                                                CLE034
     C                     MOVE WSPIBN    PIBN                                                CLE034
     C                     MOVE WSPIBA    PIBA                                                CLE034
     C                     MOVE WSCVMR    CVMR                                                CLE034
     C                     MOVE WSRVNO    RVNO                                                CLE034
     C                     MOVE WSRCRA    RCRA                                                CLE034
     C                     MOVE WSRCRN    RCRN                                                CLE034
     C                     ELSE                                                               CLE034
     C                     MOVE WAOURS    FAOURS                                              CLE034
     C                     MOVE WAMETH    FAMETH                                              CLE034
     C                     MOVE WAOSBR    FAOSBR                                              CLE034
     C                     MOVE WATHER    FATHER                                              CLE034
     C                     MOVE WSPSTM    PSTM                                                CLE034
     C                     MOVE WSPONS    PONS                                                CLE034
     C                     MOVE WSRSTM    RSTM                                                CLE034
     C                     MOVE WSRONS    RONS                                                CLE034
     C                     MOVE WASCCY    FASCCY                                              CLE034
     C                     MOVE WAICCY    FAICCY                                              CLE034
     C                     MOVE WAPSCY    FAPSCY                                              CLE034
     C                     MOVE WAREXR    FAREXR                                              CLE034
     C                     MOVE WAREXI    FAREXI                                              CLE034
     C                     MOVE WAPEXR    FAPEXR                                              CLE034
     C                     MOVE WAPEXI    FAPEXI                                              CLE034
     C                     MOVE WSROBN    ROBN                                                CLE034
     C                     MOVE WSROCN    ROCN                                                CLE034
     C                     MOVE WSRIBN    RIBN                                                CLE034
     C                     MOVE WSRIBA    RIBA                                                CLE034
     C                     MOVE WSPOBN    POBN                                                CLE034
     C                     MOVE WSPOCN    POCN                                                CLE034
     C                     MOVE WSPIBN    PIBN                                                CLE034
     C                     MOVE WSPIBA    PIBA                                                CLE034
     C                     MOVE WSCVMR    CVMR                                                CLE034
     C                     MOVE WSRVNO    RVNO                                                CLE034
     C                     MOVE WSRCRA    RCRA                                                CLE034
     C                     MOVE WSRCRN    RCRN                                                CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C                     ENDSR                                                              CLE034
      *                                                                                       CLE034
     C*****************************************************************
     C*
     C***  INIT SUBROUTINE TO PERFORM FIRST CYCLE CALCS.
     C*
     C***  CALLED FROM: MAIN PROCESSING
     C*
     C***  CALLS: ZDATE2,*PSSR,DBERR
     C*
     C********************************************************************
     C*
     C           INIT      BEGSR
     C*
     C                     MOVE 'Y'       WFIRST  1
     C                     MOVEACPY@      BIS@   80
     C*
     C           *NAMVAR   DEFN           LDA
     C*
     C           *NAMVAR   DEFN           RUNDAT
     C                     IN   RUNDAT
     C*
      *
      ** Initialise LDA
      *
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LE1069'  DBPGM
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     OUT  LDA
      *
     C*
     C                     MOVEL'LE1069'  DBPGM
     C*
     C*
     C*
     C***  ACCESS BANK DETAILS FOR TITLE
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG   ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C**
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'*READ'   DBKEY            ************
     C                     Z-ADD8         DBASE            * DBERR 08
     C                     MOVEL'SDBANKPD'DBFILE           ************
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LE1069 ' DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     EXSR DBERR
     C                     ENDIF
     C*
     C                     MOVE BJMRDT    RUNDAX  7
      *
     C                     CALL 'AOMMODR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' @OPTN
     C           SDMMOD    PARM SDMMOD    DSFDY
     C           PRTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'SDMMODPD'DBFILE           ************
     C                     Z-ADD9         DBASE            * DBERR 09 *
     C                     MOVEL'*FIRST'  DBKEY            ************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     EXSR DBERR
     C                     ENDIF
      *
     C                     MOVELBGMBIN    MBIN    1
      *
     C** ACCESS TRADING DATA
     C*
     C                     CALL 'AOTRADR0'
     C                     PARM '*DBERR ' @RTCD   7
     C                     PARM '*FIRST ' @OPTN   7
     C           SDTRAD    PARM SDTRAD    DSFDY
     C*
      *
     C* READ IN INFORMATION FOR DEALING CURRENCIES.
     C* STORE IN ARRAYS
     C                     Z-ADD1         X       30
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*FIRST ' @OPTN
     C                     PARM           PCURR   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C                     MOVE A6CYCD    CURR,X
     C                     MOVELA6SPRT    SPRT,X           SPOT RATE
     C                     MOVE A6NBDP    NBDP,X           DEC.PLACES
     C                     MOVE A6MDIN    MDI,X            MULT/DIV
     C                     MOVE A6TXND    TND,X            Telex Noti.
     C                     MOVE A6INCY    INCY,X           IN ccy         CLE031
      *
      *
     C           PRTCD     DOWNE'*EOF    '
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   PRTCD
     C                     PARM '*NEXT  ' @OPTN
     C                     PARM           PCURR   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           PRTCD     IFNE '*EOF    '
     C           A6DLCI    ANDEQ'Y'
      *
     C                     ADD  1         X
     C                     MOVE A6CYCD    CURR,X
     C                     MOVELA6SPRT    SPRT,X           SPOT RATE
     C                     MOVE A6NBDP    NBDP,X           DEC.PLACES
     C                     MOVE A6MDIN    MDI,X            MULT/DIV
     C                     MOVE A6TXND    TND,X            Telex Noti.
     C                     MOVE A6INCY    INCY,X           IN ccy         CLE031
      *
     C                     ENDIF
      *
     C                     ENDDO
     C*
     C* READ IN INFORMATION FOR BRANCH AND THEIR CORRESPONDING BRANCH
     C* INTERNAL CUSTOMER NUMBER
     C*
     C                     Z-ADD1         X       30
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*BLANKS' PRTCD
     C                     PARM '*FIRST ' @OPTN   7
     C                     PARM           @DSNB   3
     C           SDBRCH    PARM SDBRCH    DSSDY
     C                     MOVE A8BRCD    BRCH,X
     C                     MOVE A8BICN    BICU,X           Brch Int.Cus
      *
     C           PRTCD     DOWNE'*EOF    '
      *
     C**********           CALL 'AOBRCHR0'                                                    CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM '*BLANKS' PRTCD
     C                     PARM '*NEXT  ' @OPTN
     C                     PARM           @DSNB
     C           SDBRCH    PARM SDBRCH    DSSDY
      *
     C           PRTCD     IFNE '*EOF    '
      *
     C                     ADD  1         X
     C                     MOVE A8BRCD    BRCH,X
     C                     MOVE A8BICN    BICU,X           Brch Int.Cus
      *
     C                     ENDIF
      *
     C                     ENDDO
      *
     C           BJSBRC    IFNE *BLANKS
      *
     C**********           Z-ADD1         Z       20                                          212398
     C                     Z-ADD1         Z       30                                          212398
     C           BJSBRC    LOKUPBRCH,Z                   30
     C           *IN30     IFEQ *OFF
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE BRCA      DBKEY            ************
     C                     Z-ADD11        DBASE            * DBERR 11
     C                     MOVE 'LEFEED'  DBFILE           ************
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LE1069'  DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     EXSR DBERR
     C                     ELSE
     C                     MOVE BICU,Z    BICN
     C                     ENDIF
     C                     ENDIF
      *
     C*
     C*  CHECK IF LE SETTLEMENT CCY CONVERSION FEATURE IS ON
     C                     MOVE 'N'       CEU004  1
     C                     MOVE 'CEU004'  @SARD   6
     C                     CALL 'AOSARDR0'PLIST3
     C           @RTCD     IFEQ *BLANK
     C                     MOVE 'Y'       CEU004
     C                     ELSE
     C           @RTCD     IFNE '*NRF   '
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'*VERIFY' DBKEY            ************
     C                     Z-ADD12        DBASE            * DBERR 12
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LE1069 ' DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     EXSR DBERR
     C                     ENDIF
     C                     ENDIF
     C*
     C*  CHECK IF LENDING SWITCHABLE FEATURE IS ON
     C                     MOVE 'N'       S01518  1
     C                     MOVE 'S01518'  @SARD   6
     C                     CALL 'AOSARDR0'PLIST3
     C           @RTCD     IFEQ *BLANK
     C                     MOVE 'Y'       S01518
     C                     ELSE
     C           @RTCD     IFNE '*NRF   '
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBKEY
     C                     MOVEL'*VERIFY' DBKEY            ************
     C                     Z-ADD10        DBASE            * DBERR 10
     C                     MOVEL'SCSARDPD'DBFILE           ************
     C                     MOVE *BLANKS   DBPGM
     C                     MOVEL'LE1069 ' DBPGM
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     EXSR DBERR
     C                     ENDIF
     C                     ENDIF
     C/COPY WNCPYSRC,LEH00740
     C*                                                                   CLE031
     C*  CHECK IF CLE031 SWITCHABLE FEATURE IS ON                         CLE031
     C                     MOVE 'N'       CLE031  1                       CLE031
     C                     MOVE 'CLE031'  @SARD                           CLE031
     C                     CALL 'AOSARDR0'PLIST3                          CLE031
     C           @RTCD     IFEQ *BLANK                                    CLE031
     C                     MOVE 'Y'       CLE031                          CLE031
     C                     ELSE                                           CLE031
     C           @RTCD     IFNE '*NRF   '                                 CLE031
     C           *LOCK     IN   LDA                                       CLE031
     C                     MOVE *BLANKS   DBKEY                           CLE031
     C                     MOVEL'*VERIFY' DBKEY            ************   CLE031
     C                     Z-ADD13        DBASE            * DBERR 13     CLE031
     C                     MOVEL'SCSARDPD'DBFILE           ************   CLE031
     C                     MOVE *BLANKS   DBPGM                           CLE031
     C                     MOVEL'LE1069 ' DBPGM                           CLE031
     C                     OUT  LDA                                       CLE031
     C                     EXSR *PSSR                                     CLE031
     C                     EXSR DBERR                                     CLE031
     C                     ENDIF                                          CLE031
     C                     ENDIF                                          CLE031
      *                                                                                       CLE073
      ** Check if feature CLE073 is ON                                                        CLE073
      *                                                                                       CLE073
     C                     MOVE 'N'       CLE073  1                                           CLE073
     C                     MOVE 'CLE073'  @SARD   6                                           CLE073
     C                     CALL 'AOSARDR0'PLIST3                                              CLE073
     C           @RTCD     IFEQ *BLANK                                                        CLE073
     C                     MOVE 'Y'       CLE073                                              CLE073
     C                     MOVE *OFF      *IN98                                               CLE073
     C                     ENDIF                                                              CLE073
      *                                                                                       CLE073
      ** KLIST for file CLOAN                                                                 CLE073
      *                                                                                       CLE073
     C           KLOAN     KLIST                                                              CLE073
     C                     KFLD           FELOAN                                              CLE073
     C                     KFLD           WCLRT   1                                           CLE073
     C                     MOVE 'A'       WCLRT                                               CLE073
      *                                                                                       CLE134
     C           KLOANP    KLIST                                                              CLE134
     C                     KFLD           YPLON                                               CLE134
     C                     KFLD           WCLRT                                               CLE134
      *                                                                                       CLE134
      *                                                                                       CLE073
      ** Key to access HISTSHP                                                                CLE073
      *                                                                                       CLE073
     C           KEYHST    KLIST                                                              CLE073
     C                     KFLD           FEBRCA                                              CLE073
     C                     KFLD           FECNUM                                              CLE073
     C                     KFLD           FELOAN                                              CLE073
     C                     KFLD           KVDAT   50                                          CLE073
     C                     KFLD           WLASN   30                                          CLE073
     C                     Z-ADD999       WLASN                                               CLE073
      *                                                                                       CLE073
      ** Partial Key to process HISTSHP                                                       CLE073
      *                                                                                       CLE073
     C           KEYPHS    KLIST                                                              CLE073
     C                     KFLD           FEBRCA                                              CLE073
     C                     KFLD           FECNUM                                              CLE073
     C                     KFLD           FELOAN                                              CLE073
      *                                                                                       CLE034
      ** Determine if Lending Enhancements for Phase 1 Priority 1A                            CLE034
      ** (Switchable feature CLE034) is installed                                             CLE034
      *                                                                                       CLE034
     C                     MOVE 'N'       CLE034  1                                           CLE034
     C                     MOVE 'CLE034'  @SARD                                               CLE034
     C                     CALL 'AOSARDR0'PLIST3                                              CLE034
     C           @RTCD     IFEQ *BLANKS                                                       CLE034
     C                     MOVE 'Y'       CLE034                                              CLE034
     C                     ELSE                                                               CLE034
     C           @RTCD     IFNE '*NRF   '                                                     CLE034
     C           *LOCK     IN   LDA                                                           CLE034
     C                     MOVE *BLANKS   DBKEY                                               CLE034
     C                     MOVEL'*VERIFY' DBKEY                                               CLE034
     C                     Z-ADD14        DBASE                                               CLE034
     C                     MOVEL'SCSARDPD'DBFILE                                              CLE034
     C                     MOVE *BLANKS   DBPGM                                               CLE034
     C                     MOVEL'LE1069 ' DBPGM                                               CLE034
     C                     OUT  LDA                                                           CLE034
     C                     EXSR *PSSR                                                         CLE034
     C                     EXSR DBERR                                                         CLE034
     C                     ENDIF                                                              CLE034
     C                     ENDIF                                                              CLE034
      *                                                                                       CLE034
     C           *LIKE     DEFN FCNO1     PPTYPE                                              CLE034
     C           *LIKE     DEFN WWAMT     WSAMT                                               CLE034
     C           *LIKE     DEFN WWAMT     TOTAMT                                              CLE034
     C           *LIKE     DEFN WWAMT     WKAMT                                               CLE034
     C           *LIKE     DEFN FEOURS    WEOURS                                              CLE034
     C           *LIKE     DEFN FESTTL    WESTTL                                              CLE034
     C           *LIKE     DEFN FEOSBR    WEOSBR                                              CLE034
     C           *LIKE     DEFN FETHER    WETHER                                              CLE034
     C           *LIKE     DEFN PSTM      WSPSTM                                              CLE034
     C           *LIKE     DEFN PONS      WSPONS                                              CLE034
     C           *LIKE     DEFN RSTM      WSRSTM                                              CLE034
     C           *LIKE     DEFN RONS      WSRONS                                              CLE034
     C           *LIKE     DEFN FESCCY    WESCCY                                              CLE034
     C           *LIKE     DEFN FEICCY    WEICCY                                              CLE034
     C           *LIKE     DEFN FEPSCY    WEPSCY                                              CLE034
     C           *LIKE     DEFN FEREXR    WEREXR                                              CLE034
     C           *LIKE     DEFN FEREXI    WEREXI                                              CLE034
     C           *LIKE     DEFN FEPEXR    WEPEXR                                              CLE034
     C           *LIKE     DEFN FEPEXI    WEPEXI                                              CLE034
     C           *LIKE     DEFN ROBN      WSROBN                                              CLE034
     C           *LIKE     DEFN ROCN      WSROCN                                              CLE034
     C           *LIKE     DEFN RIBN      WSRIBN                                              CLE034
     C           *LIKE     DEFN RIBA      WSRIBA                                              CLE034
     C           *LIKE     DEFN POBN      WSPOBN                                              CLE034
     C           *LIKE     DEFN POCN      WSPOCN                                              CLE034
     C           *LIKE     DEFN PIBN      WSPIBN                                              CLE034
     C           *LIKE     DEFN PIBA      WSPIBA                                              CLE034
     C           *LIKE     DEFN CVMR      WSCVMR                                              CLE034
     C           *LIKE     DEFN RVNO      WSRVNO                                              CLE034
     C           *LIKE     DEFN RCRN      WSRCRN                                              CLE034
     C           *LIKE     DEFN RCRA      WSRCRA                                              CLE034
     C           *LIKE     DEFN FAOURS    WAOURS                                              CLE034
     C           *LIKE     DEFN FAMETH    WAMETH                                              CLE034
     C           *LIKE     DEFN FAOSBR    WAOSBR                                              CLE034
     C           *LIKE     DEFN FATHER    WATHER                                              CLE034
     C           *LIKE     DEFN FASCCY    WASCCY                                              CLE034
     C           *LIKE     DEFN FAPSCY    WAPSCY                                              CLE034
     C           *LIKE     DEFN FAICCY    WAICCY                                              CLE034
     C           *LIKE     DEFN FAREXR    WAREXR                                              CLE034
     C           *LIKE     DEFN FAREXI    WAREXI                                              CLE034
     C           *LIKE     DEFN FAPEXR    WAPEXR                                              CLE034
     C           *LIKE     DEFN FAPEXI    WAPEXI                                              CLE034
      *
      ** Check whether SAR CAS009 is installed or not.                                        CAS009
      *                                                                                       CAS009
     C                     CALL 'AOSARDR0'                                                    CAS009
     C                     PARM *BLANK    PRTCD                                               CAS009
     C                     PARM '*VERIFY' POPTN   7                                           CAS009
     C                     PARM 'CAS009'  PSARD   6                                           CAS009
     C           SCSARD    PARM SCSARD    DSFDY                                               CAS009
      *                                                                                       CAS009
     C           PRTCD     IFEQ *BLANK                                                        CAS009
     C                     MOVE 'Y'       CAS009  1                                           CAS009
     C                     ELSE                                                               CAS009
     C                     MOVE 'N'       CAS009                                              CAS009
     C           PRTCD     IFNE '*NRF   '                                                     CAS009
     C                     MOVEL'LE1069  'DBPGM     P                                         CAS009
     C                     MOVEL'SCSARDPD'DBFILE    P                                         CAS009
     C                     Z-ADD51        DBASE                                               CAS009
     C                     MOVEL'CAS009'  DBKEY     P                                         CAS009
     C                     EXSR *PSSR                                                         CAS009
     C                     EXSR DBERR                                                         CAS009
     C                     ENDIF                                                              CAS009
     C                     ENDIF                                                              CAS009
      *                                                                                       CAS009
     C           KFCLTY    KLIST
     C** Define Key List for FCLTY( Facility File )
     C                     KFLD           FECNUM           Cust Nbr
     C                     KFLD           FACT1            Facil
     C                     KFLD           FCNO1
     C*
      *
     C           KLEFD     KLIST
     C** Define Key List for LEFEEDL1( Fee File )
     C                     KFLD           FACNUM           Cust Nbr
     C                     KFLD           FAFACL           Facility
     C                     KFLD           FALOAN           Loan
     C                     KFLD           FAFSEQ           Fee Sequen.
     C*
      *
     C           KLEFEA    KLIST
     C** Define Key List for LEFEADL0( Fee File )
     C                     KFLD           FECNUM           Cust Nbr
     C                     KFLD           FEFACL           Facility
     C                     KFLD           FELOAN           Loan
     C                     KFLD           FEFSEQ           Fee Sequen.
     C*
      *
     C           KLEFT1    KLIST
     C** Define Key List for LEFEETL0( Fee Temporary Activity File)
     C                     KFLD           FECNUM           Cust Nbr
     C                     KFLD           FEFACL           Facility
     C                     KFLD           STDATE           Start Date
     C*
     C           KLEFT2    KLIST
     C** Define Key List for LEFEETL0( Fee Temporary Activity File)
     C                     KFLD           FECNUM           Cust Nbr
     C                     KFLD           FEFACL           Facility
     C*
      *
     C           KFACH     KLIST
     C** Define Key List for FACHISH ( Facility History Header File)
     C                     KFLD           FECNUM           Cust Nbr
     C                     KFLD           FACT1            Fac. Type
     C                     KFLD           FCNO1            Fac. Nbr
     C*
     C** PARAMETER LIST FOR PROGRAM 'AONOSTR0'
     C*
     C           PLIST1    PLIST
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           KCNUM   6                    A
     C                     PARM           KCCY    3                    B
     C**********           PARM           KEYC    4                    C                      CGL029
     C                     PARM           KEYC   10                                           CGL029
     C                     PARM           KEYD    2                    D
     C                     PARM           KNONB   2                    E
     C                     PARM           KEYF    3                    F
     C                     PARM           KEYG   10                    G
     C                     PARM           KEYH    1                    H
     C           SDNOST    PARM SDNOST    DSFDY
     C*
     C** PARAMETER LIST FOR PROGRAM 'AOCUSTR0'
     C           PLIST2    PLIST
     C                     PARM '*MSG   ' @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM           CKEY   10
     C                     PARM '*CNUM  ' KEYSTS  7
     C           SDCUST    PARM SDCUST    DSSDY
     C*
     C*
     C** Parameter list for program 'AOSARDR0'
     C*
     C           PLIST3    PLIST
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM           @SARD
     C           SCSARD    PARM SCSARD    DSFDY
      *                                                                                       CLE141
      ** PLIST for program LEZBDYCD                                                           CLE141
      *                                                                                       CLE141
     C           BDCHK     PLIST                                                              CLE141
     C                     PARM           ZDAYNO                                              CLE141
     C                     PARM           ACCY                                                CLE141
     C                     PARM           ALOC                                                CLE141
     C                     PARM           PAYIND  1                                           CLE141
     C                     PARM           BJDFIN                                              CLE141
     C                     PARM           CCYLL   3                                          CLE141A
     C                     PARM           LOCLL   3                                          CLE141A
     C                     PARM *ZEROS    ZADJDT  50                                          CLE141
      *                                                                                       CLE141
     C*
      *                                                                                       CLE134
      ** Check if feature CLE134 is ON                                                        CLE134
      *                                                                                       CLE134
     C                     MOVE 'N'       CLE134  1                                           CLE134
     C                     MOVE 'CLE134'  @SARD   6                                           CLE134
     C                     CALL 'AOSARDR0'PLIST3                                              CLE134
     C           @RTCD     IFEQ *BLANK                                                        CLE134
     C                     MOVE 'Y'       CLE134                                              CLE134
     C                     ENDIF                                                              CLE134
      *                                                                                       CLE134
      ***Access*general*ledger*details.********************************            MD035545 MD047993
      *****************************************************************            MD035545 MD047993
     C**********           CALL 'AOGELRR1'                                         MD035545 MD047993
     C**********           PARM '*DBERR ' @RTCD                                    MD035545 MD047993
     C**********           PARM '*FIRST ' @OPTN                                    MD035545 MD047993
     C********** SDGELR    PARM SDGELR    DSSDY                                    MD035545 MD047993
      *                                                                                     MD035545
      ** Retrieve system value setting.                                                     MD035545
      *                                                                                     MD035545
     C                     MOVELWPARML    P@OP01                                            MD035545
     C                     CALL 'AOSVALR0'                                                  MD035545
     C                     PARM *BLANKS   @RTCD                                             MD035545
     C                     PARM           P@OP01 20                                         MD035545
     C                     PARM           P@VL01200                                         MD035545
     C                     PARM           P@OP02 20                                         MD035545
     C                     PARM           P@VL02200                                         MD035545
     C                     PARM           P@OP03 20                                         MD035545
     C                     PARM           P@VL03200                                         MD035545
     C                     PARM           P@OP04 20                                         MD035545
     C                     PARM           P@VL04200                                         MD035545
     C                     PARM           P@OP05 20                                         MD035545
     C                     PARM           P@VL05200                                         MD035545
     C                     PARM           P@OP06 20                                         MD035545
     C                     PARM           P@VL06200                                         MD035545
     C                     PARM           P@OP07 20                                         MD035545
     C                     PARM           P@VL07200                                         MD035545
     C                     PARM           P@OP08 20                                         MD035545
     C                     PARM           P@VL08200                                         MD035545
     C                     PARM           P@OP09 20                                         MD035545
     C                     PARM           P@VL09200                                         MD035545
     C                     PARM           P@OP10 20                                         MD035545
     C                     PARM           P@VL10200                                         MD035545
      *                                                                                     MD035545
      ** If system value is not found then default value to 'N'.                            MD035545
      *                                                                                     MD035545
     C           @RTCD     IFNE '       '                                                   MD035545
     C                     MOVE 'N'       WCALC6                                            MD035545
     C                     ELSE                                                             MD035545
     C                     MOVELP@VL01    WCALC6                                            MD035545
     C********** WCALC6    IFEQ 'Y'                                                MD035545 MD047993
     C********** BKALDI    ANDEQ'Y'                                                MD035545 MD047993
     C**********           MOVE 'Y'       WCALC6                                   MD035545 MD047993
     C**********           ELSE                                                    MD035545 MD047993
     C**********           MOVE 'N'       WCALC6                                   MD035545 MD047993
     C**********           ENDIF                                                   MD035545 MD047993
     C                     ENDIF                                                            MD035545
      *                                                                                     MD035545
     C                     CALL 'AOSVALR0'                                                  MD046370
     C                     PARM *BLANKS   @RTCD                                             MD046370
     C                     PARM WPARM1    P@OP01                                            MD046370
     C                     PARM *BLANKS   P@VL01                                            MD046370
     C                     PARM *BLANKS   P@OP02                                            MD046370
     C                     PARM *BLANKS   P@VL02                                            MD046370
     C                     PARM *BLANKS   P@OP03                                            MD046370
     C                     PARM *BLANKS   P@VL03                                            MD046370
     C                     PARM *BLANKS   P@OP04                                            MD046370
     C                     PARM *BLANKS   P@VL04                                            MD046370
     C                     PARM *BLANKS   P@OP05                                            MD046370
     C                     PARM *BLANKS   P@VL05                                            MD046370
     C                     PARM *BLANKS   P@OP06                                            MD046370
     C                     PARM *BLANKS   P@VL06                                            MD046370
     C                     PARM *BLANKS   P@OP07                                            MD046370
     C                     PARM *BLANKS   P@VL07                                            MD046370
     C                     PARM *BLANKS   P@OP08                                            MD046370
     C                     PARM *BLANKS   P@VL08                                            MD046370
     C                     PARM *BLANKS   P@OP09                                            MD046370
     C                     PARM *BLANKS   P@VL09                                            MD046370
     C                     PARM *BLANKS   P@OP10                                            MD046370
     C                     PARM *BLANKS   P@VL10                                            MD046370
      *                                                                                     MD046370
     C           @RTCD     IFNE *BLANKS                                                     MD046370
     C           *LOCK     IN   LDA                                                         MD046370
     C                     MOVE *BLANKS   DBKEY                                             MD046370
     C                     MOVELWPARM1    DBKEY                                             MD046370
     C                     Z-ADD16        DBASE                                             MD046370
     C                     MOVEL'SDSVALPD'DBFILE                                            MD046370
     C                     MOVE *BLANKS   DBPGM                                             MD046370
     C                     MOVEL'LE1069 ' DBPGM                                             MD046370
     C                     OUT  LDA                                                         MD046370
     C                     EXSR *PSSR                                                       MD046370
     C                     EXSR DBERR                                                       MD046370
     C                     ELSE                                                             MD046370
     C                     MOVELP@VL01    AUENFE  1                                         MD046370
     C                     ENDIF                                                            MD046370
      *                                                                                     MD046370
      ** Check if feature CLE141 is ON                                                        CLE141
      *                                                                                       CLE141
     C                     MOVE 'N'       CLE141  1                                           CLE141
     C                     MOVE 'CLE141'  @SARD                                               CLE141
     C                     CALL 'AOSARDR0'PLIST3                                              CLE141
     C           @RTCD     IFEQ *BLANK                                                        CLE141
     C                     MOVE 'Y'       CLE141                                              CLE141
     C                     ENDIF                                                              CLE141
      *                                                                                       CLE141
     C                     ENDSR
     C*
     C*****************************************************************
     C*
     C***  DBERR SUBROUTINE TO PERFORM DATABASE ERROR PROCESSING
     C*
     C***  CALLED FROM: INIT
     C*
     C***  CALLS: NOTHING
     C*
     C********************************************************************
     C*
     C           DBERR     BEGSR
     C*
     C*
     C***  Ensure audit spool file recorded by RCF
     C*
     C                     WRITELE1069A1
     C                     WRITEDBFMT
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C/EJECT
     C*****************************************************************
     C*
     C***  *PSSR  --- SUBROUTINE TO HANDLE ABNORMAL ERROR CONDITIONS
     C*
     C***  CALLED FROM: AFTER ABNORNAL OPERATION OCCURS
     C*
     C***  CALLS: NOTHING
     C*
     C********************************************************************
     C*
     C           *PSSR     BEGSR                           ** *PSSR **
     C*
     C           @RUN      IFEQ *BLANKS
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     END
     C*
     C                     ENDSR                           ** *PSSR **
     C********************************************************************
      /TITLE SR/ZINTDY                                                    CLE013
     C/COPY ZSRSRC,ZINTDYZ2                                               CLE013
      /TITLE SR/ZDATE9                                                    CLE013
     C/COPY ZSRSRC,ZDATE9Z3                                               CLE013
      /TITLE SR/ZDAT10                                                    CLE013
     C/COPY ZSRSRC,ZDAT10Z2                                               CLE013
      *                                                                                       CLE073
     C/COPY ZSRSRC,ZFREQBZ2                                                                   CLE073
     C/COPY ZSRSRC,ZDATE1Z2                                                                   CLE073
     C/COPY ZSRSRC,ZDATE2Z2                                                                   CLE073
     C/COPY ZSRSRC,ZCHKH                                                                      CLE073
     C/COPY ZSRSRC,ZFRQB3                                                                     CLE141
      *                                                                                       CLE073
     C/EJECT
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   TABCAL/TABCBS - CALCULATION BASES.
136500236000336000436500536000636600
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN    CLE013
00366007310109601461                                                      CLE013
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR       CLE013
00000000310005900090001200015100181002120024300273003040033400365         CLE013
**   ZFMD  -  NUMBER OF DAYS IN THE MONTH                                                     CLE073
312831303130313130313031                                                                      CLE073
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                                          CLE073
0366073110961461                                                                              CLE073
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                                            CLE073
000031059090120151181212243273304334365                                                       CLE073
**   ZMNM - MONTHS SHORT NAMES                                                                CLE073
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC                                                          CLE073